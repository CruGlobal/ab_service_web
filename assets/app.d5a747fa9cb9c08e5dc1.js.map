{"version":3,"file":"app.d5a747fa9cb9c08e5dc1.js","mappings":"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","sources":["webpack://ab_platform_web/./config/configDesktop.js","webpack://ab_platform_web/./config/configMobile.js","webpack://ab_platform_web/./config/Config.js","webpack://ab_platform_web/./ui/portal_loading.js","webpack://ab_platform_web/./ui/portal_auth_login_form.js","webpack://ab_platform_web/./ui/portal_auth_login_resetPassword.js","webpack://ab_platform_web/./ui/portal_auth_login_resetRequest.js","webpack://ab_platform_web/./ui/portal_auth_login.js","webpack://ab_platform_web/./ui/portal_auth.js","webpack://ab_platform_web/./ui/ClassUIPage.js","webpack://ab_platform_web/./ui/portal_work_inbox_accordion.js","webpack://ab_platform_web/./ui/portal_work_inbox_taskWindow.js","webpack://ab_platform_web/./ui/portal_work_inbox.js","webpack://ab_platform_web/./ui/portal_work_user_profile_window.js","webpack://ab_platform_web/./ui/portal_work_user_switcheroo.js","webpack://ab_platform_web/./ui/portal_work_user_qr_window.js","webpack://ab_platform_web/./ui/portal_work_user_mobile_qr.js","webpack://ab_platform_web/./ui/portal_access_level_manager.js","webpack://ab_platform_web/./ui/portal_translation_tool.js","webpack://ab_platform_web/./ui/portal_tutorial_manager.js","webpack://ab_platform_web/./ui/portal_work.js","webpack://ab_platform_web/./ui/portal.js","webpack://ab_platform_web/./ui/ui.js","webpack://ab_platform_web/./ui/error_noDefs.js","webpack://ab_platform_web/./init/Bootstrap.js","webpack://ab_platform_web/./init/initDiv.js","webpack://ab_platform_web/./init/initConfig.js","webpack://ab_platform_web/./init/initUser.js","webpack://ab_platform_web/./index.js","webpack://ab_platform_web/./ui/ClassUI.js","webpack://ab_platform_web/./utils/performance.js","webpack://ab_platform_web/webpack/runtime/startup prefetch"],"sourcesContent":["/**\n * @class configDesktop\n *\n * Manage our configuration settings for Desktop styles.\n\n */\n\nexport default {\n   // Application List\n   appListRowHeight: 67,\n\n   // button types\n   buttonWidthLarge: 200,\n   buttonWidthMedium: 150,\n   buttonWidthSmall: 100,\n   buttonWidthExtraSmall: 50,\n\n   // tab types\n   tabWidthLarge: 200,\n   tabWidthMedium: 120,\n   tabWidthSmall: 100,\n   tabWidthExtraSmall: 50,\n\n   // column types\n   columnWidthXLarge: 350,\n   columnWidthLarge: 250,\n   columnWidthMedium: 200,\n   columnWidthSmall: 150,\n   columnWidthExtraSmall: 100,\n\n   // spacers\n   xSmallSpacer: 5,\n   smallSpacer: 10,\n   mediumSpacer: 25,\n   largeSpacer: 50,\n   xLargeSpacer: 100,\n   xxLargeSpacer: 200,\n   xxxLargeSpacer: 400,\n   appListSpacerRowHeight: 100,\n   appListSpacerColMinWidth: 100,\n   appListSpacerColMaxWidth: 200,\n   objectWorkspaceColWidth: 20,\n\n   // labels\n   labelWidthSmall: 50,\n   labelWidthMedium: 80,\n   labelWidthLarge: 120,\n   labelWidthXLarge: 150,\n   labelWidthXXLarge: 200,\n   labelWidthXXXLarge: 280,\n   labelWidthCheckbox: 0,\n\n   // show elements on desktop\n   hideMobile: false,\n};\n","/**\n * @class configMobile\n *\n * Manage our configuration settings for mobile styles.\n\n */\n\nexport default {\n   // Application List\n   appListRowHeight: 67,\n\n   // button types\n   buttonWidthLarge: 200,\n   buttonWidthMedium: 150,\n   buttonWidthSmall: 100,\n   buttonWidthExtraSmall: 50,\n\n   // tab types\n   tabWidthLarge: 200,\n   tabWidthMedium: 120,\n   tabWidthSmall: 100,\n   tabWidthExtraSmall: 50,\n\n   // column types\n   columnWidthLarge: 250,\n   columnWidthMedium: 200,\n   columnWidthSmall: 150,\n   columnWidthExtraSmall: 100,\n\n   // spacers\n   xSmallSpacer: 1,\n   smallSpacer: 1,\n   mediumSpacer: 10,\n   largeSpacer: 20,\n   xLargeSpacer: 50,\n   xxLargeSpacer: 100,\n   xxxLargeSpacer: 120,\n   appListSpacerRowHeight: 10,\n   appListSpacerColMinWidth: 1,\n   appListSpacerColMaxWidth: 1,\n   objectWorkspaceColWidth: 1,\n\n   // labels\n   labelWidthSmall: 50,\n   labelWidthMedium: 80,\n   labelWidthLarge: 120,\n   labelWidthXLarge: 120,\n   labelWidthXXLarge: 120,\n   labelWidthCheckbox: 0,\n\n   // hide elements for mobile\n   hideMobile: true,\n};\n","import ConfigDesktop from \"./configDesktop\";\nimport ConfigMobile from \"./configMobile\";\n\n// var EventEmitter = require(\"events\").EventEmitter;\nimport { defaultsDeep } from \"lodash\";\n\nconst settingsDefault = {\n   \"appbuilder-portal-autoenter\": true,\n   // {bool} autoenter\n   // open up the portal as soon as we load.\n   //   false : just displays a link that will load the portal\n\n   \"appbuilder-portal-fullscreen\": true,\n   // {bool} fullscreen\n   // take up the full browser window?\n   //   false : only take up the area the current div is\n\n   \"appbuilder-tenant\": null,\n   // {string} tenant\n   // the tenant uuid for this AppBuilder instance.\n\n   \"appbuilder-view\": \"work\",\n   // {string} view\n   // the default view to display to the current user.\n\n   \"appbuilder-tenant-prefix\": null,\n   // TESTING! Remove this\n};\n\nconst configDefaults = {\n   site: {\n      appbuilder: {\n         networkType: \"socket\",\n         // options: [\"rest\", \"relay\", \"socket\"]\n         // Note: \"socket\" is required for realtime updates across devices.\n\n         networkNumRetries: 3,\n         // the number of times we will retry sending a network request\n         // when we receive a timeout error.\n\n         urlCoreServer: window.location.origin,\n         // on the web client, just record the current URL by default.\n         // the site config can override this if they want.\n      },\n      storage: {\n         encrypted: false,\n         // {bool} should we encrypt our data in the local browser storage?\n      },\n   },\n};\nclass Config {\n   constructor() {\n      // this.setMaxListeners(0);\n      this._config = null;\n      // {obj} _config\n      // these are the configuration settings returned from the server. These\n      // are more detailed configuration settings for the running of the site.\n\n      this._configUser = null;\n      // {obj} _configUser\n      // the default settings for the current user of the system.\n      //    .user {obj}  the current info for who we think is using the site\n      //    .userReal {obj}  if switheroo'd, this is the actual user\n\n      this._settings = {};\n      // {obj} _settings\n      // settings are the configuration parameters found on the base <div>\n      // these settings are the minimum needed to successfully pull up the\n      // portal popup and perform the initial config request\n   }\n\n   config(json) {\n      this._config = this._config || {};\n      Object.keys(json).forEach((k) => {\n         this._config[k] = json[k];\n      });\n      defaultsDeep(this._config, configDefaults);\n   }\n\n   configInbox(json) {\n      this._config = this._config || {};\n      this._config.inbox = json.inbox || [];\n      this._config.inboxMeta = json.inboxMeta || [];\n   }\n\n   configUser(json) {\n      this._configUser = json;\n   }\n\n   setting(key, value) {\n      if (value) {\n         this._settings[key] = value;\n         return;\n      }\n      return this._settings[key];\n   }\n\n   settingsFromDiv(div) {\n      Object.keys(settingsDefault).forEach((d) => {\n         var val = div.getAttribute(d);\n         if (!val) {\n            val = settingsDefault[d];\n         }\n         if (val === \"false\") val = false;\n         if (val === \"true\") val = true;\n\n         var key = d.split(\"-\").pop();\n         this.setting(key, val);\n      });\n   }\n\n   settings(json = {}) {\n      for (let key in settingsDefault) {\n         const val = json[key] ?? settingsDefault[key];\n         this.setting(key.split(\"-\").pop(), val);\n      }\n   }\n\n   /**\n    * definitions()\n    * return the ABDefinition(s) required to manage the interface.\n    * @return {obj}\n    *          { ABDefinition.id : {ABDefinition} }  hash of definitions.\n    */\n   definitions() {\n      return window.definitions;\n   }\n\n   error(/* ...args */) {\n      console.error(\"Who is calling this? -> move to AB.error() instead.\");\n      // this.emit(\"ab.error\", args);\n   }\n\n   labelConfig() {\n      if (this._config && this._config.labels) {\n         return this._config.labels;\n      }\n      console.error(\"No Label config found.\");\n      return {};\n   }\n\n   languageConfig() {\n      if (this._config && this._config.languages) {\n         return this._config.languages;\n      }\n      console.error(\"No Language config found.\");\n      return {};\n   }\n\n   metaConfig() {\n      if (this._config && this._config.meta) {\n         return this._config.meta;\n      }\n      console.error(\"No Meta config found.\");\n      return {};\n   }\n\n   plugins() {\n      // TODO: Pull from this._config.plugins\n      return [\"ABDesigner.js\"];\n      // return [];\n   }\n\n   inboxConfig() {\n      if (this._config && this._config.inbox) {\n         return this._config.inbox;\n      }\n      return null;\n   }\n\n   inboxMetaConfig() {\n      if (this._config && this._config.inboxMeta) {\n         return this._config.inboxMeta;\n      }\n      return null;\n   }\n\n   /**\n    * @typedef SiteConfig\n    * @property {Object} appbuilder\n    * @property {number} appbuilder.networkNumRetries\n    * @property {\"socket\"|\"rest\"|\"relay\"} appbuilder.networkType\n    * @property {string} appbuilder.urlCoreServer\n    * @property {boolean} [relay] whether relay is enabled on the server\n    * @property {Object} [storage]\n    * @property {boolean} storage.encrypted\n    * @property {Array<{uuid: string, key: string}>} [tenants]\n    * @property {string} [privacyPolicy]\n    */\n   /** @returns {SiteConfig} */\n   siteConfig() {\n      if (this._config && this._config.site) {\n         return this._config.site;\n      }\n      return configDefaults.site;\n   }\n\n   tenantConfig() {\n      if (this._config && this._config.tenant) {\n         return this._config.tenant;\n      }\n      return null;\n   }\n\n   uiSettings() {\n      if (window.innerWidth < 768) {\n         return ConfigMobile;\n      }\n      return ConfigDesktop;\n   }\n\n   /**\n    * @typedef User - based on SITE_USER\n    * @property {string} email email address\n    * @property {string} id\n    * @property {number} isActive wether the user is active in the system\n    * @property {string} languageCode\n    * @property {string} username\n    * ...\n    */\n\n   /**\n    * Information about the current user\n    * @returns {User|null}\n    */\n   userConfig() {\n      return this._configUser?.user ?? null;\n   }\n\n   userReal() {\n      return this._configUser?.userReal ?? false;\n   }\n}\nexport default new Config();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalLoading extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui() {\n      return {\n         id: \"portal_loading\",\n         view: \"label\",\n         label: \"loading\",\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n\n      return Promise.resolve();\n   }\n\n   show() {\n      $$(\"portal_loading\").show();\n   }\n}\n\nexport default new PortalLoading();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalAuthLoginForm extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui() {\n      var self = this;\n\n      if (!this.AB) {\n         // we need to init() before being able to translate our UI:\n         return {\n            id: \"portal_auth_login_container\",\n         };\n      }\n\n      var L = this.AB.Label();\n\n      return {\n         id: \"portal_auth_login_container\",\n         css: \"portalLogin\",\n         cols: [\n            {},\n            {\n               rows: [\n                  {},\n                  {\n                     width: 360,\n                     rows: [\n                        {\n                           css: \"portalLoginForm\",\n                           padding: 30,\n                           rows: [\n                              {\n                                 template:\n                                    \"<div style='text-align: center; font-size:160px; line-height: 160px;'><i style='background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-user-circle-o'></i></div>\",\n                                 borderless: true,\n                                 height: 190,\n                                 type: \"clean\",\n                              },\n                              {\n                                 id: \"portal_auth_login_form\",\n                                 view: \"form\",\n                                 type: \"clean\",\n                                 css: { background: \"transparent !important\" },\n                                 borderless: true,\n                                 elementsConfig: {\n                                    bottomPadding: 20,\n                                    height: 52,\n                                 },\n                                 elements: [\n                                    {\n                                       view: \"text\",\n                                       placeholder: L(\"Email\"),\n                                       name: \"email\",\n                                       id: \"email\",\n                                       attributes: {\n                                          \"data-cy\":\n                                             \"portal_auth_login_form_email\",\n                                       },\n                                       // required: true,\n                                       validate: webix.rules.isEmail,\n                                       invalidMessage: L(\n                                          \"Please enter a valid email.\"\n                                       ),\n                                       validateEvent: \"blur\",\n                                    },\n                                    {\n                                       view: \"text\",\n                                       type: \"password\",\n                                       placeholder: L(\"Password\"),\n                                       name: \"password\",\n                                       attributes: {\n                                          \"data-cy\":\n                                             \"portal_auth_login_form_password\",\n                                       },\n                                       // required: true,\n                                       validate: webix.rules.isNotEmpty,\n                                       invalidMessage: L(\n                                          \"Please enter your password.\"\n                                       ),\n                                       validateEvent: \"blur\",\n                                    },\n                                    {\n                                       margin: 10,\n                                       paddingX: 2,\n                                       borderless: true,\n                                       cols: [\n                                          {},\n                                          {\n                                             view: \"button\",\n                                             label: L(\"Login\"),\n                                             type: \"form\",\n                                             id: \"portal_auth_login_form_submit\",\n                                             css: \"webix_primary\",\n                                             width: 150,\n                                             hotkey: \"enter\",\n                                             click() {\n                                                var form = $$(\n                                                   \"portal_auth_login_form\"\n                                                );\n                                                if (form.validate()) {\n                                                   $$(\n                                                      \"portal_auth_login_form_submit\"\n                                                   ).hide();\n                                                   $$(\n                                                      \"portal_auth_login_form_submit_wait\"\n                                                   ).show();\n\n                                                   var values =\n                                                      form.getValues();\n                                                   self.error(); // hids the error message\n\n                                                   // this.AB.Network.post()\n                                                   // can either be a Relay or Rest operation.\n                                                   // we should get the response from the\n                                                   // published JobRequest initialized in\n                                                   // the .init() routine.\n                                                   self.AB.Network.post(\n                                                      {\n                                                         url: \"/auth/login\",\n                                                         data: values,\n                                                      },\n                                                      {\n                                                         key: \"portal_auth_login\" /*, context:{} */,\n                                                      }\n                                                   ).catch((err) => {\n                                                      $$(\n                                                         \"portal_auth_login_form_submit\"\n                                                      ).show();\n                                                      $$(\n                                                         \"portal_auth_login_form_submit_wait\"\n                                                      ).hide();\n                                                      console.log(err);\n                                                   });\n                                                }\n                                             },\n                                             on: {\n                                                onAfterRender() {\n                                                   ClassUI.CYPRESS_REF(this);\n                                                },\n                                             },\n                                          },\n                                          {\n                                             view: \"button\",\n                                             label: \"<i class='fa fa-circle-o-notch fa-fw fa-spin'></i>\",\n                                             type: \"form\",\n                                             id: \"portal_auth_login_form_submit_wait\",\n                                             css: \"webix_primary\",\n                                             width: 150,\n                                             hidden: true,\n                                          },\n                                          {},\n                                       ],\n                                    },\n                                    {\n                                       margin: 10,\n                                       paddingX: 2,\n                                       borderless: true,\n                                       cols: [\n                                          {},\n                                          {\n                                             view: \"button\",\n                                             label: L(\"Forgot password?\"),\n                                             css: \"webix_transparent\",\n                                             click: () => {\n                                                this.emit(\"request.reset\");\n                                                // $$(\"portal_auth_login\").hide();\n                                                // $$(\"password_reset_email\").show();\n                                             },\n                                             width: 150,\n                                          },\n                                          {},\n                                       ],\n                                    },\n                                    {\n                                       id: \"portal_auth_login_form_errormsg\",\n                                       view: \"template\",\n                                       css: \"webix_control\",\n                                       height: 32,\n                                       on: {\n                                          onAfterRender() {\n                                             ClassUI.CYPRESS_REF(this);\n                                          },\n                                       },\n                                    },\n                                 ],\n                              },\n                           ],\n                        },\n                        {},\n                        {\n                           cols: [\n                              { width: 20 },\n                              {\n                                 id: \"auth_privacy_policy\",\n                                 view: \"template\",\n                                 template:\n                                    '#pretext# <a href=\"#link#\" target=\"_blank\" class=\"policyAuth\">#label#</a>',\n                                 css: \"policyLink noBackground\",\n                                 height: 30,\n                                 hidden: true,\n                              },\n                              { width: 20 },\n                           ],\n                        },\n                     ],\n                  },\n                  {},\n               ],\n            },\n            {},\n         ],\n      };\n   }\n\n   error(message) {\n      var $errMsg = $$(\"portal_auth_login_form_errormsg\");\n      if (message) {\n         $errMsg.setHTML(\n            `<div class='webix_invalid'><div class='webix_inp_bottom_label'><center>${message}</center></div></div>`\n         );\n         $errMsg.show();\n      } else {\n         $errMsg.hide();\n      }\n   }\n\n   /** @param {import('../AppBuilder/ABFactory.js').default} AB */\n   init(AB) {\n      this.AB = AB;\n\n      // now replace our initial placeholder with our viewable form\n      webix.ui(this.ui(), $$(\"portal_auth_login_container\"));\n\n      this.error(); // hides the default error message.\n\n      this.AB.Network.on(\"portal_auth_login\", (context, err, response) => {\n         // Listen for our login responses:\n         // console.log(\"Network.on():\", context, err, response);\n\n         if (err) {\n            // any http 400-500 response should show up here:\n            if (err.code) {\n               switch (err.code) {\n                  case \"EINVALIDLOGIN\":\n                     this.error(err.message);\n                     break;\n\n                  case \"EFAILEDATTEMPTS\":\n                     this.error(err.message);\n                     $$(\"portal_auth_login_form_submit\").hide();\n                     break;\n\n                  default:\n                     this.AB.error(err);\n                     break;\n               }\n            }\n            return;\n         }\n\n         if (\n            response.user ||\n            (response.status == \"success\" && response.data.user)\n         ) {\n            // reload the page to gather all the config info:\n            window.location.reload(true);\n\n            // Login was successful -> rerun BootStrap.init() to load the\n            // config, definitions, plugins, etc for this user\n            // Bootstrap.init(this.AB).catch((err) => {\n            //    Bootstrap.alert({\n            //       type: \"alert-error\",\n            //       title: \"Error initializing Portal:\",\n            //       text: err.toString(),\n            //    });\n            //    Bootstrap.error(err);\n            // });\n         } else {\n            if (response.status == \"error\") {\n               console.log(\"what to do with this error:\");\n               console.error(response);\n            }\n         }\n      });\n      const { privacyPolicy } = this.AB.Config.siteConfig();\n      if (privacyPolicy) {\n         const L = this.AB.Label();\n         $$(\"auth_privacy_policy\").setValues({\n            label: L(\"Privacy Policy\"),\n            pretext: L(\"By signing in you agree to our\"),\n            link: privacyPolicy,\n         });\n         $$(\"auth_privacy_policy\").show();\n      }\n\n      return Promise.resolve();\n   }\n\n   show() {\n      $$(\"portal_auth_login_container\").show();\n   }\n}\n\nexport default new PortalAuthLoginForm();\n","import ClassUI from \"./ClassUI.js\";\n\nvar L = null;\n\nclass PortalAuthLoginResetPassword extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui() {\n      var self = this;\n\n      if (!this.AB) {\n         // we need to init() before being able to translate our UI:\n         return {\n            id: \"portal_auth_login_reset_password\",\n         };\n      }\n\n      return {\n         id: \"portal_auth_login_reset_password\",\n         css: \"portalLogin\",\n         cols: [\n            {},\n            {\n               rows: [\n                  {},\n                  {\n                     width: 360,\n                     rows: [\n                        {\n                           id: \"portal_auth_login_reset_password_col\",\n                           css: \"portalLoginForm\",\n                           padding: 30,\n                           rows: [\n                              {\n                                 template:\n                                    \"<div style='text-align: center; font-size:160px; line-height: 160px;'><i style='background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-user-circle-o'></i></div>\",\n                                 borderless: true,\n                                 height: 190,\n                                 type: \"clean\",\n                              },\n                              {\n                                 id: \"portal_auth_login_reset_password_form\",\n                                 view: \"form\",\n                                 type: \"clean\",\n                                 css: { background: \"transparent !important\" },\n                                 borderless: true,\n                                 elementsConfig: {\n                                    height: 52,\n                                 },\n                                 elements: [\n                                    {\n                                       id: \"new-password-email\",\n                                       template: ` ${this.AB.Account.email()} `,\n                                       css: {\n                                          background: \"transparent !important\",\n                                          border: \"none\",\n                                          \"font-size\": \"16px\",\n                                          color: \"black\",\n                                          \"text-align\": \"center\",\n                                       },\n                                    },\n                                    {\n                                       id: \"password-new\",\n                                       view: \"text\",\n                                       type: \"password\",\n                                       placeholder: L(\"Enter a new Password\"),\n                                       name: L(\"Enter a new Password\"),\n                                       validate: (v) => {\n                                          return v.length >= 8;\n                                       },\n                                       invalidMessage: L(\n                                          \"Needs to be at least 8 characters\"\n                                       ),\n                                       validateEvent: \"blur\",\n                                       bottomPadding: 20,\n                                    },\n                                    {\n                                       id: \"password-confirm\",\n                                       view: \"text\",\n                                       type: \"password\",\n                                       placeholder: L(\"Re-enter Password\"),\n                                       name: \"email\",\n                                       validate: (v) => {\n                                          return (\n                                             v === $$(\"password-new\").getValue()\n                                          );\n                                       },\n                                       invalidMessage: L(\n                                          \"Passwords do not match\"\n                                       ),\n                                       validateEvent: \"blur\",\n                                       bottomPadding: 20,\n                                    },\n                                    {\n                                       margin: 10,\n                                       paddingX: 2,\n                                       borderless: true,\n                                       cols: [\n                                          {},\n                                          {\n                                             view: \"button\",\n                                             label: L(\"Save\"),\n                                             type: \"form\",\n                                             css: \"webix_primary\",\n                                             width: 150,\n                                             hotkey: \"enter\",\n                                             click: () => {\n                                                if (\n                                                   $$(\n                                                      \"portal_auth_login_reset_password_form\"\n                                                   ).validate()\n                                                ) {\n                                                   let password =\n                                                      $$(\n                                                         \"password-new\"\n                                                      ).getValue();\n                                                   this.AB.Network.post(\n                                                      {\n                                                         url: \"/auth/password/reset\",\n                                                         data: {\n                                                            password,\n                                                         },\n                                                      },\n                                                      {\n                                                         key: \"portal_auth_password_reset\",\n                                                         context: {},\n                                                      }\n                                                   ).catch((err) => {\n                                                      console.log(err);\n                                                   });\n                                                }\n                                             },\n                                          },\n                                          {},\n                                       ],\n                                    },\n                                 ],\n                              },\n                           ],\n                        },\n                     ],\n                  },\n                  {},\n               ],\n            },\n            {},\n         ],\n      };\n   }\n\n   async init(AB) {\n      this.AB = AB;\n\n      L = (...params) => {\n         return this.AB.Multilingual.label(...params);\n      };\n\n      // now replace our initial placeholder with our viewable form\n      webix.ui(this.ui(), $$(\"portal_auth_login_reset_password\"));\n\n      this.AB.Network.on(\n         \"portal_auth_password_reset\",\n         (context, err, response) => {\n            // Listen for our responses:\n            // Show a popup for confirmation that an email was sent.\n            // context.email : {string} entered email address.\n\n            this.AB.emit(\"portal.show\", \"work\"); // switch to the Work Portal.\n         }\n      );\n   }\n\n   show() {\n      $$(\"portal_auth_login_reset_password\").show();\n   }\n}\n\nexport default new PortalAuthLoginResetPassword();\n","import ClassUI from \"./ClassUI.js\";\n\nvar L = null;\n\nclass PortalAuthLoginResetRequest extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui() {\n      var self = this;\n\n      if (!this.AB) {\n         // we need to init() before being able to translate our UI:\n         return {\n            id: \"portal_auth_login_reset_request\",\n         };\n      }\n\n      return {\n         id: \"portal_auth_login_reset_request\",\n         css: \"portalLogin\",\n         cols: [\n            {},\n            {\n               rows: [\n                  {},\n                  {\n                     width: 360,\n                     rows: [\n                        {\n                           id: \"password_reset_email\",\n                           css: \"portalLoginForm\",\n                           padding: 30,\n                           rows: [\n                              {\n                                 template:\n                                    \"<div style='text-align: center; font-size:160px; line-height: 160px;'><i style='background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-envelope-o'></i></div>\",\n                                 borderless: true,\n                                 height: 190,\n                                 type: \"clean\",\n                              },\n                              {\n                                 id: \"portal_reset_password_form\",\n                                 view: \"form\",\n                                 type: \"clean\",\n                                 css: { background: \"transparent !important\" },\n                                 borderless: true,\n                                 elementsConfig: {\n                                    bottomPadding: 20,\n                                 },\n                                 elements: [\n                                    {\n                                       template: `<p>${L(\n                                          \"Enter your email. We'll send a link to reset your password.\"\n                                       )}</p>`,\n                                       autoheight: true,\n                                       css: {\n                                          background: \"transparent\",\n                                          border: \"none\",\n                                          \"font-size\": \"16px\",\n                                          color: \"black\",\n                                          \"text-align\": \"center\",\n                                       },\n                                    },\n                                    {\n                                       borderless: true,\n                                       cols: [\n                                          {\n                                             id: \"reset_tenantList\",\n                                             view: \"select\",\n                                             // label: \"Tenant\",\n                                             name: \"tenant\",\n                                             attributes: {\n                                                \"data-cy\": \"reset_tenantList\",\n                                             },\n                                             value: 1,\n                                             options: [\n                                                { id: 1, value: \"Master\" },\n                                                { id: 2, value: \"Release\" },\n                                             ],\n                                          },\n                                          {\n                                             id: \"reset-email\",\n                                             view: \"text\",\n                                             placeholder: L(\"Email\"),\n                                             name: \"email\",\n                                             validate: webix.rules.isEmail,\n                                             invalidMessage: L(\n                                                \"Please enter a valid email.\"\n                                             ),\n                                             validateEvent: \"blur\",\n                                          },\n                                          {\n                                             rows: [\n                                                {\n                                                   view: \"button\",\n                                                   icon: \"fa fa-paper-plane\",\n                                                   type: \"icon\",\n                                                   css: \"webix_primary\",\n                                                   autowidth: true,\n                                                   hotkey: \"enter\",\n                                                   click() {\n                                                      var email =\n                                                         $$(\"reset-email\");\n                                                      if (email.validate()) {\n                                                         email =\n                                                            email.getValue();\n                                                         var tenant =\n                                                            $$(\n                                                               \"reset_tenantList\"\n                                                            ).getValue();\n                                                         self.AB.Network.post(\n                                                            {\n                                                               url: \"/auth/login/reset\",\n                                                               data: {\n                                                                  email,\n                                                                  tenant,\n                                                                  url:\n                                                                     window\n                                                                        .location\n                                                                        .origin ||\n                                                                     window\n                                                                        .location\n                                                                        .href,\n                                                               },\n                                                            },\n                                                            {\n                                                               key: \"portal_auth_login_reset\",\n                                                               context: {\n                                                                  email,\n                                                               },\n                                                            }\n                                                         ).catch((err) => {\n                                                            console.log(err);\n                                                         });\n                                                      }\n                                                   },\n                                                },\n                                                {},\n                                             ],\n                                          },\n                                       ],\n                                    },\n                                    {\n                                       view: \"button\",\n                                       label: L(\"Back to log in\"),\n                                       css: \"webix_transparent\",\n                                       click() {\n                                          self.emit(\"login\");\n                                       },\n                                    },\n                                 ],\n                              },\n                           ],\n                        },\n                     ],\n                  },\n                  {},\n               ],\n            },\n            {},\n         ],\n      };\n   }\n\n   async init(AB) {\n      this.AB = AB;\n\n      L = (...params) => {\n         return this.AB.Multilingual.label(...params);\n      };\n\n      // now replace our initial placeholder with our viewable form\n      webix.ui(this.ui(), $$(\"portal_auth_login_reset_request\"));\n\n      var $tenant = $$(\"reset_tenantList\");\n      var siteConfig = this.AB.Config.siteConfig();\n      if (siteConfig?.tenants?.length) {\n         // replace options in tenant list with siteConfig.tenants:\n         var newOptions = [];\n         siteConfig.tenants.forEach((t) => {\n            var opt = {\n               id: t.uuid,\n               value: t.title || t.key,\n            };\n            newOptions.push(opt);\n         });\n\n         $tenant.define(\"options\", newOptions);\n      }\n\n      var tID = this.AB.Tenant.id();\n      if (tID) {\n         $tenant.define(\"value\", tID);\n\n         // if the tID matches one of our options, then we can hide\n         // the input.\n         // eg: they entered a route [tenant].our.url\n         // we simple auto select the tenant and don't show this component.\n         var opt = newOptions.find((o) => o.id == tID);\n         if (opt) {\n            $tenant.hide();\n         }\n      }\n\n      this.AB.Network.on(\n         \"portal_auth_login_reset\",\n         (context, err, response) => {\n            // Listen for our responses:\n            // Show a popup for confirmation that an email was sent.\n            // context.email : {string} entered email address.\n\n            var text = L(\n               \"<p>An email with instructions on how to reset your password has been sent to <b>{0}</b>.</p><p>Check your spam or junk folder if you don’t see the email in your inbox.</p>\",\n               [context.email]\n            );\n\n            webix.alert({\n               title: L(\"Email Sent\"),\n               ok: L(\"Okay\"),\n               width: 500,\n               text: text,\n            });\n         }\n      );\n   }\n\n   show() {\n      $$(\"portal_auth_login_reset_request\").show();\n   }\n}\n\nexport default new PortalAuthLoginResetRequest();\n","import ClassUI from \"./ClassUI.js\";\nimport PortalAuthLoginForm from \"./portal_auth_login_form.js\";\nimport PortalAuthLoginResetPassword from \"./portal_auth_login_resetPassword.js\";\nimport PortalAuthLoginResetRequest from \"./portal_auth_login_resetRequest.js\";\n\nclass PortalAuthLogin extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui() {\n      var self = this;\n\n      return {\n         id: \"portal_auth_login\",\n         view: \"multiview\",\n         animate: false,\n         rows: [\n            PortalAuthLoginForm.ui(),\n            PortalAuthLoginResetPassword.ui(),\n            PortalAuthLoginResetRequest.ui(),\n         ],\n      };\n   }\n\n   async init(AB) {\n      this.AB = AB;\n\n      var allInits = [];\n      allInits.push(PortalAuthLoginForm.init(AB));\n      PortalAuthLoginForm.on(\"request.reset\", () => {\n         PortalAuthLoginResetRequest.show();\n      });\n\n      allInits.push(PortalAuthLoginResetRequest.init(AB));\n      PortalAuthLoginResetRequest.on(\"login\", () => {\n         PortalAuthLoginForm.show();\n      });\n\n      allInits.push(PortalAuthLoginResetPassword.init(AB));\n      PortalAuthLoginResetPassword.on(\"updated\", () => {\n         console.log(\">>>> Password Changed ... NOW WHAT? <<<<<<\");\n      });\n\n      await Promise.all(allInits);\n   }\n\n   show(defaultView) {\n      // defaultView should be:\n      //   \"auth_login_form\",\n      //   \"auth_login_passwordReset\"\n\n      if (defaultView) {\n         var view = defaultView.split(\"_\").pop();\n         switch (view) {\n            case \"resetPassword\":\n               PortalAuthLoginResetPassword.show();\n               break;\n\n            default:\n            case \"form\":\n               PortalAuthLoginForm.show();\n               break;\n         }\n         return;\n      }\n\n      // Default to the LoginForm\n      PortalAuthLoginForm.show();\n   }\n}\n\nexport default new PortalAuthLogin();\n","import ClassUI from \"./ClassUI.js\";\n\n// sub pages:\nimport PortalAuthLogin from \"./portal_auth_login.js\";\n\nclass PortalAuth extends ClassUI {\n   constructor() {\n      super();\n\n      this.ActivePortal = null;\n      // {PortalAuthxxx} ActivePortal\n      // the UI Portal to use for Authenticating our User for this Tenant.\n   }\n\n   ui() {\n      var self = this;\n\n      return {\n         id: \"portal_auth\",\n         view: \"multiview\",\n         animate: false,\n         cells: [PortalAuthLogin.ui()],\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n\n      // decide which Auth Portal to display:\n      var authType = this.AB.Tenant.setting(\"authType\") || \"login\";\n      switch (authType) {\n         case \"login\":\n            this.ActivePortal = PortalAuthLogin;\n            break;\n\n         case \"passwordless\":\n            break;\n\n         case \"facebook\":\n            break;\n\n         case \"google\":\n            break;\n      }\n\n      return this.ActivePortal?.init(AB).then(() => {\n         this.ActivePortal?.show();\n      });\n   }\n\n   show(defaultView) {\n      // We cannot properly store the session id if users navigate directly to /home\n      // so when they navigate to /home and it was not a redirect we send them back to /\n      if (\n         window?.location?.pathname == \"/home\" &&\n         !window?.performance?.navigation?.redirectCount\n      )\n         window.location.replace(window.location.origin);\n\n      $$(\"portal_auth\").show();\n      this.ActivePortal.show(defaultView);\n   }\n}\n\nexport default new PortalAuth();\n","import ClassUI from \"./ClassUI\";\n\nclass ClassUIPage extends ClassUI {\n   constructor(containerID, page, App, AB) {\n      super();\n\n      this.containerID = containerID;\n      // {string}\n      // the webix $$(containerID) reference to attach this UI to.\n      // Typically the portal_work generates a series of container placeholders\n      // and these ClassUIPage will attach themselves to them.\n\n      this.page = page;\n      // {ABViewPage}\n      // The Root Page that this container is displaying.\n\n      this.App = App;\n      // {ABComponent.App}\n      // The common UI Component App factory.\n\n      this.AB = AB;\n      // {ABFactory}\n      // The common ABFactory being shared for all our ABxxx Objects.\n\n      this.initialized = false;\n      // {bool}\n      // indicates if the User had chosen to display this page yet.\n      // We prevent loading our data and building the page until the\n      // User decides to show the page.\n\n      this.pageStack = [];\n      // {array}\n      // Keep track of the {ABViewPage.id} that have been showPage()ed.\n      // The last element in the stack should be the Actively Shown page.\n      // If the stack is empty, then we are showing the RootPage.\n\n      this.pageComponents = {};\n      // {hash}  { ABViewPage.id : ABViewPage.component() }\n      // we keep track of all the ui.component() of our possible views to\n      // prevent having to regenerate them and quickly access their values.\n\n      this.changePageEventIds = {};\n      // {hash}  { ABViewPage.id : .on(\"changePage\") }\n      // A hash of the on(\"changePage\") listeners for each page. Used to\n      // prevent multiple listeners added to a Page\n   }\n\n   ui() {\n      // NOTE: the .container === .id\n      // so this REPLACES the container created by the portal_work\n      var placeholder = {};\n      if (this.page && this.page.isRoot()) {\n         // some pages can take a while to initialize.\n         // add a spinner to indicate it is busy\n         placeholder = {\n            type: \"clean\",\n            css: { \"text-align\": \"center\" },\n            template:\n               '<div style=\"height: 100vh; width: 100%; background: #ebedf0;\" class=\"webix_progress_icon\"><div class=\"webix_progress_state wxi-sync webix_spin\"></div></div>',\n         };\n      }\n      return {\n         view: \"multiview\",\n         // container: this.containerID,\n         css: \"ab-main-container ab-generated-page\",\n         borderless: true,\n         id: this.containerID,\n         animate: false,\n         cells: [placeholder],\n         on: {\n            // onViewChange: (prevId, nextId) => {\n            //    this.resize();\n            // },\n         },\n      };\n   }\n\n   init(AB, render = false, showPage = true) {\n      if (AB) {\n         this.AB = AB;\n      }\n\n      // don't redo all this if we already have!\n      if (this.initialized) return Promise.resolve();\n\n      var myUI = this.ui();\n      webix.ui(myUI, $$(this.containerID));\n\n      if (!render) {\n         return Promise.resolve();\n      }\n\n      // .init() returns a Promise\n      return new Promise((resolve /*, reject */) => {\n         // 1) make sure all Application DataCollections have started\n         //    initialization.\n         this.page.application.datacollectionsIncluded().forEach((dc) => {\n            if (!dc) return;\n\n            dc.init();\n         });\n\n         // 2) Render all our Pages\n         this.renderPage(this.page);\n\n         // 3) After we are rendered, we are technically initialized\n         this.initialized = true;\n\n         // 4) Make sure our Root Page is \"shown\"\n         this.showPage();\n\n         if (!showPage) {\n            let parView = $$(this.containerID).getParentView();\n            parView.showBatch(parView.getValue(), false);\n         }\n\n         resolve();\n      });\n   }\n\n   /**\n    * initEvents()\n    * Setup the listeners for each page.  There are 3 main events we are\n    * concerned with:\n    *    \"changePage\" =>\n    *          generated by our Page / Sub Page / Sub view\n    *          indicates when a new page should be displayed.\n    *    \"ab.interface.update\" =>\n    *          generated by the server.\n    *          indicates that the Definition of our interface\n    *          has changed and we need to redisplay.\n    *    \"ab.datacollection.update\" = >\n    *          generated by the server.\n    *          indicates one of the DataCollections have been updated.\n    *          if it is one we are depending on, we need to redisplay\n    *\n    * @param {ABViewPage} page\n    *       The ABViewPage to establish listeners on.\n    */\n   initEvents(page) {\n      if (page == null) return;\n\n      // { pageId: eventId, ..., pageIdn: eventIdn }\n      this.changePageEventIds = this.changePageEventIds || {};\n\n      // prevent duplicate event registrations\n      if (!this.changePageEventIds[page.id]) {\n         this.changePageEventIds[page.id] = page.on(\"changePage\", (pageID) => {\n            this.showPage(pageID);\n         });\n      }\n\n      let needToReloadPage = () => {\n         // clear the cache of events\n         this.changePageEventIds = {};\n\n         this.initialized = false;\n\n         // begin the process of reloading the page\n         this.init(this.AB, true, false);\n      };\n\n      if (!this.updatePageEventId && page.isRoot()) {\n         /**\n          * @event ab.interface.update\n          * This event is triggered when the root page is updated\n          *\n          * @param data.rootPage {uuid} - id of the root page\n          */\n         this.updatePageEventId = this.AB.on(\n            \"ab.interface.update\",\n            function (data) {\n               if (page.id == data.rootPageId) {\n                  needToReloadPage();\n               }\n            }\n         );\n      }\n\n      if (!this.updateDatacollectionEventId && page.isRoot()) {\n         /**\n          * @event ab.datacollection.update\n          * This event is triggered when the datacollection is updated\n          * Make sure we only update the Display if it was a DC that was\n          * included in this Page's Application.\n          *\n          * @param data.datacollectionId {uuid} - id of the data view\n          */\n         this.updateDatacollectionEventId = this.AB.on(\n            \"ab.datacollection.update\",\n            (data) => {\n               let updatedDC = this.page.application.datacollectionsIncluded(\n                  (dc) => dc.id == data.datacollectionId\n               )[0];\n               if (updatedDC) {\n                  needToReloadPage();\n               }\n            }\n         );\n      }\n   }\n\n   /**\n    * renderPage()\n    * create the Webix UI for the given ABViewPage and all it's Sub Pages.\n    * This routine creates the component.ui, and performs the component.init()\n    * but does not perform the final component.onShow() ( that happens in the\n    * showPage() method.)\n    * @param {ABViewPage} page\n    */\n   renderPage(page) {\n      if (window.webixLocale) {\n         setTimeout(() => {\n            webix.i18n.setLocale(window.webixLocale);\n         }, 500);\n      }\n      var component = page.component(this.App);\n      var ui = component.ui;\n\n      // Keep the page component\n      this.pageComponents[page.id] = component;\n\n      var myContainer = $$(this.containerID);\n      // {webix.ui}\n      // Referencing our container. Since we seem to make numerous references\n      // to this below, let's just pull it 1x.\n\n      // James:\n      // this is pulled in from our previous v1 code. Not sure if it is still\n      // relevant.\n      // TODO: review this and how this works in context of our Webix Only\n      // Portal.\n      // Also, notice how we are referencing the internal data of a Page object?\n      // there should be an accessor method (like page.setting(\"pageWidth\"))\n      // that returns the data we need.\n      /*\n      if (\n         parseInt(page.settings.pageWidth) > 0 &&\n         parseInt(page.settings.fixedPageWidth) == 1\n      ) {\n         var parentContainer = this.element.parent()[0];\n         parentContainer.style.width = parseInt(page.settings.pageWidth) + \"px\";\n         parentContainer.style.margin = \"0 auto\";\n         parentContainer.classList.add(page.settings.pageBackground);\n      }\n      */\n\n      var type = page.settings?.type ?? \"\";\n      if (typeof page.type === \"function\") {\n         // plugin method.\n         type = page.type();\n      }\n      switch (type) {\n         case \"popup\":\n            var popupTemplate = {\n               view: \"window\",\n               id: page.id,\n               modal: true,\n               position: \"center\",\n               resize: true,\n               width: parseInt(page.settings.popupWidth) || 700,\n               height: parseInt(page.settings.popupHeight) + 44 || 450,\n               css: \"ab-main-container\",\n               head: {\n                  view: \"toolbar\",\n                  css: \"webix_dark\",\n                  cols: [\n                     {\n                        view: \"label\",\n                        label: page.label,\n                        css: \"modal_title\",\n                        align: \"center\",\n                     },\n                     {\n                        view: \"button\",\n                        label: \"Close\",\n                        autowidth: true,\n                        align: \"center\",\n                        click: () => {\n                           this.showPage();\n                           // var popup = this.getTopParentView();\n                           // popup.hide();\n                        },\n                        on: {\n                           //Add data-cy attribute to the close button\n                           onAfterRender: () => {\n                              const button = $$(page.id).queryView(\"button\");\n                              const dataCy = `Popup Close Button ${page.name} ${page.id}`;\n                              button\n                                 .getInputNode()\n                                 .setAttribute(\"data-cy\", dataCy);\n                           },\n                        },\n                     },\n                  ],\n               },\n               body: {\n                  view: \"scrollview\",\n                  scroll: true,\n                  body: ui,\n               },\n            };\n\n            var oldView = $$(page.id);\n            if (oldView) {\n               // if it is a Popup, destroy() it\n               if (oldView.config.view == \"window\") {\n                  oldView.destructor();\n               }\n               // else remove the view from our multiview\n               else if (myContainer) {\n                  myContainer.removeView(page.id);\n               }\n            }\n\n            // Now create the New one (hidden)\n            try {\n               webix.ui(popupTemplate).hide();\n            } catch (e) {\n               console.error(\"Error creating Page:\", page);\n               console.error(e);\n               // debugger;\n            }\n            break;\n\n         case \"page\":\n         default:\n            // Define page id to be batch id of webix.multiview\n            ui.batch = page.id;\n\n            // if this view already exists\n            var oldPage = $$(page.id);\n            if (oldPage) {\n               // if the old view was a popup, but now we want it as\n               // a page, we need to move it to our multiview\n               if (oldPage.config.view == \"window\") {\n                  oldPage.destructor();\n\n                  myContainer.addView(ui);\n               }\n               // else we want to rebuild it.\n               else {\n                  webix.ui(ui, oldPage);\n               }\n            }\n            // else this is our first time so add it\n            else if (myContainer) {\n               myContainer.addView(ui);\n            }\n\n            break;\n      }\n\n      // handle events\n      this.initEvents(page);\n\n      // Render child pages\n      (page.pages() || []).forEach((subpage) => {\n         this.renderPage(subpage);\n      });\n\n      // Initial UI components\n      component.init();\n   }\n\n   /**\n    * show()\n    * is called by the main portal_work when a menu item is selected and this\n    * container should be displayed.\n    */\n   show() {\n      var container = $$(this.containerID);\n      if (container) {\n         if (!this.initialized) {\n            // this is our 1st time to show, so wait for our initial loading\n            // container to display, before causing it to be transformed into\n            // our Page.\n            var eventID = container.attachEvent(\"onViewShow\", () => {\n               // only 1x\n               container.detachEvent(eventID);\n               // give ourselves some additional space to make sure animations\n               // are complete or operational before the .init() which can be\n               // resource intensive.\n               setTimeout(() => {\n                  this.init(this.AB, true);\n                  container.show();\n               }, 50);\n            });\n         }\n\n         container.show();\n      }\n   }\n\n   /**\n    * showPage()\n    * A RootPage can have several SubPages that it wants to display during\n    * it's normal operation.  An embedded view component can trigger an\n    * .emit(\"showPage\", pageID) that will get propagated up to our RootPage\n    * and showPage(pageID) will be called.\n    *\n    * For example, an ABViewMenu object will have a button clicked and it will\n    * signal this to show the desired Page.\n    *\n    * If a showPage() is called with no parameter, then we are being requested\n    * to return to the previous page before the current one.\n    * @param {string} pageID\n    *       The {ABViewPage.id} of the page to show.\n    * @param {string} viewID\n    *       An additional ABViewxxx.id that can also be signaled to show.\n    *       ?? Usually on the Page we just showed, so you can specify a\n    *       page + view.\n    */\n   showPage(pageID, viewId) {\n      var showPageID = null;\n      // {string}\n      // This is the actual pageID of the ABViewPage to display.\n\n      // in any case, if the active page is not the requested page,\n      // we hide it:\n      var activeID = this.pageStack[this.pageStack.length - 1];\n      if (activeID) {\n         // if the actively displayed page is what is being asked for\n         // we can just exit.\n         if (activeID == pageID) {\n            return; //\n         }\n\n         // otherwise we need to hide() any popups / pages\n         var activeUI = $$(activeID);\n         if (activeUI && activeUI.hide) activeUI.hide();\n      }\n\n      // if no pageID provided, then we are displaying a previous page:\n      if (!pageID) {\n         // pull the last View displayed & remove it.\n         this.pageStack.pop();\n      } else {\n         // be sure not to add our Root Page to the stack\n         if (this.page.id != pageID) {\n            // add the new pageID to our stack:\n            // REMEMBER: last item is what should be show()n\n            this.pageStack.push(pageID);\n         } else {\n            // in this case: we have items in our .pageStack, but we are told\n            // to return to our RootPage;\n            // clear out our .pageStack and we will return to our root\n            this.pageStack = [];\n         }\n      }\n\n      // now get the ID of the page to show\n      showPageID = this.pageStack[this.pageStack.length - 1];\n      if (!showPageID) {\n         // then we want to display the Root Page:\n         showPageID = this.page.id;\n      }\n\n      if (!showPageID) {\n         // if we get here and don't have a showPageID ... something didn't\n         // go as planned:\n         this.AB.error(\n            new Error(`Unable to resolve showPage() with pageID[${pageID}]`)\n         );\n      } else {\n         // make sure a popup is shown\n         if ($$(showPageID)) $$(showPageID).show();\n\n         // if our MultiView has this batch then show batch\n         var batchExist = false;\n         var childViews = $$(this.containerID).getChildViews();\n         batchExist = childViews.filter(function (v) {\n            return v.config.batch == showPageID;\n         })[0];\n         if (batchExist) $$(this.containerID).showBatch(showPageID);\n\n         // now make sure the actual component's .onShow() is called\n         // But perform a Timeout() so any current webix animations\n         // complete beforehand:\n         setTimeout(() => {\n            if (\n               this.pageComponents[showPageID] &&\n               this.pageComponents[showPageID].onShow\n            ) {\n               // for (const element of document\n               //    .getElementById(self.containerDomID)\n               //    .getElementsByClassName(\"ab-loading\")) {\n               //    element.style.display = \"none\";\n               // }\n               this.pageComponents[showPageID].onShow();\n               if (viewId) {\n                  $$(viewId)?.show();\n               }\n            }\n         }, 60);\n      }\n   }\n\n   /*\n   removePage(pageId) {\n      var pageCom = this.pageComponents[pageId];\n      var pageElemId = pageCom.ui.id;\n\n      // swtich the page before it will be removed\n      if (this.activePageId == pageId) {\n         this.showPage(this.rootPage.id);\n      }\n\n      // remove from .multiview\n      $$(this.containerDomID).removeView(pageElemId);\n\n      // destroy view's modal\n      if ($$(pageElemId)) $$(pageElemId).destructor();\n   }\n   */\n}\n\nexport default ClassUIPage;\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalWorkInboxAccordion extends ClassUI {\n   constructor(app) {\n      super();\n\n      this.app = app;\n      this.id = `inbox-accordion-app-holder-${this.app.id}`;\n      this.idUnitList = `inbox-accordion-app-${this.app.id}`;\n   }\n\n   ui() {\n      const self = this;\n      // for .click() handler below:\n\n      return {\n         header: this.app.label,\n         id: this.id,\n         view: \"accordionitem\",\n         collapsed: true,\n         css: \"stayCollapsed\",\n         hidden: true,\n         body: {\n            view: \"unitlist\",\n            id: this.idUnitList,\n            uniteBy: \"#uniteLabel#\",\n            autoheight: true,\n            css: \"inbox_unitlist\",\n            type: {\n               templateHeader: function (value) {\n                  return (\n                     '<i style=\"opacity: 0.4\" class=\"fa fa-fw fa-code-fork fa-rotate-90\"></i> ' +\n                     value.replace(/{(.*?)}/, \"\")\n                  );\n               },\n               headerHeight: 35,\n            },\n            template: function (obj) {\n               return (\n                  obj.name +\n                  \" <span class='pull-right webix_badge'>\" +\n                  obj.items.length +\n                  \"</span>\"\n               );\n            },\n            select: true,\n            data: [],\n            click: function (id /* , ev */) {\n               const list = this;\n               // const parent = this.getParentView();\n               const selectedItem = this.getItem(id);\n\n               const cells = [];\n               // {array}\n               // the webix defs for the Form.io forms for this selection.\n\n               // const number = 1;\n               selectedItem.items.forEach(function (task) {\n                  if (task.data?.url) {\n                     cells.push({\n                        id: \"task-holder-\" + task.uuid,\n                        unitlist: list,\n                        view: \"layout\",\n                        padding: 20,\n                        rows: [\n                           {\n                              id: task.uuid,\n                              view: \"iframe\",\n                              src: task.data.url,\n                           },\n                        ],\n                     });\n                  } else\n                     cells.push({\n                        id: \"task-holder-\" + task.uuid,\n                        unitlist: list,\n                        view: \"layout\",\n                        padding: 20,\n                        rows: [\n                           {\n                              id: task.uuid,\n                              view: \"formiopreview\",\n                              formComponents: task.ui,\n                              formData: task.data,\n                              onButton: function (value) {\n                                 self.processItem(id, task, value);\n                              },\n                           },\n                        ],\n                     });\n               });\n\n               self.emit(\"showTasks\", /*list, */ selectedItem.name, cells);\n            },\n            on: {\n               onAfterRender() {\n                  ClassUI.CYPRESS_REF(this);\n                  this.data.each((a) => {\n                     ClassUI.CYPRESS_REF(\n                        this.getItemNode(a.id),\n                        `${self.id}_${a.id}`\n                     );\n                  });\n               },\n            },\n         },\n         // TODO: This never gets called!\n         // on: {\n         //    onAfterRender() {\n         //       ClassUI.CYPRESS_REF(this);\n         //    },\n         // },\n      };\n   }\n\n   init(AB) {\n      // prevent multiple .init() calls\n      if (!this.AB) {\n         this.AB = AB;\n\n         this.AB.Network.on(\"inbox.update\", (context, err /* , response */) => {\n            if (err && err.message) {\n               webix.message(err.message);\n               this.AB.notify.developer(err, {\n                  context:\n                     \"portal_work_inbox_accordion:Network[inbox.update]: error updating Inbox item\",\n                  info: context,\n               });\n               return;\n            }\n\n            const list = $$(this.idUnitList);\n            const selectedItem = list.getItem(context.unitID);\n\n            // clear out processed item from our accordion\n            // prune the item from the group of similar processes in the unit list\n            if (selectedItem) {\n               const parent = list.getParentView();\n\n               selectedItem.items = selectedItem.items.filter(function (i) {\n                  return i.uuid != context.uuid;\n               });\n\n               // refresh the unit list so we can get an update badge count\n               list.refresh();\n               if (selectedItem.items.length == 0) {\n                  // remove the item from the unit list\n                  list.remove(list.getSelectedId());\n                  // if that was the last item in the unit list remove the accordion\n                  if (list.count() == 0) {\n                     parent.hide();\n                  }\n               }\n            }\n\n            this.emit(\"item.processed\", context.uuid);\n         });\n      }\n\n      return Promise.resolve();\n   }\n\n   unitList() {\n      return $$(this.idUnitList);\n   }\n\n   /**\n    * @method processItem()\n    * submit the current task's response back to the server.\n    * @param {ABProcessForm} task\n    *        the current form that is being responded to.\n    * @param {string} value\n    *        the value of the Form button returned.\n    */\n   processItem(unitID, task, value) {\n      this.AB.Network.put(\n         {\n            url: `/process/inbox/${task.uuid}`,\n            data: { response: value },\n         },\n         {\n            key: \"inbox.update\",\n            context: { uuid: task.uuid, unitID },\n         }\n      );\n\n      return;\n   }\n\n   show() {\n      $$(this.id).show();\n      $$(this.id).expand();\n      this.initFormIOPreview();\n   }\n\n   /**\n    * Ensure the formio custom webix component is loaded and ready to\n    * use.\n    */\n   initFormIOPreview() {\n      this.AB.custom.formiopreview.init();\n   }\n}\n\nexport default PortalWorkInboxAccordion;\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalWorkInboxTaskwindow extends ClassUI {\n   constructor() {\n      super();\n      this.id = \"portal_work_inbox_taskwindow\";\n      this.idTaskMultiview = \"taskMultiview\";\n      this.idTaskTitle = \"taskTitle\";\n      this.idTaskPager = \"taskPager\";\n   }\n\n   ui() {\n      var L = (...params) => {\n         return this.label(...params);\n      };\n      return {\n         id: this.id,\n         view: \"window\",\n         position: function (state) {\n            state.left = state.maxWidth / 2 - 800 / 2; // fixed values\n            state.top = state.maxHeight / 2 - (state.maxHeight * 0.7) / 2;\n            state.width = 800; // relative values\n            state.height = state.maxHeight * 0.7;\n         },\n         modal: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               { width: 17 },\n               {\n                  id: this.idTaskTitle,\n                  view: \"label\",\n                  label: L(\"Your Tasks\"),\n               },\n               {\n                  view: \"button\",\n                  autowidth: true,\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     $$(this.id).hide();\n                     // we don't want the list to look like it has still selected the item\n                     $$(this.idTaskMultiview)\n                        .getChildViews()[0]\n                        .config.unitlist.unselectAll();\n                     // reset the pager so we don't get errors when we open it next\n                     $$(this.idTaskPager).select(0);\n                  },\n                  on: {\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this, \"inbox_taskwindow_close\");\n                     },\n                  },\n               },\n            ],\n         },\n         body: {\n            rows: [\n               {\n                  view: \"scrollview\",\n                  scroll: \"xy\",\n                  body: {\n                     id: this.idTaskMultiview,\n                     cells: [\n                        {\n                           view: \"layout\",\n                           padding: 20,\n                           rows: [\n                              {\n                                 id: \"emptyTasks\",\n                                 template: L(\"No more tasks...good job!\"),\n                              },\n                           ],\n                        },\n                     ],\n                  },\n               },\n               {\n                  view: \"toolbar\",\n                  css: \"inboxpager\",\n                  cols: [\n                     {\n                        id: this.idTaskPager,\n                        view: \"pager\",\n                        size: 1,\n                        group: 3,\n                        height: 45,\n                        master: false,\n                        template:\n                           '<div style=\"margin-top:9px; text-align: center;\">{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}</div>',\n                        on: {\n                           onAfterRender() {\n                              // debugger;\n                              ClassUI.CYPRESS_REF(this);\n                              // this.data.each((a) => {\n                              //    ClassUI.CYPRESS_REF(\n                              //       this.getItemNode(a.id),\n                              //       `${self.id}_${a.id}`\n                              //    );\n                              // });\n                           },\n                           onBeforePageChange: (new_page /*, old_page  */) => {\n                              var views = $$(\n                                 this.idTaskMultiview\n                              ).getChildViews();\n                              views[parseInt(new_page)].show();\n                           },\n                        },\n                     },\n                  ],\n               },\n            ],\n         },\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n      webix.ui(this.ui());\n\n      return Promise.resolve();\n   }\n\n   clearTask(uuid) {\n      // find out how many pages are in this multiview\n      var views = $$(this.idTaskMultiview).getChildViews();\n      // if there is more than one page we need to find out what the next page should be\n      if (views.length > 1) {\n         var taskHolder = $$(\"task-holder-\" + uuid);\n         if (taskHolder) {\n            // find out if we are on the last page\n            if (\n               $$(this.idTaskMultiview).index(taskHolder) + 1 ==\n               views.length\n            ) {\n               // if we are on the last page we will go back to the previous page\n               $$(this.idTaskMultiview).setValue(\n                  views[$$(this.idTaskMultiview).index(taskHolder) - 1].config\n                     .id\n               );\n            } else {\n               // if we are not on the last page we will go to the next page\n               $$(this.idTaskMultiview).setValue(\n                  views[$$(this.idTaskMultiview).index(taskHolder) + 1].config\n                     .id\n               );\n            }\n            // once we move off of the page we can remove it\n            $$(this.idTaskMultiview).removeView(\n               views[$$(this.idTaskMultiview).index(taskHolder)]\n            );\n         }\n\n         // // prune the item from the group of similar processes in the unit list\n         // if (this.selectedItem) {\n         //    this.selectedItem.items = this.selectedItem.items.filter(function (\n         //       i\n         //    ) {\n         //       return i.uuid != uuid;\n         //    });\n         // }\n         // // refresh the unit list so we can get an update badge count\n         // this.list.refresh();\n\n         // now we update the pager\n         // block events because we don't want it telling the multiview to change pages after we set the new value\n         $$(this.idTaskPager).blockEvent();\n         // set the page to the first while we rebuild the pager (or it will throw an error)\n         $$(this.idTaskPager).select(0);\n         // set the current number of pages to the number of views in the multiview\n         $$(this.idTaskPager).define(\n            \"count\",\n            $$(this.idTaskMultiview).getChildViews().length\n         );\n         $$(this.idTaskPager).refresh();\n         // set the page to the correct number because it probably changed when we removed a view above\n         $$(this.idTaskPager).select(\n            $$(this.idTaskMultiview).index(\n               $$(this.idTaskMultiview).getActiveId()\n            )\n         );\n         $$(this.idTaskPager).unblockEvent();\n      } else {\n         // no more tasks hide the modal\n         $$(this.id).hide();\n         // // remove the item from the unit list\n         // this.list.remove(this.list.getSelectedId());\n         // // if that was the last item in the unit list remove the accordion\n         // if (this.list.count() == 0) {\n         //    parent.hide();\n         // }\n      }\n   }\n\n   hide() {\n      $$(this.id).hide();\n   }\n\n   show() {\n      $$(this.id).show();\n   }\n\n   showTasks(/* unitList, */ selectedItemName, cells) {\n      // this.list = unitList;\n      // this.selectedItem = selectedItem;\n      webix.ui(\n         {\n            id: this.idTaskMultiview,\n            cells: cells,\n         },\n         $$(this.idTaskMultiview)\n      );\n\n      $$(this.idTaskTitle).define(\"label\", selectedItemName);\n      $$(this.idTaskPager).define(\"count\", cells.length);\n      $$(this.idTaskPager).refresh();\n      $$(this.id).show();\n   }\n}\n\nexport default new PortalWorkInboxTaskwindow();\n","import ClassUI from \"./ClassUI.js\";\nimport ClassAccordionEntry from \"./portal_work_inbox_accordion.js\";\nimport PortalWorkInboxTaskWindow from \"./portal_work_inbox_taskWindow.js\";\n\nclass PortalWorkInbox extends ClassUI {\n   constructor() {\n      super();\n\n      this.id = \"portal_work_inbox\";\n      // {string}\n      // the webix.id of this UI element\n\n      this.entries = [];\n      // {array}\n      // the list of User Forms this user is able to process.\n\n      this.processLookupHash = {\n         /* ABProcess.id : \"Process Label\" */\n      };\n\n      this.appLookupHash = {\n         /* ABProcess.id : \"ABApplication.id\" */\n      };\n\n      this.appAccordionLists = {};\n      // {hash}  { app.id : {accordionItemDefinition} }\n   }\n\n   ui() {\n      var L = (...params) => {\n         return this.label(...params);\n      };\n\n      return {\n         id: this.id,\n         view: \"window\",\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark inbox_drawer\",\n            cols: [\n               { width: 7 },\n               {\n                  view: \"label\",\n                  label: L(\"Inbox\"),\n               },\n               {\n                  view: \"button\",\n                  autowidth: true,\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     $$(this.id).hide();\n                  },\n                  on: {\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this);\n                     },\n                  },\n               },\n            ],\n         },\n         position: function (state) {\n            state.left = state.maxWidth - 350; // fixed values\n            state.top = 0;\n            state.width = 350; // relative values\n            state.height = state.maxHeight;\n         },\n         body: {\n            cells: [\n               {\n                  id: \"inboxItems\",\n                  view: \"scrollview\",\n                  scroll: \"y\",\n                  body: {\n                     view: \"accordion\",\n                     id: \"inbox_accordion\",\n                     css: {\n                        background: \"#dadee0 !important\",\n                     },\n                     multi: true,\n                     rows: [],\n                  },\n               },\n               {\n                  id: \"emptyInbox\",\n                  view: \"layout\",\n                  hidden: true,\n                  css: {\n                     background: \"#dadee0 !important\",\n                  },\n                  rows: [\n                     {},\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        height: 200,\n                        label: \"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-thumbs-up'></div>\",\n                     },\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        label: L(\"No tasks...you're all caught up.\"),\n                     },\n                     {},\n                  ],\n               },\n            ],\n         },\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n\n      //  Load the { items, meta } data structure before continuing with\n      // the rest of the init process.\n      this.AB.Network.get({ url: \"/config/inbox\" }).then((inboxConfig) => {\n         this.AB.Config.configInbox(inboxConfig);\n\n         this.initDelayed(AB);\n      });\n   }\n\n   initDelayed(AB) {\n      webix.ui(this.ui());\n\n      this.allAppAccordions = {};\n      // {hash}  { ABApplication.id : ClassAccordionEntry }\n      // A lookup of all our ClassAccordionEntry(s) by their app.id\n\n      //\n      // Prepare our Hashes:\n      //\n      this.lang = this.AB.Account.language();\n      (this.AB.Config.inboxMetaConfig() || []).forEach((app) => {\n         this.createAccordian(app);\n      });\n\n      this.entries = this.AB.Config.inboxConfig() || [];\n\n      this.entries.forEach((i) => this.addItem(i));\n\n      var allInits = [];\n\n      for (var index in this.appAccordionLists) {\n         const processes = this.getProcessList(index);\n\n         const accordion = this.allAppAccordions[index]\n            ? this.allAppAccordions[index].unitList()\n            : null;\n         if (accordion) {\n            const init = async () => {\n               await this.allAppAccordions[index].init(this.AB);\n               accordion.parse(processes);\n               accordion.show();\n            };\n            allInits.push(init());\n         } else {\n            this.AB.notify.developer(\n               new Error(\n                  `could not find an inbox-accordion for index[${index}]`\n               ),\n               {\n                  context: \"portal_work_inbox:init(): config error\",\n                  inboxMeta: this.AB.Config.inboxMetaConfig(),\n                  inbox: this.entries,\n               }\n            );\n         }\n      }\n\n      return Promise.all(allInits).then(() => {\n         this.emit(\"updated\");\n\n         this.AB.on(\"ab.inbox.create\", async (item) => {\n            const alreadyThere = this.entries.find((e) => e.uuid == item.uuid);\n            if (!alreadyThere) {\n               this.entries.push(item);\n               // If we can't find the app's accordion in the list then add it\n               const createNew = !this.appLookupHash[item.definition];\n               if (createNew) {\n                  const [app] = await this.AB.Network.post({\n                     url: \"/process/inbox/meta\",\n                     data: { ids: [item.definition] },\n                  });\n                  this.createAccordian(app);\n               }\n               const appId = this.appLookupHash[item.definition];\n               const accordion = this.allAppAccordions[appId];\n               this.addItem(item);\n\n               if (createNew) await accordion.init(this.AB);\n\n               const unitList = accordion.unitList();\n               unitList.parse(this.appAccordionLists[appId][item.definition]);\n               unitList.show();\n               unitList.refresh();\n\n               accordion.show();\n            }\n            this.emit(\"updated\");\n         });\n\n         this.AB.on(\"ab.inbox.update\", (item) => {\n            const appId = this.appLookupHash[item.definition];\n            const accordion = this.allAppAccordions[appId];\n\n            accordion.AB.Network.emit(\"inbox.update\", {\n               uuid: item.uuid,\n               unitID: item.definition,\n            });\n         });\n\n         // Now Register for RT Updates to our Inbox\n         this.AB.Network.post(\n            {\n               url: `/process/inbox/register`,\n            },\n            {\n               key: \"inbox.register\",\n               context: {},\n            }\n         );\n      });\n   }\n\n   createAccordian(app) {\n      if (!app) return;\n\n      // convert config info with current language labels\n      this.translate(app, this.lang);\n\n      const appAccordion = new ClassAccordionEntry(app);\n      $$(\"inbox_accordion\").addView(appAccordion.ui());\n      this.allAppAccordions[app.id] = appAccordion;\n      appAccordion.on(\"showTasks\", (...params) => {\n         // showTasks\n         // indicates when the user has selected a group of Accordian Tasks\n         // to process.\n         PortalWorkInboxTaskWindow.showTasks(...params);\n      });\n\n      appAccordion.on(\"item.processed\", (uuid) => {\n         // item.processed\n         // indicates when the specified form has been updated on the server.\n         PortalWorkInboxTaskWindow.clearTask(uuid);\n         this.entries = this.entries.filter((e) => e.uuid != uuid);\n         if (this.entries.length == 0) {\n            $$(\"emptyInbox\").show();\n         }\n         this.emit(\"updated\");\n      });\n\n      (app.processes || []).forEach((p) => {\n         this.translate(p, this.lang);\n         this.processLookupHash[p.id] = p.label;\n         this.appLookupHash[p.id] = app.id;\n      });\n\n      return appAccordion;\n   }\n\n   getProcessList(index) {\n      const processes = [];\n      for (const process in this.appAccordionLists[index]) {\n         processes.push(this.appAccordionLists[index][process]);\n      }\n      return processes;\n   }\n\n   addItem(item) {\n      // item {obj}  inbox configuration item\n      //    .definition {uuid} the process.id that generated this form\n      //    .name {string} the Name of this form\n      //\n      item.uniteLabel =\n         \"{\" + item.definition + \"}\" + this.processLookupHash[item.definition];\n      // create our own .uniteLabel\n      // this is used within the accordion.unitlist to group the data.\n\n      // find the application.id for this form\n      var appId = this.appLookupHash[item.definition];\n\n      // make sure we have an appAccordionLists[appID] entry\n      if (!this.appAccordionLists[appId]) this.appAccordionLists[appId] = {};\n      if (!this.appAccordionLists[appId][item.definition]) {\n         this.appAccordionLists[appId][item.definition] = {\n            id: item.definition,\n            name: item.name,\n            uniteLabel: item.uniteLabel,\n            items: [],\n         };\n      }\n\n      // add this as one of our items\n      this.appAccordionLists[appId][item.definition].items.push(item);\n   }\n\n   show() {\n      if (this.entries.length == 0) {\n         $$(\"emptyInbox\").show();\n      } else {\n         $$(\"inboxItems\").show();\n      }\n      $$(this.id).show();\n\n      for (const appId in this.allAppAccordions) {\n         this.allAppAccordions[appId]?.show();\n      }\n   }\n\n   /**\n    * @method translate()\n    * given an object with a .translations property, we will fill out\n    * the translations for the given language.\n    * @param {obj} obj\n    * @param {string} lang\n    *        the language_code of the translations to use.\n    */\n   translate(obj, lang) {\n      if (obj?.translations) {\n         var entry = obj.translations.find((t) => t.language_code == lang);\n         if (!entry) {\n            entry = obj.translations[0];\n         }\n         if (entry) {\n            Object.keys(entry).forEach((k) => {\n               if (k != \"language_code\") {\n                  obj[k] = entry[k];\n               }\n            });\n         }\n      }\n   }\n\n   count() {\n      return this.entries.length;\n   }\n}\n\nexport default new PortalWorkInbox();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalWorkUserProfileWindow extends ClassUI {\n   constructor() {\n      super(\"portal_work_user_profile_window\", {\n         imageUser: \"\",\n         uploaderImage: \"\",\n         formUserInfo: \"\",\n\n         dataEmail: \"\",\n         editModeEmail: \"\",\n         buttonEditModeEmail: \"\",\n         editModeButtonsEmail: \"\",\n\n         dataLanguage: \"\",\n         editModeLanguage: \"\",\n         buttonEditModeLanguage: \"\",\n         editModeButtonsLanguage: \"\",\n\n         formNewPassword: \"\",\n         fieldNewPassword: \"\",\n         systemNotification: \"\",\n         advanceOptions: \"\",\n      });\n   }\n\n   ui() {\n      const ids = this.ids;\n      const L = (...params) => {\n         return this.label(...params);\n      };\n\n      // [fix] preventing console 404 errors when user doesn't have an Account Image:\n      let acctImageID = this.AB.Account.imageID();\n      let imgTemplate = `<img src=\"file/${acctImageID}\" onerror=\"this.style.display='none'; document.getElementById('errorImage').style.display = 'block';\" width=\"150\" height=\"150\" style=\"border-radius: 50%; margin: 10px auto; display: block; border: 3px solid white;\" />`;\n      let imgErrorDiv = `<div id=\"errorImage\" style=\"display: none; width: 150px; height: 150px; background: #dee2e6; border-radius: 50%; margin: 10px auto; border: 3px solid white;\"><i class=\"fa fa-user\" style=\"font-size: 118px; color: white; margin: 15px 0 0 32px;\"></i></div>`;\n\n      if (acctImageID) {\n         imgTemplate = `${imgTemplate}${imgErrorDiv}`; // show both in case value is invalid\n      } else {\n         imgTemplate = imgErrorDiv.replace(\"none;\", \"block;\"); // show the Div\n      }\n\n      return {\n         id: ids.component,\n         view: \"window\",\n         position: \"center\",\n         modal: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               { width: 7 },\n               {\n                  view: \"label\",\n                  label: L(\"User Profile\"),\n               },\n               {\n                  view: \"button\",\n                  autowidth: true,\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  on: {\n                     onItemClick() {\n                        $$(ids.component).hide();\n                     },\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this, \"user-profile-close\");\n                     },\n                  },\n               },\n            ],\n         },\n         // body: {\n         // view: \"scrollview\",\n         // minHeight: 455,\n         body: {\n            view: \"layout\",\n            width: 460,\n            rows: [\n               {\n                  rows: [\n                     {\n                        id: ids.imageUser,\n                        view: \"template\",\n                        autoheight: true,\n                        borderless: true,\n                        css: {\n                           background: \"#222f3e\",\n                        },\n                        // width: 160,\n                        template: imgTemplate,\n                     },\n                     {\n                        css: {\n                           position: \"absolute\",\n                           top: \"185px\",\n                        },\n                        cols: [\n                           {},\n                           {\n                              id: ids.uploaderImage,\n                              view: \"uploader\",\n                              type: \"icon\",\n                              width: 34,\n                              height: 32,\n                              zIndex: 999,\n                              icon: \"fa fa-upload\",\n                              algin: \"center\",\n                              inputName: \"file\",\n                              apiOnly: true,\n                              multiple: false,\n                              accept:\n                                 \"image/png, image/gif, image/jpeg, image/bmp\",\n                              // Image field\n                              upload: `/file/upload/${\n                                 this.AB.objectUser().id\n                              }/6383ce19-b344-44ee-87e6-decced7361f8/1`,\n                              on: {\n                                 // when upload is complete:\n                                 onFileUpload: async (item, response) => {\n                                    const imageID = response.data.uuid;\n\n                                    const $uploaderImage = $$(\n                                       ids.uploaderImage\n                                    );\n                                    const $imageUser = $$(ids.imageUser);\n\n                                    $uploaderImage.disable();\n\n                                    // await this.AB.Network.put({\n                                    //    url: `/app_builder/model/${\n                                    //       this.AB.objectUser().id\n                                    //    }/${this.AB.Account.uuid()}`,\n                                    //    data: {\n                                    //       image_id: response.data.uuid,\n                                    //    },\n                                    // });\n                                    await this.AB.objectUser()\n                                       .model()\n                                       .update(this.AB.Account.uuid(), {\n                                          image_id: response.data.uuid,\n                                       });\n\n                                    this.AB.Account._config.image_id = imageID;\n\n                                    $imageUser.setHTML(\n                                       `<img src=\"file/${this.AB.Account.imageID()}\" onerror=\"this.style.display='none'; document.getElementById('errorImage').style.display = 'block';\" width=\"150\" height=\"150\" style=\"border-radius: 50%; margin: 10px auto; display: block; border: 3px solid white;\" /><div id=\"errorImage\" style=\"display: none; width: 150px; height: 150px; background: #dee2e6; border-radius: 50%; margin: 10px auto; border: 3px solid white;\"><i class=\"fa fa-user\" style=\"font-size: 118px; color: white; margin: 15px 0 0 32px;\"></i></div>`\n                                    );\n                                    $uploaderImage.enable();\n                                 },\n\n                                 // if an error was returned\n                                 onFileUploadError: (item, response) => {\n                                    const error = new Error(response);\n\n                                    const $uploaderImage = $$(\n                                       ids.uploaderImage\n                                    );\n\n                                    $uploaderImage.enable();\n\n                                    this.AB.notify.developer(error, {\n                                       context: \"Error uploading file\",\n                                    });\n                                    webix.alert(error);\n                                 },\n                              },\n                           },\n                           {},\n                        ],\n                     },\n                     {\n                        id: ids.formUserInfo,\n                        view: \"form\",\n                        width: 460,\n                        height: 160,\n                        borderless: true,\n                        css: {\n                           position: \"relative\",\n                           top: \"15px\",\n                        },\n                        elements: [\n                           {\n                              css: {\n                                 \"border-bottom\": \"1px solid #dee2e6\",\n                                 \"margin-top\": \"0 !important\",\n                              },\n                              cols: [\n                                 {\n                                    view: \"label\",\n                                    width: 160,\n                                    // align: \"right\",\n                                    label: L(\"Tenant\"),\n                                 },\n                                 {\n                                    view: \"label\",\n                                    name: \"tenant\",\n                                    value: \"\",\n                                    css: \"formText\",\n                                    on: {\n                                       onAfterRender: function () {\n                                          ClassUI.CYPRESS_REF(\n                                             this,\n                                             \"user_profile_tenant\"\n                                          );\n                                       },\n                                    },\n                                 },\n                              ],\n                           },\n                           {\n                              css: {\n                                 \"border-bottom\": \"1px solid #dee2e6\",\n                                 \"margin-top\": \"0 !important\",\n                              },\n                              cols: [\n                                 {\n                                    view: \"label\",\n                                    width: 160,\n                                    // align: \"right\",\n                                    label: L(\"Username\"),\n                                 },\n                                 {\n                                    view: \"label\",\n                                    name: \"username\",\n                                    value: \"\",\n                                    css: \"formText\",\n                                    on: {\n                                       onAfterRender: function () {\n                                          ClassUI.CYPRESS_REF(\n                                             this,\n                                             \"user_profile_username\"\n                                          );\n                                       },\n                                    },\n                                 },\n                              ],\n                           },\n                           {\n                              css: {\n                                 \"border-bottom\": \"1px solid #dee2e6\",\n                                 \"margin-top\": \"0 !important\",\n                              },\n                              cols: [\n                                 {\n                                    view: \"label\",\n                                    width: 160,\n                                    // align: \"right\",\n                                    label: L(\"Email\"),\n                                 },\n                                 {\n                                    id: ids.dataEmail,\n                                    view: \"label\",\n                                    name: \"email\",\n                                    value: \"\",\n                                    css: \"formText\",\n                                    on: {\n                                       onAfterRender: function () {\n                                          ClassUI.CYPRESS_REF(\n                                             this,\n                                             \"user_profile_email\"\n                                          );\n                                       },\n                                    },\n                                 },\n                                 {\n                                    id: ids.editModeEmail,\n                                    view: \"text\",\n                                    hidden: true,\n                                    value: \"\",\n                                 },\n                                 {\n                                    id: ids.buttonEditModeEmail,\n                                    view: \"button\",\n                                    type: \"icon\",\n                                    icon: \"wxi-pencil\",\n                                    width: 40,\n                                    inputWidth: 40,\n                                    on: {\n                                       onItemClick: () => {\n                                          const $dataEmail = $$(ids.dataEmail);\n                                          const $editModeEmail = $$(\n                                             ids.editModeEmail\n                                          );\n                                          const $buttonEditModeEmail = $$(\n                                             ids.buttonEditModeEmail\n                                          );\n                                          const $editModeButtonsEmail = $$(\n                                             ids.editModeButtonsEmail\n                                          );\n\n                                          $editModeEmail.setValue(\n                                             this.AB.Account.email()\n                                          );\n\n                                          $dataEmail.hide();\n                                          $buttonEditModeEmail.hide();\n\n                                          $editModeEmail.show();\n                                          $editModeButtonsEmail.show();\n                                       },\n                                    },\n                                 },\n                                 {\n                                    id: ids.editModeButtonsEmail,\n                                    hidden: true,\n                                    cols: [\n                                       {\n                                          view: \"button\",\n                                          type: \"icon\",\n                                          icon: \"wxi-close\",\n                                          width: 40,\n                                          inputWidth: 40,\n                                          css: \"webix_danger\",\n                                          on: {\n                                             onItemClick: () => {\n                                                const $dataEmail = $$(\n                                                   ids.dataEmail\n                                                );\n                                                const $editModeEmail = $$(\n                                                   ids.editModeEmail\n                                                );\n                                                const $buttonEditModeEmail = $$(\n                                                   ids.buttonEditModeEmail\n                                                );\n                                                const $editModeButtonsEmail =\n                                                   $$(ids.editModeButtonsEmail);\n\n                                                $editModeEmail.hide();\n                                                $editModeButtonsEmail.hide();\n\n                                                $dataEmail.show();\n                                                $buttonEditModeEmail.show();\n                                             },\n                                          },\n                                       },\n                                       {\n                                          view: \"button\",\n                                          type: \"icon\",\n                                          icon: \"wxi-check\",\n                                          width: 40,\n                                          inputWidth: 40,\n                                          css: \"webix_primary\",\n                                          on: {\n                                             onItemClick: async () => {\n                                                const $dataEmail = $$(\n                                                   ids.dataEmail\n                                                );\n                                                const $editModeEmail = $$(\n                                                   ids.editModeEmail\n                                                );\n                                                const $buttonEditModeEmail = $$(\n                                                   ids.buttonEditModeEmail\n                                                );\n                                                const $editModeButtonsEmail =\n                                                   $$(ids.editModeButtonsEmail);\n\n                                                $editModeEmail.hide();\n                                                $editModeButtonsEmail.hide();\n\n                                                $dataEmail.show();\n                                                $buttonEditModeEmail.show();\n\n                                                try {\n                                                   const email =\n                                                      $editModeEmail.getValue();\n\n                                                   $buttonEditModeEmail.disable();\n\n                                                   // await this.AB.Network.put({\n                                                   //    url: `/app_builder/model/${\n                                                   //       this.AB.objectUser().id\n                                                   //    }/${this.AB.Account.uuid()}`,\n                                                   //    data: {\n                                                   //       email,\n                                                   //    },\n                                                   // });\n                                                   await this.AB.objectUser()\n                                                      .model()\n                                                      .update(\n                                                         this.AB.Account.uuid(),\n                                                         { email }\n                                                      );\n\n                                                   this.AB.Account._config.email =\n                                                      email;\n                                                } catch (error) {\n                                                   this.AB.notify.developer(\n                                                      error,\n                                                      {\n                                                         context:\n                                                            \"error updating user profile email\",\n                                                      }\n                                                   );\n                                                } finally {\n                                                   $dataEmail.setValue(\n                                                      this.AB.Account.email()\n                                                   );\n                                                   $buttonEditModeEmail.enable();\n                                                }\n                                             },\n                                          },\n                                       },\n                                    ],\n                                 },\n                              ],\n                           },\n                           {\n                              css: {\n                                 \"margin-top\": \"0 !important\",\n                              },\n                              cols: [\n                                 {\n                                    view: \"label\",\n                                    width: 160,\n                                    // align: \"right\",\n                                    label: L(\"Language\"),\n                                 },\n                                 {\n                                    id: ids.dataLanguage,\n                                    view: \"label\",\n                                    name: \"language\",\n                                    value: \"\",\n                                    css: \"formText\",\n                                    on: {\n                                       onAfterRender: function () {\n                                          ClassUI.CYPRESS_REF(\n                                             this,\n                                             \"user_profile_language\"\n                                          );\n                                       },\n                                    },\n                                 },\n                                 {\n                                    id: ids.editModeLanguage,\n                                    view: \"combo\",\n                                    hidden: true,\n                                    value: null,\n                                    options: [],\n                                 },\n                                 {\n                                    id: ids.buttonEditModeLanguage,\n                                    view: \"button\",\n                                    type: \"icon\",\n                                    icon: \"wxi-pencil\",\n                                    width: 40,\n                                    inputWidth: 40,\n                                    on: {\n                                       onItemClick: async () => {\n                                          const $dataLanguage = $$(\n                                             ids.dataLanguage\n                                          );\n                                          const $editModeLanguage = $$(\n                                             ids.editModeLanguage\n                                          );\n                                          const $buttonEditModeLanguage = $$(\n                                             ids.buttonEditModeLanguage\n                                          );\n                                          const $editModeButtonsLanguage = $$(\n                                             ids.editModeButtonsLanguage\n                                          );\n\n                                          $buttonEditModeLanguage.disable();\n\n                                          $editModeLanguage.define(\n                                             \"options\",\n                                             await this.getLanguages()\n                                          );\n                                          $editModeLanguage.refresh();\n                                          $editModeLanguage.setValue(\n                                             this.AB.Account.language()\n                                          );\n\n                                          $dataLanguage.hide();\n                                          $buttonEditModeLanguage.hide();\n\n                                          $editModeLanguage.show();\n                                          $editModeButtonsLanguage.show();\n                                       },\n                                    },\n                                 },\n                                 {\n                                    id: ids.editModeButtonsLanguage,\n                                    hidden: true,\n                                    cols: [\n                                       {\n                                          view: \"button\",\n                                          type: \"icon\",\n                                          icon: \"wxi-close\",\n                                          width: 40,\n                                          inputWidth: 40,\n                                          css: \"webix_danger\",\n                                          on: {\n                                             onItemClick: async () => {\n                                                const $dataLanguage = $$(\n                                                   ids.dataLanguage\n                                                );\n                                                const $editModeLanguage = $$(\n                                                   ids.editModeLanguage\n                                                );\n                                                const $buttonEditModeLanguage =\n                                                   $$(\n                                                      ids.buttonEditModeLanguage\n                                                   );\n                                                const $editModeButtonsLanguage =\n                                                   $$(\n                                                      ids.editModeButtonsLanguage\n                                                   );\n\n                                                $editModeLanguage.hide();\n                                                $editModeButtonsLanguage.hide();\n\n                                                $dataLanguage.show();\n                                                $buttonEditModeLanguage.show();\n\n                                                try {\n                                                   $dataLanguage.setValue(\n                                                      await this.languageCodeToWord(\n                                                         this.AB.Account.language()\n                                                      )\n                                                   );\n                                                } catch (error) {\n                                                   $dataLanguage.setValue(null);\n                                                   this.AB.notify.developer(\n                                                      error,\n                                                      {\n                                                         context:\n                                                            \"portal_work_user_profile_window: Error updating language\",\n                                                      }\n                                                   );\n                                                } finally {\n                                                   $buttonEditModeLanguage.enable();\n                                                }\n                                             },\n                                          },\n                                       },\n                                       {\n                                          view: \"button\",\n                                          type: \"icon\",\n                                          icon: \"wxi-check\",\n                                          width: 40,\n                                          inputWidth: 40,\n                                          css: \"webix_primary\",\n                                          on: {\n                                             onItemClick: async () => {\n                                                const $dataLanguage = $$(\n                                                   ids.dataLanguage\n                                                );\n                                                const $editModeLanguage = $$(\n                                                   ids.editModeLanguage\n                                                );\n                                                const $buttonEditModeLanguage =\n                                                   $$(\n                                                      ids.buttonEditModeLanguage\n                                                   );\n                                                const $editModeButtonsLanguage =\n                                                   $$(\n                                                      ids.editModeButtonsLanguage\n                                                   );\n\n                                                $editModeLanguage.hide();\n                                                $editModeButtonsLanguage.hide();\n\n                                                $dataLanguage.show();\n                                                $buttonEditModeLanguage.show();\n\n                                                try {\n                                                   const languageCode =\n                                                      $editModeLanguage.getValue();\n\n                                                   // await this.AB.Network.put({\n                                                   //    url: `/app_builder/model/${\n                                                   //       this.AB.objectUser().id\n                                                   //    }/${this.AB.Account.uuid()}`,\n                                                   //    data: {\n                                                   //       languageCode,\n                                                   //    },\n                                                   // });\n                                                   await this.AB.objectUser()\n                                                      .model()\n                                                      .update(\n                                                         this.AB.Account.uuid(),\n                                                         { languageCode }\n                                                      );\n\n                                                   this.AB.Account._config.languageCode =\n                                                      languageCode;\n                                                } catch (error) {\n                                                   this.AB.notify.developer(\n                                                      error,\n                                                      {\n                                                         context:\n                                                            \"portal_work_user_profile_window: Error updating language Code\",\n                                                      }\n                                                   );\n                                                } finally {\n                                                   try {\n                                                      $dataLanguage.setValue(\n                                                         await this.languageCodeToWord(\n                                                            this.AB.Account.language()\n                                                         )\n                                                      );\n                                                   } catch (error) {\n                                                      $dataLanguage.setValue(\n                                                         null\n                                                      );\n\n                                                      this.AB.notify.developer(\n                                                         error,\n                                                         {\n                                                            context:\n                                                               \"portal_work_user_profile_window: Error updating languageCodeToWord()\",\n                                                         }\n                                                      );\n                                                   }\n\n                                                   $buttonEditModeLanguage.enable();\n                                                }\n                                             },\n                                          },\n                                       },\n                                    ],\n                                 },\n                              ],\n                           },\n                        ],\n                     },\n                  ],\n               },\n               {\n                  rows: [\n                     {\n                        view: \"button\",\n                        type: \"icon\",\n                        icon: \"wxi-angle-down\",\n                        height: 40,\n                        css: \"webix_primary\",\n                        label: L(\"Advanced Options\"),\n                        on: {\n                           onItemClick: (id) => {\n                              const $button = $$(id);\n                              const $advanceOptions = $$(ids.advanceOptions);\n\n                              if ($advanceOptions.isVisible()) {\n                                 $button.define(\"icon\", \"wxi-angle-down\");\n                                 $button.refresh();\n                                 $advanceOptions.hide();\n                              } else {\n                                 $button.define(\"icon\", \"wxi-angle-up\");\n                                 $button.refresh();\n                                 $advanceOptions.show();\n                              }\n                           },\n                        },\n                     },\n                     {\n                        id: ids.advanceOptions,\n                        hidden: true,\n                        rows: [\n                           {\n                              view: \"form\",\n                              width: 460,\n                              borderless: true,\n                              elements: [\n                                 {\n                                    cols: [\n                                       {\n                                          rows: [\n                                             {\n                                                height: 3,\n                                             },\n                                             {\n                                                view: \"label\",\n                                                width: 160,\n                                                // align: \"right\",\n                                                label: L(\"New Password\"),\n                                             },\n                                             {},\n                                          ],\n                                       },\n                                       {\n                                          id: ids.formNewPassword,\n                                          view: \"form\",\n                                          borderless: true,\n                                          width: 260,\n                                          padding: 0,\n                                          elements: [\n                                             {\n                                                id: ids.fieldNewPassword,\n                                                view: \"text\",\n                                                name: \"newPassword\",\n                                                type: \"password\",\n                                                placeholder: L(\n                                                   \"Enter a new Password (at least 8)\"\n                                                ),\n                                                value: \"\",\n                                                validate: (value) => {\n                                                   return value.length >= 8;\n                                                },\n                                             },\n                                             {\n                                                view: \"text\",\n                                                name: \"confirmPassword\",\n                                                type: \"password\",\n                                                placeholder:\n                                                   L(\"Confirm Password\"),\n                                                value: \"\",\n                                                validate: (value) => {\n                                                   const $fieldNewPassword = $$(\n                                                      ids.fieldNewPassword\n                                                   );\n\n                                                   return (\n                                                      value ===\n                                                      $fieldNewPassword.getValue()\n                                                   );\n                                                },\n                                             },\n                                             {\n                                                view: \"button\",\n                                                type: \"form\",\n                                                value: \"Save\",\n                                                align: \"right\",\n                                                height: 32,\n                                                width: 75,\n                                                inputWidth: 75,\n                                                css: \"webix_primary\",\n                                                on: {\n                                                   onItemClick: async (id) => {\n                                                      const $formNewPassword =\n                                                         $$(\n                                                            ids.formNewPassword\n                                                         );\n                                                      const $thisButton =\n                                                         $$(id);\n\n                                                      if (\n                                                         $formNewPassword.validate()\n                                                      ) {\n                                                         try {\n                                                            const $fieldNewPassword =\n                                                               $$(\n                                                                  ids.fieldNewPassword\n                                                               );\n                                                            const password =\n                                                               $fieldNewPassword.getValue();\n\n                                                            $thisButton.disable();\n                                                            $formNewPassword.disable();\n\n                                                            await this.AB.Network.post(\n                                                               {\n                                                                  url: \"/auth/password/reset\",\n                                                                  data: {\n                                                                     password,\n                                                                  },\n                                                               },\n                                                               {\n                                                                  key: \"portal_auth_password_reset\",\n                                                                  context: {},\n                                                               }\n                                                            );\n                                                         } catch (error) {\n                                                            this.AB.notify.developer(\n                                                               error,\n                                                               {\n                                                                  context:\n                                                                     \"portal_work_user_profile_window:Error resetting password\",\n                                                               }\n                                                            );\n                                                         } finally {\n                                                            $formNewPassword.clear();\n                                                            $formNewPassword.enable();\n                                                            $thisButton.enable();\n                                                         }\n                                                         webix.alert(\n                                                            \"The new password is successfully updated!\"\n                                                         );\n                                                      }\n                                                   },\n                                                },\n                                             },\n                                          ],\n                                       },\n                                    ],\n                                 },\n                                 {\n                                    css: {\n                                       \"border-top\": \"1px solid #dee2e6\",\n                                    },\n                                    cols: [\n                                       {\n                                          view: \"label\",\n                                          width: 160,\n                                          // align: \"right\",\n                                          label: L(\"System Notification\"),\n                                       },\n                                       {\n                                          id: ids.systemNotification,\n                                          view: \"checkbox\",\n                                          borderless: true,\n                                          width: 27,\n                                          css: {\n                                             \"text-align\": \"center !important\",\n                                             padding: \"0 10px\",\n                                          },\n                                          value: 0,\n                                          on: {\n                                             onItemClick: async () => {\n                                                const $systemNotification = $$(\n                                                   ids.systemNotification\n                                                );\n\n                                                try {\n                                                   const sendEmailNotifications =\n                                                      $systemNotification.getValue();\n                                                   // await this.AB.Network.put({\n                                                   //    url: `/app_builder/model/${\n                                                   //       this.AB.objectUser().id\n                                                   //    }/${this.AB.Account.uuid()}`,\n                                                   //    data: {\n                                                   //       sendEmailNotifications,\n                                                   //    },\n                                                   // });\n\n                                                   await this.AB.objectUser()\n                                                      .model()\n                                                      .update(\n                                                         this.AB.Account.uuid(),\n                                                         {\n                                                            sendEmailNotifications,\n                                                         }\n                                                      );\n\n                                                   this.AB.Account._config.sendEmailNotifications =\n                                                      sendEmailNotifications;\n                                                } catch (error) {\n                                                   this.AB.notify.developer(\n                                                      error,\n                                                      {\n                                                         context:\n                                                            \"portal_work_user_profile_window:Error updating email notifications\",\n                                                      }\n                                                   );\n                                                } finally {\n                                                   $systemNotification.setValue(\n                                                      this.AB.Account.sendEmailNotifications()\n                                                   );\n                                                }\n                                             },\n                                          },\n                                       },\n                                    ],\n                                 },\n                              ],\n                           },\n                        ],\n                     },\n                  ],\n               },\n            ],\n         },\n         // },\n      };\n   }\n\n   async init(AB) {\n      this.AB = AB;\n\n      webix.ui(this.ui());\n   }\n\n   async languageCodeToWord(code) {\n      if (typeof code !== \"string\")\n         throw new Error('The argrument \"code\" should be a string');\n\n      const languages = await this.getLanguages();\n      for (let i = 0; i < languages.length; i++)\n         if (languages[i].id === code) return languages[i].value;\n\n      return null;\n   }\n\n   async getLanguages() {\n      const data = [];\n\n      try {\n         const Language = this.AB.objectLanguage();\n         const response = await Language.model().findAll();\n         for (let i = 0; i < response.data.length; i++)\n            data.push({\n               id: response.data[i].language_code,\n               value: response.data[i].language_label,\n            });\n      } catch (error) {\n         this.AB.notify.developer(error, {\n            context: \"Error getting Languages\",\n         });\n      }\n\n      return data;\n   }\n\n   async populate() {\n      const ids = this.ids;\n\n      const $formUserInfo = $$(ids.formUserInfo);\n      const $systemNotification = $$(ids.systemNotification);\n\n      const populateLanguage = async () => {\n         const $dataLanguage = $$(ids.dataLanguage);\n         const $buttonEditModeLanguage = $$(ids.buttonEditModeLanguage);\n\n         $buttonEditModeLanguage.disable();\n\n         try {\n            $dataLanguage.setValue(\n               await this.languageCodeToWord(this.AB.Account.language())\n            );\n         } catch (error) {\n            $dataLanguage.setValue(null);\n\n            this.AB.notify.developer(error, {\n               context: \"Error setting Languages\",\n            });\n         }\n\n         $buttonEditModeLanguage.enable();\n      };\n\n      populateLanguage();\n      $formUserInfo.setValues({\n         tenant: this.AB.Tenant.id(),\n         username: this.AB.Account.username(),\n         email: this.AB.Account.email(),\n      });\n      $systemNotification.setValue(this.AB.Account.sendEmailNotifications());\n   }\n\n   hide() {\n      const ids = this.ids;\n\n      const $component = $$(ids.component);\n\n      $component.hide();\n   }\n\n   show() {\n      const ids = this.ids;\n\n      const $component = $$(ids.component);\n\n      $component.show();\n\n      this.populate();\n   }\n}\n\nexport default new PortalWorkUserProfileWindow();\n","import ClassUI from \"./ClassUI.js\";\n\nvar myClass = null;\n// Singleton.\n// This UI gets imported several times so let's not recreate the class each time.\n\nif (!myClass) {\n   myClass = class PortalWorkUserSwitcheroo extends ClassUI {\n      constructor() {\n         super(\"portal_work_user_switcheroo\", {\n            userIcon: \"\",\n            userName: \"\",\n            switchBack: \"\",\n            switchBackReplacer: \"\",\n            list: \"\",\n         });\n      }\n\n      ui() {\n         var L = (...params) => {\n            return this.label(...params);\n         };\n         const ids = this.ids;\n         return {\n            id: ids.component,\n            view: \"window\",\n            position: \"center\",\n            hidden: true,\n            close: true,\n            modal: true,\n            css: \"switcheroo\",\n            head: L(\"Switcheroo\"),\n            body: {\n               padding: 10,\n               rows: [\n                  {\n                     height: 30,\n                     cols: [\n                        {\n                           id: ids.userIcon,\n                           view: \"label\",\n                           align: \"center\",\n                           width: 44,\n                        },\n                        {\n                           id: ids.userName,\n                           view: \"label\",\n                           align: \"center\",\n                        },\n                        {\n                           id: ids.switchBack,\n                           view: \"button\",\n                           value: '<div style=\"text-align: center; font-size: 12px;\"><i class=\"fa-fw fa fa-times\"></i></div>',\n                           align: \"center\",\n                           css: \"webix_transparent\",\n                           width: 44,\n                           on: {\n                              onItemClick: () => {\n                                 this.switchUser();\n                                 this.hide();\n                              },\n                           },\n                        },\n                        {\n                           id: ids.switchBackReplacer,\n                           width: 44,\n                        },\n                     ],\n                  },\n                  {\n                     view: \"label\",\n                     label: L(\"View site as:\"),\n                     align: \"left\",\n                  },\n                  {\n                     id: ids.list,\n                  },\n                  {\n                     cols: [\n                        {\n                           view: \"button\",\n                           value: L(\"Switch\"),\n                           css: \"webix_primary\",\n                           on: {\n                              onAfterRender: function () {\n                                 ClassUI.CYPRESS_REF(\n                                    this,\n                                    \"switcheroo_switch_button\"\n                                 );\n                              },\n                              onItemClick: () => {\n                                 const userID = $$(ids.list).getValue();\n\n                                 if (!userID) {\n                                    webix.message(L(\"Please select a user.\"));\n\n                                    return;\n                                 }\n\n                                 this.switchUser(userID);\n                                 this.hide();\n                              },\n                           },\n                        },\n                     ],\n                  },\n               ],\n            },\n         };\n      }\n\n      init(AB, headless = false) {\n         this.AB = AB;\n         if (!headless) {\n            webix.ui(this.ui());\n            this.populate();\n         }\n\n         return Promise.resolve();\n      }\n\n      hide() {\n         $$(this.ids.component).hide();\n      }\n\n      show() {\n         $$(this.ids.component).show();\n      }\n\n      // const clearPopupUserMenu = () => {\n      //   $$(\"switcheroo_list\").setValue(\"\");\n      //   $$(\"switcheroo\").hide();\n      //   $$(\"userMenu_list\").unselectAll();\n      //   $$(\"userMenu_list\").show();\n      // };\n\n      async switcherooClear() {\n         return this.switchUser(null);\n      }\n\n      async switchUser(userID) {\n         const user = (this.AB.Account.userList() || []).find(\n            (e) => e.uuid === userID\n         );\n\n         // Save to a switched user.\n         if (!user || !userID) {\n            // if no user, then remove our current Switcheroo assignment\n            /* let response = */ await this.AB.Network.delete({\n               url: `/auth/switcheroo`,\n               // data: {},\n            });\n         } else {\n            /* let response = */ await this.AB.Network.post({\n               url: `/auth/switcheroo/${user.uuid}`,\n               // data: {},\n            });\n         }\n\n         window.location.reload(true);\n      }\n\n      populate() {\n         const ids = this.ids;\n\n         const mainUserID = this.AB.Account.uuid();\n         const userList = (this.AB.Account.userList() || [])\n            .filter((e) => e.uuid !== mainUserID)\n            .map((u) => {\n               return { id: u.uuid, value: u.username };\n            });\n\n         let switchedUserID = null;\n         if (this.AB.Account.isSwitcherood()) {\n            switchedUserID = mainUserID;\n         }\n         webix.ui(\n            {\n               id: ids.list,\n               view: \"combo\",\n               options: {\n                  body: {\n                     template: (obj) => {\n                        if (obj.id === switchedUserID)\n                           return `<i class='fa-fw fa fa-user-secret'></i> ${obj.value}`;\n                        return `<span data-cy=\"switcheroo_option_${obj.value}\">${obj.value}</span>`;\n                     },\n                  },\n                  data: userList,\n               },\n               on: {\n                  onAfterRender: function () {\n                     ClassUI.CYPRESS_REF(this, \"switcheroo_user_list\");\n                  },\n                  onItemClick: (id) => {\n                     $$(id).setValue(\"\");\n                  },\n               },\n            },\n            $$(ids.list)\n         );\n         $$(ids.userName).setValue(this.AB.Account.username());\n\n         if (this.AB.Account.isSwitcherood()) {\n            $$(ids.userIcon).setValue(\n               \"<i class='fa-fw fa fa-user-secret'></i>\"\n            );\n            $$(ids.switchBackReplacer)?.hide();\n            $$(ids.switchBack)?.show();\n            return;\n         }\n\n         $$(ids.userIcon).setValue(\"<i class='fa-fw fa fa-user'></i>\");\n         $$(ids.switchBack).hide();\n         $$(ids.switchBackReplacer).show();\n      }\n   };\n}\nexport default new myClass();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalWorkUserQRWindow extends ClassUI {\n   constructor() {\n      super();\n      this.id = \"portal_work_user_qr_window\";\n      this.idTaskMultiview = \"taskMultiview\";\n      this.idTaskTitle = \"taskTitle\";\n      this.idTaskPager = \"taskPager\";\n      this.classQrImageDom = \"qr-code-image-dom\";\n   }\n\n   ui() {\n      var L = (...params) => {\n         return this.label(...params);\n      };\n      return {\n         id: this.id,\n         view: \"window\",\n         position: function (state) {\n            state.left = state.maxWidth / 2 - 600 / 2; // fixed values\n            state.top = state.maxHeight / 2 - (state.maxHeight * 0.7) / 2;\n            state.width = 500; // relative values\n            state.height = 400;\n         },\n         modal: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               { width: 17 },\n               {\n                  id: this.idTaskTitle,\n                  view: \"label\",\n                  label: L(\"Connect Mobile App\"),\n               },\n               {\n                  view: \"button\",\n                  type: \"icon\",\n                  css: \"webix_transparent\",\n                  width: 40,\n                  icon: \"fa fa-repeat\",\n                  click: () => {\n                     $$(\"qr-code-image\").refresh();\n                  },\n                  on: {\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this, \"qr_image_reload\");\n                     },\n                  },\n               },\n               {\n                  view: \"button\",\n                  type: \"icon\",\n                  css: \"webix_transparent\",\n                  width: 40,\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     $$(this.id).hide();\n                  },\n                  on: {\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this, \"qr_window_close\");\n                     },\n                  },\n               },\n            ],\n         },\n         body: {\n            css: { \"text-align\": \"center\" },\n            rows: [\n               { height: 10 },\n               {\n                  borderless: true,\n                  template: `<span style=\"font-size:14px;font-weight:500;\">${L(\n                     \"Use your phone's camera app to scan this QR code, and it will open a webpage to the conneXted mobile app. You only need to scan the code for the first time.\"\n                  )}</span>`,\n               },\n               {\n                  id: \"qr-code-image\",\n                  borderless: true,\n                  autoheight: true,\n                  autowidth: true,\n                  template: `<img src='/relay/user-qr' class='${this.classQrImageDom}' style='margin: 10px auto 20px;display:block;' />`,\n                  on: {\n                     onAfterRender: () => {\n                        const $img = $$(\n                           \"qr-code-image\"\n                        ).$view.getElementsByClassName(this.classQrImageDom)[0];\n                        $img.onload = () => {\n                           $$(\"qr-code-image\").adjust();\n                        };\n                     },\n                  },\n               },\n\n               {\n                  borderless: true,\n                  template: `<div style=\"font-size:14px;font-weight:500;font-weight:500;\">${L(\n                     \"This code can only be used once. It will expire after 7 days.\"\n                  )}</div>`,\n               },\n            ],\n         },\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n      webix.ui(this.ui());\n\n      return Promise.resolve();\n   }\n\n   hide() {\n      $$(this.id).hide();\n   }\n\n   show() {\n      $$(this.id).show();\n   }\n}\n\nexport default new PortalWorkUserQRWindow();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalWorkUserMobileQR extends ClassUI {\n   constructor() {\n      super(\"portal_work_user_qr_window\", {\n         // taskMultiview:\"\",\n         description: \"\",\n         instructions: \"\",\n         title: \"\",\n         qrcode: \"\",\n         taskPager: \"\",\n      });\n   }\n\n   ui() {\n      var L = (...params) => {\n         return this.label(...params);\n      };\n      const ids = this.ids;\n      return {\n         id: ids.component,\n         view: \"window\",\n         position: function (state) {\n            state.left = state.maxWidth / 2 - 600 / 2; // fixed values\n            state.top = state.maxHeight / 2 - (state.maxHeight * 0.7) / 2;\n            state.width = 500; // relative values\n            state.height = 400;\n         },\n         modal: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               { width: 17 },\n               {\n                  id: ids.title,\n                  view: \"label\",\n                  label: L(\"Connect Mobile App\"),\n               },\n               {\n                  view: \"button\",\n                  type: \"icon\",\n                  css: \"webix_transparent\",\n                  width: 40,\n                  icon: \"fa fa-repeat\",\n                  click: () => {\n                     $$(\"qr-code-image\").refresh();\n                  },\n                  on: {\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this, \"qr_image_reload\");\n                     },\n                  },\n               },\n               {\n                  view: \"button\",\n                  type: \"icon\",\n                  css: \"webix_transparent\",\n                  width: 40,\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     $$(ids.component).hide();\n                  },\n                  on: {\n                     onAfterRender() {\n                        ClassUI.CYPRESS_REF(this, \"qr_window_close\");\n                     },\n                  },\n               },\n            ],\n         },\n         body: {\n            css: { \"text-align\": \"center\" },\n            rows: [\n               { height: 10 },\n               {\n                  id: ids.description,\n                  borderless: true,\n                  template: `<span style=\"font-size:14px;font-weight:500;\">The App's Description should go here.</span>`,\n               },\n               {\n                  id: ids.instructions,\n                  borderless: true,\n                  template: `<span style=\"font-size:14px;font-weight:500;\">${L(\n                     \"Use your phone's camera app to scan this QR code, and it will open a webpage to the {0} mobile app. You only need to scan the code for the first time.\"\n                  )}</span>`,\n               },\n               {\n                  id: ids.qrcode,\n                  height: 175,\n                  borderless: true,\n                  // autoheight: true,\n                  autowidth: true,\n                  template:\n                     \"<img src='/relay/user-qr' style='margin: 10px auto 20px;display:block;' />\",\n               },\n\n               {},\n               // {\n               //    borderless: true,\n               //    template: `<div style=\"font-size:14px;font-weight:500;font-weight:500;\">${L(\n               //       \"This code can only be used once. It will expire after 7 days.\"\n               //    )}</div>`,\n               // },\n            ],\n         },\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n      webix.ui(this.ui());\n\n      return Promise.resolve();\n   }\n\n   load(App) {\n      var L = (...params) => {\n         return this.label(...params);\n      };\n\n      // change Title\n      let $title = $$(this.ids.title);\n      $title.define(\"label\", App.label);\n      $title.refresh();\n\n      // Change Description\n      let $desc = $$(this.ids.description);\n      $desc.define(\n         \"template\",\n         `<span style=\"font-size:14px;font-weight:500;\">${App.description}</span>`\n      );\n      $desc.refresh();\n\n      let $instr = $$(this.ids.instructions);\n      $instr.define(\n         \"template\",\n         `<span style=\"font-size:14px;font-weight:500;\">${L(\n            \"Use your phone's camera app to scan this QR code, and it will open a webpage to the {0} mobile app. You only need to scan the code for the first time.\",\n            [App.label]\n         )}</span>`\n      );\n\n      // Change QR Image\n      let $qrcode = $$(this.ids.qrcode);\n      $qrcode.define(\n         \"template\",\n         `<img src='/mobile/qr/${App.id}' style='margin: 10px auto 20px;display:block;' />`\n      );\n      $qrcode.refresh();\n\n      $$(this.ids.component)?.refresh?.();\n   }\n\n   hide() {\n      $$(this.ids.component).hide();\n   }\n\n   show() {\n      $$(this.ids.component).show();\n   }\n}\n\nexport default new PortalWorkUserMobileQR();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalAccessLevelManager extends ClassUI {\n   constructor() {\n      super();\n      this.accessLevels = [\n         {\n            id: \"0\",\n            value: \"No Access\",\n         },\n         {\n            id: \"1\",\n            value: \"Read Only\",\n         },\n         {\n            id: \"2\",\n            value: \"Full Access\",\n         },\n      ];\n   }\n\n   ui() {\n      const accessLevelManagerBody = {\n         view: \"scrollview\",\n         css: \"lightgray ab_amp\",\n         body: {\n            rows: [\n               {\n                  view: \"accordion\",\n                  id: \"amp_accordion\",\n                  roles: [],\n                  hidden: true,\n                  collapsed: true,\n                  css: \"webix_dark\",\n                  rows: [],\n               },\n               {\n                  id: \"amp_accordion_noSelection\",\n                  rows: [\n                     {},\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        height: 200,\n                        label: \"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-unlock-alt'></div>\",\n                     },\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        label: \"Add a role to control access.\",\n                     },\n                     {\n                        cols: [\n                           {},\n                           {\n                              view: \"button\",\n                              label: \"Add Role\",\n                              type: \"form\",\n                              css: \"webix_primary\",\n                              autowidth: true,\n                              click: () => {\n                                 webix.ui(newRolePopup).show();\n\n                                 const roles = this.roles.filter((role) => {\n                                    return (\n                                       $$(\"amp_accordion\").config.roles.indexOf(\n                                          role.id\n                                       ) == -1\n                                    );\n                                 });\n\n                                 $$(\"role_popup_options\").define(\n                                    \"options\",\n                                    roles\n                                 );\n                                 $$(\"role_popup_options\").refresh();\n                              },\n                           },\n                           {},\n                        ],\n                     },\n                     {},\n                  ],\n               },\n            ],\n         },\n      };\n\n      const newRolePopup = {\n         view: \"popup\",\n         id: \"role_popup\",\n         position: \"center\",\n         height: 250,\n         width: 350,\n         modal: true,\n         body: {\n            rows: [\n               {\n                  view: \"toolbar\",\n                  id: \"myToolbarABLiveTool\",\n                  css: \"webix_dark\",\n                  cols: [\n                     {\n                        view: \"label\",\n                        label: \"Add Role\",\n                        align: \"center\",\n                     },\n                  ],\n               },\n               {\n                  view: \"form\",\n                  elements: [\n                     /* We are not managing users yet so take this out\n                                    {\n                                      view: \"text\",\n                                      label: \"Create new\",\n                                      labelWidth: 90\n                                    },\n                                    {\n                                      view: \"label\",\n                                      label: \"- or -\",\n                                      align: \"center\"\n                                    },*/\n                     {\n                        view: \"combo\",\n                        label: \"\",\n                        id: \"role_popup_options\",\n                        placeholder: \"Choose role\",\n                        options: [],\n                     },\n                     {\n                        cols: [\n                           {\n                              view: \"button\",\n                              value: \"Cancel\",\n                              click: () => {\n                                 $$(\"role_popup\").hide();\n                              },\n                           },\n                           {\n                              view: \"button\",\n                              value: \"Add\",\n                              id: \"role_popup_options_add\",\n                              css: \"webix_primary\",\n                              click: () => {\n                                 const role =\n                                    $$(\"role_popup_options\").getValue();\n                                 if ($$(`amp_accordionitem_${role}`)) {\n                                    $$(`amp_accordionitem_${role}`).show();\n                                    $$(\"amp_accordion\").config.roles.push(role);\n                                 } else {\n                                    this.buildAccessAccordion(role);\n                                 }\n                                 $$(\"role_popup\").hide();\n                              },\n                           },\n                        ],\n                     },\n                  ],\n               },\n            ],\n         },\n      };\n\n      return {\n         view: \"window\",\n         css: \"ampWindow\",\n         id: \"access_manager\",\n         position: function (state) {\n            state.left = state.maxWidth - 350; // fixed values\n            state.top = 0;\n            state.width = 350; // relative values\n            state.height = state.maxHeight;\n         },\n         on: {\n            onShow: () => {\n               // collapse all the accordion items but the top one\n               var index = 0;\n               $$(\"amp_accordion\")\n                  .getChildViews()\n                  .forEach((a) => {\n                     if (index == 0) {\n                        $$(a).expand();\n                     } else {\n                        $$(a).collapse();\n                     }\n                     index++;\n                     $$(\"amp_accordion\").show();\n                     $$(\"amp_accordion_noSelection\").hide();\n                  });\n            },\n         },\n         //modal: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               {\n                  width: 15,\n               },\n               {\n                  view: \"label\",\n                  label: \"Access Manager\",\n                  autowidth: true,\n               },\n               {},\n               {\n                  view: \"button\",\n                  label: \"Add Role\",\n                  width: 100,\n                  css: \"webix_primary\",\n                  click: () => {\n                     webix.ui(newRolePopup).show();\n\n                     var roles = this.roles.filter((role) => {\n                        return (\n                           $$(\"amp_accordion\").config.roles.indexOf(role.id) ==\n                           -1\n                        );\n                     });\n\n                     $$(\"role_popup_options\").define(\"options\", roles);\n                     $$(\"role_popup_options\").refresh();\n                  },\n               },\n               {\n                  view: \"button\",\n                  width: 35,\n                  css: \"webix_transparent\",\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     this.hide();\n                  },\n               },\n            ],\n         },\n         body: accessLevelManagerBody,\n      };\n   }\n\n   init(portal) {\n      this.AB = portal.AB;\n      this.portal = portal;\n      this.appId = portal.AppState.lastSelectedApp;\n\n      const languageCode = this.AB.Config.userConfig().languageCode;\n      this.roles = this.AB.Config.metaConfig().roles.map((role) => {\n         const translation = role.translations.filter(\n            (t) => t.code == languageCode\n         );\n         const name = translation.length == 1 ? translation[0].name : role.name;\n         return { id: role.id, value: name };\n      });\n\n      webix.ui(this.ui());\n\n      // buld the tree views for already defined role access levels\n      const application = this.AB.applicationByID(this.appId);\n      if (application.isAccessManaged) {\n         // Build the access level tree for Roles\n         const existingRoles = [];\n         application.pages().forEach((page) => {\n            Object.keys(page.accessLevels).forEach((role) => {\n               if (existingRoles.indexOf(role) == -1) {\n                  existingRoles.push(role);\n               }\n            });\n         });\n         existingRoles.forEach((role) => {\n            this.buildAccessAccordion(role);\n         });\n      }\n   }\n\n   show() {\n      $$(\"access_manager\").show();\n   }\n\n   hide() {\n      $$(\"access_manager\").hide();\n   }\n\n   showPage(viewId, pageId, parent) {\n      parent.application = {};\n      parent.application.id = this.appId;\n      this.portal.showPage(parent);\n      const pageUI = this.portal.pageContainers[parent.id];\n      pageUI.showPage(pageId, viewId);\n   }\n\n   /*\n    * helper to get the current apps views\n    */\n   views(f) {\n      return this.AB.applicationByID(this.appId).views(f);\n   }\n\n   buildAccessAccordion(role) {\n      const L = this.AB.Label();\n      const application = this.AB.applicationByID(this.appId);\n      const isRoleAccessManager =\n         parseInt(application.accessManagers.useRole) == 1 &&\n         application.accessManagers.role.indexOf(role) > -1;\n      const manageUsers = {\n         rows: [\n            {\n               height: 10,\n            },\n            {\n               cols: [\n                  {\n                     width: 10,\n                  },\n                  {\n                     view: \"button\",\n                     type: \"icon\",\n                     icon: \"fa fa-trash\",\n                     css: \"webix_danger_inverse\",\n                     label: \"Remove\",\n                     click: async () => {\n                        const confirmation = await webix.confirm(\n                           \"Remove role from app?\"\n                        );\n                        if (confirmation) {\n                           const tree = $$(`linetree_${role}`);\n                           const mainPages = this.AB.applicationByID(\n                              this.appId\n                           ).pages();\n                           await mainPages.forEach(async (page) => {\n                              const branch = tree.getItem(page.id);\n                              branch.access = \"0\";\n                              await page.updateAccessLevels(\n                                 tree.config.role,\n                                 \"0\"\n                              );\n                              tree.updateItem(page.id, branch);\n                           });\n\n                           $$(`amp_accordionitem_${role}`).hide();\n                           const itemToRemove =\n                              $$(\"amp_accordion\").config.roles.indexOf(role);\n                           if (itemToRemove > -1) {\n                              $$(\"amp_accordion\").config.roles.splice(\n                                 itemToRemove,\n                                 1\n                              );\n                           }\n                        }\n                     },\n                  },\n                  {\n                     width: 10,\n                  },\n               ],\n            },\n            {\n               height: 10,\n            },\n         ],\n      };\n\n      $$(\"amp_accordion\").config.roles.push(role);\n\n      const toggleParent = (element) => {\n         if (!element.parent) return false;\n         var parentElem = element.parent;\n         if (!parentElem.parent) return false;\n         parentElem.parent.emit(\"changeTab\", parentElem.id);\n         toggleParent(parentElem.parent);\n      };\n\n      const getParent = (id, component) => {\n         let item = $$(component).getItem(id);\n         if (item.$parent == 0) return item;\n         else return getParent(item.$parent, component);\n      };\n\n      const tree = {\n         id: `linetree_${role}`,\n         view: \"edittree\",\n         type: \"lineTree\",\n         editable: true,\n         role: role,\n         editor: \"combo\",\n         editValue: \"access\",\n         threeState: true,\n         template: (obj, common) => {\n            const treeOptions = $$(`linetree_${role}`).config.options;\n            const option = treeOptions.find((o) => o.id === obj.access);\n            let color, icon;\n            switch (option.id) {\n               case \"1\":\n                  color = \"#FFAB00\";\n                  icon = \"eye\";\n                  break;\n               case \"2\":\n                  color = \"#00C853\";\n                  icon = \"pencil\";\n                  break;\n               default:\n                  // Case \"0\"\n                  color = \"#ff4938\";\n                  icon = \"lock\";\n            }\n\n            return `<span class=\"accessLevel\">\n                     <span class=\"fa-stack\">\n                        <i style=\"color: ${color};\" class=\"fa fa-circle fa-stack-2x\"></i>\n                        <i class=\"fa fa-${icon} fa-stack-1x fa-inverse\"></i>\n                     </span>\n                     ${common.icon(obj, common)}\n                     <span>${obj.label}</span>\n                     <i class=\"externalLink fa fa-external-link\"></i>\n                  </span>`;\n         },\n         options: this.accessLevels,\n         data: this.getAccessLevelTree(role),\n         onClick: {\n            externalLink: (event, branch, target) => {\n               const item = $$(`linetree_${role}`).getItem(branch);\n               const parent = getParent(branch, `linetree_${role}`);\n               if (item.type == \"tab\") {\n                  this.showPage(branch, item.pageId, parent);\n\n                  const tabView = this.views((v) => v.id == item.id)[0];\n                  if (!tabView) return false;\n\n                  const tab = tabView.parent;\n                  if (!tab) return false;\n\n                  toggleParent(tab);\n                  if (!$$(tabView.id) || !$$(tabView.id).isVisible()) {\n                     const showIt = setInterval(() => {\n                        if ($$(tabView.id) && $$(tabView.id).isVisible()) {\n                           clearInterval(showIt);\n                        }\n                        tab.emit(\"changeTab\", tabView.id);\n                     }, 200);\n                  }\n               }\n               // switch page\n               else {\n                  this.showPage(branch, item.id, parent);\n               }\n\n               return false;\n            },\n         },\n         on: {\n            onAfterEditStop: async (state, editor, ignoreUpdate) => {\n               if (state.old == state.value) return false;\n               const tree = $$(`linetree_${role}`);\n               const view = this.views((v) => {\n                  return v.id == editor.id;\n               })[0];\n               await view.updateAccessLevels(tree.config.role, state.value);\n               console.log(\n                  `Role: ${tree.config.role} set to Access Level: ${state.value} on view: ${view.id}`\n               );\n            },\n            onDataUpdate: async (id, data, old) => {\n               const tree = $$(`linetree_${role}`);\n               if (data.access == \"0\") {\n                  // NOTE: Need to update \"No Access\" option here because It does not trigger `onAfterEditStop` event\n                  const view = this.views((v) => v.id == id)[0];\n                  await view.updateAccessLevels(tree.config.role, data.access);\n\n                  tree.blockEvent();\n                  await tree.data.eachSubItem(id, async (child) => {\n                     const childData = tree.getItem(child.id);\n                     if (childData.access != data.access) {\n                        childData.access = data.access;\n                        const view = this.views((v) => {\n                           return v.id == child.id;\n                        })[0];\n                        await view.updateAccessLevels(\n                           tree.config.role,\n                           data.access\n                        );\n                        console.log(\n                           `Role: ${tree.config.role} set to Access Level: ${data.access} on view: ${view.id}`\n                        );\n                        tree.updateItem(child.id, childData);\n                     }\n                  });\n                  tree.unblockEvent();\n               } else {\n                  const parentBranch = tree.getParentId(id);\n                  const parentData = tree.getItem(parentBranch);\n                  if (parentData) {\n                     if (parentData.access == \"0\") {\n                        parentData.access = \"1\";\n                        const view = this.views((v) => {\n                           return v.id == parentBranch;\n                        })[0];\n                        await view.updateAccessLevels(\n                           tree.config.role,\n                           parentData.access\n                        );\n\n                        console.log(\n                           `Role: ${tree.config.role} set to Access Level: ${parentData.access} on view: ${view.id}`\n                        );\n                        tree.updateItem(parentBranch, parentData);\n                     }\n                  }\n               }\n            },\n         },\n      };\n\n      const newAccordionItem = {\n         view: \"accordionitem\",\n         id: `amp_accordionitem_${role}`,\n         header: () => {\n            return `${\n               this.roles?.find((r) => {\n                  return r.id === role;\n               })?.value ?? role\n            } ${\n               isRoleAccessManager\n                  ? `<span class=\"header\" webix_tooltip=\"${L(\n                       \"This role has been assigned as a Page Access Manager for this App. This means they have full access. Please remove the permissions from the App's Setting page if you would like to manage their access here.\"\n                    )}\">${this.WARNING_ICON}</span>`\n                  : \"\"\n            }`;\n         },\n         collapsed: true,\n         body: {\n            type: \"clean\",\n            rows: [tree, manageUsers],\n         },\n      };\n\n      $$(\"amp_accordion\").addView(newAccordionItem, -1);\n      $$(\"amp_accordion\").show();\n      $$(\"amp_accordion_noSelection\").hide();\n\n      if (isRoleAccessManager)\n         this.AB.Webix.TooltipControl.addTooltip(\n            $$(`amp_accordionitem_${role}`).$view\n         );\n\n      $$(`linetree_${role}`).openAll();\n   }\n\n   getAccessLevelTree(role) {\n      const tree = new webix.TreeCollection();\n\n      const addPage = (page, index, parentId, type) => {\n         // add to tree collection\n         const accessLevel = page.accessLevels[role] ?? \"0\";\n         const branch = {\n            id: page.id,\n            access: accessLevel,\n            label: page.label,\n            pageId: parentId,\n            type: type,\n         };\n         tree.add(branch, index, parentId);\n\n         // stop at detail views\n         if (page.defaults.key == \"detail\") {\n            return;\n         }\n\n         const subPages = page.pages ? page.pages() : [];\n         subPages.forEach((childPage, childIndex) => {\n            addPage(childPage, childIndex, page.id, \"page\");\n         });\n\n         // add tabs\n         page\n            .views((view) => view.defaults.key == \"tab\")\n            .forEach((tab, tabIndex) => {\n               // tab views\n               tab.views().forEach((tabView, tabViewIndex) => {\n                  // tab items will be below sub-page items\n                  const tIndex = subPages.length + tabIndex + tabViewIndex;\n                  addPage(tabView, tIndex, page.id, \"tab\");\n               });\n            });\n      };\n      this.AB.applicationByID(this.appId)\n         .pages()\n         .forEach((p, index) => {\n            addPage(p, index, null, \"page\");\n         });\n\n      return tree;\n   }\n}\n\nexport default new PortalAccessLevelManager();\n","import ClassUI from \"./ClassUI.js\";\n\nclass PortalTranslationTool extends ClassUI {\n   constructor() {\n      super();\n      this.containerDomID = \"domID\";\n   }\n\n   ui() {\n      const translationToolBody = {\n         view: \"scrollview\",\n         css: \"lightgray ab_amp\",\n         body: {\n            rows: [\n               {\n                  view: \"accordion\",\n                  id: `qtt_accordion_${this.containerDomID}`,\n                  roles: [],\n                  hidden: true,\n                  collapsed: true,\n                  css: \"webix_dark\",\n                  rows: [],\n               },\n               {\n                  id: `qtt_accordion_noSelection_${this.containerDomID}`,\n                  rows: [{}],\n               },\n            ],\n         },\n      };\n\n      return {\n         view: \"window\",\n         css: \"qttWindow\",\n         id: `quickTranslationTool_${this.containerDomID}`,\n         position: function (state) {\n            state.left = state.maxWidth - 400; // fixed values\n            state.top = 0;\n            state.width = 400; // relative values\n            state.height = state.maxHeight;\n         },\n         on: {\n            onShow: () => {\n               // collapse all the accordion items but the top one\n               var index = 0;\n               $$(`qtt_accordion_${this.containerDomID}`)\n                  .getChildViews()\n                  .forEach((a) => {\n                     if (index == 0) {\n                        $$(a).expand();\n                     } else {\n                        $$(a).collapse();\n                     }\n                     index++;\n                     $$(`qtt_accordion_${this.containerDomID}`).show();\n                     $$(\n                        `qtt_accordion_noSelection_${this.containerDomID}`\n                     ).hide();\n                  });\n            },\n         },\n         head: {\n            rows: [\n               {\n                  view: \"toolbar\",\n                  css: \"webix_dark\",\n                  cols: [\n                     {\n                        width: 15,\n                     },\n                     {\n                        view: \"label\",\n                        label: \"Translation Tool\",\n                        autowidth: true,\n                     },\n                     {},\n                     {\n                        view: \"button\",\n                        width: 38,\n                        css: \"webix_transparent\",\n                        icon: \"fa fa-cog\",\n                        type: \"iconTop\",\n                        click: function () {\n                           if ($$(\"translationSettings\").config.hidden) {\n                              $$(\"translationSettings\").show();\n                           } else {\n                              $$(\"translationSettings\").hide();\n                           }\n                        },\n                     },\n                     {\n                        view: \"button\",\n                        width: 35,\n                        css: \"webix_transparent\",\n                        type: \"icon\",\n                        icon: \"nomargin fa fa-times\",\n                        click: () => {\n                           $$(\n                              `quickTranslationTool_${this.containerDomID}`\n                           ).hide();\n                        },\n                     },\n                  ],\n               },\n               {\n                  view: \"toolbar\",\n                  id: \"translationSettings\",\n                  hidden: true,\n                  css: \"webix_dark\",\n                  rows: [\n                     {\n                        id: `qtt_accordion_${this.containerDomID}_translateTo`,\n                        view: \"select\",\n                        labelWidth: 120,\n                        label: \"Translate to:\",\n                        labelAlign: \"right\",\n                        options: [],\n                        on: {\n                           onChange: (newVal, oldVal) => {\n                              if (newVal != oldVal) {\n                                 this.buildTranslationAccordion(\n                                    this.application.objectsIncluded(),\n                                    this.application.pages(),\n                                    this.application.hintsIncluded()\n                                 );\n                              }\n                           },\n                        },\n                     },\n                     {\n                        id: `qtt_accordion_${this.containerDomID}_translateHint`,\n                        view: \"select\",\n                        labelWidth: 120,\n                        label: \"Hint language:\",\n                        bottomLabel: \"*Hover over label to display hint\",\n                        labelAlign: \"right\",\n                        options: [],\n                        on: {\n                           onChange: (newVal, oldVal) => {\n                              if (newVal != oldVal) {\n                                 this.buildTranslationAccordion(\n                                    this.application.objectsIncluded(),\n                                    this.application.pages(),\n                                    this.application.hintsIncluded()\n                                 );\n                              }\n                           },\n                        },\n                     },\n                  ],\n               },\n            ],\n         },\n         body: translationToolBody,\n      };\n   }\n\n   init(portal) {\n      this.AB = portal.AB;\n      this.portal = portal;\n      this.appId = portal.AppState.lastSelectedApp;\n      this.application = this.AB.applicationByID(this.appId);\n\n      const languageCode = this.AB.Config.userConfig().languageCode;\n\n      let languageList = [];\n\n      try {\n         this.AB.Network.get({\n            // The object \"SITE_LANGUAGE\"\n            url: \"/app_builder/model/d84cd351-d96c-490f-9afb-2a0b880ca0ec\",\n         }).then((list) => {\n            list.data.forEach((item) => {\n               languageList.push({\n                  id: item.language_code,\n                  value: item.language_label,\n               });\n            });\n            $$(`qtt_accordion_${this.containerDomID}_translateTo`).define({\n               options: languageList,\n               value: languageCode,\n            });\n            $$(`qtt_accordion_${this.containerDomID}_translateTo`).refresh();\n            $$(\n               `qtt_accordion_${this.containerDomID}` + \"_translateHint\"\n            ).define({\n               options: languageList,\n               value: languageList[0].id,\n            });\n            $$(\n               `qtt_accordion_${this.containerDomID}` + \"_translateHint\"\n            ).refresh();\n            this.buildTranslationAccordion(\n               this.application.objectsIncluded(),\n               this.application.pages(),\n               this.application.hintsIncluded()\n            );\n         });\n\n         webix.ready(function () {\n            webix.protoUI(\n               {\n                  name: \"edittree\",\n               },\n               webix.EditAbility,\n               webix.ui.tree\n            );\n         });\n\n         webix.ui(this.ui());\n      } catch (error) {\n         console.error(error);\n      }\n   }\n\n   show() {\n      $$(`quickTranslationTool_${this.containerDomID}`).show();\n   }\n\n   hide() {\n      $$(`quickTranslationTool_${this.containerDomID}`).hide();\n   }\n\n   showPage(pageId) {\n      let page = this.application.views((v) => {\n         return v.id == pageId;\n      })[0];\n\n      this.portal.showPage(page);\n   }\n\n   /*\n    * helper to get the current apps views\n    */\n   views(f) {\n      return this.AB.applicationByID(this.appId).views(f);\n   }\n\n   tutorials(f) {\n      return this.AB.applicationByID(this.appId).hints(f);\n   }\n\n   buildTranslationAccordion(objects, views, tutorials) {\n      $$(`qtt_accordion_${this.containerDomID}`).removeView(\n         `qtt_accordionitem_${this.containerDomID}_objects`\n      );\n      $$(`qtt_accordion_${this.containerDomID}`).removeView(\n         `qtt_accordionitem_${this.containerDomID}_views`\n      );\n      $$(`qtt_accordion_${this.containerDomID}`).removeView(\n         `qtt_accordionitem_${this.containerDomID}_tutorials`\n      );\n\n      var toggleParent = (element) => {\n         if (!element.parent) return false;\n         var parentElem = element.parent;\n         if (!parentElem.parent) return false;\n         parentElem.parent.emit(\"changeTab\", parentElem.id);\n         toggleParent(parentElem.parent);\n      };\n\n      var objectTree = [\n         {\n            id: `qtt_object_progress${this.containerDomID}`,\n            height: 7,\n         },\n         {\n            id: `linetree_${this.containerDomID}_objects`,\n            view: \"edittree\",\n            type: \"lineTree\",\n            editable: true,\n            tooltip: \"#hint#\",\n            // role: role,\n            editor: \"text\",\n            editValue: \"value\",\n            template: (obj, common) => {\n               let language = $$(\n                  `qtt_accordion_${this.containerDomID}_translateTo`\n               ).getValue();\n               var color = \"gray\";\n               if (obj.value.indexOf(`[${language}]`) > -1) {\n                  color = \"#ff5c4c\";\n               }\n               if (!obj.icon) {\n                  obj.icon = \"minus\";\n               }\n               var icon = `<span class=\"fa-stack\" style=\"margin: 0 5px 0 4px;\">\n                                             <i style=\"color: ${color};\" class=\"fa fa-circle fa-stack-2x\"></i>\n                                             <i class=\"fa fa-${obj.icon} fa-stack-1x fa-inverse\"></i>\n                                          </span>`;\n               return (\n                  `<span>` +\n                  icon +\n                  common.icon(obj, common) +\n                  `<span>${obj.value}</span>`\n               );\n            },\n            data: [],\n            on: {\n               onAfterLoad: (id) => {\n                  if (\n                     !$$(`qtt_object_progress${this.containerDomID}`)\n                        .showProgress\n                  ) {\n                     webix.extend(\n                        $$(`qtt_object_progress${this.containerDomID}`),\n                        webix.ProgressBar\n                     );\n                  }\n                  $$(`linetree_${this.containerDomID}_objects`).parse(\n                     this.getTranslationToolObjectsTree(\n                        objects,\n                        this.containerDomID\n                     )\n                  );\n                  $$(`linetree_${this.containerDomID}_objects`).openAll();\n               },\n               onAfterEditStop: (state, editor, ignoreUpdate) => {\n                  if (state.old == state.value) return false;\n                  let language = $$(\n                     `qtt_accordion_${this.containerDomID}_translateTo`\n                  ).getValue();\n                  let branch = $$(\n                     `linetree_${this.containerDomID}_objects`\n                  ).data.getItem(editor.id);\n                  let propName = branch.field;\n                  let objectId = branch.objectId ? branch.objectId : branch.id;\n                  let fieldId = branch.fieldId ? branch.fieldId : \"\";\n                  let obj = this.AB.objectByID(objectId);\n                  if (fieldId) {\n                     let field = obj.fields((item) => {\n                        return item.id == fieldId;\n                     })[0];\n                     if (branch.type == \"option\") {\n                        field.settings.options.forEach((option) => {\n                           if (option.id == branch.id) {\n                              if (obj.languageDefault() == language) {\n                                 hasLang = true;\n                                 option[propName] = state.value;\n                              } else {\n                                 option.translations.forEach((t) => {\n                                    if (t.language_code == language) {\n                                       hasLang = true;\n                                       t[propName] = state.value;\n                                    }\n                                 });\n                              }\n                              if (!hasLang) {\n                                 var trans = {};\n                                 trans.language_code = language;\n                                 trans[propName] = state.value;\n                                 option.translations.push(trans);\n                              }\n                              field.save();\n                           }\n                        });\n                     } else {\n                        var hasLang = false;\n                        if (obj.languageDefault() == language) {\n                           hasLang = true;\n                           field[propName] = state.value;\n                        } else {\n                           field.translations.forEach((t) => {\n                              if (t.language_code == language) {\n                                 hasLang = true;\n                                 t[propName] = state.value;\n                              }\n                           });\n                        }\n                        if (!hasLang) {\n                           var trans = {};\n                           trans.language_code = language;\n                           trans[propName] = state.value;\n                           field.translations.push(trans);\n                        }\n                        field.save();\n                     }\n                  } else {\n                     let hasLang = false;\n                     if (obj.languageDefault() == language) {\n                        hasLang = true;\n                        obj[propName] = state.value;\n                     } else {\n                        obj.translations.forEach((t) => {\n                           if (t.language_code == language) {\n                              hasLang = true;\n                              t[propName] = state.value;\n                           }\n                        });\n                     }\n                     if (!hasLang) {\n                        let trans = {};\n                        trans.language_code = language;\n                        trans[propName] = state.value;\n                        obj.translations.push(trans);\n                     }\n                     obj.save();\n                  }\n\n                  let progressBar = $$(\n                     `qtt_object_progress${this.containerDomID}`\n                  );\n                  let total = progressBar.config.total;\n                  let completed = progressBar.config.completed;\n\n                  if (\n                     state.old.indexOf(`[${language}]`) == -1 &&\n                     state.value.indexOf(`[${language}]`) > -1\n                  ) {\n                     completed--;\n                  } else if (\n                     state.old.indexOf(`[${language}]`) > -1 &&\n                     state.value.indexOf(`[${language}]`) > -1\n                  ) {\n                     // no change to completed count\n                  } else {\n                     completed++;\n                  }\n                  let position = completed / total + 0.00001;\n                  progressBar.define({\n                     total: total,\n                     completed: completed,\n                  });\n                  progressBar.showProgress({\n                     type: \"top\",\n                     position: position,\n                  });\n               },\n            },\n         },\n      ];\n\n      var viewTree = [\n         {\n            id: `qtt_view_progress${this.containerDomID}`,\n            height: 7,\n         },\n         {\n            id: `linetree_${this.containerDomID}_views`,\n            view: \"edittree\",\n            type: \"lineTree\",\n            editable: true,\n            tooltip: \"#hint#\",\n            // role: role,\n            editor: \"text\",\n            editValue: \"value\",\n            template: (obj, common) => {\n               let language = $$(\n                  `qtt_accordion_${this.containerDomID}_translateTo`\n               ).getValue();\n               var color = \"gray\";\n               if (obj.value.indexOf(`[${language}]`) > -1) {\n                  color = \"#ff5c4c\";\n               }\n               if (!obj.icon) {\n                  obj.icon = \"minus\";\n               }\n               var externalLink = \"\";\n               if ([\"button\", \"label\", \"menu\"].indexOf(obj.type) == -1) {\n                  externalLink = `<i style=\"float:right; color: lightgray\" class=\"externalLink fa fa-external-link\"></i>`;\n               }\n               var icon = `<span class=\"fa-stack\" style=\"margin: 0 5px 0 4px;\">\n                                             <i style=\"color: ${color};\" class=\"fa fa-circle fa-stack-2x\"></i>\n                                             <i class=\"fa fa-${obj.icon} fa-stack-1x fa-inverse\"></i>\n                                          </span>`;\n               return (\n                  `<span>` +\n                  icon +\n                  common.icon(obj, common) +\n                  `<span>${obj.value}</span>` +\n                  externalLink\n               );\n            },\n            data: [],\n            onClick: {\n               externalLink: (event, branch, target) => {\n                  var item = $$(\n                     `linetree_${this.containerDomID}_views`\n                  ).getItem(branch);\n\n                  this.showPage(item.pageId || item.viewId);\n\n                  if (item.type == \"tab\") {\n                     var tabView = this.application.views(\n                        (v) => v.id == item.id\n                     )[0];\n                     if (!tabView) return false;\n\n                     var tab = tabView.parent;\n                     if (!tab) return false;\n\n                     toggleParent(tab);\n                     if (!$$(tabView.id) || !$$(tabView.id).isVisible()) {\n                        var showIt = setInterval(function () {\n                           if ($$(tabView.id) && $$(tabView.id).isVisible()) {\n                              clearInterval(showIt);\n                           }\n                           tab.emit(\"changeTab\", tabView.id);\n                        }, 200);\n                     }\n                  } else if (item.type == \"page\") {\n                     var pageView = this.application.views(\n                        (v) => v.id == item.id\n                     )[0];\n                     if (!pageView) return false;\n                     pageView.emit(\"changePage\", pageView.id);\n                     // this.showPage(item.pageId);\n                  }\n\n                  return false;\n               },\n            },\n            on: {\n               onAfterLoad: (id) => {\n                  if (\n                     !$$(`qtt_view_progress${this.containerDomID}`).showProgress\n                  ) {\n                     webix.extend(\n                        $$(`qtt_view_progress${this.containerDomID}`),\n                        webix.ProgressBar\n                     );\n                  }\n                  $$(`linetree_${this.containerDomID}_views`).parse(\n                     this.getTranslationToolViewsTree(\n                        views,\n                        this.containerDomID\n                     )\n                  );\n                  $$(`linetree_${this.containerDomID}_views`).openAll();\n               },\n               onAfterEditStop: (state, editor, ignoreUpdate) => {\n                  if (state.old == state.value) return false;\n                  let language = $$(\n                     `qtt_accordion_${this.containerDomID}_translateTo`\n                  ).getValue();\n                  let branch = $$(\n                     `linetree_${this.containerDomID}_views`\n                  ).data.getItem(editor.id);\n                  let propName = branch.field;\n                  if (branch.type == \"menu\") {\n                     let view = this.application.views((view) => {\n                        return view.id == branch.viewId;\n                     })[0];\n                     view.settings.order.forEach((button) => {\n                        if (button.pageId == branch.buttonId) {\n                           let hasLang = false;\n                           button.translations.forEach((t) => {\n                              if (t.language_code == language) {\n                                 hasLang = true;\n                                 t[propName] = state.value;\n                              }\n                           });\n                           if (!hasLang) {\n                              let trans = {};\n                              trans.language_code = language;\n                              trans[propName] = state.value;\n                              button.translations.push(trans);\n                           }\n                           view.save();\n                        }\n                     });\n                  } else if (branch.type == \"button\") {\n                     let view = this.application.views((view) => {\n                        return view.id == branch.viewId;\n                     })[0];\n                     var hasLang = false;\n\n                     if (view.languageDefault() == language) {\n                        hasLang = true;\n                        view.settings[propName] = state.value;\n                     } else {\n                        view.settings.translations.forEach((t) => {\n                           if (t.language_code == language) {\n                              hasLang = true;\n                              t[propName] = state.value;\n                           }\n                        });\n                     }\n                     if (!hasLang) {\n                        var trans = {};\n                        trans.language_code = language;\n                        trans[propName] = state.value;\n                        view.settings.translations.push(trans);\n                     }\n                     view.save();\n                  } else {\n                     let view = this.application.views((view) => {\n                        return view.id == branch.id;\n                     })[0];\n                     let hasLang = false;\n                     if (view.languageDefault() == language) {\n                        hasLang = true;\n                        view[propName] = state.value;\n                     } else {\n                        view.translations.forEach((t) => {\n                           if (t.language_code == language) {\n                              hasLang = true;\n                              t[propName] = state.value;\n                           }\n                        });\n                     }\n                     if (!hasLang) {\n                        let trans = {};\n                        trans.language_code = language;\n                        trans[propName] = state.value;\n                        view.translations.push(trans);\n                     }\n                     view.save();\n                  }\n                  let progressBar = $$(\n                     `qtt_view_progress${this.containerDomID}`\n                  );\n                  let total = progressBar.config.total;\n                  let completed = progressBar.config.completed;\n                  if (\n                     state.old.indexOf(`[${language}]`) == -1 &&\n                     state.value.indexOf(`[${language}]`) > -1\n                  ) {\n                     completed--;\n                  } else if (\n                     state.old.indexOf(`[${language}]`) > -1 &&\n                     state.value.indexOf(`[${language}]`) > -1\n                  ) {\n                     // no change to completed count\n                  } else {\n                     completed++;\n                  }\n                  let position = completed / total + 0.00001;\n                  progressBar.define({\n                     total: total,\n                     completed: completed,\n                  });\n                  progressBar.showProgress({\n                     type: \"top\",\n                     position: position,\n                  });\n               },\n            },\n         },\n      ];\n\n      var tutorialTree = [\n         {\n            id: `qtt_tutorials_progress${this.containerDomID}`,\n            height: 7,\n         },\n         {\n            id: `linetree_${this.containerDomID}_tutorials`,\n            view: \"edittree\",\n            type: \"lineTree\",\n            editable: true,\n            tooltip: \"#hint#\",\n            // role: role,\n            editor: \"text\",\n            editValue: \"value\",\n            template: (obj, common) => {\n               let language = $$(\n                  `qtt_accordion_${this.containerDomID}_translateTo`\n               ).getValue();\n               var color = \"gray\";\n               if (obj.value.indexOf(`[${language}]`) > -1) {\n                  color = \"#ff5c4c\";\n               }\n               if (!obj.icon) {\n                  obj.icon = \"minus\";\n               }\n               var icon = `<span class=\"fa-stack\" style=\"margin: 0 5px 0 4px;\">\n                                             <i style=\"color: ${color};\" class=\"fa fa-circle fa-stack-2x\"></i>\n                                             <i class=\"fa fa-${obj.icon} fa-stack-1x fa-inverse\"></i>\n                                          </span>`;\n               return (\n                  `<span>` +\n                  icon +\n                  common.icon(obj, common) +\n                  `<span>${obj.value}</span>`\n               );\n            },\n            data: [],\n            on: {\n               onAfterLoad: (id) => {\n                  if (\n                     !$$(`qtt_tutorials_progress${this.containerDomID}`)\n                        .showProgress\n                  ) {\n                     webix.extend(\n                        $$(`qtt_tutorials_progress${this.containerDomID}`),\n                        webix.ProgressBar\n                     );\n                  }\n                  $$(`linetree_${this.containerDomID}_tutorials`).parse(\n                     this.getTranslationToolTutorialsTree(\n                        tutorials,\n                        this.containerDomID\n                     )\n                  );\n                  $$(`linetree_${this.containerDomID}_tutorials`).openAll();\n               },\n               onAfterEditStop: (state, editor, ignoreUpdate) => {\n                  /// need to work here next week james\n                  if (state.old == state.value) return false;\n                  let language = $$(\n                     `qtt_accordion_${this.containerDomID}_translateTo`\n                  ).getValue();\n                  let branch = $$(\n                     `linetree_${this.containerDomID}_tutorials`\n                  ).data.getItem(editor.id);\n                  let propName = branch.field;\n                  if (branch.type == \"tutorial\") {\n                     let hint = this.AB.hints((h) => {\n                        return h.id == branch.viewId;\n                     })[0];\n                     let hasLang = false;\n                     if (hint.languageDefault() == language) {\n                        hasLang = true;\n                        hint[propName] = state.value;\n                     } else {\n                        hint.translations.forEach((t) => {\n                           if (t.language_code == language) {\n                              hasLang = true;\n                              t[propName] = state.value;\n                           }\n                        });\n                     }\n                     if (!hasLang) {\n                        let trans = {};\n                        for (const [key, value] of Object.entries(\n                           hint.translations[0]\n                        )) {\n                           trans[key] = `[${language}] ${value}`;\n                        }\n                        trans.language_code = language;\n                        trans[propName] = state.value;\n                        hint.translations.push(trans);\n                     }\n                     hint.save();\n                  } else if (branch.type == \"step\") {\n                     let hint = this.AB.hints((h) => {\n                        return h.id == branch.hintId;\n                     })[0];\n                     let step = hint._steps[branch.viewId];\n                     let hasLang = false;\n                     if (step.languageDefault() == language) {\n                        hasLang = true;\n                        step[propName] = state.value;\n                     } else {\n                        step.translations.forEach((t) => {\n                           if (t.language_code == language) {\n                              hasLang = true;\n                              t[propName] = state.value;\n                           }\n                        });\n                     }\n                     if (!hasLang) {\n                        let trans = {};\n                        for (const [key, value] of Object.entries(\n                           step.translations[0]\n                        )) {\n                           trans[key] = `[${language}] ${value}`;\n                        }\n                        trans.language_code = language;\n                        trans[propName] = state.value;\n                        step.translations.push(trans);\n                     }\n                     step.save();\n                  }\n                  let progressBar = $$(\n                     `qtt_tutorials_progress${this.containerDomID}`\n                  );\n                  let total = progressBar.config.total;\n                  let completed = progressBar.config.completed;\n                  if (\n                     state.old.indexOf(`[${language}]`) == -1 &&\n                     state.value.indexOf(`[${language}]`) > -1\n                  ) {\n                     completed--;\n                  } else if (\n                     state.old.indexOf(`[${language}]`) > -1 &&\n                     state.value.indexOf(`[${language}]`) > -1\n                  ) {\n                     // no change to completed count\n                  } else {\n                     completed++;\n                  }\n                  let position = completed / total + 0.00001;\n                  progressBar.define({\n                     total: total,\n                     completed: completed,\n                  });\n                  progressBar.showProgress({\n                     type: \"top\",\n                     position: position,\n                  });\n               },\n            },\n         },\n      ];\n\n      var objectsAccordionItem = {\n         view: \"accordionitem\",\n         id: `qtt_accordionitem_${this.containerDomID}_objects`,\n         header: \"Data Objects\",\n         collapsed: true,\n         body: {\n            type: \"clean\",\n            rows: objectTree,\n         },\n      };\n\n      var viewsAccordionItem = {\n         view: \"accordionitem\",\n         id: `qtt_accordionitem_${this.containerDomID}_views`,\n         header: \"Interface Items\",\n         collapsed: true,\n         body: {\n            type: \"clean\",\n            rows: viewTree,\n         },\n      };\n\n      var hintsAccordionItem = {\n         view: \"accordionitem\",\n         id: `qtt_accordionitem_${this.containerDomID}_tutorials`,\n         header: \"Tutorials\",\n         collapsed: true,\n         body: {\n            type: \"clean\",\n            rows: tutorialTree,\n         },\n      };\n\n      $$(`qtt_accordion_${this.containerDomID}`).addView(\n         objectsAccordionItem,\n         -1\n      );\n      $$(`qtt_accordion_${this.containerDomID}`).addView(\n         viewsAccordionItem,\n         -1\n      );\n      $$(`qtt_accordion_${this.containerDomID}`).addView(\n         hintsAccordionItem,\n         -1\n      );\n      $$(`qtt_accordion_${this.containerDomID}`).show();\n      $$(`qtt_accordionitem_${this.containerDomID}_views`).collapse();\n      $$(`qtt_accordionitem_${this.containerDomID}_tutorials`).collapse();\n      $$(`qtt_accordion_noSelection_${this.containerDomID}`).hide();\n\n      $$(`linetree_${this.containerDomID}_objects`).openAll();\n      $$(`linetree_${this.containerDomID}_views`).openAll();\n      $$(`linetree_${this.containerDomID}_tutorials`).openAll();\n   }\n\n   getTranslations(translations, domId, field, completed, total) {\n      var missingHint = false;\n      var missingTranslate = false;\n      var translateLang = $$(`qtt_accordion_${domId}_translateTo`).getValue();\n      var value = translations.filter((item) => {\n         return item.language_code == translateLang;\n      })[0];\n      if (!value) {\n         // we didn't find the language so we are defaulting to first language\n         missingTranslate = true;\n         value = translations[0];\n      }\n      var hintLang = $$(`qtt_accordion_${domId}_translateHint`).getValue();\n      var hint = translations.filter((item) => {\n         return item.language_code == hintLang;\n      })[0];\n      if (!hint) {\n         // we didn't find the language so we are defaulting to first language\n         missingHint = true;\n         hint = translations[0];\n      }\n\n      var hintLabel = \"\";\n      var valueLabel = \"\";\n\n      // some items store the text we need translated under \"text\"\n      if (field) {\n         hintLabel = hint[field];\n         valueLabel = value[field];\n      }\n      if (!hintLabel) {\n         hintLabel = hint.label;\n      }\n      if (!valueLabel) {\n         valueLabel = value.label;\n      }\n\n      var hintPrefix = \"\";\n      if (missingHint) {\n         hintPrefix = `[${hintLang}] `;\n      }\n      var translatePrefix = \"\";\n      if (missingTranslate) {\n         translatePrefix = `[${translateLang}] `;\n      }\n      if (\n         (valueLabel || \"\").indexOf(`[${translateLang}]`) == -1 &&\n         !missingTranslate\n      ) {\n         completed++;\n      }\n      total++;\n      return {\n         hint: hintPrefix + hintLabel,\n         value: translatePrefix + valueLabel,\n         completed: completed,\n         total: total,\n      };\n   }\n\n   getTranslationToolViewsTree(views, domId) {\n      var completed = 0;\n      var total = 0;\n      // this so it looks right/indented in a tree view:\n      var tree = new webix.TreeCollection();\n\n      /**\n       * @method addPage\n       *\n       * @param {ABView} page\n       * @param {integer} index\n       * @param {uuid} parentId\n       */\n      var addPage = (page, parentId, type, field = \"label\", viewId) => {\n         var translations = page.translations;\n         var pageId = page.id;\n         if (type == \"button\") {\n            translations = page.settings.translations;\n            pageId = `${page.id}_${field}`;\n         }\n         var labels = this.getTranslations(\n            translations,\n            domId,\n            field,\n            completed,\n            total\n         );\n         completed = labels.completed;\n         total = labels.total;\n         var icon = page.tabicon ? page.tabicon : page.icon;\n\n         // add to tree collection\n         var branch = {\n            id: pageId,\n            value: labels.value,\n            hint: labels.hint,\n            field: field,\n            viewId: viewId,\n            translations: page.translations,\n            pageId: parentId,\n            buttonId: page.pageId,\n            type: type,\n            icon: icon,\n         };\n         tree.add(branch, null, parentId);\n\n         // stop at detail views\n         // if (page.defaults.key == \"detail\") {\n         //    return;\n         // }\n\n         var subPages = page.pages ? page.pages() : [];\n         subPages.forEach((childPage, childIndex) => {\n            addPage(childPage, page.id, \"page\");\n         });\n\n         // stop if there are no views to parse\n         if (!page.views) return;\n         // add labels\n         page\n            .views((v) => v.defaults.key == \"label\")\n            .forEach((label, labelIndex) => {\n               // label views\n               // label.icon = \"th-list\";\n               addPage(label, page.id, \"label\", \"text\", label.id);\n            });\n         // add tabs\n         page\n            .views((v) => v.defaults.key == \"tab\")\n            .forEach((tab, tabIndex) => {\n               // tab views\n               tab.views().forEach((tabView, tabViewIndex) => {\n                  // tab items will be below sub-page items\n                  // tabView.icon = \"th-list\";\n                  addPage(tabView, page.id, \"tab\", \"label\", tab.id);\n               });\n            });\n         // add menus\n         page\n            .views((v) => v.defaults.key == \"menu\")\n            .forEach((menu, menuIndex) => {\n               // menu buttons\n               if (!menu.settings.order) return;\n               menu.settings.order.forEach((menuItem, menuItemIndex) => {\n                  // tab items will be below sub-page items\n                  // menuItem.icon = \"link\";\n                  addPage(menuItem, page.id, \"menu\", \"aliasname\", menu.id);\n               });\n            });\n         // add form buttons\n         page\n            .views((v) => v.defaults.key == \"form\")\n            .forEach((form, formIndex) => {\n               // form inputs\n               form.views().forEach((formInput, formInputIndex) => {\n                  // we only need buttons\n                  if (formInput.key == \"button\") {\n                     for (const property in formInput.settings\n                        .translations[0]) {\n                        if (property != \"language_code\") {\n                           addPage(\n                              formInput,\n                              page.id,\n                              \"button\",\n                              property,\n                              formInput.id\n                           );\n                        }\n                     }\n                  }\n               });\n            });\n         // add chart labels\n         page\n            .views((v) => v.defaults.key == \"chart\")\n            .forEach((chart, chartIndex) => {\n               // chart views\n               chart.views().forEach((view, viewIndex) => {\n                  // we only need buttons\n                  if (view.key == \"label\") {\n                     addPage(view, page.id, \"label\", \"text\", view.id);\n                  }\n               });\n            });\n      };\n      views.forEach((p, index) => {\n         addPage(p, null, \"page\", \"label\", p.id);\n      });\n\n      // there is a webix bug that will not allow you to se the value of a progress bar to 0\n      let progressBar = $$(`qtt_view_progress${domId}`);\n      let position = completed / total + 0.0001;\n      progressBar.showProgress({\n         type: \"top\",\n         position: position,\n      });\n      progressBar.define({\n         total: total,\n         completed: completed,\n      });\n\n      return tree;\n   }\n\n   getTranslationToolObjectsTree(objects, domId) {\n      var completed = 0;\n      var total = 0;\n      // this so it looks right/indented in a tree view:\n      var tree = new webix.TreeCollection();\n\n      /**\n       * @method addBranch\n       *\n       * @param {ABView} page\n       * @param {uuid} parentId\n       * @param {string} type\n       */\n      var addBranch = (\n         object,\n         parentId,\n         type,\n         field = \"label\",\n         fieldId,\n         objectId\n      ) => {\n         var translations = object.translations;\n         // we were missing translationson the Roles object\n         if (!translations) return;\n         var labels = this.getTranslations(\n            translations,\n            domId,\n            field,\n            completed,\n            total\n         );\n         completed = labels.completed;\n         total = labels.total;\n\n         // add to tree collection\n         var branch = {\n            id: object.id,\n            value: labels.value,\n            hint: labels.hint,\n            translations: object.translations,\n            pageId: parentId,\n            objectId: objectId,\n            type: type,\n            field: field,\n            fieldId: fieldId,\n            icon:\n               type == \"object\" ? \"database\" : object.icon ? object.icon : \"\",\n         };\n         tree.add(branch, null, parentId);\n\n         var fields = object.fields ? object.fields() : [];\n         fields.forEach((field, fieldIndex) => {\n            addBranch(field, object.id, \"field\", \"label\", field.id, object.id);\n         });\n\n         // add options\n         if (\n            object.settings &&\n            object.settings.options &&\n            object.settings.options.length\n         ) {\n            object.settings.options.forEach((option, optionIndex) => {\n               addBranch(\n                  option,\n                  object.id,\n                  \"option\",\n                  \"text\",\n                  fieldId,\n                  parentId\n               );\n            });\n         }\n      };\n      objects.forEach((p, index) => {\n         addBranch(p, null, \"object\");\n      });\n\n      // there is a webix bug that will not allow you to se the value of a progress bar to 0\n      let progressBar = $$(`qtt_object_progress${domId}`);\n      let position = completed / total + 0.0001;\n      progressBar.showProgress({\n         type: \"top\",\n         position: position,\n      });\n      progressBar.define({\n         total: total,\n         completed: completed,\n      });\n\n      return tree;\n   }\n\n   getTranslationToolTutorialsTree(tutorials, domId) {\n      var completed = 0;\n      var total = 0;\n      // this so it looks right/indented in a tree view:\n      var tree = new webix.TreeCollection();\n\n      /**\n       * @method addBranch\n       *\n       * @param {ABView} page\n       * @param {uuid} parentId\n       * @param {string} type\n       */\n      var addBranch = (\n         object,\n         parentId,\n         type,\n         field = [\"label\"],\n         hintId = null\n      ) => {\n         var translations = object.translations;\n         // we were missing translationson the Roles object\n         if (!translations) return;\n         let lastField = \"\";\n         let firstField = \"\";\n         field.forEach((f) => {\n            if (firstField == \"\") firstField = f;\n            lastField = f;\n            var labels = this.getTranslations(\n               translations,\n               domId,\n               f,\n               completed,\n               total\n            );\n            completed = labels.completed;\n            total = labels.total;\n\n            // add to tree collection\n            var branch = {\n               id: object.id + f,\n               viewId: object.id,\n               value: labels.value,\n               hint: labels.hint,\n               translations: object.translations,\n               field: f,\n               type: type,\n               hintId: hintId,\n               icon:\n                  type == \"tutorial\"\n                     ? \"info-circle\"\n                     : object.icon\n                     ? object.icon\n                     : \"minus-circle\",\n            };\n            tree.add(branch, null, parentId);\n            parentId = object.id + firstField;\n         });\n\n         var steps = object.stepIDs || [];\n         steps.forEach((step) => {\n            addBranch(\n               object._steps[step],\n               parentId,\n               \"step\",\n               [\"name\", \"text\"],\n               object.id\n            );\n         });\n      };\n      tutorials.forEach((p, index) => {\n         addBranch(p, null, \"tutorial\", [\"name\", \"description\"]);\n      });\n\n      // there is a webix bug that will not allow you to se the value of a progress bar to 0\n      let progressBar = $$(`qtt_tutorials_progress${domId}`);\n      let position = completed / total + 0.0001;\n      progressBar.showProgress({\n         type: \"top\",\n         position: position,\n      });\n      progressBar.define({\n         total: total,\n         completed: completed,\n      });\n\n      return tree;\n   }\n}\n\nexport default new PortalTranslationTool();\n","import ClassUI from \"./ClassUI.js\";\n\nlet L = (...params) => AB.Multilingual.label(...params);\n\nclass PortalTutorialManager extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui(appId) {\n      // this is the modal window that opens when you click a tutorial to edit\n      const tutorialStepsManager = (id) => {\n         return {\n            view: \"window\",\n            id: \"stepManager\" + id,\n            head: {\n               view: \"toolbar\",\n               css: \"webix_dark\",\n               cols: [\n                  {\n                     width: 15,\n                  },\n                  {\n                     view: \"label\",\n                     label: \"Tutorial Steps Manager\",\n                     autowidth: true,\n                  },\n                  {},\n                  {\n                     view: \"button\",\n                     type: \"icon\",\n                     icon: \"fa fa-plus\",\n                     label: \"Step\",\n                     autowidth: true,\n                     css: \"webix_primary\",\n                     click: async () => {\n                        // create ABStep\n                        let step = await this.createStep(id);\n                        // save it to get an id to store on the ABHint\n                        await step.save();\n\n                        // get the current ABHint\n                        let hint = this.AB.hints((h) => {\n                           return h.id == id;\n                        })[0];\n                        // store the new ABStep id in the current ABHint\n                        if (hint?.stepIDs && Array.isArray(hint.stepIDs)) {\n                           hint.stepIDs.push(step.id);\n                        } else {\n                           hint.stepIDs = [step.id];\n                        }\n                        // store the ABStep in the ABHint (not saved in definitions)\n                        hint._steps[step.id] = step;\n                        // add the new step UI to the interface\n                        $$(\"hint_steps_\" + hint.id).addView(\n                           this.stepUI(step, hint)\n                        );\n                     },\n                  },\n                  {\n                     view: \"button\",\n                     width: 35,\n                     css: \"webix_transparent\",\n                     type: \"icon\",\n                     icon: \"nomargin fa fa-times\",\n                     click: () => {\n                        $$(\"stepManager\" + id).close();\n                        this.show();\n                     },\n                  },\n               ],\n            },\n            width: 800,\n            height: 500,\n            move: true,\n            position: \"center\",\n            resize: true,\n            body: {\n               rows: [\n                  {\n                     view: \"scrollview\",\n                     body: {\n                        rows: [\n                           tutorialSettings(id),\n                           {\n                              id: \"hint_steps_\" + id,\n                              rows: [],\n                           },\n                        ],\n                     },\n                  },\n                  save(id),\n               ],\n            },\n         };\n      };\n\n      // ui that contains the list of current ABHints on this application\n      const tutorialManagerBody = {\n         view: \"scrollview\",\n         css: \"lightgray ab_tutorial\",\n         body: {\n            rows: [\n               {\n                  view: \"list\",\n                  id: \"tutorial_list\",\n                  template: `<div class=\"deleteHint\">\n                                 <i class=\"fa fa-times\"></i>\n                              </div>\n                              <div class=\"active#settings.active# abTutorial\">\n                                 <h1>#name#</h1>\n                                 <p>#description#</p>\n                              </div>`,\n                  data: this._hints,\n                  hidden: this._hints.length == 0, // hide if we do not have any hints yet\n                  type: {\n                     css: \"hintItem\",\n                     height: \"auto\",\n                  },\n                  onClick: {\n                     deleteHint: (ev, id) => {\n                        // Confirm user wants to delete the hint\n                        webix\n                           .confirm({\n                              title: L(\"Delete Tutorial\"),\n                              text: L(\n                                 \"Are you sure you want to delete this tutorial?\"\n                              ),\n                              type: \"confirm-error\",\n                           })\n                           .then((result) => {\n                              // get the hint that we want to delete\n                              let hint = this.AB.hintID(id);\n                              // delete the hint (steps will also be deleted)\n                              hint.destroy(this.application);\n                              // remove the hint from the ui\n                              $$(\"tutorial_list\").remove(id);\n                              // check if we have any hints if not switch views\n                              if ($$(\"tutorial_list\").count() == 0) {\n                                 $$(\"tutorial_list\").hide();\n                                 $$(\"tutorial_list_noSelection\").show();\n                              }\n                              return false; // blocks the default click behavior\n                           })\n                           .fail(() => {\n                              // webix.message(\"Cancel\");\n                           });\n                        return false;\n                     },\n                     hintItem: (ev, id) => {\n                        // open the editor for the hint\n                        webix.ui(tutorialStepsManager(id)).show();\n                        // insert the steps into the manager to edit\n                        this.steps(id);\n                        this.hide();\n                     },\n                  },\n               },\n               {\n                  id: \"tutorial_list_noSelection\",\n                  hidden: this._hints.length > 0,\n                  rows: [\n                     {},\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        height: 200,\n                        label: \"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-info-circle'></div>\",\n                     },\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        label: \"Add a tutorial to this page.\",\n                     },\n                     {\n                        cols: [\n                           {},\n                           {\n                              view: \"button\",\n                              label: \"Create Tutorial\",\n                              type: \"form\",\n                              css: \"webix_primary\",\n                              autowidth: true,\n                              click: () => {\n                                 // open modal that helps user make a new hint\n                                 webix.ui(newTutorialPopup).show();\n\n                                 // populate the optiosn of the page/tab combo\n                                 $$(\"view_popup_options\").define(\n                                    \"options\",\n                                    this.options\n                                 );\n                                 // attempt to set the values of the combo based off the\n                                 // last visited page would be better if we could look at\n                                 // tabs as well\n                                 $$(\"view_popup_options\").define(\n                                    \"value\",\n                                    this.portal.AppState.lastPages[\n                                       this.portal.AppState.lastSelectedApp\n                                    ]\n                                 );\n                                 $$(\"view_popup_options\").refresh();\n                              },\n                           },\n                           {},\n                        ],\n                     },\n                     {},\n                  ],\n               },\n            ],\n         },\n      };\n\n      // small modal that is displayed when user wants to create a new tutorial/hint\n      const newTutorialPopup = {\n         view: \"popup\",\n         id: \"newTutorialPopup\",\n         position: \"center\",\n         height: 250,\n         width: 350,\n         modal: true,\n         body: {\n            rows: [\n               {\n                  view: \"toolbar\",\n                  id: \"myToolbarABLiveTool\",\n                  css: \"webix_dark\",\n                  cols: [\n                     {\n                        view: \"label\",\n                        label: L(\"Create Tutorial\"),\n                        align: \"center\",\n                     },\n                  ],\n               },\n               {\n                  view: \"form\",\n                  elements: [\n                     {\n                        view: \"combo\",\n                        label: \"\",\n                        id: \"view_popup_options\",\n                        placeholder: L(\"Choose Page or Tab\"),\n                        options: [],\n                     },\n                     {\n                        cols: [\n                           {\n                              view: \"button\",\n                              value: L(\"Cancel\"),\n                              click: () => {\n                                 $$(\"newTutorialPopup\").hide();\n                              },\n                           },\n                           {\n                              view: \"button\",\n                              value: \"Create\",\n                              id: \"view_popup_options_add\",\n                              css: \"webix_primary\",\n                              click: () => {\n                                 let view = $$(\"view_popup_options\").getValue();\n                                 let text = $$(\"view_popup_options\")\n                                    .getText()\n                                    .trim();\n                                 // take values from selection to build a new hint\n                                 this.createTutorial(view, text);\n                                 $$(\"newTutorialPopup\").hide();\n                              },\n                           },\n                        ],\n                     },\n                  ],\n               },\n            ],\n         },\n      };\n\n      // save the hint and step values and close the manager\n      const save = (id) => {\n         return {\n            cols: [\n               {},\n               {\n                  view: \"button\",\n                  value: L(\"Cancel\"),\n                  width: 100,\n                  click: () => {\n                     $$(\"stepManager\" + id).close();\n                     this.show();\n                  },\n               },\n               {\n                  view: \"button\",\n                  value: L(\"Save\"),\n                  width: 100,\n                  css: \"webix_primary\",\n                  click: async (element, event) => {\n                     // validate form\n                     let valid = $$(\"stepform\" + id).validate();\n                     // get hint we are going to update\n                     let hint = this.AB.hints((h) => {\n                        return h.id == id;\n                     })[0];\n                     // loop through steps to get values and save\n                     hint.stepIDs.forEach((step) => {\n                        if (hint?._steps?.[step]) {\n                           // validate each step to ensure they are ready to save\n                           if (\n                              !$$(\"step_form\" + step).validate({\n                                 disabled: true,\n                              })\n                           ) {\n                              valid = false;\n                           } else {\n                              // set values so we can save later\n                              let values = $$(\"step_form\" + step).getValues();\n                              hint._steps[step].name = values.name;\n                              hint._steps[step].text = values.text;\n                              hint._steps[step].settings.event = values.event;\n                              hint._steps[step].settings.el = values.el;\n                              // hint._steps[step].save();\n                           }\n                        }\n                     });\n                     if (!valid) return false;\n\n                     var values = $$(\"stepform\" + id).getValues();\n                     hint.name = values.name;\n                     hint.description = values.description;\n                     hint.settings.view = values.view;\n                     hint.settings.active = values.active;\n                     // save the steps data next\n                     // hint.stepIDs.forEach((step) => {\n                     //    if (hint?._steps?.[step]) {\n                     //       hint._steps[step].save();\n                     //    }\n                     // });\n                     for (const step of hint.stepIDs) {\n                        if (hint?._steps?.[step]) {\n                           await hint._steps[step].save();\n                        }\n                     }\n                     await hint.save();\n                     $$(\"stepManager\" + id).close();\n                     this.show();\n                  },\n               },\n               {},\n            ],\n         };\n      };\n\n      // ui that is at the top of the tutorial manager for the global tutorial settings\n      const tutorialSettings = (id) => {\n         let currentTutorial = this.AB.hints((h) => {\n            return h.id == id;\n         })[0];\n         let active = currentTutorial?.settings?.active ?? \"1\";\n         return {\n            view: \"form\",\n            id: \"stepform\" + id,\n            borderless: true,\n            cols: [\n               {\n                  id: \"step_window\",\n                  rows: [\n                     {\n                        view: \"text\",\n                        label: L(\"Title\"),\n                        name: \"name\",\n                        validate: webix.rules.isNotEmpty,\n                        invalidMessage: L(\"Title is required\"),\n                        value: currentTutorial.name,\n                     },\n                     {\n                        view: \"textarea\",\n                        label: L(\"Text\"),\n                        labelAlign: \"left\",\n                        height: 100,\n                        name: \"description\",\n                        value: currentTutorial?.description || \"\",\n                     },\n                  ],\n               },\n               {\n                  width: 300,\n                  rows: [\n                     {\n                        cols: [\n                           {\n                              view: \"label\",\n                              label: L(\"Page/Tab\"),\n                              align: \"left\",\n                              width: 100,\n                           },\n                           // {\n                           //    view: \"button\",\n                           //    icon: \"fa fa-crosshairs\",\n                           //    type: \"icon\",\n                           //    label: L(\"select\"),\n                           //    css: \"focusPageTab webix_primary\",\n                           //    currentTutorialID: id,\n                           //    width: 100,\n                           //    click: () => {\n                           //       $$(\"stepManager\" + currentTutorial.id).hide();\n                           //       document.addEventListener(\n                           //          \"click\",\n                           //          this.handlePageTabClick,\n                           //          false\n                           //       );\n                           //       document.hintId = id;\n                           //       webix.ui(this.pageTabWindow(id)).show();\n                           //    },\n                           // },\n                           {\n                              view: \"combo\",\n                              name: \"view\",\n                              value: currentTutorial.settings.view,\n                              options: {\n                                 view: \"suggest\",\n                                 css: \"wider_popup\",\n                                 body: {\n                                    view: \"list\",\n                                    css: \"wider_popup\",\n                                    data: this.options,\n                                    template: \"#value#\",\n                                 },\n                              },\n                           },\n                        ],\n                     },\n\n                     {\n                        view: \"switch\",\n                        label: L(\"Active\"),\n                        labelWidth: 100,\n                        name: \"active\",\n                        value: active,\n                     },\n                  ],\n               },\n            ],\n         };\n      };\n\n      // this is the drawer admin that lists all tutorials\n      return {\n         view: \"window\",\n         css: \"tutorialWindow\",\n         id: \"tutorial_manager\",\n         position: function (state) {\n            state.left = state.maxWidth - 350; // fixed values\n            state.top = 0;\n            state.width = 350; // relative values\n            state.height = state.maxHeight;\n         },\n         on: {\n            onShow: () => {},\n         },\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               {\n                  width: 15,\n               },\n               {\n                  view: \"label\",\n                  label: \"Tutorial Manager\",\n                  autowidth: true,\n               },\n               {},\n               {\n                  view: \"button\",\n                  type: \"icon\",\n                  icon: \"fa fa-plus\",\n                  label: \"Tutorial\",\n                  width: 95,\n                  css: \"webix_primary\",\n                  click: () => {\n                     webix.ui(newTutorialPopup).show();\n\n                     $$(\"view_popup_options\").define(\"options\", this.options);\n                     $$(\"view_popup_options\").define(\n                        \"value\",\n                        this.portal.AppState.lastPages[\n                           this.portal.AppState.lastSelectedApp\n                        ]\n                     );\n                     $$(\"view_popup_options\").refresh();\n                  },\n               },\n               {\n                  view: \"button\",\n                  width: 35,\n                  css: \"webix_transparent\",\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     this.hide();\n                  },\n               },\n            ],\n         },\n         body: tutorialManagerBody,\n      };\n   }\n\n   init(portal) {\n      this.AB = portal.AB;\n      this.portal = portal;\n      this.appId = portal.AppState.lastSelectedApp;\n\n      this.application = this.AB.applicationByID(this.appId);\n      const pages = this.application.pages();\n      this.options = this.getViewOptions(pages);\n      // only return tutorials that are on current application\n      this._hints = this.AB.hints((hint) => {\n         if (this.application.hintIDs.indexOf(hint.id) > -1) {\n            return true;\n         } else {\n            return false;\n         }\n      });\n      webix.ui(this.ui());\n   }\n\n   show() {\n      // this gets the latest hints and updates them to local list.\n      $$(\"tutorial_manager\").show();\n      this._hints = this.AB.hints((hint) => {\n         if (this.application.hintIDs.indexOf(hint.id) > -1) {\n            return true;\n         } else {\n            return false;\n         }\n      });\n      $$(\"tutorial_list\").define(\"data\", this._hints);\n      $$(\"tutorial_list\").refresh();\n   }\n\n   hide() {\n      $$(\"tutorial_manager\").hide();\n   }\n\n   // small modal that gives instructions to user when selecting the page or tab to load this tutorial on\n   pageTabWindow(hintID) {\n      return {\n         view: \"window\",\n         id: \"pageTabWindow\",\n         width: 160,\n         height: 160,\n         move: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               {},\n               {\n                  view: \"button\",\n                  width: 35,\n                  css: \"webix_transparent\",\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     $$(\"stepManager\" + hintID).show();\n                     $$(\"pageTabWindow\").hide();\n\n                     document.removeEventListener(\n                        \"contextmenu\",\n                        this.handleRightClick,\n                        false\n                     );\n                  },\n               },\n            ],\n         },\n         position: function (state) {\n            state.left = state.maxWidth - state.width;\n            state.top = state.maxHeight - state.height;\n         },\n         body: {\n            template:\n               \"<div class='highlightWin'>\" +\n               L(\"Click the page or tab that will start this tutorial\") +\n               \"</div>\",\n         },\n      };\n   }\n\n   // small modal that gives instructions to users when they are selecting the highlight element\n   focusWindow(hintID) {\n      return {\n         view: \"window\",\n         id: \"focusWindow\",\n         width: 160,\n         height: 160,\n         move: true,\n         head: {\n            view: \"toolbar\",\n            css: \"webix_dark\",\n            cols: [\n               {},\n               {\n                  view: \"button\",\n                  width: 35,\n                  css: \"webix_transparent\",\n                  type: \"icon\",\n                  icon: \"nomargin fa fa-times\",\n                  click: () => {\n                     $$(\"stepManager\" + hintID).show();\n                     $$(\"focusWindow\").hide();\n\n                     document.removeEventListener(\n                        \"contextmenu\",\n                        this.handleRightClick,\n                        false\n                     );\n                     document.body.classList.remove(\"findDataCy\");\n                  },\n               },\n            ],\n         },\n         position: function (state) {\n            state.left = state.maxWidth - state.width;\n            state.top = state.maxHeight - state.height;\n         },\n         body: {\n            template:\n               \"<div class='highlightWin'>\" +\n               L(\"Right click the element you want to highlight.\") +\n               \"</div>\",\n         },\n      };\n   }\n\n   updateStepsUI(id) {\n      const views = $$(\"hint_steps_\" + id).getChildViews();\n      let viewsToRemove = [];\n      views.forEach((view) => {\n         viewsToRemove.push(view.config.id);\n      });\n      viewsToRemove.forEach((view) => {\n         $$(\"hint_steps_\" + id).removeView(view);\n      });\n      this.steps(id);\n   }\n\n   addHighlightClass(event) {\n      let item = $$(event.currentTarget);\n      let formVals = $$(\"step_form\" + item.config.stepId).getValues();\n      document.querySelector(formVals?.el).classList.add(\"highlightMe\");\n   }\n   removeHighlightClass(event) {\n      let item = $$(event.currentTarget);\n      let formVals = $$(\"step_form\" + item.config.stepId).getValues();\n      document.querySelector(formVals?.el).classList.remove(\"highlightMe\");\n   }\n\n   // build a list of steps that are included in this hint\n   steps(id) {\n      let hint = this.AB.hints((h) => {\n         return h.id == id;\n      })[0];\n      // if we do not have steps\n      if (!hint?.stepIDs?.length) {\n         let addStepBelow = {\n            id: \"addStepBelow\",\n            padding: 20,\n            rows: [\n               {\n                  css: \"ab-component-form-rules\",\n                  rows: [\n                     {},\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        height: 80,\n                        label: \"<div style='display: block; font-size: 80px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-info-circle'></div>\",\n                     },\n                     {\n                        view: \"label\",\n                        align: \"center\",\n                        label: L(\"Add a step to this tutorial.\"),\n                     },\n                     {\n                        cols: [\n                           {},\n                           {\n                              view: \"button\",\n                              type: \"icon\",\n                              icon: \"fa fa-plus\",\n                              label: L(\"Step\"),\n                              autowidth: true,\n                              css: \"webix_primary\",\n                              click: async () => {\n                                 // create an ABStep\n                                 let step = await this.createStep(id);\n                                 // save it to definitions to get id\n                                 await step.save();\n                                 // get the hint we are editing\n                                 let hint = this.AB.hints((h) => {\n                                    return h.id == id;\n                                 })[0];\n                                 // assign the new ABStep id to the ABHint\n                                 if (\n                                    hint?.stepIDs &&\n                                    Array.isArray(hint.stepIDs)\n                                 ) {\n                                    hint.stepIDs.push(step.id);\n                                 } else {\n                                    hint.stepIDs = [step.id];\n                                 }\n                                 // store the ABStep on the ABHint (not stored in defs)\n                                 hint._steps[step.id] = step;\n                                 // remove ui that shows when ABHint does not have steps\n                                 $$(\"hint_steps_\" + hint.id).removeView(\n                                    \"addStepBelow\"\n                                 );\n                                 // add the ui to edit the new step to the ui\n                                 $$(\"hint_steps_\" + hint.id).addView(\n                                    this.stepUI(step, hint)\n                                 );\n                              },\n                           },\n                           {},\n                        ],\n                     },\n                     {},\n                  ],\n               },\n            ],\n         };\n         // add to the ui now that we have it defined\n         $$(\"hint_steps_\" + id).addView(addStepBelow);\n      } else {\n         // if we do have steps\n         hint.stepIDs.forEach((step) => {\n            $$(\"hint_steps_\" + id).addView(\n               this.stepUI(hint._steps[step], hint)\n            );\n         });\n      }\n      // set up hover listeners for buttons that help user pick and show the highlight elements\n      const focusElements = document.querySelectorAll(\".focusElement\");\n      for (let i = 0; i < focusElements.length; i++) {\n         focusElements[i].addEventListener(\n            \"mouseover\",\n            this.addHighlightClass,\n            false\n         );\n         focusElements[i].addEventListener(\n            \"mouseout\",\n            this.removeHighlightClass,\n            false\n         );\n      }\n   }\n\n   // UI for each step that will be used to rebuild steps when moved/deleted/loaded\n   stepUI(step, hint) {\n      // the position of the step that we display in the top left corner of the ui\n      let position = $$(\"hint_steps_\" + hint.id).getChildViews().length + 1;\n      return {\n         view: \"form\",\n         id: \"step_form\" + step.id,\n         css: \"my\",\n         padding: 15,\n         borderless: true,\n         rows: [\n            {\n               borderless: true,\n               cols: [\n                  {\n                     width: 50,\n                     rows: [\n                        {\n                           view: \"label\",\n                           label: `<h1 class=\"stepPos\">${position}</h1>`,\n                           align: \"center\",\n                        },\n                        {\n                           view: \"icon\",\n                           class: \"moveStepUp\",\n                           icon: \"fa fa-caret-up\",\n                           disabled: position == 1 ? true : false, // do not allow moving up if already at the top position\n                           align: \"center\",\n                           click: (id, element) => {\n                              // move the step up a position\n                              this.moveStep(step, hint, \"up\");\n                           },\n                        },\n                        {\n                           view: \"icon\",\n                           class: \"moveStepDown\",\n                           icon: \"fa fa-caret-down\",\n                           disabled:\n                              hint.stepIDs.length == position ? true : false, // do not let the last item be moved down\n                           align: \"center\",\n                           click: (id, element) => {\n                              // move the step down a position\n                              this.moveStep(step, hint, \"down\");\n                           },\n                        },\n                     ],\n                  },\n                  {\n                     css: \"ab-component-form-rules\",\n                     padding: 15,\n                     cols: [\n                        {\n                           minWidth: 300,\n                           rows: [\n                              {\n                                 view: \"text\",\n                                 label: L(\"Title\"),\n                                 validate: webix.rules.isNotEmpty,\n                                 invalidMessage: L(\"Title is required\"),\n                                 labelWidth: 100,\n                                 name: \"name\",\n                                 value: step?.name || \"\",\n                              },\n                              {\n                                 view: \"textarea\",\n                                 label: L(\"Text\"),\n                                 labelAlign: \"left\",\n                                 labelWidth: 100,\n                                 height: 150,\n                                 name: \"text\",\n                                 value: step?.text || \"\",\n                              },\n                              {\n                                 cols: [\n                                    {\n                                       view: \"label\",\n                                       label: L(\"Highlight\"),\n                                       align: \"left\",\n                                       width: 100,\n                                    },\n                                    {\n                                       view: \"button\",\n                                       icon: \"fa fa-crosshairs\",\n                                       type: \"icon\",\n                                       label: L(\"select\"),\n                                       css: \"focusElement webix_primary\",\n                                       stepId: step.id,\n                                       width: 100,\n                                       click: () => {\n                                          // change the ui to support the selecting of the highlight element\n                                          $$(\"stepManager\" + hint.id).hide();\n                                          // adding this class will allow a css rule to highlight any element with data-cy attribute on hover\n                                          document.body.classList.add(\n                                             \"findDataCy\"\n                                          );\n                                          // when the user sees the element hovered can be a highlight element they right click to save it\n                                          document.addEventListener(\n                                             \"contextmenu\",\n                                             this.handleRightClick,\n                                             false\n                                          );\n                                          // store the step and hint ids to use in the handleRightClick() function\n                                          document.stepId = step.id;\n                                          document.hintId = hint.id;\n                                          // show a small window in bottom right hand corner that helps user know what to do\n                                          webix\n                                             .ui(this.focusWindow(hint.id))\n                                             .show();\n                                       },\n                                    },\n                                    {\n                                       view: \"text\",\n                                       name: \"el\",\n                                       value: step.settings.el,\n                                       disabled: true,\n                                       placeholder: L(\n                                          \"Click the 'select' button to pick an element to highlight.\"\n                                       ),\n                                       bottomLabel: L(\n                                          \"Hover over the 'select' button to highlight the chosen element.\"\n                                       ),\n                                       validate: webix.rules.isNotEmpty,\n                                       invalidMessage: L(\n                                          \"Please choose an item to highlight\"\n                                       ),\n                                    },\n                                 ],\n                              },\n                              {\n                                 cols: [\n                                    {\n                                       view: \"label\",\n                                       label: L(\"Event\"),\n                                       align: \"left\",\n                                       width: 100,\n                                    },\n                                    {\n                                       view: \"combo\",\n                                       value: step.settings.event,\n                                       name: \"event\",\n                                       options: [\n                                          {\n                                             id: \"click\",\n                                             value: L(\"Click\"),\n                                          },\n                                          {\n                                             id: \"enter\",\n                                             value: L(\"Enter\"),\n                                          },\n                                       ],\n                                    },\n                                 ],\n                              },\n                           ],\n                        },\n                     ],\n                  },\n                  {\n                     view: \"template\",\n                     borderless: true,\n                     template: `<div class=\"deleteStep\"><i class=\"fa fa-times\"></i></div>`,\n                     width: 15,\n                     onClick: {\n                        deleteStep: (ev, id) => {\n                           // ask user if they want to delete this step\n                           webix\n                              .confirm({\n                                 title: L(\"Delete Step\"),\n                                 text: L(\n                                    \"Are you sure you want to delete this step?\"\n                                 ),\n                                 type: \"confirm-error\",\n                              })\n                              .then(async (result) => {\n                                 // remove the step from the hint\n                                 hint.stepRemove(step.id);\n                                 await hint.save();\n                                 // rebuild the step ui now that one has been removed\n                                 this.updateStepsUI(hint.id);\n                                 return false; // blocks the default click behavior\n                              })\n                              .fail(() => {\n                                 // webix.message(\"Cancel\");\n                              });\n                           return false;\n                        },\n                     },\n                  },\n               ],\n            },\n         ],\n      };\n   }\n\n   // this function moves a step up or down a position\n   async moveStep(step, hint, direction) {\n      let currPosition = hint.stepIDs.indexOf(step.id);\n      switch (direction) {\n         case \"up\":\n            hint.stepIDs.splice(\n               currPosition - 1,\n               0,\n               hint.stepIDs.splice(currPosition, 1)[0]\n            );\n            break;\n         default:\n            hint.stepIDs.splice(\n               currPosition + 1,\n               0,\n               hint.stepIDs.splice(currPosition, 1)[0]\n            );\n      }\n      await hint.save();\n      this.updateStepsUI(hint.id);\n   }\n\n   // this builds the list of page/tab options that a hint can be added to\n   getViewOptions(views) {\n      // this so it looks right/indented in a tree view:\n      // var tree = new webix.TreeCollection();\n      var options = [];\n\n      /**\n       * @method addOption\n       *\n       * @param {ABView} page\n       * @param {uuid} parentId\n       * @param {number} depth\n       */\n      var addOption = (object, parentId, depth) => {\n         // add to tree collection\n         if ([\"page\", \"tab\", \"viewcontainer\"].indexOf(object.key) != -1) {\n            var indent = \"\";\n            for (let i = 0; i < depth; i++) {\n               indent += \"<i style='display:inline-block; width: 10px;'></i>\";\n            }\n            let icon =\n               object.icon == \"braille\" ? \"external-link-square\" : object.icon;\n            var option = {\n               id: object.id,\n               value: `${indent} <i class=\"fa fa-${icon}\"></i> ${object.label}`,\n            };\n            options.push(option);\n         }\n\n         var pages = object.pages ? object.pages() : [];\n         pages.forEach((page, pageIndex) => {\n            addOption(page, object.id, depth + 1);\n         });\n\n         var views = object.views();\n         views.forEach((view, pageIndex) => {\n            addOption(view, object.id, depth + 1);\n         });\n      };\n      views.forEach((p, index) => {\n         addOption(p, null, 0);\n      });\n\n      return options;\n   }\n\n   // This creates a new hint and stores it on the application and view we want to display it on\n   async createTutorial(viewID, viewLabel) {\n      let hint = this.AB.hintNew({\n         name: viewLabel,\n         settings: { view: viewID },\n      });\n      await hint.save();\n      if (Array.isArray(this?.application?.hintIDs)) {\n         this.application.hintIDs.unshift(hint.id);\n      } else {\n         this.application.hintIDs = [hint.id];\n      }\n      this.application.save();\n      let hintView = this.application.views((view) => {\n         return view.id == viewID;\n      })[0];\n      hintView.settings.hintID = hint.id;\n      hintView.save();\n      $$(\"tutorial_list\").add(hint, 0);\n      if (this.AB.hints().length) {\n         $$(\"tutorial_list\").show();\n         $$(\"tutorial_list_noSelection\").hide();\n      }\n   }\n\n   // create a new step on a hint\n   async createStep(hintID) {\n      let step = this.AB.stepNew(null, hintID);\n      return step;\n   }\n\n   // store the data-cy info on a step after right clicking an element on the page\n   handleRightClick(event) {\n      function getCy(element) {\n         if (element?.dataset?.cy) {\n            return element.dataset.cy;\n         } else if (element?.parentElement) {\n            return getCy(element.parentElement);\n         } else {\n            webix.alert({\n               text: L(\"Sorry, try another element.\"),\n            });\n            return \"\";\n         }\n      }\n\n      if (document?.stepId) {\n         event.preventDefault();\n         event.stopPropagation();\n         let dataCy = getCy(event.target);\n         if (!dataCy) return false;\n         $$(\"step_form\" + document.stepId).setValues(\n            {\n               el: \"[data-cy='\" + dataCy + \"']\",\n            },\n            true\n         );\n      }\n      $$(\"stepManager\" + document.hintId).show();\n      $$(\"focusWindow\").hide();\n\n      document.removeEventListener(\"contextmenu\", this.handleRightClick, false);\n      document.body.classList.remove(\"findDataCy\");\n      delete document.stepId;\n      delete document.hintId;\n\n      return false;\n   }\n\n   // handlePageTabClick(event) {\n   //    event.preventDefault();\n   //    event.stopPropagation();\n   //    debugger;\n   //    // $$(\"stepform\" + document?.hintId).setValues(\n   //    //    {\n   //    //       view: \"[data-cy='\" + dataCy + \"']\",\n   //    //    },\n   //    //    true\n   //    // );\n\n   //    $$(\"stepManager\" + document.hintId).show();\n   //    $$(\"pageTabWindow\").hide();\n\n   //    document.removeEventListener(\"click\", this.handlePageTabClick, false);\n   //    delete document.hintId;\n\n   //    return false;\n   // }\n}\n\nexport default new PortalTutorialManager();\n","import ClassUI from \"./ClassUI.js\";\nimport ClassUIPage from \"./ClassUIPage.js\";\n\nimport PortalWorkInbox from \"./portal_work_inbox.js\";\nimport PortalWorkInboxTaskWindow from \"./portal_work_inbox_taskWindow.js\";\nimport PortalWorkUserProfileWindow from \"./portal_work_user_profile_window.js\";\nimport PortalWorkUserSwitcheroo from \"./portal_work_user_switcheroo.js\";\nimport PortalWorkUserQRWindow from \"./portal_work_user_qr_window.js\";\nimport PortalWorkUserMobileQR from \"./portal_work_user_mobile_qr.js\";\nimport PortalAccessLevelManager from \"./portal_access_level_manager.js\";\nimport TranslationTool from \"./portal_translation_tool.js\";\nimport TutorialManager from \"./portal_tutorial_manager.js\";\n\nclass PortalWork extends ClassUI {\n   constructor() {\n      super();\n   }\n\n   ui() {\n      return {\n         id: \"portal_work\",\n         rows: [\n            {\n               id: \"portal_work_network_warning\",\n               height: 30,\n               css: \"portal_work_warning_banner warning_custom_css\",\n               hidden: true,\n               cols: [\n                  { width: 5 },\n                  {\n                     id: \"portal_work_network_warning_label\",\n                     view: \"label\",\n                     align: \"center\",\n                  },\n                  {\n                     id: \"portal_work_network_warning_button\",\n                     view: \"button\",\n                     align: \"center\",\n                     hidden: true,\n                     width: 100,\n                     css: \"webix_transparent\",\n                  },\n                  { width: 5 },\n               ],\n            },\n            {\n               id: \"portal_work_switcheroo_user_switched\",\n               height: 30,\n               css: \"portal_work_switcheroo_user_switched\",\n               hidden: true,\n               cols: [\n                  {\n                     width: 5,\n                  },\n                  {\n                     id: \"portal_work_switcheroo_user_switched_label\",\n                     view: \"label\",\n                     align: \"center\",\n                  },\n                  {\n                     id: \"portal_work_switcheroo_user_switched_loading\",\n                     view: \"label\",\n                     hidden: true,\n                     align: \"center\",\n                     width: 30,\n                     label: '<i class=\"fa fa-refresh fa-spin\" aria-hidden=\"true\"></i>',\n                  },\n                  {\n                     view: \"button\",\n                     value: '<div style=\"text-align: center; font-size: 12px; color:#FFFFFF\"><i class=\"fa-fw fa fa-times\"></i></div>',\n                     align: \"center\",\n                     width: 30,\n                     css: \"webix_transparent\",\n                     on: {\n                        onAfterRender: function () {\n                           ClassUI.CYPRESS_REF(this, \"switcheroo_clear_button\");\n                        },\n                        onItemClick: async () => {\n                           this.busy();\n                           await PortalWorkUserSwitcheroo.switcherooClear();\n                           this.ready();\n                           $$(\"portal_work_switcheroo_user_switched\").hide();\n                        },\n                     },\n                  },\n                  {\n                     width: 5,\n                  },\n               ],\n            },\n            {\n               view: \"toolbar\",\n               id: \"mainToolbar\",\n               // borderless: true,\n               css: \"webix_dark mainToolbar\",\n               padding: 10,\n               cols: [\n                  {\n                     id: \"portal_work_menu_sidebar\",\n                     view: \"button\",\n                     type: \"icon\",\n                     width: 50,\n                     icon: \"fa fa-bars no-margin\",\n                     click: () => {\n                        let navSideBar = $$(\"navSidebar\");\n                        if (navSideBar.isVisible()) {\n                           navSideBar.hide();\n                        } else {\n                           navSideBar.show();\n                           let sidebarMenu = $$(\"abSidebarMenu\");\n                           if (sidebarMenu.getSelectedId() == \"\") {\n                              sidebarMenu.blockEvent();\n                              const firstID = sidebarMenu.getFirstId();\n                              sidebarMenu.select(firstID);\n                              sidebarMenu.unblockEvent();\n                           }\n                        }\n                     },\n                     on: {\n                        onAfterRender() {\n                           ClassUI.CYPRESS_REF(this);\n                        },\n                     },\n                  },\n                  {\n                     view: \"label\",\n                     autowidth: true,\n                     id: \"portal_work_menu_title\",\n                     label: \"AppBuilder\",\n                     align: \"left\",\n                     on: {\n                        onAfterRender() {\n                           ClassUI.CYPRESS_REF(this);\n                        },\n                     },\n                  },\n                  {},\n                  {\n                     id: \"portal_work_menu_pages\",\n                     css: \"appPages\",\n                     cols: [],\n                     on: {\n                        onAfterRender() {\n                           ClassUI.CYPRESS_REF(this);\n                        },\n                     },\n                  },\n                  {},\n                  {\n                     id: \"inbox_icon\",\n                     view: \"button\",\n                     type: \"icon\",\n                     icon: \"fa fa-envelope no-margin\",\n                     width: 40,\n                     // badge: 12,\n                     click: () => {\n                        PortalWorkInbox.show();\n                     },\n                     on: {\n                        onAfterRender() {\n                           ClassUI.CYPRESS_REF(this);\n                        },\n                     },\n                  },\n                  {\n                     id: \"settings_icon\",\n                     view: \"button\",\n                     type: \"icon\",\n                     icon: \"fa fa-cog fa-lg no-margin\",\n                     width: 40,\n                     hidden: true,\n                     popup: \"settingsMenu\",\n                     /* Look at this.refreshSettingsMenu() for menu options and actions */\n                     on: {\n                        onAfterRender() {\n                           ClassUI.CYPRESS_REF(this);\n                        },\n                     },\n                  },\n                  {\n                     id: \"user_icon\",\n                     view: \"button\",\n                     type: \"icon\",\n                     icon: \"fa fa-user-circle no-margin\",\n                     width: 40,\n                     popup: \"userMenu\",\n                     /* Look at Popup created below for menu options and actions */\n                     on: {\n                        onAfterRender() {\n                           ClassUI.CYPRESS_REF(this);\n                        },\n                     },\n                  },\n               ],\n            },\n            {\n               cols: [\n                  {\n                     id: \"navSidebar\",\n                     hidden: true,\n                     autoheight: true,\n                     borderless: true,\n                     rows: [\n                        {\n                           id: \"abNavSidebarScrollView\",\n                           view: \"scrollview\",\n                           scroll: \"y\",\n                           css: \"darkScrollview\",\n                           body: {\n                              rows: [\n                                 {\n                                    view: \"sidebar\",\n                                    id: \"abSidebarMenu\",\n                                    borderless: true,\n                                    css: \"webix_dark mainSidebar\",\n                                    data: [],\n                                    on: {\n                                       onAfterRender() {\n                                          this.data.each((a) => {\n                                             ClassUI.CYPRESS_REF(\n                                                this.getItemNode(a.id),\n                                                a.id\n                                             );\n                                          });\n                                       },\n                                       onAfterSelect: (/* id */) => {\n                                          // this.selectApplication(id);\n                                       },\n                                       onItemClick: (id) => {\n                                          this.selectApplication(id);\n                                       },\n                                    },\n                                 },\n                              ],\n                           },\n                        },\n                        {\n                           view: \"template\",\n                           borderless: true,\n                           css: \"appDevDesigns\",\n                           height: 110,\n                        },\n                        {\n                           id: \"portal_work_privacy_policy\",\n                           view: \"template\",\n                           template:\n                              '<a href=\"#link#\" target=\"_blank\" class=\"policyMenu\">#label#</a>',\n                           css: \"policyLink\",\n                           height: 30,\n                           hidden: true,\n                        },\n                     ],\n                  },\n                  {\n                     id: \"abWorkPages\",\n                     template: \"No Applications Have Been Loaded.\",\n                  }, // this is where content goes\n               ],\n            },\n         ],\n      };\n   }\n\n   /** @param {import('../AppBuilder/ABFactory.js').default} AB */\n   async init(AB) {\n      this.AB = AB;\n\n      this.storageKey = \"portal_work_state\";\n\n      this.pageContainers = {};\n\n      const L = (...params) => {\n         return this.label(...params);\n      };\n\n      const allInits = [];\n\n      allInits.push(PortalWorkUserProfileWindow.init(this.AB));\n      allInits.push(PortalWorkUserSwitcheroo.init(this.AB));\n\n      // {hash}  { ABViewPage.id : ClassUIPage() }\n      // track each of the page containers (instances of ClassUIPage) that\n      // are responsible for displaying the proper state of each of our\n      // Root Pages.\n\n      // Get all our ABApplications and loaded Plugins in allApplications\n      const allApplications = (\n         this.AB.applications(\n            (a) =>\n               a.isWebApp &&\n               a.isAccessibleForRoles(this.AB.Account.rolesAll() ?? [])\n         ) || []\n      ).concat(this.AB.plugins() || []);\n\n      // Build out our Navigation Side Bar Menu with our available\n      // ABApplications\n      const menu_data = [];\n\n      for (let i = 0; i < allApplications.length; i++) {\n         // TODO: implement Sorting on these before building UI\n         menu_data.push(this.uiSideBarMenuEntry(allApplications[i]));\n      }\n\n      let { privacyPolicy, relay } = this.AB.Config.siteConfig();\n      if (privacyPolicy) {\n         $$(\"portal_work_privacy_policy\").setValues({\n            label: L(\"Privacy Policy\"),\n            link: privacyPolicy,\n         });\n         $$(\"portal_work_privacy_policy\").show();\n      }\n\n      $$(\"abSidebarMenu\").define(\"data\", menu_data);\n      this.sidebarResize();\n\n      PortalWorkUserMobileQR.init(AB);\n\n      const userMenuOptions = [\n         { id: \"user_profile\", label: L(\"User Profile\"), icon: \"user\" },\n         { id: \"user_logout\", label: L(\"Logout\"), icon: \"ban\" },\n      ];\n\n      // add in any Mobile App QR Codes:\n      const allMobile = this.AB.applications((a) => a.isMobile);\n      allMobile.forEach((m) => {\n         userMenuOptions.splice(1, 0, {\n            id: m.id, // \"pwa_app\",\n            label: m.label,\n            icon: m.icon.replace(\"fa-\", \"\"),\n         });\n      });\n\n      if (this.AB.Account.canSwitcheroo()) {\n         userMenuOptions.splice(1, 0, {\n            id: \"user_switcheroo\",\n            label: L(\"Switcheroo\"),\n            icon: \"user-secret\",\n         });\n      }\n\n      if (this.AB.Account.isSwitcherood()) {\n         $$(\"portal_work_switcheroo_user_switched_label\").setValue(\n            `<i class=\"fa-fw fa fa-user-secret\"></i>\n            ${L('You are viewing this site as \"{0}\"', [\n               this.AB.Account.username(),\n            ])}`\n         );\n         $$(\"portal_work_switcheroo_user_switched\").show();\n      }\n      /** @type {Object.<string, NetworkWarning>} */\n      this.networkWarnings = {\n         /**\n          * @typedef {object} NetworkWarning - define the display & behavior of\n          * a Network Warning\n          * @prop {string} label - warning message to display\n          * @prop {number} priority - 1 is the highest prioirity\n          * @prop {Function} [click] - click hanlder function\n          * @prop {string} [button] - label for the button\n          * @prop {string | number} [value] - to replace in button lable\n          * @prop {string} [css] - custom css to add to the warning ui\n          * @prop {Boolean} [active] - is the warning currently active\n          */\n         no_network: {\n            label: `<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n            ${L(\"No network detected. Work will not be saved.\")}`,\n            priority: 1,\n         },\n         no_server: {\n            label: `<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n            ${L(\n               \"Uh oh...we cannot communicate with our servers, please wait before saving data.\"\n            )}`,\n            priority: 2,\n            click: () => this.AB.Network._connectionCheck(),\n            button: `<i class=\"fa fa-refresh\" aria-hidden=\"true\"></i> #value# ${L(\n               \"requests\"\n            )}`,\n            value: 0,\n         },\n         slow: {\n            label: `<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n            ${L(\"Slow Network Detected! This may affect your experience.\")}`,\n            priority: 5,\n            click: () => {\n               this.networkWarningClear(\"slow\");\n               this.networkWarnings.slow.disabled = true;\n            },\n            button: `<i class=\"fa fa-times\" aria-hidden=\"true\"></i> ${L(\n               \"dismiss\"\n            )}`,\n            css: \"background: #c98025\",\n         },\n      };\n\n      if (!navigator.onLine) this.networkWarningDisplay(\"no_network\");\n\n      window.addEventListener(\"offline\", () => {\n         this.networkWarningDisplay(\"no_network\");\n      });\n\n      window.addEventListener(\"online\", () => {\n         this.networkWarningClear(\"no_network\");\n      });\n\n      // document.body.addEventListener(\n      //    \"offline\",\n      //    function () {\n      //       debugger;\n      //       $$(\"portal_work_no_network_detected\").show();\n      //    },\n      //    false\n      // );\n      // document.body.addEventListener(\n      //    \"online\",\n      //    function () {\n      //       debugger;\n      //       $$(\"portal_work_no_network_detected\").hide();\n      //    },\n      //    false\n      // );\n\n      // Only add the QR Code option if the relay service is enabled\n      if (relay) {\n         // Insert at userMenuOptions[2] so logout is still last\n         userMenuOptions.splice(2, 0, {\n            id: \"user_qr\",\n            label: L(\"Connect Mobile App\"),\n            icon: \"qrcode\",\n         });\n      }\n\n      // This is the User popup menu that opens when you click the user icon in the main nav\n      this.AB.Webix.ui({\n         view: \"popup\",\n         id: \"userMenu\",\n         width: 150,\n         body: {\n            view: \"list\",\n            data: userMenuOptions,\n            template: \"<i class='fa-fw fa fa-#icon#'></i> #label#\",\n            autoheight: true,\n            select: true,\n            on: {\n               onItemClick: (id) => {\n                  switch (id) {\n                     case \"user_profile\":\n                        PortalWorkUserProfileWindow.show();\n                        break;\n                     case \"user_switcheroo\":\n                        PortalWorkUserSwitcheroo.show();\n                        break;\n                     case \"user_logout\":\n                        AB.Account.logout();\n                        break;\n                     case \"user_qr\":\n                        PortalWorkUserQRWindow.init(AB);\n                        PortalWorkUserQRWindow.show();\n                        break;\n                     default: {\n                        // was this one of our Mobile Apps?\n                        const mobileApp = this.AB.applicationByID(id);\n                        if (mobileApp) {\n                           PortalWorkUserMobileQR.load(mobileApp);\n                           PortalWorkUserMobileQR.show();\n                        } else {\n                           const item = userMenuOptions.filter(\n                              (o) => o.id == id\n                           )[0];\n                           this.AB.Webix.message(\n                              `<b>Not yet implemented</b><br/>\n                           Menu item:<i>${item.label}</i><br/>\n                           Menu ID:<i>${item.id}</i>`\n                           );\n                        }\n                     }\n                  }\n                  $$(\"userMenu\").hide();\n               },\n\n               onAfterRender() {\n                  this.data.each((a) => {\n                     ClassUI.CYPRESS_REF(this.getItemNode(a.id), a.id);\n                  });\n               },\n            },\n         },\n      });\n\n      // Now Fill out Toolbar and Root Pages:\n      //\n      // Step 1: prepare the AppState so we can determine which options\n      // should be pre selected.\n      //\n      const AppState = (await this.AB.Storage.get(this.storageKey)) ?? {\n         lastSelectedApp: null,\n         // {string}  the ABApplication.id of the last App selected\n\n         lastPages: {},\n         // {hash}  { ABApplication.id : ABPage.id }\n         // a lookup of all the last selected Pages for each Application\n      };\n\n      this.AppState = AppState;\n\n      // set default selected App if not already set\n      // just choose the 1st App in the list (must have pages that we have\n      // access to)\n      if (!this.AppState.lastSelectedApp && menu_data.length)\n         for (let i = 0; i < menu_data.length; i++)\n            if (\n               (\n                  menu_data[i].abApplication\n                     .pages()\n                     .filter((p) => p.getUserAccess?.() > 0) || []\n               ).length > 0\n            ) {\n               this.AppState.lastSelectedApp = menu_data[i].abApplication.id;\n\n               break;\n            }\n\n      //\n      // Step 2: figure out the Default Page to be displayed.\n      //\n      let DefaultPage = null;\n      // {ABViewPage}\n      // The ABViewPage of the 1st page to display.\n\n      // sidebar and NavBar are already built at this point. So we can\n      // query them.\n      const $sideBar = $$(\"abSidebarMenu\");\n\n      if ($sideBar) {\n         // search the Menu entries to see which one matches our\n         // stored AppState\n         let foundMenuEntry = this.sidebarMenuEntryByID(\n            this.AppState.lastSelectedApp\n         );\n\n         if (!foundMenuEntry) {\n            // if we couldn't find the entry then our .lastSelectedApp\n            // must be referencing an Application we no longer have\n            // access to.\n            // So just pick the 1st app with pages\n            for (let i = 0; i < menu_data.length; i++) {\n               if ((menu_data[i].abApplication.pages() || []).length > 0) {\n                  foundMenuEntry =\n                     this.sidebarMenuEntryByID(menu_data[i].abApplication.id) ||\n                     null;\n\n                  if (foundMenuEntry) break;\n               }\n            }\n         }\n\n         if (foundMenuEntry) {\n            $sideBar.select(foundMenuEntry.id);\n            this.selectApplication(foundMenuEntry.id);\n\n            const defaultPageID =\n               this.AppState.lastPages[foundMenuEntry.abApplication.id];\n\n            DefaultPage = foundMenuEntry.abApplication.pages(\n               (p) => p.id === defaultPageID\n            )[0];\n\n            if (!DefaultPage) {\n               // then just pick the first one:\n               DefaultPage = foundMenuEntry.abApplication.pages()[0];\n            }\n         }\n      }\n\n      //\n      // Step 3: Prime the content area with placeholders for ALL\n      // Root Pages\n      //\n      const allPlaceholders = [];\n\n      for (let i = 0; i < allApplications.length; i++) {\n         const pages = allApplications[i].pages() || [];\n\n         for (let j = 0; j < pages.length; j++) {\n            if (pages[j].getUserAccess?.() === 0) continue;\n\n            allPlaceholders.push({\n               id: this.pageID(pages[j]),\n               template: `Page: ${pages[j].label || pages[j].name}`,\n            });\n         }\n      }\n\n      if (allPlaceholders.length > 0)\n         this.AB.Webix.ui(\n            {\n               view: \"multiview\",\n               keepViews: true,\n               animate: false,\n               cells: allPlaceholders,\n            },\n            $$(\"abWorkPages\")\n         );\n\n      //\n      // Step 4: initialize the DefaultPage\n      // when it is finished we can show that page and emit \"ready\" to\n      // signal we can transition to the Work Portal\n      //\n      if (!this.App) {\n         // page.component() require a common {ABComponent.App}\n         this.App = new this.AB.Class.ABComponent(\n            null,\n            \"portal_work\",\n            this.AB\n         ).App;\n      }\n\n      if (DefaultPage) {\n         const container = new ClassUIPage(\n            this.pageID(DefaultPage),\n            DefaultPage,\n            this.App,\n            this.AB\n         );\n         const containerInit = async () => {\n            await container.init(this.AB, true);\n            this.showPage(DefaultPage);\n         };\n\n         this.pageContainers[DefaultPage.id] = container;\n         allInits.push(containerInit());\n      }\n      // let pUI = DefaultPage.component(this.App);\n\n      // webix.ui(pUI.ui, $$(this.pageID(DefaultPage)));\n      // pUI.init();\n      // pUI.onShow();\n      // this.showPage(DefaultPage);\n\n      //\n      // Step 5: initialize the remaining Pages\n      //\n      for (let i = 0; i < allApplications.length; i++) {\n         const pages = allApplications[i].pages() || [];\n\n         for (let j = 0; j < pages.length; j++) {\n            if (pages[j].getUserAccess?.() === 0) continue;\n\n            if (!DefaultPage || pages[j].id !== DefaultPage.id) {\n               const cont = new ClassUIPage(\n                  this.pageID(pages[j]),\n                  pages[j],\n                  this.App,\n                  this.AB\n               );\n\n               this.pageContainers[pages[j].id] = cont;\n\n               allInits.push(cont.init(this.AB));\n\n               // let comp = page.component(commonComp.App);\n               // webix.ui(comp.ui, $$(this.pageID(page)));\n               // comp.init();\n               // comp.onShow();\n            }\n         }\n      }\n\n      this.refreshSettingsMenu();\n      //\n      // Step 6: Initialize the Inbox Items\n      //\n      PortalWorkInbox.on(\"updated\", () => {\n         const count = PortalWorkInbox.count();\n         $$(\"inbox_icon\").define({ badge: count ? count : false });\n         $$(\"inbox_icon\").refresh();\n      });\n\n      await PortalWorkInbox.init(this.AB);\n\n      //\n      // Step 7: As well as the Inbox Task Window\n      //\n      allInits.push(PortalWorkInboxTaskWindow.init(this.AB));\n\n      // Network and Queued operations Alert\n      this.AB.Network.on(\"queued\", () => {\n         const count = this.AB.Network.queueCount();\n         if (count > 0) {\n            this.networkWarningDisplay(\"no_server\", count);\n         } else {\n            this.networkWarningClear(\"no_server\");\n         }\n      });\n      this.AB.Network.on(\"queue.synced\", () => {\n         this.networkWarningDisplay(\"no_server\", 0);\n         this.networkWarningClear(\"no_server\");\n      });\n\n      if (this.AB.Network.isNetworkSlow()) this.networkWarningDisplay(\"slow\");\n      this.AB.Network.on(\"networkslow\", (isSlow) => {\n         isSlow\n            ? this.networkWarningDisplay(\"slow\")\n            : this.networkWarningClear(\"slow\");\n      });\n\n      this.emit(\"ready\");\n\n      // !!! HACK: Leave this for James to figure out why Menu Title isn't proper\n      // size on initial loading.\n      setTimeout(() => {\n         $$(\"portal_work_menu_title\").resize();\n      }, 200);\n\n      // Now attempt to flush any pending network operations:\n      this.AB.Network._connectionCheck();\n\n      // Be sure our UI elements that don't respond to onAfterRender()\n      // have their cypress references set:\n      [\"portal_work_menu_pages\"].forEach((eid) => {\n         ClassUI.CYPRESS_REF($$(eid));\n      });\n\n      await Promise.all(allInits);\n   }\n\n   /**\n    * Display a network warning banner. Will not update if a higher priority\n    * warning is already active, but will save the state in case the active\n    * warning is cleared before this one. Can be called without a key to\n    * update/clear exisiting warnings.\n    * @param {string?} key\n    */\n   networkWarningDisplay(key, value) {\n      if (key) this.networkWarnings[key].active = true;\n      if (key && value) this.networkWarnings[key].value = value;\n\n      // get the highest priority active warning\n      let warning;\n      for (const k in this.networkWarnings) {\n         const entry = this.networkWarnings[k];\n         if (!entry.active || entry.disabled) continue;\n         if (!warning || warning.priority > entry.priority) {\n            warning = entry;\n         }\n      }\n      if (!warning) {\n         // No active warnings so hide the banner\n         $$(\"portal_work_network_warning\").hide();\n         return;\n      }\n      $$(\"portal_work_network_warning_label\").setValue(warning.label);\n      const button = $$(\"portal_work_network_warning_button\");\n      if (warning.click) {\n         button.define(\"click\", warning.click);\n         const buttonText = (warning.button ?? \"\").replaceAll(\n            \"#value#\",\n            warning.value\n         );\n         button.define(\"label\", buttonText);\n         button.refresh();\n         button.show();\n      } else {\n         button.hide();\n      }\n      warning.css\n         ? this.AB.Webix.html.addStyle(\n              `.warning_custom_css{${warning.css}}`,\n              \"warning_custom_css\"\n           )\n         : this.AB.Webix.html.removeStyle(\"warning_custom_css\");\n      $$(\"portal_work_network_warning\").show();\n   }\n   /**\n    * Clear a network warning\n    * @param {string} key\n    */\n   networkWarningClear(key) {\n      this.networkWarnings[key].active = false;\n      // Call this.networkWarningDisplay() again in case another warning is still active\n      this.networkWarningDisplay();\n   }\n\n   /**\n    * pageID()\n    * return a commone webix.id for a given ABViewPage\n    * @param {ABViewPage || string} page\n    *       An instance of ABViewPage, OR a string of the ABViewPage.id\n    * @return {string}\n    */\n   pageID(page) {\n      return `page_${page.id || page}`;\n   }\n\n   selectApplication(id) {\n      const row = $$(\"abSidebarMenu\").getItem(id);\n\n      const pageButtons = [];\n      // {array}\n      // the webix menu buttons for each Page\n\n      let firstPage = true;\n      // {bool} firstPage\n      // should we choose the 1st page as being the active page?\n\n      let activePageID = null;\n      // {string}\n      // The ABViewPage.id of the active Page for the current Application.\n      if (this.AppState.lastSelectedApp != row.abApplication.id) {\n         // remember the current Application has been selected\n         this.AppState.lastSelectedApp = row.abApplication.id;\n         this.saveState();\n         // Need to Settings Menu if different for each app\n         this.refreshSettingsMenu();\n      }\n\n      // if the current Application already has an Active State Page marked\n      // we don't want the first page:\n      activePageID = this.AppState.lastPages[row.abApplication.id];\n      if (activePageID) {\n         firstPage = false;\n      }\n\n      // Build a Menu Button for each of the ABApplication Root Pages\n      (row.abApplication.pages() || []).forEach((p) => {\n         if (p.getUserAccess?.() == 0) return;\n         // Decide if current Page button should look selected.\n         let active = \"\";\n         if (firstPage || p.id == activePageID) {\n            active = \"activePage\";\n            firstPage = false;\n\n            // remember this one\n            this.AppState.lastPages[row.abApplication.id] = p.id;\n         }\n\n         let pbLabel = p.label;\n         if (\"function\" === typeof p.label) {\n            pbLabel = p.label();\n         }\n         pageButtons.push({\n            view: \"button\",\n            css: active,\n            type: \"icon\",\n            label: pbLabel,\n            autowidth: true,\n            icon: `fa fa-${p.icon}`,\n            abPage: p,\n            click: (item) => {\n               // when button is clicked, update the selected look\n               const pageButton = $$(item);\n\n               // Remove any other \"activePage\" entries\n               $$(\"portal_work_menu_pages\")\n                  .queryView(\n                     {\n                        css: \"activePage\",\n                     },\n                     \"all\"\n                  )\n                  .forEach((p) => {\n                     if (p != pageButton) {\n                        p.define(\"css\", \"\");\n                        p.$view.classList.remove(\"activePage\");\n                     }\n                  });\n\n               // make sure this one is marked\n               pageButton.define(\"css\", \"activePage\");\n               pageButton.$view.classList.add(\"activePage\");\n\n               // now trigger the page to display:\n               this.showPage(pageButton.data.abPage);\n            },\n            on: {\n               onAfterRender() {\n                  ClassUI.CYPRESS_REF(this, p.id);\n               },\n            },\n         });\n      });\n      webix.ui(pageButtons, $$(\"portal_work_menu_pages\"));\n\n      $$(\"portal_work_menu_title\").setValue(row.value);\n      $$(\"portal_work_menu_title\").resize();\n\n      // now everything is displayed\n      // default initial display to current activePage:\n      let selectedPage = null;\n      $$(\"portal_work_menu_pages\")\n         .queryView(\n            {\n               css: \"activePage\",\n            },\n            \"all\"\n         )\n         .forEach((p) => {\n            selectedPage = p;\n         });\n      this.showPage(selectedPage?.data?.abPage);\n\n      // hide the sidebar menu\n      const sideBar = $$(\"navSidebar\");\n      if (sideBar.isVisible()) {\n         sideBar.hide();\n      }\n   }\n\n   /**\n    * saveState()\n    * trigger a save of our current AppState.\n    * NOTE: we delay this so we can catch multiple saves in a short period\n    * of time.\n    */\n   saveState() {\n      if (this._saveTimeoutID) {\n         clearTimeout(this._saveTimeoutID);\n      }\n      this._saveTimeoutID = setTimeout(() => {\n         this.AB.Storage.set(this.storageKey, this.AppState);\n      }, 500);\n   }\n\n   show() {\n      $$(\"portal_work\").show();\n   }\n\n   showPage(page) {\n      // this could be a subpage\n      const pageUI = this.pageContainers[page?.id];\n\n      if (pageUI) {\n         pageUI.show();\n         this.AppState.lastPages[page.application.id] = page.id;\n         this.saveState();\n      }\n   }\n\n   /**\n    * @method sidebarMenuEntryByID()\n    * returns the sidebar menu entry that matches the given {menuID}\n    * @param {string|uuid} menuID\n    * @return {obj}\n    */\n   sidebarMenuEntryByID(menuID) {\n      const $sideBar = $$(\"abSidebarMenu\");\n\n      let foundMenuEntry = null;\n\n      if ($sideBar) {\n         // search the Menu entries to see which one matches our\n         // stored AppState\n\n         let id = $sideBar.getFirstId();\n         while (!foundMenuEntry && id) {\n            let entry = $sideBar.getItem(id);\n            if (entry.abApplication.id == menuID) {\n               foundMenuEntry = entry;\n            }\n            id = $sideBar.getNextId(id);\n         }\n      }\n\n      return foundMenuEntry;\n   }\n\n   sidebarResize() {\n      const sidebarMenu = $$(\"abSidebarMenu\");\n      const sideBarHeight = sidebarMenu.count() * 45 + 1;\n\n      sidebarMenu.define(\"height\", sideBarHeight);\n      sidebarMenu.resize();\n      // $$(\"abNavSidebarScrollView\").resize(true);\n   }\n\n   /**\n    * generate the Webix definition for a menu entry given the ABApplication\n    * the menu entry should represent.\n    * @param {ABApplication} app\n    * @return {obj} Webix.ui definition.\n    */\n   uiSideBarMenuEntry(app) {\n      return {\n         id: app.id,\n         icon: `fa ${app.icon}`,\n         value: app.label || app.name,\n         abApplication: app,\n         // This is never called:\n         // on: {\n         //    onAfterRender() {\n         //       debugger;\n         //       ClassUI.CYPRESS_REF(this, app.id);\n         //    },\n         // },\n      };\n   }\n\n   refreshSettingsMenu() {\n      const { uuid, roles } = this.AB.Config.userConfig();\n      const application = this.AB.applicationByID(\n         this.AppState.lastSelectedApp\n      );\n      const settingsMenuOptions = [];\n\n      if (!application) return $$(\"settings_icon\").hide();\n      if (application.isAccessManaged) {\n         let isManager = false;\n         if (\n            application.accessManagers.useAccount == \"1\" &&\n            application.accessManagers.account.indexOf(uuid) > -1\n         ) {\n            isManager = true;\n         }\n         if (!isManager && application.accessManagers.useRole == \"1\") {\n            roles.forEach((role) => {\n               if (application.accessManagers.role.indexOf(role.uuid) > -1) {\n                  isManager = true;\n               }\n            });\n         }\n         if (isManager) {\n            settingsMenuOptions.push({\n               id: \"accessLevel\",\n               label: this.label(\"Access Manager\"),\n               icon: \"lock\",\n            });\n         }\n      }\n      if (application.isTranslationManaged) {\n         let isManager = false;\n         if (\n            application.translationManagers.useAccount == \"1\" &&\n            application.translationManagers.account.indexOf(uuid) > -1\n         ) {\n            isManager = true;\n         }\n         if (!isManager && application.translationManagers.useRole == \"1\") {\n            roles.forEach((role) => {\n               if (\n                  application.translationManagers.role.indexOf(role.uuid) > -1\n               ) {\n                  isManager = true;\n               }\n            });\n         }\n         if (isManager) {\n            settingsMenuOptions.push({\n               id: \"translation\",\n               label: this.label(\"Translation Tool\"),\n               icon: \"language\",\n            });\n         }\n      }\n      if (application.isTutorialManaged) {\n         let isManager = false;\n         if (\n            application.tutorialManagers.useAccount == \"1\" &&\n            application.tutorialManagers.account.indexOf(uuid) > -1\n         ) {\n            isManager = true;\n         }\n         if (!isManager && application.tutorialManagers.useRole == \"1\") {\n            roles.forEach((role) => {\n               if (application.tutorialManagers.role.indexOf(role.uuid) > -1) {\n                  isManager = true;\n               }\n            });\n         }\n         if (isManager) {\n            settingsMenuOptions.push({\n               id: \"tutorial\",\n               label: this.label(\"Tutorial Manager\"),\n               icon: \"info-circle\",\n            });\n         }\n      }\n\n      if (settingsMenuOptions.length < 1) return $$(\"settings_icon\").hide();\n\n      $$(\"settings_icon\").show();\n\n      webix.ui({\n         view: \"popup\",\n         id: \"settingsMenu\",\n         width: 150,\n         body: {\n            view: \"list\",\n            data: settingsMenuOptions,\n            template: \"<i class='fa-fw fa fa-#icon#'></i> #label#\",\n            autoheight: true,\n            select: true,\n            on: {\n               onItemClick: (id /*, event */) => {\n                  switch (id) {\n                     case \"accessLevel\":\n                        PortalAccessLevelManager.init(this);\n                        PortalAccessLevelManager.show();\n                        break;\n                     case \"translation\":\n                        TranslationTool.init(this);\n                        TranslationTool.show();\n                        break;\n                     case \"tutorial\":\n                        TutorialManager.init(this);\n                        TutorialManager.show();\n                        break;\n                     default:\n                        //eslint-disable-next-line\n                        const item = settingsMenuOptions.filter(\n                           (o) => o.id == id\n                        )[0];\n                        webix.message(\n                           `<b>Not yet implemented</b><br/>\n                           Menu item:<i>${item.label}</i><br/>\n                           Menu ID:<i>${item.id}</i>`\n                        );\n                  }\n                  $$(\"settingsMenu\").hide();\n               },\n\n               onAfterRender() {\n                  this.data.each((a) => {\n                     ClassUI.CYPRESS_REF(this.getItemNode(a.id), a.id);\n                  });\n               },\n            },\n         },\n      });\n   }\n\n   busy() {\n      $$(\"portal_work_switcheroo_user_switched_loading\")?.show();\n   }\n\n   ready() {\n      $$(\"portal_work_switcheroo_user_switched_loading\")?.hide();\n   }\n}\n\nexport default new PortalWork();\n","import ClassUI from \"./ClassUI.js\";\nimport PortalLoading from \"./portal_loading.js\";\nimport PortalAuth from \"./portal_auth.js\";\nimport PortalWork from \"./portal_work.js\";\n\nclass Portal extends ClassUI {\n   constructor() {\n      super();\n\n      this.ShownPortal = null;\n      // {UI.Portal} ShownPortal\n      // Keep track of which Portal is currently shown.\n\n      this.portalWorkReady = false;\n      // {bool}\n      // has the PortalWork UI emitted it's \"ready\" event?\n      //\n   }\n\n   ui() {\n      return {\n         view: \"popup\",\n         fullscreen: true,\n         modal: true,\n         body: {\n            id: \"portal\",\n            view: \"multiview\",\n            keepViews: true,\n            animate: false,\n            rows: [PortalLoading.ui(), PortalAuth.ui(), PortalWork.ui()],\n         },\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n\n      this.AB.on(\"portal.show\", (key) => {\n         this.showPortal(key);\n      });\n\n      var allInits = [];\n      // {array} allInits\n      // all the .init() {Promise}s that are being generated during our\n      // init().\n\n      allInits.push(PortalAuth.init(AB));\n\n      // if we are authenticated, then we make sure our loading & work portals\n      // are prepared.\n      if (this.AB.Account.isAuthenticated) {\n         // Setup our listeners BEFORE the .init()s\n         this.AB.Account.on(\"logout\", (data) => {\n            if (data?.redirect) {\n               // if we pass a redirect link follow it\n               window.document.location.href = data?.redirect;\n            } else {\n               // on logout show Auth Portal\n               this.showAuthPortal();\n            }\n         });\n\n         this.AB.Network.on(\"reauth\", () => {\n            // on logout show Auth Portal\n            this.showAuthPortal();\n         });\n\n         PortalWork.on(\"ready\", () => {\n            this.portalWorkReady = true;\n            this.showDefaultView();\n         });\n\n         // Now trigger our other .init()s\n         allInits.push(PortalLoading.init(AB));\n         allInits.push(PortalWork.init(AB));\n      }\n\n      return Promise.all(allInits).then(() => {\n         this.showDefaultView();\n      });\n   }\n\n   showAuthPortal(defaultView) {\n      if (this.ShownPortal != PortalAuth) {\n         PortalAuth.show(defaultView);\n         this.ShownPortal = PortalAuth;\n      }\n   }\n\n   showWorkPortal() {\n      if (this.portalWorkReady) {\n         if (this.ShownPortal != PortalWork) {\n            // when loading portal is done move to Work Portal\n            PortalWork.show();\n            this.ShownPortal = PortalWork;\n         }\n      } else {\n         if (!this.ShownPortal) {\n            // if we haven't already shown a portal ... show the loading\n            PortalLoading.show();\n         }\n      }\n   }\n\n   showDefaultView() {\n      // At this point, all inits() are complete\n\n      // if authenticated then show our default view:\n      if (this.AB.Account.isAuthenticated) {\n         // do we have a specified defaultView?\n         let defaultView = this.AB.Config.setting(\"view\");\n         if (defaultView) {\n            // defaultView should be in form:\n            //    \"auth_login_form\",\n            //    \"auth_login_passwordReset\",\n            //    \"work\"\n            var parts = defaultView.split(\"_\");\n            this.showPortal(parts[0], defaultView);\n         } else {\n            // then default to our work view:\n            if (this.portalWorkReady) {\n               this.showWorkPortal();\n            } else {\n               if (!this.ShownPortal) {\n                  // if we haven't already shown a portal ... show the loading\n                  PortalLoading.show();\n               }\n            }\n         }\n      } else {\n         this.showAuthPortal();\n      }\n   }\n\n   showPortal(key, defaultView) {\n      switch (key) {\n         case \"auth\":\n            this.showAuthPortal(defaultView);\n            break;\n\n         case \"work\":\n            this.showWorkPortal();\n            break;\n      }\n   }\n}\n\nexport default new Portal();\n","import ClassUI from \"./ClassUI.js\";\nimport Portal from \"./portal.js\";\n\nclass UI extends ClassUI {\n   constructor() {\n      super();\n\n      this.hiddenElements = [];\n   }\n\n   ui() {\n      return {\n         id: \"labelClickToEnter\",\n         view: \"label\",\n         label: \"Hello\",\n         on: {\n            onItemClick: (/* id, e */) => {\n               this.portalShow();\n            },\n         },\n      };\n   }\n\n   init(AB) {\n      this.AB = AB;\n      var entryLabel = this.AB.Tenant.textClickToEnter;\n      if (entryLabel) {\n         $$(\"labelClickToEnter\").define({\n            label: entryLabel,\n         });\n      }\n\n      // by not sending an id param, this creates it's own div.\n      this.popup = Portal.attach();\n\n      // AB.on(\"error\", (error) => {\n      //    console.error(\"ui.on(error): \", error);\n      // });\n\n      return Portal.init(AB).then(() => {\n         if (this.AB.Config.setting(\"autoenter\")) {\n            this.portalShow();\n         } else {\n            this.portalHide();\n         }\n      });\n   }\n\n   portalHide() {\n      // show our link to enter\n      this.popup.hide();\n   }\n\n   portalShow() {\n      // show our portal\n      this.popup.show();\n   }\n}\n\nexport default new UI();\n","import ClassUI from \"./ClassUI.js\";\n\nimport Switcheroo from \"./portal_work_user_switcheroo.js\";\n\nclass ErrorNoDefsUI extends ClassUI {\n   ui() {\n      const L = (...params) => {\n         return this.label(...params);\n      };\n      return {\n         rows: [\n            {\n               id: \"switched\",\n               height: 23,\n               css: \"portal_work_switcheroo_user_switched\",\n               hidden: true,\n               cols: [\n                  {\n                     width: 5,\n                  },\n                  {\n                     id: \"switched_label\",\n                     view: \"label\",\n                     align: \"center\",\n                  },\n                  {\n                     view: \"button\",\n                     value: '<div style=\"text-align: center; font-size: 12px; color:#FFFFFF\"><i class=\"fa-fw fa fa-times\"></i></div>',\n                     align: \"center\",\n                     width: 30,\n                     css: \"webix_transparent\",\n                     on: {\n                        onItemClick: () => {\n                           Switcheroo.init(this.AB, true);\n                           Switcheroo.switcherooClear();\n                           $$(\"switched\").hide();\n                        },\n                     },\n                  },\n                  {\n                     width: 5,\n                  },\n               ],\n            },\n            {\n               id: \"error_no_defs\",\n               css: \"portalLogin\",\n               cols: [\n                  {},\n                  {\n                     rows: [\n                        {},\n                        {\n                           width: 360,\n                           height: 200,\n                           rows: [\n                              {\n                                 css: \"portalLoginForm\",\n                                 padding: 30,\n                                 rows: [\n                                    {\n                                       id: \"error_no_defs_text\",\n                                       template: `<div style='text-align: center; font-size:14px;'>\n                                       ${L(\n                                          \"You don't have any Roles in the system defined.  Talk to an Administrator.\"\n                                       )}\n                                    </div>`,\n                                       borderless: true,\n                                    },\n                                 ],\n                              },\n                           ],\n                        },\n                        {},\n                     ],\n                  },\n                  {},\n               ],\n            },\n         ],\n      };\n   }\n\n   async init(AB) {\n      this.AB = AB;\n   }\n\n   switcherooUser(user) {\n      const L = (...params) => {\n         return this.label(...params);\n      };\n      $$(\"switched\").show();\n      $$(\"switched_label\").setValue(\n         L('*You are viewing this site as \"{0}\"*', [this.AB.Account.username()])\n      );\n   }\n\n   preloadMessage(text) {\n      $$(\"error_no_defs_text\").setValues({ text });\n   }\n   destroy() {\n      $$(\"error_no_defs\").destructor();\n   }\n}\n\nexport default new ErrorNoDefsUI();\n","/*\n * Bootstrap.js\n * This file drives the setup and preparation of the Web Platform.\n * It's main job is to prepare all the local Resources for operation as\n * well the main ABFactory object that will drive the rest of the applications.\n */\n\nimport events from \"events\";\n\nconst EventEmitter = events.EventEmitter;\n\nimport Config from \"../config/Config.js\";\n\nimport initConfig from \"../init/initConfig.js\";\nimport \"../init/initConnectListerner.js\";\nimport initDiv from \"../init/initDiv.js\";\nimport initUser from \"../init/initUser.js\";\n// import initResources from \"../init/initResources.js\";\n\n// import JSZipUtils from \"jszip-utils/dist/jszip-utils.min.js\";\n\n// import Selectivity from \"../js/selectivity/selectivity.min.js\";\n// import selectivityCSS from \"../js/selectivity/selectivity.min.css\";\n\nimport UI from \"../ui/ui.js\";\nimport ErrorNoDefsUI from \"../ui/error_noDefs.js\";\n\nimport performance from \"../utils/performance.js\";\n\nclass Bootstrap extends EventEmitter {\n   constructor() {\n      super();\n      this.setMaxListeners(0);\n\n      // Common Reference to Configuration Values\n      this.Config = Config;\n\n      //\n      // UI Related\n      //\n\n      this._div = null;\n      // {el} _div\n      // the HTML element that is the where our initial [click] here button\n      // should be displayed.  Our actual portal is a popup, but the base\n      // <div> can be used for an embedded view.\n\n      this._plugins = [];\n      // {array} ._plugins\n      // an array of the loaded plugins we need to register.\n\n      this._ui = null;\n      // {obj} ._ui\n      // the Webix Object that is our UI display\n\n      this.on(\"error\", (err) => {\n         performance.error(err);\n      });\n   }\n\n   /**\n    * @param {Promise} webixLoading - so we know when webix is finished loading\n    */\n   async init(webixLoading) {\n      const loadABFactory = import(\n         /* webpackChunkName: \"AB\" */\n         /* webpackPrefetch: true */\n         \"../AppBuilder/ABFactory\"\n      );\n      // @const {Promise} loadABFactory Defer loading the ABFactory for a smaller\n      // inital file size, allowing us to show the loading UI sooner.\n      /**\n       * @type {Function} preloadMessage\n       * @description show a loading message\n       * @param {string} message to display on the loading screen\n       */\n      const preloadMessage = (m) =>\n         (document.getElementById(\"preload-text\").innerHTML = m);\n      /**\n       * @type {Function}\n       * @description remove the preload ui elements\n       */\n      const destroyPreloadUI = () =>\n         document.getElementById(\"preloader\").remove();\n\n      const networkTestWorker = new Worker(\n         new URL(\"../utils/networkTest.js\", import.meta.url)\n      );\n      let networkIsSlow = false;\n      networkTestWorker.onmessage = ({ data }) => {\n         if (networkIsSlow !== data) {\n            networkIsSlow = data;\n            const $uiWarning = document.getElementById(\n               \"preload_network_warning\"\n            );\n            $uiWarning.hidden = !networkIsSlow;\n            // Tell sentry our network speed changed\n            performance.setContext(\"breadcrumb\", {\n               category: \"network\",\n               message: networkIsSlow\n                  ? \"Slow network detected\"\n                  : \"Network speed restored\",\n               level: \"info\",\n            });\n         }\n      };\n\n      preloadMessage(\"Waiting for the API Server\");\n\n      performance.mark(\"bootstrap\", { op: \"function\" });\n      // on the web platform, we need to gather the appropriate configuration\n      // information before we can show the UI\n      // 1) Find or create the DIV element our UI is to attach to\n      //    this DIV element can contain settings pertainent to our setup\n      performance.mark(\"initDiv\", { op: \"ui.render\" });\n      await initDiv.init(this);\n      performance.measure(\"initDiv\");\n\n      // 2) Request the User's Configuration Information from the server.\n      performance.mark(\"initConfig\", { op: \"function\" });\n      preloadMessage(\"Getting Configuration Settings\");\n      await initConfig.init(this);\n      performance.measure(\"initConfig\");\n\n      await initUser.init(this);\n      const userInfo = Config.userConfig();\n\n      if (userInfo) {\n         // load definitions for current user\n         performance.setContext(\"user\", {\n            id: userInfo.id,\n         });\n      } else {\n         let { options: tenantConfig } = Config.tenantConfig();\n         tenantConfig =\n            typeof tenantConfig === \"string\"\n               ? JSON.parse(tenantConfig)\n               : tenantConfig;\n         // If no user and tenant isn't using local auth start\n         // the external auth workflow:\n         if (tenantConfig.authType !== \"login\") {\n            window.location.assign(\"/auth/login\");\n            return;\n         }\n         // Keep going if the tenant is using local auth\n      }\n      // 2.5) Load any plugins\n      performance.mark(\"loadPlugins\", { op: \"function\" });\n\n      // Plugins are now loaded via the Preloader and stored in\n      (window.__AB_Plugins || []).forEach((p) => {\n         this.addPlugin(p);\n      });\n      performance.measure(\"loadPlugins\");\n\n      // 3) Now we have enough info, to create an instance of our\n      //    {ABFactory} that drives the rest of the AppBuilder objects\n      performance.mark(\"createABFactory\", { op: \"function\" });\n      preloadMessage(\"Starting AppBuilder\");\n\n      const { default: ABFactory } = await loadABFactory;\n      let definitions = Config.definitions() || null;\n\n      if (definitions) {\n         // NOTE: when loading up an unauthorized user,\n         // definitions will be null: we can skip the plugins\n         // Q: is it possible to load a plugin when unauthorized?\n         this._plugins.forEach((p) => {\n            definitions = definitions.concat(p.definitions());\n         });\n      }\n      this.AB = new ABFactory(definitions);\n\n      if (!window.AB) window.AB = this.AB;\n      // Make our Factory Global.\n      // NOTE: our tests are expecting to access our ABFactory this way.\n\n      this.AB.Network.registerNetworkTestWorker(\n         networkTestWorker,\n         networkIsSlow\n      );\n      await this.AB.init();\n      await webixLoading;\n      // NOTE: special case: User has no Roles defined.\n      // direct them to our special ErrorNoDefsUI\n      if (userInfo && userInfo.roles.length == 0) {\n         performance.measure(\"createABFactory\");\n         ErrorNoDefsUI.init(this.AB);\n         ErrorNoDefsUI.attach();\n         ErrorNoDefsUI.show();\n         if (Config.userReal()) {\n            ErrorNoDefsUI.switcherooUser(Config.userConfig());\n         }\n         destroyPreloadUI();\n         this.ui(ErrorNoDefsUI);\n\n         let err = new Error(\"No Definitions\");\n         err.code = \"ENODEFS\";\n         throw err;\n      }\n\n      // 3.5  prepare the plugins\n      this._plugins.forEach((p) => {\n         p.apply(this.AB);\n         const labels = p.labels(this.AB.Multilingual.currentLanguage());\n         this.AB.Multilingual.pluginLoadLabels(p.key, labels);\n      });\n      performance.measure(\"createABFactory\");\n\n      // 4) Now we can create the UI and send it the {ABFactory}\n      performance.mark(\"initUI\", { op: \"ui.render\" });\n      // webix recommends wrapping any webix code in the .ready()\n      // function that executes after page loading.\n      webix.ready(() => {\n         const locales = {\n            en: \"en-US\",\n            \"zh-hans\": \"zh-CN\",\n            th: \"th-TH\",\n         };\n         // locales - map ab languageCode to webix locale\n         const { languageCode } = AB.Config.userConfig() ?? {};\n         // save the webix locale used to set locale in ClassUIPage.renderPage()\n         window.webixLocale =\n            Object.prototype.hasOwnProperty.call(locales, languageCode) &&\n            Object.prototype.hasOwnProperty.call(\n               webix.i18n.locales,\n               locales[languageCode]\n            )\n               ? locales[languageCode]\n               : false;\n\n         // webix pro offers a feature that hides scroll bars by\n         // default for browsers that include them due to the user's\n         // UI. The experience becomes more like a touch interface\n         // with the exception that scroll bars appear when user\n         // hovers over a scrollable area\n         /* if (!Webix.env.touch  && Webix.env.scrollSize ) */\n         webix.CustomScroll.init();\n\n         const div = this.div();\n\n         UI.attach(div.id);\n         destroyPreloadUI();\n         this.ui(UI);\n         this.ui()\n            .init(this.AB)\n            .then(() => {\n               performance.measure(\"initUI\");\n               performance.measure(\"bootstrap\");\n            });\n         // this.ui().init() routine handles the remaining\n         // bootup/display process.\n      });\n   }\n\n   addPlugin(plugin) {\n      this._plugins.push(plugin);\n   }\n\n   alert(options) {\n      webix.alert(options);\n   }\n\n   div(el) {\n      if (el) {\n         this._div = el;\n         return;\n      }\n      return this._div;\n   }\n\n   error(...params) {\n      console.error(...params);\n      let message = params[0];\n      this.emit(message);\n   }\n\n   ui(UI) {\n      if (UI) {\n         this._ui = UI;\n         return;\n      }\n      return this._ui;\n   }\n}\n\nexport default new Bootstrap();\n","/*\n * initDiv.js\n * find or create an initial <div> for our Appbuilder portal\n */\nexport default {\n   init: (BS) => {\n      // BS {Bootstrap}\n      // The initial Bootstrap object found in \"./Bootstrap.js\"\n\n      return new Promise((resolve, reject) => {\n         // find our initial <div appbuilder-portal=\"default\" /> tag\n         var div = document.querySelector(\"div[appbuilder-portal]\");\n         if (!div) {\n            div = document.createElement(\"Div\");\n            div.setAttribute(\"appbuilder-portal-autoenter\", \"true\");\n            div.setAttribute(\"appbuilder-portal-fullscreen\", \"true\");\n            document.getElementsByTagName(\"body\")[0].appendChild(div);\n         }\n         // let loading = document.createElement(\"Div\");\n         // loading.style.justifyContent = \"center\";\n         // loading.style.alignItems = \"center\";\n         // loading.style.display = \"flex\";\n         // loading.style.height = \"100vh\";\n         // loading.style.width = \"100%\";\n         // loading.style.position = \"absolute\";\n         // loading.style.top = \"0\";\n         // loading.style.left = \"0\";\n         // // loading.style.animation = \"spinning 1s ease infinite\";\n         //\n         // loading.innerHTML = `<svg style=\"opacity: 0.6; animation: spinning 1s ease infinite; width: 25px; height: 25px;\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d=\"M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z\"/></svg>`;\n         // document.getElementsByTagName(\"body\")[0].appendChild(loading);\n         // const css = window.document.styleSheets[0];\n         // css.insertRule(\n         //    `@keyframes spinning {\n         //          0%   { transform: rotate(0deg); }\n         //          100% { transform: rotate(360deg); }\n         //    }`,\n         //    css.cssRules.length\n         // );\n         // make sure there is a div.id set:\n         if (!div.id) {\n            div.id = \"AppBuilder\";\n         }\n         BS.div(div);\n         BS.Config.settingsFromDiv(div); // set the autoEnter config\n         resolve();\n      });\n   },\n};\n","export default {\n   init: async (BS) => {\n      // BS {Bootstrap}\n      // The initial Bootstrap object found in \"./Bootstrap.js\"\n      try {\n         let configData = window.__AB_Config;\n         // Use `AB.Network` if available\n         // if (BS.AB) {\n         //    configData = await BS.AB.Network.get(\n         //       { url: \"/config\" },\n         //       { key: \"init_config\" }\n         //    );\n         // } else {\n         //    const headers = new Headers();\n         //    const token = BS.Config.setting(\"tenant\");\n         //    if (token) {\n         //       headers.append(\"tenant-token\", token);\n         //    }\n\n         //    //// DEV TESTING:\n         //    //// uncomment the api_sails/authTenant.js && index.ejs entries for these values\n         //    //// to test url prefix route resolutions:\n         //    // var prefix = AB.setting(\"prefix\");\n         //    // if (prefix) {\n         //    //    headers.append(\"Tenant-Test-Prefix\", prefix);\n         //    // }\n         //    //// DEV TESTING\n\n         //    const response = await fetch(\"/config\", { headers });\n         //    if (response.ok) {\n         //       const { data } = await response.json();\n         //       configData = data;\n         //    } else {\n         //       BS.error(`Error communicating with Server: ${response.status}`);\n         //    }\n         // }\n         // Hotfix 11/30/22, Since we no longer send settings on the div including in config.\n         BS.Config.settings(configData.settings);\n         delete configData.settings;\n         BS.Config.config(configData);\n      } catch (err) {\n         BS.error(\"initConfig: GET /config:\", err);\n         // HOTFIX: (12/15/2022) If the user visits /home directly /config is\n         // the first request made to sails and if we're not authenticated but\n         // using OKTA or CAS, we get a CORS error when trying to authenticate.\n         // Send the user to / to get authenticated correctly.\n         if (err.message == \"Failed to fetch\")\n            window.location.replace(window.location.origin);\n      }\n   },\n};\n","export default {\n   init: async (BS) => {\n      // BS {Bootstrap}\n      // The initial Bootstrap object found in \"./Bootstrap.js\"\n      try {\n         let configData = {\n            user: window.__AB_Config_User,\n            userReal: window.__AB_Config_User_Real,\n         };\n         BS.Config.configUser(configData);\n      } catch (err) {\n         BS.error(\"initConfig: GET /config:\", err);\n         // HOTFIX: (12/15/2022) If the user visits /home directly /config is\n         // the first request made to sails and if we're not authenticated but\n         // using OKTA or CAS, we get a CORS error when trying to authenticate.\n         // Send the user to / to get authenticated correctly.\n         if (err.message == \"Failed to fetch\")\n            window.location.replace(window.location.origin);\n      }\n   },\n};\n","// Include all CSS here\nimport \"./styles/loader.css\";\nimport \"./js/webix/webix.css\";\nimport \"./js/webix/components/gantt/gantt.min.css\";\nimport \"./js/webix/components/reports/reports.min.css\";\nimport \"./js/webix/components/query/query.min.css\";\nimport \"./js/webix/components/scheduler/scheduler.min.css\";\nimport \"./js/webix/components/querybuilder/querybuilder.min.css\";\nimport \"./js/webix/components/hint/hint.css\";\nimport \"./styles/ui.css\";\n// NOTE: keep Font Awesome AFTER webix css so webix wont\n// override our icon stylesimport \"./styles/font-awesome.min.css\";\nimport \"./styles/font-awesome.min.css\";\n\nimport performance from \"./utils/performance\";\nperformance.init();\n\nimport Bootstrap from \"./init/Bootstrap.js\";\n// Bootstrap is responsible for initializing the platform.\n\n// Import webix dynamically so we load it before we load other files that need it\nconst webixLoading = import(\n   /* webpackChunkName: \"webix\" */\n   /* webpackPreload: true */\n   \"./js/webix/webix.min.js\"\n).then(async (webix) => {\n   // Make sure webix is global object\n   window.webix = webix;\n   // Now load additional webix resources\n   import(\n      /* webpackChunkName: \"webix.resources\" */\n      /* webpackPreload: true */\n      \"./js/webix/webixResources\"\n   );\n});\n\n// __AB_preload should be created by our /config/preload script that gets\n// loaded on the initial page load.\nwindow.__AB_preload.then(() => {\n   Bootstrap.init(webixLoading).catch((err) => {\n      // This is a known error that has already been handled.\n      if (err.code == \"ENODEFS\") return;\n\n      var errorMSG = err.toString();\n\n      Bootstrap.alert({\n         type: \"alert-error\",\n         title: \"Error initializing Portal:\",\n         text: errorMSG,\n      });\n\n      Bootstrap.error(err);\n   });\n});\n","import { EventEmitter } from \"events\";\n\nclass ClassUI extends EventEmitter {\n   constructor(base, ids) {\n      super();\n\n      this.ids = {};\n      // {hash}\n      // An internal reference of webix.ids that we use to reference webix\n      // components.\n\n      // We can be called in several ways:\n      // 1) super(\"base_id\");\n      //    in this case we create a default this.ids.component = base_id;\n      //\n      // 2) super({ id1:\"id1\", id2:\"id2\", ... })\n      //    in this case we create a this.ids = base;\n      //    we look for a this.ids.base || or this.ids.component and use that\n      //    as our \"base\" reference.\n      //\n      // 3) super(base, ids);\n      //\n      if (base) {\n         if (\"string\" == typeof base) {\n            this.ids = {\n               component: base,\n            };\n         } else {\n            this.ids = base;\n            base = this.ids.base ?? this.ids.component;\n         }\n      }\n\n      // a shortcut way to enter the ids is to simply put the keys:\n      // {\n      //    form:\"\",\n      //    form_button:\"\",\n      //    ...\n      // }\n      // so we need to make sure the actual values are set according to\n      // `{base}_{key}` format.\n      //\n      if (ids) {\n         Object.keys(ids).forEach((k) => {\n            if (ids[k]) {\n               return (this.ids[k] = ids[k]);\n            }\n            this.ids[k] = `${base}_${k}`;\n         });\n      }\n\n      // verify this.ids are properly set:\n      Object.keys(this.ids).forEach((k) => {\n         this.ids[k] = this.ids[k] || `${base}_${k}`;\n      });\n\n      // and make sure there is a .component set:\n      this.ids.component = this.ids.component || base;\n   }\n\n   /**\n    * @method CYPRESS_REF()\n    * Attach a cypress \"data-cy\" attribute to the given element.  This is used\n    * for writing E2E tests and how we directly identify a webix widget we are\n    * referencing for our tests.\n    * @param {webix.object|webix.node|html.element} el\n    *        The element we are attempting to attach the data attribute to\n    *        There are a number of ways we might be sending this element\n    *        on a onAfterRender() callback on a Webix Object\n    *        by gathering the nodes of a Webix object directly\n    * @param {string} id\n    *        [optional] the value of the data-cy attribute\n    */\n   static CYPRESS_REF(el, id) {\n      if (!el) return;\n\n      id = id || el.config?.id;\n\n      // is this a webix object?\n      if (el.getInputNode) {\n         var node = el.getInputNode();\n         if (node) {\n            node.setAttribute(\"data-cy\", id);\n            return;\n         }\n      }\n\n      // this element has a webix $view\n      if (el.$view) {\n         el.$view.setAttribute(\"data-cy\", id);\n         return;\n      }\n\n      // this is probably a straight up DOM element:\n      el.setAttribute?.(\"data-cy\", id);\n   }\n\n   /**\n    * attach()\n    * cause this UI object to attach itself to a given DIV.ID\n    * of an existing HTML object.\n    * @param {string} id\n    *        the <DIV ID=\"id\"> value of the HTML element to display this UI\n    *        inside.\n    * @return {Webix View}\n    *        returns an instance of the Webix UI object generated by our\n    *        .ui() description.\n    */\n   attach(id) {\n      var ui = this.ui();\n      if (ui && id) {\n         ui.container = id;\n      }\n\n      this.el = webix.ui(ui);\n      return this.el;\n   }\n\n   changePage(pageId) {\n      this.emit(\"changePage\", pageId);\n   }\n\n   hide() {\n      if (this.ids?.component) {\n         $$(this.ids.component).hide();\n      }\n   }\n\n   label(key, ...params) {\n      if (this.AB) {\n         return this.AB.Multilingual.label(key, key, ...params);\n      }\n      console.error(\".labels() called before .AB was set!\");\n      return key;\n   }\n\n   /**\n    * ui()\n    * return a Webix user interface definition for this UI component.\n    * This should be just the json description, not an active instance.\n    * @return {obj}\n    */\n   ui() {\n      console.error(\n         \"ClassUI.ui(): it is expected that sub classes of ClassUI will implement their own ui() method.\"\n      );\n   }\n\n   show() {\n      if (this.ids?.component) {\n         $$(this.ids.component)?.show();\n      }\n   }\n\n   get WARNING_ICON() {\n      return `<span class=\"webix_sidebar_dir_icon webix_icon fa fa-warning pulseLight smalltext\"></span>`;\n   }\n\n   get WARNING_ICON_DARK() {\n      return this.WARNING_ICON.replace(\"pulseLight\", \"pulseDark\");\n   }\n}\n\nexport default ClassUI;\n","/**\n * Performance - utility to track performance of the web platform\n * Written initally for sentry, but could be extended to support others\n * tracking tools.\n * Also supports the User timing API for lighthouse / local dev\n */\n\nimport * as Sentry from \"@sentry/browser\";\n/* These come from the DefinePlugin in webpack  */\nlet webpackMode = \"development\";\nlet version, dsn;\ntry {\n   /* global WEBPACK_MODE SENTRY_DSN VERSION */\n   webpackMode = WEBPACK_MODE;\n   dsn = SENTRY_DSN;\n   version = VERSION;\n} catch (err) {\n   console.warn(\n      \"Error reading from webpack, check the DefinePlugin is working correctly\",\n      err\n   );\n}\n\nconst mode = dsn\n   ? \"sentry\"\n   : webpackMode === \"development\"\n   ? \"browser\"\n   : undefined;\n\n// Following are performance tracking sources, will be accessed through the\n// PerfomanceInterface\n\n/*\n * Default - performance tracking disabled\n */\nclass Performance {\n   init() {}\n   error() {}\n   mark() {}\n   measure() {}\n   notify(domain, error, info) {\n      console.groupCollapsed(`Notify ${domain}: ${error?.message ?? \"\"}`);\n      console.error(error);\n      console.log(\"info\", info);\n      console.groupEnd();\n   }\n   setContext() {}\n}\n\n/*\n * Sentry perfomance tracking\n */\nclass SentryPerformance extends Performance {\n   constructor() {\n      super();\n      this.childSpans = {};\n   }\n\n   init() {\n      Sentry.init({\n         dsn,\n         environment: webpackMode,\n         release: version,\n         integrations: [new Sentry.BrowserTracing()],\n         normalizeDepth: 5,\n         sampleRate: 0.05,\n         tracesSampleRate: 0.05,\n      });\n   }\n\n   error(err) {\n      Sentry.captureException(err);\n   }\n\n   mark(key, context = {}) {\n      context.name = key;\n      if (!this.mainSpan) {\n         this.mainSpanKey = key;\n         this.mainSpan = Sentry.startTransaction(context);\n      } else {\n         this.childSpans[key] = this.mainSpan.startChild(context);\n      }\n   }\n\n   measure(key) {\n      if (this.mainSpanKey === key) {\n         this.mainSpan.finish();\n         delete this.mainSpan;\n         delete this.mainSpanKey;\n         this.childSpans = {};\n      } else {\n         this.childSpans[key]?.finish?.();\n         delete this.childSpans[key];\n      }\n   }\n\n   notify(domain, error, info) {\n      const scope = new Sentry.Scope();\n      // Mark builder alerts as lower level in sentry\n      if (domain == \"builder\") scope.setLevel(\"warning\");\n      scope.setTag(\"domain\", domain);\n      scope.setContext(\"info\", info);\n      Sentry.captureException(error, scope);\n      // Also log to console:\n      super.notify(domain, error, info);\n   }\n\n   setContext(key, data) {\n      switch (key) {\n         case \"tags\":\n            Sentry.setTags(data);\n            break;\n         case \"user\":\n            Sentry.setUser(data);\n            break;\n         case \"breadcrumb\":\n            Sentry.addBreadcrumb(data);\n            break;\n         default:\n            Sentry.setContext(key, data);\n            break;\n      }\n   }\n}\n\n/*\n * Browser Performance tracking - uses the User Timing API\n */\nclass BrowserPerformnace extends Performance {\n   error(err) {\n      console.error(err);\n   }\n\n   mark(key, context) {\n      if (!this.mainSpanKey) {\n         this.mainSpanKey = key;\n      }\n      window.performance.mark(key, { detail: context });\n   }\n\n   measure(key) {\n      try {\n         const mark = window.performance.getEntriesByName(key, \"mark\")[0];\n         const measure = window.performance.measure(key, {\n            start: key,\n            detail: mark?.detail,\n         });\n         if (this.mainSpanKey === key) {\n            console.groupCollapsed(\n               `${measure.name} finished in ${measure.duration} ms`\n            );\n            const entries = window.performance.getEntriesByType(\"measure\");\n            if (entries.length > 1)\n               console.table(entries, [\"name\", \"duration\", \"startTime\"]);\n            else console.log(measure);\n            console.groupEnd();\n            delete this.mainSpanKey;\n            window.performance.clearMarks();\n            window.performance.clearMeasures();\n         }\n      } catch (e) {\n         // console.warn(e);\n      }\n   }\n}\n\n/**\n * hash of performance tracking sources\n */\nconst sources = {\n   sentry: SentryPerformance,\n   browser: BrowserPerformnace,\n};\n\n/**\n * Performance Interface that the rest of the app uses. Routes the calls to the\n * configured performance tracking source\n */\nclass PerformanceInterface {\n   constructor(mode) {\n      this.mode = mode;\n      this.initialized = false;\n      this._source = new (sources[mode] ?? Performance)();\n   }\n\n   /**\n    * initialize performance, should be called early in init\n    */\n   init() {\n      if (this.initialized) return;\n      this._source.init();\n      // console.log(\"Performance.init() complete\", mode);\n      this.initialized = true;\n   }\n\n   /**\n    * Capture an error\n    * @param {Error} error\n    */\n   error(err) {\n      this._source.error(err);\n   }\n\n   /**\n    * Start a performance tracking span. End by calling measure() with the same key.\n    * The first mark will be consider a parent, and subsequent marks become\n    * children until the initial mark is measured.\n    * @param {string} key unique key to track\n    * @param {object} [context] any additional context\n    */\n   mark(key, context) {\n      this._source.mark(key, context);\n   }\n\n   /**\n    * End a performance tracking span\n    * @param {string} key should match an existing mark\n    */\n   measure(key) {\n      this._source.measure(key);\n   }\n\n   /**\n    * Implements AB.notify which will log differently depending on our tracking\n    * option\n    * @param {string} domain which group of people we are sending a notification to.\n    * @param {Error} error An error object generated at the point of issue.\n    * @param {json} info Additional related information concerning the issue.\n    */\n   notify(domain, error, info) {\n      this._source.notify(domain, error, info);\n   }\n\n   /**\n    * Set additional context to tracing/error events\n    * @param {string} key type of context (tag, user, etc)\n    * @pram {object} data\n    */\n   setContext(key, data) {\n      this._source.setContext(key, data);\n   }\n}\n\n// singleton\nlet performanceInterface;\n\n/**\n * Get/create the shared performance instance\n * @returns {PerformanceInterface}\n */\nfunction getPerformance() {\n   if (!performanceInterface)\n      performanceInterface = new PerformanceInterface(mode);\n   return performanceInterface;\n}\n\nexport default getPerformance();\n","__webpack_require__.O(0, [524], () => {\n\t__webpack_require__.E(315);\n\t__webpack_require__.E(478);\n}, 5);"],"names":["appListRowHeight","buttonWidthLarge","buttonWidthMedium","buttonWidthSmall","buttonWidthExtraSmall","tabWidthLarge","tabWidthMedium","tabWidthSmall","tabWidthExtraSmall","columnWidthXLarge","columnWidthLarge","columnWidthMedium","columnWidthSmall","columnWidthExtraSmall","xSmallSpacer","smallSpacer","mediumSpacer","largeSpacer","xLargeSpacer","xxLargeSpacer","xxxLargeSpacer","appListSpacerRowHeight","appListSpacerColMinWidth","appListSpacerColMaxWidth","objectWorkspaceColWidth","labelWidthSmall","labelWidthMedium","labelWidthLarge","labelWidthXLarge","labelWidthXXLarge","labelWidthXXXLarge","labelWidthCheckbox","hideMobile","settingsDefault","configDefaults","site","appbuilder","networkType","networkNumRetries","urlCoreServer","window","location","origin","storage","encrypted","constructor","this","_config","_configUser","_settings","config","json","Object","keys","forEach","k","defaultsDeep","configInbox","inbox","inboxMeta","configUser","setting","key","value","settingsFromDiv","div","d","val","getAttribute","split","pop","settings","definitions","error","console","labelConfig","labels","languageConfig","languages","metaConfig","meta","plugins","inboxConfig","inboxMetaConfig","siteConfig","tenantConfig","tenant","uiSettings","innerWidth","userConfig","user","userReal","PortalLoading","ClassUI","super","ui","id","view","label","init","AB","Promise","resolve","show","$$","PortalAuthLoginForm","self","L","Label","css","cols","rows","width","padding","template","borderless","height","type","background","elementsConfig","bottomPadding","elements","placeholder","name","attributes","validate","webix","rules","isEmail","invalidMessage","validateEvent","isNotEmpty","margin","paddingX","hotkey","click","form","hide","values","getValues","Network","post","url","data","catch","err","log","on","onAfterRender","CYPRESS_REF","hidden","emit","message","$errMsg","setHTML","context","response","code","status","reload","privacyPolicy","Config","setValues","pretext","link","PortalAuthLoginResetPassword","Account","email","border","color","v","length","getValue","password","params","Multilingual","PortalAuthLoginResetRequest","autoheight","options","icon","autowidth","href","$tenant","tenants","newOptions","t","opt","uuid","title","push","define","tID","Tenant","find","o","text","alert","ok","PortalAuthLogin","animate","allInits","all","defaultView","PortalAuth","ActivePortal","cells","then","pathname","performance","navigation","redirectCount","replace","ClassUIPage","containerID","page","App","initialized","pageStack","pageComponents","changePageEventIds","isRoot","render","showPage","myUI","application","datacollectionsIncluded","dc","renderPage","parView","getParentView","showBatch","initEvents","pageID","needToReloadPage","updatePageEventId","rootPageId","updateDatacollectionEventId","datacollectionId","webixLocale","setTimeout","i18n","setLocale","component","myContainer","popupTemplate","modal","position","resize","parseInt","popupWidth","popupHeight","head","align","button","queryView","dataCy","getInputNode","setAttribute","body","scroll","oldView","destructor","removeView","e","batch","oldPage","addView","pages","subpage","container","eventID","attachEvent","detachEvent","viewId","showPageID","activeID","activeUI","getChildViews","filter","onShow","Error","PortalWorkInboxAccordion","app","idUnitList","header","collapsed","uniteBy","templateHeader","headerHeight","obj","items","select","list","selectedItem","getItem","task","unitlist","src","formComponents","formData","onButton","processItem","each","a","getItemNode","notify","developer","info","unitID","parent","i","refresh","remove","getSelectedId","count","unitList","put","expand","initFormIOPreview","custom","formiopreview","PortalWorkInboxTaskwindow","idTaskMultiview","idTaskTitle","idTaskPager","state","left","maxWidth","top","maxHeight","unselectAll","size","group","master","onBeforePageChange","new_page","clearTask","views","taskHolder","index","setValue","blockEvent","getActiveId","unblockEvent","showTasks","selectedItemName","PortalWorkInbox","entries","processLookupHash","appLookupHash","appAccordionLists","multi","get","initDelayed","allAppAccordions","lang","language","createAccordian","addItem","processes","getProcessList","accordion","async","parse","item","createNew","definition","ids","appId","translate","appAccordion","p","process","uniteLabel","translations","entry","language_code","PortalWorkUserProfileWindow","imageUser","uploaderImage","formUserInfo","dataEmail","editModeEmail","buttonEditModeEmail","editModeButtonsEmail","dataLanguage","editModeLanguage","buttonEditModeLanguage","editModeButtonsLanguage","formNewPassword","fieldNewPassword","systemNotification","advanceOptions","acctImageID","imageID","imgTemplate","imgErrorDiv","onItemClick","zIndex","algin","inputName","apiOnly","multiple","accept","upload","objectUser","onFileUpload","$uploaderImage","$imageUser","disable","model","update","image_id","enable","onFileUploadError","inputWidth","$dataEmail","$editModeEmail","$buttonEditModeEmail","$editModeButtonsEmail","$dataLanguage","$editModeLanguage","$buttonEditModeLanguage","$editModeButtonsLanguage","getLanguages","languageCodeToWord","languageCode","$button","$advanceOptions","isVisible","$formNewPassword","$thisButton","clear","$systemNotification","sendEmailNotifications","Language","objectLanguage","findAll","language_label","populate","$formUserInfo","populateLanguage","username","myClass","userIcon","userName","switchBack","switchBackReplacer","close","switchUser","userID","headless","switcherooClear","userList","delete","mainUserID","map","u","switchedUserID","isSwitcherood","PortalWorkUserQRWindow","classQrImageDom","$view","getElementsByClassName","onload","adjust","PortalWorkUserMobileQR","description","instructions","qrcode","taskPager","load","$title","$desc","$qrcode","PortalAccessLevelManager","accessLevels","accessLevelManagerBody","roles","newRolePopup","role","indexOf","buildAccessAccordion","collapse","portal","AppState","lastSelectedApp","translation","applicationByID","isAccessManaged","existingRoles","pageId","pageContainers","f","isRoleAccessManager","accessManagers","useRole","manageUsers","confirm","tree","mainPages","branch","access","updateAccessLevels","updateItem","itemToRemove","splice","toggleParent","element","parentElem","getParent","$parent","editable","editor","editValue","threeState","common","getAccessLevelTree","onClick","externalLink","event","target","tabView","tab","showIt","setInterval","clearInterval","onAfterEditStop","ignoreUpdate","old","onDataUpdate","eachSubItem","child","childData","parentBranch","getParentId","parentData","newAccordionItem","r","WARNING_ICON","Webix","TooltipControl","addTooltip","openAll","TreeCollection","addPage","parentId","accessLevel","add","defaults","subPages","childPage","childIndex","tabIndex","tabViewIndex","tIndex","PortalTranslationTool","containerDomID","translationToolBody","labelWidth","labelAlign","onChange","newVal","oldVal","buildTranslationAccordion","objectsIncluded","hintsIncluded","bottomLabel","languageList","ready","protoUI","EditAbility","tutorials","hints","objects","objectTree","tooltip","onAfterLoad","showProgress","extend","ProgressBar","getTranslationToolObjectsTree","propName","field","objectId","fieldId","objectByID","fields","option","languageDefault","hasLang","trans","save","progressBar","total","completed","viewTree","pageView","getTranslationToolViewsTree","order","buttonId","tutorialTree","getTranslationToolTutorialsTree","hint","h","step","hintId","_steps","objectsAccordionItem","viewsAccordionItem","hintsAccordionItem","getTranslations","domId","missingHint","missingTranslate","translateLang","hintLang","hintLabel","valueLabel","hintPrefix","translatePrefix","tabicon","labelIndex","menu","menuIndex","menuItem","menuItemIndex","formIndex","formInput","formInputIndex","property","chart","chartIndex","viewIndex","addBranch","object","fieldIndex","optionIndex","lastField","firstField","stepIDs","PortalTutorialManager","tutorialStepsManager","createStep","Array","isArray","stepUI","move","tutorialSettings","tutorialManagerBody","_hints","deleteHint","ev","result","hintID","destroy","fail","hintItem","steps","newTutorialPopup","lastPages","getText","trim","createTutorial","valid","disabled","el","active","currentTutorial","getViewOptions","hintIDs","pageTabWindow","document","removeEventListener","handleRightClick","focusWindow","classList","updateStepsUI","viewsToRemove","addHighlightClass","currentTarget","formVals","stepId","querySelector","removeHighlightClass","addStepBelow","focusElements","querySelectorAll","addEventListener","class","moveStep","minWidth","deleteStep","stepRemove","direction","currPosition","addOption","depth","indent","pageIndex","viewID","viewLabel","hintNew","unshift","hintView","stepNew","preventDefault","stopPropagation","getCy","dataset","cy","parentElement","PortalWork","busy","navSideBar","sidebarMenu","firstID","getFirstId","popup","onAfterSelect","selectApplication","storageKey","allApplications","applications","isWebApp","isAccessibleForRoles","rolesAll","concat","menu_data","uiSideBarMenuEntry","relay","sidebarResize","userMenuOptions","isMobile","m","canSwitcheroo","networkWarnings","no_network","priority","no_server","_connectionCheck","slow","networkWarningClear","navigator","onLine","networkWarningDisplay","logout","mobileApp","Storage","abApplication","getUserAccess","DefaultPage","$sideBar","foundMenuEntry","sidebarMenuEntryByID","defaultPageID","allPlaceholders","j","keepViews","Class","ABComponent","containerInit","cont","refreshSettingsMenu","badge","queueCount","isNetworkSlow","isSlow","eid","warning","buttonText","replaceAll","html","addStyle","removeStyle","row","pageButtons","firstPage","activePageID","saveState","pbLabel","abPage","pageButton","selectedPage","sideBar","_saveTimeoutID","clearTimeout","set","pageUI","menuID","getNextId","sideBarHeight","settingsMenuOptions","isManager","useAccount","account","isTranslationManaged","translationManagers","isTutorialManaged","tutorialManagers","Portal","ShownPortal","portalWorkReady","fullscreen","showPortal","isAuthenticated","redirect","showAuthPortal","showDefaultView","showWorkPortal","parts","UI","hiddenElements","portalShow","entryLabel","textClickToEnter","attach","portalHide","ErrorNoDefsUI","switcherooUser","preloadMessage","EventEmitter","setMaxListeners","_div","_plugins","_ui","webixLoading","loadABFactory","getElementById","innerHTML","destroyPreloadUI","networkTestWorker","Worker","URL","networkIsSlow","BS","onmessage","setContext","category","level","mark","op","reject","createElement","getElementsByTagName","appendChild","measure","configData","__AB_Config","initConfig","__AB_Config_User","__AB_Config_User_Real","initUser","userInfo","JSON","authType","assign","__AB_Plugins","addPlugin","default","ABFactory","registerNetworkTestWorker","apply","currentLanguage","pluginLoadLabels","locales","en","th","prototype","hasOwnProperty","call","CustomScroll","plugin","__AB_preload","errorMSG","toString","base","node","changePage","WARNING_ICON_DARK","version","dsn","webpackMode","warn","mode","undefined","Performance","domain","groupCollapsed","groupEnd","sources","sentry","childSpans","environment","release","integrations","normalizeDepth","sampleRate","tracesSampleRate","mainSpan","startChild","mainSpanKey","finish","scope","setLevel","setTag","browser","detail","getEntriesByName","start","duration","getEntriesByType","table","clearMarks","clearMeasures","performanceInterface","_source","__webpack_require__","O","E"],"sourceRoot":""}