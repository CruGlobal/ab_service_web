/*! For license information please see 236.1ea40836572f117bc9fb.js.LICENSE.txt */
(self.webpackChunkab_platform_web=self.webpackChunkab_platform_web||[]).push([[236],{8893:(e,t,i)=>{const s=i(8030),a=i(9594);e.exports=class extends s{constructor(e,t){super(e,t=t||"ab_work_object_workspace_popupNewDataField");var i=this.Label(),s={component:this.unique(`${t}_popNewField`),types:this.unique(`${t}_popNewField_types`),editDefinitions:this.unique(`${t}_popNewField_editDefinitions`),buttonSave:this.unique(`${t}_popNewField_buttonSave`),buttonCancel:this.unique(`${t}_popNewField_buttonCancel`)};this.ui={view:"window",position:"center",id:s.component,resize:!0,modal:!0,height:500,width:700,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new field"),css:"modal_title",align:"center"},{view:"button",label:i("Close"),autowidth:!0,align:"center",click:function(){p.buttonCancel()}}]},body:{view:"scrollview",scroll:"y",css:"ab-add-fields-popup",borderless:!0,body:{type:"form",rows:[{view:"richselect",id:s.types,label:i("Field type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"temporary",view:"temporary"}],on:{onChange:function(e,t,i){p.onChange(e)}}},{height:10,type:"line"},{view:"multiview",id:s.editDefinitions,padding:0,cells:[{id:"del_me",view:"label",label:i("edit definition here")}]},{height:10},{cols:[{fillspace:!0},{view:"button",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:function(){p.buttonCancel()}},{view:"button",css:"webix_primary",id:s.buttonSave,label:i("Add Column"),autowidth:!0,type:"form",click:function(){p.buttonSave()}}]}]}},on:{onHide:function(){p.resetState()}}};var n={},r={},o={},l=null,u=null,c=null,d=[],h=null;this.init=i=>{for(let e in p.callbacks)p.callbacks[e]=i[e]||p.callbacks[e];webix.ui(this.ui),webix.extend($$(s.component),webix.ProgressBar);var u=a.allFields(),h={view:"multiview",id:s.editDefinitions,animate:!1,rows:[]};u.forEach((function(i){var s=i.defaults().menuName,a=i.defaults().key;d.push({id:s,value:s});var l=i.propertiesComponent(e,t);c||(c=l),h.rows.push(l.ui),n[s]=i,r[s]=l,o[a]=l})),$$(s.types).define("options",d),$$(s.types).refresh(),webix.ui(h,$$(s.editDefinitions));for(let e in r)r[e].init(),r[e].hide();c.show(),l=c,$$(s.types).setValue(d[0].id)};var p=this._logic={applicationLoad:e=>{for(var t in r)r[t]&&r[t]._logic.applicationLoad&&r[t]._logic.applicationLoad(e)},objectLoad:e=>{for(var t in u=e,r)r[t]&&r[t]._logic.objectLoad&&r[t]._logic.objectLoad(u)},buttonCancel:function(){for(var e in p.resetState(),r)r[e].clear();$$(s.component).hide()},buttonSave:async function(){$$(s.buttonSave).disable(),$$(s.component).showProgress();var e=l;if(e)if(e.isValid()){var t,i=this.AB.cloneDeep(e.values()),a=null,n=null;if(h){i.label&&(h.label=i.label),n=h.toObj();var r=this.AB.cloneDeep(n);for(let e in i)if("settings"==e&&i.settings&&"object"==typeof i.settings){r.settings=r.settings||{};for(let e in i.settings)r.settings[e]=i.settings[e]}else r[e]=i[e];h.fromValues(r),a=h}else{var o=20+10*(a=u.fieldNew(i)).label.length;if(a.settings.showIcon&&(o+=20),o<100&&(o=100),a.settings.width=o,"connectObject"==a.key){let e=Math.floor(1e3*Math.random());a.settings.isSource=1;var c=a.datasourceLink;let i=a.columnName;c.fields((e=>e.columnName==i)).length&&(i=`${i}${e}`),"many"==a.settings.linkType&&"many"==a.settings.linkViaType&&(i=`${u.name}${e}`),t=c.fieldNew({key:a.key,columnName:i,label:u.label,settings:{showIcon:a.settings.showIcon,linkObject:a.object.id,linkType:a.settings.linkViaType,linkViaType:a.settings.linkType,isCustomFK:a.settings.isCustomFK,indexField:a.settings.indexField,indexField2:a.settings.indexField2,isSource:0,width:o}})}}var d=a.isValid();if(d.fail())d.updateForm($$(e.ui.id)),n&&a.fromValues(n),$$(s.buttonSave).enable(),$$(s.component).hideProgress();else try{await a.save();let e=()=>{$$(s.buttonSave).enable(),$$(s.component).hideProgress(),l.clear(),p.hide(),p.callbacks.onSave(a)},i=()=>{t.object.model().refresh(),a.object.model().refresh()};null!=t?(t.settings.linkColumn=a.id,await t.save(),a.settings.linkColumn=t.id,await a.save(),h||(await a.migrateCreate(),await t.migrateCreate()),i(),e()):e()}catch(e){}}else $$(s.buttonSave).enable(),$$(s.component).hideProgress();else this.AB.notify.developer(new Error("Could not find the current editor."),{}),$$(s.buttonSave).enable(),$$(s.component).hideProgress()},callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(e){console.warn("NO onSave()!")}},hide:function(){$$(s.component).hide()},modeAdd:function(e){if(c.show(!1,!1),l=c,u.isImported&&(e="connectObject"),e){var t=a.allFields().filter((t=>t.defaults().key==e))[0];if(!t)return;var n=t.defaults().menuName;$$(s.types).setValue(n),$$(s.types).disable()}else $$(s.types).enable();$$(s.types).show(),$$(s.buttonSave).define("label",i("Add Column")),$$(s.buttonSave).refresh()},modeEdit:function(e){for(var t in l&&l.hide(),o)t==e.key?(o[t].show(!1,!1),o[t].populate(e),l=o[t]):o[t].hide();if(l&&l.ui&&l.ui.elements){var a=e=>{e.disallowEdit&&$$(e.id)&&$$(e.id).disable&&$$(e.id).disable()};l.ui.elements.forEach((e=>{a(e);var t=e.cols||e.rows;t&&t.forEach&&t.forEach((e=>{a(e)}))}))}$$(s.types).hide(),$$(s.buttonSave).define("label",i("Save")),$$(s.buttonSave).refresh()},onChange:function(e){var t=r[e];t&&(t.show(),l=t,$$(s.types).blur())},resetState:function(){if(l&&l.ui&&l.ui.elements){var e=e=>{e.disallowEdit&&$$(e.id)&&$$(e.id).enable&&$$(e.id).enable()};l.ui.elements.forEach((t=>{e(t);var i=t.cols||t.rows;i&&i.forEach&&i.forEach((t=>{e(t)}))}))}c.show(),l=c,$$(s.types).setValue(d[0].id)},show:function(e,t){(h=e)?p.modeEdit(e):p.modeAdd(t),$$(s.component).show()},typeClick:function(){var e=$$(s.types).config.data[0].submenu;"string"!=typeof e&&($$(s.types).getSubMenu($$(s.types).config.data[0].id),e=$$(s.types).config.data[0].submenu),$$(e)&&$$(e).show()}};this.actions({}),this.applicationLoad=p.applicationLoad,this.objectLoad=p.objectLoad,this.show=p.show}}},3947:(e,t,i)=>{const s=i(8030);e.exports=class extends s{constructor(e,t){super(e,t=t||"ab_work_object_workspace_popupSortFields");var i=this.Label(),s={component:this.unique(`${t}_popupSort`),list:this.unique(`${t}_popupSort_list`),form:this.unique(`${t}_popupSort_form`)},a={view:"form",id:s.form,borderless:!0,elements:[{view:"button",type:"form",css:"webix_primary",value:i("Add new sort"),on:{onItemClick:function(e,t,i){r.clickAddNewSort(),r.triggerOnChange()}}}]};this.ui={view:"popup",id:s.component,width:600,body:a,on:{onShow:function(){r.onShow()}}},this.init=e=>{for(var t in r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t];webix.ui(this.ui)};let n=null;var r=this._logic={callbacks:{onChange:function(){}},clickAddNewSort:function(e,t){var a=$$(s.form),n=a.getChildViews().length-1,o=r.getFieldList(!0);a.addView({id:"sort"+webix.uid(),cols:[{view:"combo",width:220,options:o,on:{onChange:function(e){r.onChangeCombo(e,this)}}},{view:"segmented",width:200,options:[{id:"",value:i("Please select field")}],on:{onChange:function(e,t){r.triggerOnChange()}}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",width:30,on:{onItemClick:function(){a.removeView(this.getParentView()),r.refreshFieldList(!0),r.triggerOnChange()}}}]},n),e&&a.getChildViews()[n].getChildViews()[0].setValue(e),t&&a.getChildViews()[n].getChildViews()[1].setValue(t)},getFieldList:function(e){$$(s.component);var t=$$(s.form),i=[];if(!n.fields())return i;if(n.fields().forEach((e=>{e.fieldIsSortable()&&i.push({id:e.id,value:e.label})})),e){var a=t.getChildViews();a.length>1&&a.forEach((function(e,t){if(a.length-1<=t)return!1;var s=e.getChildViews()[0].getValue();if(s){var n=null;i.filter((function(e,t){return e.id==s&&(n=t,!0)})),i.splice(n,1)}}))}return i},objectLoad:function(e){n=e},setSettings:e=>{this._settings=this.AB.cloneDeep(e)},getSettings:function(){var e=$$(s.form),t=[],i=e.getChildViews();return i.length>1&&i.forEach((function(e,s){if(i.length-1<=s)return!1;var a=e.getChildViews()[0].getValue(),n=e.getChildViews()[1].getValue();t.push({key:a,dir:n})})),t},onChangeCombo:function(e,t){var s=n.fields(),a="",o=t.getParentView().getChildViews()[1],l=null;if(s.forEach((t=>{t.id==e&&(a=t)})),a){switch(a.key){case"string":default:l=[{id:"asc",value:i("A -> Z")},{id:"desc",value:i("Z -> A")}];break;case"date":l=[{id:"asc",value:i("Before -> After")},{id:"desc",value:i("After -> Before")}];break;case"number":l=[{id:"asc",value:i("1 -> 9")},{id:"desc",value:i("9 -> 1")}]}o.define("options",l),o.refresh(),r.refreshFieldList(),r.triggerOnChange()}},onShow:()=>{var e=$$(s.form);webix.ui(a,e);var t=this._settings;t&&t.forEach&&t.forEach((e=>{r.clickAddNewSort(e.key,e.dir)})),null!=t&&0!=t.length||r.clickAddNewSort()},refreshFieldList:function(e){var t=$$(s.form),i=r.getFieldList(!1),a=[],n=[],o=t.getChildViews();o.length>1&&o.forEach((function(e,t){if(o.length-1<=t)return!1;var s=e.getChildViews()[0].getValue(),r=i.filter((function(e){return e.id==s}));r.length>0?a.push(r[0]):n.push(e)})),e||n.forEach((function(e,i){t.removeView(e)})),(o=t.getChildViews()).length>1&&o.forEach((function(e,t){if(o.length-1<=t)return!1;var s=e.getChildViews()[0].getValue(),n=i.filter((function(e){return e.id==s})),r=a.filter((function(e){return!Array.isArray(n)||-1===n.indexOf(e)})),l=i.filter((function(e){return!Array.isArray(r)||-1===r.indexOf(e)}));e.getChildViews()[0].define("options",l),e.getChildViews()[0].refresh()}))},triggerOnChange:()=>{this._blockOnChange||(this._settings=r.getSettings(),r.callbacks.onChange(this._settings))},blockOnChange:()=>{this._blockOnChange=!0},unblockOnChange:()=>{this._blockOnChange=!1},show:(e,t,i)=>{r.blockOnChange(),$$(s.component).show(e,i||null),t&&r.clickAddNewSort(t),r.unblockOnChange()},sort:function(e,t){var i=0,a=$$(s.form).getChildViews();return a.length>1&&a.forEach((function(s,r){if(!(a.length-1<=r||0!=i)){var o=s.getChildViews()[0].getValue(),l=s.getChildViews()[1].getValue(),u=n.fieldByID(o);if(u){var c=u.columnName,d=e[c],h=t[c];Array.isArray(d)&&(d=(d||[]).map((function(e){return e.text||e})).join(" ")),Array.isArray(h)&&(h=(h||[]).map((function(e){return e.text||e})).join(" ")),d!=h&&(i="asc"==l?d>h?1:-1:d<h?1:-1)}}})),i}};this.actions({}),this.objectLoad=r.objectLoad,this.show=r.show,this.sort=r.sort,this.setValue=r.setSettings,this.getValue=r.getSettings}}},4647:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>U});var s=i(5095),a=i.n(s),n=i(6486),r=i.n(n),o=i(381),l=i.n(o),u=i(3416),c=i(4586),d=i(1021),h=i.n(d),p=i(2804),m=i(7187).EventEmitter;const f=new class extends m{constructor(){super(),this.isAuthenticated=!1,this._config=null,this._listRoles=null,this._listScopes=null,this._listUsers=null}init(e){this.AB=e;var t=this.AB.Config.userConfig();t&&(this.isAuthenticated=!0,this._config=t);var i=this.AB.Config.metaConfig();return i&&(this._listRoles=i.roles||[],this._listScopes=i.scopes||[],this._listUsers=i.users||[]),this.AB.Network.on("account.logout",((e,t,i)=>{t?console.error(t):this.emit("logout",i)})),Promise.resolve()}isSystemDesigner(){return this.roles((e=>"6cc04894-a61b-4fb5-b3e5-b8c3f78bd331"===e.uuid)).length>0}email(){return this._config?.email??""}language(){return this._config?.languageCode??"en"}logout(){return this.AB.Network.post({url:"/auth/logout",data:{tenantUrl:this.AB.Tenant.setting("url")}},{key:"account.logout",context:{}})}roles(e=(()=>!0)){return(this._config?.roles||[]).filter(e)}rolesAll(){return this._listRoles}scopes(){return this._listScopes}username(){return this._config?.username}userList(){return this._listUsers}uuid(){return this._config?.uuid}imageID(){return this._config?.image_id}sendEmailNotifications(){return this._config?.sendEmailNotifications}};var g=i(2735);const b={Alert:function(e){webix.alert({title:e.title||AB.Multilingual.label("opp.dialog.alert.title","*Alert"),text:e.text||e.message||AB.Multilingual.label("opp.dialog.alert.text","*Something is wrong."),ok:e.ok||AB.Multilingual.label("opp.dialog.alert.ok","*OK")})},Confirm:function(e){var t=e.title||AB.Multilingual.label("opp.dialog.confirm.confirmTitle","* Confirm"),i=e.text||e.message||AB.Multilingual.label("opp.dialog.confirm.confirmMsg","* Are you sure you want to do this?"),s=e.labelYes||e.ok||AB.Multilingual.label("opp.common.yes","* yes"),a=e.labelNo||e.cancel||AB.Multilingual.label("opp.common.no","* no");webix.confirm({title:t,text:i,ok:s,cancel:a,callback:function(t){t?e.fnYes&&e.fnYes():e.fnNo&&e.fnNo(),e.callback&&e.callback(t)}})},ConfirmDelete:function(e){this.Confirm({title:e.title||AB.Multilingual.label("opp.dialog.confirm.deleteTitle","* Confirm Delete"),ok:e.ok||AB.Multilingual.label("opp.common.delete","* Delete"),cancel:e.cancel||AB.Multilingual.label("opp.common.cancel","* Cancel"),text:e.text||e.message||AB.Multilingual.label("opp.dialog.confirm.deleteMsg","* Are you sure you want to delete this?",["this"]),callback:function(t){t?e.fnYes&&e.fnYes():e.fnNo&&e.fnNo(),e.callback&&e.callback(t)}})},Message:function(e){var t=e.text||e.message,i=e.timeout||2e3;webix.message({text:t,expire:i})}};var v=i(7069);const w=new class extends v{constructor(){super([],{}),this.isAuthenticated=!1,this._config=null,this._missingLabelID=!1,this._missingLabels={},this._pluginLabelsMissing={}}init(e){return this.AB=e,this.labels=this.AB.Config.labelConfig(),this.pluginLabels={},Promise.resolve()}currentLanguage(){return this.AB.Account.language()}label(e,t,i=[],s=!0){void 0===t&&e&&(t=e),2==arguments.length&&Array.isArray(t)&&(i=t,t=e),t=t.replace(/"/g,'\\"'),e=e.replace(/"/g,'\\"');var a=t;"*"==a[0]&&(a=a.slice(1));var n=this.labels[a];return n||(s&&this.postMissingLabel(e,t),n=t),i.forEach(((e,t)=>{var i=`{${t}}`;n=n.replaceAll(i,e)})),n=n.replace(/\\"/g,'"')}labelPlugin(e,t,i=[]){var s=this.label(t,t,i,!1);return s||(s=this.pluginLabels[e][t]),s||(this._pluginLabelsMissing[e]=this._pluginLabelsMissing[e]||{},this._pluginLabelsMissing[e][t]=t,s=t),i.forEach(((e,t)=>{var i=`{${t}}`;s=s.replaceAll(i,e)})),s}languages(){return console.error("Multilingual:languages(): Implement Language Storage/Retrieval."),[]}pluginLoadLabels(e,t){this.pluginLabels[e]=t}pluginLabelReport(e){console.warn("missing labels for plugin: ",e),console.warn("current language:",this.currentLanguage());var t=JSON.stringify(this._pluginLabelsMissing[e],null,3);console.warn(t)}postMissingLabel(e,t){this._missingLabelID&&clearTimeout(this._missingLabelID);var i=()=>{var e=[];let t=Object.keys(this._missingLabels).map((e=>this._missingLabels[e]));if(t.length<=50)e=t,this._missingLabels={};else for(var s=0;s<=50;s++){var a=t.shift();e.push(a),delete this._missingLabels[a.key]}this.AB.Network.post({url:"/multilingual/label-missing",data:{labels:JSON.stringify(e)}}).then((()=>{Object.keys(this._missingLabels).length>0&&i()}))};this._missingLabelID=setTimeout((()=>{i()}),1e3),this._missingLabels[e]={key:e,altText:t}}destroy(){return console.error("Multilingual:destroy(): Should not be called."),Promise.resolve()}save(){return console.error("Multilingual:save(): Should not be called."),Promise.resolve()}toObj(){return console.error("Multilingual:toObj(): Should not be called."),{}}toDefinition(){return console.error("Multilingual:toDefinition(): Should not be called."),{}}};var y=i(7187).EventEmitter;const _=i(8459);var x=null;const $=class extends y{constructor(e){super({wildcard:!0,newListener:!1,maxListeners:0}),this.baseURL=null,this.numRetries=3,this._network=e,this.isRealTime=!1}init(e,t){return this.AB=e,x=this.AB.Config.siteConfig(),(t=t||{})&&(this.baseURL=t.baseURL||x.appbuilder.urlCoreServer,this.numRetries=t.networkNumRetries||x.appbuilder.networkNumRetries),Promise.resolve()}get(e,t){e.type=e.type||"GET";var i=e.data||e.params;if(i){var s=["string","number","boolean"],a=Object.keys(i).map((function(e){var t=i[e];return-1==s.indexOf(typeof t)&&(t=JSON.stringify(t)),e+"="+encodeURIComponent(t)})).join("&"),n="?";e.url.indexOf("?")>-1&&(n="&"),e.url=[e.url,a].join(n)}return this._request(e,t)}post(e,t){return e.type=e.type||"POST",this._request(e,t)}put(e,t){return e.type=e.type||"PUT",this._request(e,t)}delete(e,t){return e.type=e.type||"DELETE",this._request(e,t)}isNetworkConnected(){return this._network.isNetworkConnected()}salSend(e){return _(e.url,e).then((e=>e.data))}_request(e,t){if(e._retry=e._retry||0,e._retry>=this.numRetries){var i=new Error(`Too many retries (${this.numRetries}) for ${e.url}`);return i.code="E_TOMANYRETRIES",this.AB.notify.developer(i,{context:"NetworkRest:_request: Too Many Retries"}),t&&this._network.publishResponse(t,i),Promise.reject(i)}return new Promise(((i,s)=>{e.url=e.url||"/","/"==e.url[0]&&(e.url=this.baseURL+e.url),e.headers=e.headers||{},this.AB.Account.authToken&&(e.headers.Authorization=this.AB.Account.authToken),e.headers["Content-type"]="application/json";var a=this.AB.Tenant.id();a&&(e.headers["tenant-token"]=a),this.isNetworkConnected()?(e.method=e.method||e.type,e.timeout=6e3,e.data=e.data||e.params,delete e.params,this.salSend(e).then((e=>{var s=e;t&&this._network.publishResponse(t,null,s),i(s)})).catch((a=>{if("Request timeout"==a.statusText||a.message&&a.message.indexOf("disconnected")>-1)return this.AB.Analytics.log("NetworkRest._request():network connection error detected. Trying again"),e._retry++,void this._request(e).then((e=>{this.AB.warn("*** NetworkRest._request().then(): attempt resolved."),i(e)})).catch((e=>{this.AB.notify.developer(e,{message:"*** NetworkRest._request().catch(): retry failed:"}),s(e)}));403==a.status?this.emit("error.badAuth",a):a.status>=400&&a.status<500?this.emit("error.badRequest",a):a.status>=500&&this.emit("error.badServer",a);var n=null;if(a.responseText)try{n=JSON.parse(a.responseText)}catch(e){}if(n&&"error"==n.status)return 5==n.id||"E_REAUTH"==n.code?void this._network.emit("reauth"):(this.AB.notify.developer(n,{context:"NetworkRest:_request:Error returned from Server (req.ab.error())",data:n.data}),t&&this._network.publishResponse(t,n,null),s(n.data));var r=new Error(`${a.status} ${a.statusText||a.message}: ${e.method} ${e.url}`);return r.response=a.responseText,r.text=a.statusText,r.err=a,r.url=`${e.method} ${e.url}`,this.AB.notify.developer(r,{context:"NetworkRest:_request:Unknown Error returned from server"}),t&&this._network.publishResponse(t,r),s(r)}))):(this.AB.Analytics.log("NetworkRest:_request(): Network is offline. Queuing request."),this._network.queue(e,t).then((()=>{i({status:"queued"})})).catch(s))}))}resend(e,t){return this._request(e,t)}},k=["ab.datacollection.create","ab.datacollection.update","ab.datacollection.stale","ab.datacollection.delete","ab.inbox.create"],C=class extends ${constructor(e){super(e),this.isRealTime=!0,k.forEach((e=>{io.socket.on(e,(t=>{if(e.indexOf("ab.datacollection")>-1&&t.data){let i=this.AB.objectByID(t.objectId);if(i){let s=i.model();"ab.datacollection.delete"!=e&&s.normalizeData(t.data)}}this.AB.emit(e,t)}))}))}isNetworkConnected(){return io.socket.isConnected()}salSend(e){return new Promise(((t,i)=>{e.method=e.method.toLowerCase(),io.socket.request(e,((e,s)=>{if(s.statusCode>=400){var a=s.error?s.error.toString():s.body,n=new Error(`Socket Error: ${a}`);n.status=s.statusCode,n.statusText=a,n.responseText=s.body,i(n)}else{if(e instanceof Error)return void i(e);"string"==typeof e&&(e=JSON.parse(e)),e.status&&"error"==e.status?i({status:s.statusCode,responseText:JSON.Stringify(e)}):t(e)}}))}))}};var A=i(7187).EventEmitter;const D=new class extends A{constructor(){super(),this.setMaxListeners(0),this.queueLock=null,this._config=null,this._network=null,this._queueCount=0}init(e){if(this.AB=e,this.queueLock=new this.AB.Lock,this._config=this.AB.Config.siteConfig(),this._config){switch(this._config.appbuilder.networkType){case"relay":break;case"socket":this._network=new C(this);break;default:this._network=new $(this)}return this._network.init(e)}return console.error("??? Why No site config ???"),io&&io.socket?io.socket.on("connected",(()=>{this.queueFlush(),this.idConnectionCheck&&(clearTimeout(this.idConnectionCheck),this.idConnectionCheck=null)})):(console.error("!!! Network.init() : Did not find io.socket"),window.addEventListener("online",(()=>this.queueFlush()))),Promise.resolve()}get isRealTime(){return this._network.isRealTime}get(...e){return this._network.get(...e).then((e=>this.normalizeData(e)))}post(...e){return this._network.post(...e).then((e=>this.normalizeData(e)))}put(...e){return this._network.put(...e).then((e=>this.normalizeData(e)))}delete(...e){return this._network.delete(...e).then((e=>this.normalizeData(e)))}_connectionCheck(){this.isNetworkConnected()?(this.queueFlush().catch((()=>{this.idConnectionCheck=setTimeout((()=>{this._connectionCheck()}),250)})),this.idConnectionCheck=null):this.idConnectionCheck=setTimeout((()=>{this._connectionCheck()}),250)}networkStatus(){return navigator.connection.type}isNetworkConnected(){return io&&io.socket&&io.socket.isConnected?io.socket.isConnected():"undefined"==typeof Connection?navigator.onLine:this.networkStatus()!=Connection.NONE}publishResponse(e,t,i){i&&(i=this.normalizeData(i)),this.emit(e.key,e.context,t,i)}normalizeData(e){return"error"===e.status?e:e.data||e}refQueue(){return"networkQueue"}queueCount(){return this._queueCount}queue(e,t){var i=this.refQueue();return new Promise(((s,a)=>{this.queueLock.acquire().then((()=>this.AB.Storage.get(i))).then((s=>((s=s||[]).push({data:e,jobResponse:t}),this.AB.log(`:::: ${s.length} request${s.length>1?"s":""} queued`),this._queueCount=s.length,this.AB.Storage.set(i,s)))).then((()=>{this.emit("queued"),this.idConnectionCheck||this._connectionCheck(),this.queueLock.release(),s()})).catch((e=>{this.AB.notify.developer(e,{message:"Error while queueing data"}),this.AB.Analytics.logError(e),a(e),this.queueLock.release()}))}))}queueFlush(){var e=this.refQueue();if(!this.isNetworkConnected()){var t=new Error("Not connected to the internet.");return t.code="E_NOTCONNECTED",Promise.reject(t)}return new Promise(((t,i)=>{this.queueLock.acquire().then((()=>this.AB.Storage.get(e))).then((e=>{e=e||[];var t=i=>{if(0==e.length)i();else{var s=e.shift(),a=s.data,n=s.jobResponse;this._network.resend(a,n).then((()=>{t(i)})).catch((e=>{e&&"E_TOMANYRETRIES"==e.code?i(e):t(i)}))}};return new Promise(((e,i)=>{t((t=>{t?i(t):e()}))}))})).then((()=>(this._queueCount=0,this.AB.Storage.set(e,[])))).then((()=>(this.emit("queue.synced"),this.queueLock.release()))).then((()=>{t()})).catch((e=>{this.AB.notify.developer(e,{message:"commAPI queueFlush error"}),this.AB.Analytics.logError(e),this.queueLock.release().then((()=>{i(e)}))}))}))}reset(){return Promise.resolve()}type(){return this._config.appbuilder.networkType}getTokens(){return{}}};var E=i(7187).EventEmitter;const I=new class extends E{constructor(){super(),this.tenantStorage=null}init(e){this.AB=e;var t=this.AB.Tenant.id();return t||(t="noAuth"),this.tenantStorage=this.AB.Webix.storage.prefix(t,this.AB.Webix.storage.local),Promise.resolve()}set(e,t){return Promise.resolve().then((()=>this.tenantStorage.put(e,t)))}get(e){return Promise.resolve().then((()=>this.tenantStorage.get(e)))}clear(e){return Promise.resolve().then((()=>this.tenantStorage.remove(e)))}clearAll(){return Promise.resolve().then((()=>this.tenantStorage.clear()))}};var S=i(7187).EventEmitter;const V=new class extends S{constructor(){super(),this.tenantStorage=null,this._config=null,this._storage=null}init(e){this.AB=e;var t=this.AB.Config.siteConfig();return t?(t.storage&&t.storage.encrypted?(console.error("TODO: Implement Encrypted Storage"),this._storage=I):this._storage=I,this._storage.init(e)):(console.error("??? Why No site config ???"),Promise.resolve())}set(...e){return this._storage.set(...e)}get(...e){return this._storage.get(...e)}clear(...e){return this._storage.clear(...e)}clearAll(...e){return this._storage.clearAll(...e)}};var F=i(5753),B=i.n(F),j=i(7187).EventEmitter;const N=new class extends j{constructor(){super(),this.text=!1,this._config=null,this.textClickToEnter=null}init(){var e=p.Z.tenantConfig();if(e){if("string"==typeof e.options||e.options instanceof String)try{e.options=JSON.parse(e.options)}catch(e){console.error(e)}this._config=e,this.textClickToEnter=e.options.textClickToEnter}return Promise.resolve()}id(){return"??"==this._config.id?null:this._config.id}setting(e,t){if(!t)return this._config.options[e];this._config.options[e]=t}},P={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthXLarge:350,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:5,smallSpacer:10,mediumSpacer:25,largeSpacer:50,xLargeSpacer:100,xxLargeSpacer:200,xxxLargeSpacer:400,appListSpacerRowHeight:100,appListSpacerColMinWidth:100,appListSpacerColMaxWidth:200,objectWorkspaceColWidth:20,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:150,labelWidthXXLarge:200,labelWidthXXXLarge:280,labelWidthCheckbox:0,hideMobile:!1},T={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:1,smallSpacer:1,mediumSpacer:10,largeSpacer:20,xLargeSpacer:50,xxLargeSpacer:100,xxxLargeSpacer:120,appListSpacerRowHeight:10,appListSpacerColMinWidth:1,appListSpacerColMaxWidth:1,objectWorkspaceColWidth:1,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:120,labelWidthXXLarge:120,labelWidthCheckbox:0,hideMobile:!0},L={config:function(){return window.innerWidth<768?T:P},icons:["500px","address-book","address-book-o","address-card","address-card-o","adjust","adn","align-center","align-justify","align-left","align-right","amazon","ambulance","american-sign-language-interpreting","anchor","android","angellist","angle-double-down","angle-double-left","angle-double-right","angle-double-up","angle-down","angle-left","angle-right","angle-up","apple","archive","area-chart","arrow-circle-down","arrow-circle-left","arrow-circle-o-down","arrow-circle-o-left","arrow-circle-o-right","arrow-circle-o-up","arrow-circle-right","arrow-circle-up","arrow-down","arrow-left","arrow-right","arrow-up","arrows","arrows-alt","arrows-h","arrows-v","asl-interpreting","assistive-listening-systems","asterisk","at","audio-description","automobile","backward","balance-scale","ban","bandcamp","bank","bar-chart","bar-chart-o","barcode","bars","bath","bathtub","battery","battery-0","battery-1","battery-2","battery-3","battery-4","battery-empty","battery-full","battery-half","battery-quarter","battery-three-quarters","bed","beer","behance","behance-square","bell","bell-o","bell-slash","bell-slash-o","bicycle","binoculars","birthday-cake","bitbucket","bitbucket-square","bitcoin","black-tie","blind","bluetooth","bluetooth-b","bold","bolt","bomb","book","bookmark","bookmark-o","braille","briefcase","btc","bug","building","building-o","bullhorn","bullseye","bus","buysellads","cab","calculator","calendar","calendar-check-o","calendar-minus-o","calendar-o","calendar-plus-o","calendar-times-o","camera","camera-retro","car","caret-down","caret-left","caret-right","caret-square-o-down","caret-square-o-left","caret-square-o-right","caret-square-o-up","caret-up","cart-arrow-down","cart-plus","cc","cc-amex","cc-diners-club","cc-discover","cc-jcb","cc-mastercard","cc-paypal","cc-stripe","cc-visa","certificate","chain","chain-broken","check","check-circle","check-circle-o","check-square","check-square-o","chevron-circle-down","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-down","chevron-left","chevron-right","chevron-up","child","chrome","circle","circle-o","circle-o-notch","circle-thin","clipboard","clock-o","clone","close","cloud","cloud-download","cloud-upload","cny","code","code-fork","codepen","codiepie","coffee","cog","cogs","columns","comment","comment-o","commenting","commenting-o","comments","comments-o","compass","compress","connectdevelop","contao","copy","copyright","creative-commons","credit-card","credit-card-alt","crop","crosshairs","css3","cube","cubes","cut","cutlery","dashboard","dashcube","database","deaf","deafness","dedent","delicious","desktop","deviantart","diamond","digg","dollar","dot-circle-o","download","dribbble","drivers-license","drivers-license-o","dropbox","drupal","edge","edit","eercast","eject","ellipsis-h","ellipsis-v","empire","envelope","envelope-o","envelope-open","envelope-open-o","envelope-square","envira","eraser","etsy","eur","euro","exchange","exclamation","exclamation-circle","exclamation-triangle","expand","expeditedssl","external-link","external-link-square","eye","eye-slash","eyedropper","fa","facebook","facebook-f","facebook-official","facebook-square","fast-backward","fast-forward","fax","feed","female","fighter-jet","file","file-archive-o","file-audio-o","file-code-o","file-excel-o","file-image-o","file-movie-o","file-o","file-pdf-o","file-photo-o","file-picture-o","file-powerpoint-o","file-sound-o","file-text","file-text-o","file-video-o","file-word-o","file-zip-o","files-o","film","filter","fire","fire-extinguisher","firefox","first-order","flag","flag-checkered","flag-o","flash","flask","flickr","floppy-o","folder","folder-o","folder-open","folder-open-o","font","font-awesome","fonticons","fort-awesome","forumbee","forward","foursquare","free-code-camp","frown-o","futbol-o","gamepad","gavel","gbp","ge","gear","gears","genderless","get-pocket","gg","gg-circle","gift","git","git-square","github","github-alt","github-square","gitlab","gittip","glass","glide","glide-g","globe","google","google-plus","google-plus-circle","google-plus-official","google-plus-square","google-wallet","graduation-cap","gratipay","grav","group","h-square","hacker-news","hand-grab-o","hand-lizard-o","hand-o-down","hand-o-left","hand-o-right","hand-o-up","hand-paper-o","hand-peace-o","hand-pointer-o","hand-rock-o","hand-scissors-o","hand-spock-o","hand-stop-o","handshake-o","hard-of-hearing","hashtag","hdd-o","header","headphones","heart","heart-o","heartbeat","history","home","hospital-o","hotel","hourglass","hourglass-1","hourglass-2","hourglass-3","hourglass-end","hourglass-half","hourglass-o","hourglass-start","houzz","html5","i-cursor","id-badge","id-card","id-card-o","ils","image","imdb","inbox","indent","industry","info","info-circle","inr","instagram","institution","internet-explorer","intersex","ioxhost","italic","joomla","jpy","jsfiddle","key","keyboard-o","krw","language","laptop","lastfm","lastfm-square","leaf","leanpub","legal","lemon-o","level-down","level-up","life-bouy","life-buoy","life-ring","life-saver","lightbulb-o","line-chart","link","linkedin","linkedin-square","linode","linux","list","list-alt","list-ol","list-ul","location-arrow","lock","long-arrow-down","long-arrow-left","long-arrow-right","long-arrow-up","low-vision","magic","magnet","mail-forward","mail-reply","mail-reply-all","male","map","map-marker","map-o","map-pin","map-signs","mars","mars-double","mars-stroke","mars-stroke-h","mars-stroke-v","maxcdn","meanpath","medium","medkit","meetup","meh-o","mercury","microchip","microphone","microphone-slash","minus","minus-circle","minus-square","minus-square-o","mixcloud","mobile","mobile-phone","modx","money","moon-o","mortar-board","motorcycle","mouse-pointer","music","navicon","neuter","newspaper-o","object-group","object-ungroup","odnoklassniki","odnoklassniki-square","opencart","openid","opera","optin-monster","outdent","pagelines","paint-brush","paper-plane","paper-plane-o","paperclip","paragraph","paste","pause","pause-circle","pause-circle-o","paw","paypal","pencil","pencil-square","pencil-square-o","percent","phone","phone-square","photo","picture-o","pie-chart","pied-piper","pied-piper-alt","pied-piper-pp","pinterest","pinterest-p","pinterest-square","plane","play","play-circle","play-circle-o","plug","plus","plus-circle","plus-square","plus-square-o","podcast","power-off","print","product-hunt","puzzle-piece","qq","qrcode","question","question-circle","question-circle-o","quora","quote-left","quote-right","ra","random","ravelry","rebel","recycle","reddit","reddit-alien","reddit-square","refresh","registered","remove","renren","reorder","repeat","reply","reply-all","resistance","retweet","rmb","road","rocket","rotate-left","rotate-right","rouble","rss","rss-square","rub","ruble","rupee","s15","safari","save","scissors","scribd","search","search-minus","search-plus","sellsy","send","send-o","server","share","share-alt","share-alt-square","share-square","share-square-o","shekel","sheqel","shield","ship","shirtsinbulk","shopping-bag","shopping-basket","shopping-cart","shower","sign-in","sign-language","sign-out","signal","signing","simplybuilt","sitemap","skyatlas","skype","slack","sliders","slideshare","smile-o","snapchat","snapchat-ghost","snapchat-square","snowflake-o","soccer-ball-o","sort","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-asc","sort-desc","sort-down","sort-numeric-asc","sort-numeric-desc","sort-up","soundcloud","space-shuttle","spinner","spoon","spotify","square","square-o","stack-exchange","stack-overflow","star","star-half","star-half-empty","star-half-full","star-half-o","star-o","steam","steam-square","step-backward","step-forward","stethoscope","sticky-note","sticky-note-o","stop","stop-circle","stop-circle-o","street-view","strikethrough","stumbleupon","stumbleupon-circle","subscript","subway","suitcase","sun-o","superpowers","superscript","support","table","tablet","tachometer","tag","tags","tasks","taxi","telegram","television","tencent-weibo","terminal","text-height","text-width","th","th-large","th-list","themeisle","thermometer","thermometer-0","thermometer-1","thermometer-2","thermometer-3","thermometer-4","thermometer-empty","thermometer-full","thermometer-half","thermometer-quarter","thermometer-three-quarters","thumb-tack","thumbs-down","thumbs-o-down","thumbs-o-up","thumbs-up","ticket","times","times-circle","times-circle-o","times-rectangle","times-rectangle-o","tint","toggle-down","toggle-left","toggle-off","toggle-on","toggle-right","toggle-up","trademark","train","transgender","transgender-alt","trash","trash-o","tree","trello","tripadvisor","trophy","truck","try","tty","tumblr","tumblr-square","turkish-lira","tv","twitch","twitter","twitter-square","umbrella","underline","undo","universal-access","university","unlink","unlock","unlock-alt","unsorted","upload","usb","usd","user","user-circle","user-circle-o","user-md","user-o","user-plus","user-secret","user-times","users","vcard","vcard-o","venus","venus-double","venus-mars","viacoin","viadeo","viadeo-square","video-camera","vimeo","vimeo-square","vine","vk","volume-control-phone","volume-down","volume-off","volume-up","warning","wechat","weibo","weixin","whatsapp","wheelchair","wheelchair-alt","wifi","wikipedia-w","window-close","window-close-o","window-maximize","window-minimize","window-restore","windows","won","wordpress","wpbeginner","wpexplorer","wpforms","wrench","xing","xing-square","y-combinator","y-combinator-square","yahoo","yc","yc-square","yelp","yen","yoast","youtube","youtube-play","youtube-square"]};var O=i(3794),R=i.n(O);class q{constructor(e){this.AB=e,this.errors=[]}addError(e,t){this.errors.push({name:e,message:t})}pass(){return 0==this.errors.length}fail(){return this.errors.length>0}toValidationObject(){var e={error:"E_VALIDATION",invalidAttributes:{}},t=e.invalidAttributes;return this.errors.forEach((e=>{t[e.name]=t[e.name]||[],t[e.name].push(e)})),e}updateForm(e){var t=this.toValidationObject();this.AB.Validation.isFormValidationError(t,e)}updateGrid(e,t){var i=this.toValidationObject();this.AB.Validation.isGridValidationError(i,e,t)}}class M extends(a()){constructor(e){super(e),this.Config=p.Z,this.Class.FilterComplex=h(),this.Account=f,this.Dialog=b,this.Multilingual=w,this.Network=D,this.Storage=V,this.Tenant=N,this.Webix=R(),this.ClassUI=g.Z,this.Class.ABViewManager=B(),this.Analytics={log:()=>{},logError:()=>{}},this.Lock=class{constructor(){}acquire(){return Promise.resolve()}release(){return Promise.resolve()}},this.UISettings=L,this.Validation={validator:()=>new q(this),errorSailsCleanup:function(e){return e&&(e.error&&"E_UNKNOWN"==e.error&&e.raw&&e.raw.length>0&&(e=e.raw[0]),e.err&&(e=e.err),e.data&&e.data.error&&"E_VALIDATION"==e.data.error&&(e=e.data)),e},isFormValidationError:function(e,t){var i=!1;if(e&&((e=this.errorSailsCleanup(e)).error&&"E_VALIDATION"==e.error||e.code&&"E_VALIDATION"==e.code)){var s=e.invalidAttributes;if(s){var a=!1;for(var n in s)if(t.elements[n]){var r=s[n],o=[];r.forEach((function(e){o.push(e.message)})),t.markInvalid(n,o.join(", ")),i||(t.elements[n].focus(),i=!0),a=!0}if(a)return!0}}return!1},isGridValidationError:function(e,t,i){if(e&&((e=this.errorSailsCleanup(e)).error&&"E_VALIDATION"==e.error||e.code&&"E_VALIDATION"==e.code)){var s=e.invalidAttributes;if(s){var a=!1;for(var n in s){i.addCellCss(t,n,"webix_invalid"),i.addCellCss(t,n,"webix_invalid_cell");var r=[];s[n].forEach((e=>{r.push(e.message)})),webix.alert({text:n+": "+r.join(", ")}),a=!0}if(i.refresh(t),i.clearSelection(),a)return!0}}return!1}},this.Definitions={},this.on("error",(e=>{console.error(e)})),this._plugins=[],this._pendingNetworkRequests={},this.Network.on("definition.create",((e,t,i)=>{var s=this._pendingNetworkRequests[e.uuid];if(t)return void s?.reject(t);var a={id:i.id,data:i};this.emit("ab.abdefinition.create",a);let n=this.definitionNew(i);s?.resolve(n)})),this.Network.on("definition.update",((e,t,i)=>{var s=this._pendingNetworkRequests[e.uuid];if(t)return t.toString().indexOf("Not Found")>-1?this.definitionCreate(e.values).then(s?.resolve).catch(s?.reject):void s?.reject(t);this._definitions[e.id]=i;var a={id:i.id,data:i};this.emit("ab.abdefinition.update",a),s?.resolve(i)})),this.Network.on("definition.delete",((e,t,i)=>{var s=this._pendingNetworkRequests[e.uuid];if(t)s?.reject(t);else{delete this._definitions[e.id];var a={id:e.id,data:i};this.emit("ab.abdefinition.delete",a),s?.resolve()}}))}async init(){var e=[];e.push(this.Account.init(this)),e.push(this.Multilingual.init(this)),e.push(this.Network.init(this)),e.push(this.Tenant.init(this)),await Promise.all(e),await this.Storage.init(this);var t=await this.Storage.get("local_settings");return this._localSettings=t||{},this.on("ab.abdefinition.create",(e=>{if("string"==typeof e.data.json)try{e.data.json=JSON.parse(e.data.json)}catch(e){console.log(e)}this._definitions[e.id]=e.data,this.definitionSync("created",e.id,e.data)})),this.on("ab.abdefinition.update",(e=>{if("string"==typeof e.data.json)try{e.data.json=JSON.parse(e.data.json)}catch(e){console.log(e)}this._definitions[e.id]=e.data,this.definitionSync("updated",e.id,e.data)})),this.on("ab.abdefinition.delete",(e=>{if("string"==typeof e.data.json)try{e.data.json=JSON.parse(e.data.json)}catch(e){console.log(e)}delete this._definitions[e.id],this.definitionSync("destroyed",e.id,e.data)})),super.init()}async definitionCreate(e){return void 0===e.id&&(e.id=this.uuid(),e.json.id=e.id),new Promise(((t,i)=>{var s=this.uuid();this._pendingNetworkRequests[s]={resolve:t,reject:i};var a={key:"definition.create",context:{uuid:s}};this.Network.post({url:"/definition/create",data:e},a).catch((t=>{var i="Error attempting to CREATE definitions";"E_NOPERM"==t.code&&(i="User Doesn't have permission to CREATE definitions"),this.notify.developer(t,{context:"ABFactory.definitionCreate()",message:i,def:e})}))}))}async definitionDestroy(e){return new Promise(((t,i)=>{var s=this.uuid();this._pendingNetworkRequests[s]={resolve:t,reject:i};var a={key:"definition.delete",context:{id:e,uuid:s}};this.Network.delete({url:`/definition/${e}`},a).catch((t=>{var i="Error attempting to DESTROY definitions";"E_NOPERM"==t.code&&(i="User Doesn't have permission to DELETE definitions"),this.notify.developer(t,{context:"ABFactory.definitionDestroy()",message:i,id:e})}))}))}async definitionUpdate(e,t){return new Promise(((i,s)=>{var a=this.uuid();this._pendingNetworkRequests[a]={resolve:i,reject:s};var n={key:"definition.update",context:{id:e,uuid:a,values:t}};this.Network.put({url:`/definition/${e}`,data:t},n).catch((e=>{var t="Error attempting to UPDATE definitions";"E_NOPERM"==e.code&&(t="User Doesn't have permission to UPDATE definitions"),this.notify.developer(e,{context:"ABFactory.definitionUpdate()",message:t})}))}))}notify(e,t,i){console.error("TODO: ABFactory.notify(): pass error off to analytics"),console.error(t),console.error(i)}plugins(){return this._plugins}pluginLoad(e){this._plugins.push(e)}alert(e){R().alert(e)}cloneDeep(e){return r().cloneDeep(e)}error(e,...t){var i={message:`ABFactory[${this.Tenant.id()}]:${e.toString()}`};console.error(i.message),e instanceof Error&&(i.error=e,console.error(e)),t&&t.length>0&&t.forEach((e=>{if(e instanceof Error&&(i.error=e,console.error(e)),"object"==typeof e)for(var t in e)i[t]=e[t],console.error(t,e[t])})),this.emit("error",i)}jobID(){return(0,u.x0)()}Label(){return(...e)=>this.Multilingual.label(...e)}localSettings(e,t){return void 0===t?this._localSettings[e]:(this._localSettings[e]=t,this.Storage.set("local_settings",this._localSettings))}log(e,...t){console.log(e),t.forEach((e=>{console.log(e)}))}isUUID(e){return RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i").test(e)}merge(...e){return r().merge(...e)}orderBy(...e){return r().orderBy(...e)}uniq(...e){return r().uniq(...e)}kebabCase(...e){return r().kebabCase(...e)}sumBy(...e){return r().sumBy(...e)}meanBy(...e){return r().meanBy(...e)}maxBy(...e){return r().maxBy(...e)}minBy(...e){return r().minBy(...e)}uuid(){return(0,c.Z)()}warn(e,...t){console.warn(e),t.forEach((e=>{console.warn(e)}))}toDate(e="",t={}){if(!e)return;t.ignoreTime&&(e=e.replace(/T.*/,""));let i=t.format?l()(e,t.format):l()(e);return["YYYY-MM-DD","YYYY/MM/DD","DD/MM/YYYY","MM/DD/YYYY","DD-MM-YYYY","MM-DD-YYYY"].forEach((t=>{i&&i.isValid()||(i=l()(e,t))})),new Date(i)}toDateFormat(e,t){if(!e)return"";let i=l()(e);return t.localeCode&&i.locale(t.localeCode),i.format(t.format)}subtractDate(e,t,i){return l()(e).subtract(t,i).toDate()}addDate(e,t,i){return l()(e).add(t,i).toDate()}isString(...e){return r().isString(e)}}const U=M},9885:(e,t,i)=>{const s=i(4312);var a=i(7069);e.exports=class extends a{constructor(e,t){var i;super(["label","description"],t),e.json=e.json||{},this.id=e.id,this.type=e.type||"application",this.json=e.json,"string"==typeof this.json&&(this.json=JSON.parse(this.json)),this.name=e.name||this.json.name||"",this.icon=e.icon||"fa-rocket",this.isSystemObject=void 0!==(i=e.isSystemObject)&&""!==i&&"false"!==i&&"0"!==i&&("true"===i||"1"===i||i),this.roleAccess=e.roleAccess||[],Array.isArray(this.roleAccess)||(this.roleAccess=[this.roleAccess]),this.roleAccess=this.roleAccess.filter((e=>e)),this.isAccessManaged=JSON.parse(e.isAccessManaged||!1),this.accessManagers=e.accessManagers,"string"==typeof this.accessManagers&&(this.accessManagers=JSON.parse(this.accessManagers)),this.isTranslationManaged=JSON.parse(e.isTranslationManaged||!1),this.translationManagers=e.translationManagers,"string"==typeof this.translationManagers&&(this.translationManagers=JSON.parse(this.translationManagers)),this.objectIDs=e.json.objectIDs||[],this.queryIDs=e.json.queryIDs||[],this.datacollectionIDs=e.json.datacollectionIDs||[];let s=[];(e.json.pageIDs||[]).forEach((e=>{var t=this.AB.definitionByID(e);t?s.push(this.pageNew(t)):this.emit("warning",`App[${this.id}] is referenceing an unknown Page[${e}]`,{appID:this.id,pageID:e})})),this._pages=s;var a=[],n=[];(e.json.processIDs||[]).forEach((e=>{var t=this.AB.processByID(e);t?a.push(t):this.emit("warning","Application is referencing an unknown process.",{appID:this.id,processID:e})})),e.json.processIDs&&(e.json.processIDs=e.json.processIDs.filter((e=>-1==n.indexOf(e)))),this._processes=a,this.processIDs=e.json.processIDs||[],e.json.objectListSettings=e.json.objectListSettings||{},this.objectListSettings=this.objectListSettings||{},this.objectListSettings.isOpen=JSON.parse(e.json.objectListSettings.isOpen||!1),this.objectListSettings.searchText=e.json.objectListSettings.searchText||"",this.objectListSettings.sortDirection=e.json.objectListSettings.sortDirection||"asc",this.objectListSettings.isGroup=JSON.parse(e.json.objectListSettings.isGroup||!1),e.translations=e.translations||e.json.translations,super.fromValues(e)}isAccessibleForRoles(e){var t=!1;return this.isAccessManaged?(parseInt(this.accessManagers.useRole)&&(e||[]).forEach((e=>{this.accessManagers.role.indexOf(e.uuid||e)>-1&&(t=!0)})),t||((this.pages()||[]).forEach((i=>{i.isAccessibleForRoles(e)&&(t=!0)})),t)):((e||[]).forEach((e=>{this.roleAccess.indexOf(e.uuid||e)>-1&&(t=!0)})),t)}toObj(){return this.json=super.toObj(),this.json.name=this.name,this.json.objectIDs=this.objectIDs,this.json.objectListSettings=this.objectListSettings,this.json.queryIDs=this.queryIDs,this.json.datacollectionIDs=this.datacollectionIDs,this.json.pageIDs=(this._pages||[]).map((e=>e.id)),this.json.processIDs=(this._processes||[]).map((e=>e.id)),{id:this.id,type:this.type||"application",name:this.name,icon:this.icon,isSystemObject:this.isSystemObject,json:this.json,roleAccess:this.roleAccess,translations:this.json.translations,isAccessManaged:this.isAccessManaged,isTranslationManaged:this.isTranslationManaged,accessManagers:this.accessManagers,translationManagers:this.translationManagers}}mobileApps(e=(()=>!0)){return(this._mobileApps||[]).filter(e)}datacollectionsExcluded(e=(()=>!0)){return this.AB.datacollections((e=>-1==this.datacollectionIDs.indexOf(e.id))).filter(e)}datacollectionsIncluded(e=(()=>!0)){return this.AB.datacollections((e=>this.datacollectionIDs.indexOf(e.id)>-1)).filter(e)}objectsExcluded(e=(()=>!0)){return this.AB.objects((e=>-1==this.objectIDs.indexOf(e.id))).filter(e)}objectsIncluded(e=(()=>!0)){return this.AB.objects((e=>this.objectIDs.indexOf(e.id)>-1)).filter(e)}connectedObjects(e){if(console.error("ABApplicationCore.connectedObjects(): who is calling this?"),""==e)return[];var t=this.AB.objectByID(e).connectFields(),i={};t.forEach((e=>{i[e.settings.linkObject]=this.AB.objectByID(e.settings.linkObject)}));var s=[];return Object.keys(i).forEach((function(e){s.push({id:this[e].id,value:this[e].label})}),i),s}connectedFields(e,t){console.error("!!! Who is calling this?");var i=this.AB.objectByID(e).connectFields((e=>e.settings.linkObject==t)),s=[];return i.forEach((e=>{s.push({id:e.columnName,value:e.label})})),s}pages(e=(()=>!0),t=!1){var i=[];return!this._pages||this._pages.length<1||(e&&t?(i=this._pages.filter(e)).length<1&&this._pages.forEach((s=>{var a=s.pages(e,t);a&&a.length>0&&(i=a)})):i=(this._pages||[]).filter(e)),i}processes(e=(()=>!0)){return this._processes.filter(e)}hasProcess(e){return!(!e||!e.id)&&this.processIDs.indexOf(e.id)>-1}views(e){var t=[],i=[],s=[];return(!this._pages||this._pages.length<1)&&(!this._views||this._views.length<1)||(e?(this._views&&(i=this._views.filter(e)).length<1&&this._views.forEach((t=>{var s=t.views(e,!0);s&&s.length>0&&(i=s)})),i.length?t=i:(t=this._pages.filter(e)).length<1&&function i(s){s._pages&&s._pages.length&&s._pages.forEach((s=>{var a=s.views(e,!0);if(a&&a.length>0&&(t=a),t.length<1){var n=s.pages(e,!0);n&&n.length>0&&(t=n),t.length<1&&i(s)}}))}(this)):(this._views&&(i=this._views).length&&i.forEach((e=>{var t=e.views((()=>!0),!0);t&&t.length&&(i=i.concat(t))})),this._pages&&(s=this._pages).length&&s.forEach((e=>{var t=e.views((()=>!0),!0);t&&t.length&&(i=i.concat(t));var a=e.pages((()=>!0),!0);a&&a.length&&(s=s.concat(a),a.forEach((e=>{var t=e.views((()=>!0),!0);t&&t.length&&(i=i.concat(t))})))})),t=t.concat(s,i))),t}viewAll(e=(()=>!0)){return s.allViews(e)}queriesExcluded(e=(()=>!0)){return this.AB.queries((e=>-1==this.queryIDs.indexOf(e.id))).filter(e)}queriesIncluded(e=(()=>!0)){return this.AB.queries((e=>this.queryIDs.indexOf(e.id)>-1)).filter(e)}urlResolve(e){var t=e.split("/"),i=(t,s)=>{if(0==s.length)return t;var a=s.shift();if("#"==a)return i(this,s);if(Array.isArray(t))return t=t.filter((function(e){return e.id==a}))[0],i(t,s);if(t&&t[a])return i(t[a],s);if("_objects"==a){console.error(new Error("REFACTOR: old objectBy url reference:"));var n=s.shift();return i(this.AB.objectByID(n),s)}return console.error("!!! failed to lookup url:"+e),null};return i(this,t)}urlPointer(e){return e?"#/"+this.id+"/":"#/"}urlObject(e){return this.urlPointer(e)+"_objects/"}urlPage(e){return this.urlPointer(e)+"_pages/"}urlQuery(e){return this.urlPointer(e)+"_queries/"}get objectlistIsOpen(){return this.objectListSettings.isOpen}set objectlistIsOpen(e){this.objectListSettings.isOpen=e}get objectlistSearchText(){return this.objectListSettings.searchText}set objectlistSearchText(e){this.objectListSettings.searchText=e}get objectlistSortDirection(){return this.objectListSettings.sortDirection}set objectlistSortDirection(e){this.objectListSettings.sortDirection=e}get objectlistIsGroup(){return this.objectListSettings.isGroup}set objectlistIsGroup(e){this.objectListSettings.isGroup=e}pageNew(e){return e.key="page",s.newView(e,this,null)}pageByID(e){return this.pages((t=>t.id==e))[0]}viewNew(e,t,i){return s.newView(e,t,i)}cloneDeep(){throw new Error("ABApplicationCore.cloneDeep(): Depreciated!  Use AB.cloneDeep() instead.")}}},1748:(e,t,i)=>{const s=i(7069);var a={id:"uuid",label:"",object:{},query:{},settings:{datasourceID:"",linkDatacollectionID:"",linkFieldID:"",objectWorkspace:{filterConditions:{glue:"and",rules:[]},sortFields:[]},loadAll:!1,preventPopulate:!1,isQuery:!1,fixSelect:"",syncType:1}};const n=[];var r=null;function o(){if(0!=n.length){var e=n.shift();e.fn(),r=setTimeout(o,e.timeout)}else r=null}function l(e,t=20){n.push({fn:e,timeout:t}),r||o()}e.exports=class extends s{constructor(e,t){super(["label"],t),e=e||{},this.fromValues(e),this.__dataCollection=this._dataCollectionNew([]),this.refreshFilterConditions(),this.__bindComponentIds=[],this.__flexComponentIds=[],this._dataStatus=this.dataStatusFlag.notInitial,this.__filterCond=null}static contextKey(){return"datacollection"}fromValues(e){if(this.id=e.id,this.name=e.name||null,this.type=e.type||"datacollection",e.settings=e.settings||{},this.settings=this.settings||{},this.settings.linkDatacollectionID=e.settings.linkDatacollectionID||a.settings.linkDatacollectionID,this.settings.linkFieldID=e.settings.linkFieldID||a.settings.linkFieldID,this.settings.objectWorkspace=e.settings.objectWorkspace||{filterConditions:a.settings.objectWorkspace.filterConditions,sortFields:a.settings.objectWorkspace.sortFields},this.settings.fixSelect=e.settings.fixSelect,this.settings.loadAll=JSON.parse(e.settings.loadAll||a.settings.loadAll),this.settings.isQuery=JSON.parse(e.settings.isQuery||a.settings.isQuery),this.settings.preventPopulate=JSON.parse(e.settings.preventPopulate||a.settings.preventPopulate),this.settings.syncType=parseInt(e.settings.syncType||a.settings.syncType),this.__datasource=null,this.settings.datasourceID=e.settings.datasourceID||a.settings.datasourceID,this.settings.datasourceID){var t=this.AB.objectByID(this.settings.datasourceID);t||(t=this.AB.queryByID(this.settings.datasourceID)),t?(this.__datasource=t,this.settings.isQuery="query"===t.type,this.settings.isQuery&&this.__datasource.isGroup&&(this.__treeCollection||(this.__treeCollection=this._treeCollectionNew()),this.__isGroup=!0)):console.error(`ABDataCollection[${this.name}][${this.id}] unable to find datasource [${this.settings.datasourceID}]`)}super.fromValues(e)}toObj(){var e=super.toObj();return{id:this.id,name:this.name||this.label,type:this.type||"datacollection",settings:this.AB.cloneDeep(this.settings||{}),translations:e.translations}}async save(){return this.id||(this.label=this.label||this.name),await super.save(),this}destroy(){var e=()=>new Promise(((e,t)=>{this.AB.applications().then((i=>{var s=[];return i.filter((e=>e.datacollectionsIncluded((e=>e.id==this.id)))).forEach((e=>{s.push(e.datacollectionRemove(this))})),Promise.all(s).then(e).catch(t)}))}));return Promise.resolve().then((()=>e())).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}get $dc(){return this.__dataCollection}get datasource(){if(!this.__datasource){if(this.id&&this.name){var e=new Error(`DataCollection[${this.name}][${this.id}] missing reference datasource`);this.AB.notify("builder",e,{datacollection:this.toObj()})}return null}var t=this.AB.objectByID(this.__datasource.id);return t||(t=this.AB.queryByID(this.__datasource.id)),t}set datasource(e){this.__datasource=e,this.refreshFilterConditions()}get sourceType(){return this.settings.isQuery?"query":"object"}get datacollectionLink(){return this.AB?this.AB.datacollectionByID(this.settings.linkDatacollectionID):null}get fieldLink(){let e=this.datasource;return e?e.fieldByID(this.settings.linkFieldID):null}get model(){let e=this.datasource;return e?e.model():null}get dataStatusFlag(){return{notInitial:0,initializing:1,initialized:2}}get dataStatus(){return this._dataStatus}setCursor(e){if(this.settings.fixSelect&&("_FirstRecordDefault"!=this.settings.fixSelect||this.settings.fixSelect==e))return;if(this.__treeCollection){this.setCursorTree(e);let t=this.__treeCollection.getCursor();if(t){let i=this.__treeCollection.getItem(t);i&&(e=i._itemId)}}let t=this.__dataCollection;t&&(null==e?t.setCursor(null):t.getCursor()==e?this.emit("changeCursor",this.getCursor()):t.exists(e)&&t.setCursor(e))}setCursorTree(e){let t=this.__treeCollection;if(t&&t.getCursor()!=e)if(t.find({id:e},!0))t.setCursor(e);else{let i=t.find({_itemId:e,$parent:0},!0);i?t.setCursor(i.id):t.setCursor(null)}}getCursor(e=!1){if(e&&this.__treeCollection){let e=this.__treeCollection.getCursor();if(e){let t=this.__treeCollection.getItem(e);this.__treeCollection.filter((e=>e._itemId==t._itemId));let i=this.__treeCollection.serialize()[0]||null;return this.refreshLinkCursor(),i}}let t=this.__dataCollection;if(null==t)return null;let i=t.getCursor();return t.getItem(i)}getFirstRecord(){var e=this.__dataCollection;if(null==e)return null;var t=e.getFirstId();return e.getItem(t)}getNextRecord(e){var t=this.__dataCollection;if(null==t)return null;var i=t.getNextId(e.id);return t.getItem(i)}refreshLinkCursor(){let e,t=this.datacollectionLink;t&&(e=t.getCursor());let i=t=>null==e||this.isParentFilterValid(t);this.__dataCollection&&this.__dataCollection.filter(i),this.__treeCollection&&this.__treeCollection.filter(i)}setStaticCursor(){if(this.settings.fixSelect)if("_CurrentUser"==this.settings.fixSelect){var e=this.currentUserUsername(),t=this.datasource.fields((e=>"user"==e.key)),i=this.__dataCollection.find((i=>{var s=!1;return t.forEach((t=>{s||null==i[t.columnName]||(i[t.columnName].filter?s=i[t.columnName].filter((t=>t.id==e)).length>0:i[t.columnName]==e&&(s=!0))})),s}),!0);i&&(this.__dataCollection.setCursor(i.id),this.setCursorTree(i.id))}else if("_FirstRecord"==this.settings.fixSelect||"_FirstRecordDefault"==this.settings.fixSelect){let e=this.__dataCollection.getCursor();if(!e||e&&!this.__dataCollection.exists(e)){let e=this.__dataCollection.getFirstId();this.__dataCollection.setCursor(e||null),this.setCursorTree(e)}}else this.__dataCollection.setCursor(this.settings.fixSelect),this.setCursorTree(this.settings.fixSelect)}filterCondition(e=null){this.__filterCond=e}init(){if(this.initialized)return;this.initialized=!0,this.__dataCollection.___AD.onAfterCursorChange||(this.__dataCollection.___AD.onAfterCursorChange=this.__dataCollection.attachEvent("onAfterCursorChange",(()=>{var e=this.getCursor();this.emit("changeCursor",e)})));let e=(e,t,i="id")=>Array.isArray(e)?e.filter((e=>(e[i]||e)==t)).length>0:e&&(e[i]||e)==t;this.on("ab.datacollection.create",(t=>{let i=this.datasource;if(!i)return;if(!t||!t.data)return;let s=!1,a=[];Promise.resolve().then((()=>new Promise(((e,n)=>{if(i instanceof this.AB.Class.ABObjectQuery){let r=i.objects((e=>e.id==t.objectId))||[];if(s=r.length>0,!s)return e();let o={glue:"or",rules:[]};r.forEach((e=>{let s=t.data[`${e.PK()}`];s&&o.rules.push({key:`${e.alias||i.objectAlias(e.id)}.${e.PK()}`,rule:"equals",value:s})})),i.model().findAll({where:o}).then((t=>{a=t.data||[],a.forEach((e=>{delete e.id})),e()})).catch(n)}else s=i.id==t.objectId,a=[t.data],e()})))).then((()=>{if(s&&(i.model().normalizeData(a),(a||[]).forEach((e=>{this.isValidData(e)&&(this.__dataCollection.exists(e[`${i.PK()}`])||this.__reloadWheres?!this.__dataCollection.exists(e[`${i.PK()}`])&&this.__reloadWheres&&this.isParentFilterValid(e)&&this.__bindComponentIds.concat(this.__flexComponentIds).forEach((e=>{if($$(e+"_reloadView"))return!1;var t=0,i=$$(e).getParentView();$$(e).getParentView().index?t=$$(e).getParentView().index($$(e)):$$(e).getParentView().getParentView().index&&(i=$$(e).getParentView().getParentView(),t=$$(e).getParentView().getParentView().index($$(e).getParentView()));var s=this;if(i.addView){var a=this.AB.Label();i.addView({id:e+"_reloadView",view:"button",value:a("New data available. Click to reload."),css:"webix_primary webix_warn",click:function(e,t){s.reloadData(),$$(e).getParentView().removeView(e)}},t)}})):(this.__dataCollection.add(e,0),this.emit("create",e)))})),this.__treeCollection&&this.parseTreeCollection({data:a})),!(i instanceof this.AB.Class.ABObjectQuery)){let s=this.datasource.connectFields((e=>e.datasourceLink&&e.datasourceLink.id==t.objectId));if(a=a[0],a&&s&&s.length>0){let t=s[0].object.PK();a.id||"id"==t||(a.id=a[t]),this.__dataCollection.find({}).forEach((n=>{let r={};s.forEach((i=>{var s={};i&&i.fieldLink&&(s=a[i.fieldLink.relationName()]||{});let o=n[i.relationName()]||{},l=e(s,n.id,t);Array.isArray(o)&&o.filter((e=>e==a.id||e.id==a.id||e[t]==a.id)).length<1&&l?(o.push(a),r[i.relationName()]=o,r[i.columnName]=r[i.relationName()].map((e=>e.id||e[t]||e))):Array.isArray(o)||o==a.id&&o.id==a.id&&o[t]==a.id||!l||(r[i.relationName()]=a,r[i.columnName]=a.id||a)})),Object.keys(r).length>0&&(i.model().normalizeData(r),this.__dataCollection.updateItem(n.id,r),this.__treeCollection&&this.__treeCollection.updateItem(n.id,r),this.emit("update",this.__dataCollection.getItem(n.id)))}))}}this.refreshLinkCursor(),this.setStaticCursor()}))})),this.on("ab.datacollection.update",(t=>{let i=this.datasource;if(!i)return;let s=t.data;if(!s)return;let a=!1,n=!1,r=[],o=[],l={};if(i instanceof this.AB.Class.ABObjectQuery){let e=i.objects((e=>e.id==t.objectId))||[];a=e.length>0,a&&((e||[]).forEach((e=>{r=r.concat(this.__dataCollection.find((t=>t[`${this.datasource.objectAlias(e.id)}.${e.PK()}`]==(s[e.PK()]||s.id))).map((e=>e.id))||[]),this.__treeCollection&&(o=o.concat(this.__treeCollection.find((t=>t[`${this.datasource.objectAlias(e.id)}.${e.PK()}`]==(s[e.PK()]||s.id))).map((e=>e.id))||[]))})),n=r.length>0,l=this._queryUpdateData(e,s))}else a=i.id==t.objectId,a&&(s.id||"id"==i.PK()||(s.id=s[i.PK()]),r.push(s.id),n=this.__dataCollection.exists(s.id),l=s);if(a)if(n)if(this.isValidData(l)){this.__dataCollection&&(r=this.AB.uniq(r),r.forEach((e=>{this.__dataCollection.updateItem(e,l)}))),this.__treeCollection&&(o=this.AB.uniq(o),o.forEach((e=>{this.__treeCollection.updateItem(e,l)}))),this.emit("update",l);let e=this.getCursor();e&&e.id==l.id&&this.emit("changeCursor",e)}else r.forEach((e=>{let t=this.getCursor();t&&t.id==e&&this.emit("changeCursor",null),this.__dataCollection.remove(e),this.emit("delete",e)}));else this.isValidData(l)&&(this.__dataCollection.add(l,0),this.__treeCollection&&this.parseTreeCollection({data:[l]}),this.emit("create",l));let u=i.connectFields((e=>e.datasourceLink&&e.datasourceLink.id==t.objectId));if(i instanceof this.AB.Class.ABObject&&u&&u.length>0){let t=u[0].object.PK();s.id||"id"==t||(s.id=s[t]),this.__dataCollection.count()>0&&this.__dataCollection.find({}).forEach((a=>{let n={};u.forEach((i=>{if(!i)return;let r={},o=a[i.relationName()]||{};i.fieldLink&&(r=s[i.fieldLink.relationName()]||{});let l=e(r,a.id,t);Array.isArray(o)&&o.filter((e=>e==s.id||e.id==s.id||e[t]==s.id)).length>0&&!l?(n[i.relationName()]=o.filter((e=>(e.id||e[t]||e)!=s.id)),n[i.columnName]=n[i.relationName()].map((e=>e.id||e[t]||e))):Array.isArray(o)||o!=s.id&&o.id!=s.id&&o[t]!=s.id||l||(n[i.relationName()]=null,n[i.columnName]=null),Array.isArray(o)&&l?(o.filter((e=>e==s.id||e.id==s.id||e[t]==s.id)).length>0?o.forEach(((e,i)=>{e!=s.id&&e.id!=s.id&&e[t]!=s.id||(o[i]=s)})):o.push(s),n[i.relationName()]=o,n[i.columnName]=n[i.relationName()].map((e=>e.id||e[t]||e))):Array.isArray(o)||o==s.id&&o.id==s.id&&o[t]==s.id||!l||(n[i.relationName()]=s,n[i.columnName]=s.id||s)})),Object.keys(n).length>0&&(i.model().normalizeData(n),this.__treeCollection&&this.__treeCollection.exists(a.id)&&this.__treeCollection.updateItem(a.id,n),this.__dataCollection&&this.__dataCollection.exists(a.id)&&(this.__dataCollection.updateItem(a.id,n),this.emit("update",this.__dataCollection.getItem(a.id))))}))}this.refreshLinkCursor(),this.setStaticCursor()})),this.on("ab.datacollection.stale",(e=>{if(this.datasource&&this.model&&this.datasource.id==e.objectId){var t=e.data;if(t){var i=this.model.object.PK();if(t[i]||(i="id"),t&&this.__dataCollection.exists(t[i])){var s={where:{}};s.where[i]=t[i],this.model.staleRefresh(s).then((e=>{if(Array.isArray(e.data)&&e.data.length){let a=this.datasource;if(!a)return;a.model().normalizeData(e.data[0]),this.__dataCollection.exists(t[i])&&this.__dataCollection.updateItem(t[i],e.data[0]);var s=this.getCursor();s&&s[i]==t[i]&&this.emit("changeCursor",s)}else this.getCursor()==t[i]&&this.emit("changeCursor",null),this.__dataCollection.remove(t[i]),this.emit("delete",t[i])}))}this.refreshLinkCursor(),this.setStaticCursor()}}})),this.on("ab.datacollection.delete",(e=>{let t=this.datasource;if(!t)return;let i=e.data,s=!1,a=[],n=[];if(t instanceof this.AB.Class.ABObjectQuery){let r=t.objects((t=>t.id==e.objectId))||[];s=r.length>0,s&&(r||[]).forEach((e=>{a=this.__dataCollection.find((t=>t[`${e.alias}.${e.PK()}`]==i)).map((e=>e.id))||[],this.__treeCollection&&(n=this.__treeCollection.find((t=>t[`${e.alias}.${e.PK()}`]==i)).map((e=>e.id))||[])}))}else s=t.id==e.objectId,s&&a.push(i);if(s){var r=this.getCursor();a.forEach((e=>{r&&r[t.PK()]==e&&this.emit("changeCursor",null),this.__dataCollection.exists(e)&&this.__dataCollection.remove(e)})),this.__treeCollection&&n.forEach((e=>{this.__treeCollection.exists(e)&&this.__treeCollection.remove(e)})),a[0]&&this.emit("delete",a[0])}let o=t.connectFields((t=>t.datasourceLink&&t.datasourceLink.id==e.objectId));if(t instanceof this.AB.Class.ABObject&&o&&o.length>0){let e=o[0].object.PK();this.__dataCollection.find({}).forEach((s=>{let a={};o.forEach((t=>{let n=s[t.relationName()];null!=n&&(Array.isArray(n)&&n.filter((t=>t==i||t.id==i||t[e]==i)).length>0?(a[t.relationName()]=n.filter((t=>(t.id||t[e]||t)!=i)),a[t.columnName]=a[t.relationName()].map((t=>t.id||t[e]||t))):n!=i&&n.id!=i&&n[e]!=i||(a[t.relationName()]=null,a[t.columnName]=null))})),Object.keys(a).length>0&&(t.model().normalizeData(a),this.__dataCollection.updateItem(s.id,a),this.__treeCollection&&this.__treeCollection.updateItem(s.id,a),this.emit("update",this.__dataCollection.getItem(s.id)))}))}}));let t=this.datacollectionLink;t&&this.settings.loadAll&&this.eventAdd({emitter:t,eventName:"changeCursor",listener:()=>{this.refreshLinkCursor(),this.setStaticCursor()}})}waitForDataCollectionToInitialize(e,t){return new Promise(((t,i)=>{switch(e.dataStatus){case e.dataStatusFlag.notInitial:e.loadData().catch(i);case e.dataStatusFlag.initializing:this.eventAdd({emitter:e,eventName:"initializedData",listener:()=>{t()}});break;case e.dataStatusFlag.initialized:default:t()}}))}loadData(e,t){this._dataStatus==this.dataStatusFlag.notInitial&&(this._dataStatus=this.dataStatusFlag.initializing,this.emit("initializingData",{}));var i=this.datasource;if(null==i)return this._dataStatus=this.dataStatusFlag.initialized,Promise.resolve([]);var s=i.model();if(null==s)return this._dataStatus=this.dataStatusFlag.initialized,Promise.resolve([]);var a=this.settings.objectWorkspace.sortFields||[],n=this.settings.objectWorkspace.filterConditions||null;this.__reloadWheres&&(n=this.__reloadWheres),this.__filterCond&&(n=n.rules.length?{glue:"and",rules:[n,this.__filterCond]}:this.__filterCond);var r={where:n||{},skip:e||0,sort:a,populate:!this.settings.preventPopulate};return t&&(r.limit=t),this.settings.loadAll&&delete r.limit,Promise.resolve().then((()=>{let e=this.datacollectionLink;return e?this.waitForDataCollectionToInitialize(e):Promise.resolve()})).then((()=>new Promise(((e,t)=>{if(null==n||null==n.rules||!n.rules.length)return e();var i=[];n.rules.forEach((e=>{if("in_data_collection"==e.rule||"not_in_data_collection"==e.rule){var t=this.AB.datacollectionByID(e.value);t&&i.push(this.waitForDataCollectionToInitialize(t))}})),Promise.all(i).then((()=>{e()})).catch(t)})))).then((()=>new Promise(((e,t)=>{this._pendingLoadDataResolve={resolve:e,reject:t},this.platformFind(s,r).catch((e=>{t(e)}))}))))}platformFind(e,t){return e.findAll(t).then((e=>this.processIncomingData(e)))}processIncomingData(e){return Promise.resolve().then((()=>{this.__totalCount=e.total_count,l((()=>{this.__dataCollection.load((()=>(this.settings.loadAll&&setTimeout((()=>{this.refreshLinkCursor()}),250),e)))}),5),l((()=>{this.__dataCollection.parse(e)}),50),this.parseTreeCollection(e),l((()=>{this.datacollectionLink?(this.refreshLinkCursor(),this.setStaticCursor()):this.setStaticCursor()}),5),l((()=>{this._dataStatus!=this.dataStatusFlag.initialized&&(this._dataStatus=this.dataStatusFlag.initialized,this.emit("initializedData",{}))}),20),l((()=>{this.settings.loadAll&&this.emit("loadData",{})}),10),l((()=>{this._pendingLoadDataResolve&&(this._pendingLoadDataResolve.resolve(),this._pendingLoadDataResolve=null)}),5)}))}reloadData(e,t){return Promise.resolve().then((()=>(this.reloadTimer&&(clearTimeout(this.reloadTimer),delete this.reloadTimer),this.reloadPromise||(this.reloadPromise=new Promise(((e,t)=>{this.reloadPromise__resolve=e,this.reloadPromise__reject=t}))),this.reloadTimer=setTimeout((()=>(this.clearAll(),this.loadData(e,t).then((()=>{this.reloadPromise&&(this.reloadPromise__resolve(),delete this.reloadPromise,delete this.reloadPromise__resolve,delete this.reloadPromise__reject),clearTimeout(this.reloadTimer),delete this.reloadTimer})).catch((e=>{this.reloadPromise&&(this.reloadPromise__reject(e),delete this.reloadPromise,delete this.reloadPromise__resolve,delete this.reloadPromise__reject),clearTimeout(this.reloadTimer),delete this.reloadTimer})))),50),this.reloadPromise)))}reloadWheres(e){this.__reloadWheres=e}getData(e){var t=this.__dataCollection;return t?t.find((t=>{let i=!0;return this.datacollectionLink&&this.settings.loadAll&&i&&(i=this.isParentFilterValid(t)),i&&e&&(i=e(t)),i})):[]}isParentFilterValid(e){if(null==e)return null;var t=this.datacollectionLink;if(null==t)return!0;var i=this.fieldLink;if(null==i)return!0;var s=t.getCursor();if(null==s)return!0;var a=e[i.relationName()];if(null==a){if(!e[i.columnName])return!1;a=e[i.columnName]}let n=i.object.PK();return a.filter?a.filter((e=>(e.id||e[n]||e)==s.id)).length>0:(a.id||a[n]||a)==s.id}clearAll(){this.__dataCollection&&this.__dataCollection.clearAll(),this.__treeCollection&&this.__treeCollection.clearAll(),this._dataStatus=this.dataStatusFlag.notInitial}get totalCount(){return this.__totalCount||0}bind(){console.error("Platform.ABDataCollection.bind() Not implemented")}unbind(){console.error("Platform.ABDataCollection.unbind() Not implemented")}removeComponent(e){let t=this.__bindComponentIds.indexOf(e);this.__bindComponentIds.splice(t,1)}refreshFilterConditions(e=null){if(null==this.__filterDatasource&&(this.__filterDatasource=this.AB.filterComplexNew(`${this.id}_filterDatasource`)),this.datasource){let e;this.__filterDatasource.fieldsLoad(this.datasource.fields()),this.datasource instanceof this.AB.Class.ABObjectQuery&&(e=this.datasource.where),e?this.__filterDatasource.setValue(e):this.__filterDatasource.setValue({})}else this.__filterDatasource.fieldsLoad([]),this.__filterDatasource.setValue(a.settings.objectWorkspace.filterConditions);if(null==this.__filterDatacollection&&(this.__filterDatacollection=this.AB.filterComplexNew(`${this.id}_filterDatacollection`)),this.__filterDatacollection.fieldsLoad(this.datasource?this.datasource.fields():[]),e&&(this.settings.objectWorkspace.filterConditions=e),this.settings&&this.settings.objectWorkspace&&this.settings.objectWorkspace.filterConditions?this.__filterDatacollection.setValue(this.settings.objectWorkspace.filterConditions):this.__filterDatacollection.setValue(a.settings.objectWorkspace.filterConditions),null==this.__filterScope&&(this.__filterScope=this.AB.filterComplexNew(`${this.id}_filterScope`)),this.datasource){let e=(this.userScopes||[]).filter((e=>!e.allowAll&&(e.objectIds||[]).indexOf(this.datasource.id)>-1));if(e&&e.length>0){this.__filterScope.fieldsLoad(this.datasource.fields()||[]);let t=[];e.filter((e=>e.filter&&e.filter.rules&&e.filter.rules.length)).forEach((e=>{let i=(e.filter.rules||[]).filter((e=>this.datasource.fields((t=>t.id==e.key)).length>0));t=t.concat(i)}));let i={glue:"or",rules:t};this.__filterScope.setValue(i)}}}get isGroup(){return this.__isGroup||!1}get syncTypeFlag(){return{server:1,client:2}}get syncType(){return this.settings.syncType||a.syncType}_dataCollectionNew(){var e=new Error("the platform.ABDataCollection._dataCollectionNew() is expected to return a proper DataCollection!");return console.error(e),null}_treeCollectionNew(){return console.error("the platform.ABDataCollection._treeCollectionNew() is expected to return a proper TreeCollection!"),null}parseTreeCollection(e={}){e==={}&&console.log("Platform.ABDataCollection.parseTreeCollection() missing!")}_queryUpdateData(e,t){let i={};return Object.keys(t).forEach((s=>{e.forEach((e=>{let a=this.datasource.objectAlias(e.id);i[`${a}.${s}`]=t[s],"translations"==s&&t.translations&&t.translations.length&&(i.translations=[],t.translations.forEach((e=>{let t={};Object.keys(e).forEach((i=>{"language_code"==i?t.language_code=e.language_code:t[`${a}.${i}`]=e[i]})),i.translations.push(t)})))}))})),i}isValidData(e){let t=!0;return this.__filterDatasource&&(t=t&&this.__filterDatasource.isValid(e)),this.__filterDatacollection&&(t=t&&this.__filterDatacollection.isValid(e)),t&&this.__filterScope&&(t=t&&this.__filterScope.isValid(e)),t}clone(e){e=e||this.toObj();var t=new this.constructor(e,this.AB);t.__datasource=this.__datasource,t._dataStatus=this._dataStatus,t.__filterDatacollection.setValue(e.settings.objectWorkspace.filterConditions),(()=>{t.__dataCollection&&t.__dataCollection.parse(this.__dataCollection.find({}).filter((e=>t.__filterDatacollection.isValid(e)))),t.__treeCollection&&t.__treeCollection.parse(this.__treeCollection.find({}).filter((e=>t.__filterDatacollection.isValid(e))))})(),t.setStaticCursor();var i=this.getCursor();return i&&(i.id&&(i=i.id),t.setCursor(i)),t}filteredClone(e){var t=this.toObj();return e?.rules?.length&&(t.settings.objectWorkspace.filterConditions?.rules?.length?t.settings.objectWorkspace.filterConditions.rules=t.settings.objectWorkspace.filterConditions.rules.concat(e.rules):t.settings.objectWorkspace.filterConditions=e),this.clone(t)}eventAdd(e){if(!e||!e.emitter||!e.listener)return;this.__events=this.__events||[];let t=this.__events.find((t=>t.emitter==e.emitter&&t.eventName==e.eventName));(!t||t.length<1)&&(this.__events.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}eventClear(){this.__events&&this.__events.length>0&&this.__events.forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)}))}get userScopes(){return[]}}},52:e=>{e.exports=class{constructor(e,t){this.AB=t,this.fromValues(e)}fromValues(e){e.id&&(this.id=e.id),this.name=e?.name||e?.json?.name||e?.json?.label||e?.json?.translations?.[0]?.label||"",this.name||this.AB.notify.builder(new Error("Attributes for definition had no 'name'"),{context:"ABDefinitionCore.fromValues()",attributes:e}),this.type=e.type||e?.json?.type||"",this.json=e.json||null}toObj(){return{id:this.id,name:this.name,type:this.type,json:this.json}}destroy(){return this.AB.definitionDestroy(this.id)}async save(){return this.id?this.AB.definitionUpdate(this.id,this.toObj()):this.AB.definitionCreate(this.toObj())}}},5095:(e,t,i)=>{const s=i(1827),a=i(5741),n=i(8030),r=i(9594),o=i(5437),l=i(7826),u=i(4509),c=i(1557),d=i(1579),h=i(8447),p=i(8836),m=i(7692),f=i(144),g=i(2719),b=i(3787),v=i(1688),w=i(1021),y=i(7069),_=i(3686);e.exports=class extends _{constructor(e){if(super(),this.setMaxListeners(0),this._definitions=e||{},Array.isArray(e)){var t={};e.forEach((e=>{t[e.id]=e})),this._definitions=t}this._allApplications=[],this._allObjects=[],this._allProcesses=[],this._allQueries=[],this._allDatacollections=[],this.Class={ABApplication:s,ABComponent:n,ABDefinition:a,ABFieldManager:r,ABIndex:o,ABMLClass:y,ABObject:l,ABObjectExternal:u,ABObjectImport:c,ABObjectQuery:h,ABProcessParticipant:m,ABProcessTaskManager:g,ABViewFormComponent:b},this.rules={isUUID:function(e){return RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i").test(e)},nameFilter:function(e){return String(e).replace(/[^a-z0-9_.]/gi,"")},toApplicationNameFormat:function(e){return"AB_"+this.nameFilter(e)},toFieldRelationFormat:function(e){return this.nameFilter(e)+"__relation"},toJunctionTableFK:function(e,t){var i=e+"_"+t;return i.length>64&&(i=i.substring(0,64)),i},toJunctionTableNameFormat:function(e,t,i,s){return(e=this.toApplicationNameFormat(e)).length>17&&(e=e.substring(0,17)),t.length>15&&(t=t.substring(0,15)),i.length>15&&(i=i.substring(0,15)),(s=this.nameFilter(s)).length>14&&(s=s.substring(0,14)),"{appName}_{sourceName}_{targetName}_{colName}".replace("{appName}",e).replace("{sourceName}",t).replace("{targetName}",i).replace("{colName}",s)},toObjectNameFormat:function(e){return`AB_${this.nameFilter(e)}`}},this.notify.builder=(...e)=>{this.notify("builder",...e)},this.notify.developer=(...e)=>{this.notify("developer",...e)}}definitionClean(e){if("string"==typeof e.json)try{e.json=JSON.parse(e.json)}catch(t){console.log(t),console.error(` Error on definition id[${e.id}]`)}}init(){let e=Object.keys(this._definitions).map((e=>this._definitions[e]));return e.forEach((e=>{this.definitionClean(e)})),["object","query","datacollection","process","application"].forEach((t=>{e.filter((e=>e.type==t)).forEach((e=>{let{keyList:t,keyFn:i}=this.objectKeysByDef(e);t&&this[t].push(this[i](e.json))}))})),this.emit("init.objects_ready"),Promise.resolve()}objectKeysByDef(e){switch(e.type){case"application":return{keyList:"_allApplications",keyFn:"applicationNew"};case"datacollection":return{keyList:"_allDatacollections",keyFn:"datacollectionNew"};case"object":return{keyList:"_allObjects",keyFn:"objectNew"};case"process":return{keyList:"_allProcesses",keyFn:"processNew"};case"query":return{keyList:"_allQueries",keyFn:"queryNew"};default:return{keyList:null,keyFn:null}}}definitionByID(e,t=!1){return this._definitions[e]?t?this._definitions[e]:this._definitions[e].json:null}definitionNew(e){return new a(e,this)}definitionsParse(e=[]){return Array.isArray(e)||(e=[e]),e.forEach((e=>{this.definitionClean(e),this._definitions[e.id]=e})),e.forEach((e=>{this.definitionSync("updated",e.id,e)})),Promise.resolve()}definitionSync(e,t,i){var s,{keyList:a,keyFn:n}=this.objectKeysByDef(i);if(a)switch(e){case"created":this[a].push(this[n](i.json)),this.emit("definition.created",i.json);break;case"updated":s=this[a].find((e=>e.id==t)),this[a]=this[a].filter((e=>e.id!=t)),this[a].push(this[n](i.json)),s?s.emit("definition.updated",i.json):this.emit("definition.updated",i.json);break;case"destroyed":(s=this[a].find((e=>e.id==t)))&&(this[a]=this[a].filter((e=>e.id!=t)),s.emit("definition.deleted",i.json),this.emit("definition.deleted",i.json))}}applications(e=(()=>!0)){return(this._allApplications||[]).filter(e)}applicationByID(e){return this.applications((t=>t.id==e))[0]}applicationNew(e){return new s(e,this)}datacollections(e=(()=>!0)){return(this._allDatacollections||[]).filter(e)}datacollectionByID(e){return e?this.datacollections((t=>t.id==e||t.name==e||t.label==e))[0]:null}datacollectionNew(e){var t=new d(e,this);return t.on("destroyed",(()=>{this._allDatacollections=this._allDatacollections.filter((e=>e.id!=t.id))})),t}fieldNew(e,t){return r.newField(e,t)}indexNew(e,t){return new o(e,t)}Label(){return(e,t,i=[])=>{var s=e;return t&&(Array.isArray(t)?i=t:s=t),i.forEach(((e,t)=>{var i=`{${t}}`;s=s.replaceAll(i,e)})),s}}objects(e=(()=>!0)){return(this._allObjects||[]).filter(e)}objectByID(e){return this.objects((t=>t.id==e||t.name==e||t.label==e))[0]}objectNew(e){return 1==e.isExternal?new u(e,this):1==e.isImported?new c(e,this):new l(e,this)}objectFile(){return this.objectByID("4a9d89c9-f4eb-41af-91e4-909eff389f3e")}objectLanguage(){return this.objectByID("d84cd351-d96c-490f-9afb-2a0b880ca0ec")}objectProcessForm(){return this.objectByID("d36ae4c8-edef-48d8-bd9c-79a0edcaa067")}objectProcessInstance(){return this.objectByID("2ba85be0-78db-4eda-ba43-c2c4e3831849")}objectRole(){return this.objectByID("c33692f3-26b7-4af3-a02e-139fb519296d")}objectScope(){return this.objectByID("af10e37c-9b3a-4dc6-a52a-85d52320b659")}objectToken(){return this.objectByID("08826ac7-4b33-4745-a3d7-f7831ca4ff59")}objectUser(){return this.objectByID("228e3d91-5e42-49ec-b37c-59323ae433a1")}processes(e=(()=>!0)){return(this._allProcesses||[]).filter(e)}processByID(e){return this.processes((t=>t.id==e||t.name==e||t.label==e))[0]}processNew(e){return new p(e,this)}processElementNew(e,t){var i=this.definitionByID(e);if(i)switch(i.type){case m.defaults().type:return new m(i,t,this);case f.defaults().type:return new f(i,t,this);default:return g.newTask(i,t,this)}return null}processElementNewForModelDefinition(e,t){var i=null;switch(e.type){case"bpmn:Participant":i=new m({},t,this);break;case"bpmn:Lane":i=new f({},t,this);break;default:var s=g.definitionForElement(e);s&&(i=g.newTask(s,t,this))}return i&&i.fromElement(e),i}queries(e=(()=>!0)){return(this._allQueries||[]).filter(e)}queryByID(e){return this.queries((t=>t.id==e||t.name==e||t.label==e))[0]}queryNew(e){return new h(e,this)}rowfilterNew(e,t){return e&&console.error("!! Who is calling this with an App?"),new v(e||this._App,t,this)}filterComplexNew(e,t={}){return new w(e,this,t)}viewNewDetatched(e){return this._mockApp||(this._mockApp=this.applicationNew({})),this._mockApp.viewNew(e,this._mockApp)}notify(){console.error("ABFactory.notify() is expected to be overwritten by the platform!")}_notifyInfo(e){var t={};return e&&Object.keys(e).forEach((i=>{switch(i){case"field":t.objectID=e[i].object.id,t.objectName=e[i].object.name,t.fieldID=e[i].id,t.fieldName=e[i].label||e[i].name;break;case"object":t.objectID=e[i].id,t.objectName=e[i].name;break;case"datacollection":t.datacollectionID=e[i].id,t.datacollectionName=e[i].label||e[i].name;var s=e[i].datasource;s&&(t.datacollectionDSID=s.id,t.datacollectionDSName=s.name);break;case"process":t.processID=e[i].id,t.processName=e[i].label||e[i].name;break;case"req":t.req={jobID:e[i].jobID,tenantID:e[i]._tenantID,user:e[i]._user};break;case"task":e[i].process&&(t.processID=e[i].process.id,t.processName=e[i].process.label||e[i].process.name),t.taskID=e[i].id,t.taskName=e[i].label||e[i].name;break;case"view":e[i].application&&(t.applicationID=e[i].application.id,t.applicationName=e[i].application.label||e[i].application.name),t.viewID=e[i].id,t.viewName=e[i].label||e[i].name,t.viewKey=e[i].key;break;default:t[i]=e[i]}})),t}}},9594:(e,t,i)=>{var s={};[i(8134),i(4384),i(1812),i(176),i(1747),i(7280),i(9319),i(779),i(9137),i(2597),i(780),i(9333),i(6589),i(3088),i(7238),i(8439),i(9579),i(1797),i(9142),i(7038)].forEach((e=>{s[e.defaults().key]=e})),e.exports=class{static allFields(){var e=[];for(var t in s)e.push(s[t]);return e}static fieldByKey(e){return s[e]}static newField(e,t){if(!e.key)throw console.log("-------"),console.log("values:"),console.error(e),console.log(),console.error("object:"),console.error(t),console.log("-------"),new Error(`ABFieldManager.newField(): Unknown Field Key [${e.name}][${e.key}] for object[${t.name}]`);try{return new s[e.key](e,t)}catch(t){console.log("Error",t),console.log("Available fields",s),console.log("Requested field",e.key)}}}},5739:(e,t,i)=>{const s=i(7069);e.exports=class extends s{constructor(e,t){super(["label"],t.AB),this.object=t,this.fromValues(e)}fromValues(e){this.id=e.id,this.type="index",this.name=e.name,this.unique=JSON.parse(e.unique||!1),e.fieldIDs&&!Array.isArray(e.fieldIDs)&&(e.fieldIDs=[e.fieldIDs]),this.fields=(e.fieldIDs||[]).map((e=>{let t=this.object.fieldByID(e);return t||this.emit("warning",`Index[${this.name}][${this.id}] is referencing an unknown field[${e}]`,{index:this.id,field:e}),t})).filter((e=>e)),0==this.fields.length&&this.emit("warning",`Index[${this.name}][${this.id}] is not referencing any fields`,{index:this.id,attributeFieldIDs:e.fieldIDs||[]}),super.fromValues(e)}toObj(){let e=super.toObj();return e.id=this.id,e.type="index",e.name=this.name,e.unique=this.unique,this.fields&&!Array.isArray(this.fields)&&(this.fields=[this.fields]),e.fieldIDs=(this.fields||[]).map((e=>e.id||e)).filter((e=>e)),e}get indexName(){return`${this.object.dbTableName()}_${this.name}`.replace(/ /g,"").substring(0,64)}get uniqueName(){return`${this.indexName.substring(0,57)}_unique`}}},7243:(e,t,i)=>{var s=i(3686);e.exports=class extends s{constructor(e,t){super(),this.mlFields=e||["label"],this.AB=t}fromValues(e){this.translations=e.translations,this.translations?this.translate():(this.mlFields||[]).forEach((t=>{e[t]&&(this[t]=e[t])}))}defaultTranslations(e,t){t=t||{};var i={language_code:"en"};return e.forEach((e=>{i[e]=t[e]||e})),[i]}languageDefault(){return"en"}toObj(){return this.unTranslate(),{translations:this.translations}}toDefinition(){return this.AB.definitionNew({id:this.id,name:this.name,type:this.type,json:this.toObj()})}translate(e,t,i,s=null){e||(e=this),t||(t=this),i||(i=this.mlFields||[]),t.translations||(t.translations=[]),"string"==typeof t.translations&&(t.translations=JSON.parse(t.translations));var a=s||this.languageDefault();if(i&&i.length>0){var n=null,r=!1;t.translations.forEach((function(t){n||(n=t),t.language_code==a&&(r=!0,i.forEach((function(i){null!=t[i]&&(e[i]=t[i]),e[i]=t[i]||""})))})),!r&&n&&i.forEach((function(t){null!=n[t]&&""!=n[t]?e[t]=`[${a}]${n[t]}`:e[t]=""}))}}unTranslate(e,t,i){e||(e=this),t||(t=this),i||(i=this.mlFields||[]),t.translations||(t.translations=[]);var s=this.languageDefault();if(i&&i.length>0){var a=!1;if(t.translations.forEach((function(t){t.language_code==s&&(i.forEach((function(i){null!=e[i]&&(t[i]=e[i])})),a=!0)})),!a){var n={};n.language_code=s,i.forEach((function(t){null!=e[t]&&(n[t]=e[t])})),t.translations.push(n)}}}}},1692:e=>{e.exports=class{constructor(e){this.object=e,this.AB=e.AB,this._where=null,this._sort=null,this._skip=null,this._limit=null,this.staleRefreshInProcess=!1,this.staleRefreshMap={},this.staleRefreshPending=[],this.staleRefreshTimerID=null,this.responseContext={key:"--",context:{}}}contextKey(e){this.responseContext.key=e||"--"}contextValues(e){this.responseContext.context=e||{}}prepareMultilingualData(e){var t=this.object.multilingualFields(),i=!1;t.length&&t.forEach((function(t){null!=e[t]&&(i=!0)})),i&&(null!=e.translations&&void 0!==e.translations&&""!=e.translations||(e.translations=[]),this.object.unTranslate(e,e,t))}request(e,t){return console.error("!!! ABModelCore.request() should be overridden by platform."),Promise.resolve()}urlParamsCreate(e){return{url:this.object.urlRest(),params:e}}urlParamsDelete(e){return{url:this.object.urlRestItem(e)}}urlParamsFind(e){return{url:this.object.urlRest(),params:e||{}}}urlParamsUpdate(e,t){return{url:this.object.urlRestItem(e),params:t}}count(e){e=e||{};var t={url:this.object.urlRestCount(),params:e};return this.request("get",t).then((e=>{resolve(e)})).catch((e=>{console.error(e)}))}staleRefresh(e){var t=this.object.PK(),i=e[t];return e.where&&(i=e.where[t]),new Promise(((s,a)=>{if(!i){var n=new Error("Model.staleRefresh(): could not resolve ."+t);return n.cond=e,void a(n)}var r={resolve:s,reject:a};r[t]=i,this.staleRefreshPending.push(r),this.staleRefreshInProcess||(this.staleRefreshTimerID&&clearTimeout(this.staleRefreshTimerID),this.staleRefreshTimerID=setTimeout((()=>{this.staleRefreshProcess()}),200))}))}staleRefreshProcess(){this.staleRefreshInProcess=!0;var e=this.staleRefreshPending;this.staleRefreshPending=[];var t=this.object.PK(),i={},s={where:{}};s.where[t]=[],console.log("Model.staleRefreshProcess(): buffered "+e.length+" requests"),e.forEach((e=>{i[e[t]]=i[e[t]]||[],i[e[t]].push(e)})),s.where[t]=Object.keys(i),this.findAll(s).then((e=>{Array.isArray(e.data)&&e.data.length&&e.data.forEach((e=>{i[e[t]]?(i[e[t]].forEach((t=>{(0,t.resolve)({data:[e]})})),delete i[e[t]]):console.error("Model.staleRefreshProcess(): returned entry was not in our responseHash:",e,i)}));var s=Object.keys(i);s.length>0&&console.warn("Model.staleRefreshProcess(): "+s.length+" entries with no responses. "),s.forEach((e=>{(0,i[e].resolve)({data:[]}),delete i[e]})),this.staleRefreshPending.length>0?this.staleRefreshProcess():this.staleRefreshInProcess=!1}))}findConnected(e,t){return void 0===t&&(Array.isArray(e)||"object"!=typeof e||(t=e,e=[])),"string"==typeof e&&(e=[e]),new Promise(((i,s)=>{if(!t.id)return void i(null);let a={};a[this.object.PK()]=t.id,this.findAll({where:a,includeRelativeData:!0}).then((t=>{if(t.data&&Array.isArray(t.data)&&0!=t.data.length){var s=t.data[0];if(1==e.length){let t=s[e[0].replace(/[^a-z0-9\.]/gi,"")+"__relation"];return t?(Array.isArray(t)||(t=[t]),void i(t)):i([])}0==e.length&&this.object.fields((e=>e.settings.linkType)).forEach((t=>{e.push(t.columnName)}));var a={};e.forEach((e=>{a[e]=s[e.replace(/[^a-z0-9\.]/gi,"")+"__relation"]})),i(a)}else i([])})).catch((e=>{console.error("!!! error with findConnected() attempt:",e),s(e)}))}))}upsert(e){for(var t in this.prepareMultilingualData(e),e)null==e[t]&&delete e[t];var i={url:this.object.urlRest(),params:e};return this.request("put",i).then((e=>(this.normalizeData(e),e))).catch((e=>{console.error(e)}))}where(e){return this._where=e,this}sort(e){return this._sort=e,this}refresh(){return console.error("!!! Depreciated: where is this being called from?"),Promise.resolve()}normalizeData(e){e instanceof Array||(e=[e]);var t=this.object.connectFields(),i=this.object.multilingualFields(),s=this.object.fields((function(e){return"date"==e.key||"datetime"==e.key}))||[],a=this.object.fields((e=>"calculate"==e.key));e.forEach((e=>{null!=e&&(e.id||"id"==this.object.PK()||(e.id=e[this.object.PK()]),t.forEach((t=>{var i=t.relationName();if(null==e[i])return;"string"==typeof e[i]&&e[i].length>0&&(e[i]=JSON.parse(e[i])),Array.isArray(e[i])?e[i].forEach((e=>{e.translations&&"string"==typeof e.translations&&(e.translations=JSON.parse(e.translations))})):e[i].translations&&"string"==typeof e[i].translations&&(e[i].translations=JSON.parse(e[i].translations));let s=t.datasourceLink;s&&"id"!=s.PK()&&e[i]&&!e[i].id&&(e[i].forEach?e[i].forEach((e=>{e[s.PK()]&&(e.id=e[s.PK()])})):e[i][s.PK()]&&(e[i].id=e[i][s.PK()]));var a=s.multilingualFields();a.length&&s.translate(e[i],e[i],a),e[t.columnName]||(e[t.columnName]=e[i])})),i.length&&this.object.translate(e,e,i),s.forEach((t=>{e&&null!=e[t.columnName]&&"string"==typeof e[t.columnName]&&("date"==t.key?e[t.columnName]=this.AB.toDate(e[t.columnName],{format:"MM/DD/YYYY",ignoreTime:!0}):e[t.columnName]=this.AB.toDate(e[t.columnName]))})),a.forEach((t=>{e[t.columnName]=t.format(e)})))}))}}},6937:(e,t,i)=>{var s=i(8912),a=i(7069);const n=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends a{constructor(e,t){super(["label"],t),this.fromValues(e)}static contextKey(){return"object"}fromValues(e){this.id=e.id,this.type=e.type||"object",this.connName=e.connName||void 0,this.name=e.name||"",this.labelFormat=e.labelFormat||"",this.labelSettings=e.labelSettings||{},this.labelSettings.isNoLabelDisplay=parseInt(this.labelSettings.isNoLabelDisplay||0),this.isImported=parseInt(e.isImported||0),this.isExternal=parseInt(e.isExternal||0),this.tableName=e.tableName||"",this.tableName=this.tableName.replace(/[^a-zA-Z0-9_ ]/gi,""),this.primaryColumnName=e.primaryColumnName||"",this.transColumnName=e.transColumnName||"",this.urlPath=e.urlPath||"",this.isSystemObject=e.isSystemObject,void 0!==this.isSystemObject&&"false"!=this.isSystemObject||(this.isSystemObject=!1),this.createdInAppID=e.createdInAppID,void 0!==e.objectWorkspace&&(void 0===e.objectWorkspace.sortFields&&(e.objectWorkspace.sortFields=[]),void 0===e.objectWorkspace.filterConditions&&(e.objectWorkspace.filterConditions=[]),void 0===e.objectWorkspace.frozenColumnID&&(e.objectWorkspace.frozenColumnID=""),void 0===e.objectWorkspace.hiddenFields&&(e.objectWorkspace.hiddenFields=[])),this.objectWorkspace=e.objectWorkspace||{sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};var t=[];this.fieldIDs=e.fieldIDs||[],this.importedFieldIDs=e.importedFieldIDs||[],this.fieldIDs.forEach((e=>{if(e){var i=this.AB.definitionByID(e);i?t.push(this.AB.fieldNew(i,this)):this.emit("warning",`O[${this.name}] is referenceing an unknown field id[${e}]`,{obj:this.id,field:e})}})),this._fields=t,this.importIndexes(e.indexIDs),super.fromValues(e)}importIndexes(e){var t=[];(e||[]).forEach((e=>{var i=this.AB.definitionByID(e);i?t.push(this.AB.indexNew(i,this)):this.emit("warning",`O[${this.name}] is referenceing an unknown index id[${e}]`,{obj:this.id,index:e})})),this._indexes=t}toObj(){var e=super.toObj(),t=this.fields().map((e=>e.id)),i=this.indexes().map((e=>e.id));return{id:this.id,type:this.type||"object",connName:this.connName,name:this.name,labelFormat:this.labelFormat,labelSettings:this.labelSettings||{},isImported:this.isImported,isExternal:this.isExternal,tableName:this.tableName,primaryColumnName:this.primaryColumnName,transColumnName:this.transColumnName,urlPath:this.urlPath,objectWorkspace:this.objectWorkspace,isSystemObject:this.isSystemObject,translations:e.translations,fieldIDs:t,importedFieldIDs:this.importedFieldIDs,indexIDs:i,createdInAppID:this.createdInAppID}}objectLinks(){return this.connectFields().map((e=>e.datasourceLink))}fields(e=(()=>!0)){return this._fields.filter(e)}fieldByID(e){return this.fields((t=>t?.id==e))[0]}connectFields(e=(()=>!0)){return this.fields((e=>e&&e.isConnection)).filter(e)}fieldImport(e){if(e&&(-1==this.importedFieldIDs.indexOf(e)&&this.importedFieldIDs.push(e),!this._fields.find((t=>t.id==e)))){var t=this.AB.definitionByID(e);t?this._fields.push(this.AB.fieldNew(t,this)):this.emit("warning",`O[${this.name}] is importing an unknown field id[${e}]`,{obj:this.id,field:e})}}fieldNew(e){return this.AB.fieldNew(e,this)}fieldRemove(e){var t=this._fields.length;return this._fields=this.fields((function(t){return t.id!=e.id})),this.importedFieldIDs=this.importedFieldIDs.filter((t=>t!=e.id)),this._fields.length<t?this.save():Promise.resolve()}fieldReorder(e,t){let i=null,s=0;for(var a=0;a<this._fields.length;a++)if(this._fields[a].columnName==e){i=this._fields[a],this._fields.splice(a,1),s=a;break}for(var n=0;n<this._fields.length;n++)if(this._fields[n].columnName==t){s<=n&&n++,this._fields.splice(n,0,i);break}return this.save()}fieldSave(e){return this.fieldByID(e.id)?Promise.resolve():(this._fields.push(e),this.save())}fieldAdd(e){return this.fieldByID(e.id)?Promise.resolve():(this._fields.push(e),this.save())}imageFields(e=(()=>!0)){return this.fields((e=>e&&"image"==e.key)).filter(e)}multilingualFields(){return this.fields((e=>e&&e.isMultilingual)).map((e=>e.columnName))}indexes(e=(()=>!0)){return this._indexes.filter(e)}indexByID(e){return this.indexes((t=>t.id==e))[0]}indexRemove(e){var t=this._indexes.length;return this._indexes=this.indexes((function(t){return t.id!=e.id})),t!=this._indexes.length?this.save():Promise.resolve()}indexSave(e){return this.indexByID(e.id)?Promise.resolve():(this._indexes.push(e),this.save())}model(){var t=new s(this);return t.contextKey(e.contextKey()),t.contextValues({id:this.id}),t}urlRest(){return`/app_builder/model/${this.id}`}urlRestBatch(){return`/app_builder/batch/model/${this.id}`}urlRestItem(e){return`/app_builder/model/${this.id}/${e}`}urlRestLog(){return`/app_builder/object/${this.id}/track`}urlRestRefresh(){return`/app_builder/model/refreshobject/${this.id}`}urlRestCount(){return`/app_builder/model/count/${this.id}`}get workspaceSortFields(){if(this.workspaceViews){let e=this.workspaceViews.getCurrentView();return e?e.sortFields:null}return this.objectWorkspace.sortFields}set workspaceSortFields(e){if(this.workspaceViews){let t=this.workspaceViews.getCurrentView();t&&(t.sortFields=e)}else this.objectWorkspace.sortFields=e}get workspaceFilterConditions(){if(this.workspaceViews){let e=this.workspaceViews.getCurrentView();return e?e.filterConditions:null}return this.objectWorkspace.filterConditions}set workspaceFilterConditions(e){if(this.workspaceViews){let t=this.workspaceViews.getCurrentView();t&&(t.filterConditions=e)}else this.objectWorkspace.filterConditions=e}get workspaceFrozenColumnID(){return this.objectWorkspace.frozenColumnID}set workspaceFrozenColumnID(e){this.objectWorkspace.frozenColumnID=e}get workspaceHiddenFields(){return this.objectWorkspace.hiddenFields||[]}set workspaceHiddenFields(e){this.objectWorkspace.hiddenFields=e}get isReadOnly(){return this.isImported||this.isExternal}defaultValues(){var e={};return this.fields().forEach((t=>{t.defaultValue(e)})),e}isValidData(){return console.warn("Platform.ABObject.isValidData() missing"),!0}urlPointer(e){return console.error("Who is calling this?"),null==this.application?null:this.application.urlObject(e)+this.id}urlField(e){return console.error("Who is calling this?"),this.urlPointer(e)+"/_fields/"}PK(){return this.primaryColumnName||"uuid"}remoteCreate(e){console.log("object["+this.name+"] received a remoteCreate() with data:",e)}clone(){let e=JSON.parse(JSON.stringify(this));return["application","_fields"].forEach((t=>{e[t]=this[t]})),e}displayData(e){if(null==e)return"";var t=this.multilingualFields();this.translate(e,e,t);var i=this.labelFormat||"";if(!i&&this.fields().length>0){var s=this.fields((e=>e.fieldUseAsLabel()))[0];if(s)i="{"+s.id+"}";else if(!i.trim()){let t=this.labelSettings||{};i=t&&t.isNoLabelDisplay?n(t.noLabelText||"[No Label]"):`${this.AB.rules.isUUID(e.id)?"ID: ":""}${e.id}`}}var a=i.match(/\{[^}]+\}/g);if(a&&a.forEach&&a.forEach((t=>{var s=t.replace("{","").replace("}",""),a=this.fieldByID(s);null!=a&&(i=i.replace(t,a.format(e)||""))})),!i.trim()){let t=this.labelSettings||{};i=t&&t.isNoLabelDisplay?n(t.noLabelText||"[No Label]"):`${this.AB.rules.isUUID(e.id)?"ID: ":""}${e.id}`}return i}}},777:(e,t,i)=>{var s=i(7826),a=i(4371);e.exports=class extends s{constructor(e,t){super(e,t),this.isQuery=!0}static contextKey(){return"query"}fromValues(e){super.fromValues(e),this.type="query",this.alias2Obj={},this.objectIDs=[],this.viewName=e.viewName||"",this.importJoins(e.joins||{}),this._fields=null,this.importFields(e.fields||[]),this.where=e.where||{},this.where&&!this.where.glue&&this.where.rules&&this.where.rules.length>0&&(this.where.glue="and"),this._objectWorkspaceViews=e.objectWorkspaceViews||{},this.settings=this.settings||{},e&&e.settings&&(this.settings.grouping=JSON.parse(e.settings.grouping||!1),this.settings.hidePrefix=JSON.parse(e.settings.hidePrefix||!1))}toObj(){var e=super.toObj();return e.viewName=this.viewName,e.joins=this.exportJoins(),e.fields=this.exportFields(),e.where=this.where,e.settings=this.settings,e}importFields(e){var t=[];(e||[]).forEach((e=>{if(null==e)return;let i=this.objectByAlias(e.alias);if(!i&&this.AB&&(i=this.AB.objectByID(e.objectID),i&&(this._objects=this._objects||{},this._objects[e.alias]=i)),!i)return void this.emit("warning",`IMPORT FIELDS: could not resolve object[${e.objectID}] for fieldSetting ${JSON.stringify(e)}`,{fieldInfo:e});let s=i.fieldByID(e.fieldID);if(!s)return void this.emit("warning",`IMPORT FIELDS: Object[${i.id}] could not find field[${e.fieldID}] for fieldSetting ${JSON.stringify(e)}`,{object:i.toObj(),fieldInfo:e});this.canFilterField(s)||this.emit("warning",`Field[${s.id}] referenced in fieldSetting[${JSON.stringify(e)}] did not pass .canFilterField`,{field:s.toObj(),fieldInfo:e});let a=t.filter((t=>t.alias==e.alias&&t.field.id==e.fieldID)).length<1;if(a||this.emit("warning",`Field[${e.fieldID}] referenced in fieldSetting[${JSON.stringify(e)}] is a duplicate`,{field:s.toObj(),fieldInfo:e}),s&&this.canFilterField(s)&&a){var n=s.toObj();let i=new s.constructor(n,s.object);i.alias=e.alias;let a=e.alias;Array.isArray(this.joins())&&(a=s.object.name),t.push({alias:a,field:i})}})),this._fields=t}exportFields(){var e=[];return this._fields.forEach((t=>{e.push({alias:t.alias,objectID:t.field.object.id,fieldID:t.field.id})})),e}fields(e=(()=>!0)){return e||(e=()=>!0),this._fields.map((e=>e.field)).filter(e)}joins(){return this._joins||{}}objects(e=(()=>!0)){return this.AB.objects((e=>this.objectIDs.indexOf(e.id)>-1)).filter(e)}objectAlias(e){let t=null;return Object.keys(this.alias2Obj||{}).forEach((i=>{t||this.alias2Obj[i]!=e||(t=i)})),t}objectBase(){return this._joins.objectID&&this.AB.objectByID(this._joins.objectID)||null}objectByAlias(e){var t=this.alias2Obj[e];return t?this.objects((e=>e.id==t))[0]:null}objectByID(e){return e?this.objects((t=>t.id==e))[0]:null}links(e=(()=>!0)){return(this._links||[]).filter(e)}importJoins(e){this._joins=this.AB.cloneDeep(e);var t={},i=[];let s=(e,i)=>{e&&(this.alias2Obj[i]=e.id,t[e.id]=e.id)},a=e=>{(e||[]).forEach((e=>{i.push(e)}))},n=(e,t)=>{e&&(t||[]).forEach((t=>{var i=e.fieldByID(t.fieldID);if(i){var r=this.AB.objectByID(i.settings.linkObject);r?(s(r,t.alias),a(t.links),n(r,t.links)):this.emit("warning","could not resolve our linked field -> linkObject",{link:t})}else this.emit("warning","could not resolve our linkField",{link:t})}))};var r=this.objectBase();r?(s(r,"BASE_OBJECT"),a(e.links),n(r,e.links),this._links=i,this.objectIDs=Object.keys(t)):this.emit("warning","could not resolve our base object",{objectID:this._joins?.objectID})}exportJoins(){return this.AB.cloneDeep(this._joins||{})}model(){var e=new a(this);return e.contextKey(this.constructor.contextKey()),e.contextValues({id:this.id}),e}canFilterObject(e){return!!e&&this.objects((t=>t.id==e.id)).length>0}canFilterField(e){if(!e)return!1;let t=e.object;var i=e.datasourceLink;return this.canFilterObject(t)||this.canFilterObject(i)}urlPointer(e){return console.error("ABQueryCore.urlPointer(): Depreciated: Where is this being called?"),this.application.urlQuery(e)+this.id}get isGroup(){return this.settings.grouping||!1}get isReadOnly(){return!0}isDisabled(){return this.disabled||!1}get workspaceFilterConditions(){let e=super.workspaceFilterConditions;return null!=e&&null!=e.rules&&e.rules.length||(e=this.where),e}}},4812:(e,t,i)=>{var s=i(7069);const a=i(7043);e.exports=class extends s{constructor(e,t){super(["label"],t),this.fromValues(e)}fromValues(e){this.id=e.id,this.name=e.name||"",this.type=e.type||"process",this.xmlDefinition=e.xmlDefinition||null,this._elements={},(e.elementIDs||[]).forEach((e=>{var t=this.AB.processElementNew(e,this);t&&(this._elements[e]=t)})),this._connections=e.connections||{},super.fromValues(e),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var e=super.toObj();for(var t in["id","name","xmlDefinition"].forEach((t=>{e[t]=this[t]})),e.elementIDs=[],this._elements)e.elementIDs.push(this._elements[t].id);return e.connections=this._connections,e}modelDefinition(){return this.xmlDefinition}modelNew(){this.xmlDefinition=`<?xml version="1.0" encoding="UTF-8"?>\n<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd" id="process-def-${this.id}" targetNamespace="http://bpmn.io/schema/bpmn">\n  <bpmn2:process id="Process_1" isExecutable="true">\n    <bpmn2:startEvent id="StartEvent_1"/>\n  </bpmn2:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds height="36.0" width="36.0" x="412.0" y="240.0"/>\n      </bpmndi:BPMNShape>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn2:definitions>`}modelUpdate(e){this.xmlDefinition=e}connections(e){return e||(e=()=>!0),Object.keys(this._connections).map((e=>this._connections[e])).filter(e)}connectionForDiagramID(e){return this.connections((t=>t.id==e))[0]}connectionsIncoming(e){return this.connections((t=>t.to==e))}connectionsOutgoing(e){return this.connections((t=>t.from==e))}connectionRemove(e){delete this._connections[e.id]}connectionSimplyElement(e){var t=e.businessObject,i=null;t.sourceRef&&(i=t.sourceRef.id);var s=null;return t.targetRef&&(s=t.targetRef.id),{id:e.id,type:e.type,from:i,to:s}}connectionUpsert(e){var t=this.connectionSimplyElement(e);t.from&&t.to?this._connections[t.id]=t:this.connectionRemove(e)}elements(e=(()=>!0)){return Object.keys(this._elements).map((e=>this._elements[e])).filter(e)}elementAdd(e){this._elements[e.id||e.diagramID]=e}elementForDiagramID(e){return this.elements((t=>t.diagramID==e))[0]}elementRemove(e){delete this._elements[e.id||e.diagramID]}isTriggeredBy(e){return null!=this.taskForTriggerKey(e)}connectionPreviousTask(e){var t=[];return this.connections((t=>t.to==e.diagramID)).forEach((e=>{var i=this.elements((t=>t.diagramID==e.from))[0];i&&t.push(i)})),t}processData(e,t){var i=this.connectionPreviousTask(e),s=n(i,"processData",t,this);return s.length>0?s.length>1?s:s[0]:null}processDataFields(e){var t=this.connectionPreviousTask(e),i=n(t,"processDataFields",null,this);return i.length>0?i:null}processDataObjects(e){var t=this.connectionPreviousTask(e),i=n(t,"processDataObjects",null,this);return i.length>0?i:null}taskForTriggerKey(e){return this.elements((t=>t.triggerKey==e))[0]||null}};var n=(e,t,i,s,r,o)=>{if(void 0===r&&(r=[]),void 0===o&&(o=[]),0==e.length)return r;var l=e.shift();if(-1==o.indexOf(l.diagramID)){o.push(l.diagramID);var u=l[t].apply(l,i);null===u&&(u=[]),r=a(r,u),e=a(e,s.connectionPreviousTask(l))}return n(e,t,i,s,r,o)}},5753:(e,t,i)=>{var s=[i(902),i(1051),i(3608),i(7924),i(1939),i(1967),i(8104),i(1404),i(8016),i(9199),i(2715),i(4818),i(2471),i(4411),i(4804),i(1937),i(8446),i(6145),i(6541),i(9285),i(7726),i(6239),i(1227),i(2235),i(9403),i(9136),i(9258),i(1226),i(414),i(8990),i(7855),i(2885),i(9903),i(2011),i(3216),i(704),i(5651),i(6339),i(6311),i(9662),i(6816),i(7856),i(2941),i(8386),i(6114),i(8167),i(6222)],a={};s.forEach((e=>{e.default?.common&&(e=e.default),a[e.common().key]=e})),e.exports=class{static allViews(e=(()=>!0)){var t=[];for(var i in a){var s=a[i];e(s)&&t.push(s)}return t}static newView(e,t,i){if(i=i||null,"detailselectivity"==e.key&&(e.key="detailconnect"),e.key)return a[e.key]?new a[e.key](e,t,i):(console.error("!! View["+e.key+"] not yet defined.  Have an ABView instead:"),new a.view(e,t,i));var s=new Error(`Unknown view key [${e.key}]`);return console.error(s),console.error({error:s,values:e,application:t}),null}static viewClass(e){if(a[e])return a[e];console.error(`Unknown View Key[${e}]`)}}},353:(e,t,i)=>{const s=i(8030);function a(e,t){if(!t)return null;if(!t.columnName)return null;var i=t.columnName,s=null;if(i.indexOf(".")>-1){let t=i.split(".")[1];s=e[i]||e[t]}else s=e[i];if(void 0!==s)return s;for(var a in e){var n=a.split(".")[1];n&&n==t.id&&(s=e[a])}return s}e.exports=class extends s{constructor(e,t){e=e||"ab_filter_complex",void 0===t&&console.error("FilterComplexCore(): being called without an AB!"),super(null,e,t),this.Account={username:"??"},this._settings={},this.condition={},this._QueryFields=[],this._Fields,this._logic={callbacks:{onChange:()=>{}},removeHtmlTags:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}}init(e){e?.showObjectName&&(this._settings.showObjectName=e.showObjectName)}isValid(e){var t=this.condition,i=this._logic;if(null==t||null==t.rules||0==t.rules.length)return!0;if(null==e)return!1;var s="and"===t.glue;return t.rules.forEach((n=>{if(!n.key||!n.rule)return;var r,o=(this._Fields||[]).filter((e=>e.id==n.key))[0];if(!o)return;var l=o.key;let u;switch(void 0===o.key&&("this_object"!=o.id?(o.key="connectField",l=o.key):l="this_object"),u=o.relationName?function(e,t){let i="";if(e){let s=t.relationName();if(e[s])i=(t.indexField?e[s][t.indexField.columnName]:null)??(t.indexField2?e[s][t.indexField2.columnName]:null)??e[s].id??e[s];else{let s=a(e,t);null!=s&&(i=s)}}return i}(e,o):a(e,o),l){case"string":case"LongText":case"email":null==u&&(u=""),r=this.textValid(u,n.rule,n.value);break;case"date":case"datetime":r=this.dateValid(u,n.rule,n.value);break;case"number":r=this.numberValid(u,n.rule,n.value);break;case"list":r=this.listValid(u,n.rule,n.value);break;case"boolean":r=this.booleanValid(u,n.rule,n.value);break;case"user":r=this.userValid(u,n.rule,n.value);break;case"connectField":case"connectObject":r=this.connectFieldValid(e,o,n.rule,n.value);break;case"this_object":r=i.thisObjectValid(e,n.rule,n.value)}s="and"===t.glue?s&&r:s||r})),s}textValid(e,t,i){var s=!1;e=e.trim().toLowerCase(),e=this._logic.removeHtmlTags(e);var a=(i=i.trim().toLowerCase().replace(/  +/g," ")).split(" ");switch(t){case"contains":a.forEach((t=>{0==s&&(s=e.indexOf(t)>-1)}));break;case"not_contains":s=!0,a.forEach((t=>{1==s&&(s=e.indexOf(t)<0)}));break;case"equals":a.forEach((t=>{0==s&&(s=e==t)}));break;case"not_equal":s=!0,a.forEach((t=>{1==s&&(s=e!=t)}));break;case"is_empty":s=""==e||null==e;break;case"is_not_empty":s=""!=e&&null!=e;break;default:s=this.queryFieldValid(e,t,i)}return s}dateValid(e,t,i){var s=!1;switch(e instanceof Date||(e=new Date(e)),i instanceof Date||(i=new Date(i)),t){case"less":s=e<i;break;case"greater":s=e>i;break;case"less_or_equal":s=e<=i;break;case"greater_or_equal":s=e>=i;break;default:s=this.queryFieldValid(e,t,i)}return s}numberValid(e,t,i){var s=!1;switch(e=Number(e),i=Number(i),t){case"equals":s=e==i;break;case"not_equal":s=e!=i;break;case"less":s=e<i;break;case"greater":s=e>i;break;case"less_or_equal":s=e<=i;break;case"greater_or_equal":s=e>=i;break;default:s=this.queryFieldValid(e,t,i)}return s}listValid(e,t,i){var s=!1;switch(Array.isArray(i)||(i=[i]),t){case"equals":e&&(s=i.indexOf(e)>-1);break;case"not_equal":s=!e||i.indexOf(e)<0;break;default:s=this.queryFieldValid(e,t,i)}return s}booleanValid(e,t,i){return"equals"===t?e==i:this.queryFieldValid(e,t,i)}userValid(e,t,i){if(!e)return!1;var s=!1;switch(t){case"is_current_user":s=e==this.Account.username;break;case"is_not_current_user":s=e!=this.Account.username;break;case"contain_current_user":Array.isArray(e)||(e=[e]),s=e.filter((e=>(e.username||e)==this.Account.username)).length>0;break;case"not_contain_current_user":Array.isArray(e)||(e=[e]),s=e.filter((e=>(e.username||e)==this.Account.username)).length<1;break;case"equals":s=e.indexOf(i)>-1;break;case"not_equal":s=e.indexOf(i)<0;break;default:s=this.queryFieldValid(e,t,i)}return s}queryFieldValid(e,t,i){var s=!1;if(!i)return s;var a=i.split(":")[0],n=i.split(":")[1],r=this.AB.queries((e=>e.id==a))[0];if(!r)return s;if(!r.fields((e=>e.id==n))[0])return s;let o="{idBase}-query-field-{id}".replace("{idBase}",this.idBase).replace("{id}",r.id),l=new this.constructor(o,this.AB);switch(l.Account=this.Account,l.fieldsLoad(r.fields()),l.setValue(r.workspaceFilterConditions),t){case"in_query_field":s=l.isValid(e);break;case"not_in_query_field":s=!l.isValid(e)}return s}inQueryValid(e,t,i){let s=!1;if(!i||!this.AB)return s;let a=this.AB.queries((e=>e.id==i))[0];if(!a)return s;let n="{idBase}-query-{id}".replace("{idBase}",this.idBase).replace("{id}",a.id),r=new this.constructor(n,this.AB);switch(r.Account=this.Account,r.fieldsLoad(a.fields()),r.setValue(a.workspaceFilterConditions),t){case"in_query":s=r.isValid(e);break;case"not_in_query":s=!r.isValid(e)}return s}dataCollectionValid(e,t,i){var s=!1;if(!i)return s;let a=this.AB.datacollections((e=>e.id==i))[0];switch(t){case"in_data_collection":if(!a)return!1;s=a.getData((t=>t.id==e.id)).length>0;break;case"not_in_data_collection":if(!a)return!0;s=a.getData((t=>t.id==e.id)).length<1}return s}connectFieldValid(e,t,i,s){let n=t.relationName(),r="";if(e)if(e[n])r=((t.indexField?e[n][t.indexField.columnName]:null)??(t.indexField2?e[n][t.indexField2.columnName]:null)??e[n].id??e[n]).toString().toLowerCase();else{let i=a(e,t);null!=i&&(r=i)}let o=(s||"").toLowerCase();switch(i){case"contains":return r.toString().indexOf(o)>-1;case"not_contains":return-1==r.toString().indexOf(o);case"equals":return r==o;case"not_equal":return r!=o;case"in_query":case"not_in_query":return this.inQueryValid(e[n],i,s);case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":return this.userValid(r,i,s);case"is_empty":return null==e[n]||e[n].length<1||""==e[n];case"is_not_empty":return null!=e[n]&&(Array.isArray(e[n])&&e[n].length>0||""!=e[n]);case"in_data_collection":case"not_in_data_collection":return this.dataCollectionValid(r,i,s)}}thisObjectValid(e,t,i){switch(t){case"in_query":case"not_in_query":if(!this._Object)return!1;let n=this.AB.queries((e=>e.id==i))[0];if(!n)return!1;if(n.objects((e=>e.id==this._Object.id)).length>1)return console.error("HEY!  Can't compare this_object to a query that has > 1 copy of that object!"),!0;var s=n.objectAlias(this._Object.id),a={};return Object.keys(e).forEach((t=>{a[`${s}.${t}`]=e[t]})),this.inQueryValid(a,t,i);case"in_data_collection":case"not_in_data_collection":return this.dataCollectionValid(e,t,i)}}processFieldsLoad(e=[]){e&&!Array.isArray(e)&&(e=[e]),this._ProcessFields=e,this.uiInit()}fieldsLoad(e=[],t=null){if(this._Fields=e.filter((e=>e&&e.fieldIsFilterable&&e.fieldIsFilterable())),this._QueryFields=this._Fields?this._Fields.filter((e=>e&&e.isConnection&&"user"!=e.key)):[],t){this._Object=t;let e={id:"this_object",label:t.label,key:"uuid"};t.viewName&&(e.alias="BASE_OBJECT"),this._Fields.unshift(e)}else delete this._Object}fieldsToQB(){return(this._Fields||[]).map((e=>{let t=e.label;this._settings.showObjectName&&e.object&&e.object.label&&(t=`${e.object.label}.${e.label}`);let i="text",s=[];switch(e.key){case"boolean":s=s.concat(this.fieldsAddFiltersBoolean(e)).concat(this.fieldsAddFiltersQueryField(e));break;case"connectObject":s=this.fieldsAddFiltersQuery(e);break;case"date":case"datetime":i="date",s=s.concat(this.fieldsAddFiltersDate(e)).concat(this.fieldsAddFiltersQueryField(e));break;case"calculate":case"formula":case"number":i="number",s=s.concat(this.fieldsAddFiltersNumber(e)).concat(this.fieldsAddFiltersQueryField(e));break;case"string":case"LongText":case"email":case"AutoIndex":s=s.concat(this.fieldsAddFiltersString(e)).concat(this.fieldsAddFiltersQueryField(e));break;case"list":s=s.concat(this.fieldsAddFiltersList(e)).concat(this.fieldsAddFiltersQueryField(e));break;case"user":s=s.concat(this.fieldsAddFiltersUser(e)).concat(this.fieldsAddFiltersQueryField(e));break;case"uuid":s=s.concat(this.fieldsAddFiltersThisObject(e));break;default:i="text"}return this._isRecordRule&&(s=s.concat(this.fieldsAddFiltersRecordRule(e))),(this._ProcessFields||[]).filter((t=>{if(!t)return!1;if(t.field)return t.field.id==e.id;if(t.key){let i=t.key.split(".").pop();return i==e.id||i==e.key}})).length>0&&(s=s.concat(this.fieldsAddFiltersContext(e))),{id:e.columnName||e.id,value:t,type:i,conditions:s}}))}fieldsAddFiltersDate(e){let t={less:this.labels.component.beforeCondition,greater:this.labels.component.afterCondition,less_or_equal:this.labels.component.onOrBeforeCondition,greater_or_equal:this.labels.component.onOrAfterCondition,less_current:this.labels.component.beforeCurrentCondition,greater_current:this.labels.component.afterCurrentCondition,less_or_equal_current:this.labels.component.onOrBeforeCurrentCondition,greater_or_equal_current:this.labels.component.onOrAfterCurrentCondition,last_days:this.labels.component.onLastDaysCondition,next_days:this.labels.component.onNextDaysCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"datepicker",handler:(t,i)=>this.dateValid(t,e,i)});return i}fieldsAddFiltersString(e){let t={contains:{batch:"text",label:this.labels.component.containsCondition},not_contains:{batch:"text",label:this.labels.component.notContainsCondition},equals:{batch:"text",label:this.labels.component.isCondition},not_equal:{batch:"text",label:this.labels.component.isNotCondition},is_empty:{batch:"none",label:this.labels.component.isEmpty},is_not_empty:{batch:"none",label:this.labels.component.isNotEmpty}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:(t,i)=>this.textValid(t,e,i)});return i}fieldsAddFiltersNumber(e){let t={equals:this.labels.component.equalCondition,not_equal:this.labels.component.notEqualCondition,less:this.labels.component.lessThanCondition,greater:this.labels.component.moreThanCondition,less_or_equal:this.labels.component.lessThanOrEqualCondition,greater_or_equal:this.labels.component.moreThanOrEqualCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"text",handler:(t,i)=>this.numberValid(t,e,i)});return i}fieldsAddFiltersList(e){let t={equals:this.labels.component.equalListCondition,not_equal:this.labels.component.notEqualListCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"list",handler:(t,i)=>this.listValid(t,e,i)});return i}fieldsAddFiltersBoolean(e){let t={equals:this.labels.component.equalListCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"boolean",handler:(t,i)=>this.booleanValid(t,e,i)});return i}fieldsAddFiltersUser(e){let t={is_current_user:{batch:"none",label:this.labels.component.isCurrentUserCondition},is_not_current_user:{batch:"none",label:this.labels.component.isNotCurrentUserCondition},contain_current_user:{batch:"none",label:this.labels.component.containsCurrentUserCondition},not_contain_current_user:{batch:"none",label:this.labels.component.notContainsCurrentUserCondition},equals:{batch:"user",label:this.labels.component.equalListCondition},not_equal:{batch:"user",label:this.labels.component.notEqualListCondition}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:(t,i)=>this.userValid(t,e,i)});return i}fieldsAddFiltersQuery(e){let t={in_query:{batch:"query",label:this.labels.component.inQuery,handler:(e,t)=>this.inQueryValid(e,"in_query",t)},not_in_query:{batch:"query",label:this.labels.component.notInQuery,handler:(e,t)=>this.inQueryValid(e,"not_in_query",t)},same_as_user:{batch:"user",label:this.labels.component.sameAsUser,handler:(e,t)=>this.userValid(e,"same_as_user",t)},not_same_as_user:{batch:"user",label:this.labels.component.notSameAsUser,handler:(e,t)=>this.userValid(e,"not_same_as_user",t)},in_data_collection:{batch:"datacollection",label:this.labels.component.inDataCollection,handler:(e,t)=>this.dataCollectionValid(e,"in_data_collection",t)},not_in_data_collection:{batch:"datacollection",label:this.labels.component.notInDataCollection,handler:(e,t)=>this.dataCollectionValid(e,"not_in_data_collection",t)}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:t[e].handler});return e.settings.isCustomFK&&("one"==e.settings.linkType&&"many"==e.settings.linkViaType||"one"==e.settings.linkType&&"one"==e.settings.linkViaType&&e.settings.isSource)&&(i=this.fieldsAddFiltersString(e).concat(i)),i}fieldsAddFiltersQueryField(e){let t={in_query_field:this.labels.component.inQueryField,not_in_query_field:this.labels.component.notInQueryField},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"queryField",handler:(t,i)=>this.queryFieldValid(t,e,i)});return i}fieldsAddFiltersThisObject(e){let t={in_query:{batch:"query",label:this.labels.component.inQuery},not_in_query:{batch:"query",label:this.labels.component.notInQuery},in_data_collection:{batch:"datacollection",label:this.labels.component.inDataCollection},not_in_data_collection:{batch:"datacollection",label:this.labels.component.notInDataCollection}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:(t,i)=>this.thisObjectValid(t,e,i)});return i}fieldsAddFiltersRecordRule(e){let t={same_as_field:this.labels.component.sameAsField,not_same_as_field:this.labels.component.notSameAsField},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"recordRule",handler:(e,t)=>!0});return i}fieldsAddFiltersContext(e){let t={context_equals:{batch:"context",label:this.labels.component.equalsProcessValue,handler:(e,t)=>e==t},context_not_equal:{batch:"context",label:this.labels.component.notEqualsProcessValueCondition,handler:(e,t)=>e!=t},context_in:{batch:"context",label:this.labels.component.inProcessValueCondition,handler:(e,t)=>e.indexOf(t)>-1},context_not_in:{batch:"context",label:this.labels.component.notInProcessValueCondition,handler:(e,t)=>-1==e.indexOf(t)}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:t[e].handler});return i}queriesLoad(e=[]){this._Queries=e}queries(e=(()=>!0)){return(this._Queries??this.AB?.queries?.()??[]).filter((t=>e(t)))}setValue(e){this.condition=e||{},this.condition.rules=this.condition.rules||[]}getValue(){return void 0===this.condition.glue&&(this.condition.glue="and"),this.condition}isComplete(){let e=!0;const t=["is_current_user","is_not_current_user","contain_current_user","not_contain_current_user","same_as_user","not_same_as_user"],i=(s=[])=>{0!=e&&s.forEach((s=>{s?.rules&&Array.isArray(s?.rules)?i(s?.rules):e=e&&null!=s?.key&&""!=s?.key&&null!=s?.rule&&""!=s?.rule&&(null!=s?.value&&""!=s?.value||t.indexOf(s?.rule)>-1)}))};return i(this.condition?.rules),e}}},1584:(e,t,i)=>{const s=i(8030);function a(e,t,i=!0){if(!t)return null;if(!t.columnName)return null;e&&e[0]&&(e=e[0]);let s=t.id,a=t.columnName,n=null;if(a.indexOf(".")>-1){let t=a.split(".")[1];n=e[a]||e[t]||e[s]}else n=e[a]||e[s];if(n)return n;for(var r in e){var o=r.split(".")[1];!o||o!=s&&o!=a||(n=e[r])}return n&&Array.isArray(n)&&(n=n.filter((e=>null!=e)),i&&(n=n[0])),n}e.exports=class extends s{constructor(e,t,i){super(e,t=t||"ab_row_filter",i),this.Account={username:"??"},this._settings={},this.config_settings={},this._QueryFields=[],this._Fields;var s=this._logic={callbacks:{onChange:()=>{}},getValue:()=>this.config_settings,removeHtmlTags:function(e){let t="";try{let i=document.createElement("div");i.innerHTML=e,t=i.textContent||i.innerText||""}catch(i){t=(e||"").replace(/(<([^>]+)>)/gi,"")}return t},textValid:function(e,t,i,n){var r=!1,o=a(e,t);null==o&&(o=""),o=o.toString().trim().toLowerCase(),o=s.removeHtmlTags(o);var l=(n=n.toString().trim().toLowerCase().replace(/  +/g," ")).split(" ");switch(i){case"contains":l.forEach((e=>{0==r&&(r=o.indexOf(e)>-1)}));break;case"not_contains":r=!0,l.forEach((e=>{1==r&&(r=o.indexOf(e)<0)}));break;case"equals":l.forEach((e=>{0==r&&(r=o==e)}));break;case"not_equal":r=!0,l.forEach((e=>{1==r&&(r=o!=e)}));break;case"is_empty":r=null==o||""==o;break;case"is_not_empty":r=null!=o&&""!=o;break;default:r=s.queryValid(e,i,n)}return r},dateValid:function(e,t,i,n){var r=!1,o=a(e,t);switch(o instanceof Date||(o=new Date(o)),n instanceof Date||(n=new Date(n)),i){case"equals":r=o==n;break;case"not_equal":r=o!=n;break;case"less":r=o<n;break;case"greater":r=o>n;break;case"less_or_equal":r=o<=n;break;case"greater_or_equal":r=o>=n;break;default:r=s.queryValid(e,i,n)}return r},numberValid:function(e,t,i,n){var r=!1,o=a(e,t);switch(o=Number(o),n=Number(n),i){case"equals":r=o==n;break;case"not_equal":r=o!=n;break;case"less":r=o<n;break;case"greater":r=o>n;break;case"less_or_equal":r=o<=n;break;case"greater_or_equal":r=o>=n;break;default:r=s.queryValid(e,i,n)}return r},listValid:function(e,t,i,n){var r=!1,o=a(e,t);switch(o&&o.toLowerCase&&(o=o.toLowerCase()),n=n.toLowerCase(),Array.isArray(n)||(n=[n]),i){case"equals":o&&(r=n.indexOf(o)>-1);break;case"not_equal":r=!o||n.indexOf(o)<0;break;default:r=s.queryValid(e,i,n)}return r},booleanValid:function(e,t,i,n){var r=!1,o=a(e,t);switch(null==o&&(o=!1),i){case"equals":r=o==n;break;case"not_equal":r=o!=n;break;default:r=s.queryValid(e,i,n)}return r},userValid:(e,t,i,n)=>{var r=!1,o=a(e,t);switch(i){case"is_current_user":r=o==this.Account.username;break;case"is_not_current_user":r=o!=this.Account.username;break;case"contain_current_user":if(!o){r=!1;break}Array.isArray(o)||(o=[o]),r=(o||[]).filter((e=>!!e&&(e.username||e.id||e.text||e)==this.Account.username)).length>0;break;case"not_contain_current_user":if(!o){r=!1;break}Array.isArray(o)||(o=[o]),r=0==(o||[]).filter((e=>!!e&&(e.username||e.id||e.text||e)==this.Account.username)).length;break;case"equals":r=o.indexOf(n)>-1;break;case"not_equal":r=o.indexOf(n)<0;break;default:r=s.queryValid(e,i,n)}return r},queryValid:(e,i,s)=>{var a=!1;if(!this.AB||!s)return a;var n=s.split(":")[0],r=s.split(":")[1],o=this.queries((e=>e.id==n))[0];if(!o)return a;if(!o.fields((e=>e.id==r))[0])return a;let l="{idBase}-query-field-{id}".replace("{idBase}",t).replace("{id}",o.id),u=new this.constructor(this.App,l);switch(u.Account=this.Account,u.fieldsLoad(o.fields()),u.setValue(o.workspaceFilterConditions),i){case"in_query_field":a=u.isValid(e);break;case"not_in_query_field":a=!u.isValid(e)}return a},inQueryValid:(e,i,s,a)=>{let n=!1;if(i&&(e=e[i]||{}),!a||!this.AB)return n;let r=this.queries((e=>e.id==a))[0];if(!r)return n;let o="{idBase}-query-{id}".replace("{idBase}",t).replace("{id}",r.id),l=new this.constructor(this.App,o);switch(l.Account=this.Account,l.fieldsLoad(r.fields()),l.setValue(r.workspaceFilterConditions),s){case"in_query":n=l.isValid(e);break;case"not_in_query":n=!l.isValid(e)}return n},dataCollectionValid:(e,t,i,s)=>{var a=!1;if(!s||!this.AB)return a;t&&(e=e[t]||{});let n=this.AB.datacollectionByID(s);switch(i){case"in_data_collection":if(!n)return!1;a=n.getData((t=>(t.id||t.uuid)==(e.id||e.uuid))).length>0;break;case"not_in_data_collection":if(!n)return!0;a=n.getData((t=>(t.id||t.uuid)==(e.id||e.uuid))).length<1}return a},connectFieldValid:function(e,t,i,n){let r=t.relationName(),o=(t.columnName,"");if(e)if(e[r])o=(!!t.indexField&&e[r][t.indexField.columnName]||!!t.indexField2&&e[r][t.indexField2.columnName]||e[r].id||e[r]).toString().toLowerCase();else{let i=a(e,t);null!=i&&(o=i)}let l=(n||"").toLowerCase();switch(i){case"contains":return o.toString().indexOf(l)>-1;case"not_contains":return-1==o.toString().indexOf(l);case"equals":return o==l;case"not_equal":return o!=l;case"in_query":case"not_in_query":return s.inQueryValid(e,r,i,n);case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":return s.userValid(e,t,i,n);case"is_empty":return null==e[r]||e[r].length<1||""==e[r];case"is_not_empty":return null!=e[r]&&(Array.isArray(e[r])&&e[r].length>0||""!=e[r]);case"in_data_collection":case"not_in_data_collection":return s.dataCollectionValid(e,r,i,n)}},thisObjectValid:(e,t,i)=>{switch(t){case"in_query":case"not_in_query":if(!this.AB||!this._Object)return!1;var a=this.queries((e=>e.id==i))[0];if(!a)return!1;if(a.objects((e=>e.id==this._Object.id)).length>1)return console.error("HEY!  Can't compare this_object to a query that has > 1 copy of that object!"),!0;var n=a.objectAlias(this._Object.id),r={};return Object.keys(e).forEach((t=>{r[`${n}.${t}`]=e[t]})),s.inQueryValid(r,null,t,i);case"in_data_collection":case"not_in_data_collection":return s.dataCollectionValid(e,null,t,i)}}};this.getValue=s.getValue}init(e){e.showObjectName&&(this._settings.showObjectName=e.showObjectName)}isValid(e){var t=this.config_settings,i=this._logic;if(null==t||null==t.rules||0==t.rules.length)return!0;if(null==e)return!1;var s="and"===t.glue;return t.rules.forEach((a=>{if(a.key&&a.rule){var n=this._Fields.filter((e=>e.id==a.key))[0];if(n){var r,o=n.key;switch(void 0===n.key&&("this_object"!=n.id?(n.key="connectField",o=n.key):o="this_object"),o){case"string":case"LongText":case"email":r=i.textValid(e,n,a.rule,a.value);break;case"date":case"datetime":r=i.dateValid(e,n,a.rule,a.value);break;case"number":r=i.numberValid(e,n,a.rule,a.value);break;case"list":r=i.listValid(e,n,a.rule,a.value);break;case"boolean":r=i.booleanValid(e,n,a.rule,a.value);break;case"user":r=i.userValid(e,n,a.rule,a.value);break;case"connectField":case"connectObject":r=i.connectFieldValid(e,n,a.rule,a.value);break;case"this_object":r=i.thisObjectValid(e,a.rule,a.value)}s="and"===t.glue?s&&r:s||r}}})),s}fieldsLoad(e=[],t=null){if(this._Fields=e.filter((e=>e&&e.fieldIsFilterable())),this._QueryFields=this._Fields?this._Fields.filter((e=>e&&e.isConnection&&"user"!=e.key)):[],t){this._Object=t;let e={id:"this_object",label:t.label};t.viewName&&(e.alias="BASE_OBJECT"),this._Fields.unshift(e)}else delete this._Object}queriesLoad(e=[]){this._Queries=e}queries(e=(()=>!0)){let t=[];return this.AB&&(t=t.concat(this.AB.queries(e))),this._Queries&&(t=t.concat((this._Queries||[]).filter((i=>e(i)&&t.filter((e=>e.id==i.id)).length<1)))),t}setValue(e){this.config_settings=e||{},this.config_settings.rules=this.config_settings.rules||[]}}},6552:(e,t,i)=>{const s=i(4403);function a(e,t){return t}const n={key:"AutoIndex",description:"Auto Increment Value",icon:"key",isFilterable:!0,isSortable:!0,menuName:"Auto Index",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer"]},r={prefix:"",delimiter:"none",displayLength:4,previewText:"0000"};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return r}static getDelimiterSign(e){const t=this.delimiterList().filter((t=>t.id==e))[0];return t?t.sign:""}static delimiterList(){return[{id:"none",value:a(),sign:""},{id:"comma",value:a(),sign:", "},{id:"slash",value:a(),sign:"/"},{id:"space",value:a(),sign:" "},{id:"dash",value:a(),sign:"-"},{id:"colon",value:a(),sign:":"}]}static setValueToIndex(e,t,i,s){return e+this.getDelimiterSign(t)+("0000000000"+s).slice(-parseInt(i))}fromValues(e){super.fromValues(e),this.settings.displayLength=parseInt(this.settings.displayLength)}defaultValue(e){delete e[this.columnName]}format(e){if(!e[this.columnName])return"";try{return this.constructor.setValueToIndex(this.settings.prefix,this.settings.delimiter,this.settings.displayLength,e[this.columnName])}catch(e){return""}}}},3104:(e,t,i)=>{const s=i(4403),a={key:"boolean",description:"A single checkbox that can be checked or unchecked.",icon:"check-square-o",isFilterable:!0,isSortable:!1,menuName:"Checkbox",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["boolean"],compatibleMysqlTypes:["bool","boolean"]},n={default:0};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),null!=this.settings.default&&(this.settings.default=parseInt(this.settings.default))}defaultValue(e){null==e[this.columnName]&&null!=this.settings.default&&(e[this.columnName]=this.settings.default)}}},4562:(module,__unused_webpack_exports,__webpack_require__)=>{const ABField=__webpack_require__(4403);function L(e,t){return t}function AGE(e){if(!e)return 0;const t=new Date(e);if(!t)return 0;const i=(new Date-t)/31536e6;return i<1?Math.round(10*i)/10:Math.floor(i)}function YEAR(e){if(!e)return 0;const t=new Date(e);return t?t.getFullYear():0}function MONTH(e){if(!e)return 0;const t=new Date(e);return t?t.getMonth():0}function DAY(e){if(!e)return 0;const t=new Date(e);return t?t.getDate():0}function DATE(e){if(!e)return 0;const t=new Date(e);return t?Math.round(t.getTime()/864e5):0}function HOUR(e){if(!e)return 0;const t=new Date(e);return t?Math.round(t.getTime()/36e5):0}function MINUTE(e){if(!e)return 0;const t=new Date(e);return t?Math.round(t.getTime()/6e4):0}function MINUTE_TO_HOUR(e){const t=e/60,i=Math.floor(t),s=60*(t-i),a=Math.round(s);return parseFloat(`${i}.${a}`)}const ABFieldCalculateDefaults={key:"calculate",description:"Perform a calculation based upon existing values",icon:"calculator",isFilterable:e=>0==["MINUTE_TO_HOUR","DATE","HOUR","MINUTE"].filter((t=>e.settings.formula.includes(t))).length,isSortable:!1,menuName:"Calculate",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},defaultValues={formula:"",decimalSign:"none",decimalPlaces:0};module.exports=class ABFieldCalculateCore extends ABField{constructor(e,t){super(e,t,ABFieldCalculateDefaults)}static defaults(){return ABFieldCalculateDefaults}static defaultValues(){return defaultValues}static convertToJs(object,formula,rowData,place,alias=null){return formula?(formula=formula.replace(/\(CURRENT\)/g,"(new Date())"),object.fields().forEach((e=>{let t=e.columnName;if(t.indexOf(".")>-1&&(t=t.split(".")[1]),formula.indexOf("{"+t+"}")<0)return;const i=rowData[`${object.alias??alias}.${e.columnName}`]??rowData[e.columnName];if("number"==e.key){const e=`(${i||0})`;formula=formula.replace(new RegExp("{"+t+"}","g"),e)}else if("calculate"==e.key||"formula"==e.key){let i=e.format(rowData)||0;"string"==typeof i&&(i=i.replace(/[^-0-9.]/g,"")),i=`(${i})`,formula=formula.replace(new RegExp("{"+t+"}","g"),i)}else if("date"==e.key){const e=`"${i||""}"`;formula=formula.replace(new RegExp("{"+t+"}","g"),e)}else if("boolean"==e.key){const e=`(${i||0})`;formula=formula.replace(new RegExp("{"+t+"}","g"),e)}})),eval(formula).toFixed(place||0)):""}defaultValue(e){delete e[this.columnName]}format(e){let t=0;"none"!=this.settings.decimalSign&&(t=this.settings.decimalPlaces);try{let i=this.constructor.convertToJs(this.object,this.settings.formula,e,t,this.alias);switch(this.settings.decimalSign){case"comma":i=i.replace(".",",");break;case"space":i=i.replace("."," ")}return i}catch(e){return""}}}},3551:(e,t,i)=>{const s=i(4403),a={key:"combined",description:"Combined Value",icon:"key",isFilterable:!0,isSortable:!1,menuName:"Combined Field",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},n={combinedFields:"",delimiter:"plus"};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.delimiter=e.settings.delimiter||n.delimiter}defaultValue(e){delete e[this.columnName]}warnings(){return this._warnings=[],(this.settings.combinedFields.split(",")||[]).forEach((e=>{this.object.fieldByID(e)||this.emit("warning","dependent field not found",{fieldID:e,combinedFields:this.settings.combinedFields})})),this._warnings}}},6932:(e,t,i)=>{var s=i(4403);const a={key:"connectObject",description:"Connect two data objects together",icon:"external-link",isFilterable:!0,isSortable:e=>["one:many","one:one"].indexOf(`${e?.settings?.linkType}:${e?.settings?.linkViaType}`)>-1,menuName:"Connect to another record",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},n={linkObject:"",linkType:"one",linkViaType:"many",linkColumn:"",isSource:null,isCustomFK:0,indexField:"",indexField2:""};e.exports=class extends s{constructor(e,t,i=a){super(e,t,i),this.isConnection=!0}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.isSource=parseInt(this.settings.isSource||0),this.settings.isCustomFK=parseInt(this.settings.isCustomFK||0)}warnings(){return this._warnings=[],this.fieldLink||this.emit("warning",`ConnectField[${this.label}][${this.id}] is unable to find linked field[${this.settings.linkColumn}]`,{linkColumn:this.settings.linkColumn}),this.datasourceLink||this.emit("warning",`ConnectField[${this.label}][${this.id}] is unable to find linked object[${this.settings.linkObject}]`,{linkObject:this.settings.linkObject}),this._warnings}defaultValue(){}isValidData(e,t){super.isValidData(e,t)}relationName(){if(this.columnName.indexOf(".")>-1){const e=this.columnName.split(".");return`${e[0]}.${this.AB.rules.toFieldRelationFormat(e[1])}`}return this.AB.rules.toFieldRelationFormat(this.columnName)}get datasourceLink(){const e=this.AB.objectByID(this.settings.linkObject);if(!e){const e=new Error(`ConnectField[${this.label}][${this.id}] unable to find linkObject[${this.settings.linkObject}]`);this.AB.notify.builder(e,{field:this,linkObject:this.settings.linkObject})}return e}get fieldLink(){const e=this.datasourceLink;if(!e)return null;const t=e.fieldByID(this.settings.linkColumn);if(!t){const e=new Error(`ConnectField[${this.label}][${this.id}] unable to find linkColumn[${this.settings.linkColumn}]`);this.AB.notify.builder(e,{field:this,linkColumn:this.settings.linkColumn})}return t}pullRelationValues(e){let t;const i=this.datasourceLink;let s=this.dataValue(e);if(s&&i){if("string"==typeof s)try{s=JSON.parse(s)}catch(e){t=s}t=s}return t}dataValue(e){if(null==e)return"";const t=`${this.object.name}.${this.relationName()}`;return e[this.relationName()]||e[t]||e[this.columnName]||""}format(e){const t=this.pullRelationValues(e),i=this.datasourceLink;return Array.isArray(t)?t.map((e=>null==e.text?i.displayData(e)||"":e.text||"")).join(", "):t?null==t.text?i.displayData(e)||"":t.text?t.text||"":void 0:""}linkType(){return this.settings.linkType}linkViaType(){return this.settings.linkViaType}isSource(){return this.settings.isSource}get indexField(){if(!this.settings.isCustomFK||!this.settings.indexField)return null;if("one"==this.settings.linkType&&"many"==this.settings.linkViaType)return this.datasourceLink.fields((e=>e.id==this.settings.indexField))[0];if("one"==this.settings.linkType&&"one"==this.settings.linkViaType)return this.settings.isSource?this.datasourceLink.fields((e=>e.id==this.settings.indexField))[0]:this.object.fields((e=>e.id==this.settings.indexField))[0];if("many"==this.settings.linkType&&"one"==this.settings.linkViaType)return this.object.fields((e=>e.id==this.settings.indexField))[0];if("many"==this.settings.linkType&&"many"==this.settings.linkViaType){let e=this.object.fields((e=>e.id==this.settings.indexField))[0];return null==e&&(e=this.datasourceLink.fields((e=>e.id==this.settings.indexField))[0]),e}return null}get indexField2(){if(!this.settings.isCustomFK||!this.settings.indexField2)return null;let e;return"many"==this.settings.linkType&&"many"==this.settings.linkViaType&&(e=this.object.fields((e=>e.id==this.settings.indexField2))[0],null==e&&(e=this.datasourceLink.fields((e=>e.id==this.settings.indexField2))[0])),e}getRelationValue(e,t={}){if(null==e)return;let i;const s=this.indexField,a=this.datasourceLink;if("many"==this.settings.linkType&&"many"==this.settings.linkViaType){const e=this.indexField2;s&&s.object.id==a.id?i=s.columnName:e&&e.object.id==a.id&&(i=e.columnName)}else s&&("one"==this.settings.linkType&&"many"==this.settings.linkViaType||"one"==this.settings.linkType&&"one"==this.settings.linkViaType&&this.settings.isSource)?i=s.columnName:"many"==this.settings.linkType&&"one"==this.settings.linkViaType?i=t.forUpdate?a.PK():s?s.columnName:this.fieldLink.columnName:a&&(i=a.PK());let n=e[i]||e.id||e;return"id"==i&&(n=parseInt(n)),n}}},8601:(e,t,i)=>{const s=i(7069);e.exports=class extends s{constructor(e,t,i){super(["label"],t.AB),this.defaults=i||{},this.object=t,this.fromValues(e)}static get reservedNames(){return["id","created_at","updated_at","properties","createdAt","updatedAt"]}static defaultValues(){return{}}fieldKey(){return this.defaults.key}fieldOrmTypes(){return this.defaults.compatibleOrmTypes?Array.isArray(this.defaults.compatibleOrmTypes)?this.defaults.compatibleOrmTypes:[this.defaults.compatibleOrmTypes]:[]}fieldMysqlTypes(){return this.defaults.compatibleMysqlTypes?Array.isArray(this.defaults.compatibleMysqlTypes)?this.defaults.compatibleMysqlTypes:[this.defaults.compatibleMysqlTypes]:[]}fieldIcon(){return this.defaults.icon}fieldMenuName(){return this.defaults.menuName}fieldDescription(){return this.defaults.description}fieldIsFilterable(){return null!=this.defaults.isFilterable?"function"==typeof this.defaults.isFilterable?this.defaults.isFilterable(this):this.defaults.isFilterable:1}fieldIsSortable(){return null!=this.defaults.isSortable?"function"==typeof this.defaults.isSortable?this.defaults.isSortable(this):this.defaults.isSortable:1}fieldUseAsLabel(){return null!=this.defaults.useAsLabel?"function"==typeof this.defaults.useAsLabel?this.defaults.useAsLabel(this):this.defaults.useAsLabel:1}fieldSupportRequire(){return!this.defaults.supportRequire||this.defaults.supportRequire}fieldSupportQuery(){return null==this.defaults.supportQuery||("function"==typeof this.defaults.supportQuery?this.defaults.supportQuery(this):this.defaults.supportQuery)}toObj(){const e=super.toObj();return{id:this.id,type:this.type||"field",key:this.key,icon:this.icon,isImported:this.isImported,columnName:this.columnName,settings:this.settings,translations:e.translations}}defaultCheck(e,t){let i=t;return void 0!==e&&(i=e),i}fromValues(e){this.id||(this.id=e.id),this.type,e.type,this.key=e.key||this.fieldKey(),this.icon=e.icon||this.fieldIcon(),this.label=e.label||e.settings.label||"?label?",this.columnName=e.columnName||"",this.isImported=e.isImported||0,e.settings=e.settings||{},this.settings=e.settings,this.settings.showIcon=this.defaultCheck(e.settings.showIcon,"1"),this.settings.required=this.defaultCheck(e.settings.required,"0"),this.settings.width=this.defaultCheck(e.settings.width,"0"),this.isImported=parseInt(this.isImported),this.settings.showIcon=parseInt(this.settings.showIcon),this.settings.required=parseInt(this.settings.required),this.settings.unique=parseInt(this.settings.unique||0),this.settings.width=parseInt(this.settings.width);const t=this.constructor.defaultValues()||{};for(const i in t)this.settings[i]=this.defaultCheck(e.settings[i],t[i]);super.fromValues(e),this.columnName=this.columnName||this.label,this.columnName=this.columnName.replace(/[^a-zA-Z0-9_ ]/gi,"")}urlPointer(){return this.object.urlField()+this.id}defaultValue(e){e[this.columnName]=""}isValidData(e,t){!this.settings.required||null!=e[this.columnName]&&""!=e[this.columnName]||0==e[this.columnName]||t.addError(this.columnName,"This is a required field.")}get isMultilingual(){return!1}dataValue(e){const t=`${this.alias||this.object.name}.${this.columnName}`;let i="";return null!=e[this.columnName]?i=e[this.columnName]:null!=e[t]&&(i=e[t]),i}format(e){return e?this.dataValue(e):""}toDefinition(){const e=super.toDefinition();return""==e.name&&(e.name=e.json.name||e.json.label||e.json.columnName),this.object&&this.object.name&&(e.name=`${this.object.name}->${e.name}`),e}}},6915:(e,t,i)=>{const s=i(4403);function a(e,t){return t}const n={key:"date",description:"Pick one from a calendar.",icon:"calendar",isFilterable:!0,isSortable:!0,menuName:"Date",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["date"],compatibleMysqlTypes:["date"]},r={dateFormat:2,defaultDate:1,defaultDateValue:null,validateCondition:"none",validateRangeUnit:"days",validateRangeBefore:0,validateRangeAfter:0,validateStartDate:null,validateEndDate:null};e.exports=class extends s{constructor(e,t,i=n){super(e,t,i)}static defaults(){return n}static defaultValues(){return r}fromValues(e){super.fromValues(e),this.settings.dateFormat=parseInt(this.settings.dateFormat),this.settings.defaultDate=parseInt(this.settings.defaultDate)}defaultValue(e){if(null!=e[this.columnName])return;let t;2==this.settings.defaultDate?t=new Date:3==this.settings.defaultDate&&this.settings.defaultDateValue&&(t=new Date(this.settings.defaultDateValue)),null!=t&&(e[this.columnName]=this.AB.toDateFormat(t,{format:"YYYY-MM-DD"}))}isValidData(e,t){if(super.isValidData(e,t),e[this.columnName]){let i=e[this.columnName];if(i instanceof Date||(i=this.AB.toDate(i)),"[object Date]"===Object.prototype.toString.call(i)&&isFinite(i)){let s=!0;if(this.settings&&this.settings.validateCondition){const e=this.settings.validateStartDate?new Date(this.settings.validateStartDate):null,n=this.settings.validateEndDate?new Date(this.settings.validateEndDate):null,r=this.getDateDisplay(e),o=this.getDateDisplay(n),l=this.AB.subtractDate(new Date,this.settings.validateRangeBefore,this.settings.validateRangeUnit),u=this.AB.addDate(new Date,this.settings.validateRangeAfter,this.settings.validateRangeUnit);switch(this.settings.validateCondition){case"dateRange":l<i&&i<u?s=!0:(s=!1,t.addError(this.columnName,a(0,[this.getDateDisplay(l),this.getDateDisplay(u)])));break;case"between":e<i&&i<n?s=!0:(s=!1,t.addError(this.columnName,a(0,[r,o])));break;case"notBetween":i<e&&n<i?s=!0:(s=!1,t.addError(this.columnName,a(0,[r,o])));break;case"=":s=i.getTime&&e.getTime&&i.getTime()==e.getTime(),s||t.addError(this.columnName,a(0,[r]));break;case"<>":s=i.getTime&&e.getTime&&i.getTime()!=e.getTime(),s||t.addError(this.columnName,a(0,[r]));break;case">":s=i.getTime&&e.getTime&&i.getTime()>e.getTime(),s||t.addError(this.columnName,a(0,[r]));break;case"<":s=i.getTime&&e.getTime&&i.getTime()<e.getTime(),s||t.addError(this.columnName,a(0,[r]));break;case">=":s=i.getTime&&e.getTime&&i.getTime()>=e.getTime(),s||t.addError(this.columnName,a(0,[r]));break;case"<=":s=i.getTime&&e.getTime&&i.getTime()<=e.getTime(),s||t.addError(this.columnName,a(0,[r]))}}s&&(e[this.columnName]=this.exportValue(i))}else t.addError(this.columnName,"Should be a Date!")}}format(e){const t=this.dataValue(e);if(""==t||null==t)return"";const i=this.AB.toDate(t);return this.getDateDisplay(i)}getFormat(){let e="";switch(this.settings&&this.settings.dateFormat?this.settings.dateFormat:""){case 2:default:e="%d/%m/%Y";break;case 3:e="%m/%d/%Y";break;case 4:e="%M %d, %Y";break;case 5:e="%d %M, %Y"}return e}getDateDisplay(e){const t=this.getFormat();return this.dateToString(t,e)}exportValue(e){return e?this.AB.toDateFormat(e,{format:"YYYY-MM-DD"}):""}dateToString(e,t){return t&&t.toString?t.toString():""}},e.exports.RegEx="^[0-9]{4}-[0-9]{2}-[0-9]{2}$"},6926:(e,t,i)=>{const s=i(6915),a={key:"datetime",description:"Pick one from date & time.",icon:"clock-o",isFilterable:!0,isSortable:!1,menuName:"Date & Time",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["datetime"],compatibleMysqlTypes:["datetime"]},n={timeFormat:2,defaultTime:1,defaultTimeValue:null};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){const e=super.defaultValues();return Object.assign(e,n)}fromValues(e){super.fromValues(e),this.settings.timeFormat=parseInt(this.settings.timeFormat),this.settings.defaultTime=parseInt(this.settings.defaultTime)}defaultValue(e){if(null!=e[this.columnName])return;let t;if(super.defaultValue(e),e[this.columnName]&&(t=this.AB.toDate(e[this.columnName])),2==this.settings.defaultTime){const e=new Date;null==t&&(t=new Date),t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()),t.setMilliseconds(e.getMilliseconds())}else if(3==this.settings.defaultTime&&this.settings.defaultTimeValue){const e=new Date(this.settings.defaultTimeValue);null==t&&(t=new Date),t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()),t.setMilliseconds(e.getMilliseconds())}null!=t&&(e[this.columnName]=t.toISOString())}getFormat(){const e=this.getTimeFormat();return this.settings=this.settings||{},1==this.settings.dateFormat?e:`${super.getFormat()} ${e}`}format(e){const t=this.getFormat(),i=this.dataValue(e),s=this.AB.toDate(i);return""==i||null==i?"":webix.Date.dateToStr(t)(s)}getTimeFormat(){switch(this.settings=this.settings||{},this.settings.timeFormat){case 2:return" %h:%i %A";case 3:return" %H:%i";default:return""}}exportValue(e){return e?.toISOString?.()??""}},e.exports.RegEx="^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}$"},6945:(e,t,i)=>{const s=i(4403),a={key:"email",description:"Email fields are used to store email addresses.",icon:"envelope",isFilterable:!0,isSortable:!1,menuName:"Email",supportRequire:!0,supportUnique:!0,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},n={default:"",defaultCheckbox:0};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.default=e.settings.default||""}defaultValue(e){e[this.columnName]||this.settings.default&&(e[this.columnName]=this.settings.default)}isValidData(e,t){if(e[this.columnName]){const i=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;let s=e[this.columnName];s=String(s).toLowerCase(),i.test(s)||t.addError(this.columnName,"Invalid email")}}}},5019:(e,t,i)=>{const s=i(4403),a={key:"file",description:"Attach a File to this object.",icon:"file",isFilterable:!1,isSortable:!1,menuName:"File Attachment",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},n={removeExistingData:0,fileSize:0,fileType:""};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.fileSize=parseInt(this.settings.fileSize),this.settings.limitFileSize=parseInt(this.settings.limitFileSize),this.settings.limitFileType=parseInt(this.settings.limitFileType),this.settings.removeExistingData=parseInt(this.settings.removeExistingData)}dataValue(e){const t=`${this.alias||this.object.name}.${this.columnName}`;let i=e[this.columnName]||e[t]||{};if("string"==typeof i)try{i=JSON.parse(i)}catch(e){}return i}defaultValue(e){e[this.columnName]="{}"}format(e){let t=this.dataValue(e);if(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}return t&&t.filename||""}return""}requestParam(e){const t=super.requestParam(e);return"{}"==t?.[this.columnName]&&delete t[this.columnName],t}}},8725:(e,t,i)=>{const s=i(4403),a={key:"formula",description:"Perform a calculation by a formula type based upon existing values",icon:"circle-o-notch",isFilterable:!0,isSortable:!1,menuName:"Formula",supportQuery:e=>{const t=e.fieldLink;return null!=t&&"calculate"!==t.key},supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},n={field:"",objectLink:"",fieldLink:"",type:"sum",where:""};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}defaultValue(e){delete e[this.columnName]}format(e,t=!1){const i=this.fieldLink,s=e=>{if(i&&"calculate"!=i.key){const t={};return t[i.columnName]=e,i.format(t)}return e};if(null!=e[this.columnName]&&!t)return s(e[this.columnName]);if(!i)return 0;const a=this.fieldBase();if(!a)return 0;let n=e[a.relationName()]||e[a.columnName]||[];Array.isArray(n)||(n=[n]),n&&n.length&&this.settings&&this.settings.where&&this.settings.where.rules&&this.settings.where.rules.length&&(this.filterHelper.setValue(this.settings.where),n=n.filter((e=>this.filterHelper.isValid(e))));let r=[];switch(i.key){case"calculate":n.forEach((e=>{r.push(parseFloat(i.format(e)||0))}));break;case"number":r=n.map((e=>e[i.columnName]||0))}let o=0;const l=i.getDecimalSize();switch(this.settings.type){case"sum":if(r.length>0){const e=Math.pow(10,l);let t=0;r.forEach((i=>{t+=i*e||0})),o=t/e}break;case"average":if(r.length>0){const e=Math.pow(10,l);let t=0;r.forEach((i=>{t+=i*e||0})),o=t/e/r.length}break;case"max":o=Math.max(...r)||0;break;case"min":o=Math.min(...r)||0;break;case"count":o=r.length}return e[this.columnName]=o,"calculate"==i.key?o:s(o)}fieldBase(){return this.object.fields((e=>e.id==this.settings.field))[0]}get fieldLink(){const e=this.object.AB.objects((e=>e.id==this.settings.object))[0];if(!e)return null;return e.fields((e=>e.id==this.settings.fieldLink))[0]||null}get filterHelper(){return null==this._rowFilter&&(this._rowFilter=this.AB.filterComplexNew(`${this.id}_filterComplex`),this.fieldLink&&this.fieldLink.object&&(this._rowFilter.fieldsLoad(this.fieldLink.object.fields()),this._rowFilter.setValue(this.settings.where))),this._rowFilter}}},4342:(e,t,i)=>{const s=i(4403),a={key:"image",description:"Attach an image to this object.",icon:"file-image-o",isFilterable:!1,isSortable:!1,menuName:"Image Attachment",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},n={useWidth:0,imageWidth:"",useHeight:0,imageHeight:"",removeExistingData:0,useDefaultImage:!1,defaultImageUrl:""};e.exports=class extends s{constructor(e,t){if(super(e,t,a),"*Image Attachment"==a.menuName&&this.AB.Label){const e=this.AB.Label();a.menuName=e("ab.dataField.image.menuName","*Image Attachment"),a.description=e("ab.dataField.image.description","*Attach an image to this object.")}}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.useWidth=parseInt(this.settings.useWidth),this.settings.useHeight=parseInt(this.settings.useHeight),this.settings.imageWidth=parseInt(this.settings.imageWidth),this.settings.imageHeight=parseInt(this.settings.imageHeight),this.settings.useDefaultImage=parseInt(this.settings.useDefaultImage),this.settings.removeExistingData=parseInt(this.settings.removeExistingData)}isValidData(e,t){super.isValidData(e,t)}}},6611:(e,t,i)=>{const s=i(4403),a={key:"json",description:"JSON value",icon:"font",isFilterable:!1,isSortable:!1,menuName:"JSON",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["json"],compatibleMysqlTypes:["json"]},n={};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}defaultValue(e){}}},8472:(e,t,i)=>{const s=i(4403),a={key:"list",description:"Select list allows you to select predefined options below from a dropdown.",icon:"th-list",isFilterable:e=>!e.settings.isMultiple,isSortable:e=>!e.settings.isMultiple,menuName:"Select list",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],hasColors:e=>!!e.settings.hasColors},n={isMultiple:0,hasColors:0,options:[],default:"none",multipleDefault:[]};e.exports=class extends s{constructor(e,t){super(e,t,a),this.pendingDeletions=[]}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.options&&this.settings.options.length>0&&this.settings.options.forEach((e=>{this.translate(e,e,["text"])})),this.settings.isMultiple=parseInt(this.settings.isMultiple),this.settings.hasColors=parseInt(this.settings.hasColors)}toObj(){const e=super.toObj();return e.settings.options.forEach((e=>{this.unTranslate(e,e,["text"])})),e}defaultValue(e){if(1==this.settings.isMultiple){let t=[];this.settings.multipleDefault.forEach((e=>{this.settings.options.forEach((i=>{i.id==e.text&&t.push(i)}))})),e[this.columnName]=t||[]}else this.settings.default&&""!=this.settings.default&&(e[this.columnName]=this.settings.default)}isValidData(e,t){super.isValidData(e,t)}options(){return this.settings.options.map((e=>({id:e.id,text:e.text,hex:e.hex?e.hex:"",translations:e.translations?e.translations:""})))}format(e,t={}){let i=this.dataValue(e)||[];if("string"==typeof i)try{i=JSON.parse(i)}catch(e){}return Array.isArray(i)||(i=[i]),this.settings.options.filter((e=>i.filter((t=>(t.id||t)==e.id)).length>0)).map((e=>{let i=e.text;const s=t.languageCode||"en",a=(e.translations||[]).filter((e=>e.language_code==s))[0];return a&&(i=a.text),i})).join(", ")}}},7143:(e,t,i)=>{const s=i(4403),a={key:"LongText",description:"Multiple lines of text",icon:"align-right",isFilterable:!0,isSortable:!1,menuName:"Long text",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["longtext","mediumtext","text"],compatibleMysqlTypes:["text","mediumtext","longtext"],MAX_CHAR_LENGTH:5e3},n={default:"",supportMultilingual:0};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.default=e.settings.default||"",this.settings.supportMultilingual=e.settings.supportMultilingual+""||n.supportMultilingual,this.settings.supportMultilingual=parseInt(this.settings.supportMultilingual),this.settings.supportMultilingual?this.object&&this.object.translate(this.settings,this.settings,["default"]):this.settings.default=e.settings.default||""}toObj(){const e=super.toObj();return this.settings.supportMultilingual&&(this.object?this.object.unTranslate(e.settings,e.settings,["default"]):e.settings.default=this.settings.default),e}get isMultilingual(){return 1==this.settings.supportMultilingual}defaultValue(e){null==e[this.columnName]&&("string"==typeof this.settings.default?e[this.columnName]=this.settings.default:e[this.columnName]="")}isValidData(e,t){super.isValidData(e,t),e&&e[this.columnName]&&e[this.columnName].length>5e3&&t.addError(this.columnName,"should NOT be longer than 5000 characters")}}},9671:(e,t,i)=>{const s=i(4403),a={key:"number",description:"A Float or Integer Value",icon:"hashtag",isFilterable:!0,isSortable:!0,menuName:"Number",supportRequire:!0,supportUnique:!0,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},n={default:"",typeFormat:"none",typeDecimals:"none",typeDecimalPlaces:0,typeRounding:"none",typeThousands:"none",validation:0,validateMinimum:"",validateMaximum:""};let r=null;e.exports=class extends s{constructor(e,t){super(e,t,a),r||(r=this.AB.Label())}static defaults(){return a}static defaultValues(){return n}static formatList(e){return e&&!r&&(r=e),[{id:"none",value:r("None")},{id:"dollar",value:r("$"),sign:"$",position:"prefix"},{id:"yen",value:r("¥"),sign:"¥",position:"prefix"},{id:"pound",value:r("£"),sign:"£",position:"prefix"},{id:"euroBefore",value:r("€ (before)"),sign:"€",position:"prefix"},{id:"euroAfter",value:r("€ (after)"),sign:"€",position:"postfix"},{id:"percent",value:r("%"),sign:"%",position:"postfix"}]}static delimiterList(){return[{id:"none",value:r("None")},{id:"comma",value:r("Comma"),sign:","},{id:"period",value:r("Period"),sign:"."},{id:"space",value:r("Space"),sign:" "}]}fromValues(e){super.fromValues(e),this.settings.validation=parseInt(this.settings.validation)}defaultValue(e){""!=this.settings.default&&(e[this.columnName]=this.settings.default)}isValidData(e,t){if(super.isValidData(e,t),null!=e[this.columnName]&&""!=e[this.columnName]){let s=e[this.columnName];if("none"==this.settings.typeDecimals)s=parseInt(s);else{const e=parseInt(this.settings.typeDecimalPlaces)||2;s=parseFloat(parseFloat(s).toFixed(e))}if(i=s,!Number.isNaN(parseFloat(i))&&Number.isFinite(i)||t.addError(this.columnName,r("invalid number")),1==this.settings.validation&&null!=this.settings.validateMinimum&&this.settings.validateMinimum>s){const e=r("should be greater than {0}",[this.settings.validateMinimum]);t.addError(this.columnName,e)}if(1==this.settings.validation&&null!=this.settings.validateMaximum&&this.settings.validateMaximum<s){const e=r("should be less than {0}",[this.settings.validateMaximum]);t.addError(this.columnName,e)}}var i}format(e){if(null==e[this.columnName]||0!=e[this.columnName]&&""==e[this.columnName])return"";let t=e[this.columnName]||0;"string"==typeof t&&(t=t.replace(/,/g,"")),isNaN(parseFloat(t))&&(t=0);const i=this.constructor.formatList().filter((e=>e.id==this.settings.typeFormat))[0],s="none"!=this.settings.typeDecimalPlaces?parseInt(this.settings.typeDecimalPlaces):0;let a=this.constructor.delimiterList().filter((e=>e.id==this.settings.typeThousands))[0],n=this.constructor.delimiterList().filter((e=>e.id==this.settings.typeDecimals))[0],r="",o="";if(i&&i.sign)switch(i.position){case"prefix":r=i.sign;break;case"postfix":o=i.sign}if(n=n.sign||"",a=a.sign||"","roundDown"==this.settings.typeRounding){const e=Math.pow(10,s);t=Math.floor(t*e)/e}return`${r} ${this.formatNumber(t,{groupDelimiter:a,groupSize:3,decimalDelimiter:n,decimalSize:s})} ${o}`}formatNumber(e,t={}){if(""===e||null==e)return e;const i=(e=parseFloat(e))<0?"-":"",s=(e=Math.abs(e)).toString(),a=s.split(".")[0],n=s.split(".")[1];let r="";if(t.groupDelimiter){const e=3;let i=a.length;do{i-=e,r=`${i>0?a.substr(i,e):a.substr(0,e+i)}${r?t.groupDelimiter+r:""}`}while(i>0)}else r=a;let o="";return o=t.decimalDelimiter&&t.decimalSize?`${i}${r}${n?t.decimalDelimiter+n.toString().substr(0,t.decimalSize):""}`:`${i}${r}`,o}getDecimalSize(){return"none"!=this.settings.typeDecimalPlaces?parseInt(this.settings.typeDecimalPlaces):0}}},6756:(e,t,i)=>{const s=i(4403),a={key:"string",description:"short string value",icon:"font",isFilterable:!0,isSortable:!0,menuName:"Single line text",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],MAX_CHAR_LENGTH:255},n={default:"",supportMultilingual:0};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.default=e.settings.default||n.default,this.settings.supportMultilingual=e.settings.supportMultilingual+""||n.supportMultilingual,this.settings.supportMultilingual=parseInt(this.settings.supportMultilingual),this.settings.supportMultilingual?this.translate(this.settings,this.settings,["default"]):this.settings.default=e.settings.default||""}toObj(){const e=super.toObj();return this.settings.supportMultilingual?this.unTranslate(e.settings,e.settings,["default"]):e.settings.default=this.settings.default,e}defaultValue(e){e[this.columnName]||this.settings.default&&(this.settings.default.indexOf("{uuid}")>=0?e[this.columnName]=this.AB.uuid():e[this.columnName]=this.settings.default)}isValidData(e,t){super.isValidData(e,t);const i=this.AB.Label();e&&e[this.columnName]&&e[this.columnName].length>255&&t.addError(this.columnName,i("should NOT be longer than {0} characters",[255]))}get isMultilingual(){return 1==this.settings.supportMultilingual}}},8585:(module,__unused_webpack_exports,__webpack_require__)=>{const ABField=__webpack_require__(4403);function L(e,t){return t}const ABFieldTextFormulaDefaults={key:"TextFormula",description:"Text Formula",icon:"question",isFilterable:!1,isSortable:!1,menuName:"Text Formula",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},defaultValues={textFormula:""};function setValueToFormula(object,formulaString,rowData){if(!formulaString)return;const fieldRegExp=/{[^{}]+}/gm,matches_field_array=formulaString.match(fieldRegExp);return matches_field_array.forEach((element=>{const columnName=element.replace(/{|}|"/g,"");object.fields().forEach((field=>{if(field.columnName==columnName)if("AutoIndex"==field.key){const e=field.format(rowData)||0;formulaString=formulaString.replace(element,e)}else if("calculate"==field.key){const calVal=`(${field.format(rowData)||0})`;formulaString=formulaString.replace(element,eval(calVal))}else formulaString="date"==field.key?formulaString.replace(element,rowData[columnName]?field.exportValue(rowData[columnName]):""):formulaString.replace(element,rowData[columnName]?field.format(rowData):"")}))})),formulaString}function setBuildinValueToFormula(e,t){const i=t.match(/\w+\(.*?\)/gm);if(i){const s=getBuildInFunction();i.forEach((i=>{const a=i.split(/\(|\)/),n=a.length>2&&""!=a[2],r=a[0],o=a[1].split(",");let l=!1;for(let a=0;a<s.length;a++){let u=i;if(r==s[a].id){if(o.length==s[a].parameter_size){switch(r){case"left":u=getLeft(o[0],o[1]);break;case"right":u=getRight(o[0],o[1]);break;case"mid":u=getMid(o[0],o[1],o[2]);break;case"trim":u=getTrim(o[0]);break;case"trimLeft":u=getTrimLeft(o[0]);break;case"trimRight":u=getTrimRight(o[0]);break;case"length":u=getLength(o[0]);break;case"regexReplace":u=getRegExpReplace(o[0],o[1].trimLeft(),o[2].trimLeft());break;case"extractRegex":u=getExtractRegex(o[0],o[1].trimLeft());break;case"replace":u=getReplace(o[0],o[1].trimLeft(),o[2].trimLeft());break;case"lower":u=getLower(o[0]);break;case"upper":u=getUpper(o[0]);break;case"capitalize":u=getCapitalize(o[0]);break;case"random":u=getRandom(o[0]);break;case"numberToWords":u=getNumberToWords(o[0]);break;case"getDateDayOfWeekName":n&&(i+=")"),u=getDateDayOfWeekName(e,o[0]);break;case"getDateMonthOfYearName":n&&(i+=")"),u=getDateMonthOfYearName(e,o[0]);break;case"formatDate":u=getFormatDate(o[0],o[1].trimLeft())}return l=!0,void(t=t.replace(i,u))}u=r+"(Bad Parameter)",t=t.replace(i,u)}}}))}return t}function getBuildInFunction(){return[{id:"left",value:"left({COLUMN_NAME}, 1)",type:"build-in",parameter_size:2},{id:"right",value:"right({COLUMN_NAME}, 1)",type:"build-in",parameter_size:2},{id:"mid",value:"mid({COLUMN_NAME}, 1, 1)",type:"build-in",parameter_size:3},{id:"trim",value:"trim({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"trimLeft",value:"trimLeft({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"trimRight",value:"trimRight({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"length",value:"length({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"regexReplace",value:"regexReplace({COLUMN_NAME}, [*], REPLACE_VALUE)",type:"build-in",parameter_size:3},{id:"extractRegex",value:"extractRegex({COLUMN_NAME}, [*])",type:"build-in",parameter_size:2},{id:"replace",value:"replace({COLUMN_NAME}, SEARCH_VALUE, REPLACE_VALUE)",type:"build-in",parameter_size:3},{id:"lower",value:"lower({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"upper",value:"upper({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"capitalize",value:"capitalize({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"random",value:"random(1)",type:"build-in",parameter_size:1},{id:"numberToWords",value:"numberToWords({NUMBER_COLUMN} or 012...)",type:"build-in",parameter_size:1},{id:"getDateDayOfWeekName",value:"getDateDayOfWeekName({DATE_COLUMN})",type:"build-in",parameter_size:1},{id:"getDateMonthOfYearName",value:"getDateMonthOfYearName({DATE_COLUMN})",type:"build-in",parameter_size:1},{id:"formatDate",value:"formatDate({DATE_COLUMN}, OUTPUT_FORMAT)",type:"build-in",parameter_size:2}]}function getLeft(e,t){return e.substring(0,parseInt(t))}function getRight(e,t){const i=reverseString(e).substring(0,parseInt(t));return reverseString(i)}function reverseString(e){return e.split(" ").reverse().join(" ")}function getMid(e,t,i){return e.length<t?"mid(Bad Parameter)":e.substring(parseInt(t),parseInt(t)+parseInt(i))}function getTrim(e){return e.trim()}function getTrimLeft(e){return e.trimLeft()}function getTrimRight(e){return e.trimRight()}function getLength(e){return e.length}function getRegExpReplace(e,t,i){return e.replace(t,i)}function getExtractRegex(e,t){const i=e.match(t);return Array.isArray(i)?i[0]:i}function getReplace(e,t,i){return e.replace(t,i)}function getLower(e){return e.toLowerCase()}function getUpper(e){return e.toUpperCase()}function getCapitalize(e){return e.toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.substring(1))).join(" ")}function getRandom(e){return Math.floor(Math.random()*(e+1))}function getNumberToWords(e){const t=e.trim(",").toString();let i,s,a,n,r,o,l,u,c,d,h,p;if(0===parseInt(t))return"zero";for(i=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],s=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],a=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion","undecillion","duodecillion","tredecillion","quatttuor-decillion","quindecillion","sexdecillion","septen-decillion","octodecillion","novemdecillion","vigintillion","centillion"],n=t.length,o=[];n>0;)r=n,o.push(t.slice(n=Math.max(0,n-3),r));if(l=o.length,l>a.length)return"";for(p=[],d=0;d<l;d++)u=parseInt(o[d]),u&&(c=o[d].split("").reverse().map(parseFloat),1===c[1]&&(c[0]+=10),(h=a[d])&&p.push(h),(h=i[c[0]])&&p.push(h),(h=s[c[1]])&&p.push(h),(c[0]||c[1])&&(c[2]||!d&&l)&&p.push(""),(h=i[c[2]])&&p.push(h+" hundred"));return p.reverse().join(" ")}function getDateDayOfWeekName(e,t){return e.toDateFormat(t,{format:"dddd",localeCode:e.Account.language()})}function getDateMonthOfYearName(e,t){return e.toDateFormat(t,{format:"MMMM",localeCode:e.Account.language()})}function getFormatDate(e,t){return new Date(e).toString(t)}module.exports=class extends ABField{constructor(e,t){super(e,t,ABFieldTextFormulaDefaults)}static defaults(){return ABFieldTextFormulaDefaults}static defaultValues(){return defaultValues}static getBuildInFunction(){return getBuildInFunction()}defaultValue(e){e[this.columnName]}isValidData(e,t){return super.isValid()}get isMultilingual(){return!1}format(e){try{if(!this.settings.textFormula)return"";let t=this.settings.textFormula;return t=setValueToFormula(this.object,t,e),t=setBuildinValueToFormula(this.AB,t),t}catch(e){return""}}}},8630:(e,t,i)=>{const s=i(7038),a={key:"tree",description:"Data tree allows you to build a hierarchical set of selectable data. (ex: Categories and sub-categories)",icon:"sitemap",isFilterable:!1,isSortable:!1,menuName:"Data Tree",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},n={options:[]};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.options&&this.settings.options.length>0&&this.settings.options.forEach((e=>{this.translate(e,e,["text"])}))}toObj(){const e=super.toObj();return e.settings.options&&e.settings.options.length>0&&e.settings.options.forEach((e=>{this.unTranslate(e,e,["text"])})),e}defaultValue(e){}isValidData(e,t){super.isValidData(e,t)}}},8665:(e,t,i)=>{const s=i(6589),a={key:"user",description:"Add users to a record.",icon:"user-o",isFilterable:!0,isSortable:e=>!e.settings.isMultiple,menuName:"User",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],USERNAME_FIELD_ID:"5760560b-c078-47ca-98bf-e18ac492a561"},n={editable:1,isMultiple:0,isCurrentUser:0,isShowProfileImage:0,isShowUsername:1};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.editable=parseInt(this.settings.editable),this.settings.isMultiple=parseInt(this.settings.isMultiple),this.settings.isCurrentUser=parseInt(this.settings.isCurrentUser),this.settings.isShowProfileImage=parseInt(this.settings.isShowProfileImage),this.settings.isShowUsername=parseInt(this.settings.isShowUsername)}format(e){let t=this.dataValue(e)||[];return t&&!Array.isArray(t)&&(t=[t]),t||(t=[]),t.map((e=>e.username||e)).join(", ")}}},2418:(e,t,i)=>{const s=i(7692),a={type:"process.lane"};e.exports=class extends s{constructor(e,t,i){super(e,t,i)}static defaults(){return a}fromValues(e){super.fromValues(e),this.type=e.type||a.type}}},2957:(e,t,i)=>{const s=i(7069),a={type:"process.participant"};e.exports=class extends s{constructor(e,t,i){super(["label"],i),this.process=t,this.processID||(this.processID=t.id),this.fromValues(e)}static defaults(){return a}fromValues(e){this.id=e.id,this.name=e.name||"",this.type=e.type||a.type,this.key=e.key||a.type,this.processID=e.processID||null,this.diagramID=e.diagramID||"?diagramID?",this.laneIDs=e.laneIDs||[],this.stashed=!1,e.stashed&&""!=e.stashed&&(this.stashed=e.stashed),this.useRole=0,void 0!==e.useRole&&(this.useRole=parseInt(e.useRole)),this.role=0,void 0!==e.role&&(this.role=e.role),this.useAccount=0,void 0!==e.useAccount&&(this.useAccount=parseInt(e.useAccount)),this.account=0,void 0!==e.account&&(this.account=e.account),this.useField=0,void 0!==e.useField&&(this.useField=parseInt(e.useField)),this.fields=[],void 0!==e.fields&&(this.fields=e.fields),super.fromValues(e),this.label||(this.label=this.name)}toObj(){!this.label&&this.name&&""!=this.name&&(this.label=this.name);var e=super.toObj();return["id","name","type","processID","diagramID","laneIDs","where","useRole","role","useAccount","account","useField","fields","stashed"].forEach((t=>{e[t]=this[t]})),e}}},2719:(e,t,i)=>{var s={},a={},n=[i(8556),i(9036),i(8872),i(5187),i(2845),i(346),i(3618),i(9841),i(6088),i(7757),i(5811),i(4430),i(6298),i(8063),i(6031),i(2448),i(6732),i(2513),i(2038)];n.forEach((e=>{switch(s[e.defaults().key]=e,e.defaults().category){case"start":case"end":a[e.DiagramReplace().target.eventDefinitionType]=e.defaults();break;case"gateway":case"task":a[e.DiagramReplace().target.type]=e.defaults()}})),e.exports={allTasks:function(){var e=[];for(var t in s)e.push(s[t]);return e},newTask:function(e,t,i){if(e.key)return new s[e.key](e,t,i)},DiagramReplaceDefinitionsForType:function(e){return n.filter((t=>t.defaults().category==e)).map((e=>e.DiagramReplace()))},StartEvents:function(){return this.DiagramReplaceDefinitionsForType("start")},Gateways:function(){return this.DiagramReplaceDefinitionsForType("gateway")},Tasks:function(){return this.DiagramReplaceDefinitionsForType("task")},EndEvents:function(){return this.DiagramReplaceDefinitionsForType("end")},definitionForElement:function(e){var t=null;if(e.businessObject.eventDefinitions){var i=e.businessObject.eventDefinitions[0];i&&(t=i.$type)}return t||(t=e.type),a[t]}}},9929:(e,t,i)=>{var s=i(7069);e.exports=class extends s{constructor(e,t,i,s){super(["label"],i),this.defaults=s||{key:"core",icon:"core"},this.fromValues(e),this.process=t,this.processID||(this.processID=t.id),this.state=null}fromValues(e){this.id=e.id,this.name=e.name||"",this.type=e.type||"process.task.unknown",this.key=e.key||this.defaults.key||"?key?",this.processID=e.processID||null,this.diagramID=e.diagramID||"?diagramID?",this.laneDiagramID=e.laneDiagramID||"?laneID?",this.defaults&&this.defaults.settings&&this.defaults.settings.forEach((t=>{void 0===e[t]?this[t]=null:this[t]=e[t]})),super.fromValues(e),this.label||(this.label=this.name)}toObj(){!this.label&&this.name&&""!=this.name&&(this.label=this.name);var e=super.toObj();return["id","name","type","processID","diagramID","laneDiagramID","key"].forEach((t=>{e[t]=this[t]})),this.defaults&&this.defaults.settings&&this.defaults.settings.forEach((t=>{e[t]=this[t]})),e}errorConfig(e,t,i=[]){this.log(e,t);var s=new Error(`${this.type}: ${t}`),a={task:this};return Array.isArray(i)||(i=[i]),i.forEach((e=>{a[e]=this[e]})),this.AB.notify.builder(s,a),Promise.reject(s)}initState(e,t,i){if(t=t||{},i||(i=t,t={},this.defaults&&this.defaults.instanceValues&&this.defaults.instanceValues.forEach((e=>{t[e]=null}))),e.taskState=e.taskState||{},!e.taskState[this.diagramID]){for(var s in e.taskState[this.diagramID]={initialized:!0,status:"initialized"},t)e.taskState[this.diagramID][s]=t[s];for(var a in i)e.taskState[this.diagramID][a]=i[a]}}log(e,...t){var i=`${this.diagramID} : ${this.name?this.name:this.key} : ${t.join(" ")}`;e.log.push(i)}myLane(){return this.process.elementForDiagramID(this.laneDiagramID)}myState(e){return e.context.taskState[this.diagramID]}nextTasks(e){var t=[],i=e.hashDiagramObjects[this.diagramID];if(!i){var s=new Error(`Configuration Error: Did not find my definition for dID[${this.diagramID}]`);return this.onError(e,s),null}var a=i["bpmn2:outgoing"];if(!a)return s=new Error(`Configuration Error: Did not find any outgoing flows for dID[${this.diagramID}]`),this.AB.notify.builder(s,{task:this}),this.onError(e,s),null;Array.isArray(a)||(a=[a]);var n=i=>{var s=e.hashDiagramObjects[i._text];if(s){var a=s._attributes.targetRef;a&&(Array.isArray(a)||(a=[a]),a.forEach((i=>{var s=this.process.elementForDiagramID(i);if(s)t&&t.push(s);else{var a=new Error(`Configuration Error: No ProcessTask instance for diagramID[${i}]`);this.AB.notify.builder(a,{task:this}),this.onError(e,a),t=null}})))}};return a.forEach((e=>{n(e)})),t}onError(e,t){if(t){var i=`${t.toString()}`;this.log(e,i)}this.myState(e).status="error"}processDataFields(){return null}processData(e,t){return null}processDataObjects(){return null}hashProcessDataValues(e){var t=this.process.processDataFields(this),i={};return t.forEach((t=>{i[t.key]=this.process.processData(this,[e,t.key])})),i}reset(e){var t=this.myState(e);t?"completed"!=t.status&&"error"!=t.status||(delete e.context.taskState[this.diagramID],this.initState(e.context),this.myState(e)._prevState=t,this.log(e," Reset() called. Running again. ")):this.initState(e.context)}stateCompleted(e){this.myState(e).status="completed"}stateUpdate(e,t){t=t||{};var i=this.myState(e);for(var s in t)i[s]=t[s]}wantToDoSomething(e){var t=this.myState(e);return t?"completed"!=t.status&&"error"!=t.status:(console.warn("ABProcessTaskCore:wantToDoSomething(): called without having initialized our state first.",e),this.initState(e.context),this.wantToDoSomething(e))}get startElements(){return this.process.elements((e=>e&&e.defaults&&"start"==e.defaults.category))||[]}get previousElements(){return this.process.connectionPreviousTask(this)}get objectOfStartElement(){const e=this.startElements[0];return e?this.AB.objectByID(e.objectID):null}get objectOfPrevElement(){let e,t=this.previousElements[0];return t?(e="process.task.service.query"===t.type?t.qlObj?t.qlObj.objectID:null:t.objectID,this.AB.objectByID(e)):null}}},5197:(e,t,i)=>{const s=i(1073);var a={category:"end",fields:[],icon:"stop",key:"End"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.end",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}}initState(e,t){super.initState(e,{triggered:!1},t)}nextTasks(e){return[]}}},2889:(e,t,i)=>{const s=i(1073);var a={category:"gateway",icon:"check-circle",instanceValues:[],key:"GatewayExclusive",settings:["conditions"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.gateway.exclusive",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}}}}},2399:(e,t,i)=>{const s=i(1073);var a={category:"task",fields:["to","from","subject","message","toCustom","fromCustom","toUsers","fromUsers"],icon:"email",key:"Email"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.email",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}}}fromValues(e){super.fromValues(e),a.fields.forEach((t=>{this[t]=e[t]}))}toObj(){var e=super.toObj();return a.fields.forEach((t=>{e[t]=this[t]})),e}initState(e,t){var i={to:[],from:[],subject:this.subject,message:this.message};super.initState(e,i,t)}}},7912:(e,t,i)=>{const s=i(1073);var a={category:null,icon:"check-circle",instanceValues:[],key:"AccountingBatchProcessing",settings:["objectBatch","processBatchValue","fieldBatchEntries","fieldBatchFinancialPeriod","objectJE","fieldJEAccount","fieldJERC","fieldJEStatus","fieldJEStatusComplete","objectBR","fieldBRFinancialPeriod","fieldBRAccount","fieldBRRC","fieldBREntries"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.batchProcessing",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}}},939:(e,t,i)=>{const s=i(1073);var a={category:null,icon:"check-circle",instanceValues:[],key:"AccountingFPClose",settings:["processFPValue","objectFP","objectGL","objectAcc","fieldFPStart","fieldFPOpen","fieldFPStatus","fieldFPActive","fieldGLStarting","fieldGLRunning","fieldGLAccount","fieldGLRc","fieldGLDebit","fieldGLCredit","fieldAccType","fieldAccAsset","fieldAccExpense","fieldAccLiabilities","fieldAccEquity","fieldAccIncome"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.fpClose",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}}},1166:(e,t,i)=>{const s=i(1073);var a={category:null,icon:"check-circle",instanceValues:[],key:"AccountingFPYearClose",settings:["processFPYearValue","objectFPYear","objectFPMonth","objectGL","objectAccount","valueFundBalances","valueNetIncome","fieldFPYearStart","fieldFPYearEnd","fieldFPYearStatus","fieldFPYearActive","fieldFPMonthStart","fieldFPMonthEnd","fieldGLStartBalance","fieldGLRunningBalance","fieldGLrc","fieldAccNumber","fieldAccType","fieldAccTypeIncome","fieldAccTypeExpense","fieldAccTypeEquity"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.fpYearClose",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}}},9205:(e,t,i)=>{const s=i(1073);let a={category:null,icon:"archive",instanceValues:[],key:"AccountingJEArchive",settings:["processBatchValue","objectBatch","objectBalance","objectJE","objectJEArchive","fieldBatchFiscalMonth","fieldJeAccount","fieldJeRC","fieldJeArchiveBalance","fieldBrFiscalMonth","fieldBrAccount","fieldBrRC","fieldsMatch"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.jeArchive",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}}},689:(e,t,i)=>{const s=i(1073);let a={category:null,icon:"calculator",instanceValues:[],key:"Calculate",settings:["formulaText"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.calculate",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}processDataFields(){return{key:`${this.id}.value`,label:`${this.label}->Value`}}}},9376:(e,t,i)=>{const s=i(1073);var a={category:"task",icon:"check-circle",instanceValues:[],key:"TaskService",settings:[]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}}}}},8856:(e,t,i)=>{const s=i(1073),a={category:null,icon:"plus-circle",instanceValues:[],key:"GetResetPasswordUrl",settings:["email"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.getResetPasswordUrl",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}processDataFields(){return{key:`${this.id}.url`,label:`${this.label}->URL`}}}},4858:(e,t,i)=>{const s=i(1073);let a={category:null,icon:"plus-circle",instanceValues:[],key:"InsertRecord",settings:["objectID","fieldValues","isRepeat","repeatMode","repeatColumn"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.insertRecord",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}fromValues(e){super.fromValues(e),this.isRepeat=JSON.parse(e.isRepeat||!1)}get startElement(){return this.process.elements((e=>e&&e.defaults&&"start"==e.defaults.category))[0]}get previousElement(){return this.process.connectionPreviousTask(this)[0]}get objectOfStartElement(){let e=this.startElement;return e?this.AB.objectByID(e.objectID):null}get objectOfPrevElement(){let e,t=this.previousElement;return t?(e="process.task.service.query"===t.type?t.qlObj?t.qlObj.objectID:null:t.objectID,this.AB.objectByID(e)):null}get fieldRepeat(){let e=this.objectOfStartElement;return e?e.fields((e=>e.id==this.repeatColumn))[0]:null}}},5002:(e,t,i)=>{const s=i(1073),a=i(6370);var n={category:null,icon:"check-circle",instanceValues:[],key:"TaskServiceQuery",settings:["qlObj"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.query",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}fromValues(e){super.fromValues(e),this._datasources=[],this.qlObj&&(this.qlObj=a.fromAttributes(this.qlObj,this,this.AB))}toObj(){var e=super.toObj();return this.qlObj&&(e.qlObj=this.qlObj.toObj()),e}registerDatasource(e){this._datasources.push(e)}processDataFields(){var e=null;return this._datasources.length>0&&(e=[],this._datasources.forEach((t=>{var i=t.processDataField(this.id,this.label);i&&e.push(i)}))),e}processData(e,t){var i=t.split(".");return i[0]==this.id?this.myState(e)[i[1]]:null}}},6146:(e,t,i)=>{const s=i(1073);let a={category:"task",icon:"object-group",instanceValues:[],key:"SubProcess",settings:["isEnable","parameterId","connectionAttrs","elementIDs","loopType"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.subProcess",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}}fromValues(e){super.fromValues(e),this.isEnable=null==this.isEnable||JSON.parse(this.isEnable),this._elements={},(e.elementIDs||[]).forEach((e=>{let t=this.AB.processElementNew(e,this);t&&(this._elements[e]=t)})),this._connections=e.connectionAttrs||{}}toObj(){let e=super.toObj();e.elementIDs=[];for(let t in this._elements)e.elementIDs.push(this._elements[t].id);return e.connectionAttrs=this._connections,e}processDataFields(e){if(null==this.parameterId)return[];let t=(this.process.processDataFields(this)||[]).filter((e=>e.key==this.parameterId))[0];if(null==t)return[];let i=[];t.field&&"connectObject"==t.field.key&&t.field.datasourceLink&&t.field.datasourceLink.fields?(i.push({key:`${this.id}.uuid.subProcess`,label:`${this.label}->Repeat Data.ID`,object:t.field.datasourceLink}),t.field.datasourceLink.fields().forEach((e=>{i.push({key:`${this.id}.${e.id}.subProcess`,label:`${this.label}->Repeat Data.${e.label}`,field:e,object:e.object})}))):i.push({key:t.field?`${this.id}.${t.field.id}.subProcess`:`${this.id}.subProcess`,label:`${this.label}->Repeat Data`,field:t.field,object:t.object});let s=this.process.processDataFields.call(this,e);return s&&s.length>0&&(i=i.concat(s)),i}processData(e,t){let i,s=t[0],a=t[1];if(s&&a&&a.startsWith&&a.startsWith(this.id)){let e=a.split(".")[2],t=this.myState(s),n=t?t.data:null;if(i=n,n&&e){let t=(this.process.processDataFields(this)||[]).filter((e=>e.key==this.parameterId))[0];t&&t.field&&"connectObject"==t.field.key&&(Array.isArray(n)||(n=[n]),i=n.map((i=>{if("uuid"==e||"id"==e)return i.uuid||i.id;if(t.field.datasourceLink){let s=t.field.datasourceLink.fields((t=>t.id==e))[0];return s?i[s.columnName]:i}})))}}return null==i&&(i=this.process.processData.call(this,e,t)),null==i&&(i=this.process.processData(this,t)),i}connections(e){return this.process.connections.call(this,e)}connectionForDiagramID(e){if(e)return this.process.connectionForDiagramID.call(this,e)}connectionsIncoming(e){if(e)return this.process.connectionsIncoming.call(this,e)}connectionsOutgoing(e){if(e)return this.process.connectionsOutgoing.call(this,e)}connectionRemove(e){e&&this.process.connectionRemove.call(this,e)}connectionSimplyElement(e){if(e)return this.process.connectionSimplyElement.call(this,e)}connectionUpsert(e){e&&this.process.connectionUpsert.call(this,e)}connectionPreviousTask(e){if(e)return this.process.connectionPreviousTask.call(this,e)}elements(e=(()=>!0)){return this.process.elements.call(this,e)}elementAdd(e){e&&this.process.elementAdd.call(this,e)}elementForDiagramID(e){return e?this.process.elementForDiagramID.call(this,e):null}elementRemove(e){e&&this.process.elementRemove.call(this,e)}}},2501:(e,t,i)=>{const s=i(1073),a=i(9319);var n={category:null,icon:"check-circle",instanceValues:["userFormID","userFormResponse"],key:"Approval",settings:["who","toUsers","formBuilder"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.user.approval",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}fromValues(e){super.fromValues(e),function e(t){t&&Object.keys(t).forEach((i=>{"false"==t[i]?t[i]=!1:"true"==t[i]?t[i]=!0:"object"==typeof t[i]&&e(t[i])}))}(this.formBuilder)}preProcessFormIOComponents(){var e=this.process.processDataFields(this);return e&&this.formBuilder&&this.formBuilder.components&&this.formBuilder.components.forEach((t=>{t.abFieldID?e.filter((e=>{if(e.field&&e.field.id==t.abFieldID&&(t.label=e.field.label,t.key=e.key,t.data&&t.data.values&&e.field.settings.options)){var i=[];e.field.settings.options.forEach((e=>{i.push({label:e.text,value:e.id})})),t.data.values=i}})):t.components&&t.components.length&&(t.key=t.path,t.components.forEach((i=>{if(i.abFieldID){var s=e.filter((e=>e.key==t.path))[0];if(!s)return;s.object.fields().filter((e=>{if(e&&e.id==i.abFieldID&&(i.label=e.label,i.key=e.columnName,i.data&&i.data.values&&e.settings.options)){var t=[];e.settings.options.forEach((e=>{t.push({label:e.text,value:e.id})})),i.data.values=t}}))}})))})),this.formBuilder}processDataFields(){var e=[];this.formBuilder.components.forEach((t=>{"button"==t.type&&"event"==t.action&&t.event&&e.push({id:t.event,text:t.label})}));var t=this.diagramID,i=this.AB.objectNew({}),s=new a({id:`${t}.userFormResponse`,label:`${this.label}->Response`,columnName:`${t}.userFormResponse`,settings:{options:e}},i);return[{key:`${t}.userFormResponse`,label:`${this.label}->Response`,field:s,object:null}]}processData(e,t){if(t){var i=t.split(".");if(i[0]==this.diagramID)return this.myState(e)[i[1]]}return null}}},6493:(e,t,i)=>{const s=i(1073);var a={category:"task",icon:"user",instanceValues:[],key:"TaskUser",settings:[]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.user",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}}}initState(e,t){super.initState(e,{roles:[],ui:null},t)}}},9483:(e,t,i)=>{const s=i(1073),a={category:null,icon:"plus-circle",instanceValues:["userFormID","userFormResponse"],key:"External",settings:["who","toUsers","url"]},n={who:"0",toUsers:null,url:""};e.exports=class extends s{constructor(e,t,i){for(const t in n)e[t]=e[t]??n[t];super(Object.assign({type:"process.task.service.external"},e),t,i,a)}static defaults(){return a}static DiagramReplace(){return null}processDataFields(){return[{key:`${this.id}.userFormResponse`,label:`${this.label}->Response`}]}}},1600:(e,t,i)=>{const s=i(1073);var a={category:"start",fields:[],icon:"key",key:"Trigger"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"trigger",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}}fromValues(e){super.fromValues(e),this.triggerKey=e.triggerKey||"triggerKey.??"}toObj(){var e=super.toObj();return e.triggerKey=this.triggerKey,e}}},5364:(e,t,i)=>{const s=i(6732);var a={category:"start",fields:["objectID","lifecycleKey"],icon:"key",key:"TriggerLifecycle"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"trigger",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Object Lifecycle Trigger",actionName:"replace-with-signal-lifecycle-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"ab:SignalLifecycle"}}}fromValues(e){super.fromValues(e),this.objectID=e.objectID||"objID.??",this.lifecycleKey=e.lifecycleKey||"lifecycle.key??"}toObj(){var e=super.toObj();return e.objectID=this.objectID,e.lifecycleKey=this.lifecycleKey,e}processDataFields(){var e=null;if(this.objectID){e=[];var t=this.AB.objectByID(this.objectID);if(t){var i=this.diagramID;t.fields().forEach((s=>{e.push({key:`${i}.${s.id}`,label:`${this.label}->${t.label}->${s.label}`,field:s,object:t})})),e.push({key:`${i}.uuid`,label:`${this.label}->${t.label}`,field:null,object:t})}else{var s=new Error(`ABProcessTriggerLifecycleCore.processDataFields():TaskID[${this.id}]: could not find referenced object by ID [${this.objectID}]`);this.AB.error(s)}}return e}processData(e,t){var i=t.split(".");if(i[0]==this.diagramID){var s=this.myState(e);if(s.data){var a;if(a=this.AB.objectByID(this.objectID).fields((e=>e.id==i[1]))[0])return i[2]?a[i[2]].call(a,s.data):-1!=["calculate","TextFormula"].indexOf(a.key)?a.format(s.data):"connectObject"==a.key?s.data[a.columnName]||s.data[a.relationName()]:s.data[a.columnName];if("uuid"==i[1])return s.data.uuid;if(a=this.AB.objectByID(this.objectID).fields((e=>e.id==i[1]))[0])return i[2]?a[i[2]].call(a,s.data):s.data[a.columnName]}}return null}processDataObjects(){var e=null;return this.objectID&&(e=[this.AB.objectByID(this.objectID)]),e}}},7535:(e,t,i)=>{const s=i(6732);var a={category:"start",fields:["repeatEvery","repeatTime","repeatDaily","repeatWeekly","repeatMonthly","isEnabled"],icon:"clock-o",key:"TimerStartEvent",repeatEvery:"daily",repeatTime:"01:00",repeatDaily:"day",repeatWeekly:"FRI",repeatMonthly:"last",isEnabled:!0};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"trigger",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return{label:"Timer Start Event",actionName:"replace-with-signal-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"ab:SignalTriggerTimer"}}}fromValues(e){if(super.fromValues(e),this.repeatEvery=e.repeatEvery||a.repeatEvery,this.repeatDaily=e.repeatDaily||a.repeatDaily,this.repeatWeekly=e.repeatWeekly||a.repeatWeekly,this.repeatMonthly=e.repeatMonthly||a.repeatMonthly,e.repeatTime){let t=e.repeatTime.split(":"),i=new Date;i.setUTCHours(t[0]),i.setUTCMinutes(t[1]),this.repeatTime=`${i.getHours()}:${i.getMinutes()}`}else this.repeatTime=a.repeatTime;this.isEnabled=JSON.parse(e.isEnabled||a.isEnabled)}toObj(){var e=super.toObj();return e.repeatEvery=this.repeatEvery,e.repeatDaily=this.repeatDaily,e.repeatWeekly=this.repeatWeekly,e.repeatMonthly=this.repeatMonthly,e.repeatTime=this.repeatTime,e.repeatTime&&e.repeatTime instanceof Date&&(e.repeatTime=`${e.repeatTime.getUTCHours()}:${e.repeatTime.getMinutes()}`),e.isEnabled=this.isEnabled,e}getCronExpression(){let e,t,i,s=this.repeatTime.split(":"),a=s[1],n=s[0];switch(this.repeatEvery){case"daily":e="*",t="*",i="weekday"==this.repeatDaily?"1-5":"*";break;case"weekly":e="*",t="*",i=this.repeatWeekly;break;case"monthly":e=this.repeatMonthly,t="*",i="*"}return`* ${a} ${n} ${e} ${t} ${i} *`}}},2983:e=>{e.exports=class{constructor(e,t,i,s,a){Array.isArray(t)||(t=[t]),this.parameterDefinitions=t,this.object=i?i.object:null,i&&i.objectOut&&(this.object=i.objectOut),this.prevOP=i,this.task=s,this.AB=a,this.next=null,this.fromAttributes(e)}initObject(e){}fromAttributes(e){if(this.params=e.params||{},this.objectID=e.objectID||null,this.objectID&&(this.object=this.objectLookup(this.objectID)),this.initObject(e),this.objectID&&!this.object&&this.AB.notify.developer(new Error(`ABQLCore.fromAttributes(): unable to initialize ABObject [${this.objectID}]`),{attributes:e,objectID:this.objectID}),e.next){var t=null;if((this.NextQLOps||this.constructor.NextQLOps).forEach((i=>{i.key==e.next.key&&(t=i)})),t){var i=new t(e.next,this,this.task,this.AB);this.next=i}}}objectLookup(e){return this.AB.objects((t=>{var i=`"${t.label}"`;return t.id==e||0==i.indexOf(e)}))[0]}availableProcessDataFieldsHash(){var e=this.task.process.processDataFields(this.task)||[],t={};return e.forEach((e=>{e.field?t[e.field.id]=e:t[e.key]=e})),t}paramChanged(e){}toObj(){var e={key:this.constructor.key,params:this.params,objectID:this.object?this.object.id:null};return this.next&&(e.next=this.next.toObj()),e}}},5111:(e,t,i)=>{const s=i(5430),a=i(8409);var n=[{type:"objectConditions",name:"cond"}];class r extends s{constructor(e,t,i,s){super(e,n,t,i,s)}}r.key="find",r.label="find",r.NextQLOps=a,e.exports=r},8162:(e,t,i)=>{var s={fromAttributes:function(e,t,i){if(!e)return null;var a=[];return s.QLOps.forEach((t=>{t.key==e.key&&a.push(t)})),1==a.length?new a[0](e,t,i):null},QLOps:[i(4157)]};e.exports=s},7505:(e,t,i)=>{const s=i(5430);var a=[i(3408)],n=[{type:"objectName",name:"name"}];class r extends s{constructor(e,t,i){super(e,n,null,t,i)}initObject(e){if(!this.object&&this.params){var t=this.parameterDefinitions.find((e=>"objectName"==e.type));t&&(this.objectID=this.params[t.name],this.object=this.objectLookup(this.objectID))}}toObj(){var e=super.toObj();if(!e.objectID&&this.params){var t=this.parameterDefinitions.find((e=>"objectName"==e.type));t&&(e.objectID=this.params[t.name])}return e}}r.key="object",r.label="object",r.NextQLOps=a,e.exports=r},6569:(e,t,i)=>{const s=i(465),a=i(7027),n=i(5851);e.exports=[s,a,n]},9215:(e,t,i)=>{const s=i(4842),a=i(5926);class n extends a{get NextQLOps(){let e=[],t=this.field;return null==t&&(t=this.object.fieldByID(this.fieldID)),t?e="connectObject"==t.key?"many"==t.settings.linkType?i(8409):this.prevOP.constructor.NextQLOps:s:"_PK"==this.fieldID&&(e=s),e}}n.key="row_pluck",n.label="pluck",n.NextQLOps=[],e.exports=n},354:(e,t,i)=>{const s=i(5430);var a=[{type:"objectValues",name:"values"}];class n extends s{constructor(e,t,i,s){super(e,a,t,i,s),this.constructor.NextQLOps=t.constructor.NextQLOps}}n.key="update",n.label="update record",n.NextQLOps=[],e.exports=n},8409:(e,t,i)=>{e.exports=[i(8593),i(5926),i(7478)]},219:(e,t,i)=>{const s=i(5430),a=i(6569);class n extends s{constructor(e,t,i,s){super(e,[],t,i,s)}}n.key="first",n.label="first",n.NextQLOps=a,e.exports=n},512:(e,t,i)=>{const s=i(5430);var a=[{type:"objectFields",name:"field"}];class n extends s{constructor(e,t,i,s){super(e,a,t,i,s)}fromAttributes(e){this.constructor.NextQLOps=this.prevOP.constructor.NextQLOps,this.fieldID=e.fieldID,this.field=this.object?.fieldByID(this.fieldID),e.objectOutID&&(this.objectOut=this.objectLookup(e.objectOutID)),super.fromAttributes(e)}toObj(){var e=super.toObj();if(this.fieldID)e.fieldID=this.fieldID,this.objectOut&&(e.objectOutID=this.objectOut.id);else{e.fieldID=this.params.field||null;var t=this.object.fieldByID(e.fieldID);t?.isConnection&&(e.objectOutID=t.datasourceLink.id)}return e}}n.key="set_pluck",n.label="pluck",n.NextQLOps=[],e.exports=n},4178:(e,t,i)=>{const s=i(5430);var a=[{type:"taskParam",name:"task_param"}];class n extends s{constructor(e,t,i,s){super(e,a,t,i,s),this.taskParam&&(i.registerDatasource(this),this.registered=!0)}fromAttributes(e){this.constructor.NextQLOps=this.prevOP.constructor.NextQLOps,super.fromAttributes(e),this.taskParam=e.taskParam||this.params.task_param}toObj(){var e=super.toObj();return e.taskParam=this.taskParam||this.params.task_param,e}processDataField(e,t){var i=null;return"connectObject"!=this.prevOP?.field?.key&&(i=this.prevOP.field),{key:`${e}.${this.taskParam||this.params.task_param}`,label:`${t}->${this.taskParam||this.params.task_param}`,field:i,object:this.object,set:!0}}}n.key="set_save",n.label="save",n.NextQLOps=[],e.exports=n},4842:(e,t,i)=>{e.exports=[i(3111)]},6321:(e,t,i)=>{const s=i(7478);class a extends s{fromAttributes(e){super.fromAttributes(e),this.constructor.NextQLOps=this.prevOP.NextQLOps||this.prevOP.constructor.NextQLOps}}a.key="value_save",a.label="save",a.NextQLOps=[],e.exports=a},792:(e,t,i)=>{const s=i(1895),a={key:"csvExporter",icon:"download",labelKey:"CSV Exporter"},n={dataviewID:null,where:null,buttonLabel:"Export CSV",filename:"exportCSV",hasHeader:!0,width:150};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),"string"==typeof e.settings.hasHeader&&(this.settings.hasHeader=JSON.parse(e.settings.hasHeader)),null==this.settings.hasHeader&&(this.settings.hasHeader=n.hasHeader),this.settings.width=parseInt(e.settings.width||n.width)}}},7876:(e,t,i)=>{const s=i(1895),a=i(6204),n={key:"csvImporter",icon:"upload",labelKey:"CSV Importer"},r={dataviewID:null,availableFieldIds:[],buttonLabel:"Upload CSV",width:0,recordRules:[]};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return r}fromValues(e){super.fromValues(e),this.settings.width=parseInt(this.settings.width||r.width)}get RecordRule(){let e=this.datacollection?.datasource;if(e)return null==this._recordRule&&(this._recordRule=new a),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(e),this._recordRule}doRecordRulesPre(e){e&&!Array.isArray(e)&&(e=[e]),e.forEach((e=>{this.RecordRule?.processPre({data:e.data||e,form:this})}))}doRecordRules(e){if(e&&!Array.isArray(e)&&(e=[e]),!this.RecordRule)return Promise.resolve();let t=[];return e.forEach((e=>{t.push(this.RecordRule.process({data:e.data||e,form:this}))})),Promise.all(t)}}},6483:(e,t,i)=>{const s=i(1895),a={dataviewID:null,field:null,width:460,height:275,showLabel:!0,hideItem:!1,hideButton:!1,navigationType:"corner",filterByCursor:!1,detailsPage:null,detailsTab:null,editPage:null,editTab:null},n={key:"carousel",icon:"clone",labelKey:"Carousel"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),void 0!==this.settings.width?this.settings.width=parseInt(this.settings.width):this.settings.width=a.width,void 0!==this.settings.height?this.settings.height=parseInt(this.settings.height):this.settings.height=a.height;try{this.settings.showLabel=JSON.parse(this.settings.showLabel)}catch(e){this.settings.showLabel=a.showLabel}try{this.settings.hideItem=JSON.parse(this.settings.hideItem)}catch(e){this.settings.hideItem=a.hideItem}try{this.settings.hideButton=JSON.parse(this.settings.hideButton)}catch(e){this.settings.hideButton=a.hideButton}this.settings.navigationType=this.settings.navigationType||a.navigationType;try{this.settings.filterByCursor=JSON.parse(this.settings.filterByCursor)}catch(e){this.settings.filterByCursor=a.filterByCursor}}componentList(){return[]}get imageField(){let e=this.datacollection;if(!e)return null;let t=e.datasource;return t?t.fields((e=>e.id==this.settings.field))[0]:null}}},6202:(e,t,i)=>{const s=i(8320),a={areaType:"area",isLegend:!0,chartHeight:0,labelFontSize:12,stepValue:20,maxValue:100},n={key:"area",icon:"area-chart",labelKey:"ab.components.chart.area"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.isLegend=JSON.parse(this.settings.isLegend||a.isLegend),this.settings.chartHeight=parseInt(this.settings.chartHeight||a.chartHeight),this.settings.labelFontSize=parseInt(this.settings.labelFontSize||a.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue||a.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue||a.maxValue),this.translate(this,this,["areaLabel"])}componentList(){return[]}}},3253:(e,t,i)=>{const s=i(8320),a={barType:"bar",barPreset:"column",isLegend:!0,height:200,labelFontSize:12,stepValue:20,maxValue:100},n={key:"bar",icon:"bar-chart",labelKey:"ab.components.chart.bar"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.isLegend=JSON.parse(this.settings.isLegend||a.isLegend),this.settings.height=parseInt(this.settings.height||a.height),this.settings.labelFontSize=parseInt(this.settings.labelFontSize||a.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue||a.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue||a.maxValue),this.translate(this,this,["barLabel"])}componentList(){return[]}}},1311:(e,t,i)=>{const s=i(2715),a={dataviewID:null,columnValue:null,columnLabel:null,columnValue2:null,isPercentage:!0,showLabel:!0,labelPosition:"left",labelWidth:120,height:200,multipleSeries:!1},n={key:"chart",icon:"bar-chart",labelKey:"Chart"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.isPercentage=JSON.parse(this.settings.isPercentage||a.isPercentage),this.settings.labelPosition=this.settings.labelPosition||a.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:a.showLabel),this.settings.multipleSeries=JSON.parse(null!=this.settings.multipleSeries?this.settings.multipleSeries:a.multipleSeries),this.settings.labelWidth=parseInt(this.settings.labelWidth||a.labelWidth),this.settings.height=parseInt(this.settings.height||a.height),this.translate(this,this,["chartLabel"])}componentList(){var e=["label","pie","bar","line","area"];return this.application.viewAll().filter((t=>e.indexOf(t.common().key)>-1))}labelField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.columnLabel))[0]:null}valueField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.columnValue))[0]:null}valueField2(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.columnValue2))[0]:null}}},9875:(e,t,i)=>{const s=i(8320),a={lineType:"line",linePreset:"plot",isLegend:!0,chartHeight:200,labelFontSize:12,stepValue:20,maxValue:100},n={key:"line",icon:"line-chart",labelKey:"ab.components.chart.line"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.isLegend=JSON.parse(this.settings.isLegend||a.isLegend),this.settings.chartHeight=parseInt(this.settings.chartHeight||a.chartHeight),this.settings.labelFontSize=parseInt(this.settings.labelFontSize||a.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue||a.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue||a.maxValue),this.translate(this,this,["lineLabel"])}componentList(){return[]}}},2118:(e,t,i)=>{const s=i(8320),a={pieType:"pie",isLegend:!0,height:200,innerFontSize:12,labelFontSize:12},n={key:"pie",icon:"pie-chart",labelKey:"ab.components.chart.pie"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.isLegend=JSON.parse(this.settings.isLegend||a.isLegend),this.settings.height=parseInt(this.settings.height||a.height),this.settings.innerFontSize=parseInt(this.settings.innerFontSize||a.innerFontSize),this.settings.labelFontSize=parseInt(this.settings.labelFontSize||a.labelFontSize),this.translate(this,this,["pieLabel"])}componentList(){return[]}}},2194:(e,t,i)=>{const s=i(1895),a={dataviewID:null,columnUser:null,columnComment:null,columnDate:null,height:300,label:""},n={key:"comment",icon:"comments",labelKey:"Comment"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height||0)}componentList(){return[]}getUserField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.columnUser))[0]:null}getCommentField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.columnComment))[0]:null}getDateField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.columnDate))[0]:null}getUserData(){var e=this.getUsers(),t=[];if(e)return e.forEach(((e,i)=>{var s="";e.image&&(s="/opsportal/image/UserProfile/"+e.image);var a={id:i+1,value:e.value,image:s};t.push(a)})),t}model(){let e=this.datacollection;return e?null==e.datasource?null:e.model||null:null}}},962:(e,t,i)=>{const s=i(2715),a={dataviewID:null,filterConditions:{}},n={key:"conditionalcontainer",icon:"shield",labelKey:"Conditional Container"};e.exports=class extends s{constructor(e,t,i,a){super(e,t,i,a||n);var r=this.AB.Multilingual.label;if(this.views((e=>e instanceof s)).length<2){var o=t.viewNew({key:s.common().key,label:r("If","If"),settings:{removable:!1}},t,this);this._views.push(o);var l=t.viewNew({key:s.common().key,label:r("Else","Else"),settings:{removable:!1}},t,this);this._views.push(l)}}static common(){return n}static defaultValues(){return a}}},3578:(e,t,i)=>{const s=i(1895),a={dataviewID:null,field:null},n={key:"connect-data-filter",icon:"filter",labelKey:"Connected Data Filter"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e)}componentList(){return[]}}},5132:(e,t,i)=>{const s=i(902),a={key:"viewcontainer",icon:"braille",labelKey:"Container"},n={columns:1,gravity:1};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.columns=parseInt(this.settings.columns||n.columns),void 0!==this.settings.gravity&&this.settings.gravity.map((function(e){return parseInt(e)})),null!=this.settings.removable?this.settings.removable=JSON.parse(this.settings.removable):this.settings.removable=!0,null!=this.settings.movable?this.settings.movable=JSON.parse(this.settings.movable):this.settings.movable=!0}viewsSortByPosition(){return this.views().sort(((e,t)=>e.position.y==t.position.y?e.position.x-t.position.x:e.position.y-t.position.y))}}},5974:(e,t,i)=>{var s=i(7069);const a={key:"view",icon:"window-maximize",labelKey:"ab.components.view",tabicon:""},n={label:""};e.exports=class extends s{constructor(e,t,i,s){super(["label"],t.AB),this.__events=[],this.defaults=s||a,this.application=t,this.parent=i||null,this.warningsSilent=!1,this.fromValues(e)}static common(){return a}static defaultValues(){return n}static newInstance(e,t){return console.error("!!! where is this being called???"),e.viewNew({key:this.common().key},e,t)}viewKey(){return this.defaults.key}viewIcon(){return this.defaults.icon}tabIcon(){return this.defaults.tabicon}toObj(){var e=super.toObj(),t={id:this.id,type:this.type||"view",key:this.key,icon:this.icon,tabicon:this.tabicon,name:this.name,settings:this.AB.cloneDeep(this.settings||{}),accessLevels:this.accessLevels,translations:e.translations};return t.viewIDs=(this._views||[]).map((e=>e.id)).filter((e=>e)),this.position&&(t.position=this.position),t.isRoot=this.isRoot(),t}fromValues(e){if(this.id=e.id,this.type=e.type||"view",this.key=e.key||this.viewKey(),this.icon=e.icon||this.viewIcon(),this.tabicon=e.tabicon||this.tabIcon(),this.name=e.name,e.settings=e.settings||{},this.label=e.label||e.settings.label||"?label?",this.settings=e.settings||{},this.settings.height=parseInt(this.settings.height||0),this.accessLevels=e.accessLevels||{},super.fromValues(e),!this.name&&Array.isArray(this.translations))for(var t=0;t<this.translations.length;t++)if(0==t&&(this.name=this.translations[t].label),"en"==this.translations[t].language_code){this.name=this.translations[t].label;break}"?label?"==this.label&&this.parent&&(this.label=this.parent.label+"."+this.defaults.key);var i=[];(e.viewIDs||[]).forEach((e=>{var t=this.AB.definitionByID(e);t?i.push(this.application.viewNew(t,this.application,this)):this.AB.notify.builder(new Error(`Application[${this.application.name}][${this.application.id}].View[${this.name}][${this.id}] references unknown View[${e}]`),{context:"ABViewCore:fromValues():values.viewIDs for each",id:e})})),this._views=i,this.position=e.position||{},null!=this.position.x&&(this.position.x=parseInt(this.position.x)),null!=this.position.y&&(this.position.y=parseInt(this.position.y)),this.position.dx=parseInt(this.position.dx||1),this.position.dy=parseInt(this.position.dy||1)}isRoot(){return null==this.parent||this.parent==this.application}allParents(){var e=[],t=this;for(e.unshift(t);!t.isRoot()&&t.parent;)e.unshift(t.parent),t=t.parent;return e}isAccessibleForRoles(e){var t=!1,i=Object.keys(this.accessLevels)||[];return(e||[]).forEach((e=>{i.indexOf(e.uuid||e)>-1&&(t=!0)})),t}getUserAccess(){var e=0;if(this.application.isAccessManaged){var t=!1;1==parseInt(this.application.accessManagers.useRole)&&this.AB.Account.roles().forEach((i=>{this.application.accessManagers.role.indexOf(i.id||i.uuid)>-1&&(t=!0,e=2)})),t||1!=parseInt(this.application.accessManagers.useAccount)||this.application.accessManagers.account.indexOf(this.AB.Account.uuid()+"")>-1&&(t=!0,e=2),this.accessLevels&&Object.keys(this.accessLevels).length>0&&!t&&this.AB.Account.roles().forEach((t=>{var i=this.accessLevels[t.id||t.uuid];i&&parseInt(i)>e&&(e=parseInt(i))}))}else e=2;return e}parentFormComponent(){for(var e=null,t=this;"form"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"form"==t.key&&(e=t),e}parentDetailComponent(){for(var e=null,t=this;"detail"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"detail"==t.key&&(e=t),e}pageParent(e){if(null==e&&(e=()=>!0),this.isRoot())return this;for(var t=this.parent;t&&("page"!=t.key||!e(t));)t=t.parent;return t}pageRoot(){for(var e=this.pageParent();!e.isRoot();)e=e.pageParent();return e}urlPointer(){return this.parent?this.parent.urlView()+this.id:this.application.urlPage()+this.id}urlView(){return this.urlPointer()+"/_views/"}get datacollection(){let e=(this.settings||{}).dataviewID;if(!e){if(["form","grid","line","area","bar","gantt","kanban"].indexOf(this.key)>-1){if("form"==this.key&&this._currentObject)return null;if(this.warningsSilent)return null;var t=new Error(`ABViewCore:get datacollection(): View[${this.key}] didn't define a dataviewID.`);this.AB.notify.builder(t,{view:this,settings:this.settings})}else-1==["page","viewcontainer"].indexOf(this.key)&&console.warn(`TODO: figure out which ABView* require a .dataviewID: ${this.key}?`);return null}var i=this.AB.datacollectionByID(e);if(!i){var s=new Error(`View[${this.label}][${this.id}] is unable to find associated DataCollection`);this.AB.notify.builder(s,{view:this,dataviewID:e})}return i}updateAccessLevels(e,t){return 0==parseInt(t)?this.accessLevels[e]&&delete this.accessLevels[e]:this.accessLevels[e]=t,this.save(!1,!1)}views(e=(()=>!0),t=!1){var i=[];return!this._views||this._views.length<1||(e&&t?(i=i.concat(this._views.filter(e)),this._views.forEach((s=>{var a=s.views(e,t);a&&a.length>0&&(i=i.concat(a))}))):i=this._views.filter(e)),i}viewNew(e,t,i){return this.application.viewNew(e,t||this.application,i||this)}viewDestroy(e){return console.error("DEPRECIATED: where is this called?"),this.viewRemove(e)}viewRemove(e){var t=this._views.length;return this._views=this.views((function(t){return t.id!=e.id})),this._views.length<t?this.save():Promise.resolve()}viewInsert(e){return this.views((function(t){return t.id==e.id})).length>0?Promise.resolve():(this._views.push(e),this.save())}viewReorder(e,t){var i=this._views.findIndex((t=>t.id==e));if(!(i<0))return this._views.splice(t,0,this._views.splice(i,1)[0]),this.save(!0)}destroy(){return this.eventClear(!0),Promise.resolve().then((()=>{var e=[],t=this.views();return this._views=[],t.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(this.parent&&!this.pages)return this.parent.viewRemove(this)})).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}save(){return Promise.resolve().then((()=>super.save())).then((()=>{if(this.parent&&!this.pages)return this.parent.viewInsert(this)})).then((()=>this))}eventAdd(e){if(e&&e.emitter&&e.listener){var t=this.__events.find((t=>t.emitter==e.emitter&&t.eventName==e.eventName));(!t||t.length<1)&&(this.__events.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}}eventClear(e){e&&this.views().forEach((t=>{t.eventClear(e)})),this.__events&&this.__events.length>0&&this.__events.forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)}))}clone(e,t,i={}){e=e||{};let s=this.toObj();["pages","views"].forEach((e=>{delete s[e]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((t=>{s&&s.settings&&(s.settings[t]=e[s.settings[t]])}));let a=this.viewNew(s,this.application,t);return a.id=null==t?null:e[a.id]||this.AB.uuid(),this.pages&&!i.ignoreSubPages&&(a._pages=[],this.pages().forEach((t=>{let s=t.clone(e,a,i);s.parent=a,a._pages.push(s)}))),this.views&&!i.ignoreSubViews&&(a._views=[],this.views().forEach((t=>{let s=t.clone(e,a,i);a._views.push(s)}))),a}copy(e,t,i={}){e=e||{};let s=this.toObj();["pageIDs","viewIDs"].forEach((e=>{delete s[e]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((t=>{s&&s.settings&&(s.settings[t]=e[s.settings[t]])}));let a=this.application.viewNew(s,this.application,t);return a.parent=t||this.parent,a.id=null==t?null:e[a.id]||this.AB.uuid(),"page"==this.key&&(a.name=i?.newName||`${a.name}_copied_${this.AB.uuid().slice(0,3)}`,a.label=i?.newName||`${a.label} (copied)`),Promise.resolve().then((()=>{var t=[];return this._pages&&!i.ignoreSubPages&&(a._pages=[],this.pages().forEach((s=>{s.isRoot()&&this.application._pages.push({id:e[s.id]}),t.push(s.copy(e,a,i).then((t=>{t.parent=a,this.application._pages=this.application._pages.filter((t=>t.id!=e[s.id])),a._pages.push(t)})))}))),Promise.all(t)})).then((()=>{var t=[];return this._views&&!i.ignoreSubViews&&(a._views=[],this.views().forEach((s=>{t.push(s.copy(e,a,i).then((e=>{a._views.filter((t=>t.id==e.id)).length<1&&a._views.push(e)})))}))),Promise.all(t)})).then((()=>a.save())).then((()=>a))}}},7446:(e,t,i)=>{const s=i(414),a={xCount:1,detailsPage:"",detailsTab:"",editPage:"",editTab:""},n={key:"dataview",icon:"th",labelKey:"Data view"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.xCount=parseInt(this.settings.xCount||a.xCount),this.settings.detailsPage=this.settings.detailsPage||a.detailsPage,this.settings.editPage=this.settings.editPage||a.editPage,this.settings.detailsTab=this.settings.detailsTab||a.detailsTab,this.settings.editTab=this.settings.editTab||a.editTab}}},4044:(e,t,i)=>{const s=i(6711),a={},n={key:"detailcheckbox",icon:"check-square-o",labelKey:"ab.components.detail.checkbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},9809:(e,t,i)=>{const s=i(1895);e.exports=class extends s{detailComponent(){for(var e=null,t=this;!t.isRoot()&&t.parent&&"detail"!=t.key&&"dataview"!=t.key;)t=t.parent;return"detail"!=t.key&&"dataview"!=t.key||(e=t),e}field(){let e=this.detailComponent();if(null==e)return null;let t=e.datacollection;if(null==t)return null;let i=t.datasource;if(null==i)return null;let s=i.fields((e=>e.id==this.settings.fieldId))[0];return s&&this.settings.alias&&(s.alias=this.settings.alias),s}getCurrentData(){var e=this.detailComponent();if(!e)return null;var t=e.datacollection;if(!t)return null;var i=this.field();if(!i)return null;var s=t.getCursor();return s?s[i.columnName]:null}}},6497:(e,t,i)=>{const s=i(6711),a={formView:""},n={key:"detailconnect",icon:"list-ul",labelKey:"ab.components.detail.connect"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}}},2407:(e,t,i)=>{const s=i(2715),a={key:"detail",icon:"file-text-o",labelKey:"Detail"},n={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:0};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.labelPosition=this.settings.labelPosition||n.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:n.showLabel),this.settings.labelWidth=parseInt(this.settings.labelWidth||n.labelWidth),this.settings.height=parseInt(this.settings.height||n.height)}componentList(){var e=["label","text"];return this.application.viewAll().filter((t=>e.indexOf(t.common().key)>-1))}}},8276:(e,t,i)=>{const s=i(6711),a={},n={key:"detailcustom",icon:"dot-circle-o",labelKey:"ab.components.detail.custom"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},1597:(e,t,i)=>{const s=i(6711),a={height:80,width:120},n={key:"detailimage",icon:"image",labelKey:"ab.components.detail.image"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height||a.height),this.settings.width=parseInt(this.settings.width||a.width)}componentList(){return[]}}},9207:(e,t,i)=>{const s=i(6711),a={height:0},n={key:"detailtext",icon:"etsy",labelKey:"ab.components.detail.text"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height||a.height)}componentList(){return[]}}},7716:(e,t,i)=>{const s=i(6711),a={},n={key:"detailtree",icon:"sitemap",labelKey:"ab.components.detail.tree"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},4107:(e,t,i)=>{const s=i(1895),a={buttonlabel:"Download DOCX",dataviewID:null,width:0,filename:"",filelabel:"output.docx",language:"en",toolbarBackground:"ab-background-default",buttonPosition:"left"},n={key:"docxBuilder",icon:"file-word-o",labelKey:"DOCX Builder"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}toObj(){this.unTranslate(this,this,["filelabel","buttonlabel"]);var e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.settings.width=parseInt(this.settings.width||a.width),this.translate(this,this,["filelabel","buttonlabel"])}uploadUrl(){return console.warn(new Error("TODO: convert ABViewDocxBuilderCore.uploadUrl() to use common url code.")),`/file/upload/DOCX${this.id}/VIEW${this.id}/1`}downloadUrl(){return`/file/${this.settings.filename}`}get languageCode(){return this.settings.language||a.language}get datacollections(){let e=(this.settings||{}).dataviewID;if(!e)return[];let t=e.split(",")||[];return this.AB.datacollections((e=>t.indexOf(e.id)>-1))||[]}}},2609:(e,t,i)=>{const s=i(902),a={includeSave:!0,saveLabel:"",includeCancel:!1,cancelLabel:"",includeReset:!1,resetLabel:"",afterCancel:null,alignment:"right",isDefault:!1},n={key:"button",icon:"square",labelKey:"ab.components.button"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}toObj(){let e=[];return this.settings.saveLabel&&e.push("saveLabel"),this.settings.cancelLabel&&e.push("cancelLabel"),this.settings.resetLabel&&e.push("resetLabel"),this.unTranslate(this.settings,this.settings,e),super.toObj()}fromValues(e){super.fromValues(e);let t=[];this.settings.saveLabel&&t.push("saveLabel"),this.settings.cancelLabel&&t.push("cancelLabel"),this.settings.resetLabel&&t.push("resetLabel"),this.unTranslate(this.settings,this.settings,t),this.settings.includeSave=JSON.parse(this.settings.includeSave||a.includeSave),this.settings.includeCancel=JSON.parse(this.settings.includeCancel||a.includeCancel),this.settings.includeReset=JSON.parse(this.settings.includeReset||a.includeReset),this.settings.isDefault=JSON.parse(this.settings.isDefault||a.isDefault)}componentList(){return[]}}},8489:(e,t,i)=>{const s=i(3787),a={},n={key:"checkbox",icon:"check-square-o",labelKey:"ab.components.checkbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},3960:(e,t,i)=>{const s=i(902),a={required:0,disable:0};e.exports=class extends s{static defaultValues(){return a}field(){if(this.settings.objectId){let e=this.AB.objectByID(this.settings.objectId);return e?e.fieldByID(this.settings.fieldId):null}{let e,t=this.parentFormComponent();if(null==t)return null;if(t._currentObject)e=t._currentObject;else{let i=t.datacollection;if(null==i)return null;e=i.datasource}return null==e?null:e.fieldByID(this.settings.fieldId)}}}},4703:(e,t,i)=>{const s=i(3787),a={formView:"",filterConditions:{glue:"and",rules:[]},sortFields:[],popupWidth:700,popupHeight:450},n={key:"connect",icon:"list-ul",labelKey:"Connect"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.filterConditions=this.settings.filterConditions||a.filterConditions}componentList(){return[]}}},6980:(e,t,i)=>{const s=i(2715),a=i(3787),n=i(6204),r=i(1567),o={key:"form",icon:"list-alt",labelKey:"Form"},l={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:200,clearOnLoad:!1,clearOnSave:!1,displayRules:[],editForm:"none",recordRules:[],submitRules:[]};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||o)}static common(){return o}static defaultValues(){return l}fromValues(e){super.fromValues(e),this.settings.labelPosition=this.settings.labelPosition||l.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:l.showLabel),this.settings.clearOnLoad=JSON.parse(null!=this.settings.clearOnLoad?this.settings.clearOnLoad:l.clearOnLoad),this.settings.clearOnSave=JSON.parse(null!=this.settings.clearOnSave?this.settings.clearOnSave:l.clearOnSave),this.settings.labelWidth=parseInt(null==this.settings.labelWidth?l.labelWidth:this.settings.labelWidth),this.settings.height=parseInt(null==this.settings.height?l.height:this.settings.height)}objectLoad(e){this._currentObject=e}componentList(){var e=["label","layout","button","text"];return this.application.viewAll().filter((t=>e.indexOf(t.common().key)>-1))}fieldComponents(e){const t=e=>{let i=[];return e.forEach((e=>{null!=e&&(i.push(e),e._views?.length&&(i=i.concat(t(e._views))))})),i};return this._views?.length?(null==e&&(e=e=>e instanceof a),t(this._views).filter(e)):[]}addFieldToForm(e,t){if(null!=e){var i=e.formComponent();if(null!=i){var s=i.newInstance(this.application,this);if(null!=s)return s.settings=s.settings||{},s.settings.fieldId=e.id,null!=t&&(s.position.y=t),this._views.push(s),s}}}get RecordRule(){let e=this.datacollection.datasource;return null==this._recordRule&&(this._recordRule=new n),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(e),this._recordRule}doRecordRulesPre(e){return this.RecordRule.processPre({data:e,form:this})}doRecordRules(e){return e&&!this.datacollection.datasource.isValidData(e).pass()?(console.error("Updated data is invalid.",{rowData:e}),Promise.reject(new Error("Updated data is invalid."))):this.RecordRule.process({data:e,form:this})}doSubmitRules(e){var t=this.datacollection.datasource,i=new r;return i.formLoad(this),i.fromSettings(this.settings.submitRules),i.objectLoad(t),i.process({data:e,form:this})}}},1984:(e,t,i)=>{const s=i(3787),a={},n={key:"fieldcustom",icon:"object-group",labelKey:"ab.components.custom"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},6237:(e,t,i)=>{const s=i(3787),a={timepicker:!1},n={key:"datepicker",icon:"calendar",labelKey:"ab.components.datepicker"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},4909:(e,t,i)=>{const s=i(3787),a={isStepper:0},n={key:"numberbox",icon:"hashtag",labelKey:"ab.components.number"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}toObj(){this.unTranslate(this,this,["label","formLabel"]);var e=super.toObj();return e.views=[],e}fromValues(e){super.fromValues(e),this.settings.isStepper=this.settings.isStepper||a.isStepper,this.settings.isStepper=parseInt(this.settings.isStepper)}componentList(){return[]}}},3569:(e,t,i)=>{const s=i(9662),a={},n={key:"fieldreadonly",icon:"calculator",labelKey:"ab.components.readonly"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},6341:(e,t,i)=>{const s=i(3787),a={type:"multicombo"},n={key:"selectmultiple",icon:"list-ul",labelKey:"ab.components.selectmultiple"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},4098:(e,t,i)=>{const s=i(3787),a={type:"richselect"},n={key:"selectsingle",icon:"list-ul",labelKey:"ab.components.selectsingle"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},7209:(e,t,i)=>{const s=i(3787),a={type:"single"},n={key:"textbox",icon:"i-cursor",labelKey:"ab.components.textbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},926:(e,t,i)=>{const s=i(9662),a={},n={key:"formtree",icon:"sitemap",labelKey:"ab.components.tree"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}componentList(){return[]}}},4022:(e,t,i)=>{const s=i(1895),a={dataviewID:"",titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""},n={key:"gantt",icon:"tasks",labelKey:"Gantt"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),Object.keys(a).forEach((e=>{this.settings[e]=this.settings[e]||a[e]}))}componentList(){return[]}}},2268:(e,t,i)=>{const s=i(1895),a={label:"",dataviewID:"",padding:17,showToolbar:1,isEditable:0,massUpdate:0,allowDelete:0,isSortable:1,isExportable:0,detailsPage:"",detailsTab:"",editPage:"",editTab:"",trackView:0,frozenColumnID:"",hiddenFields:[],summaryColumns:[],countColumns:[],objectWorkspace:{frozenColumnID:"",hiddenFields:[],summaryColumns:[],countColumns:[]},gridFilter:{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1},height:0,hideHeader:0,labelAsField:0,hideButtons:0,groupBy:"",columnConfig:[],saveLocal:1},n={key:"grid",icon:"table",labelKey:"Grid"};function r(e,t){void 0!==e[t]?e[t]=e[t]||a[t]:e[t]=a[t]}function o(e,t){try{e[t]=JSON.parse(e[t])}catch(i){e[t]=a[t]}}e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),r(this.settings,"dataviewID"),o(this.settings,"padding"),o(this.settings,"showToolbar"),o(this.settings,"isEditable"),o(this.settings,"massUpdate"),o(this.settings,"allowDelete"),o(this.settings,"isSortable"),o(this.settings,"isExportable"),o(this.settings,"hideHeader"),o(this.settings,"labelAsField"),o(this.settings,"hideButtons"),o(this.settings,"columnConfig"),o(this.settings,"saveLocal"),this.settings.gridFilter=this.settings.gridFilter||a.gridFilter;try{this.settings.gridFilter.filterOption=JSON.parse(this.settings.gridFilter.filterOption)}catch(e){this.settings.gridFilter.filterOption=a.gridFilter.filterOption}try{this.settings.gridFilter.isGlobalToolbar=JSON.parse(this.settings.gridFilter.isGlobalToolbar)}catch(e){this.settings.gridFilter.isGlobalToolbar=a.gridFilter.isGlobalToolbar}r(this.settings,"detailsPage"),r(this.settings,"editPage"),r(this.settings,"detailsTab"),r(this.settings,"editTab"),o(this.settings,"trackView");var t=["sortFields","filterConditions","frozenColumnID","hiddenFields","summaryColumns","countColumns"];this.settings.objectWorkspace&&t.forEach((e=>{this.settings[e]=this.settings.objectWorkspace[e]})),t.forEach((e=>{r(this.settings,e)})),this._views=[]}componentList(){return[]}removeField(e,t){let i=!1;if(this.settings?.frozenColumnID==e.columnName&&(this.settings.frozenColumnID="",i=!0),this.settings.hiddenFields?.length){let t=this.settings.hiddenFields.indexOf(e.columnName);t>-1&&(this.settings.hiddenFields.splice(t,1),i=!0)}if(this.settings.summaryColumns?.length){let t=this.settings.summaryColumns.indexOf(e.id);t>-1&&(this.settings.summaryColumns.splice(t,1),i=!0)}if(this.settings.countColumns?.length){let t=this.settings.countColumns.indexOf(e.id);t>-1&&(this.settings.countColumns.splice(t,1),i=!0)}t(null,i)}copyUpdateProperyList(){return["detailsPage","detailsTab","editPage","editTab"]}}},7950:(e,t,i)=>{const s=i(1895),a={filename:"",width:200,height:100},n={key:"image",icon:"picture-o",labelKey:"Image"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.width=parseInt(this.settings.width||a.width),this.settings.height=parseInt(this.settings.height||a.height)}}},7907:(e,t,i)=>{const s=i(1895),a={dataviewID:null,editFields:[],verticalGroupingField:"",horizontalGroupingField:"",ownerField:"",template:""},n={key:"kanban",icon:"columns",labelKey:"Kanban"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}fromValues(e){super.fromValues(e),this.settings.template||(this.settings.template={id:`${this.id}_template`,key:"text"},this.settings.template.text=this.settings.textTemplate),this.TextTemplate=this.AB.viewNewDetatched(this.settings.template)}toObj(){var e=super.toObj();return e.settings.template=this.TextTemplate.toObj(),e}static common(){return n}static defaultValues(){return a}}},5759:(e,t,i)=>{const s=i(1895),a={label:"",format:0,alignment:"left"},n={key:"label",icon:"font",labelKey:"ab.components.label"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}toObj(){this.unTranslate(this,this,["label","text"]);var e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.text=e.text||e.settings.text||"*text",this.settings.format=this.settings.format||a.format,this.settings.alignment=this.settings.alignment||a.alignment,this._views=[],this.settings.format=parseInt(this.settings.format),this.translate(this,this,["label","text"])}componentList(){return[]}formatNormal(){this.settings.format=0}formatTitle(){this.settings.format=1}formatDescription(){this.settings.format=2}}},6897:(e,t,i)=>{const s=i(2715),a=i(1895),n={label:"",numColumns:1},r={key:"layout",icon:"columns",labelKey:"Layout"};e.exports=class extends a{constructor(e,t,i,s){super(e,t,i,s||r)}static common(){return r}static defaultValues(){return n}addColumn(){this._views.push(this.application.viewNew({key:s.common().key},this.application,this))}componentList(e){return e?[]:this.parent?this.parent.componentList(!1):[]}}},750:(e,t,i)=>{const s=i(1895),a={dataviewID:null,field:null,height:0},n={key:"list",icon:"list-ul",labelKey:"List"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}field(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fields((e=>e.id==this.settings.field))[0]:null}}},2579:(e,t,i)=>{const s=i(1895),a={orientation:"x",buttonStyle:"ab-menu-default",menuAlignment:"ab-menu-left",menuInToolbar:1,menuPadding:10,menuTheme:"bg_gray",menuPosition:"left",menuTextLeft:"",menuTextRight:"",menuTextCenter:"",pages:[],order:[]},n={key:"menu",icon:"th-large",labelKey:"Menu"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}toObj(){this.unTranslate(this,this,["menuTextLeft","menuTextCenter","menuTextRight"]),this.settings.pages&&this.settings.pages.forEach((e=>{this.unTranslate(e,e,["aliasname"])}));var e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.translate(this,this,["menuTextLeft","menuTextCenter","menuTextRight"]),this.settings.pages=this.settings.pages||a.pages;for(var t=0;t<this.settings.pages.length;t++){var i=this.settings.pages[t];i instanceof Object?(i.isChecked=JSON.parse(i.isChecked||!1),this.translate(i,i,["aliasname"])):"string"==typeof i&&(this.settings.pages[t]={pageId:i,isChecked:!0})}}componentList(){return[]}ClearPagesInView(e){e&&e.count()>1&&e.find({}).forEach((t=>{e.remove(t.id)}))}AddPagesToView(e,t){e&&t&&(t||[]).forEach((t=>{if(t.isChecked){let s=this.application.pages((e=>e.id==t.pageId),!0)[0];if(!s)return;if(0==s.getUserAccess())return;if(t.tabId){let e=this.application.views((e=>e.id==t.tabId),!0)[0];if(!e)return;if(0==e.getUserAccess())return}let a=this.getAliasname(t);var i;if(null==(i=t.parent&&"0"!=t.parent?e.getSubMenu(t.parent):e)&&(e.getMenuItem(t.parent).submenu=[],e.refresh(t.parent),i=e.getSubMenu(t.parent)),i.exists(t.tabId||t.pageId))return;i.add({id:t.tabId||t.pageId,value:a,type:t.type,pageId:t.pageId,icon:t.icon?"fa fa-fw fa-"+t.icon:""},t.position?parseInt(t.position):0)}}))}getAliasname(e){var t=this.AB.Multilingual.currentLanguage(),i=e.translations.filter((e=>e.language_code==t)),s="";if(i.length&&(i[0].aliasname?s=i[0].aliasname:i[0].label&&(s=i[0].label)),!s&&e.aliasname&&(s=e.aliasname),!s||!s.replace(/\[.{2,}\]/g,"")){var a;a=e.pageId?e.pageId:this.getParentPageId(e);var n=this.application.pages((e=>e.id==a),!0)[0];if(n)if("tab"==e.type||"viewcontainer"==e.key){var r=n.views((t=>t.id==e.tabId||t.id==e.id),!0)[0];r&&(s=r.label)}else s=n.label}return s}getParentPageId(e){return"page"!=e.key?this.getParentPageId(e.parent):e.id}copy(e,t){return super.copy(e,t).then((t=>((t.settings.pages||[]).forEach(((i,s)=>{let a=t.settings.pages[s];"string"==typeof a?t.settings.pages[s]=e[a]:(a.pageId=e[a.pageId],a.tabId=e[a.tabId])})),t.save().then((()=>t)))))}}},2094:(e,t,i)=>{const s=i(2715),a={key:"page",icon:"file"},n={type:"page",popupWidth:700,popupHeight:450,pageWidth:null,fixedPageWidth:0,pageBackground:"ab-background-default"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a),this.parent=null}static common(){return a}static defaultValues(){return n}static getPageActionKey(e){return["opstools","AB_"+String(e.application.name).replace(/[^a-z0-9]/gi,""),String(e.name).replace(/[^a-z0-9]/gi,"").toLowerCase(),"view"].join(".")}toObj(){var e=super.toObj();return e.name=this.name,e.myAppID=this.myAppID,"popup"==this.settings.type&&(e.icon="clone"),this.label&&"?label?"!=this.label||(e.label=e.name),e.pageIDs=(this._pages||[]).map((e=>e.id)),e}fromValues(e){super.fromValues(e),"popup"==e.settings.type&&(this.icon="clone"),this.label&&"?label?"!=this.label||(this.label=this.name),this.myAppID=e.myAppID,!this.myAppID&&this.application&&(this.myAppID=this.application.id);var t=[];(e.pageIDs||[]).forEach((e=>{var i=this.AB.definitionByID(e);i?t.push(this.pageNew(i)):this.AB.error(`App[${this.application.name}][${this.application.id}]->Page[${this.name}][${this.id}] referenced an unknown Page[${e}]`)})),this._pages=t,this.settings.columns=this.settings.columns||1,this.settings.gravity=this.settings.gravity||[1]}destroy(){return Promise.resolve().then((()=>{var e=[],t=this.pages();return this._pages=[],t.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>(this.parent||this.application).pageRemove(this))).then((()=>super.destroy()))}save(){return Promise.resolve().then((()=>super.save())).then((()=>(this.parent||this.application).pageInsert(this))).then((()=>this))}pages(e=(()=>!0),t=!1){var i=[];return e&&t?this._pages&&this._pages.length>0&&(i=this._pages.filter(e)).length<1&&this._pages.forEach((s=>{var a=s.pages(e,t);a&&a.length>0&&(i=a)})):i=this._pages.filter(e),i}pageInsert(e){return this.pages((t=>t.id===e.id)).length>0?Promise.resolve():(this._pages.push(e),this.save())}pageNew(e){e.key=a.key;var t=this.application.viewNew(e,this.application,null);return t.parent=this,t}pageRemove(e){var t=this._pages.length;return this._pages=this.pages((function(t){return t.id!=e.id})),this._pages.length<t?this.save():Promise.resolve()}urlPage(){return this.urlPointer()+"/_pages/"}urlPointer(){return this.parent?this.parent.urlPage()+this.id:this.application.urlPage()+this.id}updateIcon(e){return"popup"==e.settings.type?e.icon="clone":e.icon=a.icon,e}clone(e,t){if(null==e){e={};let t=i=>{e[i.id]||(e[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((e=>t(e))),i.views&&i.views().forEach((e=>t(e)))};t(this)}let i=super.clone(e,t);return i.name=null,i}copy(e,t,i){if(null==e){e={};let t=i=>{e[i.id]||(e[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((e=>t(e))),i.views&&i.views().forEach((e=>t(e)))};t(this)}return super.copy(e,t,i)}}},7766:(e,t,i)=>{const s=i(1895),a={dataviewID:null,removeMissed:0,totalColumn:0,separateLabel:0,min:0,max:0,height:0},n={key:"pivot",icon:"cube",labelKey:"ab.components.pivot"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.removeMissed=JSON.parse(this.settings.removeMissed||a.removeMissed),this.settings.totalColumn=JSON.parse(this.settings.totalColumn||a.totalColumn),this.settings.separateLabel=JSON.parse(this.settings.separateLabel||a.separateLabel),this.settings.min=JSON.parse(this.settings.allowDelete||a.min),this.settings.max=JSON.parse(this.settings.max||a.max),this.settings.structure&&"string"==typeof this.settings.structure&&(this.settings.structure=JSON.parse(this.settings.structure)),this.settings.height=parseInt(this.settings.height||a.height)}toObj(){var e=super.toObj();return e.views=[],e.settings=e.settings||{},this.settings.structure&&(e.settings.structure=JSON.stringify(this.settings.structure)),e}componentList(){return[]}}},5154:(e,t,i)=>{const s=i(1895),a={moduleList:[],queryList:[]},n={key:"reportsManager",icon:"wpforms",labelKey:"ab.components.reportsManager"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.moduleList=this.settings.moduleList||a.moduleList,this.settings.queryList=this.settings.queryList||a.queryList}toObj(){var e=super.toObj();return e.settings=e.settings||{},e}componentList(){return[]}}},6463:(e,t,i)=>{const s=i(1895),a=i(2715),n={height:0,minWidth:0,stackTabs:0,darkTheme:0,sidebarWidth:200,sidebarPos:"left",iconOnTop:0},r={key:"tab",icon:"window-maximize",labelKey:"Tab"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||r)}static common(){return r}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height),this.settings.minWidth=parseInt(this.settings.minWidth||0),this.settings.stackTabs=parseInt(this.settings.stackTabs),this.settings.darkTheme=parseInt(this.settings.darkTheme),this.settings.sidebarWidth=parseInt(this.settings.sidebarWidth),this.settings.sidebarPos=this.settings.sidebarPos,this.settings.iconOnTop=parseInt(this.settings.iconOnTop)}addTab(e,t){return this.application.viewNew({key:a.common().key,label:e,tabicon:t},this.application,this).save()}componentList(){return[]}}},5239:(e,t,i)=>{const s=i(1895),a={text:"",height:0,dataviewID:null},n={key:"text",icon:"font",labelKey:"Text"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n),this._object=null}static common(){return n}static defaultValues(){return a}toObj(){this.unTranslate(this,this,["text"]);var e=super.toObj();return e.views=[],e}fromValues(e){super.fromValues(e),this.settings=this.settings||{},this.settings.height=parseInt(this.settings.height||a.height),this.text=e.text||a.text,this.translate(this,this,["text"])}componentList(){return[]}get datacollection(){return"dataview"==this.parent?.key?this.AB.datacollectionByID(this.parent.settings.dataviewID):this.AB.datacollectionByID(this.settings.dataviewID)}fieldKey(e){let t=e.label||"";return t=t.replace(/\(/g,"\\("),t=t.replace(/\)/g,"\\)"),t}displayText(e,t){var i=this.text,s=this.datacollection,a=s?.datasource??this._object;if(!a)return(e=>e.replace(/{(.*?)}/g,""))(i);const n=e||s.getCursor()||{};return a.fields().forEach((e=>{let t=this.fieldKey(e);var s=new RegExp("{"+t+"}","g"),a=e.format(n);if("image"==e.key){var r=a;a=e.urlImage(r),!r&&e.settings.defaultImageUrl&&e.settings.useDefaultImage?a=e.urlImage(e.settings.defaultImageUrl):i=i.replace("img","img onerror='this.parentNode.removeChild(this);' ")}i=i.replace(s,a)})),i=i.replace(/{PK}/g,n[a.PK()])}objectLoad(e){this._object=e}}},9436:(e,t,i)=>{const s=i(902),a={key:"viewwidget",icon:"circle-o-notch ",labelKey:"ab.components.widget"},n={columnSpan:1,rowSpan:1};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.columnSpan=parseInt(this.settings.columnSpan||n.columnSpan),this.settings.rowSpan=parseInt(this.settings.rowSpan||n.rowSpan)}}},1827:(e,t,i)=>{i(6486);const s=i(9885),a=i(6239);i(4312),e.exports=class extends s{constructor(e,t){super(e,t),this._handler_page_updated=e=>{var t=this._pages.find((t=>t.id===e.id));t&&(this._pages=this._pages.filter((e=>e.id!=t.id)),this._pages.push(t.refreshInstance()))},this._pages.forEach((e=>{e.on("definition.updated",this._handler_page_updated)}))}static applications(){return console.error("ABApplication.applicationForID(): Depreciated. Who is doing this?"),null}static applicationForID(){var e=new Error("ABApplication.applicationForID(): Depreciated. Who is doing this?");return console.error(e),null}static definitionForID(){var e=new Error("ABApplication.definitionForID(): Depreciated. Who is doing this?");return console.error(e),null}areaKey(){return this.AB.kebabCase(`ab-${this.name}`)}refreshInstance(){var e=this.AB.applicationByID(this.id);return this._pages.forEach((e=>{e.removeListener("definition.updated",this._handler_page_updated)})),e}async _listInsert(e,t){-1!=this[t].indexOf(e.id)||(this[t].push(e.id),await this.save())}async _listRemove(e,t){var i=this[t].length;this[t]=this[t].filter((t=>t!=e.id)),i!=this[t].length&&await this.save()}datacollectionInsert(e){return this._listInsert(e,"datacollectionIDs")}datacollectionRemove(e){return this._listRemove(e,"datacollectionIDs")}objectInsert(e){return this._listInsert(e,"objectIDs")}objectRemove(e){return this._listRemove(e,"objectIDs")}processInsert(e){return this._processes.push(e),this._listInsert(e,"processIDs")}processRemove(e){return this._processes=this._processes.filter((t=>t.id!=e.id)),this._listRemove(e,"processIDs")}queryInsert(e){return this._listInsert(e,"queryIDs")}queryRemove(e){return this._listRemove(e,"queryIDs")}exportIDs(e){if(!(e.indexOf(this.id)>-1)){e.push(this.id),this.objectsIncluded().forEach((t=>{t.exportIDs(e)})),this.queriesIncluded().forEach((t=>{t.exportIDs(e)})),this.datacollectionIDs.forEach((t=>{if(!(e.indexOf(t)>-1)){var i=this.AB.definitionByID(t);if(i&&(e.push(t),i.settings.datasourceID)){var s=this.AB.objectByID(i.settings.datasourceID);s&&s.exportIDs(e)}}})),this.processes().forEach((t=>{t.exportIDs(e)}));var t=i=>{e.indexOf(i.id)>-1||(e.push(i.id),(i.pageIDs||[]).forEach((e=>{var i=this.AB.definitionByID(e);i&&t(i)})),(i.viewIDs||[]).forEach((e=>{var i=this.AB.definitionByID(e);i&&t(i)})))};(this._pages.map((e=>e.id))||[]).forEach((e=>{var i=this.AB.definitionByID(e);i&&t(i)})),e=this.AB.uniq(e)}}pageNew(e){return new a(e,this)}async pageInsert(e){if(!this._pages.filter((t=>t.id==e.id))[0])return this._pages.push(e),this.save()}async pageRemove(e){var t=this._pages.length;if(this._pages=this.pages((function(t){return t.id!=e.id})),this._pages.length<t)return this.save()}save(){return this.name!=this.label&&(this.name=this.label),super.save()}warningsEval(){this._warnings=[];var e={objectIDs:"object",queryIDs:"query",datacollectionIDs:"datacollection"};Object.keys(e).forEach((t=>{this[t].forEach((i=>{this.AB.definitionByID(i)||this.emit("warning",`Application is referencing a missing ${e[t]}`,{appID:this.id,id:i})}))})),0!=this.roleAccess.length||this.isAccessManaged||this.emit("warning","Application has no Role assigned, and is unaccessible.");var t=this.AB.Account.rolesAll().map((e=>e.id));this.roleAccess.forEach((e=>{-1==t.indexOf(e)&&this.emit("warning",`Specified Role Access [${e}] does not exist in this system`,{role:e})}))}warningsAll(){var e=[].concat(this._warnings);return["objectsIncluded","queriesIncluded","datacollectionsIncluded","processes","pages","views"].forEach((t=>{this[t]().forEach((t=>{e=e.concat(t.warningsAll())}))})),e}}},8030:(e,t,i)=>{const s=i(3686),a=i(2864);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(),e&&e.AB&&(this.AB=e.AB),i&&(this.AB=i),e||(i._App?e=i._App:(e={uuid:i.Webix.uid(),AB:i,actions:{},config:i.UISettings.config(),custom:null,icons:i.UISettings.icons,Label:n,labels:{add:n("Add"),create:n("Create"),delete:n("Delete"),edit:n("Edit"),export:n("Export"),formName:n("Name"),import:n("Import"),rename:n("Rename"),ok:n("Ok"),cancel:n("Cancel"),save:n("Save"),yes:n("Yes"),no:n("No"),none:n("None"),close:n("Close"),default:n("Default"),defaultPlaceholder:n("Enter default value"),disable:n("Disable"),required:n("Required"),unique:n("Unique"),invalidMessage:{required:n("This field is required")},createErrorMessage:n("System could not create <b>{0}</b>."),createSuccessMessage:n("<b>{0}</b> is created."),updateErrorMessage:n("System could not update <b>{0}</b>."),updateSucessMessage:n("<b>{0}</b> is updated."),deleteErrorMessage:n("System could not delete <b>{0}</b>."),deleteSuccessMessage:n("<b>{0}</b> is deleted."),renameErrorMessage:n("System could not rename <b>{0}</b>."),renameSuccessMessage:n("<b>{0}</b> is renamed."),dataFieldHeaderLabel:n("Section Title"),dataFieldHeaderLabelPlaceholder:n("Section Name"),dataFieldLabel:n("Label"),dataFieldLabelPlaceholder:n("Label"),dataFieldColumnName:n("Field Name"),dataFieldColumnNamePlaceholder:n("Database field name"),dataFieldShowIcon:n("show icon?"),componentDropZone:n("add widgets here")},unique:function(e){return`${e}${this.uuid}`}},i._App=e)),e.custom||(i.custom?e.custom=i.custom:(new a).initComponents(e)),this.App=e,this.idBase=t||"?idbase?"}actions(e){if(console.error("!!! REFACTOR out .actions()"),e)for(var t in e)this.App.actions[t]=e[t]}Label(){return(...e)=>this.AB.Multilingual.label(...e)}unique(e){return this.App.unique(`${this.idBase}_${e}`)}}},1579:(e,t,i)=>{const s=i(8447),a=i(1748);e.exports=class extends a{constructor(e,t){super(e,t),this.setMaxListeners(0)}async save(){return this.id||(this.label=this.label||this.name),await super.save(),this.AB.emit("ab.datacollection.update",{datacollectionId:this.id}),this}isValid(){var e=this.AB.Validation.validator(),t=this.AB.Label();return 0==this.AB.datacollections((e=>e.id!=this.id&&e.name.toLowerCase()==this.name.toLowerCase())).length||e.addError("name",t('Name must be unique ("{0}" already in use)',[this.name])),e}currentUserUsername(){return this.AB.Account.username()}init(){this.initialized||(super.init(),this.AB.on("ab.datacollection.create",(e=>{this.emit("ab.datacollection.create",e)})),this.AB.on("ab.datacollection.update",(e=>{this.emit("ab.datacollection.update",e)})),this.AB.on("ab.datacollection.stale",(e=>{this.emit("ab.datacollection.stale",e)})),this.AB.on("ab.datacollection.delete",(e=>{this.emit("ab.datacollection.delete",e)})),this.bindParentDc())}bindParentDc(){let e=this.datacollectionLink,t=this.fieldLink;if(!this.settings.loadAll&&e&&t){let i=this.__dataCollection;i.bind(e.__dataCollection,t.id),i.define("dataFeed",((i,s)=>{var a=this.AB.cloneDeep(this.settings.objectWorkspace.filterConditions);i&&(a.rules||(a=null),(a={glue:"and",rules:[a,{alias:t.alias,key:Object.keys(s)[0],rule:t.alias?"contains":"equals",value:t.getRelationValue(e.__dataCollection.getItem(i))}]}).rules=a.rules.filter((e=>e))),JSON.stringify(this.__reloadWheres)==JSON.stringify(a)||a.rules&&0==a.rules.length||(this.reloadWheres(a),this.reloadData(0,20))}))}}loadData(e,t=20){return super.loadData(e,t).catch((e=>{if(this.hideProgressOfComponents(),e)throw e}))}processIncomingData(e){return e.data&&!Array.isArray(e.data)&&(e.data=[e.data]),super.processIncomingData(e).then((()=>{this.hideProgressOfComponents()}))}attachFlexlayout(e){this.__dataCollection,this.__flexComponentIds.indexOf(e.config.id)>-1||this.__flexComponentIds.push(e.config.id)}bind(e){var t=this.__dataCollection;this.__bindComponentIds.indexOf(e.config.id)>-1&&$$(e.config.id).data&&$$(e.config.id).data.find&&$$(e.config.id).data.find({}).length>0||(this.__bindComponentIds.push(e.config.id),"datatable"==e.config.view||"dataview"==e.config.view||"treetable"==e.config.view||"kanban"==e.config.view?t?(0!=t.count()||this._dataStatus!=this.dataStatusFlag.notInitial&&this._dataStatus!=this.dataStatusFlag.initializing||!e.showProgress||e.showProgress({type:"icon"}),e.define("datafetch",20),e.define("datathrottle",500),"treetable"==e.config.view?this.datasource&&this.datasource.isGroup&&this.__treeCollection?(e.define("data",this.__treeCollection),e.refresh()):(e.define("data",[]),e.parse(t.find({}))):e.data.sync(t),this.settings.loadAll||(e.___AD=e.___AD||{},e.___AD.onDataRequestEvent||(e.___AD.onDataRequestEvent=e.attachEvent("onDataRequest",((i,s)=>(e.showProgress&&e.showProgress({type:"icon"}),t.loadNext(s,i),!1)))))):e.data.unsync():e.bind&&(t?e.bind(t):e.unbind(),e.refresh&&e.refresh()))}unbind(e){e&&(e.detachEvent("onDataRequest"),e.___AD&&(e.___AD.onDataRequestEvent&&delete e.___AD.onDataRequestEvent,e.___AD.onDcLoadData&&(this.off&&this.off("loadData",e.___AD.onDcLoadData),delete e.___AD.onDcLoadData)),e.data&&e.data.unsync&&(e.data.unsync(),e.define("data",[])),e.unbind&&e.unbind(),e.refresh&&e.refresh(),this.__bindComponentIds=(this.__bindComponentIds||[]).filter((t=>t!=e.config.id)))}hideProgressOfComponents(){this.__bindComponentIds.forEach((e=>{$$(e)&&$$(e).hideProgress&&$$(e).hideProgress()}))}_dataCollectionNew(e){let t=new webix.DataCollection({data:e||[]});return this._extendCollection(t),t}_treeCollectionNew(){let e=new webix.TreeCollection;return this._extendCollection(e),e}_extendCollection(e){webix.extend(e,webix.SelectionModel),e.___AD=e.___AD||{},this.settings.loadAll||(e.___AD.onDataRequestEvent||(e.___AD.onDataRequestEvent=e.attachEvent("onDataRequest",((e,t)=>(e<0&&(e=0),this.loadData(e,t),!1)))),e.___AD.onAfterLoadEvent||(e.___AD.onAfterLoadEvent=e.attachEvent("onAfterLoad",(()=>{this.emit("loadData",{})})))),e.addCss=function(){},e.removeCss=function(){},e.render=function(){},e.___AD.onAfterLoad||(e.___AD.onAfterLoad=e.attachEvent("onAfterLoad",(()=>{this.hideProgressOfComponents()})))}parseTreeCollection(e={}){if(!(this.__datasource instanceof s&&this.__datasource.isGroup&&this.__treeCollection))return;let t=(i={},s=null)=>{let a=i.alias;(e.data||[]).forEach((e=>{let t=e[`${a}.uuid`]||e[`${a}.id`];if(!t)return;let i=[],n=e[`${s}.uuid`]||e[`${s}.id`];if(n&&(i=this.__treeCollection.find((e=>e._alias==s&&e._dataId==n)).map((e=>e.id))),this.__treeCollection.find((e=>e._alias==a&&e._dataId==t&&(0==i.length||i.indexOf(e.$parent)>-1)),!0))return;let r={};r._alias=a,r._dataId=t,r._itemId=e.id,Object.keys(e).forEach((t=>{0==t.indexOf(`${a}.`)&&(r[t]=e[t])})),e.translations&&(r.translations=e.translations),i.length>0?i.forEach((e=>{this.__treeCollection.add(r,null,e)})):this.__treeCollection.add(r,null)})),(i.links||[]).forEach((e=>{t(e,a)}))};(this.__bindComponentIds||[]).forEach((e=>{let t=$$(e);t&&t.showProgress&&t.showProgress({type:"icon"}),t.data&&t.data.unsync&&t.data.unsync()})),t(this.__datasource.joins()),(this.__bindComponentIds||[]).forEach((e=>{let t=$$(e);t&&t.hideProgress&&t.hideProgress(),t.define("data",this.__treeCollection)}))}warningsAll(){const e=[].concat(this._warnings);return this.datasource?this.linkDatacollectionID&&this.AB.datacollectionById(this.linkDatacollectionID)&&e.push({message:`Datacollection[${this.label}][${this.id}] can't resolve linkDatacollectionID[${this.linkDatacollectionID}]`,data:{}}):e.push({message:`Datacollection[${this.label}][${this.id}] doesn't have a datasource.`,data:{}}),e}warningsEval(){}get userScopes(){return this.AB.Account.scopes()}}},5741:(e,t,i)=>{var s=i(52);e.exports=class extends s{}},3686:(e,t,i)=>{var s=i(7187).EventEmitter;e.exports=class extends s{constructor(){super()}}},5437:(e,t,i)=>{const s=i(5739);e.exports=class extends s{save(){return super.save().then((()=>this.object.indexSave(this))).then((()=>this.migrateCreate()))}destroy(){return new Promise(((e,t)=>{this.id?this.migrateDrop().then((()=>super.destroy())).then((()=>this.object.indexRemove(this))).then(e).catch(t):e()}))}migrateCreate(){return this.AB.Network.post({url:`/definition/migrate/object/${this.object.id}/index/${this.id}`})}migrateDrop(){return this.AB.Network.delete({url:`/definition/migrate/object/${this.object.id}/index/${this.id}`})}}},7069:(e,t,i)=>{var s=i(7243);e.exports=class extends s{constructor(e,t){super(e,t),this._warnings=[],this.on("warning",((e,t)=>{this._warnings.push({message:e,data:t})}))}warnings(){return this._warnings}warningsEval(){this._warnings=[],this.fromValues(this.toObj())}warningsAll(){return this.warnings()}languageDefault(){return this.AB.Account.language()||"en"}async destroy(){var e=this.toDefinition();return e.id?e.destroy().catch((t=>{if(t.toString().indexOf("No record found")>-1)return console.log(`ABMLClass.destroy(): could not find record for id[${e.id}]`),void console.log(e);throw t})):Promise.resolve()}async save(){var e=this.toDefinition();e.name=e.name||this.name||this.label||"name";var t=await e.save();this.id||(this.id=t.id)}}},8912:(e,t,i)=>{const s=i(1692);function a(e){e&&e.data&&"READONLY"==e.data.error&&webix.alert({title:"Your action is blocked",ok:"Ok",text:e.data.message||"",type:"alert-warning"})}e.exports=class extends s{constructor(e){super(e),this.handler_create=(...e)=>{this.handler_common("ab.datacollection.create",...e)},this.handler_delete=(...e)=>{this.handler_common("ab.datacollection.update",...e)},this.handler_findAll=(...e)=>{this.handler_common(null,...e)},this.handler_logs=(e,t,i)=>{t?e.reject?.(t):e.resolve?.(i)},this.handler_update=(...e)=>{this.handler_common("ab.datacollection.update",...e)},this.handler_common=(e,t,i,s)=>{i?t.reject?.(i):(e?-1==e.indexOf("delete")&&this.normalizeData(s):this.normalizeData(s.data),t.resolve?.(s),e&&function(e,t,i){"socket"!=e.AB.Network.type()&&e.AB.emit(t,{objectId:e.object.id,data:i})}(this,e,s))}}prepareMultilingualData(e){var t=this.object.multilingualFields(),i=!1;t.length&&t.forEach((function(t){null!=e[t]&&(i=!0)})),i&&(null!=e.translations&&void 0!==e.translations&&""!=e.translations||(e.translations=[]),this.object.unTranslate(e,e,t))}request(e,t){return this.AB.Network[e](t)}batchCreate(e){return e.batch.map((e=>this.prepareMultilingualData(e.data))),new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,((e,s,a)=>{s?i(s):(this.normalizeData(a),t(a))})),this.AB.Network.post({url:this.object.urlRestBatch(),params:e},{key:s,context:{}}).catch(i)}))}create(e){return this.prepareMultilingualData(e),this.object.fields().forEach((t=>{void 0===e[t.columnName]&&t.defaultValue(e)})),new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_create),this.AB.Network.post({url:this.object.urlRest(),params:e},{key:s,context:{resolve:t,reject:i}}).catch((e=>{a(e),i(e)}))}))}delete(e){return new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_delete),this.AB.Network.delete({url:this.object.urlRestItem(e)},{key:s,context:{resolve:t,reject:i}}).catch((e=>{a(e),i(e)}))}))}findAll(e){return e=e||{},new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_findAll),this.AB.Network.get({url:this.object.urlRest(),params:e},{key:s,context:{resolve:t,reject:i}}).catch((t=>{t&&t.code&&("ER_PARSE_ERROR"===t.code?this.AB.notify.developer(t,{message:"AppBuilder:ABModel:findAll(): Parse Error with provided condition",condition:e}):this.AB.notify.developer(t,{message:"AppBuilder:ABModel:findAll(): Unknown Error with provided condition",condition:e})),i(t)}))}))}loadInto(e){this._limit&&(e.define("datafetch",this._limit),e.define("datathrottle",250),e.___AD=e.___AD||{},e.___AD.onDataRequestEvent&&e.detachEvent(e.___AD.onDataRequestEvent),e.___AD.onDataRequestEvent=e.attachEvent("onDataRequest",((t,i)=>{var s={where:this._where,sort:this._sort,limit:i,skip:t};return e.showProgress&&e.showProgress({type:"icon"}),this.findAll(s).then((t=>{e.parse(t),e.hideProgress&&e.hideProgress()})),!1})),e.refresh());var t={};this._where&&(t.where=this._where),this._sort&&(t.sort=this._sort),null!=this._limit&&(t.limit=this._limit),null!=this._skip&&(t.skip=this._skip),e.showProgress&&e.showProgress({type:"icon"}),this.findAll(t).then((t=>{e.parse(t),e.hideProgress&&e.hideProgress()})).catch((e=>{console.error("!!!!!",e)}))}logs(e){return new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_logs),this.AB.Network.get({url:this.object.urlRestLog(),params:e},{key:s,context:{resolve:t,reject:i}}).catch((t=>{t&&t.code&&this.AB.notify.developer(t,{context:"AppBuilder:ABModel:logs(): Error",options:e}),i(t)}))}))}limit(e){return this._limit=e,this}skip(e){return this._skip=e,this}update(e,t){for(var i in this.prepareMultilingualData(t),t)null==t[i]&&delete t[i];return new Promise(((i,s)=>{var n=this.AB.jobID();this.AB.Network.once(n,this.handler_update),this.AB.Network.put({url:this.object.urlRestItem(e),params:t},{key:n,context:{resolve:i,reject:s}}).catch((e=>{a(e),s(e)}))}))}batchUpdate({rowIds:e,values:t}){return new Promise(((i,s)=>{var a=this.AB.jobID();this.AB.Network.once(a,((e,t)=>{t?s(t):i(!0)})),this.AB.Network.put({url:this.object.urlRestBatch(),params:{rowIds:e,values:t}},{key:a,context:{}}).catch(s)}))}}},4371:(e,t,i)=>{const s=i(8912);e.exports=class extends s{batchCreate(e){var t=new Error("ABObjectQuery.ABModelQuery.batchCreate() should not be called.");return Promise.reject(t)}create(e){var t=new Error("ABObjectQuery.ABModelQuery.create() should not be called.");return Promise.reject(t)}delete(e){var t=new Error("ABObjectQuery.ABModelQuery.delete() should not be called.");return Promise.reject(t)}update(e,t){var i=new Error("ABObjectQuery.ABModelQuery.update() should not be called.");return Promise.reject(i)}batchUpdate({rowIds:e,values:t}){var i=new Error("ABObjectQuery.ABModelQuery.batchUpdate() should not be called.");return Promise.reject(i)}}},7826:(e,t,i)=>{const s=i(6937),a=i(3847);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t),this.workspaceViews=new a(e,this,t),this.fields().forEach((e=>{e.on("definition.updated",(e=>{var t=this.AB.definitionByID(e.id);if(t){var i=this.AB.fieldNew(t,this),s=[];this.fields().forEach((t=>{t.id!==e.id?s.push(t):s.push(i)})),this._fields=s}}))})),this._pendingNetworkRequests={},this._handler_object_migrate=(e,t,i)=>{var s=this._pendingNetworkRequests?.[e.uuid];t?s?.reject(t):s?.resolve(i)},this.AB.Network.on("object.migrate",this._handler_object_migrate)}refreshInstance(){var e=this.AB.objectByID(this.id);return this._pendingNetworkRequests&&(this.AB.Network.removeListener("object.migrate",this._handler_object_migrate),e._pendingNetworkRequests=this._pendingNetworkRequests,this._pendingNetworkRequests=null),e}fromValues(e){super.fromValues(e),this.workspaceViews&&this.workspaceViews.fromObj(e)}isValid(){var e=this.AB.Validation.validator();return 0==this.AB.objects((e=>e.id!=this.id&&e.name.toLowerCase()==this.name.toLowerCase())).length||e.addError("name",n('Object name must be unique ("{0}" already in use)',[this.name])),e}isValidData(e){var t=this.AB.Validation.validator();return this.fields().forEach((i=>{e.hasOwnProperty(i.columnName)&&i.isValidData(e,t)})),t}async destroy(){try{if(await(()=>{var e=[];return this.AB.applications().forEach((t=>{e.push(t.objectRemove(this))})),Promise.all(e)})(),await(()=>new Promise((e=>{this.AB.queries((e=>e.objects((e=>e.id==this.id)).length>0)).forEach((e=>{e.disabled=!0})),e()})))(),this.isImported)return Promise.resolve();await this.migrateDrop();var e=[];if("object"==this.type){var t=this.fields();this._fields=[],t.forEach((t=>{e.push(t.destroy())}))}await Promise.all(e),await super.destroy(),this.emit("destroyed")}catch(e){this.AB.notify.developer(e,{context:"ABObject.destroy(): error destroying object."})}}async save(){var e=!1;this.id||(this.label=this.label||this.name,e=!0);try{return await super.save(),e&&await this.migrateCreate(),this}catch(e){throw this.AB.notify.developer(e,{context:"ABObject.save()",obj:this.toObj()}),e}}toObj(){var e=super.toObj();return e.objectWorkspaceViews=this.workspaceViews.toObj(),e}migrateCreate(){return new Promise(((e,t)=>{var i=this.AB.uuid();this._pendingNetworkRequests[i]={resolve:e,reject:t};var s={key:"object.migrate",context:{uuid:i,id:this.id}};this.AB.Network.post({url:`/definition/migrate/object/${this.id}`},s)}))}migrateDrop(){return new Promise(((e,t)=>{var i=this.AB.uuid();this._pendingNetworkRequests[i]={resolve:e,reject:t};var s={key:"object.migrate",context:{uuid:i,id:this.id}};this.AB.Network.delete({url:`/definition/migrate/object/${this.id}`},s)}))}columnResize(e,t){for(var i=null,s=0;s<this._fields.length;s++)if(this._fields[s].columnName==e){i=this._fields[s].id;break}var a=this.AB.localSettings(i);return(a=a||{}).width=t,this.AB.localSettings(i,a)}columnHeaders(e,t,i,s,a){i=i||[],s=s||[];var n=[];return this.fields().forEach((a=>{var r=a.columnHeader({isObjectWorkspace:e,editable:t});t&&(r.validationRules=a.settings.validationRules),r.alias=a.alias||void 0,r.fieldID=a.id,0!=a.settings.width&&(r.width=a.settings.width);var o=this.AB.localSettings(a.id);o&&o.width&&(!r.width||o.width>r.width)&&(r.width=o.width),r.width||(r.adjust=!0),i.indexOf(a.id)>-1?"calculate"==a.key||"formula"==a.key?r.footer={content:"totalColumn",field:a}:r.footer={content:"summColumn"}:s.indexOf(a.id)>-1&&(r.footer={content:"countColumn"}),n.push(r)})),n}customDisplays(e,t,i,s,a){if(!e||!e.getFirstId)return;let n=[];if(i.eachColumn((e=>{let t=this.fields((t=>t.columnName==e))[0];t&&n.push(t)})),null!=s)s.forEach((s=>{let r=e.getItem(s);r&&n.forEach((e=>{let s=i.getItemNode({row:r.id,column:e.columnName});e.customDisplay(r,t,s,{editable:a})}))}));else{let s=e.getFirstId();for(;s;){var r=e.getItem(s);r&&n.forEach((e=>{var s=i.getItemNode({row:r.id,column:e.columnName});e.customDisplay(r,t,s,{editable:a})})),s=e.getNextId(s)}}}displayData(e){if(null==e)return"";var t=this.multilingualFields();this.translate(e,e,t);var i=this.labelFormat||"";if(!i&&this.fields().length>0){var s=this.fields((e=>e.fieldUseAsLabel()))[0];i=s?`{${s.id}}`:`${this.AB.isUUID(e.id)?"ID: ":""}${e.id}`}var a=i.match(/\{[^}]+\}/g);if(a&&a.forEach&&a.forEach((t=>{var s=t.replace("{","").replace("}",""),a=this.fieldByID(s);null!=a&&(i=i.replace(t,a.format(e)||""))})),!i.trim()){let t=this.labelSettings||{};i=t&&t.isNoLabelDisplay?n(t.noLabelText||"[No Label]"):`${this.AB.isUUID(e.id)?"ID: ":""}${e.id}`}return i}currentView(){return this.workspaceViews.getCurrentView()}warningsAll(){var e=[].concat(this._warnings);return this.fields().forEach((t=>{e=e.concat(t.warnings())})),0==this.fields().length&&e.push({message:"I got no fields.",data:{}}),this.indexes().forEach((t=>{e=e.concat(t.warnings())})),e}isUuid(e){return console.error("ABObject.isUuid(): is depreciated.  directly reference AB.Rules.isUUID() instead."),this.AB.isUUID(e)}}},4509:(e,t,i)=>{const s=i(7826);e.exports=class extends s{}},1557:(e,t,i)=>{const s=i(7826);e.exports=class extends s{}},8447:(e,t,i)=>{const s=i(777);var a=null;"undefined"!=typeof io?io.socket.on("ab.query.update",(function(e){a?a.emit("ab.query.update",{queryId:e.queryId,data:e.data}):(console.error("ABObjectQuery:: received io.socket msg before ABFactory is defined"),console.error("TODO: move this to ABFactory!"))})):console.error("TODO: install socket.io client for sails updates."),e.exports=class extends s{constructor(e,t){super(e,t),a||(a=t),this.AB.on("ab.query.update",(e=>{this.id==e.queryId&&this.fromValues(e.data)})),this.conditionScan(this.where)}importFields(e){super.importFields(e),this._fields.forEach((e=>{e.field.columnName=`${e.alias}.${e.field.columnName}`}))}columnResize(e,t,i){let s=this.fields((t=>t.columnName==e))[0];return s?(s.settings.width=t,this.save()):Promise.resolve()}columnHeaders(e,t,i,s,a){var n=super.columnHeaders(e,t,i,s,a);return n.forEach((e=>{let t=this.objectByAlias(e.alias);if(!t)return;let i=t.fieldByID(e.fieldID);if(!i)return;let s="";if(s=Array.isArray(this.joins())?i.object.name:e.alias,e.id=`${s}.${i.columnName}`,this.settings&&this.settings.hidePrefix?e.header=`${i.label||""}`:e.header=`${i.object.label||""}.${i.label||""}`,i.settings&&i.settings.showIcon&&(e.header=`<span class="webix_icon fa fa-${i.fieldIcon()}"></span>${e.header}`),this.isGroup){let t=e.template;e.template=(i,s)=>i[e.id]?s.icon(i,s)+(t?t(i,s,i[e.id]):i[e.id]):""}e.adjust=!0,e.minWidth=220})),n}conditionScan(e){e&&(e.glue?(e.rules||[]).forEach((e=>{this.conditionScan(e)})):(this.fieldByID(e.key)||"this_object"==e.key||this.emit("warning","condition does not reference one of our fields",{rule:e}),this._conditionCheck||(this._conditionCheck=this.AB.filterComplexNew(`${this.id}_conditionCheck`)),this._conditionCheck.isConditionComplete(e)||this.emit("warning","incomplete condition definition",{rule:e})))}}},8836:(e,t,i)=>{const s=i(4812);e.exports=class extends s{constructor(e,t){super(e,t),this.AB.on("ab.abprocess.update",(e=>{this.id==e.objectId&&this.fromValues(e.data)}))}destroy(){var e=this.elements(),t=[];return e.forEach((e=>{t.push(e.destroy())})),Promise.all(t).then((()=>new Promise(((e,t)=>{this.toDefinition().destroy().then((()=>{e()})).then((()=>{console.error("TODO: ABProcess.destroy(): refactor to .emit('destroyed') and let containing Apps self remove.");var e=this.AB.applications().find((e=>e.hasProcess(this)));e.length>0&&e.forEach((e=>{e.processRemove(this)}))})).catch((e=>{t(e)}))}))))}save(){var e=[];return this.elements().forEach((t=>{e.push(t.save())})),Promise.all(e).then((()=>this.toDefinition().save().then((e=>{this.id||(this.id=e.id);var t={};Object.keys(this._elements).forEach((e=>{t[this._elements[e].id]=this._elements[e]})),this._elements=t}))))}isValid(){var e=this.AB.Validation.validator();return 0==this.AB.processes((e=>e.name.toLowerCase()==this.name.toLowerCase())).length||e.addError("name",((...e)=>AB.Multilingual.label(...e))('Process name must be unique ("{0}" already in use)',[this.name])),e}elementNewForModelDefinition(e){var t=this.AB.processElementNewForModelDefinition(e,this);return t&&this.elementAdd(t),t}}},4312:(e,t,i)=>{const s=i(5753);e.exports=class extends s{}},6580:e=>{var t=null;e.exports=class{constructor(e){t||(t=e,e.Label&&(t=e.Label))}getSeparateItems(){return[{id:",",value:t("Comma (,)")},{id:"\t",value:t("Tab (&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)")},{id:";",value:t("Semicolon (;)")},{id:"s",value:t("Space ( )")}]}validateFile(e){if(!e||!e.file||!e.file.type)return!1;let t=e.file.type.toLowerCase();return"text/csv"==t||"application/vnd.ms-excel"==t}getDataRows(e,t){return this.validateFile(e)?new Promise(((i,s)=>{let a=new window.FileReader;a.onload=e=>{let s=[];(a.result.split(/\r\n|\n|\r/).filter((e=>e&&e.length>0))||[]).forEach((e=>{let i=[];i=","==t?(e=e.replace(/,,/g,", ,")).match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g):e.split(t),s.push(i.map((e=>this.reformat(e))))})),i(s)},a.readAsText(e.file)})):Promise.reject()}getGuessDataType(e,t){for(var i,s=1;s<=10;s++){var a=e[s];if(!a)break;if(null!=(i=a[t])&&i.length>0)break}return null==i||""==i?"string":0==i||1==i||1==i||0==i||"checked"==i||"unchecked"==i?"boolean":isNaN(i)?Date.parse(i)?"date":i.length>100?"LongText":"string":"number"}reformat(e){return e?e.trim().replace(/"/g,"").replace(/'/g,""):""}}},1021:(e,t,i)=>{const s=i(353);let a=(...e)=>AB.Multilingual.label(...e);function n(e,t=[]){if(e){if(e.key){const i=t.filter((t=>t.id==e.key||t.columnName==e.key))[0];e.field=i?.columnName??i?.id,e.condition={type:e.rule,filter:e.value},Array.isArray(e.value)?e.includes=e.value:e.includes=(e.value??"").split(","),"date"!=i?.key&&"datetime"!=i?.key||(e.condition.filter=e.condition.filter?AB.toDate(e.condition.filter):null,e.includes=e.includes.map((e=>AB.toDate(e)))),delete e.key,delete e.rule,delete e.value}e.rules&&e.rules.length&&(e.rules??[]).forEach((e=>{n(e,t)}))}}function r(e,t=[]){if(e){if(e.field){let i=t.filter((t=>t.columnName==e.field))[0];e.key=i?.id??e.field,e.condition=e.condition??{},e.rule=e.condition.type;let s=e.includes??[];e.condition.filter&&s.indexOf(e.condition.filter)<0&&s.push(e.condition.filter),e.value=s.map((e=>!i||"date"!=i.key&&"datetime"!=i.key?e instanceof Date?e.toISOString():e:i.exportValue(e))).join(","),delete e.field,delete e.type,delete e.includes,delete e.condition}e.rules&&e.rules.length&&(e.rules??[]).forEach((e=>{r(e,t)}))}}e.exports=class extends s{constructor(e,t,i={}){super(e=e??"ab_filterComplex",t),this._options=i??{},this._initComplete=!1,this.observing=!1,this.labels={common:(t._App??{}).labels,component:{and:a("And"),or:a("Or"),thisObject:a("This Object"),inQuery:a("In Query"),notInQuery:a("Not In Query"),inQueryField:a("By Query Field"),notInQueryField:a("Not By Query Field"),inQueryFieldQueryPlaceholder:a("Choose a Query"),inQueryFieldFieldPlaceholder:a("Choose a Field"),sameAsUser:a("Same As User"),notSameAsUser:a("Not Same As User"),sameAsField:a("Same As Field"),notSameAsField:a("Not Field"),inDataCollection:a("In Data Collection"),notInDataCollection:a("Not In Data Collection"),containsCondition:a("contains"),notContainsCondition:a("doesn't contain"),isCondition:a("is"),isNotCondition:a("is not"),isEmpty:a("is empty"),isNotEmpty:a("is not empty"),beforeCondition:a("is before"),afterCondition:a("is after"),onOrBeforeCondition:a("is on or before"),onOrAfterCondition:a("is on or after"),beforeCurrentCondition:a("is before current date"),afterCurrentCondition:a("is after current date"),onOrBeforeCurrentCondition:a("is on or before current date"),onOrAfterCurrentCondition:a("is on or after current date"),onLastDaysCondition:a("last ... days"),onNextDaysCondition:a("next ... days"),equalCondition:a(":"),notEqualCondition:a("≠"),lessThanCondition:a("<"),moreThanCondition:a(">"),lessThanOrEqualCondition:a("≤"),moreThanOrEqualCondition:a("≥"),equalListCondition:a("equals"),notEqualListCondition:a("does not equal"),checkedCondition:a("is checked"),notCheckedCondition:a("is not checked"),isCurrentUserCondition:a("is current user"),isNotCurrentUserCondition:a("is not current user"),containsCurrentUserCondition:a("contains current user"),notContainsCurrentUserCondition:a("does not contain current user"),ContextDefaultOption:a("choose option"),EqualsProcessValue:a("equals process value"),NotEqualsProcessValueCondition:a("not equals process value"),InProcessValueCondition:a("in process value"),notInProcessValueCondition:a("not in process value")}};let s=this.ids={popup:this.unique(`${e}_popup`),querybuilder:this.unique(`${e}_querybuilder`),save:this.unique(`${e}_save`)};this.Account.username=this.AB.Account.username(),this._recordRuleFieldOptions=[],this.ui={rows:[{view:"layout",type:"clean",borderless:!0,rows:[{id:s.querybuilder,view:"query",data:()=>[],fields:[]}]},{id:s.save,view:"button",css:"webix_primary",value:a("Save"),hidden:this._options.isSaveHidden??!1,click:()=>{this.myPopup&&this.myPopup.hide(),this.emit("save",this.getValue())}}]}}init(e){if(this._initComplete)return;super.init(e),this._isRecordRule=e?.isRecordRule??!1,this._recordRuleFieldOptions=e?.fieldOptions??[];const t=$$(this.ids.querybuilder);if(t){if(!this.observing){this.__blockOnChange=!0,t.getState().$observe("value",(e=>{if(this.__blockOnChange)return!1;this.emit("changed",this.getValue())})),this.__blockOnChange=!1;let e=this.condition;this.condition=e,this.observing=!0}this._initComplete=!0}}isValid(e){let t=()=>!0,i=$$(this.ids.querybuilder);return i?(t=i.getFilterFunction(),t(e)):super.isValid(e)}isConditionComplete(e){if(!e)return!1;let t=!0;if(e.glue)(e.rules??[]).forEach((e=>{t=t&&this.isConditionComplete(e)}));else if(e.key&&""!=e.key||(t=!1),e.rule&&""!=e.rule||(t=!1),t)switch(e.rule){case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":case"same_as_user":case"not_same_as_user":case"less_current":case"greater_current":case"less_or_equal_current":case"greater_or_equal_current":case"is_empty":case"is_not_empty":break;default:e.value&&""!=e.value||(t=!1)}return t}setValue(e){super.setValue(e),this.condition=e;const t=$$(this.ids.querybuilder);if(t){if(!e)return void t.define("value",{glue:"and",rules:[]});let i=this.AB.cloneDeep(e);n(i,this._Fields),this.__blockOnChange=!0,t.define("value",i),this.__blockOnChange=!1}}getValue(){if($$(this.ids.querybuilder)){let e=this.AB.cloneDeep($$(this.ids.querybuilder).getState().value??{});r(e,this._Fields),this.condition=e}return super.getValue()}fieldsLoad(e=[],t=null){super.fieldsLoad(e,t),this.uiInit()}toShortHand(){return"Add Filters"}uiInit(){this.uiQueryCustomValue();let e=$$(this.ids.querybuilder);if(e){for(;e.config.fields.length>0;)e.config.fields.pop();(this.fieldsToQB()??[]).forEach((t=>{e.config.fields.push(t)}))}}uiQueryCustomValue(){const e=$$(this.ids.querybuilder);e&&(e.$app.require("jet-views","filter").prototype.CreateFilter=(e,t,i,s,a)=>{let n=this.uiValue(e),r={id:a.config.id,view:"filter",localId:"filter",conditions:s,field:e,mode:t,template:function(s){let a=s[e],n=i??("date"==t?webix.i18n.dateFormatStr:null);return n&&(a=n(a)),a},inputs:n,margin:6};return webix.ui(r,a)})}uiValue(e){let t;if("this_object"==e)return[].concat(this.uiQueryValue("this_object")).concat(this.uiDataCollectionValue("this_object")).concat(this.uiCustomValue("this_object")).concat(this.uiContextValue("this_object","uuid"));let i=(this._Fields??[]).filter((t=>t.columnName==e))[0];switch(i?.key){case"boolean":t=this.uiBooleanValue(i);break;case"connectObject":t=[].concat(this.uiQueryValue(i)).concat(this.uiUserValue(i)).concat(this.uiDataCollectionValue(i)).concat(this.uiContextValue(i)).concat(this.uiNoneValue());break;case"date":case"datetime":t=["datepicker","daterangepicker"];break;case"list":t=this.uiListValue(i);break;case"user":t=[].concat(this.uiNoneValue()).concat(this.uiUserValue(i));break;case"string":case"LongText":case"email":t=this.uiNoneValue()}const s=`${i?.settings?.linkType}:${i?.settings?.linkViaType}`;return i?.settings?.isCustomFK&&("one:many"==s||"one:one"==s&&i?.settings?.isSource)?t=(t??[]).concat(this.uiTextValue(i)):"connectObject"!=i?.key?t=(t??[]).concat(this.uiTextValue(i)).concat(this.uiQueryFieldValue(i)).concat(this.uiContextValue(i)):e.indexOf("uuid")>-1&&(t=this.uiContextValue(null,e)),this._isRecordRule&&(t=(t??[]).concat(this.uiRecordRuleValue(i))),t=(t??[]).concat(this.uiCustomValue(i)),t}uiNoneValue(){return[{batch:"none",borderless:!0,view:"template",template:""}]}uiBooleanValue(e){return[{batch:"boolean",view:"checkbox"}]}uiTextValue(e){return[{batch:"text",view:"text",on:{onAfterRender:function(){(this.queryView((function(e){return!e.getParentView()}),"parent")??this).$view.style.zIndex=202}}}]}uiQueryValue(e){let t=[],i=this._QueryFields?.filter((t=>t.id==e.id)).length>0;return"this_object"==e&&this._Object?t=this.queries((e=>e.canFilterObject(this._Object))):i&&(t=this.queries((t=>(this._Object?this._Object.id:"")!=t.id&&t.canFilterObject(e.datasourceLink)))),t?.forEach((e=>{t.push({id:e.id,value:e.label})})),[{batch:"query",view:"combo",options:t??[]}]}uiListValue(e){return[{batch:"list",view:"combo",options:e?.settings?.options?.map((function(e){return{id:e.id,value:e.text}}))}]}uiUserValue(e){return[{batch:"user",view:"combo",options:this.AB.Account.userList().map((e=>({id:e.username,value:e.username})))}]}uiDataCollectionValue(e){let t;return t="this_object"==e&&this._Object?this._Object.id:e?.settings?.linkObject,[{batch:"datacollection",view:"combo",options:t?this.AB.datacollections((e=>e?.datasource?.id==t)).map((e=>({id:e.id,value:e.label}))):[]}]}uiQueryFieldValue(e){return[{batch:"queryField",view:"combo",placeholder:this.labels.component.inQueryFieldQueryPlaceholder,options:this.queries((e=>null==this._Object||e.id!=this._Object.id)).map((e=>({id:e.id,value:e.label})))}]}uiRecordRuleValue(e){return[{batch:"recordRule",view:"select",options:this._recordRuleFieldOptions??[]}]}uiContextValue(e,t=null){let i=(this._ProcessFields??[]).filter((i=>{if(!i)return!1;if(i.field)return i.field.id==e.id;if(i.key){let s=i.key.split(".").pop();return s==e.id||s==e.key||s==t||i.key==t}}))[0];return i?[{batch:"context",view:"select",options:[{id:"empty",value:this.labels.component.ContextDefaultOption},{id:i.key,value:a("context({0})",[i.label])}]}]:[]}uiCustomValue(e){return e?((this._customOptions??{})[e.id??e]??{}).values??[]:[]}popUp(...e){if(!this.myPopup){let e={id:this.ids.popup,view:"popup",height:400,width:800,body:this.ui};this.myPopup=webix.ui(e),this.init()}this._Fields&&this.fieldsLoad(this._Fields,this._Object),this.condition&&this.setValue(this.condition),this.myPopup.show(...e)}addCustomOption(e,t={}){this._customOptions=this._customOptions??{},this._customOptions[e]=t}}},1688:(e,t,i)=>{const s=i(1584);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(e,t,i),console.error("TODO: Switch RowFilter => FilterComplex");let s=this.ids={component:this.unique(`${t}_rowFilter`),filterForm:this.unique(`${t}_rowFilter_form`),addNewFilter:this.unique(`${t}_rowFilter_addNewFilter`),glue:this.unique(`${t}_rowFilter_glue`),field:this.unique(`${t}_rowFilter_field`),rule:this.unique(`${t}_rowFilter_rule`),inputValue:this.unique(`${t}_rowFilter_inputValue`),queryCombo:this.unique(`${t}_rowFilter_queryCombo`),queryFieldCombo:this.unique(`${t}_rowFilter_queryFieldCombo`),queryFieldComboQuery:this.unique(`${t}_rowFilter_queryFieldComboQuery`),queryFieldComboField:this.unique(`${t}_rowFilter_queryFieldComboField`),fieldMatch:this.unique(`${t}_rowFilter_fieldMatchCombo`),dataCollection:this.unique(`${t}_rowFilter_dataCollection`),listOptions:this.unique(`${t}_rowFilter_listOptions`),datePicker:this.unique(`${t}_rowFilter_datePicker`)};var n;this.queryFieldOptions=[{value:a("By Query Field"),id:"in_query_field"},{value:a("Not In Query"),id:"not_in_query_field"}],this.recordRuleOptions=[],this.recordRuleFieldOptions=[];let r=this._logic||{};r.getFieldList=()=>(this._Fields||[]).map((e=>{let t=e.label;return this._settings.showObjectName&&e.object&&(t=e.object.label+"."+e.label),{id:e.id,value:t,alias:e.alias||void 0}})),r.getFilterUI=()=>{let e=this,t=this.config_settings||{};return{id:"f"+webix.uid(),isolate:!0,cols:[{view:"combo",id:s.glue,width:80,value:t.glue||"and",options:[{value:a("And"),id:"and"},{value:a("Or"),id:"or"}],on:{onChange:function(e,t){r.selectCombineCondition(e)}}},{view:"combo",id:s.field,suggest:{on:{onBeforeShow:function(){this.define("width",400),this.resize()}},data:r.getFieldList()},on:{onChange:function(e){var t=this.getParentView();r.selectField(e,t)}}},{id:s.rule,width:220,cells:[{},{batch:"query",view:"combo",value:"in_query",options:[{value:a("In Query"),id:"in_query"},{value:a("Not In Query"),id:"not_in_query"},{value:a("contains"),id:"contains"},{value:a("doesn't contain"),id:"not_contains"},{value:a("is"),id:"equals"},{value:a("is not"),id:"not_equal"},{value:a("is empty"),id:"is_empty"},{value:a("is not empty"),id:"is_not_empty"},{value:a("Same As User"),id:"same_as_user"},{value:a("Not Same As User"),id:"not_same_as_user"},{value:a("In Data Collection"),id:"in_data_collection"},{value:a("Not In Data Collection"),id:"not_in_data_collection"}].concat(e.recordRuleOptions),on:{onChange:function(e,t){var i=this.getParentView().getParentView();r.onChangeRule(e,i),r.onChange()}}},{batch:"date",view:"combo",value:"less",options:[{value:a("equals"),id:"equals"},{value:a("does not equal"),id:"not_equal"},{value:a("is before"),id:"less"},{value:a("is after"),id:"greater"},{value:a("is on or before"),id:"less_or_equal"},{value:a("is on or after"),id:"greater_or_equal"},{value:a("is before current date"),id:"less_current"},{value:a("is after current date"),id:"greater_current"},{value:a("is on or before current date"),id:"less_or_equal_current"},{value:a("is on or after current date"),id:"greater_or_equal_current"},{value:a("last ... days"),id:"last_days"},{value:a("next ... days"),id:"next_days"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"number",view:"combo",value:"equals",options:[{value:a(":"),id:"equals"},{value:a("≠"),id:"not_equal"},{value:a("<"),id:"less"},{value:a(">"),id:"greater"},{value:a("≤"),id:"less_or_equal"},{value:a("≥"),id:"greater_or_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"list",view:"combo",value:"equals",options:[{value:a("equals"),id:"equals"},{value:a("does not equal"),id:"not_equal"},{value:a("Same As User"),id:"same_as_user"},{value:a("Not Same As User"),id:"not_same_as_user"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e,t){var i=this.getParentView().getParentView();r.onChangeRule(e,i),r.onChange()}}},{batch:"boolean",view:"combo",value:"equals",options:[{value:a("equals"),id:"equals"},{value:a("does not equal"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"user",view:"combo",value:"is_current_user",options:[{value:a("is current user"),id:"is_current_user"},{value:a("is not current user"),id:"is_not_current_user"},{value:a("contains current user"),id:"contain_current_user"},{value:a("does not contain current user"),id:"not_contain_current_user"},{value:a("equals"),id:"equals"},{value:a("does not equal"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"string",view:"combo",value:"contains",options:[{value:a("contains"),id:"contains"},{value:a("doesn't contain"),id:"not_contains"},{value:a("is"),id:"equals"},{value:a("is not"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"email",view:"combo",value:"contains",options:[{value:a("contains"),id:"contains"},{value:a("doesn't contain"),id:"not_contains"},{value:a("is"),id:"equals"},{value:a("is not"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}}]},{id:s.inputValue,isolate:!0,cells:[{batch:"empty"},{id:s.queryCombo,batch:"query",view:"combo",options:[],on:{onChange:r.onChange}},{id:s.queryFieldCombo,batch:"queryField",rows:[{id:s.queryFieldComboQuery,view:"combo",options:[],placeholder:a("Choose a Query"),on:{onChange:function(e){var t=this.getParentView().getParentView().getParentView();r.onChangeQueryFieldCombo(e,t),r.onChange()}}},{id:s.queryFieldComboField,view:"combo",options:[],placeholder:a("Choose a Field"),on:{onChange:r.onChange}}]},{id:s.fieldMatch,batch:"fieldMatch",view:"combo",options:[],on:{onChange:r.onChange}},{id:s.dataCollection,batch:"dataCollection",view:"richselect",options:[],on:{onChange:r.onChange}},{batch:"date",id:s.datePicker,view:"datepicker",on:{onChange:function(){r.onChange()}}},{batch:"number",view:"text",validate:webix.rules.isNumber,on:{onTimedKeyPress:function(){this.validate()&&r.onChange()}}},{batch:"list",id:s.listOptions,view:"combo",options:[],on:{onChange:function(){r.onChange()}}},{batch:"boolean",view:"checkbox",on:{onChange:function(){r.onChange()}}},{batch:"user",view:"combo",options:this.AB.Account.userList().map((e=>({id:e.username,value:e.username}))),on:{onChange:function(){r.onChange()}}},{batch:"string",view:"text",on:{onTimedKeyPress:function(){r.onChange()}}},{batch:"email",view:"text",on:{onTimedKeyPress:function(){r.onChange()}}}]},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"icon",autowidth:!0,click:function(){var e=this.getFormView().index(this.getParentView());r.addNewFilter(e+1)}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){var e=this.getParentView();r.removeNewFilter(e)}}]}},r.getAddButtonUI=()=>({view:"button",id:s.addNewFilter,css:"webix_primary",type:"form",label:a("Add a filter"),click:()=>{r.addNewFilter()}}),r.addNewFilter=(e,t)=>{var i,a=r.getFilterUI(),n=$$(s.filterForm);return n&&(i=n.addView(a,e),r.toggleAddNewButton(),t&&r.selectField(t,$$(i),!0)),i},r.removeNewFilter=function(e){$$(s.filterForm).removeView(e),r.toggleAddNewButton(),r.onChange()},r.toggleAddNewButton=function(){$$(s.filterForm)&&($$(s.filterForm).getChildViews().length<1?($$(s.filterForm).hide(),$$(s.addNewFilter).show()):($$(s.filterForm).show(),$$(s.addNewFilter).hide()))},r.selectCombineCondition=(e,t)=>{this.config_settings.glue=e,$$(s.filterForm).getChildViews().forEach((t=>{t.$$&&t.$$(s.glue)&&t.$$(s.glue).setValue(e)})),t||r.onChange()},r.selectField=(e,t,i)=>{if(!this._Fields)return;var a=this._Fields.filter((t=>t.id==e))[0];if(!a)return;n=a.key,"this_object"==a.id?n="query":"LongText"==n||"combined"==n?n="string":"formula"==a.key&&(n="number");var o=this._QueryFields.filter((e=>e.id==a.id)).length>0;o&&(n="query"),t.$$(s.rule).showBatch(n),t.$$(s.inputValue).showBatch(n);let l=[],u=[];if("this_object"==a.id&&this._Object?u=this.queries((e=>e.canFilterObject(this._Object))):o&&(u=this.queries((e=>(this._Object?this._Object.id:"")!=e.id&&e.canFilterObject(a.datasourceLink)))),u.forEach((e=>{l.push({id:e.id,value:e.label})})),t.$$(s.inputValue).$$(s.queryCombo).define("options",l),t.$$(s.inputValue).$$(s.queryCombo).refresh(),"list"==a.key){let e=a.settings.options.map((function(e){return{id:e.id,value:e.text}}));t.$$(s.inputValue).$$(s.listOptions).define("options",e),t.$$(s.inputValue).$$(s.listOptions).refresh()}else"date"==a.key&&(t.$$(s.inputValue).$$(s.datePicker).define("format",a.getFormat()),t.$$(s.inputValue).$$(s.datePicker).refresh());var c=t.$$(s.rule).getActiveId(),d=t.$$(s.rule).queryView({id:c});if(d&&d.getList){let e=(d.getList().config.data||[])[0];e&&d.setValue(e.id)}i||r.onChange()},r.onChangeRule=(e,t,i=!1)=>{switch(e){case"contains":case"not_contains":case"equals":case"not_equal":"query"==n&&t.$$(s.inputValue).showBatch("string");break;case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":case"same_as_user":case"not_same_as_user":case"less_current":case"greater_current":case"less_or_equal_current":case"greater_or_equal_current":case"is_empty":case"is_not_empty":t.$$(s.inputValue).showBatch("empty"),r.onChange();break;case"last_days":case"next_days":t.$$(s.inputValue).showBatch("number");break;case"in_query_field":case"not_in_query_field":var a=[];this.queries((e=>null==this._Object||e.id!=this._Object.id)).forEach((e=>{a.push({id:e.id,value:e.label})})),t.$$(s.inputValue).$$(s.queryFieldComboQuery).define("options",a),t.$$(s.inputValue).$$(s.queryFieldComboQuery).refresh(),t.$$(s.inputValue).showBatch("queryField");break;case"same_as_field":case"not_same_as_field":t.$$(s.inputValue).$$(s.fieldMatch).define("options",this.recordRuleFieldOptions),t.$$(s.inputValue).$$(s.fieldMatch).refresh(),t.$$(s.inputValue).showBatch("fieldMatch");break;case"in_data_collection":case"not_in_data_collection":{let e,i=[],a=t.$$(s.field).getValue();if("this_object"==a&&this._Object)e=this._Object.id;else{let t=this._Fields.filter((e=>e.id==a))[0];t&&(e=t.settings.linkObject)}this._Application&&e&&this._Application.datacollections((t=>t.datasource&&t.datasource.id==e)).forEach((e=>{i.push({id:e.id,value:e.label})})),t.$$(s.inputValue).$$(s.dataCollection).define("options",i),t.$$(s.inputValue).$$(s.dataCollection).refresh(),t.$$(s.inputValue).showBatch("dataCollection");break}default:t.$$(s.inputValue).showBatch(n),i&&r.onChange()}},r.onChangeQueryFieldCombo=(e,t)=>{let i=[],a=this.queries((t=>t.id==e))[0];a&&(a.fields((e=>!e.isConnection)).forEach((e=>{i.push({id:e.id,value:e.object.label+"."+e.label})})),t.$$(s.inputValue).$$(s.queryFieldComboField).define("options",i),t.$$(s.inputValue).$$(s.queryFieldComboField).refresh())},r.onChange=()=>(this.__blockOnChange||(r.getValue(),console.warn("convert RowFilter.callback.onChange() to .emit()"),r.callbacks.onChange(),this.emit("change")),!1),r.blockOnChange=()=>{this.__blockOnChange=!0},r.unblockOnChange=()=>{this.__blockOnChange=!1},r.getValue=()=>{let e={glue:"and",rules:[]};var t=$$(s.filterForm);return t&&t.getChildViews().forEach(((t,i)=>{0==i&&(e.glue=t.$$(s.glue).getValue());var a=t.$$(s.field);if(a){var n=a.getValue();if(n){var r,o=t.$$(s.field).getPopup().config.body.data.filter((e=>e.id==n))[0];o&&(r=o.alias||void 0);var l=null,u=t.$$(s.rule).getActiveId(),c=t.$$(s.rule).queryView({id:u});c&&c.getValue&&(l=c.getValue());var d=null,h=t.$$(s.inputValue).getActiveId(),p=t.$$(s.inputValue).queryView({id:h});if(p&&p.getValue)d=p.getValue();else if(p&&p.getChildViews()){var m=[];p.getChildViews().forEach((e=>{m.push($$(e).getValue())})),d=m.join(":")}if(d instanceof Date){let e=this._Fields.filter((e=>e.id==n))[0];d=e?e.exportValue(d):d.toISOString()}e.rules.push({alias:r||void 0,key:n,rule:l,value:d})}}})),this.config_settings=e,this.config_settings},this.ui={id:s.component,rows:[{view:"form",id:s.filterForm,hidden:!0,elements:[]},r.getAddButtonUI()]}}init(e={}){for(var t in super.init(e),this._logic.callbacks)this._logic.callbacks[t]=e[t]||this._logic.callbacks[t];e.showObjectName&&(this._settings.showObjectName=e.showObjectName),e.isRecordRule&&(this.recordRuleOptions=[{value:a("Same As Field"),id:"same_as_field"},{value:a("Not Field"),id:"not_same_as_field"}],this.recordRuleFieldOptions=e.fieldOptions)}setValue(e){e=e||{},super.setValue(e);let t=this.ids,i=this._logic;i.blockOnChange();let s=this.AB.cloneDeep(e);s.rules=s.rules||[];var a=$$(t.filterForm);a&&webix.ui([],a),0==s.rules.length&&i.toggleAddNewButton(),s.rules.forEach((e=>{var a=i.addNewFilter(),n=$$(a);if(null!=n){var r=this._Fields.filter((t=>t.id==e.key))[0];n.$$(t.glue).define("value",s.glue),n.$$(t.glue).refresh(),n.$$(t.field).define("value",e.key),n.$$(t.field).refresh(),i.selectField(e.key,n,!0);var o=n.$$(t.rule).getActiveId(),l=n.$$(t.rule).queryView({id:o});l&&l.setValue&&(l.define("value",e.rule),l.refresh()),n.blockEvent(),i.onChangeRule(e.rule,n),n.unblockEvent();var u=n.$$(t.inputValue).getActiveId(),c=n.$$(t.inputValue).queryView({id:u});if(c&&c.setValue)r&&"date"==r.key&&e.value&&("less"==e.rule||"greater"==e.rule||"less_or_equal"==e.rule||"greater_or_equal"==e.rule)?c.define("value",new Date(e.value)):c.define("value",e.value),c.refresh();else if(c&&c.getChildViews()){let t=(e.value||"").split(":"),s=0;c.getChildViews().forEach((e=>{$$(e).blockEvent(),$$(e).setValue(t[s]),0==s&&i.onChangeQueryFieldCombo(t[s],n),$$(e).unblockEvent(),s++}))}r&&"user"==r.key&&(n.blockEvent(),i.onChangeRule(e.rule,n),n.blockEvent())}})),i.unblockOnChange()}isComplete(){return this._completeConditions||(this._completeConditions=this.AB.filterComplexNew(`${this.ids.component}_iscomplete`)),this._completeConditions.isConditionComplete(this.getValue())}}},2021:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var s=i(2735);const a=i(704);var n=null;class r extends s.Z{constructor(e,t){super(e,{form:`${e}_rowUpdaterForm`,addNew:`${e}_rowUpdaterAddNew`,field:`${e}_rowUpdaterField`}),this.idBase=e,this._Object=null,this._mockFormWidget=null,this.AB=t,n||(n=(...e)=>this.AB.Multilingual.label(...e))}uiItem(){var e=this;return{rows:[{view:"layout",isolate:!0,cols:[{view:"label",width:40,label:n("Set")},{view:"combo",id:this.ids.field,options:this.getFieldList(!0),on:{onChange:function(t){let i=this.getParentView();e.selectField(t,i)}}},{view:"label",width:40,label:n("To")},{view:"segmented",value:"custom",height:40,maxWidth:160,options:[{id:"custom",value:n("Custom")},{id:"process",value:n("Process")}],hidden:null==this._extendedOptions||!this._extendedOptions.length,on:{onChange:function(t){let i=this.getParentView();e.toggleCustomProcessOption(i,"process"==t)}}},{},{hidden:!0},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){let t=this.getParentView().getParentView();e.removeItem(t)}}]}]}}ui(){return{rows:[{view:"form",id:this.ids.form,hidden:!0,borderless:!0,elements:[]},{view:"button",id:this.ids.addNew,icon:"fa fa-plus",type:"iconButton",label:n("Add field to edit"),click:()=>{this.addItem()}}]}}init(e){const t=$$(this.ids.form);return t&&e.Webix.extend(t,e.Webix.ProgressBar),Promise.resolve()}addItem(e){let t=$$(this.ids.form);if(this.getFieldList(!0).length<1)return;let i=this.uiItem(),s=t.addView(i,e);return this.toggleForm(),s}getFieldList(e){let t=(this._Object.fields()||[]).map((e=>({id:e.id,value:e.label})));return e&&$$(this.ids.form).getChildViews().forEach((e=>{if(!e||!e.$$)return;let i=e.$$(this.ids.field);if(!i)return;let s=i.getValue();s&&(t=t.filter((e=>e.id!=s)))})),t}getValue(){let e=[],t=$$(this.ids.form);return t&&t.getChildViews().forEach((t=>{let i=t.getChildViews()[0];if(!i||!i.$$)return;let s=i.$$(this.ids.field);if(!s)return;let a=s.getValue();if(!a)return;let n=i.getChildViews()[4],r=i.getChildViews()[5];if(!n&&!r)return;let o=this._Object.fieldByID(a),l={fieldId:a};if(n&&n.isVisible())if("connectObject"==o.key)l.value=o.getValue(n.getChildViews()[0]);else if("date"==o.key||"datetime"==o.key)if(1==n.getChildViews()[0].getValue())l.value="ab-current-date";else{let e=n.getChildViews()[1];l.value=o.getValue(e)}else l.value=o.getValue(n);else r&&r.isVisible()&&(l.isProcessValue=!0,l.value=r.getValue());e.push(l)})),e}objectLoad(e){this._Object=e,this._mockApp=this.AB.applicationNew({}),this._mockFormWidget=new a({settings:{showLabel:!1,labelWidth:0}},this._mockApp),this._mockFormWidget.objectLoad(e),this.setValue(null)}removeItem(e){$$(this.ids.form).removeView(e),this.toggleForm()}async selectField(e,t){let i=this._Object.fieldByID(e);if(!i)return void this.AB.notify.builder(new Error(`could not find field for id[${e}]`),{context:"RowUpdater.selectField() could not find a field",fieldID:e});let s=i.formComponent().newInstance(this._mockApp,this._mockFormWidget).component(this.AB._App,this.idBase),a=s.ui;switch(i.key){case"connectObject":{this.busy();const e=i.getOptions();a.rows[0].suggest.body.data=await e??[],this.ready()}break;case"user":a.options=a.options||[],a.options.unshift({id:"ab-current-user",value:n("[Current User]")});break;case"date":case"datetime":a={view:"layout",rows:[{view:"checkbox",labelWidth:0,labelRight:n("Current Date/Time"),on:{onChange:function(e){let t=this.getParentView();if(!t)return;let i=t.getChildViews()[1];i&&(e?i.hide():i.show())}}},a]}}let r=t.getChildViews();t.removeView(r[4]),t.addView(a,4),s.init(),i.customDisplay&&i.customDisplay({},this.AB._App,r[4].$view),t.removeView(r[5]),this._extendedOptions&&this._extendedOptions.length?t.addView({view:"richselect",options:this._extendedOptions,hidden:!0},5):t.addView({hidden:!0},5),this.toggleCustomProcessOption(t,"process"==r[3].getValue()),$$(t).adjust(),t.getFormView().adjust()}setValue(e){let t=$$(this.ids.form);t&&(webix.ui([],t),(e=e||[]).length<1||(e.forEach((e=>{let t=$$(this.addItem()).getChildViews()[0];t.$$(this.ids.field).setValue(e.fieldId),t.queryView({view:"segmented"},"self").setValue(e.isProcessValue?"process":"custom");let i=t.getChildViews()[4],s=t.getChildViews()[5];if(!i&&!s)return;let a=this._Object.fieldByID(e.fieldId);if(!a)return;let n={};n[a.columnName]=e.value,a.setValue(i,n),s.setValue(e.value)})),this.toggleForm()))}toggleForm(){let e=$$(this.ids.form);if(e){let t=e.getChildViews();t&&t.length?e.show():e.hide(),e.adjust()}}setExtendedOptions(e){this._extendedOptions=e}toggleCustomProcessOption(e,t){let i=e.getChildViews()[4],s=e.getChildViews()[5];t?(i.hide(),s.show()):(i.show(),s.hide())}busy(){$$(this.ids.addNew).disable(),$$(this.ids.form)?.showProgress({type:"icon"})}ready(){$$(this.ids.addNew).enable(),$$(this.ids.form)?.hideProgress()}}},4403:(e,t,i)=>{const s=i(8601),a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.AB.on("ab.abdefinition.update",(e=>{e.id==this.id&&this.emit("definition.updated",this)}))}static clearEditor(e){this._CurrentField=null;const t={label:"",columnName:"",showIcon:1,required:0,unique:0,validationRules:""};for(const i in t){const s=$$(e[i]);s&&s.setValue(t[i])}const i=$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");i.length&&i.forEach((t=>{$$(e.filterComplex).removeView(t)})),$$(e.addValidation).hide(),$$(e.numberOfNull).hide()}static editorPopulate(e,t){if(this._CurrentField=t,$$(e.label).setValue(t.label),$$(e.columnName).setValue(t.columnName),$$(e.showIcon).setValue(t.settings.showIcon),$$(e.required).setValue(t.settings.required),$$(e.unique).setValue(t.settings.unique),this._CurrentField&&$$(e.addValidation).show(),t.settings&&t.settings.validationRules){let i=t.settings.validationRules;if("string"==typeof i)try{i=JSON.parse(i)}catch(e){}(i||[]).forEach((i=>{t.addValidation(e,i)}))}}static definitionEditor(e,t,i,s){let n=function(e,i){e!=(i=i||"")&&i==$$(t.columnName).getValue()&&$$(t.columnName).isEnabled()&&$$(t.columnName).setValue(e)};i.labelOnChange&&(n=i.labelOnChange);let r=function(e,t,i){console.warn("Field has not implemented .requiredOnChange() is that okay?")};const o=e=>this._CurrentField.addValidation(e);i.requiredOnChange&&(r=i.requiredOnChange);const l=async e=>{if(e&&this._CurrentField&&this._CurrentField.id&&this._CurrentField.settings.required!=e){const e=await this._CurrentField.object.model().count({where:{glue:"and",rules:[{key:this._CurrentField.id,rule:"is_null"}]}});if(e.count>0){const i=a("** There are {0} rows that will be updated to default value",[e.count]);$$(t.numberOfNull).setValue(i),$$(t.numberOfNull).show()}else $$(t.numberOfNull).hide()}else $$(t.numberOfNull).hide()};return{rows:[{view:"text",id:t.label,name:"label",label:a("Label"),placeholder:a("Label"),labelWidth:this.AB.UISettings.config().labelWidthLarge,css:"ab-new-label-name",on:{onChange:function(e,t){n(e,t)}}},{view:"text",id:t.columnName,name:"columnName",disallowEdit:!0,label:a("Field Name"),labelWidth:this.AB.UISettings.config().labelWidthLarge,placeholder:a("Database field name")},{view:"label",id:t.fieldDescription,label:a("Description"),align:"right"},{view:"checkbox",id:t.showIcon,name:"showIcon",labelRight:e.labels.dataFieldShowIcon,labelWidth:this.AB.UISettings.config().labelWidthCheckbox,value:!0},{view:"checkbox",id:t.required,name:"required",hidden:!s.supportRequire,labelRight:e.labels.required,labelWidth:this.AB.UISettings.config().labelWidthCheckbox,on:{onChange:async(e,i)=>{r(e,i,t),await l(e)}}},{view:"label",id:t.numberOfNull,css:{color:"#f00"},label:"",hidden:!0},{view:"checkbox",id:t.unique,name:"unique",hidden:!s.supportUnique,labelRight:e.labels.unique,disallowEdit:!0,labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{id:t.filterComplex,rows:[]},{id:t.addValidation,view:"button",label:a("Add Field Validation"),css:"webix_primary",click:()=>{o(t)}},{id:t.validationRules,view:"text",hidden:!0,name:"validationRules"}]}}static editorValues(e){const t={label:e.label,columnName:e.columnName,settings:e};return delete e.label,delete e.columnName,t}addValidation(e,t){this.object.application.App;const i=this.AB.filterComplexNew(`${this.id}_field_validation_rules`);$$(e.filterComplex).addView({view:"form",css:"abValidationForm",cols:[{rows:[{view:"text",name:"invalidMessage",labelWidth:this.AB.UISettings.config().labelWidthLarge,value:t&&t.invalidMessage?t.invalidMessage:"",label:a("Invalid Message")},i.ui]},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const t=this.getParentView();$$(e.filterComplex).removeView(t)}}]}),$$(i.ids.save).hide(),i.fieldsLoad(this.object.fields()),t&&t.rules&&i.setValue(t.rules)}isValid(){const e=this.AB.Validation.validator();return 0==this.object.fields((e=>e.id!=this.id&&e.columnName.toLowerCase()==this.columnName.toLowerCase())).length||e.addError("columnName",a("Field columnName must be unique ({0} already used in this Application)",[this.columnName])),e}async destroy(){this.id&&(await this.migrateDrop(),await super.destroy(),await this.object.fieldRemove(this))}async save(){let e=!1;if(this.id||(e=!0),!e&&this.settings.required&&this.settings.default){const e=this.object.model(),t=await e.findAll({where:{glue:"and",rules:[{key:this.id,rule:"is_null"}]}}),i=[];t.data.forEach((t=>{t[this.columnName]||(t[this.columnName]=this.settings.default),i.push(e.update(t.id,t))})),await Promise.all(i)}if(await super.save(),await this.object.fieldAdd(this),!this.isConnection){const t=e?this.migrateCreate():this.migrateUpdate();await t}return this}migrateCreate(){return this.AB.Network.post({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}migrateUpdate(){return this.AB.Network.put({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}migrateDrop(){return this.AB.Network.delete({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}columnHeader(e){e=e||{};const t={id:this.columnName,header:this.label};return e.isObjectWorkspace&&this.settings.showIcon&&(t.header=`<span class="webix_icon fa fa-${this.fieldIcon()}"></span>${t.header}`),t}customDisplay(e,t,i,s){}customEdit(e,t,i){return!0}getValue(e,t){return e.getValue()}setValue(e,t,i){if(!e)return;let s;s=null!=t&&null!=t[this.columnName]||null==i?t&&null!=t[this.columnName]?t[this.columnName]:t:i,e.setValue(s)}formComponent(e){return{common:()=>({key:e}),newInstance:(e,t)=>{const i=this.formComponent().common();return i.settings=i.settings||{},i.settings.objectId=this.object.id,i.settings.fieldId=this.id,e.viewNew(i,e,t)}}}detailComponent(){return{common:()=>({icon:"square"}),newInstance:(e,t)=>{const i=this.detailComponent().common();return i.settings=i.settings||{},i.settings.objectId=this.object.id,i.settings.fieldId=this.id,e.viewNew(i,e,t)}}}}},9579:(e,t,i)=>{const s=i(6552);e.exports=class extends s{isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?"":this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},7280:(e,t,i)=>{const s=i(3104);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){e=e||{};const t=super.columnHeader(e);return t.editor="template",t.css="center",t.template=(t,i,s,a)=>t.$group?t[this.columnName]:e.editable?'<div class="ab-boolean-display">'+i.checkbox(t,i,s,a)+"</div>":s?"<div class='webix_icon fa fa-check-square-o'></div>":"<div class='webix_icon fa fa-square-o'></div>",t}formComponent(){return super.formComponent("checkbox")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailcheckbox"}),e}}},3088:(e,t,i)=>{const s=i(4562);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?e[this.columnName]:this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},9142:(e,t,i)=>{const s=i(3551);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?"":this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},6589:(e,t,i)=>{const s=i(6932);e.exports=class extends s{constructor(e,t,i){super(e,t,i)}async destroy(){if(!this.id)return Promise.resolve();if(await super.destroy(),!this.datasourceLink)return Promise.resolve();const e=this.fieldLink;return e?e.destroy():Promise.resolve()}pullRelationValues(e){let t=[];const i=super.pullRelationValues(e),s=this.datasourceLink;return i&&s&&(Array.isArray(i)?t=i.map((function(e){return e&&(e.text=e.text||s.displayData(e),e.value=e.text),e})):i.id||i.uuid?(t=i,t.text=t.text||s.displayData(t),t.value=t.text):"string"==typeof i&&(t={text:i})),t}columnHeader(e){e=e||{};const t=super.columnHeader(e),i=this;i.AB._App,null==e.filters&&(e.filters={});var s="many"==this.settings.linkType;return t.editor=s?"multiselect":"combo",t.editFormat=e=>this.editFormat(e),t.editParse=e=>this.editParse(e),t.template=t=>{var i=this.pullRelationValues(t),s=[];if(s.push('<div class="badgeContainer">'),i&&Array.isArray(i)&&i.length)i.forEach((e=>{s.push(`<div class='webix_multicombo_value'><span>${e.value}</span>\x3c!-- span data-uuid="${e.id}" class="webix_multicombo_delete" role="button" aria-label="Remove item"></span --\x3e</div>`)})),i.length>1&&s.push(`<span class="webix_badge selectivityBadge">${i.length}</span>`);else{if(!i.value)return"";{let t="";e.editable&&(t='<span class="webix_multicombo_delete clear-combo-value" role="button" aria-label="Remove item"></span>'),s.push(`<div class='webix_multicombo_value'>${t}<span class="ellip">${i.value}</span></div>`)}}return s.push("</div>"),s.join("")},t.suggest={on:{onBeforeShow:function(){i.openOptions(this)}},filter:({value:e},t)=>(e??"").toLowerCase().includes((t??"").toLowerCase())},s&&(t.suggest.view="checksuggest",t.suggest.button=!0),t}openOptions(e){const t=e.getList();(t?.find({})??[]).length||(["create","update"].forEach((e=>{this[`_dc_${e}_event`]||(this[`_dc_${e}_event`]=this.AB.on(`ab.datacollection.${e}`,(e=>{this.datasourceLink.id==e.objectId&&t.clearAll()})))})),this.getAndPopulateOptions(e))}customEdit(e,t,i){}formComponent(){return super.formComponent("connect")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailconnect"}),e}getOptions(e,t,i){return new Promise(((s,a)=>{let n=!1;const r=e=>{e=e.filter((e=>{if(e.text.toLowerCase().includes(t.toLowerCase()))return!0})),n?this.emit("option.data",e):(n=!0,s(e))};if(i=i||[],(e=e||{}).glue||(e.glue="and"),e.rules||(e.rules=[]),t=t||"",!this.settings.linkObject)return[];const o=this.datasourceLink;if(null==o)throw new Error("No linked object");const l=this.fieldLink;if(null==l)throw new Error("No linked column");const u=o.model();"many"==this.settings.linkType&&"one"==this.settings.linkViaType||"one"==this.settings.linkType&&"one"==this.settings.linkViaType&&(1==this.settings.isSource?e.rules.push({key:l.id,rule:"have_no_relation"}):e.rules.push({key:l.id,rule:"is_null"}));const c=`${this.id}-${JSON.stringify(e)}`;Promise.resolve().then((async()=>{const e=await this.AB.Storage.get(c);if(e)return this._options=e,r(this._options)})).then((async()=>{try{const t=await u.findAll({where:e,sort:i,populate:!1});return this._options=t.data||t||[],(this._options||[]).forEach((e=>{e.text=o.displayData(e),e.value=e.text})),this.AB.Storage.set(c,this._options),r(this._options)}catch(t){throw this.AB.notify.developer(t,{context:"ABFieldConnect:getOptions(): unable to retrieve options from server",field:this.toObj(),where:e}),n=!0,t}}))}))}editFormat(e){if(!e)return"";let t=[];if(Array.isArray(e))e.forEach((e=>{if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);t.push(i.id)}}));else if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);i&&i.id&&t.push(i.id)}return t.join()}editParse(e){if("many"==this.settings.linkType){if(e){let t=[];return e.split(",").forEach((e=>{t.push(this.getItemFromVal(e))})),t}return[]}return this.getItemFromVal(e)}getAndPopulateOptions(e,t,i,s){const a=e,n=t?.filters?Object.assign({},t.filters):{glue:"and",rules:[]};if(t?.filterByConnectValues){const e=(t,s,a=0)=>{const n=s.filter((e=>e.depth===a));return[...t.rules.map((t=>{if(t.glue)return{glue:t.glue,rules:e(t,s,a+1)};const r=n.filter((e=>e.key===t.key&&e.value===t.value))[0];if(!r)return t;const o=r?.filterValue?.config.id?$$(r.filterValue.config.id):null;if(!o)throw Error("Some parent field's view components don't exist");const l=r?.filterValue?o.getValue()??"":"";let u="";return l&&(u=r.filterColumn&&i.object.fieldByID(r.filterValue.config.dataFieldId).getItemFromVal(l)?i.object.fieldByID(r.filterValue.config.dataFieldId).getItemFromVal(l)[r.filterColumn]:l),{key:t.key,rule:"equals",value:u}}))]};n.rules=e(n,t.filterByConnectValues)}const r=e=>{this.populateOptions(a,e,i,s,!0)};this.removeListener("option.data",r).once("option.data",r),this.getOptions(n,"").then((e=>{this.populateOptions(a,e,i,s,!1)}))}populateOptions(e,t,i,s,a){e.blockEvent(),e.getList().clearAll(),e.getList().define("data",t),a&&this.populateOptionsDataCy(e,i,s),e.getValue&&e.getValue()&&e.setValue(e.getValue()),e.unblockEvent()}populateOptionsDataCy(e,t,i){if(e?.getList){if(!e.getPopup)return;var s=e.getPopup();if(!s)return;e.getList().data.each((e=>{if(e){var a=s.$view.querySelector("[webix_l_id='"+e.id+"']");a&&a.setAttribute("data-cy",`${t.key} options ${e.id} ${t.id} ${i.id}`)}}))}}getItemFromVal(e){let t,i=this._options||[];if(i.length>0){for(let s=0;s<i.length;s++){if(this.indexField&&i[s][this.indexField.object.PK()]==e){t=i[s];break}if(this.indexField2&&i[s][this.indexField2.object.PK()]==e){t=i[s];break}if(i[s].id==e){t=i[s];break}}return t}return""}getValue(e){if("many"==this.settings.linkType){let t=[];return e.getValue()&&e.getValue().split(",").forEach((i=>{t.push(e.getList().getItem(i))})),t}return e.getValue()?e.getList().getItem(e.getValue()):""}setValue(e,t){if(!e)return;let i=this.pullRelationValues(t);e.getList&&0==e.getList().count()&&("one"==this.settings.linkType||Array.isArray(i)||(i=[i]),e.getList().define("data",i)),e.define("value",i)}pullRecordRelationValues(e){var t=[],i=e,s=this.datasourceLink;return i&&s&&(Array.isArray(i)?t=i.map((function(e){return e&&(e.text=e.text||s.displayData(e),e.value=e.text),e})):(i.id||i.uuid)&&((t=i).text=t.text||s.displayData(t),t.value=t.text)),t}}},176:(e,t,i)=>{const s=i(6915);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor="date",t.editable=!0,t.template=e=>e.$group?e[this.columnName]:this.format(e),t.format=e=>{const t={};return t[this.columnName]=e,this.format(t)},t.editFormat=e=>""==e||null==e?"":this.AB.toDate(e),t}formComponent(){const e=super.formComponent("datepicker");return e.common=()=>({key:"datepicker"}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}dateToString(e,t){return webix.Date.dateToStr(e)(t)}format(e){if(!window.webixLocale)return super.format(e);const t=this.dataValue(e);if(""==t||null==t)return"";const i=this.AB.toDate(t);return this.settings.dateFormat>=4?webix.i18n.longDateFormatStr(i):webix.i18n.dateFormatStr(i)}}},1747:(e,t,i)=>{const s=i(6926);e.exports=class extends s{constructor(e,t){super(e,t)}columnHeader(e){const t=super.columnHeader(e);return 1==this.settings.dateFormat?t.editor="time":t.editor="datetime",t.editable=!0,t.template=e=>e.$group?e[this.columnName]:this.format(e),t.format=e=>{const t={};return t[this.columnName]=e,this.format(t)},t.editFormat=e=>""==e||null==e?"":this.AB.toDate(e),t}formComponent(){const e=super.formComponent("datepicker");return e.common=()=>({key:"datepicker"}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}format(e){if(!window.webixLocale)return super.format(e);const t=this.dataValue(e);if(""==t||null==t)return"";const i=this.AB.toDate(t),s=this.settings.dateFormat,a=webix.Date.dateToStr(this.getTimeFormat());return s>=4?`${webix.i18n.longDateFormatStr(i)} ${a(i)}`:`${webix.i18n.dateFormatStr(i)} ${a(i)}`}}},9137:(e,t,i)=>{const s=i(6945);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t}formComponent(){const e=super.formComponent();return e.common=()=>({key:"textbox",settings:{type:"single"}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},2597:(e,t,i)=>{const s=i(5019),a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}async destroy(){return new Promise(((e,t)=>{this.id?webix.confirm({title:a("Keep Files?"),message:a("Do you want to keep the files referenced by {0}?",[this.label]),callback:async i=>{this.settings.removeExistingData=i?0:1;try{await this.save(),webix.alert({title:"!! TODO !!",text:"Tell a Developer to actually pay attention to this!"}),await super.destroy(),e()}catch(e){t(e)}}}):e()}))}columnHeader(e){e=e||{};const t=super.columnHeader(e);t.editor=!1;const i=e.editable;return t.template=e=>e.$group?this.dataValue(e):['<div class="ab-file-data-field" style="float: left;">','<div class="webix_view ab-file-holder">','<div class="webix_template">',this.fileTemplate(e,i),"</div>","</div>","</div>"].join(""),t}customDisplay(e,t,i,s){if(!i)return;s=s||{};let n=[],r=0;this.settings.limitFileType&&this.settings.fileType&&(n=this.settings.fileType.split(",")),this.settings.limitFileSize&&this.settings.fileSize&&(r=this.settings.fileSize);const o=i.querySelector(".ab-file-holder");if(o){o.innerHTML="";const t=webix.ui({view:"template",container:o,template:this.fileTemplate(e,s.editable),borderless:!0,width:160,height:60});if(webix.extend(t,webix.ProgressBar),!s.editable){const e=o.querySelector(".delete-image");return void(e&&(e.style.display="none"))}const l=this.urlUpload(!0),u=webix.ui({view:"uploader",apiOnly:!0,upload:l,inputName:"file",multiple:!1,on:{onBeforeFileAdd:function(e){i.classList.remove("webix_invalid"),i.classList.remove("webix_invalid_cell");const s=n;if(s&&""!=s){const t=e.type.toLowerCase();if(-1==s.indexOf(t))return webix.message(a("Only [{0}] files are supported",[s.join(", ")])),!1}if(r>0){const t=1e6*r;if(e.size>t)return webix.message(a("Maximum file size is {0}MB",[r])),!1}t.showProgress({type:"icon",delay:2e3})},onFileUpload:async(s,a)=>{t.hideProgress();const n={};if(n[this.columnName]={},n[this.columnName].uuid=a.data.uuid,n[this.columnName].filename=s.name,e.id)try{await this.object.model().update(e.id,n),$$(i)&&$$(i).updateItem&&$$(i).updateItem(e.id,n)}catch(t){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{context:"ABFieldFile.onFileUpload(): Error updating our entry.",row:e,values:n})}this.setValue($$(i),n)},onFileUploadError:(e,i)=>{this.AB.notify.developer(new Error("Error loading file"),{message:"Error loading file",response:i}),t.hideProgress()}}});u.addDropZone(t.$view),i.dataset.uploaderId=u.config.id,i.addEventListener("click",(e=>{e.target.className.indexOf("delete-image")>-1&&(this.deleteFile=!0)}))}}customEdit(e,t,i){if(1==this.deleteFile)delete this.deleteFile,webix.confirm({title:"",message:a("Are you sure you want to remove this file?"),callback:async t=>{if(!!t){const t={};if(t[this.columnName]="",e.id)try{await this.object.model().update(e.id,t),$$(i)&&$$(i).updateItem&&$$(i).updateItem(e.id,t)}catch(s){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(s,{message:"Error updating our entry.",row:e,values:t})}else this.setValue($$(i),t)}}});else{const t=this.dataValue(e);if(!t||!t.uuid){const t=i.dataset.uploaderId,s=$$(t);s&&s.fileDialog&&s.fileDialog({rowid:e.id})}}return!1}formComponent(){return super.formComponent("fieldcustom")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailcustom"}),e}fileTemplate(e,t){let i="",s="display:none;",n="",r="",o="";const l=this.dataValue(e);return l&&(r=l.uuid,o=l.filename),r&&o&&(i="display:none;",s="",n="/file/"+r),[`<div class="file-data-field-icon" style="text-align: center; height: inherit; display: table-cell; vertical-align: middle; border: 2px dotted #CCC; background: #FFF; border-radius: 10px; font-size: 11px; line-height: 13px; padding: 0 10px; ${i}"><i class="fa fa-file fa-2x" style="opacity: 0.6; font-size: 32px; margin-top: 3px; margin-bottom: 5px;"></i>${t?`<br/>${a("Drag and drop or click here")}`:""}</div>`,`<div class="file-data-field-name" style=" width:100%; height:100%; position:relative; "><a target="_blank" href="${n}">${o||""}</a>${t?`<a style="${s}" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image"></i></a>`:""}</div>`].join("")}getValue(e,t){const i=e.$view.querySelector(".file-data-field-name"),s=i.querySelector("a");return{uuid:i.getAttribute("file-uuid"),filename:s.innerHTML}}setValue(e,t){if(!e)return;const i=e.$view;if(!i)return;let s=null;t&&(s=this.dataValue(t));const a=i.querySelector(".file-data-field-icon");a&&(a.style.display=s&&s.uuid?"none":"block");const n=i.querySelector(".file-data-field-name");if(n){const e=n.querySelector(".ab-delete-photo");e&&(e.style.display=s&&s.uuid?"block":"none"),n.style.display=s&&s.uuid?"block":"none",s&&s.uuid?n.setAttribute("file-uuid",s.uuid):n.removeAttribute("file-uuid");const t=n.querySelector("a"),i="/file/"+(s?s.uuid:"");t.href=i,t.innerHTML=s?s.filename:""}}urlUpload(e=!0){return`/file/upload/${this.object.id}/${this.id}/${e?"1":"0"}`}}},8439:(e,t,i)=>{const s=i(8725);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?e[this.columnName]:this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},780:(e,t,i)=>{const s=i(4342),a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t)}async destroy(){return new Promise(((e,t)=>{this.id?webix.confirm({title:a("Keep Images?"),message:a("Do you want to keep the images referenced by {0}?",[this.label]),callback:async i=>{this.settings.removeExistingData=i?0:1;try{await this.save(),webix.alert({title:"!! TODO !!",text:"ABFieldImage.destroy(): Tell a Developer to actually pay attention to this!"}),await super.destroy(),e()}catch(e){t(e)}}}):e()}))}idCustomContainer(e,t){return t?`${this.columnName.replace(/ /g,"_")}-${t}-image`:`${this.columnName.replace(/ /g,"_")}-${e.id}-image`}columnHeader(e){e=e||{};const t=super.columnHeader(e),i=this;t.editor=!1;let s="100%",a="100%",n="100%",r="100%";if(i.settings.useWidth){t.width=i.settings.imageWidth||100;const e=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight+20:80;s=`${e}px`,n=`${i.settings.imageWidth||100}px`,a=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight:80,a=`${a}px`,r=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight:60,r=`${r}px`}else e.width&&(t.width=e.width||100,n=`${e.width||100}px`,a=e.width,a=`${a}px`,r=e.width,r=`${r}px`);i.settings.useHeight&&i.settings.imageHeight&&"NaN"!=i.settings.imageHeight&&(t.height=i.settings.imageHeight||0,s=parseInt(t.height)+20,s=`${s}px`,a=parseInt(t.height),a=`${a}px`,r=parseInt(t.height),r=`${r}px`);const o=e.editable;return t.template=e=>e.$group?e[this.columnName]:[`<div class="ab-image-data-field" style="float: left; width: ${n}; height: ${s}">`,`<div class="webix_view ab-image-holder" style="width: ${n}; height: ${a}">`,'<div class="webix_template">',this.imageTemplate(e,{editable:o,height:r,width:n}),"</div>","</div>","</div>"].join(""),t}customDisplay(e,t,i,s){if(!i)return;const a=t.Label;s=s||{},t.unique(this.idCustomContainer(e,s.formId));const n=i.querySelector(".ab-image-holder");if(n){n.innerHTML="";let t=0;this.settings.useHeight&&(t=parseInt(this.settings.imageHeight)||t);let r=0;this.settings.useWidth&&(r=parseInt(this.settings.imageWidth)||r),s.height&&(t=s.height),s.width&&(r=s.width);const o=webix.ui({view:"template",css:"ab-image-holder",container:n,template:this.imageTemplate(e,{editable:s.editable,height:t?t+"px":0,width:r?r+"px":0}),borderless:!0,height:t,width:r});if(webix.extend(o,webix.ProgressBar),!s.editable){const e=n.querySelector(".delete-image");return void(e&&(e.style.display="none"))}const l=this.urlUpload(),u=webix.ui({view:"uploader",apiOnly:!0,upload:l,inputName:"file",multiple:!1,on:{onBeforeFileAdd:function(e){i.classList.remove("webix_invalid"),i.classList.remove("webix_invalid_cell");const t=["jpg","jpeg","bmp","png","gif"],s=e.type.toLowerCase();if(-1==t.indexOf(s))return webix.message(a("Only [{0}] images are supported",[t.join(", ")])),!1;o.showProgress({type:"icon",delay:2e3})},onFileUpload:async(t,s)=>{o.hideProgress(),this.showImage(s.data.uuid,i);const a={};if(a[this.columnName]=s.data.uuid,e.id)try{if(await this.object.model().update(e.id,a),$$(i)&&$$(i).getItem&&$$(i).getItem(e.id))$$(i).updateItem(e.id,a);else{const t=document.querySelector(".webix_dtable");$$(t)&&$$(t).getItem(e.id)&&$$(t).updateItem(e.id,a)}}catch(t){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{context:"ABFieldImage.onFileUpload(): model.update(): error updating our entry",field:this,row:e,values:a})}this.setValue($$(i),a)},onFileUploadError:(e,t)=>{this.AB.notify.developer(new Error("Error uploading image"),{context:"ABFieldImage. uploader. onFileUploadError():",field:this,response:t}),o.hideProgress()}}});u.addDropZone(o.$view),i.dataset.uploaderId=u.config.id,"webix_cell"==i.className&&i.addEventListener("click",(e=>{e.target.className.indexOf("delete-image")>-1&&(this.deleteImage=!0)}))}}customEdit(e,t,i,s,n){if(n&&n.target.className.indexOf("delete-image")>-1||this.deleteImage)delete this.deleteImage,e.removeDefaultImage||(e.removeDefaultImage=[]),e.removeDefaultImage[this.columnName]=!0,webix.confirm({title:a("Are you sure you want to remove this image?"),callback:async t=>{if(!!t){const t={};t[this.columnName]="";try{await this.object.model().update(e.id,t),$$(i)&&$$(i).updateItem&&$$(i).updateItem(e.id,t),this.setValue($$(i),t)}catch(s){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(s,{context:"ABFieldImage: customEdit(): Error updating our entry",field:this,row:e,values:t})}}}});else{const t=i.dataset.uploaderId,s=$$(t);s&&s.fileDialog&&s.fileDialog({rowid:e.id})}return!1}formComponent(){return super.formComponent("fieldcustom")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailimage"}),e}imageTemplate(e,t){(t=t||{}).height=t.height||"100%",t.width=t.width||"100%";let i="",s="display:none;",n="",r="",o=!1;e[this.columnName]&&(r=e[this.columnName]),e.removeDefaultImage&&e.removeDefaultImage[this.columnName]&&(o=e.removeDefaultImage[this.columnName]),r?(i="display:none;",s="",n=`background-image:url('${this.urlImage(r)}');`):this.settings.useDefaultImage&&!o&&(i="display:none;",s="",n=`background-image:url('${this.urlImage(this.settings.defaultImageUrl)}');`);let l=[`<div class="image-data-field-icon" style="${i}">#drag#</div><div class="image-data-field-image" style="${s} width:${t.width}; height:${t.height}; ${n}">#remove#</div>`].join("");return l=l.replace("#drag#",t.editable?`<div>${a("Drag and drop or click here")}</div>`:""),l=l.replace("#remove#",t.editable?`<a style="${s}" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image"></i></a>`:""),l}showImage(e,t){const i=t.querySelector(".ab-image-holder");if(i){i.querySelector(".image-data-field-icon").style.display="none";const t=i.querySelector(".image-data-field-image");t.style.display="",t.style.backgroundImage=`url('${this.urlImage(e)}')`,t.setAttribute("image-uuid",e)}}getValue(e,t){return e.$view.querySelector(".image-data-field-image").getAttribute("image-uuid")}setValue(e,t){if(!e)return;const i=e.$view;if(!i)return;let s=null;t&&(s=this.dataValue(t));const a=i.querySelector(".image-data-field-icon");a&&(a.style.display=s?"none":"");const n=i.querySelector(".image-data-field-image");if(n){const e=n.querySelector(".ab-delete-photo");e&&(e.style.display=s?"block":"none"),n.style.display=s?"block":"none",s?(n.style.backgroundImage=`url('${this.urlImage(s)}')`,n.setAttribute("image-uuid",s)):n.removeAttribute("image-uuid")}}toBase64(e){return new Promise(((t,i)=>{if(!e[this.columnName])return t(null);const s=new Image;s.crossOrigin="Anonymous",s.onerror=function(e){i(e)},s.onload=function(){const e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0);const i={data:e.toDataURL(),width:s.width,height:s.height};t(i)},s.src=this.urlImage(e[this.columnName])}))}urlImage(e){return`/file/${e}`}urlUpload(e=!0){return`/file/upload/${this.object.id}/${this.id}/${e?"1":"0"}`}}},1797:(e,t,i)=>{const s=i(6611);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t.css="textCell",t.template=()=>"",t}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},9319:(e,t,i)=>{const s=i(8472);e.exports=class extends s{constructor(e,t){super(e,t)}save(){return super.save().then((()=>{if(this.pendingDeletions.length){const e=this.object.model();if(1==this.settings.isMultiple)return new Promise(((t,i)=>{let s=0,a=0;e.findAll({}).then((i=>{(i=i.data||i).forEach((i=>{if(Array.isArray(i[this.columnName])){let n=i[this.columnName].filter((e=>-1==this.pendingDeletions.indexOf(e.id)));if(n.length!=i[this.columnName].length){a++,0==n.length&&(n="");const r={};r[this.columnName]=n,e.update(i.id,r).then((()=>{s++,s>=a&&t()}))}}})),0==a&&t()})).catch(i)}));{const t={};return t[this.columnName]=this.pendingDeletions,new Promise(((i,s)=>{let a=0;e.findAll(t).then((t=>{t=t.data||t;const s={};s[this.columnName]="",t.forEach((n=>{e.update(n.id,s).then((()=>{a++,a>=t.length&&i()}))})),0==t.length&&i()})).catch(s)}))}}}))}isValid(){return super.isValid()}columnHeader(e){e=e||{};const t=super.columnHeader(e);return this.AB._App,e.editable&&((...e)=>{AB.Multilingual.label(...e)})("Select item"),e.editable&&this.settings.required,t.editFormat=e=>this.editFormat(e),t.editParse=e=>this.editParse(e),t.template=t=>{let i=t[this.columnName];if(null==i)return"";this.settings.isMultiple&&(i=function(e,t={}){let i=[];return null!=t[e.columnName]&&(i=t[e.columnName],"string"==typeof i&&(i=JSON.parse(i)),e.settings&&(i=(e.settings.options||[]).filter((e=>(i||[]).filter((t=>(e.id||e)==(t.id||t))).length>0)))),i}(this,t));var s=[];s.push('<div class="badgeContainer">');let a="",n="";if(i&&Array.isArray(i)&&i.length)i.forEach((e=>{this.settings.hasColors&&e.hex&&(a="hascustomcolor",n=`background: ${e.hex};`),e.text&&s.push(`<div style="${n}" class='webix_multicombo_value ${a}'><span>${e.text}</span>\x3c!-- span data-uuid="${e.id}" class="webix_multicombo_delete" role="button" aria-label="Remove item"></span --\x3e</div>`)})),i.length>1&&s.push(`<span class="webix_badge selectivityBadge">${i.length}</span>`);else{if(!i)return"";{let t=i;if("string"==typeof i&&(t=this.getItemFromVal(i)),!t)return"";if(this.settings.hasColors&&t.hex&&(a="hascustomcolor",n=`background: ${t.hex};`),t.text){let i="";e.editable&&!this.settings.required&&(i='<span class="webix_multicombo_delete clear-combo-value" role="button" aria-label="Remove item"></span>'),s.push(`<div style="${n}" class='webix_multicombo_value ${a}'>${i}<span class="ellip">${t.text}</span></div>`)}}}return s.push("</div>"),s.join("")},t.editor=this.settings.isMultiple?"multiselect":"combo",t.suggest={button:!0,data:this.settings.options.map((function(e){return{id:e.id,value:e.text,hex:e.hex}}))},this.settings.isMultiple&&(t.suggest.view="checksuggest"),t}customDisplay(e,t,i,s){if(i&&(s=s||{},i.querySelector)){var a=i.querySelector(".selectivity-single-selected-item-remove");a&&a.addEventListener("click",(t=>{t.stopPropagation();var s={};s[this.columnName]="",this.object.model().update(e.id,s).then((()=>{$$(i)?.updateItem?.(e.id,s)})).catch((t=>{i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{message:"Error updating our entry.",row:e,values:"",field:this.toObj()})}))}))}}formComponent(){const e=super.formComponent();return e.common=()=>({key:this.settings.isMultiple?"selectmultiple":"selectsingle",settings:{options:this.settings.options.map((function(e){return{id:e.id,value:e.text,hex:e.hex}}))}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:(this.settings.isMultiple,"detailtext")}),e}editFormat(e){if(!e)return"";let t=[];if(Array.isArray(e))e.forEach((e=>{if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);t.push(i.id)}}));else if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);i&&i.id&&t.push(i.id)}return t.join()}editParse(e){if(this.settings.isMultiple){let t=[];return e.split(",").forEach((e=>{t.push(this.getItemFromVal(e))})),t}return e}getItemFromVal(e){let t,i=this.options();return i.length>1?(i.forEach((i=>{if(i.id==e)return t=i,!1})),t):""}getValue(e,t){return this.editParse(e.getValue())}getSelectedOptions(e,t={}){let i=[];return null!=t[this.columnName]?i=t[this.columnName]:t&&(Array.isArray(t)?i=t:i.push(t)),i.length&&("string"==typeof i&&(i=JSON.parse(i)),this.settings&&(i=(this.settings.options||[]).filter((e=>(i||[]).filter((t=>(e.id||e)==(t.id||t))).length>0)))),i}setValue(e,t){e&&(this.settings.isMultiple||super.setValue(e,t))}}},4384:(e,t,i)=>{const s=i(7143);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t.template=(e,t,i,s,a)=>(i||"").toString().replace(/[<]/g,"&lt;"),t}formComponent(){const e=super.formComponent();return e.common=()=>({key:"textbox",settings:{type:"multiple"}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}setValue(e,t){super.setValue(e,t,"")}}},1812:(e,t,i)=>{const s=i(9671);let a=!1;e.exports=class extends s{constructor(e,t){a||(webix.editors.number=webix.extend({},webix.editors.text),a=!0),super(e,t)}columnHeader(e){const t=super.columnHeader(e);return t.editor="number",t.format=e=>{const t={};return t[this.columnName]=e,this.format(t)},t}formComponent(){return super.formComponent("numberbox")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},7038:(e,t,i)=>{const s=i(4403),a={allowClear:!0,removeOnly:!1,readOnly:!1,showDropdown:!0,placeholder:"",multiple:!1},n={key:"selectivity"};e.exports=class extends s{constructor(e,t,i=n){super(e,t,i)}static defaults(){return{key:"selectivity",icon:"bars",menuName:"",description:""}}selectivityRender(e,t,i,s){if(null==e)return;const n=t.dataCy||"";e.setAttribute("data-cy",n),t=t||{};for(const e in a)null===t[e]?t[e]=null:t[e]=t[e]||a[e];if(t.multiple&&t.items&&t.data&&t.data.length?(t.data.forEach((function(e){t.items.map((function(t){t.id==e.id&&(e.hex=t.hex)}))})),t.data=this.prepareData(t.data,t.multiple)):null==t.data||""==t.data?t.data=this.prepareData([],t.multiple):t.data=this.prepareData(t.data,t.multiple),t.field=this.id,null!=e.selectivity)return void e.selectivity.setOptions(t);let r;if(t.element=e,t.multiple?(t.isUsers?t.templates={multipleSelectedItem:function(e){return`<span class="selectivity-multiple-selected-item ${e.highlighted?" highlighted":""}"\n\t\t\t\t\t\t\t\tstyle="background-color: #eee !important; color: #666 !important; box-shadow: inset 0px 1px 1px #333;"\n\t\t\t\t\t\t\t\tdata-item-id="${e.uuid}" data-field-id="${t.field}">\n\t\t\t\t\t\t\t\t<i class="fa fa-user" style="color: #666; opacity: 0.6;"></i> \n                        ${t.additionalText?t.additionalText(e):""}\n\t\t\t\t\t\t\t\t${t.isLabelHidden?"":e.text}\n\t\t\t\t\t\t\t\t${e.removable?' <a class="selectivity-multiple-selected-item-remove" style="color: #333;"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t\t</span>`}}:t.templates={multipleSelectedItem:function(e){return`<span class="selectivity-multiple-selected-item ${e.highlighted?" highlighted":""}"\n\t\t\t\t\t\t\t\tstyle="background-color: ${e.hex} !important;"\n\t\t\t\t\t\t\t\tdata-item-id="${e.uuid}" data-field-id="${t.field}">\n                        ${t.editPage?' <a class="selectivity-multiple-selected-item-edit"><i class="fa fa-edit"></i></a>':""}\n                        ${t.additionalText?t.additionalText(e):""}\n                        ${t.isLabelHidden?"":e.text}\n                        ${e.removable?' <a class="selectivity-multiple-selected-item-remove"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t\t</span>`}},r=new Selectivity.Inputs.Multiple(t),e.selectivity=r,this.selectivitySetBadge(e,i,s)):(t.templates={singleSelectedItem:function(e){return`<span class="selectivity-single-selected-item" data-item-id="${e.uuid}" data-field-id="${t.field}">\n\t\t\t\t\t\t\t${t.editPage?'<a class="selectivity-single-selected-item-edit"><i class="fa fa-edit"></i></a>':""}\n                     ${t.additionalText?t.additionalText(e):""}\n                     ${t.isLabelHidden?"":e.text}\n                     ${e.removable?'<a class="selectivity-single-selected-item-remove"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t</span>`}},r=new Selectivity.Inputs.Single(t),e.selectivity=r),t.editPage){const t=()=>{const e=this,t=document.querySelectorAll(".selectivity-single-selected-item-edit, .selectivity-multiple-selected-item-edit");for(let i=0;i<t.length;i++){const s=t[i];s&&!s.__hasClickEvent&&(s.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault();const i=this.parentElement;if(!i)return;const s=i.getAttribute("data-item-id");if(!s)return;const a=i.getAttribute("data-field-id");if(!a)return;const n=e.object.fieldByID(a);n&&n.emit("editPage",s)}),!0),s.__hasClickEvent=!0)}};setTimeout((()=>{t(),e.addEventListener("change",(()=>{t()}))}),500)}if(t.readOnly){const t=e.getElementsByClassName("selectivity-caret");for(let e=0;e<t.length;e++){const i=t[e];i&&i.parentNode.removeChild(i)}}this.selectivitySettings=t}selectivityGet(e){return e&&e.selectivity?this.selectivitySettings&&this.selectivitySettings.multiple?e.selectivity.getData()||[]:e.selectivity.getData()||null:this.selectivitySettings&&this.selectivitySettings.multiple?[]:null}selectivitySet(e,t){e&&e.selectivity&&(t=this.prepareData(t,e.selectivity.options.multiple),Array.isArray(t)&&t[0]||t&&t.id?e.selectivity.setData(t):e.selectivity.clear())}selectivityDestroy(e){e&&e.selectivity&&(e.selectivity.destroy(),delete e.selectivity)}prepareData(e,t=!0){if(!e&&t)return[];if(t&&e&&Array.isArray(e)&&0==e.length)return[];if(!t&&e&&Array.isArray(e)&&0==e.length)return null;if(!e&&!t)return null;if("string"==typeof e&&e.length>0)try{e=JSON.parse(e)}catch(t){e={id:e,text:e}}return!t&&Array.isArray(e)?e=e[0]:t&&!Array.isArray(e)&&(e=[e]),t?e.forEach((e=>{!e.id&&e.uuid&&(e.id=e.uuid)})):!e.id&&e.uuid&&(e.id=e.uuid),null==e&&t&&(e=[]),e}selectivitySetBadge(e){if(e.clientHeight&&e.clientHeight-e.parentElement.clientHeight>5){let t=0,i=[];if(e&&e.selectivity&&(i=e.selectivity.getValue()||[]),t=i.length,t>1){const i=e.querySelector(".webix_badge.selectivityBadge");if(null!=i)i.innerHTML=t;else{const i=document.createElement("A");i.href="javascript:void(0);";const s=document.createElement("SPAN"),a=document.createTextNode(t);s.classList.add("webix_badge","selectivityBadge"),s.appendChild(a),i.appendChild(s),e.appendChild(i)}}}}}},8134:(e,t,i)=>{const s=i(6756);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t.css="textCell",t.template=(e,t,i)=>e.$group?"":(i||"").toString().replace(/[<]/g,"&lt;"),t}defaultValue(e){e[this.columnName]||this.settings.default&&(this.settings.default.indexOf("{uuid}")>=0?e[this.columnName]=this.AB.uuid():e[this.columnName]=this.settings.default)}isValidData(e,t){if(super.isValidData(e,t),e&&e[this.columnName]){const i=this.constructor.defaults().MAX_CHAR_LENGTH;if(e[this.columnName].length>i){const e=this.AB.Label();t.addError(this.columnName,e("should NOT be longer than {0} characters",[i]))}}}get isMultilingual(){return 1==this.settings.supportMultilingual}formComponent(){const e=super.formComponent();return e.common=()=>({key:"textbox",settings:{type:"single"}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}setValue(e,t){super.setValue(e,t,"")}}},7238:(e,t,i)=>{const s=i(8585);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?"":this.format(e),t}customDisplay(){}formComponent(){return null}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},779:(e,t,i)=>{const s=i(8630),a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{idCustomContainer(e){return"#columnName#-#id#-tree".replace("#id#",e.id).replace("#columnName#",this.columnName.replace(/ /g,"_"))}columnHeader(e){e=e||{};const t=super.columnHeader(e),i=this;let s="",n="";e.isForm&&(s=" form-entry",n="<span style='color: #CCC; padding: 0 5px;'>"+a("Select items")+"</span>");const r=e.width;return t.template=e=>{if(e.$group)return e[i.columnName];const t=[];let a=this.AB.cloneDeep(i.settings.options);a=new webix.TreeCollection({data:a});let o=e;null!=e[i.columnName]&&(o=e[i.columnName]),a.data.each((function(e){if(void 0!==o.indexOf&&-1!=o.indexOf(e.id)){let i="",s=e.id;for(;this.getParentId(s);)a.data.each((function(e){a.data.getParentId(s)==e.id&&(i=e.text+": "+i)})),s=this.getParentId(s);i+=e.text,t.push(i)}}));let l="";return l+="<div class='list-data-values'>",0==t.length?l+=n:t.forEach((function(e){l+='<span class="selectivity-multiple-selected-item rendered" style="background-color:#4CAF50 !important;">'+e+"</span>"})),l+="</div>",r?'<div style="margin-left: '+r+'px;" class="list-data-values'+s+'">'+l+"</div>":'<div class="list-data-values'+s+'">'+l+"</div>"},t}customDisplay(e,t,i,s){if(!i)return;const n=this;if((s=s||{}).isForm){if(!e||0==e.length)return void(i.innerHTML="<div class='list-data-values form-entry'><span style='color: #CCC; padding: 0 5px;'>"+a("Select items")+"</span></div>");const t=[];s=this.AB.cloneDeep(n.settings.options),s=new webix.TreeCollection({data:s});let r=e;null!=e[n.columnName]&&(r=e[n.columnName]),s.data.each((function(e){if(void 0!==r.indexOf&&-1!=r.indexOf(e.id)){let i="",a=e.id;for(;this.getParentId(a);)s.data.each((function(e){s.data.getParentId(a)==e.id&&(i=e.text+": "+i)})),a=this.getParentId(a);i+=e.text,t.push(i)}}));const o="#4CAF50";let l="";l+="<div class='list-data-values form-entry'>",t.forEach((function(e){l+='<span class="selectivity-multiple-selected-item rendered" style="background-color:'+o+' !important;">'+e+"</span>"})),l+="</div>",i.innerHTML=l}n.setBadge(i,t,e)}customEdit(e,t,i,s){const a=t.unique(this.idCustomContainer(e)),n=`${a}-popup`,r=`${a}-tree`,o=$$(i),l=this,u=s;let c={},d=!0;function h(e,t){c=function(e,t){let i={};return void 0!==e&&void 0!==e.columnName&&void 0!==t[e.columnName]&&(i=t[e.columnName]),i}(e,t),$$(r).blockEvent();const i=e.AB.cloneDeep(e.settings.options);$$(r).clearAll(),$$(r).parse(i),$$(r).refresh(),$$(r).uncheckAll(),$$(r).openAll(),null!=c&&c.length&&c.forEach((function(e){$$(r).exists(e)&&($$(r).checkItem(e),$$(r).getItemNode(e).classList.add("selected"))})),$$(r).unblockEvent()}return $$(n)?($$(n).show(),h(this,e)):webix.ui({id:n,view:"popup",width:500,height:400,on:{onShow:()=>{1==d&&h(this,e),d=!1}},body:{id:r,view:"tree",css:"ab-data-tree",template:function(e,t){return"<label>"+t.checkbox(e,t)+"&nbsp;"+e.text+"</label>"},on:{onItemCheck:async function(t,s,a){const n=this.getItemNode(t),c=this;if(1==s?n.classList.add("selected"):n.classList.remove("selected"),this.getParentId(t)){c.blockEvent();let e=t;for(;this.getParentId(e);)e=this.getParentId(e),e!=t&&c.uncheckItem(e);this.data.eachSubItem(e,(function(e){e.id!=t&&c.uncheckItem(e.id)})),c.unblockEvent()}else c.blockEvent(),this.data.eachSubItem(t,(function(e){e.id!=t&&c.uncheckItem(e.id)})),c.unblockEvent();const d={};if(d[l.columnName]=$$(r).getChecked(),e.id){0==d[l.columnName].length&&(d[l.columnName]="");try{await l.object.model().update(e.id,d),o&&o.updateItem&&o.updateItem(e.id,d)}catch(t){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{message:"Error updating our entry.",row:e,values:d})}}else{const e={};e[l.columnName]=$$(r).getChecked(),l.setValue($$(u.ui.id),e)}}}}}).show(i,{x:-7}),!1}setBadge(e,t){const i=this;if((e=e.querySelector(".list-data-values")).scrollHeight-e.parentElement.clientHeight>5){let s=0;if(s=t[i.columnName]&&t[i.columnName].length?t[i.columnName].length:0,s>1){const t=e.querySelector(".webix_badge.selectivityBadge");if(null!=t)t.innerHTML=s;else{const t=document.createElement("A");t.href="javascript:void(0);",t.addEventListener("click",(function(e){e.stopPropagation()}));const i=document.createElement("SPAN"),a=document.createTextNode(s);i.classList.add("webix_badge","selectivityBadge"),i.appendChild(a),t.appendChild(i),e.appendChild(t)}}}}formComponent(){return super.formComponent("formtree")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtree"}),e}getValue(e,t){let i={};return i=e.getValues(),i}setValue(e,t){if(!e)return!1;const i=t[this.columnName]||[];e.setValues(i);const s=e.$view.querySelector(".list-data-values");if(!s)return!1;this.customDisplay(i,this.App,s,{editable:!0,isForm:!0}),setTimeout((function(){let t=33;s.scrollHeight>33&&(t=s.scrollHeight),e.config.height=t+5,e.resize()}),200)}}},9333:(e,t,i)=>{const s=i(6932),a=i(8665);e.exports=class extends a{constructor(e,t,i){super(e,t,i)}async save(){if(null==this.id){const e=this.AB.objectUser(),t=a.defaults();this.settings.linkObject=e.id,this.settings.isCustomFK=1,this.settings.isMultiple?(this.settings.indexField2=t.USERNAME_FIELD_ID,this.settings.linkType="many",this.settings.linkViaType="many",this.settings.isSource=1):(this.settings.indexField=t.USERNAME_FIELD_ID,this.settings.linkType="one",this.settings.linkViaType="many",this.settings.isSource=1);const i=e.fieldNew({key:s.defaults().key,columnName:`${this.object.name}_${this.label}`,label:this.object.label,settings:{showIcon:this.settings.showIcon,linkObject:this.object.id,linkType:this.settings.linkViaType,linkViaType:this.settings.linkType,isCustomFK:this.settings.isCustomFK,indexField:this.settings.indexField,indexField2:this.settings.indexField2,isSource:0}});let n=await this.toDefinition().save();this.id=n.id,i.settings.linkColumn=this.id;let r=await i.toDefinition().save();return i.id=r.id,this.settings.linkColumn=i.id,await this.toDefinition().save(),await this.object.fieldAdd(this),await e.fieldAdd(i),await this.migrateCreate(),await i.migrateCreate(),this}return super.save()}columnHeader(e){return e=this.setDisplayOptions(e),super.columnHeader(e)}setDisplayOptions(e){return(e=e||{}).editable=null==this.settings.editable||this.settings.editable,e.isLabelHidden=null!=this.settings.isShowUsername&&!this.settings.isShowUsername,e.additionalText=e=>this.settings.isShowProfileImage?e.image_id?`<img src='/opsportal/image/UserProfile/${e.image_id}' style='border-radius:100%; object-fit: cover; margin: 0 5px 0 -10px;' width='28' height='28' />`:'<i style="opacity: 0.6;" class="fa fa-user"></i> ':"",e}defaultValue(e){this.settings.isCurrentUser&&(this.settings.isMultiple?e[this.columnName]=[{id:this.AB.Account.username(),text:this.AB.Account.username()}]:e[this.columnName]=this.AB.Account.username())}setValue(e,t){let i=t[this.columnName];"ab-current-user"==i&&(i=this.AB.Account.username()),t[this.columnName]=i,super.setValue(e,t)}getUsers(){return this.AB.Account.userList().map((e=>{const t={id:e.username,image:e.image_id};return this.settings.isMultiple?t.text=e.username:t.value=e.username,t}))}}},144:(e,t,i)=>{var s=i(2418);e.exports=class extends s{transferParticipantWhereToMe(e){var t=this.process.elementForDiagramID(e);t&&!this.stashed&&t.stashed&&["stashed","useRole","role","useAccount","account"].forEach((e=>{var i=this[e];this[e]=t[e],t[e]=i}))}fromElement(e){this.diagramID=e.id||this.diagramID,e.children&&e.children.length>0?e.parent&&"bpmn:Participant"==e.parent.type&&this.transferParticipantWhereToMe(e.parent.id):e.parent&&e.parent.children&&e.parent.children.length>0&&e.parent.children.forEach((t=>{if("bpmn:Lane"!=t.type&&t.businessObject.lanes&&t.businessObject.lanes.length>0&&t.businessObject.lanes.find((e=>e.id==this.diagramID))){this.transferParticipantWhereToMe(e.parent.id);var i=this.process.elementForDiagramID(t.id);i&&i.setLane(this)}})),this.onChange(e)}onChange(e){e.businessObject.name&&""!=e.businessObject.name&&(this.label=e.businessObject.name)}}},7692:(e,t,i)=>{var s=i(2957);const a=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends s{fromElement(e){this.diagramID=e.id||this.diagramID,this.onChange(e)}onChange(e){if(e.businessObject.name&&""!=e.businessObject.name&&(this.label=e.businessObject.name),e.children){var t=[];e.children.forEach((e=>{"bpmn:Lane"==e.type&&t.push(e.id)})),this.laneIDs=t}}diagramProperties(){return[{id:this.diagramID,def:{name:this.name}}]}propertiesShow(t){console.error("TODO: refactor to ABDesigner");var i=e.propertyIDs(t),s={id:t,rows:[{view:"label",label:`${this.type} :`},{view:"form",id:i.form,elements:[{id:i.name,view:"text",label:a("Name"),name:"name",value:this.name}]}]};if(this.laneIDs&&0==this.laneIDs.length){var n=e.selectUsersUi(t,this);s.rows[1].elements.push(n)}webix.ui(s,$$(t)),$$(t).show()}static selectUsersUi(t,i,s){console.warn("!!! Where is this used???");var a=(...e)=>this.AB.Multilingual.label(...e),n=e.propertyIDs(i),r=this.AB.Account.rolesAll(),o=this.AB.Account.userList();return r.unshift({id:"--",value:a("select a role")}),o.unshift({id:"--",value:a("select a user")}),{view:"fieldset",label:a("Select Users"),body:{rows:[{cols:[{view:"checkbox",id:n.useRole,labelRight:a("by Role"),labelWidth:0,width:120,value:s.useRole?s.useRole:0,click:function(e){$$(e).getValue()?$$(n.role).enable():$$(n.role).disable()}},{id:n.role,view:"select",value:s.role?s.role:"",disabled:!s.useRole,options:r,labelAlign:"left"}]},{cols:[{view:"checkbox",id:n.useAccount,labelRight:a("by Account"),labelWidth:0,width:120,value:s.useAccount?s.useAccount:0,click:function(e){$$(e).getValue()?$$(n.account).enable():$$(n.account).disable()}},{id:n.account,view:"multicombo",value:s.account?s.account:0,disabled:!s.useAccount,suggest:o,labelAlign:"left",placeholder:a("Click or type to add user..."),stringResult:!1}]}]}}}propertiesStash(t){var i=e.propertyIDs(t);if(this.name=$$(i.name).getValue(),0==this.laneIDs.length){var s=e.stashUsersUi(t);Object.keys(s).forEach((e=>{this[e]=s[e]}))}this.stashed=!0}}},1073:(e,t,i)=>{const s=i(9929);e.exports=class extends s{destroy(){return super.destroy().then((()=>this.process.elementRemove(this)))}isValid(){return!0}findLane(e,t){e?e.lanes&&e.lanes.length>0?t(null,e.lanes[0]):"bpmn:Participant"==e.$type?t(null,e):(e=e.$parent,this.findLane(e,t)):t(null,null)}setLane(e){this.laneDiagramID=e.diagramID}fromElement(e){this.diagramID=e.id||this.diagramID,this.onChange(e)}onChange(e){e.businessObject.name&&""!=e.businessObject.name&&(this.label=e.businessObject.name);var t=e.businessObject;this.findLane(t,((t,i)=>{i?this.laneDiagramID=i.id:e.parent&&"bpmn:Participant"==e.parent.type?this.laneDiagramID=e.parent.id:this.laneDiagramID=null}))}diagramProperties(){return[{id:this.diagramID,def:{name:this.name}}]}propertiesShow(e){var t={id:e,view:"label",label:"this task has not implement properties yet..."};webix.ui(t,$$(e)),$$(e).show()}propertiesStash(e){}property(e){if($$(e))return $$(e).getValue()}switchTo(e,t){this.process.elementRemove(this),this.process.elementAdd(e),e.propertiesShow(t),this.emit("switchTo",e)}}},8556:(e,t,i)=>{const s=i(5197);e.exports=class extends s{}},9036:(e,t,i)=>{const s=i(2889);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`}}propertiesShow(e,t){var i=this.propertyIDs(e),s={id:e,view:"form",elements:[{id:i.name,view:"text",label:a("Name"),name:"name",value:this.name}]},n=(this.process.processDataFields(this)||[]).map((e=>e.field)),r=this.process.connectionsOutgoing(this.diagramID);this.__dfLookup={},this.conditions=this.conditions||{},r.forEach((t=>{var i=this.conditions[t.id]||{},r=this.process.elementForDiagramID(t.to),o=this.AB.filterComplexNew(`${e}_${t.id}_filter`);o.fieldsLoad(n),this.__dfLookup[t.id]=o;var l={view:"fieldset",label:a("to {0}",[r?r.name:a("unlabeled Task({0})",[t.id])]),body:{rows:[{id:`${e}_${t.id}_label`,view:"text",label:a("Label"),value:i.label||""},o.ui]}};s.elements.push(l)})),webix.ui(s,$$(e)),$$(e).show(),r.forEach((e=>{var t=this.conditions[e.id]||{},i=this.__dfLookup[e.id];t.filterValue&&i.setValue(t.filterValue)}))}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.conditions={},this.process.connectionsOutgoing(this.diagramID).forEach((t=>{if(this.conditions[t.id]={},this.conditions[t.id].label=this.property(`${e}_${t.id}_label`),this.__dfLookup&&this.__dfLookup[t.id]){var i=this.__dfLookup[t.id];this.conditions[t.id].filterValue=i.getValue()}}))}diagramProperties(){var e=[{id:this.diagramID,def:{name:this.name}}];return this.process.connectionsOutgoing(this.diagramID).forEach((t=>{e.push({id:t.id,def:{name:this.conditions[t.id].label}})})),e}}},8872:(e,t,i)=>{const s=i(2399),a=i(7692);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,to:`${e}_to`,from:`${e}_from`,subject:`${e}_subject`,fromUser:`${e}_from_user`,toUser:`${e}_to_user`,message:`${e}_message`,toCustom:`${e}_to_custom`,fromCustom:`${e}_from_custom`}}propertiesShow(e){var t=this.propertyIDs(e),i=a.selectUsersUi(e+"_to_",this.toUsers||{}),s=a.selectUsersUi(e+"_from_",this.fromUsers||{}),r={id:e,view:"form",elements:[{id:t.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:t.to,view:"select",label:n("To"),name:"to",value:this.to,options:[{id:0,value:n("Next Participant")},{id:1,value:n("Select Role or User")},{id:2,value:n("Custom")}],on:{onChange:e=>{1==parseInt(e)?($$(t.toUser).show(),$$(t.toCustom).hide()):2==parseInt(e)?($$(t.toUser).hide(),$$(t.toCustom).show()):($$(t.toUser).hide(),$$(t.toCustom).hide())}}},{id:t.toUser,rows:[i],paddingY:10,hidden:1!=parseInt(this.to)},{id:t.toCustom,view:"text",label:n("Email"),placeholder:n("Type email address here..."),name:"toCustom",value:this.toCustom,hidden:2!=parseInt(this.to)},{id:t.from,view:"select",label:n("From"),name:"from",value:this.from,options:[{id:0,value:n("Current Participant")},{id:1,value:n("Select Role or User")},{id:2,value:n("Custom")}],on:{onChange:e=>{1==parseInt(e)?($$(t.fromUser).show(),$$(t.fromCustom).hide()):2==parseInt(e)?($$(t.fromUser).hide(),$$(t.fromCustom).show()):($$(t.fromUser).hide(),$$(t.fromCustom).hide())}}},{id:t.fromUser,rows:[s],paddingY:10,hidden:1!=parseInt(this.from)},{id:t.fromCustom,view:"text",label:n("Email"),placeholder:n("Type email address here..."),name:"fromCustom",value:this.fromCustom,hidden:2!=parseInt(this.from)},{id:t.subject,view:"text",label:n("Subject"),name:"subject",value:this.subject},{view:"spacer",height:10},{id:t.message,view:"tinymce-editor",label:n("Message"),name:"message",value:this.message,borderless:!0,minHeight:500,config:{plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",init_instance_callback:e=>{e.on("KeyUp",(e=>{})),e.on("Change",(function(e){}))}}}]};webix.ui(r,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.to=this.property(t.to),this.from=this.property(t.from),this.subject=this.property(t.subject),this.message=this.property(t.message),this.toCustom=this.property(t.toCustom),this.fromCustom=this.property(t.fromCustom),this.toUsers=a.stashUsersUi(e+"_to_"),this.fromUsers=a.stashUsersUi(e+"_from_")}}},5187:(e,t,i)=>{const s=i(9376);e.exports=class extends s{}},2845:(e,t,i)=>{const s=i(7912);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processBatchValue:`${e}_processBatchValue`,objectBatch:`${e}_objectBatch`,fieldBatchEntries:`${e}_fieldBatchEntries`,fieldBatchFinancialPeriod:`${e}_fieldBatchFinancialPeriod`,objectJE:`${e}_objectJE`,fieldJEAccount:`${e}_fieldJEAccount`,fieldJERC:`${e}_fieldJERC`,fieldJEStatus:`${e}_fieldJEStatus`,fieldJEStatusComplete:`${e}_fieldJEStatusComplete`,objectBR:`${e}_objectBR`,fieldBRFinancialPeriod:`${e}_fieldBRFinancialPeriod`,fieldBRAccount:`${e}_fieldBRAccount`,fieldBRRC:`${e}_fieldBRRC`,fieldBREntries:`${e}_fieldBREntries`}}propertiesShow(e){var t=this.propertyIDs(e),i=[{id:0,value:a("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));var s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:a("Select an Object")});var n={id:0,value:a("Select a Field")};function r(e){var t=[n];if(e){var i=s.find((t=>t.id==e));i&&i.object&&i.object.fields().forEach((e=>{t.push({id:e.id,value:e.label,field:e})}))}return t}function o(e,t,i){e.forEach((e=>{var i=$$(e);i&&(i.define("options",t),i.refresh(),i.show())}))}var l=r(this.objectBatch),u=[t.fieldBatchEntries,t.fieldBatchFinancialPeriod],c=r(this.objectJE),d=[t.fieldJEAccount,t.fieldJERC,t.fieldJEStatus];function h(e){var t=[{id:0,value:a("Select the Complete Value")}];return e&&e.options&&e.options().forEach((e=>{t.push({id:e.id,value:e.text})})),t}function p(e){var i,a,n=$$(t.objectJE).getValue(),r=s.find((e=>e.id==n));if(r&&r.object){var o=r.object.fieldByID(e);o&&o.options&&(i=m=h(o),(a=$$(t.fieldJEStatusComplete))&&(a.define("options",i),a.refresh(),a.show()))}}var m=h(),f=r(this.objectBR),g=[t.fieldBRFinancialPeriod,t.fieldBRAccount,t.fieldBRRC,t.fieldBREntries],b={id:e,view:"form",elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.processBatchValue,view:"select",label:a("Process Batch Value"),value:this.processBatchValue,name:"processBatchValue",options:i},{id:t.objectBatch,view:"select",label:a("Batch Object"),value:this.objectBatch,name:"objectBatch",options:s,on:{onChange(e,t){e!=t&&(l=r(e),o(u,l))}}},{id:t.fieldBatchEntries,view:"select",label:a("Batch->JE[]"),value:this.fieldBatchEntries,name:"fieldBatchEntries",options:l,hidden:!0},{id:t.fieldBatchFinancialPeriod,view:"select",label:a("Batch->FinancialPeriod"),value:this.fieldBatchFinancialPeriod,name:"fieldBatchFinancialPeriod",options:l,hidden:!0},{id:t.objectJE,view:"select",label:a("Journal Entry Object"),value:this.objectJE,name:"objectJE",options:s,on:{onChange(e,t){e!=t&&(c=r(e),o(d,c))}}},{id:t.fieldJEAccount,view:"select",label:a("JE->Account"),value:this.fieldJEAccount,name:"fieldJEAccount",options:c,hidden:!0},{id:t.fieldJERC,view:"select",label:a("JE->RC"),value:this.fieldJERC,name:"fieldJERC",options:c,hidden:!0},{id:t.fieldJEStatus,view:"select",label:a("JE->Status"),value:this.fieldJEStatus,name:"fieldJEStatus",options:c,hidden:!0,on:{onChange(e,t){e!=t&&p(e)}}},{id:t.fieldJEStatusComplete,view:"select",label:a("JE->Status->Complete"),value:this.fieldJEStatusComplete,name:"fieldJEStatusComplete",options:m,hidden:!0},{id:t.objectBR,view:"select",label:a("Balance Record"),value:this.objectBR,name:"objectBR",options:s,on:{onChange(e,t){e!=t&&(f=r(e),o(g,f))}}},{id:t.fieldBRFinancialPeriod,view:"select",label:a("BR->FP"),value:this.fieldBRFinancialPeriod,name:"fieldBRFinancialPeriod",options:f,hidden:!0},{id:t.fieldBRAccount,view:"select",label:a("BR->Account"),value:this.fieldBRAccount,name:"fieldBRAccount",options:f,hidden:!0},{id:t.fieldBRRC,view:"select",label:a("BR->RC"),value:this.fieldBRRC,name:"fieldBRRC",options:f,hidden:!0},{id:t.fieldBREntries,view:"select",label:a("BR->Entries"),value:this.fieldBREntries,name:"fieldBREntries",options:f,hidden:!0}]};webix.ui(b,$$(e)),this.objectBatch&&0!=this.objectBatch&&o(u,l),this.objectJE&&0!=this.objectJE&&o(d,c),this.fieldJEStatus&&p(this.fieldJEStatus),this.objectBR&&0!=this.objectBR&&o(g,f),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]=this.property(t[e])}))}}},346:(e,t,i)=>{const s=i(939);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processFPValue:`${e}_processFPValue`,objectFP:`${e}_objectFP`,objectGL:`${e}_objectGL`,objectAcc:`${e}_objectAcc`,fieldFPStart:`${e}_fieldFPStart`,fieldFPOpen:`${e}_fieldFPOpen`,fieldFPStatus:`${e}_fieldFPStatus`,fieldFPActive:`${e}_fieldFPActive`,fieldGLStarting:`${e}_fieldGLStarting`,fieldGLRunning:`${e}_fieldGLRunning`,fieldGLAccount:`${e}_fieldGLAccount`,fieldGLRc:`${e}_fieldGLRc`,fieldGLDebit:`${e}fieldGLDebit`,fieldGLCredit:`${e}_fieldGLCredit`,fieldAccType:`${e}_fieldAccType`,fieldAccAsset:`${e}_fieldAccAsset`,fieldAccExpense:`${e}_fieldAccExpense`,fieldAccLiabilities:`${e}_fieldAccLiabilities`,fieldAccEquity:`${e}_fieldAccEquity`,fieldAccIncome:`${e}_fieldAccIncome`}}propertiesShow(e){var t=this.propertyIDs(e),i=[{id:0,value:a("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));var s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:a("Select an Object")});let n=e=>{let t=[{id:0,value:a("Select a Field")}];if(e){var i=s.find((t=>t.id==e));i&&i.object&&i.object.fields().forEach((e=>{t.push({id:e.id,value:e.label,field:e})}))}return t},r=e=>{let t=[],i=this.AB.objectByID(this.objectFP);if(!i)return t;let s=i.fieldByID(e);return s&&s.settings&&s.settings.options?(t=(s.settings.options||[]).map((e=>({id:e.id,value:e.text}))),t):t},o=(e,t)=>{let i=[],s=this.AB.objectByID(e);if(!s)return i;let a=s.fieldByID(t);return a&&a.settings&&a.settings.options?(i=(a.settings.options||[]).map((e=>({id:e.id,value:e.text}))),i):i},l=n(this.objectFP),u=n(this.objectGL),c=n(this.objectAcc),d=r(this.fieldFPStatus),h=o(this.objectAcc,this.fieldAccType);var p={id:e,view:"form",elementsConfig:{labelWidth:200},elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.processFPValue,view:"select",label:a("Process Fiscal Period Value"),value:this.processFPValue,name:"processFPValue",options:i},{id:t.objectFP,view:"select",label:a("FP Object"),value:this.objectFP,name:"objectFP",options:s,on:{onChange(e,i){e!=i&&(l=n(e),(e=>{[t.fieldFPStart,t.fieldFPOpen,t.fieldFPStatus].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(l))}}},{id:t.objectGL,view:"select",label:a("GL Object"),value:this.objectGL,name:"objectGL",options:s,on:{onChange(e,i){e!=i&&(u=n(e),(e=>{[t.fieldGLRunning,t.fieldGLAccount,t.fieldGLRc,t.fieldGLDebit,t.fieldGLCredit].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(u))}}},{id:t.objectAcc,view:"select",label:a("Account Object"),value:this.objectAcc,name:"objectAcc",options:s,on:{onChange(e,i){e!=i&&(c=n(e),(e=>{$$(t.fieldAccType).define("options",e),$$(t.fieldAccType).refresh()})(c))}}},{id:t.fieldFPStart,view:"select",label:a("FP -> Start"),value:this.fieldFPStart,name:"fieldFPStart",options:l},{id:t.fieldFPOpen,view:"select",label:a("FP -> Open"),value:this.fieldFPOpen,name:"fieldFPOpen",options:l},{id:t.fieldFPStatus,view:"select",label:a("FP -> Status"),value:this.fieldFPStatus,name:"fieldFPStatus",options:l,on:{onChange(e,i){var s;e!=i&&(d=r(e),s=d,$$(t.fieldFPActive).define("options",s),$$(t.fieldFPActive).refresh())}}},{id:t.fieldFPActive,view:"select",label:a("FP -> Active"),value:this.fieldFPActive,name:"fieldFPActive",options:d},{id:t.fieldGLStarting,view:"select",label:a("GL -> Starting BL"),value:this.fieldGLStarting,name:"fieldGLStarting",options:u},{id:t.fieldGLRunning,view:"select",label:a("GL -> Running BL"),value:this.fieldGLRunning,name:"fieldGLRunning",options:u},{id:t.fieldGLAccount,view:"select",label:a("GL -> Account"),value:this.fieldGLAccount,name:"fieldGLAccount",options:u},{id:t.fieldGLRc,view:"select",label:a("GL -> RC"),value:this.fieldGLRc,name:"fieldGLRc",options:u},{id:t.fieldGLDebit,view:"select",label:a("GL -> Debit"),value:this.fieldGLDebit,name:"fieldGLDebit",options:u},{id:t.fieldGLCredit,view:"select",label:a("GL -> Credit"),value:this.fieldGLCredit,name:"fieldGLCredit",options:u},{id:t.fieldAccType,view:"select",label:a("Acc -> Type"),value:this.fieldAccType,name:"fieldAccType",options:c,on:{onChange:(e,i)=>{e!=i&&(h=o(this.objectAcc||$$(t.objectAcc).getValue(),e),(e=>{[t.fieldAccAsset,t.fieldAccExpense,t.fieldAccLiabilities,t.fieldAccEquity,t.fieldAccIncome].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(h))}}},{id:t.fieldAccAsset,view:"select",label:a("Acc -> Asset"),value:this.fieldAccAsset,name:"fieldAccAsset",options:h},{id:t.fieldAccExpense,view:"select",label:a("Acc -> Expense"),value:this.fieldAccExpense,name:"fieldAccExpense",options:h},{id:t.fieldAccLiabilities,view:"select",label:a("Acc -> Liabilities"),value:this.fieldAccLiabilities,name:"fieldAccLiabilities",options:h},{id:t.fieldAccEquity,view:"select",label:a("Acc -> Equity"),value:this.fieldAccEquity,name:"fieldAccEquity",options:h},{id:t.fieldAccIncome,view:"select",label:a("Acc -> Income"),value:this.fieldAccIncome,name:"fieldAccIncome",options:h}]};webix.ui(p,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]=this.property(t[e])}))}}},3618:(e,t,i)=>{const s=i(1166);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processFPYearValue:`${e}_processFPYearValue`,objectFPYear:`${e}_objectFPYear`,objectFPMonth:`${e}_objectFPMonth`,objectGL:`${e}_objectGL`,objectAccount:`${e}_objectAccount`,valueFundBalances:`${e}_valueFundBalances`,valueNetIncome:`${e}_valueNetIncome`,fieldFPYearStart:`${e}_fieldFPYearStart`,fieldFPYearEnd:`${e}_fieldFPYearEnd`,fieldFPYearStatus:`${e}_fieldFPYearStatus`,fieldFPYearActive:`${e}_fieldFPYearActive`,fieldFPMonthStart:`${e}_fieldFPMonthStart`,fieldFPMonthEnd:`${e}_fieldFPMonthEnd`,fieldGLStartBalance:`${e}_fieldGLStartBalance`,fieldGLRunningBalance:`${e}_fieldGLRunningBalance`,fieldGLrc:`${e}_fieldGLrc`,fieldAccNumber:`${e}_fieldAccNumber`,fieldAccType:`${e}_fieldAccType`,fieldAccTypeIncome:`${e}_fieldAccTypeIncome`,fieldAccTypeExpense:`${e}_fieldAccTypeExpense`,fieldAccTypeEquity:`${e}_fieldAccTypeEquity`}}propertiesShow(e){var t=this.propertyIDs(e),i=[{id:0,value:a("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));var s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:a("Select an Object")});let n=(e,t)=>{let i=[{id:0,value:a("Select a Field")}];if(e){var n=s.find((t=>t.id==e));n&&n.object&&n.object.fields((e=>e.key==t)).forEach((e=>{i.push({id:e.id,value:e.label,field:e})}))}return i},r=(e,t)=>{let i=[],s=this.AB.objectByID(e);if(!s)return i;let a=s.fieldByID(t);return a&&a.settings&&a.settings.options?(i=(a.settings.options||[]).map((e=>({id:e.id,value:e.text}))),i):i},o=n(this.objectFPYear,"date"),l=n(this.objectFPYear,"list"),u=r(this.objectFPYear,this.fieldFPYearStatus),c=n(this.objectFPMonth,"date"),d=n(this.objectGL,"number"),h=n(this.objectGL,"connectObject"),p=n(this.objectAccount,"number"),m=n(this.objectAccount,"list"),f=r(this.objectAccount,this.fieldAccType);var g={id:e,view:"form",elementsConfig:{labelWidth:200},elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.processFPYearValue,view:"select",label:a("Process Fiscal Period Year Value"),value:this.processFPYearValue,name:"processFPYearValue",options:i},{id:t.objectFPYear,view:"select",label:a("FP Year Object"),value:this.objectFPYear,name:"objectFPYear",options:s,on:{onChange:(e,i)=>{var s;e!=i&&(o=n(e,"date"),s=o,[t.fieldFPYearStart,t.fieldFPYearEnd].forEach((e=>{$$(e).define("options",s),$$(e).refresh()})),m=n(e,"list"),(e=>{$$(t.fieldFPYearStatus).define("options",e),$$(t.fieldFPYearStatus).refresh()})(m))}}},{id:t.objectFPMonth,view:"select",label:a("FP Month Object"),value:this.objectFPMonth,name:"objectFPMonth",options:s,on:{onChange:(e,i)=>{var s;e!=i&&(c=n(e,"date"),s=c,[t.fieldFPMonthStart,t.fieldFPMonthEnd].forEach((e=>{$$(e).define("options",s),$$(e).refresh()})))}}},{id:t.objectGL,view:"select",label:a("Balance Object"),value:this.objectGL,name:"objectGL",options:s,on:{onChange:(e,i)=>{var s,a;e!=i&&(d=n(e,"number"),a=d,[t.fieldGLStartBalance,t.fieldGLRunningBalance].forEach((e=>{$$(e).define("options",a),$$(e).refresh()})),h=n(e,"connectObject"),s=h,$$(t.fieldGLrc).define("options",s),$$(t.fieldGLrc).refresh())}}},{id:t.objectAccount,view:"select",label:a("Account Object"),value:this.objectAccount,name:"objectAccount",options:s,on:{onChange:(e,i)=>{var s;e!=i&&(m=n(e,"list"),s=m,$$(t.fieldAccType).define("options",s),$$(t.fieldAccType).refresh(),p=n(e,"number"),(e=>{$$(t.fieldAccNumber).define("options",e),$$(t.fieldAccNumber).refresh()})(p))}}},{id:t.valueFundBalances,view:"text",label:a("Fund Balances Code"),value:this.valueFundBalances,name:"valueFundBalances"},{id:t.valueNetIncome,view:"text",label:a("Net Income Code"),value:this.valueNetIncome,name:"valueNetIncome"},{id:t.fieldFPYearStart,view:"select",label:a("FP Year -> Start"),value:this.fieldFPYearStart,name:"fieldFPYearStart",options:o},{id:t.fieldFPYearEnd,view:"select",label:a("FP Year -> End"),value:this.fieldFPYearEnd,name:"fieldFPYearEnd",options:o},{id:t.fieldFPYearStatus,view:"select",label:a("FP Year -> Status"),value:this.fieldFPYearStatus,name:"fieldFPYearStatus",options:l,on:{onChange:(e,i)=>{e!=i&&(u=r(this.objectFPYear||$$(t.objectFPYear).getValue(),e),(e=>{$$(t.fieldFPYearActive).define("options",e),$$(t.fieldFPYearActive).refresh()})(u))}}},{id:t.fieldFPYearActive,view:"select",label:a("FP Year -> Active"),value:this.fieldFPYearActive,name:"fieldFPYearActive",options:u},{id:t.fieldFPMonthStart,view:"select",label:a("FP Month -> Start"),value:this.fieldFPMonthStart,name:"fieldFPMonthStart",options:c},{id:t.fieldFPMonthEnd,view:"select",label:a("FP Month -> End"),value:this.fieldFPMonthEnd,name:"fieldFPMonthEnd",options:c},{id:t.fieldGLStartBalance,view:"select",label:a("GL -> Start Balance"),value:this.fieldGLStartBalance,name:"fieldGLStartBalance",options:d},{id:t.fieldGLRunningBalance,view:"select",label:a("GL -> Running Balance"),value:this.fieldGLRunningBalance,name:"fieldGLRunningBalance",options:d},{id:t.fieldGLrc,view:"select",label:a("GL -> RC"),value:this.fieldGLrc,name:"fieldGLrc",options:h},{id:t.fieldAccNumber,view:"select",label:a("Acc -> Account Number"),value:this.fieldAccNumber,name:"fieldAccNumber",options:p},{id:t.fieldAccType,view:"select",label:a("Acc -> Type"),value:this.fieldAccType,name:"fieldAccType",options:m,on:{onChange:(e,i)=>{e!=i&&(f=r(this.objectAccount||$$(t.objectAccount).getValue(),e),(e=>{[t.fieldAccTypeIncome,t.fieldAccTypeExpense,t.fieldAccTypeEquity].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(f))}}},{id:t.fieldAccTypeIncome,view:"select",label:a("Acc -> Income"),value:this.fieldAccTypeIncome,name:"fieldAccTypeIncome",options:f},{id:t.fieldAccTypeExpense,view:"select",label:a("Acc -> Expense"),value:this.fieldAccTypeExpense,name:"fieldAccTypeExpense",options:f},{id:t.fieldAccTypeEquity,view:"select",label:a("Acc -> Equity"),value:this.fieldAccTypeEquity,name:"fieldAccTypeEquity",options:f}]};webix.ui(g,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]=this.property(t[e])}))}}},9841:(e,t,i)=>{const s=i(9205);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processBatchValue:`${e}_processBatchValue`,objectBatch:`${e}_objectBatch`,objectBalance:`${e}_objectBalance`,objectJE:`${e}_objectJE`,objectJEArchive:`${e}_objectJEArchive`,fieldBatchFiscalMonth:`${e}_fieldBatchFiscalMonth`,fieldJeAccount:`${e}_fieldJeAccount`,fieldJeRC:`${e}_fieldJeRC`,fieldJeArchiveBalance:`${e}_fieldJeArchiveBalance`,fieldBrFiscalMonth:`${e}_fieldBrFiscalMonth`,fieldBrAccount:`${e}_fieldBrAccount`,fieldBrRC:`${e}_fieldBrRC`,fieldsMatch:`${e}_fieldsMatch`}}propertiesShow(e){let t=this.propertyIDs(e),i=[{id:0,value:a("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));let s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:a("Select an Object")});let n=e=>{let t=this.AB.objectByID(e);if(!t)return[];let i=t.fields((e=>e.isConnection)).map((e=>({id:e.id,value:e.label})));return i.unshift({id:0,value:a("Select a Field")}),i},r=(e,t)=>{e.forEach((e=>{var i=$$(e);i&&(i.define("options",t),i.refresh(),i.show())}))},o=()=>{let e=$$(t.fieldsMatch);if(!e)return;webix.ui([],e);let i=this.AB.objectByID(this.objectJE);if(!i)return;let s=this.AB.objectByID(this.objectJEArchive);s&&(s.fields().forEach((t=>{let s=[];s=t.isConnection?i.fields((e=>e.isConnection&&e.settings&&t.settings&&e.settings.linkObject==t.settings.linkObject&&e.settings.linkType==t.settings.linkType&&e.settings.linkViaType==t.settings.linkViaType&&e.settings.isCustomFK==t.settings.isCustomFK)):i.fields((e=>e.key==t.key)),s=s.map((e=>({id:e.id,value:e.label}))),e.addView({view:"select",name:t.id,label:t.label,options:s})})),e.setValues(this.fieldsMatch||{}))},l=n(this.objectBatch),u=n(this.objectBalance),c=n(this.objectJE),d=n(this.objectJEArchive),h={id:e,view:"form",elementsConfig:{labelWidth:180},elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.processBatchValue,view:"select",label:a("Process Batch Value"),value:this.processBatchValue,name:"processBatchValue",options:i},{id:t.objectBatch,view:"select",label:a("Batch Object"),value:this.objectBatch,name:"objectBatch",options:s,on:{onChange:e=>{this.objectBatch=e,(e=>{let i=n(e);r([t.fieldBatchFiscalMonth],i)})(e)}}},{id:t.fieldBatchFiscalMonth,view:"select",label:a("Batch -> Fiscal Month"),value:this.fieldBatchFiscalMonth,name:"fieldBatchFiscalMonth",options:l},{id:t.objectBalance,view:"select",label:a("BR Object"),value:this.objectBalance,name:"objectBalance",options:s,on:{onChange:e=>{this.objectBalance=e,(e=>{let i=n(e);r([t.fieldBrAccount,t.fieldBrFiscalMonth,t.fieldBrRC],i)})(e)}}},{id:t.fieldBrFiscalMonth,view:"select",label:a("BR -> Fiscal Month"),value:this.fieldBrFiscalMonth,name:"fieldBrFiscalMonth",options:u},{id:t.fieldBrAccount,view:"select",label:a("BR -> Account"),value:this.fieldBrAccount,name:"fieldBrAccount",options:u},{id:t.fieldBrRC,view:"select",label:a("BR -> RC"),value:this.fieldBrRC,name:"fieldBrRC",options:u},{id:t.objectJE,view:"select",label:a("JE Object"),value:this.objectJE,name:"objectJE",options:s,on:{onChange:e=>{this.objectJE=e,(e=>{let i=n(e);r([t.fieldJeAccount,t.fieldJeRC],i)})(e),o()}}},{id:t.fieldJeAccount,view:"select",label:a("JE -> Account"),value:this.fieldJeAccount,name:"fieldJeAccount",options:c},{id:t.fieldJeRC,view:"select",label:a("JE -> RC"),value:this.fieldJeRC,name:"fieldJeRC",options:c},{id:t.objectJEArchive,view:"select",label:a("JE Archive Object"),value:this.objectJEArchive,name:"objectJEArchive",options:s,on:{onChange:e=>{this.objectJEArchive=e,(e=>{let i=n(e);r([t.fieldJeArchiveBalance],i)})(e),o()}}},{id:t.fieldJeArchiveBalance,view:"select",label:a("JE Archive -> BR"),value:this.fieldJeArchiveBalance,name:"fieldJeArchiveBalance",options:d},{view:"fieldset",label:"Fields Matching",body:{id:t.fieldsMatch,view:"form",borderless:!0,elements:[]}}]};webix.ui(h,$$(e)),$$(e).show(),o()}propertiesStash(e){let t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]="fieldsMatch"===e?$$(t.fieldsMatch).getValues():this.property(t[e])}))}}},6088:(e,t,i)=>{const s=i(689);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,formulaText:`${e}_formulaText`,variablePopup:`${e}_variablePopup`,operatorPopup:`${e}_operatorPopup`}}propertiesShow(e){let t=this.propertyIDs(e),i=(this.process.processDataFields(this)||[]).map((e=>({id:e.key,value:e.label}))),s={id:e,view:"form",elementsConfig:{labelWidth:120},elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.formulaText,view:"texthighlight",height:200,label:a("Formula"),type:"textarea",value:this.formulaText||"",highlight:e=>(i.forEach((function(t){e=e.replace(new RegExp(`{${t.value}}`,"g"),`<span style='background: #90adb5; color:#000000;'>{${t.value}}</span>`)})),e)},{cols:[{width:120,fillspace:!0},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-at",label:a("Parameters"),click:function(){$$(t.variablePopup).show(this.$view)}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-hashtag",label:a("Operators"),click:function(){$$(t.operatorPopup).show(this.$view)}}]}]};webix.ui(s,$$(e)),null==$$(t.variablePopup)&&webix.ui({id:t.variablePopup,view:"popup",hidden:!0,body:{view:"list",template:e=>e.value,data:i,on:{onItemClick:function(e,i,s){var a=this.getItem(e);n(`{${a.value}}`),$$(t.variablePopup).hide()}}}}),null==$$(t.operatorPopup)&&webix.ui({id:t.operatorPopup,view:"popup",hidden:!0,width:180,body:{view:"list",template:e=>{var t="";return e.icon&&(t+=`<i class="fa fa-${e.icon}" aria-hidden="true"></i> `),e.label&&(t+=e.label),t},data:[{label:a("+ Adds"),symbol:"+"},{label:a("- Subtracts"),symbol:"-"},{label:a("* Multiples"),symbol:"*"},{label:a("/ Divides"),symbol:"/"},{label:a("( Open Bracket"),symbol:"("},{label:a(") Closed Bracket"),symbol:")"}],on:{onItemClick:function(e,i,s){var a=this.getItem(e);n(a.symbol),$$(t.operatorPopup).hide()}}}});let n=e=>{let i=$$(t.formulaText).getValue();$$(t.formulaText).setValue(`${i}${e} `)};$$(e).show()}propertiesStash(e){let t=this.propertyIDs(e);this.name=this.property(t.name),this.formulaText=this.property(t.formulaText)}}},4430:(e,t,i)=>{const s=i(8856);e.exports=class extends s{}},7757:(e,t,i)=>{const s=i(4858);e.exports=class extends s{}},5811:(e,t,i)=>{const s=i(5002),a=i(6370);e.exports=class extends s{constructor(e,t,i){super(e,t,i)}ABQLManager(){return a}}},6298:(e,t,i)=>{const s=i(6146);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,isEnable:`${e}_isEnable`,parameterId:`${e}_parameterId`}}propertiesShow(e){let t=this.propertyIDs(e),i=(this.process.processDataFields(this)||[]).map((e=>({id:e.key,value:e.label}))),s={id:e,view:"form",elementsConfig:{labelWidth:120},elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.isEnable,view:"switch",label:a("Enable"),value:this.isEnable},{id:t.parameterId,view:"richselect",label:a("Repeat for"),options:i,value:this.parameterId}]};webix.ui(s,$$(e)),$$(e).show()}propertiesStash(e){let t=this.propertyIDs(e);this.name=this.property(t.name),this.isEnable=this.property(t.isEnable),this.parameterId=this.property(t.parameterId)}diagramProperties(e){let t=super.diagramProperties();return t=t||[{}],t[0].def=t[0].def||{},null!=this.parameterId&&(t[0].def=t[0].def||{},t[0].def.loopCharacteristics=e.get("moddle").create("bpmn:MultiInstanceLoopCharacteristics"),t[0].def.loopCharacteristics.isSequential=!0),t}onChange(e){let t=e.loopCharacteristics||e.businessObject.loopCharacteristics||{};switch(t.$type){case"bpmn:MultiInstanceLoopCharacteristics":this.loopType=t.isSequential?"sequential":"parallel";break;case"bpmn:StandardLoopCharacteristics":this.loopType="looping"}}destroy(){return this.process.destroy.call(this)}save(){return this.process.save.call(this)}elementNewForModelDefinition(e){let t=this.application.processElementNewForModelDefinition(e,this);return t&&this.elementAdd(t),t}}},8063:(e,t,i)=>{const s=i(6493);e.exports=class extends s{}},6031:(e,t,i)=>{const s=i(2501);e.exports=class extends s{}},2448:(e,t,i)=>{const s=i(9483);e.exports=class extends s{}},6732:(e,t,i)=>{const s=i(1600);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`}}propertiesShow(e){var t={id:e,rows:[{id:this.propertyIDs(e).name,view:"text",label:a("Name"),name:"name",value:this.name}]};webix.ui(t,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name)}}},2513:(e,t,i)=>{const s=i(5364);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,objList:`${e}_objlist`,lifecycleList:`${e}_lifecycleList`}}propertiesShow(e){var t=this.propertyIDs(e),i=this.application.objectsIncluded(),s=[];i.forEach((e=>{s.push({id:e.id,value:e.label})}));var n={view:"form",id:e,elements:[{id:t.name,view:"text",label:a("Name"),name:"name",value:this.name},{id:t.objList,view:"select",label:a("Object"),value:this.objectID,options:s},{id:t.lifecycleList,view:"select",label:a("lifecycle"),value:this.lifecycleKey,options:[{id:"added",value:a("after Add")},{id:"updated",value:a("after Update")},{id:"deleted",value:a("after Delete")}]}]};webix.ui(n,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.objectID=this.property(t.objList),this.lifecycleKey=this.property(t.lifecycleList),this.triggerKey=`${this.objectID}.${this.lifecycleKey}`}}},2038:(e,t,i)=>{const s=i(7535);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends s{propertyIDs(e){return{name:`${e}_name`,repeatEvery:`${e}_repeatEvery`,repeatTime:`${e}_repeatTime`,repeatOnPanel:`${e}_repeatOnPanel`,repeatDaily:`${e}_repeatDaily`,repeatWeekly:`${e}_repeatWeekly`,repeatMonthly:`${e}_repeatMonthly`,isEnabled:`${e}_isEnabled`}}propertiesShow(t){let i=this.propertyIDs(t),s=e.defaults(),n=[];for(let e=1;e<=31;e++)n.push({id:e,value:e});const r=120;let o={view:"form",id:t,elements:[{id:i.name,view:"text",label:a("Name"),labelWidth:r,name:"name",value:this.name},{id:i.repeatEvery,view:"richselect",name:"repeatEvery",label:a("Repeat every"),labelWidth:r,value:this.repeatEvery||s.repeatEvery,options:[{id:"daily",value:a("Daily")},{id:"weekly",value:a("Weekly")},{id:"monthly",value:a("Monthly")}],on:{onChange:e=>{$$(i.repeatOnPanel).showBatch(e)}}},{id:i.repeatTime,view:"datepicker",name:"repeatTime",label:a("Time"),labelWidth:r,value:this.repeatTime||s.repeatTime,timepicker:!0,type:"time",multiselect:!1},{view:"multiview",id:i.repeatOnPanel,cells:[{view:"radio",id:i.repeatDaily,label:" ",labelWidth:r,batch:"daily",vertical:!0,value:this.repeatDaily||s.repeatDaily,options:[{id:"day",value:a("Day")},{id:"weekday",value:a("Weekday")}]},{view:"multiselect",id:i.repeatWeekly,labelWidth:r,label:a("Every week on:"),batch:"weekly",value:this.repeatWeekly||s.repeatWeekly,options:[{id:"SUN",value:a("Sunday")},{id:"MON",value:a("Monday")},{id:"TUE",value:a("Tuesday")},{id:"WED",value:a("Wednesday")},{id:"THU",value:a("Thursday")},{id:"FRI",value:a("Friday")},{id:"SAT",value:a("Saturday")}]},{view:"layout",batch:"monthly",rows:[{id:i.repeatMonthly,view:"richselect",labelWidth:r,label:a("Monthly on day"),options:n,value:this.repeatMonthly||s.repeatMonthly}]}]},{id:i.isEnabled,view:"switch",label:a("Enable"),labelWidth:r,value:this.isEnabled}]};webix.ui(o,$$(t)),$$(t).show(),$$(i.repeatOnPanel).showBatch(this.repeatEvery||s.repeatEvery)}propertiesStash(e){let t=this.propertyIDs(e);this.name=$$(t.name).getValue(),this.repeatEvery=$$(t.repeatEvery).getValue(),this.repeatTime=$$(t.repeatTime).getValue(),this.repeatDaily=$$(t.repeatDaily).getValue(),this.repeatWeekly=$$(t.repeatWeekly).getValue(),this.repeatMonthly=$$(t.repeatMonthly).getValue(),this.isEnabled=$$(t.isEnabled).getValue(),this.triggerKey=null==this.triggerKey||"triggerKey.??"==this.triggerKey?`timer.${this.id||this.AB.uuid()}`:this.triggerKey}save(){return Promise.resolve().then((()=>super.save())).then((e=>this.AB.Network.put({url:(this.isEnabled?"/process/timer/#id#/start":"/process/timer/#id#/stop").replace("#id#",this.id)})))}}},5430:(e,t,i)=>{const s=i(2983),a=i(2021),n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{parseRow(e,t){this.parameterDefinitions.forEach((e=>{var i=this.uiID(t);switch(this.ids=this.toIDs(i),this.params=this.params||{},e.type){case"objectName":this.params[e.name]=$$(this.ids.objectname).getValue();break;case"objectConditions":case"objectValues":var s=$$(this.ids.condition);if(s){var a=s.getValue();a&&""!=a&&(this.params[e.name]=JSON.parse(a))}}}))}toIDs(e){return{condition:`${e}_condition`,objectname:`${e}_objname`,popup:`${e}_popup`,select:`${e}_select`,shorthand:`${e}_shorthand`}}uiAddParamForDef(e,t,i){if(i.cols){var s=this.uiParamUI(e,t);s&&(1==this.parameterDefinitions.length?i.cols.push(s):i.cols.length<3?i.cols.push({rows:[s]}):i.cols[2].rows.push(s))}else{if(!i.rows)throw new Error("provided ui is not able to add a parameter!");for(var a=0;a<i.rows.length;a++)if(i.rows[a].cols){this.uiAddParamForDef(e,t,i.rows[a]);break}}}uiAddNext(e,t){var i=this.uiNextRow(e);this.next?(this.next.uiAddParams(e,i),t.rows.push(i),this.next.uiAddNext(e,t)):t.rows.push(i)}uiAddParams(e,t){this.parameterDefinitions.forEach((i=>{this.uiAddParamForDef(i,e,t)}))}uiID(e){return this.prevOP?`${this.prevOP.uiID(e)}_${this.constructor.key}`:`${e}_${this.constructor.key}`}uiNextRow(e){var t=this.constructor.NextQLOps.map((e=>({id:e.key,value:e.label})));t.unshift({id:0,value:n("choose next operation")});var i=this.uiID(e),s=this.toIDs(i);return{cols:[{view:"spacer",width:this.constructor.uiIndentNext||10},{id:s.select,view:"select",value:this.next?this.next.constructor.key:0,options:t,on:{onChange:(t,i)=>{function a(){var e=$$(s.select);e.blockEvent(),e.setValue(i),e.unblockEvent()}if(t!=i){var n=this.constructor.NextQLOps.find((e=>e.key==t));if(n){var r=$$(s.select).getParentView(),o=r.getParentView(),l=()=>{if(n){var t=new n({},this,this.task,this.AB);this.next=t,t.viewAddParams(e,r),t.viewAddNext(e,o)}},u=o.getChildViews();u.length-1>u.indexOf(r)?webix.confirm({title:"continue?",text:"changing this rule will reset any following rules.",ok:"yes",cancel:"no",callback:e=>{if(e){for(var t=u.length-1;u[t].config.id!=r.config.id;)o.removeView(u[t]),t--;for(var i=r.getChildViews(),s=i.length;s>1;)r.removeView(i[s-1]),s--;l()}else a()}}):l()}else a()}}}}]}}uiParamUI(e,t){var i=this.uiID(t);this.ids=this.toIDs(i);var s=null;switch(e.type){case"objectName":var r=this.AB.objects().map((e=>({id:e.id,value:e.label})));s={id:this.ids.objectname,view:"select",value:this.objectID,options:r,on:{onChange:t=>{this.params=this.params||{},t!=this.params[e.name]&&(this.params[e.name]=t,this.paramChanged(e))}}};break;case"objectConditions":var o=this.AB.filterComplexNew(t),l=this.availableProcessDataFieldsHash();if(this.object){o.fieldsLoad(this.object.fields(),this.object);var u=Object.keys(l).map((e=>l[e])).filter((e=>e.object&&e.object.id==this.object.id));o.processFieldsLoad(u)}o.on("save",(t=>{this.params=this.params||{},this.params[e.name]=t;let i=$$(this.ids.shorthand);i.define({label:o.toShortHand()}),i.refresh();let s=$$(this.ids.condition);s.define({value:JSON.stringify(this.params[e.name])}),s.refresh()}));var c="";this.params&&this.params[e.name]&&(o.setValue(this.params[e.name]),c=JSON.stringify(this.params[e.name]));var d=o.toShortHand();s={rows:[{id:this.ids.shorthand,view:"label",label:d,on:{onItemClick:function(){o.popUp()}}},{id:this.ids.condition,view:"text",value:c,hidden:!0}]};break;case"objectValues":var h="",p=new a(null,i);this.object&&p.objectLoad(this.object),p.setExtendedOptions((this.task.process.processDataFields(this.task)||[]).map((e=>({id:e.key,value:e.label})))),this.params&&this.params[e.name]&&(p.setValue(this.params[e.name]),h=JSON.stringify(this.params[e.name]));var m=()=>{var t={id:this.ids.popup,view:"popup",position:"center",minWidth:700,modal:!0,resize:!0,body:{rows:[{height:30,borderless:!0,cols:[{fillspace:!0},{view:"button",value:"X",width:30,click:()=>{$$(this.ids.popup).hide()}}]},p.ui,{view:"button",value:n("Save"),css:"webix_primary",click:()=>{this.params=this.params||{},this.params[e.name]=p.getValue();var t=$$(this.ids.shorthand);t.define({label:JSON.stringify(this.params[e.name])}),t.refresh();var i=$$(this.ids.condition);i.define({value:JSON.stringify(this.params[e.name])}),i.refresh(),$$(this.ids.popup).hide()}}]}};this._myPopup=webix.ui(t),this._myPopup.show(),this.params&&this.params[e.name]&&p.setValue(this.params[e.name])};s={rows:[{id:this.ids.shorthand,view:"label",label:h,on:{onItemClick:function(){m()}}},{id:this.ids.condition,view:"text",value:h,hidden:!0}]}}return s}viewAddNext(e,t){var i=this.uiNextRow(e);t.addView(i)}viewAddParams(e,t){var i=[];this.parameterDefinitions.forEach((t=>{i.push(this.uiParamUI(t,e))}));var s;(s=i.length>1?{rows:i}:i.pop())&&t.addView(s)}}},3408:(e,t,i)=>{const s=i(5111);class a extends s{}a.uiIndentNext=10,e.exports=a},6370:(e,t,i)=>{const s=i(8162);var a={fromAttributes:s.fromAttributes,ids:function(e){return{root:`${e}_root`,select:`${e}_root_select`,options:`${e}_root_options`}},builder:function(e,t,i){let n=(...e)=>i.Multilingual.label(...e);return{ui:function(r){var o=[{id:0,value:n("choose Root")}];s.QLOps.forEach((e=>{o.push({id:e.key,value:e.label})}));var l=a.ids(r),u={rows:[{view:"label",label:n("Query:")},{id:l.root,cols:[{id:l.select,view:"select",value:e?e.constructor.key:0,options:o,on:{onChange:(a,n)=>{function o(){var e=$$(l.select);e.blockEvent(),e.setValue(n),e.unblockEvent()}if(a!=n){var u=s.QLOps.find((e=>e.key==a));if(u){var c=$$(l.root).getParentView(),d=c.getChildViews();d.length>2?webix.confirm({title:"continue?",text:"changing this rule will reset any following rules.",ok:"yes",cancel:"no",callback:e=>{if(e){for(var t=$$(l.root),i=d.length-1;d[i].config.id!=t.config.id;)c.removeView(d[i]),i--;for(var s=t.getChildViews(),a=s.length;a>1;)t.removeView(s[a-1]),a--;h()}else o()}}):h()}else o()}function h(){u&&((e=new u({},t,i)).viewAddParams(r,$$(l.root)),e.viewAddNext(r,$$(l.root).getParentView()))}}}}]}]};return e&&(e.uiAddParams(r,u),e.uiAddNext(r,u)),u},init:function(e){}}},parse:function(e,t,i){var n=a.ids(e),r=$$(n.root);if(r){var o=r.getParentView().getChildViews();o.shift();var l=function s(a,n,r){if(0==a.length)return null;for(var o=a.shift(),l=o.getChildViews(),u=l.shift();!u.getValue;)u=l.shift();var c=u.getValue(),d=n.find((e=>e.key==c));if(d){var h=null;(h=r?new d({},r,t,i):new d({},t,i)).parseRow(o,e),!h.object&&r&&(h.object=r.object,h.objectID=h.object?h.object.id:null);var p=s(a,h.constructor.NextQLOps,h);return h.next=p,h}return null}(o,s.QLOps,null);return l}console.warn("ABQLManager.parse(): unable to find root element")}};e.exports=a},4157:(e,t,i)=>{const s=i(7505);class a extends s{paramChanged(e){"name"==e.name&&(this.objectID=this.params[e.name],this.object=this.objectLookup(this.objectID),this.next&&(this.next.object=this.object))}parseRow(e,t){super.parseRow(e,t),this.params.name&&(this.objectID=this.params.name,this.object=this.objectLookup(this.params.name))}}a.uiIndentNext=10,e.exports=a},5851:(e,t,i)=>{const s=i(9215);class a extends s{paramChanged(e,t){super.paramChanged(e),"field"==e.name&&this.uiNextRowSelectorRefresh(t)}}a.uiIndentNext=20,e.exports=a},7027:(e,t,i)=>{const s=i(4178);class a extends s{}a.uiIndentNext=20,e.exports=a},465:(e,t,i)=>{const s=i(354);class a extends s{}a.uiIndentNext=20,e.exports=a},8593:(e,t,i)=>{const s=i(219);class a extends s{}a.uiIndentNext=20,e.exports=a},5926:(e,t,i)=>{const s=i(512);class a extends s{paramChanged(e){"field"==e.name&&(this.fieldID=this.params[e.name],this.field=this.object.fieldByID(this.fieldID),this.field&&"connectObject"==this.field.key&&(this.objectOut=this.field.datasourceLink,this.next&&(this.next.object=this.objectOut)))}parseRow(e,t){super.parseRow(e,t),this.fieldID=this.params.field,this.AB.objects((e=>{if(!this.field){var t=e.fieldByID(this.fieldID);t&&(this.field=t)}})),this.field&&(this.object=this.field.object,this.field&&"connectObject"==this.field.key&&(this.objectOut=this.field.datasourceLink))}}a.uiIndentNext=10,e.exports=a},7478:(e,t,i)=>{const s=i(4178);class a extends s{paramChanged(e){"task_param"==e.name&&(this.taskParam=this.params[e.name])}parseRow(e,t){super.parseRow(e,t),this.registered||(this.task.registerDatasource(this),this.registered=!0)}}a.uiIndentNext=10,e.exports=a},3111:(e,t,i)=>{const s=i(6321);class a extends s{}a.uiIndentNext=30,e.exports=a},902:(e,t,i)=>{const s=i(5974);e.exports=class extends s{component(e){var t="ABView_"+this.id,i={id:e.unique(`${t}_component`),view:"layout",type:"space",rows:[]};return 0==i.rows.length&&(i.height=30),{ui:i,init:e=>{}}}componentList(e){var t=["view","page","formpanel","viewcontainer","detailcheckbox","detailcustom","detailconnect","detailimage","detailselectivity","detailtext","detailtree","button","checkbox","connect","datepicker","fieldcustom","textbox","numberbox","selectsingle","selectmultiple","formtree","fieldreadonly","pie","bar","line","area","report","reportPage","reportPanel"];return this.application.viewAll().filter((e=>-1==t.indexOf(e.common().key)))}changePage(e){this.emit("changePage",e)}}},4818:(e,t,i)=>{const s=i(792),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e),r=null;e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s)}editorComponent(e,t){return this.component(e,"ABViewCsvExporterEditorComponent")}static propertyEditorDefaultElements(e,t,i,s){let a=super.propertyEditorDefaultElements(e,t,i,s);return i.showFilterPopup=e=>{this.filter_popup.show(e,null,{pos:"top"})},i.onFilterChange=()=>{let e=i.currentEditObject(),s=r.getValue()||{},a=!0;(s.rules||[]).forEach((e=>{a=!!(e.key&&e.rule&&e.value)&&a&&!0})),a&&setTimeout((()=>{this.propertyEditorSave(t,e)}),10)},this.initPopupEditors(e,t,i),i.selectSource=(e,s)=>{let a=i.currentEditObject();a.emit("properties.updated",a),a.settings.dataviewID=e,this.propertyEditorValues(t,a),a.save()},a.concat([{view:"fieldset",label:n("Data:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{rows:[{name:"datacollection",view:"richselect",label:n("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,skipAutoSave:!0,on:{onChange:i.selectSource}},{name:"hasHeader",view:"checkbox",label:n("Header on first line"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{cols:[{view:"label",label:n("Filter Option:"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthLarge},{view:"button",name:"filterMenuButton",css:"webix_primary",label:n("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.showFilterPopup(this.$view)}}]}]}},{view:"fieldset",label:n("Customize Display:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"buttonLabel",view:"text",label:n("Label"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"filename",view:"text",label:n("File name"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"width",label:n("Width:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}]}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);let s=i.AB.datacollections().map((e=>({id:e.id,value:e.label}))),n=$$(t.datacollection);n.define("options",s),n.define("value",i.settings.dataviewID||null),n.refresh(),$$(t.hasHeader).setValue(i.settings.hasHeader||a.hasHeader),$$(t.buttonLabel).setValue(i.settings.buttonLabel||a.buttonLabel),$$(t.filename).setValue(i.settings.filename||a.filename),$$(t.width).setValue(i.settings.width||a.width);let o=i.datacollection,l=o?o.datasource:null;l?r.fieldsLoad(l.fields()):r.fieldsLoad([]),r.setValue(i.settings.where),this.propertyBadgeNumber(t,i)}static initPopupEditors(e,t,i){r=this.AB.filterComplexNew("ABViewCSVExporterPropertyEditor_filter"),r.init(),r.on("change",(e=>{i.onFilterChange(e)})),this.filter_popup=webix.ui({view:"popup",width:800,hidden:!0,body:r.ui})}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.hasHeader=$$(e.hasHeader).getValue(),t.settings.where=r.getValue(),t.settings.buttonLabel=$$(e.buttonLabel).getValue()||a.buttonLabel,t.settings.filename=$$(e.filename).getValue()||a.filename,t.settings.width=$$(e.width).getValue()||a.width,this.propertyBadgeNumber(e,t)}static propertyBadgeNumber(e,t){t.settings.where&&t.settings.where.rules?($$(e.filterMenuButton).define("badge",t.settings.where.rules.length),$$(e.filterMenuButton).refresh()):($$(e.filterMenuButton).define("badge",null),$$(e.filterMenuButton).refresh())}component(e,t){t=t||"ABCSVExporter_"+this.id;let i={button:e.unique(`${t}_button`),buttonFilter:e.unique(`${t}_button_filter`),popupFilter:e.unique(`${t}_popup_filter`)},s=this.AB.filterComplexNew(`${t}_filter`),n={view:"layout",type:"clean",borderless:!0,cols:[{id:i.buttonFilter,view:"button",css:"webix_transparent",type:"icon",icon:"fa fa-filter",borderless:!0,width:50,label:"",click:()=>{r.showFilterPopup()}},{id:i.button,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-download",borderless:!0,width:this.settings.width||a.width,label:this.settings.buttonLabel||a.buttonLabel,click:()=>{r.downloadCsvFile()}},{fillspace:!0}]},r=this._logic={downloadCsvFile:()=>{let e=`/appbuilder/csv-export/${this.id}`,t=s.getValue();if(t&&(t.rules||[]).length){let i=JSON.stringify(t);i=encodeURIComponent(i),e=`${e}?where=${i}`}window.open(e)},showFilterPopup:()=>{let e=$$(i.buttonFilter);s.popUp(e?e.$view:null)},onFilterChange:()=>{let e=$$(i.buttonFilter);if(!e)return;let t=s.getValue();e.define("badge",(t.rules||[]).length||null),e.refresh()}};return{ui:n,init:e=>{let t=this.datacollection;if(t){let e=t.datasource;s.fieldsLoad(e?e.fields():[],e)}s.init(),s.on("change",(e=>{r.onFilterChange(e)}))}}}}},2471:(e,t,i)=>{const s=i(7876),a=i(2735).Z,n=i(6580),r=i(6204),o=s.defaultValues();let l=(...e)=>AB.Multilingual.label(...e),u=null;class c extends a{constructor(e,t){super(t=t||`ABCSVImporter_${e.id}`,{button:"",popup:"",form:"",uploader:"",uploadFileList:"",separatedBy:"",headerOnFirstLine:"",columnList:"",search:"",datatable:"",statusMessage:"",progressBar:"",importButton:"",rules:""}),this.viewCSVImporter=e,this.settings=this.viewCSVImporter.settings,this.csvImporter=new n(l),this._dataRows=null,this.CurrentObjectID=null,this._csvFileInfo=null,this.validationError=!1}ui(){return{cols:[{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-upload",label:l(this.settings.buttonLabel||o.buttonLabel),width:this.settings.width||o.width,click:()=>{this.showPopup()}},{fillspace:!0}]}}uiConfig(){var e=this.ids;return{view:"form",type:"clean",id:e.form,borderless:!0,minWidth:400,gravity:1,elements:[{rows:[{id:e.uploader,view:"uploader",name:"csvFile",css:"webix_primary",value:l("Choose a CSV file"),accept:"text/csv",multiple:!1,autosend:!1,link:e.uploadFileList,on:{onBeforeFileAdd:e=>(this._csvFileInfo=e,this.loadCsvFile())}},{id:e.uploadFileList,name:"uploadedFile",view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(e,t)=>{this.removeCsvFile(t)}}},{padding:10,rows:[{id:e.separatedBy,view:"richselect",name:"separatedBy",label:l("Separated by"),labelWidth:140,options:this.csvImporter.getSeparateItems(),value:",",on:{onChange:()=>{this.loadCsvFile()}}},{id:e.headerOnFirstLine,view:"checkbox",name:"headerOnFirstLine",label:l("Header on first line"),labelWidth:140,disabled:!0,value:!0,on:{onChange:()=>{this.populateColumnList()}}}]},{type:"space",rows:[{view:"scrollview",minHeight:300,body:{padding:10,id:e.columnList,rows:[]}}]}]}]}}uiRecordsView(){var e=this.ids;return{gravity:2,rows:[{view:"toolbar",css:"bg_gray",cols:[{width:5},{id:e.search,view:"search",value:"",label:"",placeholder:l("Search records..."),keyPressTimeout:200,on:{onTimedKeyPress:()=>{let t=$$(e.search).getValue();this.search(t)}}},{width:2}]},{id:e.datatable,view:"datatable",resizeColumn:!0,editable:!0,editaction:"dblclick",css:"ab-csv-importer",borderless:!1,tooltip:e=>e._errorMsg?e._errorMsg:"No validation errors",minWidth:650,columns:[],on:{onValidationError:function(t,i,s){var a="";Object.keys(s).forEach((e=>{this.$view.complexValidations[e].forEach((e=>{a+=e.invalidMessage+"</br>"}))}));var n=$$(e.datatable);n.blockEvent(),n.updateItem(t,{_status:"invalid",_errorMsg:a}),n.unblockEvent(),this.validationError=!0},onValidationSuccess:function(t,i,s){var a=$$(e.datatable);a.blockEvent(),a.updateItem(t,{_status:"valid",_errorMsg:""}),a.unblockEvent(),this.validationError=!1},onCheck:()=>{var t=$$(e.datatable).find({_included:!0});$$(e.importButton).setValue(this.labelImport(t)),this.overLimitAlert(t)?$$(e.importButton).disable():$$(e.importButton).enable()}}},{id:e.progressBar,height:6},{view:"button",name:"import",id:e.importButton,value:l("Import"),css:"webix_primary",disabled:!0,click:()=>{this.import()}}]}}uiPopup(){var e=this.ids;return{id:e.popup,view:"window",hidden:!0,position:"center",modal:!0,resize:!0,head:{view:"toolbar",css:"webix_dark",cols:[{},{view:"label",label:l("CSV Importer"),autowidth:!0},{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()}}]},body:{type:"form",rows:[{type:"line",cols:[this.uiConfig(),{width:20},this.uiRecordsView(),{width:1}]},{id:e.statusMessage,view:"label",align:"right",hidden:!0},{hidden:!0,margin:5,cols:[{fillspace:!0},{view:"button",name:"cancel",value:l("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.hide()}}]}]}}}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}objectLoad(e){this.CurrentObjectID=e?.id}init(e){this.AB=e;var t=this.ids;let i=this.viewCSVImporter.datacollection;i&&(this.CurrentObjectID=i.datasource.id),webix.ui(this.uiPopup()),$$(t.form)&&webix.extend($$(t.form),webix.ProgressBar),$$(t.progressBar)&&webix.extend($$(t.progressBar),webix.ProgressBar)}showPopup(){$$(this.ids.popup)?.show(),this.formClear(),$$(this.ids.uploader).fileDialog()}hide(){$$(this.ids.popup)?.hide()}formClear(){var e=this.ids;this._dataRows=null,this._csvFileInfo=null,$$(e.form).clearValidation(),$$(e.form).clear(),$$(e.separatedBy).setValue(","),webix.ui([],$$(e.columnList)),$$(e.headerOnFirstLine).disable(),$$(e.importButton).disable(),$$(e.search).setValue(""),$$(e.uploadFileList).clearAll(),$$(e.datatable).clearAll(),$$(e.statusMessage).setValue(""),$$(e.statusMessage).hide()}search(e){let t=$$(this.ids.datatable);if(!t)return;e=(e||"").toLowerCase();let i=this.getMatchFields();t.filter((t=>{let s=!1;return(i||[]).forEach((i=>{s||(s=(t[`${i.columnIndex}`]||"").toString().toLowerCase().indexOf(e)>-1)})),s}))}statusTemplate(e){let t="";if(!e)return t;switch(e._status){case"in-progress":t="<span class='fa fa-refresh'></span>";break;case"invalid":t="<span class='fa fa-exclamation-triangle'></span>";break;case"valid":case"done":t="<span class='fa fa-check'></span>";break;case"fail":t="<span class='fa fa-remove'></span>"}return t}async loadCsvFile(){if(!this._csvFileInfo)return!1;if(!this.csvImporter.validateFile(this._csvFileInfo))return webix.alert({title:l("This file extension is not allowed"),text:l("Please only upload CSV files"),ok:l("Ok")}),!1;var e=this.ids;$$(e.form)?.showProgress?.({type:"icon"});let t=$$(e.separatedBy).getValue();this._dataRows=await this.csvImporter.getDataRows(this._csvFileInfo,t),$$(e.headerOnFirstLine).enable(),$$(e.importButton).enable();let i=this._dataRows.length;return $$(e.headerOnFirstLine).getValue()&&(i=this._dataRows.length-1),$$(e.importButton).setValue(this.labelImport(i)),this.populateColumnList(),$$(e.form)?.hideProgress?.(),!0}removeCsvFile(e){return $$(this.ids.uploadFileList).remove(e),this.formClear(),!0}populateColumnList(){var e=this.ids,t=this;if(webix.ui([],$$(e.columnList)),null==this._dataRows)return;let i=this._dataRows[0];if(null==i)return;let s=[],a=[];if(this.CurrentObject&&(a=this.CurrentObject.fields((e=>{if(this.settings.availableFieldIds?.length&&this.settings.availableFieldIds.indexOf(e.id)<0)return!1;let t=e.formComponent();if(!t)return!0;let i=t.common();return!i||"fieldreadonly"!=i.key}))||[]),$$(e.headerOnFirstLine).getValue())s=i.map(((e,t)=>({id:t+1,value:e,key:this.csvImporter.getGuessDataType(this._dataRows,t)})));else for(let e=0;e<i.length;e++)s.push({id:e+1,value:l("Column {0}",[e+1]),key:this.csvImporter.getGuessDataType(this._dataRows,e)});s.unshift({id:"none",value:l("None")});let n=[],r=[];a.forEach((e=>{let i="none",a=s.filter((t=>t.key==e.key&&r.indexOf(t.id)<0))[0];a&&(i=a.id,r.push(i));let o={view:"richselect",gravity:2,options:s,fieldId:e.id,abName:"columnIndex",value:i,on:{onChange:function(){t.toggleLinkFields(this),t.loadDataToGrid()}}};if("date"==e.key){let e=["/","-",".",","," "],t=[{value:l("1 to 31"),id:"D"},{value:l("01 to 31"),id:"DD"}],i=[{value:l("1 to 12"),id:"M"},{value:l("01 to 12"),id:"MM"}],s=[{value:l("00 to 99"),id:"YY"},{value:l("2000 to 2099"),id:"YYYY"}],a=[{value:l("D-M-Y"),id:1},{value:l("M-D-Y"),id:2},{value:l("Y-M-D"),id:3},{value:l("Y-D-M"),id:4}];o={gravity:2,rows:[o,{view:"richselect",label:l("Separator"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"separator",abName:"columnDateFormat",options:e,value:"/"},{view:"richselect",label:l("Day"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"day",abName:"columnDateFormat",options:t,value:"D"},{view:"richselect",label:l("Month"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"month",abName:"columnDateFormat",options:i,value:"M"},{view:"richselect",label:l("Year"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"year",abName:"columnDateFormat",options:s,value:"YY"},{view:"richselect",label:l("Order"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"order",abName:"columnDateFormat",options:a,value:1}]}}if(e.isConnection){let t=[];e.datasourceLink&&(t=e.datasourceLink.fields((e=>!e.isConnection)).map((e=>({id:e.id,value:e.label})))),o={gravity:2,rows:[o,{view:"richselect",label:"=",labelWidth:20,abName:"columnLinkData",hidden:!0,options:t,value:t[0]?t[0].id:null}]}}n.push({view:"layout",borderless:!0,cols:[{view:"template",gravity:1,borderless:!0,css:{"padding-top":10},template:`<span class="fa fa-${e.icon}"></span> ${e.label}`},o]})})),webix.ui(n,$$(e.columnList)),this.loadDataToGrid()}toggleLinkFields(e){if(!e)return;let t=e.getParentView().queryView({abName:"columnLinkData"},"all")[0];t&&("none"==e.getValue()?t.hide():t.show())}overLimitAlert(e){return e.length>1e3&&(webix.alert({title:l("Too many records"),ok:l("Ok"),text:l("Due to browser limitations we only allow imports of {0} records. Please upload a new CSV or deselect records to import.",[1e3])}),!0)}loadDataToGrid(){var e=this.ids;let t=$$(e.datatable);if(!t)return;t.clearAll(),t?.showProgress?.({type:"icon"});let i=this.getMatchFields(),s=[];s.push({id:"_status",header:"",template:this.statusTemplate,width:30}),s.push({id:"_included",header:{content:"masterCheckbox"},template:"{common.checkbox()}",width:30});var a=[],n=[];if((i||[]).forEach((t=>{var i=t.field.settings.validationRules;if(i&&"string"==typeof i&&(i=JSON.parse(i)),i&&i.length){var r=[];i.forEach((e=>{var i=this.AB.filterComplexNew(`${t.field.id}_${webix.uid()}`);r.push(i.ui),a.push({filter:i,view:i.ids.querybuilder,columnName:t.field.id,validationRules:e.rules,invalidMessage:e.invalidMessage,columnIndex:t.columnIndex})}));var o=e.rules+"_"+t.field.id+"_"+webix.uid();n.push(o),webix.ui({view:"popup",css:"ab-rules-popup",id:o,body:{rows:r}})}var l="text";"number"===t.field.key&&(l="number"),s.push({id:t.columnIndex,header:t.field.label,editor:l,template:function(e,t,i){return i.replace(/[<]/g,"&lt;")},minWidth:150,fillspace:!0})})),a.length){var r=[];a.forEach((t=>{t.filter.fieldsLoad(this.CurrentObject.fields()),t.filter.setValue(t.validationRules),Array.isArray(r[t.columnName])||(r[t.columnName]=[]),r[t.columnName].push({filters:$$(t.view).getFilterHelper(),values:$$(e.datatable).getSelectedItem(),invalidMessage:t.invalidMessage,columnIndex:t.columnIndex})}));var o={};(l=$$(e.datatable)).$view.complexValidations=r,Object.keys(r).forEach((function(e){o[e]=function(t,s){var a=!0;return l.$view.complexValidations[e].forEach((e=>{let t={};(i||[]).forEach((e=>{let i=s[e.columnIndex];"date"==e.field.key&&i.includes("Invalid date")&&(a=!1),t[e.field.id]=i})),0==e.filters(t)&&(a=!1)})),a}})),l.define("rules",o),l.config.rulePops=n,l.refresh()}else{var l;(l=$$(e.datatable)).config.rulePops&&l.config.rulePops.forEach((e=>{$$(e)&&$$(e).destructor()})),l.define("rules",{}),l.refresh()}let u=[];(this._dataRows||[]).forEach(((e,t)=>{let s={id:t+1};(i||[]).forEach((t=>{let i=e[t.columnIndex-1];if("date"==t.field.key){let e=this.AB.toDate(i,{format:t.format});e=this.AB.toDateFormat(e,{format:"YYYY-MM-DD"}),"Invalid date"==e&&(e=e+" - "+i),s[t.columnIndex]=e}else s[t.columnIndex]=i})),s._included=!0,u.push(s)})),$$(e.headerOnFirstLine).getValue()&&u.length>1&&(u=u.slice(1)),$$(e.importButton).setValue(this.labelImport(u)),t.refreshColumns(s),t.parse(u),this.overLimitAlert(u)?$$(e.importButton).disable():$$(e.importButton).enable(),t?.hideProgress?.()}refreshRemainingTimeText(e,t,i){const s=this.ids;let a=(new Date-e)/i*(t-i),n="",r=(a/864e5).toFixed(0),o=(a/36e5).toFixed(0),u=(a/6e4).toFixed(0),c=(a/1e3).toFixed(0);if(n=c<1?"":c<60?l("Approximately {0} second(s) remaining",[c]):1==u?l("Approximately 1 minute {0} seconds remaining",[c-60]):u<60?l("Approximately {0} minutes remaining",[u]):o<24?l("Approximately {0} hour(s) remaining",[o]):l("Approximately {0} day(s) remaining",[r]),n)$$(s.importButton)?.setValue(n);else{const e=$$(s.datatable)?.find({_included:!0});$$(s.importButton)?.setValue(this.labelImport(e))}}getMatchFields(){let e=[];var t=this.ids;return($$(t.columnList).queryView({abName:"columnIndex"},"all").filter((e=>"none"!=e.getValue()))||[]).forEach((t=>{if(!this.CurrentObject)return;let i=t.getValue(),s=this.CurrentObject.fieldByID(t.config.fieldId);if(!s)return;let a={columnIndex:i,field:s};if("date"==s.key){let e=t.getParentView().queryView({abName:"columnDateFormat"},"all");if(e){var n;switch(e.forEach((e=>{a[e.config.name]=e.getValue()})),a.order){case"1":n=a.day+a.separator+a.month+a.separator+a.year;break;case"2":n=a.month+a.separator+a.day+a.separator+a.year;break;case"3":n=a.year+a.separator+a.month+a.separator+a.day;break;case"4":n=a.year+a.separator+a.day+a.separator+a.month}a.format=n}}if(s.isConnection){let e=t.getParentView().queryView({abName:"columnLinkData"},"all")[0];if(e){let t=s.datasourceLink.fieldByID(e.getValue());a.searchField=t}}e.push(a)})),e}labelImport(e){var t=e;return Array.isArray(e)&&(t=e.length),l("Import {0} Records",[t])}import(){let e=this.viewCSVImporter.datacollection;if(null==this.CurrentObject)return Promise.resolve();var t=this.ids;$$(t.importButton).disable(),$$(t.form).showProgress({type:"icon"}),$$(t.progressBar).showProgress({type:"top",position:1e-4});let i,s,a=this.getMatchFields(),n=this.CurrentObject.model(),r=$$(t.datatable).find({_included:!0}),o=0,u=()=>{o+=1,$$(t.progressBar).showProgress({type:"bottom",position:o/r.length})},c=(e,i)=>{let s=$$(t.datatable);s&&(s.addRowCss(e,"row-fail"),s.blockEvent(),s.updateItem(e,{_status:"fail",_errorMsg:i}),s.unblockEvent()),u(),console.error(i)},d=(e,i=[])=>{let s=$$(t.datatable);if(s){let n=[];i.forEach((e=>{e&&e.name&&(a.filter((t=>t.field&&t.field.columnName==e.name))[0],n.push(e.name+": "+e.message))})),$$(t.datatable).blockEvent(),$$(t.datatable).updateItem(e,{_status:"invalid",_errorMsg:n.join("</br>")}),$$(t.datatable).unblockEvent(),s.addRowCss(e,"webix_invalid")}},h=()=>{$$(t.importButton).enable(),$$(t.form).hideProgress(),$$(t.progressBar).hideProgress(),$$(t.statusMessage).setValue(""),$$(t.statusMessage).hide();var e=$$(t.datatable).find({_included:!0});$$(t.importButton).setValue(this.labelImport(e)),this.emit("done")},p=e?.datacollectionLink,m=[];p&&p.getCursor()&&(i=p.datasource,m=this.CurrentObject.fields((e=>e.isConnection&&e.settings.linkObject==i.id)),s=p.getCursor());let f=!0,g=[];if((r||[]).forEach(((e,n)=>{let r={};i&&m.length&&s&&m.forEach((e=>{let t=e.indexField?e.indexField.columnName:i.PK();r[e.columnName]={},r[e.columnName][t]=s[t]||s.id})),a.forEach((t=>{t.field&&t.field.key&&("number"===t.field.key&&"number"!=typeof e[t.columnIndex]?r[t.field.columnName]=(e[t.columnIndex]||"").replace(/[^-0-9.]/gi,""):r[t.field.columnName]=e[t.columnIndex])}));let o=!1,l="",u=this.CurrentObject.isValidData(r);o=u.pass(),l=u.errors,o?o=$$(t.datatable).validate(e.id):(f=!1,d(e.id,l)),o?((e=>{let i=$$(t.datatable);i&&(i.removeRowCss(e,"webix_invalid"),i.blockEvent(),i.updateItem(e,{_status:"",_errorMsg:""}),i.unblockEvent())})(e.id),g.push({id:e.id,data:r})):f=!1})),!f)return h(),webix.alert({title:l("Invalid Data"),ok:l("Ok"),text:l("The highlighted row has invalid data. Please edit in the window or update the CSV and try again.")}),Promise.resolve();var b={};let v,w=a.filter((e=>e&&e.field&&e.field.isConnection&&e.searchField));var y=0;return Promise.resolve().then((()=>{var e=[];return(w||[]).forEach((t=>{let i=t.field,s=t.searchField,a=i.datasourceLink;if(!a)return;let n=a.model();if(!n)return;let r=i.indexField?i.indexField.columnName:i.object.PK();b[i.id]={},e.push(n.findAll({where:{},populate:!1}).then((e=>{e.data&&(e=e.data),(e||[]).forEach((e=>{b[i.id][e[s.columnName]]=e[r]}))})).catch((e=>{console.error(e)})))})),Promise.all(e)})).then((()=>{g.forEach((e=>{let i=e.data;$$(t.datatable).blockEvent(),$$(t.datatable).updateItem(e.id,{_status:"in-progress",_errorMsg:""}),$$(t.datatable).unblockEvent(),(w||[]).forEach((t=>{let s=t.field,a=s.indexField?s.indexField.columnName:s.object.PK();var n=b[s.id][i[s.columnName]];n||(d(e.id,[{name:s.columnName}]),f=!1),i[s.columnName]={},i[s.columnName][a]=n}))}))})).then((()=>{if(!f)return webix.alert({title:l("Invalid Data"),ok:l("Ok"),text:l("The highlighted row has invalid data. Please edit in the window or update the CSV and try again.")}),h(),Promise.resolve();var e=[];const i=(e,i,s,a)=>new Promise(((n,r)=>{s.doRecordRulesPre(i),e.batchCreate({batch:i}).then((e=>{var o=[];Object.keys(e.errors).forEach((t=>{let i=e.errors[t];i&&c(t,i.message||i.sqlMessage||i)})),Object.keys(e.data).forEach((i=>{let a=e.data[i];o.push(new Promise(((e,n)=>{s.doRecordRules(a).then((()=>{(e=>{let i=$$(t.datatable);i&&(i.removeRowCss(e,"row-fail"),i.addRowCss(e,"row-pass"),i.blockEvent(),i.updateItem(e,{_status:"done",_errorMsg:""}),i.unblockEvent()),u()})(i),e()})).catch((e=>{c(i,e),n("that didn't work")}))})))})),Promise.all(o).then((()=>{i.forEach((e=>{++y%50==0&&this.refreshRemainingTimeText(v,g.length,y)})),y==a&&(h(),$$(t.importButton).disable()),n()})).catch((e=>{r(e)}))})).catch((e=>{console.error(e),r(e)}))}));g.forEach((t=>{let i=t.data;e.push({id:t.id,data:i})}));for(var s=[],a=0,r=e.length;e.length;)s[a]=e.splice(0,50),a++;return v=new Date,function e(t,s,a,r){i(n,t,a,r).then((()=>{var t=s.shift();return t&&t.length?e(t,s,a,r):Promise.resolve()})).catch((e=>Promise.reject(e)))}(s.shift(),s,this.viewCSVImporter,r)})).catch((e=>{webix.alert({title:l("Error Creating Records"),ok:l("Ok"),text:l("One or more records failed upon creation.")}),h(),console.error(e)}))}}e.exports=class extends s{editorComponent(e,t){return this.component(e,"ABViewCsvImporterEditorComponent")}static propertyEditorDefaultElements(e,t,i,s){let a=super.propertyEditorDefaultElements(e,t,i,s),n=e.Label;return u=new r,u.component(e,"ABViewCSVImporter_recordrule"),i.selectSource=(e,s)=>{let a=i.currentEditObject();this.propertyUpdateRules(t,a),a.emit("properties.updated",a),a.settings.dataviewID=e,this.propertyAvailableFields(t,a,{selectAll:!0}),a.save()},i.listTemplate=(e,t)=>{let s=i.currentEditObject(),a=e.formComponent();if(null==a)return`<i class='fa fa-times'></i>  ${e.label} <div class='ab-component-form-fields-component-info'> Disable </div>`;let r=a.common().key,o=s.application.viewAll((e=>e.common().key==r))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${o?o.common().icon:"fw"}'></i> ${o?n(o.common().labelKey,"Label"):""} </div>`},i.check=(e,s)=>{let a=$$(t.fields).getItem(s);a.selected=a.selected?0:1,$$(t.fields).updateItem(s,a);let n=i.currentEditObject();this.propertyEditorValues(t,n),n.save()},i.recordRuleShow=()=>{let e=i.currentEditObject();u.formLoad(e),u.fromSettings(e.settings.recordRules),u.show(),u.qbFixAfterShow()},i.recordRuleSave=e=>{let s=i.currentEditObject();s.settings.recordRules=e,this.propertyEditorSave(t,s),this.populateBadgeNumber(t,s)},u.init({onSave:i.recordRuleSave}),a.concat([{view:"fieldset",label:n("ab.component.label.dataSource","*Data:"),labelWidth:e.config.labelWidthLarge,body:{name:"datacollection",view:"richselect",label:n("ab.components.form.dataSource","*Data Source"),labelWidth:e.config.labelWidthLarge,skipAutoSave:!0,on:{onChange:i.selectSource}}},{view:"fieldset",label:n("ab.component.csvImporter.availableFields","*Available Fields:"),labelWidth:e.config.labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"fields",view:"list",select:!1,minHeight:250,template:i.listTemplate,type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:i.check}}]}},{view:"fieldset",label:n("ab.components.form.rules","*Rules:"),labelWidth:e.config.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:n("ab.components.form.recordRules","*Record Rules:"),width:e.config.labelWidthLarge},{view:"button",name:"buttonRecordRules",css:"webix_primary",label:n("ab.components.form.settings","*Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.recordRuleShow()}}]}]}},{view:"fieldset",label:n("ab.component.label.customizeDisplay","*Customize Display:"),labelWidth:e.config.labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"buttonLabel",view:"text",label:n("ab.components.csvImporter.label","*Label"),labelWidth:e.config.labelWidthXLarge},{view:"counter",name:"width",label:n("ab.components.csvImporter.width","*Width:"),labelWidth:e.config.labelWidthXLarge}]}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);let s=i.propertyDatacollections(),a=$$(t.datacollection);a.define("options",s),a.define("value",i.settings.dataviewID||null),a.refresh(),$$(t.buttonLabel).setValue(i.settings.buttonLabel),$$(t.width).setValue(i.settings.width);let n={};null==i.settings.availableFieldIds&&(n.selectAll=!0),this.propertyAvailableFields(t,i,n),this.propertyUpdateRules(t,i),this.populateBadgeNumber(t,i),this.updateEventIds=this.updateEventIds||{},this.updateEventIds[i.id]||(this.updateEventIds[i.id]=!0,i.addListener("properties.updated",(()=>{this.populateBadgeNumber(t,i)})))}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.buttonLabel=$$(e.buttonLabel).getValue(),t.settings.width=$$(e.width).getValue(),t.settings.availableFieldIds=[],($$(e.fields).find({selected:!0})||[]).forEach((e=>{t.settings.availableFieldIds.push(e.id)}))}static propertyAvailableFields(e,t,i={}){let s=t.AB.datacollections((e=>e.id==t.settings.dataviewID))[0],a=s?s.datasource:null;t.settings=t.settings||{};let n=t.settings.availableFieldIds||[],r=[];null!=a&&(r=a.fields().map((e=>(e.selected=!!i.selectAll||n.filter((t=>e.id==t)).length>0,e)))),$$(e.fields).clearAll(),$$(e.fields).parse(r)}static propertyUpdateRules(e,t){if(!t)return;let i=t.datacollection;i&&u.objectLoad(i.datasource),u.formLoad(t)}static populateBadgeNumber(e,t){t&&(t.settings.recordRules?($$(e.buttonRecordRules).define("badge",t.settings.recordRules.length||null),$$(e.buttonRecordRules).refresh()):($$(e.buttonRecordRules).define("badge",null),$$(e.buttonRecordRules).refresh()))}component(e=!1,t){var i=new c(this,t);if(e){var s=i;i={ui:i.ui(),init:(e,t)=>s.init(this.AB,t),onShow:(...e)=>s.onShow?.(...e)}}return i}}},1051:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var s=i(4204),a=i(5782);const n=i(6483),r=i(780);let o=(...e)=>AB.Multilingual.label(...e),l=null;class u extends n{constructor(e,t,i,s){super(e,t,i,s)}fromValues(e){super.fromValues(e),this.filterHelper.fromSettings(this.settings.filter)}editorComponent(e,t){return this.component(e,"ABViewCarouselEditorComponent")}static propertyEditorDefaultElements(e,t,i,n){var u="ABViewCarouselPropertyEditor";let c=super.propertyEditorDefaultElements(e,t,i,n);l=s.Z.propertyComponent(e,u),this.linkPageComponent=a.Z.propertyComponent(e,u);let d=webix.ui({view:"window",modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",head:{view:"toolbar",cols:[{view:"label",label:o("Filter Menu")}]},body:l.ui});return i.filterMenuShow=()=>{var e=i.currentEditObject();l.setSettings(e.settings.filter),d.show()},i.filterSave=()=>{var e=i.currentEditObject();d.hide(),this.propertyEditorValues(t,e),this.propertyEditorSave(t,e)},i.filterCancel=()=>{d.hide()},l.init({onSave:i.filterSave,onCancel:i.filterCancel}),c.concat([{view:"fieldset",label:o("Data:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{view:"select",name:"datacollection",label:o("Object:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[],on:{onChange:function(e,s){if(e!=s){$$(t.detailsPage).setValue(""),$$(t.editPage).setValue("");let s=[],a=i.currentEditObject().AB.datacollectionByID(e);if(a){let e=a.datasource;e&&(s=e.fields((e=>e instanceof r)).map((e=>({id:e.id,value:e.label})))||[])}s.length>0?s.unshift({id:"",value:o("Select a field")}):s.unshift({id:"",value:o("no image fields.")}),$$(t.field).define("options",s),$$(t.field).refresh()}}}},{view:"select",name:"field",label:o("Image Field:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[]},{view:"checkbox",name:"filterByCursor",labelWidth:0,labelRight:o("Filter images by cursor")}]}},this.linkPageComponent.ui,{view:"fieldset",label:o("Customize Display:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{view:"select",name:"navigationType",label:o("Navigation Type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"corner",value:o("Corner")},{id:"side",value:o("Side")}]},{view:"checkbox",name:"showLabel",labelRight:o("Show label of image"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"hideItem",labelRight:o("Hide item list"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"hideButton",labelRight:o("Hide navigation buttons"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"counter",name:"width",label:o("Width:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{view:"counter",name:"height",label:o("Height:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{cols:[{view:"label",label:o("Filter Option:"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthXLarge},{view:"button",id:t.gridFilterMenuButton,css:"webix_primary",label:o("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.filterMenuShow(this.$view)}}]}]}}])}static propertyEditorPopulate(e,t,i){if(super.propertyEditorPopulate(e,t,i),i){var s=i.propertyDatacollections();$$(t.datacollection).define("options",s),$$(t.datacollection).refresh(),$$(t.datacollection).setValue(i.settings.dataviewID),$$(t.field).setValue(i.settings.field),$$(t.filterByCursor).setValue(i.settings.filterByCursor),$$(t.width).setValue(i.settings.width),$$(t.height).setValue(i.settings.height),$$(t.showLabel).setValue(i.settings.showLabel),$$(t.hideItem).setValue(i.settings.hideItem),$$(t.hideButton).setValue(i.settings.hideButton),$$(t.navigationType).setValue(i.settings.navigationType);var a=i.datacollection;a&&l.objectLoad(a.datasource),this.linkPageComponent.viewLoad(i),this.linkPageComponent.setSettings(i.settings)}}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.field=$$(e.field).getValue(),t.settings.filterByCursor=$$(e.filterByCursor).getValue()||!1,t.settings.width=$$(e.width).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.hideItem=$$(e.hideItem).getValue(),t.settings.hideButton=$$(e.hideButton).getValue(),t.settings.navigationType=$$(e.navigationType).getValue(),t.settings.filter=l.getSettings();let i=this.linkPageComponent.getSettings();for(let e in i)t.settings[e]=i[e]}component(e){var t=this.idBase,i={component:e.unique(`${t}_component`)},s=this.datacollection;s&&(this.filterHelper.objectLoad(s.datasource),this.filterHelper.fromSettings(this.settings.filter));let a=this.filterHelper.component(e,t),n=this.linkPageHelper.component(e,t),r={};0==this.settings.width&&(r={width:1});let l={borderless:!0,cols:[r,{borderless:!0,rows:[a.ui,{id:i.component,view:"carousel",cols:[],width:this.settings.width,height:this.settings.height,navigation:{items:!this.settings.hideItem,buttons:!this.settings.hideButton,type:this.settings.navigationType},on:{onShow:function(){let e=$$(i.component).getActiveIndex();u.switchImage(e)}}}]},r]},u={myTemplate:e=>e&&e.src?`<div class="ab-carousel-image-container"><img src="${e.src}" class="content" ondragstart="return false" />`+(this.settings.showLabel?`<div class="ab-carousel-image-title">${e.label||""}</div>`:"")+'<div class="ab-carousel-image-icon">'+(this.settings.detailsPage||this.settings.detailsTab?`<span ab-row-id="${e.id}" class="ab-carousel-detail webix_icon fa fa-eye"></span>`:"")+(this.settings.editPage||this.settings.editTab?`<span ab-row-id="${e.id}" class="ab-carousel-edit webix_icon fa fa-pencil"></span>`:"")+'<span class="webix_icon ab-carousel-fullscreen fa fa-arrows-alt"></span><span style="display: none;" class="webix_icon ab-carousel-exit-fullscreen fa fa-times"></span></div></div>':"",busy:()=>{let e=$$(i.component);e.disable(),e.showProgress&&e.showProgress({type:"icon"})},ready:()=>{let e=$$(i.component);e.enable(),e.hideProgress&&e.hideProgress()},switchImage:async t=>{let i=this.datacollection;if(i&&t>=this._imageCount-1&&i.totalCount>this._rowCount){u.busy();try{await i.loadData(this._rowCount||0)}catch(t){e.AB.notify.developer(t,{message:"Error when load data from a Data collection"})}u.ready()}},onShow:e=>{let t=this.datacollection;if(!t)return;let s=t.datasource;if(!s)return;let r=this.imageField;if(!r)return;if(t&&t.dataStatus==t.dataStatusFlag.notInitial)return void t.loadData();e=e||a.getFilter();let l=t.getData(e);if(this.settings.filterByCursor){let e=t.getCursor();e&&(l=l.filter((t=>(t[s.PK()]||t.id||t)==(e[s.PK()]||e.id||e))))}let c=[];l.forEach((e=>{let t=e[r.columnName];if(t){let i={id:e.id,src:`/file/${t}`};this.settings.showLabel&&(i.label=s.displayData(e)),c.push({css:"image",borderless:!0,template:u.myTemplate,data:i})}})),r.settings.defaultImageUrl&&c.unshift({css:"image",template:u.myTemplate,data:{id:this.AB.uuid(),src:`/file/${r.settings.defaultImageUrl}`,label:o("Default image")}}),c.length<1&&c.push({rows:[{view:"label",align:"center",height:this.settings.height,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-picture-o'></div>"},{view:"label",align:"center",label:o("No image")}]}),this._rowCount=l.length,this._imageCount=c.length;var d=$$(i.component);webix.ui(c,d),d&&webix.extend(d,webix.ProgressBar);let h=this.settings.editPage,p=this.settings.detailsPage;$$(i.component).$view.onclick=e=>{if(e.target.className)if(e.target.className.indexOf("ab-carousel-edit")>-1){webix.html.removeCss($$(i.component).getNode(),"fullscreen"),webix.fullscreen.exit();let t=e.target.getAttribute("ab-row-id");n.changePage(h,t)}else if(e.target.className.indexOf("ab-carousel-detail")>-1){webix.html.removeCss($$(i.component).getNode(),"fullscreen"),webix.fullscreen.exit();let t=e.target.getAttribute("ab-row-id");n.changePage(p,t)}else e.target.className.indexOf("ab-carousel-fullscreen")>-1&&($$(i.component).define("css","fullscreen"),webix.fullscreen.set(i.component,{head:{view:"toolbar",css:"webix_dark",elements:[{},{view:"icon",icon:"fa fa-times",click:function(){webix.html.removeCss($$(i.component).getNode(),"fullscreen"),webix.fullscreen.exit()}}]}}))}},showFilterPopup:e=>{a.showPopup(e)}};return{ui:l,init:e=>{let t=this.datacollection;if(!t)return;let s=t.datasource;if(!s)return;t.on("loadData",(()=>{u.onShow()})),t.on("update",(()=>{t.reloadData()})),t.on("delete",(()=>{t.reloadData()})),t.on("create",(()=>{t.reloadData()})),t.on("initializingData",(()=>{u.busy()})),t.on("initializedData",(()=>{u.ready()})),this.settings.filterByCursor&&t.on("changeCursor",(()=>{u.onShow()})),this.filterHelper.objectLoad(s),this.filterHelper.viewLoad(this),a.init({onFilterData:e=>{u.onShow(e)}}),n.init({view:this,datacollection:t});const r=$$(i.component).$view;r.setAttribute("data-cy",`${this.key} ${this.id}`),r.querySelector(".webix_nav_button_prev")?.firstElementChild?.setAttribute("data-cy",`${this.key} button previous ${this.id}`),r.querySelector(".webix_nav_button_next")?.firstElementChild?.setAttribute("data-cy",`${this.key} button next ${this.id}`)},logic:u,onShow:u.onShow}}get idBase(){return`ABViewCarousel_${this.id}`}get filterHelper(){return null==this.__filterHelper&&(this.__filterHelper=new s.Z(this.AB,this.idBase)),this.__filterHelper}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new a.Z),this.__linkPageHelper}}},3608:(module,__unused_webpack_exports,__webpack_require__)=>{const ABViewChartCore=__webpack_require__(1311),ABViewChartPropertyComponentDefaults=ABViewChartCore.defaultValues();let L=(...e)=>AB.Multilingual.label(...e);module.exports=class ABViewChart extends ABViewChartCore{editorComponent(e,t){var i=super.editorComponent(e,t);return i.ui.rows[0].cellHeight=400,i}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return this._App=e,i.enableMultipleSeries=e=>{var s=i.currentEditObject();e?this.populateFieldOptions2(t,s):($$(t.columnValue2).define("options",[]),$$(t.columnValue2).refresh(),$$(t.columnValue2).disable())},a.concat([{name:"multipleSeries",view:"checkbox",label:L("Multiple Series"),labelWidth:this.AB.UISettings.config().labelWidthLarge,on:{onChange:i.enableMultipleSeries}},{name:"dataview",view:"richselect",label:L("Chart Data"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"columnLabel",view:"richselect",label:L("Label Column"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"columnValue",view:"richselect",label:L("Value Column"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"columnValue2",view:"richselect",label:L("Value Column 2"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"isPercentage",view:"checkbox",labelRight:L("Percentage"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{name:"showLabel",view:"checkbox",label:L("Display Label"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"labelPosition",view:"richselect",label:L("Label Position"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"left",value:L("Left")},{id:"top",value:L("Top")}]},{name:"labelWidth",view:"counter",label:L("Label Width"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"height",label:L("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),this.populateDataview(t,i),this.populateFieldOptions(t,i),$$(t.multipleSeries).setValue(i.settings.multipleSeries||ABViewChartPropertyComponentDefaults.multipleSeries),$$(t.dataview).setValue(i.settings.dataviewID||ABViewChartPropertyComponentDefaults.dataviewID),$$(t.columnValue).setValue(i.settings.columnValue||ABViewChartPropertyComponentDefaults.columnValue),$$(t.columnLabel).setValue(i.settings.columnLabel||ABViewChartPropertyComponentDefaults.columnLabel),$$(t.isPercentage).setValue(null!=i.settings.isPercentage?i.settings.isPercentage:ABViewChartPropertyComponentDefaults.isPercentage),$$(t.showLabel).setValue(i.settings.showLabel||ABViewChartPropertyComponentDefaults.showLabel),$$(t.labelPosition).setValue(i.settings.labelPosition||ABViewChartPropertyComponentDefaults.labelPosition),$$(t.labelWidth).setValue(i.settings.labelWidth||ABViewChartPropertyComponentDefaults.labelWidth),$$(t.height).setValue(i.settings.height||ABViewChartPropertyComponentDefaults.height),i.settings.multipleSeries&&(this.populateFieldOptions2(t,i),$$(t.columnValue2).setValue(i.settings.columnValue2||ABViewChartPropertyComponentDefaults.columnValue2))}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.multipleSeries=$$(e.multipleSeries).getValue(),t.settings.dataviewID=$$(e.dataview).getValue(),t.settings.columnValue=$$(e.columnValue).getValue(),t.settings.columnLabel=$$(e.columnLabel).getValue(),t.settings.isPercentage=$$(e.isPercentage).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue(),t.settings.labelWidth=$$(e.labelWidth).getValue(),t.settings.height=$$(e.height).getValue(),this.populateFieldOptions(e,t),t.settings.multipleSeries&&(t.settings.columnValue2=$$(e.columnValue2).getValue(),this.populateFieldOptions2(e,t)),t.views().forEach((e=>{e.parent.refreshData()}))}static populateDataview(e,t){var i=t.propertyDatacollections();$$(e.dataview).define("options",i),$$(e.dataview).refresh()}static populateFieldOptions(e,t){$$(e.columnLabel).define("options",[]),$$(e.columnLabel).refresh(),$$(e.columnValue).define("options",[]),$$(e.columnValue).refresh();var i=t.datacollection;if(null!=i){var s=i.datasource;if(null!=s){var a=s.fields(),n=s.fields((e=>"number"==e.key||"formula"==e.key||"calculate"==e.key)),r=e=>({id:e.id,value:e.columnName,key:e.key}),o=a.map(r),l=n.map(r),u={id:"",value:L("Select a column"),key:""};o.unshift(u),l.unshift(u),$$(e.columnLabel).define("options",o),$$(e.columnLabel).refresh(),$$(e.columnLabel).enable(),$$(e.columnValue).define("options",l),$$(e.columnValue).refresh(),$$(e.columnValue).enable()}}}static populateFieldOptions2(e,t){$$(e.columnValue2).define("options",[]),$$(e.columnValue2).refresh(),$$(e.columnValue2).enable();var i=t.datacollection;if(null!=i){var s=i.datasource;if(null!=s){var a=s.fields((e=>"number"==e.key)).map((e=>({id:e.id,value:e.columnName,key:e.key}))),n={id:"",value:L("Select a column"),key:""};a.unshift(n),$$(e.columnValue2).define("options",a),$$(e.columnValue2).refresh()}}}component(e){var t="ABViewChart_"+this.id,i={component:e.unique(`${t}_component`)},s=super.component(e);return{ui:{type:"form",borderless:!0,rows:[{body:s.ui}]},init:(e,t)=>{s.init(e,t);var a=$$(i.component);a&&webix.extend(a,webix.ProgressBar);let n=this.datacollection;n&&(n.datacollectionLink&&this.eventAdd({emitter:n.datacollectionLink,eventName:"changeCursor",listener:()=>this.refreshData()}),this.eventAdd({emitter:n,eventName:"changeCursor",listener:()=>this.refreshData()}),this.eventAdd({emitter:n,eventName:"create",listener:()=>this.refreshData()}),this.eventAdd({emitter:n,eventName:"update",listener:()=>this.refreshData()}),this.eventAdd({emitter:n,eventName:"delete",listener:()=>this.refreshData()}),this.eventAdd({emitter:n,eventName:"initializedData",listener:()=>this.refreshData()}))},logic:{},onShow:s.onShow}}getReportData(){return this.dcChart||(this.dcChart=new webix.DataCollection),this.dcChart}refreshData(){var dc=this.datacollection;if(null==dc)return this.dcChart;var labelCol=this.labelField(),valueCol=this.valueField(),valueCol2=this.valueField2();if(!labelCol||!valueCol)return this.dcChart;var numberColName=valueCol.columnName,numberColName2="";this.settings.multipleSeries&&valueCol2&&(numberColName2=valueCol2.columnName);var colorList=["#ee4339","#ee9336","#eed236","#d3ee36","#a7ee70","#58dccd","#36abee","#476cee","#a244ea","#e33fc7"],dInfo=dc.getData(),result=[],sumData={},sumNumber=0,sumNumber2=0,countNumber=dInfo.length,obj;switch(valueCol.key){case"formula":obj=valueCol.object;var objLink=this.AB.objectByID(valueCol.settings.object),fieldBase=obj.fieldByID(valueCol.settings.field),fieldLink=objLink.fieldByID(valueCol.settings.fieldLink);break;case"calculate":obj=valueCol.object;var place=valueCol.settings.decimalPlaces}dInfo.forEach((item=>{var labelKey=labelCol.format(item)||item.id,numberVal=parseFloat(item[numberColName]||0);if(this.settings.multipleSeries)var numberVal2=parseFloat(item[numberColName2])||0;switch(valueCol.key){case"formula":var data=item[fieldBase.relationName()];Array.isArray(data)||(data=[data]);var numberList=[];switch(fieldLink.key){case"calculate":data.forEach((e=>{numberList.push(parseFloat(fieldLink.format(e)||0))}));break;case"number":numberList=data.map((e=>e[fieldLink.columnName]||0))}var result=0;switch(valueCol.settings.type){case"sum":numberList.forEach((e=>result+=e));break;case"average":numberList.length>0&&(numberList.forEach((e=>result+=e)),result/=numberList.length);break;case"max":numberList.forEach((e=>{result<e&&(result=e)}));break;case"min":numberList.forEach((e=>{result>e&&(result=e)}));break;case"count":result=numberList.length}numberVal=result;break;case"calculate":var formula=valueCol.settings.formula;formula=formula.replace(/\(CURRENT\)/g,"(new Date())"),obj.fields().forEach((e=>{var t=e.columnName;if(t.indexOf(".")>-1&&(t=t.split(".")[1]),!(formula.indexOf(`{${t}}`)<0))if("number"==e.key){let i=`(${item[e.columnName]||0})`;formula=formula.replace(new RegExp(`{${t}}`,"g"),i)}else if("calculate"==e.key||"formula"==e.key){let i=`(${e.format(item)||0})`;formula=formula.replace(new RegExp(`{${t}}`,"g"),i)}else if("date"==e.key){let i=`"${item[e.columnName]?item[e.columnName]:""}"`;formula=formula.replace(new RegExp(`{${t}}`,"g"),i)}else if("boolean"==e.key){let i=`(${item[e.columnName]||0})`;formula=formula.replace(new RegExp(`{${t}}`,"g"),i)}})),numberVal=parseFloat(eval(formula).toFixed(place||0))}if(null==sumData[labelKey]){var label=labelKey;if(labelCol.isConnection){var relateValues=labelCol.pullRelationValues(item);null!=relateValues&&(label=Array.isArray(relateValues)?relateValues.map((e=>e.text||"")).join(", "):relateValues.text)}this.settings.multipleSeries?sumData[labelKey]={label:label||item.id,value:0,value2:0}:sumData[labelKey]={label:label||item.id,value:0}}sumData[labelKey].value+=numberVal,sumNumber+=numberVal,this.settings.multipleSeries&&(sumData[labelKey].value2+=numberVal2,sumNumber2+=numberVal2)}));var index=0;for(var key in sumData){var val=sumData[key].value;if(!(val<=0)){if(this.settings.isPercentage&&(val=val/sumNumber*100,val=Math.round(100*val)/100,val+=" %"),this.settings.multipleSeries){var val2=sumData[key].value2;if(val2<=0)continue;this.settings.isPercentage&&(val2=val2/sumNumber2*100,val2=Math.round(100*val2)/100,val2+=" %"),result.push({label:sumData[key].label,value:val,value2:val2,color:colorList[index%colorList.length],count:countNumber})}else result.push({label:sumData[key].label,value:val,color:colorList[index%colorList.length],count:countNumber});index+=1}}let dcChart=this.getReportData();dcChart.clearAll(),dcChart.parse(result),this.emit("refreshData",this.dcChart)}}},7924:(e,t,i)=>{const s=i(6202),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){let i={component:e.unique("ABViewChartAreaEditorComponent_component")};return super.editorComponent(e,t,{componentId:i.component})}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"areaType",view:"richselect",label:n("Chart Type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"area",value:n("Area")},{id:"stackedArea",value:n("Stacked Area")}]},{name:"chartHeight",view:"counter",min:1,label:n("Height")},{name:"stepValue",view:"counter",min:1,label:n("Step")},{name:"maxValue",view:"counter",min:1,label:n("Max Value")},{name:"labelFontSize",view:"counter",min:1,label:n("Label Font Size"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{name:"isLegend",view:"checkbox",labelRight:n("Show Legend"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.chartHeight).setValue(null!=i.settings.chartHeight?i.settings.chartHeight:a.chartHeight),$$(t.labelFontSize).setValue(null!=i.settings.labelFontSize?i.settings.labelFontSize:a.labelFontSize),$$(t.stepValue).setValue(null!=i.settings.stepValue?i.settings.stepValue:a.stepValue),$$(t.maxValue).setValue(null!=i.settings.maxValue?i.settings.maxValue:a.maxValue),$$(t.areaType).setValue(null!=i.settings.areaType?i.settings.areaType:a.areaType),$$(t.isLegend).setValue(null!=i.settings.isLegend?i.settings.isLegend:a.isLegend)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.areaType=$$(e.areaType).getValue(),t.settings.isLegend=$$(e.isLegend).getValue(),t.settings.chartHeight=$$(e.chartHeight).getValue(),t.settings.labelFontSize=$$(e.labelFontSize).getValue(),t.settings.stepValue=$$(e.stepValue).getValue(),t.settings.maxValue=$$(e.maxValue).getValue()}component(e){let t=super.component(e);var i=[];this.views().forEach((t=>{i.push(t.component(e))}));var s="ABViewChartArea_"+this.id,n={component:e.unique(`${s}_component`)},r={id:n.component,view:"chart",type:null!=this.settings.areaType?this.settings.areaType:a.areaType,yAxis:{start:0,step:null!=this.settings.stepValue?this.settings.stepValue:a.stepValue,end:null!=this.settings.maxValue?this.settings.maxValue:a.maxValue},xAxis:{template:1==this.settings.isLegend?"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>":""},legend:1==this.settings.isLegend?{template:"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>",values:[]}:null,series:[{alpha:.7,value:"#value#",color:"#ee4339"},{alpha:.4,value:"#value2#",color:"#a7ee70"}]};return this.settings.chartHeight&&(r.height=this.settings.chartHeight),{ui:r,init:e=>{t.init({componentId:n.component})},logic:t.logic,onShow:t.onShow}}}},1939:(e,t,i)=>{const s=i(3253),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){let i={component:e.unique("ABViewChartBarEditorComponent_component")};return super.editorComponent(e,t,{componentId:i.component})}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"barType",view:"richselect",label:n("Chart Type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"bar",value:n("Vertical")},{id:"barH",value:n("Horizontal")}]},{name:"barPreset",view:"richselect",label:n("Chart Preset"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"column",value:n("Column")},{id:"stick",value:n("Stick")},{id:"alpha",value:n("Alpha")}]},{name:"height",view:"counter",min:1,label:n("Height")},{name:"stepValue",view:"counter",min:1,label:n("Step")},{name:"maxValue",view:"counter",min:1,label:n("Max Value")},{name:"labelFontSize",view:"counter",min:1,label:n("Label Font Size"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{name:"isLegend",view:"checkbox",labelRight:n("Show Legend"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.height).setValue(null!=i.settings.height?i.settings.height:a.height),$$(t.labelFontSize).setValue(null!=i.settings.labelFontSize?i.settings.labelFontSize:a.labelFontSize),$$(t.stepValue).setValue(null!=i.settings.stepValue?i.settings.stepValue:a.stepValue),$$(t.maxValue).setValue(null!=i.settings.maxValue?i.settings.maxValue:a.maxValue),$$(t.barType).setValue(null!=i.settings.barType?i.settings.barType:a.barType),$$(t.barPreset).setValue(null!=i.settings.barPreset?i.settings.barPreset:a.barPreset),$$(t.isLegend).setValue(null!=i.settings.isLegend?i.settings.isLegend:a.isLegend)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.barType=$$(e.barType).getValue(),t.settings.barPreset=$$(e.barPreset).getValue(),t.settings.isLegend=$$(e.isLegend).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.labelFontSize=$$(e.labelFontSize).getValue(),t.settings.stepValue=$$(e.stepValue).getValue(),t.settings.maxValue=$$(e.maxValue).getValue()}component(e){let t=super.component(e);var i=[];this.views().forEach((t=>{i.push(t.component(e))}));var s="ABViewChartBar_"+this.id,n={component:e.unique(`${s}_component`)};return{ui:"bar"==this.settings.barType||null==this.settings.barType?{id:n.component,view:"chart",type:null!=this.settings.barType?this.settings.barType:a.barType,preset:null!=this.settings.barPreset?this.settings.barPreset:a.barPreset,value:"#value#",color:"#color#",yAxis:{start:0,step:null!=this.settings.stepValue?this.settings.stepValue:a.stepValue,end:null!=this.settings.maxValue?this.settings.maxValue:a.maxValue},xAxis:{template:1==this.settings.isLegend?"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>":""},legend:1==this.settings.isLegend?"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>":"",height:null!=this.settings.height?this.settings.height:a.height}:{id:n.component,view:"chart",type:null!=this.settings.barType?this.settings.barType:a.barType,preset:null!=this.settings.barPreset?this.settings.barPreset:a.barPreset,value:"#value#",color:"#color#",yAxis:{template:1==this.settings.isLegend?"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>":""},xAxis:{start:0,step:"#stepValue#",end:"#maxValue#"},legend:1==this.settings.isLegend?{template:"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>",values:[]}:null,height:null!=this.settings.height?this.settings.height:a.height},init:()=>{t.init({componentId:n.component})},logic:t.logic,onShow:t.onShow}}}},8320:(e,t,i)=>{const s=i(1895);e.exports=class extends s{editorComponent(e,t,i){let s=this.component(e),a=s.ui;a.id=i.componentId;let n=s.logic,r=s.onShow;return{ui:a,init:()=>{s.init({componentId:a.id})},logic:n,onShow:r}}component(e){var t={setValue:(e,t)=>{$$(e)&&$$(e).setValues({display:t})},onShow:()=>{this._isShow=!0;let e=this.parent.getReportData();t.refreshData(e)},refreshData:e=>{let t=$$(this._componentId);t&&t.data&&t.data.sync(e)}};return{init:e=>{this._componentId=e.componentId,this.eventAdd({emitter:this.parent,eventName:"refreshData",listener:e=>{this._isShow&&t.refreshData(e)}})},logic:t,onShow:t.onShow}}}},1967:(e,t,i)=>{const s=i(9875),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){let i={component:e.unique("ABViewChartLineEditorComponent_component")};return super.editorComponent(e,t,{componentId:i.component})}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"lineType",view:"richselect",label:n("Chart Type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"line",value:n("Line")},{id:"spline",value:n("Spline")}]},{name:"linePreset",view:"richselect",label:n("Chart Preset"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"plot",value:n("Plot")},{id:"diamond",value:n("Diamond")},{id:"simple",value:n("Simple")}]},{name:"chartHeight",view:"counter",min:1,label:n("Height")},{name:"stepValue",view:"counter",min:1,label:n("Step")},{name:"maxValue",view:"counter",min:1,label:n("Max Value")},{name:"labelFontSize",view:"counter",min:1,label:n("Label Font Size"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{name:"isLegend",view:"checkbox",labelRight:n("Show Legend"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.chartHeight).setValue(null!=i.settings.chartHeight?i.settings.chartHeight:a.chartHeight),$$(t.labelFontSize).setValue(null!=i.settings.labelFontSize?i.settings.labelFontSize:a.labelFontSize),$$(t.stepValue).setValue(null!=i.settings.stepValue?i.settings.stepValue:a.stepValue),$$(t.maxValue).setValue(null!=i.settings.maxValue?i.settings.maxValue:a.maxValue),$$(t.lineType).setValue(null!=i.settings.lineType?i.settings.lineType:a.lineType),$$(t.linePreset).setValue(null!=i.settings.linePreset?i.settings.linePreset:a.linePreset),$$(t.isLegend).setValue(null!=i.settings.isLegend?i.settings.isLegend:a.isLegend)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.lineType=$$(e.lineType).getValue(),t.settings.linePreset=$$(e.linePreset).getValue(),t.settings.isLegend=$$(e.isLegend).getValue(),t.settings.chartHeight=$$(e.chartHeight).getValue(),t.settings.labelFontSize=$$(e.labelFontSize).getValue(),t.settings.stepValue=$$(e.stepValue).getValue(),t.settings.maxValue=$$(e.maxValue).getValue()}component(e){let t=super.component(e);var i=[];this.views().forEach((t=>{i.push(t.component(e))}));var s="ABViewChartLine_"+this.id,n={component:e.unique(`${s}_component`)};return{ui:{id:n.component,view:"chart",type:null!=this.settings.lineType?this.settings.lineType:a.lineType,preset:null!=this.settings.linePreset?this.settings.linePreset:a.linePreset,value:"#value#",color:"#color#",yAxis:{start:0,step:null!=this.settings.stepValue?this.settings.stepValue:a.stepValue,end:null!=this.settings.maxValue?this.settings.maxValue:a.maxValue},xAxis:{template:1==this.settings.isLegend?"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>":""},legend:1==this.settings.isLegend?{template:"<div style='font-size:"+this.settings.labelFontSize+"px;'>#label#</div>",values:[]}:null,height:null!=this.settings.chartHeight?this.settings.chartHeight:a.chartHeight},init:()=>{t.init({componentId:n.component})},logic:t.logic,onShow:t.onShow}}}},8104:(e,t,i)=>{const s=i(2118),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){return this.component(e,"ABViewChartPieEditorComponent")}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"pieType",view:"richselect",label:n("Chart Type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"pie",value:n("Standard")},{id:"pie3D",value:n("Pie3D")},{id:"donut",value:n("Donut")}]},{name:"height",view:"counter",min:1,label:n("Height")},{name:"innerFontSize",view:"counter",min:1,label:n("Inner Font Size"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{name:"labelFontSize",view:"counter",min:1,label:n("Label Font Size"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{name:"isLegend",view:"checkbox",labelRight:n("Show Legend"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.height).setValue(null!=i.settings.height?i.settings.height:a.height),$$(t.innerFontSize).setValue(null!=i.settings.innerFontSize?i.settings.innerFontSize:a.innerFontSize),$$(t.labelFontSize).setValue(null!=i.settings.labelFontSize?i.settings.labelFontSize:a.labelFontSize),$$(t.pieType).setValue(null!=i.settings.pieType?i.settings.pieType:a.pieType),$$(t.isLegend).setValue(null!=i.settings.isLegend?i.settings.isLegend:a.isLegend)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.pieType=$$(e.pieType).getValue(),t.settings.isLegend=$$(e.isLegend).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.innerFontSize=$$(e.innerFontSize).getValue(),t.settings.labelFontSize=$$(e.labelFontSize).getValue()}component(e,t){let i=super.component(e);var s=[];this.views().forEach((t=>{s.push(t.component(e))})),t=t||"ABViewChartPie_"+this.id;var n={component:e.unique(`${t}_component`)};let r=null;return 1==this.settings.isLegend&&(r={width:this.parent.settings.labelWidth,template:1==this.settings.isLegend?`<div style='font-size: ${this.settings.labelFontSize}px;'>#label#</div>`:""}),{ui:{id:n.component,view:"chart",type:null!=this.settings.pieType?this.settings.pieType:a.pieType,value:"#value#",color:"#color#",legend:r,pieInnerText:`<div style='font-size: ${this.settings.innerFontSize}px;'>#value#</div>`,shadow:1,height:null!=this.settings.height?this.settings.height:a.height},init:()=>{i.init({componentId:n.component})},logic:i.logic,onShow:i.onShow}}}},1404:(e,t,i)=>{const s=i(2194),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i=this.component(e,"ABViewCommentEditorComponent");return{ui:i.ui,init:i.init,logic:i.logic,onShow:i.onShow}}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.selectSource=(e,s)=>{var a=i.currentEditObject();this.propertyUpdateUserFieldOptions(t,a,e),this.propertyUpdateCommentFieldOptions(t,a,e),this.propertyUpdateDateFieldOptions(t,a,e)},a.concat([{name:"dataSource",view:"richselect",label:n("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,on:{onChange:i.selectSource}},{name:"columnUser",view:"richselect",label:n("Select a user field"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"columnComment",view:"richselect",label:n("Select a comment field"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"columnDate",view:"richselect",label:n("Select a date field"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"height",label:n("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=i.settings.dataviewID?i.settings.dataviewID:null;this.propertyUpdateDatacollectionOptions(t,i,s),this.propertyUpdateUserFieldOptions(t,i,s),this.propertyUpdateCommentFieldOptions(t,i,s),this.propertyUpdateDateFieldOptions(t,i,s),$$(t.dataSource).setValue(i.settings.dataviewID||a.dataviewID),$$(t.columnUser).setValue(i.settings.columnUser||a.columnUser),$$(t.columnComment).setValue(i.settings.columnComment||a.columnComment),$$(t.columnDate).setValue(i.settings.columnDate||a.columnDate),$$(t.height).setValue(i.settings.height||a.height)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.dataSource).getValue(),t.settings.columnUser=$$(e.columnUser).getValue(),t.settings.columnComment=$$(e.columnComment).getValue(),t.settings.columnDate=$$(e.columnDate).getValue(),t.settings.height=$$(e.height).getValue()}static propertyUpdateDatacollectionOptions(e,t,i){var s=t.propertyDatacollections();$$(e.dataSource).define("options",s),$$(e.dataSource).define("value",i),$$(e.dataSource).refresh()}static propertyUpdateUserFieldOptions(e,t,i){var s=t.AB.datacollectionByID(i),a=s?s.datasource:null,n=[];null!=a&&(n=a.fields((e=>"user"==e.key)).map((e=>({id:e.id,value:e.label})))),n.unshift({id:null,value:"[Select]"}),$$(e.columnUser).define("options",n),$$(e.columnUser).refresh()}static propertyUpdateCommentFieldOptions(e,t,i){var s=t.AB.datacollectionByID(i),a=s?s.datasource:null,n=[];null!=a&&(n=a.fields((e=>"string"==e.key||"LongText"==e.key)).map((e=>({id:e.id,value:e.label})))),n.unshift({id:null,value:"[Select]"}),$$(e.columnComment).define("options",n),$$(e.columnComment).refresh()}static propertyUpdateDateFieldOptions(e,t,i){var s=t.AB.datacollectionByID(i),a=s?s.datasource:null,n=[];null!=a&&(n=a.fields((e=>"date"==e.key)).map((e=>({id:e.id,value:e.label})))),n.unshift({id:null,value:"[Select]"}),$$(e.columnDate).define("options",n),$$(e.columnDate).refresh()}component(e){var t="ABViewComment_"+this.id,i={component:e.unique(`${t}_component`)};let s=super.component(e);var a=this.getUserData(),n=this.getCurrentUserId(),r={id:i.component,view:"comments",users:a,currentUser:n,height:this.settings.height,on:{onBeforeAdd:function(e,t,i){o.addComment(t.text,new Date)},onAfterDelete:function(e){o.deleteComment(e)}}},o={getCommentData:()=>{let e=this.datacollection;if(!e)return null;let t=this.getUserField(),i=this.getCommentField(),s=this.getDateField();if(!t||!i)return null;let a=t.columnName,n=i.columnName,r=s?s.columnName:null,o=e.getData(),l=[];return o.forEach(((e,t)=>{if(e[n]){var i=this.getUserData().find((t=>t.value==e[a])),s={id:e.id,user_id:i?i.id:0,date:e[r]?new Date(e[r]):null,default_date:new Date(e.created_at),text:e[n]};l.push(s)}})),l.sort((function(e,t){return r?new Date(e.date).getTime()-new Date(t.date).getTime():new Date(e.default_date).getTime()-new Date(t.default_date).getTime()})),{data:l}},refreshComment:()=>{this.__refreshTimeout&&clearTimeout(this.__refreshTimeout),o.busy(),this.__refreshTimeout=setTimeout((()=>{let e=$$(i.component);if(!e)return;let t=e.queryView({view:"list"});t&&t.clearAll();let s=o.getCommentData();s&&$$(i.component).parse(s),t&&t.scrollTo(0,Number.MAX_SAFE_INTEGER),delete this.__refreshTimeout,o.ready()}),90)},addComment:(e,t)=>{this.saveData(e,t)},updateComment:(e,t)=>{let i=this.model();if(!i)return Promise.resolve();let s=this.getCommentField();if(!s)return Promise.resolve();let a={};return a[s.columnName]=t||"",i.update(e,a)},deleteComment:e=>{let t=this.model();if(t)return t.delete(e)},busy:()=>{let e=$$(i.component);if(!e)return;let t=e.queryView({view:"list"});t&&(t.disable(),t.showProgress&&t.showProgress({type:"icon"}))},ready:()=>{let e=$$(i.component);if(!e)return;let t=e.queryView({view:"list"});t&&(t.enable(),t.hideProgress&&t.hideProgress())}};return{ui:r,init:e=>{this.__dvEvents=this.__dvEvents||{};let t=$$(i.component);if(t){let e=t.queryView({view:"list"});e&&(this.__dvEvents.onStoreUpdated||(this.__dvEvents.onStoreUpdated=e.data.attachEvent("onStoreUpdated",((e,t,i)=>{"update"==i&&o.updateComment(e,(t||{}).text)}))),webix.extend(e,webix.ProgressBar))}var s=this.datacollection;s&&(this.__dvEvents.create||(this.__dvEvents.create=s.on("create",(()=>o.refreshComment()))),this.__dvEvents.update||(this.__dvEvents.update=s.on("update",(()=>o.refreshComment()))),this.__dvEvents.delete||(this.__dvEvents.delete=s.on("delete",(()=>o.refreshComment()))),this.__dvEvents.loadData||(this.__dvEvents.loadData=s.on("loadData",(()=>o.refreshComment()))))},logic:o,onShow:()=>{s.onShow(),o.refreshComment()}}}getUsers(){return this.AB.Account.userList().map((e=>({id:e.username,value:e.username,image:e.image_id})))}getCurrentUserId(){var e=this.getUsers(),t=this.AB.Account.username(),i=0;if(e)return e.forEach(((e,s)=>{e.value==t&&(i=s+1)})),i}async saveData(e,t){if(null==e||""==e)return Promise.resolve();let i=this.datacollection;if(!i)return Promise.resolve();let s=this.model();if(null==s)return this.AB.notify.builder({},{message:"ABViewComment.saveData(): could not pull a model to work with.",viewName:this.label}),Promise.resolve();let a={},n=this.getUserField();n&&(a[n.columnName]=this.AB.Account.username());let r=this.getCommentField();r&&(a[r.columnName]=e);let o=this.getDateField();o&&(a[o.columnName]=t);let l=i.datacollectionLink;if(l&&l.getCursor()){let e=l.datasource,t=i.fieldLink;e&&t&&(a[t.columnName]={},a[t.columnName][e.PK()]=l.getCursor().id)}return await s.create(a)}}},5766:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(2735);class a extends s.Z{constructor(...e){super(...e),this.__events=[],this.CurrentObjectID=null,this.CurrentDatacollectionID=null}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}get CurrentDatacollection(){return this.AB.datacollectionByID(this.CurrentDatacollectionID)}datacollectionLoad(e){this.CurrentDatacollectionID=e.id}objectLoad(e){this.CurrentObjectID=e.id}eventAdd(e){if(e&&e.emitter&&e.listener){var t=this.__events.find((t=>t.emitter==e.emitter&&t.eventName==e.eventName));(!t||t.length<1)&&(this.__events.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}}eventsClear(){(this.__events||[]).forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)})),this.__events=[]}onShow(){var e=this.datacollection;e&&e.dataStatus==e.dataStatusFlag.notInitial&&e.loadData()}}},8016:(e,t,i)=>{const s=i(962),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e),r=null;e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s),this.__filterComponent=this.AB.filterComplexNew(`${this.id}_filterComponent`),this.populateFilterComponent()}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.changeDatacollection=e=>{var s=i.currentEditObject();this.populatePopupEditors(t,s,e)},i.showFilterPopup=e=>{this.filter_popup.show(e,null,{pos:"top"})},i.onFilterChange=()=>{var e=i.currentEditObject(),s=r.getValue();e.settings.filterConditions=s;var a=!0;s.rules.forEach((e=>{a=!!(e.key&&e.rule&&e.value)&&a&&!0})),a&&setTimeout((()=>{this.propertyEditorSave(t,e)}),10),this.populateBadgeNumber(t,e)},r=this.AB.filterComplexNew("ABViewConditionalContainerPropertyEditor_filter"),r.init(),r.on("change",(e=>{i.onFilterChange(e)})),this.filter_popup=webix.ui({view:"popup",width:800,hidden:!0,body:r.ui}),a.concat([{name:"datacollection",view:"richselect",label:n("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,on:{onChange:function(e){i.changeDatacollection(e)}}},{view:"fieldset",name:"filter",label:n("Filter:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:n("Filter Data:"),width:this.AB.UISettings.config().labelWidthLarge},{view:"button",name:"buttonFilter",label:n("Settings"),icon:"fa fa-gear",type:"icon",css:"webix_primary",autowidth:!0,badge:0,click:function(){i.showFilterPopup(this.$view)}}]}]}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=i.settings.dataviewID?i.settings.dataviewID:null,a=$$(t.datacollection),n=i.propertyDatacollections();a.define("options",n),a.define("value",s),a.refresh(),this.populatePopupEditors(t,i)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue()}static populatePopupEditors(e,t,i){var s=t.datacollection;i&&(s=t.AB.datacollectionByID(i)),s&&s.datasource?(r.fieldsLoad(s.datasource.fields()),t.__filterComponent.fieldsLoad(s.datasource.fields())):(r.fieldsLoad(),t.__filterComponent.fieldsLoad()),r.setValue(t.settings.filterConditions||a.filterConditions),t.__filterComponent.setValue(t.settings.filterConditions||a.filterConditions),this.populateBadgeNumber(e,t)}static populateBadgeNumber(e,t){t.settings.filterConditions&&t.settings.filterConditions.rules?($$(e.buttonFilter).define("badge",t.settings.filterConditions.rules.length||null),$$(e.buttonFilter).refresh()):($$(e.buttonFilter).define("badge",null),$$(e.buttonFilter).refresh())}component(e){var t="ABViewConditionalContainer_"+this.id,i={component:e.unique(`${t}_component`)},s=super.component(e);const a=this.views()[0].component(e),r=this.views()[1].component(e);a.ui.batch="if",r.ui.batch="else";var o={id:i.component,view:"multiview",cells:[{batch:"wait",view:"layout",rows:[{view:"label",label:n("Please wait...")}]},a.ui,r.ui]},l={displayView:e=>{let t=this.datacollection;t&&t.dataStatus===t.dataStatusFlag.initialized?(null==e&&(e=t.getCursor()),this.__filterComponent.isValid(e)&&null!=e?$$(i.component).showBatch("if"):$$(i.component).showBatch("else")):$$(i.component).showBatch("wait")}};return{ui:o,init:(e,t)=>{s.init(e),a.init(e,t),r.init(e,t),this.populateFilterComponent();var i=this.datacollection;i&&(this.eventAdd({emitter:i,eventName:"loadData",listener:()=>l.displayView()}),this.eventAdd({emitter:i,eventName:"initializedData",listener:()=>l.displayView()}),this.eventAdd({emitter:i,eventName:"changeCursor",listener:(...e)=>l.displayView(...e)})),l.displayView()},logic:l,onShow:s.onShow}}populateFilterComponent(){let e=this.datacollection;e&&e.datasource?this.__filterComponent.fieldsLoad(e.datasource.fields()):this.__filterComponent.fieldsLoad([]),this.__filterComponent.setValue(this.settings.filterConditions||a.filterConditions)}save(){return super.save(!0)}}},9199:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var s=i(3578),a=i.n(s),n=i(5766);const r=(...e)=>AB.Multilingual.label(...e);class o extends n.Z{constructor(e,t){super(t??`ABViewConnectDataFilter_${e.id}`,{reset:""}),this.view=e,this.AB=e.AB,this.datacollection=this.view.datacollection,this.settings=e.settings}ui(){return{type:"space",borderless:!0,cols:[{view:"icon",icon:"fa fa-filter",align:"left",disabled:!0},{view:"combo",id:this.ids.component,labelWidth:this.AB.UISettings.config().labelWidthXLarge,disabled:!0,on:{onChange:e=>this.applyConnectFilter(e)}},{view:"icon",id:this.ids.reset,icon:"fa fa-times",align:"left",disabled:!0,tooltip:r("Renmove this filter"),on:{onItemClick:()=>this.resetConnectFilter()}}]}}async init(e){const t=this.datacollection;if(!t)return;const i=t.datasource;if(!i)return;const[s]=i.fields((e=>e.columnName==this.settings.field));if(!s)return void this.AB.notify.developer(`Cannot find field "${this.settings.field}" in ${i.name}`,{context:"ABViewConnectDataFilterComponent.init()",data:{settings:this.settings}});this.field=s;const a=webix.ui({view:"suggest",filter:({value:e},t)=>e.toLowerCase().includes(t.toLowerCase()),on:{onShow:()=>{s.populateOptionsDataCy($$(this.ids.component),s,{})}}});s.getAndPopulateOptions(a,null,s),$$(this.ids.component).define("suggest",a),$$(this.ids.component).define("label",`${r("Filter by")} ${s.label}`),$$(this.ids.component).enable(),$$(this.ids.component).refresh()}resetConnectFilter(){this.datacollection.filterCondition({glue:"and",rules:[]}),this.datacollection.reloadData(),$$(this.ids.component).blockEvent(),$$(this.ids.component).setValue(),$$(this.ids.component).unblockEvent(),$$(this.ids.reset).disable()}applyConnectFilter(e){const t={key:this.field.id,rule:"equals",value:e};this.datacollection.filterCondition({glue:"and",rules:[t]}),this.datacollection.reloadData(),$$(this.ids.reset).enable()}}class l extends(a()){component(e=!1){let t=new o(this);if(e){var i=t;t={ui:i.ui(),init:(e,t)=>i.init(this.AB,t),onShow:(...e)=>i.onShow?.(...e)}}return t}}},2715:(e,t,i)=>{const s=i(5132),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewContainerEditorComponent_component")},s={},r={rows:[{id:i.component,view:"dashboard",css:"ab-"+this.key+"-container",cellHeight:250,gridColumns:this.settings.columns||a.columns}]},o={template:e=>`<div>\n               <i class="fa fa-${e.icon} webix_icon_btn"></i> ${e.label}\n               <div class="ab-component-tools">\n               ${0==e.settings.removable?"":'<i class="fa fa-trash ab-component-remove"></i>'}\n               <i class="fa fa-edit ab-component-edit"></i>\n               </div></div>`,viewDelete:(t,s,a)=>{var r=this.views((e=>e.id==s))[0];if(!r)return!1;webix.confirm({title:n("Delete component"),text:n("Do you want to delete <b>{0}</b>?",[r.label]),callback:async t=>{if(t){o.busy();try{await r.destroy(),r.emit("destroyed",r);let e=$$(i.component);var a=e.queryView({name:s});a&&(e.blockEvent(),e.removeView(a),e.unblockEvent()),o.showEmptyPlaceholder()}catch(t){e.AB.notify.developer(t,{message:"Error trying to delete selected View:",view:r})}o.ready()}}}),t.preventDefault()},viewEdit:(t,i,s)=>{var a=this.views((e=>e.id==i))[0];return!!a&&(setTimeout((()=>{e.actions.populateInterfaceWorkspace(a)}),50),t.preventDefault(),!1)},onReorder:async()=>{o.busy();var t=$$(i.component).serialize(),s=[];this.views().forEach((e=>{var i=t.filter((t=>t.name==e.id))[0];i&&(e.position.x=i.x,e.position.y=i.y,e.position.x<0&&(e.position.x=0),e.position.y<0&&(e.position.y=0),s.push(e.save()))}));try{await Promise.all(s),await this.save(),o.ready()}catch(t){e.AB.notify.developer(t,{message:"Error trying to save selected View:",view:this.toObj()}),o.ready()}},showEmptyPlaceholder:()=>{var t=$$(i.component);0==t.getChildViews().length&&t.showOverlay("<div class='drop-zone'><div>"+e.labels.componentDropZone+"</div></div>")},validatePosition:(e,t,i)=>e<t?t:e>i?i:e,busy:()=>{let e=$$(i.component);e&&(e.disable(),e.showProgress&&e.showProgress({type:"icon"}))},ready:()=>{let e=$$(i.component);e&&(e.enable(),e.hideProgress&&e.hideProgress())}};return{ui:r,init:t=>{var a=$$(i.component);a&&(webix.extend(a,webix.OverlayBox),webix.extend(a,webix.ProgressBar)),this.viewsSortByPosition().forEach((t=>{var i=t.component(e);s[t.id]=i;let n="panel";0==t.settings.movable&&(n="scrollview"),a.addView({view:n,name:t.id,icon:"fa fa-arrows",css:"ab-widget-container",body:{rows:[{view:"template",height:30,css:"ab-widget-header",template:o.template(t),onClick:{"ab-component-edit":(e,i,s)=>{o.viewEdit(e,t.id,s)},"ab-component-remove":(e,i,s)=>{o.viewDelete(e,t.id,s)}}},i.ui]},dx:t.position.dx||1,dy:t.position.dy||1,x:o.validatePosition(t.position.x,0,a.config.gridColumns-1),y:t.position.y||0}),i.init(null,2)})),this._onChangeId&&a.detachEvent(this._onChangeId),this._onChangeId=a.attachEvent("onChange",(()=>{o.onReorder()})),o.showEmptyPlaceholder(),a.adjust()},logic:o,onShow:()=>{this.views().forEach((e=>{var t=s[e.id];t&&t.onShow&&t.onShow()}));let e=this.datacollection;e&&e.dataStatus==e.dataStatusFlag.notInitial&&e.loadData()}}}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.addColumnGravity=(e,s)=>{var a=$$(t.gravity).getParentView().index($$(t.gravity));$$(t.gravity).getParentView().addView({view:"counter",value:"1",min:1,label:n("Column {0} Gravity",[e]),labelWidth:this.AB.UISettings.config().labelWidthXLarge,css:"gravity_counter",on:{onChange:()=>{i.onChange()}}},a)},i.removeColumnGravity=(e,i)=>{$$(t.gravity).getParentView().removeView($$(t.gravity).getParentView().getChildViews()[$$(t.gravity).getParentView().index($$(t.gravity))-1])},a.concat([{name:"columns",view:"counter",min:1,label:n("Columns"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:function(e,s){e>8&&$$(t.columns).setValue(8),e>s?i.addColumnGravity(e,s):e<s&&i.removeColumnGravity(e,s)}}},{view:"text",name:"gravity",height:1}])}static propertyEditorPopulate(e,t,i,s){super.propertyEditorPopulate(e,t,i,s),this._App=e,$$(t.columns).setValue(i.settings.columns||a.columns),$$(t.gravity).getParentView().queryView({css:"gravity_counter"},"all").map((e=>$$(t.gravity).getParentView().removeView(e)));for(var r=1;r<=$$(t.columns).getValue();r++){var o=$$(t.gravity).getParentView().index($$(t.gravity));$$(t.gravity).getParentView().addView({view:"counter",min:1,label:n("Column {0} Gravity",[r]),labelWidth:this.AB.UISettings.config().labelWidthXLarge,css:"gravity_counter",value:i.settings.gravity&&i.settings.gravity[r-1]?i.settings.gravity[r-1]:a.gravity,on:{onChange:()=>{s.onChange()}}},o)}}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.columns=$$(e.columns).getValue();var i=[];$$(e.gravity).getParentView().queryView({css:"gravity_counter"},"all").map((e=>i.push($$(e).getValue()))),t.settings.gravity=i}static async propertyEditorSave(e,t){this.propertyEditorValues(e,t),await t.save(),t.emit("properties.updated",t);let i=t.editorComponent(this._App);await i.logic.onReorder()}component(e,t){var i="ABViewContainer_"+(t||"")+this.id,s={component:e.unique(`${i}_component`)};this.viewComponents=this.viewComponents||{};var n={changePage:e=>{this.changePage(e)},callbacks:{},getElements:i=>{var s,r=[];return i.forEach((i=>{let o=this.viewComponents[i.id];if(o=i.component(e,t),this.viewComponents[i.id]=o,"form"==i.key&&i._logic.callbacks&&(n.callbacks=i._logic.callbacks),null==i.position.y||i.position.y!=s){s=i.position.y||r.length;for(var l={cols:[]},u=this.settings.columns||a.columns,c=0;c<u;c++){var d=this.settings.gravity&&this.settings.gravity[c]?parseInt(this.settings.gravity[c]):a.gravity;l.cols.push({gravity:d})}r.push(l)}var h=r[r.length-1],p=i.position.x||0,m=1;h.cols[p]&&h.cols[p].gravity&&(m=h.cols[p].gravity),o.ui.gravity=m,h.cols[p]=o.ui,this.eventAdd({emitter:i,eventName:"changePage",listener:(...e)=>n.changePage(...e)})})),r}},r=this.viewsSortByPosition(),o=n.getElements(r);return{ui:{id:s.component,view:"layout",rows:o},init:(e,t=0)=>{if(e)for(var i in n.callbacks)n.callbacks[i]=e[i]||n.callbacks[i];for(var a in $$(s.component)&&$$(s.component).define("css","accessLevel-"+t),this.viewComponents){if(null==this.views((e=>e.id==a))[0])return;var r=this.viewComponents[a];t>0?r.init(e,t):$$(r.ui.id).hide()}},logic:n,onShow:()=>{let e=this.datacollection;e&&e.dataStatus==e.dataStatusFlag.notInitial&&e.loadData(),this.views().forEach((e=>{var t=this.viewComponents[e.id];t&&t.onShow&&t.onShow()}))}}}}},4411:(e,t,i)=>{const s=i(7446),a=i(5782).Z,n=s.defaultValues();let r=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{static propertyEditorDefaultElements(e,t,i,s){var n=super.propertyEditorDefaultElements(e,t,i,s);return this.linkPageComponent=a.propertyComponent(e,"ABViewDataviewPropertyEditor"),n.concat([{view:"counter",name:"xCount",min:1,label:r("Items in a row"),labelWidth:this.AB.UISettings.config().labelWidthLarge,step:1},this.linkPageComponent.ui])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.xCount).setValue(i.settings.xCount||n.xCount),this.linkPageComponent.viewLoad(i),this.linkPageComponent.setSettings(i.settings)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.xCount=$$(e.xCount).getValue();let i=this.linkPageComponent.getSettings();for(let e in i)t.settings[e]=i[e]}fromValues(e){super.fromValues(e),this.settings.detailsPage=this.settings.detailsPage||n.detailsPage,this.settings.editPage=this.settings.editPage||n.editPage,this.settings.detailsTab=this.settings.detailsTab||n.detailsTab,this.settings.editTab=this.settings.editTab||n.editTab}component(e){var t={},i="ABViewDataview_"+this.id,s={scrollview:e.unique(`${i}_scrollview`),component:e.unique(`${i}_component`),dataFlexView:e.unique(`${i}_dataFlexView`)};let a=this.linkPageHelper.component(e,i);return t.ui={id:s.component,rows:[{id:s.scrollview,view:"scrollview",scroll:"y",body:{id:s.dataFlexView,view:"flexlayout",paddingX:15,paddingY:19,type:"space",cols:[]},on:{onAfterScroll:function(){let e=this.getScrollState();t.logic.scroll(e)}}}]},this.settings.height&&(t.ui.height=this.settings.height),t.init=e=>{var i=this.datacollection;if(!i)return;let n=$$(s.dataFlexView);a.init({view:this,datacollection:i}),i.attachFlexlayout(n),i.on("initializingData",(()=>{t.logic.busy()})),i.on("initializedData",(()=>{t.logic.ready()})),i.on("loadData",(()=>{t.emptyView(),t.renderData()})),i.on("update",(()=>{t.emptyView(),t.renderData()})),i.on("delete",(()=>{t.emptyView(),t.renderData()})),i.on("create",(()=>{t.emptyView(),t.renderData()}))},t.logic={busy:()=>{let e=$$(s.dataFlexView),t=$$(s.scrollview);t&&e&&(e.disable(),t.showProgress||webix.extend(t,webix.ProgressBar),t.showProgress({type:"icon"}))},ready:()=>{let e=$$(s.dataFlexView),t=$$(s.scrollview);t&&e&&(e.enable(),t&&!t.hideProgress&&webix.extend(t,webix.ProgressBar),t.hideProgress())},toggleTab:(e,i)=>{var s=i.getTopParentView().queryView({id:e});if(null==s&&(s=$$(e)),null!=s){var a=s.getParentView().getParentView();if(null!=a){a.setValue&&a.setValue(e);var n=a.queryView({view:"scrollview"},"parent");n&&t.toggleTab(n,i)}}},scroll:async e=>{let i=e.y;if($$(s.dataFlexView).$height-$$(s.scrollview).$height-i<=40){if(this.loadMoreTimer)return;t.setYPos(i);var a=this.datacollection;if(!a)return;if($$(s.dataFlexView).getChildViews().length>=a.totalCount)return;t.logic.busy(),await a.loadData($$(s.dataFlexView).getChildViews().length||0),this.loadMoreTimer=setTimeout((()=>{this.loadMoreTimer=null}),1100)}}},t.onShow=()=>{var e=this.datacollection;e&&(e.dataStatus==e.dataStatusFlag.notInitial?e.loadData():e.dataStatus==e.dataStatusFlag.initialized&&t.renderData())},t.setYPos=e=>{this.yPosition=e},t.getYPos=()=>this.yPosition||0,t.emptyView=()=>{let e={id:s.dataFlexView,view:"flexlayout",type:"clean",padding:10,css:{background:"#ebedf0 !important"},cols:[]};webix.ui(e,$$(s.scrollview),$$(s.dataFlexView))},t.renderData=()=>{let i=this.settings.editPage,n=this.settings.detailsPage;this.settings.editTab,this.settings.detailsTab;var r=[],o=this.datacollection;if(!o)return void t.logic.ready();let l=$$(s.dataFlexView)||$$(s.component);if(!l||isNaN(l.$width))return void t.logic.ready();let u=Math.floor((l.$width-20-20*parseInt(this.settings.xCount))/parseInt(this.settings.xCount));var c=o.getData();if(l.currentLength==c.length)return void t.logic.ready();l.currentLength=c.length,this._startPos=l.getChildViews?l.getChildViews().length:0;let d=c.length;0==this._startPos?d=c.length:c.length-this._startPos>20&&(d=this._startPos+20),o.settings.loadAll&&(d=c.length);for(var h=this._startPos;h<d;h++){let t=e.AB.cloneDeep(super.component(e,c[h].id));t.ui.type="space",t.ui.css="ab-detail-view",(n||i)&&(t.ui.css+=" ab-detail-hover ab-record-"+c[h].id),n&&(t.ui.css+=" ab-detail-page"),i&&(t.ui.css+=" ab-edit-page"),t.ui.paddingX=10,t.ui.paddingY=6,t.ui.minWidth=u-10,t.ui.maxWidth=u,l.addView?(l.addView(t.ui,-1),t.init(null,2),setTimeout(t.logic.displayData(c[h]),0)):r.push(t.ui)}if(r.length){var p={id:s.dataFlexView,view:"flexlayout",paddingX:15,paddingY:19,type:"space",cols:r};webix.ui(p,$$(s.scrollview),$$(s.dataFlexView));for(let t=this._startPos;t<d;t++){let i=e.AB.cloneDeep(super.component(e,c[t].id));i.init(null,2),setTimeout(i.logic.displayData(c[t]),0)}}$$(s.scrollview)&&($$(s.scrollview).scrollTo(0,t.getYPos()),(n||i)&&(l.$view.onclick=e=>{var t=!1;if(i)for(let s of e.path)if(s.className&&s.className.indexOf("webix_accordionitem_header")>-1){t=!0,s.parentNode.parentNode.classList.forEach((e=>{if(e.indexOf("ab-record-")>-1){var t=e.replace("ab-record-","");a.changePage(i,t)}}));break}if(n&&!t)for(let t of e.path)if(t.className&&t.className.indexOf("webix_accordionitem")>-1){t.parentNode.parentNode.classList.forEach((e=>{if(e.indexOf("ab-record-")>-1){var t=e.replace("ab-record-","");a.changePage(n,t)}}));break}}));const m=this.name.replace(".dataview","");l.$view.setAttribute("data-cy",`dataview container ${m} ${this.id}`),l.getChildViews().forEach(((e,t)=>{const i=c[t+this._startPos].uuid,s=e.$view;s.querySelector(".webix_accordionitem_body").setAttribute("data-cy",`dataview item ${m} ${i} ${this.id}`),s.querySelector(".webix_accordionitem_button").setAttribute("data-cy",`dataview item button ${m} ${i} ${this.id}`)})),t.logic.ready()},t}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new a),this.__linkPageHelper}}},414:(e,t,i)=>{const s=i(2407),a=i(6711),n=i(8447),r=s.defaultValues();let o=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends s{editorComponent(e,t){var i=super.editorComponent(e,t);return i.ui.rows[0].cellHeight=75,i}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.selectSource=async(s,a)=>{i.busy();let n=i.currentEditObject();if(n.settings.dataviewID=s,n._views=[],this.propertyUpdateFieldOptions(t,n,s),n._views.length>0)return Promise.resolve();let r=[],o=$$(t.fields).find({});o.reverse(),o.forEach(((i,s)=>{if(!i.selected){let l=o.length-s-1;var a=n.addFieldToView(i,l,t,e);r.push(a.save()),i.selected=1,$$(t.fields).updateItem(i.id,i)}})),await Promise.all(r),await n.save(),n.emit("properties.updated",n),i.ready()},i.listTemplate=(e,t)=>`${t.markCheckbox(e)} ${e.label}`,i.check=async(s,a)=>{var n=i.currentEditObject(),r=$$(t.fields).getItem(a);if(r.selected=r.selected?0:1,$$(t.fields).updateItem(a,r),r.selected)await n.addFieldToView(r,null,t,e).save(),n.emit("properties.updated",n),await n.save();else{let e=n.views((e=>e.settings.fieldId==a))[0];e&&(await e.destroy(),n.emit("properties.updated",n))}},a.concat([{name:"datacollection",view:"richselect",label:o("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>i.selectSource(e,t)}},{name:"fields",view:"list",select:!1,minHeight:200,template:i.listTemplate,type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:(e,t)=>i.check(e,t)}},{name:"showLabel",view:"checkbox",label:o("Display Label"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"labelPosition",view:"richselect",label:o("Label Position"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"left",value:o("Left")},{id:"top",value:o("Top")}]},{name:"labelWidth",view:"counter",label:o("Label Width"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"height",label:o("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=$$(t.datacollection),n=i.settings.dataviewID||null,o=i.propertyDatacollections();s.define("options",o),s.define("value",n),s.refresh(),this.propertyUpdateFieldOptions(t,i,n),$$(t.showLabel).setValue(null!=i.settings.showLabel?i.settings.showLabel:r.showLabel),$$(t.labelPosition).setValue(i.settings.labelPosition||r.labelPosition),$$(t.labelWidth).setValue(parseInt(i.settings.labelWidth)||r.labelWidth),$$(t.height).setValue(i.settings.height>=0?i.settings.height:r.height),i.views().forEach((s=>{s instanceof a&&s.once("destroyed",(()=>this.propertyEditorPopulate(e,t,i)))}))}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue(),t.settings.labelWidth=$$(e.labelWidth).getValue(),t.settings.height=$$(e.height).getValue()}static propertyUpdateFieldOptions(e,t,i){var s=t.AB.datacollectionByID(i),a=s?s.datasource:null,n=[];null!=a&&(n=a.fields().map((e=>(e.selected=t.views((t=>e.id==t.settings.fieldId)).length>0,e)))),$$(e.fields).clearAll(),$$(e.fields).parse(n)}component(e,t){var i=super.component(e,t),s={type:"form",borderless:!0,rows:[{body:i.ui}]},a={displayData:i=>{i=i||{};let s=this.views()||[];s=s.sort(((e,t)=>e&&t&&e.field&&t.field?"formula"==e.field.key&&"calculate"==t.field.key?-1:"calculate"==e.field.key&&"formula"==t.field.key?1:0:0)),s.forEach((s=>{if(s.field){var a,r=s.field();if(!r)return;if(!i)return;switch(r.key){case"connectObject":case"user":a=r.pullRelationValues(i);break;case"list":if(!(a=i[r.columnName])){a="";break}if(0==r.settings.isMultiple){let e="";if(r.settings.options.forEach((function(t){t.id==a&&(e=t.text)})),r.settings.hasColors){let t="#66666",i="";r.settings.options.forEach((function(s){s.text==e&&(t=s.hex,i="hascustomcolor")})),e=`<span class="webix_multicombo_value ${i}" style="background-color: ${t} !important;"><span>${e}</span></span>`}a=e}else{let e=[],t="";a.forEach((i=>{var s="",a="";r.settings.hasColors&&i.hex&&(s="hascustomcolor",a=`background: ${i.hex};`),r.settings.options.forEach((function(e){e.id==i.id&&(t=e.text)})),e.push(`<span class="webix_multicombo_value ${s}" style="${a}" optvalue="${i.id}"><span>${t}</span></span>`)})),a=e.join("")}break;case"file":a=i[r.columnName];break;case"formula":if(i){let e=this.datacollection,t=e?e.datasource:null,s=!(!t||t instanceof n);a=r.format(i,s)}break;default:a=r.format(i)}}var o=s.component(e,t);o.logic&&o.logic.setValue&&o.logic.setValue(a),o.logic&&o.logic.displayText&&o.logic.displayText(i)}))}};return{ui:s,init:(e,t)=>{i.init(e,t)},logic:a,onShow:()=>{i.onShow();try{const e=`Detail ${this.name.split(".")[0]} ${this.id}`;$$(i.ui.id).$view.setAttribute("data-cy",e)}catch(e){console.warn("Problem setting data-cy",e)}let e=this.datacollection;if(e){let t=e.getCursor();t&&a.displayData(t),this.eventAdd({emitter:e,eventName:"changeCursor",listener:e=>{a.displayData(e)}}),this.eventAdd({emitter:e,eventName:"create",listener:t=>{let i=e.getCursor();i&&i.id==t.id&&a.displayData(t)}}),this.eventAdd({emitter:e,eventName:"update",listener:t=>{let i=e.getCursor();i&&i.id==t.id&&a.displayData(t)}})}}}}clearFieldComponents(){let e=[];return this.views().forEach((t=>{e.push((()=>t.destroy()))})),e.reduce(((e,t)=>e.then(t)),Promise.resolve([]))}addFieldToView(t,i,s,a){if(null==t)return;let n=t.detailComponent().newInstance(this.application,this);return null!=n?(n.settings=n.settings||{},n.settings.fieldId=t.id,n.settings.labelWidth=this.settings.labelWidth||r.labelWidth,n.settings.alias=t.alias,n.position.y=i,this._views.push(n),n.once("destroyed",(()=>{e.propertyEditorPopulate(a,s,this)})),n):void 0}}},8990:(e,t,i)=>{const s=i(4044);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewDetailCheckboxEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t)}component(e,t){var i=super.component(e),s=this.field(),a="ABViewDetailCheckbox_"+(t||"")+this.id,n={component:e.unique(`${a}_component`),detail:this.parentDetailComponent()?.id||this.parent.id};return i.ui.id=n.component,i.ui.on={onAfterRender:()=>{const e=`detail checkbox ${s?.columnName} ${s?.id} ${n.detail}`;$$(n.component)?.$view.setAttribute("data-cy",e)}},{ui:i.ui,init:i.init,logic:{setValue:e=>{var t;t=e&&JSON.parse(e)?'<span class="check webix_icon fa fa-check-square-o"></span>':'<span class="check webix_icon fa fa-square-o"></span>',i.logic.setValue(n.component,t)}}}}}},6711:(e,t,i)=>{const s=i(9809);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"fieldLabel",view:"text",disabled:!0,label:a("Field")}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=i.field();s&&$$(t.fieldLabel).setValue(s.label)}component(e,t){var i="ABViewDetailComponent_"+(t||"")+this.id,s={component:e.unique(`${i}_component`)},a=this.detailComponent(),n=this.field()||{},r={};a&&(r=a.settings);var o=!1;n&&"user"==n.key&&(o=!0);var l=(1==r.showLabel?"top"==r.labelPosition?"<label style='display:block; text-align: left;' class='webix_inp_top_label'>#label#</label>#display#":"<label style='width: #width#px; display: inline-block; float: left; line-height: 32px;'>#label#</label><div class='ab-detail-component-holder' style='margin-left: #width#px;'>#display#</div>":"#display#").replace(/#width#/g,r.labelWidth).replace(/#label#/g,n?n.label:""),u=38;return"top"==r.labelPosition&&(u*=2),n&&n.settings&&void 0!==n.settings.useHeight&&1==n.settings.useHeight&&(u=parseInt(n.settings.imageHeight)||u),{ui:{id:s.component,view:"template",borderless:!0,height:u,isUsers:o,template:l,data:{display:""}},init:e=>{},logic:{setValue:(e,t)=>{$$(e)&&("string"==n.key||"LongText"==n.key?t=t.replace(/[<]/g,"&lt;"):"user"==n.key&&(t=t.text??t.value??t.username??t),$$(e).setValues({display:t}))}}}}}},7855:(e,t,i)=>{const s=i(6497),a=i(5751).Z;e.exports=class extends s{fromValues(e){super.fromValues(e),this.addPageTool.fromSettings(this.settings)}static propertyEditorDefaultElements(e,t,i,s){let n=super.propertyEditorDefaultElements(e,t,i,s);return null==this.addPageProperty&&(this.addPageProperty=a.propertyComponent(e,"ABViewDetailConnectPropertyEditor"),this.addPageProperty.init({onSave:()=>{let e=i.currentEditObject();e&&(this.propertyEditorValues(t,e),this.propertyEditorSave(t,e))}})),n.concat([this.addPageProperty.ui])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),this.addPageProperty.setSettings(i,i.settings)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings=this.addPageProperty.getSettings(t),t.addPageTool.fromSettings(t.settings)}component(e,t){let i="ABViewDetailConnect_"+(t||"")+this.id,s=super.component(e,i);var a=this.parentDetailComponent()?.id||this.parent.id;let n=this.addPageTool.component(e,i);s.ui.on={onAfterRender:()=>{let e=this.field((e=>e.id==this.settings.fieldId));if(e?.columnName){const t=`detail connected ${e.columnName} ${this.settings.fieldId} ${a}`;$$(s.ui.id)?.$view.setAttribute("data-cy",t)}}};let r={};return n.ui?(n.ui.click=(e,t,i)=>{let s,a=this.detailComponent();return a&&(s=a.datacollection),setTimeout((()=>{n.onClick(s)}),50),!1},r={rows:[{cols:[s.ui,n.ui]}]}):r=s.ui,{ui:r,init:e=>{s.init(e),n.applicationLoad(this.application),n.init({})},logic:{setValue:e=>{let t=[];Array.isArray(e)?e.forEach((e=>{t.push(`<span class="webix_multicombo_value">${e.text}</span>`)})):t.push(`<span class="webix_multicombo_value">${e.text}</span>`),s.logic.setValue(s.ui.id,t.join(""))}}}}get addPageTool(){return null==this.__addPageTool&&(this.__addPageTool=new a),this.__addPageTool}}},2885:(e,t,i)=>{const s=i(8276);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewDetailCustomEditorComponent_component")},s=this.component(e),a=s.ui;return a.id=i.component,{ui:{rows:[a,{}]},init:s.init,logic:s.logic,onShow:s.onShow}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t)}component(e,t){var i=super.component(e),s=this.field(),a=this.detailComponent(),n="ABViewDetailCustom_"+(t||"")+this.id,r={component:e.unique(`${n}_component`),detail:this.parentDetailComponent()?.id||this.parent.id},o="";1==a.settings.showLabel&&(o="top"==a.settings.labelPosition?"<label style='display:block; text-align: left;' class='webix_inp_top_label'>#label#</label>":"<label style='width: #width#px; display: inline-block; float: left; line-height: 32px;'>#label#</label>");var l=(o+"#result#").replace(/#width#/g,a.settings.labelWidth).replace(/#label#/g,s?s.label:"").replace(/#result#/g,s?s.columnHeader().template({}):"");return i.ui.id=r.component,i.ui.view="template",i.ui.minHeight=45,i.ui.height=60,i.ui.borderless=!0,i.ui.template=l,i.ui.on={onAfterRender:()=>{const e=`detail custom ${s?.columnName} ${s?.id} ${r.detail}`;$$(r.component)?.$view.setAttribute("data-cy",e)}},i.init=e=>{},i.onShow=()=>{if(s){var t=$$(r.component);if(t){var i=this.detailComponent().datacollection.getCursor()||{},a=t.$view;s.customDisplay(i,e,a,{editable:!1})}}},i.logic.setValue=e=>{if(s){var t=$$(r.component);if(t){var i={};i[s.columnName]=e,s.setValue(t,i)}}},i}}},9903:(e,t,i)=>{const s=i(1597),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewDetailImageEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{view:"counter",name:"height",label:n("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"width",label:n("Width:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.height).setValue(i.settings.height||a.height),$$(t.width).setValue(i.settings.width||a.width)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.height=$$(e.height).getValue(),t.settings.width=$$(e.width).getValue()}component(e,t){var i=super.component(e),s=this.field(),a=`ABViewDetailImage_${t||""}${this.id}`,n={component:e.unique(`${a}_component`),detail:this.parentDetailComponent()?.id||this.parent.id},r=s?s.settings.defaultImageUrl:"";i.ui.id=n.component,this.settings.height&&(i.ui.height=this.settings.height),i.ui.on={onAfterRender:()=>{const e=`detail image ${s?.columnName} ${s?.id} ${n.detail}`;$$(n.component)?.$view.setAttribute("data-cy",e)}};var o={setValue:e=>{var t="";if(e||!e&&r){let i=s.urlImage(e||r),a=s&&s.settings.imageWidth?`${s.settings.imageWidth}px`:"200px",n=s&&s.settings.imageHeight?`${s.settings.imageHeight}px`:"100%";this.settings.height&&(n=`${this.settings.height}px`),this.settings.width&&(a=`${this.settings.width}px`),t=`<div class="ab-image-data-field"><div style="float: left; background-size: cover; background-position: center center; background-image:url('${i}');  width: ${a}; height: ${n}; position:relative;"><a href="${i}" target="_blank" title="" class="fa fa-download ab-image-data-field-download"></a></div></div>`}i.logic.setValue(n.component,t)}};return{ui:i.ui,init:i.init,logic:o}}}},2011:(e,t,i)=>{const s=i(9207),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewDetailTextEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{view:"counter",name:"height",label:n("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.height).setValue(i.settings.height||a.height)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.height=$$(e.height).getValue()}component(e,t){var i=super.component(e),s=this.field(),a="ABViewDetailText_"+(t||"")+this.id,n={component:e.unique(`${a}_component`),detail:this.parentDetailComponent()?.id||this.parent.id};return i.ui.id=n.component,i.ui.css="ab-text",this.settings.height&&(i.ui.height=this.settings.height),i.ui.on={onAfterRender:()=>{const e=`detail text ${s?.columnName} ${s?.id} ${n.detail}`;$$(n.component)?.$view.setAttribute("data-cy",e)}},{ui:i.ui,init:i.init,logic:{setValue:e=>{i.logic.setValue(n.component,e)}}}}}},3216:(e,t,i)=>{let s=i(7716);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewDetailTreeEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t)}component(e,t){var i=super.component(e),s=this.field(),a=(this.detailComponent(),`ABViewDetailTree_${t||""}${this.id}`),n={component:e.unique(`${a}_component`)},r="ab-detail-tree";i.ui.id=n.component;var o={getDomTree:()=>{var e=$$(n.component);if(e)return e.$view.getElementsByClassName(r)[0]},setValue:e=>{null==e||e instanceof Array||(e=[e]),setTimeout((function(){var t=o.getDomTree();if(!t)return!1;var i=[];void 0===s.settings.options.data&&(s.settings.options=new webix.TreeCollection({data:s.settings.options})),s.settings.options.data.each((function(t){if(null!=e&&-1!=e.indexOf(t.id)){for(var a="",n=t.id;this.getParentId(n);)s.settings.options.data.each((function(e){s.settings.options.data.getParentId(n)==e.id&&(a=e.text+": "+a)})),n=this.getParentId(n);a+=t.text,i.push(a)}}));var a="<div class='list-data-values'>";i.forEach((function(e){a+='<span class="selectivity-multiple-selected-item rendered" style="background-color:#4CAF50 !important;">'+e+"</span>"})),a+="</div>",t.innerHTML=a;var r=33;t.scrollHeight>33&&(r=t.scrollHeight),$$(n.component).config.height=r,$$(n.component).resize()}),50)}};return{ui:i.ui,init:e=>{i.init(e);var t=`<div class="${r}"></div>`;i.logic.setValue(n.component,t)},logic:o}}}},4804:(module,__unused_webpack_exports,__webpack_require__)=>{const ABViewDocxBuilderCore=__webpack_require__(4107),ABFieldConnect=__webpack_require__(6589),ABFieldImage=__webpack_require__(780),ABObjectQuery=__webpack_require__(8447),Docxtemplater=__webpack_require__(9590),ImageModule=__webpack_require__(2824),JSZipUtils=__webpack_require__(5863),JSZip=__webpack_require__(1290),ABViewDocxBuilderPropertyComponentDefaults=ABViewDocxBuilderCore.defaultValues();let L=(...e)=>AB.Multilingual.label(...e);function letUserDownload(e,t){let i=window.URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=t,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(i)}module.exports=class ABViewDocxBuilder extends ABViewDocxBuilderCore{editorComponent(e,t){return this.component(e,"ABViewDocxBuilderEditorComponent")}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);i.validateType=e=>{var s=["docx"],a=e.type.toLowerCase();if(-1==s.indexOf(a))return webix.message("Only ["+s.join(", ")+"] files are supported"),!1;{let e=i.currentEditObject().uploadUrl();return $$(t.docxFile).define("upload",e),$$(t.docxFile).refresh(),!0}},i.uploadedFile=e=>{if(!e||!e.data)return;let s=i.currentEditObject();s.settings.filename=e.data.uuid,s.filelabel=e.name,$$(t.filelabel).setValue(s.filelabel),$$(t.docxDownload).show()},i.downloadFile=()=>{let e=i.currentEditObject(),t=e.downloadUrl();fetch(t).then((e=>e.blob())).then((t=>{letUserDownload(t,e.filelabel)}))};var n=e.AB.Multilingual.languages().map((e=>({id:e.language_code,value:e.language_label})));return $$(t.language).define("options",n),$$(t.language).refresh(),a.concat([{view:"fieldset",label:L("Data:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"datacollection",view:"multicombo",label:L("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge}]}},{view:"fieldset",label:L("Template file:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:L("DOCX file:"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthXLarge},{view:"uploader",value:L("Upload"),name:"docxFile",apiOnly:!0,inputName:"file",multiple:!1,on:{onBeforeFileAdd:e=>i.validateType(e),onFileUpload:(e,t)=>{i.uploadedFile(e)},onFileUploadError:(e,t)=>{}}}]},{name:"filelabel",view:"text",label:L("Filename"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"docxDownload",view:"button",type:"icon",css:"webix_primary",icon:"fa fa-file-word-o",label:L("Download Template File"),click:()=>{i.downloadFile()}}]}},{view:"fieldset",label:L("Language:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"language",view:"richselect",label:L("Language"),labelWidth:this.AB.UISettings.config().labelWidthLarge}]}},{view:"fieldset",label:L("Customize Display:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"buttonlabel",view:"text",label:L("Label"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{view:"counter",name:"width",label:L("Width:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{view:"richselect",name:"toolbarBackground",label:L("Page background:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"ab-background-default",value:L("White (default)")},{id:"webix_dark",value:L("Dark")},{id:"ab-background-lightgray",value:L("Gray")}]},{view:"richselect",name:"buttonPosition",label:L("Button Position:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"left",value:L("Left (default)")},{id:"center",value:L("Centered")},{id:"right",value:L("Right")}]}]}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);let s=$$(t.datacollection),a=i.settings.dataviewID?i.settings.dataviewID:null;$$(t.toolbarBackground).setValue(i.settings.toolbarBackground||ABViewDocxBuilderPropertyComponentDefaults.toolbarBackground),$$(t.buttonPosition).setValue(i.settings.buttonPosition||ABViewDocxBuilderPropertyComponentDefaults.buttonPosition);let n=i.AB.datacollections().map((e=>({id:e.id,value:e.label})));s.define("options",n),s.define("value",a),s.refresh(),$$(t.language).setValue(i.settings.language||ABViewDocxBuilderPropertyComponentDefaults.language),$$(t.filelabel).setValue(i.filelabel||i.settings.filelabel),$$(t.buttonlabel).setValue(i.buttonlabel||i.settings.buttonlabel),$$(t.width).setValue(i.settings.width),i.settings.filename?$$(t.docxDownload).show():$$(t.docxDownload).hide()}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.buttonlabel=$$(e.buttonlabel).getValue(),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.width=$$(e.width).getValue(),t.filelabel=$$(e.filelabel).getValue(),t.settings.language=$$(e.language).getValue(),t.settings.toolbarBackground=$$(e.toolbarBackground).getValue(),t.settings.buttonPosition=$$(e.buttonPosition).getValue()}component(App){let baseCom=super.component(App);var idBase="ABViewDocxBuilder_"+this.id,ids={button:App.unique(`${idBase}_button`),noFile:App.unique(`${idBase}_noFile`)},autowidth=!1,buttonWidth=this.settings.width||ABViewDocxBuilderPropertyComponentDefaults.width;0==buttonWidth&&(autowidth=!0);var leftSpacer={type:"spacer",width:1},rightSpacer={type:"spacer",width:1},buttonPos=this.settings.buttonPosition||ABViewDocxBuilderPropertyComponentDefaults.buttonPosition;"left"==buttonPos?rightSpacer={type:"spacer"}:"center"==buttonPos?(leftSpacer={type:"spacer"},rightSpacer={type:"spacer"}):"right"==buttonPos&&(leftSpacer={type:"spacer"});var buttonLabelText=this.buttonlabel||this.settings.buttonlabel;buttonLabelText||(buttonLabelText=ABViewDocxBuilderPropertyComponentDefaults.buttonlabel);var _ui={view:"toolbar",css:this.settings.toolbarBackground||ABViewDocxBuilderPropertyComponentDefaults.toolbarBackground,cols:[leftSpacer,{id:ids.button,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-file-word-o",label:buttonLabelText,width:this.settings.width||ABViewDocxBuilderPropertyComponentDefaults.width,autowidth,click:()=>{_logic.renderFile()},on:{onAfterRender:()=>{const e=`docx download ${this.name.replace(".docxBuilder","")} ${this.id}`;$$(ids.button)?.$view.querySelector("button").setAttribute("data-cy",e)}}},{id:ids.noFile,view:"label",label:L("No template file")},{type:"spacer"},rightSpacer]},_init=e=>{let t=$$(ids.button),i=$$(ids.noFile);this.settings.filename?(t.show(),i.hide()):(t.hide(),i.show())};let _logic={busy:()=>{let e=$$(ids.button);e&&(e.disable(),e.define("icon","fa fa-refresh fa-spin"),e.refresh())},ready:()=>{let e=$$(ids.button);e&&(e.enable(),e.define("icon","fa fa-file-word-o"),e.refresh())},onShow:e=>{let t=[];this.datacollections.forEach((e=>{e&&e.dataStatus==e.dataStatusFlag.notInitial&&t.push(e.loadData())})),t.length>0&&_logic.busy(),Promise.all(t).catch((e=>console.error(e))).then((()=>{_logic.ready()}))},renderFile:()=>{_logic.busy();let reportValues={},images={},summaries={};Promise.resolve().then((()=>{let e=this.datacollections,t=e.length>1;return e.forEach((e=>{if(null==e)return;let i=e.datasource;if(null==i)return;let s=[],a=[],n=e.getCursor();if(n){let t=e.getCursor(!0);a.push(App.AB.merge({},n,t))}else a=App.AB.cloneDeep(e.getData());let r=i.multilingualFields(),o=(e,t,i,s=[])=>{let a=null;if(t.id=e.id,t[`${i.columnName}_ORIGIN`]=e[i.columnName],r.length){let t=(r||[]).filter((t=>null!=e[t]));this.translate(e,e,t,this.languageCode)}i instanceof ABFieldConnect?(a=e[i.columnName],a&&a.forEach&&a.forEach((e=>{null!=e&&(i.datasourceLink&&i.datasourceLink.fields((e=>!e.isConnection)).forEach((t=>{e[`${t.columnName}_ORIGIN`]=e[t.columnName],e[t.columnName]=t.format(e,{languageCode:this.languageCode})})),e&&"object"==typeof e&&(e._object=i.datasourceLink))}))):a=i.format(e,{languageCode:this.languageCode}),s.forEach((e=>{a?t[e]=a:t[e]||(t[e]="")})),e.data&&e.data.length&&(t.data=t.data||[],(e.data||[]).forEach(((e,a)=>{null==t.data[a]&&(t.data[a]={}),o(e,t.data[a],i,s)})))};a.forEach((e=>{let t={};t._object=i,i.fields().forEach((s=>{let a=[];i instanceof ABObjectQuery?("string"==typeof s.object.translations&&(s.object.translations=JSON.parse(s.object.translations)),"string"==typeof s.translations&&(s.translations=JSON.parse(s.translations)),(s.object.translations||[]).forEach((e=>{let t=(s.translations||[]).filter((t=>t.language_code==e.language_code))[0];if(!t)return;let i=e.label,n=t.label;a.push(`${i}.${n}`)}))):("string"==typeof s.translations&&(s.translations=JSON.parse(s.translations)),s.translations.forEach((e=>{a.push(e.label)}))),o(e,t,s,a)})),s.push(t)}));let l=s.length>1?s:s[0];t||Array.isArray(l)&&l.length>1?(e.translations||[]).forEach((e=>{reportValues[e.label]=l})):reportValues=l})),Promise.resolve()})).then((()=>{console.log("DOCX data: ",reportValues);let e=[],t=(i,s=[])=>{s.forEach((s=>{let a=i.format(s);a&&!images[a]&&e.push(new Promise(((e,t)=>{let s=i.urlImage(a);JSZipUtils.getBinaryContent(s,(function(i,s){if(i)return t(i);images[a]=s,e()}))}))),t(i,s.data||[])}))};return this.datacollections.forEach((e=>{if(!e)return;let i=e.datasource;if(!i)return;let s=e.getCursor();if(s){let t=e.getCursor(!0);s=[App.AB.merge({},s,t)]}else s=e.getData();i.fields((e=>e instanceof ABFieldImage)).forEach((e=>{t(e,s)}))})),Promise.all(e)})).then((()=>new Promise(((e,t)=>{let i=this.downloadUrl();JSZipUtils.getBinaryContent(i,((i,s)=>{if(i)return t(i);e(s)}))})))).then((content=>new Promise(((next,err)=>{let zip=new JSZip(content),doc=new Docxtemplater,imageModule=new ImageModule({centered:!1,getImage:(e,t)=>images[e]||"",getSize:(e,t,i)=>{let s=[300,160],a=this.datacollection;if(a){let e=a.datasource;if(!e)return s;if(i.indexOf(".")>-1){let t=i.split(".");if(e=e.objects((e=>e.label==t[0]))[0],!e)return s;i=t[1]}let t=e.fields((e=>e.columnName==i))[0];return t&&t.settings?(t.settings.useWidth&&t.settings.imageWidth&&(s[0]=t.settings.imageWidth),t.settings.useHeight&&t.settings.imageHeight&&(s[1]=t.settings.imageHeight),s):s}{let e=this.datacollections;return e?(e.forEach((e=>{let t=e.datasource;if(!t)return!1;if(i.indexOf(".")>-1){let e=i.split(".");if(!t.objects)return!1;if(t=t.objects((t=>t.label==e[0]))[0],!t)return!1;i=e[1]}let a=t.fields((e=>e.columnName==i))[0];return!(!a||!a.settings||(a.settings.useWidth&&a.settings.imageWidth&&(s[0]=a.settings.imageWidth),a.settings.useHeight&&a.settings.imageHeight&&(s[1]=a.settings.imageHeight),1))})),s):s}}});try{doc.attachModule(imageModule).loadZip(zip).setData(reportValues).setOptions({parser:function(tag){return{get:function(scope,context){if(0==tag.indexOf("data|")){let e=(tag.split("|")[1]||"").trim();return(scope.data||[]).filter((function(t){return!!t[e]}))}if(tag.indexOf("|$sum?")>-1){let e=tag.split("|$sum?")[0],t=tag.split("|$sum?")[1],i=scope[e];return"string"==typeof i&&(i=i.replace(/[^\d.]/g,"")),null==summaries[t]&&(summaries[t]=0),summaries[t]+=parseFloat(i),scope[e]}if(0==tag.indexOf("$sum?")){let e=tag.replace("$sum?","");return summaries[e]||0}if(0==tag.indexOf("$")){let e=tag.replace("$","").split("|"),t=e[0].trim(),i=e[1].trim(),s;if(!t||!i)return"";let a=scope._object;if(a){let e=a.fields((e=>e.columnName==i))[0];if(e){let t=e.indexField;s=t?t.columnName:null}}let n=reportValues[t];n&&!Array.isArray(n)&&(n=[n]);let r=e=>e[`${s}_ORIGIN`]||e[s]||e.id||e;return(n||[]).filter((function(e){let t=scope[i];return Array.isArray(t)?t.filter((t=>r(t)==r(e))).length>0:r(e)==r(t)}))}if(tag.indexOf("?")>-1){let result=scope,prop=tag.split("?")[0],condition=tag.split("?")[1];if(prop&&condition){let data=scope[prop];if(data)return Array.isArray(data)||(data=[data]),data.filter((d=>eval(condition.replace(/\./g,"d."))))}return result}return"."===tag?scope:scope[tag]}}}}).render()}catch(e){return err(e)}var docxFile=doc.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});next(docxFile)})))).then((e=>new Promise(((t,i)=>{letUserDownload(e,this.filelabel),t()})))).then((()=>{_logic.ready()}))}};return{ui:_ui,init:_init,logic:_logic,onShow:_logic.onShow}}}},704:(e,t,i)=>{const s=i(6980),a=i(5651),n=i(9662),r=i(6311),o=i(3787),l=i(8386),u=i(8167),c=i(6204),d=i(1567);let h=null,p=null;const m=s.defaultValues();let f=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i=super.editorComponent(e,t);return i.ui.rows[0].cellHeight=75,i}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s),n="ABViewForm";return h=new c,h.component(e,`${n}_recordrule`),p=new d,p.component(e,`${n}_submitrule`),i.selectSource=(s,a)=>{i.busy();let n=i.currentEditObject(),r=n.parentFormComponent();n.settings.dataviewID=s;var o=n._views;return n._views=[],Promise.resolve().then((()=>{var e=[];return o.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(i.busy(),this.propertyUpdateFieldOptions(t,n,s),n._views.length>0)return Promise.resolve();let a=[],o=$$(t.fields).find({});o.reverse(),o.forEach(((i,s)=>{if(!i.selected){let r=o.length-s-1,l=n.addFieldToForm(i,r);l&&(l.once("destroyed",(()=>this.propertyEditorPopulate(e,t,n))),a.push(l.save())),i.selected=1,$$(t.fields).updateItem(i.id,i)}}));let l=r.refreshDefaultButton(t);return l&&a.push(l.save()),Promise.all(a)})).then((()=>n.save())).then((()=>(r.emit("properties.updated",n),this.propertyUpdateRules(t,n,s),i.ready(),Promise.resolve())))},i.listTemplate=(e,t)=>{let s=i.currentEditObject();var a=e.formComponent();if(null==a)return"<i class='fa fa-times'></i>  #label# <div class='ab-component-form-fields-component-info'> Disable </div>".replace("#label#",e.label);var n=a.common().key,r=s.application.viewAll((e=>e.common().key==n))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${r?r.common().icon:"fw"}'></i> ${r?f(r.common().labelKey):""} </div>`},i.check=(s,a)=>{let n=i.currentEditObject(),r=n.parentFormComponent(),o=$$(t.fields).getItem(a);o.selected=o.selected?0:1,$$(t.fields).updateItem(a,o);let l=()=>{r.refreshDefaultButton(t).save().then((()=>{n.emit("properties.updated",n)}))};if(o.selected){let i=n.addFieldToForm(o);i&&i.save().then((()=>{i.once("destroyed",(()=>this.propertyEditorPopulate(e,t,n))),n.save().then((()=>{l()}))}))}else{let e=r.fieldComponents().filter((e=>e.settings.fieldId==a))[0];e&&e.destroy().then((()=>{l()}))}},i.displayRuleShow=()=>{},i.displayRuleSave=()=>{},i.recordRuleShow=()=>{var e=i.currentEditObject(),t=e.datacollection;t&&h.objectLoad(t.datasource),h.formLoad(e),h.fromSettings(e.settings.recordRules),h.show(),h.qbFixAfterShow()},i.recordRuleSave=e=>{var s=i.currentEditObject();s.settings.recordRules=e,this.propertyEditorSave(t,s),this.populateBadgeNumber(t,s)},i.submitRuleShow=()=>{var e=i.currentEditObject();p.fromSettings(e.settings.submitRules),p.show()},i.submitRuleSave=e=>{var s=i.currentEditObject();s.settings.submitRules=e,this.propertyEditorSave(t,s),this.populateBadgeNumber(t,s)},h.init({onSave:i.recordRuleSave}),p.init({onSave:i.submitRuleSave}),a.concat([{name:"datacollection",view:"richselect",label:f("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,skipAutoSave:!0,on:{onChange:i.selectSource}},{view:"fieldset",label:f("Form Fields:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"fields",view:"list",select:!1,minHeight:200,template:i.listTemplate,type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:i.check}}]}},{name:"showLabel",view:"checkbox",label:f("Display Label"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"labelPosition",view:"richselect",label:f("Label Position"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"left",value:f("Left")},{id:"top",value:f("Top")}]},{name:"labelWidth",view:"counter",label:f("Label Width"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"height",label:f("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"clearOnLoad",view:"checkbox",label:f("Clear on load"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"clearOnSave",view:"checkbox",label:f("Clear on save"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"fieldset",label:f("Rules:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:f("Submit Rules:"),width:this.AB.UISettings.config().labelWidthLarge},{view:"button",css:"webix_primary",name:"buttonSubmitRules",label:f("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.submitRuleShow()}}]},{cols:[{view:"label",label:f("Display Rules:"),width:this.AB.UISettings.config().labelWidthLarge},{view:"button",name:"buttonDisplayRules",css:"webix_primary",label:f("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.displayRuleShow()}}]},{cols:[{view:"label",label:f("Record Rules:"),width:this.AB.UISettings.config().labelWidthLarge},{view:"button",name:"buttonRecordRules",css:"webix_primary",label:f("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.recordRuleShow()}}]}]}}])}static propertyEditorPopulate(e,t,i,s){super.propertyEditorPopulate(e,t,i,s);var a=i.parentFormComponent(),n=a.settings.dataviewID?a.settings.dataviewID:null,r=$$(t.datacollection),l=i.propertyDatacollections((e=>{var t=e.datasource;return"object"==e.sourceType&&t&&!t.isImported}));r.define("options",l),r.define("value",n),r.refresh(),this.propertyUpdateFieldOptions(t,i,n),i.views().forEach((s=>{s instanceof o&&s.once("destroyed",(()=>this.propertyEditorPopulate(e,t,i)))})),r.enable(),$$(t.showLabel).setValue(i.settings.showLabel),$$(t.labelPosition).setValue(i.settings.labelPosition||m.labelPosition),$$(t.labelWidth).setValue(i.settings.labelWidth||m.labelWidth),$$(t.height).setValue(i.settings.height||m.height),$$(t.clearOnLoad).setValue(i.settings.clearOnLoad||m.clearOnLoad),$$(t.clearOnSave).setValue(i.settings.clearOnSave||m.clearOnSave),this.propertyUpdateRules(t,i,n),this.populateBadgeNumber(t,i),this.updateEventIds=this.updateEventIds||{},this.updateEventIds[i.id]||(this.updateEventIds[i.id]=!0,i.addListener("properties.updated",(()=>{this.populateBadgeNumber(t,i)})))}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue()||m.labelPosition,t.settings.labelWidth=$$(e.labelWidth).getValue()||m.labelWidth,t.settings.height=$$(e.height).getValue(),t.settings.clearOnLoad=$$(e.clearOnLoad).getValue(),t.settings.clearOnSave=$$(e.clearOnSave).getValue()}static propertyUpdateFieldOptions(e,t,i){var s=t.parentFormComponent().fieldComponents(),a=t.AB.datacollectionByID(i),n=a?a.datasource:null,r=[];null!=n&&(r=n.fields().map((e=>(e.selected=s.filter((t=>e.id==t.settings.fieldId)).length>0,e)))),$$(e.fields).clearAll(),$$(e.fields).parse(r)}static propertyUpdateRules(e,t,i){if(t){var s=t.datacollection;s&&(h.objectLoad(s.datasource),p.objectLoad(s.datasource)),h.formLoad(t),p.formLoad(t)}}static populateBadgeNumber(e,t){t&&(t.settings.submitRules?($$(e.buttonSubmitRules).define("badge",t.settings.submitRules.length||null),$$(e.buttonSubmitRules).refresh()):($$(e.buttonSubmitRules).define("badge",null),$$(e.buttonSubmitRules).refresh()),t.settings.displayRules?($$(e.buttonDisplayRules).define("badge",t.settings.displayRules.length||null),$$(e.buttonDisplayRules).refresh()):($$(e.buttonDisplayRules).define("badge",null),$$(e.buttonDisplayRules).refresh()),t.settings.recordRules?($$(e.buttonRecordRules).define("badge",t.settings.recordRules.length||null),$$(e.buttonRecordRules).refresh()):($$(e.buttonRecordRules).define("badge",null),$$(e.buttonRecordRules).refresh()))}component(e){this.App=e;var t="ABViewForm_"+this.id;this.uniqueInstanceID=webix.uid();var i=i=>e.unique(`${t}_${i}_${this.uniqueInstanceID}`),s={component:i("_component"),layout:i("_form_layout"),filterComplex:i("_filter_complex")},a=super.component(e),l=[],c=[],d=this.datacollection?.datasource??this._currentObject;if(d){var h=this.fieldComponents();d.fields().forEach((e=>{h.filter((t=>e.id==t.settings.fieldId))[0]&&e.settings.validationRules&&("string"==typeof e.settings.validationRules&&(e.settings.validationRules=JSON.parse(e.settings.validationRules)),e.settings.validationRules.forEach((t=>{var i=this.AB.filterComplexNew(`${e.columnName}_${webix.uid()}`);c.push(i.ui),l.push({filter:i,view:i.ids.querybuilder,columnName:e.columnName,validationRules:t.rules,invalidMessage:t.invalidMessage})})))}))}var p=[{hidden:!0,rows:c}],m={id:s.component,view:"form",abid:this.id,rows:a.ui.rows.concat(p)};this.timerId=void 0;var f=this._logic={callbacks:{onBeforeSaveData:function(){return!0},onSaveData:function(e){},clearOnLoad:function(){return!1}},displayData:e=>{this.fieldComponents((e=>e instanceof n||e instanceof r||e instanceof u&&"rich"==e.settings.type)),this.timerId||(this.timerId=setTimeout((()=>{var t=this.fieldComponents((e=>e instanceof n||e instanceof r||e instanceof u&&"rich"==e.settings.type));null==e?(t.forEach((e=>{var t=e.field();if(t){var i=this.viewComponents[e.id];if(null!=i){this._showed&&i.onShow&&i.onShow();var s={};t.defaultValue(s),t.setValue($$(i.ui.inputId?i.ui.inputId:i.ui.id),s),i.logic?.refresh?.(s)}}})),this.fieldComponents((e=>e instanceof o&&!(e instanceof n))).forEach((e=>{var t=e.field();if(t){var i=this.viewComponents[e.id];if(null!=i&&"button"!=e.key){var s=t.columnName,a={};t.defaultValue(a),$$(i.ui.id)&&$$(i.ui.id).setValue?.(null==a[s]?"":a[s])}}}))):t.forEach((t=>{var i=this.viewComponents[t.id];null!=i&&(this._showed&&i.onShow?.(),t.field()&&(i.ui.inputId?t.field().setValue($$(i.ui.inputId),e):t.field().setValue($$(i.ui.id),e)),i.logic?.refresh?.(e))})),this.timerId=void 0}),80))},displayParentData:e=>{let t=this.datacollection;if(null==t.getCursor()){$$(s.component);var i=t.fieldLink;if(null!=i){var a=this.fieldComponents((e=>e instanceof o&&e.field()&&e.field().id==i.id))[0];if(null!=a){var n=this.viewComponents[a.id].ui.inputId;if(null!=n){var r=$$(n),l={};l[i.relationName()]=e,i.setValue(r,l)}}}}}};return{ui:m,init:(e,t)=>{if(e)for(var i in f.callbacks)f.callbacks[i]=e[i]||f.callbacks[i];a.init(e,t);var n=$$(s.component);n&&webix.extend(n,webix.ProgressBar),t<2&&n.disable();let r=this.datacollection;if(r){this.eventAdd({emitter:r,eventName:"changeCursor",listener:(...e)=>f.displayData(...e)}),this.eventAdd({emitter:r,eventName:"initializingData",listener:()=>{let e=$$(s.component);e&&(e.disable(),e.showProgress&&e.showProgress({type:"icon"}))}}),this.eventAdd({emitter:r,eventName:"initializedData",listener:()=>{let e=$$(s.component);e&&(e.enable(),e.hideProgress&&e.hideProgress())}}),this.eventAdd({emitter:r,eventName:"ab.datacollection.update",listener:(e,t)=>{if(!t||!t.objectId)return;let i=r.datasource;if(i&&(i.id==t.objectId||i.fields((e=>e.settings.linkObject==t.objectId)).length>0)){let e=r.getCursor();e&&f.displayData(e)}}});var o=r.datacollectionLink;if(o&&this.eventAdd({emitter:o,eventName:"changeCursor",listener:(...e)=>f.displayParentData(...e)}),l.length){var u=[];l.forEach((e=>{e.filter.fieldsLoad(r.datasource.fields()),e.filter.setValue(e.validationRules),Array.isArray(u[e.columnName])||(u[e.columnName]=[]),u[e.columnName].push({filters:$$(e.view).getFilterHelper(),invalidMessage:e.invalidMessage})})),Object.keys(u).forEach((function(e){var t=$$(s.component).queryView({name:e});t.$view.complexValidations=u[e],t.define("validate",(function(e,t,i){var a=$$(s.component).queryView({name:i}),n=!0;return a.$view.complexValidations.forEach((e=>{let t=r.datasource,i=this.getValues();var s={};(t.fields()||[]).forEach((e=>{s[e.id]=i[e.columnName]})),i.uuid&&(s.this_object=i.uuid),0==e.filters(s)&&(n=!1,a.define("invalidMessage",e.invalidMessage))})),n})),t.refresh()}))}}this.settings&&this.settings.recordRules&&this.settings.recordRules.length&&this.settings.recordRules.forEach((e=>{e&&e.actionSettings&&e.actionSettings.valueRules&&e.actionSettings.valueRules.fieldOperations&&e.actionSettings.valueRules.fieldOperations.length&&e.actionSettings.valueRules.fieldOperations.forEach((e=>{if("exist"!=e.valueType)return;let t=this.AB.datacollectionByID(e.value);t&&t.dataStatus==t.dataStatusFlag.notInitial&&t.loadData()}))}))},logic:f,onShow:e=>{this._showed=!0,a.onShow();var t=$$(s.component),i=this.datacollection;if(i){t&&i.bind(t),this.settings.clearOnLoad&&(i.setCursor(null),f.displayData(null)),(this.settings.clearOnLoad||this.settings.clearOnSave)&&$$(s.component+"_reloadView")&&$$(s.component+"_reloadView").getParentView().removeView(s.component+"_reloadView"),e=i.getCursor(),f.displayData(e);var n=i.datacollectionLink;if(null==e&&n){var r=n.getCursor();f.displayParentData(r)}}else f.displayData(e);this.focusOnFirst(),t&&t.adjust()}}}refreshDefaultButton(e){let t=this.views((e=>e instanceof a&&e.settings.isDefault))[0];null==t?(t=a.newInstance(this.application,this),t.settings.isDefault=!0):this._views=this.views((e=>!(e instanceof a||e.settings.isDefault)));let i=this.views().map((e=>(e.position.y||0)+1));i.push(this._views.length||0),i.push($$(e.fields).length||0);let s=Math.max(...i);return t.position.y=s,this._views.push(t),t}getFormValues(e,t,i,s){var a=["id"];e.getValues((function(e){a.push(e.config.name)}));let o=e.getValues(),u={};a.forEach((e=>{u[e]=o[e]}));var c=this.fieldComponents((e=>e instanceof n||e instanceof r||e instanceof l));for(var d in c.forEach((e=>{var t=this.viewComponents[e.id];if(null==t)return;let i=e.field();i&&(u[i.columnName]=t.logic.getValue(u))})),t.connectFields().forEach((e=>{-1==a.indexOf(e.columnName)&&u[e.columnName]&&(delete u[e.columnName],delete u[e.relationName()])})),u)null!=u[d]&&0!=u[d].length||(u[d]="");let h;if(s&&(h=s.getCursor()),h){var p=s.datasource;t.connectFields().forEach((e=>{var t=this.fieldComponents((t=>t.field&&t.field().id==e.id));if(p.id==e.settings.linkObject&&t.length<1&&void 0===u[e.columnName]){let t=e.indexField?e.indexField.columnName:p.PK();u[e.columnName]={},u[e.columnName][t]=h[t]||h.id}}))}let m=Object.assign(i.getCursor()||{},u);return t.fields((e=>"calculate"==e.key||"formula"==e.key)).forEach((e=>{null==u[e.columnName]&&(u[e.columnName]=e.format(m,!0))})),u}validateData(e,t,i){let s,a=!0,n=this.fieldComponents((e=>e.field&&e.field()&&1==e.field().settings.required||1==e.settings.required)).map((e=>e.field()));if(a&&(s=t.isValidData(i),a=s.pass()),$$(e).validate(),n.forEach((t=>{if(t&&!i[t.columnName]&&"0"!=i[t.columnName]){e.markInvalid(t.columnName,f("This is a required field.")),a=!1;let i=e.elements[t.columnName];if(i){i.$height<56&&(i.define("height",60),i.resize());let e=i.$view.getElementsByClassName("webix_inp_bottom_label")[0];e&&!e.style["margin-left"]&&(e.style.marginLeft=`${this.settings.labelWidth||m.labelWidth}px`)}}})),!a){let t=e.queryView({view:"button",type:"form"});s&&s.errors&&s.errors.length?(s.errors.forEach((t=>{e.markInvalid(t.name,t.message)})),t&&t.disable()):t&&t.enable()}return a}async recordRulesReady(){return this.RecordRule.rulesReady()}async saveData(e){if(!this._logic.callbacks.onBeforeSaveData())return;if(!e||!e.validate())return;e.clearValidation();var t=this.datacollection;if(null==t)return;var i=t.datasource;if(null==i)return;var s=t.model;if(null==s)return;var a=this.getFormValues(e,i,t,t.datacollectionLink);if(await this.recordRulesReady(),this.doRecordRulesPre(a),!this.validateData(e,i,a))return;e.showProgress?.({type:"icon"});var n=i=>{t&&(this.settings.clearOnSave?(t.setCursor(null),e.clear()):i&&i.id&&t.setCursor(i.id)),e.hideProgress?.(),i&&this._logic.callbacks.onSaveData(i)};let r,o=t=>{let i=e.queryView({view:"button",type:"form"});if(t)if(t.invalidAttributes)for(let i in t.invalidAttributes){let s=t.invalidAttributes[i];s&&s[0]&&(s=s[0]),e.markInvalid(i,s.message)}else t.sqlMessage?webix.message({text:t.sqlMessage,type:"error"}):(webix.message({text:"System could not save your data",type:"error"}),this.AB.notify.developer(t,{message:"Could not save your data",view:this.toObj()}));i?.enable(),e?.hideProgress?.()};try{r=a.id?await s.update(a.id,a):await s.create(a)}catch(e){throw o(e.data),e}try{return await this.doRecordRules(r),this.doSubmitRules(r),n(r),r}catch(e){return this.AB.notify.developer(e,{message:"Error processing Record Rules.",view:this.toObj(),newFormVals:r}),this.doSubmitRules(r),void n(r)}}focusOnFirst(){var e=0,t="";this.views().forEach((i=>{"textbox"!=i.key&&"numberbox"!=i.key||i.position.y==e&&(e=i.position.y,t=i.id)}));var i=this.viewComponents[t];i&&$$(i.ui.id)&&$$(i.ui.id).focus()}}},5651:(e,t,i)=>{const s=i(2609),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormButtonEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"includeSave",view:"checkbox",label:n("Save")},{name:"saveLabel",view:"text",labelWidth:this.AB.UISettings.config().labelWidthLarge,label:n("Save Label"),placeholder:n("Save Placeholder")},{name:"includeCancel",view:"checkbox",label:n("Cancel")},{name:"cancelLabel",view:"text",labelWidth:this.AB.UISettings.config().labelWidthLarge,label:n("Cancel Label"),placeholder:n("Cancel Placeholder")},{name:"includeReset",view:"checkbox",label:n("Reset")},{name:"resetLabel",view:"text",labelWidth:this.AB.UISettings.config().labelWidthLarge,label:n("Reset Label"),placeholder:n("Reset Placeholder")},{name:"afterCancel",view:"richselect",labelWidth:this.AB.UISettings.config().labelWidthLarge,label:n("After Cancel")},{name:"alignment",view:"richselect",labelWidth:this.AB.UISettings.config().labelWidthLarge,label:n("Alignment"),options:[{id:"left",value:n("Left")},{id:"center",value:n("Center")},{id:"right",value:n("Right")}]}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=[];i.application.pages(),i.AddPagesToList(s,i.application,i.pageRoot().id);var n=s.map((function(e){return{id:e.id,value:e.value}}));$$(t.afterCancel).define("options",n),$$(t.includeSave).setValue(null!=i.settings.includeSave?i.settings.includeSave:a.includeSave),$$(t.includeCancel).setValue(null!=i.settings.includeCancel?i.settings.includeCancel:a.includeCancel),$$(t.includeReset).setValue(null!=i.settings.includeReset?i.settings.includeReset:a.includeReset),$$(t.saveLabel).setValue(i.settings.saveLabel||""),$$(t.cancelLabel).setValue(i.settings.cancelLabel||""),$$(t.resetLabel).setValue(i.settings.resetLabel||""),$$(t.afterCancel).setValue(i.settings.afterCancel||a.afterCancel),$$(t.alignment).setValue(i.settings.alignment||a.alignment)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.includeSave=$$(e.includeSave).getValue(),t.settings.saveLabel=$$(e.saveLabel).getValue(),t.settings.includeCancel=$$(e.includeCancel).getValue(),t.settings.cancelLabel=$$(e.cancelLabel).getValue(),t.settings.includeReset=$$(e.includeReset).getValue(),t.settings.resetLabel=$$(e.resetLabel).getValue(),t.settings.afterCancel=$$(e.afterCancel).getValue(),t.settings.alignment=$$(e.alignment).getValue()}component(e){var t=this.parentFormUniqueID(`ABViewFormButton_${this.id}_f_`),i={component:e.unique(`${t}_component`)},s=this.parentFormComponent(),r={id:i.component,cols:[]},o=this.settings.alignment||a.alignment;"center"!=o&&"right"!=o||r.cols.push({}),this.settings.includeCancel&&r.cols.push({view:"button",autowidth:!0,value:this.settings.cancelLabel||n("Cancel"),click:function(){l.onCancel(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy","button cancel "+s.id)}}},{width:10}),this.settings.includeReset&&r.cols.push({view:"button",autowidth:!0,value:this.settings.resetLabel||n("Reset"),click:function(){l.onClear(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy","button reset "+s.id)}}},{width:10}),this.settings.includeSave&&r.cols.push({view:"button",type:"form",css:"webix_primary",autowidth:!0,value:this.settings.saveLabel||n("Save"),click:function(){l.callbacks.onSaveClick(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy","button save "+s.id)}}}),"center"!=o&&"left"!=o||r.cols.push({});var l=this._logic={callbacks:{onCancelClick:function(){return!0},onSaveClick:function(e){l.onSave(e)}},onCancel:e=>{if(!l.callbacks.onCancelClick())return!1;var t=this.parentFormComponent().datacollection;if(t&&t.setCursor(null),e.getFormView()&&e.getFormView().clear(),this.settings.afterCancel)super.changePage(this.settings.afterCancel);else{var i=this.pageParent();if(i){var s=i.pageParent((e=>e.settings&&"popup"!=e.settings.type))||i;s&&super.changePage(s.id)}}},onClear:e=>{var t=this.parentFormComponent().datacollection;t&&t.setCursor(null),e.getFormView()&&e.getFormView().clear()},onSave:e=>{var t=this.parentFormComponent(),i=e.getFormView();e.disable(),t.saveData(i).then((()=>{e&&e.$view&&e.enable(),t.focusOnFirst()})).catch((()=>{e&&e.$view&&e.enable()}))}};return{ui:r,init:e=>{if(e)for(var t in l.callbacks)l.callbacks[t]=e[t]||l.callbacks[t]},logic:l}}AddPagesToList(e,t,i){t&&t.pages&&e&&(t.pages()||[]).forEach((t=>{null==t.parent&&t.id!=i||(e.push({id:t.id,value:t.label}),this.AddPagesToList(e,t,t.id))}))}parentFormUniqueID(e){var t=this.parentFormComponent();return e+(t?t.uniqueInstanceID:webix.uid())}}},6339:(e,t,i)=>{const s=i(8489);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormCheckboxEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}component(e){var t=super.component(e),i=this.parentFormUniqueID(`ABViewFormCheckbox_${this.id}_f_`),s={component:e.unique(`${i}_component`)};return t.ui.id=s.component,t.ui.view="checkbox",t.init=e=>{},t}}},3787:(e,t,i)=>{const s=i(3960),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"fieldLabel",view:"text",disabled:!0,label:n("Field")},{name:"required",view:"checkbox",labelWidth:this.AB.UISettings.config().labelWidthCheckbox,labelRight:n("Required")},{name:"disable",view:"checkbox",labelWidth:this.AB.UISettings.config().labelWidthCheckbox,labelRight:n("Disable")}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=i.field();$$(t.fieldLabel).setValue(s?s.label:""),s&&1==s.settings.required?($$(t.required).setValue(s.settings.required),$$(t.required).disable()):$$(t.required).setValue(null!=i.settings.required?i.settings.required:a.required),i&&1==i.settings.disable?$$(t.disable).setValue(i.settings.disable):$$(t.disable).setValue(a.disable)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.required=$$(e.required).getValue(),t.settings.disable=$$(e.disable).getValue()}component(e){var t=this.parentFormComponent(),i=this.field(),s={};t&&(s=t.settings);var a={labelPosition:s.labelPosition,labelWidth:s.labelWidth,label:""};if(null!=i){a.name=i.columnName;var n={};i.defaultValue(n),n[i.columnName]&&(a.value=n[i.columnName]),1==s.showLabel&&(a.label=i.label),1!=i.settings.required&&1!=this.settings.required||(a.required=1),1==this.settings.disable&&(a.disabled=!0),a.on={onAfterRender(){if(this.getList){var e=this.getPopup();if(!e)return;this.getList().data.each((s=>{if(s){var a=e.$view.querySelector("[webix_l_id='"+s.id+"']");a&&a.setAttribute("data-cy",`${i.key} options ${s.id} ${i.id} ${t.id}`)}}))}this.getInputNode().setAttribute("data-cy",`${i.key} ${i.columnName} ${i.id} ${t.id}`)}},a.validate=(e,t,s)=>{let a=this.AB.Validation.validator();return i.isValidData(t,a),a.pass()}}return{ui:a,init:()=>{}}}parentFormUniqueID(e){var t=this.parentFormComponent();return e+(t?t.uniqueInstanceID:webix.uid())}}},6311:(e,t,i)=>{const s=i(4703),a=i(5751).Z,n=i(7025).Z,r=s.defaultValues(),o=i(3947);let l=null,u=null,c=(...e)=>AB.Multilingual.label(...e);function d(e,t,i,s){const a=$$(t);if(!a)return;const n=i.field();if(!n)return;const r=a.$view;if(!r)return;const o=$$(r);if(!o)return;const l=i.settings.objectWorkspace.filterConditions||{glue:"and",rules:[]},u=(e,t=0)=>[...e.rules.filter((e=>"filterByConnectValue"===e.rule)).map((e=>{const i=Object.assign({},e);return i.depth=t,i}))].concat(...e.rules.filter((e=>e.glue)).map((e=>u(e,t+1)))),d=u(l).map((e=>{for(const t in i.parent.viewComponents){const s=$$(i.parent.viewComponents[t].ui.inputId);if(s?.config?.name===e.value){e.filterValue=s;break}}const t=i.AB.objectByID(i.settings.objectId).fieldByID(i.settings.fieldId),s=i.AB.objectByID(t.settings.linkObject).fieldByID(e.key);return s.settings.isCustomFK?e.filterColumn=i.AB.objectByID(s.settings.linkObject).fields((e=>e.id===s.settings.indexField||s.settings.indexField2))[0].columnName:e.filterColumn=null,e}));if(i.options={formView:i.settings.formView,filters:l,sort:i.settings.objectWorkspace.sortFields,editable:1!==i.settings.disable,editPage:!(!i.settings.editForm||"none"===i.settings.editForm),filterByConnectValues:d},i.options.editable){const e=[];for(let t=0;t<d?.length;t++)if(d[t].filterValue&&d[t].key){const s=$$(d[t].filterValue.config.id);let a=null;s?(n.getValue(s)||(a={id:d[t].filterValue.config.id,label:s.config.label}),s.attachEvent("onChange",(e=>{s.getValue()?(o.define("disabled",!1),o.define("placeholder",c("Select items")),n.getAndPopulateOptions(o,i.options,n,i.parentFormComponent())):(o.define("disabled",!0),o.define("placeholder",c("Must select item from '{0}' first.",[s.config.label]))),o.setValue(""),o.refresh()}),!1)):a={id:"perentElement",label:c("PARENT ELEMENT")},a&&e.findIndex((e=>e.id===a.id))<0&&e.push(a)}e.length&&!o.getValue()?(o.define("disabled",!0),o.define("placeholder",c(`Must select item from ${e.map(((e,t)=>`'{${t}}'`)).join(", ")} first.`,e.map((e=>e.label))))):(o.define("disabled",!1),o.define("placeholder",c("Select items")))}else o.define("placeholder",""),o.define("disabled",!0);o.refresh(),n.getAndPopulateOptions(o,i.options,n,i.parentFormComponent())}e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s),this.__filterComponent=this.AB.filterComplexNew(`${this.id}__filterComponent`),this.__filterComponent.fieldsLoad(this.datasource?this.datasource.fields():[],this.datasource?this.datasource:null),this.settings.objectWorkspace&&this.settings.objectWorkspace.filterConditions||(this.AB.error("Error: filter conditions do not exist",{error:"filterConditions do not exist",viewLocation:{application:this.application.name,id:this.id,name:this.label},view:this}),this.settings.objectWorkspace={},this.settings.objectWorkspace.filterConditions={glue:"and"}),this.__filterComponent.setValue(this.settings.objectWorkspace.filterConditions??r.filterConditions)}editorComponent(e,t){let i={component:e.unique("ABViewFormConnectEditorComponent_component")},s=this.component(e),a=s.ui;return a.id=i.component,{ui:{rows:[a,{}]},init:s.init,logic:s.logic,onShow:()=>{d(0,i.component,this)}}}fromValues(e){super.fromValues(e),this.addPageTool.fromSettings(this.settings),this.editPageTool.fromSettings(this.settings)}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);this.App=e,this.idBase="ABViewFormConnectPropertyEditor",i.showFilterPopup=e=>{this.filter_popup.show(e,null,{pos:"top"})},i.showSortPopup=e=>{u.show(e,null,{pos:"top"})},i.onFilterChange=()=>{let e=i.currentEditObject(),s=l.getValue()||{},a=!0;(s.rules||[]).forEach((e=>{a=!!(e.key&&e.rule&&e.value)&&a&&!0})),a&&setTimeout((()=>{this.propertyEditorSave(t,e)}),10)},i.onSortChange=()=>{let e=i.currentEditObject();this.propertyEditorSave(t,e)},this.initPopupEditors(e,t,i);let n=()=>{let e=i.currentEditObject();e&&(this.propertyEditorValues(t,e),this.propertyEditorSave(t,e))};return this.addPageProperty.init({onSave:()=>{n()}}),this.editPageProperty.init({onSave:()=>{n()}}),a.concat([this.addPageProperty.ui,this.editPageProperty.ui,{view:"fieldset",name:"addNewSettings",label:c("Add New Popup Settings:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{view:"text",name:"popupWidth",placeholder:c("Set popup width"),label:c("Width:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,validate:webix.rules.isNumber},{view:"text",name:"popupHeight",placeholder:c("Set popup height"),label:c("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,validate:webix.rules.isNumber}]}},{view:"fieldset",name:"advancedOption",label:c("Advanced Options:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:c("Filter Options:"),width:this.AB.UISettings.config().labelWidthLarge},{view:"button",name:"buttonFilter",css:"webix_primary",label:c("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.showFilterPopup(this.$view)}}]},{rows:[{view:"label",label:c("Filter by Connected Field Value:")},{view:"combo",name:"filterConnectedValue",options:[]}]},{height:30},{rows:[{cols:[{view:"label",label:c("Sort Options:"),width:e.config.labelWidthLarge},{view:"button",name:"buttonSort",css:"webix_primary",label:c("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){i.showSortPopup(this.$view)}}]}]}]}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);let s=[{id:"",value:""}],a=i.AB.definitionForID(i.settings.fieldId),n=i.AB.definitionForID(a.settings.linkObject),o=[];n.fieldIDs.forEach((e=>{o.push(i.AB.definitionForID(e))}));let l=i.application.connectedObjects(a.settings.linkObject);i.parent.views().forEach((e=>{if("connect"==e.key){let t=i.AB.definitionForID(e.settings.fieldId);l.forEach((a=>{if(a.id==t.settings.linkObject){let a;if(o.forEach((e=>{if(e.settings.isCustomFK&&""!=e.settings.indexField&&e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==t.settings.linkObject){a=e.id;let t=i.application.definitionForID(e.settings.indexField);t&&(a=`${e.id}:${t.columnName}`)}else e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==t.settings.linkObject&&(a=`${e.id}:uuid`)})),a){let t=i.parent.viewComponents[e.id];s.push({id:`${t.ui.name}:${a}`,value:t.ui.label})}}}))}})),this.addPageProperty.setSettings(i,i.settingsAddPage),this.editPageProperty.setSettings(i,i.settingsEditPage),$$(t.filterConnectedValue).define("options",s),$$(t.filterConnectedValue).setValue(i.settings.filterConnectedValue),$$(t.popupWidth).setValue(i.settings.popupWidth||r.popupWidth),$$(t.popupHeight).setValue(i.settings.popupHeight||r.popupHeight),this.populatePopupEditors(i),this.populateBadgeNumber(t,i),this.updateEventIds=this.updateEventIds||{},this.updateEventIds[i.id]||(this.updateEventIds[i.id]=!0,i.addListener("properties.updated",(()=>{this.populatePopupEditors(i),this.populateBadgeNumber(t,i)})))}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.popupWidth=$$(e.popupWidth).getValue(),t.settings.popupHeight=$$(e.popupHeight).getValue(),t.settings.filterConnectedValue=$$(e.filterConnectedValue).getValue(),t.settings.objectWorkspace={filterConditions:l.getValue(),sortFields:u.getValue()},t.settingsAddPage=this.addPageProperty.getSettings(t),t.settingsEditPage=this.editPageProperty.getSettings(t),t.addPageTool.fromSettings(t.settingsAddPage),t.editPageTool.fromSettings(t.settingsEditPage)}static populateBadgeNumber(e,t){t.settings.objectWorkspace&&t.settings.objectWorkspace.filterConditions&&t.settings.objectWorkspace.filterConditions.rules?($$(e.buttonFilter).define("badge",t.settings.objectWorkspace.filterConditions.rules.length||null),$$(e.buttonFilter).refresh()):($$(e.buttonFilter).define("badge",null),$$(e.buttonFilter).refresh()),t.settings.objectWorkspace&&t.settings.objectWorkspace.sortFields&&t.settings.objectWorkspace.sortFields.length?($$(e.buttonSort).define("badge",t.settings.objectWorkspace.sortFields.length||null),$$(e.buttonSort).refresh()):($$(e.buttonSort).define("badge",null),$$(e.buttonSort).refresh())}static initPopupEditors(e,t,i){var s="ABViewFormConnectPropertyEditor";l=this.AB.filterComplexNew(`${s}_filter`),l.init(),l.on("change",(e=>{i.onFilterChange(e)})),u=new o(this.App,`${s}_sort`),u.init({onChange:i.onSortChange}),this.filter_popup=webix.ui({view:"popup",width:800,hidden:!0,body:l.ui})}static populatePopupEditors(e){let t,i=r.objectWorkspace.filterConditions;e.settings.objectWorkspace&&e.settings.objectWorkspace.filterConditions&&(i=e.settings.objectWorkspace.filterConditions);let s=e.field();s&&(t=s.datasourceLink,t&&l.fieldsLoad(t.fields(),t)),l.setValue(i),t&&u.objectLoad(t),u.setValue(e.settings.objectWorkspace.sortFields)}static get addPageProperty(){return a.propertyComponent(this.App,this.idBase)}static get editPageProperty(){return n.propertyComponent(this.App,this.idBase)}component(e,t){var i=this.field();if(!i)return super.component(e);t=t?t+"_":"";var s=super.component(e),a=this.parentFormComponent(),n=this.parentFormUniqueID("ABViewFormConnect_"+this.id+"_f_"),r={component:e.unique(`${t}${n}_component`),popup:e.unique(`${t}${n}_popup_add_new`),editpopup:e.unique(`${t}${n}_popup_edit_form_popup_add_new`)},o={};a&&(o=a.settings);let l,u=this.addPageTool.component(e,n);s.init=t=>{a&&a.settings,u.applicationLoad(this.application),u.init({onSaveData:s.logic.callbackSaveData,onCancelClick:s.logic.callbackCancel,clearOnLoad:s.logic.callbackClearOnLoad}),l=this.editPageTool.component(e,n),l.applicationLoad(this.application),l.init({onSaveData:s.logic.callbackSaveData,onCancelClick:s.logic.callbackCancel,clearOnLoad:s.logic.callbackClearOnLoad})},s.logic={callbackSaveData:e=>{$$(r.component)&&(i.once("option.data",(t=>{if(t.forEach((e=>{e.value=e.text})),$$(r.component).getList().clearAll(),$$(r.component).getList().define("data",t),"many"==i.settings.linkType){let t=$$(r.component).getValue();-1==t.indexOf(e.id)&&$$(r.component).setValue(t?t+","+e.id:e.id)}else $$(r.component).setValue(e.id);$$(r.popup)?.close(),$$(r.editpopup)?.close()})),i.getOptions(this.settings.objectWorkspace.filterConditions,"").then((function(e){})))},callbackCancel:()=>($$(r.popup).close(),!1),callbackClearOnLoad:()=>!0,getValue:e=>{var t=$$(r.component);return i.getValue(t,e)},formBusy:e=>{e&&(e.disable&&e.disable(),e.showProgress&&e.showProgress({type:"icon"}))},formReady:e=>{e&&(e.enable&&e.enable(),e.hideProgress&&e.hideProgress())},goToEditPage:e=>{if(!this.settings.editForm)return;let t,i=this.application.urlResolve(this.settings.editForm);if(!i)return;let s=$$(r.component);s&&(t=s.getFormView()),l.onClick().then((()=>{let t=i.datacollection;t&&(t.setCursor(e),this.__editFormDcEvent||(this.__editFormDcEvent=t.on("initializedData",(()=>{t.setCursor(e)}))))}))}};var c="many"==i.settings.linkType;s.ui.label=i.label,s.ui.labelWidth=o.labelWidth,s.ui.id=r.component,s.ui.view=c?"multicombo":"combo",s.ui.on={onItemClick:(e,t)=>{if(t.target.classList.contains("editConnectedPage")&&t.target.dataset.itemId){let e=t.target.dataset.itemId;if(!e)return;s.logic.goToEditPage(e)}},onChange:e=>{let t;Array.isArray(e)?(t=[],e.forEach((e=>{let s=e;"object"!=typeof e&&(s=i.getItemFromVal(e)),s&&s.id&&t.push(s.id)}))):(t=e,"object"!=typeof e&&(t=i.getItemFromVal(e)),t=t&&t.id?t.id:e);const s=$$(r.component);if(s){s.blockEvent();let e=t.join?t.join():t;s.setValue(e),s.unblockEvent()}}},s.ui.dataFieldId=i.id;let h="";return o.editForm&&""!=o.editForm&&(h='<i data-item-id="#id#" class="fa fa-cog editConnectedPage"></i>'),s.ui.suggest={button:!0,selectAll:!!c,body:{template:h+"#value#"},on:{onShow:()=>{i.populateOptionsDataCy($$(r.component),i,a)}},filter:({value:e},t)=>e.toLowerCase().includes(t.toLowerCase())},s.ui.onClick={customField:(t,s,a)=>{if(1!=this.settings.disable&&$$(r.component)){var n=$$(r.component).$view;i.customEdit({},e,n)}}},u.ui?(s.ui.label="",s.ui.labelWidth=0,u.ui.on={onItemClick:(e,t)=>{$$(e).getFormView();let i=a.datacollection;return u.onClick(i),!1}},s.ui={inputId:s.ui.id,rows:[{cols:[{view:"label",label:i.label,width:o.labelWidth,align:"left"},u.ui,s.ui]}]}):s.ui={inputId:s.ui.id,rows:[s.ui]},s.onShow=()=>{d(0,r.component,this);let e=$$(r.component);if(!e)return;let t=e.$view;const s=`${i.key} ${i.columnName} ${i.id} ${this.parent.id}`;t.setAttribute("data-cy",s)},s}get addPageTool(){return null==this.__addPageTool&&(this.__addPageTool=new a),this.__addPageTool}get editPageTool(){return null==this.__editPageTool&&(this.__editPageTool=new n),this.__editPageTool}}},9662:(e,t,i)=>{const s=i(1984),a=i(780);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormCustomEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}component(e){var t=super.component(e),i=this.field(),s=this.parentFormComponent();if(!i)return t;var n=this.parentFormUniqueID(`ABViewFormCustom_${this.id}_f_`),r={component:e.unique(`${n}_component`)},o={};s&&(o=s.settings);var l="";(i.settings.required||this.settings.required)&&(l="webix_required");var u="";o.showLabel&&(u="top"==o.labelPosition?'<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label '+l+'">#label#</label>':'<label style="width: #width#px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="'+l+'">#label#</label>');var c=o.labelWidth;this.settings.formView?c+=40:1==o.showLabel&&"top"==o.labelPosition&&(c=0);let d=38;i instanceof a?i.settings.useHeight?"top"==o.labelPosition?(d=parseInt(i.settings.imageHeight)||80,d+=38):d=parseInt(i.settings.imageHeight)||80:d="top"==o.labelPosition?118:80:1==o.showLabel&&"top"==o.labelPosition&&(d=80);let h=`<div class="customField ${o.labelPosition}">${u}#template#</div>`.replace(/#width#/g,o.labelWidth).replace(/#label#/g,i.label).replace(/#template#/g,i.columnHeader({width:c,height:d,editable:!0}).template({}));return t.ui={id:r.component,view:"forminput",labelWidth:0,paddingY:0,paddingX:0,css:"ab-custom-field",name:t.ui.name,body:{view:e.custom.focusabletemplate.view,css:"customFieldCls",borderless:!0,template:h,height:d,onClick:{customField:(t,s,a)=>{if(1==this.settings.disable)return;let n={},o=this.parentFormComponent();if(o){let e=o.datacollection;e&&(n=e.getCursor()||{})}let l=$$(a).getParentView().$view;i.customEdit(n,e,l,r.component,t)}}}},t.onShow=()=>{let t=$$(r.component);if(!t)return;let s=t.$view;const n=`${this.key} ${i.key} ${i.columnName} ${this.id} ${this.parent.id}`;s.setAttribute("data-cy",n);let o={formId:r.component,editable:1!=this.settings.disable};i instanceof a&&(o.height=i.settings.useHeight&&parseInt(i.settings.imageHeight)||80,o.width=i.settings.useWidth&&parseInt(i.settings.imageWidth)||c),i.customDisplay({},e,s,o)},t.init=e=>{},t.logic={getValue:e=>{let t=$$(r.component);return i.getValue(t,e)}},t}}},6816:(e,t,i)=>{const s=i(6237);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormDatepickerEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}component(e){var t=super.component(e),i=this.field(),s=this.parentFormUniqueID(`ABViewFormDatepicker_${this.id}_f_`),a={component:e.unique(`${s}_component`)};return t.ui.id=a.component,t.ui.view="datepicker",i?(1==i.settings.dateFormat&&(t.ui.type="time"),"datetime"==i.key&&i.settings&&i.settings.timeFormat&&1!=i.settings.timeFormat&&(t.ui.timepicker=!0),t.ui.editable=!0,!t.ui.value||t.ui.value instanceof Date||(t.ui.value=new Date(t.ui.value)),null==i||window.webixLocale||(t.ui.format=i.getFormat()),t.init=e=>{},t):t}}},7856:(e,t,i)=>{const s=i(4909),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormNumberEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{type:"space",rows:[s,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"isStepper",view:"checkbox",labelWidth:this.AB.UISettings.config().labelWidthCheckbox,labelRight:n("Plus/Minus Buttons")}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.isStepper).setValue(null!=i.settings.isStepper?i.settings.isStepper:a.isStepper)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.isStepper=$$(e.isStepper).getValue()}component(e){var t=super.component(e),i=(this.field(),this.parentFormUniqueID(`ABViewFormNumber_${this.id}_f_`)),s={component:e.unique(`${i}_component`)},a=this.settings.isStepper?"counter":e.custom.numbertext.view;return t.ui.id=s.component,t.ui.view=a,t.ui.type="number",t.ui.validate=e=>!isNaN(1*e),t.init=e=>{},t}}},2941:(e,t,i)=>{const s=i(3569);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormReadonlyEditorComponent_component")},s=this.component(e).ui;return s.id=i.component,{ui:{rows:[s,{}]},init:e=>{},logic:{}}}component(e){var t=super.component(e),i=this.field(),s=this.parentFormComponent();if(!i)return t;var a=this.parentFormUniqueID("ABViewFormReadonly_"+this.id),n={component:e.unique(`${a}_component`),template:e.unique(`${a}template`)};t.ui={id:n.component,view:"forminput",labelWidth:0,paddingY:0,paddingX:0,readonly:!0,css:"ab-readonly-field",body:{id:n.template,view:"label",borderless:!0,css:{"background-color":"#fff"},label:""}};let r={};return s&&(r=s.settings),1==r.showLabel&&"top"==r.labelPosition?t.ui.body.height=80:i.settings.useHeight?t.ui.body.height=parseInt(i.settings.imageHeight)||38:t.ui.body.height=38,t.init=e=>{let i=$$(n.component);if(!i)return;let s=i.getFormView();if(!s)return;let a=s.getValues();t.logic.refresh(a),s.attachEvent("onChange",(function(e,i){let a=s.getValues();t.logic.refresh(a)}))},t.onShow=()=>{var e=$$(n.component);if(!e)return;let i=e.getFormView();if(!i)return;let s=i.getValues();t.logic.refresh(s)},t.logic={getValue:e=>{let t=this.field();return t?e[t.columnName]:null},refresh:e=>{let t=this.field(),i=this.parentFormComponent(),s={};i&&(s=i.settings);let a="";1==s.showLabel&&(a="top"==s.labelPosition?`<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label">${t.label}</label>`:`<label style="width: ${s.labelWidth}px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">${t.label}</label>`);let r=s.labelWidth;this.settings.formView?r+=40:1==s.showLabel&&"top"==s.labelPosition&&(r=0);let o=`<div class="readonlyField">${a}#template#</div>`.replace(/#template#/g,t.columnHeader({width:r,editable:!0}).template(e));$$(n.template)&&$$(n.template).setHTML(o)}},t}}},8386:(e,t,i)=>{const s=i(6341),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i="ABViewFormSelectMultipleEditorComponent",s={component:e.unique(`${i}_component`),options:e.unique(`${i}_option`)},a=this.component(e).ui;return a.id=s.component,{ui:{rows:[a,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"type",view:"richselect",label:n("Type"),options:[{id:"multicombo",value:n("Multi Combo")},{id:"checkbox",value:n("Checkboxes")}]}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.type).setValue(i.settings.type||a.type)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.type=$$(e.type).getValue()}component(e){var t=super.component(e),i=this.field(),s=this.parentFormUniqueID(`ABViewFormSelectMultiple_${this.id}_f_`),r={component:e.unique(`${s}_component`)};t.ui.view=this.settings.type||a.type;var o=[];return i&&"user"==i.key?o=i.getUsers():i&&(o=i.settings.options||this.settings.options||[]),t.ui.id=r.component,t.ui.options=o.map((e=>({id:e.id,value:e.text,hex:e.hex}))),"multicombo"==t.ui.view&&(t.ui.tagMode=!1,t.ui.css="hideWebixMulticomboTag",t.ui.tagTemplate=function(e){let t=[];e.forEach((e=>{t.push($$(r.component).getList().getItem(e))}));let s=t;i.getSelectedOptions&&(s=i.getSelectedOptions(i,t));var a=[];return s.forEach((e=>{var t="",s="";i.settings.hasColors&&e.hex&&(t="hascustomcolor",s=`background: ${e.hex};`);let n=e.text?e.text:e.value;a.push(`<span class="webix_multicombo_value ${t}" style="${s}" optvalue="${e.id}"><span>${n}</span><span class="webix_multicombo_delete" role="button" aria-label="Remove item"></span></span>`)})),a.join("")}),"checkbox"==t.ui.view&&t.ui.options.push({id:"temp",value:n("Option")}),t.init=e=>{},t.logic={getValue:e=>{var t=$$(r.component);return i.getValue(t,e)}},t}}},6114:(e,t,i)=>{const s=i(4098),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i="ABViewFormSelectSingleEditorComponent",s={component:e.unique(`${i}_component`),options:e.unique(`${i}_option`)},a=this.component(e).ui;return a.id=s.component,{ui:{rows:[a,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"type",view:"richselect",label:n("Type"),options:[{id:"richselect",value:n("Select list")},{id:"radio",value:n("Radio")}]}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.type).setValue(i.settings.type||a.type)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.type=$$(e.type).getValue()}component(e){var t=super.component(e),i=this.field(),s=this.parentFormUniqueID(`ABViewFormSelectSingle_${this.id}_f_`),r={component:e.unique(`${s}_component`)};t.ui.view=this.settings.type||a.type;var o=[];return o=i&&"user"==i.key?i.getUsers():i?i.settings.options||this.settings.options||[]:this.settings.options||[],t.ui.id=r.component,i?.settings.hasColors?(t.ui.css="combowithcolors",t.ui.options={view:"suggest",body:{view:"list",data:o.map((e=>({id:e.id,value:e.text||e.value,hex:i.settings.hasColors?e.hex:""}))),template:function(e){var t=[],i="",s="";return e.hex&&(i="hascustomcolor",s=`background: ${e.hex};`),t.push(`<span class="webix_multicombo_value ${i}" style="${s}" optvalue="${e.id}"><span>${e.value}</span></span>`),t.join("")}}}):t.ui.options=o.map((e=>({id:e.id,value:e.text||e.value}))),"radio"==t.ui.view&&t.ui.options.length<1&&t.ui.options.push({id:"temp",value:n("Option")}),t.init=e=>{},t}}},8167:(e,t,i)=>{const s=i(7209),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={component:e.unique("ABViewFormTextboxEditorComponent_component")},s=this.component(e),a=s.ui;return a.id=i.component,{ui:{rows:[a,{}]},init:e=>{s.init(e)},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"type",view:"radio",label:n("Type"),vertical:!0,options:[{id:"single",value:n("Single line")},{id:"multiple",value:n("Multiple lines")},{id:"rich",value:n("Rich editor")}]}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.type).setValue(i.settings.type||a.type)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.type=$$(e.type).getValue()}component(e){var t=super.component(e),i=this.parentFormUniqueID(`ABViewFormTextbox_${this.id}_f_`),s={component:e.unique(`${i}_component`)};switch(t.ui.id=s.component,this.settings.type||a.type){case"single":t.ui.view="text";break;case"multiple":t.ui.view="textarea",t.ui.height=200;break;case"rich":t.ui.view="forminput",t.ui.height=200,t.ui.css="ab-rich-text",t.ui.body={view:"tinymce-editor",value:"",cdn:"/js/webix/extras/tinymce",config:{plugins:"link",menubar:"format edit",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | fontsizeselect | link"}}}return t.onShow=()=>{this.settings.type&&"rich"==this.settings.type&&$$(t.ui.id)&&(webix.ui(t.ui,$$(t.ui.id)),$$(t.ui.id).getChildViews()[0].getEditor(!0).then((e=>{const i=`${this.key} rich ${t.ui.name} ${this.id} ${this.parent.id}`;e.contentAreaContainer.setAttribute("data-cy",i)})))},webix.copy(t)}}},6222:(e,t,i)=>{const s=i(926);e.exports=class extends s{editorComponent(e,t){var i="ABViewFormTreeEditorComponent",s={component:e.unique(`${i}_component`),options:e.unique(`${i}_option`)},a=this.component(e).ui;return a.id=s.component,{ui:{rows:[a,{}]},init:e=>{},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t)}component(e){var t=super.component(e),i=this.field(),s=this.parentFormComponent();if(!i)return t;var a=this.parentFormUniqueID(`ABViewFormTree_${this.id}_f_`),n={component:e.unique(`${a}_component`)},r={};s&&(r=s.settings);var o="";1==i.settings.required&&(o="webix_required");var l="";1==r.showLabel&&(l="top"==r.labelPosition?'<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label '+o+'">#label#</label>':'<label style="width: #width#px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="'+o+'">#label#</label>');var u=r.labelWidth;void 0!==this.settings.formView&&(u+=40);var c=(l+"#template#").replace(/#width#/g,r.labelWidth).replace(/#label#/g,i.label).replace(/#template#/g,i.columnHeader({width:u}).template);return t.ui.id=n.component,t.ui.view="template",t.ui.css="webix_el_box",void 0!==i.settings.useHeight&&1==i.settings.useHeight?t.ui.height=parseInt(i.settings.imageHeight):t.ui.height=38,t.ui.borderless=!0,t.ui.template='<div class="customField">'+c+"</div>",t.ui.onClick={customField:function(s,a,r){var o={},l=$$(n.component).$view;o[i.columnName]=t.logic.getValue(),i.customEdit(o,e,l,t)}},t.onShow=()=>{},t.init=e=>{},t.logic={getValue:()=>{var e=$$(n.component).getValues();return Array.isArray(e)&&0==e.length&&(e=""),e}},t}}},9136:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var s=i(5766);const a=i(4022);let n=null;const r={unit:"day",format:"%d"},o={unit:"week",format:e=>{const t=webix.Date.dateToStr("%d %M"),i=webix.Date.weekStart(e),s=webix.Date.add(webix.Date.add(i,1,"week",!0),-1,"day",!0);return t(i)+" - "+t(s)}},l={unit:"month",format:"%F"},u={unit:"year",format:"%Y"};class c extends s.Z{constructor(e,t){super(t||`ABViewGantt_${e.id}`,{menu:"",gantt:""}),this.viewGantt=e,this.AB=e.AB,this.settings=e.settings,this._tempDC=null,this.TitleField=null,this.StartDateField=null,this.EndDateField=null,this.DurationField=null,this.ProgressField=null,this.NotesField=null,this.originalStartDate=null,this.originalEndDate=null,this.pendingAdds={},this.ganttElement={isExistsTask:e=>{let t=$$(this.ids.gantt).getService("local");if(!t)return!1;let i=t.tasks();return!(!i||!i.exists)&&i.exists(e)},removeTask:e=>{if(!this.ganttElement.isExistsTask(e))return;let t=$$(this.ids.gantt).getService("operations");return t?t.removeTask(e):void 0}},n||(n=(...e)=>this.AB.Multilingual.label(...e))}ui(){var e=this.ids,t=this;return{id:e.component,rows:[{cols:[{fillspace:!0},{view:"menu",id:e.menu,layout:"x",width:300,data:[{id:"day",value:n("Day")},{id:"week",value:n("Week")},{id:"month",value:n("Month")},{id:"year",value:n("Year")}],on:{onItemClick:e=>{this.setScale(e)}}}]},{id:e.gantt,view:"gantt",scales:[u,l,r],override:new Map([[gantt.services.Backend,class extends gantt.services.Backend{async tasks(){var e=t.CurrentDatacollection;return e?(e.getData()||[]).map(((e,i)=>t.convertFormat(e,i))):[]}links(){return Promise.resolve([])}async addTask(e,i,s){t.pendingAdds[e.id]||(t.pendingAdds[e.id]=t.taskAdd(e));let a=await t.pendingAdds[e.id];return delete t.pendingAdds[e.id],{id:(a||{}).id}}async updateTask(e,i){return await t.taskUpdate(i.id,i),{}}async removeTask(e){return await t.taskRemove(e),{}}}]])}]}}async init(e){this.AB=e;let t=$$(this.ids.menu);t&&t.showItem("day")}get CurrentDatacollection(){let e=super.CurrentDatacollection;return e||(e=this._tempDC),e}convertFormat(e,t=null){let i={};if(e=e||{},!this.StartDateField||!this.EndDateField&&!this.DurationField)return i;let s=new Date;return i.id=e.id||e.uuid,i.type="task",i.parent=0,i.open=!0,i.text=this.TitleField?e[this.TitleField.columnName]||"":this.CurrentObject.displayData(e),i.start_date=e[this.StartDateField.columnName]||s,i.progress=this.ProgressField?parseFloat(e[this.ProgressField.columnName]||0):0,this.NotesField&&(i.details=e[this.NotesField.columnName]||""),this.EndDateField&&(i.end_date=e[this.EndDateField.columnName]||s),this.DurationField&&(i.duration=e[this.DurationField.columnName]||1),i.end_date||i.duration||(i.end_date=s,i.duration=1),null!=t&&(i.order=t),i}convertValues(e){let t={};return this.TitleField&&(t[this.TitleField.columnName]=e.text||""),this.StartDateField&&(t[this.StartDateField.columnName]=e.start_date),this.ProgressField&&(t[this.ProgressField.columnName]=parseFloat(e.progress||0)),this.NotesField&&(t[this.NotesField.columnName]=e.details),this.EndDateField&&(t[this.EndDateField.columnName]=e.end_date),this.DurationField&&(t[this.DurationField.columnName]=e.duration),t}objectLoad(e){super.objectLoad(e),e&&(this.TitleField=e.fieldByID(this.settings.titleFieldID),this.StartDateField=e.fieldByID(this.settings.startDateFieldID),this.EndDateField=e.fieldByID(this.settings.endDateFieldID),this.DurationField=e.fieldByID(this.settings.durationFieldID),this.ProgressField=e.fieldByID(this.settings.progressFieldID),this.NotesField=e.fieldByID(this.settings.notesFieldID))}datacollectionLoad(e){super.datacollectionLoad(e);let t=this.CurrentDatacollection;!t&&e&&(this._tempDC=e,t=e),this.objectLoad(t.datasource),t.dataStatus==t.dataStatusFlag.initialized&&this.initData(),this.eventAdd({emitter:t,eventName:"initializedData",listener:()=>{this.initData()}}),this.eventAdd({emitter:t,eventName:"create",listener:()=>{this.initData()}}),this.eventAdd({emitter:t,eventName:"update",listener:()=>{this.initData()}}),this.eventAdd({emitter:t,eventName:"delete",listener:e=>{this.ganttElement.isExistsTask(e)&&this.ganttElement.removeTask(e)}})}hide(){$$(this.ids.component)?.hide()}initData(){let e=$$(this.ids.gantt);if(!e)return;let t=e.getService("local");if(!t)return;let i=t.tasks();i&&setTimeout((()=>{i.clearAll();let e=this.CurrentDatacollection,s={data:e?(e.getData()||[]).map(((e,t)=>this.convertFormat(e,t))):[]};this.StartDateField&&(this.EndDateField||this.DurationField)&&i.parse(s);const a=t.getScales();this.originalStartDate=a.start,this.originalEndDate=a.end,this.sort()}),10)}setScale(e){let t=$$(this.ids.gantt);if(!t)return;let i=t.getService("local");if(!i)return;let s=[];switch(e){case"day":s=[u,l,r];break;case"week":s=[u,l,o];break;case"month":s=[u,l];break;case"year":s=[u]}const a=t.getService("local").getScales(),n=webix.Date.add(this.originalStartDate,-1,e,!0),c=webix.Date.add(this.originalEndDate,1,e,!0);i.setScales(n,c,a.precise,a.cellWidth,a.cellHeight,s),t.$app.refresh(),t.getState().$batch({top:0,left:0})}show(){$$(this.ids.component)?.show()}sort(){}async taskAdd(e){let t=this.convertValues(e);try{return await(this.CurrentObject?.model().create(t))}catch(e){throw webix.alert({title:n("Error Saving Item"),ok:n("Okay"),text:n("Unable to save this item.")}),this.AB.notify.developer(e,{context:"ABViewGantt:taskAdd(): Error Saving Item",patch:t}),e}}async taskRemove(e){try{await this.CurrentObject.model().delete(e)}catch(t){throw webix.alert({title:n("Error Removing Item"),ok:n("Okay"),text:n("Unable to remove this item.")}),this.AB.notify.developer(t,{context:"ABViewGantt:taskRemove(): Error Removing Item",rowId:e}),t}}async taskUpdate(e,t){let i=this.convertValues(t);try{await this.CurrentObject.model().update(e,i)}catch(e){throw webix.alert({title:n("Error Updating Item"),ok:n("Okay"),text:n("Unable to update this item.")}),this.AB.notify.developer(e,{context:"ABViewGantt:taskUpdate(): Error Updating Item",patch:i}),e}}}class d extends a{constructor(e,t,i,s){super(e,t,i,s)}editorComponent(e,t){return this.component(e)}component(e=!1){var t=new c(this);if(e){var i=t;t={ui:t.ui(),init:()=>i.init(this.AB),onShow:(...e)=>i.onShow?.(...e)}}return t}}},1937:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var s=i(5766),a=i(2735);class n extends a.Z{constructor(e){super({popupExport:`${e=e||"abviewgridpopupExport"}_popupExport`,list:`${e}_popupExport_list`}),this._currentObject=null,this._dataCollection=null,this._grid=null,this._filename=null,this._hiddenFields=[]}ui(){var e=this;return{view:"popup",id:this.ids.popupExport,width:160,height:0,select:!1,hidden:!0,body:{id:this.ids.list,view:"list",autoheight:!0,data:[{name:"CSV",icon:"file-excel-o"},{name:"Excel",icon:"file-excel-o"},{name:"PDF",icon:"file-pdf-o"},{name:"PNG",icon:"file-image-o"}],template:"<div><i class='fa fa-#icon# webix_icon_btn' aria-hidden='true'></i> #name#</div>",on:{onItemClick:function(t){var i=this.getItem(t);e.export(i.name)}}}}}async init(e){e&&(this.AB=e),webix.ui(this.ui()),$$(this.ids.popupExport).resize()}dataCollectionLoad(e){this._dataCollection=e}objectLoad(e){this._currentObject=e}setHiddenFields(e=[]){this._hiddenFields=e??[]}setFilename(e){this._filename=e}setGridComponent(e){this._grid=e}show(e){$$(this.ids.popupExport).show(e)}async export(e){let t,i={},s=this._dataCollection,a=this._currentObject,n=this._grid,r=this._filename;!s||s.settings.loadAll&&s.dataStatus!=s.dataStatusFlag.notInitial||(await s.reloadData(0,null),s.settings.loadAll=!0),a&&a.fields().forEach((e=>{this._hiddenFields.indexOf(e.columnName)>-1||(i[e.columnName]={template:t=>e.format(t)})}));const o=n.data.find({appbuilder_select_item:1}).length<1,l=e=>o||1==e?.appbuilder_select_item;switch(e){case"CSV":webix.csv.delimiter.cols=",",t=webix.toCSV(n,{filename:r||(a?a.label:null),columns:i,filter:l});break;case"Excel":t=webix.toExcel(n,{filename:r||(a?a.label:null),name:r||(a?a.label:null),columns:i,filterHTML:!0,filter:l});break;case"PDF":t=webix.toPDF(n,{filename:r||(a?a.label:null),filterHTML:!0,filter:l});break;case"PNG":t=webix.toPNG(n,{filename:r||(a?a.label:null)})}try{await t,$$(this.ids.popupExport).hide()}catch(t){this.AB.notify.developer(t,{message:`ABViewGridPopupExport:export(): System could not export: ${e}`,exportType:e,columns:i,fileName:r})}}}var r=i(2021),o=null;class l extends a.Z{constructor(e,t){super({component:`${t=t||"abviewgridpopupMassUpdate"}_popupMassUpdate`,submit:`${t}_submitMassUpdate`}),this.CurrentObject=null,this.GridComponent=e,this.AB=e.AB,this.rowUpdater=new r.default(t,this.AB),o||(o=(...e)=>this.AB.Multilingual.label(...e))}ui(){var e=this.ids;return{view:"popup",id:e.component,body:{width:500,rows:[this.rowUpdater.ui(),{height:15},{cols:[{},{view:"button",value:o("Cancel"),width:100,click:()=>{this.hide()}},{id:e.submit,css:"webix_primary",view:"button",label:o("Update"),type:"form",width:120,click:()=>{this.submit()}}]}]},on:{onShow:()=>{this.onShow()}}}}async init(e){return webix.ui(this.ui()),this.rowUpdater.init(e),Promise.resolve()}hide(){$$(this.ids.component).hide()}objectLoad(e,t){this.CurrentObject=e,this.rowUpdater.objectLoad(e),this.DataTable=t}onShow(){}show(e,t=null){null!=t?$$(this.ids.component).show(e,t):$$(this.ids.component).show(e)}submit(){let e=$$(this.ids.submit),t=this.rowUpdater.getValue()||[];if(e.disable(),!this.GridComponent)return void e.enable();if(t.length<1)return void e.enable();let i=this.GridComponent.getDataTable(),s=[];i.data.each((function(e){e&&e.hasOwnProperty("appbuilder_select_item")&&1==e.appbuilder_select_item&&s.push(e.id)}));let a={};t.forEach((e=>{let t=this.CurrentObject.fieldByID(e.fieldId);t&&(a[t.columnName]=e.value)})),s.length>0?webix.confirm({title:o("Updating Multiple Records"),text:o("Are you sure you want to update the selected records?"),callback:t=>{t?(i&&i.showProgress&&i.showProgress({type:"icon"}),this.CurrentObject.model().batchUpdate({rowIds:s,values:a}).then((()=>{e.enable(),this.hide(),i&&i.hideProgress&&i.hideProgress()})).catch((e=>{this.AB.notify.developer(e,{context:"ABViewGridPopupMassUpdate:submit(): Error during batchUpdate",rowIds:s,values:a})}))):e.enable()}}):(webix.alert({title:o("No Records Selected"),text:o("You need to select at least one record...did you drink your coffee today?")}),e.enable(),this.hide())}}var u=null;class c extends a.Z{constructor(e){super({component:`${e=e||"abviewgridpopupSortFields"}_popupSort`,list:`${e}_popupSort_list`,form:`${e}_popupSort_form`}),this.CurrentObject=null,this._blockOnChange=!1,this._settings=null,u||(u=(...e)=>this.AB.Multilingual.label(...e))}uiForm(){return{view:"form",id:this.ids.form,borderless:!0,elements:[{view:"button",type:"form",css:"webix_primary",value:u("Add new sort"),on:{onItemClick:()=>{this.clickAddNewSort(),this.triggerOnChange()}}}]}}ui(){return{view:"popup",id:this.ids.component,width:600,body:this.uiForm(),on:{onShow:()=>{this.onShow()}}}}async init(e){e&&(this.AB=e),webix.ui(this.ui())}clickAddNewSort(e,t){var i=this,s=$$(this.ids.form),a=s.getChildViews().length-1,n=this.getFieldList(!0);s.addView({id:"sort"+webix.uid(),cols:[{view:"combo",width:220,options:n,on:{onChange:function(e){i.onChangeCombo(e,this)}}},{view:"segmented",width:200,options:[{id:"",value:u("Please select field")}],on:{onChange:()=>{this.triggerOnChange()}}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",width:30,on:{onItemClick:function(){s.removeView(this.getParentView()),i.refreshFieldList(!0),i.triggerOnChange()}}}]},a),e&&s.getChildViews()[a].getChildViews()[0].setValue(e),t&&s.getChildViews()[a].getChildViews()[1].setValue(t)}getFieldList(e){var t=$$(this.ids.form),i=[],s=this.CurrentObject.fields();if(0==s.length)return i;if(s.forEach((e=>{e.fieldIsSortable()&&i.push({id:e.id,value:e.label})})),e){var a=t.getChildViews();a.length>1&&a.forEach((function(e,t){if(a.length-1<=t)return!1;var s=e.getChildViews()[0].getValue();s&&(i=i.filter((e=>e.id!=s)))}))}return i}objectLoad(e){this.CurrentObject=e}setSettings(e){this._settings=this.AB.cloneDeep(e)}getSettings(){var e=$$(this.ids.form),t=[],i=e.getChildViews();return i.length>1&&i.forEach((function(e,s){if(i.length-1<=s)return!1;var a=e.getChildViews()[0].getValue(),n=e.getChildViews()[1].getValue();t.push({key:a,dir:n})})),t}onChangeCombo(e,t){var i,s=this.CurrentObject.fields(),a=t.getParentView().getChildViews()[1],n=null;if(i=s.find((t=>t.id==e))){switch(i.key){case"date":n=[{id:"asc",value:u("Before -> After")},{id:"desc",value:u("After -> Before")}];break;case"number":n=[{id:"asc",value:u("1 -> 9")},{id:"desc",value:u("9 -> 1")}];break;default:n=[{id:"asc",value:u("A -> Z")},{id:"desc",value:u("Z -> A")}]}a.define("options",n),a.refresh(),this.refreshFieldList(),this.triggerOnChange()}}onShow(){var e=$$(this.ids.form);webix.ui(this.uiForm(),e);var t=this._settings;t&&t.forEach&&t.forEach((e=>{this.clickAddNewSort(e.key,e.dir)})),null!=t&&0!=t.length||this.clickAddNewSort()}refreshFieldList(e){var t=$$(this.ids.form),i=this.getFieldList(!1),s=[],a=[],n=t.getChildViews();n.length>1&&n.forEach((function(e,t){if(n.length-1<=t)return!1;var r=e.getChildViews()[0].getValue(),o=i.find((e=>e.id==r));o?s.push(o):a.push(e)})),e||a.forEach((function(e){t.removeView(e)})),(n=t.getChildViews()).length>1&&n.forEach((function(e,t){if(n.length-1<=t)return!1;var a=e.getChildViews()[0].getValue(),r=i.filter((function(e){return e.id==a})),o=s.filter((function(e){return!Array.isArray(r)||-1===r.indexOf(e)})),l=i.filter((function(e){return!Array.isArray(o)||-1===o.indexOf(e)}));e.getChildViews()[0].define("options",l),e.getChildViews()[0].refresh()}))}triggerOnChange(){this._blockOnChange||(this._settings=this.getSettings(),this.emit("changed",this._settings))}blockOnChange(){this._blockOnChange=!0}unblockOnChange(){this._blockOnChange=!1}show(e,t,i){this.blockOnChange(),$$(this.ids.component).show(e,i||null),t&&this.clickAddNewSort(t),this.unblockOnChange()}sort(e,t){let i=0;const s=$$(this.ids.form).getChildViews();return s.length>1&&s.forEach(((a,n)=>{if(s.length-1<=n||0!=i)return;const r=a.getChildViews()[0].getValue(),o=a.getChildViews()[1].getValue(),l=this.CurrentObject.fieldByID(r);if(!l)return;const u=l.columnName;let c=e[u],d=t[u];Array.isArray(c)&&(c=(c||[]).map((function(e){return e.text||e})).join(" ")),Array.isArray(d)&&(d=(d??[]).map((e=>e.text||e)).join(" ")),c!=d&&(i="asc"==o?c>d?1:-1:c<d?1:-1)})),i}}var d=i(4204);const h=i(2268),p=i(5782).Z,m="abviewgrid_settings";var f=null,g=null;class b extends s.Z{constructor(e,t){var i=t||`ABViewGrid_${e.id}`;super(i,{toolbar:"",buttonDeleteSelected:"",buttonFilter:"",buttonMassUpdate:"",buttonSort:"",buttonExport:"",globalSearchToolbar:"",datatable:""}),this.viewGrid=e,this.viewGrid.filterHelper.on("filter.data",((e,t)=>{this.callbackFilterData(e,t)})),this.AB=e.AB,this.id=e.id,this.settings=e.settings||{},this.columnSplitLeft=0,this.columnSplitRight=0,this.datacollection=null,this.validationError=!1,this.linkPage=this.viewGrid.linkPageHelper.component(this.AB._App,`${i}_gridlinkpage`),this.PopupExport=new n(i),this.PopupExport.init(this.AB),this.PopupMassUpdateComponent=new l(this,this.id),this.PopupMassUpdateComponent.init(this.AB),this.PopupSortDataTableComponent=new c(i),this.PopupSortDataTableComponent.init(this.AB),this.PopupSortDataTableComponent.on("changed",(e=>{this.callbackSortData(e)})),this.skippableColumns=["appbuilder_select_item","appbuilder_view_detail","appbuilder_view_track","appbuilder_view_edit","appbuilder_trash"],this.handler_select=(...e)=>{this.selectRow(...e)},g||(g=(...e)=>this.AB.Multilingual.label(...e))}getColumnIndex(e){var t=this.getDataTable().getColumnIndex(e);return this.settings.massUpdate||t++,t}uiDatatable(){var e=this.ids,t=this.settings,i=this,s="datatable";(t.isTreeDatable||t.groupBy)&&(s="treetable");var a="cell";return t.isEditable||!t.detailsPage&&!t.editPage||(a="row"),{view:s,id:e.datatable,resizeColumn:{size:10},resizeRow:{size:10},prerender:!1,editable:t.isEditable,fixedRowHeight:!1,height:t.height||0,editaction:"custom",select:a,footer:t.summaryColumns.length>0||t.countColumns.length>0,tooltip:!0,dragColumn:!0,on:{onBeforeSelect:function(e,s){if(-1!=i.skippableColumns.indexOf(e.column))return!1;if(t.isEditable){var a=i.datacollection.datasource.fields((t=>t.columnName==e.column))[0];if(null==a)return!0;var n=this.getItemNode({row:e.row,column:e.column}),r=this.getItem(e.row);return console.error("TODO: field.customEdit() remove App param!"),a.customEdit(r,i.AB._App,n)}return!(!t.detailsPage&&!t.editPage)&&void 0},onAfterSelect:(e,t)=>{this.settings.isEditable&&this.onAfterSelect(e,t)},onBeforeEditStart:function(e){if("appbuilder_select_item"==!this.getItem(e))return!1},onCheck:function(e,t,s){if("appbuilder_select_item"==t)i.toggleUpdateDelete();else if(i.settings.isEditable){var a={value:s},n={row:e,column:t,config:null};i.onAfterEditStop(a,n)}else{this.getItemNode({row:e,column:t}).querySelector('input[type="checkbox"]').checked=1!=s}},onBeforeEditStop:function(e,t){},onAfterEditStop:(e,t,i)=>{0==this.validationError&&this.onAfterEditStop(e,t,i)},onValidationError:function(){this.validationError=!0},onValidationSuccess:function(){this.validationError=!1},onColumnResize:function(e,t,s,a){if(-1!=["appbuilder_view_detail","appbuilder_view_track","appbuilder_view_edit","appbuilder_trash"].indexOf(e)){this.blockEvent(),this.setColumnWidth(e,s),this.unblockEvent();var n=i.getLastColumn();e=n.id,(t=t<s?n.width+40:n.width-(t-40))<50&&(t=50),n.minWidth=t,this.setColumnWidth(e,t)}a&&i.onColumnResize(e,t,s,a)},onRowResize:e=>{},onBeforeColumnDrag:(e,t)=>-1==this.skippableColumns.indexOf(e),onBeforeColumnDrop:(e,t,i)=>{if(-1!=this.skippableColumns.indexOf(t))return!1},onAfterColumnDrop:(e,t,i)=>{this.onAfterColumnDrop(e,t,i)},onHeaderClick:(e,t,i)=>{this.onHeaderClick(e,t,i)}}}}uiFilter(){return this.viewGrid.filterHelper.ui()}uiToolbar(){var e=this.ids,t=this;return{view:"toolbar",id:e.toolbar,hidden:!0,css:"ab-data-toolbar",cols:[{view:"button",id:e.buttonMassUpdate,css:"webix_transparent",label:g("Edit"),icon:"fa fa-pencil-square-o",type:"icon",disabled:!0,autowidth:!0,click:function(){t.toolbarMassUpdate(this.$view)}},{view:"button",id:e.buttonDeleteSelected,css:"webix_transparent",label:g("Delete"),icon:"fa fa-trash",type:"icon",disabled:!0,autowidth:!0,click:function(){t.toolbarDeleteSelected(this.$view)}},{view:"button",id:e.buttonFilter,css:"webix_transparent",label:g("Filters"),icon:"fa fa-filter",type:"icon",autowidth:!0,click:function(){t.toolbarFilter(this.$view)}},{view:"button",id:e.buttonSort,css:"webix_transparent",label:g("Sort"),icon:"fa fa-sort",type:"icon",autowidth:!0,click:function(){t.toolbarSort(this.$view)}},{view:"button",id:e.buttonExport,css:"webix_transparent",label:g("Export"),icon:"fa fa-print",type:"icon",autowidth:!0,click:function(){t.toolbarExport(this.$view)}},{},{id:e.globalSearchToolbar,view:"search",placeholder:g("Search..."),on:{onTimedKeyPress:()=>{let t=$$(e.globalSearchToolbar).getValue();this.viewGrid.filterHelper.externalSearchText(t)}}}]}}ui(){var e={type:"space",borderless:!0,rows:[{},{view:"label",label:g("Select an object to load."),inputWidth:200,align:"center"},{}]};return(this.datacollection||""!=this.settings.dataviewID)&&(e.padding=this.settings.padding,e.rows=[],this.settings.showToolbar&&e.rows.push(this.uiToolbar()),this.settings.gridFilter.filterOption&&e.rows.push(this.uiFilter()),e.rows.push(this.uiDatatable())),e}async init(e,t=2){e&&(this.AB=e);var i=this,s=this.ids;webix.codebase="",webix.cdn="/js/webix";var a=this.getDataTable(),n=null,r=null;webix.extend(a,webix.ProgressBar),a.config.accessLevel=t,t<2&&a.define("editable",!1);let o=e=>{var t=this.datacollection?.datasource;if(!t||!a.data)return;var i=[];let s=a.getScrollState().y,n=a.config.rowHeight,r=(a.$view.querySelector(".webix_ss_body").clientHeight,Math.floor(s/n)),o=r+a.getVisibleCount(),l=0;a.data.order.each((function(e){null!=e&&r<=l&&l<=o&&i.push(e),l++}));var u=this.settings.isEditable;a.config.accessLevel<2&&(u=!1),t.customDisplays(e,this.AB._App,a,i,u)};if(a.attachEvent("onAfterRender",(function(t){a.resize(),n&&clearTimeout(n),n=setTimeout((()=>{r&&clearTimeout(r),o(this.data)}),350),e.ClassUI.CYPRESS_REF(a),Object.keys(s).forEach((t=>{var i=$$(s[t]);i&&e.ClassUI.CYPRESS_REF(i)}))})),a.attachEvent("onScroll",(function(){r&&clearTimeout(r),n&&clearTimeout(n),r=setTimeout((()=>{o(this.data)}),1500)})),a.attachEvent("onAfterScroll",(function(){n&&clearTimeout(n),n=setTimeout((()=>{r&&clearTimeout(r),o(this.data)}),350)})),a.attachEvent("onItemClick",(function(e,t,s){var n=i.datacollection?.datasource;if(n)if(0==i.settings.isEditable&&a.getItem(e),"auto"==t||t.target.className.indexOf("eye")>-1)i.changePage(l,e,i.settings.detailsPage),i.toggleTab(i.settings.detailsTab,this);else if(t.target.className.indexOf("pencil")>-1)i.changePage(l,e,i.settings.editPage),i.toggleTab(i.settings.editTab,this);else if(t.target.className.indexOf("track")>-1)i.emit("object.track",n,e.row);else if(t.target.className.indexOf("clear-combo-value")>-1){let t={};t[e.column]="",n.model().update(e.row,t).then((e=>{})).catch((t=>{i.AB.notify.developer(t,{context:"ABViewGridComponent.onItemClick",message:"Error updating item",obj:n.toObj(),id:e.row})}))}else t.target.className.indexOf("trash")>-1?webix.confirm({title:g("Delete data"),text:g("Do you want to delete this row?"),callback:function(t){return t&&n.model().delete(e.row).then((t=>{t.numRows>0?(a.remove(e),a.clearSelection()):webix.alert({text:g("No rows were effected.  This does not seem right.")})})).catch((t=>{i.AB.notify.developer(t,{context:"ABViewGridComponent.onItemClick",message:"Error deleting item",obj:n.toObj(),id:e.row})})),a.clearSelection(),!0}}):i.settings.detailsPage.length?(i.changePage(l,e,i.settings.detailsPage),i.toggleTab(i.settings.detailsTab,this)):i.settings.editPage.length&&(i.changePage(l,e,i.settings.editPage),i.toggleTab(i.settings.editTab,this))})),this.settings.showToolbar&&((this.settings.massUpdate||this.settings.isSortable||this.settings.isExportable||this.settings.gridFilter&&this.settings.gridFilter.filterOption&&"toolbar"==this.settings.gridFilter.userFilterPosition)&&$$(s.toolbar).show(),0==this.settings.massUpdate&&($$(s.buttonMassUpdate).hide(),$$(s.buttonDeleteSelected).hide()),0==this.settings.allowDelete&&$$(s.buttonDeleteSelected).hide(),this.settings.gridFilter&&(1==this.settings.gridFilter.filterOption&&"toolbar"==this.settings.gridFilter.userFilterPosition||$$(s.buttonFilter).hide(),3==this.settings.gridFilter.filterOption&&"single"==this.settings.gridFilter.globalFilterPosition&&a.hide(),this.settings.gridFilter.isGlobalToolbar?$$(s.globalSearchToolbar).show():$$(s.globalSearchToolbar).hide(),this.settings.gridFilter.filterOption&&this.viewGrid.filterHelper.init(this.AB)),0==this.settings.isSortable&&$$(s.buttonSort).hide(),0==this.settings.isExportable&&$$(s.buttonExport).hide()),1==this.settings.hideHeader&&this.hideHeader(),!this.datacollection&&this.settings.dataviewID){var l=this.AB.datacollectionByID(this.settings.dataviewID);this.datacollectionLoad(l)}return f||(f=await this.AB.Storage.get(m)||{}),this.datacollection?.datasource&&(this.linkPage.init({view:this.viewGrid,datacollection:this.datacollection}),this.refreshHeader()),Promise.resolve()}busy(){this.getDataTable()?.showProgress?.({type:"icon"})}callbackFilterData(e,t=[]){var i=this.ids,s=$$(i.buttonFilter);if(s){var a=null;this.viewGrid.filterHelper.filterRules()?.rules?.length&&(a=1),s.define("badge",a),s.refresh()}this.datacollection.filterCondition(t),this.datacollection.reloadData()}async callbackSortData(e=[]){$$(this.ids.buttonSort).define("badge",e.length||null),$$(this.ids.buttonSort).refresh();let t=this.getDataTable();if(t.data.find({}).length<t.data.count())try{await this.datacollection.reloadData(0,0)}catch(e){this.AB.notify.developer(e,{context:"ABViewGrid:callbackSortData(): Error perform datacollection.reloadData()"})}setTimeout((()=>{t.sort(((e,t)=>this.PopupSortDataTableComponent.sort(e,t)))}),777)}changePage(e,t,i){let s=t?.row??null;e&&e.setCursor(s),this.linkPage&&this.linkPage.changePage(i,s),super.changePage(i)}columnConfig(e=[]){this.settings.columnConfig=e}datacollectionLoad(e){var t=this.datacollection;this.datacollection=e;var i=e?.datasource,s=this.getDataTable();s&&(this.__handler_dc_busy||(this.__handler_dc_busy=()=>{this.busy()},this.__handler_dc_ready=()=>{this.ready()},this.__handler_dc_loadData=()=>{"treetable"==s.config.view&&i&&!i.isGroup&&(s.clearAll(),s.parse(e.getData()),this.grouping(),this.ready())}),t&&(t.removeListener("initializingData",this.__handler_dc_busy),t.removeListener("initializedData",this.__handler_dc_ready),t.removeListener("loadData",this.__handler_dc_loadData)),e?(e.datacollectionLink&&e.fieldLink?e.bind(s,e.datacollectionLink,e.fieldLink):e.bind(s),e.removeListener("initializingData",this.__handler_dc_busy),e.on("initializingData",this.__handler_dc_busy),e.removeListener("initializedData",this.__handler_dc_ready),e.on("initializedData",this.__handler_dc_ready),e.removeListener("loadData",this.__handler_dc_loadData),e.on("loadData",this.__handler_dc_loadData),this.grouping()):s.unbind(),i&&(this.viewGrid.filterHelper.objectLoad(i),this.PopupMassUpdateComponent.objectLoad(i,this.getDataTable()),this.PopupSortDataTableComponent.objectLoad(i),this.PopupExport.objectLoad(i),this.PopupExport.dataCollectionLoad(e),this.PopupExport.setGridComponent(this.getDataTable()),this.PopupExport.setHiddenFields(this.settings.hiddenFields),this.PopupExport.setFilename(this.viewGrid.label)))}disableUpdateDelete(){$$(this.ids.buttonMassUpdate)?.disable(),$$(this.ids.buttonDeleteSelected)?.disable(),this.emit("selection.cleared")}enableUpdateDelete(){$$(this.ids.buttonMassUpdate)?.enable(),$$(this.ids.buttonDeleteSelected)?.enable(),this.emit("selection")}freezeDeleteColumn(){return this.getDataTable().define("rightSplit",this.columnSplitRight)}getDataTable(){return $$(this.ids.datatable)}getLastColumn(){var e=this.getDataTable(),t={};return e.eachColumn((function(i){var s=e.getColumnConfig(i);1==s.split&&(t=s)})),t}grouping(){if(!this.settings.groupBy)return;let e=this.getDataTable(),t={};this.datacollection.datasource.fields().forEach((e=>{switch(e.key){case"number":t[e.columnName]=[e.columnName,"sum"];break;case"calculate":case"formula":t[e.columnName]=[e.columnName,function(t,i){if(!i)return 0;let s=0;return i.forEach((t=>{s+=1*e.format(t)})),s}];break;case"connectObject":t[e.columnName]=[e.columnName,function(t,i){if(!i||!i.length)return 0;let s=0;return i.forEach((t=>{var i=t[e.relationName()];i&&null!=i.length?s+=i.length:i&&(s+=1)})),s}];break;default:t[e.columnName]=[e.columnName,function(e,t){if(!t||!t.length)return 0;let i=0;return t.forEach((t=>{e(t)&&(i+=1)})),i}]}}));let i=(this.settings.groupBy||"").split(",").map((e=>e.trim()));i=i.reverse(),i.forEach(((s,a)=>{let n,r=this.AB.cloneDeep(t);a==i.length-1?n=s:(n=e=>{let t=e[s];for(let s=a+1;s<i.length;s++)t=`${e[i[s]]} - ${t}`;return t},i.forEach((e=>{e!=s&&(r[e]=[e])}))),e.data.group({by:n,map:r})}))}hideHeader(){var e=this.getDataTable();e.define("header",!1),e.refresh()}async onAfterColumnDrop(e,t,i){this.getDataTable(),this.datacollection.datasource;var s=this.settings,a=this.localSettings();let n=null,r=0;for(var o=0;o<a.length;o++)if(a[o].id==e){n=a[o],a.splice(o,1),r=o;break}for(var l=0;l<a.length;l++)if(a[l].id==t){r<=l&&l++,a.splice(l,0,n);break}this.localSettings(a),s.saveLocal&&this.localSettingsSave(),this.emit("column.order",a.map((e=>e.fieldID))),this.refreshHeader()}async onAfterEditStop(e,t,i){var s=this.getDataTable();if(null==e.old&&""===e.value||""===e.old&&""===e.value)return s.clearSelection(),!1;if(t.config)switch(t.config.editor){case"number":e.value=parseFloat(e.value);break;case"datetime":e.value=e.value.getTime(),e&&e.old&&e.old.getTime&&(e.old=e.old.getTime())}if(e.value!=e.old){var a=s.getItem(t.row);a[t.column]=e.value,s.removeCellCss(a.id,t.column,"webix_invalid"),s.removeCellCss(a.id,t.column,"webix_invalid_cell");var n=this.datacollection.datasource,r=n.isValidData(a);if(r.pass())try{await n.model().update(a.id,a),s.exists(t.row)&&(s.updateItem(t.row,a),s.clearSelection(),s.refresh(t.row))}catch(i){this.AB.notify.developer(i,{context:"ABViewGrid:onAfterEditStop(): Error saving item",item:a,editor:t,state:e,object:n.toObj()}),s.clearSelection(),this.AB.Validation.isGridValidationError(i,t.row,s)}else r.updateGrid(t.row,s)}else s.clearSelection();return!1}onAfterSelect(e){this.getDataTable()?.editCell(e.row,e.column)}async onColumnResize(e,t,i,s){var a=!1;t<30&&(t=30,a=!0,webix.message({type:"info",text:this.AB.Multilingual.label("minimum column width is {0}",[30]),expire:1e3}));var n=this.localSettings();if(n){var r=n.find((t=>t.id==e));r&&(r.width=t,delete r.adjust)}this.localSettings(n),this.settings.saveLocal&&this.localSettingsSave(),a&&this.refreshHeader(),this.freezeDeleteColumn(),this.emit("column.resize",e,t,i)}onHeaderClick(e,t,i){if(-1!=this.skippableColumns.indexOf(e.column))return!1;var s=this.datacollection.datasource.fields((t=>t.columnName==e.column))[0];return this.emit("column.header.clicked",i,s),!1}onShow(){super.onShow(),this.getDataTable()?.adjust();var e=this.datacollection;e&&this.eventAdd({emitter:e,eventName:"changeCursor",listener:this.handler_select})}ready(){this.getDataTable()?.hideProgress?.()}refreshHeader(e=!1){var t=this.datacollection.datasource;if(!t)return;var i=this.ids,s=$$(i.datatable);if(!s)return;var a=s.config.accessLevel;s.define("leftSplit",0),s.define("rightSplit",0);let n=0;t.imageFields().forEach((e=>{e.settings.useHeight&&e.settings.imageHeight>n&&(n=e.settings.imageHeight)})),n&&s.define("rowHeight",n);var r=this.settings,o=r.isEditable;s.config.accessLevel<2&&(o=!1);var l=t.columnHeaders(!0,o,[],[],[]),u=this.localSettings();u&&!e||(u=this.AB.cloneDeep(this.settings.columnConfig)),0==u.length&&(u=l);var c=l.map((e=>e.fieldID));(u=u.filter((e=>c.indexOf(e.fieldID)>-1))).forEach((e=>{var i=l.find((t=>t.fieldID==e.fieldID));Object.keys(i).forEach((t=>{"function"!=typeof i[t]&&"suggest"!=t||(e[t]=i[t])}));var s=t.fieldByID(e.fieldID);s&&(r.hiddenFields.indexOf(s.columnName)>-1&&(e.hidden=!0),r.summaryColumns.indexOf(s.id)>-1?"calculate"==s.key||"formula"==s.key?e.footer={content:"totalColumn",field:s}:e.footer={content:"summColumn"}:r.countColumns.indexOf(s.id)>-1&&(e.footer={content:"countColumn"}))}));var d=this.localSettings();d&&!e||(this.localSettings(u),d=u),u=this.AB.cloneDeep(d);var h=[],p=[];if(u.forEach((e=>{if(e.fillspace=!1,e.validationRules&&("string"==typeof e.validationRules&&(e.validationRules=JSON.parse(e.validationRules)),e.validationRules.length)){var s=[];e.validationRules.forEach((t=>{var i=this.AB.filterComplexNew(e.id);s.push(i.ui),h.push({filter:i,view:i.ids.querybuilder,columnName:e.id,validationRules:t.rules,invalidMessage:t.invalidMessage})}));var a=i.rules+"_"+e.id;p.push(a),webix.ui({view:"popup",css:"ab-rules-popup",id:a,body:{rows:s}})}if(r.groupBy&&(r.groupBy||"").indexOf(e.id)>-1){var n=t.fieldByID(e.fieldID);n&&(e.template=(e,t)=>{if(e.$group){let i=this.AB.cloneDeep(e);return i[n.columnName]=i.value,t.treetable(e,t)+n.format(i)}return n.format(e)})}})),h.length){var m=[];h.forEach((e=>{e.filter.fieldsLoad(t.fields()),e.filter.setValue(e.validationRules),Array.isArray(m[e.columnName])||(m[e.columnName]=[]),m[e.columnName].push({filters:$$(e.view).getFilterHelper(),values:s.getSelectedItem(),invalidMessage:e.invalidMessage})}));var f={};s.$view.complexValidations=m,Object.keys(m).forEach((function(e){f[e]=function(i,a){var n=!0,r="";return s.$view.complexValidations[e].forEach((e=>{var i={};(t.fields()||[]).forEach((e=>{i[e.id]=a[e.columnName]})),a.uuid&&(i.this_object=a.uuid),0==e.filters(i)&&(n=!1,r=e.invalidMessage)})),0==n&&webix.message({type:"error",text:r}),n}})),s.define("rules",f),s.config.rulePops=p,s.refresh()}else s.config.rulePops&&s.config.rulePops.forEach((e=>{$$(e)&&$$(e).destructor()})),s.define("rules",{}),s.refresh();var g=[];r.labelAsField&&(u.unshift({id:"appbuilder_label_field",header:"Label",fillspace:!0,template:function(e){return t.displayData(e)}}),g.push("appbuilder_label_field")),r.massUpdate&&2==a?(u.unshift({id:"appbuilder_select_item",header:{content:"masterCheckbox",contentId:"mch"},width:40,template:"<div class='singleSelect'>{common.checkbox()}</div>",css:{"text-align":"center"}}),this.columnSplitLeft=1,g.push("appbuilder_select_item")):this.columnSplitLeft=0,""==r.detailsPage||r.hideButtons||(u.push({id:"appbuilder_view_detail",header:"",width:40,template:function(e,t){return"<div class='detailsView'><span class='webix_icon fa fa-eye'></span></div>"},css:{"text-align":"center"}}),g.push("appbuilder_view_detail")),0!=r.trackView&&2==a&&(u.push({id:"appbuilder_view_track",header:"",width:40,template:"<div class='track'><span class='track fa fa-history'></span></div>",css:{"text-align":"center",cursor:"pointer"}}),g.push("appbuilder_view_track")),""==r.editPage||r.hideButtons||2!=a||(u.push({id:"appbuilder_view_edit",header:"",width:40,template:"<div class='edit'>{common.editIcon()}</div>",css:{"text-align":"center"}}),g.push("appbuilder_view_edit")),r.allowDelete&&2==a&&(u.push({id:"appbuilder_trash",header:"",width:40,template:"<div class='trash'>{common.trashIcon()}</div>",css:{"text-align":"center"}}),g.push("appbuilder_trash"));for(var b=null,v=u.length-1;v>=0;v--)if(!b){var w=u[v];if(!w.hidden&&-1==g.indexOf(w.id)){b=w;break}}b&&(b.fillspace=!0,b.minWidth=b.width,b.width=150),s.refreshColumns(u),this.columnSplitRight=g.length,g.indexOf("appbuilder_select_item")>-1&&(this.columnSplitRight-=1),this.columnSplitRight<0&&(this.columnSplitRight=0);let y=r.frozenColumnID;""!=y?s.define("leftSplit",s.getColumnIndex(y)+1):s.define("leftSplit",this.columnSplitLeft),this.freezeDeleteColumn(),s.refreshColumns()}async localSettingsSave(){var e=await this.AB.Storage.get(m)||{};e[this.settingsID()]=f[this.settingsID()]?f[this.settingsID()]:[];for(const t in e)e[t].forEach((e=>{e?.footer?.field&&delete e.footer.field}));await this.AB.Storage.set(m,e)}localSettings(e=null){if(!e)return f[this.settingsID()];f[this.settingsID()]=e}selectRow(e){let t=this.getDataTable();t&&(null==e?t.unselect():e?.id&&t.exists(e.id)?t.select(e.id,!1):t.select(null,!1))}settingsID(){var e=this.datacollection.datasource;return`${this.id}-${e?e.id:"0"}`}toggleTab(e,t){var i=t.getTopParentView().queryView({id:e});if(null==i&&(i=$$(e)),null!=i){var s=i.getParentView().getParentView();if(null!=s){s.setValue&&s.setValue(e);var a=s.queryView({view:"scrollview"},"parent");a&&this.toggleTab(a,t)}}}toggleUpdateDelete(){var e=this.getDataTable(),t=0;e.data.each((function(e){void 0!==e&&e.hasOwnProperty("appbuilder_select_item")&&1==e.appbuilder_select_item&&t++})),t>0?this.enableUpdateDelete():this.disableUpdateDelete()}toolbarDeleteSelected(e){var t=this.getDataTable();let i=this.datacollection.datasource;var s=[];t.data.each((function(e){void 0!==e&&Object.prototype.hasOwnProperty.call(e,"appbuilder_select_item")&&1==e.appbuilder_select_item&&s.push((()=>i.model().delete(e.id)))})),s.length>0?webix.confirm({title:g("Delete Multiple Records"),text:g("Are you sure you want to delete the selected records?"),callback:async e=>{e&&(await Promise.all(s.map((e=>e()))),this.disableUpdateDelete())}}):webix.alert({title:g("No Records Selected"),text:g("You need to select at least one record...did you drink your coffee today?")})}toolbarFilter(e){this.viewGrid.filterHelper.showPopup(e)}toolbarSort(e){this.PopupSortDataTableComponent.show(e)}toolbarExport(e){this.PopupExport.show(e)}toolbarMassUpdate(e){this.PopupMassUpdateComponent.show(e)}toolTip(e,t){let i=this.datacollection.datasource;var s=i.imageFields().map((e=>e.columnName)),a="",n=t.column.id.replace(" ","");if(Array.isArray(e[n]))e[n].forEach((function(e){e.text&&(a+=e.text+"<br/>")}));else if(void 0!==e[n+"__relation"]){var r=e[n+"__relation"];Array.isArray(r)||(r=[r]),(r||[]).forEach((function(e){e&&(a+=e.text+"<br/>")}))}else if(void 0!==e[n+"__relation"]&&"number"==typeof e[n])a=e[n+"__relation"].text;else if(-1!=s.indexOf(n)){if(null==e[n])return"";a=`<img style='max-width: 500px; max-height: 500px;' src='/file/${e[n]}' />`}else"date"==t.column.editor?a=t.column.format(e[n]):"richselect"==t.column.editor?i.fields().forEach((function(t){t.columnName==n&&t.settings.options&&t.settings.options.forEach((function(t){t.id==e[n]&&(a=t.text)}))})):a=e[n];return null==a?"":a}toolTipOnBeforeRender(e){e.style.visibility="hidden"}toolTipOnAfterRender(e){null!=e.firstChild&&"IMG"==e.firstChild.nodeName?setTimeout((function(){var t=parseInt(e.style.top.replace("px",""))+500,i=parseInt(e.style.left.replace("px",""))+500;if(t>window.innerHeight){var s=t-window.innerHeight,a=parseInt(e.style.top.replace("px",""))-s;e.style.top=a+"px"}if(i>window.innerWidth){var n=i-window.innerWidth,r=parseInt(e.style.left.replace("px",""))-n;e.style.left=r+"px"}e.style.visibility="visible"}),250):e.style.visibility="visible"}}class v extends h{fromValues(e){super.fromValues(e),this.filterHelper.fromSettings(this.settings.gridFilter)}propertyGroupByList(e,t){let i=t||[];"string"==typeof i&&(i=i.split(","));let s=$$(e.groupBy).getList().data.find({});$$(e.groupByList).clearAll(),i.forEach((t=>{let i=s.filter((e=>e.id==t))[0];i&&$$(e.groupByList).add(i)}))}component(e=!1){var t=new b(this);if(e){var i=t;t={ui:t.ui(),init:(e,t)=>i.init(this.AB,t),onShow:(...e)=>i.onShow?.(...e)}}return t}get filterHelper(){return null==this.__filterHelper&&(this.__filterHelper=new d.Z(this.AB,`${this.id}_filterHelper`)),this.__filterHelper}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new p),this.__linkPageHelper}}},8446:(e,t,i)=>{const s=i(7950);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){return this.component(e,"ABViewImageEditorComponent")}static propertyEditorDefaultElements(e,t,i,s){var n=super.propertyEditorDefaultElements(e,t,i,s);return i.validateType=e=>{var s=["jpg","jpeg","bmp","png","gif"],n=e.type.toLowerCase();if(-1==s.indexOf(n))return webix.message(a("Only [{0}] images are supported",[s.join(", ")])),!1;{var r=i.currentEditObject();let e=`opstool.AB_${r.application.name.replace("_","")}.view`,s=`/file/upload/${r.application.name}/${e}/1`;return $$(t.file).define("upload",s),$$(t.file).refresh(),!0}},i.uploadedFile=e=>{if(e&&e.data){var s=i.currentEditObject();if(s.settings.filename=e.data.uuid,e.file){let i=new Image;i.onload=function(){$$(t.width).setValue(i.width),$$(t.height).setValue(i.height)},i.src=URL.createObjectURL(e.file)}this.propertyEditorSave(t,s)}},n.concat([{cols:[{view:"label",label:a("Image:"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthXLarge},{view:"uploader",value:a("Upload image"),name:"file",apiOnly:!0,inputName:"image",multiple:!1,on:{onBeforeFileAdd:e=>i.validateType(e),onFileUpload:(e,t)=>{i.uploadedFile(e)},onFileUploadError:(e,t)=>{}}}]},{view:"counter",name:"width",label:a("Width:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{view:"counter",name:"height",label:a("Height:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.width).setValue(i.settings.width),$$(t.height).setValue(i.settings.height)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.width=$$(e.width).getValue(),t.settings.height=$$(e.height).getValue()}component(e){var t=`ABViewImage_${this.id}`,i={component:e.unique(`${t}_component`)};return{ui:{cols:[{id:i.component,view:"template",template:"",height:this.settings.height,width:this.settings.width},{}]},init:e=>{if($$(i.component)){if(this.settings.filename){let e=`<img src="/file/${this.settings.filename}" height="${this.settings.height}" width="${this.settings.width}">`;$$(i.component).define("template",e)}else $$(i.component).define("template","");$$(i.component).refresh()}}}}}},9258:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var s=i(5766);const a=i(7907),n=i(5782).Z,r=i(5341);var o=null,l=null,u=null,c=null;class d extends s.Z{constructor(e,t){var i=t||`ABViewKanBan_${e.id}`;super(i,{kanban:"",resizer:""}),this.viewKanBan=e,this.AB=e.AB,this.settings=e.settings,this.FormSide=new r(this,`${i}_formSidePanel`,this.settings.editFields),this.CurrentVerticalField=null,this.CurrentHorizontalField=null,this.CurrentOwnerField=null,this.TextTemplate=e.TextTemplate,this._updatingOwnerRowId=null,o||(o=(...e)=>this.AB.Multilingual.label(...e),l=this.AB.Class.ABFieldManager.fieldByKey("connectObject"),u=this.AB.Class.ABFieldManager.fieldByKey("user"),c=this.AB.Class.ABFieldManager.fieldByKey("list"))}ui(){var e=this.ids,t=this;return{id:e.component,cols:[{id:e.kanban,view:"kanban",cols:[],userList:{view:"menu",template:'<i class="fa fa-user"></i> #value#',width:150,on:{onSelectChange:function(){if(null==t._updatingOwnerRowId)return;let e=this.getSelectedId(!1);null!=e&&t.updateOwner(t._updatingOwnerRowId,e)}}},editor:!1,users:[],tags:[],data:[],on:{onListAfterSelect:(t,i)=>{if(this.CurrentDatacollection?.setCursor(t),this.emit("select",t),t){let i=$$(e.kanban).getItem(t);this.FormSide.show(i),$$(e.resizer)?.show()}else this.FormSide.hide(),$$(e.resizer)?.hide()},onAfterStatusChange:(e,t)=>{this.updateStatus(e,t)},onAvatarClick:e=>{this._updatingOwnerRowId=e}}},{id:e.resizer,view:"resizer",css:"bg_gray",width:11,hidden:!0},this.FormSide.ui()]}}init(e){this.AB=e,this.$kb&&webix.extend(this.$kb,webix.ProgressBar),this.FormSide.init(e),this.FormSide.on("add",(e=>{this.saveData(e)})),this.FormSide.on("update",(e=>{this.saveData(e)}))}get $kb(){return this._kb||(this._kb=$$(this.ids.kanban)),this._kb}kanbanListTemplate(){return{icons:[{icon:"fa fa-trash-o",click:e=>{this.removeCard(e)}}],templateAvatar:e=>this.CurrentOwnerField&&e[this.CurrentOwnerField.columnName]?this.CurrentOwnerField.format(e):"<span class='webix_icon fa fa-user'></span>",templateBody:e=>this.settings.template?this.TextTemplate.displayText(e):this.CurrentObject?.displayData(e)}}hide(){$$(this.ids.component)?.hide()}async show(){var e=this.ids;$$(e.component)?.show(),this.FormSide.hide(),$$(e.resizer)?.hide();var t=this.CurrentObject;if(!t)return;var i=t.fieldByID(this.settings.verticalGroupingField);if(!i)return;this.CurrentVerticalField=i;let s=[];var a=t.fieldByID(this.settings.horizontalGroupingField);this.CurrentHorizontalField=a,a&&a instanceof l&&(s=await a.getOptions());let n=(i.settings.options||[]).map((e=>{if(i&&a){let t=[],n=[];return a instanceof c?n=(a.settings.options||[]).map((e=>e)):a instanceof u?n=a.getUsers().map((e=>({id:e.id,text:e.text||e.value}))):a instanceof l&&(n=s.map((({id:e,text:t})=>({id:e,text:t})))),n.push({id:null,text:o("Other")}),n.forEach((s=>{let n={};n[i.columnName]=e.id,n[a.columnName]=s.id,t.push({template:s.text,height:20,css:"progress_header"}),t.push({view:"kanbanlist",status:n,type:this.kanbanListTemplate()})})),{header:e.text,body:{margin:0,rows:t}}}if(i){let t={};return t[i.columnName]=e.id,{header:e.text,body:{view:"kanbanlist",status:t,type:this.kanbanListTemplate()}}}}));webix.ui(n,$$(e.kanban)),$$(e.kanban).reconstruct();var r=t.fieldByID(this.settings.ownerField);if(this.CurrentOwnerField=r,r){let t=$$(e.kanban).getUserList();if(t.clearAll(),r instanceof u){let e=this.AB.Account.userList().map((e=>({id:e.username,value:e.username})));t.parse(e)}else if(r instanceof l){let e=await r.getOptions();t.parse(e.map((e=>({id:e.id,value:e.text}))))}}}busy(){this.$kb?.showProgress?.({type:"icon"})}ready(){this.$kb?.hideProgress?.()}objectLoad(e){super.objectLoad(e),this.TextTemplate.objectLoad(e),this.FormSide.objectLoad(e)}datacollectionLoad(e){super.datacollectionLoad(e);var t=this.CurrentDatacollection;if(t||(t=e),t){t.bind(this.$kb);var i=t.datasource;i&&this.objectLoad(i)}else this.$kb.unbind()}async updateStatus(e,t){if(!this.CurrentVerticalField)return;this.busy();let i={};t instanceof Object?i=t:i[this.CurrentVerticalField.columnName]=t;let s=!1;for(let e in i)null==i[e]&&(i[e]="",s=!0);try{if(await(this.CurrentObject?.model().update(e,i)),this.ready(),s&&this.show(),this.FormSide.isVisible()){let t=$$(ids.kanban).getItem(e);this.FormSide.refresh(t)}}catch(t){this.AB.notify.developer(t,{context:"ABViewKanban:updateStatus(): Error saving item:",rowId:e,patch:i}),this.ready()}}async updateOwner(e,t){if(!this.CurrentOwnerField)return;this.busy();let i={};i[this.CurrentOwnerField.columnName]=t;try{let t=await(this.CurrentObject?.model().update(e,i));if(this.$kb?.updateItem(e,t),this.FormSide.isVisible()){let t=this.$kb.getItem(e);this.FormSide.refresh(t)}this.ready()}catch(i){this.AB.notify.developer(i,{context:"ABViewKanban:updateOwner(): Error saving item:",rowId:e,val:t}),this.ready()}}saveData(e){e.id&&this.$kb.exists(e.id)?this.$kb.updateItem(e.id,e):this.$kb.add(e)}unselect(){this.$kb&&this.$kb.eachList((function(e){e?.unselect?.()}))}addCard(){this.unselect(),this.FormSide.show(),$$(this.ids.resizer).show()}async removeCard(e){webix.confirm({title:o("Remove card"),text:o("Do you want to delete this card?"),callback:async t=>{if(t){this.busy();try{(await(this.CurrentObject?.model().delete(e))).numRows>0?this.$kb.remove(e):webix.alert({text:o("No rows were effected. This does not seem right.")})}catch(t){this.AB.notify.developer(t,{message:"ABViewKanban:removeCard(): Error deleting item:",rowId:e})}this.ready()}}})}setFields(e){this.CurrentVerticalField=e.verticalGrouping,this.CurrentHorizontalField=e.horizontalGrouping,this.CurrentOwnerField=e.ownerField}}class h extends a{editorComponent(e,t){var i=this.component(e,"ABViewKanbanEditorComponent");return{ui:i.ui,logic:i.logic,onShow:i.onShow,init:()=>{let e=this.datacollection;e&&e.removeComponent(i.ui.id),i.init()}}}component(e=!1){var t=new d(this);if(e){var i=t;t={ui:t.ui(),init:(e,t)=>i.init(this.AB),onShow:(...e)=>i.onShow?.(...e)}}return t}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new n),this.__linkPageHelper}}},5341:(e,t,i)=>{const s=i(5766).Z,a=i(704),n=i(5651);var r=null;e.exports=class extends s{constructor(e,t,i){super(t=t||`${e.id}_formSidePanel`,{form:""}),r||(r=(...e)=>this.AB.Multilingual.label(...e)),this.AB=e.AB,this.CurrentObjectID=null,this.editFields=i,this._mockApp=this.AB.applicationNew({})}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}ui(){var e=this.ids;return{id:e.component,width:300,hidden:!0,rows:[{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:r("Edit Record")},{view:"icon",icon:"wxi-close",align:"right",click:()=>{this.hide()}}]},{view:"scrollview",body:{rows:[{id:e.form,view:"form",borderless:!0,rows:[]}]}}]}}async init(e){this.AB=e}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}objectLoad(e){this.CurrentObjectID=e.id}hide(){$$(this.ids.component)?.hide(),this.emit("close")}show(e){$$(this.ids.component)?.show(),this.refreshForm(e)}isVisible(){return $$(this.ids.component)?.isVisible()??!1}refreshForm(e){var t=this.ids;let i=$$(t.form),s=this.CurrentObject;if(!s||!i)return;e=e||{};let r={id:`${this.ids.component}_sideform`,key:a.common().key,settings:{columns:1,labelPosition:"top",showLabel:1,clearOnLoad:0,clearOnSave:0,labelWidth:120,height:0}},o=this.AB.viewNewDetatched(r);o.objectLoad(s),s.fields().forEach(((e,t)=>{(!this.editFields||this.editFields.indexOf(e.id)>-1)&&o.addFieldToForm(e,t)})),o._views.push(new n({settings:{includeSave:!0,includeCancel:!1,includeReset:!1},position:{y:s.fields().length}},this._mockApp,o)),o._views.forEach(((e,t)=>e.id=`${o.id}_${e.key}_${t}`));let l=o.component(this.AB._App);webix.ui(l.ui.rows.concat({}),i),webix.extend(i,webix.ProgressBar),l.init({onBeforeSaveData:()=>{var e=o.getFormValues(i,s);return!!o.validateData(i,s,e)&&(i?.showProgress({type:"icon"}),e.id?s.model().update(e.id,e).then((e=>{this.emit("update",e),i?.hideProgress({type:"icon"})})).catch((t=>{this.AB.notify.developer(t,{context:"ABViewKanbanFormSidePanel:onBeforeSaveData():update(): Error updating value",formVals:e}),i?.hideProgress({type:"icon"})})):s.model().create(e).then((e=>{this.emit("add",e),i?.hideProgress({type:"icon"})})).catch((t=>{this.AB.notify.developer(t,{context:"ABViewKanbanFormSidePanel:onBeforeSaveData():.create(): Error creating value",formVals:e}),i?.hideProgress({type:"icon"})})),!1)}},2),i.clear(),i.parse(e),l.onShow(e)}}},6145:(e,t,i)=>{const s=i(5759),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i={type:"form",margin:10,padding:10,borderless:!0,rows:[{id:e.unique("ABViewLabelEditorComponent_component"),view:"label",label:this.text||"",align:this.settings.alignment},{}]};return{ui:i=this.uiFormatting(i),init:e=>{}}}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{view:"text",name:"text",label:n("Text"),placeholder:n("Text Placeholder")},{view:"fieldset",label:n("Format Options:"),body:{type:"clean",padding:10,rows:[{view:"radio",name:"format",vertical:!0,value:a.format,options:[{id:0,value:n("normal")},{id:1,value:n("title")},{id:2,value:n("description")}]}]}},{view:"fieldset",label:n("Alignment:"),body:{type:"clean",padding:10,rows:[{view:"radio",name:"alignment",vertical:!0,value:a.alignment,options:[{id:"left",value:n("Left")},{id:"center",value:n("Center")},{id:"right",value:n("Right")}]}]}},{}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.text).setValue(i.text),$$(t.format).setValue(i.settings.format),$$(t.alignment).setValue(i.settings.alignment)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.text=$$(e.text).getValue(),t.settings.format=$$(e.format).getValue(),t.settings.alignment=$$(e.alignment).getValue()}component(e){var t=[];this.views().forEach((i=>{t.push(i.component(e))}));var i=`ABViewLabel_${this.id}`,s={type:"form",padding:15,borderless:!0,rows:[{id:e.unique(`${i}_component`),view:"label",label:this.text||"*",align:this.settings.alignment,type:{height:"auto"}}]};return{ui:s=this.uiFormatting(s),init:e=>{}}}uiFormatting(e){switch(parseInt(this.settings.format)){case 0:e.rows[0].css="ab-component-label ab-ellipses-text";break;case 1:e.rows[0].css="ab-component-header ab-ellipses-text";break;case 2:e.rows[0].css="ab-component-description ab-ellipses-text"}return e}}},6541:(e,t,i)=>{i(2715);const s=i(6897);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i="ABViewLayoutEditorComponent",s=(e.unique(`${i}_component`),e.unique(`${i}_view`),this.component(e)),n={templateButton:function(e){return`<div class="ab-widget-header ab-layout-header">\n               <i class="fa fa-${e.icon} webix_icon_btn"></i> ${e.label}\n               <div class="ab-component-tools">'\n               <i class="fa fa-trash ab-component-remove"></i>\n               <i class="fa fa-edit ab-component-edit"></i>\n               </div></div>`},viewEdit:(t,i,s)=>{var a=this.views((function(e){return e.id==i}))[0];return!!a&&(setTimeout((()=>{e.actions.populateInterfaceWorkspace(a)}),50),t.preventDefault(),!1)},viewDelete:(t,i,s)=>{var n=this.views((function(e){return e.id==i}))[0];webix.confirm({title:a("Delete component"),text:a("Do you want to delete <b>{0}</b>?",[n.label]),callback:t=>{t&&n.destroy().then((()=>{console.error("ABViewLayout: convert App.actions.* to .emit()"),e.actions.populateInterfaceWorkspace(this)}))}}),t.preventDefault()}},r=Object.assign(s.ui,{});return r.type="form",this.views().forEach(((e,t)=>{r.cols[t]={rows:[{type:"template",css:"ab-layout-header",height:30,template:n.templateButton({icon:e.icon,label:e.label}),onClick:{"ab-component-edit":(t,i,s)=>{n.viewEdit(t,e.id,s)},"ab-component-remove":(t,i,s)=>{n.viewDelete(t,e.id,s)}}},r.cols[t],{}]}})),0==this.views().length&&(r.cols[0]={}),{ui:r,init:s.init,logic:n}}static addView(e,t){var i=t.currentEditObject();i.addColumn(),this.propertyEditorSave(e,i,!0)}static propertyEditorDefaultElements(e,t,i,s){var n=super.propertyEditorDefaultElements(e,t,i,s);return i.onClick||(i.onClick=()=>{this.addView(t,i)}),n.concat([{view:"button",css:"webix_primary",value:a("Add Column "),click:i.onClick}])}component(e,t){let i=`ABViewLayout_${t||""}${this.id}`,s={component:e.unique(`${i}_component`)};this.viewComponents=this.viewComponents||{};let a={id:s.component,view:"layout",cols:[]};return this.views().forEach((i=>{this.viewComponents[i.id]=i.component(e,t),a.cols.push(this.viewComponents[i.id].ui),this.eventAdd({emitter:i,eventName:"changePage",listener:e=>{this.changePage(e)}})})),{ui:a,init:(e,t)=>{this.views().forEach((i=>{var s=this.viewComponents[i.id];s&&s.init&&s.init(e,t)}))},onShow:()=>{this.views().forEach((e=>{var t=this.viewComponents[e.id];t&&t.onShow&&t.onShow()}))}}}}},9285:(e,t,i)=>{const s=i(750);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends s{editorComponent(e,t){var i=this.component(e,"ABViewListEditorComponent");return{ui:i.ui,logic:i.logic,onShow:i.onShow,init:()=>{let e=this.datacollection;e&&e.removeComponent(i.ui.id),i.init()}}}static propertyEditorDefaultElements(e,t,i,s){var n=super.propertyEditorDefaultElements(e,t,i,s);return i.selectSource=(e,s)=>{var a=i.currentEditObject();this.propertyUpdateFieldOptions(t,a,e)},n.concat([{name:"datacollection",view:"richselect",label:a("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,on:{onChange:i.selectSource}},{name:"field",view:"richselect",label:a("Field"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"height",label:a("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge}])}static propertyUpdateFieldOptions(e,t,i){var s=t.AB.datacollectionByID(i),a=s?s.datasource:null,n=[];null!=a&&(n=a.fields().map((e=>({id:e.id,value:e.label})))),$$(e.field).define("options",n),$$(e.field).refresh()}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=i.settings.dataviewID?i.settings.dataviewID:null,a=$$(t.datacollection),n=i.propertyDatacollections();a.define("options",n),a.define("value",s),a.refresh(),this.propertyUpdateFieldOptions(t,i,s),$$(t.field).setValue(i.settings.field),$$(t.height).setValue(i.settings.height)}static propertyEditorValues(t,i){super.propertyEditorValues(t,i),i.settings.dataviewID=$$(t.datacollection).getValue(),i.settings.field=$$(t.field).getValue(),i.settings.height=$$(t.height).getValue(),i.settings.height=parseInt(i.settings.height)||e.defaultValues().height}component(e){let t=super.component(e);var i={component:e.unique("ABViewListEditorComponent_component")},s={id:i.component,view:"dataview",type:{width:1e3,height:30},template:e=>{var t=this.field();return t?t.format(e):""}};return 0!=this.settings.height?s.height=this.settings.height:s.autoHeight=!0,{ui:s,init:e=>{var t=this.datacollection;t&&t.bind($$(i.component))},onShow:t.onShow}}}},7726:(e,t,i)=>{const s=i(2579),a=i(2235),n=s.defaultValues();let r=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i="ABViewMenuEditorComponent",s={component:e.unique(`${i}_component`),pages:e.unique(`${i}_pages`),tree:e.unique(`${i}_tree`)},a=this.component(e),n=a.ui;if(a.ui.elements){var r=0;a.ui.elements.forEach((e=>{"menu"==e.view&&(n=a.ui.elements[r]),r++}))}return n.id=s.component,{ui:{type:"space",rows:[n,{}]},init:e=>{var t=$$(s.component);this.ClearPagesInView(t),this.settings.order&&this.settings.order.length&&this.AddPagesToView(t,this.settings.order)},logic:{}}}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.updateTreeDnD=(e,s)=>{var a=i.currentEditObject(),n=a.application.pages((t=>t.id==e),!0)[0];if(n||(n=a.application.views((t=>t.id==e),!0)[0]),s){let e=a.getAliasname(n);$$(t.treeDnD).add({id:n.id,value:e,type:n.type,pageId:n.pageId||"",tabId:n.tabId||""}),i.reorderPages()}else $$(t.treeDnD).exists(e)&&!$$(t.treeDnD).isBranch(e)?($$(t.treeDnD).remove(e),i.reorderPages()):$$(t.treeDnD).exists(e)&&$$(t.treeDnD).isBranch(e)&&($$(t.pages).blockEvent(),$$(t.pages).checkItem(e),webix.message({text:r("Item comtains submenu, please remove items in submenu before removing."),type:"error",expire:1e4}),$$(t.pages).unblockEvent())},i.reorderPages=()=>{var e=i.currentEditObject(),s=[];$$(t.treeDnD).data.each((t=>{var i=e.application.pages((e=>e.id==t.id),!0)[0];i||(i=e.application.views((e=>e.id==t.id),!0)[0]),s.push(i)}));var a=[];s.forEach((i=>{if(i){var s={},n=i.id,r=$$(t.treeDnD).getItem(n);s.parent=r.$parent,s.position=$$(t.treeDnD).getBranchIndex(n),s.icon=r.icon,s.type="viewcontainer"==i.key?"tab":"page","tab"==s.type?(s.tabId=i.id,s.pageId=e.getParentPageId(i)):s.pageId=i.id,s.isChecked="true",s.translations=i.translations,a.push(s)}})),e.settings.order=a,i.onChange(),$$(t.treeDnD).openAll()},a.concat([{name:"orientation",view:"richselect",label:r("Orientation"),value:n.orientation,labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"x",value:r("Horizontal")},{id:"y",value:r("Vertical")}]},{name:"buttonStyle",view:"richselect",label:r("Button Style"),value:n.buttonStyle,labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"ab-menu-default",value:r("Default")},{id:"ab-menu-link",value:r("Link")}]},{name:"menuAlignment",view:"richselect",label:r("Menu Alignment"),value:n.menuAlignment,labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"ab-menu-left",value:r("Left")},{id:"ab-menu-center",value:r("Center")},{id:"ab-menu-right",value:r("Right")}]},{name:"menuInToolbar",view:"checkbox",labelRight:r("Put menu in toolbar"),value:n.menuInToolbar,labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{name:"toolbarFieldset",view:"fieldset",label:r("Toolbar Settings:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{name:"menuPadding",view:"counter",label:r("Toolbar padding"),value:n.menuPadding,labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"menuTheme",view:"richselect",label:r("Toolbar theme"),value:n.menuTheme,labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"white",value:r("White (Default)")},{id:"bg_gray",value:r("Gray")},{id:"webix_dark",value:r("Dark")}]},{name:"menuPosition",view:"richselect",label:r("Menu Position"),value:n.menuPosition,labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"left",value:r("Left")},{id:"center",value:r("Center")},{id:"right",value:r("Right")}]},{name:"menuTextLeft",view:"text",label:r("Text Left"),placeholder:r("Place text in left region of toolbar."),labelWidth:this.AB.UISettings.config().labelWidthLarge,labelPosition:"top"},{name:"menuTextCenter",view:"text",label:r("Text Center"),placeholder:r("Place text in center region of toolbar."),labelWidth:this.AB.UISettings.config().labelWidthLarge,labelPosition:"top"},{name:"menuTextRight",view:"text",label:r("Text Right"),placeholder:r("Place text in right region of toolbar."),labelWidth:this.AB.UISettings.config().labelWidthLarge,labelPosition:"top"}]}},{name:"pagesFieldset",view:"fieldset",label:r("Page List:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{name:"pages",view:"edittree",borderless:!0,css:"transparent",editable:!0,editValue:"aliasname",editor:"text",template:function(e,t){return`<div class='ab-page-list-item'>\n                           ${t.icon(e)} ${t.checkbox(e,!1)} <div class="fa fa-${"viewcontainer"==e.key?"window-maximize":"file"}"></div> \n                           ${e.label}</div>`},on:{onItemCheck:function(e,t){i.onChange(),i.updateTreeDnD(e,t)},onBeforeEditStart:function(e){var t=this.getItem(e);t.aliasname||(t.aliasname=t.label,this.updateItem(t))},onBeforeEditStop:function(s,a){var n=this.getItem(a.id);if(n&&(n.translations.forEach((t=>{t.language_code==e.AB.Multilingual.currentLanguage()&&(t.aliasname=s.value)})),n.label=s.value,this.updateItem(a.id,n)),$$(t.treeDnD).exists(a.id)){var r=$$(t.treeDnD).getItem(a.id)||{};r.value=s.value,r.aliasname=s.value,i.onChange(),$$(t.treeDnD).updateItem(a.id,r)}}}}]}},{name:"pageOrderFieldset",view:"fieldset",label:r("Drag & Drop to Reorder/Click to Add Icon:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{view:"edittree",borderless:!0,name:"treeDnD",template:"{common.icon()} <i class='fa fa-fw fa-#icon#'></i> <span>#value#</span>",drag:!0,editable:!0,editValue:"icon",editor:"combo",options:e.icons,suggest:{template:"#value#",filter:function(e,t){return 0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())},body:{template:"<i class='fa fa-fw fa-#value#'></i> #value#"}},on:{onBeforeDrop:function(e){e.parent=e.target,e.index=-1},onAfterDrop:function(e,t){i.reorderPages()},onDataUpdate:function(){i.reorderPages()}}}]}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.orientation).setValue(i.settings.orientation||n.orientation),$$(t.buttonStyle).setValue(i.settings.buttonStyle||n.buttonStyle),$$(t.menuAlignment).setValue(i.settings.menuAlignment||n.menuAlignment),$$(t.menuInToolbar).setValue(parseInt(i.settings.menuInToolbar)||n.menuInToolbar),$$(t.menuPadding).setValue(i.settings.menuPadding||n.menuPadding),$$(t.menuTheme).setValue(i.settings.menuTheme||n.menuTheme),$$(t.menuPosition).setValue(i.settings.menuPosition||n.menuPosition),""==i.menuTextLeft&&i.settings.menuTextLeft&&(i.menuTextLeft=i.settings.menuTextLeft),$$(t.menuTextLeft).setValue(i.menuTextLeft||n.menuTextLeft),""==i.menuTextCenter&&i.settings.menuTextCenter&&(i.menuTextCenter=i.settings.menuTextCenter),$$(t.menuTextCenter).setValue(i.menuTextCenter||n.menuTextCenter),""==i.menuTextRight&&i.settings.menuTextRight&&(i.menuTextRight=i.settings.menuTextRight),$$(t.menuTextRight).setValue(i.menuTextRight||n.menuTextRight);var s=new webix.TreeCollection,r=i.application,o=(i.pageParent().pageParent(),i.pageRoot()),l=function(e,t,n){i.settings.order&&i.settings.order.forEach&&i.settings.order.forEach((t=>{(t.pageId==e.id&&!t.id||n&&t.pageId==n&&t.tabId==e.id)&&(e.translations=t.translations)}));let r=i.getAliasname(e);e.label=r||e.label,s.add(e,t,n);var o=e.pages?e.pages():[];o.forEach(((t,i)=>{l(t,i,e.id)})),e.views((e=>e instanceof a)).forEach(((t,i)=>{t.views().forEach(((t,s)=>{var a=o.length+i+s;l(t,a,e.id)}))}))};r.pages((e=>o&&o.id==e.id),!0).forEach(((e,t)=>{l(e,t)})),$$(t.pages).clearAll(),$$(t.pages).data.importData(s),$$(t.pages).refresh(),$$(t.pages).blockEvent(),$$(t.pages).uncheckAll(),$$(t.pages).unblockEvent(),$$(t.pages).openAll(),$$(t.treeDnD).clearAll(),i.settings.order&&i.settings.order.forEach&&i.settings.order.forEach((e=>{$$(t.pages).exists(e.tabId||e.pageId)&&($$(t.pages).blockEvent(),$$(t.pages).checkItem(e.tabId||e.pageId),$$(t.pages).unblockEvent());let s=i.getAliasname(e);$$(t.treeDnD).add({id:e.tabId||e.pageId,value:s,type:e.type,pageId:e.pageId||"",tabId:e.tabId||"",icon:e.icon},e.position?parseInt(e.position):0,e.parent&&"0"!=e.parent?e.parent:"")})),$$(t.treeDnD).openAll(),$$(t.pagesFieldset).config.height=28*$$(t.pages).count()+18+40,$$(t.pagesFieldset).resize(),$$(t.pageOrderFieldset).config.height=28*$$(t.pages).count()+18+40,$$(t.pageOrderFieldset).resize()}static propertyEditorValues(e,t){if(super.propertyEditorValues(e,t),t.settings.orientation=$$(e.orientation).getValue(),t.settings.buttonStyle=$$(e.buttonStyle).getValue(),t.settings.menuAlignment=$$(e.menuAlignment).getValue(),t.settings.menuInToolbar=$$(e.menuInToolbar).getValue(),t.settings.menuPadding=$$(e.menuPadding).getValue(),t.settings.menuTheme=$$(e.menuTheme).getValue(),t.settings.menuPosition=$$(e.menuPosition).getValue(),t.menuTextLeft=$$(e.menuTextLeft).getValue(),t.menuTextCenter=$$(e.menuTextCenter).getValue(),t.menuTextRight=$$(e.menuTextRight).getValue(),t.menuTextLeft.length&&(t.settings.menuTextLeft=""),t.menuTextCenter.length&&(t.settings.menuTextCenter=""),t.menuTextCenter.length&&(t.settings.menuTextRight=""),$$(e.pages)){for(var i=0;i<$$(e.pages).data.count();i++){var s=$$(e.pages).getIdByIndex(i),a=$$(e.pages).getItem(s);"viewcontainer"==a.key&&(s=a.pageParent().id);let t=[];a&&a.translations&&(t=a.translations)}t.settings.pages&&delete t.settings.pages}}component(e){var t=`ABMenuLabel_${this.id}`,i={component:e.unique(`${t}_component`)},s="";this.settings.buttonStyle?s+=this.settings.buttonStyle+" ":s+=n.buttonStyle+" ",this.settings.menuAlignment?s+=this.settings.menuAlignment+" ":s+=n.menuAlignment+" ";var a={id:i.component,view:"menu",autoheight:!0,autowidth:!0,datatype:"json",css:s,layout:this.settings.orientation||n.orientation,on:{onMenuItemClick:(e,t,s)=>{var a=$$(i.component).getMenuItem(e);if("tab"==a.type){this.changePage(a.pageId);var n=this.application.pages((e=>e.id==a.pageId),!0)[0];if(!n)return;var r=n.views((e=>e.id==a.id),!0)[0];if(!r)return;var o=r.parent;if(!o)return;l(o);let e=setInterval((function(){$$(r.id)&&$$(r.id).isVisible()?clearInterval(e):o.emit("changeTab",r.id)}),100)}else this.changePage(e)},onAfterRender:()=>{const e=$$(i.component);e&&e?.data.each((t=>{const i=e.getItemNode(t.id);if(!i)return;const s=this.AB.definitionByID(t.id);i.setAttribute("data-cy",`menu-item ${s?.name} ${t.id} ${this.id}`)}))}},type:{subsign:!0}};if(parseInt(this.settings.menuInToolbar)){var r=[],o=!1;if(""==this.menuTextLeft&&this.settings.menuTextLeft&&(this.menuTextLeft=this.settings.menuTextLeft),""==this.menuTextCenter&&this.settings.menuTextCenter&&(this.menuTextCenter=this.settings.menuTextCenter),""==this.menuTextRight&&this.settings.menuTextRight&&(this.menuTextRight=this.settings.menuTextRight),this.settings.menuPosition&&"left"==this.settings.menuPosition)o=!0,r.push(a);else if(this.menuTextLeft&&this.menuTextLeft.length){let e=15*this.menuTextLeft.length;r.push({view:"label",label:this.menuTextLeft,align:"left",width:e})}else r.push({view:"label",label:"",autowidth:!0});if(this.settings.menuPosition&&"center"==this.settings.menuPosition)o=!0,r.push(a);else if(this.menuTextCenter&&this.menuTextCenter.length){let e=15*this.menuTextLeft.length;r.push({}),r.push({view:"label",label:this.menuTextCenter,align:"center",width:e}),r.push({})}else r.push({view:"label",label:"",autowidth:!0});if(this.settings.menuPosition&&"right"==this.settings.menuPosition)o=!0,r.push(a);else if(this.menuTextRight&&this.menuTextRight.length){let e=15*this.menuTextLeft.length;r.push({view:"label",label:this.menuTextRight,align:"right",width:e})}else r.push({view:"label",label:"",autowidth:!0});0==o&&(r=[a]),a={view:"toolbar",css:this.settings.menuTheme?this.settings.menuTheme:n.menuTheme,padding:this.settings.menuPadding?parseInt(this.settings.menuPadding):n.menuPadding,elements:r}}var l=e=>{if(!e.parent)return!1;var t=e.parent;if(!t.parent)return!1;t.parent.emit("changeTab",t.id),l(t.parent)};return{ui:a,init:e=>{var t=$$(i.component);t&&(this.ClearPagesInView(t),this.settings.order&&this.settings.order.length&&(this.AddPagesToView(t,this.settings.order),t.refresh()))}}}}},6239:(e,t,i)=>{const s=i(2094),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){var i=super.editorComponent(e,t);return{ui:i.ui,init:e=>{i.init(e)},logic:i.logic,onShow:i.onShow}}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.permissionClick=(s,a,n,r=!1)=>{var o=$$(t.permissions),l=o.getItem(s);o.showProgress({type:"icon"}),l.markCheckbox?(console.warn("ABViewPage:check for depreciated role removal here:"),e.AB.Network.delete({url:"/app_builder/page/"+l.action_key+"/role",data:{role_id:l.id}}).then((e=>{l.markCheckbox=!1,o.updateItem(s,l),o.hideProgress()})).catch((e=>{if(console.error(e),"E_NOACTIONKEY"==e.code){if(r)return console.error("Error Saving Permisison: ",e),void o.hideProgress();l.markCheckbox=!1,o.updateItem(s,l);var t=[];l._view.application.pages().forEach((e=>{t.push(e.save())})),Promise.all(t).then((()=>{i.permissionClick(s,a,n,!0)}))}}))):(console.warn("ABViewPage:check for depreciated role operation"),e.AB.Network.put({url:"/app_builder/page/"+l.action_key+"/role",data:{role_id:l.id}}).then((e=>{l.markCheckbox=!0,o.updateItem(s,l),o.hideProgress()})).catch((e=>{if(console.error(e),"E_NOACTIONKEY"==e.code){if(r)return console.error("Error Saving Permisison: ",e),void o.hideProgress();var t=[];l._view.application.pages().forEach((e=>{t.push(e.save())})),Promise.all(t).then((()=>{i.permissionClick(s,a,n,!0)}))}})))},a.concat([{name:"type",view:"richselect",label:n("Type"),options:[{id:"page",value:n("Page")},{id:"popup",value:n("Popup")}],on:{onChange:function(e,i){"page"==e?($$(t.popupSettings).hide(),$$(t.pageSettings).show()):($$(t.popupSettings).show(),$$(t.pageSettings).hide())}}},{view:"fieldset",name:"popupSettings",label:n("Popup Settings"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{view:"text",name:"popupWidth",placeholder:n("Set popup width"),label:n("Width:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,validate:webix.rules.isNumber},{view:"text",name:"popupHeight",placeholder:n("Set popup height"),label:n("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,validate:webix.rules.isNumber}]}},{view:"fieldset",name:"pageSettings",label:n("Page Settings"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{view:"checkbox",name:"fixedPageWidth",labelRight:n("Page has fixed width"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox,click:function(e,i){1==this.getValue()?$$(t.pageWidth).show():$$(t.pageWidth).hide()}},{view:"text",name:"pageWidth",placeholder:n("Set page width"),label:n("Page width:"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"richselect",name:"pageBackground",label:n("Page background:"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"ab-background-default",value:n("White (default)")},{id:"ab-background-gray",value:n("Dark")}]}]}},{view:"fieldset",name:"pagePermissionPanel",label:n("Page Permissions:"),labelWidth:this.AB.UISettings.config().labelWidthLarge,body:{type:"clean",padding:10,rows:[{name:"permissions",view:"list",select:!1,minHeight:200,template:"{common.markCheckbox()} #name#",type:{markCheckbox:function(e){return`<span class='check webix_icon fa fa-${e.markCheckbox?"check-":""}square-o'></span>`}},on:{onItemClick:function(e,t,s){i.permissionClick(e,t,s)}}}]}}])}static propertyEditorPopulate(e,t,i,s){super.propertyEditorPopulate(e,t,i,s),$$(t.type).setValue(i.settings.type||a.type),$$(t.popupWidth).setValue(i.settings.popupWidth||a.popupWidth),$$(t.popupHeight).setValue(i.settings.popupHeight||a.popupHeight),$$(t.pageWidth).setValue(i.settings.pageWidth||a.pageWidth),$$(t.fixedPageWidth).setValue(i.settings.fixedPageWidth||a.fixedPageWidth),$$(t.pageBackground).setValue(i.settings.pageBackground||a.pageBackground),i.isRoot()?($$(t.type).hide(),$$(t.pagePermissionPanel).show(),this.propertyUpdatePermissionsOptions(t,i)):($$(t.pagePermissionPanel).hide(),$$(t.type).show()),"popup"==i.settings.type?($$(t.popupSettings).show(),$$(t.pageSettings).hide()):($$(t.popupSettings).hide(),$$(t.pageSettings).show()),1==i.settings.fixedPageWidth?$$(t.pageWidth).show():$$(t.pageWidth).hide()}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.type=$$(e.type).getValue(),t.settings.popupWidth=$$(e.popupWidth).getValue(),t.settings.popupHeight=$$(e.popupHeight).getValue(),t.settings.pageWidth=$$(e.pageWidth).getValue(),t.settings.fixedPageWidth=$$(e.fixedPageWidth).getValue(),t.settings.pageBackground=$$(e.pageBackground).getValue()}static propertyUpdatePermissionsOptions(e,t){var i=this.getPageActionKey(t),s=[],a=$$(e.permissions);a.showProgress||webix.extend(a,webix.ProgressBar),a.clearAll(),a.showProgress({type:"icon"}),console.error("ABViewPage: check for depreciated Permission checks here."),t.application.getPermissions().then((function(e){var n=e;t.AB.Network.get({url:"/app_builder/page/"+i+"/role"}).then((e=>{var r=[];e.selected.forEach((e=>{r.push(e.id)})),e.roles.forEach((e=>{-1!=n.indexOf(e.id)&&(-1!=r.indexOf(e.id)?e.markCheckbox=!0:e.markCheckbox=!1,e.action_key=i,e._view=t,s.push(e))})),s=t.AB.orderBy(s,"id","asc"),a.parse(s),a.hideProgress()}))})).catch((function(e){a.hideProgress(),console.error(e)}))}component(e){var t=super.component(e);return{ui:{view:"scrollview",borderless:!0,css:this.settings.pageBackground||a.pageBackground,body:t.ui},init:e=>{var i=this.getUserAccess();t.init(e,i)},logic:t.logic,onShow:t.onShow}}}},1227:(e,t,i)=>{const s=i(7766),a=i(3088),n=i(8439),r=i(1812),o=i(8447);let l=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s)}editorComponent(e,t){var i={component:e.unique("ABViewPivotEditorComponent_component")},s=this.component(e),a=e.AB.cloneDeep(s);return a.ui.id=i.component,a.ui.readonly=!1,a.ui.on={onBeforeApply:e=>{this.settings.structure=e,this.save()}},a.init=e=>{s.init({componentId:i.component})},a}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"datacollection",view:"richselect",label:l("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"counter",name:"height",label:l("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{view:"checkbox",name:"removeMissed",labelRight:l("Remove empty data."),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"totalColumn",labelRight:l("Show a total column."),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"separateLabel",labelRight:l("Separate header label."),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"min",labelRight:l("Highlighting of a cell(s) with the least value in a row."),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"max",labelRight:l("Highlighting of a cell(s) with the biggest value in a row."),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{name:"decimalPlaces",view:"counter",min:1,label:l("Decimal Places"),labelWidth:this.AB.UISettings.config().labelWidthXLarge}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i);var s=i.settings.dataviewID?i.settings.dataviewID:null,a=$$(t.datacollection),n=i.propertyDatacollections();a.define("options",n),a.define("value",s),a.refresh(),$$(t.removeMissed).setValue(i.settings.removeMissed),$$(t.totalColumn).setValue(i.settings.totalColumn),$$(t.separateLabel).setValue(i.settings.separateLabel),$$(t.min).setValue(i.settings.min),$$(t.max).setValue(i.settings.max),$$(t.height).setValue(i.settings.height),$$(t.decimalPlaces).setValue(null==i.settings.decimalPlaces?2:i.settings.decimalPlaces)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.removeMissed=$$(e.removeMissed).getValue(),t.settings.totalColumn=$$(e.totalColumn).getValue(),t.settings.separateLabel=$$(e.separateLabel).getValue(),t.settings.min=$$(e.min).getValue(),t.settings.max=$$(e.max).getValue(),t.settings.height=$$(e.height).getValue()}component(e){let t=super.component(e);var i=`ABViewPivot_${this.id}`,s={component:e.unique(`${i}_component`)};return{ui:{id:s.component,view:"pivot",readonly:!0,removeMissed:this.settings.removeMissed,totalColumn:this.settings.totalColumn,separateLabel:this.settings.separateLabel,min:this.settings.min,max:this.settings.max,format:e=>{let t=this.settings.decimalPlaces||2;return e&&"0"!=e?parseFloat(e).toFixed(t||0):e}},init:e=>{(e=e||{}).componentId=e.componentId||s.component;let t=this.datacollection;if(!t)return Promise.resolve();let i=t.datasource;if(!i)return Promise.resolve();let l=$$(s.component);if(l&&i instanceof o){let e={};i.fields().forEach((t=>{e[t.columnName]=t.label})),l.define("fieldMap",e)}let u=()=>{let s=t.getData().map((e=>{let t={};return i.fields().forEach((i=>{t[i.columnName]=i instanceof a||i instanceof n||i instanceof r?e[i.columnName]:i.format(e)})),t}));$$(e.componentId).parse(s),this.settings.structure&&$$(e.componentId).setStructure(this.settings.structure)};return this.eventAdd({emitter:t,eventName:"initializedData",listener:()=>{u()}}),Promise.resolve().then((()=>new Promise(((e,i)=>{switch(t.dataStatus){case t.dataStatusFlag.notInitial:t.loadData();break;case t.dataStatusFlag.initialized:e()}})))).then((()=>new Promise(((e,t)=>{u(),e()}))))},onShow:t.onShow}}}},1226:(e,t,i)=>{const s=i(5154);e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s)}editorComponent(e,t){let i={component:e.unique("ABViewReportsManagerEditorComponent_component")},s=this.component(e);return s.ui.id=i.component,s.init=e=>{},s}static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.dataviewID=$$(e.datacollection).getValue()}component(e){let t=super.component(e),i=`ABViewReportManager_${this.id}`,s={component:e.unique(`${i}_component`)},a=this,n={id:s.component,view:"reports",toolbar:!0,override:new Map([[reports.services.Backend,class extends reports.services.Backend{getModules(){return Promise.resolve(a.settings.moduleList||[])}saveModule(e,t){e=e||webix.uid(),a.settings.moduleList=a.settings.moduleList||[];let i=null;return a.settings.moduleList.filter(((t,s)=>{let a=t.id==e;return a&&(i=s),a}))[0]?a.settings.moduleList[i]=t:a.settings.moduleList.push(t),new Promise(((t,i)=>{a.save().catch(i).then((()=>{t({id:e})}))}))}deleteModule(e){return a.settings.moduleList=a.settings.moduleList||[],a.settings.moduleList=a.settings.moduleList.filter((t=>t.id!=e)),new Promise(((t,i)=>{a.save().catch(i).then((()=>{t({id:e})}))}))}getModels(){let e={};return(a.AB.datacollections()||[]).forEach((t=>{if(!t.datasource)return;let i=r.getReportFields(t);e[t.id]={id:t.id,name:t.label,data:i,refs:[]}})),Promise.resolve(e)}getQueries(){return Promise.resolve(a.settings.queryList||[])}saveQuery(e,t){e=e||webix.uid(),a.settings.queryList=a.settings.queryList||[];let i=null;return a.settings.queryList.filter(((t,s)=>{let a=t.id==e;return a&&(i=s),a}))[0]?a.settings.queryList[i]=t:a.settings.queryList.push(t),new Promise(((t,i)=>{a.save().catch(i).then((()=>{t({id:e})}))}))}deleteQuery(e){return a.settings.queryList=a.settings.queryList||[],a.settings.queryList=a.settings.queryList.filter((t=>t.id!=e)),new Promise(((t,i)=>{a.save().catch(i).then((()=>{t({id:e})}))}))}getData(e){let t=[],i=[],s=[],n={},o=[];return s.push(e.data),(e.joins||[]).forEach((e=>{s.push(e.sid),s.push(e.tid)})),s=a.AB.uniq(s),s.forEach((e=>{i.push(new Promise(((t,i)=>{r.getData(e).catch(i).then((i=>{n[e]=i||[],t()}))})))})),s.forEach((e=>{let t=a.AB.datacollectionByID(e);t&&(o=o.concat(r.getReportFields(t).map((t=>(t.id=`${e}.${t.id}`,t)))))})),Promise.resolve().then((()=>Promise.all(i))).then((()=>new Promise(((i,s)=>{if(t=n[e.data]||[],!e.joins||!e.joins.length)return i();(e.joins||[]).forEach((e=>{let i=a.AB.datacollectionByID(e.sid);if(!i)return;let s=i.datasource;if(!s)return;let r=a.AB.datacollectionByID(e.tid);if(!r)return;let o=r.datasource;if(!o)return;let l=s.fieldByID(e.sf),u=o.fieldByID(e.tf);if(!l&&!u)return;let c=n[e.sid]||[],d=n[e.tid]||[];c.forEach((i=>{d.forEach((s=>{let n=i[l?`${e.sid}.${l.columnName}.id`:`${e.sid}.id`]||[],r=s[u?`${e.tid}.${u.columnName}.id`:`${e.tid}.id`]||[];Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);let o=n.filter((e=>r.indexOf(e)>-1));if(o&&o.length){let n=t.filter((t=>t[`${e.sid}.id`]==i[`${e.sid}.id`]&&null==t[`${e.tid}.id`]))||[];n&&n.length?(n||[]).forEach((e=>{for(let t in s)"id"!=t&&(e[t]=s[t])})):t.push(Object.assign(a.AB.cloneDeep(i),a.AB.cloneDeep(s)))}}))}))})),i()})))).then((()=>new Promise(((i,s)=>{let n;try{n=JSON.parse(e.query||"{}")}catch(e){s(e)}n&&n.rules&&n.rules.length&&n.rules.forEach((e=>{if(e&&e.type&&e.condition)switch(e.type){case"date":case"datetime":e.condition.filter&&(this.AB.isString(e.condition.filter)&&(e.condition.filter=this.AB.toDate(e.condition.filter)),e.condition.filter.start&&this.AB.isString(e.condition.filter.start)&&(e.condition.filter.start=this.AB.toDate(e.condition.filter.start)),e.condition.filter.end&&this.AB.isString(e.condition.filter.end)&&(e.condition.filter.end=this.AB.toDate(e.condition.filter.end)))}}));let r,l=webix.ui({view:"query",fields:o,value:n}),u=new webix.DataCollection;u.parse(t);try{r=l.getFilterFunction()}catch(e){}r&&u.filter(r),(e.sort||[]).forEach((e=>{e.id&&u.sort({as:"string",dir:e.mod||"asc",by:`#${e.id}#`})})),t=u.serialize(),l.destructor(),u.destructor(),e.group&&e.group.length&&((e.group||[]).forEach((e=>{t=_(t).groupBy(e)})),t=t.map(((t,i)=>{let s={};return(e.columns||[]).forEach((e=>{let i=e.split(".")[0],n=e.replace(/sum.|avg.|count.|max.|min./g,"");switch(i){case"sum":s[e]=a.AB.sumBy(t,n);break;case"avg":s[e]=a.AB.meanBy(t,n);break;case"count":s[e]=(t||[]).length;break;case"max":s[e]=(a.AB.maxBy(t,n)||{})[n]||"";break;case"min":s[e]=(a.AB.minBy(t,n)||{})[n]||"";break;default:s[e]=t[0][e]}})),s})).value()),i()})))).then((()=>Promise.resolve(t)))}getOptions(e){return Promise.resolve([])}getFieldData(e){return Promise.resolve([])}}],[reports.views.table,class extends reports.views.table{GetColumnConfig(e){return"date"===e.type?{id:e.id,header:e.meta.header&&"none"!==e.meta.header?[e.meta.name||e.name,{content:"text"===e.header?"textFilter":"richSelectFilter"}]:e.meta.name||e.name,type:e.type,sort:"date",width:e.width||200,format:e=>e&&e.getTime&&!isNaN(e.getTime())?webix.i18n.dateFormatStr(e):""}:super.GetColumnConfig(e)}}]])},r={getReportFields:e=>{if(!e)return[];let t=e.datasource;if(!t)return[];let i=[];return t.fields().forEach((e=>{let t=e.columnHeader();i.push({id:e.columnName,name:e.label,filter:e.fieldIsFilterable(),edit:!1,type:t.editor||"text",format:t.format,options:t.options,ref:"",key:!1,show:!0,abField:e}),e.isConnection&&e.settings.isSource&&(a.AB.datacollectionByID(e.settings.linkObject)||[]).forEach((t=>{i.push({id:e.id,name:e.label,filter:!1,edit:!1,type:"reference",ref:t.id,key:!1,show:!1})}))})),i},getData:e=>{let t=a.AB.datacollectionByID(e);if(!t)return Promise.resolve([]);let i=t.datasource;return i?Promise.resolve().then((()=>new Promise(((e,i)=>{t.dataStatus==t.dataStatusFlag.notInitial?t.loadData().catch(i).then((()=>e())):e()})))).then((()=>new Promise(((e,s)=>{let n=r.getReportFields(t),o=[];return(t.getData()||[]).forEach((e=>{let s={id:e.id};s[`${t.id}.id`]=e.id,i.fields().forEach((i=>{let r=i.columnName,o=`${t.id}.${r}`;s[o]=i?i.format(e):e[r],i&&i.isConnection&&(Array.isArray(e[r])?s[`${o}.id`]=e[r].map((e=>e[i.datasourceLink.PK()]||e.id||e)):e[r]&&(s[`${o}.id`]=e[r][i.datasourceLink.PK()]||e[r].id||e[r]));let l=n.filter((e=>e.id==r))[0];if(l)switch(l.type){case"text":case"reference":s[o]=(s[o]||"").toString();break;case"number":s[o]=parseFloat((s[o]||0).toString().replace(/[^\d.-]/g,""));break;case"date":case"datetime":s[o]=e[r],s[o]?s[o]instanceof Date||(s[o]=a.AB.toDate(e[r])):s[o]=""}})),o.push(s)})),e(o)})))):Promise.resolve([])}};return{ui:n,init:e=>((e=e||{}).componentId=e.componentId||s.component,Promise.resolve()),logic:r,onShow:t.onShow}}}},2235:(e,t,i)=>{const s=i(6463),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends s{editorComponent(t,i){var s="ABViewTabEditorComponent",a={component:t.unique(`${s}_component`),view:t.unique(`${s}_view`)},r=this.component(t),o=r.ui;if(o.rows)o.rows[0].id=a.component,o.rows[0].tabbar={height:60,type:"bottom",css:this.settings.darkTheme?"webix_dark":"",on:{onItemClick:(t,i)=>{var s=$$(a.component).getValue(),n=this.views((e=>e.id==s))[0],r=this._views.findIndex((e=>e.id==s));i.target.classList.contains("rename")?e.popupShow(n):i.target.classList.contains("move-back")?(this.viewReorder(s,r-1),this.emit("properties.updated",this)):i.target.classList.contains("move-next")&&(this.viewReorder(s,r+1),this.emit("properties.updated",this))}}},o.rows[0].cells&&o.rows[0].cells.length>0&&o.rows[0].cells.forEach((e=>{e.header='<i class="fa fa-caret-left move-back ab-tab-back"></i>'+e.header,e.header+=' <i class="fa fa-pencil-square rename ab-tab-edit"></i>',e.header+=' <i class="fa fa-caret-right move-next ab-tab-next"></i>'}));else if(o.cols){var l=1,u=0;"right"==this.settings.sidebarPos&&(l=0,u=1),o.cols[l].id=a.component,o.cols[u].on={onItemClick:(t,i)=>{var s=t.replace("_menu",""),a=this.views((e=>e.id==s))[0],n=this._views.findIndex((e=>e.id==s));r.onShow(s),i.target.classList.contains("rename")?e.popupShow(a):i.target.classList.contains("move-back")?(this.viewReorder(s,n-1),this.emit("properties.updated",this)):i.target.classList.contains("move-next")&&(this.viewReorder(s,n+1),this.emit("properties.updated",this))}},o.cols[u].data&&o.cols[u].data.length>0&&o.cols[u].data.forEach((e=>{e.value=e.value+' <i class="fa fa-pencil-square rename ab-tab-edit"></i>',e.value+='<i class="fa fa-caret-up move-back ab-tab-up"></i>',e.value+=' <i class="fa fa-caret-down move-next ab-tab-down"></i>'}))}var c={tabEdit:(e,i,s)=>{var n=$$(a.component).getValue(),r=this.views((function(e){return e.id==n}))[0];return!!r&&(setTimeout((()=>{console.error("ABViewTab: refactor .actions to .emit"),t.actions.populateInterfaceWorkspace(r)}),50),e.preventDefault(),!1)},tabRemove:(e,t,i)=>{var s=$$(a.component).getValue(),r=this.views((e=>e.id==s))[0];return r&&webix.confirm({title:n("Delete tab"),text:n("Do you want to delete <b>{0}</b>?",[r.label]),callback:e=>{e&&(r.destroy(),$$(a.component).removeView(s))}}),e.preventDefault(),!1}};return{ui:{rows:[o]},init:e=>{r.init(e),$$(a.component)&&"tabview"==$$(a.component).config.view?webix.ui({container:$$(a.component).getMultiview().$view,view:"template",autoheight:!1,height:1,width:0,template:'<div class="ab-component-tools ab-layout-view ab-tab-tools"><i class="fa fa-trash ab-component-remove"></i><i class="fa fa-edit ab-component-edit"></i></div>',onClick:{"ab-component-edit":function(e,t,i){c.tabEdit(e,t,i)},"ab-component-remove":function(e,t,i){c.tabRemove(e,t,i)}}}):$$(a.component)&&"multiview"==$$(a.component).config.view&&webix.ui({container:$$(a.component).$view,view:"template",autoheight:!1,height:1,width:0,template:'<div class="ab-component-tools ab-layout-view ab-tab-tools"><i class="fa fa-trash ab-component-remove"></i><i class="fa fa-edit ab-component-edit"></i></div>',onClick:{"ab-component-edit":function(e,t,i){c.tabEdit(e,t,i)},"ab-component-remove":function(e,t,i){c.tabRemove(e,t,i)}}}),r.onShow()},logic:c}}static addTab(e,t,i,s){return t.currentEditObject().addTab(i,s)}static editTab(e,t,i,s,a){var n=t.currentEditObject().views((e=>e.id==i))[0];if(n)return n.label=s,n.tabicon=a,n.save()}static popupShow(e){var t=$$("ab-component-tab-add-new-tab-popup"),i=$$("ab-component-tab-add-new-tab-form"),s=$$("ab-component-tab-save-button");t&&(e?(i.setValues({id:e.id,label:e.label,tabicon:e.tabicon}),t.getHead().setHTML(n("Edit Tab")),s.setValue(n("Save"))):(i.setValues({id:null,label:""}),t.getHead().setHTML(n("Add Tab")),s.setValue(n("Add"))),s.refresh(),t.show())}static popupClose(){var e=$$("ab-component-tab-add-new-tab-popup");e&&e.hide()}static popupBusy(){var e=$$("ab-component-tab-save-button");e&&e.disable()}static popupReady(){var e=$$("ab-component-tab-save-button");e&&e.enable()}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return webix.ui({id:"ab-component-tab-add-new-tab-popup",view:"window",height:250,width:300,modal:!0,position:"center",head:" ",body:{id:"ab-component-tab-add-new-tab-form",view:"form",elements:[{view:"text",name:"label",id:"ab-component-tab-name",label:n("Label"),required:!0},{view:"combo",id:"ab-component-tab-icon",name:"tabicon",label:n("Icon"),options:{filter:function(e,t){return 0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())},body:{data:e.icons,template:"<i class='fa fa-fw fa-#value#'></i> #value#"}}},{cols:[{fillspace:!0},{view:"button",value:n("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.popupClose()}},{id:"ab-component-tab-save-button",view:"button",css:"webix_primary",value:n("Add Tab"),autowidth:!0,type:"form",click:()=>{let e=$$("ab-component-tab-add-new-tab-form");if(e.validate()){this.popupBusy();let s=e.getValues(),a=()=>{this.popupReady(),this.popupClose();let e=i.currentEditObject();e.emit("properties.updated",e)};null==s.id?this.addTab(t,i,s.label,s.tabicon).then((()=>a())):this.editTab(t,i,s.id,s.label,s.tabicon).then((()=>a()))}}}]}]}}).hide(),a.concat([{view:"counter",name:"height",label:n("Height")},{view:"counter",name:"minWidth",label:n("Minimum width")},{view:"checkbox",name:"stackTabs",labelRight:n("Stack Tabs Vertically"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox,on:{onChange:(e,i)=>{1==e?($$(t.sidebarWidth).show(),$$(t.sidebarPos).show(),$$(t.iconOnTop).hide()):($$(t.sidebarWidth).hide(),$$(t.sidebarPos).hide(),$$(t.iconOnTop).show())}}},{view:"checkbox",name:"iconOnTop",labelRight:n("Position icon above text"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"checkbox",name:"darkTheme",labelRight:n("Use Dark Theme"),labelWidth:this.AB.UISettings.config().labelWidthCheckbox},{view:"counter",name:"sidebarWidth",label:n("Width of Sidebar"),labelWidth:this.AB.UISettings.config().labelWidthXLarge},{view:"richselect",name:"sidebarPos",label:n("Position of Sidebar"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,options:[{id:"left",value:n("Left")},{id:"right",value:n("Right")}]},{view:"button",css:"webix_primary",value:n("Add Tab"),click:()=>{this.popupShow()}}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.height).setValue(i.settings.height||a.height),$$(t.minWidth).setValue(i.settings.minWidth||a.minWidth),$$(t.stackTabs).setValue(i.settings.stackTabs||a.stackTabs),$$(t.darkTheme).setValue(i.settings.darkTheme||a.darkTheme),$$(t.sidebarWidth).setValue(i.settings.sidebarWidth||a.sidebarWidth),$$(t.sidebarPos).setValue(i.settings.sidebarPos||a.sidebarPos),$$(t.iconOnTop).setValue(i.settings.iconOnTop||a.iconOnTop),i.settings.stackTabs?($$(t.sidebarWidth).show(),$$(t.sidebarPos).show(),$$(t.iconOnTop).hide()):($$(t.sidebarWidth).hide(),$$(t.sidebarPos).hide(),$$(t.iconOnTop).show())}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.height=$$(e.height).getValue(),t.settings.minWidth=$$(e.minWidth).getValue(),t.settings.stackTabs=$$(e.stackTabs).getValue(),t.settings.darkTheme=$$(e.darkTheme).getValue(),t.settings.sidebarWidth=$$(e.sidebarWidth).getValue(),t.settings.sidebarPos=$$(e.sidebarPos).getValue(),t.settings.iconOnTop=$$(e.iconOnTop).getValue()}component(e){this.AB,super.component(e),this._viewComponents=[],this.views().forEach((e=>{e.getUserAccess()>0&&this._viewComponents.push({view:e})}));var t="ABViewTab_"+this.id,i={component:e.unique(`${t}_component`),sidebar:e.unique(`${t}_sidebar`),expandMenu:e.unique(`${t}_expand_menu`),collapseMenu:e.unique(`${t}_collapse_menu`)},s={};if(webix.type(webix.ui.tree,{baseType:"sideBar",name:"customIcons",icon:function(e,t){return e.icon.length?"<span class='webix_icon webix_sidebar_icon fa fa-fw fa-"+e.icon+"'></span>":"<span class='webix_icon webix_sidebar_icon sidebarCustomIcon'>"+e.value.charAt(0).toUpperCase()+"</span>"}}),this._viewComponents.length>0)if(this.settings.stackTabs){var a=this.views((e=>{if(e.getUserAccess()>0)return e})).map((e=>({id:e.id+"_menu",value:e.label,icon:e.tabicon?e.tabicon:""})));if(a.length){var r={id:i.collapseMenu,value:n("Collapse Menu"),icon:"chevron-circle-left"},o={id:i.expandMenu,value:n("Expand Menu"),icon:"chevron-circle-right",hidden:!0},l=this._viewComponents[0].view.id+"_menu",u={view:"sidebar",type:"customIcons",id:i.sidebar,width:this.settings.sidebarWidth?this.settings.sidebarWidth:0,scroll:!0,position:this.settings.sidebarPos?this.settings.sidebarPos:"left",css:this.settings.darkTheme?"webix_dark":"",data:a.concat(r),on:{onItemClick:function(e,s,a){e==i.collapseMenu?setTimeout((function(){$$(i.sidebar).remove(i.collapseMenu),$$(i.sidebar).add(o),$$(i.sidebar).toggle(),$$(i.sidebar).select(l),this.AB.Storage.set(`${t}-state`,$$(i.sidebar).getState())}),0):e==i.expandMenu?setTimeout((function(){$$(i.sidebar).remove(i.expandMenu),$$(i.sidebar).add(r),$$(i.sidebar).toggle(),$$(i.sidebar).select(l),this.AB.Storage.set(`${t}-state`,$$(i.sidebar).getState())}),0):(l=e,e=e.replace("_menu",""),$$(e).show(!1,!1))},onAfterRender:()=>{let e=$$(i.sidebar).$view.querySelector(`[webix_tm_id="${i.collapseMenu}"]`);e&&e.setAttribute("data-cy",`tab-collapseMenu-${i.collapseMenu}`);let t=$$(i.sidebar).$view.querySelector(`[webix_tm_id="${i.expandMenu}"]`);t&&t.setAttribute("data-cy",`tab-expandMenu-${i.expandMenu}`),this.views((e=>{var t=$$(i.sidebar).$view.querySelector(`[webix_tm_id="${e.id}_menu"]`);t&&t.setAttribute("data-cy",`tab-${e.label.replace(" ","")}-${e.id}-${this.id}`)}))}}},c={view:"multiview",id:i.component,keepViews:!0,minWidth:this.settings.minWidth,height:this.settings.height,cells:this._viewComponents.map((e=>({id:e.view.id,view:"layout",rows:[]}))),on:{onViewChange:function(e,t){m(t)}}},d=[u,c];"right"==this.settings.sidebarPos&&(d=[c,u]),s={cols:d}}else s={view:"spacer"}}else{var h=this.views((e=>{if(e.getUserAccess()>0)return e})).map((e=>{var t={id:e.id,view:"layout",rows:[]};return{header:e.tabicon?this.settings.iconOnTop?"<div class='ab-tabIconContainer'><span class='fa fa-lg fa-fw fa-"+e.tabicon+"'></span><br/>"+e.label+"</div>":"<span class='fa fa-lg fa-fw fa-"+e.tabicon+"'></span> "+e.label:e.label,body:t}}));s=h.length?{rows:[{view:"tabview",id:i.component,minWidth:this.settings.minWidth,tabbar:{height:60,type:"bottom",css:this.settings.darkTheme?"webix_dark":"",on:{onAfterRender:()=>{this.views((e=>{var t=$$(i.component).$view.querySelector('[button_id="'+e.id+'"]');t&&t.setAttribute("data-cy","tab "+e.name+" "+e.id+" "+this.id)}))}}},multiview:{height:this.settings.height,on:{onViewChange:function(e,t){m(t)}}},cells:h}]}:{view:"spacer"}}else s={view:"spacer"};var p={changePage:e=>{$$(i.component).blockEvent(),this.changePage(e),$$(i.component).unblockEvent()},changeTab:e=>{if(p.toggleParent(this.parent),this.settings.stackTabs){if(!$$(e).isVisible())var t=setInterval((function(){$$(e).isVisible()&&clearInterval(t),$$(e).show(!1,!1)}),200)}else $$(i.component).setValue(e)},toggleParent:e=>{("tab"==e.key||"viewcontainer"==e.key)&&$$(e.id)&&$$(e.id).show&&$$(e.id).show(!1,!1),e.parent&&p.toggleParent(e.parent)}},m=t=>{var s=this,a=!1;if(!t){var n=$$(i.sidebar);n&&(t=n.getSelectedId().replace("_menu",""))}this._viewComponents.forEach(((n,r)=>{var o=this.views((e=>e.id==n.view.id)),l=0;o.length&&(l=o[0].getUserAccess()),!t&&!a&&l>0&&(t=n.view.id,a=!0),null==n.component&&n.view.id==t&&($$(i.component)&&$$(i.component).showProgress&&$$(i.component).showProgress({type:"icon"}),n.component=n.view.component(e),s.settings.stackTabs?webix.ui({id:n.view.id,view:"scrollview",css:"ab-multiview-scrollview",body:n.component.ui},$$(n.view.id)):webix.ui({id:n.view.id,view:"scrollview",css:"ab-tabview-scrollview",body:n.component.ui},$$(n.view.id)),l=n.view.getUserAccess(),n.component.init(null,l),setTimeout((()=>{$$(i.component)&&$$(i.component).hideProgress&&$$(i.component).hideProgress()}),10)),n.view.id==t&&n.component&&n.component.onShow&&n.component.onShow(),s.settings.stackTabs&&n.view.id==t&&($$(t).show(!1,!1),$$(i.sidebar).select(t+"_menu"))}))};return{ui:s,init:e=>{$$(i.component)&&webix.extend($$(i.component),webix.ProgressBar),this._viewComponents.forEach((e=>{this.eventAdd({emitter:e.view,eventName:"changePage",listener:(...e)=>p.changePage(...e)})})),this.eventAdd({emitter:this,eventName:"changeTab",listener:(...e)=>p.changeTab(...e)}),this.AB.Storage.get(`${t}-state`).then((e=>{e&&($$(i.sidebar).setState(e),e.collapsed&&setTimeout((function(){$$(i.sidebar).remove(i.collapseMenu),$$(i.sidebar).add(o)}),0))}))},logic:p,onShow:m}}}},9403:(e,t,i)=>{const s=i(5239),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{editorComponent(e,t){webix.codebase="/js/webix/extras/";var i={component:e.unique("ABViewTextEditorComponent_component")},s={id:i.component,view:"tinymce-editor",value:this.text||a.text,config:{plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",init_instance_callback:e=>{e.on("KeyUp",(e=>{n.onChange()})),e.on("Change",(function(e){n.onChange()}))}}},n={onChange:()=>{this.__onChangeFn&&(clearTimeout(this.__onChangeFn),this.__onChangeFn=null),this.__onChangeFn=setTimeout((()=>{this.text=$$(i.component).getValue(),this.save()}),400)}};return{ui:s,init:e=>{},logic:n}}static propertyEditorDefaultElements(e,t,i,s){var a=super.propertyEditorDefaultElements(e,t,i,s);return i.selectSource=(e,s)=>{var a=i.currentEditObject();this.propertyUpdateFieldOptions(t,a,e)},i.selectField=e=>{let t=`{${e.label}}`;tinymce.activeEditor.execCommand("mceInsertContent",!1,t)},a.concat([{view:"counter",name:"height",label:n("Height:"),labelWidth:this.AB.UISettings.config().labelWidthLarge},{name:"datacollection",view:"richselect",label:n("Data Source"),labelWidth:this.AB.UISettings.config().labelWidthLarge,on:{onChange:i.selectSource}},{name:"field",view:"list",autoheight:!0,template:"#label#",on:{onItemClick:function(e,t,s){var a=this.getItem(e);i.selectField(a)}}}])}static propertyUpdateFieldOptions(e,t,i){var s=t.AB.datacollectionByID(i);s||"dataview"!=t.parent.key||(s=t.AB.datacollectionByID(t.parent.settings.dataviewID),$$(e.datacollection).setValue(t.parent.settings.dataviewID));var a=s?s.datasource:null;$$(e.field).clearAll(),a&&$$(e.field).parse(a.fields()),$$(e.field).refresh()}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.height).setValue(i.settings.height);var s=i.settings.dataviewID?i.settings.dataviewID:null,a=$$(t.datacollection),n=i.propertyDatacollections();a.define("options",n),a.define("value",s),a.refresh(),this.propertyUpdateFieldOptions(t,i,s)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.settings.height=$$(e.height).getValue(),t.settings.dataviewID=$$(e.datacollection).getValue()}component(e,t){let i=super.component(e);var s=`ABViewText_${t||""}${this.id}`,a={component:e.unique(`${s}_component`)},n={displayText:e=>{var t=this.displayText(e,a.component);$$(a.component)&&($$(a.component).define("template",t),$$(a.component).refresh())}},r={id:a.component,view:"template",autoheight:!0,minHeight:10,css:"ab-custom-template",borderless:!0};return this.settings.height?r.height=this.settings.height:r.autoheight=!0,{ui:r,init:e=>{},logic:n,onShow:e=>{i.onShow(e);let t=this.datacollection;t&&"dataview"!=this.parent.key&&this.eventAdd({emitter:t,eventName:"changeCursor",listener:(...e)=>n.displayText(...e)}),n.displayText()}}}}},1895:(e,t,i)=>{const s=i(9436),a=s.defaultValues();let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{static propertyEditorDefaultElements(e,t,i,s){return super.propertyEditorDefaultElements(e,t,i,s).concat([{name:"columnSpan",view:"counter",min:1,label:n("Column Span"),hidden:!0},{name:"rowSpan",view:"counter",min:1,label:n("Row Span"),hidden:!0}])}static propertyEditorPopulate(e,t,i){super.propertyEditorPopulate(e,t,i),$$(t.columnSpan).setValue(i.position.dx||a.columnSpan),$$(t.rowSpan).setValue(i.position.dy||a.rowSpan)}static propertyEditorValues(e,t){super.propertyEditorValues(e,t),t.position.dx=$$(e.columnSpan).getValue(),t.position.dy=$$(e.rowSpan).getValue()}component(e){let t=super.component(e);return t.onShow=e=>{let t=this.datacollection;t&&t.dataStatus==t.dataStatusFlag.notInitial&&t.loadData()},t}}},557:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(2735);class a extends s.Z{static get default(){return{}}static propertyComponent(){let e={callbacks:{}};return{ui:{view:"template",template:"No UI"},init:t=>{for(var i in e.callbacks)e.callbacks[i]=t[i]||e.callbacks[i]},logic:e}}fromSettings(e){this.settings=e}toSettings(){return this.settings||{}}component(e,t){this.App=e,this.idBase=t;let i={callbacks:{}};return{ui:{view:"template",template:"No UI"},init:e=>{for(var t in i.callbacks)i.callbacks[t]=e[t]||i.callbacks[t]},logic:i}}}},5751:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(557);let a=(...e)=>AB.Multilingual.label(...e);class n extends s.Z{static get default(){return{formView:"none"}}static propertyComponent(e,t){let i={formView:`${t}_formView`},s={id:i.formView,name:"formView",view:"richselect",label:a("Add New Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(e,t)=>{e==a("No add new option")&&$$(i.formView).setValue(""),n.callbacks.onSave()}}},n={callbacks:{onSave:function(){console.warn("NO onSave()!")}},setSettings:(e,t={})=>{if(null==e)return;let s=[{id:"none",value:a("No add new option")}],n=e.pageRoot().pages((t=>t.views((t=>t&&"form"==t.key&&t.datacollection&&t.datacollection.datasource&&t.datacollection.datasource.id==e.field().settings.linkObject),!0).length),!0).map((e=>({id:e.id,value:e.label})));s=s.concat(n);let r=$$(i.formView);r&&(r.define("options",s),r.define("value",t.formView||this.default.formView),r.refresh())},getSettings:e=>{let t=e.settings||{};return t.formView=$$(i.formView).getValue(),t}};return{ui:s,init:e=>{for(let t in n.callbacks)n.callbacks[t]=e[t]||n.callbacks[t]},setSettings:n.setSettings,getSettings:n.getSettings}}fromSettings(e={}){this.settings=this.settings||{},this.settings.formView=e.formView||this.constructor.default.formView}component(e,t){let i={popup:e.unique(`${t}_popup_add_new`),field:t.split("_")[1],button:e.unique(`${t}_popup_add_new_button`)},s="";if(this.settings.formView&&this.settings.formView!=this.constructor.default.formView){const e=`add new CR button ${this.settings.formView} ${i.field}`;s={id:i.button,view:"button",type:"icon",icon:"fa fa-plus",width:32,height:32,css:"webix_primary ab-connect-add-new-link",on:{onAfterRender:()=>{$$(i.button)?.$view.querySelector("button").setAttribute("data-cy",e)}}}}let n={callbacks:{onSaveData:e=>{$$(i.popup)&&$$(i.popup).close()},onCancel:()=>($$(i.popup)&&$$(i.popup).close(),!1),onClearOnLoad:()=>!0},applicationLoad:e=>{this._application=e},onClick:e=>{let t=this.settings.formView,i=this._application.pages((e=>e.id==t),!0)[0];return n.openFormPopup(i,e)},openFormPopup:(t,s)=>new Promise(((r,o)=>{if(null==this._application)return r();if($$(i.popup))return $$(i.popup).show(),r();let l=t.clone(null,null,{ignoreSubPages:!0});l.id=this._application.AB.uuid();let u=l.component(e),c=u.ui,d={view:"window",id:i.popup,modal:!0,position:"center",resize:!0,width:parseInt(this.settings.popupWidth)||700,height:parseInt(this.settings.popupHeight)+44||450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:t.label,css:"modal_title",align:"center"},{view:"button",label:a("Close"),autowidth:!0,align:"center",click:function(){this.getTopParentView().close()}}]},body:{view:"scrollview",scroll:!0,body:c}};webix.ui(d).show(),setTimeout((()=>{u.init({onSaveData:n.callbacks.onSaveData,onCancelClick:n.callbacks.onCancel,clearOnLoad:n.callbacks.onClearOnLoad}),u.onShow(),n.setDefaultValue(s,l),r()}),50)})),setDefaultValue:(e,t)=>{if(!e)return;let i=e.datasource;if(!i)return;let s=e.getCursor();s&&t.views().forEach((e=>{e&&"form"==e.key&&e.views().forEach((t=>{if("connect"!=t.key||null==t.settings)return;let a=t.field();if(null==a)return;let n=a.datasourceLink;if(null==n||n.id!=i.id)return;let r={},o=a.relationName();if(r[o]={id:s.id},(i.indexes()||[]).forEach((e=>{(e.fields||[]).forEach((e=>{r[o][e.columnName]=s[e.columnName]}))})),s.text)r[o].text=s.text,r[o].value=r[o].text;else{let e={};e[o]=s,r[o].text=a.format(e),r[o].value=r[o].text}let l=e.viewComponents[t.id];l&&a.setValue($$(l.ui.inputId),r)}))}))}};return{ui:s,init:e=>{for(let t in n.callbacks)n.callbacks[t]=e[t]||n.callbacks[t]},applicationLoad:n.applicationLoad,onClick:n.onClick,openFormPopup:n.openFormPopup}}}},7025:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(5751);let a=(...e)=>AB.Multilingual.label(...e);class n extends s.Z{static get default(){return{editForm:"none"}}static propertyComponent(e,t){let i={formEdit:`${t}_editForm`},s={id:i.formEdit,name:"editForm",view:"richselect",label:a("Edit Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(e,t)=>{e==a("No add new option")&&$$(i.formEdit).setValue(""),n.callbacks.onSave()}}},n={callbacks:{onSave:function(){console.warn("NO onSave()!")}},setSettings:(e,t={})=>{if(null==e)return;let s=[{id:"none",value:a("No add new option")}];(e.pageRoot().pages((()=>!0),!0)||[]).forEach((t=>{t&&t.views((()=>!0),!0).forEach((i=>{i&&"form"==i.key&&i.datacollection&&i.datacollection.datasource&&i.datacollection.datasource.id==e.field().settings.linkObject&&s.push({id:i.urlPointer(),value:`${t.label} - ${i.label}`})}))}));let n=$$(i.formEdit);n&&(n.define("options",s),n.define("value",t.editForm||this.default.editForm),n.refresh())},getSettings:e=>{let t=e.settings||{},s=$$(i.formEdit),a=(s.getPopup().config.body.data||[]).filter((e=>e.id==s.getValue()))[0];return a&&(t.editForm=a.id),t}};return{ui:s,init:e=>{for(let t in n.callbacks)n.callbacks[t]=e[t]||n.callbacks[t]},setSettings:n.setSettings,getSettings:n.getSettings}}fromSettings(e={}){this.settings=this.settings||{},this.settings.editForm=e.editForm||this.constructor.default.editForm}component(e,t){t=`${t}_popup_edit_form`;let i=super.component(e,t);return i.onClick=()=>{if(!this._application||!this.settings.editForm||this.settings.editForm==this.constructor.default.editForm)return Promise.resolve();let e=this._application.urlResolve(this.settings.editForm);if(!e)return Promise.resolve();let t=e.pageParent();return t?i.openFormPopup(t):Promise.resolve()},i}}},4204:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(557);let a=(...e)=>AB.Multilingual.label(...e);class n extends s.Z{constructor(e,t){super({filterPanel:`${t}_filterPanel`,globalFilterFormContainer:`${t}__globalFilterFormContainer`,globalFilterForm:`${t}_globalFilterForm`,filterMenutoolbar:`${t}_filterMenuToolbar`,resetFilterButton:`${t}_resetFilterButton`,component:`${t}_filterData_popup`}),this.AB=e,this.idBase=t,this.object=null,this.__externalSearchText=null,this.rowFilter=this.AB.filterComplexNew(`${this.ids.component}_filter`),this.rowFilterForm=this.AB.filterComplexNew(`${this.ids.component}_filter_form`)}static get default(){return{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1}}fromSettings(e){(e=e||{}).filterOption=void 0!==e.filterOption?e.filterOption:n.default.filterOption,e.isGlobalToolbar=void 0!==e.isGlobalToolbar?e.isGlobalToolbar:n.default.isGlobalToolbar,this.settings=e}objectLoad(e){this.object=e,this.rowFilter&&this.rowFilter.fieldsLoad(e.fields()),this.rowFilterForm&&this.rowFilterForm.fieldsLoad(e.fields())}viewLoad(e){this.view=e}ui(){var e=this,t=this.ids;return{id:t.filterPanel,type:"space",borderless:!0,padding:0,rows:[{id:t.globalFilterFormContainer,hidden:!0,cols:[{id:t.globalFilterForm,view:"text",placeholder:a("Search or scan a barcode to see results"),on:{onTimedKeyPress:()=>{this.triggerCallback()}}},{view:"button",css:"webix_primary",width:28,type:"icon",icon:"fa fa-times",click:function(){var e=$$(t.globalFilterForm);e.setValue(""),e.focus(),e.callEvent("onTimedKeyPress")}}]},this.rowFilterForm.ui,{view:"toolbar",id:t.filterMenutoolbar,css:"ab-data-toolbar",hidden:!0,cols:[{view:"button",css:"webix_primary",id:t.resetFilterButton,label:a("Reset Filter"),icon:"fa fa-ban",type:"icon",badge:0,autowidth:!0,click:function(){e.resetFilter()}}]}]}}async init(e){e&&(this.AB=e);var t=this.ids;switch(this.rowFilter.init(),this.rowFilter.on("changed",(e=>{let t=e.rules||[];this.triggerCallback((e=>this.rowFilter.isValid(e)),t)})),this.rowFilterForm.init(),this.rowFilterForm.on("changed",(()=>{this.triggerCallback()})),$$(t.filterPanel)?.hide(),$$(this.rowFilterForm.ui.id)&&$$(this.rowFilterForm.ui.id).hide(),$$(t.filterMenutoolbar).hide(),$$(t.globalFilterFormContainer).hide(),this.settings.filterOption){case 0:break;case 1:switch(this.settings.userFilterPosition){case"form":$$(this.rowFilterForm.ui.id).show(),$$(t.filterPanel).show();break;case"toolbar":$$(t.filterPanel).hide()}break;case 2:$$(t.filterPanel).show();var i=$$(t.filterMenutoolbar);i&&(i.show(),this.settings?.queryRules&&(this.settings.queryRules||[]).forEach((e=>{var t={view:"button",css:"webix_primary",label:e.ruleName,icon:"fa fa-filter",type:"icon",badge:0,autowidth:!0,click:()=>{this.selectFilter(e.queryRules)}};i.addView(t)})));break;case 3:$$(t.globalFilterFormContainer).show(),$$(t.filterPanel).show()}}filterRules(){let e=null;switch(this.settings.userFilterPosition){case"form":e=this.rowFilterForm.getValue();break;case"toolbar":e=this.rowFilter.getValue()}return e}triggerCallback(){let e=this.searchText(this.__externalSearchText),t=this.filterRules();t?.rules?.length?e&&(t={glue:"and",rules:[t,e]}):t=e,this.emit("filter.data",null,t)}resetFilter(){this.triggerCallback((()=>!0),[])}externalSearchText(e=null){this.__externalSearchText=e,this.triggerCallback()}searchText(e){var t;if(!(t=e||($$(this.ids.globalFilterForm).getValue()||"").trim()))return null;let i=t.trim().toLowerCase().split(" ");var s=[],a=this.object?.fields()||[];return i.forEach((e=>{var t=[];a.forEach((i=>{if(i.fieldIsFilterable())switch(i.key){case"string":case"LongText":case"email":t.push({key:i.id,rule:"contains",value:e});break;case"list":i.options().forEach((s=>{s.text.indexOf(e)>-1&&t.push({key:i.id,rule:"equals",value:s.id})}))}})),t.length>0&&s.push({glue:"or",rules:t})})),s.length>0?{glue:"and",rules:s}:null}showPopup(e){this.rowFilter.popUp(e)}component(e,t){super.component(e,t),this.App=e,this.idBase=t,this.rowFilter=this.AB.filterComplexNew(`${t}_filter`),this.rowFilterForm=this.AB.filterComplexNew(`${t}_filter_form`),this.object&&(this.rowFilter.fieldsLoad(this.object.fields()),this.rowFilterForm.fieldsLoad(this.object.fields()));let i={filterPanel:e.unique(`${t}_filterPanel`),globalFilterFormContainer:e.unique(`${t}_globalFilterFormContainer`),globalFilterForm:e.unique(`${t}_globalFilterForm`),filterMenutoolbar:e.unique(`${t}_filterMenuToolbar`),resetFilterButton:e.unique(`${t}_resetFilterButton`),component:e.unique(`${t}_filterData_popup`)},s=this;this.rowFilterForm.ui.hidden=!0;let n={id:i.filterPanel,type:"space",borderless:!0,padding:0,rows:[{id:i.globalFilterFormContainer,hidden:!0,cols:[{id:i.globalFilterForm,view:"text",placeholder:a("Search or scan a barcode to see results"),on:{onTimedKeyPress:function(){var e=this.getValue();r.searchText(e)}}},{view:"button",css:"webix_primary",width:28,type:"icon",icon:"fa fa-times",click:function(){$$(i.globalFilterForm).setValue(""),$$(i.globalFilterForm).focus(),$$(i.globalFilterForm).callEvent("onTimedKeyPress")}}]},this.rowFilterForm.ui,{view:"toolbar",id:i.filterMenutoolbar,css:"ab-data-toolbar",hidden:!0,cols:[{view:"button",css:"webix_primary",id:i.resetFilterButton,label:a("Reset Filter"),icon:"fa fa-ban",type:"icon",badge:0,autowidth:!0,click:function(){r.resetFilter()}}]}]},r={callbacks:{onFilterData:function(){console.warn("NO onFilterData()")}},triggerCallback:(e,t)=>{s.__currentFilter=e,r.callbacks.onFilterData(this.__currentFilter,t)},resetFilter:()=>{r.triggerCallback((function(){return!0}),[])},selectFilter:e=>{let t="hiddenQB_"+webix.uid();console.error("::: TODO: refactor getRule()");let i={id:t,hidden:!0,view:"querybuilder",fields:void 0},s=webix.ui(i);s.setValue(e);let a=s.getFilterHelper();s.destructor(),r.triggerCallback(a)},getFilter:()=>(null==s.__currentFilter&&(3==s.settings.filterOption&&"single"==s.settings.globalFilterPosition?s.__currentFilter=()=>!1:s.__currentFilter=()=>!0),s.__currentFilter),showFilterPopup(e){s.filter_popup.show(e,null,{pos:"top"})},closeFilterPopup(){s.filter_popup.hide()}};return{ui:n,init:e=>{for(var t in r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t];switch(this.rowFilter.init({}),this.rowFilterForm.init({}),$$(i.filterPanel).hide(),$$(this.rowFilterForm.ui.id)&&$$(this.rowFilterForm.ui.id).hide(),$$(i.filterMenutoolbar).hide(),$$(i.globalFilterFormContainer).hide(),this.settings.filterOption){case 0:break;case 1:switch(this.settings.userFilterPosition){case"form":$$(this.rowFilterForm.ui.id).show(),$$(i.filterPanel).show();break;case"toolbar":$$(i.filterPanel).hide()}break;case 2:$$(i.filterPanel).show(),$$(i.filterMenutoolbar).show(),this.settings.queryRules&&this.settings.queryRules.length>0&&this.settings.queryRules.forEach((e=>{var t={view:"button",css:"webix_primary",label:e.ruleName,icon:"fa fa-filter",type:"icon",badge:0,autowidth:!0,click:function(){r.selectFilter(e.queryRules)}};$$(i.filterMenutoolbar).addView(t)}));break;case 3:$$(i.globalFilterFormContainer).show(),$$(i.filterPanel).show()}},logic:r,showPopup:r.showFilterPopup,closePopup:r.closeFilterPopup,getFilter:r.getFilter,searchText:r.searchText}}}},5782:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(557);let a=(...e)=>AB.Multilingual.label(...e);class n extends s.Z{constructor(){super()}static get default(){return{detailsPage:null,detailsTab:null,editPage:null,editTab:null}}static propertyComponent(e,t){super.propertyComponent();const i=this.AB.Config.uiSettings();let s={detailsPage:t+"_linkPage_detailsPage",editPage:t+"_linkPage_editPage"},n=(e.labels,{view:"fieldset",label:a("Linked Pages:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:s.detailsPage,view:"select",name:"detailsPage",label:a("Details Page:"),labelWidth:i.labelWidthLarge},{id:s.editPage,view:"select",name:"editPage",label:a("Edit Form:"),labelWidth:i.labelWidthLarge}]}}),r={callbacks:{},viewLoad:e=>{this.view=e;let t=(t,i)=>t.key==i&&t.settings.dataviewID==e.settings.dataviewID,i=[];i=i.concat(e.pageRoot().views((e=>t(e,"detail")),!0).map((e=>({id:e.id,value:e.label})))),i=i.concat(e.pageRoot().pages((e=>e.views((e=>t(e,"detail")),!0).length),!0).map((e=>({id:e.id,value:e.label})))),i.unshift({id:"",value:a("No linked view")}),$$(s.detailsPage).define("options",i),$$(s.detailsPage).refresh();let n=[];n=n.concat(e.pageRoot().views((e=>t(e,"form")),!0).map((e=>({id:e.id,value:e.label})))),n=n.concat(e.pageRoot().pages((e=>e.views((e=>t(e,"form")),!0).length),!0).map((e=>({id:e.id,value:e.label})))),n.unshift({id:"",value:a("No linked form")}),$$(s.editPage).define("options",n),$$(s.editPage).refresh()},setSettings:e=>{var t=e.detailsPage;""!=e.detailsTab&&(t+=":"+e.detailsTab),$$(s.detailsPage).setValue(t);var i=e.editPage;""!=e.editTab&&(i+=":"+e.editTab),$$(s.editPage).setValue(i)},getSettings:()=>{let e={};var t=$$(s.detailsPage).getValue(),i="";if(t.split(":").length>1){var a=t.split(":");t=a[0],i=a[1]}e.detailsPage=t,e.detailsTab=i;var n=$$(s.editPage).getValue(),r="";if(n.split(":").length>1){var o=n.split(":");n=o[0],r=o[1]}return e.editPage=n,e.editTab=r,e}};return{ui:n,init:e=>{for(var t in r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t]},logic:r,viewLoad:r.viewLoad,setSettings:r.setSettings,getSettings:r.getSettings}}component(e,t){let i=super.component(e,t),s={changePage:(e,t)=>{this.datacollection&&this.datacollection.setCursor(t),this.view&&this.view.changePage(e)}};return{ui:i.ui,init:e=>{i.init(e),e.view&&(this.view=e.view),e.datacollection&&(this.datacollection=e.datacollection)},logic:s,changePage:s.changePage}}}},69:e=>{e.exports=class{constructor(e,t,i){this.defaultLabel=i||"default view",this.object=t,this.fromObj(e||{}),this.object.translate(this,this,["label"])}static type(){return"view"}fromObj(e){this.id=e.id||this.object.AB.uuid(),this.isDefaultView=JSON.parse(e.isDefaultView||!1),this.translations=e.translations||this.object.defaultTranslations(["label"],{label:this.defaultLabel})}toObj(){return this.object.unTranslate(this,this,["label"]),{id:this.id,translations:this.translations,isDefaultView:this.isDefaultView}}update(e){for(var t in e)this[t]=e[t]}}},3847:(e,t,i)=>{const s=i(7112),a=i(8318),n=i(3989);var r={};r[s.type()]=s,r[a.type()]=a,r[n.type()]=n;const o={currentViewID:void 0,list:[]};e.exports=class{constructor(e,t,i){this.object=t,this.AB=i,this.fromObj(e)}fromObj(e){if(e.objectWorkspaceViews=e.objectWorkspaceViews&&e.objectWorkspaceViews.list?e.objectWorkspaceViews:o,0===e.objectWorkspaceViews.list.filter((e=>e.isDefaultView)).length){void 0!==e.objectWorkspace&&(void 0===e.objectWorkspace.sortFields&&(e.objectWorkspace.sortFields=[]),void 0===e.objectWorkspace.filterConditions&&(e.objectWorkspace.filterConditions=[]),void 0===e.objectWorkspace.frozenColumnID&&(e.objectWorkspace.frozenColumnID=""),void 0===e.objectWorkspace.hiddenFields&&(e.objectWorkspace.hiddenFields=[]));var t=e.objectWorkspace||{sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};t.isDefaultView=!0;var i=new s(t,this.object);e.objectWorkspaceViews.list.unshift(i)}this.importViews(e.objectWorkspaceViews),this.currentViewID=e.objectWorkspaceViews.currentViewID,this.currentViewID||(this.currentViewID=this.list()[0].id)}toObj(){return{currentViewID:this.currentViewID,list:this.exportViews()}}list(e=(()=>!0)){return this._views.filter(e)}importViews(e){this._views=[],e.list.forEach((e=>{this.addView(e,!1)}))}exportViews(){var e=[];return this._views.forEach((t=>{e.push(t.toObj())})),e}setCurrentView(e){this.currentViewID=e}getCurrentView(){return this.list((e=>e.id==this.currentViewID))[0]}addView(e,t=!0){var i=new r[e.type](e,this.object);return this._views.push(i),t&&this.object.save(),i}removeView(e){var t=this._views.indexOf(e);this._views.splice(t,1),e.id===this.currentViewID&&(this.currentViewID=this._views[0].id),this.object.save()}updateView(e,t){var i;if(t.type===e.type)e.update(t),i=e;else{i=new r[t.type](t,this.object);var s=this._views.indexOf(e);this._views.splice(s,1,i),this.currentViewID===e.id&&(this.currentViewID=i.id)}return this.object.save(),i}}},8412:e=>{e.exports=class{constructor(e){this.elements=e.elements||function(){return[]},this.init=e.init||function(){},this.validate=e.validate||function(){return!0},this.values=e.values||function(){return{}},this.logic=e.logic||{}}}},3989:(e,t,i)=>{const s=i(69),a=i(8412),n=i(8893),r=i(176),o=i(1812),l=i(8134),u=i(4384);let c=(...e)=>AB.Multilingual.label(...e);var d={name:"Default Gantt",filterConditions:[],sortFields:[],title:"none",startDate:null,endDate:"none",duration:"none",progress:"none",notes:"none"};e.exports=class e extends s{constructor(e,t){super(e,t,"gantt")}static type(){return"gantt"}static icon(){return"fa fa-tasks"}static component(e,t){let i={title:e.unique(`${t}_popupGanttTitle`),startDate:e.unique(`${t}_popupGanttStartDate`),endDate:e.unique(`${t}_popupGanttEndDate`),duration:e.unique(`${t}_popupGanttDuration`),progress:e.unique(`${t}_popupGanttProgress`),notes:e.unique(`${t}_popupGanttNotes`)},s=(e,t)=>{let s=e.fields((e=>e instanceof r)).map((({id:e,label:t})=>({id:e,value:t})));$$(i.startDate).define("options",s),s.unshift({id:"none",value:c("Select a date field")}),$$(i.endDate).define("options",s);let a=e.fields((e=>e instanceof o)).map((({id:e,label:t})=>({id:e,value:t})));a.unshift({id:"none",value:c("Select a number field")}),$$(i.duration).define("options",a);let n=e.fields((e=>e instanceof o)).map((({id:e,label:t})=>({id:e,value:t})));n.unshift({id:"none",value:c("Select a number field")}),$$(i.progress).define("options",n);let h=e.fields((e=>e instanceof l||e instanceof u)).map((({id:e,label:t})=>({id:e,value:t})));h.unshift({id:"none",value:c("Select a string field")}),$$(i.title).define("options",h),$$(i.notes).define("options",h),t&&t.title&&($$(i.title).define("value",t.title),$$(i.title).refresh()),t&&t.startDate&&($$(i.startDate).define("value",t.startDate),$$(i.startDate).refresh()),t&&t.endDate&&($$(i.endDate).define("value",t.endDate||d.endDate),$$(i.endDate).refresh()),t&&t.duration&&($$(i.duration).define("value",t.duration||d.duration),$$(i.duration).refresh()),t&&t.progress&&($$(i.progress).define("value",t.progress),$$(i.progress).refresh()),t&&t.notes&&($$(i.notes).define("value",t.notes),$$(i.notes).refresh())};var h=new n(e,`${t}_gantt`);return new a({elements:()=>({batch:"gantt",rows:[{cols:[{id:i.title,view:"richselect",label:`<span class='webix_icon fa fa-calendar'></span> ${c("Title")}`,placeholder:c("Select a string field"),labelWidth:130,name:"title",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,l.defaults().key)}}]},{cols:[{id:i.startDate,view:"richselect",label:`<span class='webix_icon fa fa-calendar'></span> ${c("Start Date")}`,placeholder:c("Select a date field"),labelWidth:130,name:"startDate",required:!0,options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,r.defaults().key)}}]},{cols:[{id:i.endDate,view:"richselect",label:`<span class='webix_icon fa fa-calendar'></span> ${c("End Date")}`,placeholder:c("Select a date field"),labelWidth:130,name:"endDate",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,r.defaults().key)}}]},{cols:[{id:i.duration,view:"richselect",label:`<span class='webix_icon fa fa-hashtag'></span> ${c("Duration")}`,placeholder:c("Select a number field"),labelWidth:130,name:"duration",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,o.defaults().key)}}]},{cols:[{id:i.progress,view:"richselect",label:`<span class='webix_icon fa fa-hashtag'></span> ${c("Progress")}`,placeholder:c("Select a number field"),labelWidth:130,name:"progress",required:!1,options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,o.defaults().key)}}]},{cols:[{id:i.notes,view:"richselect",label:`<span class='webix_icon fa fa-align-right'></span> ${c("Notes")}`,placeholder:c("Select a string field"),labelWidth:130,name:"notes",required:!1,options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,u.defaults().key)}}]}]}),init:(e,t)=>{e&&(s(e,t),h.applicationLoad(e.application),h.objectLoad(e),h.init({onSave:()=>{s(e,t)}}))},validate:function(e){let t=$$(i.endDate).getValue()||d.endDate,s=$$(i.duration).getValue()||d.duration;return t!=d.endDate||s!=d.duration||(e.markInvalid("endDate","Required"),e.markInvalid("duration","Required"),!1)},values:function(){let e={};return e.title=$$(i.title).getValue()||d.title,e.startDate=$$(i.startDate).getValue()||d.startDate,e.endDate=$$(i.endDate).getValue()||d.endDate,e.duration=$$(i.duration).getValue()||d.duration,e.progress=$$(i.progress).getValue()||d.progress,e.notes=$$(i.notes).getValue()||d.notes,e},logic:{}})}fromObj(t){for(var i in super.fromObj(t),d)this[i]=t[i]||d[i];this.type=e.type()}toObj(){var t=super.toObj();for(var i in d)t[i]=this[i];return t.type=e.type(),t}get titleField(){return this.object.object.fieldByID(this.title)}get startDateField(){return this.object.object.fieldByID(this.startDate)}get endDateField(){return this.object.object.fieldByID(this.endDate)}get durationField(){return this.object.object.fieldByID(this.duration)}get progressField(){return this.object.object.fieldByID(this.progress)}get notesField(){return this.object.object.fieldByID(this.notes)}}},7112:(e,t,i)=>{const s=i(69);var a={name:"Default Grid",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};e.exports=class e extends s{constructor(e,t){super(e,t,"grid")}static type(){return"grid"}static icon(){return"fa fa-table"}fromObj(t){for(var i in super.fromObj(t),a)this[i]=t[i]||a[i];this.type=e.type()}toObj(){var e=super.toObj();for(var t in a)e[t]=this[t];return e.type="grid",e}}},8318:(e,t,i)=>{const s=i(69),a=i(8412),n=i(8893),r=i(6589),o=i(9319),l=i(9333);var u={name:"Default Kanban",filterConditions:[],sortFields:[],verticalGroupingField:null,horizontalGroupingField:null,ownerField:null};let c=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends s{constructor(e,t){super(e,t,"kanban")}static type(){return"kanban"}static icon(){return"fa fa-columns"}static component(e,t){let i={vGroupInput:`${t}_popupAddViewVGroup`,hGroupInput:`${t}_popupAddViewHGroup`,ownerInput:`${t}_popupAddViewOwner`},s=(e,t,s={})=>{const a=(i,s,a=(e=>e.key===o.defaults().key),n)=>{if(null!=i&&null!=e){var r=e.fields().filter(a).map((({id:e,label:t})=>({id:e,value:t})));!n&&r.length&&r.unshift({id:0,value:c("None")}),i.define("options",r),t?t[s]?i.define("value",t[s]):!n&&r[0]&&i.define("value",r[0].id):1===r.filter((e=>e.id)).length&&i.define("value",r[0].id),i.refresh()}};a(s.vGroupInput||$$(i.vGroupInput),"verticalGroupingField",(e=>[o.defaults().key,l.defaults().key].includes(e.key)),!0),a(s.hGroupInput||$$(i.hGroupInput),"horizontalGroupingField",(e=>[r.defaults().key,o.defaults().key,l.defaults().key].includes(e.key)),!1),a(s.ownerInput||$$(i.ownerInput),"ownerField",(e=>e.key===l.defaults().key||e.key===r.defaults().key&&"one"==e.settings.linkType&&"many"==e.settings.linkViaType),!1)};var u=new n(e,`${t}_kanban`);return new a({elements:()=>({batch:"kanban",rows:[{cols:[{view:"richselect",label:`<span class='webix_icon fa fa-columns'></span> ${c("Vertical Grouping")}`,id:i.vGroupInput,placeholder:c("Select a field"),labelWidth:180,name:"vGroup",required:!0,options:[],on:{onChange:function(e){$$(i.vGroupInput).validate(),$$(i.hGroupInput).validate()}},invalidMessage:c("Required")},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,o.defaults().key)}}]},{cols:[{view:"richselect",label:`<span class='webix_icon fa fa-list'></span> ${c("Horizontal Grouping")}`,id:i.hGroupInput,placeholder:c("Select a field"),labelWidth:180,name:"hGroup",required:!1,options:[],invalidMessage:c("Cannot be the same as vertical grouping field"),validate:e=>{var t=$$(i.vGroupInput).getValue();return!t||!e||t!==e},on:{onChange:function(e){$$(i.hGroupInput).validate()}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,o.defaults().key)}}]},{cols:[{view:"richselect",label:`<span class='webix_icon fa fa-user-circle'></span> ${c("Card Owner")}`,placeholder:c("Select a user field"),id:i.ownerInput,labelWidth:180,name:"owner",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,r.defaults().key)}}]}]}),init:(e,t)=>{s(e,t),u.applicationLoad(e.application),u.objectLoad(e),u.init({onSave:()=>{s(e,t)}})},values:function(){let e={};return e.verticalGroupingField=$$(i.vGroupInput).getValue()||null,e.horizontalGroupingField=$$(i.hGroupInput).getValue()||null,e.ownerField=$$(i.ownerInput).getValue()||null,e},logic:{refreshOptions:s}})}fromObj(t){for(var i in super.fromObj(t),u)this[i]=t[i]||u[i];this.type=e.type()}toObj(){var t=super.toObj();for(var i in u)t[i]=this[i];return t.type=e.type(),t}getHorizontalGroupingField(){return this.object.object.fieldByID(this.horizontalGroupingField)}getVerticalGroupingField(){return this.object.object.fieldByID(this.verticalGroupingField)}getOwnerField(){return this.object.object.fieldByID(this.ownerField)}}},679:e=>{e.exports=class{constructor(e){this.label=e,this.ui=null}cleanRules(e,t,i){void 0===i&&(i=!0),function e(s){if(s)if(s.glue&&s.rules)s.rules.forEach((t=>{e(t)}));else{var a=t.filter((e=>e.id==s.key))[0];if(a)switch(a.type){case"number":case"formula":"string"==typeof s.value&&(-1==s.value.indexOf(".")?s.value=parseInt(s.value):s.value=parseFloat(s.value));break;case"date":i?s.value instanceof Date&&(s.value=webix.i18n.dateFormatStr(s.value)):"string"==typeof s.value&&(s.value=new Date(s.value))}}}(e)}component(e,t){this.App=e,this.idBase=t;var i=e.Label,s=webix.uid(),a=e=>`${t}_${e}_${s}`,n=this.ids={component:a("qbObjectFieldConditions"),queryBuilder:a("qBuilder"),queryBuilderContainer:a("qBuilderContainer"),queryBuilderLayout:a("qBuilderLayout"),showQBButton:a("showQBButton")};this.ui={view:"layout",id:n.queryBuilderLayout,hidden:!0,type:"line",rows:[{id:n.showQBButton,cols:[{fillspace:!0},{view:"button",css:"webix_primary",name:"addqb",value:i("Add Custom Conditions"),autowidth:!0,click:function(){$$(n.queryBuilderContainer).show(),$$(n.showQBButton).hide()}},{fillspace:!0}]},{hidden:!0,id:n.queryBuilderContainer,cols:[{view:"querybuilder",id:n.queryBuilder,fields:this.conditionFields()}]}]},this.label&&this.ui.rows[1].cols.unshift({view:"label",css:"ab-text-bold",label:this.label,width:this.AB.UISettings.config().labelWidthLarge}),this.init=e=>{for(var t in e=e||{},r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t]};var r=this._logic={callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(e){console.warn("NO onSave()!")}},cleanRules:(e,t,i)=>{this.cleanRules(e,t,i)},getValue:()=>{var e=null,t=$$(n.queryBuilder);return t&&(e=t.getValue()),e&&r.cleanRules(e[0],e[1],!0),e},setValue:e=>{e=e||[],Array.isArray(e)||(e=[e]),0==e.length&&e.push({}),e.length<2&&e.push(this.conditionFields()),r.cleanRules(e[0],e[1],!1);var t=$$(n.queryBuilder);t&&e[0]&&e[0].rules&&e[0].rules.length&&(t.setValue(e[0]),$$(n.queryBuilderContainer).show(),$$(n.showQBButton).hide())}};this.getValue=r.getValue,this.show=r.show,this.setValue=r.setValue}objectLoad(e){this.currentObject=e}conditionFields(){var e=["string","LongText","number","date","email","formula","calculate"],t=[];return this.currentObject&&this.currentObject.fields().forEach((i=>{if(-1!=e.indexOf(i.key)){let e=i.key;"formula"==i.key||"calculate"==i.key?e="number":"LongText"==i.key&&(e="string"),t.push({id:i.columnName,value:i.label,type:e})}})),t}process(e){return new Promise(((t,i)=>{var s=0,a=()=>{++s>=this.listRules.length&&t()};this.listRules.forEach((t=>{t.process(e).then((function(){a()})).catch((e=>{i(e)}))})),0==this.listRules.length&&t()}))}showQueryBuilderContainer(){$$(this.ids.queryBuilderLayout).show(),$$(this.ids.queryBuilderContainer).show(),$$(this.ids.showQBButton).hide()}}},2608:(e,t,i)=>{const s=i(679);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class{constructor(e){this.listActions=e||[],this.actionDropList=[],this.listActions.forEach((e=>{this.actionDropList.push({id:e.key,value:e.label})})),this.selectedAction=null,this.actionDropList.length>0&&(this.selectedAction=this.actionDropList[0].id),this.removable=!0,this.currentObject=null,this.objectQB=null,this.currentForm=null}component(e,t){this.App=e,this.idBase=t;var i=webix.uid(),s=e=>`${t}_${e}_${i}`,n=this.ids={component:s("component"),selectAction:s("chooseAction"),queryBuilder:s("queryBuilder"),valueDisplay:s("valueArea")};this.objectQB.label=a("When"),this.objectQB.component(this.App,this.idBase),this.ui=this._generateUI(),this.init=e=>{for(var t in r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t];this.objectQB.init();var i=this.currentAction();if(i){i.component(this.App,this.idBase);var s=i.valueDisplay(n.valueDisplay);r.replaceValueDisplay(s),s.init()}};var r=this._logic={callbacks:{onDelete:function(){console.warn("NO onDelete()!")},onSave:function(e){console.warn("NO onSave()!")}},replaceValueDisplay:e=>{var t=$$(this.ids.valueDisplay);if(t){var i=t.getChildViews(),s=[];i.forEach((e=>{s.push(e)})),s.forEach((e=>{t.removeView(e)})),t.addView(e.ui)}},selectAction:(e,t)=>{e&&$$(this.ids.component).getChildViews().forEach((e=>{e.show()}));var i=this.getAction(t);i&&i.stashCondition(this.objectQB.getValue()),this.selectedAction=e;var s=this.currentAction();if(s){this.objectQB.setValue(s.condition()),s.component(this.App,this.idBase);var a=s.valueDisplay(n.valueDisplay);r.replaceValueDisplay(a),a.init()}}}}_generateUI(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rules",padding:20,type:"line",rows:[{view:"template",css:"ab-component-form-rules-delete",template:'<i class="fa fa-trash ab-component-remove"></i>',height:30,borderless:!0,hidddatasourceen:0==this.removable,onClick:{"ab-component-remove":(e,t,i)=>{this._logic.callbacks.onDelete(this)}}},{id:this.ids.selectAction,view:"richselect",label:a("Action"),placeholder:a("Choose an action"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:this.actionDropList,on:{onChange:(e,t)=>{this._logic.selectAction(e,t)}}},{for:"values",hidden:!0,cells:[{view:"layout",cols:[{view:"label",label:a("Values"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthLarge},{id:this.ids.valueDisplay,view:"layout",rows:[{label:a(" ABViewRule: This should be the Set Area"),css:"ab-text-bold",height:30}]}]}]},this.objectQB.ui]}}conditionFields(){var e=[],t=this.currentAction();return t&&(e=t.conditionFields()),e}currentAction(){return this.getAction(this.selectedAction)}getAction(e){return this.listActions.filter((t=>t.key==e))[0]}objectLoad(e){this.currentObject=e,this.listActions.forEach((t=>{t.objectLoad(e)}));var t=a("When");this.objectQB=new s(t),this.objectQB.objectLoad(e),this.ids&&(this.ui=this._generateUI())}formLoad(e){this.currentForm=e,this.listActions.forEach((t=>{t.formLoad(e)}))}processPre(e={}){if(!this.isValid(e.data))return;let t=this.currentAction();t&&t.processUpdateObject({},e.data)}process(e){var t=this.currentAction();return t?this.isValid(e.data)?t.process(e):new Promise(((e,t)=>{e()})):Promise.resolve()}fromSettings(e){if((e=e||{}).selectedAction){this.selectedAction=e.selectedAction;var t=this.currentAction();if(!t)return;t.stashCondition(e.queryRules||{}),this.ids&&$$(this.ids.selectAction).setValue(this.selectedAction),t.fromSettings(e.actionSettings)}}toSettings(){var e={};if(this.selectedAction){e.selectedAction=this.selectedAction,e.queryRules=this.objectQB.getValue();let t=this.currentAction();t&&(e.actionSettings=t.toSettings())}return e}qbFixAfterShow(){var e=this.currentAction();e&&this.objectQB&&(this.objectQB.setValue(e.condition()),e.qbFixAfterShow())}async isReady(){let e=this.currentAction();return e?e.isReady():Promise.resolve()}isValid(e={}){var t={id:"hiddenQB_"+webix.uid(),hidden:!0,view:"querybuilder"},i=webix.ui(t),s=this.currentAction().condition();this.objectQB&&this.objectQB.cleanRules(s[0],s[1],!1);let a=s[0]||{},n=s[1]||[],r=(e="")=>"number"==typeof e?e:parseFloat(e.replace(/[^-0-9.]/g,""));n.filter((e=>"number"==e.type||"calculate"==e.type||"formula"==e.type)).forEach((t=>{try{a&&a.rules&&Array.isArray(a.rules)&&a.rules.forEach((e=>{e.key==t.id&&(e.value=r(e.value))})),e[t.id]&&"string"==typeof e[t.id]&&(e[t.id]=r(e[t.id]))}catch(e){}})),i.setValue({query:a,fields:n});var o=i.getFilterHelper()(e);return i.destructor(),o}get isPreProcess(){return this.currentAction().isPreProcess||!1}}},4496:e=>{e.exports=class{constructor(e,t,i){this.key="ABViewRuleAction",this.queryObject=null,this.currentForm=null,this.queryRules={},this.valueRules={},this.currentForm=i}component(e,t){this.App=e,this.idBase=t,this.label=((...e)=>AB.Multilingual.label(...e))("generic abviewruleaction"),this.ids={component:`${"component",e.unique(`${t}_component`)}_${webix.uid()}`},this._ui=null,this.init=e=>{for(var t in i.callbacks)i.callbacks[t]=e[t]||i.callbacks[t]};var i=this._logic={callbacks:{onDelete:function(){console.warn("NO onDelete()!")},onSave:function(e){console.warn("NO onSave()!")}}}}condition(){return[this.conditionRules(),this.conditionFields()]}stashCondition(e){Array.isArray(e)&&(e=e[0]),e&&("or"!=e.glue&&(e.glue="and"),this.queryRules=e)}conditionFields(){var e=["string","number","date","formula","calculate"],t=[];return this.queryObject&&this.queryObject.fields().forEach((i=>{-1!=e.indexOf(i.key)&&t.push({id:i.columnName,value:i.label,type:i.key})})),t}conditionRules(){return this.queryRules}objectLoad(e){this.queryObjectLoad(e)}queryObjectLoad(e){this.queryObject=e}formLoad(e){this.currentForm=e}process(e){return console.error("!!! ABViewRuleAction.process() should be overridden by its child class."),new Promise(((e,t)=>{t(new Error("ABViewRuleAction.process() should be overridden by its child class."))}))}valueDisplay(e){return this.valueDisplayComponent(e)}valueDisplayComponent(e){return this._ui={ui:{template:"ABViewRuleAction.valueDisplayComponent"},init:e=>{console.error("!!! ABViewRuleAction.valueDisplayComponent() should be overridden."),console.warn(" --\x3e passed in data:",e)}}}fromSettings(e){e=e||{},this.valueRules=e.valueRules||{}}toSettings(){return{}}isReady(){return Promise.resolve()}qbFixAfterShow(){}}},6574:e=>{let t=(...e)=>AB.Multilingual.label(...e);e.exports=class{constructor(e){this.listRules=[],this.currentObject=null,(e=e||{}).labels=e.labels||{},e.labels.header=e.labels.header||"ab.components.form.ruleList",e.labels.headerDefault=e.labels.headerDefault||"*Rule List",this.childSettings=e}component(e,i){this.App=this.App||e,this.idBase=i,e=e||this.App,this.currentForm=null;var s=this.ids={component:`${i}_component`,rules:`${i}_rules`,rulesScrollview:`${i}_rulesScrollview`,action:`${i}_action`,when:`${i}_when`,values:`${i}_values`,set:`${i}_set`};this.ui={view:"window",id:s.component,modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:this.childSettings.labels.headerDefault},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:t("Add new rule"),width:150,click:()=>{this.addRule(),console.log($$(s.rules).$height),$$(s.rulesScrollview).scrollTo(0,$$(s.rules).$height)}}]},body:{type:"form",rows:[{view:"scrollview",id:s.rulesScrollview,scroll:"xy",body:{view:"layout",id:s.rules,margin:20,padding:10,rows:[]}},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:t("Cancel"),css:"ab-cancel-button",autowidth:!0,click:function(){a.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:t("Save"),type:"form",autowidth:!0,click:function(){a.buttonSave()}},{fillspace:!0}]}]}},this.init=e=>{for(var t in a.callbacks)a.callbacks[t]=e[t]||a.callbacks[t];webix.ui(this.ui)};var a=this._logic={buttonCancel:function(){$$(s.component).hide()},buttonSave:()=>{var e=this.toSettings();a.callbacks.onSave(e),a.hide()},callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(e){console.warn("NO onSave()!")}},hide:function(){$$(s.component).hide()},show:function(){$$(s.component).show()}};this.show=a.show,this.setValue=a.setValue}addRule(e){var t=this.getRule();if(t){if(this.listRules.push(t),this.ids){var i=$$(this.ids.rules);i&&(t.component(this.App,this.idBase),i.addView(t.ui),t.init({onDelete:e=>{$$(this.ids.rules).removeView(t.ids.component);var i=this.listRules.indexOf(e);-1!==i&&this.listRules.splice(i,1)}}))}e&&t.fromSettings(e)}}fromSettings(e){this.listRules.forEach((e=>{this.ids&&this.ids.rules&&e&&e.ids&&e.ids.component&&$$(this.ids.rules).removeView(e.ids.component)})),this.listRules=[],e&&e.forEach((e=>{this.addRule(e)}))}objectLoad(e){this.currentObject=e,this.listRules.forEach((t=>{t.objectLoad(e)}))}processPre(e){(this.listRules||[]).filter((e=>1==e.isPreProcess)).forEach((t=>{t.processPre(e,e.data)}))}process(e){return new Promise(((t,i)=>{let s=(this.listRules||[]).filter((e=>!e.isPreProcess));var a=0;s.forEach((n=>{n.process(e).then((function(){++a>=s.length&&t()})).catch((e=>{i(e)}))})),0==s.length&&t()}))}toSettings(){var e=[];return this.listRules.forEach((t=>{e.push(t.toSettings())})),e}getRule(){return console.error("!!! ABViewRuleList.getRule() should be overridded by a child object."),null}formLoad(e){this.currentForm=e,this.App=this.App||e.App}rulesReady(){return Promise.resolve()}qbFixAfterShow(){this.listRules.forEach((e=>{e.qbFixAfterShow()}))}}},6204:(e,t,i)=>{const s=i(6574),a=i(2608),n=i(7318),r=i(7857),o=i(8135),l=i(4120);e.exports=class extends s{constructor(){super({labels:{header:"ab.components.form.recordRules",headerDefault:"*Record Rules"}})}getRule(){var e=[new n(this.App,`${this.idBase}_ruleActionUpdate`,this.currentForm),new r(this.App,`${this.idBase}_ruleActionInsert`,this.currentForm),new o(this.App,`${this.idBase}_ruleActionUpdateConnected`,this.currentForm),new l(this.App,`${this.idBase}_ruleActionRemoveConnected`,this.currentForm)],t=new a(e);return this.currentObject&&t.objectLoad(this.currentObject),t}async rulesReady(){var e=(this.listRules||[]).map((e=>e.isReady()));await Promise.all(e)}}},1567:(e,t,i)=>{const s=i(6574),a=i(2608),n=i(6220),r=i(4316),o=i(924),l=i(7521),u=i(4151),c=i(8873);e.exports=class extends s{constructor(){super({labels:{header:"ab.component.form.submitRule",headerDefault:"*Submit Rules"}})}getRule(){var e=[new n(this.App,`${this.idBase}_ruleActionConfirmMessage`),new r(this.App,`${this.idBase}_ruleActionExistPage`),new o(this.App,`${this.idBase}_ruleActionParentPage`),new l(this.App,`${this.idBase}_ruleActionClosePopup`),new u(this.App,`${this.idBase}_ruleActionWebsite`),new c(this.App,`${this.idBase}_ruleActionEmail`)],t=new a(e);return t.objectLoad(this.currentObject),t.formLoad(this.currentForm),t}}},7857:(e,t,i)=>{const s=i(8135);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleInsertConnected",this.label=((...e)=>AB.Multilingual.label(...e))("Insert Connected Object")}valueDisplayChooser(e){var t=super.valueDisplayChooser(e);return t._logic.showQBIfNeeded=function(){},t}queryBuilderDisplay(){return null}process(e){var t=this.connectedObject(),i=t.model(),s=this.selectedField(),a={};if(this.processUpdateObject({},a),!a.newRecords){let n=t.fieldByID(s.settings.linkColumn);return n?(a[n.columnName]=e.data.id,i.create(a)):Promise.reject("No connected object field")}{let n=t.fieldByID(s.settings.linkColumn);if(!n)return Promise.reject("No connected object field");a.newRecords.forEach((t=>(t[n.columnName]=e.data.id,i.create(t))))}}toSettings(){var e=super.toSettings();return delete e.qbCondition,e}}},4120:(e,t,i)=>{const s=i(8135);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleRemoveConnected",this.label=((...e)=>AB.Multilingual.label(...e))("Remove Connected Record"),this.isUpdateValueDisabled=!0}process(e){let t=this.selectedField();return this._formData=e.data,new Promise(((i,s)=>{let a=e.form.datacollection;if(!a)return i();let n=a.model;if(!n)return i();let r={};r[t.columnName]="",n.update(e.data.id,r).then(i).catch((t=>{this.AB.notify.developer(t,{message:"!!! ABViewRuleActionFormRecordRuleUpdate.process(): update error:",data:e.data}),s(t)}))}))}}},7318:(e,t,i)=>{const s=i(5263);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=((...e)=>AB.Multilingual.label(...e))("Update Record")}get isPreProcess(){return!0}}},8135:(e,t,i)=>{const s=i(5263),a=i(6589),n=i(679);let r=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleUpdateConnected",this.label=r("Update Connected Record"),this.baseObject=null,this.selectedFieldID=null,this.fieldDropList=[],this.objectQB=null,this.qbCondition=null}objectLoad(e){this.queryObjectLoad(e),this.baseObject=e,this.connectedFieldList().forEach((e=>{this.fieldDropList.push({id:e.id,value:e.label})}))}connectedFieldList(){var e=a.defaults().key;return this.baseObject&&this.baseObject.fields?this.baseObject.fields((t=>t.key==e)):[]}connectedObject(){if(this.selectedFieldID){var e=this.selectedField();if(e)return e.datasourceLink}return null}selectedField(){return this.connectedFieldList().filter((e=>e.id==this.selectedFieldID))[0]}valueDisplayComponent(e){return null==this._uiChooser&&(this._uiChooser=this.valueDisplayChooser(e)),this._uiChooser}valueDisplayChooser(e){var t=webix.uid(),i=e=>e+"_"+t,s={component:i("updateConnectedValues"),updateForm:i("updateChooser"),selectConnectedField:i("updateSelect"),updateFieldsForm:i("updateForm")},a={id:s.component,view:"layout",css:"ab-component-form-rule",rows:[{id:s.selectConnectedField,view:"richselect",label:r("Select which connected object to update."),labelWidth:300,value:this.selectedField,options:this.fieldDropList,on:{onChange:(e,t)=>{n.selectAction(e,t)}}}]},n=this._logic={addDisplay:e=>{$$(s.component).addView(e)},removePreviousDisplays:()=>{var e=$$(s.component).getChildViews(),t=[];e.forEach((e=>{t.push(e)})),t.forEach((e=>{e.config.id!=s.selectConnectedField&&$$(s.component).removeView(e)}))},selectAction:(e,t)=>{n.removePreviousDisplays(),this.selectedFieldID=e;var i=this.connectedObject();if(i){if(this.updateObjectLoad(i),this.updateComponent=super.valueDisplayComponent(s.updateFieldsForm),n.showQBIfNeeded(),n.addDisplay(this.updateComponent.ui),this.updateComponent.init(),this.isUpdateValueDisabled){let e=$$(this.updateComponent.ui.id);e&&(e.disable(),e.hide())}}else this.AB.notify.builder(new Error("No connectedObject found."),{fieldID:this.selectedFieldID})},showQBIfNeeded:()=>{var e=this.queryBuilderDisplay();e.component(this.App,this.idBase),n.addDisplay(e.ui),e.init({})},fromSettings:e=>{$$(s.selectConnectedField).setValue(e.selectedFieldID),this.objectQB&&this.objectQB.setValue(this.qbCondition),this.updateComponent&&this.updateComponent.fromSettings(e)},toSettings:()=>{var e={fieldOperations:[]};return this.formRows.forEach((t=>{var i=t.toSettings();i&&e.fieldOperations.push(i)})),e}};return{ui:a,init:e=>{if(e=e||this.valueRules,this.selectedFieldID){var t=$$(s.selectConnectedField);t&&t.setValue(this.selectedFieldID)}},fromSettings:e=>{n.fromSettings(e)},toSettings:()=>n.toSettings(),_logic:n}}queryBuilderDisplay(){if(!this.objectQB){this.objectQB=new n(r("How to choose which object:"));var e=this.connectedObject();e&&this.objectQB.objectLoad(e)}return this.objectQB}process(e){this._formData=e.data;var t=this.connectedObject(),i=t.model(),s=this.selectedField(),a=null,n=i=>{this.baseObject.model().findConnected(s.columnName,e.data).then((e=>{if(e&&0!=e.length){var s=e.map((e=>e.id));a={glue:"and",rules:[{key:t.PK(),rule:"in",value:s}]},Object.keys(this.qbCondition).length>0&&a.rules.push(this.qbCondition),i()}else i()})).catch(i)};return new Promise(((t,s)=>{var r=(t,s)=>{this.processUpdateObject({},t)?i.update(t.id,t).then((()=>{s()})).catch((t=>{this.AB.notify.developer(t,{message:"!!! ABViewRuleActionFormRecordRuleUpdateConnected.process(): update error:",data:e.data}),s(t)})):s()};n((e=>{e?s(e):null===a?t():i.findAll({where:a}).then((e=>{var i=0;e&&e.data&&(e=e.data),e.forEach((a=>{r(a,(a=>{if(a)return s(a);++i>=e.length&&t()}))})),0==e.length&&t()})).catch(s)}))}))}fromSettings(e){e=e||{},this.selectedFieldID=e.selectedFieldID||null,this.qbCondition=e.qbCondition||{},super.fromSettings(e),this._uiChooser&&this._logic.fromSettings(e)}toSettings(){var e=super.toSettings();e.selectedFieldID=this.selectedFieldID;var t=null;return this.objectQB&&(t=this.objectQB.getValue(),Array.isArray(t)&&(t=t[0]),t&&(t.glue=t.glue||"and")),e.qbCondition=t,this._uiChooser&&(e.valueRules=this._logic.toSettings()),e}qbFixAfterShow(){this.objectQB&&this.objectQB.setValue(this.qbCondition)}}},7521:(e,t,i)=>{const s=i(4496);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleClosePopup",this.label=((...e)=>AB.Multilingual.label(...e))("Close the current popup"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){return this._ui={ui:{view:"layout",rows:[]},init:()=>{}},this._ui}process(e){return new Promise(((t,i)=>{let s=e.form;if(!s)return;let a=s.pageParent((e=>"popup"==e.settings.type));if(!a)return;let n=$$(a.id);n&&n.hide(),e.form.changePage(null),t()}))}}},6220:(e,t,i)=>{const s=i(4496);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleConfirmMessage",this.label=((...e)=>AB.Multilingual.label(...e))("Show a confirmation message"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){var t={message:`${e}_message`};this._ui={ui:{id:t.message,view:"textarea",height:130},init:()=>{},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={fromSettings:e=>{e=e||{},$$(t.message).setValue(e.message||"")},toSettings:()=>({message:$$(t.message).getValue()||""})};return this._ui}process(e){return new Promise(((e,t)=>{var i=this.valueRules.message||"";webix.message({text:i,type:"info"}),e()}))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},8873:(e,t,i)=>{const s=i(4496),a=i(6589),n=i(9137);let r=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleEmail",this.label=r("Send a custom email"),this.queryObject=null,this.formRows=[]}valueDisplayComponent(e){var t={form:`${e}_form`,popup:`${e}_popup`,list:`${e}_fieldList`,toEmailsContainer:`${e}_toEmailsContainer`,toEmails:`${e}_toEmails`,message:`${e}_message`};this._ui={ui:{id:t.form,view:"form",width:450,elementsConfig:{labelPosition:"top",labelWidth:100},cols:[{width:330,rows:[{view:"text",name:"fromName",label:r("From Name")},{view:"text",name:"fromEmail",label:r("From Email"),validate:webix.rules.isEmail,on:{onChange:function(e,i){this.getValue()&&!this.validate()?$$(t.form).markInvalid("fromEmail","Email is invalid"):$$(t.form).markInvalid("fromEmail",!1)}}},{id:t.toEmailsContainer,view:"forminput",name:"toEmails",label:r("Send"),css:"ab-rich-text",width:320,body:{width:320,rows:[{height:25},{id:t.toEmails,width:320,view:"layout",rows:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:r("Add a recipient"),width:150,click:()=>{i.toEmailAdd()}}]}},{view:"text",name:"subject",label:r("Subject")},{view:"textarea",id:t.message,name:"message",label:r("Message"),width:320,height:400}]},{rows:[{view:"template",type:"header",template:"Fields"},{id:t.list,view:"list",width:120,css:{"background-color":"#fff !important;"},template:function(e,t){return i.fieldTemplate(e,t)},on:{onItemClick:function(e,t,s){var a=this.getItem(e);i.enterField(a)}}}]}]},init:()=>{this.queryObject&&($$(t.list).parse(this.queryObject.fields((e=>e.fieldUseAsLabel()))),$$(t.list).refresh()),i.refreshUI()},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={fromSettings:e=>{e=e||{},$$(t.form).setValues(e),(e.toEmails||[]).forEach((e=>{i.toEmailAdd({type:e.type,emailType:e.emailType,value:e.value})})),i.refreshUI()},toSettings:()=>{var e=$$(t.form).getValues()||{},i=[];return $$(t.toEmails).getChildViews().forEach((e=>{var t=e.queryView({name:"emailType"}).getValue(),s=e.queryView({name:t}).getValue();i.push({type:"to",emailType:t,value:s})})),{fromName:e.fromName,fromEmail:e.fromEmail,toEmails:i,subject:e.subject,message:e.message}},toEmailTemplate:e=>({width:320,cols:[{view:"richselect",name:"emailType",value:(e=e||{}).emailType||"email",width:150,options:[{id:"email",value:r("A custom email address")},{id:"field",value:r("An email field")},{id:"query",value:r("From query")}],on:{onChange:function(e,t){i.emailTypeChange(e,this)}}},{width:150,name:"emailValue",visibleBatch:e.emailType||"email",cols:[{view:"text",name:"email",batch:"email",value:"email"==e.emailType?e.value:"",validate:webix.rules.isEmail,width:150,on:{onChange:function(e,t){i.toEmailValidate()}}},{view:"richselect",name:"field",batch:"field",value:"field"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:i.emailFieldOptions()}},{view:"richselect",name:"query",batch:"query",value:"query"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:i.queryOptions()}}]},{view:"button",css:"webix_danger",type:"icon",icon:"fa fa-trash-o",width:32,click:function(){var e=this.getParentView();i.toEmailRemove(e)}}]}),toEmailAdd:e=>{var s=$$(t.toEmails).getChildViews().length;$$(t.toEmails).addView(i.toEmailTemplate(e),s),i.refreshUI()},emailTypeChange:(e,i)=>{var s=i.getParentView().queryView({name:"emailValue"});switch(e){case"field":s.showBatch("field");break;case"query":s.showBatch("query");break;default:s.showBatch("email")}$$(t.toEmailsContainer).adjust()},toEmailRemove:e=>{$$(t.toEmails).removeView(e),i.refreshUI()},toEmailValidate:()=>{var e=!0;$$(t.toEmails).getChildViews().forEach((t=>{let i=t.queryView({name:"email"});i.getValue()&&!i.validate()&&(e=!1)})),e?$$(t.form).markInvalid("toEmails",!1):$$(t.form).markInvalid("toEmails","Email is invalid")},fieldTemplate:(e,t)=>`<i class='fa fa-${e.icon} webix_icon_btn' aria-hidden='true'></i> ${e.label}`,emailFieldOptions:()=>{var e=[],t=[],i=(e,i)=>{var s=e.fields((e=>e instanceof n)).map((t=>{var s="",a="";return i?(s=`${i.id}|${t.urlPointer()}`,a=`${e.label}.${t.label} (${i.label})`):(s=`|${t.urlPointer()}`,a=`${e.label}.${t.label}`),{id:s,value:a}}));t=t.concat(s)};return i(this.queryObject),this.queryObject.connectFields().forEach((t=>{e.indexOf(t.id)>-1||(e.push(t.id),i(t.datasourceLink,t))})),t},queryOptions:()=>{var e=[];return this.currentForm.AB.datacollections((e=>{let t=e.datasource;return e.settings.isQuery&&t&&t.fields((e=>"email"==e.key)).length>0})).forEach((t=>{t.datasource&&t.datasource.fields((e=>"email"==e.key)).forEach((i=>{e.push({id:`${t.id}|${i.id}`,value:`${t.label}.${i.label}`})}))})),e},enterField:e=>{var t=webix.UIManager.getFocus(),i="";"text"==t.config.view&&"textarea"==t.config.view||(t.getValue&&(i=t.getValue()),t.setValue&&t.setValue(`${i}${e.label}`),webix.UIManager.setFocus(t))},refreshUI:()=>{$$(t.toEmailsContainer).adjust(),$$(t.message).adjust()}};return this._ui}process(e){if(!webix.rules.isEmail(this.valueRules.fromEmail))return Promise.resolve();var t=[];return Promise.resolve().then((()=>new Promise(((i,s)=>{var n=[];this.valueRules.toEmails.forEach((i=>{n.push(new Promise(((s,n)=>{if("field"==i.emailType){var r=i.value.split("|")[1],o=this.queryObject.application.urlResolve(r);if(o){if(o.object.id==this.queryObject.id){var l=e.data[o.columnName];l&&(t=t.concat(l))}else{let s=i.value.split("|")[0];this.queryObject.fields((e=>e instanceof a&&e.id==s)).forEach((i=>{var s=e.data[i.relationName()]||[];s&&!Array.isArray(s)&&(s=[s]),s.forEach((e=>{var i=e[o.columnName];i&&(t=t.concat(i))}))}))}s()}else s()}else if("query"==i.emailType){var u=i.value;if(!u)return s();var c=u.split("|")[0],d=u.split("|")[1],h=this.currentForm.AB.datacollectionByID(c);if(!h)return s();var p=h.datasource.fieldByID(d);if(!p)return s();h.getData().forEach((e=>{var i=e[p.columnName];i&&t.push(i)})),s()}else t.push(i.value),s()})))})),Promise.all(n).catch(s).then(i)})))).then((()=>new Promise(((i,s)=>{if(!(t=this.AB.uniq(t).filter((e=>e)))||t.length<1)return i();var a=this.valueRules.fromName,n=this.valueRules.subject,r=this.valueRules.message;this.queryObject.fields((e=>e.fieldUseAsLabel())).forEach((t=>{var i=new RegExp(`{${t.label}}`,"g"),s=t.format(e.data);a=a.replace(i,s),n=n.replace(i,s),r=r.replace(i,s)})),this.AB.Network.post({url:"/app_builder/email",params:{fromName:a,fromEmail:this.valueRules.fromEmail,subject:n,message:r,recipients:this.AB.uniq(t)}}).then((()=>{i()})).catch(s)}))))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},4316:(e,t,i)=>{const s=i(4496);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleExistPage",this.label=((...e)=>AB.Multilingual.label(...e))("Redirect to an existing page"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){var t={pagesAndTabs:`${e}_PagesAndTabs`};this._ui={ui:{id:t.pagesAndTabs,view:"richselect",options:[]},init:()=>{i.populateOptions()},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={populateOptions:()=>{var e=[],i=(t,s,a,n)=>{s=s||"";let r="fa fa-file-o";"tab"==a&&(r="fa fa-window-maximize");let o=t.pageParent();e.push({id:t.id,value:s+t.label,type:a,pageId:o?o.id:null,icon:r}),"page"!=a&&"tab"!=a||(t.pages&&t.pages().forEach((function(e){i(e,s+"-","page")})),t.views&&t.views((e=>"tab"==e.key)).forEach((e=>{e.views().forEach((e=>{i(e,s+"-","tab",t.id)}))})))};i(this.currentForm.pageRoot(),"","page"),$$(t.pagesAndTabs).define("options",e),$$(t.pagesAndTabs).refresh()},fromSettings:e=>{e=e||{},$$(t.pagesAndTabs).setValue(e.tabId||e.pageId||"")},toSettings:()=>{var e={},i=$$(t.pagesAndTabs).getValue(),s=$$(t.pagesAndTabs).getPopup().getList().config.data.filter((e=>e.id==i))[0];return s&&(e="tab"==s.type?{pageId:s.pageId,tabId:i}:{pageId:i}),e}};return this._ui}process(e){return new Promise(((t,i)=>{if(this.valueRules.pageId&&(e.form.changePage(this.valueRules.pageId),this.valueRules.tabId)){var s=e.form.application.pages((e=>e.id==this.valueRules.pageId),!0)[0];if(!s)return t();var a=s.views((e=>e.id==this.valueRules.tabId),!0)[0];if(!a)return t();var n=a.parent;if(!n)return t();var r=e=>{if(!e.parent)return!1;var t=e.parent;if(!t.parent)return!1;t.parent.emit("changeTab",t.id),r(t.parent)};r(n);let i=setInterval((function(){$$(a.id)&&$$(a.id).isVisible()?clearInterval(i):n.emit("changeTab",a.id)}),100)}t()}))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},924:(e,t,i)=>{const s=i(4496);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleParentPage",this.label=((...e)=>AB.Multilingual.label(...e))("Redirect to the parent page"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){this._ui={ui:{view:"label",label:this.label},init:()=>{},_logic:t};var t={};return this._ui}process(e){return new Promise(((t,i)=>{var s=e.form.pageParent().pageParent();e.form.changePage(s.id),t()}))}}},4151:(e,t,i)=>{const s=i(4496);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleWebsite",this.label=((...e)=>AB.Multilingual.label(...e))("Redirect to another website URL"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){var t={website:`${e}_website`};this._ui={ui:{id:t.website,view:"text"},init:()=>{},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={fromSettings:e=>{e=e||{},$$(t.website).setValue(e.website||"")},toSettings:()=>({website:$$(t.website).getValue()||""})};return this._ui}process(e){return new Promise(((e,t)=>{this.valueRules.website&&window.open(`http://${this.valueRules.website.replace("http://","")}`,"_blank"),e()}))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},5263:(e,t,i)=>{const s=i(4496);let a=(...e)=>AB.Multilingual.label(...e);var n={filterConditions:{glue:"and",rules:[]}};e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=a("Update Record"),this.updateObject=null,this.formRows=[],this.stashRules={}}valueDisplayComponent(e){return null==this._uiUpdater&&(this._uiUpdater=this.valueDisplayList(e)),this._uiUpdater}valueDisplayList(e){var t=webix.uid(),i={updateForm:("updateForm",`${e}_updateForm_${t}`)},s={removeAddRow:()=>{var e=s.formGet();if(e){var t=e.getChildViews().filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()}))))[0];t&&e.removeView(t)}},addRow:t=>{var i=s.formGet();if(i){var a=i.getChildViews();if(!(null==t&&a.filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()})))).length>0)){var n=this.valueDisplayRow(e);i.addView(n.ui),n.init({onAdd:()=>{s.addRow()},onDelete:e=>{s.delRow(e)},data:t}),this.formRows.push(n)}}},delRow:e=>{this.formRows.forEach(((t,i)=>{t.ui.id==e&&this.formRows.splice(i,0)}));var t=s.formGet();t&&t.removeView($$(e))},formClear:()=>{var e=s.formGet();if(e){var t=e.getChildViews(),i=[];t.forEach((e=>{i.push(e)})),i.forEach((t=>{e.removeView(t)})),this.formRows=[]}},formGet:()=>$$(i.updateForm)||(this.currentForm.AB.notify.developer(new Error("no webix form"),{context:"ABViewRuleActionObjectUpdater:formGet  could not find webix form",id:i.updateForm}),null),setValues:e=>{(e=e||{}).fieldOperations=e.fieldOperations||[],s.formGet()&&(s.formClear(),e.fieldOperations.length>0&&e.fieldOperations.forEach((e=>{s.addRow(e)})),s.removeAddRow(),s.addRow())},fromSettings:e=>{var t=e.valueRules||e;s.setValues(t)},toSettings:()=>{var e={fieldOperations:[]};return this.formRows.forEach((t=>{t.toSettings()&&e.fieldOperations.push(t.toSettings())})),e}};return{ui:{view:"form",id:i.updateForm,elements:[]},init:e=>{e=e||this.valueRules,s.setValues(e)},fromSettings:e=>{s.fromSettings(e)},toSettings:()=>s.toSettings(),_logic:s}}valueDisplayRow(e){var t,i=webix.uid(),s=e=>e+"_"+i,r={row:s("row"),updateForm:s("updateFormRow"),field:s("field"),value:s("value"),selectDc:s("selectDc"),selectBy:s("selectBy"),queryField:s("queryField"),multiview:s("multiview"),buttonAdd:s("add"),buttonDelete:s("delete")},o={callbacks:{onAdd:()=>{},onDelete:()=>{}},buttonsToggle:()=>{$$(r.row).getChildViews()[0].getChildViews()[4].hide(),$$(r.row).getChildViews()[0].getChildViews()[5].show()},getFieldList:e=>{var t=[];if(this.updateObject&&(t=(this.updateObject.fields()||[]).map((e=>({id:e.id,value:e.label}))),e)){var i={};this.formRows.forEach((e=>{var t=$$(e.ui.id);if(t){var s=t.getChildViews()[0].getChildViews()[1];i[s.getValue()]=!0}})),t=t.filter((e=>!i[e.id]))}return t},isValid:()=>{var e=this.currentForm.AB.Validation.validator(),t=$$(r.row).getChildViews()[0].getChildViews()[3],i=t.getParentView().getParentView(),s=this.getUpdateObjectField($$(r.field).getValue());if(s){var n=s.getValue(t,{}),o={};return o[s.columnName]=n,s.isValidData(o,e),(""==n||null==n||Array.isArray(n)&&0==n.length)&&e.addError(s.columnName,a("A value is required")),i.clearValidation(),e.updateForm(i),e.pass()}var l=$$(r.row).getChildViews()[0].getChildViews()[1];return l.define("invalidMessage",a("A value is required")),l.define("invalid",!0),l.refresh(),!1},selectField:i=>{var s=this.getUpdateObjectField(i);if(s){var n,l=s.formComponent().newInstance(s.object.application).component(this.App),u=l.ui;u.id=r.value;var c=this.currentForm.AB.datacollections((e=>e.datasource)),d=[];c.forEach((e=>{d.push({id:e.id,value:e.label})}));var h=[{id:"select-one",value:a("Current selection")},{id:"filter-select-one",value:a("Select first after filter by...")}],p={type:"clean",rows:[{cols:[{id:r.selectDc,view:"combo",options:d,placeholder:a("Choose a data source"),on:{onChange:(e,t)=>{var i=this.currentForm.AB.datacollectionByID(e);if(!i||"query"!=i.sourceType&&s.isConnection)$$(r.queryField).hide();else{var a=[];i.datasource.fields().forEach((e=>{a.push({id:e.id,value:e.label})})),$$(r.queryField).define("options",a),$$(r.queryField).refresh(),$$(r.queryField).show()}}}},{id:r.queryField,view:"combo",hidden:!0,placeholder:a("Choose value from..."),options:[{id:1,value:"figure this out"}]}]},{id:r.selectBy,view:"combo",options:h,placeholder:a("Choose select option"),on:{onChange:(i,s)=>{var a=$$(r.row);if(a.removeView(a.getChildViews()[1]),"select-one"==i)a.addView({},1);else{var n=this.currentForm.datacollection.datasource.fields().map((function(e){return{id:e.id,value:e.label}}));(t=this.AB.filterComplexNew(`${e}_filter`)).init({isRecordRule:!0,fieldOptions:n}),t.on("change",(e=>{o.onFilterChange(e)})),a.addView(t.ui,1);var l=$$(r.selectDc).getValue(),u=this.currentForm.AB.datacollectionByID(l);u&&o.populateFilters(u)}}}}]};if("user"==s.key&&(u.options=u.options||[],u.options.unshift({id:"ab-current-user",value:a("[Current User]")})),s.isConnection){var m=s.datasourceLink;c=c.filter((e=>e.datasource.id==m.id));var f=this.currentForm.AB.datacollections((e=>"query"==e.sourceType&&e.datasource&&e.datasource.canFilterObject(m)));c=c.concat(f),d=[],c.forEach((e=>{d.push({id:e.id,value:e.label})})),h.push({id:"filter-select-all",value:a("Select all after filter by...")}),n=p,l={init:function(){}}}else n={id:r.multiview,view:"multiview",cells:[{batch:"custom",rows:[u,{view:"label",label:`<a>${a("Or exists value")}</a>`,on:{onItemClick:function(){this.getParentView().getParentView().showBatch("exist")}}}]},{batch:"exist",rows:[p,{view:"label",label:`<a>${a("Or custom value")}</a>`,on:{onItemClick:function(){var e=this.getParentView().getParentView();$$(r.selectBy).setValue("select-one"),e.showBatch("custom")}}}]}]};var g=$$(r.row).getChildViews()[0];if(g.removeView(g.getChildViews()[3]),g.addView(n,3),l.init(),!s.isConnection&&s.customDisplay){var b=$$(u.id).$view;setTimeout((()=>{s.customDisplay(s,this.App,b,{editable:!0,isForm:!0})}),50)}g.getChildViews()[4].show(),i&&o.callbacks.onAdd()}},setValue:e=>{$$(r.field).setValue(e.fieldID);var t=this.getUpdateObjectField(e.fieldID);if(t){var i=()=>{$$(r.selectDc).setValue(e.value),e.queryField&&$$(r.queryField).setValue(e.queryField);var t=e.selectBy||"select-one";if($$(r.selectBy).setValue(t),"select-one"!=t){var i=e.value,s=this.currentForm.AB.datacollectionByID(i);s&&e.filterConditions&&o.populateFilters(s,e.filterConditions)}};t.isConnection?i():"exist"==e.valueType?($$(r.multiview).showBatch("exist"),i()):($$(r.multiview).showBatch("custom"),setTimeout((function(){var i={};i[t.columnName]=e.value,t.setValue($$(r.value),i)}),50))}},populateFilters:(e,i)=>{i=i||n.filterConditions,t.fieldsLoad(e.datasource?e.datasource.fields():[]),t.setValue(i)},toSettings:()=>{var e=$$(r.buttonDelete);if(e&&e.isVisible()){var i={};i.fieldID=$$(r.field).getValue();var s=$$(r.value),a=this.getUpdateObjectField(i.fieldID);return a.isConnection||"exist"==$$(r.multiview).config.visibleBatch?(i.value=$$(r.selectDc).getValue(),i.queryField=$$(r.queryField).getValue(),i.op="set",i.type=a.key,i.selectBy=$$(r.selectBy).getValue(),i.valueType="exist",t&&(i.filterConditions=t.getValue())):(i.value=a.getValue(s,{}),i.op="set",i.type=a.key,i.valueType="custom"),i}return null}};return{ui:{id:r.row,view:"layout",rows:[{cols:[{view:"label",width:this.currentForm.AB.Config.labelWidthSmall,label:a("Set")},{view:"combo",name:"field",placeholder:a("Choose a field"),id:r.field,height:32,options:o.getFieldList(!0),on:{onChange:function(e){o.selectField(e)}}},{view:"label",width:this.currentForm.AB.Config.labelWidthSmall,label:a("To")},{},{view:"button",css:"webix_danger",id:r.buttonDelete,icon:"fa fa-trash",type:"icon",width:30,hidden:!0,click:function(){o.callbacks.onDelete(r.row)}}]},{}]},init:e=>{for(var t in o.callbacks)o.callbacks[t]=e[t]||o.callbacks[t];e.data&&o.setValue(e.data)},toSettings:()=>o.toSettings(),_logic:o}}getUpdateObjectField(e){return this.updateObject?this.updateObject.fieldByID(e):null}processUpdateObject(e,t){this._formData=t;var i=!1;return this.valueRules=this.valueRules||{},this.valueRules.fieldOperations=this.valueRules.fieldOperations||[],this.valueRules.fieldOperations.forEach((e=>{var s=this.getUpdateObjectField(e.fieldID);if(s){var a=e.value;if("ab-current-user"==a)a=this.currentForm.AB.Account.username();else if(s.isConnection||"exist"==e.valueType){var n=this.currentForm.AB.datacollectionByID(e.value),r=this.currentForm.AB.cloneDeep(e.filterConditions);r&&r.rules&&r.rules.filter((e=>"same_as_field"==e.rule||"not_same_as_field"==e.rule)).forEach((e=>{var t=this.currentForm.datacollection.datasource.fieldByID(e.value);t.isConnection?e.value=t.format(this._formData):e.value=this._formData[t.columnName],"not_same_as_field"==e.rule?e.rule="not equals":e.rule="equals"}));let p=n.filteredClone(r);switch(e.selectBy){case"select-one":default:switch((a=p.getCursor())&&("exist"==e.valueType?(u=p.datasource.fieldByID(e.queryField))&&(a=a[u.columnName]):a.id&&(a=a.id)),e.op){case"set":if(!a)break;s.isConnection?(t[s.columnName]={},t[s.columnName].id=a[s.datasourceLink.PK()],t[s.columnName][s.datasourceLink.PK()]=a[s.datasourceLink.PK()],s.settings.isCustomFK&&(s.indexField&&(t[s.columnName][s.indexField.columnName]=a[s.indexField.columnName]),s.indexField2&&(t[s.columnName][s.indexField2.columnName]=a[s.indexField2.columnName])),s.datasourceLink.fields((e=>"combined"==e.key||"AutoIndex"==e.key)).forEach((e=>{t[s.columnName][e.columnName]=a[e.columnName]}))):t[s.columnName]=a}break;case"filter-select-all":for(var o=[],l=p.getFirstRecord();l;){switch(p.sourceType){case"object":o.push(l.id);break;case"query":var u,c=l[(u=p.datasource.fieldByID(e.queryField)).columnName];void 0===c&&(c=l[u.relationName()],Array.isArray(c)?c=c.map((e=>e.id?e.id:e)):c.id&&(c=c.id)),o=this.currentForm.AB.uniq(o.concat(c))}l=p.getNextRecord(l)}if("set"===e.op)if("one"==s.linkType()){var d=[];o.forEach((e=>{var i=this.currentForm.AB.cloneDeep(t);i[s.columnName]=e,d.push(i)})),t.newRecords=d}else t[s.columnName]=o;break;case"filter-select-one":if(o=[],a=p.getFirstRecord())if("query"==p.sourceType||"exist"==e.valueType&&e.queryField)u=p.datasource.fieldByID(e.queryField),void 0===(c=a[u.columnName])&&(c=a[u.relationName()],Array.isArray(c)&&(c=c[0]),c.id&&(c=c.id)),a=c;else if("object"==p.sourceType){var h;s.indexField?h=s.indexField.columnName:s.indexField2&&(h=s.indexField2.columnName),h&&a[h]?a=a[h]:a.id&&(a=a.id)}"set"===e.op&&(t[s.columnName]=a)}i=!0}else"set"===e.op&&(t[s.columnName]=a),i=!0}})),i}process(e){return this._formData=e.data,new Promise(((t,i)=>{if(this.processUpdateObject({},e.data)){var s=e.form.datacollection;if(!s)return t();s.model.update(e.data.id,e.data).then(t).catch((t=>{this.currentForm.AB.notify.developer(t,{context:"ABViewRuleActionObjectUpdater:process  update error",id:e.data.id,data:e.data}),i(t)}))}else t()}))}objectLoad(e){super.objectLoad(e),this.updateObjectLoad(e)}updateObjectLoad(e){this.updateObject&&(this.stashRules[this.updateObject.id]=this.valueRules),this.updateObject=e,this._uiUpdater=null,this.valueRules=this.stashRules[this.updateObject.id]||{}}fromSettings(e){if(e=e||{},super.fromSettings(e),e.updateObjectURL){var t=this.currentForm.application.urlResolve(e.updateObjectURL);this.updateObject=t}this._uiUpdater&&this._uiUpdater.fromSettings(e)}toSettings(){var e=super.toSettings();return e.valueRules=this._uiUpdater.toSettings(),e.updateObjectURL=this.updateObject.urlPointer(),e}isReady(){var e=[];return(this.valueRules?.fieldOperations??[]).forEach((t=>{let i=this.getUpdateObjectField(t.fieldID);if(!i)return;if(!i.isConnection&&"exist"!==t.valueType)return;let s=this.currentForm.AB.datacollectionByID(t.value);s?.dataStatus!==s?.dataStatusFlag.initialized&&e.push(new Promise((e=>{s.on("initializedData",(()=>{e()}))})))})),Promise.all(e)}}},2824:e=>{e.exports=function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){if(n)return n(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};t[r][0].call(u.exports,(function(e){return a(t[r][1][e]||e)}),u,u.exports,e,t,i,s)}return i[r].exports}for(var n=void 0,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){"use strict";var s=e("docxtemplater").DocUtils;s.convertPixelsToEmus=function(e){return Math.round(9525*e)},t.exports=s},{docxtemplater:5}],2:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("./docUtils"),n=/[^.]+\.([^.]+)/,r={getPrefix:function(e){return"docx"===e?"word":"ppt"},getFileTypeName:function(e){return"docx"===e?"document":"presentation"},getRelsFileName:function(e){return e.replace(/^.*?([a-zA-Z0-9]+)\.xml$/,"$1")+".xml.rels"},getRelsFilePath:function(e,t){return("pptx"===t?"ppt/slides":"word")+"/_rels/"+r.getRelsFileName(e)}};t.exports=function(){function e(t,i,s,a){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.fileName=i,this.prefix=r.getPrefix(a),this.zip=t,this.xmlDocuments=s,this.fileTypeName=r.getFileTypeName(a),this.mediaPrefix="pptx"===a?"../media":"media";var n=r.getRelsFilePath(i,a);this.relsDoc=s[n]||this.createEmptyRelsDoc(s,n)}return s(e,[{key:"createEmptyRelsDoc",value:function(e,t){var i=this.prefix+"/_rels/"+this.fileTypeName+".xml.rels",s=e[i];if(!s){var n=new Error("Could not copy from empty relsdoc");throw n.properties={mainRels:i,relsFileName:t,files:Object.keys(this.zip.files)},n}for(var r=a.str2xml(a.xml2str(s)),o=r.getElementsByTagName("Relationships")[0],l=o.getElementsByTagName("Relationship"),u=0,c=l.length;u<c;u++)o.removeChild(l[u]);return e[t]=r,r}},{key:"loadImageRels",value:function(){var e=this.relsDoc.getElementsByTagName("Relationship");return Array.prototype.reduce.call(e,(function(e,t){var i=t.getAttribute("Id");return/^rId[0-9]+$/.test(i)?Math.max(e,parseInt(i.substr(3),10)):e}),0)}},{key:"addExtensionRels",value:function(e,t){var i=this.xmlDocuments["[Content_Types].xml"],s=i.getElementsByTagName("Default");if(!Array.prototype.some.call(s,(function(e){return e.getAttribute("Extension")===t}))){var a=i.getElementsByTagName("Types")[0],n=i.createElement("Default");n.namespaceURI=null,n.setAttribute("ContentType",e),n.setAttribute("Extension",t),a.appendChild(n)}}},{key:"addImageRels",value:function(e,t,i){null==i&&(i=0);var s=0===i?e:e+"("+i+")",a=this.prefix+"/media/"+s;if(null!=this.zip.files[a])return this.addImageRels(e,t,i+1);var r={name:a,data:t,options:{binary:!0}};this.zip.file(r.name,r.data,r.options);var o=s.replace(n,"$1");this.addExtensionRels("image/"+o,o);var l=this.relsDoc.getElementsByTagName("Relationships")[0],u=this.relsDoc.createElement("Relationship");u.namespaceURI=null;var c=this.loadImageRels()+1;return u.setAttribute("Id","rId"+c),u.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/image"),u.setAttribute("Target",this.mediaPrefix+"/"+s),l.appendChild(u),c}}]),e}()},{"./docUtils":1}],3:[function(e,t,i){"use strict";t.exports={getImageXml:function(e,t){return('<w:drawing>\n\t\t<wp:inline distT="0" distB="0" distL="0" distR="0">\n\t\t\t<wp:extent cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t<wp:effectExtent l="0" t="0" r="0" b="0"/>\n\t\t\t<wp:docPr id="2" name="Image 2" descr="image"/>\n\t\t\t<wp:cNvGraphicFramePr>\n\t\t\t\t<a:graphicFrameLocks xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" noChangeAspect="1"/>\n\t\t\t</wp:cNvGraphicFramePr>\n\t\t\t<a:graphic xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main">\n\t\t\t\t<a:graphicData uri="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t<pic:pic xmlns:pic="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t<pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:cNvPr id="0" name="Picture 1" descr="image"/>\n\t\t\t\t\t\t\t<pic:cNvPicPr>\n\t\t\t\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t\t\t\t</pic:cNvPicPr>\n\t\t\t\t\t\t</pic:nvPicPr>\n\t\t\t\t\t\t<pic:blipFill>\n\t\t\t\t\t\t\t<a:blip r:embed="rId'+e+'">\n\t\t\t\t\t\t\t\t<a:extLst>\n\t\t\t\t\t\t\t\t\t<a:ext uri="{28A0092B-C50C-407E-A947-70E740481C1C}">\n\t\t\t\t\t\t\t\t\t\t<a14:useLocalDpi xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" val="0"/>\n\t\t\t\t\t\t\t\t\t</a:ext>\n\t\t\t\t\t\t\t\t</a:extLst>\n\t\t\t\t\t\t\t</a:blip>\n\t\t\t\t\t\t\t<a:srcRect/>\n\t\t\t\t\t\t\t<a:stretch>\n\t\t\t\t\t\t\t\t<a:fillRect/>\n\t\t\t\t\t\t\t</a:stretch>\n\t\t\t\t\t\t</pic:blipFill>\n\t\t\t\t\t\t<pic:spPr bwMode="auto">\n\t\t\t\t\t\t\t<a:xfrm>\n\t\t\t\t\t\t\t\t<a:off x="0" y="0"/>\n\t\t\t\t\t\t\t\t<a:ext cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t\t\t\t</a:xfrm>\n\t\t\t\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t\t\t\t<a:avLst/>\n\t\t\t\t\t\t\t</a:prstGeom>\n\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t<a:ln>\n\t\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t</a:ln>\n\t\t\t\t\t\t</pic:spPr>\n\t\t\t\t\t</pic:pic>\n\t\t\t\t</a:graphicData>\n\t\t\t</a:graphic>\n\t\t</wp:inline>\n\t</w:drawing>\n\t\t').replace(/\t|\n/g,"")},getImageXmlCentered:function(e,t){return('<w:p>\n\t\t\t<w:pPr>\n\t\t\t\t<w:jc w:val="center"/>\n\t\t\t</w:pPr>\n\t\t\t<w:r>\n\t\t\t\t<w:rPr/>\n\t\t\t\t<w:drawing>\n\t\t\t\t\t<wp:inline distT="0" distB="0" distL="0" distR="0">\n\t\t\t\t\t<wp:extent cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t\t<wp:docPr id="0" name="Picture" descr=""/>\n\t\t\t\t\t<a:graphic xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main">\n\t\t\t\t\t\t<a:graphicData uri="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t<pic:pic xmlns:pic="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t\t<pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:cNvPr id="0" name="Picture" descr=""/>\n\t\t\t\t\t\t\t<pic:cNvPicPr>\n\t\t\t\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t\t\t\t</pic:cNvPicPr>\n\t\t\t\t\t\t\t</pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:blipFill>\n\t\t\t\t\t\t\t<a:blip r:embed="rId'+e+'"/>\n\t\t\t\t\t\t\t<a:stretch>\n\t\t\t\t\t\t\t\t<a:fillRect/>\n\t\t\t\t\t\t\t</a:stretch>\n\t\t\t\t\t\t\t</pic:blipFill>\n\t\t\t\t\t\t\t<pic:spPr bwMode="auto">\n\t\t\t\t\t\t\t<a:xfrm>\n\t\t\t\t\t\t\t\t<a:off x="0" y="0"/>\n\t\t\t\t\t\t\t\t<a:ext cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t\t\t\t</a:xfrm>\n\t\t\t\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t\t\t\t<a:avLst/>\n\t\t\t\t\t\t\t</a:prstGeom>\n\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t<a:ln w="9525">\n\t\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t\t<a:miter lim="800000"/>\n\t\t\t\t\t\t\t\t<a:headEnd/>\n\t\t\t\t\t\t\t\t<a:tailEnd/>\n\t\t\t\t\t\t\t</a:ln>\n\t\t\t\t\t\t\t</pic:spPr>\n\t\t\t\t\t\t</pic:pic>\n\t\t\t\t\t\t</a:graphicData>\n\t\t\t\t\t</a:graphic>\n\t\t\t\t\t</wp:inline>\n\t\t\t\t</w:drawing>\n\t\t\t</w:r>\n\t\t</w:p>\n\t\t').replace(/\t|\n/g,"")},getPptxImageXml:function(e,t,i){return('<p:pic>\n\t\t\t<p:nvPicPr>\n\t\t\t\t<p:cNvPr id="6" name="Picture 2"/>\n\t\t\t\t<p:cNvPicPr>\n\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t</p:cNvPicPr>\n\t\t\t\t<p:nvPr/>\n\t\t\t</p:nvPicPr>\n\t\t\t<p:blipFill>\n\t\t\t\t<a:blip r:embed="rId'+e+'" cstate="print">\n\t\t\t\t\t<a:extLst>\n\t\t\t\t\t\t<a:ext uri="{28A0092B-C50C-407E-A947-70E740481C1C}">\n\t\t\t\t\t\t\t<a14:useLocalDpi xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" val="0"/>\n\t\t\t\t\t\t</a:ext>\n\t\t\t\t\t</a:extLst>\n\t\t\t\t</a:blip>\n\t\t\t\t<a:srcRect/>\n\t\t\t\t<a:stretch>\n\t\t\t\t\t<a:fillRect/>\n\t\t\t\t</a:stretch>\n\t\t\t</p:blipFill>\n\t\t\t<p:spPr bwMode="auto">\n\t\t\t\t<a:xfrm>\n\t\t\t\t\t<a:off x="'+i.x+'" y="'+i.y+'"/>\n\t\t\t\t\t<a:ext cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t</a:xfrm>\n\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t<a:avLst/>\n\t\t\t\t</a:prstGeom>\n\t\t\t\t<a:noFill/>\n\t\t\t\t<a:ln>\n\t\t\t\t\t<a:noFill/>\n\t\t\t\t</a:ln>\n\t\t\t\t<a:effectLst/>\n\t\t\t\t<a:extLst>\n\t\t\t\t\t<a:ext uri="{909E8E84-426E-40DD-AFC4-6F175D3DCCD1}">\n\t\t\t\t\t\t<a14:hiddenFill xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main">\n\t\t\t\t\t\t\t<a:solidFill>\n\t\t\t\t\t\t\t\t<a:schemeClr val="accent1"/>\n\t\t\t\t\t\t\t</a:solidFill>\n\t\t\t\t\t\t</a14:hiddenFill>\n\t\t\t\t\t</a:ext>\n\t\t\t\t\t<a:ext uri="{91240B29-F687-4F45-9708-019B960494DF}">\n\t\t\t\t\t\t<a14:hiddenLine xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" w="9525">\n\t\t\t\t\t\t\t<a:solidFill>\n\t\t\t\t\t\t\t\t<a:schemeClr val="tx1"/>\n\t\t\t\t\t\t\t</a:solidFill>\n\t\t\t\t\t\t\t<a:miter lim="800000"/>\n\t\t\t\t\t\t\t<a:headEnd/>\n\t\t\t\t\t\t\t<a:tailEnd/>\n\t\t\t\t\t\t</a14:hiddenLine>\n\t\t\t\t\t</a:ext>\n\t\t\t\t\t<a:ext uri="{AF507438-7753-43E0-B8FC-AC1667EBCBE1}">\n\t\t\t\t\t\t<a14:hiddenEffects xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main">\n\t\t\t\t\t\t\t<a:effectLst>\n\t\t\t\t\t\t\t\t<a:outerShdw dist="35921" dir="2700000" algn="ctr" rotWithShape="0">\n\t\t\t\t\t\t\t\t\t<a:schemeClr val="bg2"/>\n\t\t\t\t\t\t\t\t</a:outerShdw>\n\t\t\t\t\t\t\t</a:effectLst>\n\t\t\t\t\t\t</a14:hiddenEffects>\n\t\t\t\t\t</a:ext>\n\t\t\t\t</a:extLst>\n\t\t\t</p:spPr>\n\t\t</p:pic>\n\t\t').replace(/\t|\n/g,"")}}},{}],4:[function(e,t,i){"use strict";var s=e("./memoize"),a=e("xmldom").DOMParser,n=e("xmldom").XMLSerializer,r=e("./errors"),o={};o.defaults={nullGetter:function(e){return e.module?(e.module,""):"undefined"},parser:s((function(e){return s=function(t){return"."===e?t:t[e]},(i="get")in(t={})?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t;var t,i,s})),fileType:"docx",delimiters:{start:"{",end:"}"}},o.mergeObjects=function(){for(var e={},t=void 0,i=void 0,s=0;s<arguments.length;s+=1){t=arguments[s],i=Object.keys(t);for(var a=0;a<i.length;a+=1)e[i[a]]=t[i[a]]}return e},o.xml2str=function(e){return(new n).serializeToString(e)},o.decodeUtf8=function(e){try{if(void 0===e)return;return decodeURIComponent(escape(o.convertSpaces(e)))}catch(i){var t=new Error("End");throw t.properties.data=e,t.properties.explanation="Could not decode string to UTF8",t}},o.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},o.str2xml=function(e,t){return new a({errorHandler:t}).parseFromString(e,"text/xml")},o.charMap={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"};var l=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;o.escapeRegExp=function(e){return e.replace(l,"\\$&")},o.charMapRegexes=Object.keys(o.charMap).map((function(e){var t=o.charMap[e];return{rstart:new RegExp(o.escapeRegExp(t),"g"),rend:new RegExp(o.escapeRegExp(e),"g"),start:t,end:e}})),o.wordToUtf8=function(e){for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rstart,t.end);return e},o.utf8ToWord=function(e){"string"!=typeof e&&(e=e.toString());for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rend,t.start);return e},o.cloneDeep=function(e){return JSON.parse(JSON.stringify(e))},o.concatArrays=function(e){return e.reduce((function(e,t){return Array.prototype.push.apply(e,t),e}),[])};var u=new RegExp(String.fromCharCode(160),"g");function c(e){var t=new r.XTTemplateError("No tag '"+e.element+"' was found at the "+e.position);throw t.properties={id:"no_xml_tag_found_at_"+e.position,explanation:"No tag '"+e.element+"' was found at the "+e.position,parsed:e.parsed,index:e.index,element:e.element},t}o.convertSpaces=function(e){return e.replace(u," ")},o.pregMatchAll=function(e,t){for(var i=[],s=void 0;null!=(s=e.exec(t));)i.push({array:s,offset:s.index});return i},o.sizeOfObject=function(e){return Object.keys(e).length},o.getRight=function(e,t,i){for(var s=i,a=e.length;s<a;s++)if(e[s].value==="</"+t+">")return s;c({position:"right",element:t,parsed:e,index:i})},o.getLeft=function(e,t,i){for(var s=e.slice(0,i),a=s.length-1;a>=0;a--){var n=s[a];if(0===n.value.indexOf("<"+t)&&-1!==[">"," "].indexOf(n.value[t.length+1]))return a}c({position:"left",element:t,parsed:e,index:i})},t.exports=o,o.traits=e("./traits"),o.moduleWrapper=e("./module-wrapper")},{"./errors":6,"./memoize":9,"./module-wrapper":11,"./traits":20,xmldom:23}],5:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=e("./doc-utils"),r=n.moduleWrapper,o=function(){function e(){if(a(this,e),arguments.length>0)throw new Error("The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return s(e,[{key:"attachModule",value:function(e){return this.modules.push(r(e)),this}},{key:"setOptions",value:function(t){var i=this;return this.options=t,Object.keys(n.defaults).forEach((function(e){var t=n.defaults[e];i[e]=null!=i.options[e]?i.options[e]:t})),"docx"!==this.fileType&&"pptx"!==this.fileType||(this.fileTypeConfig=e.FileTypeConfig[this.fileType]),this.fileTypeConfig=this.options.fileTypeConfig||this.fileTypeConfig,this.options.xmlFileNames=[],this}},{key:"loadZip",value:function(e){if(e.loadAsync)throw new Error("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=e,this}},{key:"compileFile",value:function(e){var t=this.createTemplateClass(e);t.parse(),this.compiled[e]=t}},{key:"compile",value:function(){this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip)}},{key:"render",value:function(){var e=this;return this.modules=this.fileTypeConfig.baseModules.map((function(e){return e()})).concat(this.modules),this.options=this.modules.reduce((function(t,i){return i.optionsTransformer(t,e)}),this.options),this.xmlDocuments=this.options.xmlFileNames.reduce((function(t,i){var s=e.zip.files[i].asText();return t[i]=n.str2xml(s),t}),{}),this.modules.forEach((function(t){t.set({zip:e.zip,xmlDocuments:e.xmlDocuments,data:e.data})})),this.compile(),this.modules.forEach((function(t){t.set({compiled:e.compiled})})),this.templatedFiles.forEach((function(t){null!=e.zip.files[t]&&e.compileFile(t)})),this.mapper=this.modules.reduce((function(e,t){return t.getRenderedMap(e)}),{}),Object.keys(this.mapper).forEach((function(t){var i=e.mapper[t],s=i.from,a=e.compiled[s];a.setTags(i.data),a.render(),e.zip.file(t,a.content)})),Object.keys(this.xmlDocuments).forEach((function(t){e.zip.remove(t);var i=n.encodeUtf8(n.xml2str(e.xmlDocuments[t]));return e.zip.file(t,i,{})})),this}},{key:"setData",value:function(e){return this.data=e,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(e){var t=this.zip.files[e].asText();return this.createTemplateClassFromContent(t,e)}},{key:"createTemplateClassFromContent",value:function(t,i){var s=this,a={filePath:i};return Object.keys(n.defaults).forEach((function(e){a[e]=s[e]})),a.fileTypeConfig=this.fileTypeConfig,a.modules=this.modules,new e.XmlTemplater(t,a)}},{key:"getFullText",value:function(e){return this.createTemplateClass(e||this.fileTypeConfig.textPath).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.compile(),this.templatedFiles}}]),e}();o.DocUtils=e("./doc-utils"),o.Errors=e("./errors"),o.XmlTemplater=e("./xml-templater"),o.FileTypeConfig=e("./file-type-config"),o.XmlMatcher=e("./xml-matcher"),t.exports=o},{"./doc-utils":4,"./errors":6,"./file-type-config":7,"./xml-matcher":21,"./xml-templater":22}],6:[function(e,t,i){"use strict";function s(e){this.name="GenericError",this.message=e,this.stack=new Error(e).stack}function a(e){this.name="TemplateError",this.message=e,this.stack=new Error(e).stack}function n(e){this.name="ScopeParserError",this.message=e,this.stack=new Error(e).stack}function r(e){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=e,this.stack=new Error(e).stack}s.prototype=Error.prototype,a.prototype=new s,n.prototype=new s,r.prototype=new s,t.exports={XTError:s,XTTemplateError:a,XTInternalError:r,XTScopeParserError:n}},{}],7:[function(e,t,i){"use strict";var s=e("./modules/loop"),a=e("./modules/space-preserve"),n=e("./modules/rawxml"),r=e("./modules/expand-pair-trait"),o=e("./modules/render"),l={getTemplatedFiles:function(e){return e.file(/ppt\/(slides|slideMasters)\/(slide|slideMaster)\d+\.xml/).map((function(e){return e.name})).concat(["ppt/presentation.xml"])},textPath:"ppt/slides/slide1.xml",tagsXmlTextArray:["a:t","m:t"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[o,r,n,s]},u={getTemplatedFiles:function(e){return e.file(/word\/(header|footer)\d+\.xml/).map((function(e){return e.name})).concat(["word/document.xml"])},textPath:"word/document.xml",tagsXmlTextArray:["w:t","m:t"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r"],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[o,a,r,n,s]};t.exports={docx:u,pptx:l}},{"./modules/expand-pair-trait":12,"./modules/loop":13,"./modules/rawxml":14,"./modules/render":15,"./modules/space-preserve":16}],8:[function(e,t,i){"use strict";var s=e("./errors"),a=e("./doc-utils");function n(e,t){return e[0]<=t.offset&&t.offset<e[1]}function r(e,t){if("tag"===e.type&&"start"===e.position&&e.text){if(t)throw new Error("Malformed xml : Already in text tag");return!0}if("tag"===e.type&&"end"===e.position&&e.text){if(!t)throw new Error("Malformed xml : Already not in text tag");return!1}return t}function o(e,t){return e.offset-t.offset}function l(e){var t=1;"/"===e[1]&&(t=2);var i=e.indexOf(" "),s=-1===i?e.length-1:i;return{tag:e.slice(t,s),position:1===t?"start":"end"}}function u(e){var t=new s.XTTemplateError("Unclosed tag");throw t.properties={xtag:e.xtag.split(" ")[0].substr(1),id:"unclosed_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}function c(e,t){var i=!1,a={offset:0},n=void 0;e.forEach((function(e){n=t.substr(a.offset,e.offset-a.offset),("start"===e.position&&i||"end"===e.position&&!i)&&("start"===e.position?u({xtag:n}):function(e){var t=new s.XTTemplateError("Unopened tag");throw t.properties={xtag:e.xtag.split(" ")[0],id:"unopened_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}({xtag:n})),i=!i,a=e}));var r=t.length;n=t.substr(a.offset,r-a.offset),i&&u({xtag:n})}function d(e,t,i){var s=[],a=-1;do{-1!==(a=e.indexOf(t,a+1))&&s.push({offset:a,position:i})}while(-1!==a);return s}function h(e){var t=this;this.innerContentParts=e,this.full="",this.parseDelimiters=function(e){t.full=t.innerContentParts.join("");var i=0;t.ranges=t.innerContentParts.map((function(e){return(i+=e.length)-e.length}));var s=a.concatArrays([d(t.full,e.start,"start"),d(t.full,e.end,"end")]).sort(o);c(s,t.full);var r={start:e.start.length,end:e.end.length},l=0,u=0;t.parsed=t.ranges.map((function(e,t){for(var i=[e,e+this.innerContentParts[t].length],a=this.innerContentParts[t],o=[];u<s.length&&n(i,s[u]);)o.push(s[u]),u++;var c=[],d=0;l>0&&(d=l,l=0),o.forEach((function(t){var i=a.substr(d,t.offset-e-d);i.length>0&&c.push({type:"content",value:i}),c.push({type:"delimiter",position:t.position}),d=t.offset-e+r[t.position]})),l=d-a.length;var h=a.substr(d);return h.length>0&&c.push({type:"content",value:h}),c}),t)}}t.exports={parse:function(e,t){var i=!1,s=[];e.forEach((function(e){(i=r(e,i))&&"content"===e.type&&s.push(e.value)}));var a=new h(s);a.parseDelimiters(t);var n=[],o=0;return e.forEach((function(e){i=r(e,i),"content"===e.type&&(e.position=i?"insidetag":"outsidetag"),i&&"content"===e.type?(Array.prototype.push.apply(n,a.parsed[o].map((function(e){return"content"===e.type&&(e.position="insidetag"),e}))),o++):n.push(e)})),n},xmlparse:function(e,t){var i=function(e,t,i){for(var s=0,n=e.length,r=a.concatArrays([t.map((function(e){return{tag:e,text:!0}})),i.map((function(e){return{tag:e,text:!1}}))]).reduce((function(e,t){return e[t.tag]=t.text,e}),{}),o=[];s<n&&-1!==(s=e.indexOf("<",s));){var u=s;s=e.indexOf(">",s);var c=e.slice(u,s+1),d=l(c),h=d.tag,p=d.position,m=r[h];null!=m&&o.push({type:"tag",position:p,text:m,offset:u,value:c})}return o}(e,t.text,t.other),s=0,n=i.reduce((function(t,i){var a=e.substr(s,i.offset-s);return a.length>0&&t.push({type:"content",value:a}),s=i.offset+i.value.length,delete i.offset,i.value.length>0&&t.push(i),t}),[]),r=e.substr(s);return r.length>0&&n.push({type:"content",value:r}),n}}},{"./doc-utils":4,"./errors":6}],9:[function(e,t,i){"use strict";t.exports=function(e){var t=JSON.stringify,i={};return function(){var s=t(arguments);return s in i?i[s]:i[s]=e.apply(this,arguments)}}},{}],10:[function(e,t,i){"use strict";function s(e,t){for(var i=-1,s=0,a=e.length;s<a;s++)t[s]>=e[s].length||(-1===i||e[s][t[s]].offset<e[i][t[i]].offset)&&(i=s);if(-1===i)throw new Error("minIndex negative");return i}t.exports=function(e){var t=e.reduce((function(e,t){return e+t.length}),0);e=e.filter((function(e){return e.length>0}));for(var i=new Array(t),a=e.map((function(){return 0})),n=0;n<=t-1;){var r=s(e,a);i[n]=e[r][a[r]],a[r]++,n++}return i}},{}],11:[function(e,t,i){"use strict";function s(){}function a(e){return e}t.exports=function(e){var t={set:s,parse:s,render:s,getTraits:s,optionsTransformer:a,getRenderedMap:a,postparse:a};if(Object.keys(t).every((function(t){return!e[t]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(t).forEach((function(i){e[i]=e[i]||t[i]})),e}},{}],12:[function(e,t,i){"use strict";var s=e("../mergesort"),a=e("../doc-utils"),n=e("../module-wrapper"),r=e("../traits").getExpandToDefault,o=e("../errors");function l(e){var t=e.tags,i=new o.XTTemplateError("Closing tag does not match opening tag");throw i.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+t[0].value+'" is closed by the tag "'+t[1].value+'"',openingtag:t[0].value,closingtag:t[1].value},i}function u(e){switch(e.location){case"start":return 1;case"end":return-1;default:throw new Error("Location should be one of 'start' or 'end' (given : "+e.location+")")}}function c(e){if(0===e.length)return[];for(var t=1,i=e[0],s=1;s<e.length;s++){var a=e[s];if(0===(t+=u(a.part))){a.part.value!==i.part.value&&""!==a.part.value&&l({tags:[i.part,a.part]});var n=c(e.slice(s+1));return[[i,a]].concat(n)}}var r=i.part;!function(e){var t=e.location,i="start"===t?"unclosed":"unopened",s="start"===t?"Unclosed":"Unopened",a=new o.XTTemplateError(s+" loop"),n=e.part.value;throw a.properties={id:i+"_loop",explanation:"The loop with tag "+n+" is "+i,xtag:n},a}({part:r,location:r.location})}var d={name:"ExpandPairTrait",postparse:function(e,t){var i=t.getTraits,n=t.postparse,o=i("expandPair",e);o=o.map((function(e){return e||[]}));var l=c(o=s(o)),u=l.map((function(t){var i=t[0].part.expandTo;return"auto"===i&&(i=r(e.slice(t[0].offset,t[1].offset))),i?[a.getLeft(e,i,t[0].offset),a.getRight(e,i,t[1].offset)]:[t[0].offset,t[1].offset]})),d=0,h=void 0;return e.reduce((function(t,i,s){var a=d<l.length&&u[d][0]<=s,r=l[d],o=u[d];if(!a)return t.push(i),t;if(o[0]===s&&(h=[]),r[0].offset!==s&&r[1].offset!==s&&h.push(i),o[1]===s){var c=e[r[0].offset];delete c.location,delete c.expandTo,c.subparsed=n(h),t.push(c),d++}return t}),[])}};t.exports=function(){return n(d)}},{"../doc-utils":4,"../errors":6,"../mergesort":10,"../module-wrapper":11,"../traits":20}],13:[function(e,t,i){"use strict";var s=e("../doc-utils"),a=/^-([^\s]+)\s(.+)$/,n=e("../module-wrapper"),r="loop",o={name:"LoopModule",parse:function(e){var t=r,i="placeholder";return"#"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!1}:"^"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!0}:"/"===e[0]?{type:i,value:e.substr(1),module:t,location:"end"}:"-"===e[0]?{type:i,value:e.replace(a,"$2"),expandTo:e.replace(a,"$1"),module:t,location:"start",inverted:!1}:null},getTraits:function(e,t){if("expandPair"===e)return t.reduce((function(e,t,i){return"placeholder"===t.type&&t.module===r&&e.push({part:t,offset:i}),e}),[])},render:function(e,t){if("placeholder"===!e.type||e.module!==r)return null;var i=[];return t.scopeManager.loopOver(e.value,(function(a){var n=t.scopeManager.createSubScopeManager(a,e.value);i.push(t.render(s.mergeObjects({},t,{compiled:e.subparsed,tags:{},scopeManager:n})))}),e.inverted),{value:i.join("")}}};t.exports=function(){return n(o)}},{"../doc-utils":4,"../module-wrapper":11}],14:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("../doc-utils"),n=e("../errors"),r="rawxml",o=e("../module-wrapper");function l(e){var t=e.part,i=e.left,s=e.right,a=e.postparsed,r=e.index,o=a.slice(i+1,s);return o.forEach((function(e,s){s!==r-i-1&&("placeholder"===e.type||"content"===e.type&&"insidetag"===e.position)&&function(e){var t=new n.XTTemplateError("Raw tag should be the only text in paragraph"),i=e.part.value;throw t.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:"The tag "+i,xtag:e.part.value,paragraphParts:e.paragraphParts},t}({paragraphParts:o,part:t})})),t}var u=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="RawXmlModule"}return s(e,[{key:"optionsTransformer",value:function(e,t){return this.fileTypeConfig=t.fileTypeConfig,e}},{key:"parse",value:function(e){return"@"!==e[0]?null:{type:"placeholder",value:e.substr(1),module:r}}},{key:"postparse",value:function(e){return a.traits.expandToOne(e,{moduleName:r,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(e,t){if(e.module!==r)return null;var i=t.scopeManager.getValue(e.value);return null==i&&(i=t.nullGetter(e)),{value:i}}}]),e}();t.exports=function(){return o(new u)}},{"../doc-utils":4,"../errors":6,"../module-wrapper":11}],15:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("../module-wrapper"),n=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="Render"}return s(e,[{key:"set",value:function(e){e.compiled&&(this.compiled=e.compiled),null!=e.data&&(this.data=e.data)}},{key:"getRenderedMap",value:function(e){var t=this;return Object.keys(this.compiled).reduce((function(e,i){return e[i]={from:i,data:t.data},e}),e)}}]),e}();t.exports=function(){return a(new n)}},{"../module-wrapper":11}],16:[function(e,t,i){"use strict";var s=e("../module-wrapper"),a={name:"SpacePreserveModule",postparse:function(e){var t=[],i=!1,s=e.reduce((function(e,s){return"tag"===s.type&&"start"===s.position&&s.text&&"<w:t>"===s.value&&(i=!0),i?("placeholder"!==s.type||s.module||(t[0].value='<w:t xml:space="preserve">'),t.push(s)):e.push(s),"tag"===s.type&&"end"===s.position&&s.text&&"</w:t>"===s.value&&(Array.prototype.push.apply(e,t),i=!1,t=[]),e}),[]);return Array.prototype.push.apply(s,t),s}};t.exports=function(){return s(a)}},{"../module-wrapper":11}],17:[function(e,t,i){"use strict";var s=e("./doc-utils"),a={postparse:function(e,t){function i(e,i){return t.map((function(t){return t.getTraits(e,i)}))}return function e(s){return t.reduce((function(t,s){return s.postparse(t,{postparse:e,getTraits:i})}),s)}(e)},parse:function(e,t){var i=!1,a=void 0,n=[];return e.reduce((function(e,r){return"delimiter"===r.type?(i="start"===r.position,"end"===r.position?(function(e,i){for(var s=void 0,a=0,n=t.length;a<n;a++)if(s=t[a].parse(e))return i.push(s),s;return null}(a=s.wordToUtf8(a),e)||e.push({type:"placeholder",value:a}),Array.prototype.push.apply(e,n),n=[],e):(a="",e)):i?("content"===r.type&&"insidetag"===r.position?a+=r.value:n.push(r),e):(e.push(r),e)}),[])}};t.exports=a},{"./doc-utils":4}],18:[function(e,t,i){"use strict";var s=e("./scope-manager"),a=e("./doc-utils");t.exports=function e(t){return t.render=e,t.modules=t.modules,t.scopeManager||(t.scopeManager=s.createBaseScopeManager(t)),t.compiled.map((function(e){var i=function(e,t){for(var i=void 0,s=0,a=t.modules.length;s<a;s++)if(i=t.modules[s].render(e,t))return i;return!1}(e,t);if(i)return i.value;if("placeholder"===e.type){var s=t.scopeManager.getValue(e.value);return null==s&&(s=t.nullGetter(e)),a.utf8ToWord(s)}if("content"===e.type||"tag"===e.type)return e.value;throw new Error('Unimplemented tag type "'+e.type+'"')})).join("")}},{"./doc-utils":4,"./scope-manager":19}],19:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("./errors"),n=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.scopePath=t.scopePath,this.scopeList=t.scopeList,this.parser=t.parser}return s(e,[{key:"loopOver",value:function(e,t,i){return i=i||!1,this.loopOverValue(this.getValue(e),t,i)}},{key:"functorIfInverted",value:function(e,t,i){e&&t(i)}},{key:"isValueFalsy",value:function(e,t){return null==e||!e||"[object Array]"===t&&0===e.length}},{key:"loopOverValue",value:function(e,t,i){var s=Object.prototype.toString.call(e),a=this.scopeList[this.num];if(this.isValueFalsy(e,s))return this.functorIfInverted(i,t,a);if("[object Array]"!==s)return"[object Object]"===s?this.functorIfInverted(!i,t,e):!0===e?this.functorIfInverted(!i,t,a):void 0;for(var n,r=0;r<e.length;r++)n=e[r],this.functorIfInverted(!i,t,n)}},{key:"getValue",value:function(e,t){this.num=null==t?this.scopeList.length-1:t;var i=void 0,s=void 0,n=void 0,r=this.scopeList[this.num];try{s=this.parser(e)}catch(t){throw(i=new a.XTScopeParserError("Scope parser compilation failed")).properties={id:"scopeparser_compilation_failed",tag:e,explanation:"The scope parser for the tag "+e+" failed to compile",rootError:t},i}try{n=s.get(r,{num:this.num,scopeList:this.scopeList})}catch(t){throw(i=new a.XTScopeParserError("Scope parser execution failed")).properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+e+" failed to execute",scope:r,tag:e,rootError:t},i}return null==n&&this.num>0?this.getValue(e,this.num-1):n}},{key:"createSubScopeManager",value:function(t,i){var s={scopePath:this.scopePath.slice(0),scopeList:this.scopeList.slice(0)};return s.parser=this.parser,s.scopeList=this.scopeList.concat(t),s.scopePath=this.scopePath.concat(i),new e(s)}}]),e}();n.createBaseScopeManager=function(e){var t=e.parser,i=e.tags,s={parser:t,tags:i,scopePath:[]};return s.scopeList=[i],new n(s)},t.exports=n},{"./errors":6}],20:[function(e,t,i){"use strict";var s=e("./doc-utils"),a=e("./errors");function n(e,t){if(0===e.length)return!1;var i=e[e.length-1].tag.substr(1),s=t.substr(2,t.length-3);return 0===i.indexOf(s)}function r(e,t){return e.push({tag:t}),e}function o(e,t,i){var n=e.expandTo||i.expandTo,r=t.indexOf(e);if(!n)return t;var o=void 0,l=void 0;try{o=s.getRight(t,n,r),l=s.getLeft(t,n,r)}catch(t){!function(e){var t=new a.XTTemplateError("Raw tag not in paragraph"),i=e.part.value;throw t.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+i+'"',rootError:e.rootError,xtag:i},t}({part:e,rootError:t})}var u=t.slice(l,r),c=t.slice(r+1,o+1),d=i.getInner({index:r,part:e,leftParts:u,rightParts:c,left:l,right:o,postparsed:t});return"[object Array]"===Object.prototype.toString.call(d)&&(d=s.concatArrays(d)),s.concatArrays([t.slice(0,l),[d],t.slice(o+1)])}t.exports={expandToOne:function(e,t){return e.reduce((function(e,i){return"placeholder"===i.type&&i.module===t.moduleName&&e.push(i),e}),[]).forEach((function(i){e=o(i,e,t)})),e},getExpandToDefault:function(e){for(var t=function(e){for(var t,i=e.filter((function(e){return"tag"===e.type})).map((function(e){return e.value})),s=[],a=0;a<i.length;a++)"/"===(t=i[a])[1]?n(s,t)?s.pop():s=r(s,t):"/"!==t[t.length-1]&&(s=r(s,t));return s}(e),i=0;i<t.length;i++)if(0===t[i].tag.indexOf("<w:tc"))return"w:tr";return!1}}},{"./doc-utils":4,"./errors":6}],21:[function(e,t,i){"use strict";var s=e("./doc-utils");var a=e("./memoize")((function(e,t){var i={};i.content=e,i.tagsXmlArray=t,i.tagsXmlArrayJoined=i.tagsXmlArray.join("|");var a=new RegExp("(<(?:"+i.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+i.tagsXmlArrayJoined+")>","g");return i.matches=s.pregMatchAll(a,i.content),i.charactersAddedCumulative=i.matches.map((function(){return 0})),i.charactersAdded=i.matches.map((function(){return 0})),function(e){function t(){var t={array:Array.prototype.slice.call(arguments)};t.array.shift();var i=t.array[0]+t.array[1];t.array.unshift(i),t.array.pop();var s=t.array.pop();return t.offset=s,t.first=!0,e.matches.unshift(t),e.charactersAdded.unshift(0),e.charactersAddedCumulative.unshift(0)}-1===e.content.indexOf("<")&&-1===e.content.indexOf(">")&&e.content.replace(/^()([^<>]*)$/,t);var i=new RegExp("^()([^<]+)</(?:"+e.tagsXmlArrayJoined+")>");return e.content.replace(i,t),i=new RegExp("(<(?:"+e.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),e.content.replace(i,(function(){var t={array:Array.prototype.slice.call(arguments)};t.array.pop();var i=t.array.pop();return t.offset=i,t.last=!0,e.matches.push(t),e.charactersAdded.push(0),e.charactersAddedCumulative.push(0)})),e}(i)}));t.exports=function(e,t){return s.cloneDeep(a(e,t))}},{"./doc-utils":4,"./memoize":9}],22:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("./doc-utils"),n=e("./scope-manager"),r=e("./xml-matcher"),o=e("./errors"),l=e("./lexer"),u=e("./parser.js"),c=e("./render.js");t.exports=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.fromJson(i),this.setModules({inspect:{filePath:this.filePath}}),this.load(t)}return s(e,[{key:"load",value:function(e){if("string"!=typeof e){var t=new o.XTInternalError("Content must be a string");throw t.properties.id="xmltemplater_content_must_be_string",t}this.content=e}},{key:"setTags",value:function(e){return this.tags=null!=e?e:{},this.scopeManager=n.createBaseScopeManager({tags:this.tags,parser:this.parser}),this}},{key:"fromJson",value:function(e){this.filePath=e.filePath,this.modules=e.modules,this.fileTypeConfig=e.fileTypeConfig,Object.keys(a.defaults).map((function(t){this[t]=null!=e[t]?e[t]:a.defaults[t]}),this)}},{key:"getFullText",value:function(){return e=this.content,t=this.fileTypeConfig.tagsXmlTextArray,i=r(e,t).matches.map((function(e){return e.array[2]})),a.wordToUtf8(a.convertSpaces(i.join("")));var e,t,i}},{key:"setModules",value:function(e){this.modules.forEach((function(t){t.set(e)}))}},{key:"parse",value:function(){return this.xmllexed=l.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}}),this.lexed=l.parse(this.xmllexed,this.delimiters),this.setModules({inspect:{lexed:this.lexed}}),this.parsed=u.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}}),this.postparsed=u.postparse(this.parsed,this.modules),this}},{key:"render",value:function(){return this.setModules({inspect:{postparsed:this.postparsed}}),this.content=c({compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath}),this.setModules({inspect:{content:this.content}}),this}}]),e}()},{"./doc-utils":4,"./errors":6,"./lexer":8,"./parser.js":17,"./render.js":18,"./scope-manager":19,"./xml-matcher":21}],23:[function(e,t,i){function s(e){this.options=e||{locator:{}}}function a(){this.cdata=!1}function n(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function r(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function o(e,t,i){return"string"==typeof e?e.substr(t,i):e.length>=t+i||t?new java.lang.String(e,t,i)+"":e}function l(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var i=this.options,s=new u,n=i.domBuilder||new a,o=i.errorHandler,l=i.locator,c=i.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&n.setDocumentLocator(l),s.errorHandler=function(e,t,i){if(!e){if(t instanceof a)return t;e=t}var s={},n=e instanceof Function;function o(t){var a=e[t];!a&&n&&(a=2==e.length?function(i){e(t,i)}:e),s[t]=a&&function(e){a("[xmldom "+t+"]\t"+e+r(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),s}(o,n,l),s.domBuilder=i.domBuilder||n,/\/x?html?$/.test(t)&&(d.nbsp=" ",d.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?s.parse(e,c,d):s.errorHandler.error("invalid doc source"),n.doc},a.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,i,s){var a=this.doc,r=a.createElementNS(e,i||t),o=s.length;l(this,r),this.currentElement=r,this.locator&&n(this.locator,r);for(var u=0;u<o;u++){e=s.getURI(u);var c=s.getValue(u),d=(i=s.getQName(u),a.createAttributeNS(e,i));this.locator&&n(s.getLocator(u),d),d.value=d.nodeValue=c,r.setAttributeNode(d)}},endElement:function(e,t,i){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&n(this.locator,i),l(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){if(e=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&n(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,i){e=o.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&n(this.locator,s),l(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var a=s.createDocumentType(e,t,i);this.locator&&n(this.locator,a),l(this,a)}},warning:function(e){console.warn("[xmldom warning]\t"+e,r(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,r(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,r(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){a.prototype[e]=function(){return null}}));var u=e("./sax").XMLReader,c=i.DOMImplementation=e("./dom").DOMImplementation;i.XMLSerializer=e("./dom").XMLSerializer,i.DOMParser=s},{"./dom":24,"./sax":25}],24:[function(e,t,i){function s(e,t){for(var i in e)t[i]=e[i]}function a(e,t){var i=e.prototype;if(Object.create){var a=Object.create(t.prototype);i.__proto__=a}if(!(i instanceof t)){function n(){}n.prototype=t.prototype,s(i,n=new n),e.prototype=i=n}i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}var n={},r=n.ELEMENT_NODE=1,o=n.ATTRIBUTE_NODE=2,l=n.TEXT_NODE=3,u=n.CDATA_SECTION_NODE=4,c=n.ENTITY_REFERENCE_NODE=5,d=n.ENTITY_NODE=6,h=n.PROCESSING_INSTRUCTION_NODE=7,p=n.COMMENT_NODE=8,m=n.DOCUMENT_NODE=9,f=n.DOCUMENT_TYPE_NODE=10,g=n.DOCUMENT_FRAGMENT_NODE=11,b=n.NOTATION_NODE=12,v={},w={},y=(v.INDEX_SIZE_ERR=(w[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3)),_=(v.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7),v.NOT_FOUND_ERR=(w[8]="Not found",8)),x=(v.NOT_SUPPORTED_ERR=(w[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10));function $(e,t){if(t instanceof Error)var i=t;else i=this,Error.call(this,w[e]),this.message=w[e],Error.captureStackTrace&&Error.captureStackTrace(this,$);return i.code=e,t&&(this.message=this.message+": "+t),i}function k(){}function C(e,t){this._node=e,this._refresh=t,A(this)}function A(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var i=e._refresh(e._node);ae(e,"length",i.length),s(i,e),e._inc=t}}function D(){}function E(e,t){for(var i=e.length;i--;)if(e[i]===t)return i}function I(e,t,i,s){if(s?t[E(t,s)]=i:t[t.length++]=i,e){i.ownerElement=e;var a=e.ownerDocument;a&&(s&&P(a,e,s),function(e,t,i){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(t._nsMap[i.prefix?i.localName:""]=i.value)}(a,e,i))}}function S(e,t,i){var s=E(t,i);if(!(s>=0))throw $(_,new Error(e.tagName+"@"+i));for(var a=t.length-1;s<a;)t[s]=t[++s];if(t.length=a,e){var n=e.ownerDocument;n&&(P(n,e,i),i.ownerElement=null)}}function V(e){if(this._features={},e)for(var t in e)this._features=e[t]}function F(){}function B(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function j(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(j(e,t))return!0}while(e=e.nextSibling)}function N(){}function P(e,t,i,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete t._nsMap[i.prefix?i.localName:""]}function T(e,t,i){if(e&&e._inc){e._inc++;var s=t.childNodes;if(i)s[s.length++]=i;else{for(var a=t.firstChild,n=0;a;)s[n++]=a,a=a.nextSibling;s.length=n}}}function L(e,t){var i=t.previousSibling,s=t.nextSibling;return i?i.nextSibling=s:e.firstChild=s,s?s.previousSibling=i:e.lastChild=i,T(e.ownerDocument,e),t}function O(e,t,i){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===g){var a=t.firstChild;if(null==a)return t;var n=t.lastChild}else a=n=t;var r=i?i.previousSibling:e.lastChild;a.previousSibling=r,n.nextSibling=i,r?r.nextSibling=a:e.firstChild=a,null==i?e.lastChild=n:i.previousSibling=n;do{a.parentNode=e}while(a!==n&&(a=a.nextSibling));return T(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function R(){this._nsMap={}}function q(){}function M(){}function U(){}function W(){}function z(){}function H(){}function G(){}function J(){}function K(){}function Q(){}function Y(){}function X(){}function Z(e,t){var i=[],s=9==this.nodeType?this.documentElement:this,a=s.prefix,n=s.namespaceURI;if(n&&null==a&&null==(a=s.lookupPrefix(n)))var r=[{namespace:n,prefix:null}];return te(this,i,e,t,r),i.join("")}function ee(e,t,i){var s=e.prefix||"",a=e.namespaceURI;if(!s&&!a)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===a||"http://www.w3.org/2000/xmlns/"==a)return!1;for(var n=i.length;n--;){var r=i[n];if(r.prefix==s)return r.namespace!=a}return!0}function te(e,t,i,s,a){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case r:a||(a=[]),a.length;var n=e.attributes,d=n.length,b=e.firstChild,v=e.tagName;i="http://www.w3.org/1999/xhtml"===e.namespaceURI||i,t.push("<",v);for(var w=0;w<d;w++)"xmlns"==(y=n.item(w)).prefix?a.push({prefix:y.localName,namespace:y.value}):"xmlns"==y.nodeName&&a.push({prefix:"",namespace:y.value});for(w=0;w<d;w++){var y;if(ee(y=n.item(w),0,a)){var _=y.prefix||"",x=y.namespaceURI,$=_?" xmlns:"+_:" xmlns";t.push($,'="',x,'"'),a.push({prefix:_,namespace:x})}te(y,t,i,s,a)}if(ee(e,0,a)&&(_=e.prefix||"",x=e.namespaceURI,$=_?" xmlns:"+_:" xmlns",t.push($,'="',x,'"'),a.push({prefix:_,namespace:x})),b||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(t.push(">"),i&&/^script$/i.test(v))for(;b;)b.data?t.push(b.data):te(b,t,i,s,a),b=b.nextSibling;else for(;b;)te(b,t,i,s,a),b=b.nextSibling;t.push("</",v,">")}else t.push("/>");return;case m:case g:for(b=e.firstChild;b;)te(b,t,i,s,a),b=b.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,B),'"');case l:return t.push(e.data.replace(/[<&]/g,B));case u:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case f:var k=e.publicId,C=e.systemId;if(t.push("<!DOCTYPE ",e.name),k)t.push(' PUBLIC "',k),C&&"."!=C&&t.push('" "',C),t.push('">');else if(C&&"."!=C)t.push(' SYSTEM "',C,'">');else{var A=e.internalSubset;A&&t.push(" [",A,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case c:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ie(e,t,i){var s;switch(t.nodeType){case r:(s=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:i=!0}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,i)for(var a=t.firstChild;a;)s.appendChild(ie(e,a,i)),a=a.nextSibling;return s}function se(e,t,i){var s=new t.constructor;for(var a in t){var n=t[a];"object"!=typeof n&&n!=s[a]&&(s[a]=n)}switch(t.childNodes&&(s.childNodes=new k),s.ownerDocument=e,s.nodeType){case r:var l=t.attributes,u=s.attributes=new D,c=l.length;u._ownerElement=s;for(var d=0;d<c;d++)s.setAttributeNode(se(e,l.item(d),!0));break;case o:i=!0}if(i)for(var h=t.firstChild;h;)s.appendChild(se(e,h,i)),h=h.nextSibling;return s}function ae(e,t,i){e[t]=i}v.INVALID_STATE_ERR=(w[11]="Invalid state",11),v.SYNTAX_ERR=(w[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13),v.NAMESPACE_ERR=(w[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(w[15]="Invalid access",15),$.prototype=Error.prototype,s(v,$),k.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var i=[],s=0;s<this.length;s++)te(this[s],i,e,t);return i.join("")}},C.prototype.item=function(e){return A(this),this[e]},a(C,k),D.prototype={length:0,item:k.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var i=this[t];if(i.nodeName==e)return i}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new $(x);var i=this.getNamedItem(e.nodeName);return I(this._ownerElement,this,e,i),i},setNamedItemNS:function(e){var t,i=e.ownerElement;if(i&&i!=this._ownerElement)throw new $(x);return t=this.getNamedItemNS(e.namespaceURI,e.localName),I(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return S(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);return S(this._ownerElement,this,i),i},getNamedItemNS:function(e,t){for(var i=this.length;i--;){var s=this[i];if(s.localName==t&&s.namespaceURI==e)return s}return null}},V.prototype={hasFeature:function(e,t){var i=this._features[e.toLowerCase()];return!(!i||t&&!(t in i))},createDocument:function(e,t,i){var s=new N;if(s.implementation=this,s.childNodes=new k,s.doctype=i,i&&s.appendChild(i),t){var a=s.createElementNS(e,t);s.appendChild(a)}return s},createDocumentType:function(e,t,i){var s=new H;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=i,s}},F.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return O(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return L(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return se(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==l&&e.nodeType==l?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var i=t._nsMap;if(i)for(var s in i)if(i[s]==e)return s;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var i=t._nsMap;if(i&&e in i)return i[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},s(n,F),s(n,F.prototype),N.prototype={nodeName:"#document",nodeType:m,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var i=e.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,t),i=s}return e}return null==this.documentElement&&e.nodeType==r&&(this.documentElement=e),O(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),L(this,e)},importNode:function(e,t){return ie(this,e,t)},getElementById:function(e){var t=null;return j(this.documentElement,(function(i){if(i.nodeType==r&&i.getAttribute("id")==e)return t=i,!0})),t},createElement:function(e){var t=new R;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new k,(t.attributes=new D)._ownerElement=t,t},createDocumentFragment:function(){var e=new Q;return e.ownerDocument=this,e.childNodes=new k,e},createTextNode:function(e){var t=new U;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new W;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new z;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var i=new Y;return i.ownerDocument=this,i.tagName=i.target=e,i.nodeValue=i.data=t,i},createAttribute:function(e){var t=new q;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new K;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var i=new R,s=t.split(":"),a=i.attributes=new D;return i.childNodes=new k,i.ownerDocument=this,i.nodeName=t,i.tagName=t,i.namespaceURI=e,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,a._ownerElement=i,i},createAttributeNS:function(e,t){var i=new q,s=t.split(":");return i.ownerDocument=this,i.nodeName=t,i.name=t,i.namespaceURI=e,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,i}},a(N,F),R.prototype={nodeType:r,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t,this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var i=t.parentNode;if(i){var s=e.lastChild;i.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,T(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new C(this,(function(t){var i=[];return j(t,(function(s){s===t||s.nodeType!=r||"*"!==e&&s.tagName!=e||i.push(s)})),i}))},getElementsByTagNameNS:function(e,t){return new C(this,(function(i){var s=[];return j(i,(function(a){a===i||a.nodeType!==r||"*"!==e&&a.namespaceURI!==e||"*"!==t&&a.localName!=t||s.push(a)})),s}))}},N.prototype.getElementsByTagName=R.prototype.getElementsByTagName,N.prototype.getElementsByTagNameNS=R.prototype.getElementsByTagNameNS,a(R,F),q.prototype.nodeType=o,a(q,F),M.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){i=this.data.substring(0,e)+i+this.data.substring(e+t),this.nodeValue=this.data=i,this.length=i.length}},a(M,F),U.prototype={nodeName:"#text",nodeType:l,splitText:function(e){var t=this.data,i=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},a(U,M),W.prototype={nodeName:"#comment",nodeType:p},a(W,M),z.prototype={nodeName:"#cdata-section",nodeType:u},a(z,M),H.prototype.nodeType=f,a(H,F),G.prototype.nodeType=b,a(G,F),J.prototype.nodeType=d,a(J,F),K.prototype.nodeType=c,a(K,F),Q.prototype.nodeName="#document-fragment",Q.prototype.nodeType=g,a(Q,F),Y.prototype.nodeType=h,a(Y,F),X.prototype.serializeToString=function(e,t,i){return Z.call(e,t,i)},F.prototype.toString=Z;try{if(Object.defineProperty){function ne(e){switch(e.nodeType){case r:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ne(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(C.prototype,"length",{get:function(){return A(this),this.$$length}}),Object.defineProperty(F.prototype,"textContent",{get:function(){return ne(this)},set:function(e){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ae=function(e,t,i){e["$$"+t]=i}}}catch(re){}i.DOMImplementation=V,i.XMLSerializer=X},{}],25:[function(e,t,i){var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,a=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+s.source+a.source+"*(?::"+s.source+a.source+"*)?$");function r(){}function o(e,t,i,s,a){function n(e){var t=e.slice(1,-1);return t in i?i[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),i=56320+(1023&e);return String.fromCharCode(t,i)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(a.error("entity not found:"+e),e)}function r(t){if(t>x){var i=e.substring(x,t).replace(/&#?\w+;/g,n);w&&o(x),s.characters(i,0,t-x),x=t}}function o(t,i){for(;t>=b&&(i=v.exec(e));)p=i.index,b=p+i[0].length,w.lineNumber++;w.columnNumber=t-p+1}for(var p=0,b=0,v=/.*(?:\r\n?|\n)|.*$/g,w=s.locator,y=[{currentNSMap:t}],_={},x=0;;){try{var $=e.indexOf("<",x);if($<0){if(!e.substr(x).match(/^\s*$/)){var k=s.doc,C=k.createTextNode(e.substr(x));k.appendChild(C),s.currentElement=C}return}switch($>x&&r($),e.charAt($+1)){case"/":var A=e.indexOf(">",$+3),D=e.substring($+2,A),E=y.pop();A<0?(D=e.substring($+2).replace(/[\s<].*/,""),a.error("end tag name: "+D+" is not complete:"+E.tagName),A=$+1+D.length):D.match(/\s</)&&(D=D.replace(/[\s<].*/,""),a.error("end tag name: "+D+" maybe not complete"),A=$+1+D.length);var I=E.localNSMap,S=E.tagName==D;if(S||E.tagName&&E.tagName.toLowerCase()==D.toLowerCase()){if(s.endElement(E.uri,E.localName,D),I)for(var V in I)s.endPrefixMapping(V);S||a.fatalError("end tag name: "+D+" is not match the current start tagName:"+E.tagName)}else y.push(E);A++;break;case"?":w&&o($),A=f(e,$,s);break;case"!":w&&o($),A=m(e,$,s,a);break;default:w&&o($);var F=new g,B=y[y.length-1].currentNSMap,j=(A=u(e,$,F,B,n,a),F.length);if(!F.closed&&h(e,A,F.tagName,_)&&(F.closed=!0,i.nbsp||a.warning("unclosed xml attribute")),w&&j){for(var N=l(w,{}),P=0;P<j;P++){var T=F[P];o(T.offset),T.locator=l(w,{})}s.locator=N,c(F,s,B)&&y.push(F),s.locator=w}else c(F,s,B)&&y.push(F);"http://www.w3.org/1999/xhtml"!==F.uri||F.closed?A++:A=d(e,A,F.tagName,n,s)}}catch(e){a.error("element parse error: "+e),A=-1}A>x?x=A:r(Math.max($,x)+1)}}function l(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function u(e,t,i,s,a,n){for(var r,o=++t,l=0;;){var u=e.charAt(o);switch(u){case"=":if(1===l)r=e.slice(t,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(n.warning('attribute value must after "="'),r=e.slice(t,o)),t=o+1,!((o=e.indexOf(u,t))>0))throw new Error("attribute value no end '"+u+"' match");c=e.slice(t,o).replace(/&#?\w+;/g,a),i.add(r,c,t-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');c=e.slice(t,o).replace(/&#?\w+;/g,a),i.add(r,c,t),n.warning('attribute "'+r+'" missed start quot('+u+")!!"),t=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return n.error("unexpected end of input"),0==l&&i.setTagName(e.slice(t,o)),o;case">":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(c=e.slice(t,o)).slice(-1)&&(i.closed=!0,c=c.slice(0,-1));case 2:2===l&&(c=r),4==l?(n.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c.replace(/&#?\w+;/g,a),t)):("http://www.w3.org/1999/xhtml"===s[""]&&c.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),i.add(c,c,t));break;case 3:throw new Error("attribute value missed!!")}return o;case"":u=" ";default:if(u<=" ")switch(l){case 0:i.setTagName(e.slice(t,o)),l=6;break;case 1:r=e.slice(t,o),l=2;break;case 4:var c=e.slice(t,o).replace(/&#?\w+;/g,a);n.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c,t);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&r.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+r+'" missed value!! "'+r+'" instead2!!'),i.add(r,r,t),t=o,l=1;break;case 5:n.warning('attribute space is required"'+r+'"!!');case 6:l=1,t=o;break;case 3:l=4,t=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function c(e,t,i){for(var s=e.tagName,a=null,n=e.length;n--;){var r=e[n],o=r.qName,l=r.value;if((h=o.indexOf(":"))>0)var u=r.prefix=o.slice(0,h),c=o.slice(h+1),d="xmlns"===u&&c;else c=o,u=null,d="xmlns"===o&&"";r.localName=c,!1!==d&&(null==a&&(a={},p(i,i={})),i[d]=a[d]=l,r.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(d,l))}for(n=e.length;n--;)(u=(r=e[n]).prefix)&&("xml"===u&&(r.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(r.uri=i[u||""]));var h;(h=s.indexOf(":"))>0?(u=e.prefix=s.slice(0,h),c=e.localName=s.slice(h+1)):(u=null,c=e.localName=s);var m=e.uri=i[u||""];if(t.startElement(m,c,s,e),!e.closed)return e.currentNSMap=i,e.localNSMap=a,!0;if(t.endElement(m,c,s),a)for(u in a)t.endPrefixMapping(u)}function d(e,t,i,s,a){if(/^(?:script|textarea)$/i.test(i)){var n=e.indexOf("</"+i+">",t),r=e.substring(t+1,n);if(/[&<]/.test(r))return/^script$/i.test(i)?(a.characters(r,0,r.length),n):(r=r.replace(/&#?\w+;/g,s),a.characters(r,0,r.length),n)}return t+1}function h(e,t,i,s){var a=s[i];return null==a&&((a=e.lastIndexOf("</"+i+">"))<t&&(a=e.lastIndexOf("</"+i)),s[i]=a),a<t}function p(e,t){for(var i in e)t[i]=e[i]}function m(e,t,i,s){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(a=e.indexOf("--\x3e",t+4))>t?(i.comment(e,t+4,a-t-4),a+3):(s.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var a=e.indexOf("]]>",t+9);return i.startCDATA(),i.characters(e,t+9,a-t-9),i.endCDATA(),a+3}var n=function(e,t){var i,s=[],a=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(a.lastIndex=t,a.exec(e);i=a.exec(e);)if(s.push(i),i[1])return s}(e,t),r=n.length;if(r>1&&/!doctype/i.test(n[0][0])){var o=n[1][0],l=r>3&&/^public$/i.test(n[2][0])&&n[3][0],u=r>4&&n[4][0],c=n[r-1];return i.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),c.index+c[0].length}return-1}function f(e,t,i){var s=e.indexOf("?>",t);if(s){var a=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return a?(a[0].length,i.processingInstruction(a[1],a[2]),s+2):-1}return-1}function g(e){}function b(e,t){return e.__proto__=t,e}r.prototype={parse:function(e,t,i){var s=this.domBuilder;s.startDocument(),p(t,t={}),o(e,t,i,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(e){if(!n.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,i){if(!n.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},b({},b.prototype)instanceof b||(b=function(e,t){function i(){}for(t in i.prototype=t,i=new i,e)i[t]=e[t];return i}),i.XMLReader=r},{}],"/src/js/index.js":[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("./templates"),n=e("docxtemplater").DocUtils,r=e("xmldom").DOMParser;var o=e("./imgManager"),l="open-xml-templating/docxtemplater-image-module";function u(e){return e.part}function c(e){var t=e.part,i=e.left,s=e.right,a=e.postparsed.slice(i+1,s).reduce((function(e,t){return e+t.value}),""),n=(new r).parseFromString("<xml>"+a+"</xml>"),o=n.getElementsByTagName("a:off"),l=n.getElementsByTagName("a:ext");return t.ext={cx:parseInt(l[0].getAttribute("cx"),10),cy:parseInt(l[0].getAttribute("cy"),10)},t.offset={x:parseInt(o[0].getAttribute("x"),10),y:parseInt(o[0].getAttribute("y"),10)},t}var d=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="ImageModule",this.options=t||{},this.imgManagers={},null==this.options.centered&&(this.options.centered=!1),null==this.options.getImage)throw new Error("You should pass getImage");if(null==this.options.getSize)throw new Error("You should pass getSize");this.imageNumber=1}return s(e,[{key:"optionsTransformer",value:function(e,t){var i=t.zip.file(/\.xml\.rels/).concat(t.zip.file(/\[Content_Types\].xml/)).map((function(e){return e.name}));return this.fileTypeConfig=t.fileTypeConfig,this.fileType=t.fileType,this.zip=t.zip,e.xmlFileNames=e.xmlFileNames.concat(i),e}},{key:"set",value:function(e){e.zip&&(this.zip=e.zip),e.xmlDocuments&&(this.xmlDocuments=e.xmlDocuments)}},{key:"parse",value:function(e){var t=l,i="placeholder";return"%%"===e.substring(0,2)?{type:i,value:e.substr(2),module:t,centered:!0}:"%"===e.substring(0,1)?{type:i,value:e.substr(1),module:t,centered:!1}:null}},{key:"postparse",value:function(e){var t=void 0,i=void 0;return"pptx"===this.fileType?(t="p:sp",i=c):(t=this.options.centered?"w:p":"w:t",i=u),n.traits.expandToOne(e,{moduleName:l,getInner:i,expandTo:t})}},{key:"render",value:function(e,t){this.imgManagers[t.filePath]=this.imgManagers[t.filePath]||new o(this.zip,t.filePath,this.xmlDocuments,this.fileType);var i=this.imgManagers[t.filePath];if("placeholder"===!e.type||e.module!==l)return null;try{var s=t.scopeManager.getValue(e.value);if(!s)throw new Error("tagValue is empty");var a=this.options.getImage(s,e.value),n=i.addImageRels(this.getNextImageName(),a),r=this.options.getSize(a,s,e.value);return this.getRenderedPart(e,n,r)}catch(e){return{value:this.fileTypeConfig.tagTextXml}}}},{key:"getRenderedPart",value:function(e,t,i){if((s=t)!=s)throw new Error("rId is NaN, aborting");var s,a=[n.convertPixelsToEmus(i[0]),n.convertPixelsToEmus(i[1])],r=this.options.centered||e.centered;return{value:"pptx"===this.fileType?this.getRenderedPartPptx(e,t,a,r):this.getRenderedPartDocx(t,a,r)}}},{key:"getRenderedPartPptx",value:function(e,t,i,s){var n={x:e.offset.x,y:e.offset.y},r=e.ext.cx,o=e.ext.cy,l=i[0],u=i[1];return s&&(n.x+=r/2-l/2,n.y+=o/2-u/2),a.getPptxImageXml(t,[l,u],n)}},{key:"getRenderedPartDocx",value:function(e,t,i){return i?a.getImageXmlCentered(e,t):a.getImageXml(e,t)}},{key:"getNextImageName",value:function(){var e="image_generated_"+this.imageNumber+".png";return this.imageNumber++,e}}]),e}();t.exports=d},{"./imgManager":2,"./templates":3,docxtemplater:5,xmldom:23}]},{},[])("/src/js/index.js")},9590:e=>{e.exports=function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){if(n)return n(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};t[r][0].call(u.exports,(function(e){return a(t[r][1][e]||e)}),u,u.exports,e,t,i,s)}return i[r].exports}for(var n=void 0,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){"use strict";var s=e("./memoize"),a=e("xmldom").DOMParser,n=e("xmldom").XMLSerializer,r=e("./errors"),o={};o.defaults={nullGetter:function(e){return e.module?(e.module,""):"undefined"},parser:s((function(e){return s=function(t){return"."===e?t:t[e]},(i="get")in(t={})?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t;var t,i,s})),delimiters:{start:"{",end:"}"}},o.mergeObjects=function(){for(var e={},t=void 0,i=void 0,s=0;s<arguments.length;s+=1){t=arguments[s],i=Object.keys(t);for(var a=0;a<i.length;a+=1)e[i[a]]=t[i[a]]}return e},o.xml2str=function(e){return(new n).serializeToString(e)},o.decodeUtf8=function(e){try{if(void 0===e)return;return decodeURIComponent(escape(o.convertSpaces(e)))}catch(i){var t=new Error("End");throw t.properties.data=e,t.properties.explanation="Could not decode string to UTF8",t}},o.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},o.str2xml=function(e,t){return new a({errorHandler:t}).parseFromString(e,"text/xml")},o.charMap={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"};var l=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;o.escapeRegExp=function(e){return e.replace(l,"\\$&")},o.charMapRegexes=Object.keys(o.charMap).map((function(e){var t=o.charMap[e];return{rstart:new RegExp(o.escapeRegExp(t),"g"),rend:new RegExp(o.escapeRegExp(e),"g"),start:t,end:e}})),o.wordToUtf8=function(e){for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rstart,t.end);return e},o.utf8ToWord=function(e){"string"!=typeof e&&(e=e.toString());for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rend,t.start);return e},o.cloneDeep=function(e){return JSON.parse(JSON.stringify(e))},o.concatArrays=function(e){return e.reduce((function(e,t){return Array.prototype.push.apply(e,t),e}),[])};var u=new RegExp(String.fromCharCode(160),"g");function c(e){var t=new r.XTTemplateError("No tag '"+e.element+"' was found at the "+e.position);throw t.properties={id:"no_xml_tag_found_at_"+e.position,explanation:"No tag '"+e.element+"' was found at the "+e.position,parsed:e.parsed,index:e.index,element:e.element},t}o.convertSpaces=function(e){return e.replace(u," ")},o.pregMatchAll=function(e,t){for(var i=[],s=void 0;null!=(s=e.exec(t));)i.push({array:s,offset:s.index});return i},o.sizeOfObject=function(e){return Object.keys(e).length},o.getRight=function(e,t,i){for(var s=i,a=e.length;s<a;s++)if(e[s].value==="</"+t+">")return s;c({position:"right",element:t,parsed:e,index:i})},o.getLeft=function(e,t,i){for(var s=i;s>=0;s--){var a=e[s];if(0===a.value.indexOf("<"+t)&&-1!==[">"," "].indexOf(a.value[t.length+1]))return s}c({position:"left",element:t,parsed:e,index:i})},t.exports=o},{"./errors":2,"./memoize":5,xmldom:19}],2:[function(e,t,i){"use strict";function s(e){this.name="GenericError",this.message=e,this.stack=new Error(e).stack}function a(e){this.name="TemplateError",this.message=e,this.stack=new Error(e).stack}function n(e){this.name="ScopeParserError",this.message=e,this.stack=new Error(e).stack}function r(e){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=e,this.stack=new Error(e).stack}s.prototype=Error.prototype,a.prototype=new s,n.prototype=new s,r.prototype=new s,t.exports={XTError:s,XTTemplateError:a,XTInternalError:r,XTScopeParserError:n}},{}],3:[function(e,t,i){"use strict";var s=e("./modules/loop"),a=e("./modules/space-preserve"),n=e("./modules/rawxml"),r=e("./modules/expand-pair-trait"),o=e("./modules/render"),l={getTemplatedFiles:function(e){return e.file(/ppt\/(slides|slideMasters)\/(slide|slideMaster)\d+\.xml/).map((function(e){return e.name})).concat(["ppt/presentation.xml"])},textPath:"ppt/slides/slide1.xml",tagsXmlTextArray:["a:t","m:t"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[o,r,n,s]},u={getTemplatedFiles:function(e){return e.file(/word\/(header|footer)\d+\.xml/).map((function(e){return e.name})).concat(["word/document.xml"])},textPath:"word/document.xml",tagsXmlTextArray:["w:t","m:t"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r"],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[o,a,r,n,s]};t.exports={docx:u,pptx:l}},{"./modules/expand-pair-trait":8,"./modules/loop":9,"./modules/rawxml":10,"./modules/render":11,"./modules/space-preserve":12}],4:[function(e,t,i){"use strict";var s=e("./errors"),a=e("./doc-utils");function n(e,t){return e[0]<=t.offset&&t.offset<e[1]}function r(e,t){if("tag"===e.type&&"start"===e.position&&e.text){if(t)throw new Error("Malformed xml : Already in text tag");return!0}if("tag"===e.type&&"end"===e.position&&e.text){if(!t)throw new Error("Malformed xml : Already not in text tag");return!1}return t}function o(e,t){return e.offset-t.offset}function l(e){var t=1;"/"===e[1]&&(t=2);var i=e.indexOf(" "),s=-1===i?e.length-1:i;return{tag:e.slice(t,s),position:1===t?"start":"end"}}function u(e){var t=new s.XTTemplateError("Unclosed tag");throw t.properties={xtag:e.xtag.split(" ")[0].substr(1),id:"unclosed_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}function c(e,t){var i=!1,a={offset:0},n=void 0;e.forEach((function(e){n=t.substr(a.offset,e.offset-a.offset),("start"===e.position&&i||"end"===e.position&&!i)&&("start"===e.position?u({xtag:n}):function(e){var t=new s.XTTemplateError("Unopened tag");throw t.properties={xtag:e.xtag.split(" ")[0],id:"unopened_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}({xtag:n})),i=!i,a=e}));var r=t.length;n=t.substr(a.offset,r-a.offset),i&&u({xtag:n})}function d(e,t,i){var s=[],a=-1;do{-1!==(a=e.indexOf(t,a+1))&&s.push({offset:a,position:i})}while(-1!==a);return s}function h(e){var t=this;this.innerContentParts=e,this.full="",this.parseDelimiters=function(e){t.full=t.innerContentParts.join("");var i=0;t.ranges=t.innerContentParts.map((function(e){return(i+=e.length)-e.length}));var s=a.concatArrays([d(t.full,e.start,"start"),d(t.full,e.end,"end")]).sort(o);c(s,t.full);var r={start:e.start.length,end:e.end.length},l=0,u=0;t.parsed=t.ranges.map((function(e,t){for(var i=[e,e+this.innerContentParts[t].length],a=this.innerContentParts[t],o=[];u<s.length&&n(i,s[u]);)o.push(s[u]),u++;var c=[],d=0;l>0&&(d=l,l=0),o.forEach((function(t){var i=a.substr(d,t.offset-e-d);i.length>0&&c.push({type:"content",value:i}),c.push({type:"delimiter",position:t.position}),d=t.offset-e+r[t.position]})),l=d-a.length;var h=a.substr(d);return h.length>0&&c.push({type:"content",value:h}),c}),t)}}t.exports={parse:function(e,t){var i=!1,s=[];e.forEach((function(e){(i=r(e,i))&&"content"===e.type&&s.push(e.value)}));var a=new h(s);a.parseDelimiters(t);var n=[],o=0;return e.forEach((function(e){i=r(e,i),"content"===e.type&&(e.position=i?"insidetag":"outsidetag"),i&&"content"===e.type?(Array.prototype.push.apply(n,a.parsed[o].map((function(e){return"content"===e.type&&(e.position="insidetag"),e}))),o++):n.push(e)})),n},xmlparse:function(e,t){var i=function(e,t,i){for(var s=0,n=e.length,r=a.concatArrays([t.map((function(e){return{tag:e,text:!0}})),i.map((function(e){return{tag:e,text:!1}}))]).reduce((function(e,t){return e[t.tag]=t.text,e}),{}),o=[];s<n&&-1!==(s=e.indexOf("<",s));){var u=s;s=e.indexOf(">",s);var c=e.slice(u,s+1),d=l(c),h=d.tag,p=d.position,m=r[h];null!=m&&o.push({type:"tag",position:p,text:m,offset:u,value:c})}return o}(e,t.text,t.other),s=0,n=i.reduce((function(t,i){var a=e.substr(s,i.offset-s);return a.length>0&&t.push({type:"content",value:a}),s=i.offset+i.value.length,delete i.offset,i.value.length>0&&t.push(i),t}),[]),r=e.substr(s);return r.length>0&&n.push({type:"content",value:r}),n}}},{"./doc-utils":1,"./errors":2}],5:[function(e,t,i){"use strict";t.exports=function(e){var t=JSON.stringify,i={};return function(){var s=t(arguments);return s in i?i[s]:i[s]=e.apply(this,arguments)}}},{}],6:[function(e,t,i){"use strict";function s(e,t){for(var i=-1,s=0,a=e.length;s<a;s++)t[s]>=e[s].length||(-1===i||e[s][t[s]].offset<e[i][t[i]].offset)&&(i=s);if(-1===i)throw new Error("minIndex negative");return i}t.exports=function(e){var t=e.reduce((function(e,t){return e+t.length}),0);e=e.filter((function(e){return e.length>0}));for(var i=new Array(t),a=e.map((function(){return 0})),n=0;n<=t-1;){var r=s(e,a);i[n]=e[r][a[r]],a[r]++,n++}return i}},{}],7:[function(e,t,i){"use strict";function s(){}function a(e){return e}t.exports=function(e){var t={set:s,parse:s,render:s,getTraits:s,optionsTransformer:a,getRenderedMap:a,postparse:a};if(Object.keys(t).every((function(t){return!e[t]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(t).forEach((function(i){e[i]=e[i]||t[i]})),e}},{}],8:[function(e,t,i){"use strict";var s=e("../mergesort"),a=e("../doc-utils"),n=e("../module-wrapper"),r=e("../traits").getExpandToDefault,o=e("../errors");function l(e){var t=e.tags,i=new o.XTTemplateError("Closing tag does not match opening tag");throw i.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+t[0].value+'" is closed by the tag "'+t[1].value+'"',openingtag:t[0].value,closingtag:t[1].value},i}function u(e){switch(e.location){case"start":return 1;case"end":return-1;default:throw new Error("Location should be one of 'start' or 'end' (given : "+e.location+")")}}function c(e){if(0===e.length)return[];for(var t=1,i=e[0],s=1;s<e.length;s++){var a=e[s];if(0===(t+=u(a.part))){a.part.value!==i.part.value&&""!==a.part.value&&l({tags:[i.part,a.part]});var n=c(e.slice(s+1));return[[i,a]].concat(n)}}var r=i.part;!function(e){var t=e.location,i="start"===t?"unclosed":"unopened",s="start"===t?"Unclosed":"Unopened",a=new o.XTTemplateError(s+" loop"),n=e.part.value;throw a.properties={id:i+"_loop",explanation:"The loop with tag "+n+" is "+i,xtag:n},a}({part:r,location:r.location})}var d={name:"ExpandPairTrait",postparse:function(e,t){var i=t.getTraits,n=t.postparse,o=i("expandPair",e);o=o.map((function(e){return e||[]}));var l=c(o=s(o)),u=l.map((function(t){var i=t[0].part.expandTo;return"auto"===i&&(i=r(e.slice(t[0].offset,t[1].offset))),i?[a.getLeft(e,i,t[0].offset),a.getRight(e,i,t[1].offset)]:[t[0].offset,t[1].offset]})),d=0,h=void 0;return e.reduce((function(t,i,s){var a=d<l.length&&u[d][0]<=s,r=l[d],o=u[d];if(!a)return t.push(i),t;if(o[0]===s&&(h=[]),r[0].offset!==s&&r[1].offset!==s&&h.push(i),o[1]===s){var c=e[r[0].offset];delete c.location,delete c.expandTo,c.subparsed=n(h),t.push(c),d++}return t}),[])}};t.exports=function(){return n(d)}},{"../doc-utils":1,"../errors":2,"../mergesort":6,"../module-wrapper":7,"../traits":16}],9:[function(e,t,i){"use strict";var s=e("../doc-utils"),a=/^-([^\s]+)\s(.+)$/,n=e("../module-wrapper"),r="loop",o={name:"LoopModule",parse:function(e){var t=r,i="placeholder";return"#"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!1}:"^"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!0}:"/"===e[0]?{type:i,value:e.substr(1),module:t,location:"end"}:"-"===e[0]?{type:i,value:e.replace(a,"$2"),expandTo:e.replace(a,"$1"),module:t,location:"start",inverted:!1}:null},getTraits:function(e,t){if("expandPair"===e)return t.reduce((function(e,t,i){return"placeholder"===t.type&&t.module===r&&e.push({part:t,offset:i}),e}),[])},render:function(e,t){if("placeholder"===!e.type||e.module!==r)return null;var i=[];return t.scopeManager.loopOver(e.value,(function(a){var n=t.scopeManager.createSubScopeManager(a,e.value);i.push(t.render(s.mergeObjects({},t,{compiled:e.subparsed,tags:{},scopeManager:n})))}),e.inverted),{value:i.join("")}}};t.exports=function(){return n(o)}},{"../doc-utils":1,"../module-wrapper":7}],10:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("../doc-utils"),n=e("../errors"),r="rawxml",o=e("../module-wrapper");function l(e){var t=e.part,i=e.left,s=e.right,a=e.postparsed,r=e.index,o=a.slice(i+1,s);return o.forEach((function(e,s){s!==r-i-1&&("placeholder"===e.type||"content"===e.type&&"insidetag"===e.position)&&function(e){var t=new n.XTTemplateError("Raw tag should be the only text in paragraph"),i=e.part.value;throw t.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:"The tag "+i,xtag:e.part.value,paragraphParts:e.paragraphParts},t}({paragraphParts:o,part:t})})),t}var u=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="RawXmlModule"}return s(e,[{key:"optionsTransformer",value:function(e,t){return this.fileTypeConfig=t.fileTypeConfig,e}},{key:"parse",value:function(e){return"@"!==e[0]?null:{type:"placeholder",value:e.substr(1),module:r}}},{key:"postparse",value:function(e){return a.traits.expandToOne(e,{moduleName:r,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(e,t){if(e.module!==r)return null;var i=t.scopeManager.getValue(e.value);return null==i&&(i=t.nullGetter(e)),{value:i}}}]),e}();t.exports=function(){return o(new u)}},{"../doc-utils":1,"../errors":2,"../module-wrapper":7}],11:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("../module-wrapper"),n=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="Render"}return s(e,[{key:"set",value:function(e){e.compiled&&(this.compiled=e.compiled),null!=e.data&&(this.data=e.data)}},{key:"getRenderedMap",value:function(e){var t=this;return Object.keys(this.compiled).reduce((function(e,i){return e[i]={from:i,data:t.data},e}),e)}}]),e}();t.exports=function(){return a(new n)}},{"../module-wrapper":7}],12:[function(e,t,i){"use strict";var s=e("../module-wrapper"),a={name:"SpacePreserveModule",postparse:function(e){var t=[],i=!1,s=e.reduce((function(e,s){return"tag"===s.type&&"start"===s.position&&s.text&&"<w:t>"===s.value&&(i=!0),i?("placeholder"!==s.type||s.module||(t[0].value='<w:t xml:space="preserve">'),t.push(s)):e.push(s),"tag"===s.type&&"end"===s.position&&s.text&&"</w:t>"===s.value&&(Array.prototype.push.apply(e,t),i=!1,t=[]),e}),[]);return Array.prototype.push.apply(s,t),s}};t.exports=function(){return s(a)}},{"../module-wrapper":7}],13:[function(e,t,i){"use strict";var s=e("./doc-utils"),a={postparse:function(e,t){function i(e,i){return t.map((function(t){return t.getTraits(e,i)}))}return function e(s){return t.reduce((function(t,s){return s.postparse(t,{postparse:e,getTraits:i})}),s)}(e)},parse:function(e,t){var i=!1,a=void 0,n=[];return e.reduce((function(e,r){return"delimiter"===r.type?(i="start"===r.position,"end"===r.position?(function(e,i){for(var s=void 0,a=0,n=t.length;a<n;a++)if(s=t[a].parse(e))return i.push(s),s;return null}(a=s.wordToUtf8(a),e)||e.push({type:"placeholder",value:a}),Array.prototype.push.apply(e,n),n=[],e):(a="",e)):i?("content"===r.type&&"insidetag"===r.position?a+=r.value:n.push(r),e):(e.push(r),e)}),[])}};t.exports=a},{"./doc-utils":1}],14:[function(e,t,i){"use strict";var s=e("./scope-manager"),a=e("./doc-utils");t.exports=function e(t){return t.render=e,t.modules=t.modules,t.scopeManager||(t.scopeManager=s.createBaseScopeManager(t)),t.compiled.map((function(e){var i=function(e,t){for(var i=void 0,s=0,a=t.modules.length;s<a;s++)if(i=t.modules[s].render(e,t))return i;return!1}(e,t);if(i)return i.value;if("placeholder"===e.type){var s=t.scopeManager.getValue(e.value);return null==s&&(s=t.nullGetter(e)),a.utf8ToWord(s)}if("content"===e.type||"tag"===e.type)return e.value;throw new Error('Unimplemented tag type "'+e.type+'"')})).join("")}},{"./doc-utils":1,"./scope-manager":15}],15:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("./errors"),n=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.scopePath=t.scopePath,this.scopeList=t.scopeList,this.parser=t.parser}return s(e,[{key:"loopOver",value:function(e,t,i){return i=i||!1,this.loopOverValue(this.getValue(e),t,i)}},{key:"functorIfInverted",value:function(e,t,i){e&&t(i)}},{key:"isValueFalsy",value:function(e,t){return null==e||!e||"[object Array]"===t&&0===e.length}},{key:"loopOverValue",value:function(e,t,i){var s=Object.prototype.toString.call(e),a=this.scopeList[this.num];if(this.isValueFalsy(e,s))return this.functorIfInverted(i,t,a);if("[object Array]"!==s)return"[object Object]"===s?this.functorIfInverted(!i,t,e):!0===e?this.functorIfInverted(!i,t,a):void 0;for(var n,r=0;r<e.length;r++)n=e[r],this.functorIfInverted(!i,t,n)}},{key:"getValue",value:function(e,t){this.num=null==t?this.scopeList.length-1:t;var i=void 0,s=void 0,n=void 0,r=this.scopeList[this.num];try{s=this.parser(e)}catch(t){throw(i=new a.XTScopeParserError("Scope parser compilation failed")).properties={id:"scopeparser_compilation_failed",tag:e,explanation:"The scope parser for the tag "+e+" failed to compile",rootError:t},i}try{n=s.get(r,{num:this.num,scopeList:this.scopeList})}catch(t){throw(i=new a.XTScopeParserError("Scope parser execution failed")).properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+e+" failed to execute",scope:r,tag:e,rootError:t},i}return null==n&&this.num>0?this.getValue(e,this.num-1):n}},{key:"createSubScopeManager",value:function(t,i){var s={scopePath:this.scopePath.slice(0),scopeList:this.scopeList.slice(0)};return s.parser=this.parser,s.scopeList=this.scopeList.concat(t),s.scopePath=this.scopePath.concat(i),new e(s)}}]),e}();n.createBaseScopeManager=function(e){var t=e.parser,i=e.tags,s={parser:t,tags:i,scopePath:[]};return s.scopeList=[i],new n(s)},t.exports=n},{"./errors":2}],16:[function(e,t,i){"use strict";var s=e("./doc-utils"),a=e("./errors");function n(e,t){if(0===e.length)return!1;var i=e[e.length-1].tag.substr(1),s=t.substr(2,t.length-3);return 0===i.indexOf(s)}function r(e,t){return e.push({tag:t}),e}function o(e,t,i){var n=e.expandTo||i.expandTo,r=t.indexOf(e);if(!n)return t;var o=void 0,l=void 0;try{o=s.getRight(t,n,r),l=s.getLeft(t,n,r)}catch(i){throw i instanceof a.XTTemplateError&&function(e){var t=new a.XTTemplateError("Raw tag not in paragraph"),i=e.part.value;throw t.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+i+'"',rootError:e.rootError,xtag:i,postparsed:e.postparsed,expandTo:e.expandTo,index:e.index},t}({part:e,rootError:i,postparsed:t,expandTo:n,index:r}),i}var u=t.slice(l,r),c=t.slice(r+1,o+1),d=i.getInner({index:r,part:e,leftParts:u,rightParts:c,left:l,right:o,postparsed:t});return d.length||(d.expanded=[u,c],d=[d]),s.concatArrays([t.slice(0,l),d,t.slice(o+1)])}t.exports={expandToOne:function(e,t){return e.reduce((function(e,i){return"placeholder"===i.type&&i.module===t.moduleName&&e.push(i),e}),[]).forEach((function(i){e=o(i,e,t)})),e},getExpandToDefault:function(e){for(var t=function(e){for(var t,i=e.filter((function(e){return"tag"===e.type})).map((function(e){return e.value})),s=[],a=0;a<i.length;a++)"/"===(t=i[a])[1]?n(s,t)?s.pop():s=r(s,t):"/"!==t[t.length-1]&&(s=r(s,t));return s}(e),i=0;i<t.length;i++){var s=t[i];if(0===s.tag.indexOf("<w:tc"))return"w:tr";if(0===s.tag.indexOf("<a:tc"))return"a:tr"}return!1}}},{"./doc-utils":1,"./errors":2}],17:[function(e,t,i){"use strict";var s=e("./doc-utils");var a=e("./memoize")((function(e,t){var i={};i.content=e,i.tagsXmlArray=t,i.tagsXmlArrayJoined=i.tagsXmlArray.join("|");var a=new RegExp("(<(?:"+i.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+i.tagsXmlArrayJoined+")>","g");return i.matches=s.pregMatchAll(a,i.content),i.charactersAddedCumulative=i.matches.map((function(){return 0})),i.charactersAdded=i.matches.map((function(){return 0})),function(e){function t(){var t={array:Array.prototype.slice.call(arguments)};t.array.shift();var i=t.array[0]+t.array[1];t.array.unshift(i),t.array.pop();var s=t.array.pop();return t.offset=s,t.first=!0,e.matches.unshift(t),e.charactersAdded.unshift(0),e.charactersAddedCumulative.unshift(0)}-1===e.content.indexOf("<")&&-1===e.content.indexOf(">")&&e.content.replace(/^()([^<>]*)$/,t);var i=new RegExp("^()([^<]+)</(?:"+e.tagsXmlArrayJoined+")>");return e.content.replace(i,t),i=new RegExp("(<(?:"+e.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),e.content.replace(i,(function(){var t={array:Array.prototype.slice.call(arguments)};t.array.pop();var i=t.array.pop();return t.offset=i,t.last=!0,e.matches.push(t),e.charactersAdded.push(0),e.charactersAddedCumulative.push(0)})),e}(i)}));t.exports=function(e,t){return s.cloneDeep(a(e,t))}},{"./doc-utils":1,"./memoize":5}],18:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var a=e("./doc-utils"),n=e("./scope-manager"),r=e("./xml-matcher"),o=e("./errors"),l=e("./lexer"),u=e("./parser.js"),c=e("./render.js");t.exports=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.fromJson(i),this.setModules({inspect:{filePath:this.filePath}}),this.load(t)}return s(e,[{key:"load",value:function(e){if("string"!=typeof e){var t=new o.XTInternalError("Content must be a string");throw t.properties.id="xmltemplater_content_must_be_string",t}this.content=e}},{key:"setTags",value:function(e){return this.tags=null!=e?e:{},this.scopeManager=n.createBaseScopeManager({tags:this.tags,parser:this.parser}),this}},{key:"fromJson",value:function(e){this.filePath=e.filePath,this.modules=e.modules,this.fileTypeConfig=e.fileTypeConfig,Object.keys(a.defaults).map((function(t){this[t]=null!=e[t]?e[t]:a.defaults[t]}),this)}},{key:"getFullText",value:function(){return e=this.content,t=this.fileTypeConfig.tagsXmlTextArray,i=r(e,t).matches.map((function(e){return e.array[2]})),a.wordToUtf8(a.convertSpaces(i.join("")));var e,t,i}},{key:"setModules",value:function(e){this.modules.forEach((function(t){t.set(e)}))}},{key:"parse",value:function(){return this.xmllexed=l.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}}),this.lexed=l.parse(this.xmllexed,this.delimiters),this.setModules({inspect:{lexed:this.lexed}}),this.parsed=u.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}}),this.postparsed=u.postparse(this.parsed,this.modules),this}},{key:"render",value:function(e){return this.filePath=e,this.setModules({inspect:{postparsed:this.postparsed}}),this.content=c({compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath}),this.setModules({inspect:{content:this.content}}),this}}]),e}()},{"./doc-utils":1,"./errors":2,"./lexer":4,"./parser.js":13,"./render.js":14,"./scope-manager":15,"./xml-matcher":17}],19:[function(e,t,i){function s(e){this.options=e||{locator:{}}}function a(){this.cdata=!1}function n(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function r(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function o(e,t,i){return"string"==typeof e?e.substr(t,i):e.length>=t+i||t?new java.lang.String(e,t,i)+"":e}function l(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var i=this.options,s=new u,n=i.domBuilder||new a,o=i.errorHandler,l=i.locator,c=i.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&n.setDocumentLocator(l),s.errorHandler=function(e,t,i){if(!e){if(t instanceof a)return t;e=t}var s={},n=e instanceof Function;function o(t){var a=e[t];!a&&n&&(a=2==e.length?function(i){e(t,i)}:e),s[t]=a&&function(e){a("[xmldom "+t+"]\t"+e+r(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),s}(o,n,l),s.domBuilder=i.domBuilder||n,/\/x?html?$/.test(t)&&(d.nbsp=" ",d.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?s.parse(e,c,d):s.errorHandler.error("invalid doc source"),n.doc},a.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,i,s){var a=this.doc,r=a.createElementNS(e,i||t),o=s.length;l(this,r),this.currentElement=r,this.locator&&n(this.locator,r);for(var u=0;u<o;u++){e=s.getURI(u);var c=s.getValue(u),d=(i=s.getQName(u),a.createAttributeNS(e,i));this.locator&&n(s.getLocator(u),d),d.value=d.nodeValue=c,r.setAttributeNode(d)}},endElement:function(e,t,i){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&n(this.locator,i),l(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){if(e=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&n(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,i){e=o.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&n(this.locator,s),l(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var a=s.createDocumentType(e,t,i);this.locator&&n(this.locator,a),l(this,a)}},warning:function(e){console.warn("[xmldom warning]\t"+e,r(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,r(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,r(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){a.prototype[e]=function(){return null}}));var u=e("./sax").XMLReader,c=i.DOMImplementation=e("./dom").DOMImplementation;i.XMLSerializer=e("./dom").XMLSerializer,i.DOMParser=s},{"./dom":20,"./sax":21}],20:[function(e,t,i){function s(e,t){for(var i in e)t[i]=e[i]}function a(e,t){var i=e.prototype;if(Object.create){var a=Object.create(t.prototype);i.__proto__=a}if(!(i instanceof t)){function n(){}n.prototype=t.prototype,s(i,n=new n),e.prototype=i=n}i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}var n={},r=n.ELEMENT_NODE=1,o=n.ATTRIBUTE_NODE=2,l=n.TEXT_NODE=3,u=n.CDATA_SECTION_NODE=4,c=n.ENTITY_REFERENCE_NODE=5,d=n.ENTITY_NODE=6,h=n.PROCESSING_INSTRUCTION_NODE=7,p=n.COMMENT_NODE=8,m=n.DOCUMENT_NODE=9,f=n.DOCUMENT_TYPE_NODE=10,g=n.DOCUMENT_FRAGMENT_NODE=11,b=n.NOTATION_NODE=12,v={},w={},y=(v.INDEX_SIZE_ERR=(w[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3)),_=(v.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7),v.NOT_FOUND_ERR=(w[8]="Not found",8)),x=(v.NOT_SUPPORTED_ERR=(w[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10));function $(e,t){if(t instanceof Error)var i=t;else i=this,Error.call(this,w[e]),this.message=w[e],Error.captureStackTrace&&Error.captureStackTrace(this,$);return i.code=e,t&&(this.message=this.message+": "+t),i}function k(){}function C(e,t){this._node=e,this._refresh=t,A(this)}function A(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var i=e._refresh(e._node);ae(e,"length",i.length),s(i,e),e._inc=t}}function D(){}function E(e,t){for(var i=e.length;i--;)if(e[i]===t)return i}function I(e,t,i,s){if(s?t[E(t,s)]=i:t[t.length++]=i,e){i.ownerElement=e;var a=e.ownerDocument;a&&(s&&P(a,e,s),function(e,t,i){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(t._nsMap[i.prefix?i.localName:""]=i.value)}(a,e,i))}}function S(e,t,i){var s=E(t,i);if(!(s>=0))throw $(_,new Error(e.tagName+"@"+i));for(var a=t.length-1;s<a;)t[s]=t[++s];if(t.length=a,e){var n=e.ownerDocument;n&&(P(n,e,i),i.ownerElement=null)}}function V(e){if(this._features={},e)for(var t in e)this._features=e[t]}function F(){}function B(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function j(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(j(e,t))return!0}while(e=e.nextSibling)}function N(){}function P(e,t,i,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete t._nsMap[i.prefix?i.localName:""]}function T(e,t,i){if(e&&e._inc){e._inc++;var s=t.childNodes;if(i)s[s.length++]=i;else{for(var a=t.firstChild,n=0;a;)s[n++]=a,a=a.nextSibling;s.length=n}}}function L(e,t){var i=t.previousSibling,s=t.nextSibling;return i?i.nextSibling=s:e.firstChild=s,s?s.previousSibling=i:e.lastChild=i,T(e.ownerDocument,e),t}function O(e,t,i){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===g){var a=t.firstChild;if(null==a)return t;var n=t.lastChild}else a=n=t;var r=i?i.previousSibling:e.lastChild;a.previousSibling=r,n.nextSibling=i,r?r.nextSibling=a:e.firstChild=a,null==i?e.lastChild=n:i.previousSibling=n;do{a.parentNode=e}while(a!==n&&(a=a.nextSibling));return T(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function R(){this._nsMap={}}function q(){}function M(){}function U(){}function W(){}function z(){}function H(){}function G(){}function J(){}function K(){}function Q(){}function Y(){}function X(){}function Z(e,t){var i=[],s=9==this.nodeType?this.documentElement:this,a=s.prefix,n=s.namespaceURI;if(n&&null==a&&null==(a=s.lookupPrefix(n)))var r=[{namespace:n,prefix:null}];return te(this,i,e,t,r),i.join("")}function ee(e,t,i){var s=e.prefix||"",a=e.namespaceURI;if(!s&&!a)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===a||"http://www.w3.org/2000/xmlns/"==a)return!1;for(var n=i.length;n--;){var r=i[n];if(r.prefix==s)return r.namespace!=a}return!0}function te(e,t,i,s,a){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case r:a||(a=[]),a.length;var n=e.attributes,d=n.length,b=e.firstChild,v=e.tagName;i="http://www.w3.org/1999/xhtml"===e.namespaceURI||i,t.push("<",v);for(var w=0;w<d;w++)"xmlns"==(y=n.item(w)).prefix?a.push({prefix:y.localName,namespace:y.value}):"xmlns"==y.nodeName&&a.push({prefix:"",namespace:y.value});for(w=0;w<d;w++){var y;if(ee(y=n.item(w),0,a)){var _=y.prefix||"",x=y.namespaceURI,$=_?" xmlns:"+_:" xmlns";t.push($,'="',x,'"'),a.push({prefix:_,namespace:x})}te(y,t,i,s,a)}if(ee(e,0,a)&&(_=e.prefix||"",x=e.namespaceURI,$=_?" xmlns:"+_:" xmlns",t.push($,'="',x,'"'),a.push({prefix:_,namespace:x})),b||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(t.push(">"),i&&/^script$/i.test(v))for(;b;)b.data?t.push(b.data):te(b,t,i,s,a),b=b.nextSibling;else for(;b;)te(b,t,i,s,a),b=b.nextSibling;t.push("</",v,">")}else t.push("/>");return;case m:case g:for(b=e.firstChild;b;)te(b,t,i,s,a),b=b.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,B),'"');case l:return t.push(e.data.replace(/[<&]/g,B));case u:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case f:var k=e.publicId,C=e.systemId;if(t.push("<!DOCTYPE ",e.name),k)t.push(' PUBLIC "',k),C&&"."!=C&&t.push('" "',C),t.push('">');else if(C&&"."!=C)t.push(' SYSTEM "',C,'">');else{var A=e.internalSubset;A&&t.push(" [",A,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case c:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ie(e,t,i){var s;switch(t.nodeType){case r:(s=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:i=!0}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,i)for(var a=t.firstChild;a;)s.appendChild(ie(e,a,i)),a=a.nextSibling;return s}function se(e,t,i){var s=new t.constructor;for(var a in t){var n=t[a];"object"!=typeof n&&n!=s[a]&&(s[a]=n)}switch(t.childNodes&&(s.childNodes=new k),s.ownerDocument=e,s.nodeType){case r:var l=t.attributes,u=s.attributes=new D,c=l.length;u._ownerElement=s;for(var d=0;d<c;d++)s.setAttributeNode(se(e,l.item(d),!0));break;case o:i=!0}if(i)for(var h=t.firstChild;h;)s.appendChild(se(e,h,i)),h=h.nextSibling;return s}function ae(e,t,i){e[t]=i}v.INVALID_STATE_ERR=(w[11]="Invalid state",11),v.SYNTAX_ERR=(w[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13),v.NAMESPACE_ERR=(w[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(w[15]="Invalid access",15),$.prototype=Error.prototype,s(v,$),k.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var i=[],s=0;s<this.length;s++)te(this[s],i,e,t);return i.join("")}},C.prototype.item=function(e){return A(this),this[e]},a(C,k),D.prototype={length:0,item:k.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var i=this[t];if(i.nodeName==e)return i}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new $(x);var i=this.getNamedItem(e.nodeName);return I(this._ownerElement,this,e,i),i},setNamedItemNS:function(e){var t,i=e.ownerElement;if(i&&i!=this._ownerElement)throw new $(x);return t=this.getNamedItemNS(e.namespaceURI,e.localName),I(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return S(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);return S(this._ownerElement,this,i),i},getNamedItemNS:function(e,t){for(var i=this.length;i--;){var s=this[i];if(s.localName==t&&s.namespaceURI==e)return s}return null}},V.prototype={hasFeature:function(e,t){var i=this._features[e.toLowerCase()];return!(!i||t&&!(t in i))},createDocument:function(e,t,i){var s=new N;if(s.implementation=this,s.childNodes=new k,s.doctype=i,i&&s.appendChild(i),t){var a=s.createElementNS(e,t);s.appendChild(a)}return s},createDocumentType:function(e,t,i){var s=new H;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=i,s}},F.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return O(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return L(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return se(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==l&&e.nodeType==l?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var i=t._nsMap;if(i)for(var s in i)if(i[s]==e)return s;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var i=t._nsMap;if(i&&e in i)return i[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},s(n,F),s(n,F.prototype),N.prototype={nodeName:"#document",nodeType:m,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var i=e.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,t),i=s}return e}return null==this.documentElement&&e.nodeType==r&&(this.documentElement=e),O(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),L(this,e)},importNode:function(e,t){return ie(this,e,t)},getElementById:function(e){var t=null;return j(this.documentElement,(function(i){if(i.nodeType==r&&i.getAttribute("id")==e)return t=i,!0})),t},createElement:function(e){var t=new R;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new k,(t.attributes=new D)._ownerElement=t,t},createDocumentFragment:function(){var e=new Q;return e.ownerDocument=this,e.childNodes=new k,e},createTextNode:function(e){var t=new U;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new W;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new z;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var i=new Y;return i.ownerDocument=this,i.tagName=i.target=e,i.nodeValue=i.data=t,i},createAttribute:function(e){var t=new q;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new K;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var i=new R,s=t.split(":"),a=i.attributes=new D;return i.childNodes=new k,i.ownerDocument=this,i.nodeName=t,i.tagName=t,i.namespaceURI=e,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,a._ownerElement=i,i},createAttributeNS:function(e,t){var i=new q,s=t.split(":");return i.ownerDocument=this,i.nodeName=t,i.name=t,i.namespaceURI=e,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,i}},a(N,F),R.prototype={nodeType:r,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t,this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var i=t.parentNode;if(i){var s=e.lastChild;i.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,T(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new C(this,(function(t){var i=[];return j(t,(function(s){s===t||s.nodeType!=r||"*"!==e&&s.tagName!=e||i.push(s)})),i}))},getElementsByTagNameNS:function(e,t){return new C(this,(function(i){var s=[];return j(i,(function(a){a===i||a.nodeType!==r||"*"!==e&&a.namespaceURI!==e||"*"!==t&&a.localName!=t||s.push(a)})),s}))}},N.prototype.getElementsByTagName=R.prototype.getElementsByTagName,N.prototype.getElementsByTagNameNS=R.prototype.getElementsByTagNameNS,a(R,F),q.prototype.nodeType=o,a(q,F),M.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){i=this.data.substring(0,e)+i+this.data.substring(e+t),this.nodeValue=this.data=i,this.length=i.length}},a(M,F),U.prototype={nodeName:"#text",nodeType:l,splitText:function(e){var t=this.data,i=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},a(U,M),W.prototype={nodeName:"#comment",nodeType:p},a(W,M),z.prototype={nodeName:"#cdata-section",nodeType:u},a(z,M),H.prototype.nodeType=f,a(H,F),G.prototype.nodeType=b,a(G,F),J.prototype.nodeType=d,a(J,F),K.prototype.nodeType=c,a(K,F),Q.prototype.nodeName="#document-fragment",Q.prototype.nodeType=g,a(Q,F),Y.prototype.nodeType=h,a(Y,F),X.prototype.serializeToString=function(e,t,i){return Z.call(e,t,i)},F.prototype.toString=Z;try{if(Object.defineProperty){function ne(e){switch(e.nodeType){case r:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ne(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(C.prototype,"length",{get:function(){return A(this),this.$$length}}),Object.defineProperty(F.prototype,"textContent",{get:function(){return ne(this)},set:function(e){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ae=function(e,t,i){e["$$"+t]=i}}}catch(re){}i.DOMImplementation=V,i.XMLSerializer=X},{}],21:[function(e,t,i){var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,a=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+s.source+a.source+"*(?::"+s.source+a.source+"*)?$");function r(){}function o(e,t,i,s,a){function n(e){var t=e.slice(1,-1);return t in i?i[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),i=56320+(1023&e);return String.fromCharCode(t,i)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(a.error("entity not found:"+e),e)}function r(t){if(t>x){var i=e.substring(x,t).replace(/&#?\w+;/g,n);w&&o(x),s.characters(i,0,t-x),x=t}}function o(t,i){for(;t>=b&&(i=v.exec(e));)p=i.index,b=p+i[0].length,w.lineNumber++;w.columnNumber=t-p+1}for(var p=0,b=0,v=/.*(?:\r\n?|\n)|.*$/g,w=s.locator,y=[{currentNSMap:t}],_={},x=0;;){try{var $=e.indexOf("<",x);if($<0){if(!e.substr(x).match(/^\s*$/)){var k=s.doc,C=k.createTextNode(e.substr(x));k.appendChild(C),s.currentElement=C}return}switch($>x&&r($),e.charAt($+1)){case"/":var A=e.indexOf(">",$+3),D=e.substring($+2,A),E=y.pop();A<0?(D=e.substring($+2).replace(/[\s<].*/,""),a.error("end tag name: "+D+" is not complete:"+E.tagName),A=$+1+D.length):D.match(/\s</)&&(D=D.replace(/[\s<].*/,""),a.error("end tag name: "+D+" maybe not complete"),A=$+1+D.length);var I=E.localNSMap,S=E.tagName==D;if(S||E.tagName&&E.tagName.toLowerCase()==D.toLowerCase()){if(s.endElement(E.uri,E.localName,D),I)for(var V in I)s.endPrefixMapping(V);S||a.fatalError("end tag name: "+D+" is not match the current start tagName:"+E.tagName)}else y.push(E);A++;break;case"?":w&&o($),A=f(e,$,s);break;case"!":w&&o($),A=m(e,$,s,a);break;default:w&&o($);var F=new g,B=y[y.length-1].currentNSMap,j=(A=u(e,$,F,B,n,a),F.length);if(!F.closed&&h(e,A,F.tagName,_)&&(F.closed=!0,i.nbsp||a.warning("unclosed xml attribute")),w&&j){for(var N=l(w,{}),P=0;P<j;P++){var T=F[P];o(T.offset),T.locator=l(w,{})}s.locator=N,c(F,s,B)&&y.push(F),s.locator=w}else c(F,s,B)&&y.push(F);"http://www.w3.org/1999/xhtml"!==F.uri||F.closed?A++:A=d(e,A,F.tagName,n,s)}}catch(e){a.error("element parse error: "+e),A=-1}A>x?x=A:r(Math.max($,x)+1)}}function l(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function u(e,t,i,s,a,n){for(var r,o=++t,l=0;;){var u=e.charAt(o);switch(u){case"=":if(1===l)r=e.slice(t,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(n.warning('attribute value must after "="'),r=e.slice(t,o)),t=o+1,!((o=e.indexOf(u,t))>0))throw new Error("attribute value no end '"+u+"' match");c=e.slice(t,o).replace(/&#?\w+;/g,a),i.add(r,c,t-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');c=e.slice(t,o).replace(/&#?\w+;/g,a),i.add(r,c,t),n.warning('attribute "'+r+'" missed start quot('+u+")!!"),t=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return n.error("unexpected end of input"),0==l&&i.setTagName(e.slice(t,o)),o;case">":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(c=e.slice(t,o)).slice(-1)&&(i.closed=!0,c=c.slice(0,-1));case 2:2===l&&(c=r),4==l?(n.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c.replace(/&#?\w+;/g,a),t)):("http://www.w3.org/1999/xhtml"===s[""]&&c.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),i.add(c,c,t));break;case 3:throw new Error("attribute value missed!!")}return o;case"":u=" ";default:if(u<=" ")switch(l){case 0:i.setTagName(e.slice(t,o)),l=6;break;case 1:r=e.slice(t,o),l=2;break;case 4:var c=e.slice(t,o).replace(/&#?\w+;/g,a);n.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c,t);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&r.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+r+'" missed value!! "'+r+'" instead2!!'),i.add(r,r,t),t=o,l=1;break;case 5:n.warning('attribute space is required"'+r+'"!!');case 6:l=1,t=o;break;case 3:l=4,t=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function c(e,t,i){for(var s=e.tagName,a=null,n=e.length;n--;){var r=e[n],o=r.qName,l=r.value;if((h=o.indexOf(":"))>0)var u=r.prefix=o.slice(0,h),c=o.slice(h+1),d="xmlns"===u&&c;else c=o,u=null,d="xmlns"===o&&"";r.localName=c,!1!==d&&(null==a&&(a={},p(i,i={})),i[d]=a[d]=l,r.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(d,l))}for(n=e.length;n--;)(u=(r=e[n]).prefix)&&("xml"===u&&(r.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(r.uri=i[u||""]));var h;(h=s.indexOf(":"))>0?(u=e.prefix=s.slice(0,h),c=e.localName=s.slice(h+1)):(u=null,c=e.localName=s);var m=e.uri=i[u||""];if(t.startElement(m,c,s,e),!e.closed)return e.currentNSMap=i,e.localNSMap=a,!0;if(t.endElement(m,c,s),a)for(u in a)t.endPrefixMapping(u)}function d(e,t,i,s,a){if(/^(?:script|textarea)$/i.test(i)){var n=e.indexOf("</"+i+">",t),r=e.substring(t+1,n);if(/[&<]/.test(r))return/^script$/i.test(i)?(a.characters(r,0,r.length),n):(r=r.replace(/&#?\w+;/g,s),a.characters(r,0,r.length),n)}return t+1}function h(e,t,i,s){var a=s[i];return null==a&&((a=e.lastIndexOf("</"+i+">"))<t&&(a=e.lastIndexOf("</"+i)),s[i]=a),a<t}function p(e,t){for(var i in e)t[i]=e[i]}function m(e,t,i,s){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(a=e.indexOf("--\x3e",t+4))>t?(i.comment(e,t+4,a-t-4),a+3):(s.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var a=e.indexOf("]]>",t+9);return i.startCDATA(),i.characters(e,t+9,a-t-9),i.endCDATA(),a+3}var n=function(e,t){var i,s=[],a=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(a.lastIndex=t,a.exec(e);i=a.exec(e);)if(s.push(i),i[1])return s}(e,t),r=n.length;if(r>1&&/!doctype/i.test(n[0][0])){var o=n[1][0],l=r>3&&/^public$/i.test(n[2][0])&&n[3][0],u=r>4&&n[4][0],c=n[r-1];return i.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),c.index+c[0].length}return-1}function f(e,t,i){var s=e.indexOf("?>",t);if(s){var a=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return a?(a[0].length,i.processingInstruction(a[1],a[2]),s+2):-1}return-1}function g(e){}function b(e,t){return e.__proto__=t,e}r.prototype={parse:function(e,t,i){var s=this.domBuilder;s.startDocument(),p(t,t={}),o(e,t,i,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(e){if(!n.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,i){if(!n.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},b({},b.prototype)instanceof b||(b=function(e,t){function i(){}for(t in i.prototype=t,i=new i,e)i[t]=e[t];return i}),i.XMLReader=r},{}],"/src/js/docxtemplater.js":[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=e("./doc-utils");n.traits=e("./traits"),n.moduleWrapper=e("./module-wrapper");var r=n.moduleWrapper,o=function(){function e(){if(a(this,e),arguments.length>0)throw new Error("The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return s(e,[{key:"attachModule",value:function(e){return this.modules.push(r(e)),this}},{key:"setOptions",value:function(e){var t=this;return this.options=e,Object.keys(n.defaults).forEach((function(e){var i=n.defaults[e];t[e]=null!=t.options[e]?t.options[e]:i})),this.zip&&this.updateFileTypeConfig(),this}},{key:"loadZip",value:function(e){if(e.loadAsync)throw new Error("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=e,this.updateFileTypeConfig(),this}},{key:"compileFile",value:function(e){var t=this.createTemplateClass(e);t.parse(),this.compiled[e]=t}},{key:"compile",value:function(){return this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip),this}},{key:"updateFileTypeConfig",value:function(){return this.fileType=this.zip.files["word/document.xml"]?"docx":"pptx",this.fileTypeConfig=this.options.fileTypeConfig||e.FileTypeConfig[this.fileType],this}},{key:"render",value:function(){var e=this;return this.options.xmlFileNames=[],this.modules=this.fileTypeConfig.baseModules.map((function(e){return e()})).concat(this.modules),this.options=this.modules.reduce((function(t,i){return i.optionsTransformer(t,e)}),this.options),this.xmlDocuments=this.options.xmlFileNames.reduce((function(t,i){var s=e.zip.files[i].asText();return t[i]=n.str2xml(s),t}),{}),this.modules.forEach((function(t){t.set({zip:e.zip,xmlDocuments:e.xmlDocuments,data:e.data})})),this.compile(),this.modules.forEach((function(t){t.set({compiled:e.compiled})})),this.templatedFiles.forEach((function(t){null!=e.zip.files[t]&&e.compileFile(t)})),this.mapper=this.modules.reduce((function(e,t){return t.getRenderedMap(e)}),{}),Object.keys(this.mapper).forEach((function(t){var i=e.mapper[t],s=i.from,a=e.compiled[s];a.setTags(i.data),a.render(t),e.zip.file(t,a.content)})),Object.keys(this.xmlDocuments).forEach((function(t){e.zip.remove(t);var i=n.xml2str(e.xmlDocuments[t]);return e.zip.file(t,i,{})})),this}},{key:"setData",value:function(e){return this.data=e,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(e){var t=this.zip.files[e].asText();return this.createTemplateClassFromContent(t,e)}},{key:"createTemplateClassFromContent",value:function(t,i){var s=this,a={filePath:i};return Object.keys(n.defaults).forEach((function(e){a[e]=s[e]})),a.fileTypeConfig=this.fileTypeConfig,a.modules=this.modules,new e.XmlTemplater(t,a)}},{key:"getFullText",value:function(e){return this.createTemplateClass(e||this.fileTypeConfig.textPath).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.compile(),this.templatedFiles}}]),e}();o.DocUtils=e("./doc-utils"),o.Errors=e("./errors"),o.XmlTemplater=e("./xml-templater"),o.FileTypeConfig=e("./file-type-config"),o.XmlMatcher=e("./xml-matcher"),t.exports=o},{"./doc-utils":1,"./errors":2,"./file-type-config":3,"./module-wrapper":7,"./traits":16,"./xml-matcher":17,"./xml-templater":18}]},{},[])("/src/js/docxtemplater.js")},1290:e=>{e.exports=function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){if(n)return n(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};t[r][0].call(u.exports,(function(e){return a(t[r][1][e]||e)}),u,u.exports,e,t,i,s)}return i[r].exports}for(var n=void 0,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){"use strict";function s(e){if(e){this.data=e,this.length=this.data.length,this.index=0,this.zero=0;for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}}var a=e("./dataReader");s.prototype=new a,s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),s=e.charCodeAt(2),a=e.charCodeAt(3),n=this.length-4;n>=0;--n)if(this.data[n]===t&&this.data[n+1]===i&&this.data[n+2]===s&&this.data[n+3]===a)return n-this.zero;return-1},s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./dataReader":6}],2:[function(e,t,i){"use strict";var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e,t){for(var i,a,n,r,o,l,u,c="",d=0;d<e.length;)r=(i=e.charCodeAt(d++))>>2,o=(3&i)<<4|(a=e.charCodeAt(d++))>>4,l=(15&a)<<2|(n=e.charCodeAt(d++))>>6,u=63&n,isNaN(a)?l=u=64:isNaN(n)&&(u=64),c=c+s.charAt(r)+s.charAt(o)+s.charAt(l)+s.charAt(u);return c},i.decode=function(e,t){var i,a,n,r,o,l,u="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)i=s.indexOf(e.charAt(c++))<<2|(r=s.indexOf(e.charAt(c++)))>>4,a=(15&r)<<4|(o=s.indexOf(e.charAt(c++)))>>2,n=(3&o)<<6|(l=s.indexOf(e.charAt(c++))),u+=String.fromCharCode(i),64!=o&&(u+=String.fromCharCode(a)),64!=l&&(u+=String.fromCharCode(n));return u}},{}],3:[function(e,t,i){"use strict";function s(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}s.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=s},{}],4:[function(e,t,i){"use strict";i.STORE={magic:"\0\0",compress:function(e,t){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},i.DEFLATE=e("./flate")},{"./flate":9}],5:[function(e,t,i){"use strict";var s=e("./utils"),a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==s.getTypeOf(e);void 0===t&&(t=0);var n=0;t^=-1;for(var r=0,o=e.length;r<o;r++)n=i?e[r]:e.charCodeAt(r),t=t>>>8^a[255&(t^n)];return-1^t}},{"./utils":22}],6:[function(e,t,i){"use strict";function s(e){this.data=null,this.length=0,this.index=0,this.zero=0}var a=e("./utils");s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return a.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=s},{"./utils":22}],7:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!1,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],8:[function(e,t,i){"use strict";var s=e("./utils");i.string2binary=function(e){return s.string2binary(e)},i.string2Uint8Array=function(e){return s.transformTo("uint8array",e)},i.uint8Array2String=function(e){return s.transformTo("string",e)},i.string2Blob=function(e){var t=s.transformTo("arraybuffer",e);return s.arrayBuffer2Blob(t)},i.arrayBuffer2Blob=function(e){return s.arrayBuffer2Blob(e)},i.transformTo=function(e,t){return s.transformTo(e,t)},i.getTypeOf=function(e){return s.getTypeOf(e)},i.checkSupport=function(e){return s.checkSupport(e)},i.MAX_VALUE_16BITS=s.MAX_VALUE_16BITS,i.MAX_VALUE_32BITS=s.MAX_VALUE_32BITS,i.pretty=function(e){return s.pretty(e)},i.findCompression=function(e){return s.findCompression(e)},i.isRegExp=function(e){return s.isRegExp(e)}},{"./utils":22}],9:[function(e,t,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,a=e("pako");i.uncompressInputType=s?"uint8array":"array",i.compressInputType=s?"uint8array":"array",i.magic="\b\0",i.compress=function(e,t){return a.deflateRaw(e,{level:t.level||-1})},i.uncompress=function(e){return a.inflateRaw(e)}},{pako:25}],10:[function(e,t,i){"use strict";function s(e,t){return this instanceof s?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new s;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new s(e,t)}var a=e("./base64");s.prototype=e("./object"),s.prototype.load=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.utils=e("./deprecatedPublicUtils"),s.base64={encode:function(e){return a.encode(e)},decode:function(e){return a.decode(e)}},s.compressions=e("./compressions"),t.exports=s},{"./base64":2,"./compressions":4,"./defaults":7,"./deprecatedPublicUtils":8,"./load":11,"./object":14,"./support":18}],11:[function(e,t,i){"use strict";var s=e("./base64"),a=e("./utf8"),n=e("./utils"),r=e("./zipEntries");t.exports=function(e,t){var i,o,l,u;for((t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode})).base64&&(e=s.decode(e)),i=(o=new r(e,t)).files,l=0;l<i.length;l++)u=i[l],this.file(u.fileNameStr,u.decompressed,{binary:!0,optimizedBinaryString:!0,date:u.date,dir:u.dir,comment:u.fileCommentStr.length?u.fileCommentStr:null,unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions,createFolders:t.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":2,"./utf8":21,"./utils":22,"./zipEntries":23}],12:[function(e,t,i){(function(e){"use strict";t.exports=function(t,i){return new e(t,i)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(e,t,i){"use strict";function s(e){this.data=e,this.length=this.data.length,this.index=0,this.zero=0}var a=e("./uint8ArrayReader");s.prototype=new a,s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./uint8ArrayReader":19}],14:[function(e,t,i){"use strict";var s=e("./support"),a=e("./utils"),n=e("./crc32"),r=e("./signature"),o=e("./defaults"),l=e("./base64"),u=e("./compressions"),c=e("./compressedObject"),d=e("./nodeBuffer"),h=e("./utf8"),p=e("./stringWriter"),m=e("./uint8ArrayWriter"),f=function(e){if(e._data instanceof c&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===a.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},g=function(e){var t=f(e);return"string"===a.getTypeOf(t)?!e.options.binary&&s.nodebuffer?d(t,"utf-8"):e.asBinary():t},b=function(e){var t=f(this);return null==t?"":(this.options.base64&&(t=l.decode(t)),t=e&&this.options.binary?A.utf8decode(t):a.transformTo("string",t),e||this.options.binary||(t=a.transformTo("string",A.utf8encode(t))),t)},v=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this.options=i,this._initialMetadata={dir:i.dir,date:i.date}};v.prototype={asText:function(){return b.call(this,!0)},asBinary:function(){return b.call(this,!1)},asNodeBuffer:function(){var e=g(this);return a.transformTo("nodebuffer",e)},asUint8Array:function(){var e=g(this);return a.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var w=function(e,t){var i,s="";for(i=0;i<t;i++)s+=String.fromCharCode(255&e),e>>>=8;return s},y=function(e,t,i){var s,n=a.getTypeOf(t);if("string"==typeof(i=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=a.extend(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e}(i)).unixPermissions&&(i.unixPermissions=parseInt(i.unixPermissions,8)),i.unixPermissions&&16384&i.unixPermissions&&(i.dir=!0),i.dosPermissions&&16&i.dosPermissions&&(i.dir=!0),i.dir&&(e=x(e)),i.createFolders&&(s=_(e))&&$.call(this,s,!0),i.dir||null==t)i.base64=!1,i.binary=!1,t=null,n=null;else if("string"===n)i.binary&&!i.base64&&!0!==i.optimizedBinaryString&&(t=a.string2binary(t));else{if(i.base64=!1,i.binary=!0,!(n||t instanceof c))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===n&&(t=a.transformTo("uint8array",t))}var r=new v(e,t,i);return this.files[e]=r,r},_=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},x=function(e){return"/"!=e.slice(-1)&&(e+="/"),e},$=function(e,t){return t=void 0!==t&&t,e=x(e),this.files[e]||y.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},k=function(e,t,i){var s,r=new c;return e._data instanceof c?(r.uncompressedSize=e._data.uncompressedSize,r.crc32=e._data.crc32,0===r.uncompressedSize||e.dir?(t=u.STORE,r.compressedContent="",r.crc32=0):e._data.compressionMethod===t.magic?r.compressedContent=e._data.getCompressedContent():(s=e._data.getContent(),r.compressedContent=t.compress(a.transformTo(t.compressInputType,s),i))):((s=g(e))&&0!==s.length&&!e.dir||(t=u.STORE,s=""),r.uncompressedSize=s.length,r.crc32=n(s),r.compressedContent=t.compress(a.transformTo(t.compressInputType,s),i)),r.compressedSize=r.compressedContent.length,r.compressionMethod=t.magic,r},C=function(e,t,i,s,o,l){var u,c,d,p,m=(i.compressedContent,l!==h.utf8encode),f=a.transformTo("string",l(t.name)),g=a.transformTo("string",h.utf8encode(t.name)),b=t.comment||"",v=a.transformTo("string",l(b)),y=a.transformTo("string",h.utf8encode(b)),_=g.length!==t.name.length,x=y.length!==b.length,$=t.options,k="",C="",A="";d=t._initialMetadata.dir!==t.dir?t.dir:$.dir,p=t._initialMetadata.date!==t.date?t.date:$.date;var D=0,E=0;d&&(D|=16),"UNIX"===o?(E=798,D|=function(e,t){var i=e;return e||(i=t?16893:33204),(65535&i)<<16}(t.unixPermissions,d)):(E=20,D|=function(e,t){return 63&(e||0)}(t.dosPermissions)),u=p.getHours(),u<<=6,u|=p.getMinutes(),u<<=5,u|=p.getSeconds()/2,c=p.getFullYear()-1980,c<<=4,c|=p.getMonth()+1,c<<=5,c|=p.getDate(),_&&(C=w(1,1)+w(n(f),4)+g,k+="up"+w(C.length,2)+C),x&&(A=w(1,1)+w(this.crc32(v),4)+y,k+="uc"+w(A.length,2)+A);var I="";return I+="\n\0",I+=m||!_&&!x?"\0\0":"\0\b",I+=i.compressionMethod,I+=w(u,2),I+=w(c,2),I+=w(i.crc32,4),I+=w(i.compressedSize,4),I+=w(i.uncompressedSize,4),I+=w(f.length,2),I+=w(k.length,2),{fileRecord:r.LOCAL_FILE_HEADER+I+f+k,dirRecord:r.CENTRAL_FILE_HEADER+w(E,2)+I+w(v.length,2)+"\0\0\0\0"+w(D,4)+w(s,4)+f+k+v,compressedObject:i}},A={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,i,s,n,r=[];for(t in this.files)this.files.hasOwnProperty(t)&&(s=this.files[t],n=new v(s.name,s._data,a.extend(s.options)),i=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(i,n)&&r.push(n));return r},file:function(e,t,i){if(1===arguments.length){if(a.isRegExp(e)){var s=e;return this.filter((function(e,t){return!t.dir&&s.test(e)}))}return this.filter((function(t,i){return!i.dir&&t===e}))[0]||null}return e=this.root+e,y.call(this,e,t,i),this},folder:function(e){if(!e)return this;if(a.isRegExp(e))return this.filter((function(t,i){return i.dir&&e.test(t)}));var t=this.root+e,i=$.call(this,t),s=this.clone();return s.root=i.name,s},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter((function(t,i){return i.name.slice(0,e.length)===e})),s=0;s<i.length;s++)delete this.files[i[s].name];return this},generate:function(e){e=a.extend(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:h.utf8encode}),a.checkSupport(e.type),"darwin"!==e.platform&&"freebsd"!==e.platform&&"linux"!==e.platform&&"sunos"!==e.platform||(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var t,i,s=[],n=0,o=0,c=a.transformTo("string",e.encodeFileName(e.comment||this.comment||""));for(var d in this.files)if(this.files.hasOwnProperty(d)){var f=this.files[d],g=f.options.compression||e.compression.toUpperCase(),b=u[g];if(!b)throw new Error(g+" is not a valid compression method !");var v=f.options.compressionOptions||e.compressionOptions||{},y=k.call(this,f,b,v),_=C.call(this,d,f,y,n,e.platform,e.encodeFileName);n+=_.fileRecord.length+y.compressedSize,o+=_.dirRecord.length,s.push(_)}var x;x=r.CENTRAL_DIRECTORY_END+"\0\0\0\0"+w(s.length,2)+w(s.length,2)+w(o,4)+w(n,4)+w(c.length,2)+c;var $=e.type.toLowerCase();for(t="uint8array"===$||"arraybuffer"===$||"blob"===$||"nodebuffer"===$?new m(n+o+x.length):new p(n+o+x.length),i=0;i<s.length;i++)t.append(s[i].fileRecord),t.append(s[i].compressedObject.compressedContent);for(i=0;i<s.length;i++)t.append(s[i].dirRecord);t.append(x);var A=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return a.transformTo(e.type.toLowerCase(),A);case"blob":return a.arrayBuffer2Blob(a.transformTo("arraybuffer",A),e.mimeType);case"base64":return e.base64?l.encode(A):A;default:return A}},crc32:function(e,t){return n(e,t)},utf8encode:function(e){return a.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=A},{"./base64":2,"./compressedObject":3,"./compressions":4,"./crc32":5,"./defaults":7,"./nodeBuffer":12,"./signature":15,"./stringWriter":17,"./support":18,"./uint8ArrayWriter":20,"./utf8":21,"./utils":22}],15:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],16:[function(e,t,i){"use strict";function s(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0,this.zero=0}var a=e("./dataReader"),n=e("./utils");s.prototype=new a,s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./dataReader":6,"./utils":22}],17:[function(e,t,i){"use strict";var s=e("./utils"),a=function(){this.data=[]};a.prototype={append:function(e){e=s.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=a},{"./utils":22}],18:[function(e,t,i){(function(e){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==e,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var t=new ArrayBuffer(0);try{i.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);s.append(t),i.blob=0===s.getBlob("application/zip").size}catch(e){i.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],19:[function(e,t,i){"use strict";function s(e){e&&(this.data=e,this.length=this.data.length,this.index=0,this.zero=0)}var a=e("./arrayReader");s.prototype=new a,s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./arrayReader":1}],20:[function(e,t,i){"use strict";var s=e("./utils"),a=function(e){this.data=new Uint8Array(e),this.index=0};a.prototype={append:function(e){0!==e.length&&(e=s.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=a},{"./utils":22}],21:[function(e,t,i){"use strict";for(var s=e("./utils"),a=e("./support"),n=e("./nodeBuffer"),r=new Array(256),o=0;o<256;o++)r[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;r[254]=r[254]=1;var l=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+r[e[i]]>t?i:t},u=function(e){var t,i,a,n,o=e.length,l=new Array(2*o);for(i=0,t=0;t<o;)if((a=e[t++])<128)l[i++]=a;else if((n=r[a])>4)l[i++]=65533,t+=n-1;else{for(a&=2===n?31:3===n?15:7;n>1&&t<o;)a=a<<6|63&e[t++],n--;n>1?l[i++]=65533:a<65536?l[i++]=a:(a-=65536,l[i++]=55296|a>>10&1023,l[i++]=56320|1023&a)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),s.applyFromCharCode(l)};i.utf8encode=function(e){return a.nodebuffer?n(e,"utf-8"):function(e){var t,i,s,n,r,o=e.length,l=0;for(n=0;n<o;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<o&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=a.uint8array?new Uint8Array(l):new Array(l),r=0,n=0;r<l;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<o&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t}(e)},i.utf8decode=function(e){if(a.nodebuffer)return s.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],i=0,n=(e=s.transformTo(a.uint8array?"uint8array":"array",e)).length;i<n;){var r=l(e,Math.min(i+65536,n));a.uint8array?t.push(u(e.subarray(i,r))):t.push(u(e.slice(i,r))),i=r}return t.join("")}},{"./nodeBuffer":12,"./support":18,"./utils":22}],22:[function(e,t,i){"use strict";function s(e){return e}function a(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}function n(e){var t=65536,s=[],a=e.length,n=i.getTypeOf(e),r=0,o=!0;try{switch(n){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,u(0))}}catch(e){o=!1}if(!o){for(var l="",c=0;c<e.length;c++)l+=String.fromCharCode(e[c]);return l}for(;r<a&&t>1;)try{"array"===n||"nodebuffer"===n?s.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+t,a)))):s.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+t,a)))),r+=t}catch(e){t=Math.floor(t/2)}return s.join("")}function r(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}var o=e("./support"),l=e("./compressions"),u=e("./nodeBuffer");i.string2binary=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i));return t},i.arrayBuffer2Blob=function(e,t){i.checkSupport("blob"),t=t||"application/zip";try{return new Blob([e],{type:t})}catch(i){try{var s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return s.append(e),s.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}},i.applyFromCharCode=n;var c={};c.string={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:function(e){return a(e,u(e.length))}},c.array={string:n,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(e)}},c.arraybuffer={string:function(e){return n(new Uint8Array(e))},array:function(e){return r(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(new Uint8Array(e))}},c.uint8array={string:n,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return u(e)}},c.nodebuffer={string:n,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return r(e,new Uint8Array(e.length))},nodebuffer:s},i.transformTo=function(e,t){if(t||(t=""),!e)return t;i.checkSupport(e);var s=i.getTypeOf(t);return c[s][e](t)},i.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&u.test(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(e){var t,i,s="";for(i=0;i<(e||"").length;i++)s+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return s},i.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},i.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},i.extend=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===i[t]&&(i[t]=arguments[e][t]);return i}},{"./compressions":4,"./nodeBuffer":12,"./support":18}],23:[function(e,t,i){"use strict";function s(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var a=e("./stringReader"),n=e("./nodeBufferReader"),r=e("./uint8ArrayReader"),o=e("./arrayReader"),l=e("./utils"),u=e("./signature"),c=e("./zipEntry"),d=e("./support");e("./object"),s.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+l.pretty(t)+", expected "+l.pretty(e)+")")},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);var s=this.reader.readString(4)===t;return this.reader.setIndex(i),s},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=d.uint8array?"uint8array":"array",i=l.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,s=this.zip64EndOfCentralSize-44;0<s;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(u.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===u.CENTRAL_FILE_HEADER;)(e=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(u.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,u.LOCAL_FILE_HEADER)?new Error("Corrupted zip : can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(u.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,u.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var s=t-i;if(s>0)this.isSignature(t,u.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(s<0)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(e){var t=l.getTypeOf(e);if(l.checkSupport(t),"string"!==t||d.uint8array)if("nodebuffer"===t)this.reader=new n(e);else if(d.uint8array)this.reader=new r(l.transformTo("uint8array",e));else{if(!d.array)throw new Error("Unexpected error: unsupported type '"+t+"'");this.reader=new o(l.transformTo("array",e))}else this.reader=new a(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=s},{"./arrayReader":1,"./nodeBufferReader":13,"./object":14,"./signature":15,"./stringReader":16,"./support":18,"./uint8ArrayReader":19,"./utils":22,"./zipEntry":24}],24:[function(e,t,i){"use strict";function s(e,t){this.options=e,this.loadOptions=t}var a=e("./stringReader"),n=e("./utils"),r=e("./compressedObject"),o=e("./object"),l=e("./support");s.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,i){return function(){var s=e.index;e.setIndex(t);var a=e.readData(i);return e.setIndex(s),a}},prepareContent:function(e,t,i,s,a){return function(){var e=n.transformTo(s.uncompressInputType,this.getCompressedContent()),t=s.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(i),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=n.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");if(this.decompressed=new r,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=n.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readData(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=new a(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,i,s,a=e.index;for(this.extraFields=this.extraFields||{};e.index<a+this.extraFieldsLength;)t=e.readInt(2),i=e.readInt(2),s=e.readString(i),this.extraFields[t]={id:t,length:i,value:s}},handleUTF8:function(){var e=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var i=n.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var s=this.findExtraFieldUnicodeComment();if(null!==s)this.fileCommentStr=s;else{var a=n.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new a(e.value);return 1!==t.readInt(1)||o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new a(e.value);return 1!==t.readInt(1)||o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=s},{"./compressedObject":3,"./object":14,"./stringReader":16,"./support":18,"./utils":22}],25:[function(e,t,i){"use strict";var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=s},{"./lib/deflate":26,"./lib/inflate":27,"./lib/utils/common":28,"./lib/zlib/constants":31}],26:[function(e,t,i){"use strict";function s(e){if(!(this instanceof s))return new s(e);this.options=r.assign({level:h,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==d)throw new Error(l[i]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var a;if(a="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=n.deflateSetDictionary(this.strm,a))!==d)throw new Error(l[i]);this._dict_set=!0}}function a(e,t){var i=new s(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}var n=e("./zlib/deflate"),r=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=Object.prototype.toString,d=0,h=-1,p=0,m=8;s.prototype.push=function(e,t){var i,s,a=this.strm,l=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=o.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(l),a.next_out=0,a.avail_out=l),1!==(i=n.deflate(a,s))&&i!==d)return this.onEnd(i),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===d):2!==s||(this.onEnd(d),a.avail_out=0,!0)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){e===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=s,i.deflate=a,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,a(e,t)}},{"./utils/common":28,"./utils/strings":29,"./zlib/deflate":33,"./zlib/messages":38,"./zlib/zstream":40}],27:[function(e,t,i){"use strict";function s(e){if(!(this instanceof s))return new s(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(u[i]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function a(e,t){var i=new s(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}var n=e("./zlib/inflate"),r=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),u=e("./zlib/messages"),c=e("./zlib/zstream"),d=e("./zlib/gzheader"),h=Object.prototype.toString;s.prototype.push=function(e,t){var i,s,a,u,c,d,p=this.strm,m=this.options.chunkSize,f=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(m),p.next_out=0,p.avail_out=m),(i=n.inflate(p,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&f&&(d="string"==typeof f?o.string2buf(f):"[object ArrayBuffer]"===h.call(f)?new Uint8Array(f):f,i=n.inflateSetDictionary(this.strm,d)),i===l.Z_BUF_ERROR&&!0===g&&(i=l.Z_OK,g=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&i!==l.Z_STREAM_END&&(0!==p.avail_in||s!==l.Z_FINISH&&s!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(a=o.utf8border(p.output,p.next_out),u=p.next_out-a,c=o.buf2string(p.output,a),p.next_out=u,p.avail_out=m-u,u&&r.arraySet(p.output,p.output,a,u,0),this.onData(c)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((p.avail_in>0||0===p.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(s=l.Z_FINISH),s===l.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):s!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),p.avail_out=0,!0)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=s,i.inflate=a,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},i.ungzip=a},{"./utils/common":28,"./utils/strings":29,"./zlib/constants":31,"./zlib/gzheader":34,"./zlib/inflate":36,"./zlib/messages":38,"./zlib/zstream":40}],28:[function(e,t,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,s,a){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),a);else for(var n=0;n<s;n++)e[a+n]=t[i+n]},flattenChunks:function(e){var t,i,s,a,n,r;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(r=new Uint8Array(s),a=0,t=0,i=e.length;t<i;t++)n=e[t],r.set(n,a),a+=n.length;return r}},n={arraySet:function(e,t,i,s,a){for(var n=0;n<s;n++)e[a+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(s)},{}],29:[function(e,t,i){"use strict";function s(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&n))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}var a=e("./common"),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var o=new a.Buf8(256),l=0;l<256;l++)o[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;o[254]=o[254]=1,i.string2buf=function(e){var t,i,s,n,r,o=e.length,l=0;for(n=0;n<o;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<o&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new a.Buf8(l),r=0,n=0;r<l;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<o&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},i.buf2binstring=function(e){return s(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,s=t.length;i<s;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,n,r,l=t||e.length,u=new Array(2*l);for(a=0,i=0;i<l;)if((n=e[i++])<128)u[a++]=n;else if((r=o[n])>4)u[a++]=65533,i+=r-1;else{for(n&=2===r?31:3===r?15:7;r>1&&i<l;)n=n<<6|63&e[i++],r--;r>1?u[a++]=65533:n<65536?u[a++]=n:(n-=65536,u[a++]=55296|n>>10&1023,u[a++]=56320|1023&n)}return s(u,a)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+o[e[i]]>t?i:t}},{"./common":28}],30:[function(e,t,i){"use strict";t.exports=function(e,t,i,s){for(var a=65535&e|0,n=e>>>16&65535|0,r=0;0!==i;){i-=r=i>2e3?2e3:i;do{n=n+(a=a+t[s++]|0)|0}while(--r);a%=65521,n%=65521}return a|n<<16|0}},{}],31:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],32:[function(e,t,i){"use strict";var s=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,a){var n=s,r=a+i;e^=-1;for(var o=a;o<r;o++)e=e>>>8^n[255&(e^t[o])];return-1^e}},{}],33:[function(e,t,i){"use strict";function s(e,t){return e.msg=D[t],t}function a(e){return(e<<1)-(e>4?9:0)}function n(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&($.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function o(e,t){k._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,r(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,i,s){var a=e.avail_in;return a>s&&(a=s),0===a?0:(e.avail_in-=a,$.arraySet(t,e.input,e.next_in,a,i),1===e.state.wrap?e.adler=C(e.adler,t,a,i):2===e.state.wrap&&(e.adler=A(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)}function d(e,t){var i,s,a=e.max_chain_length,n=e.strstart,r=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-ie?e.strstart-(e.w_size-ie):0,u=e.window,c=e.w_mask,d=e.prev,h=e.strstart+te,p=u[n+r-1],m=u[n+r];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(i=t)+r]===m&&u[i+r-1]===p&&u[i]===u[n]&&u[++i]===u[n+1]){n+=2,i++;do{}while(u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<h);if(s=te-(h-n),n=h-te,s>r){if(e.match_start=t,r=s,s>=o)break;p=u[n+r-1],m=u[n+r]}}}while((t=d[t&c])>l&&0!=--a);return r<=e.lookahead?r:e.lookahead}function h(e){var t,i,s,a,n,r=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-ie)){$.arraySet(e.window,e.window,r,r,0),e.match_start-=r,e.strstart-=r,e.block_start-=r,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=r?s-r:0}while(--i);t=i=r;do{s=e.prev[--t],e.prev[t]=s>=r?s-r:0}while(--i);a+=r}if(0===e.strm.avail_in)break;if(i=c(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=i,e.lookahead+e.insert>=ee)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+ee-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<ee)););}while(e.lookahead<ie&&0!==e.strm.avail_in)}function p(e,t){for(var i,s;;){if(e.lookahead<ie){if(h(e),e.lookahead<ie&&t===E)return de;if(0===e.lookahead)break}if(i=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ie&&(e.match_length=d(e,i)),e.match_length>=ee)if(s=k._tr_tally(e,e.strstart-e.match_start,e.match_length-ee),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ee){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=k._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=e.strstart<ee-1?e.strstart:ee-1,t===V?(o(e,!0),0===e.strm.avail_out?pe:me):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function m(e,t){for(var i,s,a;;){if(e.lookahead<ie){if(h(e),e.lookahead<ie&&t===E)return de;if(0===e.lookahead)break}if(i=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ee-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ie&&(e.match_length=d(e,i),e.match_length<=5&&(e.strategy===O||e.match_length===ee&&e.strstart-e.match_start>4096)&&(e.match_length=ee-1)),e.prev_length>=ee&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-ee,s=k._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ee),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=ee-1,e.strstart++,s&&(o(e,!1),0===e.strm.avail_out))return de}else if(e.match_available){if((s=k._tr_tally(e,0,e.window[e.strstart-1]))&&o(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return de}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=k._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ee-1?e.strstart:ee-1,t===V?(o(e,!0),0===e.strm.avail_out?pe:me):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function f(e,t){for(var i,s,a,n,r=e.window;;){if(e.lookahead<=te){if(h(e),e.lookahead<=te&&t===E)return de;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ee&&e.strstart>0&&(s=r[a=e.strstart-1])===r[++a]&&s===r[++a]&&s===r[++a]){n=e.strstart+te;do{}while(s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&a<n);e.match_length=te-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ee?(i=k._tr_tally(e,1,e.match_length-ee),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=k._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=0,t===V?(o(e,!0),0===e.strm.avail_out?pe:me):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function g(e,t){for(var i;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===E)return de;break}if(e.match_length=0,i=k._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=0,t===V?(o(e,!0),0===e.strm.avail_out?pe:me):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function b(e,t,i,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=a}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new $.Buf16(2*X),this.dyn_dtree=new $.Buf16(2*(2*Q+1)),this.bl_tree=new $.Buf16(2*(2*Y+1)),n(this.dyn_ltree),n(this.dyn_dtree),n(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new $.Buf16(Z+1),this.heap=new $.Buf16(2*K+1),n(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new $.Buf16(2*K+1),n(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=W,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ae:ue,e.adler=2===t.wrap?0:1,t.last_flush=E,k._tr_init(t),B):s(e,N)}function y(e){var t=w(e);return t===B&&function(e){e.window_size=2*e.w_size,n(e.head),e.max_lazy_match=x[e.level].max_lazy,e.good_match=x[e.level].good_length,e.nice_match=x[e.level].nice_length,e.max_chain_length=x[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ee-1,e.match_available=0,e.ins_h=0}(e.state),t}function _(e,t,i,a,n,r){if(!e)return N;var o=1;if(t===L&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),n<1||n>H||i!==z||a<8||a>15||t<0||t>9||r<0||r>M)return s(e,N);8===a&&(a=9);var l=new v;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=a,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ee-1)/ee),l.window=new $.Buf8(2*l.w_size),l.head=new $.Buf16(l.hash_size),l.prev=new $.Buf16(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new $.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=r,l.method=i,y(e)}var x,$=e("../utils/common"),k=e("./trees"),C=e("./adler32"),A=e("./crc32"),D=e("./messages"),E=0,I=1,S=3,V=4,F=5,B=0,j=1,N=-2,P=-3,T=-5,L=-1,O=1,R=2,q=3,M=4,U=0,W=2,z=8,H=9,G=15,J=8,K=286,Q=30,Y=19,X=2*K+1,Z=15,ee=3,te=258,ie=te+ee+1,se=32,ae=42,ne=69,re=73,oe=91,le=103,ue=113,ce=666,de=1,he=2,pe=3,me=4,fe=3;x=[new b(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===E)return de;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,o(e,!1),0===e.strm.avail_out))return de;if(e.strstart-e.block_start>=e.w_size-ie&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=0,t===V?(o(e,!0),0===e.strm.avail_out?pe:me):(e.strstart>e.block_start&&(o(e,!1),e.strm.avail_out),de)})),new b(4,4,8,4,p),new b(4,5,16,8,p),new b(4,6,32,32,p),new b(4,4,16,16,m),new b(8,16,32,32,m),new b(8,16,128,128,m),new b(8,32,128,256,m),new b(32,128,258,1024,m),new b(32,258,258,4096,m)],i.deflateInit=function(e,t){return _(e,t,z,G,J,U)},i.deflateInit2=_,i.deflateReset=y,i.deflateResetKeep=w,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?N:(e.state.gzhead=t,B):N},i.deflate=function(e,t){var i,o,c,d;if(!e||!e.state||t>F||t<0)return e?s(e,N):N;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===ce&&t!==V)return s(e,0===e.avail_out?T:N);if(o.strm=e,i=o.last_flush,o.last_flush=t,o.status===ae)if(2===o.wrap)e.adler=0,l(o,31),l(o,139),l(o,8),o.gzhead?(l(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),l(o,255&o.gzhead.time),l(o,o.gzhead.time>>8&255),l(o,o.gzhead.time>>16&255),l(o,o.gzhead.time>>24&255),l(o,9===o.level?2:o.strategy>=R||o.level<2?4:0),l(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(l(o,255&o.gzhead.extra.length),l(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=A(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=ne):(l(o,0),l(o,0),l(o,0),l(o,0),l(o,0),l(o,9===o.level?2:o.strategy>=R||o.level<2?4:0),l(o,fe),o.status=ue);else{var h=z+(o.w_bits-8<<4)<<8;h|=(o.strategy>=R||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(h|=se),h+=31-h%31,o.status=ue,u(o,h),0!==o.strstart&&(u(o,e.adler>>>16),u(o,65535&e.adler)),e.adler=1}if(o.status===ne)if(o.gzhead.extra){for(c=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>c&&(e.adler=A(e.adler,o.pending_buf,o.pending-c,c)),r(e),c=o.pending,o.pending!==o.pending_buf_size));)l(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>c&&(e.adler=A(e.adler,o.pending_buf,o.pending-c,c)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=re)}else o.status=re;if(o.status===re)if(o.gzhead.name){c=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>c&&(e.adler=A(e.adler,o.pending_buf,o.pending-c,c)),r(e),c=o.pending,o.pending===o.pending_buf_size)){d=1;break}d=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,l(o,d)}while(0!==d);o.gzhead.hcrc&&o.pending>c&&(e.adler=A(e.adler,o.pending_buf,o.pending-c,c)),0===d&&(o.gzindex=0,o.status=oe)}else o.status=oe;if(o.status===oe)if(o.gzhead.comment){c=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>c&&(e.adler=A(e.adler,o.pending_buf,o.pending-c,c)),r(e),c=o.pending,o.pending===o.pending_buf_size)){d=1;break}d=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,l(o,d)}while(0!==d);o.gzhead.hcrc&&o.pending>c&&(e.adler=A(e.adler,o.pending_buf,o.pending-c,c)),0===d&&(o.status=le)}else o.status=le;if(o.status===le&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&r(e),o.pending+2<=o.pending_buf_size&&(l(o,255&e.adler),l(o,e.adler>>8&255),e.adler=0,o.status=ue)):o.status=ue),0!==o.pending){if(r(e),0===e.avail_out)return o.last_flush=-1,B}else if(0===e.avail_in&&a(t)<=a(i)&&t!==V)return s(e,T);if(o.status===ce&&0!==e.avail_in)return s(e,T);if(0!==e.avail_in||0!==o.lookahead||t!==E&&o.status!==ce){var p=o.strategy===R?g(o,t):o.strategy===q?f(o,t):x[o.level].func(o,t);if(p!==pe&&p!==me||(o.status=ce),p===de||p===pe)return 0===e.avail_out&&(o.last_flush=-1),B;if(p===he&&(t===I?k._tr_align(o):t!==F&&(k._tr_stored_block(o,0,0,!1),t===S&&(n(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),r(e),0===e.avail_out))return o.last_flush=-1,B}return t!==V?B:o.wrap<=0?j:(2===o.wrap?(l(o,255&e.adler),l(o,e.adler>>8&255),l(o,e.adler>>16&255),l(o,e.adler>>24&255),l(o,255&e.total_in),l(o,e.total_in>>8&255),l(o,e.total_in>>16&255),l(o,e.total_in>>24&255)):(u(o,e.adler>>>16),u(o,65535&e.adler)),r(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?B:j)},i.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ae&&t!==ne&&t!==re&&t!==oe&&t!==le&&t!==ue&&t!==ce?s(e,N):(e.state=null,t===ue?s(e,P):B):N},i.deflateSetDictionary=function(e,t){var i,s,a,r,o,l,u,c,d=t.length;if(!e||!e.state)return N;if(2===(r=(i=e.state).wrap)||1===r&&i.status!==ae||i.lookahead)return N;for(1===r&&(e.adler=C(e.adler,t,d,0)),i.wrap=0,d>=i.w_size&&(0===r&&(n(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new $.Buf8(i.w_size),$.arraySet(c,t,d-i.w_size,i.w_size,0),t=c,d=i.w_size),o=e.avail_in,l=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,h(i);i.lookahead>=ee;){s=i.strstart,a=i.lookahead-(ee-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+ee-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--a);i.strstart=s,i.lookahead=ee-1,h(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ee-1,i.match_available=0,e.next_in=l,e.input=u,e.avail_in=o,i.wrap=r,B},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":28,"./adler32":30,"./crc32":32,"./messages":38,"./trees":39}],34:[function(e,t,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],35:[function(e,t,i){"use strict";t.exports=function(e,t){var i,s,a,n,r,o,l,u,c,d,h,p,m,f,g,b,v,w,y,_,x,$,k,C,A;i=e.state,s=e.next_in,C=e.input,a=s+(e.avail_in-5),n=e.next_out,A=e.output,r=n-(t-e.avail_out),o=n+(e.avail_out-257),l=i.dmax,u=i.wsize,c=i.whave,d=i.wnext,h=i.window,p=i.hold,m=i.bits,f=i.lencode,g=i.distcode,b=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{m<15&&(p+=C[s++]<<m,m+=8,p+=C[s++]<<m,m+=8),w=f[p&b];t:for(;;){if(p>>>=y=w>>>24,m-=y,0==(y=w>>>16&255))A[n++]=65535&w;else{if(!(16&y)){if(0==(64&y)){w=f[(65535&w)+(p&(1<<y)-1)];continue t}if(32&y){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}_=65535&w,(y&=15)&&(m<y&&(p+=C[s++]<<m,m+=8),_+=p&(1<<y)-1,p>>>=y,m-=y),m<15&&(p+=C[s++]<<m,m+=8,p+=C[s++]<<m,m+=8),w=g[p&v];i:for(;;){if(p>>>=y=w>>>24,m-=y,!(16&(y=w>>>16&255))){if(0==(64&y)){w=g[(65535&w)+(p&(1<<y)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(x=65535&w,m<(y&=15)&&(p+=C[s++]<<m,(m+=8)<y&&(p+=C[s++]<<m,m+=8)),(x+=p&(1<<y)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=y,m-=y,x>(y=n-r)){if((y=x-y)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if($=0,k=h,0===d){if($+=u-y,y<_){_-=y;do{A[n++]=h[$++]}while(--y);$=n-x,k=A}}else if(d<y){if($+=u+d-y,(y-=d)<_){_-=y;do{A[n++]=h[$++]}while(--y);if($=0,d<_){_-=y=d;do{A[n++]=h[$++]}while(--y);$=n-x,k=A}}}else if($+=d-y,y<_){_-=y;do{A[n++]=h[$++]}while(--y);$=n-x,k=A}for(;_>2;)A[n++]=k[$++],A[n++]=k[$++],A[n++]=k[$++],_-=3;_&&(A[n++]=k[$++],_>1&&(A[n++]=k[$++]))}else{$=n-x;do{A[n++]=A[$++],A[n++]=A[$++],A[n++]=A[$++],_-=3}while(_>2);_&&(A[n++]=A[$++],_>1&&(A[n++]=A[$++]))}break}}break}}while(s<a&&n<o);s-=_=m>>3,p&=(1<<(m-=_<<3))-1,e.next_in=s,e.next_out=n,e.avail_in=s<a?a-s+5:5-(s-a),e.avail_out=n<o?o-n+257:257-(n-o),i.hold=p,i.bits=m}},{}],36:[function(e,t,i){"use strict";function s(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new p.Buf16(320),this.work=new p.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function n(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=F,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new p.Buf32(ue),t.distcode=t.distdyn=new p.Buf32(ce),t.sane=1,t.back=-1,k):D}function r(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,n(e)):D}function o(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?D:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,r(e))):D}function l(e,t){var i,s;return e?(s=new a,e.state=s,s.window=null,(i=o(e,t))!==k&&(e.state=null),i):D}function u(e){if(he){var t;for(d=new p.Buf32(512),h=new p.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(b(w,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;b(y,e.lens,0,32,h,0,e.work,{bits:5}),he=!1}e.lencode=d,e.lenbits=9,e.distcode=h,e.distbits=5}function c(e,t,i,s){var a,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new p.Buf8(n.wsize)),s>=n.wsize?(p.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((a=n.wsize-n.wnext)>s&&(a=s),p.arraySet(n.window,t,i-s,a,n.wnext),(s-=a)?(p.arraySet(n.window,t,i-s,s,0),n.wnext=s,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}var d,h,p=e("../utils/common"),m=e("./adler32"),f=e("./crc32"),g=e("./inffast"),b=e("./inftrees"),v=0,w=1,y=2,_=4,x=5,$=6,k=0,C=1,A=2,D=-2,E=-3,I=-4,S=-5,V=8,F=1,B=2,j=3,N=4,P=5,T=6,L=7,O=8,R=9,q=10,M=11,U=12,W=13,z=14,H=15,G=16,J=17,K=18,Q=19,Y=20,X=21,Z=22,ee=23,te=24,ie=25,se=26,ae=27,ne=28,re=29,oe=30,le=31,ue=852,ce=592,de=15,he=!0;i.inflateReset=r,i.inflateReset2=o,i.inflateResetKeep=n,i.inflateInit=function(e){return l(e,de)},i.inflateInit2=l,i.inflate=function(e,t){var i,a,n,r,o,l,d,h,ue,ce,de,he,pe,me,fe,ge,be,ve,we,ye,_e,xe,$e,ke,Ce=0,Ae=new p.Buf8(4),De=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return D;(i=e.state).mode===U&&(i.mode=W),o=e.next_out,n=e.output,d=e.avail_out,r=e.next_in,a=e.input,l=e.avail_in,h=i.hold,ue=i.bits,ce=l,de=d,xe=k;e:for(;;)switch(i.mode){case F:if(0===i.wrap){i.mode=W;break}for(;ue<16;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(2&i.wrap&&35615===h){i.check=0,Ae[0]=255&h,Ae[1]=h>>>8&255,i.check=f(i.check,Ae,2,0),h=0,ue=0,i.mode=B;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=oe;break}if((15&h)!==V){e.msg="unknown compression method",i.mode=oe;break}if(ue-=4,_e=8+(15&(h>>>=4)),0===i.wbits)i.wbits=_e;else if(_e>i.wbits){e.msg="invalid window size",i.mode=oe;break}i.dmax=1<<_e,e.adler=i.check=1,i.mode=512&h?q:U,h=0,ue=0;break;case B:for(;ue<16;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(i.flags=h,(255&i.flags)!==V){e.msg="unknown compression method",i.mode=oe;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=oe;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&(Ae[0]=255&h,Ae[1]=h>>>8&255,i.check=f(i.check,Ae,2,0)),h=0,ue=0,i.mode=j;case j:for(;ue<32;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}i.head&&(i.head.time=h),512&i.flags&&(Ae[0]=255&h,Ae[1]=h>>>8&255,Ae[2]=h>>>16&255,Ae[3]=h>>>24&255,i.check=f(i.check,Ae,4,0)),h=0,ue=0,i.mode=N;case N:for(;ue<16;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&(Ae[0]=255&h,Ae[1]=h>>>8&255,i.check=f(i.check,Ae,2,0)),h=0,ue=0,i.mode=P;case P:if(1024&i.flags){for(;ue<16;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&(Ae[0]=255&h,Ae[1]=h>>>8&255,i.check=f(i.check,Ae,2,0)),h=0,ue=0}else i.head&&(i.head.extra=null);i.mode=T;case T:if(1024&i.flags&&((he=i.length)>l&&(he=l),he&&(i.head&&(_e=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),p.arraySet(i.head.extra,a,r,he,_e)),512&i.flags&&(i.check=f(i.check,a,he,r)),l-=he,r+=he,i.length-=he),i.length))break e;i.length=0,i.mode=L;case L:if(2048&i.flags){if(0===l)break e;he=0;do{_e=a[r+he++],i.head&&_e&&i.length<65536&&(i.head.name+=String.fromCharCode(_e))}while(_e&&he<l);if(512&i.flags&&(i.check=f(i.check,a,he,r)),l-=he,r+=he,_e)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=O;case O:if(4096&i.flags){if(0===l)break e;he=0;do{_e=a[r+he++],i.head&&_e&&i.length<65536&&(i.head.comment+=String.fromCharCode(_e))}while(_e&&he<l);if(512&i.flags&&(i.check=f(i.check,a,he,r)),l-=he,r+=he,_e)break e}else i.head&&(i.head.comment=null);i.mode=R;case R:if(512&i.flags){for(;ue<16;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=oe;break}h=0,ue=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=U;break;case q:for(;ue<32;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}e.adler=i.check=s(h),h=0,ue=0,i.mode=M;case M:if(0===i.havedict)return e.next_out=o,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=h,i.bits=ue,A;e.adler=i.check=1,i.mode=U;case U:if(t===x||t===$)break e;case W:if(i.last){h>>>=7&ue,ue-=7&ue,i.mode=ae;break}for(;ue<3;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}switch(i.last=1&h,ue-=1,3&(h>>>=1)){case 0:i.mode=z;break;case 1:if(u(i),i.mode=Y,t===$){h>>>=2,ue-=2;break e}break;case 2:i.mode=J;break;case 3:e.msg="invalid block type",i.mode=oe}h>>>=2,ue-=2;break;case z:for(h>>>=7&ue,ue-=7&ue;ue<32;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=oe;break}if(i.length=65535&h,h=0,ue=0,i.mode=H,t===$)break e;case H:i.mode=G;case G:if(he=i.length){if(he>l&&(he=l),he>d&&(he=d),0===he)break e;p.arraySet(n,a,r,he,o),l-=he,r+=he,d-=he,o+=he,i.length-=he;break}i.mode=U;break;case J:for(;ue<14;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(i.nlen=257+(31&h),h>>>=5,ue-=5,i.ndist=1+(31&h),h>>>=5,ue-=5,i.ncode=4+(15&h),h>>>=4,ue-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=oe;break}i.have=0,i.mode=K;case K:for(;i.have<i.ncode;){for(;ue<3;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}i.lens[De[i.have++]]=7&h,h>>>=3,ue-=3}for(;i.have<19;)i.lens[De[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,$e={bits:i.lenbits},xe=b(v,i.lens,0,19,i.lencode,0,i.work,$e),i.lenbits=$e.bits,xe){e.msg="invalid code lengths set",i.mode=oe;break}i.have=0,i.mode=Q;case Q:for(;i.have<i.nlen+i.ndist;){for(;ge=(Ce=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,be=65535&Ce,!((fe=Ce>>>24)<=ue);){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(be<16)h>>>=fe,ue-=fe,i.lens[i.have++]=be;else{if(16===be){for(ke=fe+2;ue<ke;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(h>>>=fe,ue-=fe,0===i.have){e.msg="invalid bit length repeat",i.mode=oe;break}_e=i.lens[i.have-1],he=3+(3&h),h>>>=2,ue-=2}else if(17===be){for(ke=fe+3;ue<ke;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}ue-=fe,_e=0,he=3+(7&(h>>>=fe)),h>>>=3,ue-=3}else{for(ke=fe+7;ue<ke;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}ue-=fe,_e=0,he=11+(127&(h>>>=fe)),h>>>=7,ue-=7}if(i.have+he>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=oe;break}for(;he--;)i.lens[i.have++]=_e}}if(i.mode===oe)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=oe;break}if(i.lenbits=9,$e={bits:i.lenbits},xe=b(w,i.lens,0,i.nlen,i.lencode,0,i.work,$e),i.lenbits=$e.bits,xe){e.msg="invalid literal/lengths set",i.mode=oe;break}if(i.distbits=6,i.distcode=i.distdyn,$e={bits:i.distbits},xe=b(y,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,$e),i.distbits=$e.bits,xe){e.msg="invalid distances set",i.mode=oe;break}if(i.mode=Y,t===$)break e;case Y:i.mode=X;case X:if(l>=6&&d>=258){e.next_out=o,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=h,i.bits=ue,g(e,de),o=e.next_out,n=e.output,d=e.avail_out,r=e.next_in,a=e.input,l=e.avail_in,h=i.hold,ue=i.bits,i.mode===U&&(i.back=-1);break}for(i.back=0;ge=(Ce=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,be=65535&Ce,!((fe=Ce>>>24)<=ue);){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(ge&&0==(240&ge)){for(ve=fe,we=ge,ye=be;ge=(Ce=i.lencode[ye+((h&(1<<ve+we)-1)>>ve)])>>>16&255,be=65535&Ce,!(ve+(fe=Ce>>>24)<=ue);){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}h>>>=ve,ue-=ve,i.back+=ve}if(h>>>=fe,ue-=fe,i.back+=fe,i.length=be,0===ge){i.mode=se;break}if(32&ge){i.back=-1,i.mode=U;break}if(64&ge){e.msg="invalid literal/length code",i.mode=oe;break}i.extra=15&ge,i.mode=Z;case Z:if(i.extra){for(ke=i.extra;ue<ke;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,ue-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=ee;case ee:for(;ge=(Ce=i.distcode[h&(1<<i.distbits)-1])>>>16&255,be=65535&Ce,!((fe=Ce>>>24)<=ue);){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(0==(240&ge)){for(ve=fe,we=ge,ye=be;ge=(Ce=i.distcode[ye+((h&(1<<ve+we)-1)>>ve)])>>>16&255,be=65535&Ce,!(ve+(fe=Ce>>>24)<=ue);){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}h>>>=ve,ue-=ve,i.back+=ve}if(h>>>=fe,ue-=fe,i.back+=fe,64&ge){e.msg="invalid distance code",i.mode=oe;break}i.offset=be,i.extra=15&ge,i.mode=te;case te:if(i.extra){for(ke=i.extra;ue<ke;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,ue-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=oe;break}i.mode=ie;case ie:if(0===d)break e;if(he=de-d,i.offset>he){if((he=i.offset-he)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=oe;break}he>i.wnext?(he-=i.wnext,pe=i.wsize-he):pe=i.wnext-he,he>i.length&&(he=i.length),me=i.window}else me=n,pe=o-i.offset,he=i.length;he>d&&(he=d),d-=he,i.length-=he;do{n[o++]=me[pe++]}while(--he);0===i.length&&(i.mode=X);break;case se:if(0===d)break e;n[o++]=i.length,d--,i.mode=X;break;case ae:if(i.wrap){for(;ue<32;){if(0===l)break e;l--,h|=a[r++]<<ue,ue+=8}if(de-=d,e.total_out+=de,i.total+=de,de&&(e.adler=i.check=i.flags?f(i.check,n,de,o-de):m(i.check,n,de,o-de)),de=d,(i.flags?h:s(h))!==i.check){e.msg="incorrect data check",i.mode=oe;break}h=0,ue=0}i.mode=ne;case ne:if(i.wrap&&i.flags){for(;ue<32;){if(0===l)break e;l--,h+=a[r++]<<ue,ue+=8}if(h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=oe;break}h=0,ue=0}i.mode=re;case re:xe=C;break e;case oe:xe=E;break e;case le:return I;default:return D}return e.next_out=o,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=h,i.bits=ue,(i.wsize||de!==e.avail_out&&i.mode<oe&&(i.mode<ae||t!==_))&&c(e,e.output,e.next_out,de-e.avail_out)?(i.mode=le,I):(ce-=e.avail_in,de-=e.avail_out,e.total_in+=ce,e.total_out+=de,i.total+=de,i.wrap&&de&&(e.adler=i.check=i.flags?f(i.check,n,de,e.next_out-de):m(i.check,n,de,e.next_out-de)),e.data_type=i.bits+(i.last?64:0)+(i.mode===U?128:0)+(i.mode===Y||i.mode===H?256:0),(0===ce&&0===de||t===_)&&xe===k&&(xe=S),xe)},i.inflateEnd=function(e){if(!e||!e.state)return D;var t=e.state;return t.window&&(t.window=null),e.state=null,k},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?D:(i.head=t,t.done=!1,k):D},i.inflateSetDictionary=function(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==M?D:i.mode===M&&m(1,t,s,0)!==i.check?E:c(e,t,s,s)?(i.mode=le,I):(i.havedict=1,k):D},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":28,"./adler32":30,"./crc32":32,"./inffast":35,"./inftrees":37}],37:[function(e,t,i){"use strict";var s=e("../utils/common"),a=15,n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,u,c,d,h,p){var m,f,g,b,v,w,y,_,x,$=p.bits,k=0,C=0,A=0,D=0,E=0,I=0,S=0,V=0,F=0,B=0,j=null,N=0,P=new s.Buf16(16),T=new s.Buf16(16),L=null,O=0;for(k=0;k<=a;k++)P[k]=0;for(C=0;C<u;C++)P[t[i+C]]++;for(E=$,D=a;D>=1&&0===P[D];D--);if(E>D&&(E=D),0===D)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(A=1;A<D&&0===P[A];A++);for(E<A&&(E=A),V=1,k=1;k<=a;k++)if(V<<=1,(V-=P[k])<0)return-1;if(V>0&&(0===e||1!==D))return-1;for(T[1]=0,k=1;k<a;k++)T[k+1]=T[k]+P[k];for(C=0;C<u;C++)0!==t[i+C]&&(h[T[t[i+C]]++]=C);if(0===e?(j=L=h,w=19):1===e?(j=n,N-=257,L=r,O-=257,w=256):(j=o,L=l,w=-1),B=0,C=0,k=A,v=d,I=E,S=0,g=-1,b=(F=1<<E)-1,1===e&&F>852||2===e&&F>592)return 1;for(;;){y=k-S,h[C]<w?(_=0,x=h[C]):h[C]>w?(_=L[O+h[C]],x=j[N+h[C]]):(_=96,x=0),m=1<<k-S,A=f=1<<I;do{c[v+(B>>S)+(f-=m)]=y<<24|_<<16|x|0}while(0!==f);for(m=1<<k-1;B&m;)m>>=1;if(0!==m?(B&=m-1,B+=m):B=0,C++,0==--P[k]){if(k===D)break;k=t[i+h[C]]}if(k>E&&(B&b)!==g){for(0===S&&(S=E),v+=A,V=1<<(I=k-S);I+S<D&&!((V-=P[I+S])<=0);)I++,V<<=1;if(F+=1<<I,1===e&&F>852||2===e&&F>592)return 1;c[g=B&b]=E<<24|I<<16|v-d|0}}return 0!==B&&(c[v+B]=k-S<<24|64<<16|0),p.bits=E,0}},{"../utils/common":28}],38:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],39:[function(e,t,i){"use strict";function s(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e,t,i,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}function n(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function r(e){return e<256?J[e]:J[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,i){e.bi_valid>P-i?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>P-e.bi_valid,e.bi_valid+=i-P):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function u(e,t,i){l(e,i[2*t],i[2*t+1])}function c(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function d(e,t,i){var s,a,n=new Array(N+1),r=0;for(s=1;s<=N;s++)n[s]=r=r+i[s-1]<<1;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=c(n[o]++,o))}}function h(e){var t;for(t=0;t<V;t++)e.dyn_ltree[2*t]=0;for(t=0;t<F;t++)e.dyn_dtree[2*t]=0;for(t=0;t<B;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*L]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function p(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function m(e,t,i,s){var a=2*t,n=2*i;return e[a]<e[n]||e[a]===e[n]&&s[t]<=s[i]}function f(e,t,i){for(var s=e.heap[i],a=i<<1;a<=e.heap_len&&(a<e.heap_len&&m(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!m(t,s,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=s}function g(e,t,i){var s,a,n,o,c=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],a=e.pending_buf[e.l_buf+c],c++,0===s?u(e,a,t):(u(e,(n=K[a])+S+1,t),0!==(o=M[n])&&l(e,a-=Q[n],o),u(e,n=r(--s),i),0!==(o=U[n])&&l(e,s-=Y[n],o))}while(c<e.last_lit);u(e,L,t)}function b(e,t){var i,s,a,n=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=j,i=0;i<l;i++)0!==n[2*i]?(e.heap[++e.heap_len]=u=i,e.depth[i]=0):n[2*i+1]=0;for(;e.heap_len<2;)n[2*(a=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[a]=0,e.opt_len--,o&&(e.static_len-=r[2*a+1]);for(t.max_code=u,i=e.heap_len>>1;i>=1;i--)f(e,n,i);a=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],f(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,n[2*a]=n[2*i]+n[2*s],e.depth[a]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,n[2*i+1]=n[2*s+1]=a,e.heap[1]=a++,f(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,s,a,n,r,o,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,m=t.stat_desc.max_length,f=0;for(n=0;n<=N;n++)e.bl_count[n]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<j;i++)(n=l[2*l[2*(s=e.heap[i])+1]+1]+1)>m&&(n=m,f++),l[2*s+1]=n,s>u||(e.bl_count[n]++,r=0,s>=p&&(r=h[s-p]),o=l[2*s],e.opt_len+=o*(n+r),d&&(e.static_len+=o*(c[2*s+1]+r)));if(0!==f){do{for(n=m-1;0===e.bl_count[n];)n--;e.bl_count[n]--,e.bl_count[n+1]+=2,e.bl_count[m]--,f-=2}while(f>0);for(n=m;0!==n;n--)for(s=e.bl_count[n];0!==s;)(a=e.heap[--i])>u||(l[2*a+1]!==n&&(e.opt_len+=(n-l[2*a+1])*l[2*a],l[2*a+1]=n),s--)}}(e,t),d(n,u,e.bl_count)}function v(e,t,i){var s,a,n=-1,r=t[1],o=0,l=7,u=4;for(0===r&&(l=138,u=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)a=r,r=t[2*(s+1)+1],++o<l&&a===r||(o<u?e.bl_tree[2*a]+=o:0!==a?(a!==n&&e.bl_tree[2*a]++,e.bl_tree[2*O]++):o<=10?e.bl_tree[2*R]++:e.bl_tree[2*q]++,o=0,n=a,0===r?(l=138,u=3):a===r?(l=6,u=3):(l=7,u=4))}function w(e,t,i){var s,a,n=-1,r=t[1],o=0,c=7,d=4;for(0===r&&(c=138,d=3),s=0;s<=i;s++)if(a=r,r=t[2*(s+1)+1],!(++o<c&&a===r)){if(o<d)do{u(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==n&&(u(e,a,e.bl_tree),o--),u(e,O,e.bl_tree),l(e,o-3,2)):o<=10?(u(e,R,e.bl_tree),l(e,o-3,3)):(u(e,q,e.bl_tree),l(e,o-11,7));o=0,n=a,0===r?(c=138,d=3):a===r?(c=6,d=3):(c=7,d=4)}}function y(e,t,i,s){l(e,(A<<1)+(s?1:0),3),function(e,t,i,s){p(e),s&&(o(e,i),o(e,~i)),_.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}var _=e("../utils/common"),x=4,$=0,k=1,C=2,A=0,D=1,E=2,I=29,S=256,V=S+1+I,F=30,B=19,j=2*V+1,N=15,P=16,T=7,L=256,O=16,R=17,q=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(V+2));s(H);var G=new Array(2*F);s(G);var J=new Array(512);s(J);var K=new Array(256);s(K);var Q=new Array(I);s(Q);var Y=new Array(F);s(Y);var X,Z,ee,te=!1;i._tr_init=function(e){te||(function(){var e,t,i,s,n,r=new Array(N+1);for(i=0,s=0;s<I-1;s++)for(Q[s]=i,e=0;e<1<<M[s];e++)K[i++]=s;for(K[i-1]=s,n=0,s=0;s<16;s++)for(Y[s]=n,e=0;e<1<<U[s];e++)J[n++]=s;for(n>>=7;s<F;s++)for(Y[s]=n<<7,e=0;e<1<<U[s]-7;e++)J[256+n++]=s;for(t=0;t<=N;t++)r[t]=0;for(e=0;e<=143;)H[2*e+1]=8,e++,r[8]++;for(;e<=255;)H[2*e+1]=9,e++,r[9]++;for(;e<=279;)H[2*e+1]=7,e++,r[7]++;for(;e<=287;)H[2*e+1]=8,e++,r[8]++;for(d(H,V+1,r),e=0;e<F;e++)G[2*e+1]=5,G[2*e]=c(e,5);X=new a(H,M,S+1,V,N),Z=new a(G,U,0,F,N),ee=new a(new Array(0),W,0,B,T)}(),te=!0),e.l_desc=new n(e.dyn_ltree,X),e.d_desc=new n(e.dyn_dtree,Z),e.bl_desc=new n(e.bl_tree,ee),e.bi_buf=0,e.bi_valid=0,h(e)},i._tr_stored_block=y,i._tr_flush_block=function(e,t,i,s){var a,n,r=0;e.level>0?(e.strm.data_type===C&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return $;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return k;for(t=32;t<S;t++)if(0!==e.dyn_ltree[2*t])return k;return $}(e)),b(e,e.l_desc),b(e,e.d_desc),r=function(e){var t;for(v(e,e.dyn_ltree,e.l_desc.max_code),v(e,e.dyn_dtree,e.d_desc.max_code),b(e,e.bl_desc),t=B-1;t>=3&&0===e.bl_tree[2*z[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=a&&(a=n)):a=n=i+5,i+4<=a&&-1!==t?y(e,t,i,s):e.strategy===x||n===a?(l(e,(D<<1)+(s?1:0),3),g(e,H,G)):(l(e,(E<<1)+(s?1:0),3),function(e,t,i,s){var a;for(l(e,t-257,5),l(e,i-1,5),l(e,s-4,4),a=0;a<s;a++)l(e,e.bl_tree[2*z[a]+1],3);w(e,e.dyn_ltree,t-1),w(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),g(e,e.dyn_ltree,e.dyn_dtree)),h(e),s&&p(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(K[i]+S+1)]++,e.dyn_dtree[2*r(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){l(e,D<<1,3),u(e,L,H),function(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":28}],40:[function(e,t,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)},6700:(e,t,i)=>{var s={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":1793,"./ru.js":1793,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function a(e){var t=n(e);return i(t)}function n(e){if(!i.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}a.keys=function(){return Object.keys(s)},a.resolve=n,e.exports=a,a.id=6700},9391:e=>{e.exports=class{get key(){return"activelist"}constructor(e,t){e.Label,e.labels,e.unique(this.key);var i={name:this.key};this.view=this.key,this._logic={},webix.protoUI(i,webix.ui.list,webix.ActiveContent)}}},183:e=>{e.exports=class{get key(){return"countfooter"}constructor(e,t){e.Label,this.view=this.key,this._logic={},webix.ui.datafilter.countColumn=webix.extend({refresh:function(e,t,i){var s=0;(e.find({})||[]).forEach((e=>{if(null!=e){var t=e[i.columnId]||e[i.columnId+"__relation"];t&&Array.isArray(t)?s+=t.length:null!=t&&""!=t&&0!=t&&"false"!=t&&"0"!=t&&(s+=1)}})),t.innerHTML=s}},webix.ui.datafilter.summColumn)}}},2864:(e,t,i)=>{var s=[i(9391),i(183),i(8362),i(6944),i(511),i(1471),i(6562),i(7272),i(9008),i(4756),i(7943),i(4603),i(5835)];e.exports=class{constructor(){}initComponents(e){e.custom=e.custom||{},s.forEach((t=>{var i=new t(e);e.custom[i.key]=i})),e.AB.custom=e.custom}}},8362:e=>{e.exports=class{get key(){return"datetimepicker"}constructor(e){e.Label,e.labels,e.unique(this.key),e.unique("custom_datetimepicker"),this.view=this.key,this._logic={},webix.editors.$popup.datetime={view:"popup",width:250,height:250,padding:0,body:{view:"calendar",icons:!0,borderless:!0,timepicker:!0}},webix.editors.datetime=webix.extend({popupType:"datetime"},webix.editors.date)}}},6944:e=>{e.exports=class{get key(){return"editlist"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key};this.view=this.key,this._logic={},webix.protoUI(t,webix.EditAbility,webix.ui.list)}}},511:e=>{e.exports=class{get key(){return"edittree"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key};this.view=this.key,this._logic={},webix.protoUI(t,webix.EditAbility,webix.ui.tree)}}},1471:e=>{e.exports=class{get key(){return"editunitlist"}constructor(e){var t={name:this.key};this.view=this.key,this._logic={},webix.protoUI(t,webix.EditAbility,webix.ui.unitlist)}}},6562:e=>{e.exports=class{get key(){return"focusabletemplate"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key,focus:function(){return!1}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.template,webix.UIManager)}}},7272:e=>{e.exports=class{get key(){return"formiobuilder"}constructor(e){e.Label,e.labels,e.unique(this.key);var t,i={name:this.key,defaults:{css:"scrolly forceOpen",hidden:!1,autofit:!0},$init:function(e){var i=s.parseDataFields(e.dataFields),a=e.formComponents?e.formComponents:{};Formio.builder(this.$view,a,{builder:{basic:!1,advanced:!1,customBasic:!1,premium:!1,custom:{title:"Fields",weight:0,default:!0,components:i},layout:{components:{table:!0}}}}).then((function(e){t=e}))},getFormData:()=>t.schema};this.view=this.key;var s={parseDataFields:e=>{var t={};return e.forEach((e=>{if(e.field)switch(e.field.key){case"boolean":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"checkbox",disabled:!0,key:e.key,_key:e.key,input:!0}};break;case"calculate":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"textfield",key:e.key,_key:e.key,input:!0,inputType:"text",disabled:!0,calculateValue:"value = "+e.field.settings.formula.replace(/{/g,"data['").replace(/}/g,"']")}};break;case"connectObject":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"textfield",key:e.key,_key:e.key,input:!0,inputType:"text",disabled:!0,calculateValue:`value = data['${e.key}.format']`}};break;case"date":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"datetime",disabled:!0,key:e.key,_key:e.key,input:!0,format:1==e.field.settings.timeFormat?"MMMM d, yyyy":"MMMM d, yyyy h:mm a"}};break;case"email":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,disabled:!0,type:"email",key:e.key,_key:e.key,input:!0}};break;case"file":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"htmlelement",tag:"a",className:"btn btn-primary btn-block",content:"<i class='fa fa-paperclip'></i>  {{JSON.parse(data['"+e.key+"']).filename}}",attrs:[{attr:"href",value:"/opsportal/file/"+e.field.object.application.name+"/{{JSON.parse(data['"+e.key+"']).uuid}}"},{attr:"target",value:"_blank"}],refreshOnChange:!0,key:e.key,_key:e.key,disabled:!0,input:!1}};break;case"image":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"htmlelement",tag:"img",className:"img-thumbnail max100",content:"",attrs:[{attr:"src",value:"/opsportal/image/"+e.field.object.application.name+"/{{data['"+e.key+"']}}"}],refreshOnChange:!0,key:e.key,_key:e.key,input:!1}};break;case"list":var i=[];e.field.settings.options.forEach((e=>{i.push({label:e.text,value:e.id})})),t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"select",key:e.key,_key:e.key,disabled:!0,input:!0,data:{values:i},multiple:e.field.settings.isMultiple}};break;case"LongText":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"textarea",disabled:!0,key:e.key,_key:e.key,input:!0}};break;case"number":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,disabled:!0,type:"number",key:e.key,_key:e.key,input:!0}};break;case"TextFormula":t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"textfield",key:e.key,_key:e.key,input:!0,inputType:"text",disabled:!0,calculateValue:"value = '"+e.field.settings.textFormula+"'"}};break;default:t[e.key]={title:e.label,key:e.key,icon:e.field.icon,schema:{abFieldID:e.field.id,label:e.field.label,type:"textfield",disabled:!0,key:e.key,_key:e.key,input:!0}}}})),t.approveButton={title:"Approve Button",key:"approve",icon:"check-square",schema:{label:"Approve",type:"button",key:"approve",event:"approve",block:!0,size:"lg",input:!1,leftIcon:"fa fa-thumbs-up",action:"event",theme:"success"}},t.denyButton={title:"Deny Button",key:"deny",icon:"ban",schema:{label:"Deny",type:"button",key:"deny",event:"deny",block:!0,size:"lg",input:!1,leftIcon:"fa fa-thumbs-down",action:"event",theme:"danger"}},t.customButton={title:"Custom Action Button",key:"custom",icon:"cog",schema:{label:"Custom Name",type:"button",key:"custom",event:"yourEvent",block:!0,size:"lg",input:!1,leftIcon:"fa fa-cog",action:"event",theme:"primary"}},t}};this._logic=s,webix.protoUI(i,webix.ui.popup)}}},9008:(e,t,i)=>{var s=i(3686);e.exports=class extends s{get key(){return"formiopreview"}constructor(e){super(),e.Label,e.labels,e.unique(this.key);var t={name:this.key,defaults:{css:"scrolly",borderless:!0},$init:function(e){var t=e.formComponents?e.formComponents:{},i=e.formData?e.formData:{};for(var s in i)if(Array.isArray(i[s])&&"object"==typeof i[s][0]){var a=[];i[s].forEach((e=>{e.id&&a.push(e.id)})),i[s]=a}Formio.createForm(this.$view,t,{}).then((function(s){s.submission={data:i},(t.components||[]).forEach((t=>{"button"==t.type&&"event"==t.action&&t.event&&s.once(t.event,(function(i){e.onButton&&e.onButton(t.event)}))}))}))}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.view)}}},4756:e=>{e.exports=class{get key(){return"numbertext"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key,defaults:{css:"webix_el_text"},$getValue:function(){var e=this.getInputNode().value;return e?JSON.parse(e):""}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.text)}}},7943:e=>{e.exports=class{get key(){return"timepicker"}constructor(e){e.Label,e.labels,e.unique(this.key),e.unique("custom_timepicker"),this.view=this.key,this._logic={},webix.editors.$popup.time={view:"popup",body:{view:"calendar",width:220,height:200,type:"time"}},webix.editors.time=webix.extend({popupType:"time"},webix.editors.date)}}},4603:e=>{e.exports=class{get key(){return"totalfooter"}constructor(e,t){e.Label,this.view=this.key,this._logic={},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var s=0;e.eachRow((function(t){var a=e.getItem(t),n=i.field.format(a);n&&(s+=parseFloat(n))})),t.innerHTML=s}},webix.ui.datafilter.summColumn)}}},5835:e=>{e.exports=class{get key(){return"treesuggest"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key,defaults:{type:"tree",width:0,body:{borderless:!0,select:!0,template:function(e,t){return"<span>"+(e.$count?"<b>"+e.value+"</b>":e.value)+"</span>"},ready:function(){this.openAll()},on:{onAfterSelect:function(e,t){this.getItem(e).$count&&(this.getParentView().setMasterValue(""),this.show($$(this.getParentView().config.master).getInputNode()))}}}}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.suggest)}}}}]);
//# sourceMappingURL=236.1ea40836572f117bc9fb.js.map