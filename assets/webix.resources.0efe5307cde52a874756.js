/*! For license information please see webix.resources.0efe5307cde52a874756.js.LICENSE.txt */
!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="7bd0e410-8fee-4f6a-8af1-7cec5515e80b",t._sentryDebugIdIdentifier="sentry-dbid-7bd0e410-8fee-4f6a-8af1-7cec5515e80b")}catch(t){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"f9318650996ef363cc662a072d926d590b2107f6"},(self.webpackChunkab_platform_web=self.webpackChunkab_platform_web||[]).push([[761],{49706:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=49706,t.exports=e},67468:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=67468,t.exports=e},97935:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=97935,t.exports=e},86993:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=86993,t.exports=e},18473:function(t,e,i){!function(t){"use strict";var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function n(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},a=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],a={},o=r.indexOf(":");if(-1===o&&(o=r.indexOf("?")),-1!==o)for(var s=0,l=r.substr(o+1).split(/[\:\?\&]/g);s<l.length;s++){var u=l[s].split("=");a[u[0]]=decodeURIComponent(u[1])}i[n]={page:o>-1?r.substr(0,o):r,params:a,isNew:!0}}return i}function l(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var a=u(r.params);a&&e.push("?"+a)}return e.join("")}function u(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var c=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=l(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var a=0;a<i.length;a++)n[a]&&(i[a].view=n[a].view),r&&n[a]&&i[a].page===n[a].page?i[a].isNew=!1:i[a].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=l(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var o=l(r),s={url:r,redirect:o,confirm:Promise.resolve()},u=e?e.app:null;!u||u.callEvent("app:guard",[s.redirect,e,s])?s.confirm.catch((function(t){return i(t)})).then((function(){if(null!==s.redirect){if(s.redirect!==o)return u.show(s.redirect),void i(new a);n.route.path=o,n.route.url=r,t()}else i(new a)})):i(new a)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=l(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=l(this.route.url)},t}(),h=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return n(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof o?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new c(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,a=null,o=!1;if(this._container.tagName?a=this._container:(r=this._container).popup?(a=document.body,o=!0):a=this.webix.$$(r.id),!this.app||!a)return Promise.reject(null);var s=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!o){var u=a,c=u.getParentView();c&&"multiview"===c.name&&!l.ui.id&&(l.ui.id=u.config.id)}this._root=this.app.webix.ui(l.ui,a);var h=this._root;o&&h.setPosition&&!h.isVisible()&&h.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var a=e.view;if(!a&&e.url){if("string"==typeof e.url)return e.route=new c(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||a instanceof e.url||(a=new(this.app._override(e.url))(this.app,"")),a||(a=e.url)}if(a)return a.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),p=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return n(e,t),e.prototype.config=function(){return this._ui},e}(h),d=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,g=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return n(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var a=t[r];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[r]=a;else if(a instanceof Date)e[r]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(n?e.push(s):e[r]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:d});if(t.prototype instanceof o)return new t(this,{name:i,params:n});t=t(this)}return t instanceof o?t:new p(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;this.$router?r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new c(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var a=i?i.params:this.config.params||null,o=this.getSubView(),s=this._subSegment,l=s.show({url:r,params:a},o).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new h(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof a))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new c(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new c(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),v=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),m=!1;function w(t){if(!m&&t){m=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,a={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var a=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var o in r)a(o);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,a,!0),t.extend(t.ui.baselayout.prototype,a,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var _=function(t){function e(e){var i;return e.router=e.router||v,w((i=t.call(this,e)||this).webix),i}return n(e,t),e.prototype.require=function(t,e){return i(49706)(t+"/"+e)},e}(g),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function x(t,e,i){for(var n in t)b(t,n)&&e.call(i||t,t[n],n,t)}function S(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var $=String.prototype.replace,C=String.prototype.split,k=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},D={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:k,chinese:function(){return 0},croatian:k,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:k,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},T={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function E(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var L=/\$/g,A=/%\{(.*?)\}/g;function I(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,a=n||A,o="number"==typeof e?{smart_count:e}:e;if(null!=o.smart_count&&r){var s=C.call(r,"||||");r=(s[function(t,e){return D[function(t){var e,i=(e={},x(T,(function(t,i){x(t,(function(t){e[t]=i}))})),e);return i[t]||i[C.call(t,/-/,1)[0]]||i.en}(t)](e)}(i||"en",o.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return $.call(r,a,(function(t,e){return b(o,e)&&null!=o[e]?$.call(o[e],L,"$$"):t}))}function P(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?I:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||S,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(E(e)+"(.*?)"+E(i),"g")}(e.interpolation)}P.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},P.prototype.extend=function(t,e){x(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},P.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:x(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},P.prototype.clear=function(){this.phrases={}},P.prototype.replace=function(t){this.clear(),this.extend(t)},P.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=I(i,r,this.currentLocale,this.tokenRegex)),n},P.prototype.has=function(t){return b(this.phrases,t)},P.transformPhrase=function(t,e,i){return I(t,e,i)};var R=P,M=window.webix;M&&w(M);var V=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function a(e,a,o){a.__esModule&&(a=a.default);var l={phrases:a};i.polyglot&&t.webix.extend(l,i.polyglot);var u=s.polyglot=new R(l);if(u.locale(e),s._=t.webix.bind(u.t,u),r=e,n&&n.put("lang",r),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return o?Promise.resolve():t.refresh()}function o(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;a(e,t.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:o,setLangData:a,_:null,polyglot:null};t.setService("locale",s),o(r,!0)},O=window;O.Promise||(O.Promise=O.webix.promise);var F=!1;function H(t,e,i){var n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}var B=1;function U(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function N(t,e){e=e||{};var i={},n={},r=function(t,e){var r=B++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},a=[],o=!1,s=function(t,e,n,r){if(o)a.push([t,e,n,r]);else for(var s=Object.keys(i),l=0;l<s.length;l++){var u=i[s[l]];u&&("*"!==u.mask&&u.mask!==t||u.handler(n,e,t,r))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(o=!0,t(n),o=!1;a.length;){var i=a.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var r in i=i||e,t)if(t.hasOwnProperty(r)){var a=t[r];i.nested&&"object"==typeof a&&a?n[r]=N(a,i):j(n,a,r,s)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function j(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}var G={start:function(t,e){t._auto_scroll_delay=webix.delay(G.autoScroll,t,[e,webix.html.pos(e)],250)},reset:function(t){t._auto_scroll_delay&&(t._auto_scroll_delay=window.clearTimeout(t._auto_scroll_delay))},autoScroll:function(t,e){var i=-1!==this.direction.indexOf("y"),n=-1!==this.direction.indexOf("x"),r=webix.html.offset(this.from.$view),a=!1;i&&G.autoYScroll.call(this,e,r,this.senseY)&&(a=!0),n&&G.autoXScroll.call(this,e,r,this.senseX)&&(a=!0),a&&(function(t,e){if(webix.DragControl.active){var i=webix.DragControl.getNode();e=webix.copy(e),webix.DragControl.$dragPos(e,t),i.style.top=e.y+webix.DragControl.top+"px",i.style.left=e.x+webix.DragControl.left+"px"}}(t,e),this._auto_scroll_delay=webix.delay(G.autoScroll,this,[t,e],100))},autoYScroll:function(t,e,i){var n=this.from.getScrollState();return t.y<e.y+i?G.autoScrollTo.call(this,n.x,n.y-i,"y"):t.y>e.y+e.height-i&&G.autoScrollTo.call(this,n.x,n.y+i,"y")},autoXScroll:function(t,e,i){var n=this.from.getScrollState();if(t.x<e.x+i)return G.autoScrollTo.call(this,n.x-i,n.y,"x");if(t.x>e.x+e.width-i){var r=this.snode?Math.min(n.x+i,this.snode.scrollWidth-e.width):n.x+i;return r!=n.x&&G.autoScrollTo.call(this,r,n.y,"x")}return!1},autoScrollTo:function(t,e,i){this.from.scrollTo(t,e),this.from.callEvent("onAfterAutoScroll",[]);var n=this.from.getScrollState();return Math.abs(("x"===i?t:e)-n[i])<1}};function Y(t){var e=webix.copy(q);e.view=t,e.master=this,e.Local=this.app.getService("local"),webix.DragControl.addDrag(t.$view,e),webix.DragControl.addDrop(t.$view,e,!0)}function z(t,e){var i=t.getBoundingClientRect(),n=(e-i.left)/i.width,r=webix.env.touch?400:200,a=.2/(i.width>r?i.width/r:1);return n<a?"start":n>1-a?"end":"move"}function W(t){var e=this.Local.getScales();return t.senseX=Math.round(e.cellWidth*(webix.env.touch?1:.5)),t.senseY=Math.round(e.cellHeight*(webix.env.touch?3:1)),t}var q={$longTouchLimit:!0,$dragCreate:function(t,e,i){if(this.master.State.readonly)return!1;var n=this.getContext();n.$touch="touch"===i;var r=this.locateEvent(e);if(r){var a=this.view.getItem(r);if(a.$group)return!1;var o=e.target;if(o.classList.contains("webix_gantt_link"))return n.mode="links",X[n.mode].$dragCreate.call(this,t,e,r);var s=this.view.getItemNode(r);if(!n.$touch&&function(t,e){for(;t!=e;){if(t.classList.contains("webix_gantt_progress_drag"))return!0;t=t.parentNode}return!1}(o,s))return n.mode="progress",X[n.mode].$dragCreate.call(this,t,e,r);var l=this.view.getScrollState(),u=this.getEventContext(e,n),c=z(s,u.x);"task"==a.type||"start"!=c&&"end"!=c||(c="move");var h=this.Local.getScales(),p=h.cellWidth;if(h.precise){var d=this.master.app.getService("helpers").getSmallerCount(h.minUnit);p=Math.round(p/("number"==typeof d?d:d()))}if(webix.extend(n,{id:r,mode:c,node:s,step:p,dx:0,from:this.view,snode:t.querySelector(".webix_scroll_cont"),x:u.x,scroll:l,t:parseInt(s.style.top),l:parseInt(s.style.left),w:parseInt(s.style.width)},!0),!this.master.app.callEvent("bars:beforedrag",[a,n]))return!1;X[n.mode].dragScroll&&webix.extend(n,W.call(this,X[n.mode].dragScroll));var f=s.cloneNode(!0);return f.className+=" webix_drag_zone webix_gantt_mode_"+c,s.style.visibility="hidden",webix.html.addCss(t,"webix_gantt_in_action",!0),t.style.cursor="move"==c?"move":"ew-resize",t.appendChild(f),f}return!(!this.master.app.config.split||"resources"===this.master.State.display||e.target!=t)&&(n.mode="split",X[n.mode].$dragCreate.call(this,t,e))},$dragDestroy:function(t,e){var i=this,n=this.getContext();return X[n.mode].dragScroll&&G.reset(n),n.mode&&X[n.mode].$dragDestroy?X[n.mode].$dragDestroy.call(this,t,e):(n.$waitUpdate?n.$waitUpdate.catch((function(){i.master.Action({action:"update-task-time",id:n.id})})):n.$waitUpdate=this.master.Action({action:"update-task-time",id:n.id}),n.$waitUpdate.finally((function(){n.node.style.visibility="",webix.html.remove(e),i.master.app.config.split&&n.id&&i.master.Action({action:"split-resize",id:n.id})})),t.style.cursor="",webix.html.removeCss(t,"webix_gantt_in_action"),!1)},$dragIn:function(t,e,i){var n=this.getContext();return!!n.mode&&(X[n.mode].dragScroll&&(G.reset(n),G.start(n,i)),!X[n.mode].$dragIn||X[n.mode].$dragIn.call(this,t,e,i))},$dragPos:function(t){var e=this.getContext();return X[e.mode].$dragPos.call(this,t)},$dragOut:function(t,e,i,n){var r=this.getContext();return X[r.mode].$dragOut?X[r.mode].$dragOut.call(this,t,e,i,n):null},$drop:function(t,e,i){var n=this.getContext();if(!n.mode)return!1;if(X[n.mode].$drop)return X[n.mode].$drop.call(this,t,e,i);var r=n.id,a=n.mode,o=n.dx,s=n.step,l=Math.round(o/s);if(n.timeShift=l,!this.master.app.callEvent("bars:beforedrop",[this.view.getItem(n.id),n]))return!1;n.$waitUpdate=this.master.Action({action:"update-task-time",mode:a,time:l,id:r})},locateEvent:function(t,e){return e&&(t=document.elementFromPoint(e.x,e.y)),webix.html.locate(t,"webix_l_id")},getEventContext:function(t,e){if(e.$touch){if(t.changedTouches&&(!t.touches||!t.touches[0])){var i=t.changedTouches[0];return{x:i.pageX,y:i.pageY}}return t.time?t:webix.env.touch.context(t)}return{x:t.clientX,y:t.clientY}},getContext:function(){return webix.DragControl.getContext()},setDragOffset:function(t,e,i){var n=this.getContext(),r=webix.html.pos(i),a=webix.html.offset(t);n.width=a.width,n.height=a.height,n.x_offset=a.x-r.x,n.y_offset=a.y-r.y}},K={$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState(),n=webix.DragControl.getNode(),r=e.mode,a=e.l,o=e.t,s=e.w,l=e.x,u=e.id,c=e.scroll,h=e.step,p=e.dx=t.x-l-c.x+i.x;"start"===r?(t.x=Math.min(a+p,a+s-h),n.style.width=Math.max(s-p,h)+"px"):"end"===r&&(t.x=a,n.style.width=Math.max(s+p,h)+"px"),t.y=o,this.master.Action({action:"drag-task",id:u,left:t.x,width:parseInt(n.style.width)}),this.master.app.config.split&&this.master.Action({action:"split-resize",id:u})}},X={links:{dragScroll:{direction:"xy"},$dragCreate:function(t,e,i){var n=this.getContext(),r=e.target,a=this.view.getItemNode(i),o=this.view.getScrollState(),s=webix.html.offset(r),l=r.classList;if(webix.extend(n,{id:i,from:this.view,node:a,link:r,fromStart:l.contains("webix_gantt_link_left"),start:{x:s.x+s.width/2+o.x,y:s.y+s.height/2+o.y}},!0),!this.master.app.callEvent("bars:beforedrag",[this.view.getItem(i),n]))return!1;X[n.mode].dragScroll&&webix.extend(n,W.call(this,X[n.mode].dragScroll)),r.style.opacity=1,webix.html.addCss(a,"webix_gantt_task_in_action",!0);var u=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(u),u},$dragDestroy:function(t,e){var i=this.getContext();if(this.master.Action({action:"temp-link"}),i.target){var n=this.view.getItemNode(i.target);webix.html.removeCss(n,"webix_gantt_link_visible")}return i.link.style.opacity="",webix.html.removeCss(i.node,"webix_gantt_task_in_action"),webix.html.remove(e),!1},$dragIn:function(t,e,i){var n=this.getContext(),r=this.getEventContext(i,n),a=this.locateEvent(i,n.$touch?r:null);if(!a)return!1;var o=this.view.getItemNode(a);return a!=n.target&&(webix.html.addCss(o,"webix_gantt_link_visible",!0),n.target=a),o},$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState();e.end={x:t.x+i.x,y:t.y+i.y},this.master.Action({action:"temp-link",start:e.start,end:e.end})},$dragOut:function(t,e,i,n){var r=this.getContext(),a=this.getEventContext(n,r),o=this.locateEvent(n,r.$touch?a:null);if(r.target&&o!=r.target){var s=this.view.getItemNode(r.target);webix.html.removeCss(s,"webix_gantt_link_visible"),r.target=null}return null},$drop:function(t,e,i){var n=this.getContext(),r=n.id,a=this.getEventContext(i,n),o=this.locateEvent(i,n.$touch?a:null);if(!o||r==o)return!1;var s=this.view.getItemNode(o).getBoundingClientRect(),l=a.x-s.left<s.width/2,u=n.linkType=(n.fromStart?1:0)+(l?0:2);n.targetId=o,this.master.app.callEvent("bars:beforedrop",[this.view.getItem(r),n])&&this.master.Action({action:"add-link",source:r,target:o,type:u})}},move:{dragScroll:{direction:"x"},$dragPos:function(t){var e=this.getContext(),i=e.node,n=e.l,r=e.t,a=e.x,o=e.id,s=e.scroll,l=this.view.getScrollState(),u=e.dx=t.x-a-s.x+l.x;t.x=n+u,t.y=r,this.master.Action({action:"drag-task",id:o,left:t.x,width:parseInt(i.style.width)}),this.master.app.config.split&&this.master.Action({action:"split-resize",id:o})}},progress:{$dragCreate:function(t,e,i){var n=this.getContext(),r=this.view.getItemNode(i),a=this.view.getItem(i).progress,o=r.querySelector(".webix_gantt_progress"),s=this.getEventContext(e,n),l=this.view.getScrollState();if(webix.extend(n,{id:i,node:r,prevProgress:a,progressNode:o,from:this.view,x:s.x,w:parseInt(r.style.width),scroll:l},!0),!this.master.app.callEvent("bars:beforedrag",[this.view.getItem(i),n]))return!1;t.style.cursor="ew-resize",webix.html.addCss(t,"webix_gantt_in_action",!0),webix.html.addCss(r,"webix_gantt_mode_progress",!0);var u=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(u),u},$dragPos:function(t){var e=this.getContext(),i=e.x,n=e.scroll,r=e.w,a=e.node,o=this.view.getScrollState(),s=t.x-i-n.x+o.x,l=Math.min(Math.max(e.prevProgress+Math.round(100*s/r),0),100);e.progress!=l&&(e.progress=l,X[e.mode].updateTaskTemplate.call(this,e,l)),a.style.zIndex="3",a.style.boxShadow={contrast:"#393939",dark:"#20262B"}[webix.skin.$name||"#ffffff"]+" -1px 0px 0px"},$drop:function(){var t=this.getContext(),e=t.id,i=t.progress,n=t.prevProgress;!webix.isUndefined(i)&&i!=n&&this.master.app.callEvent("bars:beforedrop",[this.view.getItem(e),t])&&(t.$waitUpdate=this.master.Action({action:"update-task-progress",progress:i,id:e}))},$dragDestroy:function(t,e){var i=this,n=this.getContext();return n.$waitUpdate?n.$waitUpdate.catch((function(){i.master.Action({action:"update-task-progress",id:n.id})})):n.$waitUpdate=this.master.Action({action:"update-task-progress",id:n.id}),t.style.cursor="",webix.html.removeCss(t,"webix_gantt_in_action"),webix.html.removeCss(n.node,"webix_gantt_mode_progress"),webix.html.remove(e),!1},updateTaskTemplate:function(t,e){var i=t.progressNode;i.style.width=e+"%",i.innerHTML=this.master.DragProgressTemplate(e)}},start:K,end:K,split:{$dragCreate:function(t,e){var i=webix.html.create("DIV",{class:"webix_gantt_split_selection"}),n=this.Local.getScales(),r=this.view.getScrollState(),a=e.target.getBoundingClientRect(),o=Math.floor((e.y-a.y+r.y)/n.cellHeight),s=e.x-a.x;i.style.top=o*n.cellHeight+6+"px",i.style.left=s+r.x+"px",i.style.height=n.cellHeight-14+"px",i.style.width="0px";var l=n.cellWidth;if(n.precise){var u=this.master.app.getService("helpers").getSmallerCount(n.minUnit);l=Math.round(l/("number"==typeof u?u:u()))}var c=this.getContext();webix.extend(c,{from:this.view,node:i,start:{offsetX:s,clientX:e.clientX},index:o,step:l,scroll:r},!0),t.appendChild(i);var h=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(h),h},$dragPos:function(t){var e=this.getContext(),i=e.dx=t.x-e.start.clientX;t.x<e.start.clientX?(e.node.style.left=e.start.offsetX+e.scroll.x+i+"px",e.node.style.width=-i+"px"):(e.node.style.left=e.start.offsetX+e.scroll.x+"px",e.node.style.width=t.x-e.start.clientX+"px")},$drop:function(){var t=this.getContext(),e=this.view.getIdByIndex(t.index),i=Math.round((t.start.offsetX+t.scroll.x)/t.step),n=Math.round(t.dx/t.step);n<0&&(i+=n,n*=-1),this.master.Action({action:"add-task",id:e,dates:{start:i,end:n}})},$dragDestroy:function(t,e){var i=this.getContext();return webix.html.remove(e),webix.html.remove(i.node),!1}}},Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("locale")._;return{view:"abslayout",css:this.State.readonly||!this.app.config.links?"webix_gantt_readonly":"",borderless:!0,cells:[{view:"template",css:"webix_gantt_holidays",borderless:!0,relative:!0},{view:"template",css:"webix_gantt_links",borderless:!0,relative:!0},{view:"list",borderless:!0,type:this.BarsType(e),css:"webix_gantt"+(webix.env.touch?"_touch":"")+"_bars",on:{onItemClick:function(e){return t.ItemClickHandler(e)}},tooltip:function(i){return t.GetTooltip(i,e)},scroll:"xy",relative:!0}]}},e.prototype.init=function(t){var e=this,i=t.getChildViews(),n=i[0],r=i[1],a=i[2];this.Holidays=n,this.Links=r,this.Bars=a,this.Ops=this.app.getService("operations"),this.Helpers=this.app.getService("helpers");var o=this.Local=this.app.getService("local"),s=o.getScales(),l=o.links(),u=this.LinksData=l.data;this.Calendars=this.app.config.resourceCalendars,this.HandleScroll(),this.HandleDrag(s),this.HandleSelection(s),this.InitMarkers(),this.HandleHolidays(s),this.on(this.State.$changes,"display",(function(t,i){e.SyncData(!0),i&&(e.Local.refreshLinks(),e.RefreshLinks(),e.Calendars&&e.RenderResourceHolidays())})),this.DrawGrid(t,s),this.Calendars&&this.RenderResourceHolidays(s),this.on(this.app,"onScalesUpdate",(function(i){e.DrawGrid(t,i),e.Bars.refresh(),e.RefreshLinks()})),this.on(this.VisibleTasks.data,"onStoreUpdated",(function(t,i,n){e.RefreshLinks(),"update"!==n&&e.ApplySelection(),!n&&e.Calendars&&e.RenderResourceHolidays()})),this.on(u,"onStoreUpdated",(function(){e.RefreshLinks()})),this.on(this.State.$changes,"criticalPath",(function(t,i){webix.isUndefined(i)||(e.Local.showCriticalPath(!t),e.RefreshLinks())})),this.on(this.State.$changes,"compact",(function(){e.RefreshLinks()})),this.Calendars&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(t,i,n){if(e.RenderResourceHolidays(),e.app.config.excludeHolidays&&n){var r=e.Local.tasks().getItem(i.task);r&&e.Ops.updateAssignedTaskDates(r)}})),this.on(this.State.$changes,"baseline",(function(t,i){webix.isUndefined(i)||e.Local.updateScaleMinMax(e.VisibleTasks)}))},e.prototype.ItemClickHandler=function(t){this.Bars.getItem(t).$group||this.State.$batch({parent:null,selected:t})},e.prototype.DrawGrid=function(t,e){t.$view.style.backgroundImage="url("+this.app.getService("helpers").drawGridInner(e.cellWidth,e.cellHeight,{contrast:"#808080",dark:"#384047"}[webix.skin.$name]||"#ccc")+")",t.$view.style.marginTop="0px";var i=this.app.getState();t.$view.style.backgroundPosition="-"+i.left+"px -"+i.top+"px",this.Resize(e.width)},e.prototype.SyncData=function(t){var e=this;this.Bars.clearAll(),this.VisibleTasks=this.Local.getVisibleTasksCollection(),this.Calendars?this.Local.taskCalendarMap().then((function(){e.Bars.sync(e.VisibleTasks)})):this.Bars.sync(this.VisibleTasks),this.ApplySelection(t)},e.prototype.BarsTemplate=function(t,e){var i=t.text||(t.$group?e("Unassigned"):e("(no title)"));return"milestone"==t.type?"<span>"+i+"</span>":i},e.prototype.BarsType=function(t){var e=this;return{template:function(i){if("tasks"===e.State.display&&"split"===i.type&&i.$data&&i.$data.length){var n=e.GetSplitBox(i),r=n.height,a=n.width,o=n.left,s=n.top,l='<div class="webix_gantt_split_container" webix_s_id="'+i.id+'" style="top:'+s+"px;left:"+o+"px;height:"+r+"px;width:"+a+'px;"></div>',u=e.VisibleTasks.data.order,c=u.length>1&&i.id==u[u.length-1];return i.$data.forEach((function(i){l+=e.TemplateStart(i,c,!0)+e.BarsTemplate(i,t)+e.TemplateEnd(i)})),l}return e.BarsTemplate(i,t)},templateStart:function(t){if("tasks"===e.State.display&&"split"===t.type&&t.$data&&t.$data.length)return"";var i=e.VisibleTasks.data.order,n=i.length>1&&t.id==i[i.length-1];return e.TemplateStart(t,n)},templateEnd:function(t){return"tasks"===e.State.display&&"split"===t.type&&t.$data&&t.$data.length?"":e.TemplateEnd()}}},e.prototype.GetSplitBox=function(t){var e=t.$data[0],i=t.$data[t.$data.length-1],n=i.$x+("milestone"==i.type?Math.floor(i.$w/2):0),r="milestone"==e.type?Math.floor(e.$w/2):e.$w;return{top:e.$y,left:n,height:e.$h,width:e.$x-n+r}},e.prototype.TemplateStart=function(t,e,i){var n=t.$w,r=t.$h,a=0,o="",s=this.BarCSS(t,e),l=this.ContentCss(t);if("milestone"==t.type)n=r=Math.ceil(Math.sqrt(Math.pow(t.$w,2)/2)),a=Math.ceil((t.$w-n)/2);else{var u="task"==t.type?this.DragProgressTemplate(t.progress):"";o='<div class="webix_gantt_progress" style="width:'+t.progress+'%;">'+u+"</div>"}var c="";return this.State.baseline&&"milestone"!==t.type&&t.planned_start&&!i&&(c=this.TemplateBaseline(t)),c+'<div webix_l_id="'+t.id+'" class="'+s+'" \n\t\t\tstyle="left:'+(t.$x+a)+"px;top:"+(t.$y+a-(c?1:0))+"px;width:"+n+"px;height:"+r+'px;" \n\t\t\tdata-id="'+t.id+'">\n\t\t\t\t<div class="webix_gantt_link webix_gantt_link_left"></div>\n\t\t\t\t'+o+'\n\t\t\t\t<div class="webix_gantt_content '+l+'">'},e.prototype.TemplateBaseline=function(t){return'<div  \n\t\t\tclass="webix_gantt_baseline_'+t.type+'" \n\t\t\tstyle="left:'+t.$x0+"px;top:"+(t.$y+t.$h-2)+"px;width:"+t.$w0+'px; " \n\t\t\tdata-baseid="'+t.id+'"></div>'},e.prototype.BarCSS=function(t,e){var i="webix_gantt_task_base webix_gantt_"+("split"===t.type?"task":t.type);return t.$critical&&(i+=" webix_gantt_critical"),t.$group&&(i+=" webix_gantt_group"),e&&(i+=" webix_gantt_last"),t.css&&"milestone"!=t.type&&(i+=" "+t.css),i},e.prototype.ContentCss=function(t){return t.css&&"milestone"==t.type?" "+t.css:""},e.prototype.TemplateEnd=function(){return'</div><div class="webix_gantt_link webix_gantt_link_right"></div></div>'},e.prototype.DragProgressTemplate=function(t){return'<div class="webix_gantt_progress_drag" style="left:'+t+'%">\n\t\t\t<span class="webix_gantt_progress_percent">'+t+"</span>\n\t\t</div>"},e.prototype.HandleDrag=function(){var t=this;Y.call(this,this.Bars),this._mousemove_handler=webix.event(this.Bars.$view,"pointermove",(function(e){"mouse"==e.pointerType&&function(t,e){if(!webix.DragControl.active){var i=webix.html.locate(t,"webix_l_id");if(i&&"task"==e.getItem(i).type){var n=e.getItemNode(i),r=z(n,t.clientX);n.style.cursor="move"==r?"pointer":"ew-resize"}}}(e,t.Bars)}))},e.prototype.destroy=function(){this._mousemove_handler=webix.eventRemove(this._mousemove_handler),this._scroll_handler=webix.eventRemove(this._scroll_handler);var t=this.app.config.markers;if(t)for(var e=0;e<t.length;e++){var i=t[e];i.$interval&&(i.$interval=clearInterval(i.$interval))}},e.prototype.GetLinks=function(t){return this.Links.$view.querySelector(".webix_gantt_"+(t?"temp_line":"lines"))},e.prototype.HandleScroll=function(){var t=this;this._scroll_handler=webix.event(this.Bars.$view,"scroll",(function(e){var i=e.target,n=Math.round(i.scrollTop),r=Math.round(i.scrollLeft);if(t.holidaysContainer.style.height="0px",t.containerForMarkers.style.height="0px",t.app.config.links){var a=t.GetLinks(),o=t.GetLinks(!0),s={viewBox:r+" "+n+" "+i.scrollWidth+" "+i.scrollHeight,width:i.scrollWidth,height:i.scrollHeight};for(var l in s)a.setAttribute(l,s[l]),o.setAttribute(l,s[l])}t.SetHolidaysScroll(i.scrollHeight,r,n),t.containerForMarkers.style.height=i.scrollHeight+"px",t.getRoot().$view.style.backgroundPosition="-"+r+"px -"+n+"px",t.State.$batch({top:n,left:r})})),this.on(this.State.$changes,"top",(function(e){t.Bars.scrollTo(t.State.left,e)})),this.app.config.resources&&(this.on(this.State.$changes,"left",(function(e){t.State.resourcesDiagram&&t.Bars.scrollTo(e,t.State.top)})),this.on(this.app,"rdiagram:resize",(function(){t.holidaysContainer.style.height=t.Bars.$view.scrollHeight+"px",t.containerForMarkers.style.height=t.Bars.$view.scrollHeight+"px"})))},e.prototype.SetHolidaysScroll=function(t,e,i){this.holidaysContainer.style.height=t+"px",this.holidaysContainer.style.left=-e+"px",this.holidaysContainer.style.top=-i+"px",this.Calendars&&(this.resHolidaysContainer.style.height=t+"px",this.resHolidaysContainer.style.left=-e+"px",this.resHolidaysContainer.style.top=-i+"px")},e.prototype.HandleSelection=function(t){var e=this;this.selLine=webix.html.create("DIV",{class:"webix_gantt_bar_selection",style:"height:"+t.cellHeight+"px;width:"+t.width+"px"}),this.Bars.$view.insertBefore(this.selLine,this.Bars.$view.firstChild),this.on(this.State.$changes,"selected",(function(){return e.ApplySelection()}))},e.prototype.ApplySelection=function(t){var e=this.State.selected,i=-100;if(e&&this.Bars.data.order.length){var n=i=this.Bars.getIndexById(e),r=this.Bars.getItem(e);n<0&&("tasks"==this.State.display&&r&&0!=r.parent&&"split"===this.Bars.getItem(r.parent).type?n=this.Bars.getIndexById(r.parent):t&&!this.Bars.exists(e)&&(this.State.selected=null)),i=n*this.Local.getScales().cellHeight,this.ScrollToTask(r)}this.selLine.style.top=i+"px"},e.prototype.ScrollToTask=function(t){if(t){var e=this.Bars;(t.$x>e.$width-this.Local.getScales().cellWidth||t.$x<e.$view.scrollLeft)&&(this.State.left=t.$x-30)}this.Bars.scrollTo(this.State.left,this.State.top)},e.prototype.InitMarkers=function(){var t=this;this.containerForMarkers=webix.html.create("DIV",{class:"webix_gantt_markers",style:"height:"+this.Bars.$view.scrollHeight+"px"}),this.Bars.$view.insertBefore(this.containerForMarkers,this.Bars.$view.firstChild),this.RenderMarkers(this.app.config.markers),this.on(this.app,"onScalesUpdate",(function(){return t.RenderMarkers(t.app.config.markers)}))},e.prototype.RenderMarkers=function(t){var e=this;if(t){for(var i=[],n=0;n<t.length;n++){var r=t[n];r.now&&(r.start_date=new Date,r.$interval||(r.$interval=setInterval((function(t){e.containerForMarkers.querySelector('[gantt_now="'+t.$interval+'"]').style.left=e.GetMarkerPosition(new Date)+"px"}),3e5,r))),i.push(this.MarkerTemplate(t[n]))}this.containerForMarkers.innerHTML=i.join("")}},e.prototype.MarkerTemplate=function(t){var e=t.text?'<span class="webix_gantt_marker_text">'+t.text+"</span>":"";return'<div\n\t\t\tgantt_now="'+t.$interval+'"\n\t\t\tclass="webix_gantt_marker '+(t.css||"")+'"\n\t\t\tstyle="left:'+this.GetMarkerPosition(t.start_date)+'px">'+e+"</div>"},e.prototype.GetMarkerPosition=function(t){var e=this.Local.getScales(),i=e.start,n=e.end,r=e.cellWidth,a=e.diff,o=e.minUnit,s=this.Helpers.getUnitStart(o,i);return t<i||t>n?-100:Math.round(a(t,s,webix.Date.startOnMonday,!0)*r)},e.prototype.LinksTemplate=function(t,e){var i=this.Bars.$view;return'<svg\n\t\t\tclass="'+e+'"\n\t\t\tviewBox="'+this.State.left+" "+this.State.top+" "+i.scrollWidth+" "+i.scrollHeight+'"\n\t\t\twidth="'+i.scrollWidth+'"\n\t\t\theight="'+i.scrollHeight+'"\n\t\t>'+t+"</svg>"},e.prototype.RefreshLinks=function(){var t=this,e=[];if(this.LinksData.count()&&this.VisibleTasks.count()){var i=this.LinksData;i.order.each((function(n){var r=i.getItem(n);if(r.$p){var a=t.State.criticalPath&&t.Local.isLinkCritical(r);e.push('<polyline data-id="'+n+'" '+(a?"class='webix_gantt_line_critical'":"")+' points="'+r.$p+'" />')}}))}var n=this.LinksTemplate(e.join(""),"webix_gantt_lines")+this.LinksTemplate('<polyline points="" />',"webix_gantt_temp_line");this.Links.setHTML(n)},e.prototype.RefreshTaskLinks=function(t){var e=this;this.LinksData.find((function(e){return e.source==t||e.target==t})).forEach((function(t){var i=e.Links.$view.querySelector('[data-id="'+t.id+'"]');if(i){var n=e.VisibleTasks.getItem(t.source),r=e.VisibleTasks.getItem(t.target);e.Helpers.updateLink(t,n,r),i.setAttribute("points",t.$p)}}))},e.prototype.Resize=function(t){var e=this.Bars.$view.querySelector(".webix_scroll_cont");e.style.width=t+"px",e.style.minHeight="1px",this.selLine&&(this.selLine.style.width=t+"px")},e.prototype.Action=function(t){var e=this.app.getService("operations"),i=null;if("update-task-time"===t.action)t.time?i=e.updateTaskTime(t.id,t.mode,t.time):(this.Local.refreshTasks(t.id),"resources"===this.State.display&&this.VisibleTasks.refresh(t.id),this.RefreshTaskLinks(t.id));else if("update-task-progress"===t.action)if(webix.isUndefined(t.progress)){var n=this.VisibleTasks.getItem(t.id);this.Bars.render(t.id,n,"paint")}else i=e.updateTask(t.id,{progress:t.progress});else if("drag-task"===t.action)(n=this.VisibleTasks.getItem(t.id)).$x=parseInt(t.left),n.$w=parseInt(t.width),this.RefreshTaskLinks(t.id);else if("add-link"===t.action){var r=t.source,a=t.target,o=t.type;i=e.addLink({source:r,target:a,type:o})}else if("temp-link"===t.action){var s=t.start,l=t.end,u=this.GetLinks(!0).firstChild;if(s){var c=this.app.getService("helpers").newLink(this.Links.$view.getBoundingClientRect(),s,l),h=c.left,p=c.top,d=c.p,f=[h,p],g=d.split(",").map((function(t,e){return 1*t+f[e%2]})).join(",");u.setAttribute("points",g)}else u.setAttribute("points","")}else if("add-task"===t.action){var v=this.Local.getScales(),m=v.precise?this.Helpers.getSmallerUnit(v.minUnit):v.minUnit;s=this.Helpers.addUnit(m,v.start,t.dates.start),l=this.Helpers.addUnit(m,s,t.dates.end),this.app.callEvent("task:add",[t.id,{start:s,end:l}])}else if("split-resize"===t.action&&"resources"!==this.State.display&&0!=(n=this.VisibleTasks.getItem(t.id)).parent){var w=this.VisibleTasks.getItem(n.parent);if("split"===w.type){var _=this.Bars.$view.querySelector('[webix_s_id="'+n.parent+'"]');w.$data.sort((function(t,e){return e.$x-t.$x}));var y=this.GetSplitBox(w),b=y.width;h=y.left,_.style.width=b+"px",_.style.left=h+"px"}}return i||webix.promise.resolve()},e.prototype.HandleHolidays=function(t){var e=this,i="<div class='webix_gantt_bar_holidays' style='height:"+this.Bars.$view.scrollHeight+"px'></div>";this.Calendars&&(i+="<div class='webix_gantt_bar_resource_holidays' style='height:"+this.Bars.$view.scrollHeight+"px'></div>"),this.Holidays.setHTML(i),this.holidaysContainer=this.Holidays.$view.querySelector(".webix_gantt_bar_holidays"),this.resHolidaysContainer=this.Holidays.$view.querySelector(".webix_gantt_bar_resource_holidays"),this.RenderHolidays(t),this.on(this.app,"onScalesUpdate",(function(t){return e.RenderHolidays(t)})),this.on(this.app.getRoot(),"onViewShow",(function(){e.refresh()}))},e.prototype.EachScaleDate=function(t,e){if("day"===t.minUnit||"hour"===t.minUnit){var i=webix.Date.copy(t.start),n=webix.Date.dayStart(t.end);t.end-n||(n=webix.Date.add(n,-1,"day",!0));for(var r=t.start.getHours();i<=n;)e.call(this,i,r),i=webix.Date.add(webix.Date.dayStart(i),1,"day",!0),r=webix.Date.equal(i,n)?24-Math.ceil(webix.Date.timePart(t.end)/60/60):0}},e.prototype.RenderHolidays=function(t){var e=this;if(this.holidaysContainer){var i="";this.EachScaleDate(t,(function(n,r){t.isHoliday(n)&&(i+=e.HolidayTemplate(t,n,r))})),this.holidaysContainer.innerHTML=i,this.Calendars&&this.RenderResourceHolidays(t)}},e.prototype.MarkResourceHolidays=function(t,e,i){var n=this,r=this.Bars.getIndexById(e);if(r<0)return"";var a="",o=0,s=null;return this.EachScaleDate(t,(function(e,l){var u=t.isHoliday(e);n.Helpers.isResourceHoliday(e,i)?u?o&&(a+=n.ResourceHolidayTemplate(t,s,l,r,o),o=0):(o||(s=e),o++):u&&(o&&(a+=n.ResourceHolidayTemplate(t,s,l,r,o),o=0),a+=n.ResourceWorkDayTemplate(t,e,l,r))})),a},e.prototype.RenderResourceHolidays=function(t){var e=this;this.resHolidaysContainer&&(t=t||this.Local.getScales(),this.Local.taskCalendarMap().then((function(i){var n="";if(i)for(var r in i)n+=e.MarkResourceHolidays(t,r,i[r]);e.resHolidaysContainer.innerHTML=n})))},e.prototype.GetDateBox=function(t,e,i,n){var r=this.Helpers.getUnitStart(t.minUnit,t.start),a={x:Math.round(t.diff(e,r)*t.cellWidth),w:("hour"===t.minUnit?24-i:1)*t.cellWidth};return(n||0===n)&&(a.y=t.cellHeight*n,a.h=t.cellHeight),a},e.prototype.HolidayTemplate=function(t,e,i){var n=this.GetDateBox(t,e,i);return"<div class='webix_gantt_holiday' style='left:"+n.x+"px;width:"+n.w+"px;'></div>"},e.prototype.ResourceHolidayTemplate=function(t,e,i,n,r){var a=this.GetDateBox(t,e,i,n),o=a.x,s=a.y;return"<div class='webix_gantt_holiday' style='left:"+o+"px;width:"+a.w*r+"px;top:"+s+"px;height:"+a.h+"px;'></div>"},e.prototype.ResourceWorkDayTemplate=function(t,e,i,n){var r=this.GetDateBox(t,e,i,n),a=r.x,o=r.y;return"<div class='webix_gantt_work_day' style='left:"+(a+.2)+"px;width:"+(r.w-1.2)+"px;top:"+o+"px;height:"+(r.h-1)+"px;'></div>"},e.prototype.GetTooltip=function(t,e){var i=webix.i18n.longDateFormatStr,n=(t.text||e("(no title)"))+"<br>\n\t\t\t<br>"+e("Start date")+": "+i(t.start_date);return"milestone"!=t.type&&(n+="<br>"+e("End date")+": "+i(t.end_date)+"\n\t\t\t<br>"+e("Lasts")+" "+t.duration+" "+(t.duration>1?e("days"):e("day"))),n},e}(h),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{view:"template",height:20,css:"webix_gantt_scale"}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Local=this.app.getService("local");var e=this.Local.getScales();this.RenderScales(e),this.on(this.app,"onScalesUpdate",(function(e){return t.RenderScales(e)}))},e.prototype.ready=function(){var t=this.getRoot();this.on(this.State.$changes,"left",(function(e){return t.scrollTo(e,null)}))},e.prototype.RenderScales=function(t){var e=this,i=this.getRoot(),n=t.rows.map((function(i){var n=("hour"===i.type||"day"===i.type)&&1===i.step;return'<div class="webix_gantt_scale_row" style=\'height:'+i.height+"px;width:"+t.width+"px'>"+i.cells.map((function(t){return e.CellTemplate(t,n)})).join("")+"</div>"})).join("");i.config.height=t.height,i.setHTML(n),i.resize()},e.prototype.CellTemplate=function(t,e){return'<div class="webix_gantt_scale_cell '+t.css+(e&&this.app.config.isHoliday(t.date)?"webix_gantt_holiday_scale":"")+'" style="width:'+t.width+'px;">'+this.FormatDate(t.date,t.format)+"</div>"},e.prototype.FormatDate=function(t,e){return"string"==typeof e&&(e=webix.Date.dateToStr(e)),e(t)},e}(h),Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{rows:[J,Q]}},e.prototype.init=function(){var t=this;this.on(this.app,"bars:toggle",(function(e){e?t.getRoot().show():t.getRoot().hide()}))},e}(h),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return this.State=this.getParam("state",!0),{view:"abslayout",css:" webix_gantt_readonly",cells:[{view:"template",css:"webix_gantt_holidays",borderless:!0,relative:!0},{view:"tree",borderless:!0,type:this.WorkloadMarkersType(),css:"webix_gantt"+(webix.env.touch?"_touch":"")+"_bars webix_gantt_resdiagram_chart",scroll:"xy",relative:!0,filterMode:{showSubItems:!1,level:0}}]}},e.prototype.init=function(t){var e=this,i=t.getChildViews(),n=i[0],r=i[1];this.Holidays=n,this.Bars=r,this.LocalState=this.getParam("localState"),this.Unit="hours";var a=this.Local=this.app.getService("local"),o=this.Scales=a.getScales();this.RDCollection=this.app.getService("grouping").getRDCollection(),this.Helpers=this.app.getService("helpers"),this.on(this.Bars.data,"onSyncApply",(function(){e.Scales=e.Local.getScales(),e.RestoreTreeState(),e.Calendars&&e.RenderResourceHolidays()})),this.Bars.sync(this.RDCollection,(function(){this.filter((function(t){return t.$group}))})),this.Calendars=this.app.config.resourceCalendars,this.DrawGrid(t,o),this.HandleScroll(),this.HandleHolidays(o),this.on(this.app,"onScalesUpdate",(function(i){e.DrawGrid(t,i)})),this.on(this.app,"rdiagram:branch:toggle",(function(t,i){e.ToggleBranch(t,i)})),this.on(this.app,"rdiagram:resize",(function(){e.holidaysContainer.style.height=e.Bars.$view.scrollHeight+"px"})),this.on(this.app,"rdiagram:sort",(function(t,i,n){t?e.Bars.sort(t,i,n):e.Bars.sort(n,i)})),this.Calendars&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(){e.RenderResourceHolidays()}))},e.prototype.ToggleBranch=function(t,e){var i=this;e?this.Bars.open(t):this.Bars.close(t);var n=this.Bars.data.getBranch("0"),r=this.Bars.getState().open.filter((function(t){return n.find((function(e){return e.id==t}))}));this._treeOpened=r.map((function(t){return i.Bars.getIndexById(t)})),this.holidaysContainer.style.height=this.Bars.$view.clientHeight+"px",this.Calendars&&(this.resHolidaysContainer.style.height=this.Bars.$view.clientHeight+"px",this.RenderResourceHolidays())},e.prototype.RestoreTreeState=function(){var t=this;if(this._treeOpened&&this._treeOpened.length){var e=this._treeOpened,i=this.Bars.data.getBranch("0");i.forEach((function(n){var r=i.indexOf(n);n.open=!e.indexOf(r),t.Bars.data.callEvent("onStoreUpdated",[n.id,0,"branch"])}))}else this.Bars.openAll()},e.prototype.HandleScroll=function(){var t=this;this._scroll_handler=webix.event(this.Bars.$view,"scroll",(function(e){var i=e.target,n=Math.round(i.scrollTop),r=Math.round(i.scrollLeft);t.getRoot().$view.style.backgroundPosition="-"+r+"px -"+n+"px",t.State.left=r,t.LocalState.top=n,t.SetHolidaysScroll(i.scrollHeight,r,n)})),this.on(this.LocalState.$changes,"top",(function(e){t.Bars.scrollTo(t.State.left,e)})),this.on(this.State.$changes,"left",(function(e){t.Bars.scrollTo(e,t.LocalState.top)})),this.on(this.app,"rdiagram:unit:change",(function(e){t.Unit=e,t.Bars.render()}))},e.prototype.WorkloadMarkersType=function(){var t=this;return{template:function(e){return t.MarkerTemplate(e)},templateStart:function(e,i){return t.MarkerStartTemplate(e,i)},templateEnd:function(){return"</div>"}}},e.prototype.MarkerStartTemplate=function(t,e){return'<div webix_tm_id="'+t.id+'" style="height:'+(this.Scales.cellHeight-8)+'px; padding: 4px;" class="'+e.classname(t,e)+' webix_gantt_diagram_line" '+e.aria(t)+">"},e.prototype.MarkerTemplate=function(t){if(2===t.$level){var e=this.GetMarkerData(t),i=[];for(var n in e)i.push(this.MarkerToHTML(e[n]));return i.join("")}return""},e.prototype.CheckResourceHoliday=function(t,e){if(this.Calendars){var i=this.Bars.getItem(e).resource_id;if(i){var n=this.Local.resources().getItem(i).calendar_id;if(n){var r=this.Local.calendars().getItem(n);return this.Helpers.isResourceHoliday(t,r)}}}return this.app.config.isHoliday(t)},e.prototype.GetMarkerData=function(t){for(var e={},i=0;i<t.duration.length;++i)for(var n=t.duration[i],r=t.units[i],a=t.$x[i]-Math.min.apply(Math,t.$x),o=this.Scales.cellHeight>40?28:20,s=this.Scales.cellWidth-o,l=Math.round(s/2),u=a?-2:l,c=webix.Date.copy(t.start_date[i]),h=0;h<n;++h,u+=s){if(this.app.config.excludeHolidays&&this.CheckResourceHoliday(c,t.id))++n;else{var p;p="hour"!==this.Scales.minUnit&&(h===n-1?r[1]:h?r[2]:r[0])||r[2];var d=t.$x[i]+h*this.Scales.cellWidth-2;e[d]?(e[d].hours+=p,e[d].count+=1):e[d]={hours:p,x:d+l,count:1},e[d].overloaded=this.CheckOverload(e[d],t)}webix.Date.add(c,1,this.Scales.minUnit)}return e},e.prototype.CheckOverload=function(t){return"hour"===this.Scales.minUnit?Math.round(24*t.hours)>this.Helpers.unitLoadNorm.day:t.hours>this.Helpers.unitLoadNorm[this.Scales.minUnit]},e.prototype.MarkerToHTML=function(t){var e=t.overloaded?"webix_gantt_overload":"",i="hours"===this.Unit?t.hours>=1?t.hours:" ":t.count;return'<div class="webix_gantt_diagram_marker '+e+'" style="left:'+t.x+'px;">'+i+"</div>"},e.prototype.RenderResourceHolidays=function(t){var e=this;t=t||this.Local.getScales();var i="";this.Bars.data.each((function(n){if(n.resource_id){var r=e.Local.resources().getItem(n.resource_id).calendar_id;r&&(i+=e.MarkResourceHolidays(t,n.id,e.Local.calendars().getItem(r)))}})),this.resHolidaysContainer.innerHTML=i},e}(Q);function et(t){return function(e,i){return e[t].localeCompare(i[t],void 0,{ignorePunctuation:!0,numeric:!0})}}function it(t,e){return t&&t.length==e.length&&t.every((function(t){return e.includes(t)}))}var nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("local").getScales(),i=this._=this.app.getService("locale")._,n=this.Compact=this.getParam("compact",!0),r=[{id:"name",css:"webix_gantt_title",header:n?"<span class='webix_icon gti-menu'>":i("Name"),template:function(e,i){return t.TreeTemplate(e,i)},fillspace:!0,sort:n?"":et("name"),minWidth:n?44:150},{id:"load",header:i("Hours"),hidden:n,batch:"hours",sort:"int",minWidth:50,resize:!1},{id:"count",header:i("Tasks"),batch:"tasks",sort:"int",minWidth:50,hidden:!0,resize:!1}],a=webix.skin.$name,o={view:"treetable",css:"webix_gantt_resdiagram_tree "+("material"==a||"mini"==a?"webix_header_border":""),prerender:!0,borderless:"contrast"===a,width:n?44:this.State.treeWidth,rowHeight:e.cellHeight,headerRowHeight:e.height,scroll:"xy",scrollAlignY:!1,sort:!0,resizeColumn:{headerOnly:!0,size:10},columns:r,tooltip:function(){return""},on:{onViewResize:function(){t.State.treeWidth=t.Tree.$width},onAfterOpen:function(e){return t.ToggleBranch(e,1)},onAfterClose:function(e){return t.ToggleBranch(e,0)},onAfterSort:function(e,i,n){return t.SortTasks(e,i,n)},onColumnResize:function(e,i,n,r){return t.NormalizeColumns(e,r)}},onClick:{"gti-menu":function(){return t.ToggleColumns()}},filterMode:{showSubItems:!1,level:0}},s=this.LocalState=this.getParam("localState");return o.on.onScrollY=o.on.onSyncScroll=o.on.onAfterScroll=function(){s.top=this.getScrollState().y},o},e.prototype.init=function(t){var e=this;this.Tree=t,this.Helpers=this.app.getService("helpers"),this.Local=this.app.getService("local"),this.RDCollection=this.app.getService("grouping").getRDCollection(),this._unit="hours",this._collapsed=!0,this.on(this.LocalState.$changes,"top",(function(t){e.Tree.scrollTo(null,t)})),this.on(this.Tree.data,"onSyncApply",(function(){return e.RestoreTreeState()})),t.sync(this.RDCollection,(function(){this.filter((function(t){return t.$group}))})),this.on(this.State.$changes,"treeWidth",(function(i){e.Compact||t.$width===i||(t.define({width:i}),t.resize())})),this.on(this.app,"rdiagram:unit:change",(function(t){return e.ShowInUnits(t)})),this.on(this.app,"onScalesUpdate",(function(t){var i=e.Tree.columnId(0);e.Tree.getColumnConfig(i).header[0].height=t.height,e.Tree.refreshColumns()}))},e.prototype.RestoreTreeState=function(){var t=this;if(this._treeOpened&&this._treeOpened.length){var e=this._treeOpened,i=this.Tree.data.getBranch("0");i.forEach((function(n){var r=i.indexOf(n);n.open=!e.indexOf(r),t.Tree.data.callEvent("onStoreUpdated",[n.id,0,"branch"])}))}else this.Tree.openAll()},e.prototype.TreeTemplate=function(t,e){var i=this.Compact&&this._collapsed;return 1==t.$level?i?e.icon(t):e.treetable(t,e)+t.category:i?this.Helpers.resourceAvatar(t):e.space(t)+this.Helpers.resourceAvatar(t)+t.name},e.prototype.ShowInUnits=function(t){this._unit=t;var e=this.Tree,i=e.config.columns,n=i[i.length-1].fillspace;this.Compact&&this._collapsed||e.showColumnBatch(t),this.SetColumns(0,n)},e.prototype.NormalizeColumns=function(t,e){e&&this.SetColumns(this.Tree.getColumnIndex(t),!0)},e.prototype.SetColumns=function(t,e){var i=this.Tree.config.columns,n=i.length-1;0===t?(i[n].fillspace=e,i[n].width=0,i[n].resize=!1):t===n&&(i[0].fillspace=!0,i[0].width=0),this.Tree.refreshColumns()},e.prototype.ToggleColumns=function(){var t=this.Tree,e=t.isColumnVisible("load"),i=t.isColumnVisible("count"),n=this._collapsed=e||i;n?(e&&t.hideColumn("load"),i&&t.hideColumn("count")):"hours"===this._unit?t.showColumn("load"):t.showColumn("count"),t.config.width=n?44:0,t.config.columns[0].minWidth=n?44:150,t.resize(),t.refreshColumns(),this.app.callEvent("rdiagram:tree:toggle",[n])},e.prototype.ToggleBranch=function(t,e){var i=this,n=this.Tree.data.getBranch("0"),r=this.Tree.getState().open.filter((function(t){return n.find((function(e){return e.id==t}))}));this._treeOpened=r.map((function(t){return i.Tree.getIndexById(t)})),this.app.callEvent("rdiagram:branch:toggle",[t,e])},e.prototype.SortTasks=function(t,e,i){this.app.callEvent("rdiagram:sort",[t,e,i])},e}(h),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n="contrast"===webix.skin.$name,r=this.app.getService("local").getScales().minUnit;return{type:n?"clean":"line",rows:[{view:"toolbar",borderless:n,elements:[{},{view:"radio",width:330,value:"hours",localId:"radio",options:[{id:"hours",value:e("Hours per")+" "+e(r)},{id:"tasks",value:e("Tasks per")+" "+e(r)}],on:{onChange:function(e){t.app.callEvent("rdiagram:unit:change",[e])}}}]},{type:"clean",cols:[nt,{view:i?"spacer":"resizer",css:"webix_gantt_resizer",width:i?1:4},{localId:"diagram",rows:[J,tt]}]}]}},e.prototype.init=function(){var t=this,e=N({top:0});this.setParam("localState",e),this.on(this.app,"rdiagram:tree:toggle",(function(e){e?t.$$("diagram").show():t.$$("diagram").hide()}));var i=this.app.getService("locale")._,n=this.$$("radio");this.on(this.app,"onScalesUpdate",(function(t,e){t.minUnit!==e.minUnit&&(n.config.options.map((function(e){var n=e.value.split(" ");n[n.length-1]=i(t.minUnit),e.value=n.join(" ")})),n.refresh())}))},e}(h),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._,i={css:"webix_gantt_datepicker",type:"calendar",body:{height:270,width:250,icons:!0,events:function(e){return t.app.config.isHoliday(e)&&"webix_cal_event"}}};return{view:"form",localId:"form",borderless:!0,autoheight:!0,elementsConfig:{labelPosition:"top"},padding:{left:3,right:3},visibleBatch:"added",elements:[{batch:"added",rows:[{view:"datepicker",name:"planned_start",label:e("Start date"),suggest:webix.copy(i)},{view:"datepicker",name:"planned_end",label:e("End date"),suggest:webix.copy(i)},{view:"counter",name:"planned_duration",css:"webix_gantt_form_counter",min:1,max:1e3,label:e("Duration")}]},{batch:"none",cols:[{view:"button",type:"icon",icon:"wxi-plus",autowidth:!0,label:e("Add dates"),click:function(){return t.AddBtnClickHandler()},css:"webix_transparent"},{}]},{batch:"added",cols:[{},{view:"button",type:"icon",icon:"wxi-trash",autowidth:!0,label:e("Remove dates"),click:function(){return t.RemoveBtnClickHandler()},css:"webix_transparent"},{}]}],on:{onChange:function(e,i,n){t.Compact?t.UpdateTaskTime():"user"==n&&t.UpdateTask()}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Form=this.$$("form"),this.Tasks=this.app.getService("local").tasks(),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,n){"update"==n&&e==t.State.selected&&t.FillData(e)}))},e.prototype.FillData=function(t){this.Tasks.getItem(t).planned_start?this.$$("form").showBatch("added"):this.$$("form").showBatch("none"),this.Form.setValues(this.Tasks.getItem(t))},e.prototype.PrepareDates=function(t){var e=this._eventSource=this.Form.$eventSource.config.name,i=!0;return"planned_duration"==e||"planned_start"==e&&"project"==t.type?t.planned_end=null:"planned_end"==e||"planned_start"==e?t.planned_duration=null:i=!1,i},e.prototype.UpdateTaskTime=function(){var t=this.Form.getValues();if(this.PrepareDates(t)){var e=this._eventSource?this._eventSource.split("_")[1]:null;"duration"==e&&(e=null),this.Ops.updatePlannedTaskDuration(t,e),this.Form.blockEvent(),this.Form.setValues(t,!0),this.Form.unblockEvent()}},e.prototype.UpdateTask=function(){var t=this.State.selected,e=this.Form.getValues();this.Compact||this.PrepareDates(e);var i=this._eventSource?this._eventSource.split("_")[1]:null;"duration"==i&&(i=null),this.Ops.updateTask(t,e,i,!1,!0)},e.prototype.AddBtnClickHandler=function(){var t=this.State.selected,e=this.Form.getValues(),i={planned_start:e.start_date,planned_end:e.end_date,planned_duration:e.duration};this.Ops.updateTask(t,i,null,!1,!0)},e.prototype.RemoveBtnClickHandler=function(){var t=this,e=this.State.selected;webix.confirm(this._("Planned dates will be removed, are you sure?")).then((function(){t.Ops.updateTask(e,{planned_start:null,planned_end:null,planned_duration:null},null,!1,!0)}))},e}(h),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={view:"treetable",css:"webix_gantt_tree webix_gantt_form_tree",header:!1,borderless:!0,localId:"links",autoheight:!0,editable:!0,scroll:!1,hover:"webix_gantt_link_table_hover",scheme:{$group:{by:"ttype"}},columns:[{id:"task",css:"webix_gantt_title",header:e("Task"),fillspace:!0,template:function(t){return t.$group?'<span class="webix_strong">'+e("source"==t.ttype?e("Successors"):e("Predecessors"))+"</span>":t.text||e("(no title)")}},{id:"type",css:"webix_gantt_type",header:e("Link"),width:140,template:function(t,e,i,n){return t.$group?"":n.collection.getItem(i).value+'<span class="webix_icon wxi-menu-down"></span>'},editor:"richselect",options:[{id:"0",value:e("End to start")},{id:"1",value:e("Start to start")},{id:"2",value:e("End to end")},{id:"3",value:e("Start to end")}]},{width:30,css:"webix_gantt_action",template:function(t){return t.$group?"":"<span class='webix_icon wxi-trash'></span>"}}],on:{onBeforeEditStart:function(t){return!this.getItem(t).$group},onBeforeEditStop:function(e,i){if(e.value!=e.old)return t.UpdateLink(i.row,{type:1*e.value}),!1},onAfterLoad:function(){this.openAll()}},onClick:{"wxi-trash":function(i,n){webix.confirm({container:t.app.getRoot().$view,title:e("Delete link"),text:e("The link will be deleted permanently, are you sure?")}).then((function(){return t.DeleteLink(n)}))}}};return{padding:{top:webix.skin.$active.layoutMargin.form,bottom:5},rows:[i]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Links=this.$$("links"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)}));var e=this.app.getService("local").links();this.on(e.data,"onStoreUpdated",(function(e,i){if(i){var n=t.State.selected;i.target!==n&&i.source!==n||t.FillData(n)}}))},e.prototype.FillData=function(t){var e=this.app.getService("local"),i=e.getLinks(t,"target").concat(e.getLinks(t,"source"));this.Links.clearAll(),i.length?(this.Links.parse(i),this.getRoot().show()):this.getRoot().hide()},e.prototype.UpdateLink=function(t,e){var i=this;this.Ops.updateLink(t,e).then((function(){i.Links.blockEvent(),i.Links.editCancel(),i.Links.unblockEvent(),e.type+="",i.Links.updateItem(t,e)}))},e.prototype.DeleteLink=function(t){var e=this;this.Ops.removeLink(t).then((function(){e.FillData(e.State.selected)}))},e}(h);webix.editors.gantt_numeditor=webix.extend({render:function(){var t=webix.editors.text.render.call(this),e=t.querySelector("input");return e.type="number",e.min=0,t}},webix.editors.text);var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this.Local=this.app.getService("local"),this.Helpers=this.app.getService("helpers");var i=this.app.config,n=this.IsSingle="single"==i.resources||i.resourceCalendars,r={cols:[{view:"button",type:"icon",icon:"wxi-plus",autowidth:!0,localId:"addBtn",label:e("Add assignment"),click:function(){return t.AddBtnClickHandler()},css:"webix_transparent"},{}]},a={view:"treetable",css:"webix_gantt_resource_table webix_gantt_tree webix_gantt_form_tree",header:!1,borderless:!0,localId:"resources",autoheight:!0,editable:!0,editaction:"custom",scroll:!1,hover:"webix_gantt_table_hover",rowHeight:Math.max(webix.skin.$active.rowHeight,32),columns:[{id:"resource",css:"webix_gantt_title",fillspace:!0,template:function(e){return t.ResourceTemplate(e)},editor:"richselect",suggest:{width:250,css:"webix_gantt_select_editor_popup",padding:0,point:0,body:{width:250,type:{height:Math.max(webix.skin.$active.listItemHeight,32)},template:function(e){return n?t.OptionTemplate(e):t.EditorOptionTemplate(e)}}}},{id:"value",width:85,css:"webix_gantt_value",template:function(e){return t.ValueTemplate(e)},editFormat:function(t){return parseFloat(t)},editParse:function(t){return t=parseFloat(t),isNaN(t)?0:t},editor:"gantt_numeditor"},{id:"remove",width:30,css:"webix_gantt_action",template:function(e){return t.DeleteIconTemplate(e)}}],on:{onItemClick:function(e){t.Table.getItem(e).$group||"remove"==e.column||(t.Table.editRow(e),"value"==e.column&&t.Table.getEditor(e.row,"resource").getPopup().hide(),t.Table.getEditor(e.row,e.column).focus())},onBeforeEditStart:function(e){var i=t.Table.getItem(e.row);if(i.$group)return!1;if("resource"==e.column){t.Table.addCellCss(e.row,e.column,"webix_gantt_select_editor");var r=e&&!n?i.resource:null;t.FilterOptions(r)}return!0},onAfterEditStart:function(e){if("value"==e.column){var i=t.Table.getItem(e.row),n=t.Table.getEditor(e.row,"value").getInputNode(),r=t.GetRange(i);r&&t.ApplyEditorLimits(n,r);var a=t.GetValueStep(i);a&&t.ApplyEditorStep(n,a)}},onBeforeEditStop:function(e,i){if(t.Table.removeCellCss(i.row,"resource","webix_gantt_select_editor"),e.value!=e.old){var n={};if(n[i.column]=e.value,"value"==i.column){var r=t.Table.getItem(i.row),a=t.GetRange(r);a?t.ApplyValueRange(n,a):n.value<0&&(n.value=0),i.getInputNode().value=n.value}t.UpdateAssignment(i.row,n)}return!0},onAfterLoad:function(){this.openAll()}},onClick:{webix_gantt_remove_icon:function(i,n){webix.confirm({container:t.app.getRoot().$view,title:e("Delete assignment"),text:e("Are you sure to delete this assignment?")}).then((function(){return t.RemoveAssignment(n.row)}))}}};return n||(a.scheme={$group:{by:"category"}}),{margin:webix.skin.$active.layoutMargin.form,padding:{top:webix.skin.$active.layoutMargin.form,bottom:5},rows:[a,r]}},e.prototype.init=function(){var t=this;if(this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Helpers=this.app.getService("helpers"),this.Table=this.$$("resources"),this.Local=this.app.getService("local"),this.Resources=this.Local.resources(),!this.app.config.resources)return!1;this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)}))},e.prototype.FillData=function(t){var e=this;if("task"!=this.Local.tasks().getItem(t).type)return!1;this.Local.getAssignments(t).then((function(t){if(!e.getRoot())return!1;e.Table.clearAll(),e.Table.getColumnConfig("resource").collection=e.Resources,t.length?(e.Table.show(),e.Table.parse(e.GetData(t)),e.IsSingle&&e.$$("addBtn").disable()):(e.IsSingle&&e.$$("addBtn").enable(),e.Table.hide())}))},e.prototype.GetData=function(t){return t.sort(this.app.getService("operations").sortResources),t},e.prototype.FilterOptions=function(t){var e=[],i=t?this.Resources.getItem(t).category_id:null;this.Table.data.each((function(t){e.push(t.resource)})),this.Resources.filter((function(n){return(!i||n.category_id==i)&&(e.indexOf(n.id)<0||t&&n.id==t)}))},e.prototype.UpdateAssignment=function(t,e){var i=this,n=this.Table.$view.querySelector(".webix_gantt_select_editor");if(n){var r=1*n.getAttribute("aria-rowindex");this.Table.removeCellCss(this.Table.data.getIdByIndex(r-1),"resource","webix_gantt_select_editor")}this.Ops.updateAssignment(t,e).then((function(){i.CloseEditor(t,e)}))},e.prototype.GetRange=function(t){var e=this.Resources.getItem(t.resource);return this.Helpers.getResourceValueRange(e)},e.prototype.ApplyValueRange=function(t,e){t.value<e[0]?t.value=e[0]:t.value>e[1]&&(t.value=e[1])},e.prototype.ApplyEditorLimits=function(t,e){t.min=e[0],t.max=e[1]},e.prototype.GetValueStep=function(t){var e=this.Resources.getItem(t.resource);return this.Helpers.getResourceValueStep(e)},e.prototype.ApplyEditorStep=function(t,e){t.step=e},e.prototype.CloseEditor=function(t,e){this.Table.blockEvent(),this.Table.editCancel(),this.Table.unblockEvent(),this.Table.updateItem(t,e)},e.prototype.RemoveAssignment=function(t){var e=this;this.Ops.removeAssignment(t).then((function(){e.FillData(e.State.selected)}))},e.prototype.AddBtnClickHandler=function(){var t=this;this.FilterOptions(),webix.delay((function(){t.ShowPopup()}))},e.prototype.AddAssignment=function(t){var e=this;this.IsSingle&&this.$$("addBtn").disable(),this.Ops.addAssignment({resource:t.id,value:this.Helpers.getDefaultResourceValue(t),task:this.State.selected}).then((function(){e.FillData(e.State.selected)}))},e.prototype.ResourceTemplate=function(t){if(t.$group)return'<span class="webix_strong">'+t.category+"</span>";if(t.resource){var e=this.Resources.getItem(t.resource);return this.EditorTemplate(e)}return""},e.prototype.ValueTemplate=function(t){if(t.$group)return"";var e=t.value;return(isNaN(e)?this.Helpers.getDefaultResourceValue(t):e)+this.GetUnitName(t)},e.prototype.GetUnitName=function(t){return this._(this.Helpers.getResourceUnit(t))},e.prototype.DeleteIconTemplate=function(t){return t.$group?"":"<span class='webix_icon wxi-trash webix_gantt_remove_icon'></span>"},e.prototype.GetPopupConfig=function(){var t=this;return{view:"suggest",localId:"popup",width:320,padding:0,point:0,fitMaster:!1,borderless:!0,css:"webix_gantt_select_editor_popup",body:{view:"list",minHeight:28,type:{height:Math.max(webix.skin.$active.listItemHeight,32)},data:this.Resources,template:function(e){return t.OptionTemplate(e)},on:{onItemClick:function(e){t.AddAssignment(t.Resources.getItem(e)),t.Popup.hide()}}}}},e.prototype.ShowPopup=function(){this.Popup&&this.Popup.$view||(this.Popup=this.ui(this.GetPopupConfig()),this.SetPopupPlaceholder()),this.Popup.show(this.$$("addBtn").$view,{x:1})},e.prototype.SetPopupPlaceholder=function(t){this.Popup.getBody().$view.firstChild.setAttribute("placeholder",t||this._("No resources to add"))},e.prototype.OptionTemplate=function(t){return"<div class='webix_gantt_avatar_option_box'><div class=\"webix_gantt_avatar_box_inline\">"+this.Helpers.resourceAvatar(t)+"<div class='webix_gantt_editor_avatar_name'>"+t.name+"</div></div><span class='webix_gantt_resource_section'>"+t.category+"</span></div>"},e.prototype.EditorTemplate=function(t){return'<div class="webix_gantt_avatar_box">'+this.Helpers.resourceAvatar(t)+" <div class='webix_gantt_editor_avatar_name'>"+t.name+"</div><span class='webix_icon wxi-menu-down'></span></div>"},e.prototype.EditorOptionTemplate=function(t){return'<div class="webix_gantt_avatar_box">'+this.Helpers.resourceAvatar(t)+" <div class='webix_gantt_editor_avatar_name'>"+t.name+"</div></div>"},e}(h),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;this.Compact=this.getParam("compact",!0);var e=this.app.getService("locale")._;this.isResources=this.app.config.resources,this.State=this.getParam("state",!0);var i=webix.skin.$active,n={view:"toolbar",css:"webix_subbar",borderless:!0,padding:{left:i.layoutPadding.form-(i.inputHeight-20)/2,right:i.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.Close()}},{},{view:"button",width:130,css:"webix_primary",value:e("Done"),click:function(){return t.Done()}}]},r={css:"webix_gantt_datepicker",type:"calendar",body:{height:270,width:250,icons:!0,events:function(e){return t.app.config.isHoliday(e)&&"webix_cal_event"}}},a=[{id:"task",value:e("Task")},{id:"milestone",value:e("Milestone")}];this.app.config.projects||a.splice(1,0,{id:"project",value:e("Project")});var o=[];this.app.config.links&&o.push({header:e("Related tasks"),body:ot,collapsed:!0}),this.isResources&&o.push({localId:"resourcesItem",header:"single"==this.isResources||this.app.config.resourceCalendars?e("Assignment"):e("Assignments"),body:{$subview:st,name:"resources"},collapsed:!0,hidden:!0}),this.State.baseline&&o.push({localId:"baselineItem",header:e("Planned dates"),body:{$subview:at,name:"baseline"},collapsed:!0,hidden:!0});var s={multi:!0,view:"accordion",borderless:!0,type:"clean",margin:10,css:"webix_gantt_accordion",rows:o};return{view:"proxy",body:{margin:0,padding:{bottom:14},rows:[n,{view:"form",localId:"form",borderless:!0,autoheight:!1,scroll:!0,elementsConfig:{labelPosition:"top"},elements:[{view:"text",name:"text",label:e("Title")},{view:"richselect",localId:"types",name:"type",label:e("Type"),options:a,on:{onChange:function(e){return t.ToggleControls(e)}}},{view:"datepicker",name:"start_date",label:e("Start date"),suggest:webix.copy(r)},{view:"datepicker",name:"end_date",label:e("End date"),suggest:webix.copy(r)},{view:"counter",name:"duration",css:"webix_gantt_form_counter",min:1,max:1e3,label:e("Duration")},{view:"slider",name:"progress",title:webix.template("#value#%"),label:e("Progress")},s,{view:"textarea",name:"details",label:e("Notes"),height:150}],on:{onChange:function(e,i,n){t.Compact?t.UpdateTaskTime():"user"==n&&t.UpdateTask().then((function(){"type"!==t._eventSource||"user"!==n||"split"!==e&&"split"!==i||t.Tasks.data.callEvent("onStoreUpdated",[])}))}}}]}}},e.prototype.init=function(){var t=this;this.Ops=this.app.getService("operations"),this.Local=this.app.getService("local"),this.Tasks=this.Local.tasks(),this.Form=this.$$("form"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,n){"update"==n&&e==t.State.selected&&t.FillData(t.State.selected)})),this.on(this.State.$changes,"display",(function(e){var i=t.$$("form").elements.type;"tasks"==e?i.enable():"resources"==e&&i.disable()})),this.app.config.resourceCalendars&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(){return t.SetResourceHolidays()})),this.on(this.State.$changes,"baseline",(function(e,i){webix.isUndefined(i)||t.SetBaselineVisibility(t.Tasks.getItem(t.State.selected))}))},e.prototype.FillData=function(t){var e=this.Tasks.getItem(t),i=this.$$("types").getList();this.app.config.split&&e.$count?i.exists("split")||i.add({id:"split",value:this.app.getService("locale")._("Split task")}):i.exists("split")&&i.remove("split"),this.app.config.projects&&this.LimitTypeOptions(e),this.app.config.resourceCalendars&&this.SetResourceHolidays(),this.isResources&&this.SetResourcesVisibility(e),this.State.baseline&&this.SetBaselineVisibility(e),this.Form.setValues(e),this.Form.focus()},e.prototype.SetResourcesVisibility=function(t){var e=this.$$("resourcesItem");if("task"==t.type){if(!e.isVisible()){var i=this.getSubView("resources");i&&i.FillData(t.id),e.show()}}else e.isVisible()&&e.hide()},e.prototype.SetBaselineVisibility=function(t){var e=this.$$("baselineItem");if(!this.State.baseline||"task"!=t.type&&"project"!=t.type)e.isVisible()&&e.hide();else if(!e.isVisible()){var i=this.getSubView("baseline");i&&i.FillData(t.id),e.show()}},e.prototype.LimitTypeOptions=function(t){var e=this.Form.elements.type;"project"===t.type?e.hide():e.show()},e.prototype.PrepareDates=function(t){var e=this._eventSource=this.Form.$eventSource.config.name,i=!0;return"duration"==e||"start_date"==e&&"project"==t.type?t.end_date=null:"end_date"==e||"start_date"==e?t.duration=null:i=!1,i},e.prototype.UpdateTaskTime=function(){var t=this.Form.getValues(),e=this.PrepareDates(t);if("type"===this._eventSource&&"split"!==t.type&&(t.open=t.opened=1),this.RemoveTagsFromText(t)&&(this.Form.blockEvent(),this.Form.setValues(t,!0),this.Form.unblockEvent()),e){var i=this._eventSource?this._eventSource.split("_")[0]:null;this.Ops.updateTaskDuration(t,i),this.Form.blockEvent(),this.Form.setValues(t,!0),this.Form.unblockEvent()}},e.prototype.RemoveTagsFromText=function(t){return("text"===this._eventSource||"details"===this._eventSource)&&(t[this._eventSource]=(t[this._eventSource]||"").replace(/(<[^>]+>|^\s+|\s+$)/gi,""),!0)},e.prototype.UpdateTask=function(){var t=this,e=this.State.selected,i=this.Form.getValues();this.Compact||(this.PrepareDates(i),this.RemoveTagsFromText(i));var n=this._eventSource?this._eventSource.split("_")[0]:null;return"type"===this._eventSource&&"split"!==i.type&&(i.open=i.opened=1),this._inProgress=this.Ops.updateTask(e,i,n),this._inProgress.finally((function(){return t._inProgress=null})),this._inProgress},e.prototype.ToggleControls=function(t){if(this.Form.elements.end_date.show(),this.Form.elements.duration.show(),this.Form.elements.progress.show(),this.Form.elements.end_date.enable(),this.Form.elements.duration.enable(),this.Form.elements.progress.enable(),"project"==t||"milestone"==t){var e="project"==t?"disable":"hide";this.Form.elements.end_date[e](),this.Form.elements.duration[e](),this.Form.elements.progress[e]()}},e.prototype.Close=function(){var t=this;if(this.Compact&&this.Form.isDirty()){var e=this.app.getService("locale")._;webix.confirm({container:this.app.getRoot().$view,text:e("Save changes?")}).then((function(){return t.Done(!0)}),(function(){return t.Back(!0)}))}else this.Back(!0)},e.prototype.Back=function(t){t?this.State.$batch({edit:null,selected:null}):this.State.edit=null},e.prototype.Done=function(t){var e=this;this.Compact&&this.Form.isDirty()?this._inProgress?this._inProgress.then((function(){e.Back(t)})):this.UpdateTask().then((function(){return e.Back(t)})):this.Back(t)},e.prototype.SetResourceHolidays=function(){var t=this,e=[],i=this.Form.elements,n=this.app.getService("helpers");e.push(i.start_date,i.end_date);var r=this.Local.getTaskCalendar(this.State.selected);e.forEach((function(e){var i=e.getPopup().getBody();i.config.events=function(e){return(r?n.isResourceHoliday(e,r):t.app.config.isHoliday(e))&&"webix_cal_event"},i.refresh()}))},e}(h),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._,i=this.State=this.getParam("state",!0),n={view:"button",width:130,label:e("Edit"),css:"webix_primary",click:function(){return t.EditTask()}},r=webix.skin.$active,a={view:"toolbar",css:"webix_subbar",borderless:!0,padding:{left:r.layoutPadding.form-(r.inputHeight-20)/2,right:r.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.Close()}},{},i.readonly?{}:n]},o={localId:"text",view:"template",css:"webix_gantt_task_info",template:function(e){return t.InfoTemplate(e)},borderless:!0},s={view:"button",label:e("Delete task"),css:"webix_danger webix_gantt_danger",align:"center",inputWidth:330,click:function(){webix.confirm({container:t.app.getRoot().$view,title:e("Delete task"),text:e("The task will be deleted permanently, are you sure?")}).then((function(){return t.DeleteTask()}))}};return{view:"proxy",body:{margin:0,rows:[a,{type:"form",borderless:!0,rows:[o,i.readonly?{}:s]}]}}},e.prototype.init=function(){var t=this;this.Local=this.app.getService("local"),this.Tasks=this.Local.tasks(),this.Text=this.$$("text"),this.isResources=this.app.config.resources,this.on(this.State.$changes,"selected",(function(e){e&&t.FillTemplate(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,n){"update"==n&&e==t.State.selected&&t.FillTemplate(t.State.selected)}));var e=this.Local.links();this.on(e.data,"onStoreUpdated",(function(e,i){if(i){var n=t.State.selected;i.target!==n&&i.source!==n||t.FillTemplate(n)}})),this.isResources&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(e,i){i&&i.task==t.State.selected&&t.FillTemplate(i.task)})),this.on(this.State.$changes,"baseline",(function(e,i){webix.isUndefined(i)||t.FillTemplate(t.State.selected)}))},e.prototype.FillTemplate=function(t){var e=this,i=webix.copy(this.Tasks.getItem(t));i.sources=this.Local.getLinks(t,"source"),i.targets=this.Local.getLinks(t,"target"),this.isResources&&"task"==i.type?this.Local.getAssignments(t).then((function(t){if(!e.getRoot())return!1;i.resources=t.sort(e.app.getService("operations").sortResources),e.Text.setValues(i)})):this.Text.setValues(i)},e.prototype.EditTask=function(){this.State.edit=!0},e.prototype.DeleteTask=function(){this.app.getService("operations").removeTask(this.State.selected),this.Close()},e.prototype.Close=function(){this.State.$batch({edit:null,selected:null})},e.prototype.InfoTemplate=function(t){if(!t.start_date)return"";var e=this._,i='<span class="webix_gantt_task_title">'+(t.text||e("(no title)"))+"</span><br><br>";return i+=this.BaseTemplate(t),i+=this.LinkTemplate(t),this.State.baseline&&t.planned_start&&(i+=this.BaselineTemplateChunk(t,e("Planned dates"))),t.details&&(i+='<br><br><div class="webix_gantt_task_title">'+e("Notes")+'</div>\n\t\t\t\t<br><div class="webix_gantt_task_text">'+t.details.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</div>"),i},e.prototype.BaseTemplate=function(t){var e=this._,i='<span class="webix_strong">'+e("Start date")+"</span>: "+this.DateFormat(t.start_date)+"<br>";return"milestone"!==t.type&&(i+='<span class="webix_strong">'+e("End date")+"</span>: "+this.DateFormat(t.end_date)+'<br>\n\t\t\t<span class="webix_strong">'+e("Duration")+"</span>: "+t.duration+'<br>\n\t\t\t<span class="webix_strong">'+e("Progress")+"</span>: "+t.progress+"%\n\t\t<br>"),i},e.prototype.LinkTemplate=function(t){var e="",i=this._;if(t.targets.length&&(e+=this.InfoTemplateChunk(t.targets,i("Predecessors"))),t.sources.length&&(e+=this.InfoTemplateChunk(t.sources,i("Successors"))),t.resources){var n="single"==this.isResources||this.app.config.resourceCalendars;e+=this.ResourcesTemplateChunk(t.resources,i(n?"Assignment":"Assignments"))}return e},e.prototype.ResourcesTemplateChunk=function(t,e){var i=this;if(!t||!t.length)return"";var n=130;return t.forEach((function(t){var e=webix.html.getTextSize(t.name,"webix_gantt_info_list_text"),i=webix.html.getTextSize(t.category,"webix_gantt_info_list_text webix_gantt_resource_section");n=Math.max(n,e.width,i.width)})),n=Math.min(200,n),'<br><span class="webix_strong">'+e+'</span>:<br><ul class="webix_gantt_info_list_resources">'+t.map((function(t){var e=i.app.getService("helpers"),r="<div>"+e.resourceAvatar(t,"webix_gantt_person_avatar_big")+"</div>",a="<div class=' webix_gantt_info_list_text webix_gantt_resource_section' style='min-width:"+n+"px'>"+t.category+"</div>",o="<div class='webix_gantt_resource_section'>"+t.value+i._(e.getResourceUnit(t))+"</div>";return"<div class='webix_gantt_info_resource'>"+r+"<div  ><div class='webix_gantt_info_list_text_row'><div class='webix_gantt_info_list_text' style='min-width:"+n+"px'>"+t.name+"</div>"+o+"</div>"+a+"</div></div>"})).join("")+"</ul>"},e.prototype.InfoTemplateChunk=function(t,e){var i=this;return'<br><span class="webix_strong">'+e+"</span>:<br><ul>"+t.map((function(t){return"<li>"+(t.text||i._("(no title)"))+"</li>"})).join("")+"</ul>"},e.prototype.DateFormat=function(t){return webix.i18n.longDateFormatStr(t)},e.prototype.BaselineTemplateChunk=function(t,e){var i=this.app.getService("locale")._;return'<br><span class="webix_strong">'+e+'</span><br><div class="webix_gantt_info_list_planned">'+i("Start date")+": "+this.DateFormat(t.planned_start)+"<br>"+i("End date")+": "+this.DateFormat(t.planned_end)+"<br>"+i("Duration")+": "+t.planned_duration+"<br></div>"},e}(h),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",borderless:!0,fullscreen:!0,head:!1,body:{$subview:!0}})},e}(h),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.State=this.getParam("state",!0);this.Local=this.app.getService("local"),this.Helpers=this.app.getService("helpers");var i=this.Local.getScales(),n=this._=this.app.getService("locale")._,r=this.Compact=this.getParam("compact",!0);this.isResources=this.app.config.resources,this.maxAvatarNumber=3;var a={id:"action",css:"webix_gantt_action",header:{text:'<span webix_tooltip="'+n("Add task")+'" class="webix_icon wxi-plus-circle"></span>',css:"webix_gantt_action"},template:function(){return'<span webix_tooltip="'+n("Add task")+'" class="webix_icon wxi-plus"></span>'},width:44,minWidth:44},o=[{id:"text",css:"webix_gantt_title",header:n("Title"),template:function(e,i){return i.treetable(e,i)+t.TitleTemplate(e)},fillspace:!0,hidden:r,batch:"full",sort:et("text"),minWidth:150},{id:"start_date",header:n("Start date"),format:webix.i18n.dateFormatStr,hidden:r,batch:"full",sort:"date",minWidth:100}];this.isResources&&o.push({id:"resources",css:"webix_gantt_tree_column_resources",header:n("Assigned"),template:function(e){return t.ResourcesTemplate(e)},minWidth:100}),r?(a.header.text="<span class='webix_icon gti-menu'>",e.readonly&&(a.template=""),o.unshift(a)):e.readonly||o.push(a),o[o.length-1].resize=!1;var s=webix.skin.$name,l={view:"treetable",css:"webix_gantt_tree "+("material"==s||"mini"==s?"webix_header_border":""),prerender:!0,width:r?44:e.treeWidth,rowHeight:i.cellHeight,headerRowHeight:i.height,scroll:"xy",scrollAlignY:!1,select:"row",sort:"multi",resizeColumn:{headerOnly:!0,size:10},drag:!e.readonly&&"order",columns:o,tooltip:function(){return""},onClick:{"wxi-plus":function(e,i){return t.AddTask(i.row)},"wxi-plus-circle":function(){return t.AddTask("0")},"gti-menu":function(){return t.ToggleColumns()}},on:{onBeforeOpen:function(e){return t.HandleToggle(e)},onAfterOpen:function(e){t.ToggleBranch(e,1),t.ApplySelection()},onAfterClose:function(e){return t.ToggleBranch(e,0)},onBeforeSelect:function(e){return t.BeforeSelectHandler(e)},onItemClick:function(e){return t.ItemClickHandler(e)},onAfterSort:function(e,i,n){return t.SortTasks(e,i,n)},onColumnResize:function(e,i,n,r){return t.NormalizeColumns(e,r)},onBeforeDrag:function(e,i){return t.BeforeDragHandler(e,i)},onBeforeDrop:function(e){return t.BeforeDropHandler(e)},onViewResize:function(){t.State.treeWidth=t.Tree.$width}}};return l.on.onScrollY=l.on.onSyncScroll=l.on.onAfterScroll=function(){e.top=this.getScrollState().y},l},e.prototype.init=function(t){var e=this;this.Tree=t,this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Helpers=this.app.getService("helpers"),this.Tasks=this.Local.tasks(),this.on(this.State.$changes,"display",(function(t){e.Mode=t,e.State.top=0,e.SyncData()})),this.isResources&&(this.on(this.Assignments.data,"onStoreUpdated",(function(){e.Tree.refresh()})),this.on(this.Tree.data,"onStoreUpdated",(function(t){"resources"!=e.Mode||t||e.ApplySelection()}))),this.on(this.State.$changes,"top",(function(t){return e.Tree.scrollTo(null,t)})),this.on(this.State.$changes,"selected",(function(t){t?e.ApplySelection():e.Tree.unselect()})),this.on(this.app,"onScalesUpdate",(function(t){var i=e.Tree.columnId(0);e.Tree.getColumnConfig(i).header[0].height=t.height,e.Tree.refreshColumns()})),this.on(this.app,"task:add",(function(t,i){return e.AddTask(t||"0",i)})),this.on(this.State.$changes,"treeWidth",(function(i){e.Compact||t.$width===i||(t.define({width:i}),t.resize())}))},e.prototype.HandleToggle=function(t){var e=this.Tree.getItem(t);if("split"===e.type&&e.$data.length)return!1},e.prototype.ItemClickHandler=function(t){this.Tree.getItem(t).$group?this.app.callEvent("edit:stop"):this.State.$batch({parent:null,selected:t.row})},e.prototype.BeforeSelectHandler=function(t){return!this.Tree.getItem(t).$group},e.prototype.BeforeDragHandler=function(t,e){if("tasks"==this.Mode){var i=this.Tree.getItem(t.start);if("split"===i.type&&i.$data.length){var n=this.Tree.$dragHTML(this.Tree.getItem(t.start),e,t);t.html=n.replace("webix_dd_drag","webix_dd_drag webix_gantt_tree_no_icon")}return!0}return!1},e.prototype.BeforeDropHandler=function(t){return this.Ops.moveTask(t.start,t.parent,t.index),!1},e.prototype.SyncData=function(){var t=this;this.Tree.clearAll(),this.VisibleTasks=this.Local.getVisibleTasksCollection(),this.resDisplayed="resources"===this.State.display,this.resDisplayed&&!this.clearEvID&&(this.clearEvID=this.on(this.VisibleTasks.data,"onClearAll",(function(){t.resDisplayed&&t.RefreshData()}))),this.RefreshData()},e.prototype.GetLoaders=function(){var t=[this.VisibleTasks.waitData];return this.isResources&&(this.Resources=this.Local.resources(),this.Assignments=this.Local.assignments(),t.push(this.Resources.waitData,this.Assignments.waitData)),t},e.prototype.RefreshData=function(){var t=this,e=this.GetLoaders();webix.promise.all(e).then((function(){t.Tree.sync(t.VisibleTasks),t.ApplySelection(),t.ApplySorting()}))},e.prototype.ApplySelection=function(){var t=this.State.selected;if(t&&this.Tree.exists(t)&&this.Tree.getSelectedId()!=t){var e=void 0,i=this.Tree.getItem(t);if("tasks"===this.State.display){var n=i.parent,r=0!=n?this.Tree.getItem(n):null;r&&"split"===r.type?e=n:this.Local._isTaskVisible(i)&&(e=t)}else this.Local._isTaskVisible(i)&&(e=t);e&&(this.Tree.select(e),this.Tree.showItem(e))}},e.prototype.ApplySorting=function(){this.State.sort&&(this.Tree.data.blockEvent(),this.Tree.setState({sort:this.State.sort}),this.Tree.data.unblockEvent())},e.prototype.AddTask=function(t,e){var i=this;this.State.selected=null;var n,r=this.Tree.getItem(t),a=r?0:-1,o=this.GetNewTask(r,e);if("resources"==this.Mode&&r)n=this.AddTaskWithAssignment(o,t);else if(r&&e){var s=void 0;this.app.config.resources&&(s=this.Assignments.find((function(t){return t.task==r.id}))),n=s&&s.length?this.SplitTaskWithAssignment(o,a,t,r,s):this.Ops.splitTaskWithDnd(o,a,t,r)}else n=this.Ops.addTask(o,a,r?t:0);return this.app.callEvent("backend:operation",[n]),n.then((function(e){r&&"tasks"==i.Mode&&"split"!==r.type&&i.Tree.open(t),i.State.$batch({edit:!0,selected:e.id}),i.Tree.showItem(e.id)})),!1},e.prototype.GetNewTask=function(t,e){var i=this.GetDates(t,e),n=i.start,r=i.end;return{start_date:new Date(n),end_date:r||webix.Date.add(n,1,"day",!0),progress:0,text:""}},e.prototype.GetDates=function(t,e){if(e)return e;var i;if(t&&"split"===t.type){var n=t.$data&&t.$data.length?t.$data[0].end_date:t.end_date;i=this.Helpers.addUnit("day",n,1)}else if(t)i=t.start_date;else{var r=this.Local.getScales();i=webix.Date.add(r.start,1,r.minUnit)}return{start:i,end:void 0}},e.prototype.AddTaskWithAssignment=function(t,e){var i=this;this.Tasks.data.blockEvent(),this.Assignments.data.blockEvent();var n="0";e&&(n=this.Tree.getItem(e).$group?"0":e);var r=0;return this.Tasks.data.branch[n]&&(r=this.Tasks.data.branch[n].length),this.Ops.addTask(t,r,n).then((function(n){t.id=n.id;for(var r=[],a=null;"0"!=e&&!a;)(a=i.Tree.getItem(e).resources)||(e=i.Tree.getParentId(e));return a&&a.length&&a.forEach((function(e){var n=i.Local.resources().getItem(e);r.push(i.Ops.addAssignment({resource:e,value:i.Helpers.getDefaultResourceValue(n),task:t.id}))})),r.length?webix.promise.all(r).then((function(){return n})):webix.promise.resolve(n)})).finally((function(){i.Tasks.data.unblockEvent(),i.Assignments.data.unblockEvent(),i.Tasks.data.callEvent("onStoreUpdated",[t.id,t,"add"])}))},e.prototype.SplitTaskWithAssignment=function(t,e,i,n,r){var a=this;return this.Ops.splitTaskWithDnd(t,e,i,n).then((function(t){if(t.sibling){for(var e=[],i=0;i<r.length;++i)e.push(a.Ops.updateAssignment(r[i].id,{task:t.sibling}).then((function(){return t})));return webix.promise.all(e).then((function(){return t}))}return t}))},e.prototype.RefreshTasks=function(){this.Tasks.data.callEvent("onStoreUpdated",[])},e.prototype.SortTasks=function(t,e,i){var n=webix.isArray(t)?t:{by:t,dir:e,as:i},r=this.Tree.getState().sort;this.VisibleTasks.sort(n),this.State.sort=r},e.prototype.ToggleColumns=function(){var t=this.Tree.isColumnVisible("text");this.Tree.showColumnBatch("full",!t),this.Tree.config.width=t?44:0,this.Tree.resize(),this.app.callEvent("bars:toggle",[t])},e.prototype.NormalizeColumns=function(t,e){if(e){var i=this.Tree,n=i.config.columns,r=i.getColumnIndex(t),a=n.length-1;"action"===n[a].id&&(a-=1),0===r?(n[a].fillspace=!0,n[a].width=0):r===a&&(n[0].fillspace=!0,n[0].width=0),i.refreshColumns()}},e.prototype.ToggleBranch=function(t,e){if("resources"!=this.State.display)this.RefreshTasks(),this.State.readonly||this.Ops.updateTask(t,{opened:e});else{var i=this.VisibleTasks;i.getItem(t).open=!!e,i.data.callEvent("onStoreUpdated",[t,0,"branch"])}},e.prototype.TitleTemplate=function(t){return t.text||(t.$group?this._("Unassigned"):this._("(no title)"))},e.prototype.ResourcesTemplate=function(t){var e=this;if(this.Assignments.count()&&this.Resources.count()){var i=[];return this.Assignments.data.each((function(n){n.task==t.id&&i.push(e.Resources.getItem(n.resource))})),i.sort(this.Ops.sortResources),this.GetAssignmentsHTML(i)}return""},e.prototype.GetAssignmentsHTML=function(t){var e=this,i="";if(t.length>this.maxAvatarNumber){var n=t.length-this.maxAvatarNumber+1,r=(t=t.splice(0,this.maxAvatarNumber)).pop(),a=this.Helpers.resourceAvatar(r),o="<div class='webix_gantt_cell_remain_num'>+"+n+"</div>";i=t.map((function(t){return""+e.Helpers.resourceAvatar(t,null,!0)})).join(""),i+="<div class='webix_gantt_cell_assigned_last'>"+a+o+"</div>"}else i=t.map((function(t){return""+e.Helpers.resourceAvatar(t,null,!0)})).join(""),1==t.length&&(i+="<span class='webix_gantt_cell_assigned_text'>"+t[0].name.split(" ")[0]+"</span>");return"<div class='webix_gantt_avatar_box'>"+i+"</div>"},e}(h),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;F||(F=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;var n=t.config;this._forceCompact=void 0!==n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout)),this.fCompact=this.getParam("forceCompact"),webix.isUndefined(this.fCompact)||this.setParam("compact",this.fCompact),this.Compact=this.getParam("compact"),this.State=this.getParam("state",!0);var e=this.Compact?{$subview:!0,name:"edit",popup:!0}:{view:"proxy",css:"webix_shadow_medium",borderless:!0,width:400,hidden:!0,localId:"edit",body:{$subview:!0,name:"edit"}},i=[ht,{view:this.Compact?"spacer":"resizer",css:"webix_gantt_resizer",width:this.Compact?1:4},Z];return this.app.config.resources?i=[{type:"clean",rows:[{type:"clean",cols:i,on:{onViewResize:function(){t.app.callEvent("rdiagram:resize",[])}}},{view:"resizer",css:"webix_gantt_resizer",localId:"rdResizer"},{view:"proxy",localId:"rdiagram",height:this.Compact?0:400,body:{$subview:!0,name:"rdiagram"}}]},e]:i.push(e),{view:"abslayout",css:"webix_gantt",cells:[{view:"r-layout",localId:"main",borderless:!0,relative:!0,type:"clean",cols:i},{css:"webix_gantt_absbutton",view:"icon",icon:"wxi-plus",localId:"add",hidden:!this.Compact||this.State.readonly,width:50,height:50,right:20,bottom:20,click:function(){t.app.callEvent("task:add",[])}}]}},e.prototype.init=function(t){var e=this;this.$$("main").sizeTrigger(this.app,(function(t){return e.SetCompactMode(t)}),!!this.Compact),this.on(this.State.$changes,"selected",(function(t,i){t?e.ShowTask(e.State.edit?"form":"info"):i&&e.HideTask()})),this.on(this.State.$changes,"edit",(function(t){e.State.selected&&e.ShowTask(t?"form":"info")})),webix.extend(t,webix.ProgressBar),this.on(this.app,"backend:operation",(function(e){t.showProgress({type:"top",delay:2e3}),e.finally((function(){t.hideProgress()}))})),this.app.config.resources&&this.on(this.State.$changes,"resourcesDiagram",(function(t){t?(e.$$("rdiagram").show(),e.$$("rdResizer").show(),e.show("rdiagram",{target:"rdiagram"})):(e.$$("rdiagram").hide(),e.$$("rdResizer").hide(),e.show("_blank",{target:"rdiagram"}).then((function(){e.app.callEvent("rdiagram:resize",[])})))}))},e.prototype.ShowTask=function(t){t="task."+t,this.Compact?this.show("task.popup/"+t,{target:"edit"}):(this.$$("edit").show(),this.show(t,{target:"edit"}))},e.prototype.HideTask=function(){this.show("_blank",{target:"edit"}),this.Compact||this.$$("edit").hide()},e.prototype.SetCompactMode=function(t){var e=this;webix.delay((function(){e.State.$batch({top:0,left:0}),e.setParam("compact",t),e.refresh()}))},e}(h),dt={JetView:h};dt["chart/bars"]=Q,dt.chart=Z,dt["chart/scale"]=J,dt["rdiagram/diagram"]=tt,dt.rdiagram=rt,dt["rdiagram/tree"]=nt,dt["task/baseline"]=at,dt["task/form"]=lt,dt["task/info"]=ut,dt["task/links"]=ot,dt["task/popup"]=ct,dt["task/resources"]=st,dt.top=pt,dt.tree=ht;var ft=function(){function t(t,e){this.app=t,this.state=t.getState(),this.Helpers=this.app.getService("helpers"),this.resetScales(e),this.dateToLocalStr=webix.Date.dateToStr(webix.i18n.parseFormat)}return t.prototype.setScales=function(t,e,i,n,r,a){var o=this._scales;n?(this._scaleBase={width:n,height:r,scales:a},e=webix.Date.add(e,1,"day")):(n=this._scaleBase.width,r=this._scaleBase.height,a=this._scaleBase.scales),this._scales=this.app.getService("helpers").setScales(t,e,i,n,r,a),this._taskHeight=this._scales.cellHeight-12;var s=this.getVisibleTasksCollection();s&&s.data.order.length&&("resources"===this.state.display?this.app.getService("grouping").refreshResourceTasks():this.refreshTasks(),this.refreshLinks()),this.app.callEvent("onScalesUpdate",[this._scales,o])},t.prototype.getScales=function(){return this._scales},t.prototype.resetScales=function(t){t=t||this.app.config;var e=webix.skin.$active,i=t.scaleStart||webix.Date.dayStart(new Date),n=t.scaleEnd||webix.Date.add(i,1,"month",!0);this.setScales(i,n,t.preciseTimeUnit,t.scaleCellWidth||80,e.barHeight-2*e.borderWidth,t.scales||[{unit:"day",step:1,format:"%d"}])},t.prototype.getTaskHeight=function(){return this._taskHeight},t.prototype.adjustScale=function(t){var e=t.start_date,i=t.end_date;this.state.baseline&&t.planned_start&&t.planned_end&&(e>t.planned_start&&(e=t.planned_start),i<t.planned_end&&(i=t.planned_end));var n=this.getScales();e=this.Helpers.addUnit(n.minUnit,e,-1),i=this.Helpers.addUnit(n.minUnit,i,1),(n&&n.start>e||n.end<i)&&this.setScales(n.start>e?e:n.start,n.end<i?i:n.end,n.precise)},t.prototype.tasks=function(t){var e=this;if(this._tasks&&!t)return this._tasks;this._tasks?this._tasks.clearAll():this._tasks=this.createTasks();var i=[this.app.getService("backend").tasks()];return this.app.config.resourceCalendars&&i.push(this.taskCalendarMap(!1,t)),this._tasks.parse(webix.promise.all(i).then((function(t){return e.app.getService("grouping").getTreeData(t[0],0)}))),this._tasks},t.prototype.createTasks=function(){var t=this,e=this.app.getService("operations"),i=new webix.TreeCollection({on:{"data->onStoreLoad":function(){t.app.config.scaleStart||t.updateScaleMinMax(i),i.data.each((function(e){t.app.config.projects&&e.$count&&(e.type="project")}))},"data->onStoreUpdated":function(e,i,n){e="update"==n?e:null,t.refreshTasks(e),t.refreshLinks(),!n&&t.state.criticalPath&&(t.app.config.links?t._links.waitData.then((function(){return t.showCriticalPath()})):t.showCriticalPath())}},scheme:{$change:function(i){i.start_date=webix.i18n.parseFormatDate(i.start_date),i.end_date=webix.i18n.parseFormatDate(i.end_date),i.type=i.type||"task",t.app.config.split||"split"!==i.type||(i.type="task"),e.updateTaskDuration(i),i.planned_start&&(i.planned_start=webix.i18n.parseFormatDate(i.planned_start),i.planned_end=webix.i18n.parseFormatDate(i.planned_end),e.updatePlannedTaskDuration(i)),"split"===i.type?(i.open=i.opened=0,i.$css="webix_gantt_split_task"):(delete i.$css,i.open=1*(i.open||i.opened)||0)},$sort:{by:"position",dir:"asc",as:"int"},$serialize:function(e){return t.taskOut(e)},$export:function(e){return t.taskOut(e)}}});return i},t.prototype.refreshTasks=function(t,e){var i=this;if(t){var n=this._tasks.getItem(t);(e=webix.isUndefined(e)?this._tasks.getIndexById(t):e)<0&&(e=this._tasks.getIndexById(n.parent)),"split"===n.type&&(n.$data=this._tasks.find((function(t){return t.parent==n.id})).sort((function(t,e){return e.start_date-t.start_date||e.end_date-t.end_date}))),this.Helpers.updateTask(n,e),this.state.baseline&&n.planned_start&&this.refreshBaseline(n,e)}else this._tasks.data.order.forEach((function(t,e){i.refreshTasks(t,e)}))},t.prototype.refreshBaseline=function(t,e){var i=r({},t);i.start_date=t.planned_start,i.duration=t.planned_duration,i.end_date=t.planned_end,this.Helpers.updateTask(i,e,this._scales,this._taskHeight),t.$x0=i.$x,t.$w0=i.$w},t.prototype.links=function(t){return this._links&&!t||(this._links?this._links.clearAll():this._links=this.createLinks(),this.app.config.links&&this._links.parse(this.app.getService("backend").links())),this._links},t.prototype.createLinks=function(){var t=this;return new webix.DataCollection({on:{"data->onStoreUpdated":function(e,i,n){n&&t.refreshLinks(e)}},scheme:{$init:function(t){t.type=1*t.type}}})},t.prototype.refreshLinks=function(t){var e=this,i=this.getVisibleTasksCollection();this._links&&i&&(this._links.data.each((function(t){var n=i.getItem(t.source),r=i.getItem(t.target);n&&r&&e._isTaskVisible(n)&&e._isTaskVisible(r)?e.Helpers.updateLink(t,n,r):t.$p=""})),this.state.criticalPath&&t&&this.showCriticalPath())},t.prototype.getLinks=function(t,e){for(var i=this._links.find((function(i){return i[e]==t})),n=[],r=0;r<i.length;r++){var a=i[r],o=this._tasks.getItem(a["source"==e?"target":"source"]);o&&n.push({id:a.id,type:a.type.toString(),text:o.text,ttype:e})}return n},t.prototype.taskOut=function(t){t=webix.copy(t);var e=this.dateToLocalStr;for(var i in t.start_date&&(t.start_date=e(t.start_date)),t.end_date&&(t.end_date=e(t.end_date)),t)0===i.indexOf("$")&&delete t[i];return t},t.prototype._isTaskVisible=function(t,e){var i=this.getVisibleTasksCollection(e),n=t.$parent,r="split"===t.type&&!t.open;if(r&&!n)return!1;for(;t.$parent;)if(!(n==(t=i.getItem(t.$parent)).id&&"split"==t.type||t.open)||t.open&&r)return!1;return!0},t.prototype.categories=function(t){return this._categories&&!t||(this._categories?this._categories.clearAll():this._categories=new webix.DataCollection({}),this._categories.parse(this.app.getService("backend").categories())),this._categories},t.prototype.resources=function(t){var e=this;if(this._resources&&!t)return this._resources;this._resources?this._resources.clearAll():this._resources=new webix.DataCollection({});var i=[this.app.getService("backend").resources(),this.categories(t).waitData];return this.app.config.resourceCalendars&&i.push(this.calendars(t).waitData),this._resources.parse(webix.promise.all(i).then((function(t){var i=t[0];return i.forEach((function(t){if(t.category_id){var i=e.categories().getItem(t.category_id);t.category=i.name,!t.unit&&i.unit&&(t.unit=i.unit)}})),i.sort(e.app.getService("operations").sortResources),i}))),this._resources},t.prototype.assignments=function(t){return this._assignments&&!t||(this._assignments?this._assignments.clearAll():this._assignments=new webix.DataCollection({}),this._assignments.parse(this.app.getService("backend").assignments())),this._assignments},t.prototype.getAssignments=function(t){var e=this;return webix.promise.all([this.resources().waitData,this.assignments().waitData]).then((function(){var i=e.resources();return e.assignments().data.find((function(e){return e.task==t})).map((function(t){var e=Object.assign({},t),n=Object.assign({},i.getItem(t.resource));return delete n.id,Object.assign(e,n)}))}))},t.prototype.calendars=function(t){return this._calendars&&!t||(this._calendars?this._calendars.clearAll():this._calendars=this.createCalendars(),this._calendars.parse(this.app.getService("backend").calendars())),this._calendars},t.prototype.createCalendars=function(){return new webix.DataCollection({scheme:{$change:function(t){"string"==typeof t.weekDays&&(t.weekDays=t.weekDays.split(",").map((function(t){return 1*t}))),t.holidays&&("string"==typeof t.holidays&&(t.holidays=t.holidays.split(",")),t.holidays=t.holidays.map((function(t){return webix.Date.datePart(new Date(t))})))}}})},t.prototype.showCriticalPath=function(t){var e=this;if(t)this._tasks.data.order.forEach((function(t){delete e._tasks.getItem(t).$critical}));else{var i=this._tasks.data.getRange().sort((function(t,e){return e.end_date-t.end_date||(t.parent==e.id?1:e.parent==t.id?-1:0)||e.start_date-t.start_date})),n=webix.Date.copy(i[0].end_date);i.forEach((function(t){t.$critical=e.isTaskCritical(t,n)}))}this._tasks.data.callEvent("onStoreUpdated",[null,null,"paint"])},t.prototype.isTaskCritical=function(t,e){if(e&&webix.Date.equal(e,t.end_date))return!0;for(var i=this._links.find((function(e){return e.source==t.id&&0==e.type})),n=0;n<i.length;++n){var r=this._tasks.getItem(i[n].target);if(r.$critical&&this.isNoSlack(r.start_date,t.end_date,t.id))return!0}if(0!=t.parent){var a=this._tasks.getItem(t.parent);return a.$critical&&t.end_date>=a.end_date}return!1},t.prototype.isNoSlack=function(t,e,i){if(this.app.config.excludeHolidays){if(e>=t)return!0;for(var n=webix.Date.copy(e);n<t;){if(!this.isHoliday(n,i))return!1;webix.Date.add(n,1,"day")}return!0}return e>=t},t.prototype.isLinkCritical=function(t){var e=!1;if(0==t.type){var i=this.tasks(),n=i.getItem(t.source),r=i.getItem(t.target);e=n&&r&&n.$critical&&r.$critical}return e},t.prototype.getVisibleTasksCollection=function(t){if(!t&&"resources"==this.state.display){var e=this.app.getService("grouping");return e?e.getResourceTree():null}return this._tasks},t.prototype.taskCalendarMap=function(t,e){var i=this;if(t)return this._calendarMap||null;this._calendarMap||(this.assignments().data.attachEvent("onStoreUpdated",(function(){i.refreshCalendarMap()})),this.resources().data.attachEvent("onStoreUpdated",(function(){i.refreshCalendarMap()})),this.calendars().data.attachEvent("onStoreUpdated",(function(){i.refreshCalendarMap()})));var n=[this.assignments(e).waitData,this.resources(e).waitData];return e||n.push(this.calendars().waitData),webix.promise.all(n).then((function(){return i._calendarMap||i.refreshCalendarMap(),i._calendarMap}))},t.prototype.refreshCalendarMap=function(){var t=this.resources(),e=this.calendars(),i={};return this.assignments().data.each((function(n){var r=t.getItem(n.resource);if(r){var a=r.calendar_id,o=a?e.getItem(a):null;o&&!i[n.task]&&(i[n.task]=o)}})),this._calendarMap=i},t.prototype.getTaskCalendar=function(t){var e=this.taskCalendarMap(!0);return e?e[t]:null},t.prototype.isHoliday=function(t,e){if(e&&this._calendarMap){var i=this._calendarMap[e];if(i)return this.Helpers.isResourceHoliday(t,i)}return this.app.config.isHoliday(t)},t.prototype.clearAll=function(){var t=this,e=this.app.getService("grouping");this.state.$batch({edit:null,selected:null,sort:null,top:0,left:0}),this.app.config.resourcesDiagram&&e.getRDCollection().clearAll(),this.app.config.resources&&e.getResourceTree().clearAll(),["tasks","links","resources","categories","assignments","calendars"].forEach((function(e){var i="_"+e;t[i]&&t[i].clearAll()})),this.resetScales()},t.prototype.reload=function(){var t=this;this.clearAll();var e=this.app.getService("grouping"),i=["tasks","links"],n=[];this.app.config.resources&&!this.app.config.resourceCalendars&&i.push("resources","assignments"),i.forEach((function(e){var i=t[e](!0);n.push(i.waitData)})),this.app.config.resourcesDiagram&&e.getRDCollection(!0),webix.promise.all(n).then((function(){t.app.refresh()}))},t.prototype.updateScaleMinMax=function(t){var e=this,i=1/0,n=-1/0;if(t.data.each((function(t){t.start_date<i&&(i=t.start_date),t.end_date>n&&(n=t.end_date),e.state.baseline&&t.planned_start&&t.planned_end&&(t.planned_start<i&&(i=t.planned_start),t.planned_end>n&&(n=t.planned_end))})),"object"==typeof i){var r=this.getScales();this.setScales(this.Helpers.addUnit(r.minUnit,i,-1),this.Helpers.addUnit(r.minUnit,n,1),r.precise)}},t}(),gt=function(){function t(t,e){this.app=t,this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.tasks=function(){return webix.ajax(this.url("tasks")).then((function(t){return t.json()}))},t.prototype.links=function(){return webix.ajax(this.url("links")).then((function(t){return t.json()}))},t.prototype.resources=function(){return webix.ajax(this.url("resources")).then((function(t){return t.json()}))},t.prototype.categories=function(){return webix.ajax(this.url("categories")).then((function(t){return t.json()}))},t.prototype.assignments=function(){return webix.ajax(this.url("assignments")).then((function(t){return t.json()}))},t.prototype.calendars=function(){return webix.ajax(this.url("calendars")).then((function(t){return t.json()}))},t.prototype.addTask=function(t,e,i){var n=webix.ajax().post(this.url("tasks"),r(r({},t),{mode:e,parent:i})).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[n]),n},t.prototype.removeTask=function(t){var e=webix.ajax().del(this.url("tasks/"+t)).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.updateTask=function(t,e,i){var n=webix.ajax().put(this.url("tasks/"+t+(i?"/split":"")),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[n]),n},t.prototype.reorderTask=function(t,e){var i=webix.ajax().put(this.url("tasks/"+t+"/position"),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[i]),i},t.prototype.addLink=function(t){var e=webix.ajax().post(this.url("links"),t).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.updateLink=function(t,e){var i=webix.ajax().put(this.url("links/"+t),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[i]),i},t.prototype.removeLink=function(t){var e=webix.ajax().del(this.url("links/"+t)).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.addAssignment=function(t){var e=webix.ajax().post(this.url("assignments"),t).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.updateAssignment=function(t,e){var i=webix.ajax().put(this.url("assignments/"+t),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[i]),i},t.prototype.removeAssignment=function(t){var e=webix.ajax().del(this.url("assignments/"+t)).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t}(),vt=function(){function t(t){this.app=t,this._local=this.app.getService("local"),this._helpers=this.app.getService("helpers"),this._back=this.app.getService("backend"),this._state=this.app.getState()}return t.prototype.addTask=function(t,e,i,n){var a=this;this.updateTaskDuration(t,n),t.planned_start&&this.updatePlannedTaskDuration(t,n);var o=0==e?"first":"last";return this._back.addTask(this.cleanData(t),o,i).then((function(n){return a._local.adjustScale(t),a._local.tasks().add(r(r({},t),{id:n.id,parent:i}),e,i),a.completeAdd(i,n)}))},t.prototype.splitTaskWithDnd=function(t,e,i,n){var a=this;return this.updateTaskDuration(t),this._back.updateTask(i,r(r({},t),{position:e,parent:i}),!0).then((function(o){a._local.adjustScale(t);var s=a._local.tasks();return s.updateItem(i,{type:"split",duration:n.duration||1,progress:n.progress||0}),(o.sibling&&0!=o.sibling||!s.find((function(t){return t.parent==i}),!0))&&(s.add(r(r({},n),{type:"task",parent:i,id:o.sibling,duration:n.duration||1,progress:n.progress||0}),0,i),++e),s.add(r(r({},t),{id:o.id,parent:i,position:e}),e,i),a.completeAdd(i,o,o.sibling)}))},t.prototype.completeAdd=function(t,e,i){var n=this;return t?this.syncProject(t).then((function(){return n._state.criticalPath&&n._local.showCriticalPath(),i&&(e.sibling=i),e})):webix.promise.resolve(e)},t.prototype.updateTask=function(t,e,i,n){var a=this,o=this._local.tasks(),s=webix.copy(o.getItem(t)),l=r(r({},s),e),u=!(webix.Date.equal(s.start_date,l.start_date)&&webix.Date.equal(s.end_date,l.end_date));u&&this.updateTaskDuration(l,i);var c=l.planned_start&&!(webix.Date.equal(s.planned_start,l.planned_start)&&webix.Date.equal(s.planned_end,l.planned_end));return c&&this.updatePlannedTaskDuration(l,i),n||"project"!=l.type||"project"==s.type?this._back.updateTask(t,this.cleanData(l)).then((function(){var e=a._local.getScales(),i=e.start,r=e.end;return(i>l.start_date||r<l.end_date||c&&(i>l.planned_start||r<l.planned_end))&&a._local.adjustScale(l),o.updateItem(t,l),"task"!=l.type&&"task"==s.type&&a.removeAssignments(l),n||!u&&s.progress==l.progress&&s.parent==l.parent||(s.$count&&"project"==s.type?a.syncTasks(t,s.start_date,l.start_date).then((function(){return a.syncProject(s.parent)})):s.parent!=l.parent?webix.promise.all([a.syncProject(l.parent),a.syncProject(s.parent)]):a.syncProject(l.parent)).then((function(){a._state.criticalPath&&(o.updateItem(t,{$critical:!1}),a._local.showCriticalPath())})),l})):this.syncProject(t,l)},t.prototype.updateTaskDuration=function(t,e){var i=this;if(this.app.config.excludeHolidays){var n=void 0;if(e){var r=(e="move"==e?"start":e)+("start"===e||"end"===e?"_date":"");n=this._local.tasks().getItem(t.id)[r]>t[r]?-1:1,"start"!=e&&(e="end")}var a=webix.copy(this._local.getScales());a.isHoliday=function(e){return i._local.isHoliday(e,t.id)},this._helpers.updateTaskDuration(t,a,e,n)}else this._helpers.updateTaskDuration(t)},t.prototype.updatePlannedTaskDuration=function(t,e){var i=this;if(this.app.config.excludeHolidays){var n=void 0;if(e){var r="planned_"+e;n=this._local.tasks().getItem(t.id)[r]>t[r]?-1:1}var a=webix.copy(this._local.getScales());a.isHoliday=function(e){return i._local.isHoliday(e,t.id)},this._updatePlannedTaskDuration(t,a,e,n)}else this._updatePlannedTaskDuration(t)},t.prototype._updatePlannedTaskDuration=function(t,e,i,n){var a=r({},t);a.start_date=t.planned_start,a.duration=t.planned_duration,a.end_date=t.planned_end,this._helpers.updateTaskDuration(a,e,i,n),t.planned_start=a.start_date,t.planned_end=a.end_date,t.planned_duration=a.duration},t.prototype.syncTasks=function(t,e,i){var n=this,a=i-e;if(this.app.config.excludeHolidays&&(a=this.getWorkDateDiff(a,e,t)),a){var o=[];return this._local.tasks().data.eachSubItem(t,(function(t){var e=t.start_date.valueOf()+a;if(n.app.config.excludeHolidays){var i=a-n.getWorkDateDiff(a,t.start_date,t.id);i&&(e+=i)}var s=r(r({},t),{start_date:new Date(e),end_date:null});o.push(n.updateTask(t.id,s,"move",!0))})),webix.promise.all(o)}return webix.promise.resolve()},t.prototype.getWorkDateDiff=function(t,e,i){for(var n=Math.sign(t),r=n*Math.floor(t/864e5),a=0,o=e;a<r;++a)webix.Date.add(o,n,"day"),this._local.isHoliday(o,i)&&(t-=864e5*n);return t},t.prototype.syncProject=function(t,e){var i=this,n=this._local.tasks();if(!e)if(e=n.getItem(t),this.app.config.projects&&e&&"split"!=e.type)e.type=e.$count?"project":"task",this.removeAssignments(e);else for(;e&&"project"!=e.type;)t=n.getParentId(t),e=n.getItem(t);return e&&e.$count&&(e=this.setProjectData(e)),e?this.updateTask(t,e,"start",!0).then((function(){return i.syncProject(e.parent),e})):webix.promise.resolve()},t.prototype.setProjectData=function(t,e,i){i||(t=webix.copy(t));var n=1/0,r=0,a=0,o=0,s=function(t){n=t.start_date<n?t.start_date:n,r=t.end_date>r?t.end_date:r,!t.duration||"project"==t.type&&t.$count||(a+=t.duration*t.progress,o+=1*t.duration)};return i?i.forEach(s):(e||this._local.tasks()).data.eachSubItem(t.id,s),webix.Date.equal(t.start_date,n)||(t.start_date=n,t.duration=null),webix.Date.equal(t.end_date,r)||(t.end_date=r,t.duration=null),t.progress=a?Math.round(a/o):a,t},t.prototype.updateTaskTime=function(t,e,i){var n=this._local.tasks().getItem(t),r={},a=this._local.getScales(),o=a.precise?this._helpers.getSmallerUnit(a.minUnit):a.minUnit;if("start"===e||"move"===e){var s=a.precise?n.start_date:this._helpers.getUnitStart(o,n.start_date);r.start_date=this._helpers.addUnit(o,s,i),"start"===e&&r.start_date>n.end_date&&(r.start_date=this._helpers.addUnit(o,n.end_date,-1))}else if("end"===e){var l=this._helpers.getUnitStart(o,n.end_date);s=a.precise||webix.Date.equal(l,n.end_date)?n.end_date:this._helpers.addUnit(o,l,1),r.end_date=this._helpers.addUnit(o,s,i),r.end_date<n.start_date&&(r.end_date=this._helpers.addUnit(o,n.start_date,1))}return"move"===e?r.end_date=null:r.duration=0,this.updateTask(t,r,e)},t.prototype.removeTask=function(t){var e=this,i=this._local.tasks(),n=this._local.links();return n.find((function(e){return e.source==t||e.target==t})).forEach((function(t){return n.remove(t.id)})),this._back.removeTask(t).then((function(n){var r=i.getItem(t).parent;return i.remove(t),e.app.config.split&&0!=r&&"split"===i.getItem(r).type&&!i.find((function(t){return t.parent==r}),!0)?e.updateTask(r,{type:"task"}).then((function(){return e.completeRemoval(n,r)})):e.completeRemoval(n,r)}))},t.prototype.completeRemoval=function(t,e){var i=this;return this.syncProject(e).then((function(){return i._state.criticalPath&&i._local.showCriticalPath(),t}))},t.prototype.addLink=function(t){var e=this;return this.linkExists(t)?webix.promise.reject():this._back.addLink(t).then((function(i){return t.id=i.id,e._local.links().add(t),t}))},t.prototype.linkExists=function(t){return this._local.links().find((function(e){return e.target==t.target&&e.source==t.source&&e.type==t.type}),!0)},t.prototype.updateLink=function(t,e){var i=this;return this._back.updateLink(t,e).then((function(n){var a=i._local.links(),o=i.linkExists(r(r({},a.getItem(t)),e));return a.updateItem(t,e),o?i.removeLink(o.id).then((function(){return n})):n}))},t.prototype.removeLink=function(t){var e=this;return this._back.removeLink(t).then((function(i){return e._local.links().remove(t),i}))},t.prototype.moveTask=function(t,e,i){var n=this;e=e||0;var r=this._local.tasks(),a=r.data.branch[e],o=r.getItem(t).parent,s=r.data.getBranchIndex(t);return e==o&&(i===s||-1===i&&t===a[a.length-1])?webix.promise.reject():(r.move(t,i,null,{parent:e}),this._back.reorderTask(t,{parent:e,mode:0===i?"first":-1===i?"last":"after",target:r.data.branch[e][i-1]}).then((function(i){return e!==o?(r.updateItem(t,{parent:e}),webix.promise.all([n.syncProject(e),n.syncProject(o)]).then((function(){return n._state.criticalPath&&n._local.showCriticalPath(),i}))):i})))},t.prototype.updateAssignment=function(t,e){var i=this;return this._back.updateAssignment(t,e).then((function(n){return i._local.assignments().updateItem(t,e),n}))},t.prototype.addAssignment=function(t){var e=this;return this._back.addAssignment(t).then((function(i){return t.id=i.id,e._local.assignments().add(t),t}))},t.prototype.removeAssignment=function(t){var e=this;return this._back.removeAssignment(t).then((function(i){return e._local.assignments().remove(t),i}))},t.prototype.sortResources=function(t,e){return t.category==e.category?t.name>e.name?1:-1:t.category>e.category?1:-1},t.prototype.removeAssignments=function(t){var e=this;if(this.app.config.resources){var i=this._local.assignments(),n=[];return i.waitData.then((function(){return i.data.each((function(i){i.task==t.id&&n.push(e.removeAssignment(i.id))})),n.length?webix.promise.all(n):webix.promise.resolve(!1)}))}return webix.promise.resolve(!1)},t.prototype.cleanData=function(t){var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},t.prototype.updateAssignedTaskDates=function(t){var e=webix.copy(t);this.updateTaskDuration(e),(!webix.Date.equal(t.start_date,e.start_date)||!webix.Date.equal(t.end_date,e.end_date))&&this.updateTask(t.id,e,null,!0)},t}();function mt(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function wt(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function _t(t){wt(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new Date(t.getTime()):"number"==typeof t||"[object Number]"===e?new Date(t):("string"!=typeof t&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function yt(t,e){wt(2,arguments);var i=_t(t),n=mt(e);return isNaN(n)?new Date(NaN):n?(i.setDate(i.getDate()+n),i):i}function bt(t,e){wt(2,arguments);var i=_t(t),n=mt(e);if(isNaN(n))return new Date(NaN);if(!n)return i;var r=i.getDate(),a=new Date(i.getTime());return a.setMonth(i.getMonth()+n+1,0),r>=a.getDate()?a:(i.setFullYear(a.getFullYear(),a.getMonth(),r),i)}function xt(t,e){wt(2,arguments);var i=_t(t).getTime(),n=mt(e);return new Date(i+n)}function St(t,e){wt(1,arguments);var i=e||{},n=i.locale,r=n&&n.options&&n.options.weekStartsOn,a=null==r?0:mt(r),o=null==i.weekStartsOn?a:mt(i.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=_t(t),l=s.getDay(),u=(l<o?7:0)+l-o;return s.setDate(s.getDate()-u),s.setHours(0,0,0,0),s}function $t(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function Ct(t){wt(1,arguments);var e=_t(t);return e.setHours(0,0,0,0),e}function kt(t,e){wt(2,arguments);var i=_t(t),n=_t(e),r=i.getTime()-n.getTime();return r<0?-1:r>0?1:r}function Dt(t,e){return wt(2,arguments),_t(t).getTime()-_t(e).getTime()}var Tt={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}};function Et(t){return t?Tt[t]:Tt.trunc}function Lt(t){wt(1,arguments);var e=_t(t);return function(t){wt(1,arguments);var e=_t(t);return e.setHours(23,59,59,999),e}(e).getTime()===function(t){wt(1,arguments);var e=_t(t),i=e.getMonth();return e.setFullYear(e.getFullYear(),i+1,0),e.setHours(23,59,59,999),e}(e).getTime()}function At(t,e){wt(2,arguments);var i,n=_t(t),r=_t(e),a=kt(n,r),o=Math.abs(function(t,e){wt(2,arguments);var i=_t(t),n=_t(e);return 12*(i.getFullYear()-n.getFullYear())+(i.getMonth()-n.getMonth())}(n,r));if(o<1)i=0;else{1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-a*o);var s=kt(n,r)===-a;Lt(_t(t))&&1===o&&1===kt(t,r)&&(s=!1),i=a*(o-Number(s))}return 0===i?0:i}function It(t,e){var i=t.getDay();return e&&(0===i?i=6:i--),i}var Pt={year:function(t,e){wt(2,arguments);var i=_t(t),n=_t(e),r=kt(i,n),a=Math.abs(function(t,e){wt(2,arguments);var i=_t(t),n=_t(e);return i.getFullYear()-n.getFullYear()}(i,n));i.setFullYear(1584),n.setFullYear(1584);var o=kt(i,n)===-r,s=r*(a-Number(o));return 0===s?0:s},quarter:function(t,e,i){wt(2,arguments);var n=At(t,e)/3;return Et(null==i?void 0:i.roundingMethod)(n)},month:At,week:function(t,e,i){return function(t,e,i){wt(2,arguments);var n=St(t,i),r=St(e,i),a=n.getTime()-$t(n),o=r.getTime()-$t(r);return Math.round((a-o)/6048e5)}(t,e,{weekStartsOn:i?1:0})},day:function(t,e){wt(2,arguments);var i=Ct(t),n=Ct(e),r=i.getTime()-$t(i),a=n.getTime()-$t(n);return Math.round((r-a)/864e5)},hour:function(t,e,i){wt(2,arguments);var n=Dt(t,e)/36e5;return Et(null==i?void 0:i.roundingMethod)(n)},minute:function(t,e,i){wt(2,arguments);var n=Dt(t,e)/6e4;return Et(null==i?void 0:i.roundingMethod)(n)}},Rt={year:["quarter",4],quarter:["month",3],month:["day",function(t){if(!t)return 30;var e=t.getMonth();if(1===e){var i=t.getFullYear();return i%4?28:i%100?29:i%400?28:29}return e%2&&e<7||!(e%2)&&e>7?30:31}],week:["day",7],day:["hour",24],hour:["minute",60],minute:["minute",1]},Mt={year:function(t,e){return wt(2,arguments),bt(t,12*mt(e))},quarter:function(t,e){return wt(2,arguments),bt(t,3*mt(e))},month:bt,week:function(t,e){return wt(2,arguments),yt(t,7*mt(e))},day:yt,hour:function(t,e){return wt(2,arguments),xt(t,36e5*mt(e))},minute:function(t,e){return wt(2,arguments),xt(t,6e4*mt(e))}};function Vt(t,e,i,n,r,a){var o=t;if(r){var s=Rt[t][0];"number"!=typeof s&&"function"!=typeof s&&(o=s)}var l=i,u=e;if(a&&(l=Bt(o,l,n),(u=Bt(o,u,n))<e&&(u=Ht(o)(u,1))),r){var c=Pt[o](u,l),h=Rt[t][1],p=0;return"function"==typeof h?p=h(i):"number"==typeof h&&(p=h),c/p}return Pt[o](u,l,n)}function Ot(t){return function(e,i,n,r,a){return"month"===t&&r?function(t,e,i){if(Ft(e,t))return Vt("month",t,e,null,!0,i);var n=0;if(e.getDate()>1){var r=new Date(e.getFullYear(),e.getMonth()+1,1);n=Vt("month",r,e,null,!0),e=r}var a=0;return Ft(e,t)||(a=Vt("month",Bt("month",t),e),e=Ht("month")(e,a)),n+a+Vt("month",t,e,null,!0)}(e,i,a):Vt(t,e,i,n,r,a)}}function Ft(t,e){return Bt("month",t).valueOf()===Bt("month",e).valueOf()}function Ht(t){return Mt[t]}function Bt(t,e,i){var n;switch(t){case"year":return new Date(e.getFullYear(),0,1);case"quarter":return new Date(e.getFullYear(),3*Math.floor(e.getMonth()/3),1);case"month":return new Date(e.getFullYear(),e.getMonth(),1);case"week":return(n=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(e.getDate()-It(e,i)),n;case"day":return(n=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(0,0,0,0),n;case"hour":return(n=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(e.getHours(),0,0,0),n;default:return new Date(e)}}function Ut(t,e,i,n,r){var a=i.start,o=i.end,s=i.cellWidth,l=i.cellHeight,u=i.diff,c=i.minUnit,h=i.precise,p=t.start_date<a?a:t.start_date,d=t.end_date>o?o:t.end_date,f=Bt(c,a,i.startOnMonday),g="milestone"==t.type;t.$h=n,t.$x=Math.round(u(p,f,i.startOnMonday,h)*s)-(g?t.$h/2:0),t.$w=g?t.$h:Math.round(u(d,p,i.startOnMonday,h,!0)*s),t.$y=void 0===r?l*e+(l-n)/2:r}function Nt(t){t.duration=0,t.end_date=t.start_date}function jt(t){return t.duration<1?Ht("hour")(t.start_date,Math.floor(24*t.duration)):Ht("day")(t.start_date,t.duration)}function Gt(t,e){if(t.duration<1)return jt(t);for(var i=function(t,e){var i=new Date(t.valueOf());return i.setHours(0),i.getDate()!=t.getDate()?t.setHours(1):t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}(t.start_date),n=0,r=0;n<t.duration;)e.isHoliday(i)?30==++r&&Wt():(++n,r=0),i=Ht("day")(i,1);return i}function Yt(t,e){var i=Ot("day")(t.end_date,t.start_date,!0);if(i<1)return parseFloat(i.toFixed(2));if(!e)return Math.floor(i);for(var n=t.start_date,r=0;n<t.end_date;)e.isHoliday(n)||++r,n=Ht("day")(n,1);return r}function zt(t,e){for(var i,n=t,r=t,a=0;a<30&&(i=e.isHoliday(r))&&e.isHoliday(n);)n=Ht("day")(n,-1),r=Ht("day")(r,1),a++;return 30===a&&Wt(),i?n:r}function Wt(){throw alert("No work days found within 30 days, check your isHoliday function!"),"Wrong isHoliday function"}function qt(t,e,i,n){for(var r=0;r<30&&i.isHoliday(Kt(t,e));)t=Ht("day")(t,n),r++;return 30===r&&Wt(),t}function Kt(t,e){return e&&!function(t,e){return(t.valueOf()/1e3-60*t.getTimezoneOffset())%86400}(t)?Ht("day")(t,-1):t}var Xt=function(){function t(t){this.app=t,this.defaultResourceUnit="hour",this.defaultResourceValues={hour:8},this.resourceValueRanges={hour:[.5,24]},this.resourceValueSteps={hour:.5},this.unitLoadNorm={day:8,week:40,month:170,quarter:510,year:2040}}return t.prototype.initials=function(t){var e=t.match(/\b\w/g)||[];return 1==e.length?t.charAt(0).toUpperCase()+t.charAt(1):((e.shift()||"")+(e.pop()||"")).toUpperCase()},t.prototype.avatarCss=function(t){return" webix_gantt_person_avatar_"+(t.charCodeAt(1)+t.length%10)%10},t.prototype.resourceAvatar=function(t,e,i){var n="webix_gantt_person_avatar";if("string"==typeof e&&(n+=" "+e),t.avatar)return'<img class="'+n+'" src="'+t.avatar+'" webix_tooltip="'+(i?t.name:"")+'"/>';var r=t.name;return"<div class='"+n+" "+(r?this.avatarCss(r):"")+"' webix_tooltip=\""+(i?t.name:"")+'">'+(r?this.initials(r):"")+"</div>"},t.prototype.getDefaultResourceValue=function(t){var e=this.getResourceUnit(t);return this.defaultResourceValues[e]},t.prototype.getResourceUnit=function(t){return t.unit||this.defaultResourceUnit},t.prototype.getResourceValueRange=function(t){var e=this.getResourceUnit(t);return this.resourceValueRanges[e]||[1,100]},t.prototype.getResourceValueStep=function(t){var e=this.getResourceUnit(t);return this.resourceValueSteps[e]||null},t.prototype.isResourceHoliday=function(t,e){var i=!1;return e.holidays&&(i=e.holidays.find((function(e){return e.getTime()==t.getTime()}))),e.weekDays&&(i=i||-1==e.weekDays.indexOf(t.getDay())),i},t.prototype.addUnit=function(t,e,i){return Ht(t)(e,i)},t.prototype.getDifference=function(t,e,i){return Ot(t)(e,i,webix.Date.startOnMonday)},t.prototype.getUnitStart=function(t,e){return Bt(t,e,webix.Date.startOnMonday)},t.prototype.updateTask=function(t,e){var i=this.app.getService("local");return function(t,e,i,n,r){return"split"===t.type&&t.$data&&t.$data.length?t.$data.forEach((function(t){return Ut(t,e,i,n)})):Ut(t,e,i,n,void 0),t}(t,e,i.getScales(),i.getTaskHeight())},t.prototype.setScales=function(t,e,i,n,r,a){return function(t,e,i,n,r,a,o,s){var l=function(t){var e=new Date;return t.map((function(t){return{item:t,len:Ht(t.unit)(e,1)}})).sort((function(t,e){return t.len<e.len?-1:1}))[0].item.unit}(a),u=Ot(l),c=Bt(l,e,s);t=Bt(l,t,s),e=c<e?Ht(l)(c,1):c;var h=u(e,t,s)*n,p=r*a.length;return{rows:a.map((function(i){for(var a=[],o=Ht(i.unit),c=i.step||1,h="week"===l&&"week"!==i.unit,p=Bt(i.unit,t,s);p<e;){var d=o(p,c);p<t&&(p=t),d>e&&(d=e);var f=p,g=d;h&&(It(p,s)>3&&(f=Ht("week")(p,1)),It(d,s)>3&&(g=Ht("week")(d,1)));var v=(u(g,f,s)||1)*n,m="";i.css&&(m+="function"==typeof i.css?i.css(p):i.css),a.push({width:v,css:m,date:p,format:i.format}),p=d}return{cells:a,add:o,height:r,type:i.unit,step:i.step||1}})),width:h,height:p,cellWidth:n,cellHeight:r,diff:u,start:t,end:e,minUnit:l,precise:i=!!("day"===l?i:0!=i),isHoliday:o,startOnMonday:s}}(t,e,i,n,r,a,this.app.config.isHoliday,webix.Date.startOnMonday)},t.prototype.updateLink=function(t,e,i){return function(t,e,i,n){var r=Math.round(n/2);if(!e||!i)return t.$p="",t;var a=!1,o=!1;switch(t.type){case 0:o=!0;break;case 1:a=!0,o=!0;break;case 3:a=!0}var s,l,u=a?e.$x:e.$x+e.$w,c=e.$y,h=o?i.$x:i.$x+i.$w,p=i.$y;if(function(t,e,i,n,r){return"milestone"===t.type||"milestone"===e.type?Math.abs(i-n)>r/2:i!==n}(e,i,u,h,n)||c!==p){var d=function(t,e,i,n,r,a,o){var s=t+20*(r?-1:1),l=i+20*(a?-1:1),u=[t,e,s,e,0,0,0,0,l,n,i,n],c=l-s,h=n-e,p=a===r;return!p&&(l<=t+20-2&&a||l>t&&!a)&&(h-=19),p&&a&&s>l||p&&!a&&s<l?(u[4]=u[2]+c,u[5]=u[3],u[6]=u[4],u[7]=u[5]+h):(u[4]=u[2],u[5]=u[3]+h,u[6]=u[4]+c,u[7]=u[5]),u.join(",")}(u,c+r,h,p+r,a,o),f=(s=h,l=p+r,o?s-5+","+(l-3)+","+(s-5)+","+(l+3)+","+s+","+l:s+5+","+(l+3)+","+(s+5)+","+(l-3)+","+s+","+l);t.$p=d+","+f}else t.$p="";return t}(t,e,i,this.app.getService("local").getTaskHeight())},t.prototype.updateTaskDuration=function(t,e,i,n){return function(t,e,i,n){t.start_date&&t.end_date&&t.start_date.valueOf()>=t.end_date.valueOf()&&(t.end_date=null,t.duration=1,i&&(i="move")),e?function(t,e,i,n){if("milestone"==t.type)return t.start_date=i?qt(t.start_date,!1,e,n):zt(t.start_date,e),Nt(t);i?"start"==i||"move"==i?(t.start_date=qt(t.start_date,!1,e,n),t.duration||(t.duration=Yt(t,e)),t.end_date||(t.end_date=Gt(t,e))):(t.end_date||(t.end_date=Gt(t,e)),t.duration||(t.end_date=qt(t.end_date,!0,e,n),t.duration=Yt(t,e))):(t.start_date=zt(t.start_date,e),t.end_date=Gt(t,e),t.duration=Yt(t,e))}(t,e,i,n):"milestone"==t.type?Nt(t):(t.duration||(t.duration=Yt(t)),t.end_date||(t.end_date=jt(t)))}(t,e,i,n)},t.prototype.getSmallerUnit=function(t){return Rt[t][0]},t.prototype.getSmallerCount=function(t){return Rt[t][1]},t.prototype.newLink=function(t,e,i){return function(t,e,i){if(e&&i){var n=i.x-e.x,r=i.y-e.y,a=(n>0?e.x:i.x)-t.left,o=(r>0?e.y:i.y)-t.top,s=(n>0?0:-n)+","+(r>0?0:-r)+","+(n>0?n:0)+","+(r>0?r:0);return{width:Math.abs(n),height:Math.abs(r),left:a,top:o,p:s}}return null}(t,e,i)},t.prototype.drawGridInner=function(t,e,i){return function(t,e,i){var n=document.createElement("canvas");n.setAttribute("width",t+""),n.setAttribute("height",e+"");var r=n.getContext("2d");return r.strokeStyle=i,r.moveTo(0,e),r.lineTo(t,e),r.lineTo(t,0),r.stroke(),n.toDataURL()}(t,e,i)},t}(),Qt=function(){function t(t){this.app=t,this.local=t.getService("local"),this.helpers=t.getService("helpers"),this.closedResources=null}return t.prototype.getTreeData=function(t,e){var i=this,n=t.filter((function(t){return t.parent==e}));return n.forEach((function(e){var n=i.getTreeData(t,e.id);n&&(e.data=n)})),n},t.prototype.getRDCollection=function(t){var e=this;if(this._rdCollection&&!t)return this._rdCollection;var i=this.local.tasks(),n=this.local.assignments(),r=this.local.resources();return this._rdCollection?this._rdCollection.clearAll():(this._rdCollection=new webix.TreeCollection({}),webix.extend(this._rdCollection,webix.Group),this.syncRDWithData()),webix.promise.all([i.waitData,n.waitData,r.waitData]).then((function(){var t=[],i=e.local.getScales();n.data.each((function(n){var r=e.getDiagramItemData(n,i);r&&t.push(r)})),e._rdCollection.parse(t),e.groupResourceDiagram()})),this._rdCollection},t.prototype.syncRDWithData=function(){var t=this;this.app.on("onScalesUpdate",(function(e,i){t._rdCollection&&t._rdCollection.data.order.length&&(t.refreshTaskDiagram(),e.minUnit!==i.minUnit&&(t.updateUnitDurations(),t.groupResourceDiagram()))})),this.local.tasks().data.attachEvent("onStoreUpdated",(function(e,i,n){n&&i&&("update"==n||"delete"==n||t.local.assignments().find((function(t){return t.task===i.id}),!0))&&(t.updateTaskDiagram(i,n),t.groupResourceDiagram())})),this.local.assignments().data.attachEvent("onStoreUpdated",(function(e,i,n){e&&(t.refreshResourceDiagram(e,i,n),t.groupResourceDiagram())}))},t.prototype.updateUnitDurations=function(){var t=this,e=this.local.tasks(),i=this.local.assignments(),n=this.local.getScales();this._rdCollection.data.each((function(a){if(a.task){var o=e.getItem(a.task),s=i.getItem(a.id);o&&s&&(a.duration=t.calculateUnitDuration(o,n),a.value=t.calculateLoad(r(r({},o),s),n.minUnit))}}))},t.prototype.calculateUnitDuration=function(t,e){return"day"===e.minUnit?t.duration:e.diff(t.end_date,t.start_date,webix.Date.startOnMonday,!1,!0)},t.prototype.getDiagramItemData=function(t,e){var i=this.local.tasks().getItem(t.task);if(i){this.local._isTaskVisible(i,!0)||this.helpers.updateTask(i,0);var n=this.local.resources().getItem(t.resource),a=r(r(r({},i),n),t);return a.duration=this.calculateUnitDuration(i,e),a.value=this.calculateLoad(a,e.minUnit),a.$x=this.truncateX(a.$x,e),a}return null},t.prototype.calculateLoad=function(t,e){var i=this.getUnitLoad(t);if("hour"===e)return[0,0,i/24];if("day"===e)return[0,0,i];var n,r=[],a=webix.Date.copy(t.start_date),o=this.helpers.getUnitStart(e,a),s=webix.Date.copy(t.end_date),l=this.helpers.getUnitStart(e,s);if(webix.Date.datePart(a,!0)>o)if(s>(n=this.helpers.addUnit(e,o,1))){var u=this.findUnitDuration(a,n,t);r.push(u),a=n}else r.push(0);else r.push(0);if(!webix.Date.equal(o,l)&&webix.Date.datePart(s,!0)>=l){var c=this.findUnitDuration(l,s,t);r.push(c),s=l}else r.push(0);var h=this.helpers.addUnit(e,a,1),p=this.findUnitDuration(a,new Date(Math.min(h,s)),t);return r.push(p),r.map((function(t){return t*i}))},t.prototype.findUnitDuration=function(t,e,i){var n=this.helpers.getDifference("day",e,t);if(this.app.config.excludeHolidays){var r=void 0,a=webix.Date.copy(t),o=n;for(r=0;r<o;r++)this.checkHoliday(a,i)&&n--,webix.Date.add(a,1,"day")}return n},t.prototype.checkHoliday=function(t,e){if(this.app.config.resourceCalendars){var i=this.local.resources().getItem(e.resource).calendar_id;if(i){var n=this.local.calendars().getItem(i);return this.helpers.isResourceHoliday(t,n)}}return this.app.config.isHoliday(t)},t.prototype.getUnitLoad=function(t){return t.value},t.prototype.truncateX=function(t,e){return!1!==e.precise?Math.floor(t/e.cellWidth)*e.cellWidth:t},t.prototype.refreshResourceDiagram=function(t,e,i){var n=this._rdCollection,a=this.local.getScales();switch(i){case"update":if(n.exists(t)){var o=this.local.tasks().getItem(e.task),s=r({},this.local.resources().getItem(e.resource));delete s.id;var l=this.calculateLoad(r(r({},o),e),a.minUnit);n.updateItem(t,r(r(r({},e),s),{value:l}))}break;case"add":n.add(this.getDiagramItemData(e,a));break;case"delete":n.exists(t)&&n.remove(t)}},t.prototype.updateTaskDiagram=function(t,e){var i=this,n=this._rdCollection,a=this.local.getScales();if("delete"===e)this.pruneDiagram();else if("add"===e){var o=this.local.assignments().find((function(e){return e.task===t.id}),!0);n.add(this.getDiagramItemData(o,a))}else"update"===e&&n.find((function(e){return e.task===t.id})).forEach((function(e){var o=i.local.assignments().getItem(e.id);n.updateItem(e.id,{start_date:t.start_date,id:e.id,duration:i.calculateUnitDuration(t,a),$x:i.truncateX(t.$x,a),value:i.calculateLoad(r(r({},t),o),a.minUnit)})}))},t.prototype.pruneDiagram=function(){var t=this.local.tasks(),e=[];this._rdCollection.data.eachLeaf(0,(function(i){t.exists(i.task)||e.push(i.id)})),e.length&&this._rdCollection.remove(e)},t.prototype.refreshTaskDiagram=function(){var t=this,e=this.local.getScales();this._rdCollection.data.each((function(i){var n=t.local.tasks().getItem(i.task);n&&(i.$x=t.truncateX(n.$x,e))}))},t.prototype.groupResourceDiagram=function(){var t=this._rdCollection;t.group({by:function(t){return t.name+"-"+t.category},map:{resource_id:["resource"],value:["name"],name:["name"],category:["category"],avatar:["avatar"],load:["value",Zt],duration:["duration",Jt],units:["value",Jt],$x:["$x",Jt],count:["value","count"],start_date:["start_date",Jt]}}),t.group({by:"category",map:{value:["category"],name:["category"],duration:["duration","sum"],load:["load","sum"],count:["count","sum"]}},0)},t.prototype.getResourceTree=function(){var t=this;return this._resourcesTree||(this._resourcesTree=new webix.TreeCollection({on:{"data->onStoreUpdated":function(e,i,n){e="update"==n||"paint"==n?e:null,t.refreshResourceTasks(e),t.local.refreshLinks()}},scheme:{$sort:{by:"start_date",dir:"asc",as:"int"}}}),this._resourcesTree.parse(this.resourceTaskLoader().finally((function(){t.syncResourceTree()})))),this._resourcesTree},t.prototype.tasksWithResources=function(){var t=this;return webix.promise.all([this.local.tasks().waitData,this.local.assignments().waitData]).then((function(){var e=[];return t.local.tasks().data.each((function(i){if("task"==i.type||!i.type){var n=Object.assign({},i),r=t.local.assignments().data.find((function(t){return t.task==n.id}));n.resources=r.length?r.map((function(t){return t.resource})):null,e.push(n)}}),"",!0),e}))},t.prototype.resourceTaskLoader=function(){var t=this,e=this.app.getService("operations");return webix.promise.all([this.tasksWithResources(),this.local.resources().waitData]).then((function(i){var n=t.getResourceTaskData(i[0]);return n.forEach((function(t){e.setProjectData(t,null,t.data)})),n}))},t.prototype.refreshResourceTree=function(){var t=this;this._resourcesTree.count()?(this.closedResources=[],this._resourcesTree.data.eachChild("0",(function(e){e.open||t.closedResources.push(e.resources)}))):this.closedResources=null,this.resourceTaskLoader().then((function(e){return t._resourcesTree.clearAll(),t._resourcesTree.parse(e),e}))},t.prototype.syncResourceTree=function(){var t=this,e=this._resourcesTree;this.local.tasks().data.attachEvent("onStoreUpdated",(function(i,n,r){if("update"==r){var a=e.exists(i)&&"task"==e.getItem(i).type,o="task"==n.type;if(a&&o){e.updateItem(i,{text:n.text,details:n.details,start_date:n.start_date,end_date:n.end_date,duration:n.duration,progress:n.progress});var s=e.getParentId(i),l=e.getItem(s);return l&&(l=t.app.getService("operations").setProjectData(l,e),e.updateItem(s,l)),!0}a^o&&t.refreshResourceTree()}else t.refreshResourceTree()})),this.local.assignments().data.attachEvent("onStoreUpdated",(function(){t.refreshResourceTree()}))},t.prototype.getResourceTaskData=function(t){var e=this,i=[],n=null,r=this.app.getService("operations");return t.forEach((function(t){var a,o=t.resources;(a=o?i.find((function(t){return it(t.resources,o)})):n||null)||((a={id:o?webix.uid():"unassigned",type:"project",text:"",data:[],$group:!0,open:e.checkResourceOpen(o)}).resources=o,o&&(a.text=o.map((function(t){return e.local.resources().getItem(t)})).sort(r.sortResources).map((function(t){return t.name})).join(", ")),o?i.push(a):(a.id="unassigned",n=a)),a.data.push(webix.copy(t))})),n&&i.push(n),i},t.prototype.refreshResourceTasks=function(t,e){var i=this,n=this._resourcesTree;if(t){var r=n.getItem(t);e=webix.isUndefined(e)?n.getIndexById(t):e,this.helpers.updateTask(r,e)}else n.data.order.forEach((function(t,e){i.refreshResourceTasks(t,e)}))},t.prototype.checkResourceOpen=function(t){return!this.closedResources||(t?!this.closedResources.find((function(e){return it(e,t)})):-1==this.closedResources.indexOf(null))},t}();function Jt(t,e){for(var i=[],n=0;n<e.length;n++)i.push(t(e[n]));return i}function Zt(t,e){for(var i=0,n=0;n<e.length;n++)for(var r=t(e[n]),a=parseInt(e[n].duration),o=r.length-1,s=0;s<r.length;++s){var l=r[s];l&&(i+=(s===o?a:1)*l,a--)}return i}var te=function(t){function e(e){var i,n,a,o=this,s=N({top:0,left:0,selected:null,edit:null,readonly:e.readonly||!1,sort:null,display:e.resources&&"resources"==e.display?"resources":"tasks",criticalPath:e.criticalPath||!1,resourcesDiagram:!(!e.resources||!e.resourcesDiagram),treeWidth:e.treeWidth||(e.resources?400:500),baseline:e.baseline||!1}),l=e.isHoliday||function(t){var e=t.getDay();return 0===e||6===e},u={router:y,version:"10.1.0",debug:!0,start:"/top",compactWidth:650,markers:[{css:"webix_gantt_today_marker",now:!0}],params:{state:s,forceCompact:e.compact},links:!0,isHoliday:l},c=function(t){return o.config.override&&o.config.override.get(t)||t};return(o=t.call(this,r(r({},u),e))||this).setService("helpers",new(c(Xt))(o,e)),o.setService("local",new(c(ft))(o,e)),o.setService("backend",new(c(gt))(o,e.url)),o.setService("operations",new(c(vt))(o)),o.setService("grouping",new(c(Qt))(o)),a={updateConfig:function(t){var e=i.getRoot(),r=e.$view;n?n&&!r.id&&(r.id=n):(r.id?n=r.id:r.id=n="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+n+"{ position: relative; }"),webix.html.addStyle("#"+n+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+n+" .webix_disabled{ z-index:1 !important; }")),t.container=n,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var a=!0,o=t.on.onShow;return t.on.onShow=function(){var t=this;o&&o.apply(this,arguments),a&&(this.$setSize=function(i,n){H(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},function(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){H(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}(this,i),a=null),webix.callEvent("onClick",[]),webix.html.addCss(r,"webix_win_inside"),e.disable(),H(this,e)},t}},(i=o).setService("jet-win",a),o.use(V,o.config.locale||{lang:"en",webix:{en:"en-US"}}),o}return n(e,t),e.prototype.require=function(t,e){return"jet-views"===t?dt[e]:"jet-locales"===t?ie[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(_);webix.protoUI({name:"gantt",app:te,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this,e=this.$app.getState();for(var i in e)U(e,this.config,i);this.$app.attachEvent("bars:beforedrag",(function(e,i){return t.callEvent("onBeforeDrag",[e,i])})),this.$app.attachEvent("bars:beforedrop",(function(e,i){return t.callEvent("onBeforeDrop",[e,i])}))},$exportView:function(t){return"png"===t.export_mode||"pdf"===t.export_mode&&"image"===t.display?this.$app.getRoot():this.$app.getService("local").tasks()},clearAll:function(){this.$app.getService("local").clearAll()},reload:function(){this.$app.getService("local").reload()}},webix.ui.jetapp);var ee={Local:ft,Backend:gt,Operations:vt,Helpers:Xt,Grouping:Qt},ie={en:{Edit:"Edit",Done:"Done","Delete task":"Delete task","Delete link":"Delete link","The task will be deleted permanently, are you sure?":"The task will be deleted permanently, are you sure?","The link will be deleted permanently, are you sure?":"The link will be deleted permanently, are you sure?",Predecessors:"Predecessors",Successors:"Successors",Title:"Title","Start date":"Start date","End date":"End date",Duration:"Duration",Progress:"Progress",Notes:"Notes",Type:"Type",Project:"Project",Milestone:"Milestone","Add task":"Add task","Add project":"Add project","(no title)":"(no title)","Save changes?":"Save changes?","Related tasks":"Related tasks",Task:"Task",Link:"Link","End to start":"End to start","Start to start":"Start to start","End to end":"End to end","Start to end":"Start to end",Lasts:"Lasts",day:"day",days:"days","Add assignment":"Add assignment",Assignment:"Assignment",Assignments:"Assignments",Assigned:"Assigned","Delete assignment":"Delete assignment","Are you sure to delete this assignment?":"Are you sure to delete this assignment?","No resources to add":"No resources to add",Unassigned:"Unassigned",hour:"h","Hours per":"Hours per","Tasks per":"Tasks per",Name:"Name",Hours:"Hours",Tasks:"Tasks",month:"month",week:"week",quarter:"quarter",year:"year","Split task":"Split task","Planned dates":"Planned dates","Planned dates will be removed, are you sure?":"Planned dates will be removed, are you sure?","Add dates":"Add dates","Remove dates":"Remove dates"}};t.App=te,t.locales=ie,t.services=ee,t.views=dt,Object.defineProperty(t,"__esModule",{value:!0})}(e)},7425:()=>{!function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}webix.protoUI({name:"kanbanheader",$kanban:!0,$skin:function(){this.defaults.height=webix.skin.$active.barHeight,this._template_types.sub.height=webix.skin.$active.barHeight-12},$init:function(t){var e=this._template_types[t.type];e&&webix.extend(t,e)},defaults:{css:"webix_kanban_header",borderless:!0,template:function(){var t=this.icon||(this.link?"webix_kanban_icon kbi-plus-circle":"");return(t?"<span class='webix_icon "+(this.link?"webix_kanban_add_icon ":"")+t+"'></span>":"")+"<span class='webix_strong' style='line-height:"+this.height+"px'>"+(this.label||"")+"</span>"}},_template_types:{sub:{css:"webix_kanban_sub_header"}},on_click:{webix_kanban_add_icon:function(){var t={text:""},e=this.getKanban(),i=e.queryView({id:this.config.link});i&&this.callEvent("onBeforeCardAdd",[t,i])&&(e.setListStatus(t,i),e.add(t))}},getKanban:function(){return webix.$$(this.config.master)}},webix.MouseEvents,webix.ui.template);var e={jpg:!0,jpeg:!0,png:!0,gif:!0},i={ppt:"-powerpoint",pptx:"-powerpoint",pptm:"-powerpoint",pps:"-powerpoint",ppsx:"-powerpoint",ppsm:"-powerpoint",doc:"-word",docx:"-word",docm:"-word",xls:"-excel",xlsx:"-excel",xlsm:"-excel",xlsb:"-excel",pdf:"-pdf",wav:"-audio",aif:"-audio",mp3:"-audio",mid:"-audio",mpg:"-video",mov:"-video",wmv:"-video",avi:"-video",mp4:"-video",zip:"-archive",jar:"-archive",rar:"-archive",gz:"-archive",jpg:"-image",jpeg:"-image",png:"-image",gif:"-image"};function n(t){return e[t.toString().toLowerCase()]}var r={height:"auto",icons:[{id:"attachments",icon:"webix_kanban_icon kbi-file",show:function(t){return!!t.attachments&&t.attachments.length},template:"#attachments.length#"},{id:"comments",icon:"webix_kanban_icon kbi-comment",show:function(t,e){return!!e.config.comments},template:function(t){return t.comments&&t.comments.length||""}},{id:"editor",icon:"webix_kanban_icon kbi-pencil",show:function(t,e){return e.config.editor&&!e.config.cardActions}},{id:"menu",icon:"webix_kanban_icon kbi-cogs",show:function(t,e){return!!e.config.cardActions}}],templateTags:function(t,e,i){var n=[];if(t.tags)for(var r=i._tags,a=0;a<t.tags.length;a++){var o=t.tags[a];r.exists(o)&&(o=r.getItem(o).value),n.push("<span class='webix_kanban_tag'>"+o+"</span>")}return"<div  class='webix_kanban_tags'>"+(n.length?n.join(""):"&nbsp;")+"</div>"},templateIcons:function(t,e,i){for(var n=[],r=null,a="",o=0;o<e.icons.length;o++)(r=e.icons[o]).show&&!r.show(t,i)||(a="<span webix_icon_id='"+(r.id||r.icon||r)+"' class='webix_kanban_footer_icon' title='"+(r.tooltip||"")+"'>",a+="<span class='"+(r.icon||r)+" webix_icon'></span>",r.template&&(a+="<span class='webix_kanban_icon_text'>"+webix.template(r.template)(t)+"</span>"),a+="</span>",n.push(a));return"<div  class='webix_kanban_footer_icons'>"+n.join(" ")+"</div>"},templateAvatar:function(t,e,i){var n=i._users,r=t.user_id&&n.exists(t.user_id)?n.getItem(t.user_id):{};return r.image?"<img class='webix_kanban_avatar' src='"+r.image+"' title='"+(r.value||"")+"'>":"<span class='webix_icon webix_kanban_icon kbi-account' title='"+(r.value||"")+"'></span>"},templateBody:function(t){return t.text},templateAttachments:function(t){if(t.attachments)for(var e in t.attachments){var i=t.attachments[e];if(n(i.link.split(".").pop()))return"<img class='webix_kanban_attachment' src='"+i.link+"'/>"}return""},templateFooter:function(t,e,i){return(e.templateTags(t,e,i)||"&nbsp;")+e.templateIcons(t,e,i)},templateStart:webix.template("<div webix_l_id='#id#' class='{common.classname()} webix_kanban_list_item' style='width:{common.width}px; height:{common.height}px;'>"),template:function(t,e){var i=webix.$$(e.master),n=i._colors.exists(t.color)?i._colors.getItem(t.color).color:t.color,r="<div class='webix_kanban_user_avatar' webix_icon_id='$avatar'>"+e.templateAvatar(t,e,i)+"</div>",a="<div class='webix_kanban_body'>"+e.templateBody(t,e,i)+r+"</div>";return"<div class='webix_kanban_list_content'"+(n?" style='border-left-color:"+n+"'":"")+">"+(i.config.attachments?e.templateAttachments(t,e,i):"")+a+"<div class='webix_kanban_footer'>"+e.templateFooter(t,e,i)+"</div></div>"}};webix.KanbanView={$kanban:!0,on_context:{},$skin:function(){},getKanban:function(){return webix.$$(this.config.master)},_kanban_event:function(t,e,i){this.attachEvent(t,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(n[i]=this).getKanban().callEvent(e,n)}))},_fixOrder:function(){this.data.each((function(t,e){return t.$index=e+1}))},move:function(t,e,i,n){if(i=i||this,n=n||{},webix.isArray(t))return webix.DataMove.move.call(this,t,e,i,n);var r=i!==this,a=this.getKanban(),o=a.getItem(t),s=webix.dp.$$(a.config.id);if(r){if(!a.callEvent("onBeforeStatusChange",[t,i.config.status,i]))return;a.setListStatus(o,i),s?s.ignore((function(){return a.updateItem(t)})):a.updateItem(t)}if(webix.DataMove.move.call(i,t,e),this._fixOrder(),this!==i&&i._fixOrder(),s){var l=webix.copy(o);l.webix_move_index=e,l.webix_move_id=i.data.order[e+1],l.webix_move_parent=i.config.serverStatus||i.config.status,s.save(t,"update",l)}return r&&a.callEvent("onAfterStatusChange",[t,i.config.status,i]),t},_setHandlers:function(){this.attachEvent("onAfterSelect",(function(){this.eachOtherList((function(t){t.unselect()}))})),this._kanban_event("onBeforeSelect","onListBeforeSelect",2),this._kanban_event("onAfterSelect","onListAfterSelect",1),this._kanban_event("onBeforeContextMenu","onListBeforeContextMenu",3),this._kanban_event("onAfterContextMenu","onListAfterContextMenu",3),this._kanban_event("onItemClick","onListItemClick",3),this._kanban_event("onItemDblClick","onListItemDblClick",3),this._kanban_event("onBeforeDrag","onListBeforeDrag",2),this._kanban_event("onBeforeDrop","onListBeforeDrop",2),this._kanban_event("onAfterDrop","onListAfterDrop",2),this._kanban_event("onBeforeDragIn","onListBeforeDragIn",2),this._kanban_event("onDragOut","onListDragOut",2),this.on_click.webix_kanban_user_avatar=this._handle_icons,this.on_click.webix_kanban_footer_icon=this._handle_icons},_handle_icons:function(e,i,n){var r=n.getAttribute("webix_icon_id"),a=this.type.icons;if(a)for(var o=0;o<a.length;o++)"object"===t(a[o])&&(a[o].id||a[o].icon)===r&&a[o].click&&a[o].click.call(this,i,e,n,this);"$avatar"===r?this.getKanban().callEvent("onAvatarClick",[i,e,n,this]):this.getKanban().callEvent("onListIconClick",[r,i,e,n,this])},$dragCreate:function(t,e){var i=webix.DragControl.$drag(t,e);if(!i)return!1;webix.callEvent("onClick",[]);var n=document.createElement("DIV");return n.innerHTML=i,n.className="webix_drag_zone webix_kanban_drag_zone",document.body.appendChild(n),n},$dropHTML:function(){return"<div class='webix_kanban_drop_inner'></div>"},eachOtherList:function(t){var e=this.config.id;this.getKanban().eachList((function(i){i.config.id!=e&&t.call(webix.$$(e),i)}))},defaults:{drag:"move",select:!0}},webix.protoUI({name:"kanbanlist",$init:function(){this.$view.className+=" webix_kanban_list",this.$ready.push(webix.bind(this._setHandlers,this))},defaults:{scroll:"auto"},type:r},webix.ui.list,webix.KanbanView);var a=webix.copy(r);function o(e,i){var n=i.config.status;if("object"===t(n))for(var r in n)e[r]=n[r];else"function"==typeof n?n.call(i,e,!0):e.status=n}function s(e){var i=e.config.status;return"object"===t(i)?function(t){for(var e in i)if(t[e]!=i[e])return!1;return!0}:"function"==typeof i?function(t){return i.call(e,t)}:function(t){return t.status===i}}a.width=200,webix.protoUI({name:"kanbandataview",$init:function(){this.$view.className+=" webix_kanban_list",this.$ready.push(webix.bind(this._setHandlers,this))},defaults:{prerender:!0},type:a},webix.ui.dataview,webix.KanbanView),webix.protoUI({name:"kanbanuploader",$init:function(){var t=this;this.files.data.scheme({$init:function(e){"string"==typeof e.link&&e.link&&(e.name=e.name||e.link.split("/").pop(),e.type=e.type||e.name.split(".").pop(),e.status=e.status||"server"),e.sizetext=e.sizetext||t._format_size(e.size)}}),this.files.data.attachEvent("onStoreUpdated",(function(){var e=webix.$$(t.config.link),i="<span class='webix_strong'>"+(webix.i18n.kanban.dnd||"")+"</span>";t.files.data.count()?e.hideOverlay():e.showOverlay(i)}))},defaults:{icon:"webix_kanban_icon kbi-upload"},getValue:function(){var t=[];return this.files.data.each((function(e){"server"===e.status&&t.push({id:e.id,link:e.link,size:e.size})})),t},_format_size:function(t){for(var e=0;1024<t;)e++,t/=1024;return Math.round(100*t)/100+" "+webix.i18n.fileSize[e]}},webix.ui.uploader),webix.type(webix.ui.dataview,{name:"uploader",height:91,width:161,template:function(t,e){return"<a".concat("server"===t.status?' href="'.concat(t.link,'" download="').concat(t.name,'"'):"","></a>\n\t\t\t\t").concat(e.body(t),"\n\t\t\t\t").concat(e.title(t,e),"\n\t\t\t\t").concat(e.removeIcon(t))},body:function(t){return"server"===t.status&&n(t.type)?'<div class="webix_kanban_uploader_body"><img src="'.concat(t.link,'"></div>'):"<div class='webix_kanban_uploader_body'>\n\t\t\t\t\t<span class='webix_icon webix_kanban_icon kbi-file".concat(function(t){return i[t.toString().toLowerCase()]||""}(t.type),"'></span>\n\t\t\t\t</div>")},title:function(t,e){return'<div class="webix_kanban_uploader_title" title="'.concat(t.name,'">\n\t\t\t\t\t').concat(e.progress(t),'\n\t\t\t\t\t<div class="webix_kanban_uploader_label">').concat(t.name,"</div>\n\t\t\t\t</div>")},progress:function(t){switch(t.status){case"client":return"<span class='webix_kanban_uploader_progress'>"+t.sizetext+"</span>";case"transfer":return"<span class='webix_kanban_uploader_progress'>"+t.percent+"%</span>";case"server":return"<span class='webix_kanban_uploader_progress_server'>"+t.sizetext+"</span>";default:return"<span class='webix_kanban_uploader_progress_error'>ERROR</span>"}},removeIcon:function(){return"<div class='webix_kanban_remove_upload'><span class='webix_icon wxi-close'></span></div>"},on_click:{webix_kanban_remove_upload:function(t,e){return webix.$$(this.config.uploader).files.remove(e),webix.html.preventEvent(t)}}}),webix.i18n.kanban={copy:"Copy",dnd:"Drop Files Here",remove:"Remove",save:"Save",confirm:"The card will be deleted permanently, are you sure?",editor:{add:"Add card",assign:"Assign to",attachments:"Attachments",color:"Color",edit:"Edit card",status:"Status",tags:"Tags",text:"Text",upload:"Upload"},menu:{copy:"Copy",edit:"Edit",remove:"Remove"}},webix.protoUI({name:"kanbaneditor",defaults:{width:534,position:"center",css:"webix_kanban_editor",modal:!0,move:!0},$init:function(e){var i=this,n=webix.$$(e.master);e.head={view:"toolbar",paddingX:17,paddingY:8,elements:[{view:"label",label:webix.i18n.kanban.editor.add,localId:"$kanban_header"},{view:"icon",icon:"wxi-close",click:function(){return i._close()}}]};var r=n.config.editor,a={view:"form",borderless:!0,padding:0,elementsConfig:{labelPosition:"top"}},o=[{view:"textarea",label:webix.i18n.kanban.editor.text,name:"text",height:90},{view:"multicombo",label:webix.i18n.kanban.editor.tags,name:"tags",options:n._tags,$hide:!0},{margin:8,cols:[{view:"combo",label:webix.i18n.kanban.editor.assign,name:"user_id",$hide:!0,options:{body:{data:n._users,yCount:5}}},{view:"richselect",label:webix.i18n.kanban.editor.color,name:"color",$hide:!0,options:{body:{yCount:5,data:n._colors,css:"webix_kanban_colorpicker",template:"<span class='webix_kanban_color_item' style='background-color: #color#'></span>#value#"}}},{view:"richselect",label:webix.i18n.kanban.editor.status,name:"$list",options:{body:{data:n._statuses,yCount:5}}}]}];webix.isArray(r)?a.elements=r:"object"===t(r)?((a=webix.extend(a,r,!0)).view="form",a.elements=a.elements||a.rows||(a.cols?[{cols:a.cols}]:o),delete a.rows,delete a.cols):a.elements=o,n.config.attachments&&a.elements.push({margin:0,rows:[{cols:[{view:"label",label:webix.i18n.kanban.editor.attachments},{view:"kanbanuploader",label:webix.i18n.kanban.editor.upload,upload:n.config.attachments,name:"attachments",autowidth:!0,css:"webix_transparent webix_kanban_uploader",type:"icon"}]},{view:"dataview",localId:"$kanban_dataview_uploader",yCount:1,borderless:!0,type:"uploader",css:"webix_kanban_dataview_uploader",on:{onItemDblClick:function(t,e,i){i.getElementsByTagName("a")[0].click()}}}]}),e.body={paddingX:17,paddingY:0,margin:16,rows:[a,{cols:[{view:"button",label:webix.i18n.kanban.remove,type:"danger",autowidth:!0,hidden:!0,localId:"$kanban_remove",click:function(){var t=i.getValues({hidden:!1}),e=i.getKanban();e.callEvent("onBeforeEditorAction",["remove",i,t])&&e._removeCard(t.id).then((function(){return i._close()}))}},{},{view:"button",label:webix.i18n.kanban.save,type:"form",autowidth:!0,click:function(){var t=i.getValues({hidden:!1}),e=i.getKanban();e.callEvent("onBeforeEditorAction",["save",i,t])&&(i._fixStatus(t,e),e.exists(t.id)?(t.$list=e.getItem(t.id).$list,e.updateItem(t.id,t)):e.add(t),i._close())}}]},{height:1}]},this.$ready.push(this._afterInit)},_afterInit:function(){this._form=this.queryView({view:"form"}),this._removeBtn=this.queryView({localId:"$kanban_remove"}),this._header=this.queryView({localId:"$kanban_header"});var t=this.queryView({view:"kanbanuploader"});if(t){var e=this.queryView({localId:"$kanban_dataview_uploader"});t.define("link",e.config.id),t.addDropZone(e.$view),webix.extend(e,webix.OverlayBox)}var i=this.queryView({$hide:!0},"all");i.length&&this.attachEvent("onShow",(function(){for(var t=0;t<i.length;t++)i[t].getList().count()?i[t].show():i[t].hide()}))},_fixStatus:function(t,e){t.$list=Number(t.$list)||0,e._sublists[t.$list]&&e.setListStatus(t,e._sublists[t.$list])},getForm:function(){return this._form},getKanban:function(){return webix.$$(this.config.master)},setValues:function(e){"object"===t(e)&&e||(e={});var i=this.getKanban(),n=i._assignList(e);e.$list=e.$list||(-1!==n?n:0),this._prepareEditor(i,e.id),this._form.setValues(e)},getValues:function(t){return this._form.getValues(t)},_prepareEditor:function(t,e){e&&t.exists(e)?(this._removeBtn.show(),this._header.define("label",webix.i18n.kanban.editor.edit)):(this._removeBtn.hide(),this._header.define("label",webix.i18n.kanban.editor.add)),this._header.refresh()},_close:function(){this.hide(),this._form.clear(),this._prepareEditor()}},webix.ui.window),webix.protoUI({name:"kanbanuserlist",defaults:{width:300,layout:"y",scroll:!0,yCount:4,autoheight:!1,select:!0,template:function(t){return t.image?"<img class='webix_kanban_list_avatar' src='"+t.image+"'>"+t.value:"<span class='webix_icon webix_kanban_icon kbi-account webix_kanban_list_avatar'></span>"+t.value}},$init:function(){this.$ready.push((function(){var t=this;this.attachEvent("onShow",(function(){var e=t.getContext().user_id;e&&t.exists(e)?(t.select(e),t.showItem(e)):t.unselectAll()})),this.attachEvent("onMenuItemClick",(function(e){var i=t.getKanban(),n=t.getContext().id;i.updateItem(n,{user_id:e})})),this.type.master=this.config.masterId}))},getKanban:function(){return webix.$$(this.config.masterId)}},webix.ui.contextmenu),webix.protoUI({name:"kanbanmenu",$init:function(){this.$ready.push((function(){this.attachEvent("onItemClick",(function(t){var e=this.getContext().id,i=this.getKanban();if(i.callEvent("onBeforeCardAction",[t,e]))switch(t){case"edit":i.showEditor(webix.copy(i.getItem(e)));break;case"copy":i.copy(e);break;case"remove":i._removeCard(e)}}))}))},getKanban:function(){return webix.$$(this.config.masterId)}},webix.ui.contextmenu),webix.protoUI({name:"kanbanchat",$init:function(t){t.padding=0,this.$ready.push((function(){var t=this;this.attachEvent("onHide",this._hide_chat),this.queryView({view:"list"}).data.attachEvent("onStoreUpdated",(function(e,i,n){n&&"paint"!==n&&t._save()}))}))},_save:function(){var t=this.getContext(),e=this.getBody(),i=this.getKanban();t&&i.exists(t.id)&&i.updateItem(t.id,{comments:e.serialize()})},_hide_chat:function(){var t=this.getBody();t.queryView({view:"form"}).clear(),t.queryView({view:"list"}).clearAll()},getKanban:function(){return webix.$$(this.config.masterId)}},webix.ui.context),webix.protoUI({name:"kanban",defaults:{delimiter:","},$skin:function(){this.defaults.type="space"},$init:function(t){var e=this;this.$view.className+=" webix_kanban",this.data.provideApi(this,!0),this.data.scheme({$change:function(t){"string"==typeof t.tags&&(t.tags=e._strToArr(t.tags))}}),this._destroy_with_me=[],this._statuses=new webix.DataCollection,this._destroy_with_me.push(this._statuses),this._tags=this._data_unification(t.tags),this._users=this._data_unification(t.users),this._colors=this._data_unification(t.colors),this.$ready.push((function(){var t=this;this.reconstruct(),this._initEditor(),this._initUserList(),this._initMenu(),this._initComments(),this.data.attachEvent("onStoreUpdated",(function(e,i,n){return t._applyOrder(e,i,n)})),this.data.attachEvent("onIdChange",(function(e,i){t.getOwnerList(e).data.changeId(e,i)})),this.attachEvent("onDestruct",(function(){for(var e=0;e<t._destroy_with_me.length;e++)t._destroy_with_me[e].destructor()}))})),this.serialize=this._serialize},_strToArr:function(t){return t?t.split(this.config.delimiter):[]},getTags:function(){return this._tags},getUsers:function(){return this._users},getColors:function(){return this._colors},getStatuses:function(){return this._statuses.serialize()},cardActions_setter:function(t){if(!0===t&&(t=["edit","copy","remove"]),webix.isArray(t))return t.map((function(t){return{id:t,value:webix.i18n.kanban.menu[t]||t}}))},showEditor:function(t){var e=this.getEditor();this.callEvent("onBeforeEditorShow",[e,t])&&e&&(e.setValues(t),e.show(),this.callEvent("onAfterEditorShow",[e,t]))},copy:function(t){if(this.callEvent("onBeforeCopy",[t])){var e=webix.copy(this.getItem(t));delete e.id,e.text=webix.i18n.kanban.copy+" "+(e.text||"");var i=this.add(e),n=this.getOwnerList(i);n.move(i,n.getIndexById(t)+1,n),this.callEvent("onAfterCopy",[t])}},_removeCard:function(t){var e=this,i=webix.promise.defer();return webix.i18n.kanban.confirm?webix.confirm({text:webix.i18n.kanban.confirm,callback:function(n){n&&(e.remove(t),i.resolve())}}):(this.remove(t),i.resolve()),i},_data_unification:function(t){if(t&&t.getItem)return t;var e=new webix.DataCollection;return this._destroy_with_me.push(e),t&&"string"==typeof t?e.load(t):e.parse(t||[]),e},getEditor:function(){return webix.$$(this._editor)},getUserList:function(){return webix.$$(this._userList)},getMenu:function(){return webix.$$(this._menu)},getComments:function(){return webix.$$(this._comments)},_initEditor:function(){var t=this;if(this.config.editor){var e=webix.ui({view:"kanbaneditor",master:this.config.id});this._editor=e.config.id,this._destroy_with_me.push(e),this.attachEvent("onListIconClick",(function(e,i){"editor"===e&&t.showEditor(webix.copy(t.getItem(i)))})),this.attachEvent("onListItemDblClick",(function(e){return t.showEditor(webix.copy(t.getItem(e)))}))}},_initUserList:function(){var e=this;if(this.config.userList){var i="object"===t(this.config.userList)?this.config.userList:{};webix.extend(i,{view:"kanbanuserlist",masterId:this.config.id,data:this._users},!0),i=webix.ui(i),this._userList=i.config.id,this._destroy_with_me.push(i),this.attachEvent("onAvatarClick",(function(t,i,n){var r=e.getUserList();r.setContext({id:t,user_id:e.getItem(t).user_id}),r.show(n)}))}},_initMenu:function(){var t=this;if(this.config.cardActions){var e=webix.ui({view:"kanbanmenu",data:this.config.cardActions,masterId:this.config.id});this._menu=e.config.id,this._destroy_with_me.push(e),this.attachEvent("onListIconClick",(function(e,i,n,r){if("menu"===e){var a=t.getMenu();a.setContext({id:i}),a.show(r)}}))}},_initComments:function(){var e=this;if(this.config.comments){var i="object"===t(this.config.comments)?this.config.comments:{};i=webix.extend({width:400,height:400},i,!0),webix.extend(i,{view:"comments",users:this._users},!0);var n=webix.ui({view:"kanbanchat",body:i,masterId:this.config.id});this._comments=n.config.id,this._destroy_with_me.push(n),this.attachEvent("onListIconClick",(function(t,i,n,r){if("comments"===t&&e.callEvent("onBeforeCommentsShow",[i,n,r])){var a=e.getComments(),o=webix.html.offset(r);o.y+=o.height,a.hide();var s=a.getBody(),l=e.getItem(i).comments||[];s.parse(webix.copy(l)),a.setContext({id:i}),a.show(o)}}))}},_serialize:function(){var t=[];return this.eachList((function(e){t=t.concat(e.serialize())})),t},_applyOrder:function(t,e,i){if(!t)return this._syncData();switch(i){case"add":0<=this._assignList(e)&&(this.getOwnerList(t).add(e),e.$index=this._sublists[e.$list].count());break;case"delete":var n=this._sublists[e.$list];n&&n.exists(t)&&n.remove(t);break;case"paint":case"update":if(-1===this.getIndexById(t))break;var r=e.$list,a=this._assignList(e);r===a?0<=a&&this.getOwnerList(t).updateItem(t,e):(this._sublists[r]&&this._sublists[r].remove(t),0<=a&&this.getOwnerList(t).add(e))}},setListStatus:function(t,e){for(var i=0;i<this._sublists.length;i++)if(this._sublists[i]===e)return void o(t,e)},reconstruct:function(){this._prepareLists(),this._syncData()},_prepareLists:function(){this._sublists=[],this._subfilters=[];for(var t=[],e=this.queryView((function(t){return t.$kanban}),"all"),i=0;i<e.length;i++){var n=e[i];"kanbanheader"!==n.config.view?this._sublists.push(n):n.config.master=this.config.id}for(var r=0;r<this._sublists.length;r++){var a=this._sublists[r];this._subfilters[r]=s(a),this.config.icons&&(a.type.icons=a.type.icons||this.config.icons);var o=a.config.name||("string"==typeof a.config.status&&a.config.status?a.config.status[0].toUpperCase()+a.config.status.slice(1):a.config.id);t.push({id:r.toString(),value:o}),a.config.master=this.config.id,a.type.master=this.config.id}this._statuses.clearAll(),this._statuses.parse(t)},_syncData:function(){for(var t=[],e=0;e<this._sublists.length;e++)t[e]=[];this.data.each((function(e){var i=this._assignList(e);0<=i&&t[i].push(e)}),this);for(var i=0;i<this._sublists.length;i++){var n=t[i];1<n.length&&n[0].$index&&n.sort((function(t,e){return t.$index>e.$index?1:-1})),this._sublists[i].clearAll(),this._sublists[i].data.importData(n),this._sublists[i]._fixOrder()}},_assignList:function(t){for(var e=0;e<this._sublists.length;e++)if(this._subfilters[e](t))return t.$list=e;return-1},getSelectedId:function(){var t=null;return this.eachList((function(e){t=e.getSelectedId()||t})),t},select:function(t){this.getOwnerList(t).select(t)},getOwnerList:function(t){var e=this.getItem(t);return e?this._sublists[e.$list]:null},eachList:function(t){for(var e=0;e<this._sublists.length;e++)t.call(this,this._sublists[e],this._sublists[e].config.status)}},webix.DataLoader,webix.EventSystem,webix.ui.headerlayout)}()},7641:function(t,e,i){!function(t){"use strict";class e{}class n{constructor(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}getRoot(){return this._root}destructor(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null}setParam(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)}getParam(t,e){const i=this._data[t];if(void 0!==i||!e)return i;const n=this.getParentView();return n?n.getParam(t,e):void 0}getUrl(){return this._segment.suburl()}getUrlString(){return this._segment.toString()}getParentView(){return this._parent}$$(t){if("string"==typeof t){const e=this.getRoot();return e.queryView((i=>(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope),"self")}return t}on(t,e,i){const n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n}contains(t){for(const e in this._subs){const i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1}getSubView(t){const e=this.getSubViewInfo(t);if(e)return e.subview.view}getSubViewInfo(t){const e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null}_detachEvents(){const t=this._events;for(let e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)}_destroySubs(){for(const t in this._subs){const e=this._subs[t].view;e&&e.destructor()}this._subs={}}_init_url_data(){const t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)}_getDefaultSub(){if(this._subs.default)return this._subs.default;for(const t in this._subs){const e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){const t=e.view._getDefaultSub();if(t)return t}}}_routed_view(){const t=this.getParentView();if(!t)return!0;const e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()}}function r(t){"/"===t[0]&&(t=t.substr(1));const e=t.split("/"),i=[];for(let t=0;t<e.length;t++){const n=e[t],r={};let a=n.indexOf(":");if(-1===a&&(a=n.indexOf("?")),-1!==a){const t=n.substr(a+1).split(/[\:\?\&]/g);for(const e of t){const t=e.split("=");r[t[0]]=decodeURIComponent(t[1])}}i[t]={page:a>-1?n.substr(0,a):n,params:r,isNew:!0}}return i}function a(t){const e=[];for(const i of t){e.push("/"+i.page);const t=o(i.params);t&&e.push("?"+t)}return e.join("")}function o(t){const e=[];for(const i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}class s{constructor(t,e){this._next=1,this.route="string"==typeof t?{url:r(t),path:t}:t,this.index=e}current(){return this.route.url[this.index]}next(){return this.route.url[this.index+this._next]}suburl(){return this.route.url.slice(this.index)}shift(t){const e=new s(this.route,this.index+this._next);return e.setParams(e.route.url,t,e.index),e}setParams(t,e,i){if(e){const r=t[i].params;for(var n in e)r[n]=e[n]}}refresh(){const t=this.route.url;for(let e=this.index+1;e<t.length;e++)t[e].isNew=!0}toString(){const t=a(this.suburl());return t?t.substr(1):""}_join(t,e){let i=this.route.url;if(null===t)return i;const n=this.route.url;let a=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(r(t));for(let t=0;t<i.length;t++)n[t]&&(i[t].view=n[t].view),a&&n[t]&&i[t].page===n[t].page?i[t].isNew=!1:i[t].isNew&&(a=!1)}return i}append(t){const e=this._join(t,!0);return this.route.path=a(e),this.route.url=e,this.route.path}show(t,i,n){const r=this._join(t.url,n);return this.setParams(r,t.params,this.index+(n?this._next:0)),new Promise(((t,n)=>{const o=a(r),s={url:r,redirect:o,confirm:Promise.resolve()},l=i?i.app:null;!l||l.callEvent("app:guard",[s.redirect,i,s])?s.confirm.catch((t=>n(t))).then((()=>{if(null!==s.redirect){if(s.redirect!==o)return l.show(s.redirect),void n(new e);this.route.path=o,this.route.url=r,t()}else n(new e)})):n(new e)}))}size(t){this._next=t}split(){const t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=a(t.url)),new s(t,0)}update(t,e,i){const n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=a(this.route.url)}}class l extends n{constructor(t,e){super(t.webix),this.app=t,this._children=[]}ui(t,e){const i=(e=e||{}).container||t.container,r=this.app.createView(t);return this._children.push(r),r.render(i,this._segment,this),"object"!=typeof t||t instanceof n?r:r.getRoot()}show(t,e){if(e=e||{},"object"==typeof t){for(const e in t)this.setParam(e,t[e]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){const i=this.getParentView();return i?i.show(t.substr(3),e):this.app.show("/"+t.substr(3))}const i=this.getSubViewInfo(e.target);if(i){if(i.parent!==this)return i.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,i.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)}_show(t,e,i){return t.show(e,i,!0).then((()=>(this._init_url_data(),this._urlChange()))).then((()=>{t.route.linkRouter&&(this.app.getRouter().set(t.route.path,{silent:!0}),this.app.callEvent("app:route",[t.route.path]))}))}init(t,e){}ready(t,e){}config(){this.app.webix.message("View:Config is not implemented")}urlChange(t,e){}destroy(){}destructor(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),super.destructor())}use(t,e){t(this.app,this,e)}refresh(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)}render(t,e,i){"string"==typeof e&&(e=new s(e,0)),this._segment=e,this._parent=i,this._init_url_data();const n="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==n?(this._container=n,this._render(e)):this._urlChange().then((()=>this.getRoot()))}_render(t){const e=this.config();return e.then?e.then((e=>this._render_final(e,t))):this._render_final(e,t)}_render_final(t,e){let i,n=null,r=null,a=!1;if(this._container.tagName?r=this._container:(n=this._container,n.popup?(r=document.body,a=!0):r=this.webix.$$(n.id)),!this.app||!r)return Promise.reject(null);const o=this._segment.current(),s={ui:{}};this.app.copyConfig(t,s.ui,this._subs),this.app.callEvent("app:render",[this,e,s]),s.ui.$scope=this,!n&&o.isNew&&o.view&&o.view.destructor();try{if(n&&!a){const t=r,e=t.getParentView();e&&"multiview"===e.name&&!s.ui.id&&(s.ui.id=t.config.id)}this._root=this.app.webix.ui(s.ui,r);const t=this._root;a&&t.setPosition&&!t.isVisible()&&t.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),o.isNew&&(o.view=this,o.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((()=>this._urlChange().then((()=>(this._initUrl=null,this.ready(this._root,e.suburl()))))))}catch(t){i=Promise.reject(t)}return i.catch((t=>this._initError(this,t)))}_init(t,e){return this.init(t,e.suburl())}_urlChange(){this.app.callEvent("app:urlchange",[this,this._segment]);const t=[];for(const e in this._subs){const i=this._subs[e],n=this._renderFrameLock(e,i,null);n&&t.push(n)}return Promise.all(t).then((()=>this.urlChange(this._root,this._segment.suburl())))}_renderFrameLock(t,e,i){if(!e.lock){const n=this._renderFrame(t,e,i);n&&(e.lock=n.then((()=>e.lock=null),(()=>e.lock=null)))}return e.lock}_renderFrame(t,e,i){if("default"===t){if(this._segment.next()){let t=i?i.params:null;return e.params&&(t=this.webix.extend(t||{},e.params)),this._createSubView(e,this._segment.shift(t))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((()=>this._createSubView(e,e.route)));if(e.branch)return}let n=e.view;if(!n&&e.url){if("string"==typeof e.url)return e.route=new s(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||n instanceof e.url||(n=new(this.app._override(e.url))(this.app,"")),n||(n=e.url)}if(n)return n.render(e,e.route||this._segment,this)}_initError(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0}_createSubView(t,e){return this.app.createFromURL(e.current()).then((i=>i.render(t,e,this)))}_destroyKids(){const t=this._children;for(let e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]}}class u extends l{constructor(t,e){super(t,e),this._ui=e.ui}config(){return this._ui}}class c{constructor(t,e,i){this.path="",this.app=i}set(t,e){this.path=t;const i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})}get(){return this.path}}let h=!0;class p extends n{constructor(t){const e=(t||{}).webix||window.webix;t=e.extend({name:"App",version:"1.0",start:"/home"},t,!0),super(e,t),this.config=t,this.app=this.config.app,this.ready=Promise.resolve(),this._services={},this.webix.extend(this,this.webix.EventSystem)}getUrl(){return this._subSegment.suburl()}getUrlString(){return this._subSegment.toString()}getService(t){let e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e}setService(t,e){this._services[t]=e}destructor(){this.getSubView().destructor(),super.destructor()}copyConfig(t,e,i){if((t instanceof n||"function"==typeof t&&t.prototype instanceof n)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);const r=t instanceof Array;e=e||(r?[]:{});for(const a in t){let o=t[a];if("function"==typeof o&&o.prototype instanceof n&&(o={$subview:o}),!o||"object"!=typeof o||o instanceof this.webix.DataCollection||o instanceof RegExp||o instanceof Map)e[a]=o;else if(o instanceof Date)e[a]=new Date(o);else{const t=this.copyConfig(o,o instanceof Array?[]:{},i);null!==t&&(r?e.push(t):e[a]=t)}}return e}getRouter(){return this.$router}clickHandler(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){const i=e.getAttribute("trigger");if(i)return this._forView(e,(t=>t.app.trigger(i))),t.cancelBubble=!0,t.preventDefault();const n=e.getAttribute("route");if(n)return this._forView(e,(t=>t.show(n))),t.cancelBubble=!0,t.preventDefault()}const i=e.parentNode;i&&this.clickHandler(t,i)}getRoot(){return this.getSubView().getRoot()}refresh(){return this._subSegment?this.getSubView().refresh().then((t=>(this.callEvent("app:route",[this.getUrl()]),t))):Promise.resolve(null)}loadView(t){const e=this.config.views;let i=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{e&&(i="function"==typeof e?e(t):e[t],"string"==typeof i&&(t=i,i=null)),i||("_hidden"===t?i={hidden:!0}:"_blank"===t?i={}:(t=t.replace(/\./g,"/"),i=this.require("jet-views",t)))}catch(e){i=this._loadError(t,e)}return i.then||(i=Promise.resolve(i)),i=i.then((t=>t.__esModule?t.default:t)).catch((e=>this._loadError(t,e))),i}_forView(t,e){const i=this.webix.$$(t);i&&e(i.$scope)}_loadViewDynamic(t){return null}createFromURL(t){let e;return e=t.isNew||!t.view?this.loadView(t.page).then((e=>this.createView(e,name,t.params))):Promise.resolve(t.view),e}_override(t){const e=this.config.override;if(e){let i;for(;t;)i=t,t=e.get(t);return i}return t}createView(t,e,i){let r;if("function"==typeof(t=this._override(t))){if(t.prototype instanceof p)return new t({app:this,name:e,params:i,router:c});if(t.prototype instanceof n)return new t(this,{name:e,params:i});t=t(this)}return r=t instanceof n?t:new u(this,{name:e,ui:t}),r}show(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)}trigger(t,...e){this.apply(t,e)}apply(t,e){this.callEvent(t,e)}action(t){return this.webix.bind((function(...e){this.apply(t,e)}),this)}on(t,e){this.attachEvent(t,e)}use(t,e){t(this,null,e)}error(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){let t=e[i].message;0===t.indexOf("Module build failed")?(t=t.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML=`<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${t}</pre>`):(t+="<br><br>Check console for more details",this.webix.message({type:"error",text:t,expire:-1}))}}render(t,e,i){this._container="string"==typeof t?this.webix.toNode(t):t||document.body;let n=null;this.$router?n="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(h&&"tagName"in this._container&&(this.webix.event(document.body,"click",(t=>this.clickHandler(t))),h=!1),"string"==typeof e&&(e=new s(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);const r=i?i.params:this.config.params||null,a=this.getSubView(),o=this._subSegment,l=o.show({url:n,params:r},a).then((()=>this.createFromURL(o.current()))).then((e=>e.render(t,o))).then((t=>(this.$router.set(o.route.path,{silent:!0}),this.callEvent("app:route",[this.getUrl()]),t)));return this.ready=this.ready.then((()=>l)),l}getSubView(){if(this._subSegment){const t=this._subSegment.current().view;if(t)return t}return new l(this,{})}require(t,e){return null}_first_start(t){if(this._segment=t,this.$router=new this.config.router((t=>setTimeout((()=>{this.show(t).catch((t=>{if(!(t instanceof e))throw t}))}),1)),this.config,this),this._container===document.body&&!1!==this.config.animation){const t=this._container;this.webix.html.addCss(t,"webixappstart"),setTimeout((()=>{this.webix.html.removeCss(t,"webixappstart"),this.webix.html.addCss(t,"webixapp")}),10)}if(t){if(this.app){const e=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new s(this.config.start,0),t.current().view=e}}else{let e=this.$router.get();e||(e=this.config.start,this.$router.set(e,{silent:!0})),t=new s(e,0)}return t}_loadError(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}}addSubView(t,e,i){const n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e}}class d{constructor(t,e){this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=()=>this.cb(this.get())}set(t,e){if(this.config.routes){const e=t.split("?",2);for(const i in this.config.routes)if(this.config.routes[i]===e[0]){t=i+(e.length>1?"?"+e[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((()=>this.cb(t)),1)}get(){let t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){const e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t}_detectPrefix(){const t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]}_getRaw(){return document.location.href}}let f=!1;function g(t){if(f||!t)return;f=!0;const e=window;e.Promise||(e.Promise=t.promise);const i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){const i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});const n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,a={addView(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){const i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);for(const t in r)i._renderFrame(t,r[t],null).then((()=>{i._subs[t]=r[t]}));return t.id}return n.apply(this,arguments)},removeView(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){const e=this.$scope._subs;for(const i in e){const n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,a,!0),t.extend(t.ui.baselayout.prototype,a,!0),t.protoUI({name:"jetapp",$init(e){this.$app=new this.app(e);const i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}class v extends p{constructor(t){t.router=t.router||d,super(t),g(this.webix)}require(t,e){return i(67468)(t+"/"+e)}}class m{constructor(t,e){this.path="",this.cb=t}set(t,e){this.path=t,e&&e.silent||setTimeout((()=>this.cb(t)),1)}get(){return this.path}}function w(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e,i){for(var n in t)w(t,n)&&e.call(i||t,t[n],n,t)}function y(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var b=String.prototype.replace,x=String.prototype.split,S=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},$={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:S,chinese:function(){return 0},croatian:S,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:S,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},C={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function k(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var D=/\$/g,T=/%\{(.*?)\}/g;function E(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,a=n||T,o="number"==typeof e?{smart_count:e}:e;if(null!=o.smart_count&&r){var s=x.call(r,"||||");r=(s[function(t,e){return $[function(t){var e,i=(e={},_(C,(function(t,i){_(t,(function(t){e[t]=i}))})),e);return i[t]||i[x.call(t,/-/,1)[0]]||i.en}(t)](e)}(i||"en",o.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return b.call(r,a,(function(t,e){return w(o,e)&&null!=o[e]?b.call(o[e],D,"$$"):t}))}function L(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?E:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||y,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(k(e)+"(.*?)"+k(i),"g")}(e.interpolation)}L.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},L.prototype.extend=function(t,e){_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},L.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},L.prototype.clear=function(){this.phrases={}},L.prototype.replace=function(t){this.clear(),this.extend(t)},L.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=E(i,r,this.currentLocale,this.tokenRegex)),n},L.prototype.has=function(t){return w(this.phrases,t)},L.transformPhrase=function(t,e,i){return E(t,e,i)};var A=L;let I=window.webix;I&&g(I);const P=function(t,e,i){const n=(i=i||{}).storage;let r=n?n.get("lang")||"en":i.lang||"en";function a(e,a,o){a.__esModule&&(a=a.default);const l={phrases:a};i.polyglot&&t.webix.extend(l,i.polyglot);const u=s.polyglot=new A(l);if(u.locale(e),s._=t.webix.bind(u.t,u),r=e,n&&n.put("lang",r),i.webix){const n=i.webix[e];n&&t.webix.i18n.setLocale(n)}return o?Promise.resolve():t.refresh()}function o(e,n){if(!1===i.path)return;const r=(i.path?i.path+"/":"")+e;a(e,t.require("jet-locales",r),n)}const s={getLang:function(){return r},setLang:o,setLangData:a,_:null,polyglot:null};t.setService("locale",s),o(r,!0)},R=window;R.Promise||(R.Promise=R.webix.promise);let M=!1;function V(t,e,i){const n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}var O=1;function F(t,e,i){Object.defineProperty(e,i,{get:()=>t[i],set:e=>t[i]=e})}function H(t,e){e=e||{};const i={},n={},r=function(t,e){const r=O++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},a=[];let o=!1;const s=function(t,e,n,r){if(o)return void a.push([t,e,n,r]);const s=Object.keys(i);for(let a=0;a<s.length;a++){const o=i[s[a]];o&&("*"!==o.mask&&o.mask!==t||o.handler(n,e,t,r))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){const e=t;t=()=>{for(const t in e)n[t]=e[t]}}for(o=!0,t(n),o=!1;a.length;){const t=a.shift();s.apply(this,t)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){i=i||e;for(const e in t)if(t.hasOwnProperty(e)){const r=t[e];i.nested&&"object"==typeof r&&r?n[e]=H(r,i):B(n,r,e,s)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function B(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}webix.protoUI({name:"pivot-portlet",$reorderOnly:!0,$drag:function(t){webix.html.addCss(this.$view,"portlet_in_drag");const e=webix.DragControl.getContext();e.source=e.from=t,webix.callEvent("onClick",[]);const i=this.$scope.app.getService("local"),n=this.getChildViews()[0].getValues();let r="";"complex"==n.operation?r=i.fixMath(n.math):(r=n.name?i.getField(n.name).value:"",n.name2?r+=(r?", ":"")+i.getField(n.name2).value:r?n.operation&&(r+=` (${n.operation})`):r=(0,this.$scope.app.getService("locale")._)("Field not defined"));const a=webix.skin.$active;return`<div class="webix_pivot_portlet_drag" style="width:${this.$width-a.inputHeight}px;height:${this.$height}px;">\n\t\t\t\t<span class="webix_icon ${this.config.icon}"></span>${r}\n\t\t\t</div>`}},webix.ui.portlet);class U extends l{constructor(t,e,i){super(t,e),i||(i={}),this.plusLabel=i.plusLabel,this.field=i.field}config(){const t=webix.skin.$active;return{borderless:!0,type:"clean",paddingY:8,rows:[{localId:"forms",type:"clean",rows:[]},{template:`<div class="webix_pivot_handle_add_value">\n\t\t\t\t\t\t<span class="webix_icon wxi-plus-circle"></span><span>${this.plusLabel}</span>\n\t\t\t\t\t</div>`,css:"webix_pivot_add_value",height:t.inputHeight-2*t.inputPadding,localId:"addValue",onClick:{webix_pivot_handle_add_value:()=>{const t=this.$$("forms").getChildViews();this.Add(null,t.length);const e=t[t.length-1].queryView({name:"name"});e&&(e.focus(),webix.html.triggerEvent(e.getInputNode(),"MouseEvent","click")),"values"!=this.field&&t.length==this.app.getState().fields.length&&this.$$("addValue").hide()}}}]}}init(){this.on(webix,"onAfterPortletMove",(t=>{t==this.$$("forms")&&this.app.callEvent("property:change",[this.field,this.GetValue()])})),this.on(webix,"onPortletDrag",(function(t,e){if(t.$reorderOnly)return t.getParentView()===e.getParentView()}))}ListTemplate(t){const e=this._activeInput,i="values"==this.field&&e&&!e.$destructed&&"wavg"==e.getFormView().elements.operation.getValue(),n=this.getParentView().GetCorrections()[this.field],r=t.value;if(!i&&n){let e="webix_pivot_list_marker";return this.CheckCorrections(n,t.id)&&(e+=" webix_pivot_list_marker_fill"),`<div class="${e}"> ${r}</div>`}return r}CheckCorrections(t,e){if(this._activeInput&&e==this._activeInput.getValue())return!0;const i=this.app.getStructure();for(let n=0;n<t.length;n++){const r=i[t[n]];if(r)if("string"==typeof r){if(r==e)return!0}else for(let t=0;t<r.length;t++){let i=r[t];if(i.name&&(i=i.name),i==e)return!0}}return!1}GetValue(){const t=this.$$("forms").getChildViews();let e=[];return t.forEach((t=>{const i=t.getChildViews()[0].getValues().name;i&&e.push(i)})),e}SetValue(t){const e=this.$$("forms"),i=e.getChildViews();for(let t=i.length-1;t>=0;t--)e.removeView(i[t]);for(let e=0;e<t.length;e++)t[e].external||this.Add(t[e],e)}Add(t,e){this.$$("forms").addView({view:"pivot-portlet",mode:"replace",borderless:!0,body:{view:"form",paddingY:0,paddingX:2,elements:[{margin:2,cols:this.ItemConfig(t,e)}],on:{onChange:(t,e,i)=>{"user"==i&&this.app.callEvent("property:change",[this.field,this.GetValue()])}}}})}ItemConfig(t){return[{width:webix.skin.$active.inputHeight},{view:"richselect",name:"name",value:this.PrepareValue(t),hidden:t&&"complex"==t.operation,options:{css:"webix_pivot_suggest",data:this.app.getState().fields,on:{onBeforeShow:function(){const t=webix.$$(this.config.master),e=t.$scope,i=e.GetValue();e._activeInput=t,this.getList().filter((n=>e.FilterSuggest(i,t.getValue(),n)))}},body:{template:t=>this.ListTemplate(t)}}},{view:"icon",icon:"wxi-close",css:"webix_pivot_close_icon",pivotPropertyRemove:!0,click:function(){const t=this.$scope;t.$$("addValue").show(),t.$$("forms").removeView(this.queryView("pivot-portlet","parent")),t.app.callEvent("property:change",[t.field,t.GetValue()])}}]}PrepareValue(t){return t?("object"==typeof t&&(t=t.name),webix.isArray(t)&&(t=t[0])):t="",t}FilterSuggest(t,e,i){return(i=i.id)==e||!t.find((t=>(t.name&&(t=t.name),i==t)))}}function N(t){const e=t.charCodeAt(0);return e<=122?e>=48&&e<=57||e>=65:e>191}function j(t,e){if(e){for(let e=0;e<t.length;e++)if(!N(t[e]))return e;return t.length}for(let e=t.length-1;e>=0;e--)if(!N(t[e]))return e+1;return 0}function G(t,e){return 0===t.toLowerCase().indexOf(e.toLowerCase())}webix.protoUI({name:"suggest-math",$enterKey(){const t=this.getList();this.isVisible()&&!t.getSelectedId()&&t.count()&&(t.select(t.data.order[1]),this._addFirst=1),webix.ui.suggest.prototype.$enterKey.apply(this,arguments),webix.delay((()=>{delete this._addFirst}))},defaults:{filter(t,e){const i=webix.$$(this.config.master),n=i.getInputNode().selectionStart,r=e.substring(0,n),a=r.substring(j(r)),o=e.charAt(n);if(!a||n!==e.length&&N(o)||(e=a),t.disabled){const n=i.$scope.app;if("$fields"==t.id)return!!n.getState().fields.find((t=>G(t.value,e)));if("$methods"==t.id){const t=n.getService("locale")._;return!!n.getService("local").operations.find((i=>G(t(i.id),e)))}}return G(t.value,e)}}},webix.ui.suggest),webix.protoUI({name:"math-editor",$init(){this.$view.className+=" webix_el_text"},$onBlur(){const t=webix.$$(this.config.suggest).$view.contains(document.activeElement);webix.delay((()=>{const e=webix.UIManager.getFocus();e&&e.config.pivotPropertyRemove||t||this.callEvent("onChange",[this.getValue(),null,"user"])}))},setValue(){const t=webix.$$(this.config.suggest);t.isVisible()||t._addFirst||webix.ui.text.prototype.setValue.apply(this,arguments)},$setValueHere(t){this.setValueHere(t)},setValueHere(t){const e=this.getValue(),i=this.getInputNode().selectionStart;let n=e.substring(0,i),r=e.substring(i);const a=j(r,!0);n+=r.substring(0,a),r=r.substring(a),"("==n[n.length-1]&&(n=n.substring(0,n.length-1)),n=n.substring(0,j(n))+t,this.$scope.app.getService("local").operations.find((e=>e.value==t))&&(n+="("==r[0]?"":"("),this.$setValue(n+r),this.getInputNode().setSelectionRange(n.length,n.length)}},webix.ui.text);class Y extends U{constructor(t,e,i){super(t,e,i),this.Local=this.app.getService("local"),this._=this.app.getService("locale")._,this.typeName="operation",this.plusLabel=this._("Add value"),this.field="values",this.operations=this.Local.operations,this.operations.map((t=>(t.value=this._(t.id),t)))}init(){super.init(),this.State=this.app.getState(),this.on(this.State.$changes,"mode",(()=>{this.ToggleColors()}))}GetValue(){const t=this.$$("forms").getChildViews(),e=[];return t.forEach((t=>{const i=t.getChildViews()[0].getValues({hidden:!1});webix.isUndefined(i.name2)||(i.name&&i.name2?(i.name=[i.name,i.name2],delete i.name2):i.name=""),""!=i.name&&""!=i.math&&(i.math&&(i.math=this.OutComplexMath(i.math)),e.push(i))})),e}ItemConfig(t,e){const i=super.ItemConfig(t);let n;if(t)n=t.operation;else{const t=this.app.config.defaultOperation,e=Math.max(this.operations.findIndex((e=>e.id==t)),0);n=this.operations[e].id}i.splice(2,0,{view:"richselect",name:"operation",width:110,value:n,options:{css:"webix_pivot_suggest",data:this.operations.filter((t=>t.fields<=2||"complex"==t.id))},on:{onChange:function(t){this.$scope.SetOperation(t,this)}}}),i.splice(2,0,{view:"richselect",hidden:2!=this.Local.getOperation(n).fields,value:t&&webix.isArray(t.name)?t.name[1]:"",name:"name2",options:{css:"webix_pivot_suggest",data:this.app.getState().fields}}),i.splice(1,0,{view:"math-editor",name:"math",hidden:!t||"complex"!=t.operation,value:t&&t.math?this.Local.fixMath(t.math):"",suggest:{view:"suggest-math",data:this.SuggestData()}});const r="mini"==webix.skin.$name||"compact"==webix.skin.$name,a=this.Local.getPalette(),o=t&&t.color||this.Local.getValueColor(e);return i.splice(1,0,{view:"colorpicker",hidden:"chart"!=this.State.mode,name:"color",css:"webix_pivot_value_color",value:o,width:r?30:38,suggest:{type:"colorboard",body:{width:150,height:150,view:"colorboard",palette:a}}}),i}ToggleColors(){const t=this.State.mode,e=this.$$("forms").getChildViews();for(let i=0;i<e.length;i++){const n=e[i].getChildViews()[0].elements.color;"chart"==t?n.show():n.hide()}}FilterSuggest(){return!0}SetOperation(t,e){const i=e.getFormView().elements;"complex"==t?(i.name.hide(),i.name2.hide(),i.math.show(),i.name.setValue(),i.name2.setValue()):2==this.Local.getOperation(t).fields?(i.name.show(),i.name2.show(),i.math.hide()):(i.name.show(),i.name2.hide(),i.math.hide())}SuggestData(){return[{value:this._("Fields"),id:"$fields",disabled:!0,$css:"webix_pivot_values_section"},...this.app.getState().fields,{value:this._("Methods"),id:"$methods",disabled:!0,$css:"webix_pivot_values_section"},...this.operations.filter((t=>"complex"!=t.id))]}OutComplexMath(t){const e=this.app.getState().fields,i=new RegExp("(\\(|\\s|,|^)("+e.map((t=>t.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"))).join("|")+")(\\)|\\s|,|$)","g"),n=Array.from(t.matchAll(i));for(let i=n.length-1;i>=0;i--){const r=n[i];t=t.substring(0,r.index+r[1].length)+e.find((t=>t.value==r[2])).id+t.substring(r.index+r[0].length-r[3].length,t.length)}const r=this.operations,a=new RegExp("(\\(|,|\\+|-|\\/|\\*|\\s|^)("+r.map((t=>t.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"))).join("|")+")\\(","g"),o=Array.from(t.matchAll(a));for(let e=o.length-1;e>=0;e--){const i=o[e];t=t.substring(0,i.index+i[1].length)+this.operations.find((t=>t.value==i[2])).id+t.substring(i.index+i[0].length-1,t.length)}return t}}class z extends U{constructor(t,e){super(t,e),this.field="groupBy"}config(){return{padding:10,rows:[{view:"richselect",localId:"group",options:{css:"webix_pivot_suggest",data:this.app.getState().fields,body:{template:t=>this.ListTemplate(t)},on:{onBeforeShow:()=>{this._activeInput=this.$$("group")}}},on:{onChange:(t,e,i)=>{"user"==i&&this.app.callEvent("property:change",[this.field,t])}}}]}}init(){this.State=this.getParam("state",!0)}GetValue(){return this.$$("group").getValue()}SetValue(t){this.$$("group").setValue(t)}}class W extends l{config(){const t=this.app.getService("locale")._;return{view:"form",complexData:!0,padding:10,elementsConfig:{labelWidth:120},elements:[{name:"type",view:"richselect",value:"bar",options:{css:"webix_pivot_suggest",data:[{id:"bar",value:t("Bar")},{id:"line",value:t("Line")},{id:"radar",value:t("Radar")},{id:"area",value:t("Area")},{id:"spline",value:t("Spline")},{id:"splineArea",value:t("Spline Area")},{id:"pie",value:t("Pie")},{id:"donut",value:t("Donut")}]}},{name:"xAxis.title",view:"text",label:t("X axis title"),batch:"axis"},{name:"yAxis.title",view:"text",label:t("Y axis title"),batch:"axis"},{name:"scaleColor",batch:"scale",view:"colorpicker",editable:!0,label:t("Scale color"),suggest:{type:"colorboard",body:{width:150,height:150,view:"colorboard",palette:this.app.getService("local").getPalette()}}},{name:"3D",view:"checkbox",batch:"pie",labelWidth:0,labelRight:t("3D")},{name:"pieInnerText",view:"checkbox",batch:"pie",labelWidth:0,labelRight:t("Show values inside")},{name:"stacked",view:"checkbox",batch:"stacked",labelWidth:0,labelRight:t("Stacked")},{name:"horizontal",view:"checkbox",batch:"bar",labelWidth:0,labelRight:t("Horizontal")},{name:"scale",batch:"scale",view:"checkbox",checkValue:"logarithmic",uncheckValue:"linear",labelWidth:0,labelRight:t("Logarithmic scale")},{name:"yAxis.lineShape",view:"checkbox",batch:"radar",checkValue:"arc",labelWidth:0,labelRight:t("Circled lines")},{name:"lines",batch:"scale",view:"checkbox",labelWidth:0,labelRight:t("Lines")}],on:{onChange:(t,e,i)=>{if("user"==i){const t=this.OutValues(this.getRoot().getValues());this.innerChange=!0,this.State.chart=Object.assign({},t),this.HandleVisibility(),delete this.innerChange}}}}}init(){this.State=this.getParam("state",!0),this.on(this.State.$changes,"chart",(t=>{this.innerChange||(this.getRoot().setValues(this.InValues(t)),this.HandleVisibility())}))}HandleVisibility(){const t=this.getRoot(),e=t.getValues().type;if("pie"==e||"donut"==e)t.showBatch("pie");else if(t.showBatch("scale"),"radar"==e)t.showBatch("radar",!0);else{t.showBatch("axis",!0);const i="bar"==e;(i||"area"==e)&&(i&&t.showBatch("bar",!0),t.showBatch("stacked",!0))}}InValues(t){const e=(t=webix.copy(t)).type.toLowerCase(),i="stackedarea"==e;return(-1!=e.indexOf("bar")||i)&&(-1!=e.indexOf("stacked")&&(t.stacked=1),-1!=e.indexOf("h")&&(t.horizontal=1),t.type=i?"area":"bar"),t}OutValues(t){const e="bar"==t.type;return(e||"area"==t.type)&&(e&&t.horizontal&&(t.type+="H",delete t.horizontal),t.stacked&&(t.type="stacked"+t.type[0].toUpperCase()+t.type.slice(1),delete t.stacked)),t}}class q extends l{config(){const t=this.app.getService("locale")._;return{view:"form",padding:10,elements:[{name:"cleanRows",localId:"cleanRows",view:"checkbox",labelWidth:0,labelRight:t("Clean rows")},{view:"label",height:20,label:t("Highlight")},{cols:[{name:"minX",view:"checkbox",labelWidth:0,labelRight:t("Min X")},{name:"maxX",view:"checkbox",labelWidth:0,labelRight:t("Max X")},{name:"minY",view:"checkbox",labelWidth:0,labelRight:t("Min Y")},{name:"maxY",view:"checkbox",labelWidth:0,labelRight:t("Max Y")}]},{view:"label",height:20,label:t("Footer")},{view:"radio",name:"footer",options:[{id:1,value:t("Off")},{id:2,value:t("On")},{id:3,value:t("Sum Only")}],value:1},{view:"label",height:20,label:t("Total Column")},{view:"radio",name:"totalColumn",options:[{id:1,value:t("Off")},{id:2,value:t("On")},{id:3,value:t("Sum Only")}],value:1}],on:{onChange:(t,e,i)=>{if("user"==i){const t=this.OutValues(this.getRoot().getValues());this.innerChange=!0,this.State.datatable=Object.assign({},t),delete this.innerChange}}}}}init(){this.State=this.getParam("state",!0),this.on(this.State.$changes,"datatable",(t=>{this.innerChange||this.getRoot().setValues(this.InValues(t))})),this.on(this.State.$changes,"mode",(t=>{"table"==t?this.$$("cleanRows").show():this.$$("cleanRows").hide()}))}InValues(t){return(t=webix.copy(t)).footer?t.footer="sumOnly"==t.footer?3:2:t.footer=1,t.totalColumn?t.totalColumn="sumOnly"==t.totalColumn?3:2:t.totalColumn=1,t}OutValues(t){switch(t.footer){case"1":delete t.footer;break;case"2":t.footer=!0;break;case"3":t.footer="sumOnly"}switch(t.totalColumn){case"1":delete t.totalColumn;break;case"2":t.totalColumn=!0;break;case"3":t.totalColumn="sumOnly"}return t}}class K extends l{config(){return this.Local=this.app.getService("local"),{view:"popup",css:"webix_pivot_filter_popup",template:t=>t.label,body:{view:"filter",field:"value",on:{onChange:t=>{if("user"==t){const t=this.app.getState(),e=webix.copy(t.structure);let i;e.filters=e.filters.filter((t=>{const e=t.name==this.field,n=e&&!t.external;return n&&(i=t.value=this.filter.getValue()),!e||n})),t.structure=e,this.app.callEvent("filter:change",[this.field,i])}}}}}}Show(t,e){const i=this.getRoot(),n=this.filter=i.getBody();this.field=e.name;const r=n.getChildViews()[2],a=this.Local.getField(this.field);this.Local.collectFieldValues(this.field).then((o=>{r.clearAll(),r.parse(webix.copy(o)),n.define({mode:a.type}),n.config.value="",n.setValue(webix.copy(e.value||{})),i.show(t)}))}}class X extends l{config(){const t=this.app.getService("locale")._;this.Compact=this.getParam("compact");const e=webix.skin.$active,i="mini"==webix.skin.$name||"compact"==webix.skin.$name,n={height:e.toolbarHeight,cols:[{view:"segmented",localId:"modes",align:"middle",inputHeight:e.inputHeight-e.inputPadding*(i?0:2),optionWidth:80,width:244,options:[{id:"table",value:t("Table")},{id:"tree",value:t("Tree")},{id:"chart",value:t("Chart")}],on:{onChange:(t,e,i)=>{"user"==i&&this.SetMode(t)}}},{width:e.dataPadding}]};return this.Compact&&(n.css="webix_pivot_footer",n.cols[1].width=0,n.cols.unshift({})),n}init(){this.State=this.getParam("state"),this.on(this.State.$changes,"mode",(t=>{this.$$("modes").setValue(t)}))}SetMode(t){this.State.mode=t}}class Q extends l{config(){const t=this.app.getService("locale")._;let e;if(this.Compact=this.getParam("compact"),this.State=this.getParam("state"),this.Compact)e={view:"icon",icon:"pt-settings",inputHeight:webix.skin.$active.buttonHeight,on:{onItemClick:()=>this.ToggleConfig()}};else{const i=t("Configure Pivot"),n="webix_template webix_pivot_measure_size";e={view:"template",borderless:!0,width:28+webix.html.getTextSize(i,n).width,template:()=>`\n\t\t\t\t\t\t<span>${i}</span>\n\t\t\t\t\t\t<span class="pt-settings webix_pivot_toolbar_icon"></span>`,onClick:{webix_pivot_settings:()=>this.ToggleConfig()}}}e.localId="config",e.css="webix_pivot_settings",e.tooltip=t("Click to configure");const i=webix.env.$customScroll?0:this._GetScrollWidth(),n=webix.skin.$active.toolbarHeight+i;let r="webix_pivot_toolbar";i&&(webix.html.addStyle(`.webix_pivot_bar_with_scroll .webix_pivot_settings>.webix_template{ line-height: ${n}px; }`),r+=" webix_pivot_bar_with_scroll");const a={css:r,margin:this.Compact?12:0,padding:{left:this.Compact?webix.skin.$active.inputPadding:0},height:n,cols:[e,this.GetFilters()]};return this.Compact||a.cols.push(X),a}init(){this.filterPopup=this.ui(K),this.on(this.State.$changes,"fields",(t=>{if(t.length){const t=this.$$("filters").getParentView();webix.ui(this.GetFilters(),t)}})),this.on(this.State.$changes,"structure",((t,e)=>{if(e&&this.FiltersChanged(t,e)){const t=this.$$("filters").getParentView();webix.ui(this.GetFilters(),t)}})),this.on(this.State.$changes,"readonly",(t=>{this.ToggleReadonly(t)}))}FiltersChanged(t,e){if(t.filters.length!=e.filters.length)return!0;for(let i=0;i<t.filters.length;i++){const n=t.filters[i],r=e.filters[i];if(n.name!=r.name||n.external!=r.external)return!0;if(JSON.stringify(n.value)!=JSON.stringify(r.value))return!0}return!1}ToggleConfig(){this.State.config=!this.State.config}ToggleReadonly(t){t?this.$$("config").hide():this.$$("config").show()}GetFilters(){const t=this.State.structure,e=[];this.State.fields.length&&t.filters.forEach((t=>{t.external||e.push(this.FilterConfig(t))}));const i=webix.skin.$active,n=(i.toolbarHeight-i.buttonHeight)/2;return{view:"scrollview",borderless:!0,scroll:"x",body:{margin:8,padding:{left:this.Compact?0:8,top:n+i.inputPadding,bottom:n+i.inputPadding},localId:"filters",cols:e}}}FilterConfig(t){const e=this.app.getService("local").getField(t.name).value;return{view:"template",borderless:!0,width:(this.Compact?0:28)+webix.html.getTextSize(e,"webix_template webix_pivot_measure_size").width,css:"webix_pivot_filter",template:()=>{const i=t.value,n=i&&(i.includes||i.condition.filter)?"webix_pivot_active_filter":"",r=this.Compact?"":"<span class='pt-filter webix_pivot_toolbar_icon'></span>";return`<div class="webix_pivot_filter_inner ${n}">\n\t\t\t\t\t<span>${e}</span>\n\t\t\t\t\t${r}\n\t\t\t\t</div>`},onClick:{webix_pivot_filter:function(){this.$scope.filterPopup.Show(this.$view,t)}}}}_GetScrollWidth(){const t=webix.html.create("DIV",{style:"visibility:hidden;overflow:scroll;"}),e=webix.html.create("DIV");document.body.appendChild(t),t.appendChild(e);const i=t.offsetWidth-e.offsetWidth;return t.parentNode.removeChild(t),i}}const J={JetView:l};J.chart=class extends l{config(){const t=this.State=this.getParam("state",!0),e={view:"chart",$mainView:!0,borderless:!0,localId:"data",xAxis:{},yAxis:{}};webix.extend(e,webix.copy(t.chart),!0);const i=e.type;"barH"==i||"stackedBarH"==i?e.yAxis.template||(e.yAxis.template=t=>t[t.length-1]):e.xAxis.template||(e.xAxis.template=t=>t[t.length-1]);const n={lines:e.lines};return e.scaleColor&&(n.color=n.lineColor=e.scaleColor),webix.extend(e.xAxis,n,!0),webix.extend(e.yAxis,n,!0),this.IsPieBased()&&webix.extend(e,{multilevel:!0,tooltip:this.ValueFormat,color:"#color#",type:i+(e["3D"]?"3D":""),pieInnerText:e.pieInnerText?this.ValueFormat:""},!0),e}init(){this.Local=this.app.getService("local"),this.LoadData(),this.on(this.State.$changes,"structure",((t,e)=>{e&&this.LoadData()})),this.on(this.State.$changes,"chart",((t,e)=>{e&&this.refresh()}))}LoadData(){return this.Local.getData().then((t=>{this.UpdateChart(t)}))}UpdateChart(t){this.$$("data").clearAll(),this.IsPieBased()||(this.$$("data").removeAllSeries(),this.SetSeries(t.values)),this.SetLegend(t.values),this.$$("data").parse(t.data)}IsPieBased(t){return t||(t=this.State.chart.type),"pie"==t||"donut"==t}SetSeries(t){for(let e=0;e<t.length;e++)this.$$("data").addSeries(this.GetSeriesConfig(t[e],e))}GetSeriesConfig(t,e,i){return{type:i=i||this.State.chart.type,value:t=>t[e],alpha:"area"==i||"splineArea"==i?.7:1,color:t.color,tooltip:t=>this.ValueFormat({value:t[e]}),item:{color:t.color,borderColor:t.color},line:{color:t.color}}}SetLegend(t){const e=this.app.getService("locale")._;t=t.map((t=>{const i=t.operation;let n=t.text;return"complex"==i?n=this.Local.fixMath(n):i&&(n=n.split(",").map((t=>this.Local.getField(t).value)).join(", "),n=`${n} (${e(i)})`),{color:t.color,text:n}}));const i=webix.extend({values:t,valign:"middle",align:"right",layout:"y"},this.State.chart.legend||{},!0);this.$$("data").define({legend:i})}ValueFormat(t){return t.text||parseFloat(t.value||0).toFixed(3)}},J.config=class extends l{config(){const t=this.app.getService("locale")._;return this.State=this.app.getState(),this.Compact=this.getParam("compact",!0),{margin:0,rows:[{type:"form",borderless:!0,padding:{left:16,right:14,top:8,bottom:4},cols:[{},{view:"button",label:t("Done"),hotkey:"esc",autowidth:!0,css:"webix_primary",click:()=>this.ToggleForm()}]},{borderless:!0,view:"scrollview",scroll:"y",body:{view:"accordion",css:"webix_pivot_configuration",localId:"settings",multi:!0,type:"space",padding:{left:16,right:16,top:4,bottom:16},margin:20,rows:[this.GroupConfig(t("Rows"),"pt-rows",{name:"rows",$subview:new U(this.app,"",{field:"rows",plusLabel:t("Add row")})},"table"),this.GroupConfig(t("Columns"),"pt-columns",{name:"columns",$subview:new U(this.app,"",{field:"columns",plusLabel:t("Add column")})},"table"),this.GroupConfig(t("Values"),"pt-values",{name:"values",$subview:Y}),this.GroupConfig(t("Group By"),"pt-group",{name:"groupBy",$subview:z},"chart"),this.GroupConfig(t("Filters"),"pt-filter",{name:"filters",$subview:new U(this.app,"",{field:"filters",plusLabel:t("Add filter")})}),this.GroupConfig(t("Chart"),"pt-chart",{$subview:W},"chart"),this.GroupConfig(t("Table"),"wxi-columns",{$subview:q},"table"),{}]}}]}}init(){this.on(this.State.$changes,"readonly",((t,e)=>{webix.isUndefined(e)||this.ToggleForm()}))}ready(){this.on(this.app,"property:change",((t,e)=>{this.HandleFieldChange(t,e)})),this.on(this.State.$changes,"structure",(()=>{this.innerChange||this.SetValues()})),this.on(this.State.$changes,"mode",((t,e)=>{const i="chart"==t;this.$$("settings").showBatch(i?"chart":"table"),e&&(i||"chart"==e)&&this.SetValues()}))}ToggleForm(){this.State.config=!this.State.config}SetValues(){const t=this.State.structure;["rows","columns","values","filters","groupBy"].forEach((e=>{const i=t[e]||this.State[e];this.getSubView(e).SetValue(i)}))}HandleFieldChange(t,e){const i=webix.copy(this.State.structure);"filters"==t?e=this.CorrectFilters(i,e):this.CorrectInputs(i,t,e),i[t]=e,this.innerChange=!0,this.app.setStructure(i),delete this.innerChange}GroupConfig(t,e,i,n){return{batch:n,header:`\n\t\t\t\t<span class="webix_icon webix_pivot_config_icon ${e}"></span>\n\t\t\t\t<span class="webix_pivot_config_label">${t}</span>\n\t\t\t`,body:i,borderless:!0}}GetCorrections(){return{rows:["columns","values","groupBy"],columns:["rows","values"],values:["rows","columns","groupBy"],groupBy:["rows","values"]}}CorrectFilters(t,e){for(let i=0;i<e.length;i++){const n=t.filters.find((t=>{if(t.name==e[i])return!0}));e[i]={name:e[i]},n&&!n.external&&(e[i].value=n.value)}const i=t.filters.filter((t=>t.external));return e=e.concat(i)}CorrectInputs(t,e,i){const n=this.GetCorrections()[e];n&&("string"==typeof i&&(i=[i]),i=i.map((t=>t.name?t.name:t)),n.forEach((e=>{const n=this.getSubView(e);let r=n.GetValue();"string"==typeof r?i.find((t=>t==r))&&(r=""):r=r.filter((t=>(t.name&&(t=t.name),-1==i.indexOf(t)))),t[e]=r,n.SetValue(r)})))}},J["config/popup"]=class extends l{config(){return this.app.getService("jet-win").updateConfig({view:"window",borderless:!0,fullscreen:!0,head:!1,body:{$subview:!0}})}},J["config/properties/chart"]=W,J["config/properties/group"]=z,J["config/properties"]=U,J["config/properties/table"]=q,J["config/properties/values"]=Y,J.filter=K,J.main=class extends l{config(){M||(M=!0,webix.protoUI({name:"r-layout",sizeTrigger(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;const n=t.config;this._forceCompact=void 0!==n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout));const t=this.getParam("forceCompact");webix.isUndefined(t)||this.setParam("compact",t),this.Compact=this.getParam("compact");const e=[Q,{view:"r-layout",localId:"main",cols:[{$subview:!0}]}];return this.Compact?e.push(X,{$subview:!0,name:"edit",popup:!0}):e[1].cols.push({view:"proxy",maxWidth:450,localId:"edit",css:"webix_pivot_config_container webix_shadow_medium",borderless:!0,hidden:!0,body:{$subview:!0,name:"edit"}}),{margin:0,rows:e,view:webix.isUndefined(t)?"r-layout":"layout"}}init(){const t=this.getParam("state");this.$$("main").sizeTrigger(this.app,(t=>this.SetCompactMode(t)),!!this.Compact),this.on(t.$changes,"mode",(t=>{this.show("./"+("chart"==t?"chart":"table"))})),this.on(t.$changes,"config",(t=>{t?this.ShowConfig():this.HideConfig()}))}ShowConfig(){this.Compact?this.show("config.popup/config",{target:"edit"}):(this.$$("edit").show(),this.show("config",{target:"edit"}))}HideConfig(){this.show("_blank",{target:"edit"}),this.Compact||this.$$("edit").hide()}SetCompactMode(t){webix.delay((()=>{this.setParam("compact",t),t||webix.fullscreen.exit(),this.refresh()}))}},J.mode=X,J.table=class extends l{config(){this.Local=this.app.getService("local");const t=this.State=this.getParam("state",!0),e=t.structure.rows.length,i={view:"treetable",$mainView:!0,localId:"data",css:"webix_data_border webix_header_border",select:!0,leftSplit:"table"==t.mode?e:e?1:0,resizeColumn:!0,borderless:!0,columns:[],footer:t.datatable.footer};return webix.extend(i,t.datatable,!0),i}init(){this.LoadData(),this.on(this.State.$changes,"structure",((t,e)=>{e&&this.LoadData()})),this.on(this.State.$changes,"datatable",((t,e)=>{e&&this.refresh()})),this.on(this.State.$changes,"mode",((t,e)=>{e&&"chart"!=e&&"chart"!=t&&this.refresh()}))}LoadData(){return this.Local.getData().then((t=>{this.UpdateTable(t)}))}UpdateTable(t){const e=this.State,i=e.structure,n=this.CheckFreeze();let r=0;const a=e.datatable.totalColumn;let o;if(a){const t=i.values;o="sumOnly"==a?t.filter((t=>"sum"==t.operation)):t,n&&(r=o.length)}let s=0;if(n){const t=i.rows.length;s="table"==e.mode?t:t?1:0}if(!t.$ready){const e=t.totalColumn;let i;if(e){i=t.header[t.header.length-1].id;for(let e=0;e<o.length;e++){let n=o[e].name;webix.isArray(n)&&(n=n.join()),t.header.push({header:[{name:"total",colspan:r},{text:n||o[e].operation,operation:o[e].operation}],id:i+e+1})}}const n={i:0};t=this.Local._store={data:t.data.map((t=>this._prepareData(t,e,n,i))),columns:this.SetColumns(t.header,t.footer,t.marks),$ready:1}}const l=this.$$("data");l.clearAll(),l.define({leftSplit:s,rightSplit:r},!0),l.refreshColumns(t.columns),l.parse(t.data)}_prepareData(t,e,i,n){const r="table"==this.State.mode;let a;(r||e&&!t.data)&&(a=i.i++);const o=new Proxy(t,{get:(t,i)=>{if("data"==i)return t.vals;if(r&&"id"==i)return a+1;const o=1*i;if(!isNaN(o)){const i="object"==typeof t.values?t.values:t;return e&&o>n&&(a||0===a)?e[a][o-n-1]:i[o-1]}return t[i]}});return t.data&&(o.open=!0,o.vals=t.data.map((t=>this._prepareData(t,e,i,n)))),o}CheckFreeze(){const t=this.app.config.freezeColumns,e=this.getParam("compact",!0);return webix.isUndefined(t)?!e:t}SetColumns(t,e,i){t=webix.copy(t);const n=this.app.getService("locale")._,r=this.State.structure.rows.length,a="table"==this.State.mode?r:r?1:0;for(let r=0;r<t.length;r++)if(r<a)this.SetFirstColumn(t[r],!r&&this.State.datatable.footer,n);else{t[r].sort="int",t[r].format||(t[r].format=this.CellFormat),i.length&&(t[r].cssFormat=(t,e,n,r)=>{const a=i[n-1],o=a?a[r-1]:null;return o?o.join(" "):""});const a=t[r].header;for(let t=0;t<a.length;t++){let e=a[t];e&&(t||"total"!=e.name?t==a.length-1&&(e.text=this.HeaderTemplate(e,n)):e.text=n("Total"))}e.length&&(t[r].footer=this.CellFormat(e[r]))}return t}SetFirstColumn(t,e,i){"tree"==this.State.mode?(t.header={text:this.State.structure.rows.map((t=>this.Local.getField(t).value)).join("<span class='webix_icon wxi-angle-right'></span>"),css:"webix_pivot_tree_header"},t.width=300,t.template=(t,e)=>e.treetable(t,e)+t[1]):(t.header=this.Local.getField(t.header[0].text).value,t.width=200),e&&(t.footer=i("Total"))}HeaderTemplate(t,e){if(t.operation&&"complex"!=t.operation){let i=t.text.split(",");return i=i.map((t=>this.Local.getField(t).value)).join(", "),`${i} <span class="webix_pivot_operation">${e(t.operation)}</span>`}return this.Local.fixMath(t.text)}CellFormat(t){return t||(t=0===t?"0":""),t?parseFloat(t).toFixed(3):t}},J.toolbar=Q;const Z=(t,e)=>t.key>e.key?1:-1,tt=(t,e)=>t.key<e.key?1:-1;class et{constructor(t,e,i,n,r){"desc"===r?this._sort=tt:"asc"===r?this._sort=Z:r&&(this._sort=(t,e)=>r(t.key,e.key)),this._label=i,this._meta=n||null,this._table=t,this._getter=e,this._prepared=0}getIndexes(){return this._indexes}getValue(t){return this._values[t].key}getSize(){return this._values.length}getLabel(){return this._label}getOptions(){return this._prepareOptions(),this._values.map((t=>t.key))}getMeta(){return this._meta}reset(){this._prepared=0}prepare(){if(1&this._prepared)return;this._prepared=1|this._prepared,this._prepareOptions();const{_table:t,_getter:e,_keys:i}=this,n=t.count();this._values.forEach(((t,e)=>t.index=e));const r=this._indexes=new Array(n);for(let t=0;t<n;t++){const n=e(t);r[t]=i.get(n).index}}_prepareOptions(){if(2&this._prepared)return;this._prepared=2|this._prepared;const{_table:t,_getter:e}=this,i=t.count(),n=this._keys=new Map,r=this._values=[];for(let t=0;t<i;t++){const i=e(t);void 0===n.get(i)&&n.set(i,r[r.length]={key:i,index:0})}this._sort&&r.sort(this._sort)}}class it{constructor(t){this._pivot=t}toArray({cleanRows:t,filters:e,ops:i}){const n=[],r=this._pivot.getLimit().rows||0;this._pivot.filter(e),this._pivot.operations(i),this._pivot.resetCursor();let a=0;const o=new Set,s=new Map,l=[];for(;;){const t={},e=this._pivot.next(o,n.length,s,t);if(!e)break;if(n.push(e),l.push(t),a++,r===a)break}const[u,c]=this._pivot.getWidth();t&&this._cleanRows(n,u);const h={data:n,columns:Array.from(o).sort(((t,e)=>t>e?1:-1)),width:c+u,scaleWidth:u,rowData:l};return h.columnData=this._pivot.aggregateColumns(h,s),h.marks=this._pivot.mark(h,s),h}toNested({filters:t,ops:e}){this._pivot.filter(t),this._pivot.operations(e),this._pivot.resetCursor();const i=new Map,n=this._pivot.nested(i);return n.columnData=this._pivot.aggregateColumns(n,i),n.marks=this._pivot.mark(n,i),n}toXHeader(t,e){return this._pivot.getXHeader(t,e)}_cleanRows(t,e){const i=t.length,n=new Array(e);for(let r=0;r<i;r++){const i=t[r];for(let t=0;t<e;t++){if(n[t]!==i[t]){for(let r=t;r<e;r++)n[r]=i[r];break}i[t]=""}}}}function nt(t,e){return new Function(e.propertyName,e.methodName,e.contextName,"return "+function(t,e){let i="";const n=t.length;let r=0,a=!1,o=!1,s=0;for(;r<n;){const n=t[r];if(r++,'"'===n)a?i+=t.substr(s,r-s):s=r-1,a=!a;else{if(a)continue;const l=","===n||"/"===n||"*"===n||"+"===n||"-"===n||"("===n||")"===n,u=" "===n||"\t"===n||" \n"===n||"\r"===n;if(o){if(!l&&!u)continue;{const a=t.substr(s,r-s-1);i+="("===n?e.method(a):e.property(a),o=!1}}if(u)continue;l||"0"===n||"1"===n||"2"===n||"3"===n||"4"===n||"5"===n||"6"===n||"7"===n||"8"===n||"9"===n?i+=n:(o=!0,s=r-1)}}return o&&(i+=e.property(t.substr(s,r-s))),i}(t,e))}function rt(t,e,i,n){const r=ut(t,i),a={table:t,order:e,from:0,to:0,array:(t,e)=>{const i=e.to-e.from,n=new Array(i),r=lt[t];for(let t=0;t<i;t++)n[t]=r(e.order[t+e.from]);return n}};return function(t,e){return a.from=t,a.to=e,r(0,n,a)}}function at(t,e,i,n){const r=ut(t,i),a={table:t,order:e,range:[],array:(t,e)=>{const i=a.range.length,n=[],r=lt[t];for(let t=0;t<i;t+=2){const i=a.range[t],o=a.range[t+1];for(let t=i;t<o;t++)n.push(r(e.order[t]))}return n}};return function(t){return a.range=t,r(0,n,a)}}function ot(t,e){const i=nt(t,{propertyName:"d",methodName:"m",contextName:"c",property:()=>"d",method:t=>"m."+t.toLowerCase()});return function(t){return i(t,e,null)}}let st=0;const lt=[];function ut(t,e){return nt(e,{propertyName:"d",methodName:"m",contextName:"c",property:e=>{const i=st;return lt[i]=t.getColumn(e).getter,st+=1,`c.array("${i}", c)`},method:t=>"m."+t.toLowerCase()})}const ct=(t,e)=>i=>t(i)&&e(i);function ht(t,e,i,n){const r=n.getter(t,e);if("object"!=typeof i){const t=n.compare.eq(i);return e=>t(r(e))}{const t=Object.keys(i);let e=null;for(let a=0;a<t.length;a++){const o=n.compare[t[a].toLowerCase()](i[t[a]]),s=t=>o(r(t));e=e?ct(e,s):s}return e}}class pt{constructor(t,e,i,n,r){this._rows=e,this._cols=i,this._dims=e.concat(i),this._table=t,this._context=r,this._cursor=-1,this._order=this._base_order=this._sort(),this._data=this._dims.map((t=>t.getIndexes())),this.filter(n,!0)}resetCursor(){this._cursor=0,this._group=this._dims.map((()=>null)),this._order.length&&(this._rows.length&&this._nextRow(),this._cols.length&&this._nextColumn())}next(t,e,i,n){const{_cursor:r,_cols:a,_order:o,_group:s,_ops:l,_rows:u}=this;if(this._cursor>=o.length)return null;const c=u.length,h=new Array(c+l.length*a.length);for(let t=0;t<c;t++)h[t]=u[t].getValue(s[t]);const p=this._rows.length?this._nextRow(a.length>0):o.length;return this._fillRow(h,e,r,p,c,t,i,n),this._cursor=p,h}nested(t){const{_cols:e,_order:i,_rows:n}=this,r=new Set,a=n.length,o=a>0?1:0,s=[{data:[],values:[]}],l=[];let u=[],c=[],h=this._cursor,p=0;const{_groupOps:d}=this,f=[{}].concat(n.map((()=>({})))),g=[],v=this._context.limit.rows,m=Math.min(this._context.limit.columns,(e.length?this._sizes[0]*e[0].getSize():0)+o),w=function(e){if(s[e])for(;e<a;e++)for(const[i,n]of t){const t=f[e][i]||0;if(0===t||n.length>t)for(let r=0;r<d.length;r++){const a=d[r];a&&(s[e].values[o+i+r]=a(n.slice(t+1)),f[e][i]=n.length-1)}}};for(;this._cursor<i.length;){const f=new Array(m);u=c,c=[].concat(this._group);const _=this._rows.length?this._nextRow(e.length>0):i.length;if(null!==d)for(let t=0;t<a;t++)if(c[t]!=u[t]){w(t+1);break}const y={};if(this._fillRow(f,l.length,h,_,o,r,t,y),g.push(y),a>0){for(let t=0;t<a;t++)if(c[t]!=u[t]){for(let e=t;e<a;e++){const t=e+1,i=t===a,r=s[t]={id:i?l.length+1:0,data:i?null:[],values:i?f:[n[e].getValue(c[e])]};s[e].data.push(r)}break}f[0]=n[a-1].getValue(c[a-1]),s[a].values=f}else s[0].data.push({data:null,values:f});if(l.push(f),p++,p>=v)break;this._cursor=h=_}null!==d&&w(1);const _=Array.from(r).sort(((t,e)=>t>e?1:-1)),y={tree:s[0].data,data:l,width:m,scaleWidth:o,columns:_,rowData:g};return this._fillGroupRow(s[0],y,t,n.length-1),y}getLimit(){return this._context.limit}getWidth(){return[this._rows.length,this._cols.length&&this._ops.length?this._cols[0].getSize()*this._sizes[0]:0,this._ops.length]}getXHeader(t,e){const{_cols:i,_rows:n,_ops:r,_opInfo:a}=this,{nonEmpty:o,meta:s}=e||{},l=t.tree,u=[],c=t.tree?Math.min(n.length,1):n.length,h=r.length,p=i.map((t=>t.getSize())),d=p.reduce(((t,e)=>t*e),h),f=t.columns,g=c+Math.min(o?f.length*h:d,this._context.limit.columns);let v=d;const m=p.map((t=>v/=t)),w=[];if(this._cols.forEach((()=>w.push(new Array(g)))),o){for(let t=0;t<c;t++)u.push(t);for(let t=0;t<f.length;t++){const e=c+f[t];for(let t=0;t<h;t++)u.push(e+t)}for(let t=0;t<i.length;t++){const e=m[t];let n,r=-1,a=0,o=0;for(let s=c;s<u.length;s+=h){const l=u[s];if(l<a)o+=h;else{0!==o&&(w[t][r]={colspan:o,text:n});const u=Math.floor((l-c)/e);r=s,a=(u+1)*e+c,o=h,n=i[t].getValue(u%p[t])}}0!==o&&(w[t][r]={colspan:o,text:n})}}else for(let t=0;t<i.length;t++){const e=p[t],n=m[t];let r=0;for(let a=c;a<g;a+=n)w[t][a]=1===n?i[t].getValue(r++):{text:i[t].getValue(r++),colspan:n},r>=e&&(r=0)}if(this._ops){const t=new Array(g),e=r.length;for(let i=c;i<g;i+=e)for(let n=0;n<e;n++)t[i+n]=a[n].label;w.push(t)}for(let t=0;t<c;t++){const e=i.length+(this._ops?1:0);if(l){w[0][0]={text:"",rowspan:e};break}const r=n[t].getLabel();w[0][t]=e>1?{text:r,rowspan:e}:r}const _={data:w};if(o&&(_.nonEmpty=u),s){const t=new Array(g);for(let e=0;e<c;e++)t[e]=n[e].getMeta();const e=r.length;for(let i=c;i<g;i+=e)for(let n=0;n<e;n++)t[i+n]=a[n].meta;_.meta=t}return _}filter(t,e){if(!t||0===Object.keys(t).length){if(e||!this._masterRules)return void(this._order=this._base_order);t=Object.assign(Object.assign({},this._masterRules),t)}e&&(this._masterRules=t),this._order=function(t,e,i,n){const r=function(t,e,i){const n=Object.keys(e);let r=null;for(let a=0;a<n.length;a++){const o=n[a],s=ht(t,o,e[o],i);r=r?ct(r,s):s}return r}(e,i,n);return t.filter((t=>r(t)))}(this._base_order,this._table,t,this._context)}operations(t){const{_table:e,_order:i,_context:n}=this;t=t||[],this._ops=t.map((t=>rt(e,i,"string"==typeof t?t:t.math,n.math))),this._groupResultOps=t.map((t=>"result"===t.branchMode?ot("string"==typeof t?t:t.branchMath||t.math,n.math):null)),this._groupResultOps.find((t=>null!==t))||(this._groupResultOps=null),this._groupOps=t.map((t=>"raw"===t.branchMode?at(e,i,"string"==typeof t?t:t.branchMath||t.math,n.math):null)),this._groupOps.find((t=>null!==t))||(this._groupOps=null),this._opInfo=t.map((t=>"string"==typeof t?{label:t,math:t}:Object.assign(Object.assign({},t),{label:t.label||t.math}))),this._rowResultOps=dt(t,"row","result",((t,e)=>({name:e,op:ot(t,n.math)}))),this._rowOps=dt(t,"row","raw",((t,r)=>({name:r,op:rt(e,i,t,n.math)}))),this._colResultOps=dt(t,"column","result",((t,e)=>({name:e,op:ot(t,n.math)}))),this._colOps=dt(t,"column","raw",((t,r)=>({name:r,op:at(e,i,t,n.math)}))),this._marks=t.map((t=>t.marks||null)),this._marks.find((t=>null!==t))||(this._marks=null),this._setSizes()}aggregateColumns(t,e){const{_colOps:i,_colResultOps:n}=this,{columns:r,data:a,scaleWidth:o}=t;if(!i&&!n)return[];const s=this._ops.length,l=[];for(let t=0;t<r.length;t++){const u=r[t],c=e.get(u);if(!c)continue;const h=Array.from(c[0].keys());for(let t=0;t<s;t++){const e={};if(n){const i=n[t];if(i){const n=h.map((e=>a[e][u+t+o]));i.forEach((t=>e[t.name]=t.op(n)))}}if(i){const n=i[t];n&&n.forEach((t=>e[t.name]=t.op(c.slice(1))))}l[o+u+t]=e}}return l}_optimizeGroup(t){const e={};let i=!0;for(const n in t){const r=t[n];e[n]=ot(r,this._context.math),i=!1}return i?null:e}mark(t,e){const i=[],{_marks:n,_ops:r}=this;if(!n)return i;const a=r.length,{scaleWidth:o,data:s,columnData:l,rowData:u}=t;for(const[t,n]of e){const e=n[0];for(let n=0;n<a;n++){const r=this._marks[n];if(null!==r)for(const a of e){const e=t+n+o,c=a,h=[];for(let t=0;t<r.length;t++)r[t].check(s[c][e],l[e]||{},u[c]||{})&&h.push(r[t].name);if(h.length){let t=i[c];void 0===t&&(t=i[c]=[]),t[e]=h}}}}return i}__getHeaderStub(){return{}}_fillGroupRow(t,e,i,n){const{_groupResultOps:r}=this,{columns:a,scaleWidth:o}=e;if(r)for(let e=0;e<a.length;e++){const i=a[e];for(let e=0;e<r.length;e++){const a=r[e];a&&n>0&&this._fillGroupRowInner(t,a,i+e+o,n)}}}_fillGroupRowInner(t,e,i,n){const r=[];if(n>0)t.data.forEach((t=>{const a=this._fillGroupRowInner(t,e,i,n-1);null!==a&&r.push(a)}));else for(let e=0;e<t.data.length;e++){const n=t.data[e].values[i];void 0!==n&&r.push(n)}return r.length?t.values[i]=e(r):null}_fillRow(t,e,i,n,r,a,o,s){const{_cols:l,_group:u,_ops:c,_sizes:h,_rows:p,_rowResultOps:d,_rowOps:f}=this,g=p.length,v=null!==this._colResultOps||null!==this._colOps||null!==this._marks;let m=[];if(null!==d&&(m=d.map((()=>[]))),c.length)if(l.length){let s=i;for(;s<n;){let i=0;for(let t=0;t<l.length;t++)i+=h[t]*u[g+t];const n=this._nextColumn();for(let e=0;e<c.length;e++){const a=t[i+r+e]=c[e](s,n);null!==d&&m[e].push(a)}if(v){let t=o.get(i);t?t.push(s,n):o.set(i,t=[new Set,s,n]),t[0].add(e)}a.add(i),this._cursor=s=n}}else{for(let e=0;e<c.length;e++)t[e+r]=c[e](i,n);if(v){let t=o.get(0);t?t.push(i,n):o.set(0,t=[new Set,i,n]),t[0].add(e)}a.add(0)}null!==d&&d.forEach(((t,e)=>{const i=m[e];t&&i.length&&t.forEach((t=>{s[t.name]=t.op(m[e])}))})),null!==f&&f.forEach((t=>{null==t||t.forEach((t=>{s[t.name]=t.op(i,n)}))}))}_sort(){const{_table:t,_dims:e}=this,i=Math.min(t.count(),this._context.limit.raws),n=new Array(i);for(let t=0;t<i;t++)n[t]=t;const r=e.length,a=e.map((t=>t.getIndexes()));return n.sort(((t,e)=>{for(let i=0;i<r;i++){const n=a[i][t],r=a[i][e];if(n>r)return 1;if(n<r)return-1}return 0})),n}_nextRow(t){const{_data:e,_order:i,_group:n,_rows:r}=this,a=r.length;let o=!0,s=this._cursor;for(;;){const r=i[s];for(let i=0;i<a;i++)e[i][r]!=n[i]&&(t||(n[i]=e[i][r]),o=!1);if(!o)break;s++}return s}_nextColumn(){const{_data:t,_order:e,_group:i,_rows:n,_cols:r}=this,a=r.length+n.length;let o=!0,s=this._cursor;for(;;){const n=e[s];for(let e=0;e<a;e++)t[e][n]!=i[e]&&(i[e]=t[e][n],o=!1);if(!o)break;s++}return s}_setSizes(){const t=this._cols.map((t=>t.getSize()));let e=this._ops.length||1;for(let i=t.length-1;i>=0;i--){const n=e;e*=t[i],t[i]=n}this._sizes=t}}function dt(t,e,i,n){const r=t.map((t=>{const r=t[e];if(!r)return null;const a=r.map((t=>(t.source||"raw")===i?"string"==typeof t?n(t,ft(t)):n(t.math,t.as||ft(t.math)):null)).filter((t=>null!==t));return a.length?a:null}));return r.find((t=>!!t))?r:null}function ft(t){const e=t.indexOf("(");return-1===e?t.trim():t.substring(0,e).trim()}class gt{constructor(t){this._columns=t.fields,this.parse(t.data)}parse(t){this._raw=t,this._parse_inner()}prepare(){if(this._prepared)return;this._prepared=!0;const t=this._raw,e=this._columns.filter((t=>3===t.type));if(!t||!e.length)return;const i=t.length,n=e.length;for(let t=0;t<i;t++)for(let i=0;i<n;i++){const n=e[i],r=n.getter(t);"string"==typeof r&&n.setter(t,new Date(r))}}_parse_inner(){this._columns.forEach((t=>{const e=t.id;t.getter=t=>this._raw[t][e],t.setter=(t,i)=>this._raw[t][e]=i}))}getColumn(t){return this._columns.find((e=>e.id===t))}count(){return this._raw.length}}class vt extends gt{parse(t){this._parse_init(t.length);const e=t.length,i=this._columns.length;for(let n=0;n<e;n++){const e=t[n];for(let t=0;t<i;t++){const i=this._columns[t];i.data[n]=e[i.id]}}}_parse_init(t){this._columns.forEach((e=>{const i=e.data=new Array(t);e.getter=t=>i[t],e.setter=(t,e)=>i[t]=e}))}count(){return this._columns[0].data.length}}const mt={round:t=>Math.round(t),sum:t=>t.reduce(((t,e)=>t+e),0),min:t=>t.reduce(((t,e)=>e<t?e:t),t.length?t[0]:0),max:t=>t.reduce(((t,e)=>e>t?e:t),t.length?t[0]:0),avg:t=>t.length?t.reduce(((t,e)=>t+e),0)/t.length:0,wavg:(t,e)=>{if(!t.length)return 0;let i=0,n=0;for(let r=t.length-1;r>=0;r--)i+=e[r],n+=t[r]*e[r];return n/i},count:t=>t.length,any:t=>t.length?t[0]:null},wt={eq:t=>e=>e==t,neq:t=>e=>e!=t,gt:t=>e=>e>t,gte:t=>e=>e>=t,lt:t=>e=>e<t,lte:t=>e=>e<=t,in:t=>e=>t[e],hasPrefix:t=>e=>0===e.indexOf(t),contains:t=>e=>-1!==e.indexOf(t)},_t={year:t=>t.getFullYear(),month:t=>t.getMonth(),day:t=>t.getDate(),hour:t=>t.getHours(),minute:t=>t.getMinutes()};class yt{constructor(t){this._tables={},this._dimensions={},this._preds=Object.assign({},_t),this._maths=Object.assign({},mt),this._comps=Object.assign({},wt),t&&t.tables&&t.tables.forEach((t=>this.addTable(t))),t&&t.dimensions&&t.dimensions.forEach((t=>this.addDimension(t)))}addPredicate(t,e){this._preds[t.toLowerCase()]=e}addMath(t,e){this._maths[t.toLowerCase()]=e}addComparator(t,e){this._comps[t.toLowerCase()]=e}getDimension(t){return this._dimensions[t]}addDimension(t){if(this._dimensions[t.id])return;const e=this._tables[t.table],i=this._predicateGetter(e,t.rule.by);this._dimensions[t.id]=new et(e,i,t.label||t.id,t.meta||t,t.sort)}resetDimensions(t,e){const i=this._dimensions;this._dimensions={},t&&t.forEach((t=>{const n=i[t.id];e&&n?this._dimensions[t.id]=n:this.addDimension(t)}))}addTable(t){const e="raw"===(t.driver||"raw")?gt:vt,i=this._tables[t.id]=new e(t);t.prepare&&i.prepare()}getTable(t){return this._tables[t]}compact(t,e){const{rows:i,cols:n,filters:r,limit:a}=e,o=this._tables[t],s=i?i.map((t=>this._dimensions[t])):[],l=n?n.map((t=>this._dimensions[t])):[];[...s,...l].forEach((t=>t.prepare()));const u=new pt(o,s,l,r,{getter:this._predicateGetter.bind(this),math:this._maths,compare:this._comps,limit:Object.assign({rows:1e4,columns:5e3,raws:1/0},a||{})});return new it(u)}_predicateGetter(t,e){const i=e.indexOf("(");if(-1!==i){const n=this._preds[e.substr(0,i).toLowerCase()];e=e.substr(i+1,e.length-i-2);const r=t.getColumn(e).getter;return t=>n(r(t))}return t.getColumn(e).getter}}class bt{constructor(t){this._app=t,this._store={},this._filtersHash={},this._state=t.getState(),t.config.externalProcessing?this._setOperations():(this._data=[],this._initRengine())}_setOperations(){this.operations=[{id:"sum",fields:1,branchMode:"result"},{id:"min",fields:1,branchMode:"result"},{id:"max",fields:1,branchMode:"result"},{id:"avg",fields:1,branchMode:"raw"},{id:"wavg",fields:2,branchMode:"raw"},{id:"count",fields:1,branchMode:"raw"},{id:"any",fields:1,branchMode:"result"},{id:"complex"}];const t=this._app.config,e=this._app.config.operations;if(e)if(t.externalProcessing)this.operations=this.operations.concat(e);else for(let t in e){let i,n,r,a=e[t];"object"==typeof a?(i=a.fields||a.handler.length,n=a.branchMode,r=a.hidden,a=a.handler):i=a.length,this._reng.addMath(t,a),r||this.operations.push({id:t,fields:i,branchMode:n})}}_setTotalOperations(){this.totalOperations={};const t=this._app.config.totalOperations;if(t)for(let e in t){const i=t[e],n="string"==typeof t[e];["footer","group","column"].forEach((t=>{(n||i[t])&&(this.totalOperations[t]||(this.totalOperations[t]={}),this.totalOperations[t][e]=n?i:i[t])}))}}_setFilters(){for(let t in webix.filters)this._reng.addComparator(t,(e=>i=>("date"==t&&(i=i.valueOf()),!e||(e.includes?-1!=e.includes.indexOf(i):!e.condition.filter||webix.filters[t][e.condition.type](i,e.condition.filter)))))}_setPredicates(){const t=this._app.config.predicates;if(t)for(let e in t)this._reng.addPredicate(e,t[e])}getFields(t){let e=this._app.config.fields;if(!e){e=[];for(let i in t){let n;const r=typeof t[i];switch(r){case"string":n="text";break;case"number":n=r;break;default:n="date"}e.push({id:i,value:i,type:n})}}return e}getData(t){if(!t&&this.useOldData())return this._dataLoad||webix.promise.resolve(this._store);const e=this._app.config.externalProcessing;return e||!Object.keys(this._store).length||t?this._dataLoad=this._app.getService("backend").data().then((t=>(e?this._store=this._rengineToWebix(t.result,t.header):(this._table=this.getTable(t),this._reng.addTable(this._table),this._store=this.getPivotData()),this._filtersHash={},this._store))).catch((t=>this.loadError(t))).finally((()=>delete this._dataLoad)):(this._store=this.getPivotData(),webix.promise.resolve(this._store))}useOldData(){const t=this._state;let e=`${t.mode}|${JSON.stringify(t.structure)}`;if("chart"==t.mode){const i=t.chart.type;e+="|"+("pie"==i||"donut"==i)}else e+="|"+JSON.stringify(t.datatable);const i=this._old==e;return this._old=e,i}_initRengine(){this._reng=new yt,this._setFilters(),this._setOperations(),this._setTotalOperations(),this._setPredicates()}getPivotData(){if(!this._table)return{data:[],header:[],total:[],marks:[]};const t=this._state.structure,e=this._state.mode,i=this._state.datatable;this.setDimensions();const n={};for(let e=0;e<t.filters.length;e++){const i=t.filters[e],r=this._state.fields.find((t=>t.id==i.name));n[i.name]={[r.type]:i.value}}const r=this._reng.compact(this._table.id,{rows:this.getRows(),cols:this.getColumns(),limit:this.getLimits()}),a=this.getOps();try{let t,o;return t="table"==e?r.toArray({filters:n,ops:a,cleanRows:i.cleanRows}):r.toNested({filters:n,ops:a}),"chart"!=e&&(o={meta:!0,nonEmpty:!0}),this._rengineToWebix(t,r.toXHeader(t,o))}catch(t){return this.loadError()}}_updateTotalMath(t,e,i){for(let n=i.length-1;n>=0;n--){const r=i[n];e=e.substring(0,r.index+r[1].length)+(this.totalOperations[t][r[2]]||r[2])+e.substring(r.index+r[0].length-1,e.length)}return e}getOps(){const t=this._state,e=t.datatable,i=t.mode,n=t.structure.values,r=[];for(let t=0;t<n.length;t++){const a=n[t].format,o=n[t].operation,s=n[t].color,l="complex"==o;let u=l?n[t].math:n[t].name;u=webix.isArray(u)?u.join(","):u;const c=l?u:`${o}(${u})`;let h;l||(h=this.getOperation(o).branchMode);const p={math:c,branchMode:h||"raw",label:u,meta:{operation:o,format:a,color:s},column:[],row:[],marks:[]},d=this.totalOperations;let f;if(Object.keys(d).length){const t=new RegExp("(\\(|,|\\+|-|\\/|\\*|\\s|^)("+this.operations.map((t=>t.id)).join("|")+")\\(","g");f=Array.from(c.matchAll(t))}d.group&&(p.branchMath=this._updateTotalMath("group",c,f)),"chart"!=i&&(e.footer&&("sumOnly"==e.footer&&"sum"==o||"sumOnly"!=e.footer)&&p.column.push({math:d.footer?this._updateTotalMath("footer",c,f):c,as:"value"}),e.totalColumn&&("sumOnly"==e.totalColumn&&"sum"==o||"sumOnly"!=e.totalColumn)&&p.row.push({math:d.column?this._updateTotalMath("column",c,f):c,as:""+t}),e.minY&&(p.column.push({as:"minY",math:"min(group)",source:"result"}),p.marks.push({name:"webix_min_y",check:(t,e)=>t==e.minY})),e.maxY&&(p.column.push({as:"maxY",math:"max(group)",source:"result"}),p.marks.push({name:"webix_max_y",check:(t,e)=>t==e.maxY})),e.minX&&(p.row.push({as:"minX"+c,math:"min(group)",source:"result"}),p.marks.push({name:"webix_min_x",check:(t,e,i)=>t==i["minX"+c]})),e.maxX&&(p.row.push({as:"maxX"+c,math:"max(group)",source:"result"}),p.marks.push({name:"webix_max_x",check:(t,e,i)=>t==i["maxX"+c]}))),r.push(p)}return r}_rengineToWebix(t,e){const i=this._state;if("chart"==i.mode)return this.getChartData(t,e);const n=e.nonEmpty.map((e=>t.columnData[e]?t.columnData[e].value:""));let r;return e=this.getHeader(e),i.datatable.totalColumn&&(r=t.rowData.map((t=>{const e=[];for(let i in t)-1==i.indexOf("minX")&&-1==i.indexOf("maxX")&&(e[i]=t[i]);return e.filter((t=>t||0===t))}))),{data:t.tree||t.data,header:e,marks:t.marks,footer:n,totalColumn:r}}loadError(){return webix.message({text:this._app.getService("locale")._("Incorrect formula in values"),type:"error"}),{data:[],values:[],header:[],marks:[],footer:[],totalColumn:[]}}_toTree(t){let e=t.values;if(!webix.isArray(e)){let t=[];for(let i in e)t[i]=e[i];e=t}return e.unshift(""),t.data?(e.open=!0,e.data=t.data.map((t=>this._toTree(t)))):e.id=t.id,e}getTable(t){const e=this.getFields(t[0]);return this._state.fields=e,this._data=t=this.prepareData(t,e),{id:"webixpivot",prepare:!0,driver:"raw",fields:webix.copy(e),data:t}}prepareData(t,e){return(e=e.filter((t=>t.prepare||"date"==t.type))).length&&(t=t.map((t=>(e.forEach((e=>{t[e.id]=e.prepare?e.prepare(t[e.id]):new Date(t[e.id])})),t)))),t}collectFieldValues(t){if(this._filtersHash[t])return webix.promise.resolve(this._filtersHash[t]);const e=this._app;if(e.config.externalProcessing)return this._filtersHash[t]=e.getService("backend").collectFieldValues(t);const i=this.getField(t),n={},r=[];for(let a=0;a<this._data.length;a++){let o=this._data[a][t];if(o||0===o){let t=o;"date"==i.type&&(o=o.valueOf()),n[o]||(n[o]=!0,i.predicate&&(t=e.config.predicates[i.predicate](t)),r.push({value:o,id:o,label:t}))}}return this._filtersHash[t]=r,webix.promise.resolve(r)}fixMath(t){const e=this._app.getService("locale")._,i=this._state.fields,n=new RegExp(i.map((t=>"\\b"+t.id+"\\b(?!\\()")).join("|"),"g"),r=this.operations,a=new RegExp(r.map((t=>"\\b"+t.id+"\\b\\(")).join("|"),"g");return t.replaceAll(n,(t=>i.find((e=>e.id==t)).value)).replaceAll(a,(t=>e(t.substring(0,t.length-1))+"("))}getField(t){return this._state.fields.find((e=>e.id==t))}getOperation(t){return this.operations.find((e=>e.id==t))}getColumns(){const t=this._state.structure;return"chart"==this._state.mode&&t.groupBy?[t.groupBy]:t.columns}getRows(){return"chart"==this._state.mode?[]:this._state.structure.rows}getLimits(){return{}}getHeader(t){const e=t.data,i=[];return t.nonEmpty.forEach(((n,r)=>{i.push({id:n+1,header:e.map((e=>{e=e[r]&&!webix.isUndefined(e[r].text)?e[r]:{text:e[r]||""};const i=t.meta[r]&&t.meta[r].operation;return i&&(e.operation=i),e})),format:t.meta[r]&&t.meta[r].format})})),i}setDimensions(){this._reng.resetDimensions();const t=this.getColumns().concat(this.getRows()||[]);for(let e=0;e<t.length;e++){const i=this.getField(t[e]);this._reng.addDimension({id:t[e],table:this._table.id,label:t[e],rule:{by:i.predicate?`${i.predicate}(${t[e]})`:t[e]}})}}getChartData(t,e){const i=this._state,n=i.structure.values;let r=[],a=[];if(t.data.length){const a=i.chart.type,o=i.structure.groupBy,s=webix.copy(t.data[0]),l=o?e.data[0]:s.map((()=>""));let u=0;for(;s.length;){let t=s.splice(0,n.length);if(!t.length)break;{let e=l[u].text;if(0===e&&(e="0"),"pie"==a||"donut"==a){for(let e=0;e<t.length;e++)t[e]={value:t[e],color:n[e].color};o?r.push({text:e||l[u],color:this.getValueColor(u/n.length,!0),data:t}):r=t}else t.push(e||l[u]),r.push(t);u+=n.length}}}for(let t=0;t<n.length;t++){const e=n[t];let i="complex"==e.operation?e.math:e.name;i=Array.isArray(i)?i.join(","):i,a.push({text:i||e.operation,operation:e.operation,color:e.color})}return{data:r,values:a}}getPalette(){return[["#e33fc7","#a244ea","#476cee","#36abee","#58dccd","#a7ee70"],["#d3ee36","#eed236","#ee9336","#ee4339","#595959","#b85981"],["#c670b8","#9984ce","#b9b9e2","#b0cdfa","#a0e4eb","#7faf1b"],["#b4d9a4","#f2f79a","#ffaa7d","#d6806f","#939393","#d9b0d1"],["#780e3b","#684da9","#242464","#205793","#5199a4","#065c27"],["#54b15a","#ecf125","#c65000","#990001","#363636","#800f3e"]]}getValueColor(t,e){const i=this.getPalette(e);let n=t/i[0].length;n=n==i.length?0:parseInt(n,10);const r=t%i[0].length;return i[n][r]}clearAll(){this._app.config.fields=null,this._state.fields=[],this._app.setStructure({}),delete this._table,this._store=this.getPivotData(),this._data=[],this._filtersHash={}}}class xt{constructor(t,e){this.app=t,this._url=e}url(t){return this._url+(t||"")}data(){let t,e=this.url();if(this.app.config.externalProcessing){e+="/data";const i=this.app.getState(),n=i.mode;t={structure:i.structure,mode:n},"chart"!=n&&(t.table=i.datatable)}return webix.ajax(e,t).then((t=>t.json()))}collectFieldValues(t){return webix.ajax(this.url("/fields/"+t)).then((t=>t.json()))}}class St extends v{constructor(t){const e=t.mode||"tree";let i=t.structure||{};const n=t.chart||{};webix.extend(n,{type:"bar",scale:"linear",lines:!0}),delete n.id;const r=t.datatable||{};delete r.id;const a=H({mode:e,structure:i,readonly:t.readonly||!1,fields:t.fields||[],datatable:r,chart:n,config:!1}),o={router:m,version:"10.1.0",debug:!0,compactWidth:720,start:"main/"+("chart"==e?"chart":"table"),params:{state:a,forceCompact:t.compact}};super(Object.assign(Object.assign({},o),t)),this.setService("backend",new(this.dynamic(xt))(this,this.config.url)),this.setService("local",new(this.dynamic(bt))(this,t)),function(t){let e;const i={updateConfig(i){const n=t.getRoot(),r=n.$view;e?e&&!r.id&&(r.id=e):(r.id?e=r.id:r.id=e="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle(`#${e}{ position: relative; }`),webix.html.addStyle(`#${e} .webix_window{ z-index:2 !important; }`),webix.html.addStyle(`#${e} .webix_disabled{ z-index:1 !important; }`)),i.container=e,i.fullscreen&&(i._fillApp=!0,delete i.fullscreen),i.on||(i.on={});let a=!0;const o=i.on.onShow;return i.on.onShow=function(){o&&o.apply(this,arguments),a&&(this.$setSize=(t,e)=>{V(this,n,!0),webix.ui.window.prototype.$setSize.apply(this,[t,e])},function(t,e){const i=e.getRoot();t.attachEvent("onHide",(()=>{i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));const n=e.attachEvent("view:resize",(()=>{V(t,i)}));t.attachEvent("onDestruct",(()=>{e.detachEvent(n)}))}(this,t),a=null),webix.callEvent("onClick",[]),webix.html.addCss(r,"webix_win_inside"),n.disable(),V(this,n)},i}};t.setService("jet-win",i)}(this),i=this.prepareStructure(i,!0),this.use(P,this.config.locale||{lang:"en",webix:{en:"en-US"}})}dynamic(t){return this.config.override&&this.config.override.get(t)||t}require(t,e){return"jet-views"===t?J[e]:"jet-locales"===t?Ct[e]:null}getState(){return this.config.params.state}setStructure(t){this.getState().structure=this.prepareStructure(t)}getStructure(){return this.getState().structure}prepareStructure(t,e){const i=this.getState().mode;webix.extend(t,{rows:[],columns:[],values:[],filters:[]}),e?"chart"==i&&t.groupBy||!t.columns.length?t.groupBy&&(t.columns=[t.groupBy]):t.groupBy=t.columns[0]:"chart"!=i?t.groupBy=t.columns[0]:t.groupBy?t.columns[0]!==t.groupBy&&(t.columns=[t.groupBy]):t.columns=[];const n=[];for(let e=0;e<t.values.length;e++){const i=t.values[e];if(webix.isArray(i.operation)){i.color=(webix.isArray(i.color)?i.color:[i.color])||[];for(let t=0;t<i.operation.length;t++){const e=Object.assign({},i);e.operation=i.operation[t],e.color=i.color&&i.color[t],n.push(e)}}else n.push(i)}for(let t=0;t<n.length;t++){const e=this.getService("local");if(n[t].color||(n[t].color=e.getValueColor(t)),n[t].name||n[t].math){if(e.getOperation(n[t].operation).fields>2){const e=n[t].name;n[t].math=`${n[t].operation}(${webix.isArray(e)?e.join():e})`,n[t].operation="complex"}}else n[t].math=n[t].operation,n[t].operation="complex"}return t.values=n,t}}webix.protoUI({name:"pivot",app:St,defaults:{borderless:!1},$init:function(){this.name="pivot",this.$view.className+=" webix_pivot";const t=this.$app.getState();for(let e in t)F(t,this.config,e);this.$app.attachEvent("filter:change",((t,e)=>this.callEvent("onFilterChange",[t,e])))},$exportView:function(t){const e=this.$app.getRoot().queryView({$mainView:!0});return e.$exportView?e.$exportView(t):e},getState(){return this.$app.getState()},getService(t){return this.$app.getService(t)},setStructure:function(t){this.$app.setStructure(t)},getStructure:function(){return this.$app.getStructure()},clearAll:function(){this.$app.getService("local").clearAll()}},webix.ui.jetapp);const $t={Backend:xt,LocalData:bt},Ct={en:{Done:"Done",Table:"Table",Tree:"Tree",Chart:"Chart","Click to configure":"Click to configure","Configure Pivot":"Configure Pivot",Total:"Total",Fields:"Fields",Methods:"Methods",Columns:"Columns","Add column":"Add column",Rows:"Rows","Add row":"Add row","Clean rows":"Clean rows",Filters:"Filters","Add filter":"Add filter","Group By":"Group By","Chart type":"Chart type","Logarithmic scale":"Logarithmic scale","X axis title":"X axis title","Y axis title":"Y axis title","Scale color":"Scale color","Circled lines":"Circled lines",Horizontal:"Horizontal",Stacked:"Stacked",Lines:"Lines",Line:"Line",Radar:"Radar",Bar:"Bar",Area:"Area",Spline:"Spline","Spline Area":"Spline Area",Pie:"Pie",Donut:"Donut",Values:"Values","Add value":"Add value","Field not defined":"Field not defined",Highlight:"Highlight","Min X":"Min X","Max X":"Max X","Min Y":"Min Y","Max Y":"Max Y",Footer:"Footer","Total Column":"Total Column",Off:"Off",On:"On","Sum Only":"Sum Only","3D":"3D","Show values inside":"Show values inside",count:"count",max:"max",min:"min",avg:"avg",wavg:"wavg",any:"any",sum:"sum",complex:"complex","Incorrect formula in values":"Incorrect formula in values"}};t.App=St,t.locales=Ct,t.services=$t,t.views=J,Object.defineProperty(t,"__esModule",{value:!0})}(e)},41461:function(t,e,i){var n,r,a;!function(o){"use strict";var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function l(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var u=function(){return(u=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)n[r]=a[o];return n}var h=function(){},p=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function d(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],a={},o=r.indexOf(":");if(-1===o&&(o=r.indexOf("?")),-1!==o)for(var s=0,l=r.substr(o+1).split(/[\:\?\&]/g);s<l.length;s++){var u=l[s].split("=");a[u[0]]=decodeURIComponent(u[1])}i[n]={page:o>-1?r.substr(0,o):r,params:a,isNew:!0}}return i}function f(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var a=g(r.params);a&&e.push("?"+a)}return e.join("")}function g(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var v=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:d(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=f(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(d(t));for(var a=0;a<i.length;a++)n[a]&&(i[a].view=n[a].view),r&&n[a]&&i[a].page===n[a].page?i[a].isNew=!1:i[a].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=f(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var a=f(r),o={url:r,redirect:a,confirm:Promise.resolve()},s=e?e.app:null;!s||s.callEvent("app:guard",[o.redirect,e,o])?o.confirm.catch((function(t){return i(t)})).then((function(){if(null!==o.redirect){if(o.redirect!==a)return s.show(o.redirect),void i(new h);n.route.path=a,n.route.url=r,t()}else i(new h)})):i(new h)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=f(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=f(this.route.url)},t}(),m=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return l(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof p?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new v(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,a=null,o=!1;if(this._container.tagName?a=this._container:(r=this._container).popup?(a=document.body,o=!0):a=this.webix.$$(r.id),!this.app||!a)return Promise.reject(null);var s=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!o){var u=a,c=u.getParentView();c&&"multiview"===c.name&&!l.ui.id&&(l.ui.id=u.config.id)}this._root=this.app.webix.ui(l.ui,a);var h=this._root;o&&h.setPosition&&!h.isVisible()&&h.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var a=e.view;if(!a&&e.url){if("string"==typeof e.url)return e.route=new v(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||a instanceof e.url||(a=new(this.app._override(e.url))(this.app,"")),a||(a=e.url)}if(a)return a.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(p),w=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return l(e,t),e.prototype.config=function(){return this._ui},e}(m),_=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),y=!0,b=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return l(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof p||"function"==typeof t&&t.prototype instanceof p)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var a=t[r];if("function"==typeof a&&a.prototype instanceof p&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[r]=a;else if(a instanceof Date)e[r]=new Date(a);else{var o=this.copyConfig(a,a instanceof Array?[]:{},i);null!==o&&(n?e.push(o):e[r]=o)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:_});if(t.prototype instanceof p)return new t(this,{name:i,params:n});t=t(this)}return t instanceof p?t:new w(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;this.$router?r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(y&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),y=!1),"string"==typeof e&&(e=new v(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var a=i?i.params:this.config.params||null,o=this.getSubView(),s=this._subSegment,l=s.show({url:r,params:a},o).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new m(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof h))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new v(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new v(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(p),x=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),S=!1;function $(t){if(!S&&t){S=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,a={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var a=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var o in r)a(o);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,a,!0),t.extend(t.ui.baselayout.prototype,a,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var C=function(t){function e(e){var i;return e.router=e.router||x,$((i=t.call(this,e)||this).webix),i}return l(e,t),e.prototype.require=function(t,e){return i(97935)(t+"/"+e)},e}(b),k=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}l(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(x),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function D(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function T(t,e,i){for(var n in t)D(t,n)&&e.call(i||t,t[n],n,t)}function E(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var L=String.prototype.replace,A=String.prototype.split,I=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},P={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:I,chinese:function(){return 0},croatian:I,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:I,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},R={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function M(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var V=/\$/g,O=/%\{(.*?)\}/g;function F(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,a=n||O,o="number"==typeof e?{smart_count:e}:e;if(null!=o.smart_count&&r){var s=A.call(r,"||||");r=(s[function(t,e){return P[function(t){var e,i=(e={},T(R,(function(t,i){T(t,(function(t){e[t]=i}))})),e);return i[t]||i[A.call(t,/-/,1)[0]]||i.en}(t)](e)}(i||"en",o.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return L.call(r,a,(function(t,e){return D(o,e)&&null!=o[e]?L.call(o[e],V,"$$"):t}))}function H(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?F:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||E,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(M(e)+"(.*?)"+M(i),"g")}(e.interpolation)}H.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},H.prototype.extend=function(t,e){T(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},H.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:T(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},H.prototype.clear=function(){this.phrases={}},H.prototype.replace=function(t){this.clear(),this.extend(t)},H.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=F(i,r,this.currentLocale,this.tokenRegex)),n},H.prototype.has=function(t){return D(this.phrases,t)},H.transformPhrase=function(t,e,i){return F(t,e,i)};var B=H,U=window.webix;U&&$(U);var N=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function a(e,a,o){a.__esModule&&(a=a.default);var l={phrases:a};i.polyglot&&t.webix.extend(l,i.polyglot);var u=s.polyglot=new B(l);if(u.locale(e),s._=t.webix.bind(u.t,u),r=e,n&&n.put("lang",r),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return o?Promise.resolve():t.refresh()}function o(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;a(e,t.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:o,setLangData:a,_:null,polyglot:null};t.setService("locale",s),o(r,!0)},j=window;j.Promise||(j.Promise=j.webix.promise);var G=1;function Y(t){var e=!1;return function(){if(e)return t.apply(this,arguments);e=!0}}var z=null;function W(t,e){z=t,e(),z=null}function q(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function K(t,e){e=e||{};var i={},n={},r=function(t,e){var r=G++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},a=[],o=!1,s=function(t,e,n,r){if(o)a.push([t,e,n,r]);else for(var s=Object.keys(i),l=0;l<s.length;l++){var u=i[s[l]];u&&("*"!==u.mask&&u.mask!==t||u.handler(n,e,t,r))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(o=!0,t(n),o=!1;a.length;){var i=a.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var r in i=i||e,t)if(t.hasOwnProperty(r)){var a=t[r];i.nested&&"object"==typeof a&&a?n[r]=K(a,i):X(n,a,r,s)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function X(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,z)}},enumerable:!0,configurable:!1})}var Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this;return{view:"popup",padding:0,point:!1,body:{view:"menu",subMenuPos:"right",layout:"y",borderless:!0,type:{subsign:!0},css:"webix_rpt_popup_menu",template:function(e){return t.GetTemplate(e)},width:160,submenuConfig:{point:!1,width:190,padding:0,template:function(e){return t.GetTemplate(e)}},autowidth:!0,autoheight:!0,data:this.GetData(),on:{onMenuItemClick:function(e,i){return t.PopupAction(e,i)}}}}},e.prototype.GetData=function(){var t=this.app.getService("locale")._;return[{value:t("To PNG"),id:"png"},{value:t("To PDF"),id:"pdf"}]},e.prototype.PopupAction=function(t){this.app.callEvent("exportModule",[t]),this.getRoot().hide()},e.prototype.GetTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span>"+t.value},e.prototype.Show=function(t){var e=this;this.getRoot().isVisible()||this.webix.delay((function(){return e.getRoot().show(t)}))},e}(m),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"form",localId:"toolbar",height:webix.skin.$active.barHeight+6,hidden:!0,padding:{left:10,right:10,top:6,bottom:6},margin:10,cols:[{view:"button",type:"icon",width:140,label:e("Export"),icon:"rpi-export",click:function(e){return t.ShowExportPopup(e)}},{}]}},e.prototype.ShowExportPopup=function(t){this.ExportMenu&&this.ExportMenu.$view||(this.ExportMenu=this.ui(Q));var e=webix.$$(t);this.ExportMenu.Show(e.$view)},e}(m),Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){return{rows:[J,{type:"wide",margin:5,cols:[{}]}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.Local=this.app.getService("local"),this.Charts=this.app.getService("charts")},e.prototype.ready=function(){var t=this,e=this.getRoot().getChildViews();this.Bar=e[0],this.Host=e[1],this.on(this.State.$changes,"module",(function(e){return t.Show(e)})),this.on(this.app,"exportModule",(function(e){return t.Export(e)}))},e.prototype.Show=function(t){var e=this,i=this.Host;if(t&&"chart"===t.type&&this.CheckColumns(t.columns)){var n=this.GetChartConfig(t);if(!n.view)return;this.Bar.show(),this.GetChartData(t).then((function(r){var a=r[0],o=r[1];a=webix.copy(a),"rows"==t.meta.chart.seriesFrom&&(a=e.ConvertDataBySeries(a)),n.data=e.FormatLabels(a.slice(0,e.Charts.numLimit),o),webix.ui([n],i),e.Chart=i.getChildViews()[0]}))}else webix.ui([{template:" "}],i),this.Bar.hide(),this.Chart=null},e.prototype.FormatLabels=function(t,e){var i=this.State.module.meta.chart.labelColumn,n=i&&e.length?e.find((function(t){return t.field==i})):null;if(n)t.forEach((function(t){var e=n.data.find((function(e){return e.id==t[i]}));t[i]=e?e.value:t[i]}));else{var r=(this.State.module.fields||this.State.module.columns).find((function(t){return t.id==i}));r&&"date"==r.type&&t.forEach((function(t){t[i]=webix.i18n.dateFormatStr(new Date(t[i]))}))}return t},e.prototype.CheckColumns=function(t){return t.length&&-1==t.indexOf(webix.undefined)},e.prototype.GetChartConfig=function(t){var e=this,i=t.columns,n=t.meta;if(!i||!n.chart)return{};var r=n.chart,a=r.chartType,o=r.labelColumn,s=r.legendPosition,l=r.series,c=r.axises;if(!l)return{};var h=[];l.forEach((function(t){if(!1!==t.show){var i=t.chartType||a;h.push(u(u({},e.ApplyTypeConfig(t,i)),{value:function(e){return e[t.id]}}))}}));var p={view:"chart",type:a,localId:"chart",series:h,padding:{left:80,right:40,top:50,bottom:80},on:{onAfterRender:function(){return e.CorrectLabels()}},legend:this.GetLegendConfig(l,a,s)};return c&&(p.xAxis=u({template:function(t){return"<div class='webix_rpt_chart_label'>"+(t[o]||"")+"</div>"}},c.x),p.yAxis=u({},c.y),c.y.logarithmic&&(p.scale="logarithmic"),c.x.verticalLabels&&(p.css="webix_rpt_vertical_chart_labels")),"right"==p.legendPosition?p.padding.right=p.legend.width+10:p.padding.bottom=90,p},e.prototype.GetLegendConfig=function(t,e,i){if("none"==i)return null;var n=[],r=[],a=this.Charts.itemSupport;t.forEach((function(i){!1!==i.show&&(n.push({text:i.meta.name,color:i.meta.color,markerType:-1!=a.indexOf(t.chartType||e)?"item":"square"}),r.push(i.name))}));var o={values:n,margin:8};return"right"==i?(o.width=webix.html.getTextSize(r).width+30,o.valign="middle",o.align="right"):(o.layout="x",o.valign="bottom",o.align="center"),o},e.prototype.GetChartData=function(t){return Promise.all([this.Local.getData(this.Local.getDataConfig(t),"edit"==this.State.mode),this.Local.getOptions(t.columns)])},e.prototype.ApplyTypeConfig=function(t,e){var i=t.meta;return-1!=this.Charts.itemSupport.indexOf(e)?{fill:i.area?i.color:null,alpha:i.area?.2:1,item:{type:i.markerType,radius:"no"==i.markerType?0:3,borderColor:i.color,color:i.fillMarker?i.color:"#ffffff"},line:{color:i.color,width:i.area?1:2},disableItems:!!i.area}:"area"==e||"splineArea"==e?{border:!0,alpha:.3,color:i.color}:{color:i.color}},e.prototype.ConvertDataBySeries=function(t){var e=this.State.module.meta.chart,i=e.labelColumn,n=e.baseColumn,r=e.dataColumn;if(!(i&&n&&r))return[];var a=[];return t.forEach((function(t){var e=a.find((function(e){return e[i]==t[i]}));e||((e={})[i]=t[i]),e[t[n]]||(e[t[n]]=t[r]),a.push(e)})),a},e.prototype.CorrectLabels=function(){var t=this.$$("chart");if(t&&!t.config.offset){var e=t.$view.querySelector(".webix_axis_item_x");e&&(e.className+=" webix_rpt_chart_label0")}},e.prototype.Export=function(t){this.Chart&&("png"==t?webix.toPNG(this.Chart):"pdf"==t&&webix.toPDF(this.Chart,{autowidth:!0,display:"image"}))},e}(m);function tt(t,e,i,n){return function t(e,i,n){if("*"!==i)n.getList||n.attachEvent("onTimedKeyPress",(function(){var t=this.getValue();this.config.value!==t&&(this.config.value=t,this.callEvent("onChange",[t]))})),n.attachEvent("onChange",(function(){var t=this;W(this,(function(){var n;(n=t.getValue())!==e[i]&&(e[i]=n)}))}));else{var r=n.elements;for(var a in r)void 0!==e[a]&&t(e,a,r[a])}}(t,e,i),function(t,e,i,n){var r=function(t,n,r,a){if("*"===r){var o=i.elements;for(var s in o)void 0!==t[s]&&o[s].setValue(t[s])}else if("*"===e){var l=i.elements[r];l&&l!=a&&l.setValue(t)}else a!=i&&i.setValue(t)};return n?n.on(t.$changes,e,r):t.$changes.attachEvent(e,r)}(t,e,i,n)}webix.protoUI({name:"input-list",getValue:function(){return this._value||[]},setValue:function(t){this._value=t,this.clearAll(),this.parse([].concat(t))}},webix.ui.list);var et,it={table:"<span class='rpi-table'></span>",chart:"<span class='rpi-poll'></span>",heatmap:"<span class='rpi-chart-tree'></span>"},nt={main:"<svg  xmlns='http://www.w3.org/2000/svg' viewBox='0 0 390 320'><path class='webix_rpt_cls1' d='M369.51,182.77c-23.18-52.39,32-103.23,13.74-148.28s-77.61-39.42-162.07-20S78.47-6.35,34.66,14.46c-29.39,14-27.27,58.82-5,107,38.95,84.29-51.86,117.32-24.38,166s118.91-.95,183.37,4.22c37.62.59,62.88,6.26,109.52,21.27C387.63,341.7,412.41,279.75,369.51,182.77Z'/><rect class='webix_rpt_cls2' x='111.53' y='226.04' width='212.47' height='0.91'/><rect class='webix_rpt_cls3' x='97' y='89.51' width='212' height='151.96'/><rect class='webix_rpt_cls4' x='67' y='159.96' width='136.33' height='81.98' rx='2'/><polygon class='webix_rpt_cls5' points='199.32 235.55 72.61 235.55 72.61 165.28 71.01 165.28 71.01 235.55 71.01 237.68 71.01 237.68 72.61 237.68 72.61 237.68 199.32 237.68 199.32 235.55'/><rect class='webix_rpt_cls6' x='84.64' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='97.47' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='110.3' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='123.14' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='135.97' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls7' x='148.8' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='161.63' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='174.46' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls6' x='187.29' y='165.28' width='0.8' height='68.14'/><rect class='webix_rpt_cls7' x='111.53' y='94.41' width='212.47' height='132.54'/><rect class='webix_rpt_cls8' x='111.53' y='109.85' width='212.47' height='0.91'/><path class='webix_rpt_cls9' d='M111.53,94.41H324v15.44H111.53Z'/><path class='webix_rpt_cls7' d='M111.53,79H324V94.41H111.53Z'/><path class='webix_rpt_cls2' d='M324,125.28v-.91H287.68V109.84h-.91v14.53H250.45V109.84h-.91v14.53H213.22V109.84h-.9v14.53H176V109.85h-.91v14.52H111.53v.91h63.56v13.61H111.53v.91h63.56v13.62H111.53v.91h63.56v13.61H111.53v.91h63.56v13.62H111.53v.91h63.56V197H111.53v.91h63.56v13.62H111.53v.9h63.56V227H176V212.42h36.32V227h.9V212.42h36.32V227h.91V212.42h36.32V227h.91V212.42H324v-.9H287.68V197.9H324V197H287.68V183.38H324v-.91H287.68V168.85H324v-.91H287.68V154.33H324v-.91H287.68V139.8H324v-.91H287.68V125.28Zm-74.46,0v13.61H213.22V125.28Zm-36.32,57.19V168.85h36.32v13.62Zm36.32.91V197H213.22V183.38Zm-36.32-15.44V154.33h36.32v13.61Zm0-14.52V139.8h36.32v13.62ZM176,125.28h36.32v13.61H176Zm0,14.52h36.32v13.62H176Zm0,14.53h36.32v13.61H176Zm0,14.52h36.32v13.62H176Zm0,14.53h36.32V197H176Zm0,28.14V197.9h36.32v13.62Zm37.22,0V197.9h36.32v13.62Zm73.55,0H250.45V197.9h36.32Zm0-14.53H250.45V183.38h36.32Zm0-14.52H250.45V168.85h36.32Zm0-14.53H250.45V154.33h36.32Zm0-14.52H250.45V139.8h36.32Zm0-14.53H250.45V125.28h36.32Z'/><rect class='webix_rpt_cls2' x='175.09' y='94.41' width='0.91' height='15.43'/><rect class='webix_rpt_cls2' x='212.32' y='94.41' width='0.91' height='15.43'/><rect class='webix_rpt_cls2' x='249.54' y='94.41' width='0.91' height='15.43'/><rect class='webix_rpt_cls2' x='286.77' y='94.41' width='0.91' height='15.43'/><rect class='webix_rpt_cls9' x='118.79' y='84.43' width='21.79' height='5.45'/><rect class='webix_rpt_cls9' x='250.45' y='84.43' width='66.28' height='5.45'/></svg>",alt:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 390 320' fill='none'><g clip-path='url(#clip0_4706_8889)'><path d='M369.502 182.763C346.322 130.373 401.502 79.5332 383.242 34.4832C364.982 -10.5668 305.632 -4.93676 221.172 14.4832C136.712 33.9032 78.4622 -6.35676 34.6522 14.4532C5.26223 28.4532 7.38222 73.2732 29.6522 121.453C68.6022 205.743 -22.2078 238.773 5.27222 287.453C32.7522 336.133 124.182 286.503 188.642 291.673C226.262 292.263 251.522 297.933 298.162 312.943C387.622 341.693 412.402 279.743 369.502 182.763Z' class='webix_rpt_cls1'/><path d='M112.545 76.0479C112.545 74.9421 113.475 74.0457 114.622 74.0457H215.368L256.913 114.09V251.238C256.913 252.344 255.983 253.241 254.836 253.241H114.622C113.475 253.241 112.545 252.344 112.545 251.238V76.0479Z' class='webix_rpt_cls6'/><path d='M128.322 60.5902C128.322 59.4844 129.252 58.588 130.399 58.588H231.145L272.69 98.6313V235.781C272.69 236.887 271.76 237.783 270.612 237.783H130.399C129.252 237.783 128.322 236.887 128.322 235.781V60.5902Z' class='webix_rpt_cls4'/><path fill-rule='evenodd' clip-rule='evenodd' d='M130.399 59.588C129.769 59.588 129.322 60.0708 129.322 60.5902V235.781C129.322 236.3 129.769 236.783 130.399 236.783H270.612C271.243 236.783 271.69 236.299 271.69 235.781V99.0563L230.742 59.588H130.399ZM231.145 58.588H130.399C129.252 58.588 128.322 59.4844 128.322 60.5902V235.781C128.322 236.887 129.252 237.783 130.399 237.783H270.612C271.76 237.783 272.69 236.887 272.69 235.781V98.6313L231.145 58.588Z' class='webix_rpt_cls3'/><path d='M231.146 96.6297V58.588L272.69 98.6313H233.222C232.075 98.6313 231.146 97.7353 231.146 96.6297Z' class='webix_rpt_cls3'/><path d='M184.729 74.0457H143.184C142.323 74.0457 141.626 74.718 141.626 75.5473V75.5473C141.626 76.3766 142.323 77.0489 143.184 77.0489H184.729C185.589 77.0489 186.287 76.3766 186.287 75.5473C186.287 74.718 185.589 74.0457 184.729 74.0457Z' class='webix_rpt_cls2'/><path d='M184.729 87.0457H143.184C142.323 87.0457 141.626 87.718 141.626 88.5473V88.5473C141.626 89.3766 142.323 90.0489 143.184 90.0489H184.729C185.589 90.0489 186.287 89.3766 186.287 88.5473C186.287 87.718 185.589 87.0457 184.729 87.0457Z' class='webix_rpt_cls2'/><path d='M222.443 101H143.557C142.697 101 142 101.672 142 102.5C142 103.328 142.697 104 143.557 104H222.443C223.303 104 224 103.328 224 102.5C224 101.672 223.303 101 222.443 101Z' class='webix_rpt_cls2'/><path d='M222.443 115H143.557C142.697 115 142 115.672 142 116.5V116.5C142 117.328 142.697 118 143.557 118H222.443C223.303 118 224 117.328 224 116.5C224 115.672 223.303 115 222.443 115Z' class='webix_rpt_cls2'/><path fill-rule='evenodd' clip-rule='evenodd' d='M218 223C240.644 223 259 204.644 259 182C259 159.356 240.644 141 218 141C195.356 141 177 159.356 177 182C177 204.644 195.356 223 218 223ZM218 227C242.853 227 263 206.853 263 182C263 157.147 242.853 137 218 137C193.147 137 173 157.147 173 182C173 206.853 193.147 227 218 227Z' class='webix_rpt_cls4'/><path d='M219.686 134C231.802 134 243.423 138.813 251.99 147.381C260.558 155.949 265.371 167.569 265.371 179.686C265.371 191.002 261.225 201.404 254.407 209.417L256.305 211.314H261.857L297 246.457L286.457 257L251.314 221.857V216.305L249.417 214.407C241.404 221.225 231.002 225.371 219.686 225.371C207.569 225.371 195.949 220.558 187.381 211.99C178.813 203.423 174 191.802 174 179.686C174 167.569 178.813 155.949 187.381 147.381C195.949 138.813 207.569 134 219.686 134ZM219.686 148.057C202.114 148.057 188.057 162.114 188.057 179.686C188.057 197.257 202.114 211.314 219.686 211.314C237.257 211.314 251.314 197.257 251.314 179.686C251.314 162.114 237.257 148.057 219.686 148.057Z' class='webix_rpt_cls5'/><path fill-rule='evenodd' clip-rule='evenodd' d='M253.047 209.471L253.645 208.769C260.316 200.928 264.371 190.754 264.371 179.686C264.371 167.834 259.663 156.468 251.283 148.088C242.903 139.708 231.537 135 219.686 135C207.834 135 196.468 139.708 188.088 148.088C179.708 156.468 175 167.834 175 179.686C175 191.537 179.708 202.903 188.088 211.283C196.468 219.663 207.834 224.371 219.686 224.371C230.754 224.371 240.928 220.316 248.769 213.645L249.471 213.047L252.314 215.89V221.443L286.457 255.586L295.586 246.457L261.443 212.314H255.89L253.047 209.471ZM261.857 211.314L297 246.457L286.457 257L251.314 221.857V216.305L249.417 214.407C241.404 221.225 231.002 225.371 219.686 225.371C207.569 225.371 195.949 220.558 187.381 211.99C178.813 203.423 174 191.802 174 179.686C174 167.569 178.813 155.949 187.381 147.381C195.949 138.813 207.569 134 219.686 134C231.802 134 243.423 138.813 251.99 147.381C260.558 155.949 265.371 167.569 265.371 179.686C265.371 191.002 261.225 201.404 254.407 209.417L256.305 211.314H261.857ZM187.057 179.686C187.057 161.562 201.562 147.057 219.686 147.057C237.809 147.057 252.314 161.562 252.314 179.686C252.314 197.809 237.809 212.314 219.686 212.314C201.562 212.314 187.057 197.809 187.057 179.686ZM188.057 179.686C188.057 162.114 202.114 148.057 219.686 148.057C237.257 148.057 251.314 162.114 251.314 179.686C251.314 197.257 237.257 211.314 219.686 211.314C202.114 211.314 188.057 197.257 188.057 179.686Z' class='webix_rpt_cls3'/><path d='M236.083 167.231L232.852 164L220.042 176.81L207.231 164L204 167.231L216.81 180.042L204 192.852L207.231 196.083L220.042 183.273L232.852 196.083L236.083 192.852L223.273 180.042L236.083 167.231Z' class='webix_rpt_cls3'/></g><defs><clipPath id='clip0_4706_8889'><rect width='390' height='320' class='webix_rpt_cls4'/></clipPath></defs></svg>"},rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return{view:"form",scroll:"auto",elementsConfig:{labelWidth:130,labelPosition:"top"},elements:[{rows:[{view:"label",label:e("Report name")},{view:"text",name:"name",localId:"name"}]},{rows:[{view:"label",label:e("Description")},{view:"textarea",labelPosition:"top",height:150,name:"desc"}]},{rows:[{view:"label",label:e("Data source")},{view:"combo",name:"data",options:[]}]},{view:"input-list",name:"joins",template:this.JoinListTemplate.bind(this),data:[],autoheight:!0,borderless:!0,onClick:{webix_rpt_action_remove:function(e,i){return t.RemoveJoin(i)}}},{view:"button",localId:"add",label:e("Join data"),click:function(){return t.ShowJoins()}},{},{view:"button",label:e("Delete report"),localId:"delete",inputWidth:170,align:"left",css:"webix_rpt_delete",click:function(){return t.app.callEvent("onMenuAction",[null,"delete"])}}]}},e.prototype.init=function(){var t=this,e=this.getRoot().elements;this.State=this.getParam("state",!0),this.AppState=this.app.getParam("state"),this.Local=this.app.getService("local"),this.Models=this.Local.getModels(!0);var i=Object.keys(this.Models);e.data.getList().parse(i.map((function(e){var i=t.Models[e];return{id:i.id,value:i.name}}))),tt(this.State,"*",this.getRoot(),this),this.on(this.State.$changes,"id",(function(e){return t.ShowDeleteButton(e)})),this.on(this.AppState.$changes,"toolbar",(function(e){return t.ShowDeleteButton(e)})),this.SourcesList=this.ui({view:"popup",body:{view:"list",autoheight:!0,type:{template:this.JoinTemplate.bind(this)},click:function(e){var i=t.SourcesList.getBody().getItem(e);t.AddJoin(i),t.SourcesList.hide()}}})},e.prototype.AddJoin=function(t){var e=this.Local.addJoin(t.tid,this.State);e.joins=c(this.State.joins,[t]),this.State.$batch(e)},e.prototype.RemoveJoin=function(t){var e=this.Local.cleanLinkedModels(t,this.State);e.block?(e.block.filter&&webix.alert({container:this.app.getRoot().$view,text:this._("Please delete the related query filter first")}),e.block.group&&webix.alert({container:this.app.getRoot().$view,text:this._("Please delete the related group rule first")})):this.State.$batch(e)},e.prototype.JoinTemplate=function(t){var e=this.Models[t.sid],i=this.Models[t.tid],n=t.sf||t.tf,r=(t.sf?e:i).data.find((function(t){return t.id===n})).name;return i.name+" <span class='webix_rpt_sources_path'>"+e.name+(t.sf?" ("+r+")":"")+" -> "+i.name+(t.tf?" ("+r+")":"")+"</span>"},e.prototype.JoinListTemplate=function(t){return"<span style='float:right' class='webix_icon webix_rpt_action_remove rpi-delete'></span>"+this.JoinTemplate(t)},e.prototype.ShowJoins=function(){var t=this.Local.getLinkedModels([this.State.data].concat(this.State.joins.map((function(t){return t.tid}))),!0);if(t.length){var e=this.SourcesList.getBody();e.clearAll(),e.parse(t),this.SourcesList.show(this.$$("add").$view)}},e.prototype.ShowDeleteButton=function(){this.State.id&&this.AppState.toolbar?this.$$("delete").show():this.$$("delete").hide()},e}(m);function at(t,e){var i=new webix.promise.defer;return webix.ui(e.getService("jet-win").updateConfig({view:"window",head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,elements:[{view:"label",label:t.text},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){i.reject("prompt cancelled"),this.getTopParentView().close()}}]},body:{view:"form",padding:{top:5,left:20,right:20,bottom:20},rows:[{margin:10,cols:[{view:"text",name:"name",value:t.value,width:230,css:"fm-prompt-input"},{view:"button",value:t.button,width:100,hotkey:"enter",click:function(){var t=this.getTopParentView(),e=t.getBody().getValues().name;i.resolve(e),t.close()}}]}]},on:{onShow:function(){var e=this.getBody().elements.name.getInputNode();e.focus(),t.selectMask?t.selectMask(e):e.select()}}})).show(),i}webix.protoUI({name:"query-select",$cssName:"richselect",$init:function(){webix.extend(this.on_click,{webix_rpt_qselect_icon:function(){return this.callEvent("onClearClick",[]),!1}})}},webix.ui.richselect),et=function(t){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function n(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},a=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],a={},o=r.indexOf(":");if(-1===o&&(o=r.indexOf("?")),-1!==o)for(var s=0,l=r.substr(o+1).split(/[\:\?\&]/g);s<l.length;s++){var u=l[s].split("=");a[u[0]]=decodeURIComponent(u[1])}i[n]={page:o>-1?r.substr(0,o):r,params:a,isNew:!0}}return i}function l(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var a=u(r.params);a&&e.push("?"+a)}return e.join("")}function u(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var c=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=l(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var a=0;a<i.length;a++)n[a]&&(i[a].view=n[a].view),r&&n[a]&&i[a].page===n[a].page?i[a].isNew=!1:i[a].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=l(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var o=l(r),s={url:r,redirect:o,confirm:Promise.resolve()},u=e?e.app:null;!u||u.callEvent("app:guard",[s.redirect,e,s])?s.confirm.catch((function(t){return i(t)})).then((function(){if(null!==s.redirect){if(s.redirect!==o)return u.show(s.redirect),void i(new a);n.route.path=o,n.route.url=r,t()}else i(new a)})):i(new a)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=l(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=l(this.route.url)},t}(),h=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return n(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof o?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new c(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,a=null,o=!1;if(this._container.tagName?a=this._container:(r=this._container).popup?(a=document.body,o=!0):a=this.webix.$$(r.id),!this.app||!a)return Promise.reject(null);var s=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!o){var u=a,c=u.getParentView();c&&"multiview"===c.name&&!l.ui.id&&(l.ui.id=u.config.id)}this._root=this.app.webix.ui(l.ui,a);var h=this._root;o&&h.setPosition&&!h.isVisible()&&h.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var a=e.view;if(!a&&e.url){if("string"==typeof e.url)return e.route=new c(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||a instanceof e.url||(a=new(this.app._override(e.url))(this.app,"")),a||(a=e.url)}if(a)return a.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),p=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return n(e,t),e.prototype.config=function(){return this._ui},e}(h),d=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,g=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return n(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var a=t[r];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[r]=a;else if(a instanceof Date)e[r]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(n?e.push(s):e[r]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:d});if(t.prototype instanceof o)return new t(this,{name:i,params:n});t=t(this)}return t instanceof o?t:new p(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;this.$router?r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new c(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var a=i?i.params:this.config.params||null,o=this.getSubView(),s=this._subSegment,l=s.show({url:r,params:a},o).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new h(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof a))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new c(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new c(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),v=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),m=!1;function w(t){if(!m&&t){m=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,a={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var a=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var o in r)a(o);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,a,!0),t.extend(t.ui.baselayout.prototype,a,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var _=function(t){function e(e){var i;return e.router=e.router||v,w((i=t.call(this,e)||this).webix),i}return n(e,t),e.prototype.require=function(t,e){return i(97935)(t+"/"+e)},e}(g),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function x(t,e,i){for(var n in t)b(t,n)&&e.call(i||t,t[n],n,t)}function S(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var $=String.prototype.replace,C=String.prototype.split,k=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},D={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:k,chinese:function(){return 0},croatian:k,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:k,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},T={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function E(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var L=/\$/g,A=/%\{(.*?)\}/g;function I(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,a=n||A,o="number"==typeof e?{smart_count:e}:e;if(null!=o.smart_count&&r){var s=C.call(r,"||||");r=(s[function(t,e){return D[function(t){var e,i=(e={},x(T,(function(t,i){x(t,(function(t){e[t]=i}))})),e);return i[t]||i[C.call(t,/-/,1)[0]]||i.en}(t)](e)}(i||"en",o.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return $.call(r,a,(function(t,e){return b(o,e)&&null!=o[e]?$.call(o[e],L,"$$"):t}))}function P(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?I:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||S,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(E(e)+"(.*?)"+E(i),"g")}(e.interpolation)}P.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},P.prototype.extend=function(t,e){x(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},P.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:x(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},P.prototype.clear=function(){this.phrases={}},P.prototype.replace=function(t){this.clear(),this.extend(t)},P.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=I(i,r,this.currentLocale,this.tokenRegex)),n},P.prototype.has=function(t){return b(this.phrases,t)},P.transformPhrase=function(t,e,i){return I(t,e,i)};var R=P,M=window.webix;M&&w(M);var V=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function a(e,a,o){a.__esModule&&(a=a.default);var l={phrases:a};i.polyglot&&t.webix.extend(l,i.polyglot);var u=s.polyglot=new R(l);if(u.locale(e),s._=t.webix.bind(u.t,u),r=e,n&&n.put("lang",r),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return o?Promise.resolve():t.refresh()}function o(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;a(e,t.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:o,setLangData:a,_:null,polyglot:null};t.setService("locale",s),o(r,!0)},O=window;O.Promise||(O.Promise=O.webix.promise);var F=1;function H(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function B(t,e){e=e||{};var i={},n={},r=function(t,e){var r=F++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},a=[],o=!1,s=function(t,e,n,r){if(o)a.push([t,e,n,r]);else for(var s=Object.keys(i),l=0;l<s.length;l++){var u=i[s[l]];u&&("*"!==u.mask&&u.mask!==t||u.handler(n,e,t,r))}};for(var l in t)if(t.hasOwnProperty(l)){var u=t[l];e.nested&&"object"==typeof u&&u?n[l]=B(u,e):U(n,u,l,s)}return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(o=!0,t(n),o=!1;a.length;){var i=a.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),n}function U(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}var N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",point:!1,body:{view:"list",yCount:4,width:120,borderless:!0,data:[{id:"edit",value:e("Edit")},{id:"add-filter",value:e("Add Filter")},{id:"add-group",value:e("Add Group")},{id:"delete",value:e("Delete")}],click:function(e){t.app.callEvent("action",[e,t.Item]),t.Hide()}}}},e.prototype.Hide=function(){this.getRoot().hide()},e.prototype.Show=function(t,e){this.Item=e;var i=webix.html.offset(t);this.getRoot().show({x:i.x+i.width+webix.skin.$active.dataPadding,y:i.y-10})},e}(h),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.GetButton=function(){var t=this;return{view:"button",value:(0,this.app.getService("locale")._)("Add filter"),localId:"button",css:"webix_primary",click:function(){return t.Add(null,null)}}},e.prototype.GetList=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("simple")?"<span style='float:right' class='webix_icon action-close wxi-close'></span>":"<span style='float:right' class='webix_icon action-menu wxi-dots'></span>",n=e("and"),r=e("or"),a=function(t){return"and"==t.glue?n:r};return{view:"tree",borderless:!0,localId:"list",glue:"and",css:"wbq-query_list",scheme:{$serialize:function(t){if(t.group)return{group:t.group,glue:t.glue};var e={glue:t.glue,field:t.field,condition:t.condition};return t.includes&&t.includes.length&&(e.includes=t.includes),e},$init:function(t){t.group&&(t.$css="group",t.open=!0)}},type:{template:function(n){if(n.group){var r=t.DisableSwitch?"wbq-filter_join_disabled":"";return"<div class='wbq-filter_join wbq-filter_join_"+n.glue+" "+r+"'>"+a(n)+"</div>"}return t.Template(n,t.app.config.fields,i,e)+"<div class='wbq-filter_join wbq-filter_join_"+n.glue+"'>"+a(n)+"</div>"}},onClick:{"action-menu":function(t,e){this.$scope.Actions.Show(t.target,e)},"action-close":function(e,i){t.Delete(i)},"wbq-filter_join":function(e,i){t.SwitchGlue(i)}},on:{onItemDblClick:function(e){t.EditStart(e)}}}},e.prototype.init=function(){var t=this;this.Actions=this.ui(N),this.on(this.app,"applyFilter",(function(e){return t.EditStop(e)})),this.on(this.app,"action",(function(e,i){"delete"===e?t.Delete(i):"add-filter"===e?t.Add(null,i):"add-group"===e?t.AddGroup(null,i):"edit"===e&&webix.delay((function(){return t.EditStart(i)}))})),this.State=this.getParam("state"),this.on(this.State.$changes,"value",(function(e){t.LastValue=JSON.stringify(e),t.EditStop(),t.$$("list").clearAll(),e&&t.$$("list").parse(t.ConvertTo(e))}))},e.prototype.ConvertTo=function(t,e){var i=this;if(t.rules){var n=t.rules.map((function(e){return i.ConvertTo(e,t.glue)}));return e?{group:!0,glue:e,data:n}:n}return r(r({},t),{glue:e})},e.prototype.ConvertFrom=function(t,e){var i=this,n=e.getBranch(t),r=n.map((function(t){var n=t.id,r=t.field,a=t.type,o=t.condition,s=t.includes;return r?{field:r,type:a,condition:o,includes:s}:i.ConvertFrom(n,e)}));return r.length?{glue:n[0].glue,rules:r}:null},e.prototype.Add=function(t,e){this.EditStop(),t=t||{field:""};var i=this.$$("list"),n=e?i.getParentId(e):0,r=e?i.getBranchIndex(e)+1:-1;!e&&i.count()&&(e=i.getFirstId());var a=e?i.getItem(e).glue:i.config.glue;t.glue=a;var o=i.add(t,r,n);this.EditStart(o),this.CreateMode=!0},e.prototype.SwitchGlue=function(t){this.EditStop();for(var e=this.$$("list"),i=e.data.getBranch(e.getParentId(t)),n=0;n<i.length;n++)e.updateItem(i[n].id,{glue:"and"==i[n].glue?"or":"and"});this.Save()},e.prototype.AddGroup=function(t,e){this.EditStop(),t=t||{};var i=this.$$("list"),n=e?i.getParentId(e):0,r=e?i.getBranchIndex(e)+1:-1,a={id:webix.uid(),group:!0},o=e?i.getItem(e).glue:i.config.glue;a.glue=o,t.glue="and"==a.glue?"or":"and",this.DisableSwitch=!0,i.add(a,r,n);var s=i.add(t,null,a.id);this.EditStart(s),this.DisableSwitch=!1,this.CreateMode=!0},e.prototype.Delete=function(t){this.EditStop(),this.DeleteSilent(t),this.Save()},e.prototype.DeleteSilent=function(t){var e=this.$$("list");if(!e.exists(t))return null;var i=e.getParentId(t);e.remove(t);var n=e.data.branch[i];if(i&&!n)this.DeleteSilent(i);else if(1==n.length&&e.getItem(n[0]).group){var r=n[0];if(i){var a=e.getParentId(i),o=e.getBranchIndex(i,a);e.move(r,o,e,{parent:a}),this.DeleteSilent(i)}else{o=e.getBranchIndex(r,0);var s=[].concat(e.data.branch[r]);e.move(s,o,e,{parent:0}),this.DeleteSilent(r)}}},e.prototype.EditStop=function(t){if(this.Active){var e=this.$$("list");t?((t=t||this.Active.GetValue()).includes=t.includes||[],e.updateItem(this.ActiveId,r({},t))):this.CreateMode?this.DeleteSilent(this.ActiveId):e.refresh(this.ActiveId);var i=this.Active;this.Active=null,this.ActiveId=null,i.destructor(),this.Save()}},e.prototype.Save=function(){var t=this.ConvertFrom(0,this.$$("list").data),e=JSON.stringify(t);this.LastValue!==e&&(this.State.value=t)},e.prototype.Template=function(t,e,i,n){var r="&nbsp;",a=e.find((function(e){return e.id===t.field}))||{value:""};if(t.includes&&t.includes.length){r=n("in")+" ";for(var o=0;o<t.includes.length;o++)r+=(o>0?", ":"")+"<span class='wbq-field-value'>"+t.includes[o]+"</span>"}else t.condition&&t.condition.type&&(r=n(t.condition.type)+" <span class='wbq-field-value'>"+this.Format(t.condition.filter,a.format,a.type)+"</span>");return"<span class='wbq-field-box'><span class='wbq-field-name'>"+a.value+"</span> "+r+" </span>"+i},e.prototype.Format=function(t,e,i){if(!t)return"";if(t.start)t=this.Format(t.start,e,i)+(t.end?" - "+this.Format(t.end,e,i):"");else{var n=e||("date"==i?webix.i18n.dateFormatStr:null);n&&(t=n(t))}return t},e}(h),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{padding:10,margin:6,css:"webix_shadow_small",rows:[{view:"richselect",options:[],localId:"field",on:{onChange:function(){return t.AdjustToField()}}},{localId:"filter"},{type:"clean",cols:[{view:"button",value:e("Cancel"),width:100,click:function(){return t.Hide()}},{},{view:"button",value:e("Apply"),width:100,css:"webix_primary",click:function(){return t.ApplyFilter()}}]}]}},e.prototype.GetField=function(){var t=this.$$("field");return t.getList().getItem(t.getValue())},e.prototype.AdjustToField=function(){var t=this.GetField();this.CreateFilter(t.id,t.type,t.format,t.conditions,this.$$("filter"))},e.prototype.CreateFilter=function(t,e,i,n,r){var a={view:"filter",localId:"filter",conditions:n,field:t,mode:e,template:function(n){var r=n[t],a=i||("date"==e?webix.i18n.dateFormatStr:null);return a&&(r=a(r)),r},margin:6},o=webix.ui(a,r),s=this.app.getService("backend").data(t);return o.parse(s),o},e.prototype.ApplyFilter=function(){this.app.callEvent("applyFilter",[this.GetValue()])},e.prototype.GetValue=function(){var t=this.GetField(),e=r(r({},this.$$("filter").getValue()),{field:t.id,type:t.type});return""!=e.condition.filter||e.includes&&e.includes.length||(e=null),e},e.prototype.Hide=function(){this.app.callEvent("applyFilter",[null])},e.prototype.Show=function(t,e){var i=this.$$("field");i.getList().parse(e),t.field?i.setValue(t.field):i.setValue(e[0].id),this.$$("filter").setValue(webix.copy(t))},e}(h),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{view:"popup",point:!1,body:{$subview:G,name:"body"}}},e.prototype.Show=function(t,e,i){var n=this;setTimeout((function(){n.getRoot().show(i),n.getSubView("body").Show(t,e)}),100)},e}(h),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this.GetButton();t.width=100;var e=this.GetList();e.scroll=!1!==this.app.config.scroll?"x":"",e.borderless=!0,e.css="wbq-query_bar";var i=8,n=58;return("mini"==webix.skin.$name||"compact"==webix.skin.$name)&&(i=4,n=50),e.scroll&&(n+=webix.env.scrollSize),{view:"toolbar",paddingX:2*i,paddingY:i,height:n,borderless:!0,cols:[e,t]}},e.prototype.EditStart=function(t){var e=this;this.EditStop();var i=this.$$("list");this.ActiveId=t,this.Active=this.ui(Y),this.Active.getRoot().attachEvent("onHide",(function(){e.Active&&e.EditStop()}));var n=webix.html.offset(i.getItemNode(t));this.Active.Show(i.getItem(t),this.app.config.fields,n),this.CreateMode=!1},e}(j),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{paddingX:16,paddingY:8,margin:0,rows:[this.GetButton(),this.GetList()]}},e.prototype.EditStart=function(t){var e=this;if(!this.ActiveId||this.ActiveId!=t){this.EditStop();var i=this.$$("list"),n=i.getItemNode(t);n.classList.add("active-editor"),n.innerHTML="",this.ActiveId=t,this.Active=this.ui(G,{container:n}),this.$$("list").attachEvent("onAfterRender",(function(){return e.EditStop()})),this.Active.Show(i.getItem(t),this.app.config.fields),this.CreateMode=!1}},e}(j),q={JetView:h};q.actions=N,q.bar=z,q.base=j,q.filter=G,q.list=W,q.popup=Y;var K=function(){function t(t){this._app=t}return t.prototype.data=function(t){var e=this._app.config.data;return"function"==typeof e?Promise.resolve(e(t)).then((function(e){return e.map((function(e){var i;return(i={})[t]=e,i}))})):Promise.resolve(e)},t.prototype.save=function(t){console.log(t)},t}();function X(t,e,i){if(!t||!t.rules.length)return function(){return!0};var n=t.rules.map((function(t){return function(t,e,i){return t.rules?X(t,e,i):function(n){var r=n[t.field];if(t.includes&&t.includes.length)return-1!==t.includes.findIndex((function(t){return t===r}));if(!webix.isUndefined(r)){var a=t.condition.type;return(e[a]||e[i[t.field]][a])(r,t.condition.filter)}return!1}}(t,e,i)}));return("or"===t.glue?J:Q)(n)}function Q(t){return function(e){for(var i=0;i<t.length;i++)if(!t[i](e))return!1;return!0}}function J(t){return function(e){for(var i=0;i<t.length;i++)if(t[i](e))return!0;return!1}}var Z=function(t){function e(e){var i=this,n=B({value:e.value||null}),a={router:y,version:"10.0.9",debug:!0};return(i=t.call(this,r(r({},a),e))||this).config.start="bar"===e.type?"/bar":"/list",i.config.params={state:n,simple:!0===e.simple},i.setService("backend",new(i.dynamic(K))(i)),i.use(V,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i}return n(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?q[e]:"jet-locales"===t?et[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype.GetFilter=function(){return function(t,e){var i=webix.filters,n={};return e.forEach((function(t){t.conditions&&t.conditions.forEach((function(t){"object"==typeof t&&(i[t.id]=t.handler)})),t.type&&(n[t.id]=t.type)})),X(t,i,n)}(this.config.params.state.value,this.config.fields)},e}(_);webix.protoUI({name:"query",app:Z,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t,e,i=this,n=this.getState();for(var r in n)H(n,this.config,r);n.$changes.attachEvent("value",(t=function(t,e){return i.callEvent("onChange",t,e)},e=!1,function(){if(e)return t.apply(this,arguments);e=!0}))},getFilterFunction:function(){return this.$app.GetFilter()}},webix.ui.jetapp);var tt={Backend:K},et={en:{"Add filter":"Add filter",in:"=",equal:"=",notEqual:"<>",less:"<",greater:">",greaterOrEqual:">=",lessOrEqual:"<=",contains:"contains",notContains:"not contains",beginsWith:"begins",notBeginsWith:"not begings",endsWith:"ends",notEndsWith:"not ends",between:"between",notBetween:"not between",and:"and",or:"or",Edit:"Edit","Add Filter":"Add Filter","Add Group":"Add Group",Delete:"Delete",Apply:"Apply",Cancel:"Cancel"}};t.App=Z,t.locales=et,t.services=tt,t.views=q,Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof o?et(o):(r=[e],void 0===(a="function"==typeof(n=et)?n.apply(e,r):n)||(t.exports=a));var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("local");return{view:"query",localId:"query",css:"webix_rpt_query",locale:{lang:this.app.getService("locale").getLang()},data:function(i){var n=t.State.fields.find((function(t){return t.id===i}));return"boolean"===n.type?[0,1]:e.getFieldData(i,n.type)},fields:this.State.fields.filter((function(t){return"reference"!==t.type&&"picklist"!==t.type})).map((function(t){var e={id:t.id,value:t.name+" "+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":""),type:t.type};return"boolean"===e.type&&(e.conditions=["equal"],e.type="number"),e}))}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0);var e=this.getRoot();this.on(this.State.$changes,"query",(function(t){e.$app.callEvent("applyFilter",[null]),e.config.value=t?st(JSON.parse(t)):null})),e.getState().$observe("value",(function(e){t.State.query=e?JSON.stringify(e):""}))},e}(m);function st(t){if(t.rules)t.rules.forEach(st);else if("date"===t.type){var e=t.condition;e.filter&&"string"==typeof t.condition.filter&&(e.filter=new Date(e.filter)),e.filter.start&&"string"==typeof e.filter.start&&(e.filter.start=new Date(e.filter.start)),e.filter.end&&"string"==typeof e.filter.end&&(e.filter.end=new Date(e.filter.end))}return t}var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return{localId:"qblock",type:"clean",rows:[{type:"form",margin:5,padding:{bottom:5},rows:[{localId:"queryBar",visibleBatch:"def",cols:[{view:"label",label:e("Filtering query"),width:120},{},{batch:"query",view:"icon",localId:"delete",icon:"rpi-delete",tooltip:e("Delete"),click:function(){return t.DeleteQuery()}},{batch:"query",view:"icon",localId:"copy",icon:"rpi-content-copy",tooltip:e("Create copy"),click:function(){return t.CopyQuery()}},{batch:"query",view:"icon",localId:"rename",icon:"rpi-pencil",tooltip:e("Rename"),click:function(){return t.RenameQuery()}},{view:"button",disabled:!0,css:"webix_primary",localId:"save",label:e("Save"),tooltip:e("Save query"),width:150,click:function(){return t.SaveQuery(null)}}]},{view:"query-select",options:[],name:"id",css:"webix_rpt_qselect",localId:"qselect",suggest:{css:"webix_rpt_qselect_suggest",template:function(e){return t.QSelectTemplate(e)},body:{minHeight:25},on:{onShow:function(){this.getBody().$view.firstChild.getAttribute("placeholder")||this.getBody().$view.firstChild.setAttribute("placeholder",e("No saved queries"))}}},on:{onClearClick:function(){return t.NewQuery()}}},{autoheight:!0,borderless:!0,template:e("Save filter to use it in other reports"),css:"webix_rpt_description"}]},ot]}},e.prototype.init=function(){var t=this;this.Local=this.app.getService("local"),this.Operations=this.app.getService("operations");var e=this.State=this.getParam("state",!0),i=this.Queries=this.Local.getQueries();this.LocalState=K({id:"",saved:!0}),i.waitData.then((function(){var n,r=t.State.query,a=t.$$("qselect"),o=a.getList(),s=((n={})[t.State.data]=1,n);t.State.joins.forEach((function(t){return s[t.tid]=1})),i.filter((function(t){var e=!0;return t.models.forEach((function(t){s[t]||(e=!1)})),e})),o.sync(i),i.data.each((function(t){t.text==r&&a.setValue(t.id)})),t.on(e.$changes,"query",(function(e){var n=t.LocalState.id,r=!n&&e||n&&i.getItem(n).text!=e;t.LocalState.saved=!r}))})),tt(this.LocalState,"id",this.$$("qselect"),this);var n=this.$$("save");this.on(this.LocalState.$changes,"saved",(function(t){t?n.disable():n.enable()})),this.on(this.LocalState.$changes,"id",(function(e){if(e){var n=i.getItem(e);t.State.query=n.text,t.$$("queryBar").showBatch("query")}else t.$$("queryBar").showBatch("def")}))},e.prototype.NewQuery=function(){this.LocalState.id=null,this.LocalState.saved=!0,this.State.query=null},e.prototype.SaveQuery=function(t){var e=this,i=this.LocalState.id,n=this.State.query;if(i)return null===t&&(t=this.Queries.getItem(i).name),void this.Operations.updateQuery(i,{name:t,text:n}).then((function(){e.$$("qselect").setValue(i),e.LocalState.saved=!0}));at({text:this._("Enter query name"),button:this._("Save"),value:""},this.app).then((function(t){t&&e.Operations.addQuery({name:t,text:n}).then((function(t){e.LocalState.saved=!0,e.LocalState.id=t}))}))},e.prototype.RenameQuery=function(){var t=this,e=this.LocalState.id,i=this.Queries.getItem(e).name;at({text:this._("Enter query name"),value:i,button:this._("Save")},this.app).then((function(e){e&&t.SaveQuery(e)}))},e.prototype.CopyQuery=function(){var t=this,e=this.app.getService("locale")._,i=this.Queries.getItem(this.LocalState.id),n=i.name,r=i.text;n=e("Copy of")+" "+n,this.Operations.addQuery({name:n,text:r}).then((function(e){t.LocalState.id=e}))},e.prototype.DeleteQuery=function(){var t=this,e=this.app.getService("locale")._;webix.confirm({container:this.app.getRoot().$view,title:e("Delete"),ok:e("Delete"),cancel:e("Cancel"),text:e("Are you sure to delete this query?")}).then((function(){var e=t.LocalState.id;t.Operations.deleteQuery(e).then((function(){t.LocalState.$batch({saved:!0,id:null}),t.State.query=null}))}))},e.prototype.GetMenuOptions=function(){return[{id:"copy",value:"Copy",icon:"rpi-content-copy"},{id:"rename",value:"Rename",icon:"rpi-pencil"},{id:"delete",value:"Delete",icon:"rpi-delete"}]},e.prototype.GetMenuTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span>"+t.value},e.prototype.ApplyQueryAction=function(t){switch(this.QueryMenu.hide(),t){case"rename":this.RenameQuery();break;case"copy":this.CopyQuery();break;case"delete":this.DeleteQuery()}},e.prototype.QSelectTemplate=function(t){return t.value+" <span class='webix_icon wxi-close webix_rpt_qselect_icon'></span>"},e}(m),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={optionWidth:102,tabMinWidth:102,view:"tabbar",localId:"tabbar",css:"webix_rpt_editor_tabbar",borderless:!0,options:[{id:"common",value:e("Common")},{id:"data",value:e("Query")},{id:"other",value:e("Data")},{id:"structure",value:e("View")}],on:{onChange:function(e){return t.ShowView(e)}}},n=webix.skin.$name;"flat"!=n&&"compact"!=n&&"contrast"!=n||(i.type="bottom");var r={width:490,hidden:!1,localId:"settings",rows:[{view:"toolbar",padding:{left:13,top:0,bottom:0},height:webix.skin.$active.barHeight+6,scroll:!1,cols:[i,{view:"icon",width:40,localId:"closeBtn",icon:"rpi-close",click:function(){return t.Hide()}}]},{$subview:!0}]};return this.Operations=this.app.getService("operations"),this.Local=this.app.getService("local"),this.Local.ready(r)},e.prototype.init=function(){var t=this;this.AppState=this.app.getParam("state");var e=this.Local.newModule();e.id=-1;var i=this.State=K(e);this.setParam("state",this.State),this.on(this.AppState.$changes,"moduleId",(function(e){return t.ChangeModule(e)})),this.on(this.State.$changes,"data",(function(e,i,n,r){!e||r&&r.load||t.ChangeModel(e)})),this.on(this.AppState.$changes,"toolbar",(function(e){return t.ShowHideButton(e)})),this.on(this.State.$changes,"*",function(t,e){e=e||200;var i=null,n=null;return function(){var r=this;n=arguments,i||(i=setTimeout((function(){clearTimeout(i),i=null,t.apply(r,n)}),e))}}((function(){-1!==t.State.id&&(t.TrackChanges(),t.AppState.module=Object.assign({},t.State))}))),this.on(i.$changes,"group",(function(e,n,r,a){if(!e&&n){var o=i.oldColumns||t.Local.getFields(i.data,i.joins,!0),s=webix.copy(o).filter((function(t){return"number"==t.type&&!t.key})),l=t.UpdateMeta(s,o);i.$batch({publicFields:null,columns:o,meta:l})}else if(e){var h=[];if(a&&a.load)h=c(t.State.columns);else if(n){if(JSON.stringify(e)==JSON.stringify(n))return;h=c(t.State.columns)}else i.oldColumns=i.columns;o=e.columns.map((function(t){return{id:t.op+"."+t.id,name:t.name,type:"number",meta:{},model:""}}));var p=webix.copy(o);e.by&&(o=o.concat(e.by.map((function(e){var i=t.State.fields.find((function(t){return t.id==e.id})),n=e.mod?e.mod+"."+e.id:e.id,r=u(u({},i),{id:n});return e.mod&&(r.type="text"),r}))));var d={};(i.publicFields||i.columns).forEach((function(t){return d[t.id]=1}));var f={};o.forEach((function(t){if(f[t.id]=1,d[t.id]){var e=h.find((function(e){return e.id==t.id}));e&&e.name!=t.name&&(e.name=t.name)}else h.push(t)})),h=h.filter((function(t){return f[t.id]})),(l=t.UpdateMeta(p,o)).freeze&&l.freeze>=h.length&&delete l.freeze,i.$batch({publicFields:o,columns:h,meta:l})}})),this.on(this.app,"saveModule",(function(){return t.Save()})),this.on(this.app,"resetModule",(function(){return t.Reset()})),this.on(this.app,"onColumnResize",(function(e,i){var n=c(t.State.columns);n.find((function(t){return t.id==e})).width=i,t.State.columns=n})),this.on(this.AppState.$changes,"readonly",(function(e){e&&t.Reset()})),this.show("./editor.common")},e.prototype.Save=function(){var t=this,e=this.Operations.getModuleSaveData(this.State),i={name:this.State.name,text:JSON.stringify(e)};this.AppState.moduleId?this.Operations.updateModule(this.AppState.moduleId,i).then((function(e){return t.SaveCallback(e)})):this.Operations.addModule(i).then((function(e){return t.SaveCallback(e)}))},e.prototype.SaveCallback=function(t){this.AppState.$batch({moduleId:t,mode:"view",module:Object.assign({},this.AppState.module),saved:!0})},e.prototype.ShowView=function(t){this.$$("tabbar").setValue(t),this.show("editor."+t)},e.prototype.Hide=function(){this.Reset()},e.prototype.Reset=function(){var t=this,e=this.AppState.moduleId;e?this.Local.getModule(e).then((function(e){t.AppState.$batch({mode:"view",module:Object.assign({},JSON.parse(e.text)),saved:!0})})):this.AppState.$batch({mode:"list",module:null,saved:!0})},e.prototype.ChangeModel=function(t){t&&this.State.$batch(this.Local.setDataSource(t))},e.prototype.ChangeModule=function(t){var e=this;this.InitStateValue="",t?this.Local.getModule(t).then((function(t){var i=JSON.parse(t.text);e.InitStateValue=t.text,e.InitName=i.name=t.name,i.id=t.id,i.saved=!0,i.fields=e.Local.getFields(i.data,i.joins),W({load:!0},(function(){return e.State.$batch(i)})),e.AppState.saved=!0})):(this.InitStateValue=null,this.State.$batch(this.Local.newModule()),this.State.fields=this.Local.getFields(this.State.data,this.State.joins),this.AppState.saved=!1)},e.prototype.TrackChanges=function(){this.AppState.saved=JSON.stringify(this.Operations.getModuleSaveData(this.State))==this.InitStateValue&&this.State.name==this.InitName},e.prototype.ShowHideButton=function(t){t?this.$$("closeBtn").show():this.$$("closeBtn").hide()},e.prototype.UpdateMeta=function(t,e){var i=this.State.meta,n=this.State;return t.length&&("chart"==n.type?(t=t.map((function(t){var e=u(u({},t),{value:t.name});return delete e.name,e})),i.chart.series=this.app.getService("charts").getSeries(t,n.chartType)):"heatmap"==n.type&&(i.value=t[0].id,i.label=n.publicFields?e[e.length-1].id:e[0].id,i.color&&!t.find((function(t){return t.id==i.color}))&&(i.color=t[0].id))),i},e}(m),ct=function(t){function e(e,i){var n=t.call(this,e)||this;return n.Name=i,n}return l(e,t),e.prototype.config=function(){var t=this;return{view:"popup",body:{view:"list",css:"webix_rpt_popup_menu",width:160,autoheight:!0,template:function(e){return t.GetTemplate(e)},click:function(e){t.ClickHandler(e),t.getRoot().close()},data:this.GetOptions()}}},e.prototype.ClickHandler=function(t){this.getParentView().ApplyAction(t)},e.prototype.Show=function(t,e,i){this.SetActionStates(e,i),this.getRoot().show(t)},e.prototype.GetOptions=function(){return[{id:"delete",value:(0,this.app.getService("locale")._)("Delete"),icon:"rpi-delete"}]},e.prototype.SetActionStates=function(t){var e=this.getRoot().getBody();e.data.each((function(i){1==t.length?e.disableItem(i.id):e.enableItem(i.id)}))},e.prototype.GetTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span> "+t.value},e}(m),ht=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.State=i,r.ParentState=n,r}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this.ValueSeparator=",";var i={margin:webix.skin.$active.layoutMargin.form,padding:{top:0,bottom:0,left:0,right:0},localId:"forms",view:"form",type:"clean",elements:[]},n={localId:"other",view:"form",type:"clean",borderless:!0,margin:webix.skin.$active.layoutMargin.form,cols:[{view:"text",name:"name",width:150,placeholder:e("Bucket name"),value:e("Other"),on:{onChange:function(e){return t.Changed("other","name",e)}}},{view:"label",css:"webix_rpt_subtitle",label:e("Other values")}],rules:{name:webix.rules.isNotEmpty}},r=webix.skin.$active.layoutPadding.form;return{borderless:!0,type:"clean",padding:{top:r,bottom:r,left:0,right:0},css:"webix_rpt_subview",rows:[i,{height:webix.skin.$active.layoutMargin.form},n,{height:webix.skin.$active.layoutMargin.form},{view:"button",icon:"wxi-plus",type:"icon",label:e("Add bucket"),inputWidth:210,align:"left",click:function(){return t.AddNewBucket()}}]}},e.prototype.init=function(){var t=this;this.Local=this.app.getService("local"),this.Forms=this.$$("forms"),this.GetRowKeys(this.State.id).then((function(e){t.Data=e.sort((function(e,i){return t.Sort(e,i)})),t.CreateForm()})),this.on(this.app,"onAction",(function(e,i,n){"bucket"==e&&"focus"==i&&n==t.State.id&&t.Focus(0)}))},e.prototype.GetRowKeys=function(t){if(t&&this.ParentState.columns.length){var e=[];return this.GetColumnData(t).then((function(i){var n=i[0],r=i[1];return n.forEach((function(i){var n=i[t];-1==e.indexOf(n)&&e.push(n)})),r?e.map((function(t){var e=r.data.find((function(e){return e.id==t}))||null;return{id:t,value:e?e.value:t}})):e.map((function(t){return{id:t,value:t}}))}))}return Promise.resolve([])},e.prototype.GetColumnData=function(t){var e=this.app.getParam("state"),i=this.Local.getDataConfig(e.module);i.columns=[t],delete i.buckets,delete i.group;var n=[this.Local.getData(i),this.Local.getOptionsList(t)];return Promise.all(n)},e.prototype.CreateForm=function(){var t=this,e=this.State.options;e&&e.length?this.LoadBuckets(e):this.AddNewBucket(),webix.delay((function(){t.app.callEvent("onAction",["bucket","resize",t.State.id]),t.Focus(0)}))},e.prototype.AddNewBucket=function(){this.AddBucket(),this.Changed(),this.Focus()},e.prototype.LoadBuckets=function(t){var e=this;t.forEach((function(t){t.values?e.AddBucket(t):e.LoadOther(t)})),this.Changed()},e.prototype.LoadOther=function(t){this.$$("other").setValues({name:t.id})},e.prototype.AddBucket=function(t){t=t||{},this.Forms.addView(this.GetRowForm(webix.uid(),t))},e.prototype.GetRowForm=function(t,e){var i=this,n=[{rows:[{width:150,view:"text",name:"name",value:e.id||null,placeholder:this._("Bucket name"),on:{onChange:function(e){return i.Changed(t,"name",e)}}}]},{view:"multicombo",name:"values",placeholder:this._("Bucket values"),css:"webix_multilist webix_rpt_multicombo",separator:this.ValueSeparator,suggest:{body:{css:"webix_multilist webix_rpt_bucket_values",data:this.Data,template:function(e){return i.OptionTemplate(t,e)}},on:{onBeforeShow:function(){this.getList().refresh()}}},value:e.values||null,on:{onChange:function(e){return i.Changed(t,"values",e)}}},{rows:[{view:"icon",icon:"wxi-dots",click:function(t,e){return i.ShowPopup(t,e)}}]}];return{view:"form",localId:t,type:"clean",borderless:!0,margin:webix.skin.$active.layoutMargin.form,rules:{name:webix.rules.isNotEmpty,values:webix.rules.isNotEmpty},cols:n}},e.prototype.ShowPopup=function(t,e){this.Popup&&this.Popup.$view||(this.Popup=this.ui(new ct(this.app,"bucket")));var i=webix.$$(t).getParentView().getParentView();this.ActiveForm=i,this.Popup.Show(e.target,this.GetValues(),i.getParentView().index(i))},e.prototype.GetValidBuckets=function(){var t=this,e=this.$$("other"),i=e.elements.name.getValue();e.validate();var n={};i&&(n[i]=[e]);var r=[];return this.ForEachFormRow((function(e){e.validate();var i=e.getValues(),a=i.name;a&&(n[a]?(t.$$(n[a]).forEach((function(t){return t.markInvalid("name",!0)})),e.markInvalid("name",!0)):i.values.length&&r.push({id:a,values:i.values.split(",")}),n[a]||(n[a]=[]),n[a].push(e))})),r.length&&i&&r.push({id:i}),r},e.prototype.Changed=function(t,e,i){"values"==e&&this.CorrectValues(t,i);var n=this.GetValidBuckets();this.State.options=n},e.prototype.OptionTemplate=function(t,e){var i=!e.$checked&&this.GetValues().find((function(i){return i.id!=t&&i.values.indexOf(e.value)>-1}));return"<div class='webix_rpt_bucket_value"+(i?" webix_rpt_bucket_value_selected":"")+"'>"+e.value+"</div>"+(i?"<span class='webix_rpt_bucket_icon webix_icon rpi-pail-outline'></span>":"")},e.prototype.GetValues=function(){var t=[];return this.ForEachFormRow((function(e){var i=e.getValues();i.id=e.config.localId,t.push(i)})),t},e.prototype.ForEachFormRow=function(t){this.Forms.getChildViews().forEach((function(e){e&&e.elements&&t(e)}))},e.prototype.CorrectValues=function(t,e){this.ForEachFormRow((function(i){if(i.config.localId!=t){var n=i.getValues().values.split(",");n=n.filter((function(t){return-1==e.indexOf(t)})),i.elements.values.setValue(n)}}))},e.prototype.ApplyAction=function(t){"delete"==t&&this.DeleteBucket(this.ActiveForm)},e.prototype.DeleteBucket=function(t){this.Forms.removeView(t),this.Changed()},e.prototype.Sort=function(t,e){var i=this,n=this.ParentState.fields.find((function(t){return t.id==i.State.id})).type;if(t=t.value,e=e.value,"number"==n){if(t*=1,e*=1,isNaN(e))return 1;if(isNaN(t))return-1}else{if(!e)return 1;if(!t)return-1;t=t.toString().toLowerCase(),e=e.toString().toLowerCase()}return t>e?1:t<e?-1:0},e.prototype.Focus=function(t){var e=this;webix.delay((function(){var i=e.Forms.getChildViews();void 0===t&&(t=i.length-1);var n=i[t];n&&n.elements.name.focus()}),null,null,100)},e}(m),pt=function(t){function e(e,i){var n=t.call(this,e)||this;return n.Master=i,n}return l(e,t),e.prototype.config=function(){var t=this;return{view:"popup",autoheight:!0,fitMaster:!0,body:{rows:[{padding:{top:5,bottom:5,left:10,right:10},cols:[{view:"text",localId:"search",placeholder:(0,this.app.getService("locale")._)("Search")}]},{view:"list",scroll:!0,yCount:5,autoheight:!0,select:!0,type:{template:function(e){return t.GetTemplate(e)}},on:{onItemClick:function(e){var i=t.List.getItem(e);t.AddColumn(i),t.View.hide()},onEnter:function(){var e=t.List.getSelectedItem();e&&(t.AddColumn(e),webix.delay((function(){return t.View.hide()})))}}}]}}},e.prototype.init=function(){var t=this;this.View=this.getRoot();var e=this.View.getBody().getChildViews();this.State=this.getParam("state",!0),this.BucketState=this.getParam("buckets",!0),this.Text=e[0].getChildViews()[0],this.List=e[1],this.Text.attachEvent("onTimedKeyPress",(function(){t.Find(t.Text.getValue())}))},e.prototype.AddColumn=function(t){var e=c(this.BucketState.buckets);e.push({column:t.id,options:[]}),this.BucketState.buckets=e},e.prototype.Show=function(t){t=t.firstChild.firstChild,this.View.config.width=t.offsetWidth-2,this.View.adjust(),this.View.show(t),this.Text.focus(),this.List.clearAll(),this.List.parse(this.GetColumns())},e.prototype.GetColumns=function(){var t=this,e=this.State.fields;return this.State.publicFields&&(e=e.filter((function(e){return t.State.publicFields.find((function(t){return t.id==e.id}))}))),e.map((function(e){return{id:e.id,value:e.name,type:e.type,model:e.model,disabled:t.BucketState.buckets&&t.BucketState.buckets.find((function(t){return t.column==e.id}))}}))},e.prototype.GetTemplate=function(t){return t.value+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e.prototype.Find=function(t){(t=t.toLowerCase())?this.List.filter((function(e){return e.value.toLowerCase().indexOf(t)>-1})):this.List.filter("")},e}(m);webix.protoUI({name:"groupselect",$cssName:"text webix_rpt_groupselect",defaults:{selectIcon:!0,modifiers:{}},renderModifier:function(t){var e=this._modifiers[t];if(e){var i=this.config.modifiers.find((function(t){return t.id===e}));return"<div class='webix_rpt_date_selector'>"+(i?i.value:"")+(this.config.selectIcon?"<span class='webix_icon wxi-angle-down'></span>":"")+"</div> <span class='webix_rpt_groupselect_sep'> | </span> "}return""},$renderTag:function(t,e,i,n){var r=this.renderModifier(n);return r+="<span>"+t+"</span><span class='webix_multicombo_delete webix_rpt_groupselect_delete' role='button' aria-label='"+webix.i18n.aria.removeItem+"'></span>","<li class='webix_multicombo_value' style='line-height:"+i+"px;' optvalue='"+webix.template.escape(n)+"'>"+r+"</li>"},$init:function(){this._modifiers={},webix.extend(this.on_click,{webix_rpt_date_selector:function(t,e,i){var n=webix.html.locate(t,"optvalue");return this.callEvent("onModifierClick",[n,t,i]),!1}})},setValue:function(t){var e=this;return t?("string"!=typeof t&&"string"!=typeof t[0]&&(this._modifiers={},t=t.map((function(t){return e._modifiers[t.id]=t.mod||null,t.id}))),webix.ui.multicombo.prototype.setValue.call(this,t)):this._modifiers={},webix.ui.multicombo.prototype.setValue.call(this,t)},getModifier:function(t){return this._modifiers[t]},setModifier:function(t,e,i){this._modifiers[t]=e,i||this.callEvent("onChange",[]),this.refresh()},$setSize:function(t,e){var i=this.config,n=this._custom_last_size||[0,0],r=n[0],a=n[1];if((t!=r||e!=a)&&(this._custom_last_size=[t,e],webix.ui.view.prototype.$setSize.call(this,t,e))){if(!t||!e)return;"top"==i.labelPosition&&(i.labelWidth=0),this.render()}}},webix.ui.multicombo);var dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this.Views={};var i={margin:5,rows:[{autoheight:!0,borderless:!0,template:e("Specify columns and their data buckets"),css:"webix_rpt_description"},{view:"button",icon:"wxi-plus",localId:"addColumn",label:e("Add column"),click:function(){return t.ShowColumns()}}]},n={view:"datatable",css:"webix_rpt_columns_list webix_rpt_bcols",localId:"table",borderless:!0,autoheight:!0,header:!1,select:!1,subview:function(e,i){var n=K({id:e.id,options:e.options});t.on(n.$changes,"*",Y((function(){t.Update(e.id,n)})));var r=t.Views[e.id]=new ht(t.app,n,t.State);return t.ui(r,{container:i}),r.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.RowTemplate(e,i)}}],on:{onItemClick:function(e){return t.ToggleSub(e)},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onSubViewOpen:function(e){return t.HideAllEditors(e)},onSubViewClose:function(){return t.ResetEditor()}},onClick:{webix_rpt_bucket_delete:function(i,n){return webix.confirm({title:e("Delete"),ok:e("Delete"),cancel:e("Cancel"),text:e("Are you sure to delete?")}).then((function(){return t.RemoveColumn(n)})),!1}}};return{view:"form",borderless:!0,padding:0,elements:[{margin:webix.skin.$active.layoutMargin.form,rows:[i,n]}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Table=this.$$("table");var e=this.State.buckets||[];this.BucketState=K({buckets:e,newColumn:null}),this.LoadBuckets(),this.setParam("buckets",this.BucketState),this.on(this.BucketState.$changes,"*",Y((function(e,i){return t.Changed(e,i)}))),this.on(this.app,"onAction",(function(e,i,n){t.getRoot()&&"bucket"==e&&"resize"==i&&t.Table.refresh(n)}))},e.prototype.ShowColumns=function(){this.ColumnList&&this.ColumnList.$view||(this.ColumnList=this.ui(pt,this.State)),this.ColumnList.Show(this.$$("addColumn").$view)},e.prototype.LoadBuckets=function(){var t=this,e=this.BucketState.buckets?this.BucketState.buckets.map((function(e){var i=t.State.fields.find((function(t){return t.id==e.column}));return{id:e.column,name:i.name,model:i.model||null,options:e.options}})):[];this.Table.clearAll(),this.Table.parse(e),e.length||this.Table.hide()},e.prototype.AddColumn=function(t){this.Table.config.hidden&&this.Table.show();var e=this.State.fields.find((function(e){return e.id==t}));this.Table.add({id:t,name:e.name,model:e.model||null,options:[]})},e.prototype.RemoveColumn=function(t){this.Table.remove(t);var e=c(this.BucketState.buckets),i=e.findIndex((function(e){return e.column==t}));e.splice(i,1),this.BucketState.buckets=e,e.length||this.Table.hide(),this._ActiveEditor&&String(t)==String(this._ActiveEditor)&&this.ResetEditor(),this.Views[t].destructor()},e.prototype.ListTemplate=function(t){return t.value+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e.prototype.Changed=function(t,e){if(t.length>e.length){var i=t[t.length-1].column;this.AddColumn(i),this.Table.openSub(i)}var n=this.BucketState.buckets.filter((function(t){return t.options.length}));this.State.buckets=n},e.prototype.RowTemplate=function(t,e){return"<div class='webix_rpt_config_row'>\n\t\t\t<span class='webix_rpt_buckets_num'>\n\t\t\t\t<span class='webix_rpt_bucket_sublabel'>"+this._("buckets")+": </span>\n\t\t\t\t\t"+t.options.length+"\n\t\t\t\t</span>\n\t\t\t\t<div class='webix_rpt_config_row_name'>\n\t\t\t\t\t<span class='webix_rpt_bucket_sublabel'>"+this._("column")+": </span>\n\t\t\t\t\t"+t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")+"\n\t\t\t\t</div>\n\t\t\t\t<span class='webix_icon rpi-delete webix_rpt_bucket_delete'></span>\n\t\t\t\t"+e.subrow(t,e)+"\n\t\t\n\t\t</div>"},e.prototype.HideAllEditors=function(t){var e=this._ActiveEditor;e&&this.Table.getItem(e)&&this.Table.closeSub(e),this._ActiveEditor=t,t&&this.FocusEditor()},e.prototype.FocusEditor=function(){this.app.callEvent("onAction",["bucket","focus",this._ActiveEditor])},e.prototype.ResetEditor=function(){this._ActiveEditor=null},e.prototype.ToggleSub=function(t){this.Table.getItem(t).$subopen?this.Table.closeSub(t):this.Table.openSub(t)},e.prototype.Update=function(t,e){this._hasFocus=document.activeElement;var i=c(this.BucketState.buckets),n=this.BucketState.buckets.find((function(e){return e.column==t}));n.options=e.options,this.BucketState.buckets=i,this.Table.updateItem(t,{options:n.options})},e}(m),ft=function(t){function e(e,i){var n=t.call(this,e)||this;return n.Master=i,n}return l(e,t),e.prototype.config=function(){var t=this;return{view:"popup",body:{view:"list",width:160,autoheight:!0,css:"webix_rpt_grouppopup",template:function(e){return t.GetPopupTemplate(e)},data:this.Master.config.modifiers,click:function(e){t.Master.setModifier(t.ActiveGroup,e),t.getRoot().hide()}}}},e.prototype.$init=function(){this.ActiveGroup=null},e.prototype.GetPopupTemplate=function(t){var e=t.id==this.Master.getModifier(this.ActiveGroup);return t.value+" <span class='webix_icon wxi-radiobox-"+(e?"marked":"blank")+"'></span>"},e.prototype.Show=function(t,e){this.ActiveGroup=e,this.getRoot().show(t,{x:-10}),this.getRoot().getBody().refresh()},e}(m),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={margin:webix.skin.$active.layoutMargin.form,cols:[{view:"label",label:e("Function"),width:100,css:"webix_rpt_subtitle"},{view:"label",label:e("Column"),css:"webix_rpt_subtitle"},{view:"label",label:e("New column name"),css:"webix_rpt_subtitle"},{width:38}]},n={margin:webix.skin.$active.layoutMargin.form,localId:"summaries",view:"form",type:"clean",css:"webix_rpt_summary_form",elements:[]};return{borderless:!0,type:"clean",rows:[{cols:[{view:"label",label:e("Group summaries")}]},i,n,{height:webix.skin.$active.layoutMargin.form},{view:"button",icon:"wxi-plus",type:"icon",label:e("Add column"),width:210,align:"left",click:function(){return t.AddNewAggregation()}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.GroupState=this.getParam("group",!0),this.SummaryColumns=this.State.fields.filter((function(t){return("number"==t.type||"date"==t.type)&&!t.key})).sort((function(t,e){return t.type<e.type?1:-1})).map((function(t){return{id:t.id,value:t.name,type:t.type}})),this.CreateForm(),this.on(this.GroupState.$changes,"by",(function(){return t.ValidateFormData()}))},e.prototype.CreateForm=function(){var t=this.GroupState.columns;t&&t.length?this.LoadAggregations(t):this.AddNewAggregation(),this.SummaryColumns.length||this.ApplyOneRowMode()},e.prototype.ApplyOneRowMode=function(){var t=this.getRoot().getChildViews();t[3].hide(),t[4].hide()},e.prototype.AddNewAggregation=function(){this.AddAggregation(),this.Changed()},e.prototype.LoadAggregations=function(t){var e=this;t.forEach((function(t){e.AddAggregation(t)})),this.Changed()},e.prototype.AddAggregation=function(t){if(!(t=t||this.GetDefaultFormData()))return!1;var e=t.id||"form"+webix.uid();this.$$("summaries").addView(this.GetRowForm(e,t))},e.prototype.GetRowForm=function(t,e){var i=this,n=[{width:100,view:"richselect",name:"op",value:e.op||null,options:this.GetOperations(),on:{onChange:function(e){return i.Changed(t,"op",e)}}},{view:"richselect",name:"id",disabled:"count"==e.op,value:e.id||null,options:this.SummaryColumns,on:{onChange:function(e){return i.Changed(t,"id",e)}}},{view:"text",value:e.name||null,name:"name",on:{onTimedKeypress:function(e){return i.Changed(t,"name",e)}}}];return n.push({view:"icon",icon:"wxi-dots",click:function(t,e){return i.ShowPopup(t,e)}}),{view:"form",localId:t,type:"clean",borderless:!0,margin:webix.skin.$active.layoutMargin.form,rules:{id:function(t){var e=i.GroupState.by;return!e||e.indexOf(t)<0}},cols:n}},e.prototype.GetDefaultFormData=function(){var t=this.GetData(),e=this.SummaryColumns,i=this.GetOperations();if(!e.length){var n=t.length?null:i.find((function(t){return"count"==t.id}));return n?{op:"count",id:"",name:this.NewColumnTemplate(n),type:"number"}:null}for(var r=0;r<i.length;r++)for(var a=function(n){var a=i[r];if(!t.find((function(t){return t.op==a.id&&("count"==a.id||t.id==e[n].id)})))return{value:{op:a.id,id:"count"!=a.id?e[n].id:null,name:o.NewColumnTemplate(a,e[n]),type:e[n].type}}},o=this,s=0;s<e.length;s++){var l=a(s);if("object"==typeof l)return l.value}return null},e.prototype.NewColumnTemplate=function(t,e){return"count"==t.id?t.value:t.value+" "+e.value},e.prototype.ShowPopup=function(t,e){this.Popup&&this.Popup.$view||(this.Popup=this.ui(new ct(this.app,"summary")));var i=webix.$$(t).getParentView();this.ActiveForm=i,this.Popup.Show(e.target,this.GetData(),i.getParentView().index(i))},e.prototype.ApplyAction=function(t){"delete"==t&&this.DeleteAggregation()},e.prototype.DeleteAggregation=function(t){var e=(t=t||this.ActiveForm).getParentView();e.getChildViews().length>1?e.removeView(t):t.setValues({}),this.Changed()},e.prototype.GetOperations=function(){var t=this.app.getService("locale")._;return[{id:"sum",value:t("Sum")},{id:"count",value:t("Count")},{id:"avg",value:t("Average")},{id:"max",value:t("Max")},{id:"min",value:t("Min")}]},e.prototype.GetData=function(){var t=[];return this.ForEachFormRow((function(e){t.push(e.getValues())})),t},e.prototype.ForEachFormRow=function(t){this.$$("summaries").getChildViews().forEach((function(e){e&&e.elements&&t(e)}))},e.prototype.ValidateFormData=function(){var t=!0;return this.ForEachFormRow((function(e){return t=e.validate()&&t})),t},e.prototype.ChangeNewColumnName=function(t){var e=this.$$(t).elements,i=e.op.getValue(),n=e.id.getValue(),r=this.GetOperations();i&&("count"==i?e.name.setValue(this.NewColumnTemplate(r.find((function(t){return t.id==i})))):n&&e.name.setValue(this.NewColumnTemplate(r.find((function(t){return t.id==i})),this.SummaryColumns.find((function(t){return t.id==n})))))},e.prototype.Changed=function(t,e,i){var n=this;"op"!=e&&"id"!=e||this.ChangeNewColumnName(t),"op"==e&&"count"==i?(this.$$(t).elements.id.setValue(null),this.$$(t).elements.id.disable()):t&&e&&this.$$(t).elements.id.enable(),this.ValidateFormData();var r=this.GetData();r.forEach((function(t){return t.type=(n.SummaryColumns.find((function(e){return e.id==t.id}))||{type:"number"}).type})),this.GroupState.columns=r},e}(m),vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e={margin:5,rows:[{autoheight:!0,borderless:!0,template:(0,this.app.getService("locale")._)("Specify columns to group by and output(s)"),css:"webix_rpt_description"},{view:"groupselect",localId:"groupBy",modifiers:this.GetDateOptions(),options:[],on:{onChange:function(){return t.ChangeGroupBy()},onModifierClick:function(e,i,n){return t.ShowModifierPopup(e,i,n)}}}]};return{view:"form",borderless:!0,padding:0,elements:[{localId:"groupByLayout",margin:webix.skin.$active.layoutMargin.form,rows:[e,gt]}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0);var e=this.State.group||{};this.GroupState=K({by:e.by||null,columns:e.columns||null}),this.LoadColumns(),this.setParam("group",this.GroupState),this.on(this.GroupState.$changes,"*",Y((function(){return t.Apply()})))},e.prototype.ChangeGroupBy=function(){var t=this.$$("groupBy"),e=t.getPopup().getList(),i=t.getValue();i=i?"string"==typeof i?i.split(","):i:[],this.GroupState.by=i.map((function(i){var n=t.getModifier(i);"date"!==e.getItem(i).type||n||(n="year",t.setModifier(i,n,!0));var r={id:i};return n&&(r.mod=n),r}))},e.prototype.FilterGroupByColumns=function(t){return"id"!=t.id},e.prototype.LoadColumns=function(){var t=this,e=this.State.fields.map((function(t){return{id:t.id,value:t.name,type:t.type,model:t.model}})),i=this.$$("groupBy").getPopup().getList();i.type.template=function(e){return t.ListTemplate(e)},i.parse(e),this.$$("groupBy").setValue(this.GroupState.by)},e.prototype.ListTemplate=function(t){return t.value+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e.prototype.ShowModifierPopup=function(t,e,i){var n=this;this.DatePopup||(this.DatePopup=this.ui(new ft(this.app,this.$$("groupBy")))),webix.delay((function(){return n.DatePopup.Show(i,t)}))},e.prototype.GetDateOptions=function(){var t=this.app.getService("locale")._;return[{id:"day",value:t("Day")},{id:"month",value:t("Month")},{id:"year",value:t("Year")},{id:"yearmonth",value:t("Year")+"/"+t("Month")},{id:"yearmonthday",value:t("Year")+"/"+t("Month")+"/"+t("Day")}]},e.prototype.Apply=function(){var t=this.GroupState;this.State.group={by:t.by||null,columns:t.columns||[]}},e}(m),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"scrollview",body:{type:"form",rows:[{cols:[{view:"switch",localId:"groupBySwitch",css:"webix_rpt_title",width:65,on:{onChange:function(e){return t.ToggleGroupBy(e)}}},{view:"label",label:e("Group")}]},{$subview:"_hidden",name:"group"},{cols:[{view:"switch",localId:"bucketsSwitch",css:"webix_rpt_title",width:65,on:{onChange:function(e){return t.ToggleBuckets(e)}}},{view:"label",label:e("Data buckets")}]},{$subview:"_hidden",name:"buckets"},{cols:[{view:"switch",localId:"sortBySwitch",css:"webix_rpt_title",width:65,on:{onChange:function(e){return t.ToggleSortBy(e)}}},{view:"label",label:e("Sort")}]},{$subview:"_hidden",name:"sort"},{gravity:1e-6}]}}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.$$("groupBySwitch").setValue(!!this.State.group),this.$$("sortBySwitch").setValue(!!this.State.sort),this.$$("bucketsSwitch").setValue(!!this.State.buckets)},e.prototype.ToggleGroupBy=function(t){t?this.show("./editor.other.groups",{target:"group"}):(this.State.group=null,this.show("_hidden",{target:"group"}))},e.prototype.ToggleSortBy=function(t){t?this.show("./editor.other.sorts",{target:"sort"}):(this.State.sort=null,this.show("_hidden",{target:"sort"}))},e.prototype.ToggleBuckets=function(t){t?this.show("./editor.other.buckets",{target:"buckets"}):(this.State.buckets=null,this.show("_hidden",{target:"buckets"}))},e}(m),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this;return{rows:[{view:"label",label:(0,this.app.getService("locale")._)("Specify columns to sort by"),css:"webix_rpt_subtitle"},{view:"groupselect",localId:"sortBy",selectIcon:!1,css:"webix_rpt_sort_selector",modifiers:[{id:"asc",value:"<span class='webix_icon rpi-sort-alphabetical-ascending'></span>"},{id:"desc",value:"<span class='webix_icon rpi-sort-alphabetical-descending'></span>"}],options:[],on:{onChange:function(){return t.ChangeSortBy()},onModifierClick:function(e){return t.ChangeDirection(e)}}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.on(this.State.$changes,"publicFields",(function(e){e&&t.LoadColumns()})),this.on(this.State.$changes,"fields",(function(){t.State.publicFields||t.LoadColumns()}))},e.prototype.LoadColumns=function(){var t=this,e=(this.State.publicFields||this.State.fields).map((function(t){return{id:t.id,value:t.name,type:t.type,model:t.model}})),i=this.$$("sortBy"),n=i.getPopup().getList();n.type.template=function(e){return t.ListTemplate(e)},n.clearAll(),n.parse(e);var r=this.State.sort;r&&(r=r.filter((function(t){return!!e.find((function(e){return e.id==t.id}))}))),i.setValue(r)},e.prototype.ListTemplate=function(t){return t.value+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e.prototype.ChangeSortBy=function(){var t=this.$$("sortBy"),e=t.getValue(),i=(e=e?"string"==typeof e?e.split(","):e:[]).map((function(e){var i=t.getModifier(e);i||(i="asc",t.setModifier(e,i,!0));var n={id:e};return i&&(n.mod=i),n}));this.State.sort=i.length?i:null},e.prototype.ChangeDirection=function(t){var e=this.$$("sortBy");e.setModifier(t,"asc"===e.getModifier(t)?"desc":"asc")},e}(m),_t=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.Axis=i,r.ChartState=n,r}return l(e,t),e.prototype.config=function(){var t=this.app.getService("locale")._;return this.Charts=this.app.getService("charts"),{view:"form",borderless:!0,elementsConfig:{labelAlign:"right",labelWidth:190},visibleBatch:"default",rows:[{label:t("Logarithmic scale"),view:"checkbox",name:"logarithmic",hidden:!0},{label:t("Title"),view:"text",name:"title"},{label:t("Color"),view:"colorpicker",name:"color",css:"webix_rpt_colorpicker",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{cols:[{labelWidth:190,label:t("Gridlines"),view:"checkbox",name:"lines"},{view:"colorpicker",name:"lineColor",width:150,css:"webix_rpt_colorpicker",suggest:{padding:0,type:"colorselect",body:{button:!0}}}]},{label:t("Vertical labels"),view:"checkbox",name:"verticalLabels",hidden:!0}]}},e.prototype.init=function(){var t=this;this.on(this.Axis.$changes,"id",(function(e){"y"==e?t.ApplyYAxis():t.ApplyXAxis()})),this.on(this.Axis.$changes,"lines",(function(e){var i=t.getRoot().elements.lineColor;e?i.show():i.hide()})),tt(this.Axis,"*",this.getRoot())},e.prototype.ApplyYAxis=function(){this.getRoot().elements.logarithmic.show()},e.prototype.ApplyXAxis=function(){this.getRoot().elements.verticalLabels.show()},e}(m),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.HideField=function(t){this.$$("fields").updateItem(t,{show:!1}),this.SaveOrder()},e.prototype.ShowField=function(t){this.$$("fields").updateItem(t,{show:!0}),this.SaveOrder()},e.prototype.HideAllEditors=function(t,e){var i=this;e||(e="fields"),this._ActiveEditor[e]&&this.$$(e).closeSub(this._ActiveEditor[e]),this._ActiveEditor[e]=t,t&&webix.delay((function(){var n=i.$$(e).getSubView(t);n&&n.focus()}),null,null,100)},e.prototype.ResetEditor=function(t){this._ActiveEditor[t||"fields"]=null},e.prototype.ToggleSub=function(t,e){var i=this.$$(e||"fields");i.getItem(t).$subopen?i.closeSub(t):i.openSub(t)},e.prototype.SaveOrder=function(){},e}(m),bt=function(t){function e(e,i){var n=t.call(this,e)||this;return n.State=i,n.Id=null,n}return l(e,t),e.prototype.config=function(){var t=this;return{view:"popup",body:{view:"colorselect",button:!0,on:{onColorSelect:function(e){var i=t.GetSeries(t.Id);i&&(i.meta.color=e),t.State.updatedSeries=t.Id,t.getRoot().close()}}}}},e.prototype.Show=function(t,e){var i=this.getRoot();this.Id=e,i.show(t),i.getBody().setValue(this.GetSeries(e).meta.color)},e.prototype.GetSeries=function(t){return this.State.series.find((function(e){return e.id==t}))},e}(m);webix.protoUI({name:"text-search",$cssName:"search",defaults:{closeIcon:"wxi-close",template:function(t,e){var i=e.$renderInput(t);return(t.badge||0===t.badge)&&(i=i.replace(new RegExp("</div>$"),"<span class='webix_badge'>"+t.badge+"</span></div>")),i}},on_click:{webix_input_icon:function(t){var e=t.target.className;this.getInputNode().focus(),e.indexOf(this.config.closeIcon)>-1?(this.setValue(""),this.callEvent("onCloseIconClick",[t]),this.hideCloseIcon()):this.callEvent("onSearchIconClick",[t])}},$init:function(){var t=this;this.attachEvent("onTimedKeyPress",(function(){return t._onSearch()})),this.attachEvent("onChange",(function(){return t._onSearch()}))},_onSearch:function(){var t=this.getValue();t?this.showCloseIcon():this.hideCloseIcon(),this.callEvent("onSearchChange",[t])},setIcon:function(t){var e=this.$view.getElementsByClassName("webix_input_icon");e.length&&(e[0].className="webix_input_icon "+t)},showCloseIcon:function(){this.setIcon(this.config.closeIcon)},hideCloseIcon:function(){this.setIcon(this.config.icon)},setBadge:function(t){var e=this.$view.querySelector(".webix_badge");t||0===t?e?e.innerHTML=""+t:(e=webix.html.create("SPAN",{class:"webix_badge"},""+t),this.$view.querySelector(".webix_el_box").appendChild(e)):e&&webix.html.remove(e),this.config.badge=t}},webix.ui.search);var xt=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.Series=i,r.ChartState=n,r}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return this.Charts=this.app.getService("charts"),{view:"form",borderless:!0,elementsConfig:{labelWidth:170},visibleBatch:"default",rows:[{labelAlign:"right",label:e("Title"),view:"text",name:"name"},{labelAlign:"right",label:e("Color"),view:"colorpicker",name:"color",css:"webix_rpt_colorpicker",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{labelAlign:"right",label:e("Marker type"),view:"richselect",css:"webix_rpt_markerselect",name:"markerType",options:{padding:0,body:{css:"webix_rpt_markerselect_list",template:function(e){return t.ItemListTemplate(e)},data:this.Charts.getItemTypes()}},batch:"marker"},{labelAlign:"right",label:e("Fill marker"),view:"checkbox",name:"fillMarker",batch:"marker"}]}},e.prototype.init=function(){var t=this;tt(this.Series,"*",this.getRoot()),this.Charts.itemSupport.indexOf(this.ChartState.chartType)>-1&&this.getRoot().showBatch("marker"),this.on(this.Series.$changes,"color",(function(){var e=t.getRoot().elements.markerType;e.refresh(),e.getList().refresh()}))},e.prototype.ItemListTemplate=function(t){return'<div class="webix_rpt_config_row">'+t.value+" <span class='webix_icon "+t.icon+"' style='color:"+this.Series.color+"'></span></div>"},e}(m),St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this.Charts=this.app.getService("charts"),this.Local=this.app.getService("local"),this._ActiveEditor={};var i={rows:[{view:"label",label:this._("Chart type")},{view:"richselect",localId:"type",options:this.Charts.getTypes(),on:{onChange:function(e){return t.ChartState.chartType=e}}}]},n={rows:[{view:"label",label:e("X axis column")},{view:"richselect",localId:"labelColumn",options:[],on:{onChange:function(e){return t.ChangeLabelField(e)}}}]},r={view:"datatable",css:"webix_rpt_columns_list",localId:"fields",borderless:!0,autoheight:!0,header:!1,select:!1,editable:!0,subview:function(e,i){t.SubState||(t.SubState={});var n=t.SubState[e.id]=K({name:e.meta.name,color:e.meta.color,type:e.meta.type||null,markerType:e.meta.markerType||null,fillMarker:e.meta.fillMarker||null});t.on(n.$changes,"*",Y((function(){t.UpdateSeries(e.id,n)})));var r=new xt(t.app,n,t.ChartState);return t.ui(r,{container:i}),r.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.RowTemplate(e,i)}}],drag:"order",on:{onItemDblClick:function(t){this.openSub(t)},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onAfterDrop:function(){return t.SaveOrder()},onSubViewOpen:function(e){return t.HideAllEditors(e)},"data->onClearAll":function(){return t.ResetEditor()},onSubViewClose:function(){return t.ResetEditor()}},onClick:{webix_rpt_chart_color:function(e,i){return t.ShowColorPopup(e,i)},"action-visible":function(e,i){return t.HideField(i)},"action-hidden":function(e,i){return t.ShowField(i)},webix_rpt_config_row_name:function(e,i){return t.ToggleSub(i)}}},a={rows:[{view:"label",label:e("Axes")},{view:"datatable",css:"webix_rpt_columns_list",localId:"axisFields",borderless:!0,autoheight:!0,header:!1,select:!1,subview:function(e,i){var n=K(u({id:e.id},e.meta));t.on(n.$changes,"*",Y((function(){t.UpdateAxis(e.id,n)})));var r=new _t(t.app,n,t.ChartState);return t.ui(r,{container:i}),r.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.AxisRowTemplate(e,i)}}],on:{onItemClick:function(e){return t.ToggleSub(e,"axisFields")},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onSubViewOpen:function(e){return t.HideAllEditors(e,"axisFields")},onSubViewClose:function(){return t.ResetEditor("axisFields")}}}]},o={rows:[{view:"label",label:e("Legend")},{view:"radio",localId:"legendPosition",options:[{id:"bottom",value:e("Bottom")},{id:"right",value:e("Right")},{id:"none",value:e("None")}],on:{onChange:function(e){return t.ChangeLegend(e)}}}]};return{view:"form",scroll:"auto",css:"webix_rpt_chart_config",padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[i,n,{localId:"dataInputs",rows:this.GetDataInputs()},r,a,o,{}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Types=this.Charts.getTypes();var e=[];(this.State.publicFields||this.State.fields).forEach((function(t){e.push(u({},t))})),this.Fields=e.filter((function(t){return!t.key})).sort((function(t,e){return t.type<e.type?1:-1})).map((function(t){return{id:t.id,value:t.name,type:t.type}})),this.ValueFields=e.filter((function(t){return"number"==t.type&&!t.key})).map((function(t){return{id:t.id,value:t.name,type:t.type,model:t.model}})),this.ChartState=K(this.GetInitState()),this.on(this.ChartState.$changes,"*",(function(){t.UpdateModuleState()})),this.on(this.ChartState.$changes,"chartType",(function(e,i){t.ApplyChartType(e,i)})),this.on(this.ChartState.$changes,"seriesFrom",(function(e,i){t.ApplySeriesFrom(e,i)})),this.on(this.ChartState.$changes,"baseColumn",Y((function(){t.GenerateSeries()}))),this.on(this.ChartState.$changes,"dataColumn",Y((function(){t.GenerateSeries()}))),this.on(this.ChartState.$changes,"updatedSeries",(function(e){e&&(t.$$("fields").refresh(e),t.SubState&&t.SubState[e]&&(t.SubState[e].color=t.ChartState.series.find((function(t){return t.id==e})).meta.color),t.ChartState.updatedSeries=null)})),this.$$("type").setValue(this.ChartState.chartType),this.$$("labelColumn").getList().parse(this.Fields),this.$$("labelColumn").setValue(this.ChartState.labelColumn),this.$$("seriesFrom").setValue(this.ChartState.seriesFrom),this.$$("baseColumn").getList().parse(this.Fields),this.$$("baseColumn").setValue(this.ChartState.baseColumn),this.$$("dataColumn").getList().parse(this.ValueFields),this.$$("dataColumn").setValue(this.ChartState.dataColumn),this.$$("legendPosition").setValue(this.ChartState.legendPosition)},e.prototype.ChangeLabelField=function(t){this.ChartState.labelColumn=t},e.prototype.ChangeLegend=function(t){this.ChartState.legendPosition=t},e.prototype.GetInitState=function(){var t=this.State.meta.chart||{};return{chartType:t.chartType||this.Charts.type,labelColumn:t.labelColumn||null,updatedSeries:null,seriesFrom:t.seriesFrom||"columns",baseColumn:t.baseColumn||null,dataColumn:t.dataColumn||null,series:t.series||null,legend:t.legend||{layout:"x"},axises:t.axises||null,legendPosition:t.legendPosition||"bottom"}},e.prototype.ApplyChartType=function(t,e){this.ShowAxisInputs(t),this.RenderSeries(e)},e.prototype.RenderSeries=function(t){var e=this.ChartState.series;e&&void 0===t?this.LoadSeries(e):this.GenerateSeries()},e.prototype.ShowAxisInputs=function(t){this.Charts.noAxisSupport.indexOf(t)?(this.ChartState.axises||(this.ChartState.axises={x:{title:"",color:"#edeff0",lineColor:"#edeff0",lines:!0,verticalLabels:!0},y:{title:"",color:"#edeff0",lineColor:"#edeff0",lines:!0,logarithmic:!1}}),this.$$("axisFields").data.count()||this.$$("axisFields").parse([{id:"x",meta:u({},this.ChartState.axises.x)},{id:"y",meta:u({},this.ChartState.axises.y)}])):(this.ChartState.axises=null,this.$$("axisFields").clearAll())},e.prototype.GetDataInputs=function(){var t=this;return[{rows:[{view:"label",label:this._("Data series")},{cols:[{rows:[{view:"label",label:this._("Extract series from"),css:"webix_rpt_subtitle"},{view:"radio",width:200,localId:"seriesFrom",options:[{id:"columns",value:this._("columns")},{id:"rows",value:this._("rows")}],on:{onChange:function(e){return t.ChartState.seriesFrom=e}}}]},{hidden:!0,localId:"baseColumnLayout",margin:webix.skin.$active.layoutMargin.form,cols:[{rows:[{view:"label",label:this._("Keys column"),css:"webix_rpt_subtitle"},{view:"richselect",css:"webix_rpt_subtitle",localId:"baseColumn",options:[],labelPosition:"top",on:{onChange:function(e){return t.ChartState.baseColumn=e}}}]},{rows:[{view:"label",label:this._("Values column"),css:"webix_rpt_subtitle"},{view:"richselect",css:"webix_rpdataColumnt_subtitle",localId:"dataColumn",options:[],on:{onChange:function(e){return t.ChartState.dataColumn=e}}}]}]}]}]}]},e.prototype.ApplySeriesKeys=function(t){var e=this.Charts.getSeries(t,this.ChartState.type);this.ChartState.series=e,this.LoadSeries(e)},e.prototype.LoadSeries=function(t){t.length?this.$$("fields").show():this.$$("fields").hide(),this.$$("fields").clearAll(),this.$$("fields").parse(t)},e.prototype.GetRowKeys=function(t){if(t&&this.State.columns.length){var e=[];return this.GetData(t).then((function(i){var n=i[0],r=i[1];return n.forEach((function(i){var n=i[t];-1==e.indexOf(n)&&e.push(n)})),r?e.map((function(t){var e=r.data.find((function(e){return e.id==t}))||null;return{id:t,value:e?e.value:t}})):e.map((function(t){return{id:t,value:t}}))}))}return Promise.resolve([])},e.prototype.GenerateSeries=function(){var t=this;if("columns"==this.ChartState.seriesFrom)this.ApplySeriesKeys(c(this.ValueFields),null);else{this.ChartState.dataColumn=this.$$("dataColumn").getValue();var e=this.ChartState.baseColumn=this.$$("baseColumn").getValue();this.GetRowKeys(e).then((function(i){return t.ApplySeriesKeys(i,e)}))}},e.prototype.ApplySeriesFrom=function(t,e){this.$$("baseColumnLayout")&&("columns"==t?(this.$$("baseColumnLayout").hide(),this.$$("baseColumn").setValue(null)):this.$$("baseColumnLayout").show(),e&&this.GenerateSeries())},e.prototype.UpdateSeries=function(t,e){this._hasFocus=document.activeElement;var i=c(this.ChartState.series),n=i.findIndex((function(e){return e.id==t}));Object.assign(i[n].meta,e),this.ChartState.series=i,this.$$("fields").refresh(t)},e.prototype.UpdateAxis=function(t,e){this._hasFocus=document.activeElement;var i=u({},this.ChartState.axises);Object.assign(i[t],e),this.ChartState.axises=i},e.prototype.RowTemplate=function(t,e){var i="<div class='webix_rpt_config_row'><div class='webix_icon rpi-drag-vertical'></div>";return i+="<span class='webix_icon "+(t.show?"action-visible rpi-eye":"action-hidden rpi-eye-off-outline")+"'></span>",i+="<div class='webix_rpt_chart_color' style='background:"+t.meta.color+"'> </div>",i+="<div class='webix_rpt_config_row_name'>"+t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")+"</div>",(i+=e.subrow(t,e))+"</div>"},e.prototype.GetData=function(t){var e=this.app.getParam("state"),i=this.Local.getDataConfig(e.module);i.columns=this.State.columns.map((function(t){return t.id}));var n=[this.Local.getData(i)];return t&&n.push(this.Local.getOptionsList(t)),Promise.all(n)},e.prototype.ShowColorPopup=function(t,e){this.ColorPopup&&this.ColorPopup.$view||(this.ColorPopup=this.ui(new bt(this.app,this.ChartState))),this.ActiveSeries=e,this.ColorPopup.Show(t.target,e)},e.prototype.SaveOrder=function(){var t=this,e=this.$$("fields"),i=[];e.data.each((function(e){e.show&&i.push((t.State.publicFields||t.State.fields).find((function(t){return t.id===e.id})))})),this.ChartState.series=e.serialize()},e.prototype.UpdateModuleState=function(){var t=this,e=this.ChartState,i=[];e.labelColumn&&this.AddColumn(i,e.labelColumn),"columns"==e.seriesFrom?e.series&&e.series.forEach((function(e){e.show&&t.AddColumn(i,e.id)})):(e.baseColumn&&this.AddColumn(i,e.baseColumn),e.dataColumn&&this.AddColumn(i,e.dataColumn)),this.State.$batch({columns:i,meta:u(u({},this.State.meta),{chart:this.ChartState})})},e.prototype.AddColumn=function(t,e){var i=(this.State.publicFields||this.State.fields).find((function(t){return t.id===e}));i&&t.push(i)},e.prototype.AxisRowTemplate=function(t,e){var i="<div class='webix_rpt_config_row'>"+this._("x"==t.id?"X Axis":"Y Axis");return(i+=e.subrow(t,e))+"</div>"},e}(yt),$t=function(t){function e(e,i){var n=t.call(this,e)||this;return n.Column=i,n}return l(e,t),e.prototype.config=function(){var t=this.app.getService("locale")._;return{view:"form",borderless:!0,elementsConfig:{labelWidth:120},rows:[{labelAlign:"right",label:t("Title"),view:"text",name:"name"},{labelAlign:"right",label:t("Filter"),view:"richselect",name:"header",options:[{id:"none",value:t("No filter")},{id:"text",value:t("Text")},{id:"select",value:t("Select")}]}]}},e.prototype.init=function(){tt(this.Column,"*",this.getRoot())},e}(m),Ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this._=this.app.getService("locale")._,e={rows:[{view:"label",label:t("Labels column")},{view:"richselect",name:"label",options:[]}]},i={rows:[{view:"label",label:t("Values column")},{view:"richselect",name:"value",options:[]}]},n={rows:[{view:"label",label:t("Color column")},{view:"richselect",name:"color",options:[]}]};return{view:"form",scroll:!1,padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[i,e,n,{}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Local=this.app.getService("local");var e=this.Fields=(this.State.publicFields||this.State.fields).map((function(t){return u({},t)})),i=e.filter((function(t){return"number"==t.type&&!t.key}));i.length||(i=e.filter((function(t){return"number"==t.type})));var n=this.getRoot().elements,r=n.label;r.getList().parse(e),r.getList().type.template=function(e){return t.ListTemplate(e)},r.setValue(this.State.meta.label||e[0].id);var a=n.value;a.getList().parse(i),a.getList().type.template=function(e){return t.ListTemplate(e)},a.setValue(this.State.meta.value||i[0].id);var o=n.color;o.getList().parse(i),o.getList().type.template=function(e){return t.ListTemplate(e)},o.setValue(this.State.meta.color||i[0].id),this.getRoot().attachEvent("onChange",(function(){return t.OnChange()})),this.State.meta.value||this.OnChange()},e.prototype.OnChange=function(){this.Apply(u(u({},this.State.meta),this.getRoot().getValues()))},e.prototype.Apply=function(t){var e=[t.value,t.label,t.color],i=this.Fields.filter((function(t){return-1!==e.indexOf(t.id)}));this.State.$batch({meta:t,columns:i})},e.prototype.ListTemplate=function(t){return t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e}(yt),kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={view:"richselect",localId:"select",borderless:!0,align:"left",inputWidth:170,options:[{id:"table",value:it.table+" "+e("Table")},{id:"chart",value:it.chart+" "+e("Chart")},{id:"heatmap",value:it.heatmap+" "+e("Heatmap")}],on:{onChange:function(e){return t.ChangeReportType(e)}}},n={width:480,hidden:!1,localId:"settings",type:"clean",rows:[{view:"form",padding:{left:webix.skin.$active.layoutPadding.form,top:5,bottom:0},scroll:!1,cols:[i]},{$subview:!0}]};return this.Local=this.app.getService("local"),n},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.on(this.State.$changes,"type",(function(e){t.show("editor.structure."+e)})),this.$$("select").setValue(this.State.type)},e.prototype.ChangeReportType=function(t){this.State.type!=t&&this.State.$batch({type:t,meta:{}})},e}(m),Dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this._ActiveEditor={};var i={padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[{view:"label",label:e("Columns")},{view:"text-search",localId:"search",on:{onSearchChange:function(){return t.FilterFields()}}}]},n={view:"datatable",css:"webix_rpt_columns_list",localId:"fields",borderless:!0,autoheight:!0,header:!1,select:!1,subview:function(e,i){var n=K({name:e.meta.name||e.name,header:e.meta.header||"none"});t.on(n.$changes,"*",Y((function(){t.Update(e.id,n)})));var r=new $t(t.app,n);return t.ui(r,{container:i}),r.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.RowTemplate(e,i)}}],drag:"order",on:{onItemDblClick:function(t){"$freeze"!==t.row&&this.openSub(t)},onBeforeDrag:function(e){t.HideAllEditors();var i=t.$$("fields");if(webix.html.addCss(i.$view,"webix_rpt_drag"),"$freeze"===e.start)e.html='<div class="webix_drag_zone"><div class="webix_dd_drag wbx-mark_frozen" style="width:'+i.$width+'px;"><div>'+t.FrozenTemplate()+"</div></div></div>";else if(!i.getItem(e.start).show)return!1},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onAfterDrop:function(){webix.html.removeCss(t.$$("fields").$view,"webix_rpt_drag"),t.SaveOrder()},onSubViewOpen:function(e){return t.HideAllEditors(e)},onSubViewClose:function(){return t.ResetEditor()}},onClick:{"action-visible":function(e,i){return t.HideField(i)},"action-hidden":function(e,i){return t.ShowField(i)},webix_rpt_config_row_name:function(e,i){return t.ToggleSub(i)}}};return{view:"form",scroll:"auto",padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[i,n]}},e.prototype.init=function(){this.State=this.getParam("state",!0);var t=this.$$("fields"),e={},i=this.State.columns.map((function(t){return e[t.id]=1,u(u({},t),{show:!0})}));(this.State.publicFields||this.State.fields).forEach((function(t){e[t.id]||i.push(u(u({},t),{show:!1}))})),i.splice(this.State.meta.freeze||0,0,{id:"$freeze",$css:"wbx-mark_frozen",name:this.FrozenTemplate()}),t.parse(i)},e.prototype.FilterFields=function(){var t=this.$$("search").getValue().toLowerCase();this.$$("fields").filter((function(e){return-1!==e.name.toLowerCase().indexOf(t)}))},e.prototype.Update=function(t,e){this._hasFocus=document.activeElement;var i=c(this.State.columns),n=i.findIndex((function(e){return e.id==t}));Object.assign(i[n].meta,e),this.State.$batch({columns:i,meta:u(u({},this.State.meta),{freeze:this.GetFreeze()})})},e.prototype.GetFreeze=function(){for(var t=this.$$("fields"),e=t.data.order,i=0,n=0;n<e.length&&"$freeze"!==e[n];n++)i+=t.getItem(e[n]).show?1:0;return i},e.prototype.SaveOrder=function(){var t=this,e=this.$$("fields"),i=[];e.data.each((function(e){e.show&&i.push((t.State.publicFields||t.State.fields).find((function(t){return t.id===e.id})))})),this.State.$batch({columns:i,meta:u(u({},this.State.meta),{freeze:this.GetFreeze()})})},e.prototype.FrozenTemplate=function(){return"<span class='webix_rpt_frozen webix_icon rpi-arrow-horizontal-lock'></span><span>"+this._("Frozen columns above")+"</span>"},e.prototype.RowTemplate=function(t,e){var i="<div class='webix_rpt_config_row'><div class='webix_icon rpi-drag-vertical'></div>";return i+="$freeze"!==t.id?"<span class='webix_icon "+(t.show?"action-visible rpi-eye":"action-hidden rpi-eye-off-outline")+"'></span>":"",i+="<div class='webix_rpt_config_row_name'>"+t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")+"</div>",(i+="$freeze"!==t.id?e.subrow(t,e):"")+"</div>"},e}(yt),Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this;return{css:"webix_rpt_empty",view:"template",borderless:!0,template:function(e){return t.GetTemplate(e)}}},e.prototype.init=function(){var t=this,e=this.app.getService("local").getModules();e.waitData.then((function(){var i=t.GetText(e.data.count());t.getRoot().setValues({text:i})}))},e.prototype.GetText=function(t){return(0,this.app.getService("locale")._)(t?"Select any report from the list":"Click 'New' button to add a new report")},e.prototype.GetSVG=function(){var t=webix.skin.$name;return nt["willow"==t||"dark"==t?"alt":"main"]},e.prototype.GetTemplate=function(t){return"<div class='webix_rpt_empty_placeholder'>"+(t.text||"")+"</div>"+this.GetSVG()},e}(m),Et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){return{rows:[J,{type:"wide",margin:5,cols:[{}]}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.Local=this.app.getService("local")},e.prototype.ready=function(){var t=this,e=this.getRoot().getChildViews();this.Bar=e[0],this.Host=e[1],this.on(this.State.$changes,"module",(function(e){return t.Show(e)})),this.on(this.app,"exportModule",(function(e){return t.Export(e)}))},e.prototype.Show=function(t){var e=this,i=this.Host;if(t&&t.meta.value&&"heatmap"===t.type){var n=this.GetChartConfig(t);if(!n.view)return;this.Bar.show(),this.GetChartData(t).then((function(r){var a=r[0],o=r[1];n.data=e.FormatLabels(webix.copy(a),o),a.length&&t.meta.color&&(n.type.cssClass=e.CssFactory(a,t.meta.color)),webix.ui([n],i),e.Chart=i.getChildViews()[0]}))}else webix.ui([{template:" "}],i),this.Bar.hide(),this.Chart=null},e.prototype.GetChartConfig=function(t){var e=t.meta,i=t.columns,n={view:"treemap",css:"webix_rpt",value:function(t){return t[e.value]},tooltip:this.TooltipFactory(e,i),type:{}};return e.label&&(n.type.template=function(t){return t[e.label]}),n},e.prototype.GetChartData=function(t){return Promise.all([this.Local.getData(this.Local.getDataConfig(t),"edit"==this.State.mode),this.Local.getOptions(t.columns)])},e.prototype.CssFactory=function(t,e){for(var i=1/0,n=-1/0,r=0;r<t.length;r++){var a=t[r][e];a>n&&(n=1*a),a<i&&(i=1*a)}var o=(n-i)/4,s=[n-o,n-2*o,n-3*o,i];return function(t){for(var i=t[e],n=0;n<s.length;n++)if(i>=s[n])return"l"+n}},e.prototype.TooltipFactory=function(t,e){var i=e.find((function(e){return e.id===t.value})),n=e.find((function(e){return e.id===t.color}));if(!i||!n)return"";var r=[t.value,i.name];return t.color&&t.color!=t.value&&r.push(t.color,n.name),function(t){for(var e="",i=0;i<r.length;i+=2)e+=(i?", ":"")+r[i+1]+": "+t[r[i]];return e}},e.prototype.Export=function(t){this.Chart&&("png"==t?webix.toPNG(this.Chart):"pdf"==t&&webix.toPDF(this.Chart,{autowidth:!0,display:"image"}))},e.prototype.FormatLabels=function(t,e){var i=this.State.module.meta.label,n=i&&e.length?e.find((function(t){return t.field==i})):null;if(n)t.forEach((function(t){var e=n.data.find((function(e){return e.id==t[i]}));t[i]=e?e.value:t[i]}));else{var r=this.State.module.fields.find((function(t){return t.id==i}));r&&"date"==r.type&&t.forEach((function(t){t[i]=webix.i18n.dateFormatStr(new Date(t[i]))}))}return t},e}(m),Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",padding:0,point:!1,body:{view:"list",borderless:!0,css:"webix_rpt_popup_menu",template:function(t){return"<span class='webix_icon "+t.icon+"'></span>"+t.value},width:160,autoheight:!0,data:[{value:e("Edit"),id:"edit",icon:"rpi-square-edit-outline"},{value:e("Create copy"),id:"copy",icon:"rpi-content-copy"},{value:e("Delete"),id:"delete",icon:"rpi-delete"}],on:{onItemClick:function(e){t.app.callEvent("onMenuAction",[t.ID,e]),t.getRoot().hide()}}}}},e.prototype.init=function(){},e.prototype.Show=function(t,e){var i=this;this.ID=e,webix.delay((function(){i.getRoot()&&i.getRoot().show(t)}))},e}(m),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return{width:320,type:"clean",rows:[{view:"form",height:webix.skin.$active.barHeight+6,padding:{left:10,right:10,top:5,bottom:5},margin:0,localId:"bar",cols:[{view:"label",label:e("Reports")},{},{view:"icon",localId:"nameSorting",icon:"rpi-sort-alphabetical-ascending",css:"webix_rpt_sort_icon webix_rpt_btn_active",icons:{asc:"rpi-sort-alphabetical-ascending",desc:"rpi-sort-alphabetical-descending"},click:function(){return t.Sort("name")}},{width:4},{view:"icon",localId:"updatedSorting",css:"webix_rpt_sort_icon",icon:"rpi-sort-calendar-descending",icons:{asc:"rpi-sort-calendar-ascending",desc:"rpi-sort-calendar-descending"},click:function(){return t.Sort("updated")}}]},{type:"clean",rows:[{view:"form",padding:{left:10,right:10,top:2,bottom:4},cols:[{view:"text-search",localId:"search",placeholder:e("Type to search")}]},{view:"list",localId:"list",scroll:!0,select:!0,css:"webix_rpt_list",type:{height:webix.skin.$active.rowHeight+24,template:function(e){return t.GetListTemplate(e)}},scheme:{$change:function(t){t.date&&"string"==typeof t.date&&(t.date=new Date(t.date))}},onClick:{webix_rpt_action_menu:function(e,i){return t.Menu.Show(e,i),!1}},onDblClick:{},on:{onAfterSelect:function(e){return t.LoadModule(e,null)},onItemDblClick:function(e){return t.LoadModule(e,"edit")}}}]}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Menu=this.ui(Lt);var e=this.$$("list");e.$view.firstChild.setAttribute("placeholder",this._("No reports"));var i=this.app.getService("local").getModules();e.sync(i),i.waitData.then((function(){t.State.moduleId&&e.select(t.State.moduleId)})),this.on(this.State.$changes,"readonly",(function(){return t.$$("list").refresh()})),this.$$("search").attachEvent("onSearchChange",(function(e){return t.Find(e)})),this.Sorting={by:"name",dir:"asc"}},e.prototype.LoadModule=function(t,e){this.app.callEvent("loadModule",[t,e])},e.prototype.Hide=function(){this.app.callEvent("hideModuleList")},e.prototype.Find=function(){var t=this,e=this.$$("search").getValue(),i=this.$$("list");e?(e=e.toLowerCase(),i.filter((function(i){return t.SearchCompare(e,i)}))):i.filter()},e.prototype.SearchCompare=function(t,e){return e.name.toLowerCase().indexOf(t)>-1},e.prototype.GetListTemplate=function(t){var e=this.app.getService("locale")._,i="<div class='webix_rpt_list_block'>";return i+="<div class='webix_rpt_list_report_name'>"+it[t.parsed.type]+" "+t.name+"</div>",i+="<div class='webix_rpt_list_report_date'>"+e("Last modified")+": "+webix.i18n.longDateFormatStr(t.updated||new Date)+"</div>",this.State.readonly||(i+="<span class='webix_icon webix_rpt_action_menu rpi-dots-vertical'></span>"),i+"</div>"},e.prototype.Sort=function(t){var e=this.Sorting,i=webix.copy(e);e.by==t?e.dir="desc"==e.dir?"asc":"desc":(e.by=t,e.dir="desc"),e.as="updated"==t?"date":"string",this.ChangeSortButtons(e,i),this.$$("list").sort(e)},e.prototype.ChangeSortButtons=function(t,e){var i=this.$$(t.by+"Sorting");if(this.webix.html.addCss(i.$view,"webix_rpt_btn_active"),i.config.icon=i.config.icons[t.dir],i.refresh(),t.by!=e.by){var n=this.$$(e.by+"Sorting");this.webix.html.removeCss(n.$view,"webix_rpt_btn_active")}},e}(m),It=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.GetData=function(){var t=this.app.getService("locale")._;return[{value:t("To Excel"),id:"excel"},{value:t("To CSV"),id:"csv"}]},e}(Q),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"form",localId:"toolbar",height:webix.skin.$active.barHeight+6,hidden:!0,padding:{left:10,right:10,top:6,bottom:6},margin:10,cols:[{view:"button",type:"icon",width:140,label:e("Export"),icon:"rpi-export",click:function(e){return t.ShowExportPopup(e)}},{},{view:"text-search",localId:"search",placeholder:e("Type to search"),maxWidth:600,minWidth:200}]}},e.prototype.ready=function(){var t=this;this.State=this.getParam("state",!0),this.$$("search").attachEvent("onSearchChange",(function(e){return t.State.search=e})),this.on(this.app,"onRecordsSearch",(function(e,i){e?t.$$("search").setBadge(i.length):t.$$("search").setBadge(null)}))},e.prototype.ShowExportPopup=function(t){this.ExportMenu&&this.ExportMenu.$view||(this.ExportMenu=this.ui(It));var e=webix.$$(t);this.ExportMenu.Show(e.$view)},e}(m),Rt={number:"int",date:"date",text:"string",boolean:"number",picklist:"text",reference:"text"},Mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){return{rows:[Pt,{type:"wide",margin:5,cols:[{}]}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.LocalState=K({search:""}),this.setParam("state",this.LocalState),this.Local=this.app.getService("local")},e.prototype.ready=function(){var t=this,e=this.getRoot().getChildViews();this.Bar=e[0],this.Host=e[1],this.on(this.State.$changes,"module",(function(e){return t.Show(e)})),this.on(this.app,"exportModule",(function(e){return t.Export(e)})),this.on(this.LocalState.$changes,"search",(function(e){return t.Find(e)}))},e.prototype.Export=function(t){var e={ignore:{$selection:!0},plainOutput:!0,filterHTML:!0};this.Table&&("excel"==t?webix.toExcel(this.Table,e):"csv"==t&&webix.toCSV(this.Table,e))},e.prototype.Show=function(t){var e=this,i=this.Host;if(t&&t.columns.length&&"table"===t.type){var n=this.GetTableConfig(t);if(!n)return;this.Bar.show(),webix.ui([n],i);var r=this.Table=i.getChildViews()[0];this.GetTableData(t).then((function(t){var i=t[0],n=t[1];r.$destructed||(n.forEach((function(t){var i=t.field,n=t.data;e.IsBucketColumn(i)||r.getColumnConfig(i).collection.parse(n)})),r.parse(i))}))}else webix.ui([{}],i),this.Table=null,this.Bar.hide()},e.prototype.IsBucketColumn=function(t,e){return(e=e||this.State.module).buckets&&e.buckets.find((function(e){return e.column==t}))},e.prototype.GetTableConfig=function(t){var e=this,i=t.groups,n=t.columns,r=t.meta;if(!n)return null;var a=[],o=n.map((function(t){return"date"==t.type&&a.push(t.id),e.GetColumnConfig(t)})),s="edit"===this.State.mode,l={view:i?"treetable":"datatable",columns:o,resizeColumn:!!s&&{headerOnly:!0},leftSplit:r.freeze?r.freeze:0,css:s?"webix_header_border":"",on:{onColumnResize:function(t,i,n,r){return e.SetColWidth(t,i,n,r)}}};return a.length&&(l.scheme={$change:function(t){return a.forEach((function(e){return t[e]=new Date(t[e])}))}}),l},e.prototype.GetColumnConfig=function(t){var e={id:t.id,header:t.meta.header&&"none"!==t.meta.header?[t.meta.name||t.name,{content:"text"===t.meta.header?"textFilter":"richSelectFilter"}]:t.meta.name||t.name,type:t.type,sort:Rt[t.type],width:t.width||200};if("date"===t.type&&(e.format=webix.i18n.dateFormatStr),"boolean"===t.type){var i=this.app.getService("locale")._;e.template=function(e){return 1==e[t.id]?i("True"):i("False")}}return"reference"!==t.type&&"picklist"!==t.type||this.IsBucketColumn(t.id)||(e.options=[]),e},e.prototype.SetColWidth=function(t,e,i,n){if(n){if("$selection"===t||"$subrow"===t){var r=this.Tbl;return r.blockEvent(),r.setColumnWidth(t,i),void r.unblockEvent()}this.app.callEvent("onColumnResize",[t,e])}},e.prototype.GetTableData=function(t){return Promise.all([this.Local.getData(this.Local.getDataConfig(t),"edit"==this.State.mode),this.Local.getOptions(t.columns)])},e.prototype.Find=function(t){var e=this.app.getService("helpers"),i=this.Table,n=[];if(i){if(i.clearCss("webix_rpt_found_record",!0),t){for(var r=e.hasNonDigits(t),a=new RegExp(e.wildToRegexp(t),"gi"),o=i.config.columns.filter((function(t){return!("$selection"===t.id||"$subrow"===t.id||r&&("number"===t.type||"date"===t.type))})),s=[],l=function(n){var r=o[n].type||"text",l=o[n].id;if("text"===r||"number"===r)s.push((function(t){return a.test(t[l])}));else if("reference"===r||"picklist"===r){var u=i.getColumnConfig(l).collection,c=e.findOptions(u,a);s.push(e.matchPerColumn(l,(function(t){return c[t]})))}else if("bool"===r)switch(t){case"true":s.push((function(t){return t[l]}));break;case"false":s.push((function(t){return!t[l]}))}else if("date"===r){var h=i.getColumnConfig(l).format;s.push((function(t){return a.test(h(t[l]))}))}},u=0;u<o.length;++u)l(u);var c=!1;n=i.find((function(t){for(var e=0;e<s.length;++e)if(s[e](t))return c||(c=!0,i.showItem(t.id)),i.addCss(t.id,"webix_rpt_found_record",!0),!0;return!1}))}i.refresh(),this.app.callEvent("onRecordsSearch",[t,n])}},e}(m);function Vt(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,n=e.handler;return webix.UIManager.removeHotKey(i,n,t)}}}var Ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){var t=this,e=this.app,i=this.app.getService("locale")._;return{view:"toolbar",localId:"bar",padding:{left:10,right:10,top:6,bottom:6},margin:10,visibleBatch:"default",height:webix.skin.$active.barHeight+6,elements:[{localId:"defaultButtons",margin:10,width:300,cols:[{view:"toggle",type:"icon",label:i("All reports"),localId:"list",width:150,offIcon:"rpi-menu",onIcon:"rpi-menu-open",on:{onChange:function(){e.callEvent("showModules",[this.getValue()])}}},{view:"button",type:"icon",localId:"newBtn",icon:"rpi-plus",label:i("New"),click:function(){t.$$("bar").showBatch("edit"),e.callEvent("loadModule",[null,"edit"])}}]},{width:300,batch:"edit"},{view:"label",localId:"name",align:"center",label:""},{width:330,batch:"default"},{batch:"report",width:290,cols:[{},{view:"button",type:"icon",align:"right",css:"webix_primary",icon:"wxi-pencil",label:i("Edit"),width:140,click:function(){return e.callEvent("onMenuAction",[null,"edit"])}}]},{width:290,batch:"edit",margin:10,cols:[{view:"button",type:"icon",icon:"rpi-close",label:i("Cancel"),localId:"reset",click:function(){return e.callEvent("resetModule",[])}},{view:"button",css:"webix_primary",type:"icon",icon:"wxi-check",localId:"save",width:140,label:i("Save"),disabled:!0,click:function(){return e.callEvent("saveModule",[])}}]},{popup:!0,$subview:!0,name:"popup"}]}},e.prototype.init=function(){var t=this;this.State=this.app.getParam("state",!0),this.on(this.State.$changes,"module",(function(e){e?void 0!==e.name?t.$$("name").setValue(e.name):t.State.moduleId&&t.app.getService("local").getModule(t.State.moduleId).then((function(e){t.$$("name").setValue(e.name)})):t.$$("name").setValue("")})),this.on(this.State.$changes,"saved",(function(e){var i=t.$$("name").$view;e?(t.$$("save").disable(),i.classList.remove("webix_rpt_not_saved")):(t.$$("save").enable(),i.classList.add("webix_rpt_not_saved"))})),this.on(this.State.$changes,"mode",(function(){return t.SetVisibleButtons()})),this.on(this.State.$changes,"moduleId",(function(){return t.SetVisibleButtons()})),this.on(this.State.$changes,"readonly",(function(){return t.SetVisibleButtons()})),this.on(Vt(),"ctrl+e",(function(){return t.app.callEvent("onMenuAction",[null,"edit"]),!1})),this.on(Vt(),"ctrl+s",(function(){return t.app.callEvent("saveModule",[]),!1})),this.on(Vt(),"ctrl+l",(function(){return t.app.callEvent("showModules",[!0]),!1}))},e.prototype.SetVisibleButtons=function(){var t=this.State.mode;"list"==t?this.$$("list").setValue(!0):this.$$("list").setValue(!1),"edit"==t?(this.$$("defaultButtons").hide(),this.$$("bar").showBatch("edit")):(this.$$("defaultButtons").show(),this.State.moduleId&&!this.State.readonly?this.$$("bar").showBatch("report"):this.$$("bar").showBatch("default"));var e=this.$$("newBtn");e&&(this.State.readonly?e.isVisible()&&e.hide():e.isVisible()||e.show())},e.prototype.TitleTemplate=function(t){return'<div class="rep_title">'+t.name+"</div>"},e}(m),Ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.config=function(){return{type:"wide",margin:5,css:"webix_reports",rows:[{$subview:!0,name:"top"},{type:"wide",margin:5,cols:[{$subview:!0,name:"left"},{$subview:!0,name:"right",css:"webix_rpt_right"}]}]}},e.prototype.init=function(){var t=this;this.State=this.app.getParam("state");var e=this.app.getService("locale")._;this.on(this.State.$changes,"toolbar",(function(e){t.show(e?"toolbar":"_hidden",{target:"top"})})),this.on(this.State.$changes,"mode",(function(e){"edit"===e?t.show("./editor",{target:"left"}):"list"===e?t.show("./modules",{target:"left"}):t.show("_hidden",{target:"left"})})),this.on(this.State.$changes,"moduleId",(function(e){e?t.app.getService("local").getModule(e).then((function(e){t.State.module=JSON.parse(e.text)})):t.State.module=null})),this.on(this.State.$changes,"module",(function(e){var i=(e?e.type:"empty")||"table";t.show("./"+i,{target:"right"})})),this.on(this.app,"loadModule",(function(e,i){return t.LoadModule(e,i)})),this.on(this.app,"onMenuAction",(function(i,n){!i&&t.State.moduleId&&(i=t.State.moduleId),i&&("edit"===n?t.LoadModule(i,"edit"):"delete"===n?webix.confirm({container:t.app.getRoot().$view,title:e("Delete report"),ok:e("Delete"),cancel:e("Cancel"),text:e("Are you sure to delete this report?")}).then((function(){t.app.getService("operations").deleteModule(i).then((function(){i==t.State.moduleId&&t.State.$batch({moduleId:null,mode:"list"})}))})):"copy"===n&&t.app.getService("operations").copyModule(i).then((function(e){t.State.$batch({moduleId:e,mode:"edit"})})))})),this.on(this.app,"showModules",(function(e){e?t.State.mode="list":"list"==t.State.mode&&(t.State.mode="view")}))},e.prototype.LoadModule=function(t,e){this.State.moduleId=t,e&&(this.State.mode=e)},e}(m),Ht={JetView:m};function Bt(t,e,i){var n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}Ht.chart=Z,Ht["common/export"]=Q,Ht["common/toolbar"]=J,Ht["editor/common"]=rt,Ht["editor/data"]=lt,Ht.editor=ut,Ht["editor/other/bucket"]=ht,Ht["editor/other/bucketpopup"]=pt,Ht["editor/other/buckets"]=dt,Ht["editor/other/datepopup"]=ft,Ht["editor/other/groups"]=vt,Ht["editor/other"]=mt,Ht["editor/other/sorts"]=wt,Ht["editor/other/summary"]=gt,Ht["editor/other/summarypopup"]=ct,Ht["editor/query"]=ot,Ht["editor/structure/axis"]=_t,Ht["editor/structure/baseview"]=yt,Ht["editor/structure/chart"]=St,Ht["editor/structure/chartseries"]=xt,Ht["editor/structure/colorpopup"]=bt,Ht["editor/structure/column"]=$t,Ht["editor/structure/heatmap"]=Ct,Ht["editor/structure"]=kt,Ht["editor/structure/table"]=Dt,Ht.empty=Tt,Ht.heatmap=Et,Ht.menu=Lt,Ht.modules=At,Ht["table/export"]=It,Ht.table=Mt,Ht["table/toolbar"]=Pt,Ht.toolbar=Ot,Ht.top=Ft;var Ut=function(){function t(t){this._app=t,this._fieldData=new Map,this._optionsData=new Map,this._data=new Map}return t.prototype.ready=function(t){return this.getModels().then((function(){return t}))},t.prototype.getModules=function(){if(!this._modules){this._modules=new webix.DataCollection({scheme:{$change:function(t){t.value=t.name,t.parsed=JSON.parse(t.text),"string"==typeof t.updated&&(t.updated=new Date(t.updated))},$sort:{by:"name",dir:"asc",as:"string"}}});var t=this._app.getService("backend").getModules().then((function(t){return t.filter((function(t){return t.text}))}));this._modules.parse(t)}return this._modules},t.prototype.getModule=function(t){var e=this;return this.getModules().waitData.then((function(){return e._modules.getItem(t)}))},t.prototype.getModels=function(t){var e=this;return t?this._models||{}:(this._models_async||(this._models_async=this._app.getService("backend").getModels().then((function(t){var i={};return Object.keys(t).forEach((function(e){t[e].data.forEach((function(t){if("reference"==t.type){i[e]||(i[e]=[]),i[t.ref]||(i[t.ref]=[]);var n=e+"/"+t.id+"//"+t.ref;i[e].push({sid:e,tid:t.ref,sf:t.id,id:n}),i[t.ref].push({sid:t.ref,tid:e,tf:t.id,id:n})}}))})),e._refs=i,e._models=t,t}))),this._models_async)},t.prototype.getRefs=function(){return this._refs},t.prototype.getModel=function(t){return this._models[t]},t.prototype.getFieldData=function(t,e){var i=t,n=this._fieldData.get(i);return n||(n=this._app.getService("backend").getFieldData(t).then((function(t){return"date"===e&&(t=t.map((function(t){return new Date(t)}))),t})),this._fieldData.set(i,n),n)},t.prototype.getFields=function(t,e,i){var n=this,r=this._models,a=[];return r[t].data.forEach((function(e){return a.push(n.newField(r[t],e))})),e.forEach((function(t){return r[t.tid].data.forEach((function(e){i&&!e.show||a.push(n.newField(r[t.tid],e))}))})),a},t.prototype.setDataSource=function(t){var e=this.getFields(t,[]);return{query:"",sort:null,fields:e,columns:c(e),oldColumns:null,group:null,joins:[],buckets:null}},t.prototype.newField=function(t,e){var i={id:t.id+"."+e.id,name:e.name,type:e.type,ref:e.ref,mid:t.id,model:t.name,meta:{}};return e.key&&(i.key=!0),i},t.prototype.newModule=function(t){var e=this._app.getService("locale")._;return{id:0,name:e("New report"),desc:e("Created on")+" "+webix.i18n.dateFormatStr(new Date),joins:[],query:"",sort:null,columns:[],fields:[],publicFields:null,group:null,buckets:null,meta:{},data:Object.keys(this._models)[0],type:t||"table"}},t.prototype.addJoin=function(t,e){var i=this,n=this._models[t],r=e.fields,a=e.columns,o=e.group;return n.data.forEach((function(t){r.push(i.newField(n,t)),t.show&&!o&&a.push(i.newField(n,t))})),{fields:r,columns:a}},t.prototype.getData=function(t,e){var i=JSON.stringify(t),n=this._data.get(i);return n||(e&&(t.limit=30,i=JSON.stringify(t),n=this._data.get(i))||(n=this._app.getService("backend").getData(t),this._data.set(i,n)),n)},t.prototype.getDataConfig=function(t){return{data:t.data,query:t.query,columns:t.columns.map((function(t){return t.id})).sort(),joins:t.joins,sort:t.sort,group:t.group&&t.group.by?t.group.by.map((function(t){return(t.mod?t.mod+".":"")+t.id})):"",buckets:t.buckets}},t.prototype.getOptions=function(t){var e=this,i=t.filter((function(t){return"picklist"===t.type||"reference"===t.type})).map((function(t){return e.getOptionsList(t.id)}));return Promise.all(i)},t.prototype.getOptionsList=function(t){var e=this._optionsData.get(t);return e||(e=this._app.getService("backend").getOptions(t),this._optionsData.set(t,e)),e.then((function(e){return{field:t,data:e}}))},t.prototype.getLinkedModels=function(t,e){for(var i=[],n=this.getRefs(),r=0;r<t.length;r++){var a=t[r];n[a]&&n[a].forEach((function(n){e&&-1!=t.indexOf(n.tid)||i.push(u({},n))}))}return i},t.prototype.cleanLinkedModels=function(t,e){var i,n,r=e.data,a=e.joins,o=e.fields,s=e.columns,l=e.query,u=e.group,c=e.publicFields,h=((i={})[r]=1,i),p=a,d=[];a=n=a.filter((function(e){return e.id!=t}));do{a=n,n=[];for(var f=0;f<a.length;f++)h[a[f].sid]?h[a[f].tid]=1:n.push(a[f])}while(n.length&&n.length!==a.length);var g=l?Nt(JSON.parse(l)):[],v=function(t){var e=p[t];if(h[e.tid])d.push(e);else{if(-1!==g.indexOf(e.tid))return{value:{block:{filter:1}}};if(u){var i="."+e.tid+".";if(c.find((function(t){return-1!=t.id.indexOf(i)})))return{value:{block:{group:1}}}}s=s.filter((function(t){return t.mid!=e.tid})),o=o.filter((function(t){return t.mid!=e.tid}))}};for(f=0;f<p.length;f++){var m=v(f);if("object"==typeof m)return m.value}return{joins:d,columns:s,fields:o}},t.prototype.getQueries=function(){return this._queries?this._queries:this._queries=new webix.DataCollection({scheme:{$change:function(t){t.value=t.name,t.models=t.text?Nt(JSON.parse(t.text)):[]}},data:this._app.getService("backend").getQueries()})},t}();function Nt(t,e){return e=e||[],t.rules&&t.rules.forEach((function(t){if(t.rules)Nt(t,e);else{var i=t.field.split(".");e.push(i[0])}})),e}var jt=function(){function t(t){this.app=t,this._url=t.config.url}return t.prototype.getQueries=function(){return webix.ajax(this._url+"api/queries").then((function(t){return t.json()}))},t.prototype.addQuery=function(t){return webix.ajax().post(this._url+"api/queries",t).then((function(t){return t.json()}))},t.prototype.updateQuery=function(t,e){return webix.ajax().put(this._url+"api/queries/"+t,e).then((function(t){return t.json()}))},t.prototype.deleteQuery=function(t){return webix.ajax().del(this._url+"api/queries/"+t).then((function(t){return t.json()}))},t.prototype.getModules=function(){return webix.ajax(this._url+"api/modules").then((function(t){return t.json()}))},t.prototype.addModule=function(t){return webix.ajax().post(this._url+"api/modules",t).then((function(t){return t.json()}))},t.prototype.updateModule=function(t,e){return webix.ajax().put(this._url+"api/modules/"+t,e).then((function(t){return t.json()}))},t.prototype.deleteModule=function(t){return webix.ajax().del(this._url+"api/modules/"+t).then((function(t){return t.json()}))},t.prototype.getModels=function(){return webix.ajax(this._url+"api/objects").then((function(t){return t.json()}))},t.prototype.getData=function(t){var e=t.query,i=t.columns,n=t.joins,r=t.limit,a=t.group,o=t.sort,s=t.buckets;return webix.ajax().post(this._url+"api/objects/"+t.data+"/data",{query:e,columns:i,joins:n,limit:r,sort:o,group:a,buckets:s}).then((function(t){return t.json()}))},t.prototype.getOptions=function(t){return webix.ajax(this._url+"api/fields/"+t+"/options").then((function(t){return t.json()}))},t.prototype.getFieldData=function(t){return webix.ajax(this._url+"api/fields/"+t+"/suggest").then((function(t){return t.json()}))},t}(),Gt=function(){function t(t){this._app=t,this._local=t.getService("local"),this._back=t.getService("backend")}return t.prototype.deleteModule=function(t){var e=this;return this._back.deleteModule(t).then((function(){e._local.getModules().remove(t)}))},t.prototype.copyModule=function(t){var e=this._local.getModules().getItem(t),i=this._app.getService("locale")._;return this.addModule({name:i("Copy of")+" "+e.name,text:e.text})},t.prototype.addModule=function(t){var e=this;return this._back.addModule(t).then((function(i){return e._local.getModules().add(u({id:i.id},t)),i.id}))},t.prototype.updateModule=function(t,e){var i=this;return this._back.updateModule(t,e).then((function(n){return i._local.getModules().updateItem(t,e),n.id}))},t.prototype.getModuleSaveData=function(t){return{desc:t.desc,data:t.data,joins:t.joins,query:t.query,columns:t.columns,group:t.group,buckets:t.buckets,meta:t.meta,sort:t.sort,type:t.type}},t.prototype.addQuery=function(t){var e=this;return this._back.addQuery(t).then((function(i){return e._local.getQueries().add(u({id:i.id},t)),i.id}))},t.prototype.updateQuery=function(t,e){var i=this;return this._back.updateQuery(t,e).then((function(n){return i._local.getQueries().updateItem(t,e),n.id}))},t.prototype.deleteQuery=function(t){var e=this;return this._back.deleteQuery(t).then((function(){e._local.getQueries().remove(t)}))},t}(),Yt=function(){function t(){this.replacements=[{from:/(^ +)/g,to:""},{from:/(\w+)/g,to:"($&)"},{from:/^(\?)/g,to:"^\\S{1}"},{from:/(\?)/g,to:"\\S{1}"},{from:/(\*)/g,to:"\\S*"},{from:/( +)$/g,to:"$"}]}return t.prototype.wildToRegexp=function(t){for(var e=0;e<this.replacements.length;++e)t=t.replace(this.replacements[e].from,this.replacements[e].to);return t},t.prototype.matchPerColumn=function(t,e){return function(i){return e(i[t])}},t.prototype.findOptions=function(t,e){var i={};return t.find((function(t){return e.test(t.value)})).forEach((function(t){return i[t.id]=1})),i},t.prototype.hasNonDigits=function(t){return/\D/gi.test(t.replace(/[?*/. ]/g,""))},t}(),zt=function(){function t(t){this._app=t,this.type="line",this.type="line",this.colors=["#FF9700","#4CB050","#00BCD4","#3F51B5","#9C28B1","#F34336","#FFEA3B","#009788","#2196F3","#673BB7","#EA1E63"],this.itemSupport=["line","spline","radar"],this.noAxisSupport=["pie","donut"],this.lineTypes=["line","spline"],this.multiTypeSupport=["bar","stackedBar","area","stackedArea","splineArea"],this.numLimit=30}return t.prototype.getTypes=function(){var t=this._app.getService("locale")._;return this.types||(this.types=[{id:"line",value:t("Line"),icon:"rpi-chart-line"},{id:"spline",value:t("Spline"),icon:"rpi-chart-bell-curve-cumulative"},{id:"area",value:t("Area"),icon:"rpi-chart-areaspline"},{id:"stackedArea",value:t("Stacked area"),icon:"rpi-chart-line-stacked"},{id:"splineArea",value:t("Spline area"),icon:"rpi-chart-areaspline-variant"},{id:"bar",value:t("Bar"),icon:"rpi-chart-bar"},{id:"stackedBar",value:t("Stacked bar"),icon:"rpi-chart-bar-stacked"},{id:"radar",value:t("Radar"),icon:"rpi-vector-triangle"}]),this.types},t.prototype.getItemTypes=function(){var t=this._app.getService("locale")._;return this.itemTypes||(this.itemTypes=[{id:"r",value:t("circle"),icon:"rpi-circle-outline"},{id:"s",value:t("square"),icon:"rpi-square-outline"},{id:"t",value:t("triangle"),icon:"rpi-triangle-outline"},{id:"d",value:t("diamond"),icon:"rpi-rhombus-outline"},{id:"no",value:t("no markers")}]),this.itemTypes},t.prototype.getSeries=function(t,e){var i=this,n=[],r=0;return t.forEach((function(t){var a={id:t.id,name:t.value,model:t.model||null,show:!0,meta:{name:t.value,color:i.colors[r]||i.colors[0]}};r++,-1!=i.itemSupport.indexOf(e)&&(a.meta.markerType="r",a.meta.fillMarker=!1),n.push(a)})),n},t}(),Wt=function(t){function e(e){var i=this,n=K({moduleId:e.moduleId||null,module:null,mode:e.mode||"list",toolbar:!1!==e.toolbar,saved:!0,readonly:e.readonly||!1}),r={router:k,debug:!0,start:"/top/empty",params:{state:n}};(i=t.call(this,u(u({},r),e))||this).config.debug&&(webix.Promise=window.Promise);var a,o,s,l=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("local",new(l(Ut))(i)),i.setService("backend",new(l(jt))(i)),i.setService("helpers",new(l(Yt))(i)),i.setService("charts",new(l(zt))(i)),i.setService("operations",new(l(Gt))(i)),s={updateConfig:function(t){var e=a.getRoot(),i=e.$view;o?o&&!i.id&&(i.id=o):(i.id?o=i.id:i.id=o="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+o+"{ position: relative; }"),webix.html.addStyle("#"+o+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+o+" .webix_disabled{ z-index:1 !important; }")),t.container=o,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var n=!0,r=t.on.onShow;return t.on.onShow=function(){var t=this;r&&r.apply(this,arguments),n&&(this.$setSize=function(i,n){Bt(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},function(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){Bt(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}(this,a),n=null),webix.callEvent("onClick",[]),webix.html.addCss(i,"webix_win_inside"),e.disable(),Bt(this,e)},t}},(a=i).setService("jet-win",s),i.use(N,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i}return l(e,t),e.prototype.require=function(t,e){return"jet-views"===t?Ht[e]:"jet-locales"===t?Kt[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(C);webix.protoUI({name:"reports",app:Wt,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this.$app.getState();for(var e in t)q(t,this.config,e)}},webix.ui.jetapp);var qt={Local:Ut,Backend:jt,Helpers:Yt,Charts:zt},Kt={en:{"Add column":"Add column","All reports":"All reports","Are you sure to delete this report?":"Are you sure to delete this report?","Are you sure to delete this query?":"Are you sure to delete this query?",Average:"Average",Cancel:"Cancel",Chart:"Chart",Column:"Column",Columns:"Columns",column:"column","Color column":"Color column",Common:"Common","Copy of":"Copy of",Count:"Count","Created on":"Created on",Data:"Data","Data source":"Data source",Day:"Day",Delete:"Delete","Delete report":"Delete report",Description:"Description",Query:"Query",Edit:"Edit","Enter query name":"Enter query name",Export:"Export","To Excel":"To Excel","To CSV":"To CSV","To PNG":"To PNG","To PDF":"To PDF",Filter:"Filter","Filtering query":"Filtering query","Frozen columns above":"Frozen columns above",Function:"Function",Group:"Group","Group summaries":"Group summaries","Join data":"Join data",Heatmap:"Heatmap","Labels column":"Labels column",Max:"Max",Min:"Min",Month:"Month",New:"New","Click 'New' button to add a new report":"Click 'New' button to add a new report","Select any report from the list":"Select any report from the list","No reports":"No reports","No saved queries":"No saved queries","Last modified":"Last modified","New column name":"New column name","New report":"New report","Please delete the related query filter first":"Please delete the related query filter first","Please delete the related group rule first":"Please delete the related group rule first",Rename:"Rename","Report name":"Report name",Reports:"Reports",Save:"Save","Save query":"Save query",Sort:"Sort","Specify columns to group by and output(s)":"Specify columns to group by and output(s)","Specify columns to sort by":"Specify columns to sort by",Sum:"Sum",Table:"Table",Title:"Title","Type to search":"Type to search",View:"View",Year:"Year",Axes:"Axes","X Axis":"X Axis","Y Axis":"Y Axis",columns:"columns",rows:"rows","Data series":"Data series","Chart type":"Chart type","Keys column":"Keys column","X axis column":"X axis column","Values column":"Values column",Color:"Color","Marker type":"Marker type","Fill marker":"Fill marker",Legend:"Legend","Logarithmic scale":"Logarithmic scale",Gridlines:"Gridlines",Bottom:"Bottom",None:"None",Right:"Right",Line:"Line",Spline:"Spline",Area:"Area","Stacked area":"Stacked area","Spline area":"Spline area",Bar:"Bar","Stacked bar":"Stacked bar",Radar:"Radar","Create copy":"Create copy",circle:"circle",square:"square",triangle:"triangle",diamond:"diamond","no markers":"no markers","Vertical labels":"Vertical labels","Extract series from":"Extract series from",True:"True",False:"False","Save filter to use it in other reports":"Save filter to use it in other reports","No filter":"No filter",Text:"Text",Select:"Select",buckets:"buckets","Data buckets":"Data buckets","Bucket name":"Bucket name","Bucket values":"Bucket values","Add bucket":"Add bucket","Specify columns and their data buckets":"Specify columns and their data buckets",Search:"Search",Other:"Other","Other values":"Other values","Are you sure to delete?":"Are you sure to delete?"}};o.App=Wt,o.locales=Kt,o.services=qt,o.views=Ht,Object.defineProperty(o,"__esModule",{value:!0})}(e)},9217:function(t,e,i){!function(t){"use strict";var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function n(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function a(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)n[r]=a[o];return n}var o=function(){},s=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function l(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],a={},o=r.indexOf(":");if(-1===o&&(o=r.indexOf("?")),-1!==o)for(var s=0,l=r.substr(o+1).split(/[\:\?\&]/g);s<l.length;s++){var u=l[s].split("=");a[u[0]]=decodeURIComponent(u[1])}i[n]={page:o>-1?r.substr(0,o):r,params:a,isNew:!0}}return i}function u(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var a=c(r.params);a&&e.push("?"+a)}return e.join("")}function c(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var h=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:l(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=u(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(l(t));for(var a=0;a<i.length;a++)n[a]&&(i[a].view=n[a].view),r&&n[a]&&i[a].page===n[a].page?i[a].isNew=!1:i[a].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=u(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var a=u(r),s={url:r,redirect:a,confirm:Promise.resolve()},l=e?e.app:null;!l||l.callEvent("app:guard",[s.redirect,e,s])?s.confirm.catch((function(t){return i(t)})).then((function(){if(null!==s.redirect){if(s.redirect!==a)return l.show(s.redirect),void i(new o);n.route.path=a,n.route.url=r,t()}else i(new o)})):i(new o)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=u(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=u(this.route.url)},t}(),p=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return n(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof s?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new h(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,a=null,o=!1;if(this._container.tagName?a=this._container:(r=this._container).popup?(a=document.body,o=!0):a=this.webix.$$(r.id),!this.app||!a)return Promise.reject(null);var s=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!o){var u=a,c=u.getParentView();c&&"multiview"===c.name&&!l.ui.id&&(l.ui.id=u.config.id)}this._root=this.app.webix.ui(l.ui,a);var h=this._root;o&&h.setPosition&&!h.isVisible()&&h.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var a=e.view;if(!a&&e.url){if("string"==typeof e.url)return e.route=new h(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||a instanceof e.url||(a=new(this.app._override(e.url))(this.app,"")),a||(a=e.url)}if(a)return a.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(s),d=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return n(e,t),e.prototype.config=function(){return this._ui},e}(p),f=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),g=!0,v=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return n(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof s||"function"==typeof t&&t.prototype instanceof s)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var a=t[r];if("function"==typeof a&&a.prototype instanceof s&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[r]=a;else if(a instanceof Date)e[r]=new Date(a);else{var o=this.copyConfig(a,a instanceof Array?[]:{},i);null!==o&&(n?e.push(o):e[r]=o)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:f});if(t.prototype instanceof s)return new t(this,{name:i,params:n});t=t(this)}return t instanceof s?t:new d(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;this.$router?r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(g&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),g=!1),"string"==typeof e&&(e=new h(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var a=i?i.params:this.config.params||null,o=this.getSubView(),s=this._subSegment,l=s.show({url:r,params:a},o).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new p(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof o))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new h(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new h(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(s),m=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),w=!1;function _(t){if(!w&&t){w=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,a={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var a=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var o in r)a(o);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,a,!0),t.extend(t.ui.baselayout.prototype,a,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var y=function(t){function e(e){var i;return e.router=e.router||m,_((i=t.call(this,e)||this).webix),i}return n(e,t),e.prototype.require=function(t,e){return i(86993)(t+"/"+e)},e}(v),b=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(m),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function x(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function S(t,e,i){for(var n in t)x(t,n)&&e.call(i||t,t[n],n,t)}function $(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var C=String.prototype.replace,k=String.prototype.split,D=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},T={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:D,chinese:function(){return 0},croatian:D,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:D,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},E={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function L(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var A=/\$/g,I=/%\{(.*?)\}/g;function P(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,a=n||I,o="number"==typeof e?{smart_count:e}:e;if(null!=o.smart_count&&r){var s=k.call(r,"||||");r=(s[function(t,e){return T[function(t){var e,i=(e={},S(E,(function(t,i){S(t,(function(t){e[t]=i}))})),e);return i[t]||i[k.call(t,/-/,1)[0]]||i.en}(t)](e)}(i||"en",o.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return C.call(r,a,(function(t,e){return x(o,e)&&null!=o[e]?C.call(o[e],A,"$$"):t}))}function R(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?P:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||$,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(L(e)+"(.*?)"+L(i),"g")}(e.interpolation)}R.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},R.prototype.extend=function(t,e){S(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},R.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:S(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},R.prototype.clear=function(){this.phrases={}},R.prototype.replace=function(t){this.clear(),this.extend(t)},R.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=P(i,r,this.currentLocale,this.tokenRegex)),n},R.prototype.has=function(t){return x(this.phrases,t)},R.transformPhrase=function(t,e,i){return P(t,e,i)};var M=R,V=window.webix;V&&_(V);var O=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function a(e,a,o){a.__esModule&&(a=a.default);var l={phrases:a};i.polyglot&&t.webix.extend(l,i.polyglot);var u=s.polyglot=new M(l);if(u.locale(e),s._=t.webix.bind(u.t,u),r=e,n&&n.put("lang",r),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return o?Promise.resolve():t.refresh()}function o(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;a(e,t.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:o,setLangData:a,_:null,polyglot:null};t.setService("locale",s),o(r,!0)},F=window;F.Promise||(F.Promise=F.webix.promise);var H=1;function B(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function U(t,e){e=e||{};var i={},n={},r=function(t,e){var r=H++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},a=[],o=!1,s=function(t,e,n,r){if(o)a.push([t,e,n,r]);else for(var s=Object.keys(i),l=0;l<s.length;l++){var u=i[s[l]];u&&("*"!==u.mask&&u.mask!==t||u.handler(n,e,t,r))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(o=!0,t(n),o=!1;a.length;){var i=a.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var r in i=i||e,t)if(t.hasOwnProperty(r)){var a=t[r];i.nested&&"object"==typeof a&&a?n[r]=U(a,i):N(n,a,r,s)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function N(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}var j=!1;function G(t,e,i){var n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}function Y(t){var e=webix.promise.defer(),i=setInterval((function(){var n=t.$destructed;(n||t.isVisible())&&(n?e.reject():e.resolve(),clearInterval(i))}),300);return e}var z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n=this.app.config.calendars;return{view:"align",body:{view:i?"icon":"button",type:"icon",icon:"wxi-plus",css:"webix_primary",label:e("Create"),width:i?50:n?185:100,height:i?50:webix.skin.$active.inputHeight,on:{onItemClick:function(){return t.AddEvent()}}},align:"middle"}},e.prototype.AddEvent=function(){this.app.getState().selected={id:"0"}},e}(p),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return{cols:[{view:"icon",icon:"wxi-angle-left",tooltip:function(){return t.NavLabel(-1)},align:"left",on:{onItemClick:function(){return t.ChangeDate(-1)}}},{view:"label",localId:"title",align:"center",width:160},{view:"icon",icon:"wxi-angle-right",tooltip:function(){return t.NavLabel(1)},align:"right",on:{onItemClick:function(){return t.ChangeDate(1)}}}]}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.on(this.State.$changes,"date",(function(){return t.DateLabel()})),this.on(this.State.$changes,"mode",(function(){return t.DateLabel()})),this.app.config.timeline&&this.on(this.State.$changes,"timelineMode",(function(){return t.DateLabel()}))},e.prototype.ChangeDate=function(t){var e=this.State,i=this.GetStep(e.mode),n=webix.Date.add(e.date,t,i,!0);if("month"===e.mode){var r=Math.abs(e.date.getMonth()-n.getMonth());1!=r&&r<6&&n.setDate(0)}e.$batch({date:n,selected:null})},e.prototype.GetStep=function(t){switch(t){case"agenda":return"month";case"units":return"day";case"timeline":return this.State.timelineMode;default:return t}},e.prototype.DateLabel=function(){var t=this.State.date,e=this.State.mode,i=webix.Date.dateToStr("%F %Y");"year"===e?i=webix.Date.dateToStr("%Y"):("day"==e||"units"==e||"timeline"==e&&"day"==this.State.timelineMode)&&(i=webix.i18n.longDateFormatStr),this.$$("title").setHTML(i(t))},e.prototype.NavLabel=function(t){var e=this.app.getService("locale")._,i=this.State.mode;return e((t=t>0?"Next":"Previous")+(i=-1!==["month","week","day"].indexOf(i)?" "+i:""))},e}(p),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n=!!this.app.config.units,r={hidden:i,view:"tabbar",bottomOffset:0,localId:"buttons",borderless:!0,width:320,optionWidth:80,options:[{id:"day",value:e("Day")},{id:"week",value:e("Week")},{id:"month",value:e("Month")},{id:"agenda",value:e("Agenda")},{id:"year",value:e("Year")}]};return this.app.config.timeline&&(r.width+=80,r.options.push({id:"timeline",value:e("Timeline")})),i||(r.on={onChange:function(e){return t.SetMode(e)}}),n&&(r.width+=80,r.options.push({id:"units",value:e("Units")})),r},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.on(this.State.$changes,"mode",(function(e){t.$$("buttons").setValue(e)}))},e.prototype.SetMode=function(t){this.State.$batch({mode:t,selected:null})},e}(p),K=[["#61AEE6","#01C2A5","#E88DD9","#D2FB9E","#6BA8CB","#61BBA5","#CF89D5"],["#EF9C80","#8289EE","#74B1A7","#DD89AF","#E48882","#997CEB","#ADD579"],["#F68896","#FFE999","#6D4BCE","#99CA58","#D352BE","#F7CC34","#DA5C53"]],X=[["#5890DC","#3AA3E3","#045AA3","#014593","#01C2A5","#61A649","#157B7A"],["#04864F","#AD44AB","#CB61C8","#AC3C6E","#BA282E","#BD4E1B","#B87728"],["#B65F06","#7A67EB","#4536AD","#282A8A","#36337E","#585B85","#2A2F50"]],Q={material:K,mini:K,flat:K,compact:K,contrast:K,willow:X,dark:X};function J(){var t=webix.skin.$active;return{view:"colorboard",css:"webix_scheduler_palette",height:3*t.optionHeight+4,width:7*t.optionHeight+4,palette:Q[webix.skin.$name]}}var Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact",!0),i=this.app.getService("locale")._,n={view:"button",value:i("Save"),align:"right",inputWidth:100,css:"webix_primary",click:function(){return t.Save()}},r=webix.skin.$active,a={view:"toolbar",padding:{left:r.layoutPadding.form-(r.inputHeight-20)/2,right:r.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.getRoot().hide()}},{},n]},o=[{view:"button",localId:"removeBtn",value:i("Delete"),css:"webix_danger webix_scheduler_danger",hidden:!0,align:e?"center":"left",inputWidth:e?330:100,click:function(){return t.Delete()}}];e||o.push(n);var s=this.app.getService("jet-win").updateConfig({view:"window",width:400,close:!0,borderless:e,fullscreen:e,css:"webix_scheduler_cal_popup",head:e?a:i("Edit calendar"),body:{view:"form",localId:"calendars:form",elements:[{view:"text",label:i("Title"),name:"text"},{view:"colorpicker",label:i("Color"),name:"color",suggest:{type:"colorboard",padding:3,body:J()}},{view:"checkbox",label:i("Active"),name:"active"},{cols:o}]},on:{onHide:function(){t.Form.clear(),t.$$("removeBtn").hide()}}});return e&&s.body.elements.splice(3,0,{}),s},e.prototype.init=function(){this.Cals=this.app.getService("local").calendars(!0),this.Ops=this.app.getService("operations"),this.Form=this.$$("calendars:form")},e.prototype.Show=function(t){if(t){var e=this.Cals.getItem(t);this.Form.setValues(e),this.$$("removeBtn").show()}else this.Form.setValues({color:"#997CEB",active:1});this.getRoot().show(),this.Form.focus()},e.prototype.Save=function(){var t=this.Form.getValues();t.id?this.Ops.updateCalendar(t.id,t):this.Ops.addCalendar(t),this.getRoot().hide()},e.prototype.Delete=function(){var t=this,e=this.Form.getValues(),i=this.app.getService("locale")._;webix.confirm({text:i("Do you really want to remove this calendar?"),container:this.app.getRoot().$view}).then((function(){t.Ops.removeCalendar(e.id),t.getRoot().hide()}))},e}(p),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",relative:"right",body:{rows:[webix.extend(J(),{localId:"colors",on:{onItemClick:function(e){return t.UpdateColor(e)}}}),{css:"webix_scheduler_settings",template:e("Settings"),height:webix.skin.$active.inputHeight,onClick:{webix_template:function(){return t.ShowEditor()}}}]},on:{onHide:function(){return t.app.callEvent("side:popup:hide",[])}}}},e.prototype.init=function(){var t=this;Y(this.getRoot()).then((function(){t.Editor=t.ui(Z)}))},e.prototype.Show=function(t,e,i){this.Cid=t,this.getRoot().show(e),this.$$("colors").setValue(i)},e.prototype.ShowEditor=function(){this.Editor.Show(this.Cid),this.getRoot().hide()},e.prototype.UpdateColor=function(t){this.app.getService("operations").updateCalendar(this.Cid,{color:t}),this.getRoot().hide()},e.prototype.Hide=function(){this.getRoot().hide()},e}(p),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;this.Compact=this.getParam("compact",!0);var e=this.app.getService("locale")._,i=this.app.getState(),n={view:"calendar",localId:"calendar",height:276,monthSelect:!1,on:{onAfterDateSelect:function(t){i.date=webix.Date.dayStart(t)}}},r={view:"list",localId:"calendars",type:this.ListType(e,i),borderless:!0,autoheight:!0,yCount:5,editable:!0,editValue:"text",editaction:"custom",editor:"text",css:"webix_scheduler_cal_list",tooltip:function(){return""},onClick:{webix_scheduler_cal_edit:function(e,i){return t.ShowPopup(e,i)},webix_scheduler_cal_title:function(e,i){return t.ToggleCalendar(i)},webix_scheduler_active:function(e,i){return t.ToggleCalendar(i)}},on:{onBeforeEditStop:function(e,i){return t.SetTitle(i.id,e.value)}}},a={type:"form",padding:{top:8},rows:[{maxHeight:100},r,{view:"button",localId:"add",value:e("Add calendar"),hidden:!i.readonly,inputWidth:190,align:"center",click:function(){return t.AddCalendar()}},{}]};return this.Compact||(r.on.onAfterScroll=function(){return t.Popup.Hide()},a={view:"scrollview",body:{type:"clean",rows:[n,a]}}),a},e.prototype.init=function(){var t=this;this.Cals=this.$$("calendars"),this.Data=this.app.getService("local"),this.Ops=this.app.getService("operations"),this.Popup=this.Compact?this.ui(Z):this.ui(tt),webix.extend(this.Cals,webix.EditAbility),this.Data.calendars().then((function(e){return t.Cals.parse(e)}));var e=this.app.getState();this.Compact||(this.on(e.$changes,"date",(function(e){t.$$("calendar").setValue(e)})),this.on(this.app,"side:popup:hide",(function(){t.Cals.unselectAll()}))),this.on(e.$changes,"readonly",(function(e){return t.ToggleState(e)}))},e.prototype.ListType=function(t,e){return{checkbox:function(t){var e=1*t.active?"wxi-checkbox-marked":"wxi-checkbox-blank";return'<span style="color:'+t.color+';" \n\t\t\t\t\trole="checkbox" tabindex="-1" \n\t\t\t\t\taria-checked="'+(t.active?"true":"false")+'" \n\t\t\t\t\tclass="webix_icon webix_scheduler_active '+e+'">\n\t\t\t\t</span>'},template:function(i,n){var r='\n\t\t\t\t\t<span\n\t\t\t\t\t\twebix_tooltip="'+t("Edit calendar")+'" \n\t\t\t\t\t\tclass="webix_icon wxi-dots webix_scheduler_cal_edit \n\t\t\t\t\t\t\t'+(webix.env.touch?" webix_scheduler_cal_visible":"")+'\n\t\t\t\t\t\t">\n\t\t\t\t\t</span>\n\t\t\t\t';return"\n\t\t\t\t\t"+n.checkbox(i)+'\n\t\t\t\t\t<span class="webix_scheduler_cal_title">'+(i.text||t("(no title)"))+"</span>\n\t\t\t\t\t"+(e.readonly?"":r)+"\n\t\t\t\t"}}},e.prototype.AddCalendar=function(){var t=this,e=this.app.getService("locale")._;this.Ops.addCalendar().then((function(i){t.Cals.edit(i),t.Cals.getEditor().getInputNode().setAttribute("placeholder",e("(no title)"))}))},e.prototype.ShowPopup=function(t,e){if(this.Compact)this.Popup.Show(e);else{this.Cals.select(e);var i=this.Cals.getItem(e).color;this.Popup.Show(e,this.Cals.getItemNode(e),i)}},e.prototype.ToggleCalendar=function(t){var e=this.Cals.getItem(t);this.Ops.updateCalendar(t,{active:1^e.active})},e.prototype.ToggleState=function(t){var e=this.$$("add");t?e.hide():e.show(),this.Cals.refresh()},e.prototype.SetTitle=function(t,e){var i=this;return this.Ops.updateCalendar(t,{text:e}).then((function(){return i.EditStopSilent()}),(function(){return i.EditStopSilent(!0)})),!1},e.prototype.EditStopSilent=function(t){this.Cals.blockEvent(),t?this.Cals.editCancel():this.Cals.editStop(),this.Cals.unblockEvent()},e}(p),it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=!!this.app.config.units,n={view:"list",css:"webix_scheduler_navlist",localId:"modes",autoheight:!0,data:[{id:"day",value:e("Day"),icon:"shi-day"},{id:"week",value:e("Week"),icon:"shi-week"},{id:"month",value:e("Month"),icon:"shi-month"},{id:"agenda",value:e("Agenda"),icon:"shi-agenda"},{id:"year",value:e("Year"),icon:"shi-year"}],on:{onItemClick:function(e){return t.SetMode(e)}}};i&&n.data.push({id:"units",value:e("Units"),icon:"shi-units"}),this.app.config.timeline&&n.data.push({id:"timeline",value:e("Timeline"),icon:"shi-timeline"});var r={view:"sidemenu",animate:!1,borderless:!0,css:"webix_scheduler_sidemenu",width:300,state:function(e){var i=webix.skin.$active.tabbarHeight+10;e.left=t.Parent.left,e.top=t.Parent.top+i+2,e.height=t.Parent.height-i-2},body:n};return this.app.config.calendars&&(r.body={view:"scrollview",body:{type:"clean",rows:[n,et]}}),r},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.on(this.app,"view:resize",(function(){t.getRoot().isVisible()&&t.Show(!0)}))},e.prototype.Show=function(t){!t&&this.getRoot().isVisible()||(this.Parent=this.app.getRoot().$view.getBoundingClientRect(),this.$$("modes").select(this.State.mode),this.getRoot().show())},e.prototype.SetMode=function(t){var e=this;this.getRoot().hide(),setTimeout((function(){return e.State.$batch({mode:t,selected:null})}),500)},e}(p),nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;this.Compact=this.getParam("compact",!0);var i={view:"icon",icon:"wxi-calendar",batch:"compact",tooltip:e("Today"),click:function(){return t.SetToday()}},n={view:"align",align:"middle",batch:"full",body:{width:80,view:"button",css:"webix_transparent",value:e("Today"),click:function(){return t.SetToday()}}};return{view:"toolbar",css:"webix_scheduler_toolbar webix_dark",responsive:!0,paddingY:0,paddingX:4,height:webix.skin.$active.tabbarHeight+10,visibleBatch:this.Compact?"compact":"full",cols:[{view:"icon",icon:"shi-menu",click:function(){return t.ShowNav()},hidden:!this.Compact&&!this.app.config.calendars,responsiveCell:!1},{view:"proxy",localId:"add",borderless:!0,body:z,batch:"full",responsiveCell:!1},{},{view:"proxy",borderless:!0,body:W,responsiveCell:!1},{},n,{width:12},q,i]}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.Compact&&(this.NavPopup=this.ui(it)),this.on(this.State.$changes,"readonly",(function(e){t.ToggleAdd(e)}))},e.prototype.SetToday=function(){this.State.date=webix.Date.dayStart(new Date)},e.prototype.ShowNav=function(){this.Compact?this.NavPopup.Show():this.app.callEvent("show:panel")},e.prototype.ToggleAdd=function(t){var e=this.$$("add");t?e.hide():this.Compact||e.show()},e}(p),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",body:{view:"menu",layout:"y",width:220,autoheight:!0,data:[{id:"this",value:e("This event")},{id:"next",value:e("This event and the following")},{id:"all",value:e("All events")}],on:{onMenuItemClick:function(e){t.Result&&t.Result.resolve(e),t.Result=null,t.Root.hide()}}},on:{onHide:function(){t.Result&&t.Result.reject(),t.Result=null}}}},e.prototype.init=function(t){this.Root=t},e.prototype.Show=function(t){return this.Result=webix.promise.defer(),this.Root.show(t),this.Result},e}(p);function at(t,e){return function(i){var n=i.start_date<=t,r=i.end_date>=e;if(n||r){var a=webix.copy(i);return n&&(a.start_date=t),r&&(a.end_date=e),a}return i}}function ot(t){return webix.Date.equal(webix.Date.datePart(t),webix.Date.datePart(new Date))}function st(t){return t.all_day||t.start_date.getDate()!=t.end_date.getDate()&&t.end_date-t.start_date>=864e5}function lt(t,e){return Math.round((webix.Date.dayStart(e)-webix.Date.dayStart(t))/864e5)}function ut(t,e){return webix.Date.equal(webix.Date.dayStart(t),webix.Date.dayStart(e))}var ct=webix.Date.dateToStr("%Y%m%dT000000Z");function ht(t){for(var e=t.split(";"),i={},n=0;n<e.length;n++){var r=e[n].split("="),a=r[0],o=r[1];i[a]=o}return i.UNTIL&&(i.UNTIL=pt(i.UNTIL)),i.EXDATE&&(i.EXDATE=i.EXDATE.split(",").map((function(t){return pt(t)}))),i}function pt(t){return new Date(1*t.substr(0,4),1*t.substr(4,2)-1,1*t.substr(6,2))}function dt(t){var e=[];for(var i in t){var n=t[i];"UNTIL"===i&&(n=ct(n)),"EXDATE"===i&&(n=(n=n.map((function(t){return ct(t)}))).join(",")),n&&e.push(i+"="+n)}return e.join(";")}var ft=["SU","MO","TU","WE","TH","FR","SA"],gt={DAILY:"day",WEEKLY:"week",MONTHLY:"month",YEARLY:"year"};function vt(t,e){if(!t)return!1;for(var i=0;i<t.length;++i)if(webix.Date.equal(webix.Date.dayStart(e),t[i]))return!0;return!1}function mt(t,e){if(t.BYDAY)for(var i=e.wdays=[0,0,0,0,0,0,0],n=t.BYDAY.split(",").map((function(t){return ft.indexOf(t)})).sort(),r=0;r<n.length;r++)for(var a=n[r],o=n[r+1]||n[0]+7,s=a;s<o;s++)i[s%7]=o-s}function wt(t,e,i){var n,r,a=1*(e.INTERVAL||1);switch(e.FREQ){case"DAILY":t.setDate(t.getDate()+a);break;case"WEEKLY":n=t.getDay(),(r=i.wdays?i.wdays[n]:7)+n>6&&a>1&&(r+=7*(a-1)),t.setDate(t.getDate()+r);break;case"YEARLY":if(e.BYYEARDAY){t.setFullYear(t.getFullYear()+a),t.setMonth(0),t.setDate(1),t.setDate(e.BYYEARDAY);break}a*=12;case"MONTHLY":if(n=t.getMonth(),t.setDate(1),t.setMonth(n+a),e.BYMONTHDAY)t.setDate(e.BYMONTHDAY),(n+a)%12!=t.getMonth()&&t.setDate(0);else if(e.BYSETPOS){t.setDate(0);for(var o=0;o<e.BYSETPOS;o++)r=i.wdays[t.getDay()],t.setDate(t.getDate()+r)}}return t}function _t(t,e){var i=new Date(t),n=e.BYDAY.split(","),r=ft[i.getDay()];return{result:-1!==n.indexOf(r),start:i,days:n,oldDay:r}}function yt(t,e){var i=_t(t,e),n=i.result,r=i.days,a=i.oldDay;return n?e.BYDAY:("WEEKLY"===e.FREQ?r.splice(ft.indexOf(r[0]),0,a):r=[a],r.join(","))}function bt(t){return{id:t.$id||t.id,date:t.$recurring?t.id:null}}function xt(t){return webix.Date.dayStart(t.getDate?t:new Date(1*t.split("_")[0]))}function St(t,e,i){var n=xt(t);return(!i||!e.$recurring.UNTIL||e.$recurring.UNTIL>n)&&(e.$recurring.UNTIL=n),e.$recurring.COUNT&&delete e.$recurring.COUNT,e.$recurring.EXDATE&&(e.$recurring.EXDATE=e.$recurring.EXDATE.filter((function(t){return t<n}))),dt(e.$recurring)}function $t(t,e){var i=xt(t);return e.$recurring.EXDATE||(e.$recurring.EXDATE=[]),e.$recurring.EXDATE.push(i),dt(e.$recurring)}function Ct(t,e){var i="string"==typeof e?new Date(1*e.split("_")[0]):new Date(e),n=(t.end_date-t.start_date)/1e3/60;return{start_date:i,end_date:webix.Date.add(i,n,"minute",!0)}}function kt(t,e){return!!t&&(t.getDate?t:new Date(1*t.split("_")[0]))<=e}function Dt(t,e){return t.origin_id&&t.recurring?this.app.getService("local").isLastPart(t)&&(e=""):e="all",e}function Tt(t,e,i){var n=(webix.Date.dayStart(e.start_date)-webix.Date.dayStart(i.start_date))/864e5;if(n){if(t.UNTIL){var r=webix.Date.add(t.UNTIL,n,"day",!0);r>e.end_date?t.UNTIL=r:t.UNTIL=webix.Date.dayStart(webix.Date.add(e.end_date,1,"day",!0))}if(t.BYDAY&&((n%=7)<0&&(n+=7),t.BYDAY=t.BYDAY.split(",").map((function(t){return ft[(ft.indexOf(t)+n)%7]})).join(",")),t.BYMONTHDAY){var a=e.start_date.getDate();a!=t.BYMONTHDAY&&(t.BYMONTHDAY=a)}}if(t.BYSETPOS){var o=Et(e.start_date);t.BYSETPOS!=o&&(t.BYSETPOS=o)}if(t.BYMONTH){var s=e.start_date.getMonth()+1;s!=t.BYMONTH&&(t.BYMONTH=s)}return t}function Et(t){var e=t.getDate();return Math.floor(e/7)+(e%7?1:0)}function Lt(t){var e=t.$recurring||ht(t.recurring);"WEEKLY"!==e.FREQ||e.BYDAY?"MONTHLY"!==e.FREQ&&"YEARLY"!==e.FREQ||e.BYSETPOS||e.BYMONTHDAY||e.BYYEARDAY?"YEARLY"!==e.FREQ||e.BYMONTH||e.BYYEARDAY?(e.BYDAY&&(e.BYDAY=yt(t.start_date,e)),e.BYMONTHDAY&&(e.BYMONTHDAY=t.start_date.getDate()),e.BYMONTH&&(e.BYMONTH=t.start_date.getMonth()+1),e.BYSETPOS&&(e.BYSETPOS=Et(t.start_date)),t.recurring=dt(e)):e.BYMONTH=t.start_date.getMonth():e.BYMONTHDAY=t.start_date.getDate():e.BYDAY=ft[t.start_date.getDay()]}var At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n=webix.skin.$active,r={view:"form",localId:"recurringForm",hidden:!0,elementsConfig:{labelPosition:"left"},padding:{top:n.layoutPadding.form,bottom:0,left:i?n.layoutPadding.form:0,right:i?14:0},borderless:!0,rows:[this.CreateIntervalControls(e),{localId:"customRecControls",hidden:!0,rows:[this.CreateCheckboxes(e),this.CreateSelect(e)]},this.CreateRadio(e)]};return i||(r.on={onChange:function(e,i,n){return t.UpdateEvent(n)}}),r},e.prototype.init=function(){this.State=this.app.getState(),this.Form=this.$$("recurringForm"),this.Events=this.app.getService("local").events(!0),this.CheckBoxContainer=this.$$("weekly"),this.Checkboxes=this.CheckBoxContainer.getChildViews().slice(1),this.Checkboxes.pop(),this.PatternSelect=this.$$("patternSelect"),this.UntilDateContainer=this.$$("untilDate"),this.UntilDateCalendar=this.Form.elements.untilDate.getPopup().getBody(),this.UntilNumContainer=this.$$("untilCount"),this.UntilNum=this.UntilNumContainer.getBody(),this.CustomRecControls=this.$$("customRecControls")},e.prototype.CreateIntervalControls=function(t){var e=this;return{margin:8,cols:[{view:"counter",label:t("Every"),labelWidth:50,min:1,name:"INTERVAL",css:"webix_scheduler_counter"},{view:"richselect",name:"FREQ",options:[{id:"DAILY",value:t("day")},{id:"WEEKLY",value:t("week")},{id:"MONTHLY",value:t("month")},{id:"YEARLY",value:t("year")}],on:{onChange:function(t){return e.ChangeControls(t)}}}]}},e.prototype.ChangeControls=function(t){this._freq=t,"DAILY"===t?this.CustomRecControls.hide():(this.CustomRecControls.show(),"WEEKLY"===t?(this.CheckBoxContainer.show(),this.PatternSelect.hide()):(this.CheckBoxContainer.hide(),"MONTHLY"===t&&3==this.PatternSelect.getValue()&&this.PatternSelect.setValue(1),this.PatternSelect.show(),this.PatternSelect.getList().refresh(),this.PatternSelect.refresh()))},e.prototype.CreateCheckboxes=function(t){for(var e=[],i=0;i<7;++i)e.push({view:"checkbox",label:webix.i18n.calendar.dayShort[i],labelPosition:"top",labelAlign:"center",css:"webix_scheduler_day_checkbox",inputWidth:26,width:45,align:"center",name:ft[i],on:{onChange:function(t,e){this.$scope.CheckboxGuard(this.config.name,t,e)}}});return{localId:"weekly",cols:a([{view:"label",label:t("on"),width:45}],e,[{gravity:1e-5}])}},e.prototype.CheckboxGuard=function(t,e,i){var n;webix.isUndefined(i)||e||this.GetBYDAY()||this.Form.setValues(((n={})[t]=1,n),!0)},e.prototype.SetBYDAY=function(t){var e=t.BYDAY.split(",");this.Checkboxes.forEach((function(i){t[i.config.name]=!!e.find((function(t){return t==i.config.name}))}))},e.prototype.GetBYDAY=function(){var t=[];return this.Checkboxes.forEach((function(e){e.getValue()&&t.push(e.config.name)})),t.join(",")},e.prototype.CreateSelect=function(t){var e=this;return{view:"richselect",localId:"patternSelect",name:"rec_pattern",suggest:{data:[],body:{template:function(i){if("YEARLY"===e._freq&&i.BYYEARDAY)return t("Every")+" "+i.BYYEARDAY+" "+t("day of year");var n=[];i.BYDAY&&i.BYDAY.forEach((function(t){return n.push(webix.i18n.calendar.dayFull[t])}));var r=t("Every")+" "+(i.BYMONTHDAY||i.BYSETPOS)+" "+(i.BYDAY?n.join(", "):"");return"YEARLY"===e._freq&&(r+=" "+t("of")+" "+webix.i18n.calendar.monthFull[i.BYMONTH-1]),r}},on:{onShow:function(){var t=this;this.getList().filter((function(e){return"YEARLY"===t.$scope._freq||3!=e.id}))}}}}},e.prototype.SetPatternOptions=function(t,e){this.PatternSelect.getList().parse([{id:1,BYMONTH:t.BYMONTH||e.month+1,BYMONTHDAY:t.BYMONTHDAY||e.day},{id:2,BYSETPOS:t.BYSETPOS||e.weekNum,BYDAY:[e.weekday],BYMONTH:t.BYMONTH||e.month+1},{id:3,BYYEARDAY:t.BYYEARDAY||e.yearday}]),this.PatternSelect.refresh(),this._freq=t.FREQ,t.rec_pattern=t.BYSETPOS?2:t.BYYEARDAY?3:1},e.prototype.GetRecPattern=function(t){var e=webix.copy(this.PatternSelect.getList().getItem(t.rec_pattern));return"MONTHLY"===this._freq&&delete e.BYMONTH,e.BYDAY&&(e.BYDAY=e.BYDAY.map((function(t){return ft[t]})).join(",")),delete e.id,e},e.prototype.CreateRadio=function(t){var e=this;return{rows:[{view:"label",label:t("End repeat")},{cols:[{view:"radio",name:"until",localId:"until",vertical:!0,options:[{id:1,value:t("never")},{id:2,value:t("date")},{id:3,value:t("after several occurrences")}],on:{onChange:function(t){return e.ChangeSelectors(t)}}},{width:130,rows:[{localId:"untilDate",align:"middle",view:"align",body:{view:"datepicker",name:"untilDate",icons:!1}},{localId:"untilCount",view:"align",align:"bottom",body:{name:"untilCount",view:"counter",css:"webix_scheduler_counter",min:1}}]}]}]}},e.prototype.ChangeSelectors=function(t){this.UntilDateContainer["2"===t?"show":"hide"](),this.UntilNumContainer["3"===t?"show":"hide"]()},e.prototype.SetUNTIL=function(t){var e=this._StartDate;t.until=t.COUNT?3:t.UNTIL?2:1,t.untilDate=t.UNTIL||webix.Date.add(e,1,"year",!0),t.untilCount=t.COUNT||this.CountNum(t),this.UntilDateCalendar.define({minDate:e})},e.prototype.CountNum=function(t){var e=0;if(t.UNTIL){var i={};mt(t,i);for(var n=webix.Date.copy(this._StartDate);n<=t.UNTIL;)n=wt(n,t,i),e++}else e=3;return e},e.prototype.SetValues=function(t,e,i){if(!e)return this.Form.setValues(t,!0);this._StartDate=t.start_date;var n=t.$recurring;n||(n={FREQ:"DAILY"}),n.INTERVAL||(n.INTERVAL=1),n.BYDAY||(n.BYDAY=ft[e.weekday]),n.EXDATE||(n.EXDATE=[]),this.SetUNTIL(n),this.SetBYDAY(n),this.SetPatternOptions(n,e),this.Form.setValues(n,!0),i&&this.Form.setDirty()},e.prototype.GetValues=function(){var t=this.Form.getValues(),e={FREQ:t.FREQ,INTERVAL:t.INTERVAL,UNTIL:2==t.until?t.untilDate:this.GetUntil(t),COUNT:3==t.until?t.untilCount:null,EXDATE:t.EXDATE||[]};return"WEEKLY"===t.FREQ?e.BYDAY=this.GetBYDAY(t):"MONTHLY"!==t.FREQ&&"YEARLY"!==t.FREQ||(e=webix.extend(e,this.GetRecPattern(t))),this.Form.setDirty(),e},e.prototype.GetUntil=function(t){if(3==t.until){var e={};mt(t,e);for(var i=webix.Date.copy(this._StartDate),n=1;n<t.untilCount;++n)i=wt(i,t,e);return i=webix.Date.add(i,1,"day",!0),this.Form.setValues({untilDate:i},!0),i}return null},e.prototype.UpdateEvent=function(t){if("user"===t){var e=this.GetValues();this.app.callEvent("form:update:recurring",[{$recurring:e}]),this.Form.setDirty()}},e.prototype.IsDirty=function(){return this.Form.isDirty()},e.prototype.Show=function(){this.getRoot().show()},e.prototype.Hide=function(){this.getRoot().hide()},e}(p);function It(t,e,i,n){return t&&"next"===t&&kt(n,i)&&(t=Dt.call(this,e,t)),t}function Pt(t,e,i,n){for(var r=t.origin_id||t.$id||t.id,a=n.find((function(t){return r==t.origin_id&&i<t.start_date})).sort((function(t,e){return t.start_date>e.start_date?-1:t.start_date<e.start_date?1:0})),o=webix.copy(t.$recurring),s=0,l=void 0;s<a.length;++s)if((l=a[s]).$recurring){if(!l.$recurring.COUNT){o.UNTIL=l.$recurring.UNTIL;break}if(!o.COUNT||t.$id==l.id){o.UNTIL=Mt(l);break}o.COUNT=1*o.COUNT+1*l.$recurring.COUNT}return"next"!==e||a.length||(o.COUNT?o.COUNT=function(t,e){var i=xt(e),n={};mt(t.$recurring,n);for(var r=webix.Date.dayStart(t.start_date),a=0;r<i;)a++,r=wt(r,t.$recurring,n);return t.$recurring.COUNT-a}(t,i):o.UNTIL&&t.start_date>=o.UNTIL&&(o.UNTIL=webix.Date.add(webix.Date.dayStart(t.start_date),1,gt[o.FREQ],!0))),o}function Rt(t){if(!t.recurring)return!0;if(!t.$recurring.UNTIL)return!1;var e=webix.Date.dayStart(webix.Date.add(t.end_date,1,"day",!0));return webix.Date.equal(e,t.$recurring.UNTIL)}function Mt(t){var e=t.$recurring,i=1*e.COUNT;return"WEEKLY"===e.FREQ&&(i=Math.floor(e.BYDAY.split(",").length/7*e.COUNT)),webix.Date.add(t.start_date,i,gt[e.FREQ],!0)}function Vt(t){t.ChangeMode=It,t.CorrectCountUntil=Pt,t.HasOneOccurrence=Rt}var Ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;this.Compact=this.getParam("compact",!0);var i=webix.skin.$active,n={view:"toolbar",borderless:!0,padding:{left:i.layoutPadding.form-(i.inputHeight-20)/2,right:14},elements:[{view:"icon",icon:"wxi-close",tooltip:e("Close"),hotkey:"esc",click:function(){return t.Close()}},{view:"label",label:e("Edit event")},{view:"button",width:130,css:"webix_primary",value:e("Done"),hotkey:"Ctrl+Enter",click:function(){return t.Done()}}]},r={view:"form",localId:"form",scroll:!0,borderless:!0,padding:{right:14},elementsConfig:{labelPosition:"top"},elements:[{view:"text",label:e("Event"),name:"text"},{margin:8,rows:[this.GetDateTime("start",e,i),this.GetDateTime("end",e,i)]},{view:"checkbox",name:"all_day",labelPosition:"left",labelWidth:0,labelRight:e("All Day"),on:{onChange:function(e){return t.ToggleTimeControls(e)}}},this.CreateCalendarColor(e),{view:"textarea",label:e("Notes"),name:"details",height:150},{}],on:{onChange:function(e,i,n){var r=t.Form.getDirtyValues();Object.keys(r).length&&t.PrepareChange(r),t.Compact||"user"!==n||t.Wait((function(){return t.UpdateEvent(r)}))}}};if(this.app.config.recurring&&r.elements.splice(3,0,this.CreateRepeat(e,i)),this.app.config.units){var a=this.app.config.recurring?5:4;r.elements.splice(a,0,this.CreateUnitSelector(e))}return this.app.config.timeline&&(a=this.app.config.recurring?5:4,this.app.config.units&&a++,r.elements.splice(a,0,this.CreateSectionSelector(e))),{view:"proxy",body:{margin:0,rows:[n,r]}}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.Form=this.$$("form"),this.Local=this.app.getService("local").events(!0),this.Ops=this.app.getService("operations"),Vt(this),this.RecurringOptions=this.$$("recOption"),this.StartTime=this.$$("startTime"),this.EndTime=this.$$("endTime"),this.on(this.State.$changes,"readonly",(function(e,i){webix.isUndefined(i)||t.Close()})),this.on(this.app,"form:update:recurring",(function(e){Object.keys(e).length&&t.PrepareChange(e),t.UpdateEvent(e)}));var e=this.app.getService("local");if(this.app.config.calendars&&(this.Calendars=e.calendars(!0),this.$$("calendar").getList().parse(this.Calendars)),this.app.config.units){var i=e.units(),n=this.Form.elements.units;i.then((function(t){n.getList().parse(t),n.refresh()}))}this.app.config.timeline&&(this.Sections=e.sections(!0),this.$$("sections").getList().parse(this.Sections))},e.prototype.ready=function(){var t=this;this.SubForm=this.getSubView("recurringForm"),this.on(this.State.$changes,"selected",(function(e){e&&(t.ClearTempEvent(),t.Wait((function(){return t.FillForm(e)})))}))},e.prototype.destroy=function(){this.ClearTempEvent()},e.prototype.CreateRepeat=function(t,e){var i=this,n=[{view:"label",label:t("Repeat"),height:e.labelTopHeight},{margin:4,cols:[{view:"richselect",localId:"recOption",name:"rec_option",suggest:{data:[{id:"none",value:t("never")},{id:"daily",value:t("daily")},{id:"weekly"},{id:"monthly"},{id:"yearly"},{id:"work",value:t("every working day")},{id:"custom",value:t("custom")}]},on:{onChange:function(t,e){return i.ToggleSubform(t,e)}}}]}];return this.Compact&&n[1].cols.push({localId:"editCustomRec",view:"icon",icon:"wxi-pencil",tooltip:t("Change recurring pattern"),hidden:!0,click:function(){return i.ShowSubForm()}}),n.push({$subview:At,name:"recurringForm"}),{localId:"repeatControls",rows:n}},e.prototype.ToggleTimeControls=function(t){1==t?(this.StartTime.hide(),this.EndTime.hide()):(this.StartTime.show(),this.EndTime.show())},e.prototype.ToggleSubform=function(t,e){"custom"===t?this.Compact?(this.$$("editCustomRec").show(),e&&this.ShowSubForm()):this.SubForm.Show():(this.SubForm.Hide(),this.Compact&&this.$$("editCustomRec").hide())},e.prototype.CreateCalendarColor=function(t){var e={margin:8,cols:[{view:"colorpicker",label:t("Color"),name:"color",value:"#1abc9c",suggest:{type:"colorboard",padding:3,body:J()}}]};return this.app.config.calendars&&e.cols.unshift({view:"richselect",localId:"calendar",label:t("Calendar"),name:"calendar",css:"webix_scheduler_cal_color",options:{css:"webix_scheduler_cal_color_suggest",data:[],body:{tooltip:function(){return""},template:function(e){var i=1*e.active,n=i?"":"class='webix_scheduler_cal_disabled'";return'<div style="overflow: hidden;" '+(i?"":'webix_tooltip="'+t("Inactive calendar")+'"')+" "+n+">"+(e.text||t("(no title)"))+'\n\t\t\t\t\t\t\t\t<span class="webix_scheduler_cal_marker" style="background-color:'+e.color+';">\n\t\t\t\t\t\t\t</span></div>'}}}}),e},e.prototype.CreateUnitSelector=function(t){return{view:"multicombo",name:"units",label:t("Units"),options:[]}},e.prototype.GetDateTime=function(t,e,i){return{rows:[{view:"label",height:i.labelTopHeight,label:e("start"===t?"Start":"End")},{margin:8,cols:[{view:"datepicker",name:t+"_date",suggest:{type:"calendar",icons:!1}},{view:"datepicker",localId:t+"Time",name:t+"_time",type:"time",format:"%H:%i"}]}]}},e.prototype.CreateSectionSelector=function(t){return{localId:"sections",view:"richselect",label:t("Section"),name:"section",options:{data:[],body:{template:"#text#"}}}},e.prototype.FillForm=function(t){var e,i=this;if(this.Id=t.id,this.Form.focus(),this.Date=t.date,"string"==typeof this.Date&&(this.Date=new Date(1*this.Date.slice(0,this.Date.indexOf("_")))),"0"==t.id){if(this.State.clipboard&&this.State.clipboard.selected?(e=this.State.clipboard.selected,this.$$("repeatControls").hide()):e=this.NewEvent(t),e.then)return e.then((function(e){i.Local.add(r({id:t.id},webix.copy(e))),i.FillFormContinue(e)}));this.Local.add(r({id:t.id},webix.copy(e)))}else{e=webix.copy(this.Local.getItem(t.id));var n=this.getParam("mode",!0);n&&(e=this.AdaptObjToMode(n,e))}this.FillFormContinue(e)},e.prototype.AdaptObjToMode=function(t,e){return t=this.ChangeMode(t,e,e.recurring?e.start_date:this.Local.getItem(e.origin_id).start_date,e.recurring?this.State.selected.date:e.start_date),this.setParam("mode",t,!0),"all"!==t&&"next"!==t||("all"===t&&e.origin_id&&(e=webix.copy(this.Local.getItem(e.origin_id))),e.$recurring||(e.$recurring=webix.copy(this.Local.getItem(e.origin_id).$recurring)),(e.$recurring.COUNT||e.$recurring.UNTIL)&&(e.$recurring=this.CorrectCountUntil(e,t,e.start_date,this.Local))),"this"!==t&&"next"!==t||(this.State.selected.date&&(e=r(r({},e),Ct(e,this.State.selected.date))),"this"===t&&(e.$recurring=null,e.recurring="",this.$$("repeatControls").hide())),e},e.prototype.FillFormContinue=function(t){t.start_time=webix.Date.copy(t.start_date),t.end_time=webix.Date.copy(t.end_date),t.start_date=webix.Date.datePart(t.start_date),t.end_date=webix.Date.datePart(t.end_date),this.app.config.recurring&&this.SetRecurring(t),this.Form.setValues(t)},e.prototype.GetFromStartDate=function(t){var e,i={weekday:t.getDay(),day:t.getDate(),month:t.getMonth(),yearday:(e=t,(e-webix.Date.yearStart(e))/1e3/60/60/24+1)};return i.weekNum=Math.floor(i.day/7)+(i.day%7?1:0),i},e.prototype.SetRecurring=function(t){var e=this.GetFromStartDate(t.start_date),i=this.ResetRecurringOptions(e);this.RecurringOptions.getList().parse(i),this.SubForm.SetValues(webix.copy(t),e,!0),t.$recurring?"MO,TU,WE,TH,FR"===t.$recurring.BYDAY?t.rec_option="work":t.$recurring.UNTIL||t.$recurring.COUNT||t.$recurring.INTERVAL&&1!=t.$recurring.INTERVAL||!("DAILY"===t.$recurring.FREQ||"WEEKLY"===t.$recurring.FREQ&&t.$recurring.BYDAY==ft[e.weekday]||"MONTHLY"===t.$recurring.FREQ&&t.$recurring.BYSETPOS&&t.$recurring.BYSETPOS==e.weekNum&&t.$recurring.BYDAY==ft[e.weekday]||"YEARLY"===t.$recurring.FREQ&&t.$recurring.BYMONTH==e.month+1&&t.$recurring.BYMONTHDAY==e.day)?t.rec_option="custom":t.rec_option=t.$recurring.FREQ.toLowerCase():t.rec_option="none"},e.prototype.ResetRecurringOptions=function(t){var e=this.app.getService("locale")._;return[{id:"weekly",value:e("weekly, every")+" "+webix.i18n.calendar.dayFull[t.weekday]},{id:"monthly",value:e("monthly, every")+" "+t.weekNum+" "+e("week on")+" "+webix.i18n.calendar.dayFull[t.weekday]},{id:"yearly",value:e("yearly, every")+" "+webix.i18n.calendar.monthFull[t.month]+" "+t.day}]},e.prototype.Join=function(t,e){return webix.Date.add(t,webix.Date.timePart(e)/60,"minute",!0)},e.prototype.NewEvent=function(t){var e=this,i=this.GetStartDate(),n={start_date:i,end_date:this.State.selected.end_date||webix.Date.add(i,1,"hour",!0),text:"",details:""};if(this.app.config.recurring&&(n.recurring=""),this.app.config.timeline&&(n.section=t.section||this.Sections.getFirstId()),this.app.config.calendars){var r=this.State.active[0];if(!r){var a=this.Calendars.getFirstId();return(a?this.Ops.updateCalendar(a,{active:1}):this.Ops.addCalendar()).then((function(){return n.calendar=e.State.active[0],n.$color=e.Calendars.getItem(n.calendar).color,n}))}n.calendar=r,n.$color=this.Calendars.getItem(n.calendar).color}else n.$color="#01C2A5";return this.app.config.calendars&&t.unit&&(n.units=t.unit),n},e.prototype.GetStartDate=function(){if(this.Date)return webix.Date.copy(this.Date);var t=new Date,e=30*Math.ceil(t.getMinutes()/30),i=webix.Date.copy(this.State.date);return i.setHours(t.getHours(),e),i},e.prototype.UpdateEvent=function(t){var e=this;if(this.Form.setDirty(),"0"===this.Id){var i=this.PrepareOut(t);this._inProgress=this.Ops.addEvent(i,!0,this.Id)}else Object.keys(t).length&&(this._inProgress=this.UpdateExisting(this.Id,t));return this._inProgress&&(this.app.callEvent("backend:operation",[this._inProgress]),this._inProgress.then((function(i){i&&e.UpdateSelection(i),e.ChangeDate(t,e.Form.getValues()),e.setParam("mode","",!0)})).finally((function(){e._inProgress=null}))),this._inProgress||webix.promise.resolve()},e.prototype.UpdateExisting=function(t,e){var i=this,n=this.getParam("mode",!0),r=this.Local.getItem(t);if("this"===n&&!this.HasOneOccurrence(r)||"next"===n){e.origin_id=r.origin_id||r.id;var a=this.PrepareOut(e),o="";if("this"===n)o=$t(this.State.selected.date,r);else{var s=void 0;r.recurring?s=[this.State.selected.date,r]:(t=r.origin_id,s=[a.start_date,this.Local.getItem(t)]),o=St.apply(void 0,s)}return this.Ops.updateEvent(t,{recurring:o},n,webix.Date.dayStart(a.start_date),!0).then((function(){return"none"===e.rec_option&&(i.State.selected.date=null),i.Ops.addEvent(a,!0)}))}if("all"===n){var l=this.Form.getValues().$recurring;l&&webix.isUndefined(e.recurring)&&(delete l.EXDATE,e.recurring=dt(l),this.Form.setValues({$recurring:l,recurring:e.recurring},!0),this.SubForm.SetValues({EXDATE:null})),r.origin_id&&(this.Id=this.State.selected.id=r.origin_id)}return this.Ops.updateEvent(this.Id,e,n,void 0,!0).then((function(){"none"===e.rec_option&&(i.State.selected.date=null)}))},e.prototype.UpdateSelection=function(t){this.State.selected.id=this.Id=t;var e=this.State.selected.date;if(e instanceof Date)this.State.selected.date=null;else if(e){var i=this.Form.getValues();this.State.selected.date=this.Join(i.start_date,i.start_time).valueOf()+"_"+t}},e.prototype.PrepareChange=function(t){t.rec_option?this.ProcessRecurringOption(t):webix.isUndefined(t.$recurring)||this.ProcessRecurringPattern(t),this.ProcessDates(t),this.app.config.recurring&&t.start_date&&this.ApplyDatechangeToRecurring(t),this.ProcessText(t,"text"),this.ProcessText(t,"details"),this._changedValues=t},e.prototype.ProcessRecurringOption=function(t){var e=this.Form.getValues();"none"===t.rec_option?(t.recurring="",t.series_end_date=""):"custom"===t.rec_option?(e.$recurring&&this.SubForm.SetValues(r(r({},e),t),this.GetFromStartDate(e.start_date)),t.$recurring=this.SubForm.GetValues(),this.ProcessRecurringPattern(t),e.$recurring||this.Form.setValues({$recurring:t.$recurring},!0)):(this.GetRecurring(t.rec_option,t,e.start_date),t.series_end_date=""),delete t.rec_option,delete t.$recurring},e.prototype.ProcessRecurringPattern=function(t){var e,i=this.Form.getValues(),n=dt(t.$recurring),r=this.Local.getItem(this.State.selected.id);r&&n===r.recurring||(t.recurring=n,t.series_end_date=t.$recurring.UNTIL,t.$recurring.BYDAY&&(e=function(t,e,i){var n=_t(t,i),r=n.result,a=n.start,o=n.days;if(r)return[t,e];var s=ft.indexOf(o[0])-a.getDay();a.setDate(a.getDate()+s);var l=new Date(e);return l.setDate(l.getDate()+s),[a,l]}(i.start_date,i.end_date,t.$recurring),t.start_date=e[0],t.end_date=e[1]),this.Form.setValues(t,!0)),delete t.$recurring},e.prototype.ProcessDates=function(t){var e=this.Form.getValues();webix.isUndefined(t.all_day)?((t.start_date||t.start_time)&&0==e.all_day&&(t.start_date=this.Join(e.start_date,e.start_time)),(t.end_date||t.end_time)&&0==e.all_day&&(t.end_date=this.Join(e.end_date,e.end_time))):1==t.all_day?(t.start_date=e.start_date,t.end_date=e.end_date):0==t.all_day&&(t.start_date=this.Join(e.start_date,e.start_time),t.end_date=this.Join(e.end_date,e.end_time)),(t.start_date||t.end_date)&&this.CorrectDateTime(t)},e.prototype.CorrectDateTime=function(t){var e=this.Form.getValues(),i=this.Local.getItem(this.State.selected.id),n=(i.end_date-i.start_date)/1e3/60,r=t.start_date?"start":"end",a="start"===r?"end":"start",o=t.start_date||i.start_date,s=t.end_date||i.end_date;(o>=s&&!e.all_day||o>s)&&(t[a+"_date"]=webix.Date.add(t[r+"_date"],("start"===r?1:-1)*(n||60),"minute",!0),this.Form.setValues({start_date:webix.Date.datePart(t.start_date,!0),end_date:webix.Date.datePart(t.end_date,!0),start_time:t.start_time||webix.Date.copy(t.start_date),end_time:t.end_time||webix.Date.copy(t.end_date)},!0)),delete t.start_time,delete t.end_time},e.prototype.ProcessText=function(t,e){if(!this.webix.isUndefined(t[e])){t[e]=t[e].replace(/(<[^>]+>|^\s+|\s+$)/gi,"");var i=this.Local.getItem(this.State.selected.id)[e]||"";t[e]===i.trim()&&delete t[e]}},e.prototype.ApplyDatechangeToRecurring=function(t){var e=this.GetFromStartDate(t.start_date),i=this.Form.getValues();if(!t.recurring&&i.$recurring)if("custom"===i.rec_option){var n=i.$recurring;if(n.BYYEARDAY&&(n.BYYEARDAY=e.yearday),n.BYMONTH&&(n.BYMONTH=e.month+1),n.BYMONTHDAY&&(n.BYMONTHDAY=e.day),n.BYSETPOS&&(n.BYSETPOS=e.weekNum),n.BYDAY&&(n.BYDAY=yt(t.start_date,i.$recurring)),n.UNTIL&&n.UNTIL<t.start_date){var a=this.Local.getItem(this.State.selected.id).start_date,o=(i.$recurring.UNTIL-a)/1e3/60;n.UNTIL=webix.Date.add(t.start_date,o,"minute",!0)}t.recurring=dt(n),this.SubForm.SetValues(r(r({},i),t),e)}else this.GetRecurring(i.rec_option,t,i.start_date),delete t.$recurring;this.RecurringOptions.getList().parse(this.ResetRecurringOptions(e)),this.RecurringOptions.refresh()},e.prototype.GetRecurring=function(t,e,i){var n=this.GetRecurringPreset(t,i);if("work"===t&&e.start_date){var r=yt(e.start_date,n);n.BYDAY!==r&&(n.BYDAY=r,t="custom")}var a=dt(n),o=this.Local.getItem(this.State.selected.id);o&&a===o.recurring||(e.$recurring=n,e.recurring=a,this.Form.setValues({$recurring:e.$recurring,recurring:a,rec_option:t},!0))},e.prototype.GetRecurringPreset=function(t,e){var i=this.GetFromStartDate(e);switch(t){case"daily":default:return{FREQ:"DAILY",INTERVAL:1};case"weekly":return{FREQ:"WEEKLY",INTERVAL:1,BYDAY:ft[i.weekday]};case"work":return{FREQ:"WEEKLY",INTERVAL:1,BYDAY:"MO,TU,WE,TH,FR"};case"monthly":return{FREQ:"MONTHLY",INTERVAL:1,BYSETPOS:i.weekNum,BYDAY:ft[i.weekday]};case"yearly":return{FREQ:"YEARLY",INTERVAL:1,BYMONTH:i.month+1,BYMONTHDAY:i.day}}},e.prototype.ChangeDate=function(t,e){if(t)if(t.start_date&&!e.recurring||""===t.recurring)this.State.selected.date=null,this.UpdateStateDate(t.start_date||e.start_date);else if(t.start_date||t.recurring){var i=this.GetClosestOccurrenceDate(t,e);this.State.selected.date=i.valueOf()+"_"+this.State.selected.id,this.UpdateStateDate(i)}},e.prototype.GetClosestOccurrenceDate=function(t,e){var i=t.start_date?webix.Date.copy(t.start_date):this.Join(e.start_date,e.start_time),n=webix.Date.dayStart(this.State.selected.date?new Date(1*this.State.selected.date.split("_")[0]):i);e.series_end_date&&(n=new Date(Math.min(webix.Date.add(e.series_end_date,-1,"day",!0),n)));var r={};mt(e.$recurring,r);for(var a=webix.Date.copy(i);webix.Date.dayStart(a)<n;)a=wt(a,e.$recurring,r),Math.abs(n-a)<Math.abs(n-i)&&(i=webix.Date.copy(a));return i},e.prototype.UpdateStateDate=function(t){t=webix.Date.dayStart(t);var e=this.State;if("day"===e.mode||"units"===e.mode||"timeline"===e.mode&&"day"===e.timelineMode){var i=webix.Date.dayStart(e.date);webix.Date.equal(t,i)||(e.date=webix.Date.dayStart(t))}else{var n=this.GetModeBounds(),r=n.start,a=n.end;(t<r||t>=a)&&(e.date=webix.Date.dayStart(t))}},e.prototype.GetModeBounds=function(){var t=this.State,e=t.mode;"timeline"===e?e=t.timelineMode:"agenda"===e&&(e="month");var i=webix.Date[e+"Start"](t.date),n=webix.Date.add(i,1,e,!0);if("month"===t.mode){i=webix.Date.weekStart(i);var r=Math.ceil((n-i)/864e5/7);n=webix.Date.add(i,r,"week",!0)}return{start:i,end:n}},e.prototype.PrepareOut=function(t){var e=this.Form.getValues();return e.all_day||(e.start_date=this.Join(e.start_date,e.start_time),e.end_date=this.Join(e.end_date,e.end_time)),e=webix.extend(e,t||{},!0),t&&t.recurring||!e.$recurring||(e.$recurring.EXDATE=[],e.recurring=dt(e.$recurring)),e.origin_id||(e.origin_id=0),this.app.config.timeline&&!e.section&&(e.section=0),e},e.prototype.ClearTempEvent=function(){var t=this.Id;"0"===t&&this.Local.exists(t)&&this.Local.remove(t)},e.prototype.Back=function(t){if(this.Form.clear(),t||"0"===this.State.selected.id)this.State.selected=null;else{var e=this.Compact?"event.formpopup/":"../";this.show(e+"event.info",{target:"edit"})}},e.prototype.Close=function(){var t=this;if(this._inProgress)this._inProgress.then((function(){t.Back(!0)}));else{var e=this.Form.isDirty()||this.Subform&&this.SubForm.IsDirty();if(this.Compact&&e){var i=this.app.getService("locale")._;webix.confirm({text:i("Save changes?"),container:this.app.getRoot().$view}).then((function(){return t.Done(!0)})).catch((function(){return t.Back(!0)}))}else this.Back(!0)}},e.prototype.Done=function(t){var e=this;if(this._inProgress)this._inProgress.then((function(){e.Back()}));else if("0"===this.State.selected.id||this.Compact){var i={};this.Compact&&(this._changedValues&&(i=this._changedValues),this.SubForm.IsDirty()&&(i.$recurring=this.SubForm.GetValues(),i.series_end_date=i.$recurring.UNTIL,delete i.rec_option)),this.UpdateEvent(i).then((function(){return e.Back(t)}))}else this.Back()},e.prototype.Wait=function(t){this._inProgress?this._inProgress.then(t):t.call()},e.prototype.ShowSubForm=function(){var t=this;this.SubForm.Show();var e=this.app.getService("locale")._,i=this.SubForm.getRoot(),n=webix.skin.$active;webix.fullscreen.set(i,{head:{view:"toolbar",padding:{left:n.layoutPadding.form-(n.inputHeight-20)/2,right:14},elements:[{view:"icon",icon:"shi-back",click:function(){return t.HideSubPop()}},{view:"label",label:e("Change recurring pattern")},{view:"button",value:e("Done"),width:130,css:"webix_primary",click:function(){return t.HideSubPop()}}]}}),i.getTopParentView().define({css:"webix_scheduler_subform_popup"})},e.prototype.HideSubPop=function(){this.SubForm.Hide(),webix.fullscreen.exit()},e}(p),Ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",fullscreen:!0,head:!1,body:{$subview:!0}})},e}(p);function Ht(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,n=e.handler;return webix.UIManager.removeHotKey(i,n,t)}}}function Bt(t){(t.recurring||t.$id||t.origin_id)&&(t.recurring="",delete t.$recurring,t.origin_id||(t.origin_id=t.$id||t.id),delete t.$id),delete t.id;var e=this.app.getService("locale")._;t.text&&(t.text=e("Copy of")+" "+t.text.replace(e("Copy of")+" ",""))}function Ut(t){var e=this;this.clipboardModes=["copy","cut"],this.Ops=this.app.getService("operations");var i=webix.env.isMac?"COMMAND":"CTRL";this.on(Ht(t),i+"+C",(function(t){return e.AddToClipboard(t,"copy")})),this.on(Ht(t),i+"+X",(function(t){return e.AddToClipboard(t,"cut")})),this.on(Ht(t),i+"+V",(function(t,i){return e.PasteFromClipboard(i)})),this.on(Ht(t),"Esc",(function(t,i){return e.PurgeClipboard(t,i)})),this.on(this.State.$changes,"mode",(function(){webix.UIManager.setFocus(t)})),this.on(this.State.$changes,"clipboard",(function(e,i){e?webix.html.addCss(t.$view,"webix_scheduler_clipboard_target"):i&&webix.html.removeCss(t.$view,"webix_scheduler_clipboard_target")})),this.on(this.app,"events:rendered",(function(){e.RestoreClipboardSource(t)})),this.$multi?this._globalClickHandler=webix.event(this.List.$view,"click",(function(){e.State.clipboard&&e.State.clipboard.source&&e.ChangePasteTarget(e.List.$view)})):this.on(t,"onItemClick",(function(i,n,r){e.State.clipboard&&e.State.clipboard.source&&("timeline"===e.State.mode&&(r=e.CreatePasteTarget(t,n)),e.ChangePasteTarget(r))}))}function Nt(){this._globalClickHandler&&(webix.eventRemove(this._globalClickHandler),this._globalClickHandler=null)}function jt(t,e){var i=t.getScrollState(),n=e.clientX-t.$view.offsetLeft+i.x,r=e.clientY-t.$view.offsetTop+i.y;this.mousePosUnit=Math.floor(n/this.Scales.cellWidth);var a=webix.html.create("div"),o=this.GetSectionHeight();a.style.top=r-r%o+"px",a.style.left=n-n%this.Scales.cellWidth+"px",a.style.width=this.Scales.cellWidth+"px",a.style.height=o+"px",a.style.position="absolute";var s=t.$view.firstChild;return s.insertBefore(a,s.childNodes[0]),a}function Gt(t){webix.html.addCss(t,"webix_scheduler_paste_target"),this.State.clipboard.target=t}function Yt(){var t=this.State.clipboard;if(t&&t.target){if(webix.html.removeCss(this.State.clipboard.target,"webix_scheduler_paste_target"),"timeline"===this.State.mode&&t.target.parentNode){var e=t.target;e.parentNode.removeChild(e)}this.State.clipboard.target=null}}function zt(t){this.State.clipboard.target!==t&&(this.ClearPasteTargetStyle(),this.SetPasteTargetStyle(t))}function Wt(t,e,i){return e&&t.contains(e)?e:t.querySelectorAll('[webix_e_id="'+i+'"]')[0]||t.querySelectorAll('[webix_l_id="'+i+'"]')[0]}function qt(t,e){var i=this.State.selected;if(i&&"0"!==i.id){this.ClearPasteTargetStyle();var n=Wt(t.$view,i.node,i.date||i.id);n&&this.SetClipboardSourceStyle(e,n);var r=this.GetEvent(i.date||i.id);this.State.clipboard={mode:e,selected:webix.copy(r),source:n}}}function Kt(t,e){var i="webix_scheduler_"+t;-1===e.className.indexOf(i)&&webix.html.addCss(e,i);var n="webix_scheduler_"+this.clipboardModes[1^this.clipboardModes.indexOf(t)];webix.html.removeCss(e,n);var r=this.State.clipboard;r&&r.source&&e!=r.source&&(webix.html.removeCss(this.State.clipboard.source,i),webix.html.removeCss(this.State.clipboard.source,n))}function Xt(t){var e=this.State.clipboard;if(e){var i=Wt(t.$view,e.source,e.selected.id);i&&(i!==e.source&&(this.State.clipboard.source=i),this.SetClipboardSourceStyle(e.mode,i))}}function Qt(t){var e=this.State.clipboard;if(e&&e.source){var i=this.GetEventData(e,t);"copy"===e.mode?this.CopyEvent(i):"cut"===e.mode&&this.MoveEvent(i),this.PurgeClipboard()}}function Jt(t,e){var i=t.selected,n=Math.floor(i.end_date-i.start_date)/6e4;if(i.start_date=this.GetTargetDate(e.target.getAttribute("webix_l_id")),i.end_date=webix.Date.add(i.start_date,n,"minute",!0),"units"===this.State.mode)i.units=this.Unit.id;else if("timeline"===this.State.mode){var r=e.target.getAttribute("webix_l_id");r&&(i.section=r)}return i}function Zt(t){var e=this;Bt.call(this,t),this.Ops.addEvent(t,!0).then((function(i){return e.UpdateSelection(i,t)}))}function te(t){var e=this;if(t.recurring){var i=$t(t.id,t),n=t.$id;Bt.call(this,t),this.Ops.updateEvent(n,{recurring:i},"this",t.start_date,!0).then((function(){return e.Ops.addEvent(t,!0).then((function(i){return e.UpdateSelection(i,t)}))}))}else{var r={start_date:t.start_date,end_date:t.end_date};t.units&&(r.units=t.units),t.section&&(r.section=t.section),this.Ops.updateEvent(t.id,r,null,null,!0).then((function(){e.UpdateSelection(t.id,t)}))}}function ee(){var t=this.State.clipboard;if(t){var e=t.mode,i=t.source;return webix.html.removeCss(i,"webix_scheduler_"+e),this.ClearPasteTargetStyle(),this.State.clipboard=null,!1}}function ie(t,e,i){t.AddToClipboard=qt,t.SetClipboardSourceStyle=Kt,t.RestoreClipboardSource=Xt,t.PasteFromClipboard=Qt,t.GetEventData=Jt,t.CopyEvent=Zt,t.MoveEvent=te,t.ClearPasteTargetStyle=Yt,t.SetPasteTargetStyle=Gt,t.ChangePasteTarget=zt,t.CreatePasteTarget=jt,t.PurgeClipboard=ee,i&&i.multi&&(t.$multi=!0,t.destroy=Nt),Ut.call(t,e)}var ne,re,ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=webix.skin.$active,n={view:"toolbar",borderless:!0,padding:{left:i.layoutPadding.form-(i.inputHeight-20)/2,right:14},elements:[{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){return t.Back()}},{},{width:130,view:"button",localId:"edit",label:e("Edit"),css:"webix_primary",click:function(){this.$scope.StartAction("Edit",this.$view)}}]};return this.app.config.copypaste&&n.elements.splice(-1,0,{view:"icon",icon:"shi-content-copy",tooltip:e("Copy event"),click:function(){return t.CopyEvent()}}),{view:"proxy",body:{margin:0,rows:[n,{type:"form",padding:{right:16},borderless:!0,rows:[{localId:"text",view:"template",css:"webix_scheduler_info",template:function(e){return e.start_date?t.InfoTemplate(e):""},borderless:!0},{view:"button",localId:"remove",label:e("Delete event"),css:"webix_danger webix_scheduler_danger",align:"center",inputWidth:330,click:function(){this.$scope.StartAction("Delete",this.$view)}}]}]}}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.UnitsLocal=this.app.getService("local").units(!0),this.on(this.State.$changes,"readonly",(function(e){var i=e?"hide":"show";t.$$("edit")[i](),t.$$("remove")[i]()}));var e=this.$$("text");this.on(this.State.$changes,"selected",(function(i){i&&(t.EventObj=t.app.getService("local").events(!0).getItem(i.id),e.setValues(t.EventObj))})),this.Menu=this.ui(rt),this.app.config.units&&this.app.getService("local").units().then((function(){e.refresh()})),this.app.config.timeline&&this.app.getService("local").sections().then((function(i){t.Sections=i,e.refresh()}))},e.prototype.StartAction=function(t,e){var i=this;this.app.config.recurring&&("string"==typeof this.State.selected.date||this.EventObj.origin_id)?this.Menu.Show(e).then((function(e){"Delete"===t?i.DeleteEvent(e):i.EditEvent(e)})):"Delete"===t?this.DeleteEvent():this.EditEvent()},e.prototype.EditEvent=function(t){var e=this.getParam("compact",!0)?"event.formpopup/":"../";this.show(e+"event.form",{target:"edit",params:{mode:t}})},e.prototype.DeleteEvent=function(t){var e=this,i=this.app.getService("locale")._;webix.confirm({title:i("Delete event"),text:i("The event will be deleted permanently, are you sure?"),container:this.app.getRoot().$view}).then((function(){var i=e.EventObj,n="";t&&"all"!==t&&(e.State.selected?n=e.State.selected.date:i.$id&&(n=i.id)),e.app.getService("operations").removeEvent(e.EventObj,t,n),e.Back(!0)}))},e.prototype.CopyEvent=function(){var t=webix.copy(this.EventObj);Bt.call(this,t),this.State.$batch({selected:{id:"0"},clipboard:{mode:"copy",selected:t}})},e.prototype.Back=function(t){if(t){var e=this.State.clipboard;e&&(e.selected.id===this.EventObj.id||e.selected.id.indexOf("_"+this.EventObj.id)>-1)&&(this.State.clipboard=null)}this.State.selected=null},e.prototype.InfoTemplate=function(t){var e=this,i=this.app.getService("locale")._;this.app.config.recurring&&this.State.selected.date&&(t=r(r({},t),Ct(t,this.State.selected.date)));var n=[t.start_date,t.end_date],a=n[0],o=n[1],s=webix.Date.equal(webix.Date.datePart(a,!0),webix.Date.datePart(o,!0)),l=webix.Date.equal(webix.Date.datePart(a,!0),a)&&webix.Date.equal(webix.Date.datePart(o,!0),o)&&t.all_day,u=webix.i18n.timeFormatStr,c=webix.i18n.longDateFormatStr,h='<div class="webix_scheduler_event_title">'+(t.text||i("(No title)"))+"</div>",p=c(a),d=c(o),f=u(a),g=u(o),v="";s?(v='<div class="webix_scheduler_event_text">'+p+"</div>",l||(v+='<div class="webix_scheduler_event_text">'+i("from")+" "+f+" "+i("to")+" "+g+"</div>")):v='<div class="webix_scheduler_event_text">'+i("from")+" "+(l?"":f)+" "+p+'</div><div class="webix_scheduler_event_text">'+i("to")+" "+(l?"":g)+" "+d+"</div>";var m=this.app.config.recurring&&t.recurring?this.GetRecurringText(t,i):"",w="";if(this.app.config.units){if(w+='<div class="webix_scheduler_event_units_title">'+i("Assigned to units")+':</div><div class="webix_scheduler_event_units">',t.units){var _=t.units.split(",");_.forEach((function(t,n){var r=n===_.length-1,a=e.UnitsLocal.getItem(t),o=a&&a.value?a.value:i("Unknown unit");w+='<div class="webix_scheduler_event_unit_item">'+o+(r?"":",")+"</div>"}))}else w+=i("No units");w+="</div>"}var y=this.app.config.timeline&&this.Sections?this.GetSection(t,i):"",b="";return t.details&&(b='<div class="webix_scheduler_event_details_title">'+i("Notes")+'</div>\n\t\t\t\t<div class="webix_scheduler_event_text">'+t.details.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</div>"),h+"\n\t\t\t<div class='webix_scheduler_event_from_to'>"+v+"</div>\n\t\t\t<div class='webix_scheduler_event_recurring_pattern'>"+m+"</div>"+w+y+b},e.prototype.GetRecurringText=function(t,e){var i=t.$recurring,n=i.INTERVAL&&i.INTERVAL>1?i.INTERVAL:"",r="";return i.BYDAY?r=" "+e("on")+" "+(i.BYSETPOS||"")+" "+i.BYDAY.split(",").map((function(t){return webix.i18n.calendar.dayFull[ft.indexOf(t)]})).join(", ")+" "+(i.BYMONTH?e("of")+" "+webix.i18n.calendar.monthFull[i.BYMONTH-1]:""):i.BYMONTHDAY?r=(i.BYMONTHDAY?" "+e("on")+" ":"")+(i.BYMONTH?(i.BYSETPOS?e("of"):"")+" "+webix.i18n.calendar.monthFull[i.BYMONTH-1]:"")+(i.BYMONTHDAY?" "+i.BYMONTHDAY:""):i.BYYEARDAY&&(r=e("day")+" "+i.BYYEARDAY),e("Repeats each")+" "+n+" "+e(gt[i.FREQ]+(n?"s":""))+" "+r+(i.COUNT?", "+i.COUNT+" "+e("times"):i.UNTIL?" "+e("till")+" "+webix.i18n.longDateFormatStr(i.UNTIL):"")},e.prototype.GetSection=function(t,e){var i=this.Sections.getItem(t.section);return i?'<div class="webix_scheduler_section_tpl"><span class="webix_scheduler_section_title">'+e("Section")+":</span> "+i.text+"</div>":""},e}(p),oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={margin:webix.skin.$active.layoutMargin.form,cols:[{view:"button",value:e("Cancel"),hotkey:"esc",click:function(){return t.Cancel()}},{view:"button",value:e("Apply"),css:"webix_primary",hotkey:"enter",click:function(){return t.Done()}}]};return this.app.getService("jet-win").updateConfig({view:"window",head:e("Edit recurring event"),autoheight:!0,css:"webix_scheduler_action_popup",body:{type:"form",padding:{top:0},width:340,rows:[{view:"radio",localId:"option",vertical:!0,options:[{id:"this",value:e("This event")},{id:"next",value:e("This event and the following")},{id:"all",value:e("All events")}]},i]},on:{onHide:function(){return t.Result=null}}})},e.prototype.init=function(t){this.Root=t},e.prototype.Show=function(t){this.Result=t,this.$$("option").setValue("this"),this.Root.show()},e.prototype.Done=function(){var t=this.$$("option").getValue();this.Result&&this.Result.resolve(t),this.Root.hide()},e.prototype.Cancel=function(){this.Result&&this.Result.reject(),this.Root.hide()},e}(p),se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){j||(j=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;var n=t.config;this._forceCompact=void 0!==n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout));var t=this.getParam("forceCompact");webix.isUndefined(t)||this.setParam("compact",t),this.Compact=this.getParam("compact"),this.Calendars=!this.Compact&&this.app.config.calendars;var e=[nt,{view:"r-layout",localId:"main",cols:[{$subview:!0}]}];return this.Compact?e.push({$subview:!0,name:"edit",popup:!0}):e[1].cols.push({view:"proxy",width:400,localId:"edit",css:"webix_shadow_medium",borderless:!0,hidden:!0,body:{$subview:!0,name:"edit"}}),this.Calendars&&e[1].cols.unshift({view:"proxy",localId:"side",borderless:!0,body:et,hidden:!0}),{css:"webix_scheduler",view:"abslayout",cells:[{relative:!0,margin:0,rows:e},{view:"proxy",css:"webix_scheduler_absbutton",body:z,localId:"add",borderless:!0,right:20,bottom:20,hidden:!this.Compact}]}},e.prototype.init=function(t){var e=this;this.$$("main").sizeTrigger(this.app,(function(t){return e.SetCompactMode(t)}),!!this.Compact),webix.extend(t,webix.ProgressBar),this.on(this.app,"backend:operation",(function(e){t.showProgress({type:"top",delay:2e3}),e.finally((function(){t.hideProgress()}))})),this.Calendars&&this.$$("side").show();var i=this.app.getState();this.on(i.$changes,"mode",(function(t){e.show("./modes."+t)})),this.on(i.$changes,"readonly",(function(t){e.ToggleAdd(t)})),this.on(i.$changes,"selected",(function(t,i){return e.ToggleEvent(t,i)})),this.on(this.app,"show:panel",(function(){return e.ToggleSidePanel()})),Y(this.getRoot()).then((function(){return e.app._dndActionPopup=e.ui(oe)}))},e.prototype.ToggleEvent=function(t,e){t?this.ShowEvent(t,e):e&&this.HideEvent()},e.prototype.ShowEvent=function(t,e){var i=e&&e.id==t.id,n=this.getSubView("edit"),r=n&&i?n.getUrl()[0].page:"event."+("0"===t.id?"form":"info");this.Compact?this.show("event.formpopup/"+r,{target:"edit"}):(this.ToggleSidePanel("hide"),this.$$("edit").show(),this.show(r,{target:"edit"}))},e.prototype.HideEvent=function(){this.show("_blank",{target:"edit"}),this.Compact||(this.$$("edit").hide(),this.ToggleSidePanel("show"))},e.prototype.SetCompactMode=function(t){var e=this;webix.delay((function(){e.setParam("compact",t),t||webix.fullscreen.exit(),e.refresh()}))},e.prototype.ToggleSidePanel=function(t){var e=this.$$("side");e&&("show"!==t&&e.isVisible()?(this._sidePanel="hide"===t,e.hide()):(!t||this._sidePanel&&"hide"!==t)&&(e.show(),this._sidePanel=!1))},e.prototype.ToggleAdd=function(t){var e=this.$$("add");t?e.hide():this.Compact&&e.show()},e}(p);function le(t){var e=function(t){var e=webix.color.toRgb(t),i=e[0],n=e[1],r=e[2];return webix.color.rgbToHsv(i,n,r)}(t),i=e[0],n=e[1];return i*=.95,n*=.4,"rgb("+webix.color.hsvToRgb(i,n,ne)+")"}function ue(t){var e=t.color||t.$color;return'<div class="webix_event_marker"><div class="webix_event_marker_inner" style="background-color:'+(t.$past?le(e):e)+';"></div></div>'}function ce(t){return function(e,i){return'<div class="webix_event_overall '+(e.$past?"webix_scheduler_past_event":"")+'"><div class="webix_event_time">'+i.timeStart(e)+"</div>"+ue(e)+'<div class="webix_event_text">'+(e.text||t("(No title)"))+"</div></div>"}}function he(t){var e=t.color||t.$color;return"border-color:"+(t.$past?le(t.$color):t.$color)+"; background-color:"+(t.$past?le(e):e)+"; color:"+(t.$past?re:t.$textColor)+";"}function pe(t,e){return'<div class="start">'+webix.i18n.timeFormatStr(t)+'</div><div class="end">'+webix.i18n.timeFormatStr(e)+"</div>"}function de(t,e,i){var n=e.master;return n["$"+i]-(n.config["width"==i?"xCount":"yCount"]-1)*e[i]}function fe(t,e,i){var n=e.width,r=e.height;return t.right&&(n=de(0,e,"width")),t.bottom&&(r=de(0,e,"height")),'<div webix_l_id="'+t.id+'" class="'+e.classname(t,e,i)+'" '+e.aria(t,e,i)+' style="width:'+n+"px; height:"+r+'px; float:left; overflow:hidden;">'}webix.ready((function(){var t="contrast"===webix.skin.$name||"dark"===webix.skin.$name;ne=t?.35:.75,re=t?"#9f9d9d":"#ffffff"}));var ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return{view:"unitlist",localId:"list",uniteBy:function(){return"custom"},type:{template:ce(this.app.getService("locale")._),templateHeader:function(e){return t.TemplateHeader(e)},timeStart:function(e){return t.TimeStart(e)},height:50},on:{onUnits:function(){return t.SetUnits()},onItemClick:function(e,i){return t.ShowEvent(e,i)}}}},e.prototype.init=function(){this.State=this.app.getState(),this.List=this.$$("list"),webix.extend(this.List,webix.OverlayBox)},e.prototype.ShowEvent=function(t,e){var i=bt(this.List.getItem(t));i.node=e,this.State.selected=i},e.prototype.ToggleOverlay=function(){if(this.List.count())this.List.hideOverlay();else{var t=this.app.getService("locale")._;this.List.showOverlay(t("No Events"))}},e.prototype.SetUnits=function(){var t=this.List.units,e=this.data.all;if(Object.keys(t).length){this.List.units={};for(var i=this.data.start,n=this.data.end,r=function(){var t=webix.Date.add(i,1,"day",!0),n=e.filter((function(e){return e.start_date<t&&(e.end_date>i||e.end_date>=i&&e.all_day)})).map((function(t){return t.id}));n.length&&(a.List.units[i.valueOf()]=n),i=webix.Date.add(i,1,"day",!0)},a=this;i<n;)r()}},e.prototype.TimeStart=function(t){var e=this.app.getService("locale")._;return st(t)?e("All Day"):pe(t.start_date,t.end_date)},e}(p),ve=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var e=this,i=this.getParam("compact",!0),n=t.prototype.config.call(this);return n.css="webix_scheduler_agenda",webix.extend(n.type,{height:"auto",headerHeight:50,classname:function(t){return e.TemplateCss(t)}},!0),webix.extend(n.on,{onItemRender:function(t){t.$unit&&(e.CurrentUnit=t.$unit)},onItemClick:function(t,n,r){r=r.firstChild,e.ShowEvent(t,r),i||e.SelectEvent(r)}},!0),n},e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.Data=this.app.getService("local");var i=this.Data.events(!0);this.on(this.State.$changes,"date",(function(){return e.RefreshData()})),this.on(this.State.$changes,"active",(function(){return e.RefreshData()})),this.on(this.State.$changes,"selected",(function(t){t||e.SelectEvent()})),this.on(this.app,"events:refresh",(function(){return e.RefreshData()})),this.on(i.data,"onStoreUpdated",(function(t,i,n){return n&&e.RefreshData()}))},e.prototype.RefreshData=function(){var t=this,e=webix.Date.monthStart(this.State.date),i=webix.Date.add(e,1,"month",!0);this.Data.getEvents(e,i).then((function(n){t.data={all:n,start:e,end:i},t.app&&(t.List.clearAll(),t.List.parse(n.map(at(e,i))),t.ToggleOverlay())}))},e.prototype.SelectEvent=function(t){if(t!=this._selected){var e="webix_agenda_selected";this._selected&&webix.html.removeCss(this._selected,e),t&&webix.html.addCss(t,e),this._selected=t}},e.prototype.TemplateHeader=function(t){var e=new Date(1*t),i="%F <span class='webix_scheduler_monthday"+(ot(e)?" webix_scheduler_today":"")+"'>%j</span><br><span class='webix_scheduler_dayofweek'>%l</span>";return webix.Date.dateToStr(i)(e)},e.prototype.TemplateCss=function(t){var e=this.List.getUnitList(this.CurrentUnit),i="webix_list_item";return t.id==e[e.length-1]&&(i+=" webix_event_last"),t.id==e[0]&&(i+=" webix_event_first"),i},e}(ge),me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return{view:"list",borderless:!0,localId:"scale",css:"webix_scheduler_scale",type:{height:42,heightSize:function(e,i){var n=t.List.getIndexById(e.id);return i.height-(0===n?17:0)+"px"}},scroll:!1,autoheight:!0,width:51,template:function(e){return t.HourScaleItem(e)}}},e.prototype.init=function(){this.List=this.$$("scale"),this.ParseHours()},e.prototype.ParseHours=function(){for(var t=[],e=0;e<24;e++)t.push({id:e+""});this.List.parse(t)},e.prototype.HourScaleItem=function(t){return 0===this.List.getIndexById(t.id)?"":(t.id<10?"0":"")+t.id+":00"},e}(p),we=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return{cols:[{view:"template",localId:"more",width:50,css:"webix_scheduler_multi_space",tooltip:function(){return""},onClick:{"wxi-angle-down":function(){return t.ExpandData()},"wxi-angle-up":function(){return t.WrapData()}}},{}]}},e.prototype.init=function(){this.List=this.$$("multiDayList"),this.MoreIcon=this.$$("more"),this._expandState="down",this.maxVisibleLines=3},e.prototype.SetMoreIcon=function(t){if(t){var e="up"===t?"Collapse":"Expand",i=this.app.getService("locale")._;this.MoreIcon.setHTML('<div class="webix_scheduler_more_icon webix_icon wxi-angle-'+t+'" webix_tooltip="'+i(e+" all-day events")+'"><div>')}else this.MoreIcon.setHTML("")},e.prototype.Animate=function(t,e,i){var n=this;this.List.$view.style.transition="height 150ms",e&&(this.List.$view.style.height=e+"px"),setTimeout((function(){i&&i(),n.List.$view.style.transition="",n._inAnimation=!1,n.SetMoreIcon(t)}),150)},e}(p);function _e(t,e){var i=this.LocateSelected(t);if(i)for(var n=0;n<i.length;n++)e(i[n],"webix_scheduler_event_selected")}function ye(t){return _e.call(this,t,webix.html.addCss)}function be(t){return _e.call(this,t,webix.html.removeCss)}function xe(){var t=this,e=this._SelectionMode;if(this.State=this.app.getState(),this.on(this.State.$changes,"selected",(function(i,n){if(n&&t.Unselect(n.date&&"string"==typeof n.date?n.date:n.id),i){var r="0"!==i.id&&i.date?i.date:i.id;setTimeout((function(){return t.Select(r)}),"multi"!==e&&"0"===r?150:0)}})),"multi"!==e){var i=this.app.getService("local").events(!0);this.on(i.data,"onStoreUpdated",(function(e,i,n){"add"===n&&"0"!=e&&t.State.selected&&"0"===t.State.selected.id&&(t.State.selected.id=e)}))}}function Se(t,e,i){t._SelectionMode=e,t.Select=ye,t.Unselect=be,t.HandleSelection=xe,t.LocateSelected=function(t){return function(e){return this._DataObj?Array.prototype.map.call(this._DataObj.querySelectorAll("[webix_"+(t?"l":"e")+'_id="'+e+'"]'),(function(e){return t?e.firstElementChild:e})):null}}(i),t.HandleSelection()}var $e,Ce={$dragIn:function(){return this.getContext().from.mode===this.mode},$dragPos:function(t){var e=this.getContext(),i=webix.html.offset(e.target),n=t.y-i.y;n<e.y_diff?n=e.y_diff:n>i.height&&(n=i.height);var r=n-e.y_diff;Ce.updateNodeHeight.call(this,r),e.duration!==r&&(e.duration=r,this.updateText(e)),t.x=e.x_diff,t.y=e.y_diff},updateNodeHeight:function(t){webix.DragControl.getNode().style.height=Math.max(this.master.minEventHeight,t)+"px"},getActualDate:function(t,e){var i=this.getContext(),n=webix.Date.copy(i.event.start_date),r=5*(Math.round(60*i.duration/t.List.type.height/5)||1);return webix.Date.add(n,r,"minute"),!e&&webix.Date.equal(n,i.event.end_date)?null:{start_date:webix.Date.copy(i.event.start_date),end_date:n}}},ke=function(t,e){return function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=webix.Date;function n(t,e){return i.add(t,1*e,"day",!0)}function r(t,e){return(t=new Date(t)).setHours(0,0,0,0),(e=new Date(e)).setHours(0,0,0,0),Math.round((t.getTime()-e.getTime())/864e5)}function a(t,e){return 24*r(t,e)+(t.getHours()-e.getHours())}var o={};function s(t,e){return l(e)(t)}function l(t){var e=o[t];return e||(e=o[t]=i.dateToStr(t)),e}function u(t){var e=t.getDay();return i.startOnMonday&&(0===e?e=6:e--),e}var c={year:function(t,e){return t.getFullYear()-e.getFullYear()},quarter:function(t,e){return 4*(t.getFullYear()-e.getFullYear())+(Math.floor(t.getMonth()/3)+1)-(Math.floor(e.getMonth()/3)+1)},month:function(t,e){return 12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth())},week:function(t,e){var i=r(t,e)/7,n=u(t),a=u(e);return Math.ceil(Math.abs(i)-(n<=a?0:1))*Math.sign(i)},day:r,hour:a,minute:function(t,e){return 60*a(t,e)+(t.getMinutes()-e.getMinutes())}},h={year:["quarter",4],quarter:["month",3],month:["day",function(t){if(!t)return 30;var e=t.getMonth();if(1===e){var i=t.getFullYear();return i%4?28:i%100?29:i%400?28:29}return e%2&&e<7||!(e%2)&&e>7?30:31}],week:["day",7],day:["hour",24],hour:["minute",60]},p={year:function(t,e){return i.add(t,1*e,"year",!0)},quarter:function(t,e){return i.add(t,3*e,"month",!0)},month:function(t,e){return i.add(t,1*e,"month",!0)},week:function(t,e){return i.add(t,1*e,"week",!0)},day:n,hour:function(t,e){return i.add(t,1*e,"hour",!0)},minute:function(t,e){return i.add(t,1*e,"minute",!0)}};function d(t,e,i,n,r){var a=n?h[t][0]:t,o=i,s=e;if(r&&(o=m(a,i),(s=m(a,e))<e&&(s=v(a)(s,1))),n){var l=c[a](s,o),u=h[t][1];return l/("number"==typeof u?u:u(i))}return c[a](s,o)}function f(t){return function(e,i,n,r){return"month"===t&&n?function(t,e,i){if(g(e,t))return d("month",t,e,!0,i);var n=0;if(e.getDate()>1){var r=new Date(e.getFullYear(),e.getMonth()+1,1);n=d("month",r,e,!0),e=r}var a=0;return g(e,t)||(a=d("month",webix.Date.monthStart(t),e),e=webix.Date.add(e,a,"month",!0)),n+a+d("month",t,e,!0)}(e,i,r):d(t,e,i,n,r)}}function g(t,e){return webix.Date.equal(webix.Date.monthStart(t),webix.Date.monthStart(e))}function v(t){return p[t]}function m(t,e){var i;switch(t){case"year":return new Date(e.getFullYear(),0,1);case"quarter":return new Date(e.getFullYear(),3*Math.floor(e.getMonth()/3),1);case"month":return new Date(e.getFullYear(),e.getMonth(),1);case"week":return(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(e.getDate()-u(e)),i;case"day":return(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(0,0,0,0),i;case"hour":return(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(e.getHours(),0,0,0),i;default:return new Date(e)}}function w(t,e,i,n,r){var a=i.start,o=i.end,s=i.cellWidth,l=i.cellHeight,u=i.diff,c=i.minUnit,h=i.precise,p=t.start_date<a?a:t.start_date,d=t.end_date>o?o:t.end_date,f=m(c,a),g="milestone"==t.type;t.$h=n,t.$x=Math.round(u(p,f,h)*s)-(g?t.$h/2:0),t.$w=g?t.$h:Math.round(u(d,p,h,!0)*s),t.$y=webix.isUndefined(r)?l*e+(l-n)/2:r}function _(t){t.duration=0,t.end_date=t.start_date}function y(t){return t.duration<1?v("hour")(t.start_date,Math.floor(24*t.duration)):v("day")(t.start_date,t.duration)}function b(t,e){if(t.duration<1)return y(t);for(var r=function(t){return i.datePart(t,!0)}(t.start_date),a=0,o=0;a<t.duration;)e.isHoliday(r)?30==++o&&$():(++a,o=0),r=n(r,1);return r}function x(t,e){var i=f("day")(t.end_date,t.start_date,!0);if(i<1)return parseFloat(i.toFixed(2));if(!e)return Math.floor(i);for(var r=t.start_date,a=0;r<t.end_date;)e.isHoliday(r)||++a,r=n(r,1);return a}function S(t,e){for(var i,r=t,a=t,o=0;o<30&&(i=e.isHoliday(a))&&e.isHoliday(r);)r=n(r,-1),a=n(a,1),o++;return 30===o&&$(),i?r:a}function $(){throw alert("No work days found within 30 days, check your isHoliday function!","error"),"Wrong isHoliday function"}function C(t,e,i,r){for(var a=0;a<30&&i.isHoliday(k(t,e));)t=n(t,r),a++;return 30===a&&$(),t}function k(t,e){return e&&!function(t){return i.timePart(t)}(t)?n(t,-1):t}e.addUnit=v,e.getDiff=f,e.getUnitStart=m,e.grid=function(t,e,i){var n=document.createElement("canvas");n.setAttribute("width",t),n.setAttribute("height",e);var r=n.getContext("2d");return r.strokeStyle=i,r.moveTo(0,e),r.lineTo(t,e),r.lineTo(t,0),r.stroke(),n.toDataURL()},e.newLink=function(t,e,i){if(e&&i){var n=i.x-e.x,r=i.y-e.y,a=(n>0?e.x:i.x)-t.left,o=(r>0?e.y:i.y)-t.top,s=(n>0?0:-n)+","+(r>0?0:-r)+","+(n>0?n:0)+","+(r>0?r:0);return{width:Math.abs(n),height:Math.abs(r),left:a,top:o,p:s}}return null},e.resetScales=function(t,e,i,n,r,a,o){var c=function(t){var e=new Date;return t.map((function(t){return{item:t,len:v(t.unit)(e,1)}})).sort((function(t,e){return t.len<e.len?-1:1}))[0].item.unit}(a),h=f(c),p=m(c,e);t=m(c,t),e=p<e?v(c)(p,1):p;var d=h(e,t)*n,g=r*a.length;return{rows:a.map((function(i){for(var a=[],o=v(i.unit),p=i.step||1,d="week"===c&&"week"!==i.unit,f=m(i.unit,t);f<e;){var g=o(f,p);f<t&&(f=t),g>e&&(g=e);var w=f,_=g;d&&(u(f)>3&&(w=webix.Date.add(f,1,"week",!0)),u(g)>3&&(_=webix.Date.add(g,1,"week",!0)));var y=(h(_,w)||1)*n,b="function"==typeof i.format?i.format(f,g):s(f,i.format),x="";i.css&&(x+="function"==typeof i.css?i.css(f):i.css),a.push({width:y,value:b,css:x,date:f,format:l(i.format)}),f=g}return{cells:a,add:o,height:r,type:i.unit,step:i.step||1}})),width:d,height:g,cellWidth:n,cellHeight:r,diff:h,start:t,end:e,minUnit:c,precise:i=!!("day"===c?i:0!=i),isHoliday:o}},e.smallerCount=h,e.updateLink=function(t,e,i,n){var r,a,o,s,l=Math.round(n/2);if(!e||!i)return t.$p="",t;var u,c,h=!1,p=!1;switch(t.type){case 0:p=!0;break;case 1:h=!0,p=!0;break;case 3:h=!0}if(r=h?e.$x:e.$x+e.$w,a=e.$y,o=p?i.$x:i.$x+i.$w,s=i.$y,function(t,e,i,n,r){return"milestone"===t.type||"milestone"===e.type?Math.abs(i-n)>r/2:i!==n}(e,i,r,o,n)||a!==s){var d=function(t,e,i,n,r,a,o){var s=t+20*(r?-1:1),l=i+20*(a?-1:1),u=[t,e,s,e,0,0,0,0,l,n,i,n],c=l-s,h=n-e,p=a===r;return!p&&(l<=t&&a||l>t&&!a)&&(h-=19),p&&a&&s>l||p&&!a&&s<l?(u[4]=u[2]+c,u[5]=u[3],u[6]=u[4],u[7]=u[5]+h):(u[4]=u[2],u[5]=u[3]+h,u[6]=u[4]+c,u[7]=u[5]),u.join(",")}(r,a+l,o,s+l,h,p),f=(u=o,c=s+l,p?u-5+","+(c-3)+","+(u-5)+","+(c+3)+","+u+","+c:u+5+","+(c+3)+","+(u+5)+","+(c-3)+","+u+","+c);t.$p=d+","+f}else t.$p="";return t},e.updateTask=function(t,e,i,n,r){return"split"===t.type&&t.$data&&t.$data.length?t.$data.forEach((function(t){return w(t,e,i,n)})):w(t,e,i,n,r),t},e.updateTaskDuration=function(t,e,i,n){t.start_date&&t.end_date&&t.start_date.valueOf()>=t.end_date.valueOf()&&(t.end_date=null,t.duration=1,i&&(i="move")),e?function(t,e,i,n){if("milestone"==t.type)return t.start_date=i?C(t.start_date,!1,e,n):S(t.start_date,e),_(t);i?"start"==i||"move"==i?(t.start_date=C(t.start_date,!1,e,n),t.duration||(t.duration=x(t,e)),t.end_date||(t.end_date=b(t,e))):(t.end_date||(t.end_date=b(t,e)),t.duration||(t.end_date=C(t.end_date,!0,e,n),t.duration=x(t,e))):(t.start_date=S(t.start_date,e),t.end_date=b(t,e),t.duration=x(t,e))}(t,e,i,n):"milestone"==t.type?_(t):(t.duration||(t.duration=x(t)),t.end_date||(t.end_date=y(t)))}}(e={exports:{}},e.exports),e.exports}();($e=ke)&&$e.__esModule&&Object.prototype.hasOwnProperty.call($e,"default")&&$e.default;var De=ke.addUnit,Te=(ke.getDiff,ke.getUnitStart),Ee=ke.grid,Le=(ke.newLink,ke.resetScales),Ae=ke.smallerCount,Ie=(ke.updateLink,ke.updateTask);ke.updateTaskDuration;var Pe={start:function(t,e){t._auto_scroll_delay=webix.delay(Pe.autoScroll,t,[e,webix.html.pos(e)],250)},reset:function(t){t._auto_scroll_delay&&(t._auto_scroll_delay=window.clearTimeout(t._auto_scroll_delay))},autoScroll:function(t,e){var i=-1!==this.direction.indexOf("y"),n=-1!==this.direction.indexOf("x"),r=webix.html.offset(this.from.view.$view),a=!1;i&&Pe.autoYScroll.call(this,e,r,this.senseY)&&(a=!0),n&&Pe.autoXScroll.call(this,e,r,this.senseX)&&(a=!0),a&&(function(t,e){if(webix.DragControl.active){var i=webix.DragControl.getNode();e=webix.copy(e),webix.DragControl.$dragPos(e,t),i.style.top=e.y+webix.DragControl.top+"px",i.style.left=e.x+webix.DragControl.left+"px"}}(t,e),this._auto_scroll_delay=webix.delay(Pe.autoScroll,this,[t,e],100))},autoYScroll:function(t,e,i){var n=this.from.view.getScrollState();return t.y<e.y+i?Pe.autoScrollTo.call(this,n.x,n.y-i,"y"):t.y>e.y+e.height-i&&Pe.autoScrollTo.call(this,n.x,n.y+i,"y")},autoXScroll:function(t,e,i){var n=this.from.view.getScrollState();if(t.x<e.x+i)return Pe.autoScrollTo.call(this,n.x-i,n.y,"x");if(t.x>e.x+e.width-i){var r=this.snode?Math.min(n.x+i,this.snode.scrollWidth-e.width):n.x+i;return r!=n.x&&Pe.autoScrollTo.call(this,r,n.y,"x")}return!1},autoScrollTo:function(t,e,i){this.from.view.scrollTo(t,e),this.from.view.callEvent("onAfterAutoScroll",[]);var n=this.from.view.getScrollState();return Math.abs(("x"===i?t:e)-n[i])<1}};function Re(t,e,i){var n=webix.copy(Je[e]);n.view=t,n.master=this,n.State=this.app.getState();var r=this.app.getService("local");n.Local=r.events(!0),n.Calendars=r.calendars(!0),n.Ops=this.app.getService("operations"),webix.DragControl.addDrag(t.$view,n),i||webix.DragControl.addDrop(t.$view,n,!0)}function Me(t,e,i){var n,r,a=t.target;do{r=(n=a.getAttribute?a.getAttribute(i||"webix_e_id"):null)?a:null,a=a.parentNode}while(!n&&a&&a!==e);return{id:n,node:r}}function Ve(t,e){if(this.State.selected){var i=bt(t);t.$recurring&&(i.date=e.start_date.valueOf()+"_"+t.$id),this.State.selected=i}}function Oe(t,e,i){var n=this,a=e.$id||e.id,o=this.Local.getItem(a);if("this"===t&&this.master.HasOneOccurrence(r(r({},e),{start_date:o.start_date,end_date:o.end_date})))return this.Ops.updateEvent(a,i,void 0,void 0,!0);if(!(t=this.master.ChangeMode(t,e,this.Local.getItem(e.recurring?a:e.origin_id).start_date,e.recurring?e.id:e.start_date)))return e.$recurring=Tt(e.$recurring,i,e),i.recurring=dt(e.$recurring),this.Ops.updateEvent(a,i,void 0,void 0,!0);if("this"===t||"next"===t){var s,l="";"this"===t?l=$t(e.id,e):e.recurring?l=St(e.id,webix.copy(e)):(a=e.origin_id,s=webix.copy(this.Local.getItem(a)),l=St(i.start_date,webix.copy(s),!0));var u=Be.call(this,a,t,e,i,s);return this.Ops.updateEvent(a,{recurring:l},t,webix.Date.dayStart(u.start_date),!0).then((function(){return n.Ops.addEvent(u,!0)}))}if("all"===t){var c=e.origin_id||e.$id,h=webix.copy(this.Local.getItem(c)),p=h.$recurring;return(p.COUNT||p.UNTIL)&&(p=this.master.CorrectCountUntil(h,t,i.start_date,this.Local)),!i.start_date||ut(e.start_date,i.start_date)?(i.start_date&&(i.start_date=He(h.start_date,i.start_date)),i.end_date&&(ut(e.end_date,i.end_date)?i.end_date=He(h.end_date,i.end_date):i.end_date=Fe(h.end_date,e.end_date,i.end_date))):(i.end_date||(i.start_date=Fe(h.start_date,e.start_date,i.start_date)),p=Tt(p,i,h)),i.start_date&&(p.EXDATE&&delete p.EXDATE,i.recurring=dt(p)),this.Ops.updateEvent(e.origin_id||a,i,t,void 0,!0)}}function Fe(t,e,i){return new Date(1*t+(i-e))}function He(t,e){var i=1e3*webix.Date.timePart(e);return new Date(1*webix.Date.dayStart(t)+i)}function Be(t,e,i,n,a){var o=r(r(r({},i),n),{recurring:""});if(o.origin_id||(o.origin_id=t),"next"===e){var s=webix.copy(i.recurring?i.$recurring:a.$recurring);(s.COUNT||s.UNTIL)&&(s=this.master.CorrectCountUntil(r(r({},this.Local.getItem(t)),{$recurring:s}),e,o.start_date,this.Local)),(s=Tt(s,o,i)).EXDATE=[],o.recurring=dt(s)}return delete o.$id,o}var Ue={mode:"common",$longTouchLimit:!0,$dragDestroy:function(t,e){var i=this.getContext();return!i.$waitUpdate&&i.node&&(i.node.style.visibility="visible"),i.$resize&&webix.html.removeCss(document.body,"webix_active_resize"),webix.html.remove(e),"move"!==i.moveMode||i.more||Pe.reset(i),!1},getContext:function(){return webix.DragControl.getContext()},setDragOffset:function(t,e,i){var n=this.getContext(),r=webix.html.pos(i),a=webix.html.offset(t);n.width=a.width,n.height=a.height,n.x_offset=a.x-r.x,n.y_offset=a.y-r.y},updateEvent:function(t,e){var i=this;if(t.$id||t.origin_id)this.master._waitPopup=webix.promise.defer(),this.master._waitPopup.then((function(n){var r=Oe.call(i,n,t,e);r.then((function(){return Ve.call(i,t,e)})),i.master.app.callEvent("backend:operation",[r])})).finally((function(){return i.master._waitPopup=null})),this.master.app._dndActionPopup.Show(this.master._waitPopup);else{var n=this.Ops.updateEvent(t.$id||t.id,e,void 0,void 0,!0);this.finishOperation(n,t,e)}},addEvent:function(t,e){var i={text:t.text,start_date:e.start_date,end_date:e.end_date,details:""};this.master.app.config.calendars&&(i.calendar=t.calendar),this.master.app.config.timeline&&(i.section=e.section||t.section),this.master.app.config.units&&t.units&&(i.units=e.units||t.units);var n=this.Ops.addEvent(i,!0);this.finishOperation(n,i,e)},copyEvent:function(t,e){var i=r(r({},t),e);Bt.call(this.master,i);var n=this.Ops.addEvent(i,!0);this.finishOperation(n,i,e)},finishOperation:function(t,e,i){var n=this,a=this.getContext();t.then((function(t){return Ve.call(n,t?r(r({},e),{id:t}):e,i)})),this.master.app.callEvent("backend:operation",[t]),a.$waitUpdate=!0}},Ne=webix.extend({mode:"day",$dragIn:function(t,e){var i=this.getContext();if(i.$resize)return Ce.$dragIn.apply(this,arguments);if(i.from.mode!==this.mode)return!1;if(i.target!=e){var n=webix.DragControl.getNode();e.firstChild.appendChild(n),i.target=e}return!0},$drop:function(t,e,i){var n=this.getContext();webix.extend(n,{to:this});var r=this.master.app;if(n.from.mode!==this.mode||!r.callEvent("app:beforedrop",[n,i]))return!1;var a=this.getActualDate(this.master);a&&("0"==n.event.id?n.$creation?this.State.selected={id:"0",date:n.event.start_date,end_date:a.end_date}:this.addEvent(n.event,a):n.$copy&&!n.$resize?this.copyEvent(n.event,a):this.updateEvent(n.event,a))},$dragPos:function(t){var e=this.getContext();if(e.$resize)return Ce.$dragPos.apply(this,arguments);var i=webix.html.offset(e.target),n=i.height-e.height;t.x=e.x_diff,t.y+=e.y_offset-i.y,t.y<0?t.y=0:t.y>n&&(t.y=n),webix.extend(e,t,!0),e.$last_y!==t.y&&(this.updateText(e),e.$last_y=t.y)},$dragCreate:function(t,e){if(this.State.readonly)return!1;var i=this.getContext(),n=Me(e,t);if(n.id){webix.extend(i,n,!0),webix.extend(i,{from:this,target:t},!0),i.event=this.master.GetEvent(n.id),this.setDragOffset(n.node,t,e),e.target.getAttribute("webix_resizer")&&(i.$resize=!0);var r=this.master.app;return!!r.callEvent("app:beforedrag",[i,e])&&(i.$resize&&webix.html.addCss(document.body,"webix_active_resize",!0),(c=n.node.cloneNode(!0)).className+=" webix_drag_zone webix_"+(i.$resize?"resize":"drag")+"_event",t.firstChild.appendChild(c),i.$copy=(e.ctrlKey||e.metaKey)&&r.config.copypaste,i.$copy&&"0"!==n.id&&!i.$resize||(n.node.style.visibility="hidden"),c)}if(this.master.app.config.dragCreate&&!this.State.clipboard){var a=this.view.getScrollState().y,o=webix.html.offset(t).y;i.y=webix.html.pos(e).y-o+a;var s=this.getActualDate(this.master,!0),l=s.start_date,u=s.end_date;i.event={id:"0",text:"",start_date:l,end_date:u,$color:"#997CEB",$textColor:"#fff",$top:i.y,$left:0,$height:this.master.minEventHeight,$width:this.master.List.$width-8};var c,h=this.Calendars.getFirstId();h&&(i.event.$color=this.Calendars.getItem(h).color),webix.extend(i,{from:this,target:t},!0),(c=webix.html.create("div")).innerHTML=this.master.ToHTML(i.event),c.firstChild.className+=" webix_drag_zone webix_resize_event",webix.html.addCss(document.body,"webix_active_resize",!0);var p=t.firstChild.appendChild(c.firstChild);return this.setDragOffset(p,t,e),i.$resize=!0,i.$creation=!0,p}return!1},getActualDate:function(t,e){var i=this.getContext();if(i.$resize)return Ce.getActualDate.apply(this,arguments);var n=webix.Date.copy(t.Day),r=t.List.getFirstId()*t.List.type.height,a=5*Math.round(60*(i.y+r)/t.List.type.height/5);if(webix.Date.add(n,a,"minute"),!e&&webix.Date.equal(n,i.event.start_date))return null;var o=i.event?i.event.end_date-i.event.start_date:36e5;return{start_date:n,end_date:new Date(n.valueOf()+o)}},updateText:function(t){var e=webix.DragControl.getNode(),i=webix.DragControl.getMaster(t.target),n=this.getActualDate(i.master,!0);n.text=t.event.text,e.innerHTML="",e.innerHTML=i.master.EventTemplate(n)},setDragOffset:function(t,e,i){var n=this.getContext(),r=webix.html.pos(i),a=webix.html.offset(t);n.height=a.height,n.x_offset=a.x-r.x,n.y_offset=a.y-r.y;var o=webix.html.offset(e);n.x_diff=a.x-o.x-1,n.y_diff=a.y-o.y}},Ue),je=webix.extend({mode:"month",$dragIn:function(t,e,i){var n=this.getContext();if(n.from.mode!==this.mode)return!1;n.offset=n.offset||webix.html.offset(e);var r=this.locate(i),a=this.view.getIdByIndex(r),o=this.view.getItemNode(a);return n.$marked!==a&&this.markDropArea(a),o},$dragOut:function(t,e,i){return e!==i&&this.markDropArea(),null},$drop:function(t,e,i){var n=this.getContext();webix.extend(n,{to:this});var r=this.master.app;if(n.from.mode!==this.mode||!r.callEvent("app:beforedrop",[n,i]))return!1;this.markDropArea();var a=n.$copy,o=this.getActualDate(i,a);o&&("0"==n.event.id?this.addEvent(n.event,o):a?this.copyEvent(n.event,o):this.updateEvent(n.event,o))},$dragPos:function(t){var e=this.getContext();t.x+=e.x_offset,t.y+=e.y_offset},$dragCreate:function(t,e){if(this.State.readonly)return!1;var i=Me(e,t);if(i.id&&"$wsh_multi_more"!=i.id){var n=this.getContext();webix.extend(n,i,!0),webix.extend(n,{from:this,offset:webix.html.offset(t)},!0),n.event=this.master.Events.getItem(i.id),n.start=this.view.getIdByIndex(this.locate(e)),this.setDragOffset(i.node,t,e);var r=this.master.app;if(!r.callEvent("app:beforedrag",[n,e]))return!1;var a=document.createElement("DIV"),o=i.node.cloneNode(!0);return o.style.position="static",a.appendChild(o),a.className=t.className+" webix_drag_zone webix_drag_event",document.body.appendChild(a),n.$copy=(e.ctrlKey||e.metaKey)&&r.config.copypaste,n.$copy&&"0"!==n.event.id||(i.node.style.visibility="hidden"),webix.callEvent("onClick",[e]),a}return!1},getActualDate:function(t,e){var i=this.getContext(),n=this.locate(t)-this.view.getIndexById(i.start);return n||e?{start_date:webix.Date.add(i.event.start_date,n,"day",!0),end_date:webix.Date.add(i.event.end_date,n,"day",!0)}:null},markDropArea:function(t){var e=this.getContext();if(e.$marked&&e.$marked!=t&&(this.view.removeCss(e.$marked,"webix_drag_over"),e.$marked=null,e.$extra&&(webix.html.removeCss(this.view.$view,e.$extra),e.$extra=null)),!e.$marked&&t){this.view.addCss(t,"webix_drag_over"),e.$marked=t;var i=void 0;this.view.getFirstId()==t?i="webix_scheduler_dnd_1":this.view.getLastId()==t&&(i="webix_scheduler_dnd_n"),i&&(webix.html.addCss(this.view.$view,i,!0),e.$extra=i)}},locate:function(t){var e=this.getContext(),i=webix.html.pos(t);return i.x-=e.offset.x,i.y-=e.offset.y,Math.min(Math.floor(i.y/this.view.type.height),this.view.config.yCount-1)*this.view.config.xCount+Math.min(Math.floor(i.x/this.view.type.width),this.view.config.xCount-1)}},Ue),Ge=webix.extend({mode:"multiday"},je),Ye=webix.extend({$dragCreate:function(t,e){if(this.State.readonly)return!1;var i=this.view.locate(e);if(i){var n=this.getContext(),r=this.view.getItemNode(i).children[0];if(webix.extend(n,{from:this,id:i},!0),n.event=this.master.Events.getItem(i),n.start=this.master.ID,this.setDragOffset(r,t,e),!this.master.app.callEvent("app:beforedrag",[n,e]))return!1;var a=document.createElement("DIV");return a.style.width=n.width+"px",a.style.height=n.height+"px",a.appendChild(r.cloneNode(!0)),a.className=t.className+" webix_drag_zone webix_drag_event",document.body.appendChild(a),this.master.HideWindow(),a}return!1},$dragDestroy:function(t,e){return webix.html.remove(e),!1}},je),ze=webix.extend({mode:"units",$drop:function(t,e,i){var n=this.getContext();webix.extend(n,{to:this});var r=this.master.app;if(n.from.mode!==this.mode||!r.callEvent("app:beforedrop",[n,i]))return!1;var a=n.$copy,o=this.getActualDate(this.master,a),s=this.getEventUnits(n);if(o||s){var l=webix.extend(o||{},s||{});"0"==n.event.id?n.$creation?this.State.selected={id:"0",date:n.event.start_date,end_date:l.end_date,unit:l.units}:this.addEvent(n.event,l):a&&!n.$resize?this.copyEvent(n.event,l):this.updateEvent(n.event,l)}},getEventUnits:function(t){var e=t.from.master.Unit.id+"";if(t.event.units){var i=t.event.units.split(","),n=this.master.Unit.id+"";if(n==e||t.$resize)return;var r=i.filter((function(t){return t!=e}));return-1===i.indexOf(n)&&r.push(n),{units:r.join(",")}}return{units:e}}},Ne),We=webix.extend({mode:"multidayUnits",$dragCreate:function(t,e){if(this.State.readonly)return!1;var i=Me(e,t,"webix_l_id");if(i.id&&"$wsh_multi_more"!=i.id){var n=this.getContext();webix.extend(n,i,!0),webix.extend(n,{from:this,target:t},!0),n.event=this.master.GetEvent(i.id),this.setDragOffset(i.node,t,e);var r=this.master.app;if(!r.callEvent("app:beforedrag",[n,e]))return!1;var a=i.node.cloneNode(!0);return a.className+=" webix_drag_zone webix_drag_event",a.style.width="100%",t.firstChild.appendChild(a),n.$copy=(e.ctrlKey||e.metaKey)&&r.config.copypaste,n.$copy||(i.node.style.visibility="hidden"),a}return!1},$dragPos:function(t){var e=this.getContext(),i=webix.html.offset(e.target),n=i.height-e.height;t.x=e.x_diff,t.y+=e.y_offset-i.y,t.y<0?t.y=0:t.y>n&&(t.y=n),webix.extend(e,t,!0)},getActualDate:function(t,e){var i=t.State.date,n=this.getContext();if(!e&&webix.Date.equal(i,n.event.start_date))return null;var r=n.event.end_date-n.event.start_date;return{start_date:i,end_date:new Date(i.valueOf()+r)}}},ze),qe=webix.extend({mode:"timeline",dragScroll:{direction:"xy"},locate:function(t){var e=this.getContext(),i=this.view.getScrollState(),n=this.view.$scope.Sections.count(),r=this.getEventContext(t,e).y-e.offset.y+i.y;return Math.min(Math.floor(r/this.view.type.height),n-1)},$dragCreate:function(t,e,i){var n=this.getContext();n.$touch="touch"===i;var a=this.master.app;if(this.State.readonly)return!1;var o=Me(e,t);if(o.id&&"$wsh_multi_more"!=o.id){var s=o.node,l=this.getEventContext(e,n),u=Xe(s,l.x),c=this.view.getScrollState();if(webix.extend(n,r(r({},o),{from:this,offset:webix.html.offset(t),moveMode:u,step:this.getStep(),dx:0,scroll:c,x:l.x,t:parseInt(s.style.top),l:parseInt(s.style.left),w:parseInt(s.style.width)}),!0),n.event=this.master.Events.getItem(o.id),n.start=this.view.getIdByIndex(this.locate(e)),this.setDragOffset(s,t,e),!a.callEvent("app:beforedrag",[n,e]))return!1;"move"===n.moveMode&&webix.extend(n,Qe.call(this,this.dragScroll,this.view.$scope.Scales));var h=document.createElement("DIV"),p=s.cloneNode(!0);return p.style.position="static",h.appendChild(p),h.className=t.className+" webix_drag_zone webix_drag_event",s.parentNode.appendChild(h),n.$copy=(e.ctrlKey||e.metaKey)&&a.config.copypaste,n.$copy&&"0"!==n.event.id&&"move"===n.moveMode||(s.style.visibility="hidden"),webix.callEvent("onClick",[e]),h}return!1},getEventContext:function(t,e){if(e.$touch){if(t.changedTouches&&(!t.touches||!t.touches[0])){var i=t.changedTouches[0];return{x:i.pageX,y:i.pageY}}return t.time?t:webix.env.touch.context(t)}return{x:t.clientX,y:t.clientY}},$dragIn:function(t,e,i){var n=this.getContext();return n.from.mode===this.mode&&(n.offset=n.offset||webix.html.offset(e),"move"!==n.moveMode||n.more||(Pe.reset(n),Pe.start(n,i)),!0)},$dragPos:function(t){var e=this.getContext(),i=e.x,n=e.t,r=e.l,a=e.w,o=e.scroll,s=e.step,l=e.moveMode,u=this.view.getScrollState();e.dx=t.x-i-(o?o.x:0)+u.x;var c=webix.DragControl.getNode();if("move"===l){var h=e.more?{x:0,y:0}:e.offset;t.x+=e.x_offset-h.x+u.x,t.y+=e.y_offset-h.y+u.y}else"start"===l?(t.x=Math.min(r+e.dx,r+a-s),t.y=n,c.childNodes[0].style.width=c.style.width=Math.max(s,a-e.dx)+"px"):"end"===l&&(t.x=r,t.y=n,c.childNodes[0].style.width=c.style.width=Math.max(a+e.dx,s)+"px")},$drop:function(t,e,i){var n=this.getContext();webix.extend(n,{to:this});var r=this.master.app;if(n.from.mode!==this.mode||!r.callEvent("app:beforedrop",[n,i]))return!1;var a=this.getData(i);a&&("0"==n.event.id?this.addEvent(n.event,a):n.$copy&&"move"===n.moveMode?this.copyEvent(n.event,a):this.updateEvent(n.event,a))},getData:function(t){var e=this.getContext(),i={},n=this.view.getIdByIndex(this.locate(t)),r=e.moveMode,a=e.dx,o=e.step,s=Math.round(a/(o||this.getStep()));if(n!=e.start||e.$copy&&"0"!==e.event.id||s){"move"===r&&(i.section=n);var l=this.view.$scope.Scales;return webix.extend(i,function(t,e,i,n){var r={},a=e.precise?Ae[e.minUnit][0]:e.minUnit;if("start"===i||"move"===i){var o=e.precise?t.start_date:Te(a,t.start_date);r.start_date=De(a)(o,n),"start"===i&&Ke(r.start_date,t.end_date,r.all_day)&&(r.start_date=De(a)(t.end_date,-1)),webix.Date.equal(r.start_date,t.start_date)&&delete r.start_date}if("end"===i||"move"===i){var s=Te(a,t.end_date);o=e.precise||webix.Date.equal(s,t.end_date)?t.end_date:De(a)(s,1),r.end_date=De(a)(o,n),Ke(r.start_date||t.start_date,r.end_date,r.all_day)&&(r.end_date=De(a)(t.start_date,1)),webix.Date.equal(r.end_date,t.end_date)&&delete r.end_date}return r}(e.event,l,r,s)),i}return null},getStep:function(){var t=this.view.$scope.Scales,e=t.cellWidth;if(t.precise){var i=Ae[t.minUnit][1];e=Math.round(e/("number"==typeof i?i:i()))}return e}},Ue);function Ke(t,e,i){return i?e<t:e<=t}function Xe(t,e){var i=t.getBoundingClientRect(),n=(e-i.left)/i.width,r=webix.env.touch?400:200,a=.2/(i.width>r?i.width/r:1);return n<a&&-1==t.className.indexOf("webix_scheduler_event_break_left")?"start":n>1-a&&-1==t.className.indexOf("webix_scheduler_event_break_right")?"end":"move"}function Qe(t,e){return t.senseX=Math.round(e.cellWidth*(webix.env.touch?1:.5)),t.senseY=Math.round(e.cellHeight*(webix.env.touch?3:1)),t}var Je={day:Ne,month:je,more:Ye,multiday:Ge,units:ze,multidayUnits:We,timeline:qe,timelineMore:webix.extend({mode:"timeline",dragScroll:null,$dragCreate:function(t,e,i){var n=this.getContext();if(n.$touch="touch"===i,this.State.readonly)return!1;var r=this.view.locate(e);if(r){var a=this.view.getItemNode(r).children[0];if(webix.extend(n,{from:this,id:r,moveMode:"move",more:!0},!0),n.event=this.master.Events.getItem(r),n.x=n.event.$x+parseInt(t.offsetParent.style.left),n.start=this.master.ID,this.setDragOffset(a,t,e),!this.master.app.callEvent("app:beforedrag",[n,e]))return!1;var o=document.createElement("DIV");return o.style.width=n.width+"px",o.style.height=n.height+"px",o.appendChild(a.cloneNode(!0)),o.className=t.className+" webix_drag_zone webix_drag_event",document.body.appendChild(o),this.master.HideWindow(),o}return!1},$dragDestroy:function(t,e){return webix.html.remove(e),!1}},qe)},Ze=function(t){function e(e,i){var n=t.call(this,e)||this;return i&&(n.WeekDayNum=i.day),n}return n(e,t),e.prototype.config=function(){var t=this;return{view:"list",localId:"dayList",css:"webix_scheduler_day_events",scroll:!1,autoheight:!0,template:"",type:{height:42,css:"webix_scheduler_day_scale_item"},onClick:{webix_scheduler_day_event:function(e){return t.ShowEvent(e)}},onDblClick:{webix_scheduler_day_scale_item:function(e,i){return t.ShowNew(i)}}}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.List=this.$$("dayList"),Se(this,"scale"),Vt(this),this.List.$setSize=function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this.render()},this.minEventHeight=62,this.ParseHours(),this.on(this.State.$changes,"readonly",(function(){return t.List.render()})),this.List.attachEvent("onAfterRender",(function(){return t.RenderEvents()})),Re.call(this,this.List,"day");var e=this.getParam("compact",!0);!this.app.config.copypaste||webix.env.mobile||e||ie(this,this.List)},e.prototype.urlChange=function(){var t=this;if(this.data=this.getParam("data"),this.data){if(this.Day=webix.Date.datePart(this.State.date,!0),this.WeekDayNum>-1){var e=this.data.start;this.Day=webix.Date.add(e,this.WeekDayNum,"day",!0)}var i=webix.Date.add(this.Day,1,"day",!0);this.Events=this.FilterToday(this.Day,i),this._marker_update_interval&&(this._marker_update_interval=clearInterval(this._marker_update_interval)),ot(this.Day)&&(this._marker_update_interval=setInterval((function(){ot(t.Day)?t.UpdateMarkerPosition():(webix.html.remove(t._Marker),t._Marker=t._marker_update_interval=clearInterval(t._marker_update_interval))}),3e5)),this.List.render()}},e.prototype.GetEvent=function(t){for(var e=0;e<this.Events.length;e++)if(this.Events[e].id==t)return this.Events[e];return null},e.prototype.FilterToday=function(t,e){return this.WeekDayNum>-1?this.data.single.filter((function(i){return i.start_date<e&&i.end_date>t})):this.data.single},e.prototype.MarkToday=function(){if(this.Day&&ot(this.Day)){var t=webix.html.create("div",{class:"webix_scheduler_today_marker"});this._Marker=this.List.$view.firstChild.appendChild(t),this.UpdateMarkerPosition()}else this._Marker=null},e.prototype.UpdateMarkerPosition=function(){if(this._Marker){var t=new Date,e=60*t.getHours()+t.getMinutes();this._Marker.style.top=Math.round(e*this.List.type.height/60)+"px"}},e.prototype.RenderEvents=function(){var t=this,e=this.Events;if(e&&e.length){this.PrepareEvents();var i=webix.html.create("div",{role:"presentation"});i.innerHTML=e.map((function(e){return t.ToHTML(e)})).join(""),this._DataObj=this.List.$view.firstChild.appendChild(i),this.app.callEvent("events:rendered",[])}this.MarkToday()},e.prototype.PrepareEvents=function(){for(var t=this.Events,e=[],i=0;i<t.length;i++){var n=t[i];n.$inner=!1;var r=this.PruneStack(n,e);e.length&&(e[e.length-1].$inner=!0),r||(e.length?(n.$sorder=e[e.length-1].$sorder+1,n.$inner=!1):n.$sorder=0),e.splice(n.$sorder,0,n),e.length>(e.max_count||0)&&(e.max_count=e.length)}this.SetPosition(e,t)},e.prototype.PruneStack=function(t,e){for(;e.length&&this.GetEventEndDate(e[e.length-1])<=t.start_date;)e.splice(e.length-1,1);for(var i=0;i<e.length;i++)if(this.GetEventEndDate(e[i])<=t.start_date)return t.$sorder=e[i].$sorder,e.splice(i,1),t.$inner=!0,!0;return!1},e.prototype.SetPosition=function(t,e){for(var i=this.List.getFirstId()*this.List.type.height,n=0;n<e.length;n++){var r=e[n];r.$count=t.max_count;var a=Math.floor(this.List.$width/r.$count);r.$left=r.$sorder*a,r.$inner||(a*=r.$count-r.$sorder),r.$width=a-8;var o=at(this.Day,webix.Date.add(this.Day,1,"day",!0))(r),s=60*o.start_date.getHours()+o.start_date.getMinutes(),l=60*o.end_date.getHours()+o.end_date.getMinutes()||1440;r.$top=Math.round(s*this.List.type.height/60)-i,r.$height=Math.max(this.minEventHeight,(l-s)*this.List.type.height/60)}},e.prototype.ToHTML=function(t){var e=this.EventTemplate(t);return this.EventTemplateStart(t)+e+"</div>"},e.prototype.GetEventEndDate=function(t){var e=t.end_date;return(t.end_date-t.start_date)/6e4*this.List.type.height/60<this.minEventHeight&&(e=webix.Date.add(t.start_date,Math.ceil(this.minEventHeight/this.List.type.height*60),"minute",!0)),e},e.prototype.EventTemplateStart=function(t){var e='class="webix_scheduler_day_event '+(!this.State.selected||t.id!=this.State.selected.id&&t.id!=this.State.selected.date?"":"webix_scheduler_event_selected")+" "+(t.$past?"webix_scheduler_past_event":"")+'"';return"<div webix_e_id='"+t.id+"' "+e+" style='left:"+t.$left+"px; top:"+t.$top+"px; width:"+t.$width+"px; height:"+t.$height+"px; "+he(t)+"'>"},e.prototype.EventTemplate=function(t){var e=this.app.getService("locale")._,i=this.State.readonly?"":"<div class='webix_icon webix_scheduler_resizer' webix_resizer='true'></div>";return'<div class="webix_scheduler_inner_day"><span class="webix_scheduler_event_name">'+(t.text||e("(No title)"))+'</span><div class="webix_scheduler_event_time">'+webix.i18n.timeFormatStr(t.start_date)+" - "+webix.i18n.timeFormatStr(t.end_date)+"</div></div>"+i},e.prototype.ShowEvent=function(t){var e=Me(t,this.List.$view);if(e.id&&"0"!=e.id){var i=this.GetEvent(e.id),n=webix.extend(e,bt(i),!0);this.State.selected=n}return!1},e.prototype.GetTargetDate=function(t){var e=webix.Date.copy(this.Day||this.State.date);return t&&e.setHours(t),e},e.prototype.ShowNew=function(t){var e=this.State;e.readonly||e.clipboard||(e.selected={id:"0",date:this.GetTargetDate(t)})},e.prototype.UpdateSelection=function(t,e){this.State.selected&&(e.id=t,this.State.selected=bt(e))},e}(me),ti=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this);return i.cols[1]={view:"list",localId:"multiDayList",autoheight:!0,scroll:!1,css:"webix_scheduler_multilist",type:{height:36,template:function(t,i){return e.EventTemplate(t,i)}},onClick:{webix_scheduler_multiday_event:function(t,i,n){return e.ShowEvent(i,n)}}},i},e.prototype.init=function(){var e=this;this.State=this.app.getState(),t.prototype.init.call(this),this._DataObj=this.List.$view.firstChild,Se(this,"multi",!0),this.MoreIcon=this.$$("more"),this._moreBtn={id:"$wsh_multi_more",$css:"webix_scheduler_multi_more"},this.on(this.$$("multiDayList"),"onAfterRender",(function(){e.app.callEvent("events:rendered",[])})),this.app.config.copypaste&&!webix.env.mobile&&(Vt(this),ie(this,this.List,{multi:!0}))},e.prototype.urlChange=function(){var t=this.getParam("data");t&&(this.LimitData(t.multi),this.List.clearAll(),this.List.parse(t.multi))},e.prototype.EventTemplate=function(t,e){var i=e.height-8,n="height:"+i+"px; line-height:"+i+"px; width:calc(100% - 5px);",r="$wsh_multi_more"!==t.id?he(t):"",a=this.GetStyle(t),o=this.app.getService("locale")._;return'\n\t\t\t<div\n\t\t\t\tclass="'+a+'"\n\t\t\t\tstyle="'+n+" "+r+'">\n\t\t\t\t\t'+(t.text||o("(No title)"))+"\n\t\t\t</div>\n\t\t"},e.prototype.GetStyle=function(t){var e="webix_scheduler_multiday_event";if("$wsh_multi_more"==t.id)return e;var i=this.State.date,n=t.all_day||webix.Date.timePart(t.end_date)?t.end_date:webix.Date.add(t.end_date,-1,"day",!0);return e+=!this.State.selected||t.id!=this.State.selected.id&&t.id!=this.State.selected.date?"":" webix_scheduler_event_selected",e+=t.$past?" webix_scheduler_past_event":"",t.start_date<i&&(e+=" webix_scheduler_event_break_left"),n>=webix.Date.add(i,1,"day",!0)&&(e+=" webix_scheduler_event_break_right"),e},e.prototype.LimitData=function(t){if(t.length>this.maxVisibleLines){var e=t.length-2,i=this.app.getService("locale")._;this._moreBtn.text=e+" "+i("more"),"down"===this._expandState?this._reserve=t.splice(2,e,this._moreBtn):this._reserve=t.slice(2),this.SetMoreIcon(this._expandState),this._reserveIds=this._reserve.map((function(t){return t.id}))}else this.SetMoreIcon()},e.prototype.WrapData=function(){var t=this;if(!this._inAnimation){this._inAnimation=!0,this._expandState="down";var e=this.List.$height-(this._reserveIds.length-1)*this.List.type.height;this.Animate("down",e,(function(){t.List.add(t._moreBtn),t.List.remove(t._reserveIds)}))}},e.prototype.ExpandData=function(){this._inAnimation||(this._inAnimation=!0,this._expandState="up",this.Animate("up"),this.List.remove("$wsh_multi_more"),this.List.parse(this._reserve))},e.prototype.Animate=function(t,e,i){var n=this;this.List.$view.style.transition="height 150ms",e&&(this.List.$view.style.height=e+"px"),setTimeout((function(){i&&i(),n.List.$view.style.transition="",n._inAnimation=!1,n.SetMoreIcon(t)}),150)},e.prototype.SetMoreIcon=function(t){if(t){this._expandState=t;var e="up"===t?"Collapse":"Expand",i=this.app.getService("locale")._;this.MoreIcon.setHTML('<div class="webix_scheduler_more_icon webix_icon wxi-angle-'+t+'" webix_tooltip="'+i(e+" all-day events")+'"><div>')}else this.MoreIcon.setHTML("")},e.prototype.ShowEvent=function(t,e){if("$wsh_multi_more"===t)this.ExpandData();else{var i=bt(this.List.getItem(t));i.node=e,this.State.selected=i}return!1},e.prototype.GetEvent=function(t){return this.List.getItem(t)},e.prototype.GetTargetDate=function(){return this.State.date},e}(we),ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{css:"webix_scheduler_day",rows:[{view:"template",localId:"header",css:"webix_scheduler_day_header",height:32,template:function(t){return t.date?webix.Date.dateToStr("%l")(t.date):""}},{localId:"multi",hidden:!0,cols:[ti]},{localId:"scroll",view:"scrollview",css:"webix_scheduler_day_scroll",body:{cols:[me,Ze]}}]}},e.prototype.init=function(){var t=this,e=this.app.getState();this.on(e.$changes,"date",(function(e){return t.RefreshData(e)})),this.on(e.$changes,"active",(function(){return t.RefreshData(e.date)})),this.on(this.app,"events:refresh",(function(){return t.RefreshData(e.date)}));var i=this.app.getService("local").events(!0);this.on(i.data,"onStoreUpdated",(function(i,n,r){return r&&t.RefreshData(e.date)})),this.on(e.$changes,"selected",(function(i){i&&!e.clipboard&&t.ScrollScale(i)}))},e.prototype.RefreshData=function(t){var e=this;this.$$("header").setValues({date:t}),this.GetDay(t).then((function(t){e.app&&e.setParam("data",t,!0),t.multi.length?e.$$("multi").show():e.$$("multi").hide()}))},e.prototype.GetDay=function(t){var e=webix.Date.add(t,1,"day",!0);return this.app.getService("local").getEvents(t,e).then((function(t){var e=[],i=[];return t.forEach((function(t){st(t)?e.push(t):i.push(t)})),{multi:e,single:i}}))},e.prototype.ScrollScale=function(t){var e=this;"0"!==t.id||t.date||setTimeout((function(){var t=40*((new Date).getHours()+2);e.$$("scroll").scrollTo(0,t)}),100)},e}(p),ii=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return this.Events={},{view:"calendar",localId:"calendar",events:function(e,i){return t.MarkEvent(e,i)},icons:!1,navigation:!1,monthHeader:!1,skipEmptyWeeks:!0,width:0,height:410}},e.prototype.init=function(){var t=this;this.Calendar=this.getRoot(),this.Calendar.attachEvent("onAfterDateSelect",(function(e){t.app.getState().date=webix.Date.dayStart(e)}))},e.prototype.urlChange=function(){this.data=this.getParam("data"),this.data&&this.RefreshData()},e.prototype.RefreshData=function(){var t=this.data,e=t.start,i=t.weeks,n=t.data,r=webix.Date.add(e,i,"week",!0);for(this.Events={};e<r;){for(var a=webix.Date.add(e,1,"day",!0),o=0;o<n.length;o++)(n[o].all_day?n[o].end_date>=e:n[o].end_date>e)&&n[o].start_date<a&&(this.Events[e.valueOf()]=!0);e=a}this.Calendar.setValue(this.app.getState().date)},e.prototype.MarkEvent=function(t,e){var i="";return e||(i+=webix.Date.isHoliday(t)||""),this.Events[t.valueOf()]&&(i+=" webix_cal_day_with_event"),i},e}(p),ni=function(t){function e(e,i){var n=t.call(this,e)||this;return n.Events=i.events,n.drag=!!webix.isUndefined(i.drag)||i.drag,n}return n(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",width:266,padding:8,minHeight:70,relative:"right",body:{view:"list",css:"webix_scheduler_more_list",borderless:!0,autoheight:!0,yCount:3,tooltip:{template:""},onClick:{webix_scheduler_month_event:function(e,i){return t.ShowEvent(i)},webix_scheduler_month_event_single:function(e,i){return t.ShowEvent(i)}},type:{height:56,template:function(i,n){return t.MoreTemplate(i,n,e)}}}}},e.prototype.init=function(t){this.Win=t,Vt(this),this.drag&&Re.call(this,t.getBody(),"more",!0)},e.prototype.MoreTemplate=function(t,e,i){var n=webix.i18n,r=!lt(t.start_date,t.all_day?webix.Date.add(t.end_date,1,"day",!0):t.end_date),a=r?"":he(t),o=!r&&this.webix.Date.equal(t.start_date,t.end_date),s="webix_scheduler_month_event"+(r?"_single":"");return t.$past&&(s+=" webix_scheduler_past_event"),'\n\t\t\t<div\n\t\t\t\tclass="'+s+'"\n\t\t\t\tstyle="'+a+'"\n\t\t\t>\n\t\t\t\t'+(r?ue(t):"")+'\n\t\t\t\t<div webix_tooltip="'+t.text+'" class="webix_event_text">'+(t.text||i("(No title)"))+'</div>\n\t\t\t\t<div class="webix_event_time">\n\t\t\t\t\t'+this.DayFormatStr(t.start_date)+"\n\t\t\t\t\t"+(o?"":n.timeFormatStr(t.start_date)+" -\n\t\t\t\t\t\t"+(r?"":" "+this.DayFormatStr(t.end_date))+"\n\t\t\t\t\t\t"+n.timeFormatStr(t.end_date))+"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"},e.prototype.DayFormatStr=function(t){return webix.Date.dateToStr("%F %j")(t)},e.prototype.ShowEvent=function(t){var e=this.Events.getItem(t);this.app.getState().selected=bt(e),this.HideWindow()},e.prototype.ShowWindow=function(t,e,i){var n=this;if(this.ID===t&&this.Win.isVisible())return this.Win.hide();this.ID=t,i=i.map((function(t){return n.Events.getItem(t)}));var r=this.Win.getBody();r.clearAll(),r.parse(i),this.Win.show(e)},e.prototype.HideWindow=function(){this.Win.hide()},e}(p),ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return{view:"dataview",css:"webix_scheduler_calendar",prerender:!0,xCount:7,yCount:5,width:0,height:0,scroll:!1,tooltip:{template:""},onClick:{webix_cal_date:function(e,i){return t.ShowDay(i)},webix_scheduler_month_event:function(e){return t.ShowEvent(e)},webix_scheduler_month_event_single:function(e){return t.ShowEvent(e)},webix_scheduler_more:function(e,i){return t.ShowMore(i)}},onDblClick:{webix_cal_day:function(e,i){return t.ShowNew(i)}},type:{height:"auto",width:"auto",template:function(e,i){return t.CalendarTemplate(e,i)},templateStart:fe,headerHeight:32,eventHeight:28,padding:8}}},e.prototype.init=function(t){var e=this;this.State=this.app.getState(),this.Calendar=t,t.type.master=this.Calendar,Se(this,"month"),Vt(this),this.Events=new webix.DataCollection({}),this.MoreWindow=this.ui(new(this.app.dynamic(ni))(this.app,{events:this.Events})),t.attachEvent("onAfterRender",(function(){return e.RenderEvents()})),Re.call(this,this.Calendar,"month"),this.app.config.copypaste&&!webix.env.mobile&&ie(this,t)},e.prototype.urlChange=function(){this.data=this.getParam("data",!0),this.data&&this.RefreshData()},e.prototype.CalendarTemplate=function(t){var e=this.app.getService("locale")._,i='<span class="webix_cal_date">'+t.date.getDate()+"</span>";return t.$more&&t.$more.length&&(i+='<div class="webix_scheduler_more">'+t.$more.length+" "+e("more")+"</div>"),i},e.prototype.GetDayCss=function(t,e){var i="webix_cal_day";return ot(t)&&(i+=" webix_cal_today"),t.getMonth()!=e?i+=" webix_cal_outside":i+=" "+(webix.Date.isHoliday(t)||""),i},e.prototype.GetMonthData=function(){for(var t=[],e=this.data,i=e.start,n=e.weeks,r=webix.Date.add(i,1,"week",!0).getMonth(),a=webix.Date.copy(i),o=0;o<7*n;o++){var s={date:webix.Date.copy(a),$css:this.GetDayCss(a,r)};(o+1)%7==0&&(s.right=!0),o>=7*(n-1)&&(s.bottom=!0),t.push(s),webix.Date.add(a,1,"day")}return t},e.prototype.RenderEvents=function(){if(this.Events.count()&&this.Calendar.count()){var t=webix.html.create("div",{role:"presentation",class:"webix_scheduler_month_events"}),e=this.data.start,i=this.Calendar.type,n=Math.floor((i.height-i.headerHeight+i.padding-2)/(i.eventHeight+i.padding)),r=webix.Date.copy(e),a=webix.Date.add(r,1,"week",!0),o="",s={},l=this.GetTargetDate(this.Calendar.getLastId()),u=this.GetTargetDate(this.Calendar.getFirstId());this.Calendar.data.each((function(t,e){t.date>=a&&(s={},r=a,a=webix.Date.add(r,1,"week",!0));var i=[],c=[];this.Events.data.each((function(o){var h=o.id;if(!(o.start_date>=a||o.end_date<r||!o.all_day&&webix.Date.equal(o.end_date,r)))if(webix.isUndefined(s[h])){if(o.start_date<webix.Date.add(t.date,1,"day",!0)&&o.end_date>=t.date){for(var p=0;!webix.isUndefined(c[p]);)p++;if(s[h]=p,p>=n)return i.push(h);var d={ms:u,me:l};d.single=this.IsSingleDay(o),d.length=1,d.single||(d.es=o.start_date,d.ee=o.all_day||webix.Date.timePart(o.end_date)?o.end_date:webix.Date.add(o.end_date,-1,"day",!0),d.length+=lt(d.ls=new Date(Math.max(r,d.es)),d.le=new Date(Math.min(a-1,d.ee)))),d.index=e,c[p]=this.ToHTML(o,p,d)}}else t.date<=o.end_date&&o.all_day||t.date<o.end_date?s[h]>=n?i.push(h):c[s[h]]="":delete s[h]}),this);var h=t.$more&&t.$more.length;t.$more=i,h!=i.length&&this.Calendar.render(t.id,t,"paint"),o+=c.join("")}),this),t.innerHTML=o,this._DataObj=this.Calendar.$view.firstChild.appendChild(t),this.app.callEvent("events:rendered",[])}},e.prototype.IsSingleDay=function(t){if(t.all_day)return!lt(t.start_date,webix.Date.add(t.end_date,1,"day",!0));var e=lt(t.start_date,t.end_date);return 1===e&&webix.Date.timePart(t.start_date)&&!webix.Date.timePart(t.end_date)&&(e=0),!e},e.prototype.ToHTML=function(t,e,i){var n=this.Calendar.type,r=i.single?"":he(t),a=i.length*n.width-n.padding,o=n.eventHeight,s=this.GetPosition(n,e,i.index),l="";i.single&&(l=ue(t)+'<span class="webix_event_time">'+webix.i18n.timeFormatStr(t.start_date)+"</span>");var u=this.GetStyle(t,i),c=this.app.getService("locale")._;return'\n\t\t\t<div\n\t\t\t\twebix_tooltip="'+t.text+'"\n\t\t\t\twebix_e_id="'+t.id+'"\n\t\t\t\tclass="'+u+'"\n\t\t\t\tstyle="height:'+o+"px;line-height:"+o+"px; width:"+a+"px; "+(s+r)+'">\n\t\t\t\t\t'+(l+(t.text||c("(No title)")))+"\n\t\t\t</div>\n\t\t"},e.prototype.GetStyle=function(t,e){var i="webix_scheduler_month_event"+(e.single?"_single":"");return i+=!this.State.selected||t.id!=this.State.selected.id&&t.id!=this.State.selected.date?"":" webix_scheduler_event_selected",i+=t.$past?" webix_scheduler_past_event":"",e.single||(e.es<e.ms&&webix.Date.equal(e.ms,webix.Date.dayStart(e.ls))?i+=" webix_scheduler_event_break_left":e.ee>=webix.Date.add(e.me,1,"day",!0)&&webix.Date.equal(e.me,webix.Date.dayStart(e.le))&&(i+=" webix_scheduler_event_break_right")),i},e.prototype.GetPosition=function(t,e,i){var n=Math.floor(i/this.Calendar.config.xCount),r=i%this.Calendar.config.xCount;return"\n\t\t\ttop:"+(n*t.height+t.headerHeight+e*(t.eventHeight+t.padding))+"px;\n\t\t\tleft:"+r*t.width+"px;\n\t\t"},e.prototype.RefreshData=function(){var t=this.data,e=t.data,i=t.weeks;this.Events.clearAll(),this.Events.parse(e),this.Events.sort((function(t,e){var i=webix.Date.dayStart(t.start_date),n=webix.Date.dayStart(e.start_date);if(webix.Date.equal(i,n)){var r=lt(t.start_date,t.end_date);return lt(e.start_date,e.end_date)-r||t.start_date-e.start_date}return i-n}));var n=this.GetMonthData();this.Calendar.clearAll(),this.Calendar.config.yCount!=i&&(this.Calendar.define("yCount",i),this.Calendar.resize()),this.Calendar.parse(n)},e.prototype.ShowMore=function(t){return this.MoreWindow.ShowWindow(t,this.Calendar.getItemNode(t),this.Calendar.getItem(t).$more||[]),!1},e.prototype.ShowEvent=function(t){var e=Me(t,this.Calendar.$view);if(e.id&&"0"!=e.id){var i=this.Events.getItem(e.id),n=webix.extend(e,bt(i),!0);this.State.selected=n}return!1},e.prototype.ShowNew=function(t){var e=this.State;if(!e.readonly&&!e.clipboard){var i=this.GetTargetDate(t);e.selected={id:"0",date:i}}},e.prototype.ShowDay=function(t){return this.app.getState().$batch({date:this.GetTargetDate(t),mode:"day"}),!1},e.prototype.GetTargetDate=function(t){return t?this.Calendar.getItem(t).date:this.State.date},e.prototype.GetEvent=function(t){return this.Events.getItem(t)},e.prototype.UpdateSelection=function(t,e){this.State.selected&&(e.id=t,this.State.selected=bt(e))},e}(p),ai=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{view:"dataview",css:"webix_scheduler_calendar_header",xCount:7,yCount:1,width:0,height:32,scroll:!1,type:{height:"auto",width:"auto",templateStart:fe}}},e.prototype.init=function(t){t.type.master=t,t.parse(this.GetHeaderData())},e.prototype.GetHeaderData=function(){for(var t=[],e=webix.Date.startOnMonday?1:0,i=0;i<7;i++)t.push({value:webix.i18n.calendar.dayShort[(e+i)%7]});return t[t.length-1].right=!0,t},e}(p),oi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;return{view:"list",type:{height:50,template:ce(this.app.getService("locale")._),timeStart:function(e){return t.TimeStart(e)}},on:{onItemClick:function(e){return t.ShowEvent(e)}}}},e.prototype.init=function(){this.List=this.getRoot(),this.State=this.app.getState(),webix.extend(this.List,webix.OverlayBox)},e.prototype.urlChange=function(){this.data=this.getParam("data"),this.data&&this.RefreshData()},e.prototype.RefreshData=function(){var t=this,e=webix.Date.datePart(this.State.date,!0),i=webix.Date.add(e,1,"day",!0);this.app.getService("local").getEvents(e,i).then((function(n){t.List.clearAll(),t.List.parse(n.map(at(e,i))),t.ToggleOverlay()}))},e.prototype.ToggleOverlay=function(){if(this.List.count())this.List.hideOverlay();else{var t=this.app.getService("locale")._;this.List.showOverlay(t("No Events"))}},e.prototype.ShowEvent=function(t){var e=this.List.getItem(t);this.State.selected=bt(e)},e.prototype.TimeStart=function(t){var e=this.app.getService("locale")._;return st(t)?e("All Day"):pe(t.start_date,t.end_date)},e}(p),si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{rows:this.getParam("compact",!0)?[ii,oi]:[ai,ri]}},e.prototype.init=function(){var t=this;this.Data=this.app.getService("local");var e=this.app.getState();this.on(e.$changes,"date",(function(e){return t.RefreshData(e)})),this.on(e.$changes,"active",(function(){return t.RefreshData(e.date)})),this.on(this.app,"events:refresh",(function(){return t.RefreshData(e.date)}));var i=this.app.getService("local").events(!0);this.on(i.data,"onStoreUpdated",(function(i,n,r){return r&&t.RefreshData(e.date)}))},e.prototype.RefreshData=function(t){var e=this,i=webix.Date.monthStart(t),n=webix.Date.add(i,1,"month",!0);i=webix.Date.weekStart(new Date(i.getFullYear(),i.getMonth(),1));var r=Math.ceil((n-i)/864e5/7);n=webix.Date.add(i,r,"week",!0),this.Data.getEvents(i,n).then((function(t){e.app&&e.setParam("data",{start:i,weeks:r,data:t},!0)}))},e}(p),li=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=webix.skin.$active,e=this.app.getService("locale")._,i=this.getParam("state",!0);return{view:"toolbar",height:t.barHeight,elements:[{},{view:"richselect",label:e("Timeline scale"),labelWidth:120,width:260,value:i.timelineMode,options:[{id:"day",value:e("Day")},{id:"week",value:e("Week")},{id:"month",value:e("Month")}],on:{onChange:function(t){i.timelineMode=t}}}]}},e}(p),ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var e=t.prototype.config.call(this);return e.width=360,e.relative="bottom",e},e.prototype.init=function(t){this.Win=t,Vt(this),Re.call(this,t.getBody(),"timelineMore",!0)},e.prototype.ShowWindow=function(t,e,i){var n=this;if(this.ID===t&&this.Win.isVisible())return this.Win.hide();this.ID=t,i=i.map((function(t){return n.Events.getItem(t)}));var r=this.Win.getBody();r.clearAll(),r.parse(i),this.Win.show(e,{x:e.clientWidth})},e}(ni),ci=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this,e=this.GetSectionHeight();return{cols:[{view:"treetable",localId:"sections",css:"webix_scheduler_timeline_sections",width:this.getParam("compact",!0)?80:200,header:!1,scroll:"y",rowHeight:e,scrollAlignY:!1,columns:[{id:"text",header:"",fillspace:!0}]},{view:"list",localId:"list",type:{height:e,template:""},css:"webix_scheduler_timeline"+(webix.env.touch?"_touch":"")+"_bars",onClick:{webix_scheduler_timeline_event:function(e){return t.ShowEvent(e)}},onDblClick:{webix_list_item:function(e,i){return t.ShowNew(e,i)}},tooltip:{template:""},scroll:"xy"}]}},e.prototype.init=function(){var t=this;this.Tree=this.$$("sections"),this.Bars=this.$$("list"),this.State=this.getParam("state",!0),this.InnerState=this.getParam("innerState",!0),this.Data=this.app.getService("local"),this.Events=new webix.DataCollection({scheme:{$change:function(e){return t.RefreshTask(e.id)}}}),this.MoreWindow=this.ui(new(this.app.dynamic(ui))(this.app,{events:this.Events})),Se(this,"month"),Vt(this),this._sectionsReady=this.Data.sections().then((function(e){t.Sections=e,t.Tree.parse(e),t.Bars.parse(e)})),this.HandleScroll();var e=this.app.getService("local").events(!0);this.on(e.data,"onStoreUpdated",(function(e,i,n){return n&&t.RefreshData()})),this.on(this.app,"events:refresh",(function(){return t.RefreshData()})),this.on(this.State.$changes,"active",(function(e,i){return i&&t.RefreshData()})),Re.call(this,this.Bars,"timeline"),this._mousemove_handler=webix.event(this.Bars.$view,"pointermove",(function(e){"mouse"==e.pointerType&&function(t,e){if(!webix.DragControl.active){var i=Me(t,e),n=i.id,r=i.node;if(n){var a=Xe(r,t.clientX);r.style.cursor="move"==a?"pointer":"ew-resize"}}}(e,t.Bars.$view)}));var i=this.getParam("compact",!0);!this.app.config.copypaste||webix.env.mobile||i||ie(this,this.Bars)},e.prototype.urlChange=function(){var t=this.Scales=this.getParam("scales",!0);this.DrawGrid(t),this.RefreshData(t)},e.prototype.GetSectionHeight=function(){var t=webix.skin.$active;return this._sectionSize=5,(t.barHeight-2*t.borderWidth)*this._sectionSize},e.prototype.RefreshData=function(t){var e=this;t||(t=this.Scales),webix.promise.all([this._sectionsReady,this.Data.getEvents(t.start,t.end)]).then((function(t){e.ClearCollections(),e.Events.parse(t[1]),e.RenderEvents()}))},e.prototype.ClearCollections=function(){this.Events.clearAll(),this._processed=[],this._lastRow={},this._moreEvents={}},e.prototype.RefreshTask=function(t){var e=this,i=this.GetEvent(t),n=function(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1}(this.Sections.data.order,i.section);if(-1!=n){var r=this.State.timelineMode,a=this.GetUnitCount(r);"day"===r&&"week"===r||(a=this.GetUnitCount(a));var o,s=this._processed.find((function(t){if(t.section==i.section){if("day"===r)return e.CheckDates(t.end_date,i.start_date,t.all_day);var n=webix.Date.timePart(t.end_date)?e.GetUnitStart(a,webix.Date.add(t.end_date,1,a,!0)):t.end_date,o=e.GetUnitStart(a,i.start_date);return e.CheckDates(n,o,t.all_day)}return!1}));s?(o=s.$y,this._processed.splice(this._processed.findIndex((function(t){return s.id==t.id})),1)):(webix.isUndefined(this._lastRow[i.section])?this._lastRow[i.section]=0:this._lastRow[i.section]++,this._lastRow[i.section]>=this._sectionSize-1?i.$more=!0:i.$more=!1),this.UpdateTask(i,n,o),this._processed.push(i),this._processed.sort((function(t,e){return t.$y-e.$y}))}else i.$hide=!0},e.prototype.CheckDates=function(t,e,i){return(i?webix.Date.add(t,1,"day",!0):t)<=e},e.prototype.RenderEvents=function(){var t=this;if(this._DataObj&&(this.Bars.$view.firstChild.removeChild(this._DataObj),delete this._DataObj),this.Events.count()&&this.Bars.count()){var e=webix.html.create("div",{role:"presentation"}),i="",n=this.app.getService("locale")._;this.Events.data.each((function(e){e.$hide||(e.$more&&4!=t._lastRow[e.section]?(t._moreEvents[e.section]||(t._moreEvents[e.section]=[],i+=t.MoreBarTemplate(e,n)),t._moreEvents[e.section].push(e.id)):i+=t.BarsTemplate(e,n))})),e.innerHTML=i,this._DataObj=this.Bars.$view.firstChild.appendChild(e),this.app.callEvent("events:rendered",[])}},e.prototype.DrawGrid=function(t){var e=this.Bars;e.$view.style.backgroundImage="url("+this.GetGrid(t,{contrast:"#808080",dark:"#384047"}[webix.skin.$name]||"#ddd")+")",e.$view.style.marginTop="0px",e.$view.style.backgroundPosition="-"+this.InnerState.left+"px -"+this.InnerState.top+"px",this.Resize(t.width)},e.prototype.Resize=function(t){var e=this.Bars.$view.querySelector(".webix_scroll_cont");e.style.width=t+"px",e.style.minHeight="1px"},e.prototype.HandleScroll=function(){var t=this;this.InnerState=this.getParam("innerState",!0),this._scroll_handler=webix.event(this.Bars.$view,"scroll",(function(e){var i=e.target,n=Math.round(i.scrollTop),r=Math.round(i.scrollLeft);t.Bars.$view.style.backgroundPosition="-"+r+"px -"+n+"px",t.InnerState.$batch({top:n,left:r}),t.Tree.scrollTo(0,n),t.MoreWindow.HideWindow()})),this.on(this.Tree,"onScrollY",(function(){var t=this.getScrollState().y;this.$scope.Bars.scrollTo(this.$scope.InnerState.left,t)}))},e.prototype.BarsTemplate=function(t,e){var i=he(t),n=this.Scales,r=t.$w-2;t.all_day&&t.end_date<n.end&&(r+=this.GetUnitWidth(n,t.start_date));var a='<div class="webix_scheduler_timeline_content">'+(t.text||e("(no title)"))+"</div>",o="webix_scheduler_timeline_event";o+=!this.State.selected||t.id!=this.State.selected.id&&t.id!=this.State.selected.date?"":" webix_scheduler_event_selected",t.start_date<this.Scales.start?o+=" webix_scheduler_event_break_left":t.end_date>this.Scales.end&&(o+=" webix_scheduler_event_break_right");var s=this.GetTooltip(t);return'<div webix_e_id="'+t.id+'" \n\t\t\twebix_tooltip="'+s+'" class="'+o+'" \n\t\t\tstyle="left:'+t.$x+"px;top:"+t.$y+"px;width:"+r+"px;height:"+t.$h+"px;"+i+'">\n\t\t\t'+a+"\n\t\t</div>"},e.prototype.GetTooltip=function(t){return t.text},e.prototype.MoreBarTemplate=function(t,e){var i=e("Show more"),n='<div class="webix_scheduler_timeline_content" webix_tooltip="'+i+'">'+i+"</div>";return'<div webix_e_id="$wsh_multi_more" webix_r_id="'+t.section+'" class="webix_scheduler_timeline_event webix_scheduler_multi_more" style="left:0px;top:'+t.$y+"px;width:100%;height:"+t.$h+'px;">\n\t\t\t'+n+"\n\t\t</div>"},e.prototype.ShowEvent=function(t){var e=Me(t,this.Bars.$view);if("$wsh_multi_more"===e.id){var i=e.node.getAttribute("webix_r_id");this.MoreWindow.ShowWindow(i,this.Tree.getItemNode(i),this._moreEvents[i]||[])}else if(e.id&&"0"!=e.id){var n=this.GetEvent(e.id),r=webix.extend(e,bt(n),!0);this.State.selected=r}return!1},e.prototype.ShowNew=function(t,e){var i=this.State;if(!i.readonly&&!i.clipboard){var n=this.Scales,r=n.start,a=n.precise?this.GetUnitCount(n.minUnit):n.minUnit,o=Math.floor(t.offsetX/this.GetUnitWidth(n)),s=this.AddUnit(a,r,o);i.selected={id:"0",date:s,section:e}}},e.prototype.GetEvent=function(t){return this.Events.getItem(t)},e.prototype.UpdateSelection=function(t,e){this.State.selected&&(e.id=t,this.State.selected=bt(e))},e.prototype.GetTargetDate=function(){var t=this.mousePosUnit||0,e=this.Scales;return this.AddUnit(e.minUnit,e.start,t)},e.prototype.GetUnitCount=function(t){return Ae[t][0]},e.prototype.GetUnitStart=function(t,e){return Te(t,e)},e.prototype.AddUnit=function(t,e,i){return De(t)(e,i)},e.prototype.GetGrid=function(t,e){return Ee(t.cellWidth,t.cellHeight,e)},e.prototype.UpdateTask=function(t,e,i){return Ie(t,this._lastRow[t.section]+e*this._sectionSize,this.Scales,this.Scales.cellHeight-12,i)},e.prototype.GetUnitWidth=function(t,e){if(t.precise&&("day"!==t.minUnit||"month"!==t.minUnit)){var i=Ae[t.minUnit][1],n="number"==typeof i?i:i(e);return Math.floor(t.cellWidth/n)}return t.cellWidth},e}(p),hi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{cols:[{width:this.getParam("compact",!0)?80:200,css:"webix_scheduler_timeline_space",borderless:!1},{view:"template",localId:"scale",height:20,css:"webix_scheduler_timeline_scale"}]}},e.prototype.init=function(){var t=this.$$("scale"),e=this.InnerState=this.getParam("innerState",!0);this.on(e.$changes,"left",(function(e){return t.scrollTo(e,null)}))},e.prototype.urlChange=function(){this.RenderScales()},e.prototype.RenderScales=function(){var t=this,e=this.getParam("scales",!0),i=this.$$("scale"),n=e.rows.map((function(i){return'<div class="webix_scheduler_timeline_scale_row" style=\'height:'+i.height+"px;width:"+e.width+"px'>"+i.cells.map((function(e){return t.CellTemplate(e,i.type)})).join("")+"</div>"})).join("");i.config.height=e.height,i.setHTML(n),i.resize()},e.prototype.CellTemplate=function(t){return'<div class="webix_scheduler_timeline_scale_cell '+t.css+'" style="width:'+t.width+'px;">'+t.format(t.date)+"</div>"},e.prototype.DateIsToday=function(t){var e=webix.Date.dayStart(new Date);return webix.Date.equal(e,webix.Date.dayStart(t))},e}(p),pi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{rows:[li,hi,ci]}},e.prototype.init=function(){var t=this,e=this.State=this.getParam("state",!0),i=this.InnerState=U({top:0,left:0});this.setParam("innerState",i,!0),this.on(e.$changes,"date",(function(i){return t.SetScales(i,e.timelineMode)})),this.on(e.$changes,"timelineMode",(function(i,n){n&&t.SetScales(e.date,i)}))},e.prototype.SetScales=function(t,e){var i=this.ResetScales(e,t);this.setParam("scales",i,!0)},e.prototype.GetScalesArray=function(t){switch(t){case"day":return[{unit:"hour",format:"%H:00"}];case"week":return[{unit:"day",step:1,format:"%d"}];case"month":return[{unit:"week",format:function(t){var e=webix.Date.dateToStr("%d %M"),i=webix.Date.weekStart(t),n=webix.Date.add(webix.Date.add(i,1,"week",!0),-1,"day",!0);return e(i)+" - "+e(n)}}];default:return[{unit:this.GetDefaultScaleUnit(t),format:function(t,e){var i=webix.Date.dateToStr("%d %M %YYYY");return i(t)+" - "+i(e)}}]}},e.prototype.GetScalesCellWidth=function(t){switch(t){case"day":return 80;case"week":return 300;case"month":return 400;default:return 100}},e.prototype.GetScalePrecision=function(t){switch(t){case"day":case"week":return!1;default:return!0}},e.prototype.AddUnit=function(t,e,i){return De(t)(e,i)},e.prototype.GetUnitStart=function(t,e){return Te(t,e)},e.prototype.ResetScales=function(t,e){var i=this.GetUnitStart(t,e),n=this.AddUnit(t,i,1),r=webix.skin.$active;return Le(i,n,this.GetScalePrecision(t),this.GetScalesCellWidth(t),r.barHeight-2*r.borderWidth,this.GetScalesArray(t))},e.prototype.GetDefaultScaleUnit=function(t){return Ae[t][0]||t},e}(p),di=function(t){function e(e,i){var n=t.call(this,e)||this;return i&&(n.Unit=i.unit),n}return n(e,t),e.prototype.config=function(){var t=this;return{view:"list",localId:"unitList",css:"webix_scheduler_day_events",scroll:!1,autoheight:!0,template:"",type:{height:42,css:"webix_scheduler_day_scale_item"},onClick:{webix_scheduler_day_event:function(e){return t.ShowEvent(e)}},onDblClick:{webix_scheduler_day_scale_item:function(e,i){return t.ShowNew(i)}}}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.List=this.$$("unitList"),Se(this,"scale"),Vt(this),this.List.$setSize=function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this.render()},this.minEventHeight=62,this.ParseHours(),this.on(this.State.$changes,"readonly",(function(){return t.List.render()})),this.List.attachEvent("onAfterRender",(function(){return t.RenderEvents()})),Re.call(this,this.List,"units");var e=this.getParam("compact",!0);!this.app.config.copypaste||webix.env.mobile||e||ie(this,this.List)},e.prototype.FilterToday=function(e,i){var n=this;return t.prototype.FilterToday.call(this,e,i).filter((function(t){if(t.units){var e=t.units.split(","),i=n.Unit.id+"";return-1!==e.indexOf(i)}return!1}))},e.prototype.ShowNew=function(t){var e=this.State;if(!e.readonly&&!e.clipboard){var i=webix.Date.copy(this.Day||e.date),n=this.Unit.id;i.setHours(t),e.selected={id:"0",date:i,unit:n}}},e}(Ze),fi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{type:"clean",cols:[{borderless:!1,width:51},{view:"dataview",localId:"header",css:"webix_scheduler_day_header",xCount:1,yCount:1,width:0,height:32,scroll:!1,type:{height:"auto",width:"auto"},template:function(t){return t.value}}]}},e.prototype.init=function(){var t=this;this.Header=this.$$("header"),this.Units=this.app.getService("local").units(),this.Units.then((function(e){t.Header.sync(e,(function(){t.Header.define({xCount:e.count()}),t.Header.resize()}))}))},e}(p),gi=function(t){function e(e,i){var n=t.call(this,e)||this;return i&&(n.Unit=i.unit),n}return n(e,t),e.prototype.config=function(){var t=this;return{view:"list",localId:"multiDayList",autoheight:!0,scroll:!1,css:"webix_scheduler_multilist",type:{height:36,template:function(e,i){return t.EventTemplate(e,i)}},onClick:{webix_scheduler_multiday_event:function(e,i,n){return t.ShowEvent(i,n)}}}},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.List=this.$$("multiDayList"),this._expandState="down",this.maxVisibleLines=3,this._DataObj=this.List.$view.firstChild,Se(this,"multi",!0),this._moreBtn={id:"$wsh_multi_more",$css:"webix_scheduler_multi_more"},this.on(this.app,"units:multi:state",(function(e){e!==t._expandState&&("down"===e?t.WrapData():t.ExpandData())})),Re.call(this,this.List,"multidayUnits"),Vt(this),this.app.config.copypaste&&!webix.env.mobile&&ie(this,this.List,{multi:!0})},e.prototype.urlChange=function(){var t=this.getParam("data");if(t){var e=webix.copy(t.multi),i=this.FilterByUnits(e);this.LimitData(i),this.List.clearAll(),this.List.parse(i)}},e.prototype.EventTemplate=function(t,e){var i=e.height-8,n="height:"+i+"px; line-height:"+i+"px; width:calc(100% - 5px);",r="$wsh_multi_more"!==t.id?he(t):"",a=this.GetStyle(t),o=this.app.getService("locale")._;return'\n\t\t\t<div\n\t\t\t\tclass="'+a+'"\n\t\t\t\tstyle="'+n+" "+r+'">\n\t\t\t\t\t'+(t.text||o("(No title)"))+"\n\t\t\t</div>\n\t\t"},e.prototype.GetStyle=function(t){var e="webix_scheduler_multiday_event";if("$wsh_multi_more"==t.id)return e;var i=this.State.date,n=t.all_day||webix.Date.timePart(t.end_date)?t.end_date:webix.Date.add(t.end_date,-1,"day",!0);return e+=!this.State.selected||t.id!=this.State.selected.id&&t.id!=this.State.selected.date?"":" webix_scheduler_event_selected",e+=t.$past?" webix_scheduler_past_event":"",t.start_date<i&&(e+=" webix_scheduler_event_break_left"),n>=webix.Date.add(i,1,"day",!0)&&(e+=" webix_scheduler_event_break_right"),e},e.prototype.LimitData=function(t){if(delete this._reserve,delete this._reserveIds,t.length>this.maxVisibleLines){var e=t.length-2,i=this.app.getService("locale")._;this._moreBtn.text=e+" "+i("more"),"down"===this._expandState?this._reserve=t.splice(2,e,this._moreBtn):this._reserve=t.slice(2),this._reserveIds=this._reserve.map((function(t){return t.id})),this.app.callEvent("units:multi:state",[this._expandState,!1])}},e.prototype.WrapData=function(){var t=this;if(!this._inAnimation&&(this._expandState="down",this._reserveIds)){this._inAnimation=!0;var e=this.List.$height-(this._reserveIds.length-1)*this.List.type.height;this.Animate("down",e,(function(){t.List.add(t._moreBtn),t.List.remove(t._reserveIds)}))}},e.prototype.ExpandData=function(){var t=this.List.exists("$wsh_multi_more");this._inAnimation||(this._expandState="up",t&&(this._inAnimation=!0,this.Animate("up"),this.List.remove("$wsh_multi_more"),this.List.parse(this._reserve)))},e.prototype.Animate=function(t,e,i){var n=this;this.List.$view.style.transition="height 150ms",e&&(this.List.$view.style.height=e+"px"),setTimeout((function(){i&&i(),n.List.$view.style.transition="",n._inAnimation=!1}),150)},e.prototype.ShowEvent=function(t,e){if("$wsh_multi_more"===t)this.app.callEvent("units:multi:state",["up",!0]);else{var i=bt(this.List.getItem(t));i.node=e,this.State.selected=i}return!1},e.prototype.FilterByUnits=function(t){var e=this;return t.filter((function(t){if(t.units){var i=t.units.split(","),n=e.Unit.id+"";return-1!==i.indexOf(n)}return!1}))},e.prototype.GetEvent=function(t){return this.List.getItem(t)},e.prototype.GetTargetDate=function(){return this.State.date},e}(p),vi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this),n=this.app.getService("local").units();return i.cols[0].onClick={"wxi-angle-down":function(){return e.app.callEvent("units:multi:state",["up",!0])},"wxi-angle-up":function(){return e.app.callEvent("units:multi:state",["down",!0])}},i.cols[1]={cols:[]},n.then((function(t){for(var n=t.serialize(),r=0;r<n.length;++r)i.cols[1].cols.push(new(e.app.dynamic(gi))(e.app,{unit:n[r]}));return i}))},e.prototype.init=function(){var t=this;this.State=this.app.getState(),this.MoreIcon=this.$$("more"),this.on(this.State.$changes,"date",(function(){t.SetMoreIcon()})),this.on(this.app,"units:multi:state",(function(e,i){t.Animate(e,i?150:1)}))},e.prototype.Animate=function(t,e){var i=this;setTimeout((function(){i.SetMoreIcon(t)}),e)},e}(we),mi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var t=this;this.Compact=this.getParam("compact",!0);var e=this.app.getService("local").units(),i={localId:"multi",hidden:!0,cols:[vi]},n={localId:"scroll",view:"scrollview",scroll:"y",css:"webix_scheduler_week_days",body:{cols:[me]}};return e.then((function(e){for(var r=e.serialize(),a=0;a<r.length;++a)n.body.cols.push(new(t.app.dynamic(di))(t.app,{unit:r[a]}));return{rows:[fi,i,n]}}))},e.prototype.init=function(){var t=this,e=this.app.getState();this.on(e.$changes,"date",(function(e){return t.RefreshData(e)})),this.on(e.$changes,"active",(function(){return t.RefreshData(e.date)})),this.on(this.app,"events:refresh",(function(){return t.RefreshData(e.date)}));var i=this.app.getService("local").events(!0);this.on(i.data,"onStoreUpdated",(function(i,n,r){return r&&t.RefreshData(e.date)}))},e.prototype.RefreshData=function(t){var e=this;this.GetDay(t).then((function(t){e.app&&e.setParam("data",t,!0),t.multi.length?e.$$("multi").show():e.$$("multi").hide()}))},e.prototype.GetDay=function(t){var e=webix.Date.add(t,1,"day",!0);return this.app.getService("local").getEvents(t,e).then((function(t){var e=[],i=[];return t.forEach((function(t){st(t)?e.push(t):i.push(t)})),{multi:e,single:i}}))},e}(p),wi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var e=t.prototype.config.call(this);return e.css="webix_scheduler_week",e.type.headerHeight=28,e},e.prototype.urlChange=function(){this.data=this.getParam("data"),this.data&&(this.List.clearAll(),this.List.parse(this.data.all),this.ToggleOverlay())},e.prototype.TemplateHeader=function(t){var e=new Date(1*t),i="%l, %F <span class='webix_scheduler_monthday"+(ot(e)?" webix_scheduler_today":"")+"'>%j</span>";return'<span class="webix_unit_header_inner">'+webix.Date.dateToStr(i)(e)+"</span>"},e}(ge),_i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{type:"clean",cols:[{borderless:!1,width:51},{view:"dataview",localId:"header",css:"webix_scheduler_day_header",xCount:7,yCount:1,width:0,height:32,scroll:!1,type:{height:"auto",width:"auto"},template:function(t){return'<span class="webix_scheduler_weekday">'+t.day+'</span> <span class="webix_scheduler_monthday">'+t.date+"</span>"}}]}},e.prototype.urlChange=function(){this.data=this.getParam("data"),this.data&&this.RefreshData()},e.prototype.RefreshData=function(){for(var t=this.data.start,e=[];t<this.data.end;){var i={day:webix.i18n.calendar.dayShort[t.getDay()],date:t.getDate()};ot(t)&&(i.$css="webix_scheduler_list_today"),e.push(i),t=webix.Date.add(t,1,"day",!0)}var n=this.$$("header");n.clearAll(),n.parse(e)},e}(p),yi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this);return i.cols[1]={view:"dataview",localId:"multiDayList",css:"webix_scheduler_multidays",scroll:!1,height:32,xCount:7,yCount:1,width:0,type:{width:"auto",height:"auto",itemHeight:36},template:"",tooltip:{template:""},onClick:{webix_scheduler_multiday_event:function(t){return e.ShowEvent(t)}}},i},e.prototype.init=function(){var e=this;this.State=this.app.getState(),t.prototype.init.call(this),Se(this,"multi"),Vt(this),this.Events=new webix.DataCollection({}),this.List.attachEvent("onAfterRender",(function(){return e.RenderEvents()})),Re.call(this,this.List,"multiday"),this.app.config.copypaste&&!webix.env.mobile&&ie(this,this.List)},e.prototype.urlChange=function(){this.data=this.getParam("data"),this.data&&this.ParseDays(this.data.multi)},e.prototype.ParseDays=function(t){if(t.length){this.Events.clearAll(),this.Events.parse(t);for(var e=[],i=0;i<7;i++)e.push({id:i+1,date:webix.Date.add(this.data.start,i,"day",!0)});this.BreakEventsByDay(e),this.SetMoreIcon(this._maxEvents>this.maxVisibleLines?this._expandState:null),this.List.blockEvent(),this.List.parse(e),this.ResetListHeight(),this.List.unblockEvent(),this.RenderEvents()}},e.prototype.BreakEventsByDay=function(t){var e=this;this.Days=[];var i={};this._maxEvents=0,t.forEach((function(t,n){var r=t.date;e.Days.push([]),e.Events.data.each((function(t){if(webix.isUndefined(i[t.id])){if(t.start_date<webix.Date.add(r,1,"day",!0)&&t.end_date>=r){for(var a=0;!webix.isUndefined(e.Days[n][a]);)a++;i[t.id]=a;var o={};o.es=t.start_date,o.ee=t.all_day||webix.Date.timePart(t.end_date)?t.end_date:webix.Date.add(t.end_date,-1,"day",!0),o.length=1+lt(o.ls=new Date(Math.max(e.data.start,o.es)),o.le=new Date(Math.min(e.data.end-1,o.ee))),t.$config=o,e.Days[n][a]=t}}else r<=t.end_date&&t.all_day||r<t.end_date?e.Days[n][i[t.id]]="":delete i[t.id]})),e.Days[n].length>e._maxEvents&&(e._maxEvents=e.Days[n].length)}))},e.prototype.RenderEvents=function(){var t=this,e=this.Events.count();if(e){var i=webix.html.create("div",{role:"presentation"}),n="",r=0,a="down"===this._expandState&&this._maxEvents>this.maxVisibleLines;this.List.data.each((function(e,i){for(var o=[],s=a?t.maxVisibleLines-1:t.Days[i].length,l=0;l<s;++l)o[l]=t.Days[i][l],o[l]&&(o[l]=t.ToHTML(o[l],i,l),r++);n+=o.join("")})),a&&(n+=this.MoreOption(e-r)),i.innerHTML=n,this._DataObj=this.List.$view.firstChild.appendChild(i),this.app.callEvent("events:rendered",[])}},e.prototype.ToHTML=function(t,e,i){var n=he(t),r=this.GetSizePosition(t.$config.length,e,i),a=this.GetStyle(t,t.$config),o=this.app.getService("locale")._;return'\n\t\t\t<div\n\t\t\t\twebix_tooltip="'+(t.text||o("(No title)"))+'"\n\t\t\t\twebix_e_id="'+t.id+'"\n\t\t\t\tclass="'+a+'"\n\t\t\t\tstyle="'+r+" "+n+'">\n\t\t\t\t\t'+(t.text||o("(No title)"))+"\n\t\t\t</div>\n\t\t"},e.prototype.GetStyle=function(t,e){var i=this.data,n=i.start,r=i.end,a="webix_scheduler_multiday_event";return a+=!this.State.selected||t.id!=this.State.selected.id&&t.id!=this.State.selected.date?"":" webix_scheduler_event_selected",e.es<n&&webix.Date.equal(n,webix.Date.dayStart(e.ls))&&(a+=" webix_scheduler_event_break_left"),e.ee>=r&&webix.Date.equal(webix.Date.add(r,-1,"day",!0),webix.Date.dayStart(e.le))&&(a+=" webix_scheduler_event_break_right"),a+(t.$past?" webix_scheduler_past_event":"")},e.prototype.MoreOption=function(t){var e=this.app.getService("locale")._;return'<div webix_e_id="$wsh_multi_more" class="webix_scheduler_multiday_event webix_scheduler_multi_more" style="'+this.GetSizePosition(this.List.config.xCount,0,this.maxVisibleLines-1)+'">'+t+" "+e("more")+"</div>"},e.prototype.GetSizePosition=function(t,e,i){var n=t*this.List.type.width-4,r=this.List.type.itemHeight-8;return"width:"+n+"px; height:"+r+"px; line-height:"+r+"px; left:"+(this.List.type.width*e+1)+"px; top:"+(i*this.List.type.itemHeight+4)+"px;"},e.prototype.ShowEvent=function(t){var e=Me(t,this.List.$view);if(e.id){if("$wsh_multi_more"===e.id)return this.ExpandData();var i=this.Events.getItem(e.id),n=webix.extend(e,bt(i),!0);this.State.selected=n}return!1},e.prototype.ExpandData=function(){this._inAnimation||(this._inAnimation=!0,this._expandState="up",this.Animate("up"),this.ResetListHeight(this._maxEvents))},e.prototype.WrapData=function(){var t=this;if(!this._inAnimation){this._inAnimation=!0,this._expandState="down";var e=this.List.$height-(this._maxEvents-this.maxVisibleLines)*this.List.type.height;this.Animate("down",e,(function(){t.ResetListHeight(t.maxVisibleLines)}))}},e.prototype.ResetListHeight=function(t){t||(t="down"===this._expandState?Math.min(this._maxEvents,this.maxVisibleLines):this._maxEvents);var e=t*this.List.type.itemHeight;this.List.type.height!==e&&(this.List.type.height=e,this.List.define("height",e),this.List.resize())},e.prototype.GetEvent=function(t){return this.Events.getItem(t)},e.prototype.GetTargetDate=function(t){return t?this.List.getItem(t).date:this.State.date},e}(we),bi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){if(this.Compact=this.getParam("compact",!0),this.Compact)return{rows:[wi]};for(var t={localId:"scroll",view:"scrollview",scroll:"y",css:"webix_scheduler_week_days",body:{cols:[me]}},e=0;e<7;++e)t.body.cols.push(new(this.app.dynamic(Ze))(this.app,{day:e}));return{rows:[_i,{localId:"multi",hidden:!0,cols:[yi]},t]}},e.prototype.init=function(){var t=this,e=this.app.getState();this.on(e.$changes,"date",(function(e){return t.RefreshData(e)})),this.on(e.$changes,"active",(function(){return t.RefreshData(e.date)})),this.on(this.app,"events:refresh",(function(){return t.RefreshData(e.date)}));var i=this.app.getService("local").events(!0);this.on(i.data,"onStoreUpdated",(function(i,n,r){return r&&t.RefreshData(e.date)})),this.Compact||this.on(e.$changes,"selected",(function(e){return e&&t.ScrollScale(e)}))},e.prototype.RefreshData=function(t){var e=this,i=webix.Date.weekStart(t),n=webix.Date.add(i,1,"week",!0);this.GetWeek(i,n).then((function(t){e.app&&e.setParam("data",t,!0),t.multi.length?e.$$("multi").show():e.$$("multi").hide()}))},e.prototype.GetWeek=function(t,e){var i=this;return this.app.getService("local").getEvents(t,e).then((function(n){if(i.Compact)return{start:t,end:e,all:n};var r=[],a=[];return n.forEach((function(t){st(t)?r.push(t):a.push(t)})),{start:t,end:e,multi:r,single:a}}))},e.prototype.ScrollScale=function(t){var e=this;"0"!==t.id||t.date||setTimeout((function(){var t=40*((new Date).getHours()+2);e.$$("scroll").scrollTo(0,t)}),100)},e}(p),xi=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._month=i.month,n}return n(e,t),e.prototype.config=function(){var t=this;return this.DayEvents={},{view:"calendar",localId:"calendar",events:function(e){return t.MarkEvent(e)},icons:!1,navigation:!1,calendarHeader:"%F",skipEmptyWeeks:!0,borderless:!0,onClick:{webix_cal_day_with_event:function(e){return t.ShowEvents(e)},webix_cal_month:function(){return t.ShowMonth()}},onDblClick:{webix_cal_day:function(e){return t.ShowNew(e)}},on:{onChange:function(e,i){return"user"===i&&t.SetStateDate(e)}}}},e.prototype.init=function(){var t=this;this.Data=this.app.getService("local"),this.Calendar=this.getRoot(),this.Events=new webix.DataCollection({});var e,i,n=this.State=this.app.getState();this.on(n.$changes,"date",(function(e){return t.ManageDateChange(e)})),this.on(n.$changes,"active",(e=function(){return t.RefreshData(t.GetMonthStart(n.date))},i=!1,function(){if(i)return e.apply(this,arguments);i=!0})),this.on(this.app,"events:refresh",(function(){return t.RefreshData(t.GetMonthStart(n.date))}));var r=this.app.getService("local").events(!0);this.on(r.data,"onStoreUpdated",(function(e,i,r){return r&&t.RefreshData(t.GetMonthStart(n.date))})),this.Popup=this.ui(new(this.app.dynamic(ni))(this.app,{events:this.Events,drag:!1}))},e.prototype.SetStateDate=function(t){this.State.date=webix.Date.dayStart(t)},e.prototype.ManageDateChange=function(t){if(!this._date||this._date.getFullYear()!=t.getFullYear()){var e=this.MonthStart=this.GetMonthStart(t);this.Calendar.showCalendar(e),this.RefreshData(e)}this._month===t.getMonth()?this.Calendar.setValue(t):this.Calendar.getValue()&&this.Calendar.setValue(),this._date=t},e.prototype.GetMonthStart=function(t){return new Date(t.getFullYear(),this._month,1)},e.prototype.RefreshData=function(t){var e=this;this.DayEvents={};var i=webix.Date.add(t,1,"month",!0);this.Data.getEvents(t,i).then((function(n){e.Events.clearAll(),e.Events.parse(n);for(var r=function(){var i=webix.Date.add(t,1,"day",!0);n.forEach((function(n){if((n.all_day?n.end_date>=t:n.end_date>t)&&n.start_date<i){var r=t.valueOf();e.DayEvents[r]||(e.DayEvents[r]=[]),e.DayEvents[r].push(n.id)}})),t=i};t<i;)r();e.Calendar.refresh()}))},e.prototype.MarkEvent=function(t){var e=webix.Date.isHoliday(t)||"";return this.DayEvents[t.valueOf()]&&(e+=" webix_cal_day_with_event"),e},e.prototype.GetDay=function(t){var e=t.target.innerHTML;return e?new Date(this.MonthStart).setDate(1*e):null},e.prototype.ShowEvents=function(t){var e=this.GetDay(t);if(e){var i=this.DayEvents[e];this.Popup.ShowWindow(e,t.target.parentNode,i||[])}},e.prototype.ShowNew=function(t){var e=this.State;if(!e.readonly&&!e.clipboard){var i=this.GetDay(t);i&&(e.mode="day",e.selected={id:"0",date:i})}},e.prototype.ShowMonth=function(){this.State.$batch({mode:"month",date:this.MonthStart})},e}(p),Si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.config=function(){return{view:"scrollview",body:{padding:20,view:"flexlayout",css:"webix_scheduler_year",cols:this.GetCalendars()}}},e.prototype.GetCalendars=function(){for(var t=[],e=0;e<12;e++)t.push(new(this.app.dynamic(xi))(this.app,{month:e}));return t},e}(p),$i={JetView:p};$i["bars/add"]=z,$i["bars/date"]=W,$i.bars=nt,$i["bars/nav"]=q,$i["bars/navpopup"]=it,$i["event/actionmenu"]=rt,$i["event/form"]=Ot,$i["event/formpopup"]=Ft,$i["event/info"]=ae,$i["event/recurringform"]=At,$i.main=se,$i["modes/agenda"]=ve,$i["modes/common/actionpopup"]=oe,$i["modes/common/hourscale"]=me,$i["modes/common/multimore"]=we,$i["modes/common/unitlist"]=ge,$i["modes/day/events"]=Ze,$i["modes/day"]=ei,$i["modes/day/multiday"]=ti,$i["modes/month/compact"]=ii,$i["modes/month/events"]=ri,$i["modes/month/header"]=ai,$i["modes/month"]=si,$i["modes/month/list"]=oi,$i["modes/month/more"]=ni,$i["modes/timeline/bar"]=li,$i["modes/timeline/chart"]=ci,$i["modes/timeline"]=pi,$i["modes/timeline/more"]=ui,$i["modes/timeline/scale"]=hi,$i["modes/units/events"]=di,$i["modes/units/header"]=fi,$i["modes/units"]=mi,$i["modes/units/multiday"]=vi,$i["modes/units/multidaylist"]=gi,$i["modes/week/compact"]=wi,$i["modes/week/header"]=_i,$i["modes/week"]=bi,$i["modes/week/multiday"]=yi,$i["modes/year/calendar"]=xi,$i["modes/year"]=Si,$i["side/editor"]=Z,$i.side=et,$i["side/popup"]=tt;var Ci=function(){function t(t){this.app=t,this.store=this.createEvents(),this.events_ready=null,!1!==t.config.calendars&&(this.cals=this.createCalendars(),this.cals_ready=null),!1!==t.config.units&&(this.unitsCache=this.createUnits(),this.units_ready=null),t.config.timeline&&(this._sections=this.createSections(),this.sections_ready=null);var e=t.config.serverUTC;this.strToDate=webix.Date.strToDate(webix.i18n.parseFormat,e),this.dateToStr=webix.Date.dateToStr(webix.i18n.parseFormat,e),this.dateToLocalStr=webix.Date.dateToStr(webix.i18n.parseFormat),this.loaded_ranges={}}return t.prototype.createEvents=function(){var t=this;return new webix.DataCollection({scheme:{$change:function(e){"string"==typeof e.start_date&&(e.start_date=t.strToDate(e.start_date)),"string"==typeof e.end_date&&(e.end_date=t.strToDate(e.end_date)),t.app.config.recurring&&(e.$recurring=e.recurring?ht(e.recurring):null,e.$recurring&&Lt(e),"string"!=typeof e.origin_id||isNaN(e.origin_id)||(e.origin_id*=1)),"string"==typeof e.all_day&&(e.all_day*=1),t.getColor(e,t.cals&&t.cals.getItem(e.calendar))},$serialize:function(e){return t.eventOut(e)},$export:function(e){return t.eventOut(e)}}})},t.prototype.events=function(t,e){var i=this,n=this.store;return t?n:this.calendars().then((function(){return i.app.config.dynamic?i.events_ready||(i.events_ready=webix.promise.resolve(i.store)):i.events_ready&&!e||(i.events_ready=i.app.getService("backend").events().then((function(t){return n.clearAll(),n.parse(t),n}))),i.events_ready}))},t.prototype.getEvents=function(t,e){var i,n=this,r=this.app.config.dynamic;if(r){var a=this.getParams(r);i=a.then?a.then((function(){return n.getLocal(t,e)})):!0===a?this.getLocal(t,e):this.loaded_ranges[a.from]=this.getDynamic(a).then((function(){return n.getLocal(t,e)}))}else i=this.getLocal(t,e);return i},t.prototype.getLocal=function(t,e){var i=this;return this.events().then((function(n){var r=i.app.config,a=i.app.getState().active,o=[],s=new Date,l=i.app.config.dimPastEvents;return n.data.each((function(n){(!r.calendars||function(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return!0;return!1}(a,n.calendar))&&n.start_date<e&&(n.end_date>t||n.end_date>=t&&n.all_day||n.$recurring&&(!n.$recurring.UNTIL||n.$recurring.UNTIL>t))&&(i.app.config.recurring&&n.recurring?o=o.concat(function(t,e,i){var n=i.$recurring,r={},a=[];mt(n,r);for(var o=new Date(i.start_date),s=i.end_date-i.start_date,l=1;t-o>=(s||1)&&(!n.UNTIL||o<n.UNTIL)&&(!n.COUNT||l<=n.COUNT)||vt(n.EXDATE,o);)++l,wt(o,n,r);for(;e>o&&(!n.UNTIL||o<n.UNTIL)&&(!n.COUNT||l<=n.COUNT);){if(!vt(n.EXDATE,o)){var u=webix.copy(i);o.setHours(i.start_date.getHours()),u.start_date=new Date(o),u.end_date=new Date(1*o+s),u.$id=i.id,u.id=u.start_date.valueOf()+"_"+i.id,a.push(u)}l++,wt(o,n,r)}return a}(t,e,n).map((function(t){return l&&(t.$past=i.isPast(t,s)),t}))):(delete n.recurring,l&&(n.$past=i.isPast(n,s)),o.push(n))),n.start_date=i.roundTime(n.start_date),n.end_date=i.roundTime(n.end_date)})),o.sort((function(t,e){return t.start_date-e.start_date||t.end_date-e.end_date})),o}))},t.prototype.isPast=function(t,e){return t.all_day?t.end_date<webix.Date.dayStart(e):t.end_date<e},t.prototype.getDynamic=function(t){var e=this;return this.app.getService("backend").events(t).then((function(i){return e.store.parse(i),e.loaded_ranges[t.from]=!0,i}))},t.prototype.getParams=function(t){var e=this.app.getState(),i=webix.i18n.parseFormatStr,n=webix.Date[t+"Start"](e.date),r=webix.Date.add(n,1,t,!0);"month"!==t&&"year"!==t||"week"!==e.mode&&"month"!==e.mode||(n.getDay()&&(n=webix.Date.weekStart(n)),r.getDay()&&(r=webix.Date.add(webix.Date.weekStart(r),1,"week")));var a=i(n);return this.loaded_ranges[a]?this.loaded_ranges[a]:{from:a,to:i(r)}},t.prototype.createCalendars=function(){var t=this;return new webix.DataCollection({scheme:{$sort:{dir:"desc",by:"active",as:ki}},on:{onAfterDelete:function(){return t.setActive()},onAfterAdd:function(){return t.setActive()},"data->onDataUpdate":function(e,i,n){n&&(i.color!==n.color&&(t.store.data.each((function(n){n.calendar==e&&t.getColor(n,i)})),t.app.callEvent("events:refresh")),i.active!==n.active&&(t.setActive(),setTimeout((function(){t.cals.sort("#active#","desc",ki)}),400)))}}})},t.prototype.calendars=function(t,e){var i=this;if(0==this.app.config.calendars)return!t&&webix.promise.resolve();var n=this.cals;return t?n:(this.cals_ready&&!e||(this.cals_ready=this.app.getService("backend").calendars().then((function(t){return n.clearAll(),n.parse(t),i.setActive(),n}))),this.cals_ready)},t.prototype.eventOut=function(t,e,i){t=webix.copy(t),!i&&t.recurring&&Lt(t);var n=e?this.dateToStr:this.dateToLocalStr;return t.start_date&&(t.start_date=n(t.start_date)),t.end_date&&(t.end_date=n(t.end_date)),e||(delete t.$recurring,delete t.$textColor,delete t.$color,delete t.$past),t},t.prototype.setActive=function(){var t=[];this.cals.data.each((function(e){1*e.active&&t.push(e.id)})),this.app.getState().active=t},t.prototype.getColor=function(t,e){var i,n;t.$color=e?e.color:t.color||"#01C2A5",t.$textColor=(i=t.color||t.$color,n=webix.color.toRgb(i),Math.round((299*n[0]+587*n[1]+114*n[2])/1e3)>180?"#475466":"#ffffff")},t.prototype.roundTime=function(t){var e=webix.Date.copy(t);return e.setMinutes(5*Math.round(e.getMinutes()/5)),e},t.prototype.isLastPart=function(t){return!this.store.find((function(e){return t.origin_id==e.origin_id&&(t.$id||t.id)!=e.id&&t.start_date<e.start_date}),!0)},t.prototype.createUnits=function(){return new webix.DataCollection({data:[]})},t.prototype.units=function(t,e){if(0==this.app.config.units)return!t&&webix.promise.resolve();var i=this.unitsCache;return t?i:(this.units_ready&&!e||(this.units_ready=this.app.getService("backend").units().then((function(t){return i.clearAll(),i.parse(t),i}))),this.units_ready)},t.prototype.createSections=function(){return new webix.DataCollection({})},t.prototype.sections=function(t,e){var i=this._sections;return t?i:(this.sections_ready&&!e||(this.sections_ready=this.app.getService("backend").sections().then((function(t){return i.clearAll(),i.parse(t),i}))),this.sections_ready)},t.prototype.clearAll=function(){this.loaded_ranges={},this.store.clearAll(),this.events_ready=null,!1!==this.app.config.calendars&&(this.cals.clearAll(),this.cals_ready=null),!1!==this.app.config.units&&(this.unitsCache.clearAll(),this.units_ready=null),!1!==this.app.config.timeline&&(this._sections.clearAll(),this.sections_ready=null)},t}();function ki(t,e,i){return 1*t[i]>1*e[i]?1:-1}var Di=function(){function t(t){this.app=t,this.Back=t.getService("backend");var e=this.Local=t.getService("local");this.Events=e.events(!0),this.Cals=e.calendars(!0),this.State=t.getState()}return t.prototype.addEvent=function(t,e,i){var n=this,r=this.Local.eventOut(t,!0,e);return this.Back.addEvent(r).then((function(e){return i&&n.Events.remove(i),t.id=e.id,n.Events.add(t)}))},t.prototype.updateEvent=function(t,e,i,n,r){var a=this,o=this.Local.eventOut(e,!0,r);return this.Back.updateEvent(t,o,i,n).then((function(){if(a.Events.updateItem(t,e),"all"===i){var r=a.Events.find((function(e){return e.origin_id==t})).map((function(t){return t.id}));a.Events.remove(r)}else if("next"===i&&n){var o=a.Events.getItem(t);o.origin_id&&(t=o.origin_id),r=a.Events.find((function(e){return e.origin_id==t&&e.start_date>=n})).map((function(t){return t.id})),a.Events.remove(r)}}))},t.prototype.removeEvent=function(t,e,i){var n=this,r=this.State.selected?this.State.selected.id:t.$id||t.id,a=!!e&&kt(i,t.start_date);if("next"===e&&a&&(e=Dt.call(this,t,e)),!e||"all"===e||"this"===e&&!i||"next"===e&&t.origin_id&&a)"all"===e&&t.origin_id&&(r=t.origin_id),this.Back.removeEvent(r).then((function(){n.Events.remove(r);var t=n.Events.find((function(t){return t.origin_id==r})).map((function(t){return t.id}));n.Events.remove(t)}));else if("this"===e||"next"===e){i||(r=t.origin_id,t=this.Events.getItem(r));var o=webix.Date.dayStart(i?new Date(1*i.split("_")[0]):t.start_date),s="this"===e?$t(o,t):St(o,t);this.updateEvent(r,{recurring:s},e,o,!0)}},t.prototype.addCalendar=function(t){var e=this;return t||(t={text:"",color:"#997CEB",active:1}),this.Back.addCalendar(t).then((function(i){return t.id=i.id,e.Cals.add(t,0),t.id}))},t.prototype.updateCalendar=function(t,e){var i=this;return this.app.getState().readonly?webix.promise.resolve(this.Cals.updateItem(t,e)):this.Back.updateCalendar(t,e).then((function(){return i.Cals.updateItem(t,e)}))},t.prototype.removeCalendar=function(t){var e=this;this.Back.removeCalendar(t).then((function(){e.Cals.remove(t)}))},t}(),Ti=function(){function t(t,e){this.app=t,this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.events=function(t){return webix.ajax(this.url("events"),t).then((function(t){return t.json()}))},t.prototype.addEvent=function(t){return webix.ajax().post(this.url("events"),t).then((function(t){return t.json()}))},t.prototype.updateEvent=function(t,e,i,n){var r=e;return i&&(r.recurring_update_mode=i),n&&(r.recurring_update_date=n),webix.ajax().put(this.url("events/"+t),r).then((function(t){return t.json()}))},t.prototype.removeEvent=function(t){return webix.ajax().del(this.url("events/"+t)).then((function(t){return t.json()}))},t.prototype.calendars=function(){return webix.ajax(this.url("calendars")).then((function(t){return t.json()}))},t.prototype.addCalendar=function(t){return webix.ajax().post(this.url("calendars"),t).then((function(t){return t.json()}))},t.prototype.updateCalendar=function(t,e){return webix.ajax().put(this.url("calendars/"+t),e).then((function(t){return t.json()}))},t.prototype.removeCalendar=function(t){return webix.ajax().del(this.url("calendars/"+t)).then((function(t){return t.json()}))},t.prototype.units=function(t){return webix.ajax().get(this.url("units"),t).then((function(t){return t.json()}))},t.prototype.sections=function(){return webix.ajax(this.url("sections")).then((function(t){return t.json()}))},t}(),Ei=function(t){function e(e){var i,n,a,o=this,s=U({mode:e.mode||"month",date:webix.Date.datePart(e.date||new Date),readonly:e.readonly||!1,active:[],selected:null,timelineMode:e.timelineMode||"week"}),l={router:b,version:"10.1.0",debug:!0,start:"/main",params:{state:s,forceCompact:(e=e||{}).compact},compactWidth:780,recurring:!0,calendars:!0,timeline:!!e.timeline,copypaste:!0,dragCreate:!0,dimPastEvents:!1};return(o=t.call(this,r(r({},l),e))||this).setService("backend",new(o.dynamic(Ti))(o,o.config.url)),o.setService("local",new(o.dynamic(Ci))(o,e)),o.setService("operations",new(o.dynamic(Di))(o)),a={updateConfig:function(t){var e=i.getRoot(),r=e.$view;n?n&&!r.id&&(r.id=n):(r.id?n=r.id:r.id=n="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+n+"{ position: relative; }"),webix.html.addStyle("#"+n+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+n+" .webix_disabled{ z-index:1 !important; }")),t.container=n,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var a=!0,o=t.on.onShow;return t.on.onShow=function(){var t=this;o&&o.apply(this,arguments),a&&(this.$setSize=function(i,n){G(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},function(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){G(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}(this,i),a=null),webix.callEvent("onClick",[]),webix.html.addCss(r,"webix_win_inside"),e.disable(),G(this,e)},t}},(i=o).setService("jet-win",a),o.use(O,o.config.locale||{lang:"en",webix:{en:"en-US"}}),o}return n(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?$i[e]:"jet-locales"===t?Ai[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(y);webix.protoUI({name:"scheduler",app:Ei,defaults:{borderless:!0},$init:function(){var t=this;this.name="scheduler";var e=this.$app.getState();for(var i in e)B(e,this.config,i);e.$changes.attachEvent("date",(function(){})),this.$app.attachEvent("app:beforedrag",(function(e,i){return t.callEvent("onBeforeEventDrag",[e,i])})),this.$app.attachEvent("app:beforedrop",(function(e,i){return t.callEvent("onBeforeEventDrop",[e,i])}))},$exportView:function(t){return"png"===t.export_mode||"pdf"===t.export_mode&&"image"===t.display?this.$app.getRoot():this.$app.getService("local").events(!0)},getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},clearAll:function(){this.$app.getService("local").clearAll()}},webix.ui.jetapp);var Li={Backend:Ti,LocalData:Ci,Operations:Di},Ai={en:{Week:"Week",Day:"Day",Month:"Month",Year:"Year",Agenda:"Agenda",Units:"Units",Timeline:"Timeline",Today:"Today",Create:"Create",Next:"Next",Previous:"Previous","Next day":"Next day","Previous day":"Previous day","Next week":"Next week","Previous week":"Previous week","Next month":"Next month","Previous month":"Previous month","Add calendar":"Add calendar","Do you really want to remove this calendar?":"Do you really want to remove this calendar?","Edit calendar":"Edit calendar",Delete:"Delete",Save:"Save",Title:"Title",Color:"Color",Active:"Active",Settings:"Settings","(no title)":"(no title)","Inactive calendar":"Inactive calendar","No Events":"No Events","All Day":"All Day",more:"more","Expand all-day events":"Expand all-day events","Collapse all-day events":"Collapse all-day events","The event will be deleted permanently, are you sure?":"The event will be deleted permanently, are you sure?",Done:"Done","Delete event":"Delete event",Close:"Close",Edit:"Edit","(No title)":"(No title)",Event:"Event",Start:"Start",End:"End",Calendar:"Calendar",Notes:"Notes",from:"from",to:"to","Edit event":"Edit event","Assigned to units":"Assigned to units","No units":"No units","Unknown unit":"Unknown unit",never:"never",none:"none",daily:"daily",day:"day",days:"days",every:"Every",weekly:"weekly",week:"week",weeks:"weeks",each:"Every",monthly:"monthly",month:"month",months:"months",yearly:"yearly",year:"year",years:"years",Repeat:"Repeat","End repeat":"End repeat","Repeats each":"Repeats each",till:"till",times:"times","weekly, every":"weekly, every","monthly, every":"monthly, every","yearly, every":"yearly, every","every working day":"every working day",custom:"custom",Every:"Every",on:"on",of:"of","day of year":"day of year","after several occurrences":"after several occurrences",date:"date","week on":"week on","Change recurring pattern":"Change recurring pattern","Save changes?":"Save changes?","All events":"All events","This event":"This event","This event and the following":"This event and the following",Cancel:"Cancel",Apply:"Apply","Edit recurring event":"Edit recurring event","Timeline scale":"Timeline scale",Section:"Section","Show more":"Show more","Copy of":"Copy of","Copy event":"Copy event"}};t.App=Ei,t.locales=Ai,t.services=Li,t.views=$i,Object.defineProperty(t,"__esModule",{value:!0})}(e)},71144:()=>{webix.i18n.locales["th-TH"]={groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,dateFormat:t=>null==t?"":"string"==typeof t?t:webix.Date.dateToStr(`%d/%m/${t.getFullYear()+543}`)(t),timeFormat:"%G:%i",longDateFormat:t=>null==t?"":"string"==typeof t?t:webix.Date.dateToStr(`%j %F ${t.getFullYear()+543}`)(t),fullDateFormat:t=>null==t?"":"string"==typeof t?t:webix.Date.dateToStr(`%d/%m/${t.getFullYear()+543} %G:%i`)(t),am:["am","AM"],pm:["pm","PM"],price:"฿{obj}",priceSettings:{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2},calendar:{monthFull:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],dayFull:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],dayShort:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."]},aria:{dateFormat:t=>null==t?"":"string"==typeof t?t:webix.Date.dateToStr(`%d %F ${t.getFullYear()+543}`)(t),monthFormat:t=>null==t?"":"string"==typeof t?t:webix.Date.dateToStr(`%F ${t.getFullYear()+543}`)(t),yearFormat:t=>null==t?"":"string"==typeof t?t:webix.Date.dateToStr(`${t.getFullYear()+543}`)(t)}}},92783:(t,e,i)=>{"use strict";i.r(e),i(71144),Promise.resolve().then(i.t.bind(i,18473,23)).then((t=>window.gantt=t)),Promise.resolve().then(i.t.bind(i,7425,23)).then((t=>window.kanban=t)),Promise.resolve().then(i.t.bind(i,7641,23)).then((t=>window.pivot=t)),Promise.resolve().then(i.t.bind(i,41461,23)).then((t=>window.reports=t)),Promise.resolve().then(i.t.bind(i,9217,23)).then((t=>window.scheduler=t))}}]);
//# sourceMappingURL=webix.resources.0efe5307cde52a874756.js.map