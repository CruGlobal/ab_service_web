/*! For license information please see ABDesigner.js.LICENSE.txt */
(()=>{var e={9293:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},5367:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),a=i.n(n),o=i(3645),s=i.n(o)()(a());s.push([e.id,"@font-face {\n  font-family: 'bpmn';\n  src: url('../font/bpmn.eot?26374340');\n  src: url('../font/bpmn.eot?26374340#iefix') format('embedded-opentype'),\n       url('../font/bpmn.woff2?26374340') format('woff2'),\n       url('../font/bpmn.woff?26374340') format('woff'),\n       url('../font/bpmn.ttf?26374340') format('truetype'),\n       url('../font/bpmn.svg?26374340#bpmn') format('svg');\n  font-weight: normal;\n  font-style: normal;\n}\n/* Chrome hack: SVG is rendered more smooth in Windozze. 100% magic, uncomment if you need it. */\n/* Note, that will break hinting! In other OS-es font will be not as sharp as it could be */\n/*\n@media screen and (-webkit-min-device-pixel-ratio:0) {\n  @font-face {\n    font-family: 'bpmn';\n    src: url('../font/bpmn.svg?26374340#bpmn') format('svg');\n  }\n}\n*/\n\n [class^=\"bpmn-icon-\"]:before, [class*=\" bpmn-icon-\"]:before {\n  font-family: \"bpmn\";\n  font-style: normal;\n  font-weight: normal;\n  speak: never;\n\n  display: inline-block;\n  text-decoration: inherit;\n  width: 1em;\n  /* margin-right: .2em; */\n  text-align: center;\n  /* opacity: .8; */\n\n  /* For safety - reset parent styles, that can break glyph codes*/\n  font-variant: normal;\n  text-transform: none;\n\n  /* fix buttons height, for twitter bootstrap */\n  line-height: 1em;\n\n  /* Animation center compensation - margins should be symmetric */\n  /* remove if not needed */\n  /* margin-left: .2em; */\n\n  /* you can be more comfortable with increased icons size */\n  /* font-size: 120%; */\n\n  /* Font smoothing. That was taken from TWBS */\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n\n  /* Uncomment for 3D effect */\n  /* text-shadow: 1px 1px 1px rgba(127, 127, 127, 0.3); */\n}\n\n.bpmn-icon-screw-wrench:before { content: '\\e800'; } /* '' */\n.bpmn-icon-trash:before { content: '\\e801'; } /* '' */\n.bpmn-icon-conditional-flow:before { content: '\\e802'; } /* '' */\n.bpmn-icon-default-flow:before { content: '\\e803'; } /* '' */\n.bpmn-icon-gateway-parallel:before { content: '\\e804'; } /* '' */\n.bpmn-icon-intermediate-event-catch-cancel:before { content: '\\e805'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-message:before { content: '\\e806'; } /* '' */\n.bpmn-icon-start-event-compensation:before { content: '\\e807'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-parallel-multiple:before { content: '\\e808'; } /* '' */\n.bpmn-icon-loop-marker:before { content: '\\e809'; } /* '' */\n.bpmn-icon-parallel-mi-marker:before { content: '\\e80a'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-signal:before { content: '\\e80b'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-timer:before { content: '\\e80c'; } /* '' */\n.bpmn-icon-intermediate-event-catch-parallel-multiple:before { content: '\\e80d'; } /* '' */\n.bpmn-icon-intermediate-event-catch-compensation:before { content: '\\e80e'; } /* '' */\n.bpmn-icon-gateway-xor:before { content: '\\e80f'; } /* '' */\n.bpmn-icon-connection:before { content: '\\e810'; } /* '' */\n.bpmn-icon-end-event-cancel:before { content: '\\e811'; } /* '' */\n.bpmn-icon-intermediate-event-catch-condition:before { content: '\\e812'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-parallel-multiple:before { content: '\\e813'; } /* '' */\n.bpmn-icon-start-event-condition:before { content: '\\e814'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-timer:before { content: '\\e815'; } /* '' */\n.bpmn-icon-sequential-mi-marker:before { content: '\\e816'; } /* '' */\n.bpmn-icon-user-task:before { content: '\\e817'; } /* '' */\n.bpmn-icon-business-rule:before { content: '\\e818'; } /* '' */\n.bpmn-icon-sub-process-marker:before { content: '\\e819'; } /* '' */\n.bpmn-icon-start-event-parallel-multiple:before { content: '\\e81a'; } /* '' */\n.bpmn-icon-start-event-error:before { content: '\\e81b'; } /* '' */\n.bpmn-icon-intermediate-event-catch-signal:before { content: '\\e81c'; } /* '' */\n.bpmn-icon-intermediate-event-catch-error:before { content: '\\e81d'; } /* '' */\n.bpmn-icon-end-event-compensation:before { content: '\\e81e'; } /* '' */\n.bpmn-icon-subprocess-collapsed:before { content: '\\e81f'; } /* '' */\n.bpmn-icon-subprocess-expanded:before { content: '\\e820'; } /* '' */\n.bpmn-icon-task:before { content: '\\e821'; } /* '' */\n.bpmn-icon-end-event-error:before { content: '\\e822'; } /* '' */\n.bpmn-icon-intermediate-event-catch-escalation:before { content: '\\e823'; } /* '' */\n.bpmn-icon-intermediate-event-catch-timer:before { content: '\\e824'; } /* '' */\n.bpmn-icon-start-event-escalation:before { content: '\\e825'; } /* '' */\n.bpmn-icon-start-event-signal:before { content: '\\e826'; } /* '' */\n.bpmn-icon-business-rule-task:before { content: '\\e827'; } /* '' */\n.bpmn-icon-manual:before { content: '\\e828'; } /* '' */\n.bpmn-icon-receive:before { content: '\\e829'; } /* '' */\n.bpmn-icon-call-activity:before { content: '\\e82a'; } /* '' */\n.bpmn-icon-start-event-timer:before { content: '\\e82b'; } /* '' */\n.bpmn-icon-start-event-message:before { content: '\\e82c'; } /* '' */\n.bpmn-icon-intermediate-event-none:before { content: '\\e82d'; } /* '' */\n.bpmn-icon-intermediate-event-catch-link:before { content: '\\e82e'; } /* '' */\n.bpmn-icon-end-event-escalation:before { content: '\\e82f'; } /* '' */\n.bpmn-icon-text-annotation:before { content: '\\e830'; } /* '' */\n.bpmn-icon-bpmn-io:before { content: '\\e831'; } /* '' */\n.bpmn-icon-gateway-complex:before { content: '\\e832'; } /* '' */\n.bpmn-icon-gateway-eventbased:before { content: '\\e833'; } /* '' */\n.bpmn-icon-gateway-none:before { content: '\\e834'; } /* '' */\n.bpmn-icon-gateway-or:before { content: '\\e835'; } /* '' */\n.bpmn-icon-end-event-terminate:before { content: '\\e836'; } /* '' */\n.bpmn-icon-end-event-signal:before { content: '\\e837'; } /* '' */\n.bpmn-icon-end-event-none:before { content: '\\e838'; } /* '' */\n.bpmn-icon-end-event-multiple:before { content: '\\e839'; } /* '' */\n.bpmn-icon-end-event-message:before { content: '\\e83a'; } /* '' */\n.bpmn-icon-end-event-link:before { content: '\\e83b'; } /* '' */\n.bpmn-icon-intermediate-event-catch-message:before { content: '\\e83c'; } /* '' */\n.bpmn-icon-intermediate-event-throw-compensation:before { content: '\\e83d'; } /* '' */\n.bpmn-icon-start-event-multiple:before { content: '\\e83e'; } /* '' */\n.bpmn-icon-script:before { content: '\\e83f'; } /* '' */\n.bpmn-icon-manual-task:before { content: '\\e840'; } /* '' */\n.bpmn-icon-send:before { content: '\\e841'; } /* '' */\n.bpmn-icon-service:before { content: '\\e842'; } /* '' */\n.bpmn-icon-receive-task:before { content: '\\e843'; } /* '' */\n.bpmn-icon-user:before { content: '\\e844'; } /* '' */\n.bpmn-icon-start-event-none:before { content: '\\e845'; } /* '' */\n.bpmn-icon-intermediate-event-throw-escalation:before { content: '\\e846'; } /* '' */\n.bpmn-icon-intermediate-event-catch-multiple:before { content: '\\e847'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-escalation:before { content: '\\e848'; } /* '' */\n.bpmn-icon-intermediate-event-throw-link:before { content: '\\e849'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-condition:before { content: '\\e84a'; } /* '' */\n.bpmn-icon-data-object:before { content: '\\e84b'; } /* '' */\n.bpmn-icon-script-task:before { content: '\\e84c'; } /* '' */\n.bpmn-icon-send-task:before { content: '\\e84d'; } /* '' */\n.bpmn-icon-data-store:before { content: '\\e84e'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-escalation:before { content: '\\e84f'; } /* '' */\n.bpmn-icon-intermediate-event-throw-message:before { content: '\\e850'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-multiple:before { content: '\\e851'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-signal:before { content: '\\e852'; } /* '' */\n.bpmn-icon-intermediate-event-throw-multiple:before { content: '\\e853'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-message:before { content: '\\e854'; } /* '' */\n.bpmn-icon-ad-hoc-marker:before { content: '\\e855'; } /* '' */\n.bpmn-icon-service-task:before { content: '\\e856'; } /* '' */\n.bpmn-icon-task-none:before { content: '\\e857'; } /* '' */\n.bpmn-icon-compensation-marker:before { content: '\\e858'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-multiple:before { content: '\\e859'; } /* '' */\n.bpmn-icon-intermediate-event-throw-signal:before { content: '\\e85a'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-condition:before { content: '\\e85b'; } /* '' */\n.bpmn-icon-participant:before { content: '\\e85c'; } /* '' */\n.bpmn-icon-event-subprocess-expanded:before { content: '\\e85d'; } /* '' */\n.bpmn-icon-lane-insert-below:before { content: '\\e85e'; } /* '' */\n.bpmn-icon-space-tool:before { content: '\\e85f'; } /* '' */\n.bpmn-icon-connection-multi:before { content: '\\e860'; } /* '' */\n.bpmn-icon-lane:before { content: '\\e861'; } /* '' */\n.bpmn-icon-lasso-tool:before { content: '\\e862'; } /* '' */\n.bpmn-icon-lane-insert-above:before { content: '\\e863'; } /* '' */\n.bpmn-icon-lane-divide-three:before { content: '\\e864'; } /* '' */\n.bpmn-icon-lane-divide-two:before { content: '\\e865'; } /* '' */\n.bpmn-icon-data-input:before { content: '\\e866'; } /* '' */\n.bpmn-icon-data-output:before { content: '\\e867'; } /* '' */\n.bpmn-icon-hand-tool:before { content: '\\e868'; } /* '' */\n.bpmn-icon-group:before { content: '\\e869'; } /* '' */\n.bpmn-icon-transaction:before { content: '\\e8c4'; } /* '' */",""]);const r=s},1629:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),a=i.n(n),o=i(3645),s=i.n(o)()(a());s.push([e.id,'.bjs-container {\n  --bjs-font-family: Arial, sans-serif;\n\n  --color-grey-225-10-15: hsl(225, 10%, 15%);\n  --color-grey-225-10-35: hsl(225, 10%, 35%);\n  --color-grey-225-10-55: hsl(225, 10%, 55%);\n  --color-grey-225-10-75: hsl(225, 10%, 75%);\n  --color-grey-225-10-80: hsl(225, 10%, 80%);\n  --color-grey-225-10-85: hsl(225, 10%, 85%);\n  --color-grey-225-10-90: hsl(225, 10%, 90%);\n  --color-grey-225-10-95: hsl(225, 10%, 95%); \n  --color-grey-225-10-97: hsl(225, 10%, 97%);\n\n  --color-blue-205-100-45: hsl(205, 100%, 45%);\n  --color-blue-205-100-45-opacity-30: hsla(205, 100%, 45%, 30%);\n  --color-blue-205-100-50: hsl(205, 100%, 50%);\n  --color-blue-205-100-95: hsl(205, 100%, 95%);\n\n  --color-green-150-86-44: hsl(150, 86%, 44%);\n\n  --color-red-360-100-40: hsl(360, 100%, 40%);\n  --color-red-360-100-45: hsl(360, 100%, 45%);\n  --color-red-360-100-92: hsl(360, 100%, 92%);\n  --color-red-360-100-97: hsl(360, 100%, 97%);\n\n  --color-white: hsl(0, 0%, 100%);\n  --color-black: hsl(0, 0%, 0%); \n  --color-black-opacity-05: hsla(0, 0%, 0%, 5%); \n  --color-black-opacity-10: hsla(0, 0%, 0%, 10%);\n\n  --breadcrumbs-font-family: var(--bjs-font-family);\n  --breadcrumbs-item-color: var(--color-blue-205-100-50);\n  --breadcrumbs-arrow-color: var(--color-black);\n  --drilldown-fill-color: var(--color-white);\n  --drilldown-background-color: var(--color-blue-205-100-50);\n}\n\n.bjs-breadcrumbs {\n  position: absolute;\n  display: none;\n  flex-wrap: wrap;\n  align-items: center;\n  top: 30px;\n  left: 30px;\n  padding: 0px;\n  margin: 0px;\n  font-family: var(--breadcrumbs-font-family);\n  font-size: 16px;\n  line-height: normal;\n}\n\n.bjs-breadcrumbs-shown .bjs-breadcrumbs {\n  display: flex;\n}\n\n.djs-palette-shown .bjs-breadcrumbs {\n  left: 90px;\n}\n\n.djs-palette-shown.djs-palette-two-column .bjs-breadcrumbs {\n  left: 140px;\n}\n\n.bjs-breadcrumbs li {\n  display: inline-flex;\n  padding-bottom: 5px;\n}\n\n.bjs-breadcrumbs li a {\n  cursor: pointer;\n  color: var(--breadcrumbs-item-color);\n}\n\n.bjs-breadcrumbs li:last-of-type a {\n  color: inherit;\n  cursor: default;\n}\n\n.bjs-breadcrumbs li:not(:first-child)::before {\n  content: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" /><path d="M0 0h24v24H0z" fill="none" /></svg>\');\n  padding: 0 8px;\n  color: var(--breadcrumbs-arrow-color);\n  height: 1em;\n}\n\n.bjs-breadcrumbs .bjs-crumb {\n  display: inline-block;\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.bjs-drilldown {\n  width: 20px;\n  height: 20px;\n\n  padding: 0px;\n  margin-left: -20px;\n\n  cursor: pointer;\n  border: none;\n  border-radius: 2px;\n  outline: none;\n\n  fill: var(--drilldown-fill-color);\n  background-color: var(--drilldown-background-color);\n}\n\n.bjs-drilldown-empty {\n  display: none;\n}\n\n.selected .bjs-drilldown-empty {\n  display: inherit;\n}',""]);const r=s},2622:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),a=i.n(n),o=i(3645),s=i.n(o)()(a());s.push([e.id,"/**\n * color definitions\n */\n.djs-container {\n  --color-grey-225-10-15: hsl(225, 10%, 15%);\n  --color-grey-225-10-35: hsl(225, 10%, 35%);\n  --color-grey-225-10-55: hsl(225, 10%, 55%);\n  --color-grey-225-10-75: hsl(225, 10%, 75%);\n  --color-grey-225-10-80: hsl(225, 10%, 80%);\n  --color-grey-225-10-85: hsl(225, 10%, 85%);\n  --color-grey-225-10-90: hsl(225, 10%, 90%);\n  --color-grey-225-10-95: hsl(225, 10%, 95%); \n  --color-grey-225-10-97: hsl(225, 10%, 97%);\n\n  --color-blue-205-100-45: hsl(205, 100%, 45%);\n  --color-blue-205-100-45-opacity-30: hsla(205, 100%, 45%, 30%);\n  --color-blue-205-100-50: hsl(205, 100%, 50%);\n  --color-blue-205-100-95: hsl(205, 100%, 95%);\n\n  --color-green-150-86-44: hsl(150, 86%, 44%);\n\n  --color-red-360-100-40: hsl(360, 100%, 40%);\n  --color-red-360-100-45: hsl(360, 100%, 45%);\n  --color-red-360-100-92: hsl(360, 100%, 92%);\n  --color-red-360-100-97: hsl(360, 100%, 97%);\n\n  --color-white: hsl(0, 0%, 100%);\n  --color-black: hsl(0, 0%, 0%); \n  --color-black-opacity-05: hsla(0, 0%, 0%, 5%); \n  --color-black-opacity-10: hsla(0, 0%, 0%, 10%);\n\n  --bendpoint-fill-color: var(--color-blue-205-100-45-opacity-30);\n  --bendpoint-stroke-color: var(--color-blue-205-100-50);\n\n  --context-pad-entry-background-color: var(--color-white);\n  --context-pad-entry-hover-background-color: var(--color-grey-225-10-95);\n\n  --element-dragger-color: var(--color-blue-205-100-50);\n  --element-hover-outline-fill-color: var(--color-blue-205-100-45);\n  --element-selected-outline-stroke-color: var(--color-blue-205-100-50);\n\n  --lasso-fill-color: var(--color-black-opacity-05);\n  --lasso-stroke-color: var(--color-black);\n\n  --palette-entry-color: var(--color-grey-225-10-15);\n  --palette-entry-hover-color: var(--color-blue-205-100-45);\n  --palette-entry-selected-color: var(--color-blue-205-100-50);\n  --palette-separator-color: var(--color-grey-225-10-75);\n  --palette-toggle-hover-background-color: var(--color-grey-225-10-55);\n  --palette-background-color: var(--color-grey-225-10-97);\n  --palette-border-color: var(--color-grey-225-10-75);\n\n  --popup-body-background-color: var(--color-white);\n  --popup-header-entry-selected-color: var(--color-blue-205-100-50);\n  --popup-header-entry-selected-background-color: var(--color-black-opacity-10);\n  --popup-header-separator-color: var(--color-grey-225-10-75);\n  --popup-background-color: var(--color-grey-225-10-97);\n  --popup-border-color: var(--color-grey-225-10-75);\n\n  --resizer-fill-color: var(--color-blue-205-100-45-opacity-30);\n  --resizer-stroke-color: var(--color-blue-205-100-50);\n\n  --search-container-background-color: var(--color-grey-225-10-97);\n  --search-container-border-color: var(--color-blue-205-100-50);\n  --search-container-box-shadow-color: var(--color-blue-205-100-95);\n  --search-container-box-shadow-inset-color: var(--color-grey-225-10-80);\n  --search-input-border-color: var(--color-grey-225-10-75);\n  --search-result-border-color: var(--color-grey-225-10-75);\n  --search-result-highlight-color: var(--color-black);\n  --search-result-selected-color: var(--color-blue-205-100-45-opacity-30);\n\n  --shape-attach-allowed-stroke-color: var(--color-blue-205-100-50);\n  --shape-connect-allowed-fill-color: var(--color-grey-225-10-97);\n  --shape-drop-allowed-fill-color: var(--color-grey-225-10-97);\n  --shape-drop-not-allowed-fill-color: var(--color-red-360-100-97);\n  --shape-resize-preview-stroke-color: var(--color-blue-205-100-50);\n\n  --snap-line-stroke-color: var(--color-blue-205-100-45-opacity-30);\n\n  --space-tool-crosshair-stroke-color: var(--color-black);\n\n  --tooltip-error-background-color: var(--color-red-360-100-97);\n  --tooltip-error-border-color: var(--color-red-360-100-45);\n  --tooltip-error-color: var(--color-red-360-100-45);\n}\n\n/**\n * outline styles\n */\n\n.djs-outline {\n  fill: none;\n  visibility: hidden;\n}\n\n.djs-element.hover .djs-outline,\n.djs-element.selected .djs-outline {\n  visibility: visible;\n  shape-rendering: geometricPrecision;\n  stroke-dasharray: 3,3;\n}\n\n.djs-element.selected .djs-outline {\n  stroke: var(--element-selected-outline-stroke-color);\n  stroke-width: 1px;\n}\n\n.djs-element.hover .djs-outline {\n  stroke: var(--element-hover-outline-fill-color);\n  stroke-width: 1px;\n}\n\n.djs-shape.connect-ok .djs-visual > :nth-child(1) {\n  fill: var(--shape-connect-allowed-fill-color) !important;\n}\n\n.djs-shape.connect-not-ok .djs-visual > :nth-child(1),\n.djs-shape.drop-not-ok .djs-visual > :nth-child(1) {\n  fill: var(--shape-drop-not-allowed-fill-color) !important;\n}\n\n.djs-shape.new-parent .djs-visual > :nth-child(1) {\n  fill: var(--shape-drop-allowed-fill-color) !important;\n}\n\nsvg.drop-not-ok {\n  background: var(--shape-drop-not-allowed-fill-color) !important;\n}\n\nsvg.new-parent {\n  background: var(--shape-drop-allowed-fill-color) !important;\n}\n\n.djs-connection.connect-ok .djs-visual > :nth-child(1),\n.djs-connection.drop-ok .djs-visual > :nth-child(1) {\n  stroke: var(--shape-drop-allowed-fill-color) !important;\n}\n\n.djs-connection.connect-not-ok .djs-visual > :nth-child(1),\n.djs-connection.drop-not-ok .djs-visual > :nth-child(1) {\n  stroke: var(--shape-drop-not-allowed-fill-color) !important;\n}\n\n.drop-not-ok,\n.connect-not-ok {\n  cursor: not-allowed;\n}\n\n.djs-element.attach-ok .djs-visual > :nth-child(1) {\n  stroke-width: 5px !important;\n  stroke: var(--shape-attach-allowed-stroke-color) !important;\n}\n\n.djs-frame.connect-not-ok .djs-visual > :nth-child(1),\n.djs-frame.drop-not-ok .djs-visual > :nth-child(1) {\n  stroke-width: 3px !important;\n  stroke: var(--shape-drop-not-allowed-fill-color) !important;\n  fill: none !important;\n}\n\n/**\n* Selection box style\n*\n*/\n.djs-lasso-overlay {\n  fill: var(--lasso-fill-color);\n\n  stroke-dasharray: 5 1 3 1;\n  stroke: var(--lasso-stroke-color);\n\n  shape-rendering: geometricPrecision;\n  pointer-events: none;\n}\n\n/**\n * Resize styles\n */\n.djs-resize-overlay {\n  fill: none;\n\n  stroke-dasharray: 5 1 3 1;\n  stroke: var(--shape-resize-preview-stroke-color);\n\n  pointer-events: none;\n}\n\n.djs-resizer-hit {\n  fill: none;\n  pointer-events: all;\n}\n\n.djs-resizer-visual {\n  fill: var(--resizer-fill-color);\n  stroke-width: 1px;\n  stroke-opacity: 0.5;\n  stroke: var(--resizer-stroke-color);\n  shape-rendering: geometricprecision;\n}\n\n.djs-resizer:hover .djs-resizer-visual {\n  stroke: var(--resizer-stroke-color);\n  stroke-opacity: 1;\n}\n\n.djs-cursor-resize-ns,\n.djs-resizer-n,\n.djs-resizer-s {\n  cursor: ns-resize;\n}\n\n.djs-cursor-resize-ew,\n.djs-resizer-e,\n.djs-resizer-w {\n  cursor: ew-resize;\n}\n\n.djs-cursor-resize-nwse,\n.djs-resizer-nw,\n.djs-resizer-se {\n  cursor: nwse-resize;\n}\n\n.djs-cursor-resize-nesw,\n.djs-resizer-ne,\n.djs-resizer-sw {\n  cursor: nesw-resize;\n}\n\n.djs-shape.djs-resizing > .djs-outline {\n  visibility: hidden !important;\n}\n\n.djs-shape.djs-resizing > .djs-resizer {\n  visibility: hidden;\n}\n\n.djs-dragger > .djs-resizer {\n  visibility: hidden;\n}\n\n/**\n * drag styles\n */\n.djs-dragger * {\n  fill: none !important;\n  stroke: var(--element-dragger-color) !important;\n}\n\n.djs-dragger tspan,\n.djs-dragger text {\n  fill: var(--element-dragger-color) !important;\n  stroke: none !important;\n}\n\nmarker.djs-dragger circle,\nmarker.djs-dragger path,\nmarker.djs-dragger polygon,\nmarker.djs-dragger polyline,\nmarker.djs-dragger rect {\n  fill: var(--element-dragger-color) !important;\n  stroke: none !important;\n}\n\nmarker.djs-dragger text,\nmarker.djs-dragger tspan {\n  fill: none !important;\n  stroke: var(--element-dragger-color) !important;\n}\n\n.djs-dragging {\n  opacity: 0.3;\n}\n\n.djs-dragging,\n.djs-dragging > * {\n  pointer-events: none !important;\n}\n\n.djs-dragging .djs-context-pad,\n.djs-dragging .djs-outline {\n  display: none !important;\n}\n\n/**\n * no pointer events for visual\n */\n.djs-visual,\n.djs-outline {\n  pointer-events: none;\n}\n\n.djs-element.attach-ok .djs-hit {\n  stroke-width: 60px !important;\n}\n\n/**\n * all pointer events for hit shape\n */\n.djs-element > .djs-hit-all {\n  pointer-events: all;\n}\n\n.djs-element > .djs-hit-stroke,\n.djs-element > .djs-hit-click-stroke {\n  pointer-events: stroke;\n}\n\n/**\n * all pointer events for hit shape\n */\n.djs-drag-active .djs-element > .djs-hit-click-stroke {\n  pointer-events: all;\n}\n\n/**\n * shape / connection basic styles\n */\n.djs-connection .djs-visual {\n  stroke-width: 2px;\n  fill: none;\n}\n\n.djs-cursor-grab {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n}\n\n.djs-cursor-grabbing {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.djs-cursor-crosshair {\n  cursor: crosshair;\n}\n\n.djs-cursor-move {\n  cursor: move;\n}\n\n.djs-cursor-resize-ns {\n  cursor: ns-resize;\n}\n\n.djs-cursor-resize-ew {\n  cursor: ew-resize;\n}\n\n\n/**\n * snapping\n */\n.djs-snap-line {\n  stroke: var(--snap-line-stroke-color);\n  stroke-linecap: round;\n  stroke-width: 2px;\n  pointer-events: none;\n}\n\n/**\n * snapping\n */\n.djs-crosshair {\n  stroke: var(--space-tool-crosshair-stroke-color);\n  stroke-linecap: round;\n  stroke-width: 1px;\n  pointer-events: none;\n  shape-rendering: crispEdges;\n  stroke-dasharray: 5, 5;\n}\n\n/**\n * palette\n */\n\n.djs-palette {\n  position: absolute;\n  left: 20px;\n  top: 20px;\n\n  box-sizing: border-box;\n  width: 48px;\n}\n\n.djs-palette .separator {\n  margin: 0 5px;\n  padding-top: 5px;\n\n  border: none;\n  border-bottom: solid 1px var(--palette-separator-color);\n\n  clear: both;\n}\n\n.djs-palette .entry:before {\n  vertical-align: text-bottom;\n}\n\n.djs-palette .djs-palette-toggle {\n  cursor: pointer;\n}\n\n.djs-palette .entry,\n.djs-palette .djs-palette-toggle {\n  color: var(--palette-entry-color);\n  font-size: 30px;\n\n  text-align: center;\n}\n\n.djs-palette .entry {\n  float: left;\n}\n\n.djs-palette .entry img {\n  max-width: 100%;\n}\n\n.djs-palette .djs-palette-entries:after {\n  content: '';\n  display: table;\n  clear: both;\n}\n\n.djs-palette .djs-palette-toggle:hover {\n  background: var(--palette-toggle-hover-background-color);\n}\n\n.djs-palette .entry:hover {\n  color: var(--palette-entry-hover-color);\n}\n\n.djs-palette .highlighted-entry {\n  color: var(--palette-entry-selected-color) !important;\n}\n\n.djs-palette .entry,\n.djs-palette .djs-palette-toggle {\n  width: 46px;\n  height: 46px;\n  line-height: 46px;\n  cursor: default;\n}\n\n/**\n * Palette open / two-column layout is controlled via\n * classes on the palette. Events to hook into palette\n * changed life-cycle are available in addition.\n */\n.djs-palette.two-column.open {\n  width: 94px;\n}\n\n.djs-palette:not(.open) .djs-palette-entries {\n  display: none;\n}\n\n.djs-palette:not(.open) {\n  overflow: hidden;\n}\n\n.djs-palette.open .djs-palette-toggle {\n  display: none;\n}\n\n/**\n * context-pad\n */\n.djs-overlay-context-pad {\n  width: 72px;\n  z-index: 100;\n}\n\n.djs-context-pad {\n  position: absolute;\n  display: none;\n  pointer-events: none;\n}\n\n.djs-context-pad .entry {\n  width: 22px;\n  height: 22px;\n  text-align: center;\n  display: inline-block;\n  font-size: 22px;\n  margin: 0 2px 2px 0;\n\n  border-radius: 3px;\n\n  cursor: default;\n\n  background-color: var(--context-pad-entry-background-color);\n  box-shadow: 0 0 2px 1px var(--context-pad-entry-background-color);\n  pointer-events: all;\n}\n\n.djs-context-pad .entry:before {\n  vertical-align: top;\n}\n\n.djs-context-pad .entry:hover {\n  background: var(--context-pad-entry-hover-background-color);\n}\n\n.djs-context-pad.open {\n  display: block;\n}\n\n/**\n * popup styles\n */\n.djs-popup .entry {\n  line-height: 20px;\n  white-space: nowrap;\n  cursor: default;\n}\n\n/* larger font for prefixed icons */\n.djs-popup .entry:before {\n  vertical-align: middle;\n  font-size: 20px;\n}\n\n.djs-popup .entry > span {\n  vertical-align: middle;\n  font-size: 14px;\n}\n\n.djs-popup .entry:hover,\n.djs-popup .entry.active:hover {\n  background: var(--popup-header-entry-selected-background-color);\n}\n\n.djs-popup .entry.disabled {\n  background: inherit;\n}\n\n.djs-popup .djs-popup-header .entry {\n  display: inline-block;\n  padding: 2px 3px 2px 3px;\n\n  border: solid 1px transparent;\n  border-radius: 3px;\n}\n\n.djs-popup .djs-popup-header .entry.active {\n  color: var(--popup-header-entry-selected-color);\n  border: solid 1px var(--popup-header-entry-selected-color);\n  background-color: var(--popup-header-entry-selected-background-color);\n}\n\n.djs-popup-body .entry {\n  padding: 4px 10px 4px 5px;\n}\n\n.djs-popup-body .entry > span {\n  margin-left: 5px;\n}\n\n.djs-popup-body {\n  background-color: var(--popup-body-background-color);\n}\n\n.djs-popup-header {\n  border-bottom: 1px solid var(--popup-header-separator-color);\n}\n\n.djs-popup-header .entry {\n  margin: 1px;\n  margin-left: 3px;\n}\n\n.djs-popup-header .entry:last-child {\n  margin-right: 3px;\n}\n\n/**\n * popup / palette styles\n */\n.djs-palette {\n  background: var(--palette-background-color);\n  border: solid 1px var(--palette-border-color);\n  border-radius: 2px;\n}\n\n.djs-popup {\n  background: var(--popup-background-color);\n  border: solid 1px var(--popup-border-color);\n  border-radius: 2px;\n}\n\n/**\n * touch\n */\n\n.djs-shape,\n.djs-connection {\n  touch-action: none;\n}\n\n.djs-segment-dragger,\n.djs-bendpoint {\n  display: none;\n}\n\n/**\n * bendpoints\n */\n.djs-segment-dragger .djs-visual {\n  display: none;\n\n  fill: var(--bendpoint-fill-color);\n  stroke: var(--bendpoint-stroke-color);\n  stroke-width: 1px;\n  stroke-opacity: 1;\n}\n\n.djs-segment-dragger:hover .djs-visual {\n  display: block;\n}\n\n.djs-bendpoint .djs-visual {\n  fill: var(--bendpoint-fill-color);\n  stroke: var(--bendpoint-stroke-color);\n  stroke-width: 1px;\n  stroke-opacity: 0.5;\n}\n\n.djs-segment-dragger:hover,\n.djs-bendpoints.hover .djs-segment-dragger,\n.djs-bendpoints.selected .djs-segment-dragger,\n.djs-bendpoint:hover,\n.djs-bendpoints.hover .djs-bendpoint,\n.djs-bendpoints.selected .djs-bendpoint {\n  display: block;\n}\n\n.djs-drag-active .djs-bendpoints * {\n  display: none;\n}\n\n.djs-bendpoints:not(.hover) .floating {\n  display: none;\n}\n\n.djs-segment-dragger:hover .djs-visual,\n.djs-segment-dragger.djs-dragging .djs-visual,\n.djs-bendpoint:hover .djs-visual,\n.djs-bendpoint.floating .djs-visual {\n  fill: var(--bendpoint-fill-color);\n  stroke: var(--bendpoint-stroke-color);\n  stroke-opacity: 1;\n}\n\n.djs-bendpoint.floating .djs-hit {\n  pointer-events: none;\n}\n\n.djs-segment-dragger .djs-hit,\n.djs-bendpoint .djs-hit {\n  fill: none;\n  pointer-events: all;\n}\n\n.djs-segment-dragger.horizontal .djs-hit {\n  cursor: ns-resize;\n}\n\n.djs-segment-dragger.vertical .djs-hit {\n  cursor: ew-resize;\n}\n\n.djs-segment-dragger.djs-dragging .djs-hit {\n  pointer-events: none;\n}\n\n.djs-updating,\n.djs-updating > * {\n  pointer-events: none !important;\n}\n\n.djs-updating .djs-context-pad,\n.djs-updating .djs-outline,\n.djs-updating .djs-bendpoint,\n.connect-ok .djs-bendpoint,\n.connect-not-ok .djs-bendpoint,\n.drop-ok .djs-bendpoint,\n.drop-not-ok .djs-bendpoint {\n  display: none !important;\n}\n\n.djs-segment-dragger.djs-dragging,\n.djs-bendpoint.djs-dragging {\n  display: block;\n  opacity: 1.0;\n}\n\n\n/**\n * tooltips\n */\n.djs-tooltip-error {\n  width: 160px;\n  padding: 6px;\n\n  background: var(--tooltip-error-background-color);\n  border: solid 1px var(--tooltip-error-border-color);\n  border-radius: 2px;\n  color: var(--tooltip-error-color);\n  font-size: 12px;\n  line-height: 16px;\n\n  opacity: 0.75;\n}\n\n.djs-tooltip-error:hover {\n  opacity: 1;\n}\n\n\n/**\n * search pad\n */\n.djs-search-container {\n  position: absolute;\n  top: 20px;\n  left: 0;\n  right: 0;\n  margin-left: auto;\n  margin-right: auto;\n\n  width: 25%;\n  min-width: 300px;\n  max-width: 400px;\n  z-index: 10;\n\n  font-size: 1.05em;\n  opacity: 0.9;\n  background: var(--search-container-background-color);\n  border: solid 1px var(--search-container-border-color);\n  border-radius: 2px;\n  box-shadow: 0 0 0 2px var(--search-container-box-shadow-color), 0 0 0 1px var(--search-container-box-shadow-inset-color) inset;\n}\n\n.djs-search-container:not(.open) {\n  display: none;\n}\n\n.djs-search-input input {\n  font-size: 1.05em;\n  width: 100%;\n  padding: 6px 10px;\n  border: 1px solid var(--search-input-border-color);\n  box-sizing: border-box;\n}\n\n.djs-search-input input:focus {\n  outline: none;\n  border-color: var(--search-input-border-color);\n}\n\n.djs-search-results {\n  position: relative;\n  overflow-y: auto;\n  max-height: 200px;\n}\n\n.djs-search-results:hover {\n  cursor: pointer;\n}\n\n.djs-search-result {\n  width: 100%;\n  padding: 6px 10px;\n  background: white;\n  border-bottom: solid 1px var(--search-result-border-color);\n  border-radius: 1px;\n}\n\n.djs-search-highlight {\n  color: var(--search-result-highlight-color);\n}\n\n.djs-search-result-primary {\n  margin: 0 0 10px;\n}\n\n.djs-search-result-secondary {\n  font-family: monospace;\n  margin: 0;\n}\n\n.djs-search-result:hover {\n  background: var(--search-result-selected-color);\n}\n\n.djs-search-result-selected {\n  background: var(--search-result-selected-color);\n}\n\n.djs-search-result-selected:hover {\n  background: var(--search-result-selected-color);\n}\n\n.djs-search-overlay {\n  background: var(--search-result-selected-color);\n}\n\n/**\n * hidden styles\n */\n.djs-element-hidden,\n.djs-element-hidden .djs-hit,\n.djs-element-hidden .djs-outline,\n.djs-label-hidden .djs-label {\n  display: none !important;\n}\n",""]);const r=s},1597:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),a=i.n(n),o=i(3645),s=i.n(o)()(a());s.push([e.id,"@keyframes pulseDark {\n   0% {\n      /* color: darkorange; */\n      transform: scale(1);\n      text-shadow: 0 0 1px rgba(0, 0, 0, 0.4);\n   }\n   50% {\n      /* color: orange; */\n   }\n   100% {\n      /* color: darkorange; */\n      transform: scale(1.25);\n      text-shadow: 0 3px 3px rgba(0, 0, 0, 0.4);\n   }\n}\n@keyframes pulseLight {\n   0% {\n      /* color: darkorange; */\n      transform: scale(1);\n      text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);\n   }\n   50% {\n      /* color: orange; */\n   }\n   100% {\n      /* color: darkorange; */\n      transform: scale(1.25);\n      text-shadow: 0 3px 3px rgba(0, 0, 0, 0.1);\n   }\n}\n.pulseDark {\n   animation-name: pulseDark;\n   animation-duration: 1s;\n   animation-timing-function: ease-out;\n   animation-direction: alternate;\n   animation-iteration-count: infinite;\n   animation-play-state: running;\n   color: orange !important;\n}\n.pulseLight {\n   animation-name: pulseLight;\n   animation-duration: 1s;\n   animation-timing-function: ease-out;\n   animation-direction: alternate;\n   animation-iteration-count: infinite;\n   animation-play-state: running;\n   color: orange !important;\n}\n.smalltext {\n   font-size: small !important;\n}\n.ab-object-list-item .webix_sidebar_dir_icon {\n   margin-right: 20px;\n}\n.ab-datacollection-list-item .webix_sidebar_dir_icon {\n   margin-right: 20px;\n}\n.ab-interface-list-item .webix_sidebar_dir_icon {\n   margin-right: 20px;\n}\n.darkorange .webix_button {\n   background-color: darkorange !important;\n}\n.warningtext {\n   color: orange;\n}\n.warningslist {\n   list-style-type: none;\n   margin: 0;\n   padding: 0;\n   line-height: 28px;\n   background-color: transparent;\n   color: white;\n}\n.warningslist li {\n   border-bottom: 1px solid rgba(0, 0, 0, 0.2);\n}\n.webix_theme_dark {\n   background-color: #4a4e58;\n}\n.lighten {\n   opacity: 0.4;\n}\n.app_form_window {\n   border-radius: 8px;\n}\n.app_form_window .webix_win_head {\n   background-color: #b8b8b8;\n}\n.app_form_window div.webix_view.webix_control.webix_el_icon.alert {\n   padding: 0px;\n}\n/* main view background (transparent by default) */\n.app_form_window .alert {\n   background-color: transparent;\n}\n/* main font color */\n.app_form_window .alert .webix_icon {\n   color: #eed202;\n}\n/* circle background (hover) */\n.app_form_window .alert .webix_icon_button:hover:before {\n   opacity: 0.8;\n}\n/* hover: font color */\n.app_form_window .alert .webix_icon_button:hover .webix_icon {\n   color: #d6bd01;\n}\n.app_form_window .webix_template {\n   font-size: 18px;\n   background-color: #b8b8b8;\n}\n.app_form_window .webix_label_right {\n   font-weight: 500;\n   color: rgb(49, 49, 49);\n   width: 340px;\n   padding-left: 10px;\n}\n.app_form_window .webix_scroll_cont .npr_smallLabels .webix_el_box {\n   font-size: 16px;\n   font-weight: 500;\n   color: #33b5e5;\n   text-align: right;\n}\n.app_form_window .webix_multicombo {\n   border: 2px solid #eee;\n   border-radius: 6px;\n}\n.app_form_window .webix_view .webix_layout_form {\n   border: 1px solid #eee;\n   border-radius: 6px;\n}\n.app_form_window div.webix_view.webix_form.no-margin.webix_layout_form {\n   background-color: #eee;\n}\n.app_form_window .webix_button {\n   border-radius: 6px;\n}\n.app_form_window_2 {\n   border-radius: 6px;\n}\n.app_form_window_2 .webix_win_head {\n   background-color: #b8b8b8;\n}\n.app_form_window_2 .webix_template {\n   font-size: 18px;\n   background-color: #b8b8b8;\n}\n/* Tab editing */\n.ab-tab-back:hover,\n.ab-tab-next:hover,\n.ab-tab-up:hover,\n.ab-tab-down:hover {\n   cursor: e-resize;\n   opacity: 1;\n}\n.ab-tab-back:hover {\n   cursor: w-resize;\n}\n.ab-tab-up:hover {\n   cursor: n-resize;\n   opacity: 1;\n}\n.ab-tab-down:hover {\n   cursor: s-resize;\n}\n.ab-tab-back,\n.ab-tab-next,\n.ab-tab-up,\n.ab-tab-down {\n   float: left;\n   margin-left: 10px;\n   background: #1ca1c1;\n   opacity: 0.8;\n   width: 20px;\n   height: 20px;\n   border-radius: 10px;\n   line-height: 20px !important;\n   padding-right: 2px;\n   color: white;\n}\n.fa-pencil-square.ab-tab-edit {\n   opacity: 0.4;\n}\n.fa-pencil.ab-tab-edit {\n   opacity: 0;\n   position: absolute;\n   left: 12px;\n   top: 12px;\n   background: #1ca1c1;\n   width: 20px;\n   height: 20px;\n   text-align: center;\n   line-height: 20px !important;\n   border-radius: 100%;\n   font-size: 11px;\n}\n.ab-tab-edit:hover {\n   opacity: 1;\n   transform: scale(1.2);\n}\n.webix_tree_item:hover .fa-pencil.ab-tab-edit {\n   opacity: 1;\n}\n.ab-tab-next {\n   float: right;\n   margin-right: 10px;\n   padding-left: 6px;\n}\n.ab-tab-up,\n.ab-tab-down {\n   /*   float: right;*/\n   /*   margin: 12px -2px 12px 15px;*/\n   /*   padding-left: 6px;*/\n   opacity: 0.2;\n   border-radius: 0 !important;\n   position: absolute;\n   right: 1px;\n   top: 0;\n   line-height: 22px !important;\n   width: 22px;\n   height: 21px;\n   text-align: center;\n   margin: 0;\n}\n.ab-tab-down {\n   top: 22px;\n}\n.webix_tree_item {\n   position: relative;\n}\n.webix_all_tabs div:nth-child(1) .ab-tab-back {\n   display: none;\n}\n.webix_all_tabs div:nth-last-child(1) .ab-tab-next {\n   display: none;\n}\n",""]);const r=s},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);n&&s[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),t.push(d))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},8269:function(e,t,i){var n;n=void 0!==i.g?i.g:this,e.exports=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var t=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var t,i=String(e),n=i.length,a=-1,o="",s=i.charCodeAt(0);++a<n;)0!=(t=i.charCodeAt(a))?o+=t>=1&&t<=31||127==t||0==a&&t>=48&&t<=57||1==a&&t>=48&&t<=57&&45==s?"\\"+t.toString(16)+" ":0==a&&1==n&&45==t||!(t>=128||45==t||95==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)?"\\"+i.charAt(a):i.charAt(a):o+="�";return o};return e.CSS||(e.CSS={}),e.CSS.escape=t,t}(n)},2270:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},840:(e,t,i)=>{var n;!function(a,o,s,r){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],d=o.createElement("div"),u=Math.round,h=Math.abs,p=Date.now;function m(e,t,i){return setTimeout(x(e,i),t)}function f(e,t,i){return!!Array.isArray(e)&&(g(e,i[t],i),!0)}function g(e,t,i){var n;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==r)for(n=0;n<e.length;)t.call(i,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n,e)}function v(e,t,i){var n="DEPRECATED METHOD: "+t+"\n"+i+" AT \n";return function(){var t=new Error("get-stack-trace"),i=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=a.console&&(a.console.warn||a.console.log);return o&&o.call(a.console,n,i),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===r||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==r&&null!==n)for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])}return t}:Object.assign;var b=v((function(e,t,i){for(var n=Object.keys(t),a=0;a<n.length;)(!i||i&&e[n[a]]===r)&&(e[n[a]]=t[n[a]]),a++;return e}),"extend","Use `assign`."),y=v((function(e,t){return b(e,t,!0)}),"merge","Use `assign`.");function w(e,t,i){var n,a=t.prototype;(n=e.prototype=Object.create(a)).constructor=e,n._super=a,i&&l(n,i)}function x(e,t){return function(){return e.apply(t,arguments)}}function $(e,t){return"function"==typeof e?e.apply(t&&t[0]||r,t):e}function _(e,t){return e===r?t:e}function C(e,t,i){g(A(t),(function(t){e.addEventListener(t,i,!1)}))}function E(e,t,i){g(A(t),(function(t){e.removeEventListener(t,i,!1)}))}function S(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function k(e,t){return e.indexOf(t)>-1}function A(e){return e.trim().split(/\s+/g)}function D(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function R(e){return Array.prototype.slice.call(e,0)}function P(e,t,i){for(var n=[],a=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];D(a,s)<0&&n.push(e[o]),a[o]=s,o++}return i&&(n=t?n.sort((function(e,i){return e[t]>i[t]})):n.sort()),n}function L(e,t){for(var i,n,a=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((n=(i=c[o])?i+a:t)in e)return n;o++}return r}var V=1;function F(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||a}var I="ontouchstart"in a,B=L(a,"PointerEvent")!==r,T=I&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),j="touch",O="mouse",M=["x","y"],N=["clientX","clientY"];function W(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){$(e.options.enable,[e])&&i.handler(t)},this.init()}function z(e,t,i){var n=i.pointers.length,a=i.changedPointers.length,o=1&t&&n-a==0,s=12&t&&n-a==0;i.isFirst=!!o,i.isFinal=!!s,o&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,n=t.pointers,a=n.length;i.firstInput||(i.firstInput=U(t)),a>1&&!i.firstMultiple?i.firstMultiple=U(t):1===a&&(i.firstMultiple=!1);var o=i.firstInput,s=i.firstMultiple,l=s?s.center:o.center,c=t.center=q(n);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=Y(l,c),t.distance=Z(l,c),function(e,t){var i=t.center,n=e.offsetDelta||{},a=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(a=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=a.x+(i.x-n.x),t.deltaY=a.y+(i.y-n.y)}(i,t),t.offsetDirection=G(t.deltaX,t.deltaY);var d,u,m=H(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=m.x,t.overallVelocityY=m.y,t.overallVelocity=h(m.x)>h(m.y)?m.x:m.y,t.scale=s?(d=s.pointers,Z((u=n)[0],u[1],N)/Z(d[0],d[1],N)):1,t.rotation=s?function(e,t){return Y(t[1],t[0],N)+Y(e[1],e[0],N)}(s.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,n,a,o,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(8!=t.eventType&&(l>25||s.velocity===r)){var c=t.deltaX-s.deltaX,d=t.deltaY-s.deltaY,u=H(l,c,d);n=u.x,a=u.y,i=h(u.x)>h(u.y)?u.x:u.y,o=G(c,d),e.lastInterval=t}else i=s.velocity,n=s.velocityX,a=s.velocityY,o=s.direction;t.velocity=i,t.velocityX=n,t.velocityY=a,t.direction=o}(i,t);var f=e.element;S(t.srcEvent.target,f)&&(f=t.srcEvent.target),t.target=f}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function U(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:u(e.pointers[i].clientX),clientY:u(e.pointers[i].clientY)},i++;return{timeStamp:p(),pointers:t,center:q(t),deltaX:e.deltaX,deltaY:e.deltaY}}function q(e){var t=e.length;if(1===t)return{x:u(e[0].clientX),y:u(e[0].clientY)};for(var i=0,n=0,a=0;a<t;)i+=e[a].clientX,n+=e[a].clientY,a++;return{x:u(i/t),y:u(n/t)}}function H(e,t,i){return{x:t/e||0,y:i/e||0}}function G(e,t){return e===t?1:h(e)>=h(t)?e<0?2:4:t<0?8:16}function Z(e,t,i){i||(i=M);var n=t[i[0]]-e[i[0]],a=t[i[1]]-e[i[1]];return Math.sqrt(n*n+a*a)}function Y(e,t,i){i||(i=M);var n=t[i[0]]-e[i[0]],a=t[i[1]]-e[i[1]];return 180*Math.atan2(a,n)/Math.PI}W.prototype={handler:function(){},init:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(F(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4},X="mousedown",Q="mousemove mouseup";function J(){this.evEl=X,this.evWin=Q,this.pressed=!1,W.apply(this,arguments)}w(J,W,{handler:function(e){var t=K[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:O,srcEvent:e}))}});var ee={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},te={2:j,3:"pen",4:O,5:"kinect"},ie="pointerdown",ne="pointermove pointerup pointercancel";function ae(){this.evEl=ie,this.evWin=ne,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}a.MSPointerEvent&&!a.PointerEvent&&(ie="MSPointerDown",ne="MSPointerMove MSPointerUp MSPointerCancel"),w(ae,W,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),a=ee[n],o=te[e.pointerType]||e.pointerType,s=o==j,r=D(t,e.pointerId,"pointerId");1&a&&(0===e.button||s)?r<0&&(t.push(e),r=t.length-1):12&a&&(i=!0),r<0||(t[r]=e,this.callback(this.manager,a,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),i&&t.splice(r,1))}});var oe={touchstart:1,touchmove:2,touchend:4,touchcancel:8},se="touchstart",re="touchstart touchmove touchend touchcancel";function le(){this.evTarget=se,this.evWin=re,this.started=!1,W.apply(this,arguments)}function ce(e,t){var i=R(e.touches),n=R(e.changedTouches);return 12&t&&(i=P(i.concat(n),"identifier",!0)),[i,n]}w(le,W,{handler:function(e){var t=oe[e.type];if(1===t&&(this.started=!0),this.started){var i=ce.call(this,e,t);12&t&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:j,srcEvent:e})}}});var de={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ue="touchstart touchmove touchend touchcancel";function he(){this.evTarget=ue,this.targetIds={},W.apply(this,arguments)}function pe(e,t){var i=R(e.touches),n=this.targetIds;if(3&t&&1===i.length)return n[i[0].identifier]=!0,[i,i];var a,o,s=R(e.changedTouches),r=[],l=this.target;if(o=i.filter((function(e){return S(e.target,l)})),1===t)for(a=0;a<o.length;)n[o[a].identifier]=!0,a++;for(a=0;a<s.length;)n[s[a].identifier]&&r.push(s[a]),12&t&&delete n[s[a].identifier],a++;return r.length?[P(o.concat(r),"identifier",!0),r]:void 0}function me(){W.apply(this,arguments);var e=x(this.handler,this);this.touch=new he(this.manager,e),this.mouse=new J(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function fe(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ge.call(this,t)):12&e&&ge.call(this,t)}function ge(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout((function(){var e=n.indexOf(i);e>-1&&n.splice(e,1)}),2500)}}function ve(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var a=this.lastTouches[n],o=Math.abs(t-a.x),s=Math.abs(i-a.y);if(o<=25&&s<=25)return!0}return!1}w(he,W,{handler:function(e){var t=de[e.type],i=pe.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:j,srcEvent:e})}}),w(me,W,{handler:function(e,t,i){var n=i.pointerType==j,a=i.pointerType==O;if(!(a&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)fe.call(this,t,i);else if(a&&ve.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var be=L(d.style,"touchAction"),ye=be!==r,we="compute",xe="auto",$e="manipulation",_e="none",Ce="pan-x",Ee="pan-y",Se=function(){if(!ye)return!1;var e={},t=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){e[i]=!t||a.CSS.supports("touch-action",i)})),e}();function ke(e,t){this.manager=e,this.set(t)}ke.prototype={set:function(e){e==we&&(e=this.compute()),ye&&this.manager.element.style&&Se[e]&&(this.manager.element.style[be]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){$(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(k(e,_e))return _e;var t=k(e,Ce),i=k(e,Ee);return t&&i?_e:t||i?t?Ce:Ee:k(e,$e)?$e:xe}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var n=this.actions,a=k(n,_e)&&!Se.none,o=k(n,Ee)&&!Se["pan-y"],s=k(n,Ce)&&!Se["pan-x"];if(a){var r=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(r&&l&&c)return}if(!s||!o)return a||o&&6&i||s&&24&i?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ae=32;function De(e){this.options=l({},this.defaults,e||{}),this.id=V++,this.manager=null,this.options.enable=_(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Re(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Pe(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Le(e,t){var i=t.manager;return i?i.get(e):e}function Ve(){De.apply(this,arguments)}function Fe(){Ve.apply(this,arguments),this.pX=null,this.pY=null}function Ie(){Ve.apply(this,arguments)}function Be(){De.apply(this,arguments),this._timer=null,this._input=null}function Te(){Ve.apply(this,arguments)}function je(){Ve.apply(this,arguments)}function Oe(){De.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Me(e,t){return(t=t||{}).recognizers=_(t.recognizers,Me.defaults.preset),new Ne(e,t)}function Ne(e,t){this.options=l({},Me.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(B?ae:T?he:I?me:J))(this,z),this.touchAction=new ke(this,this.options.touchAction),We(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function We(e,t){var i,n=e.element;n.style&&(g(e.options.cssProps,(function(a,o){i=L(n.style,o),t?(e.oldCssProps[i]=n.style[i],n.style[i]=a):n.style[i]=e.oldCssProps[i]||""})),t||(e.oldCssProps={}))}De.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(f(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Le(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return f(e,"dropRecognizeWith",this)||(e=Le(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(f(e,"requireFailure",this))return this;var t=this.requireFail;return-1===D(t,e=Le(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(f(e,"dropRequireFailure",this))return this;e=Le(e,this);var t=D(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function n(i){t.manager.emit(i,e)}i<8&&n(t.options.event+Re(i)),n(t.options.event),e.additionalEvent&&n(e.additionalEvent),i>=8&&n(t.options.event+Re(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ae},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!$(this.options.enable,[this,t]))return this.reset(),void(this.state=Ae);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},w(Ve,De,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=6&t,a=this.attrTest(e);return n&&(8&i||!a)?16|t:n||a?4&i?8|t:2&t?4|t:2:Ae}}),w(Fe,Ve,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Ee),24&e&&t.push(Ce),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,a=e.direction,o=e.deltaX,s=e.deltaY;return a&t.direction||(6&t.direction?(a=0===o?1:o<0?2:4,i=o!=this.pX,n=Math.abs(e.deltaX)):(a=0===s?1:s<0?8:16,i=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=a,i&&n>t.threshold&&a&t.direction},attrTest:function(e){return Ve.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Pe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),w(Ie,Ve,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),w(Be,De,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[xe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,a=e.deltaTime>t.time;if(this._input=e,!n||!i||12&e.eventType&&!a)this.reset();else if(1&e.eventType)this.reset(),this._timer=m((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Ae},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),w(Te,Ve,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),w(je,Ve,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Fe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return 30&i?t=e.overallVelocity:6&i?t=e.overallVelocityX:24&i&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Pe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),w(Oe,De,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$e]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(n&&a&&i){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||Z(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=m((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ae},failTimeout:function(){return this._timer=m((function(){this.state=Ae}),this.options.interval,this),Ae},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Me.VERSION="2.0.7",Me.defaults={domEvents:!1,touchAction:we,enable:!0,inputTarget:null,inputClass:null,preset:[[Te,{enable:!1}],[Ie,{enable:!1},["rotate"]],[je,{direction:6}],[Fe,{direction:6},["swipe"]],[Oe],[Oe,{event:"doubletap",taps:2},["tap"]],[Be]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ne.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var i;this.touchAction.preventDefaults(e);var n=this.recognizers,a=t.curRecognizer;(!a||a&&8&a.state)&&(a=t.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],2===t.stopped||a&&i!=a&&!i.canRecognizeWith(a)?i.reset():i.recognize(e),!a&&14&i.state&&(a=t.curRecognizer=i),o++}},get:function(e){if(e instanceof De)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(f(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(f(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=D(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==r&&t!==r){var i=this.handlers;return g(A(e),(function(e){i[e]=i[e]||[],i[e].push(t)})),this}},off:function(e,t){if(e!==r){var i=this.handlers;return g(A(e),(function(e){t?i[e]&&i[e].splice(D(i[e],t),1):delete i[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=o.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&We(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Me,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ae,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ne,Input:W,TouchAction:ke,TouchInput:he,MouseInput:J,PointerEventInput:ae,TouchMouseInput:me,SingleTouchInput:le,Recognizer:De,AttrRecognizer:Ve,Tap:Oe,Pan:Fe,Swipe:je,Pinch:Ie,Rotate:Te,Press:Be,on:C,off:E,each:g,merge:y,extend:b,assign:l,inherit:w,bindFn:x,prefixed:L}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=Me,(n=function(){return Me}.call(t,i,t,e))===r||(e.exports=n)}(window,document)},1235:(e,t,i)=>{e.exports=i(8302),e.exports.Collection=i(5048)},5048:e=>{"use strict";e.exports.extend=function(e,t,i,n){var a=i.inverse;return Object.defineProperty(e,"remove",{value:function(e){var i=this.indexOf(e);return-1!==i&&(this.splice(i,1),t.unset(e,a,n)),e}}),Object.defineProperty(e,"contains",{value:function(e){return-1!==this.indexOf(e)}}),Object.defineProperty(e,"add",{value:function(e,i){var o=this.indexOf(e);if(void 0===i){if(-1!==o)return;i=this.length}-1!==o&&this.splice(o,1),this.splice(i,0,e),-1===o&&t.set(e,a,n)}}),Object.defineProperty(e,"__refs_collection",{value:!0}),e},e.exports.isExtended=function(e){return!0===e.__refs_collection}},8302:(e,t,i)=>{"use strict";var n=i(5048);function a(e,t,i){var a=n.extend(i[t.name]||[],e,t,i);Object.defineProperty(i,t.name,{enumerable:t.enumerable,value:a}),a.length&&a.forEach((function(n){e.set(n,t.inverse,i)}))}function o(e,t){if(!(this instanceof o))return new o(e,t);e.inverse=t,t.inverse=e,this.props={},this.props[e.name]=e,this.props[t.name]=t}o.prototype.bind=function(e,t){if("string"==typeof t){if(!this.props[t])throw new Error("no property <"+t+"> in ref");t=this.props[t]}t.collection?a(this,t,e):function(e,t,i){var n=t.inverse,a=i[t.name];Object.defineProperty(i,t.name,{configurable:t.configurable,enumerable:t.enumerable,get:function(){return a},set:function(t){if(t!==a){var o=a;a=null,o&&e.unset(o,n,i),a=t,e.set(a,n,i)}}})}(this,t,e)},o.prototype.ensureRefsCollection=function(e,t){var i=e[t.name];return n.isExtended(i)||a(this,t,e),i},o.prototype.ensureBound=function(e,t){(function(e,t){return Object.prototype.hasOwnProperty.call(e,t.name||t)})(e,t)||this.bind(e,t)},o.prototype.unset=function(e,t,i){e&&(this.ensureBound(e,t),t.collection?this.ensureRefsCollection(e,t).remove(i):e[t.name]=void 0)},o.prototype.set=function(e,t,i){e&&(this.ensureBound(e,t),t.collection?this.ensureRefsCollection(e,t).add(i):e[t.name]=i)},e.exports=o},2720:e=>{"use strict";var t=/,?([a-z]),?/gi,i=parseFloat,n=Math,a=n.PI,o=n.min,s=n.max,r=n.pow,l=n.abs,c=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,d=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi,u=Array.isArray||function(e){return e instanceof Array};function h(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function p(e){if("function"==typeof e||Object(e)!==e)return e;var t=new e.constructor;for(var i in e)h(e,i)&&(t[i]=p(e[i]));return t}function m(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return e.push(e.splice(i,1)[0])}function f(e){var t=f.ps=f.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout((function(){for(var i in t)h(t,i)&&i!=e&&(t[i].sleep--,!t[i].sleep&&delete t[i])})),t[e]}function g(e,t,i,n){return 1===arguments.length&&(t=e.y,i=e.width,n=e.height,e=e.x),{x:e,y:t,width:i,height:n,x2:e+i,y2:t+n}}function v(){return this.join(",").replace(t,"$1")}function b(e){var t=p(e);return t.toString=v,t}function y(e,t,i,n,a,o,s,l,c){var d=1-c,u=r(d,3),h=r(d,2),p=c*c*c,m=u*t+3*h*c*n+3*d*c*c*o+p*l;return{x:E(u*e+3*h*c*i+3*d*c*c*a+p*s),y:E(m)}}function w(e){var t=L.apply(null,e);return g(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0)}function x(e,t,i){return t>=e.x&&t<=e.x+e.width&&i>=e.y&&i<=e.y+e.height}function $(e,t,i,n,a){return e*(e*(-3*t+9*i-9*n+3*a)+6*t-12*i+6*n)-3*t+3*i}function _(e,t,i,a,o,s,r,l,c){null==c&&(c=1);for(var d=(c=c>1?1:c<0?0:c)/2,u=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0,m=0;m<12;m++){var f=d*u[m]+d,g=$(f,e,i,o,r),v=$(f,t,a,s,l),b=g*g+v*v;p+=h[m]*n.sqrt(b)}return d*p}function C(e,t,i,n,a,r,l,c){if(!(s(e,i)<o(a,l)||o(e,i)>s(a,l)||s(t,n)<o(r,c)||o(t,n)>s(r,c))){var d=(e*n-t*i)*(r-c)-(t-n)*(a*c-r*l),u=(e-i)*(r-c)-(t-n)*(a-l);if(u){var h=E(((e*n-t*i)*(a-l)-(e-i)*(a*c-r*l))/u),p=E(d/u),m=+h.toFixed(2),f=+p.toFixed(2);if(!(m<+o(e,i).toFixed(2)||m>+s(e,i).toFixed(2)||m<+o(a,l).toFixed(2)||m>+s(a,l).toFixed(2)||f<+o(t,n).toFixed(2)||f>+s(t,n).toFixed(2)||f<+o(r,c).toFixed(2)||f>+s(r,c).toFixed(2)))return{x:h,y:p}}}}function E(e){return Math.round(1e11*e)/1e11}function S(e,t,i){if(n=w(e),a=w(t),n=g(n),!(x(a=g(a),n.x,n.y)||x(a,n.x2,n.y)||x(a,n.x,n.y2)||x(a,n.x2,n.y2)||x(n,a.x,a.y)||x(n,a.x2,a.y)||x(n,a.x,a.y2)||x(n,a.x2,a.y2)||(n.x<a.x2&&n.x>a.x||a.x<n.x2&&a.x>n.x)&&(n.y<a.y2&&n.y>a.y||a.y<n.y2&&a.y>n.y)))return i?0:[];for(var n,a,o=_.apply(0,e),s=_.apply(0,t),r=A(e)?1:~~(o/5)||1,c=A(t)?1:~~(s/5)||1,d=[],u=[],h={},p=i?0:[],m=0;m<r+1;m++){var f=y.apply(0,e.concat(m/r));d.push({x:f.x,y:f.y,t:m/r})}for(m=0;m<c+1;m++)f=y.apply(0,t.concat(m/c)),u.push({x:f.x,y:f.y,t:m/c});for(m=0;m<r;m++)for(var v=0;v<c;v++){var b,$=d[m],E=d[m+1],S=u[v],k=u[v+1],D=l(E.x-$.x)<.01?"y":"x",R=l(k.x-S.x)<.01?"y":"x",P=C($.x,$.y,E.x,E.y,S.x,S.y,k.x,k.y);if(P){if(h[b=P.x.toFixed(9)+"#"+P.y.toFixed(9)])continue;h[b]=!0;var L=$.t+l((P[D]-$[D])/(E[D]-$[D]))*(E.t-$.t),V=S.t+l((P[R]-S[R])/(k[R]-S[R]))*(k.t-S.t);L>=0&&L<=1&&V>=0&&V<=1&&(i?p++:p.push({x:P.x,y:P.y,t1:L,t2:V}))}}return p}function k(e){var t=f(e);if(t.abs)return b(t.abs);if(u(e)&&u(e&&e[0])||(e=function(e){if(!e)return null;var t=f(e);if(t.arr)return p(t.arr);var i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=[];return u(e)&&u(e[0])&&(n=p(e)),n.length||String(e).replace(c,(function(e,t,a){var o=[],s=t.toLowerCase();for(a.replace(d,(function(e,t){t&&o.push(+t)})),"m"==s&&o.length>2&&(n.push([t].concat(o.splice(0,2))),s="l",t="m"==t?"l":"L");o.length>=i[s]&&(n.push([t].concat(o.splice(0,i[s]))),i[s]););})),n.toString=f.toString,t.arr=p(n),n}(e)),!e||!e.length)return[["M",0,0]];var i,n=[],a=0,o=0,s=0,r=0,l=0;"M"==e[0][0]&&(s=a=+e[0][1],r=o=+e[0][2],l++,n[0]=["M",a,o]);for(var h,m,g=l,y=e.length;g<y;g++){if(n.push(h=[]),(i=(m=e[g])[0])!=i.toUpperCase())switch(h[0]=i.toUpperCase(),h[0]){case"A":h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h[6]=+m[6]+a,h[7]=+m[7]+o;break;case"V":h[1]=+m[1]+o;break;case"H":h[1]=+m[1]+a;break;case"M":s=+m[1]+a,r=+m[2]+o;default:for(var w=1,x=m.length;w<x;w++)h[w]=+m[w]+(w%2?a:o)}else for(var $=0,_=m.length;$<_;$++)h[$]=m[$];switch(i=i.toUpperCase(),h[0]){case"Z":a=+s,o=+r;break;case"H":a=h[1];break;case"V":o=h[1];break;case"M":s=h[h.length-2],r=h[h.length-1];default:a=h[h.length-2],o=h[h.length-1]}}return n.toString=v,t.abs=b(n),n}function A(e){return e[0]===e[2]&&e[1]===e[3]&&e[4]===e[6]&&e[5]===e[7]}function D(e,t,i,n){return[e,t,i,n,i,n]}function R(e,t,i,n,a,o){var s=1/3,r=2/3;return[s*e+r*i,s*t+r*n,s*a+r*i,s*o+r*n,a,o]}function P(e,t,i,o,s,r,c,d,u,p){var f,g,v=120*a/180,b=a/180*(+s||0),y=[],w=(g=function(e,t,i){return{x:e*n.cos(i)-t*n.sin(i),y:e*n.sin(i)+t*n.cos(i)}},function e(){var t=Array.prototype.slice.call(arguments,0),i=t.join("␀"),n=e.cache=e.cache||{},a=e.count=e.count||[];return h(n,i)?(m(a,i),n[i]):(a.length>=1e3&&delete n[a.shift()],a.push(i),n[i]=g.apply(0,t),n[i])});if(p)D=p[0],R=p[1],k=p[2],A=p[3];else{e=(f=w(e,t,-b)).x,t=f.y;var x=(e-(d=(f=w(d,u,-b)).x))/2,$=(t-(u=f.y))/2,_=x*x/(i*i)+$*$/(o*o);_>1&&(i*=_=n.sqrt(_),o*=_);var C=i*i,E=o*o,S=(r==c?-1:1)*n.sqrt(l((C*E-C*$*$-E*x*x)/(C*$*$+E*x*x))),k=S*i*$/o+(e+d)/2,A=S*-o*x/i+(t+u)/2,D=n.asin(((t-A)/o).toFixed(9)),R=n.asin(((u-A)/o).toFixed(9));(D=e<k?a-D:D)<0&&(D=2*a+D),(R=d<k?a-R:R)<0&&(R=2*a+R),c&&D>R&&(D-=2*a),!c&&R>D&&(R-=2*a)}var L=R-D;if(l(L)>v){var V=R,F=d,I=u;R=D+v*(c&&R>D?1:-1),y=P(d=k+i*n.cos(R),u=A+o*n.sin(R),i,o,s,0,c,F,I,[R,V,k,A])}L=R-D;var B=n.cos(D),T=n.sin(D),j=n.cos(R),O=n.sin(R),M=n.tan(L/4),N=4/3*i*M,W=4/3*o*M,z=[e,t],U=[e+N*T,t-W*B],q=[d+N*O,u-W*j],H=[d,u];if(U[0]=2*z[0]-U[0],U[1]=2*z[1]-U[1],p)return[U,q,H].concat(y);for(var G=[],Z=0,Y=(y=[U,q,H].concat(y).join().split(",")).length;Z<Y;Z++)G[Z]=Z%2?w(y[Z-1],y[Z],b).y:w(y[Z],y[Z+1],b).x;return G}function L(e,t,i,a,r,c,d,u){for(var h,p,m,f,g,v,b,y,w=[],x=[[],[]],$=0;$<2;++$)if(0==$?(p=6*e-12*i+6*r,h=-3*e+9*i-9*r+3*d,m=3*i-3*e):(p=6*t-12*a+6*c,h=-3*t+9*a-9*c+3*u,m=3*a-3*t),l(h)<1e-12){if(l(p)<1e-12)continue;0<(f=-m/p)&&f<1&&w.push(f)}else b=p*p-4*m*h,y=n.sqrt(b),b<0||(0<(g=(-p+y)/(2*h))&&g<1&&w.push(g),0<(v=(-p-y)/(2*h))&&v<1&&w.push(v));for(var _,C=w.length,E=C;C--;)_=1-(f=w[C]),x[0][C]=_*_*_*e+3*_*_*f*i+3*_*f*f*r+f*f*f*d,x[1][C]=_*_*_*t+3*_*_*f*a+3*_*f*f*c+f*f*f*u;return x[0][E]=e,x[1][E]=t,x[0][E+1]=d,x[1][E+1]=u,x[0].length=x[1].length=E+2,{x0:o.apply(0,x[0]),y0:o.apply(0,x[1]),x1:s.apply(0,x[0]),y1:s.apply(0,x[1])}}function V(e){var t=f(e);if(t.curve)return b(t.curve);for(var n=k(e),a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=function(e,t,i){var n,a;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"].concat(P.apply(0,[t.x,t.y].concat(e.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*t.x-t.bx,a=2*t.y-t.by):(n=t.x,a=t.y),e=["C",n,a].concat(e.slice(1));break;case"T":"Q"==i||"T"==i?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"].concat(R(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat(R(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"].concat(D(t.x,t.y,e[1],e[2]));break;case"H":e=["C"].concat(D(t.x,t.y,e[1],t.y));break;case"V":e=["C"].concat(D(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"].concat(D(t.x,t.y,t.X,t.Y))}return e},s=function(e,t){if(e[t].length>7){e[t].shift();for(var i=e[t];i.length;)r[t]="A",e.splice(t++,0,["C"].concat(i.splice(0,6)));e.splice(t,1),u=n.length}},r=[],l="",c="",d=0,u=n.length;d<u;d++){n[d]&&(l=n[d][0]),"C"!=l&&(r[d]=l,d&&(c=r[d-1])),n[d]=o(n[d],a,c),"A"!=r[d]&&"C"==l&&(r[d]="C"),s(n,d);var h=n[d],p=h.length;a.x=h[p-2],a.y=h[p-1],a.bx=i(h[p-4])||a.x,a.by=i(h[p-3])||a.y}return t.curve=b(n),n}e.exports=function(e,t,i){e=V(e),t=V(t);for(var n,a,o,s,r,l,c,d,u,h,p=i?0:[],m=0,f=e.length;m<f;m++){var g=e[m];if("M"==g[0])n=r=g[1],a=l=g[2];else{"C"==g[0]?(u=[n,a].concat(g.slice(1)),n=u[6],a=u[7]):(u=[n,a,n,a,r,l,r,l],n=r,a=l);for(var v=0,b=t.length;v<b;v++){var y=t[v];if("M"==y[0])o=c=y[1],s=d=y[2];else{"C"==y[0]?(h=[o,s].concat(y.slice(1)),o=h[6],s=h[7]):(h=[o,s,o,s,c,d,c,d],o=c,s=d);var w=S(u,h,i);if(i)p+=w;else{for(var x=0,$=w.length;x<$;x++)w[x].segment1=m,w[x].segment2=v,w[x].bez1=u,w[x].bez2=h;p=p.concat(w)}}}}}return p}},3379:e=>{"use strict";var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var o={},s=[],r=0;r<e.length;r++){var l=e[r],c=n.base?l[0]+n.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var h=i(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var m=a(p,n);n.byIndex=r,t.splice(r,0,{identifier:u,updater:m,references:1})}s.push(u)}return s}function a(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,a){var o=n(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var r=i(o[s]);t[r].references--}for(var l=n(e,a),c=0;c<o.length;c++){var d=i(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},569:e=>{"use strict";var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var a=void 0!==i.layer;a&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,a&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},5256:e=>{e.exports=[]},3880:e=>{e.exports={}},8023:(e,t,i)=>{var n={};n.en=i(3880),e.exports=n},2761:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"csvExporter"}constructor(e,t="interface_editor_csvExporter"){super(e,t),this.view=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){this.AB=e,this.component.init(this.AB)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},6720:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"csvImporter"}constructor(e,t="interface_editor_csvImporter"){super(e,t),this.view=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){this.AB=e,this.component.init(this.AB)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},8442:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"carousel"}constructor(t,i="interface_editor_viewcarousel"){super(i,{label:""}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){return this.AB=e,this.component.init(e,2)}detatch(){this.component.detatch()}onShow(){this.component.onShow()}}}return a}},1298:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let a=null;function o(e){if(!a){const t="interface_editor_viewchart",i=(0,n.default)(e);a=class extends i{static get key(){return"chart"}constructor(e,i=t){super(e,i)}ui(){const e=super.ui();return e.rows[0].cellHeight=400,e}async init(e){this.AB=e,await super.init(e)}detatch(){}onShow(){super.onShow()}}}return a}},6062:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewchart_area",i=(0,n.Z)(e);a=class extends i{static get key(){return"area"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},3725:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewchart_bar",i=(0,n.Z)(e);a=class extends i{static get key(){return"bar"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},3121:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewchart_line",i=(0,n.Z)(e);a=class extends i{static get key(){return"line"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},5250:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewchart_pie",i=(0,n.Z)(e);a=class extends i{static get key(){return"pie"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},8971:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewcomment",i=(0,n.Z)(e);a=class extends i{static get key(){return"comment"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},760:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let a=null;function o(e){if(a)return a;const t=(0,n.default)(e);return a=class extends t{static get key(){return"conditionalcontainer"}constructor(e,t="interface_editor_viewconditionalContainer"){super(e,t)}},a}},4713:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=null;function o(e){if(!a){const i=(0,n.Z)(e);var t=i.L();a=class n extends i{static get key(){return"viewcontainer"}constructor(t,i="interface_editor_viewcontainer",n={}){var a={label:""};Object.keys(n).forEach((e=>{void 0===a[e]?a[e]="":console.error(`!!! ABFieldProperty:: passed in ids contains a restricted field : ${e}`)})),super(i,a),this.view=t,this.settings=t.settings,this.viewLoad(t),this.base=i,this.AB=e,this.subComponents={},this.cellHeight=250}ui(){let t=n.key,i=e.Class.ABViewManager.viewClass(t).defaultValues();return{rows:[{id:this.ids.component,view:"dashboard",css:`ab-${t}-container`,cellHeight:this.cellHeight,gridColumns:this.settings.columns||i.columns}]}}init(e){var t=$$(this.ids.component);t&&(webix.extend(t,webix.OverlayBox),webix.extend(t,webix.ProgressBar)),this.CurrentView.viewsSortByPosition().forEach((i=>{let n;i.warningsSilent=!0;try{n=i.component()}catch(e){n=i.component(this.AB._App);let t=n.ui;n.ui=(()=>t).bind(n)}this.subComponents[i.id]=n;let a="panel";0==i.settings.movable&&(a="scrollview"),t.addView({view:a,name:i.id,icon:"fa fa-arrows",css:"ab-widget-container",body:{rows:[{view:"template",height:30,css:"ab-widget-header",template:this.template(i),onClick:{"ab-component-edit":(e,t,n)=>{this.viewEdit(e,i.id,n)},"ab-component-remove":(e,t,n)=>{this.viewDelete(e,i.id,n)}}},n.ui()]},dx:i.position.dx||1,dy:i.position.dy||1,x:this.validatePosition(i.position.x,0,t.config.gridColumns-1),y:i.position.y||0}),n.init(e,2)})),this._onChangeId&&t.detachEvent(this._onChangeId),this._onChangeId=t.attachEvent("onChange",(()=>{this.onReorder()})),this.showEmptyPlaceholder(),t.adjust()}detatch(){Object.keys(this.subComponents).forEach((e=>{this.subComponents[e]?.detatch?.()}));var e=$$(this.ids.component);e&&this._onChangeId&&e.detachEvent(this._onChangeId)}busy(){let e=$$(this.ids.component);e?.disable(),e?.showProgress({type:"icon"})}async onReorder(){this.busy();var e=$$(this.ids.component).serialize(),t=[];this.CurrentView.views().forEach((i=>{var n=e.filter((e=>e.name==i.id))[0];n&&(i.position.x=n.x,i.position.y=n.y,i.position.x<0&&(i.position.x=0),i.position.y<0&&(i.position.y=0),t.push(i.save()))}));try{await Promise.all(t),await this.CurrentView.save(),this.ready()}catch(e){this.AB.notify.developer(e,{message:"Error trying to save selected View:",view:this.CurrentView.toObj()}),this.ready()}}onShow(){this.CurrentView.views().forEach((e=>{this.subComponents[e.id]?.onShow?.()}));let e=this.CurrentView.datacollection;e&&e.dataStatus==e.dataStatusFlag.notInitial&&e.loadData()}ready(){let e=$$(this.ids.component);e?.enable(),e?.hideProgress()}showEmptyPlaceholder(){var e=$$(this.ids.component);0==e.getChildViews().length&&e.showOverlay("<div class='drop-zone'><div>"+t("Add Widgets Here")+"</div></div>")}template(e){let t="";return(e.warningsAll()||[]).length>0&&(t=this.WARNING_ICON),`<div>\n               <i class="fa fa-${e.icon} webix_icon_btn"></i> ${e.label}\n               <div class="ab-component-tools">\n               ${t}${0==e.settings.removable?"":'<i class="fa fa-trash ab-component-remove"></i>'}\n               <i class="fa fa-edit ab-component-edit"></i>\n               </div></div>`}validatePosition(e,t,i){return e<t?t:e>i?i:e}viewDelete(e,i){var n=this.CurrentView.views((e=>e.id==i))[0];if(!n)return!1;webix.confirm({title:t("Delete component"),text:t("Do you want to delete <b>{0}</b>?",[n.label]),callback:async e=>{if(e){this.busy();try{await n.destroy(),n.emit("destroyed",n),this.emit("view.destroyed",n);let e=$$(this.ids.component);var t=e.queryView({name:i});t&&(e.blockEvent(),e.removeView(t),e.unblockEvent()),this.showEmptyPlaceholder()}catch(e){this.AB.notify.developer(e,{message:"Error trying to delete selected View:",view:n})}this.ready()}}}),e.preventDefault()}viewEdit(e,t){var i=this.CurrentView.views((e=>e.id==t))[0];return!!i&&(setTimeout((()=>{try{this.emit("view.edit",i)}catch(e){console.error(e)}}),15),e.preventDefault(),!1)}}}return a}},5903:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let a=null;function o(e){if(!a){const t=(0,n.default)(e);a=class extends t{static get key(){return"dataview"}constructor(e,t="interface_editor_viewdataview"){super(e,t)}ui(){let e=super.ui();return e.rows[0].cellHeight=75,e}init(e){return this.AB=e,super.init(e)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},2442:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let a=null;function o(e){if(!a){const t=(0,n.default)(e);a=class extends t{static get key(){return"detail"}constructor(e,t="interface_editor_viewdetail"){super(e,t)}ui(){let e=super.ui();return e.rows[0].cellHeight=75,e}init(e){return this.AB=e,super.init(e)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},559:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(a)return a;const t=(0,n.Z)(e);return a=class extends t{static get key(){return"docxBuilder"}constructor(t,i="interface_editor_viewdocxBuilder"){super(i,{}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){return this.AB=e,this.component.init(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}},a}},2363:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713),a=null;function o(e){if(!a){const t=(0,n.default)(e);a=class extends t{static get key(){return"form"}constructor(e,t="interface_editor_viewform"){super(e,t)}ui(){let e=super.ui();return e.rows[0].cellHeight=75,e}init(e){return this.AB=e,super.init(e)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},803:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewgantt",i=(0,n.Z)(e);a=class extends i{static get key(){return"gantt"}constructor(i,n=t){super(n,{label:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,this.component.ignoreLocal=!0,await this.component.init(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}}}return a}},5084:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"grid"}constructor(t,i="interface_editor_viewgrid"){super(i,{label:""}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){return this.AB=e,this.component.ignoreLocal=!0,this.component.init(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}}}return a}},9074:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewkanban",i=(0,n.Z)(e);a=class extends i{static get key(){return"kanban"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.component.ui();return e.minWidth=400,{view:"layout",cols:[e,{fillspace:!0}]}}init(e){this.AB=e,this.component?.init?.(e)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},7895:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewlabel",i=(0,n.Z)(e);a=class extends i{static get key(){return"label"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.ids,t=this.view,i=this.component,n={type:"form",margin:10,padding:10,borderless:!0,rows:[{id:e.component,view:"label",label:t.text||"",align:t.settings.alignment},{}]};return i.uiFormatting(n)}async init(e){this.AB=e,webix.codebase="/js/webix/extras/",await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},4826:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e),i=(...t)=>e.Multilingual.label(...t);a=class extends t{static get key(){return"layout"}constructor(e,t="interface_editor_view_layout"){super(t)}get viewComponent(){const e=this.CurrentView;return e&&!this._component&&(this._component=e.component()),this._component}ui(){const e=this.CurrentView.views(),t=this.viewComponent.ui().rows.find((e=>"layout"===e.view));return t.type="form",e.length?e.forEach(((e,i)=>{const n=e.component().ui();t.cols[i]={rows:[{type:"template",css:"ab-layout-header",height:30,template:this.templateButton({icon:e.icon,label:e.label,warnings:e._warnings}),onClick:{"ab-component-edit":(t,i,n)=>{this.viewEdit(t,e.id,n)},"ab-component-remove":(t,i,n)=>{this.viewDelete(t,e.id,n)}}},n,{}]}})):t.cols[0]={},t}init(e,t){this.AB=e,this.viewComponent.init(e,t),this.viewComponent.onShow?.(),this.CurrentView.views().forEach((i=>{const n=i.component();n.init(e,t),n.onShow?.()}))}detatch(){this.viewComponent?.detatch?.()}templateButton(e){let t="";return(e.warnings||[]).length>0&&(t=this.WARNING_ICON),`<div class="ab-widget-header ab-layout-header">\n               <i class="fa fa-${e.icon} webix_icon_btn"></i> ${e.label}\n               <div class="ab-component-tools">\n               ${t}\n               <i class="fa fa-trash ab-component-remove"></i>\n               <i class="fa fa-edit ab-component-edit"></i>\n               </div></div>`}viewEdit(e,t){const i=this.CurrentView.views((e=>e.id==t))[0];return!!i&&(setTimeout((()=>{try{this.emit("view.edit",i)}catch(e){console.error(e)}}),50),e.preventDefault(),!1)}viewDelete(e,t){const n=this.CurrentView.views((e=>e.id==t))[0];if(!n)return!1;this.AB.Webix.confirm({title:i("Delete component"),text:i("Do you want to delete <b>{0}</b>?",[n.label]),callback:e=>{e&&n.destroy().then((()=>{n.emit("destroyed",n),this.emit("view.destroyed",n)}))}}),e.preventDefault()}}}return a}},6629:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"menu"}constructor(e,t="interface_editor_viewmenu"){super(t),this.view=e,this.component=this.view.component()}ui(){return{type:"space",rows:[this.component.ui(),{}]}}init(e){this.AB=e,this.onShow()}detatch(){this.component?.detatch?.()}onShow(){const e=this.component.ids,t=this.view,i=$$(e.menu);t.ClearPagesInView(i),t?.settings?.order?.length&&t.AddPagesToView(i,t.settings.order),this.component?.onShow?.()}}}return a}},5694:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"pdfImporter"}constructor(e,t="interface_editor_pdfImporter"){super(e,t),this.view=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){this.AB=e,this.component.init(this.AB)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return a}},302:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713),a=null;function o(e){if(!a){const t=(0,n.default)(e);a=class extends t{static get key(){return"page"}}}return a}},5025:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"pivot"}constructor(e,t="interface_editor_viewpivot"){super(t),this.view=e,this.component=this.view.component()}ui(){const e=this.component.ui().rows[0];return e.readonly=!1,e}init(e){this.AB=e,this.component?.init?.();const t=this.ui().id;$$(t).getState().$observe("structure",(e=>{this._saveStructure(e)}))}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}_saveStructure(e){this.view.settings.structure=e,this.view.save()}}}return a}},2279:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285),a=i(5888);let o=null;function s(e){if(!o){const t="interface_editor_viewtab",i=(0,n.Z)(e),s=i.L(),r=(0,a.Z)(e);o=class extends i{static get key(){return"tab"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.ids,t=this.view,i=this.component,n=this.component.ui()?.rows[0];if(n.rows){n.rows[0].id=e.component,n.rows[0].tabbar={height:60,type:"bottom",css:t.settings.darkTheme?"webix_dark":"",on:{onItemClick:(i,n)=>{const a=$$(e.component).getValue(),o=t.views((e=>e.id===a))[0],s=t._views.findIndex((e=>e.id===a));n.target.classList.contains("rename")?t.tabPopup.show(o):n.target.classList.contains("move-back")?(t.viewReorder(a,s-1),t.emit("properties.updated",t)):n.target.classList.contains("move-next")&&(t.viewReorder(a,s+1),t.emit("properties.updated",t))}}};for(let e=0;e<(n.rows[0]?.cells??[]).length;e++){let i=n.rows[0].cells[e];i.header=`<i class="fa fa-caret-left move-back ab-tab-back"></i>${n.rows[0]?.cells[e].header}`;let a=t.views((e=>e.id==i.body.id))[0];(!a||(a.warningsAll()||[]).length>0)&&(i.header+=this.WARNING_ICON),i.header+=' <i class="fa fa-pencil-square rename ab-tab-edit"></i>',i.header+=' <i class="fa fa-caret-right move-next ab-tab-next"></i>'}}else if(n.cols){let a=1,o=0;"right"===t.settings.sidebarPos&&(a=0,o=1),n.cols[a].id=e.component,n.cols[o].on={onItemClick:(e,n)=>{const a=e.replace("_menu",""),o=t.views((e=>e.id==a))[0],s=t._views.findIndex((e=>e.id===a));i.onShow(a),n.target.classList.contains("rename")?t.tabPopup.show(o):n.target.classList.contains("move-back")?(t.viewReorder(a,s-1),t.emit("properties.updated",t)):n.target.classList.contains("move-next")&&(t.viewReorder(a,s+1),t.emit("properties.updated",t))}};for(let e=0;e<(n.cols[o].data??[]).length;e++)n.cols[o].data[e].value=n.cols[o].data[e].value+' <i class="fa fa-pencil rename ab-tab-edit"></i>',n.cols[o].data[e].value+='<i class="fa fa-caret-up move-back ab-tab-up"></i>',n.cols[o].data[e].value+=' <i class="fa fa-caret-down move-next ab-tab-down"></i>'}return{rows:[n]}}async init(e){this.AB=e;const t=this.ids;await this.component.init(this.AB);const i=$$(t.component);if(i){const e=i.getValue(),t=this.view.views((t=>t.id===e))[0];let n="";(!t||(t.warningsAll()||[]).length>0)&&(n=this.WARNING_ICON),"tabview"===i.config.view?webix.ui({container:i.getMultiview().$view,view:"template",autoheight:!1,height:1,width:0,template:['<div class="ab-component-tools ab-layout-view ab-tab-tools">','<i class="fa fa-trash ab-component-remove"></i>','<i class="fa fa-edit ab-component-edit"></i>',n,"</div>"].join(""),onClick:{"ab-component-edit":(e,t,i)=>{this.tabEdit(e,t,i)},"ab-component-remove":(e,t,i)=>{this.tabRemove(e,t,i)}}}):"multiview"===i.config.view&&webix.ui({container:i.$view,view:"template",autoheight:!1,height:1,width:0,template:['<div class="ab-component-tools ab-layout-view ab-tab-tools">',n,'<i class="fa fa-trash ab-component-remove"></i>','<i class="fa fa-edit ab-component-edit"></i>',"</div>"].join(""),onClick:{"ab-component-edit":e=>{this.tabEdit(e)},"ab-component-remove":e=>{this.tabRemove(e)}}})}const n=this.view;n.tabPopup||(n.tabPopup=new r(n),n.tabPopup.init(e))}tabEdit(e){const t=$$(this.ids.component).getValue(),i=this.view.views((e=>e.id==t))[0];return!!i&&(setTimeout((()=>{try{this.emit("view.edit",i)}catch(e){console.error(e)}}),50),e.preventDefault(),!1)}tabRemove(e){const t=this.ids,i=$$(t.component),n=i.getValue(),a=this.view.views((e=>e.id==n))[0];return a&&webix.confirm({title:s("Delete tab"),text:s("Do you want to delete <b>{0}</b>?",[a.label]),callback:e=>{if(e){a.destroy();const e=this.component.ui();if(e.rows)i.removeView(n);else{let t=null;for(let i=0;i<e.cols.length;i++)if("sidebar"===e.cols[i].view){t=$$(e.cols[i].id);break}t.remove(`${n}_menu`)}}}}),e.preventDefault(),!1}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return o}},7912:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t="interface_editor_viewtext",i=(0,n.Z)(e);a=class extends i{static get key(){return"text"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.ids,t=this.view;return{id:e.component,view:"tinymce-editor",value:t.text,config:{plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",init_instance_callback:e=>{e.on("Change",(()=>{this.onChange()}))}}}}async init(e){this.AB=e,webix.codebase="/js/webix/extras/",await this.component.init(this.AB)}onChange(){const e=this.ids,t=this.view;t._onChangeFunction&&(clearTimeout(t._onChangeFunction),t._onChangeFunction=null);const i=$$(e.component);t._onChangeFunction=setTimeout((()=>{t.text=i.getValue(),t.save()}),400)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return a}},3759:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=(0,n.Z)(e);a=class extends t{static get key(){return"_default"}constructor(t,i="interface_editor_viewdefault"){super(i,{label:""}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component(this.AB._App)}ui(){return"function"==typeof this.component.ui?this.component.ui():this.component.ui}init(e){return this.AB=e,this.component.init?.(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}}}return a}},5888:(e,t,i)=>{"use strict";function n(e){const t=(...t)=>e.Multilingual.label(...t);class i extends e.ClassUI{constructor(e){super(`${e.id}_popup`,{popupTabManager:"",popupTabManagerForm:"",popupTabManagerSaveButton:""}),this.view=e}async init(e){this.view.AB=e,this.create()}ui(){const e=this.ids;return{id:e.popupTabManager,view:"window",height:250,width:300,modal:!0,position:"center",head:" ",body:{id:e.popupTabManagerForm,view:"form",elements:[{view:"text",name:"label",label:t("Label"),required:!0},{view:"combo",name:"tabicon",label:t("Icon"),options:{filter:(e,t)=>0===e.value.toString().toLowerCase().indexOf(t.toLowerCase()),body:{data:this.view.AB._App.icons??[],template:"<i class='fa fa-fw fa-#value#'></i> #value#"}}},{cols:[{fillspace:!0},{view:"button",value:t("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.hide()}},{id:e.popupTabManagerSaveButton,view:"button",css:"webix_primary",value:t("Add Tab"),autowidth:!0,type:"form",click:()=>{const t=$$(e.popupTabManagerForm);if(t.validate()){this.busy();const e=t.getValues(),i=()=>{this.ready(),this.hide(),this.emit("saved")};e.id?this.editTab(e).then((()=>i())):this.addTab(e).then((()=>i()))}}}]}]}}}create(){this.view.AB.Webix.ui(this.ui()).hide()}show(e){const i=this.ids,n=$$(i.popupTabManager),a=$$(i.popupTabManagerForm),o=$$(i.popupTabManagerSaveButton);n&&(e?(a.setValues({id:e.id,label:e.label,tabicon:e.tabicon}),n.getHead().setHTML(t("Edit Tab")),o.setValue(t("Save"))):(a.setValues({id:null,label:"",tabicon:""}),n.getHead().setHTML(t("Add Tab")),o.setValue(t("Add"))),o.refresh(),n.show())}hide(){const e=this.ids,t=$$(e.popupTabManager);t&&t.hide()}busy(){const e=this.ids,t=$$(e.popupTabManagerSaveButton);t&&t.disable()}ready(){const e=this.ids,t=$$(e.popupTabManagerSaveButton);t&&t.enable()}addTab(e){return this.view.addTab(e.label??"",e.tabicon??null)}editTab(e){const t=this.view.views((t=>t.id===e.id))[0];if(t)return t.label=e.label,t.tabicon=e.tabicon,t.save()}}return i}i.d(t,{Z:()=>n})},7056:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=null;function a(e){if(!n){var t=[];[i(6063),i(1573),i(9263),i(1134),i(2818),i(2970),i(2250),i(6393),i(727),i(6139),i(7380),i(7341),i(4074),i(3820),i(6771),i(401),i(8546),i(1702),i(8114)].forEach((i=>{t.push(i.default(e))}));var a=[];[i(2607),i(5732),i(7670),i(3412),i(6692),i(6699),i(1051),i(8010),i(2367),i(6277),i(4490),i(7825),i(8866),i(7358),i(9722)].forEach((t=>{a.push(t.default(e))}));var o=[];[i(814),i(7887),i(7661),i(2225),i(992),i(3875),i(4158),i(4856),i(3156),i(1712),i(231),i(5786),i(3300),i(1377),i(9270),i(3381),i(8568),i(7420),i(1023),i(7901),i(6309),i(3257),i(3020),i(2480),i(2318),i(1722),i(35),i(5670),i(6378),i(7754),i(9720),i(2651),i(9975),i(5177),i(4973),i(5281),i(5711),i(4247),i(1163),i(8450),i(6598),i(9630),i(3348),i(1832),i(7375),i(4333),i(6234),i(7669)].forEach((t=>{o.push(t.default(e))})),n={fields:function(e=(()=>!0)){return t.filter(e)},processElements:function(e=(()=>!0)){return a.filter(e)},views:function(e=(()=>!0)){return o.filter(e)}}}return n}},917:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285);let a=null;function o(e){if(!a){const t=e.Config.uiSettings(),i=(0,n.Z)(e),o=i.L();a=class extends i{constructor(t="properties_abfield",i={}){const n={label:"",columnName:"",fieldDescription:"",showIcon:"",required:"",numberOfNull:"",unique:"",filterComplex:"",addValidation:"",shorthand:"",validationRules:"",buttonCog:"",editFieldName:"",editFieldNameForm:"",editFieldNameFormDatabaseColumn:"",filterView:"",uniqueView:""};Object.keys(i).forEach((e=>{void 0===n[e]?n[e]="":console.error(`!!! ABFieldProperty:: passed in ids contains a restricted field : ${e}`)})),super(t,n),this.base=t,this.AB=e}ui(e=[]){const t=this.ids,n=this.FieldClass(),a={view:"form",id:t.component,borderless:!0,autowidth:!0,elements:[{cols:[{view:"label",label:o("Field Name:"),align:"left",width:87},{name:"label",id:t.label,view:"text",placeholder:o("Database field name"),fillspace:!0,on:{onChange:e=>{this.textFieldName(e)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"text",id:t.columnName,name:"columnName",hidden:!0,on:{onAfterRender(){i.CYPRESS_REF(this)}}},{view:"button",id:t.buttonCog,css:"webix_transparent",label:'<span class="webix_icon_btn" style="margin: 0px;"><i class="nomargin fa fa-cog"></i></span>',width:40,on:{onItemClick:()=>{this.buttonCog()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:o("Show icon:"),align:"left",width:75},{view:"switch",id:t.showIcon,name:"showIcon",value:1,width:55,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:20},{view:"label",label:o("Required:"),align:"left",width:66},{view:"switch",id:t.required,name:"required",disabled:!n.defaults().supportRequire,value:0,width:55,on:{onChange:(e,i)=>{this.requiredOnChange(e,i,t),this.getNumberOfNullValue(e)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:20},{view:"label",id:t.numberOfNull,css:{color:"#f00"},label:"",hidden:!0,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"label",label:o("Unique:"),align:"left",width:59},{view:"switch",id:t.unique,name:"unique",disabled:!n.defaults().supportUnique,disallowEdit:!0,value:0,width:55,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:20},{id:t.addValidation,view:"button",label:o("Add Field Validation"),css:"webix_primary",popup:t.filterView,on:{onItemClick:()=>{$$(t.filterView).adjust()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{id:t.validationRules,view:"text",hidden:!0,name:"validationRules",on:{onAfterRender(){i.CYPRESS_REF(this)}}},{cols:[{view:"label",label:o("Custom Settings:"),align:"left",width:200},{},{view:"label",id:t.fieldDescription,label:o("Description"),align:"right",on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{id:t.uniqueView,view:"scrollview",borderless:!0,scroll:"y",css:{background:"#ddd"},body:{padding:{top:25,bottom:25,left:25,right:25},rows:e.map((e=>(!e.id&&e.name&&(this.ids[e.name]||(this.ids[e.name]=`${this.base}_${e.name}`),e.id=this.ids[e.name]),e)))}}],rules:{label:webix.rules.isNotEmpty,columnName:webix.rules.isNotEmpty}};return webix.ui({view:"window",id:t.editFieldName,modal:!0,hidden:!0,position:"center",width:450,height:250,head:{view:"toolbar",css:"webix_dark",paddingX:2,elements:[{view:"label",align:"center",label:o("Edit field name")}]},body:{view:"form",id:t.editFieldNameForm,elements:[{cols:[{view:"label",label:o("Database Column:"),align:"right",width:125},{view:"text",id:t.editFieldNameFormDatabaseColumn,name:"columnName",placeholder:o("Database Column"),on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:30}]},{cols:[{},{view:"button",value:o("Cancel"),css:"webix_danger",width:100,on:{onItemClick:()=>{this.buttonEditFieldNameButtonCancel()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"button",value:o("Submit"),css:"webix_primary",width:100,on:{onItemClick:()=>{this.buttonEditFieldNameButtonSubmit()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:30}]}]}}),webix.ui({id:t.filterView,view:"popup",resize:!0,height:503,width:692,position:"center",body:{rows:[{view:"toolbar",css:"webix_dark",paddingX:0,elements:[{view:"label",align:"center",label:o("Field Validation")},{view:"button",label:'<span class="webix_icon"><i class="nomargin fa fa-times"></i></span>',css:"webix_transparent",width:40,click:()=>{$$(t.filterView).hide()},on:{onAfterRender:()=>{i.CYPRESS_REF(this)}}}]},{cols:[{view:"button",label:o("Add"),css:"webix_secondary",on:{onItemClick:()=>{this.addValidation()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"button",label:o("Delete All"),css:"webix_danger",on:{onItemClick:()=>{this.filterViewDeleteAllValidation()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"scrollview",scroll:"y",body:{id:t.filterComplex,rows:[]}}]},on:{onViewResize:()=>{$$(t.filterView).show()}}}),a}async init(e){this.AB=e;const t=this.FieldClass();t?$$(this.ids.fieldDescription).define("label","*"+o(t.defaults().description)):$$(this.ids.fieldDescription).hide()}textFieldName(e){const t=this.formValues();this.modeEdit?t.label=e:(t.label=e,t.columnName=t.label),$$(this.ids.component).setValues(t)}buttonCog(){if(this.isValid()){const e=this.formValues();$$(this.ids.editFieldNameForm).setValues({columnName:e.columnName}),this.modeEdit?$$(this.ids.editFieldNameFormDatabaseColumn).disable():$$(this.ids.editFieldNameFormDatabaseColumn).enable(),$$(this.ids.editFieldName).show()}}buttonEditFieldNameButtonCancel(){const e=$$(this.ids.component).getValues();$$(this.ids.editFieldNameForm).setValues({columnName:e.columnName}),$$(this.ids.editFieldName).hide()}buttonEditFieldNameButtonSubmit(){const e=this.formValues(),t=$$(this.ids.editFieldNameForm).getValues().columnName;e.columnName=""!==t?t:e.columnName,$$(this.ids.component).setValues(e),$$(this.ids.editFieldName).hide()}addValidation(e){const n=this.ids,a=new this.AB.Class.FilterComplex(this.AB._App,"field_validation_rules",this.AB);$$(n.filterComplex).addView({view:"form",css:"abValidationForm",cols:[{rows:[{view:"text",name:"invalidMessage",labelWidth:t.labelWidthLarge,value:e?.invalidMessage?e.invalidMessage:"",label:o("Invalid Message")},a.ui]},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const e=this.getParentView();$$(n.filterComplex).removeView(e);const t=$$(n.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");$$(n.addValidation).define("badge",0!==t.length?t.length:null),$$(n.addValidation).refresh()},on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]}),this.resetDefaultValidation(),$$(a.ids.save).hide(),a.fieldsLoad(this.CurrentObject.fields()),e&&e.rules&&a.setValue(e.rules)}filterViewDeleteAllValidation(){const e=this.ids,t=$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");t.length&&t.forEach((t=>{$$(e.filterComplex).removeView(t)})),this.resetDefaultValidation()}clearEditor(){console.error("!!! Depreciated! call clear() instead."),this.clear()}clear(){const e=this.ids;this._CurrentField=null;const t=this.defaultValues();for(const i in t){const n=$$(e[i]);n&&n.setValue(t[i])}this.filterViewDeleteAllValidation(),$$(e.numberOfNull).hide()}clearInvalid(e){$$(this.ids.component).markInvalid(e,!1)}resetDefaultValidation(){const e=this.ids,t=$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");$$(e.addValidation).define("badge",0!==t.length?t.length:null),$$(e.addValidation).refresh()}defaults(){const e=this.FieldClass();return e?e.defaults():(console.error("!!! ABFieldStringProperty: could not find FieldClass[]"),null)}defaultValues(){const e={label:"",columnName:"",showIcon:1,required:0,unique:0,validationRules:""},t=this.FieldClass();if(t){const i=t.defaultValues();Object.keys(i).forEach((t=>{void 0===e[t]&&(e[t]=i[t])}))}return e}eachDeep(e,t){e.forEach((e=>{e.cols?this.eachDeep(e.cols,t):e.body?.cols?this.eachDeep(e.body.cols,t):e.rows?this.eachDeep(e.rows,t):e.body?.rows?this.eachDeep(e.body.rows,t):t(e)}))}editorPopulate(e){console.error("!!! Depreciated. call populate() instead."),this.populate(e)}FieldClass(){return console.error("!!! Child Class has not overwritten FieldClass()"),null}_FieldClass(e){return this.AB.Class.ABFieldManager.fieldByKey(e)}formValues(){return $$(this.ids.component).getValues()}async getNumberOfNullValue(e){const t=this.ids;if(e&&this._CurrentField&&this._CurrentField.id&&this._CurrentField.settings.required!=e)try{const e=await this._CurrentField.object.model().count({where:{glue:"and",rules:[{key:this._CurrentField.id,rule:"is_null"}]}});e.count>0?($$(t.numberOfNull).setValue(o("** There are {0} rows that will be updated to default value",[e.count])),$$(t.numberOfNull).show()):$$(t.numberOfNull).hide()}catch(e){}else $$(t.numberOfNull).hide()}isValid(){const e=this.ids;let t=$$(e.component).validate(),i=this.formValues().columnName;const n=this.FieldClass();n||this.AB.notify.developer(new Error("Unable to resolve FieldClass"),{context:"ABFieldProperty: isValid()",base:this.ids.component}),n?.reservedNames.indexOf(i.trim().toLowerCase())>-1&&(this.markInvalid("columnName",o("This is a reserved name")),t=!1);let a=this.CurrentObject?.fields((e=>e.columnName==i));return this._CurrentField&&(a=a.filter((e=>e.id!=this._CurrentField.id))),a.length>0&&(this.markInvalid("columnName",o("This column name is in use by another field ({0})",[a.label])),t=!1),t}markInvalid(e,t){$$(this.ids.component).markInvalid(e,t)}populate(e){const t=this.ids;if(this._CurrentField=e,["label","columnName"].forEach((i=>{$$(t[i]).setValue?.(e[i])})),$$(t.fieldDescription).setValue(e.fieldDescription()),Object.keys(t).forEach((i=>{void 0!==e.settings[i]&&$$(t[i])?.setValue?.(e.settings[i])})),$$(t.label).setValue(e.label),$$(t.columnName).setValue(e.columnName),$$(t.showIcon).setValue(e.settings.showIcon),$$(t.required).setValue(e.settings.required),$$(t.unique).setValue(e.settings.unique),e.settings&&e.settings.validationRules){let i=e.settings.validationRules;if("string"==typeof i)try{i=JSON.parse(i)}catch(t){this.AB.notify.builder(t,{context:`ABField[${e.id}][${e.name}]: has invalid validationRules`,validationRules:e.settings.validationRules}),i=[]}(i||[]).forEach((i=>{e.addValidation(t,i)})),$$(t.addValidation).define("badge",0!==i.length?i.length:null),$$(t.addValidation).refresh()}}requiredOnChange(){}values(){const e=this.ids,t=$$(e.component).getValues();if($$(e.filterComplex)){const i=[];$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all").forEach((e=>{const t=e.queryView({view:"querybuilder"}).getValue(),n={invalidMessage:e.queryView({name:"invalidMessage"}).getValue(),rules:t};i.push(n)})),t.validationRules=JSON.stringify(i)}const i=this.FieldClass(),n=i.editorValues(t);return n.key=i.defaults().key,n}}}return a}},6063:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_autoindex`,{prefix:"",delimiter:"",displayLength:"",previewText:""})}ui(){const e=this.ids,n=this.FieldClass();return super.ui([{cols:[{view:"label",label:i("Prefix:"),align:"right",width:75},{id:e.prefix,view:"text",name:"prefix",placeholder:i("Prefix"),on:{onTimedKeyPress:()=>{this.previewChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Delimiter:"),align:"right",width:75},{id:e.delimiter,view:"richselect",name:"delimiter",value:"none",options:n.delimiterList(),on:{onChange:()=>{this.previewChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Length:"),align:"right",width:75},{id:e.displayLength,view:"counter",name:"displayLength",step:1,value:4,min:1,max:10,width:104,on:{onChange:()=>{this.previewChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Preview:"),align:"right",width:75},{id:e.previewText,view:"text",name:"previewText",value:"0000",disabled:!0,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}])}previewChange(){const e=this.ids,t=this.FieldClass().setValueToIndex($$(e.prefix).getValue(),$$(e.delimiter).getValue(),$$(e.displayLength).getValue(),0);$$(e.previewText).setValue(t)}FieldClass(){return super._FieldClass("AutoIndex")}populate(e){super.populate(e),this.previewChange()}}}},1573:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_boolean`,{checkBoxLabel:"",default:""})}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Default:"),align:"right",width:65},{id:e.default,name:"default",view:"checkbox",css:"webix_table_checkbox",width:30,on:{onChange:t=>{let n=i("Check"),a=i("Uncheck");$$(e.checkBoxLabel).setValue(t?n:a)},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.checkBoxLabel,view:"label",label:i("Uncheck"),width:60}]}])}FieldClass(){return super._FieldClass("boolean")}}}},9263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_calculate`,{formula:"",fieldPopup:"",fieldList:"",numberOperatorPopup:"",numberOperatorPopupList:"",dateOperatorPopup:"",dateFieldList:"",decimalSign:"",decimalPlaces:""})}ui(){const e=this.ids,n=[{id:"none",value:i("None")},{id:"comma",value:i("Comma"),sign:","},{id:"period",value:i("Period"),sign:"."},{id:"space",value:i("Space"),sign:" "}];return webix.ui({id:e.fieldPopup,view:"popup",hidden:!0,width:200,body:{id:e.fieldList,view:"list",data:[],template:this.itemTemplate,on:{onItemClick:t=>{const i="{"+$$(e.fieldList).getItem(t).columnName+"}";this.insertEquation(i),$$(e.fieldPopup).hide()},onAfterRender:function(){t.CYPRESS_REF(this)}}},on:{onBeforeShow:()=>{$$(e.fieldList).clearAll(),$$(e.fieldList).parse(this.getNumberFields())}}}),webix.ui({id:e.numberOperatorPopup,view:"popup",hidden:!0,width:200,body:{id:e.numberOperatorPopupList,view:"list",template:this.itemTemplate,data:[{label:i("+ Adds"),symbol:"+"},{label:i("- Subtracts"),symbol:"-"},{label:i("* Multiples"),symbol:"*"},{label:i("/ Divides"),symbol:"/"},{label:i("( Open Bracket"),symbol:"("},{label:i(") Closed Bracket"),symbol:")"}],on:{onItemClick:t=>{const i=$$(e.numberOperatorPopupList).getItem(t);this.insertEquation(i.symbol),$$(e.numberOperatorPopup).hide()},onAfterRender:function(){t.CYPRESS_REF(this)}}}}),webix.ui({id:e.dateOperatorPopup,view:"popup",hidden:!0,width:280,data:[],body:{id:e.dateFieldList,view:"list",template:this.itemTemplate,data:[],on:{onItemClick:t=>{const i=$$(e.dateFieldList).getItem(t);this.insertEquation(i.function),$$(e.dateOperatorPopup).hide()},onAfterRender:function(){t.CYPRESS_REF(this)}}},on:{onBeforeShow:()=>{$$(e.dateFieldList).clearAll(),$$(e.dateFieldList).parse(this.getDateFields())}}}),super.ui([{rows:[{cols:[{view:"label",label:i("Equation:"),align:"left",width:75},{}]},{id:e.formula,name:"formula",view:"textarea",height:100,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{rows:[{cols:[{view:"button",type:"icon",css:"webix_primary",icon:"fa fa-hashtag",label:i("Number Fields"),width:185,click:function(){$$(e.fieldPopup).show(this.$view)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"button",type:"icon",css:"webix_primary",icon:"fa fa-calendar",label:i("Date Fields"),click:function(){$$(e.dateOperatorPopup).show(this.$view)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-hashtag",label:i("Number Operators"),width:185,click:function(){$$(e.numberOperatorPopup).show(this.$view)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{}]},{cols:[{view:"label",label:i("Decimals:"),align:"right",width:67},{id:e.decimalSign,view:"richselect",name:"decimalSign",value:"none",options:n,on:{onChange:t=>{"none"==t?$$(e.decimalPlaces).disable():$$(e.decimalPlaces).enable()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"label",label:i("Places:"),align:"right",width:67},{id:e.decimalPlaces,view:"counter",name:"decimalPlaces",step:1,value:1,min:1,max:10,disabled:!0,width:104,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]}])}getNumberFields(){return this.CurrentObject?this.CurrentObject.fields((e=>"number"==e.key||"calculate"==e.key||"formula"==e.key)):[]}getDateFields(){if(this.CurrentObject){const e=[];return e.push({label:i("Convert minutes to hours (Format: hours.minutes)"),function:"MINUTE_TO_HOUR()"}),e.push({label:i("Year of [{0}]",["Current"]),function:"YEAR(CURRENT)"}),e.push({label:i("Month of [{0}]",["Current"]),function:"MONTH(CURRENT)"}),e.push({label:i("Day of [{0}]",["Current"]),function:"DAY(CURRENT)"}),e.push({label:i("Get days of [{0}] (since January 1, 1970)",["Current"]),function:"DATE(CURRENT)"}),e.push({label:i("Get hours of [{0}] (since January 1, 1970)",["Current"]),function:"HOUR(CURRENT)"}),e.push({label:i("Get minutes of [{0}] (since January 1, 1970)",["Current"]),function:"MINUTE(CURRENT)"}),this.CurrentObject.fields((e=>"date"==e.key)).forEach((t=>{e.push({label:i("Calculate age from [{0}]",[t.label]),function:`AGE({${t.columnName}})`}),e.push({label:i("Year of [{0}]",[t.label]),function:`YEAR({${t.columnName}})`}),e.push({label:i("Month of [{0}]",[t.label]),function:`MONTH({${t.columnName}})`}),e.push({label:i("Day of [{0}]",[t.label]),function:`DAY({${t.columnName}})`}),e.push({label:i("Get days of [${0}] (since January 1, 1970)",[t.label]),function:`DATE({${t.columnName}})`}),e.push({label:i("Get hours of [${0}] (since January 1, 1970)",[t.label]),function:`HOUR({${t.columnName}})`}),e.push({label:i("Get minutes of [${0}] (since January 1, 1970)",[t.label]),function:`MINUTE({${t.columnName}})`})})),e}return[]}itemTemplate(e){let t="";return e.icon&&(t+=`<i class="fa fa-${e.icon}" aria-hidden="true"></i> `),e.label&&(t+=e.label),t}insertEquation(e){const t=this.ids,i=$$(t.formula).getValue();$$(t.formula).setValue(i+e)}FieldClass(){return super._FieldClass("calculate")}isValid(){const e=this.ids,t=this.FieldClass();let i=super.isValid();if(i){$$(e.component).markInvalid("formula",!1);const n=$$(e.formula).getValue();try{t.convertToJs(this.CurrentObject,n,{}),i=!0}catch(t){$$(e.component).markInvalid("formula",""),i=!1}}return i}}}},1134:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_combine`,{combinedFields:"",delimiter:""})}ui(){const e=this.ids,n=this.FieldClass();return super.ui([{cols:[{view:"label",label:a("Combined Fields:"),align:"right",width:125},{id:e.combinedFields,name:"combinedFields",view:"multicombo",labelWidth:t.labelWidthXLarge,disallowEdit:!0,options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:a("Delimiter:"),align:"right",width:125},{id:e.delimiter,view:"richselect",name:"delimiter",value:n.defaultValues().delimiter,labelWidth:t.labelWidthXLarge,disallowEdit:!0,options:[{id:"plus",value:a("Plus ( + )")},{id:"dash",value:a("Dash ( - )")},{id:"period",value:a("Period ( . )")},{id:"space",value:a("Space ( )")}],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]}])}FieldClass(){return super._FieldClass("combined")}show(){const e=this.ids,t=this.CurrentObject.fields((e=>["string","LongText","number","date","datetime","boolean","list","email","user","AutoIndex","combined"].indexOf(e.key)>-1||e.isConnection&&("one"==e.settings.linkType&&"many"==e.settings.linkViaType||"one"==e.settings.linkType&&"one"==e.settings.linkViaType&&e.settings.isSource))).map((e=>({id:e.id,value:e.label})));super.show();const i=$$(e.combinedFields);i&&(i.define("options",t),i.refresh())}}}},2818:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_connect`,{linkObject:"",objectCreateNew:"",fieldLink:"",fieldLink2:"",linkType:"",linkViaType:"",fieldLinkVia:"",fieldLinkVia2:"",link1:"",link2:"",isCustomFK:"",indexField:"",indexField2:"",connectDataPopup:""})}ui(){const e=this.FieldClass(),n=this.ids;return super.ui([{cols:[{view:"label",label:a("Connected to:"),align:"right",width:94},{id:n.linkObject,view:"richselect",disallowEdit:!0,name:"linkObject",labelWidth:t.labelWidthLarge,placeholder:a("Select object"),options:[],on:{onChange:(e,t)=>{this.selectObjectTo(e,t)},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"layout",id:n.link1,hidden:!0,cols:[{id:n.fieldLink,view:"label",width:300},{id:n.linkType,disallowEdit:!0,name:"linkType",view:"richselect",value:e.defaultValues().linkType,width:95,options:[{id:"many",value:a("many")},{id:"one",value:a("one")}],on:{onChange:(e,t)=>{this.selectLinkType(e,t)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.fieldLinkVia,view:"label",label:a("<b>[Select Object]</b> entry."),width:200}]},{view:"layout",id:n.link2,hidden:!0,cols:[{id:n.fieldLinkVia2,view:"label",label:a("Each <b>[Select object]</b> entry connects with"),width:300},{id:n.linkViaType,name:"linkViaType",disallowEdit:!0,view:"richselect",value:e.defaultValues().linkViaType,width:95,options:[{id:"many",value:a("many")},{id:"one",value:a("one")}],on:{onChange:(e,t)=>{this.selectLinkViaType(e,t)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.fieldLink2,view:"label",width:200}]},{name:"linkColumn",view:"text",hidden:!0},{name:"isSource",view:"text",hidden:!0},{id:n.isCustomFK,name:"isCustomFK",view:"checkbox",disallowEdit:!0,labelWidth:0,labelRight:a("Custom Foreign Key"),hidden:!0,on:{onChange:()=>{this.checkCustomFK()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.indexField,name:"indexField",view:"richselect",disallowEdit:!0,hidden:!0,labelWidth:t.labelWidthLarge,label:a("Index Field:"),placeholder:a("Select index field"),options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.indexField2,name:"indexField2",view:"richselect",disallowEdit:!0,hidden:!0,labelWidth:t.labelWidthLarge,label:a("Index Field:"),placeholder:a("Select index field"),options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}])}clear(){super.clear(),$$(this.ids.linkObject).setValue(this.FieldClass().defaultValues().linkObject)}FieldClass(){return super._FieldClass("connectObject")}isValid(){const e=this.ids;let t=super.isValid();return $$(e.linkObject).getValue()?this.clearInvalid("linkObject"):(this.markInvalid("linkObject",a("Select an object")),t=!1),t}selectLinkViaType(e){let t=a("entry"),i=a("entries"),n=$$(this.ids.fieldLink2),o=n.getValue()||"";o="many"==e?o.replace(t,i):o.replace(i,t),n.define("label",o),n.refresh(),this.updateCustomIndex()}show(){super.show(),this.populateSelect(!1);const e=this.ids;$$(e.fieldLink).setValue(a("Each <b>{0}</b> entry connects with",[this.CurrentObject?.label])),$$(e.fieldLink2).setValue(a("<b>{0}</b> entry.",[this.CurrentObject?.label])),this.updateCustomIndex()}checkCustomFK(){const e=this.ids;if($$(e.indexField).hide(),$$(e.indexField2).hide(),$$(e.isCustomFK).getValue()){let t=$$(e.indexField).getList().config.data;t&&t.length&&$$(e.indexField).show();let i=$$(e.indexField2).getList().config.data;i&&i.length&&$$(e.indexField2).show()}}populateSelect(){const e=[],t=this.CurrentApplication;t?t.objectsIncluded().forEach((t=>{e.push({id:t.id,value:t.label})})):this.AB.objects().forEach((t=>{e.push({id:t.id,value:t.label})})),e.sort(((e,t)=>e.value<t.value?-1:e.value>t.value?1:0));const i=this.ids,n=$$(i.linkObject);n.define("options",e),n.refresh()}selectLinkType(e){let t=a("entry"),i=a("entries"),n=$$(this.ids.fieldLinkVia),o=n.getValue()||"";o="many"==e?o.replace(t,i):o.replace(i,t),n.define("label",o),n.refresh(),this.updateCustomIndex()}selectObjectTo(e,t){const i=this.ids;if(e||($$(i.link1).hide(),$$(i.link2).hide()),e==t||""==e)return;let n=$$(i.linkObject).getList().getItem(e);if(!n)return;let o=n.value;$$(i.fieldLinkVia).setValue(a("<b>{0}</b> entry.",[o])),$$(i.fieldLinkVia2).setValue(a("Each <b>{0}</b> entry connects with",[o])),$$(i.link1).show(),$$(i.link2).show(),this.updateCustomIndex()}updateCustomIndex(){const e=this.ids;let t=$$(e.linkObject).getValue(),i=$$(e.linkType).getValue(),n=$$(e.linkViaType).getValue(),a=null,o=null;$$(e.indexField2).define("options",[]),$$(e.indexField2).refresh();let s=`${i}:${n}`;if(["one:one","one:many"].indexOf(s)>-1)a=this.AB.objectByID(t);else if("many:one"==s)a=this.CurrentObject;else if("many:many"==s){a=this.CurrentObject;let i=this.AB.objectByID(t),n=[];o=i.indexes((e=>e.unique)),(o||[]).forEach((e=>{(e.fields||[]).forEach((e=>{(e&&e.settings&&e.settings.required&&!n.filter((t=>t.id==e.id)).length||"AutoIndex"==e.key||"combined"==e.key)&&n.push({id:e.id,value:e.label})}))})),$$(e.indexField2).define("options",n),$$(e.indexField2).refresh()}if($$(e.indexField).hide(),$$(e.indexField2).hide(),!a)return void $$(e.isCustomFK).hide();let r=a.indexes((e=>e.unique));if((!r||r.length<1)&&(!o||o.length<1))return $$(e.isCustomFK).hide(),$$(e.indexField).define("options",[]),void $$(e.indexField).refresh();let l=[];(r||[]).forEach((e=>{(e.fields||[]).forEach((e=>{(e&&e.settings&&e.settings.required&&!l.filter((t=>t.id==e.id)).length||"AutoIndex"==e.key||"combined"==e.key)&&l.push({id:e.id,value:e.label,field:e})}))})),$$(e.indexField).define("options",l),$$(e.indexField).refresh(),l&&l.length&&$$(e.isCustomFK).show(),this.checkCustomFK()}}}},2970:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_date`,{default:"",currentToDefault:"",dateDisplay:"",dateFormat:"",defaultDate:"",defaultDateValue:"",validateCondition:"",validateRange:"",validateRangeUnit:"",validateRangeBefore:"",validateRangeAfter:"",validateRangeBeforeLabel:"",validateRangeAfterLabel:"",validateStartDateContainer:"",validateStartDateContainerLabel:"",validateEndDateContainer:""})}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Date Format:"),align:"right",width:88},{view:"richselect",name:"dateFormat",id:e.dateFormat,value:2,options:[{id:2,value:"dd/mm/yyyy"},{id:3,value:"mm/dd/yyyy"},{id:4,value:"M D, yyyy"},{id:5,value:"D M, yyyy"}],on:{onChange:()=>{this.refreshDateValue()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default:"),align:"right",width:88},{view:"richselect",name:"defaultDate",id:e.defaultDate,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Date")},{id:3,value:i("Specific Date")}],on:{onChange:()=>{this.defaultDateChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultDateValue",id:e.defaultDateValue,gravity:.5,disabled:!0,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:i("Validation criteria:"),width:123,css:"ab-text-bold"},{cols:[{view:"label",label:i("Condition:"),align:"right",width:88,css:"ab-text-bold"},{id:e.validateCondition,view:"select",name:"validateCondition",value:"none",options:[{id:"none",value:i("None")},{id:"dateRange",value:i("Range")},{id:"between",value:i("Between")},{id:"notBetween",value:i("Not between")},{id:"=",value:i("Equal to")},{id:"<>",value:i("Not equal to")},{id:">",value:i("Greater than")},{id:"<",value:i("Less than")},{id:">=",value:i("Greater than or Equal to")},{id:"<=",value:i("Less than or Equal to")}],on:{onChange:t=>{switch(t){case"none":$$(e.validateRange).hide(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"dateRange":$$(e.validateRange).show(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"between":case"notBetween":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Start Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).show();break;case"=":case"<>":case">":case"<":case">=":case"<=":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).hide()}},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateRange,hidden:!0,rows:[{cols:[{view:"label",label:i("Unit:"),align:"right",width:88},{id:e.validateRangeUnit,view:"select",name:"validateRangeUnit",options:[{id:"days",value:i("Days")},{id:"months",value:i("Months")},{id:"years",value:i("Years")}],on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh(),$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{id:e.validateRangeBeforeLabel,view:"template",align:"left",width:140,borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("Before")} ${$$(e.validateRangeBefore).getValue()} ${n.value}`}},{view:"label",label:"",align:"center",width:1},{id:e.validateRangeAfterLabel,view:"template",align:"right",borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("After")} ${$$(e.validateRangeAfter).getValue()} ${n.value}`}}]},{cols:[{id:e.validateRangeBefore,view:"slider",name:"validateRangeBefore",on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.validateRangeAfter,view:"slider",name:"validateRangeAfter",on:{onChange:()=>{$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]},{id:e.validateStartDateContainer,hidden:!0,cols:[{id:e.validateStartDateContainerLabel,view:"label",label:i("Start Date:"),align:"right",width:88},{name:"validateStartDate",view:"datepicker",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateEndDateContainer,hidden:!0,cols:[{view:"label",label:i("End Date:"),align:"right",width:88},{name:"validateEndDate",view:"datepicker",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}])}defaultDateChange(){const e=this.ids,t=$$(e.defaultDate).getValue();switch(parseInt(t)){case 1:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue();break;case 2:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue(new Date),this.refreshDateValue();break;case 3:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue();break;default:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue(new Date)}}refreshDateValue(){const e=this.ids,t=$$(e.dateFormat).getValue();let i="";switch(parseInt(t)){case 2:default:i="%d/%m/%Y";break;case 3:i="%m/%d/%Y";break;case 4:i="%M %d, %Y";break;case 5:i="%d %M, %Y"}$$(e.defaultDateValue).define("format",i),$$(e.defaultDateValue).refresh()}defaultTimeChange(){const e=this.ids;switch(console.log("defaultTimeChange"),parseInt($$(e.defaultTime).getValue())){case 1:default:$$(e.defaultTimeValue).disable(),$$(e.defaultTimeValue).setValue();break;case 2:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue(new Date);break;case 3:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue()}}FieldClass(){return super._FieldClass("date")}populate(e){const t=this.ids;super.populate(e),$$(t.defaultDateValue).setValue(new Date(e.settings.defaultDateValue))}show(){this.refreshDateValue(),super.show()}}}},2250:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_datetime`,{default:"",currentToDefault:"",dateDisplay:"",dateFormat:"",defaultDate:"",defaultDateValue:"",timeFormat:"",defaultTime:"",defaultTimeValue:"",validateCondition:"",validateRange:"",validateRangeUnit:"",validateRangeBefore:"",validateRangeAfter:"",validateRangeBeforeLabel:"",validateRangeAfterLabel:"",validateStartDateContainer:"",validateStartDateContainerLabel:"",validateEndDateContainer:""})}ui(){const e=this.ids;return super.ui([{view:"label",label:i("Date:"),align:"left"},{cols:[{view:"label",label:i("Format:"),align:"right",width:88},{id:e.dateFormat,view:"richselect",name:"dateFormat",value:1,options:[{id:1,value:i("Ignore Date")},{id:2,value:"dd/mm/yyyy"},{id:3,value:"mm/dd/yyyy"},{id:4,value:"M D, yyyy"},{id:5,value:"D M, yyyy"}],on:{onChange:()=>{this.refreshDateValue()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default:"),align:"right",width:88},{view:"richselect",name:"defaultDate",id:e.defaultDate,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Date")},{id:3,value:i("Specific Date")}],on:{onChange:()=>{this.defaultDateChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultDateValue",id:e.defaultDateValue,gravity:.5,disabled:!0,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:i("Validation criteria:"),width:123,css:"ab-text-bold"},{cols:[{view:"label",label:i("Condition:"),align:"right",width:88,css:"ab-text-bold"},{id:e.validateCondition,view:"select",name:"validateCondition",value:"none",options:[{id:"none",value:i("None")},{id:"dateRange",value:i("Range")},{id:"between",value:i("Between")},{id:"notBetween",value:i("Not between")},{id:"=",value:i("Equal to")},{id:"<>",value:i("Not equal to")},{id:">",value:i("Greater than")},{id:"<",value:i("Less than")},{id:">=",value:i("Greater than or Equal to")},{id:"<=",value:i("Less than or Equal to")}],on:{onChange:t=>{switch(t){case"none":$$(e.validateRange).hide(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"dateRange":$$(e.validateRange).show(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"between":case"notBetween":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Start Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).show();break;case"=":case"<>":case">":case"<":case">=":case"<=":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).hide()}},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateRange,hidden:!0,rows:[{cols:[{view:"label",label:i("Unit:"),align:"right",width:88},{id:e.validateRangeUnit,view:"select",name:"validateRangeUnit",options:[{id:"days",value:i("Days")},{id:"months",value:i("Months")},{id:"years",value:i("Years")}],on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh(),$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{id:e.validateRangeBeforeLabel,view:"template",align:"left",width:140,borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("Before")} ${$$(e.validateRangeBefore).getValue()} ${n.value}`}},{view:"label",label:"",align:"center",width:1},{id:e.validateRangeAfterLabel,view:"template",align:"right",borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("After")} ${$$(e.validateRangeAfter).getValue()} ${n.value}`}}]},{cols:[{id:e.validateRangeBefore,view:"slider",name:"validateRangeBefore",on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.validateRangeAfter,view:"slider",name:"validateRangeAfter",on:{onChange:()=>{$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]},{id:e.validateStartDateContainer,hidden:!0,cols:[{id:e.validateStartDateContainerLabel,view:"label",label:i("Start Date:"),align:"right",width:88},{name:"validateStartDate",view:"datepicker",om:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateEndDateContainer,hidden:!0,cols:[{view:"label",label:i("End Date:"),align:"right",width:88},{name:"validateEndDate",view:"datepicker",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:i("Time:"),align:"left"},{cols:[{view:"label",label:i("Format:"),align:"right",width:88},{view:"richselect",name:"timeFormat",id:e.timeFormat,value:2,options:[{id:2,value:i("HH:MM AM/PM")},{id:3,value:i("HH:MM (military)")}],on:{onChange:()=>{this.refreshTimevalue()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default Time:"),align:"right",width:88},{view:"richselect",name:"defaultTime",id:e.defaultTime,labelWidth:110,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Time")},{id:3,value:i("Specific Time")}],on:{onChange:()=>{this.defaultTimeChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultTimeValue",type:"time",id:e.defaultTimeValue,gravity:.5,disabled:!0,onAfterRender:function(){t.CYPRESS_REF(this)}}]}])}defaultDateChange(){const e=this.ids,t=$$(e.defaultDate).getValue();switch(parseInt(t)){case 1:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue();break;case 2:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue(new Date),this.refreshDateValue();break;case 3:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue();break;default:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue(new Date)}}refreshDateValue(){const e=this.ids,t=$$(e.dateFormat).getValue();let i="";switch(parseInt(t)){case 2:default:i="%d/%m/%Y";break;case 3:i="%m/%d/%Y";break;case 4:i="%M %d, %Y";break;case 5:i="%d %M, %Y"}$$(e.defaultDateValue).define("format",i),$$(e.defaultDateValue).refresh()}defaultTimeChange(){const e=this.ids;switch(parseInt($$(e.defaultTime).getValue())){case 1:default:$$(e.defaultTimeValue).disable(),$$(e.defaultTimeValue).setValue();break;case 2:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue(new Date);break;case 3:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue()}this.refreshTimevalue()}refreshTimevalue(){const e=this.ids;let t="";switch(parseInt($$(e.timeFormat).getValue())){case 2:default:t="%h:%i %A";break;case 3:t="%H:%i"}$$(e.defaultTimeValue).define("format",t),$$(e.defaultTimeValue).refresh()}FieldClass(){return super._FieldClass("datetime")}populate(e){const t=this.ids;super.populate(e),$$(t.defaultDateValue).setValue(new Date(e.settings.defaultDateValue)),$$(t.defaultTimeValue).setValue(new Date(e.settings.defaultTimeValue))}show(){this.refreshDateValue(),this.refreshTimevalue(),super.show()}}}},6393:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_email`,{default:"",defaultCheckbox:""})}ui(){const i=this.ids;return super.ui([{cols:[{view:"label",label:a("Default Value:"),align:"right",width:100},{id:i.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{view:"text",id:i.default,name:"default",placeholder:a("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}])}checkboxDefaultValue(e){0===e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}FieldClass(){return super._FieldClass("email")}isValid(){const e=this.ids;let t=super.isValid();$$(e.component).clearValidation();const i=$$(e.required).getValue(),n=$$(e.default).getValue();return i||n?webix.rules.isEmail(n)?t=!0:($$(e.component).markInvalid("default",a("This email is invalid")),t=!1):t=!0,t}populate(e){const t=this.ids;super.populate(e),""===e.settings.default?$$(t.defaultCheckbox).setValue(0):$$(t.defaultCheckbox).setValue(1)}}}},727:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_file`,{fileSize:"",fileType:""})}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Size (MB):"),align:"right",width:75},{view:"checkbox",name:"limitFileSize",value:1,width:30,click:function(){this.getValue()?$$(e.fileSize).enable():$$(e.fileSize).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"counter",name:"fileSize",id:e.fileSize,width:104,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Type:"),align:"right",width:75},{view:"checkbox",name:"limitFileType",width:30,labelWidth:0,value:1,click:function(){this.getValue()?$$(e.fileType).enable():$$(e.fileType).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.fileType,view:"text",name:"fileType",placeholder:i("txt,rtf,doc,docx,..."),on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}])}FieldClass(){return super._FieldClass("file")}clear(){const e=this.ids;super.clear(),$$(e.fileSize).setValue(0),$$(e.fileType).setValue("")}}}},6139:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_formula`,{field:"",fieldList:"",rowFilterContainer:""})}ui(){this.FieldClass();const n=this.ids;return this.rowFilter=e.filterComplexNew(n.component,{isSaveHidden:!0}),super.ui([{cols:[{view:"label",label:a("Type:"),align:"right",width:40},{view:"richselect",name:"type",labelWidth:t.labelWidthMedium,value:"sum",options:[{id:"sum",value:a("Sum")},{id:"max",value:a("Max")},{id:"min",value:a("Min")},{id:"average",value:a("Average")},{id:"count",value:a("Count")}],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:a("Field:"),align:"right",width:40},{id:n.field,view:"richselect",name:"field",labelWidth:t.labelWidthMedium,options:{view:"suggest",body:{id:n.fieldList,view:"list",template:this.itemTemplate,data:[]}},on:{onChange:()=>{this.refreshFilter()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{id:n.rowFilterContainer,height:200,rows:[{fillspace:!0,height:10},this.rowFilter.ui]}])}getFieldList(){const e=[];return this.CurrentObject.connectFields().forEach((t=>{t.datasourceLink.fields().forEach((i=>{"number"==i.key&&e.push({id:`${t.id}:${i.id}`,field:t,fieldLink:i})}))})),e}itemTemplate(e){return`[${e.field.label}] ${e.fieldLink.object.label} -> <i class="fa fa-${e.fieldLink.icon}" aria-hidden="true"></i><b>${e.fieldLink.label}</b>`}getSelectedField(){const e=this.ids,t=$$(e.field).getValue();return $$(e.field).getList().data.find({id:t})[0]}refreshFilter(){const e=$$(this.ids.rowFilterContainer),t=this.getSelectedField();t?.fieldLink?.object?(this.rowFilter.fieldsLoad(t.fieldLink.object.fields()),e.show()):(this.rowFilter.fieldsLoad([]),e.hide())}FieldClass(){return super._FieldClass("formula")}populate(e){const t=this.ids;if(super.populate(e),e.settings.field){const i=`${e.settings.field}:${e.settings.fieldLink}`;$$(t.field).setValue(i||"")}else $$(t.field).setValue("");this.refreshFilter(),this.rowFilter.setValue(e.settings.where||{})}show(){const e=this.ids,t=this.getFieldList();$$(e.fieldList).clearAll(),$$(e.fieldList).parse(t),super.show(),this.refreshFilter()}values(){const e=this.ids,t=$$(e.component).getValues(),i=this.getSelectedField();return i?(t.field=i.field.id,t.fieldLink=i.fieldLink.id,t.object=i.fieldLink.object.id):(t.field="",t.fieldLink="",t.object=""),t.where=this.rowFilter.getValue(),$$(e.component).setValues(t),super.values()}}}},7380:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_image`,{imageWidth:"",imageHeight:"",imageContainer:"",defaultImageUrl:"",useWidth:"",useHeight:"",useDefaultImage:""})}ui(){const n=this.ids;return super.ui([{cols:[{view:"label",label:i("Width:"),align:"right",width:60},{id:n.useWidth,view:"checkbox",name:"useWidth",width:30,value:1,click:function(){this.getValue()?$$(n.imageWidth).enable():$$(n.imageWidth).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:n.imageWidth,view:"text",name:"imageWidth",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Height:"),align:"right",width:60},{id:n.useHeight,view:"checkbox",name:"useHeight",width:30,value:1,click:function(){this.getValue()?$$(n.imageHeight).enable():$$(n.imageHeight).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"text",name:"imageHeight",id:n.imageHeight,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default image:"),align:"right",width:100},{id:n.useDefaultImage,view:"checkbox",name:"useDefaultImage",value:0,click:function(){this.getValue()?$$(n.imageContainer).enable():$$(n.imageContainer).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:n.imageContainer,disabled:!0,cols:[{},{view:"uploader",id:n.defaultImageUrl,template:`<div style="text-align:center; font-size: 30px;">\n                           <div class="default-image-holder">\n                              <div class="image-data-field-icon">\n                                 <i class="fa fa-picture-o fa-2x"></i>\n                                 <div style="font-size: 15px;">${i("Drag and drop or click here")}</div>\n                              </div>\n                              <div class="image-data-field-image" style="display:none;">\n                                 <a style="" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image" style="display:none;"></i></a>\n                              </div>\n                           </div>\n                        </div>`,apiOnly:!0,inputName:"file",multiple:!1,name:"defaultImageUrl",height:105,width:150,on:{onBeforeFileAdd:function(e){const t=["jpg","jpeg","bmp","png","gif"],n=e.type.toLowerCase();if(-1==t.indexOf(n))return webix.message(i("Only [{0}] images are supported",[t.join(", ")])),!1},onFileUploadError:function(t,i){e.notify.developer(new Error("Error loading image"),{message:"Error loading image",response:i})},onAfterRender:function(){t.CYPRESS_REF(this)}}},{}]}])}urlImage(e){return`/file/${e}`}urlUpload(e=!0){return`/file/upload/${this.CurrentObjectID}/${this.CurrentFieldID}/${e?"1":"0"}`}FieldClass(){return super._FieldClass("image")}populate(e){const t=this.ids,i=$$(t.defaultImageUrl),n=e.settings.defaultImageUrl,a=e.settings.useDefaultImage;super.populate(e),e.settings.useDefaultImage&&$$(t.imageContainer).enable(),n&&a&&(i.attachEvent("onAfterRender",(()=>{const e=i.$view.querySelector(".default-image-holder");e.querySelector(".image-data-field-icon").style.display="none";const t=e.querySelector(".image-data-field-image");t.style.display="",t.style.backgroundImage=`url('${this.urlImage(n)}')`,t.setAttribute("image-uuid",n),e.querySelector(".delete-image").style.display="table-cell"})),i.$view.addEventListener("click",(e=>{if(e.target.className.indexOf("delete-image")>-1){const e=i.$view.querySelector(".default-image-holder");e.querySelector(".image-data-field-icon").style.display="";const t=e.querySelector(".image-data-field-image");t.style.display="none",t.style.backgroundImage="",t.setAttribute("image-uuid",""),e.querySelector(".delete-image").style.display="none"}})))}show(){const e=this.ids,t=this.urlUpload(!0),i=$$(e.defaultImageUrl);i.config.upload=t,i.attachEvent("onFileUpload",((t,n)=>{$$(e.defaultImageUrl).setValue(n.data.uuid);const a=i.$view.querySelector(".default-image-holder");a.querySelector(".image-data-field-icon").style.display="none";const o=a.querySelector(".image-data-field-image");o.style.display="",o.style.backgroundImage=`url('${this.urlImage(n.data.uuid)}')`,o.setAttribute("image-uuid",n.data.uuid),a.querySelector(".delete-image").style.display="table-cell"})),i.attachEvent("onAfterRender",(()=>{const e=i.$view.querySelector(".default-image-holder");e.querySelector(".image-data-field-icon").style.display="";const t=e.querySelector(".image-data-field-image");t.style.display="none",t.style.backgroundImage="",t.setAttribute("image-uuid",""),e.querySelector(".delete-image").style.display="none"})),i.addDropZone(i.$view),i.render(),super.show()}clear(){const e=this.ids;super.clear(),$$(e.useWidth).setValue(0),$$(e.useHeight).setValue(0),$$(e.useDefaultImage).setValue(0),$$(e.imageWidth).setValue(""),$$(e.imageHeight).setValue(""),$$(e.defaultImageUrl).setValue("")}}}},7341:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e);return class extends t{constructor(e="properties_abfield"){super(`${e}_json`,{})}ui(){return super.ui([])}FieldClass(){return super._FieldClass("json")}}}},4074:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Class.ABFieldManager.fieldByKey("selectivity");return class extends t{constructor(e="properties_abfield"){super(`${e}_list`,{isMultiple:"",hasColors:"",default:"",multipleDefault:"",options:"",colorboard:""}),this.colors=[["#F44336","#E91E63","#9C27B0","#673AB7"],["#3F51B5","#2196F3","#03A9F4","#00BCD4"],["#009688","#4CAF50","#8BC34A","#CDDC39"],["#FFEB3B","#FFC107","#FF9800","#FF5722"],["#795548","#9E9E9E","#607D8B","#000000"]],this._originalOptions=[]}ui(){const e=this.ids;return super.ui([{view:"checkbox",name:"isMultiple",disallowEdit:!0,id:e.isMultiple,labelRight:i("Multiselect"),labelWidth:0,value:!1,on:{onChange:t=>{1==t?($$(e.default).hide(),$$(e.multipleDefault).show()):($$(e.default).show(),$$(e.multipleDefault).hide()),this.updateDefaultList()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"checkbox",name:"hasColors",id:e.hasColors,labelRight:i("Customize Colors"),labelWidth:0,value:!1,on:{onChange:(e,t)=>{if(e==t)return!1;this.toggleColorControl(e)},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"label",label:`<b>${i("Options")}</b>: `},{id:e.options,name:"options",css:"padList",view:this.AB._App.custom.editlist.view,template:"<div style='position: relative;'><i class='ab-color-picker fa fa-lg fa-chevron-circle-down' style='color:#hex#'></i> #value#<i class='ab-new-field-remove fa fa-remove' style='position: absolute; top: 7px; right: 7px;'></i></div>",autoheight:!0,drag:!0,editable:!0,hex:"",editor:"text",editValue:"value",onClick:{"ab-new-field-remove":(t,n)=>((this._originalOptions||[]).filter((e=>e.id==n))[0]?webix.confirm({title:i("Delete Option"),text:i("All exisiting entries with this value will be cleared. Are you sure you want to delete this option?"),type:"confirm-warning"}).then((()=>{this._CurrentField.pendingDeletions=this._CurrentField.pendingDeletions||[],this._CurrentField.pendingDeletions.push(n),$$(e.options).remove(n)})):$$(e.options).remove(n),!1),"ab-color-picker":(t,i,n)=>(webix.ui({id:e.colorboard,view:"popup",body:{view:"colorboard",type:"classic",id:"color",width:125,height:150,palette:this.colors,left:125,top:150,on:{onSelect:t=>{const n=$$(e.options).getItem(i);n.hex=t,$$(e.options).updateItem(i,n),$$(e.colorboard).hide()}}}}).show(n,{x:-7}),!1)},on:{onAfterAdd:()=>{this.updateDefaultList()},onAfterEditStop:()=>{this.updateDefaultList()},onAfterDelete:()=>{this.updateDefaultList()},onAfterRender:()=>{this.toggleColorControl($$(e.hasColors).getValue())}}},{view:"button",css:"webix_primary",value:i("Add new option"),click:()=>{let t=webix.uid(),i=this.getNextHex(),n=$$(e.options);n&&(n.add({id:t,value:"",hex:i,isNew:!0},n.count()),n.exists(t)&&n.edit(t))},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{cols:[{view:"label",label:i("Default:"),width:55},{id:e.default,placeholder:i("Select Default"),name:"default",view:"richselect",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.multipleDefault,name:"multipleDefault",view:"forminput",labelWidth:0,height:44,borderless:!0,hidden:!0,body:{view:this.AB._App.custom.focusabletemplate.view,css:"customFieldCls",borderless:!0,template:`<label style="width: 80px;text-align: left;line-height:32px;" class="webix_inp_label">${i("Default")}</label><div style="margin-left: 80px; height: 36px;" class="list-data-values form-entry"></div>`}}])}clear(){const e=this.ids;$$(e.isMultiple).setValue(0),$$(e.hasColors).setValue(0),$$(e.options).clearAll(),$$(e.default).define("options",[]),$$(e.default).setValue(this.FieldClass()?.defaultValues()?.default);const t=$$(e.multipleDefault).$view.querySelector(".list-data-values");t&&t.selectivity&&t.selectivity.setData([])}FieldClass(){return super._FieldClass("list")}getNextHex(){const e=[];$$(this.ids.options)?.data.each((function(t){e.push(t.hex)}));const t=[];this.colors.forEach((e=>{e?.forEach?.((e=>{t.push(e)}))}));let i="#3498db";for(let n=0;n<t.length;n++)if(-1==e.indexOf(t[n])){i=t[n];break}return i}populate(e){super.populate(e),this._originalOptions=e?.settings?.options??[];let t=[];this._CurrentField=e,this._CurrentField&&(this._CurrentField.pendingDeletions=[],t=(e?.settings.options||[]).map((e=>({id:e.id,value:e.text,hex:e.hex,translations:e.translations}))));const i=$$(this.ids.options);i.parse(t),i.refresh(),setTimeout((()=>{this.updateDefaultList()}),10)}toggleColorControl(e){const t=$$(this.ids.options)?.$view.querySelectorAll(".ab-color-picker");t?.forEach((function(t){1==e?t.classList.remove("hide"):t.classList.add("hide")}))}updateDefaultList(){const e=this.ids,t=this._CurrentField?.settings,n=$$(e.options).find({}).map((function(e){return{id:e.id,value:e.value,hex:e.hex}}));if($$(e.isMultiple).getValue()){const o=$$(e.multipleDefault).$view.querySelector(".list-data-values");if(!o)return!1;const s=this.values();new a(s,this).selectivityRender(o,{multiple:!0,data:t?.multipleDefault??[],placeholder:i("Select items"),items:n.map((function(e){return{id:e.id,text:e.value,hex:e.hex}}))}),o.addEventListener("change",(function(t){t.value.length?$$(e.multipleDefault).define("required",!1):$$(e.multipleDefault).$view.querySelector(".webix_inp_label").classList.contains("webix_required")&&$$(e.multipleDefault).define("required",!0)}))}else $$(e.default).define("options",n),t?.default&&$$(e.default).setValue(t.default),$$(e.default).refresh()}values(){const e=super.values(),t=this.ids;e.settings.options=[],$$(t.options).data.each((t=>{let i=t.id;t.isNew&&t.value&&!e.settings.options.filter((e=>e.id==t.value)).length&&(i=t.value),e.settings.options.push({id:i,text:t.value,hex:t.hex,translations:t.translations})})),e.settings.options.forEach((e=>{this.AB.Multilingual.unTranslate(e,e,["text"])})),e.settings.multipleDefault=[];const i=$$(t.multipleDefault).$view.querySelector(".list-data-values");return i&&i.selectivity&&(e.settings.multipleDefault=i.selectivity.getData()||[]),e}}}},3820:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_longtext`,{default:"",defaultCheckbox:""})}ui(){const e=this.ids;return super.ui([{view:"layout",cols:[{view:"label",label:a("Default Value:"),align:"right",width:100},{id:e.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:e.default,view:"text",name:"default",placeholder:a("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"checkbox",name:"supportMultilingual",disallowEdit:!0,labelRight:a("Support multilingual"),labelWidth:t.labelWidthCheckbox,value:!1,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}])}FieldClass(){return super._FieldClass("LongText")}populate(e){super.populate(e);const t=""===e.settings.default?0:1;$$(this.ids.defaultCheckbox).setValue(t)}show(){super.show(),$$(this.ids.defaultCheckbox).setValue(0)}checkboxDefaultValue(e){0==e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}}}},6771:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_number`,{default:"",decimalOptions:"",typeDecimalPlaces:"",typeRounding:"",validation:"",validateMinimum:"",validateMaximum:"",defaultCheckbox:"",validateView:"",typeDecimals:"",typeFormat:"",typeThousands:""})}ui(){const i=this.FieldClass(),n=this.ids;return super.ui([{cols:[{view:"label",label:a("Default Value:"),align:"right",width:100},{id:n.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{id:n.default,view:"text",name:"default",placeholder:a("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onChange:(e,t)=>{this.numValidation(e,t,n.default)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:a("Format:"),align:"right",width:100},{id:n.typeFormat,view:"richselect",name:"typeFormat",value:"none",labelWidth:t.labelWidthXLarge,options:i.formatList(a),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:a("Decimals:"),align:"right",width:100},{id:n.typeDecimals,view:"segmented",name:"typeDecimals",disallowEdit:!0,labelWidth:t.labelWidthXLarge,value:"none",options:i.delimiterList(),on:{onChange:e=>{this.segmentedDecimals(e)},onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{id:n.decimalOptions,hidden:!0,disabled:!0,rows:[{cols:[{width:20},{view:"label",label:a("Places:"),align:"right",width:100},{id:n.typeDecimalPlaces,view:"counter",disallowEdit:!0,name:"typeDecimalPlaces",width:102,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}},{width:20},{view:"label",label:a("Rounding:"),align:"right",width:100},{id:n.typeRounding,view:"richselect",name:"typeRounding",value:"none",vertical:!0,options:[{id:"none",value:a("Default")},{id:"roundUp",value:a("Round Up")},{id:"roundDown",value:a("Round Down")}],on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]},{cols:[{view:"label",label:a("Thousands:"),align:"right",width:100},{id:n.typeThousands,view:"segmented",name:"typeThousands",value:"none",options:i.delimiterList(),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:a("Validation:"),align:"right",width:100},{view:"switch",id:n.validation,name:"validation",value:0,width:55,on:{onChange:e=>{this.switchValidation(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}}]},{id:n.validateView,hidden:!0,disabld:!0,rows:[{cols:[{width:20},{view:"label",label:a("Minimum:"),align:"right",width:100},{view:"text",id:n.validateMinimum,name:"validateMinimum",placeholder:a("Minimum Number"),on:{onChange:(e,t)=>{this.numValidation(e,t,n.validateMinimum)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{width:20},{view:"label",label:a("Maximum:"),align:"right",width:100},{view:"text",id:n.validateMaximum,name:"validateMaximum",placeholder:a("Maximum Number"),on:{onChange:(e,t)=>{this.numValidation(e,t,n.validateMaximum)},onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]}])}numValidation(e,t,i){new RegExp("^[0-9.]*$").test(e)||$$(i).setValue(t||"")}checkboxDefaultValue(e){0==e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}segmentedDecimals(e){"none"==e?($$(this.ids.decimalOptions).disable(),$$(this.ids.decimalOptions).hide()):($$(this.ids.decimalOptions).enable(),$$(this.ids.decimalOptions).show())}switchValidation(e){e?($$(this.ids.validateView).enable(),$$(this.ids.validateView).show()):($$(this.ids.validateView).disable(),$$(this.ids.validateView).hide())}FieldClass(){return super._FieldClass("number")}isValid(){let e=super.isValid();const t=this.formValues(),i=t.default;let n=0;if(""!==i&&(n=parseFloat(i)),t.required&&""===i&&(this.markInvalid("default",a("If a field is required, you must set a default value.")),e=!1),t.validation){const o=t.validateMinimum,s=t.validateMaximum;let r=0,l=0;""!==o&&(r=parseFloat(o)),""!==s&&(l=parseFloat(s)),""!==i&&(""!==o&&n<r&&(this.markInvalid("default",a("default value must be within any min / max value setting")),e=!1),""!==s&&n>l&&(this.markInvalid("default",a("default value must be within any min / max value setting")),e=!1)),""!=o&&""!=s&&r>l&&(this.markInvalid("validateMinimum",a("minimum value must be <= maximum value")),this.markInvalid("validateMaximum",a("maximum value must be >= minimum value")),e=!1)}return e}populate(e){const t=this.ids;super.populate(e),""===e.settings.default?$$(t.defaultCheckbox).setValue(0):$$(t.defaultCheckbox).setValue(1),0===e.settings.validation?$$(t.validateView).hide():$$(t.validateView).show(),"none"===e.settings.typeDecimals?($$(t.decimalOptions).hide(),$$(t.decimalOptions).disable()):($$(t.decimalOptions).enable(),$$(t.decimalOptions).show(),$$(t.typeDecimalPlaces).enable(),$$(t.typeDecimalPlaces).show(),$$(t.typeRounding).enable(),$$(t.typeRounding).show())}}}},401:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_string`,{default:"",supportMultilingual:"",defaultCheckbox:""})}ui(){const i=this.ids;return super.ui([{cols:[{view:"label",label:a("Default Value:"),align:"right",width:100},{id:i.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{view:"text",id:i.default,name:"default",placeholder:a("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{view:"checkbox",id:i.supportMultilingual,name:"supportMultilingual",disallowEdit:!0,labelRight:a("Support multilingual"),labelWidth:t.labelWidthCheckbox,value:!1,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}])}checkboxDefaultValue(e){0===e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}FieldClass(){return super._FieldClass("string")}populate(e){const t=this.ids;super.populate(e),""===e.settings.default?$$(t.defaultCheckbox).setValue(0):$$(t.defaultCheckbox).setValue(1)}}}},8546:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_textformula`,{textFormula:"",formulaSuggest:""})}ui(){const e=this.ids;return super.ui([{view:"layout",cols:[{id:e.textFormula,view:"textarea",name:"textFormula",editor:"text",labelWidth:t.labelWidthLarge,placeholder:a("Text Formula"),on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"spacer",width:15},{view:"layout",rows:[{view:"spacer",height:5},{id:e.formulaSuggest,name:"formulaSuggest",view:"dataview",xCount:1,select:!0,type:{height:30,width:246},template:"#value#",on:{onItemClick:t=>{const i=$$(e.formulaSuggest).getItem(t),n="field"==i.type?"{"+i.value+"}":i.value;$$(e.textFormula).setValue($$(e.textFormula).getValue()+n),$$(e.formulaSuggest).unselect()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"spacer",height:5}]}]}])}FieldClass(){return super._FieldClass("TextFormula")}show(){super.show(),this.loadSuggestions()}populate(e){super.populate(e),this.loadSuggestions()}loadSuggestions(){const e=this.ids,t=this.FieldClass(),i=this.CurrentObject.fields().filter((e=>"formula"!=e.key&&"TextFormula"!=e.key&&!e.isConnection)).map((e=>({id:e.id,value:e.columnName,type:"field"}))).concat(t.getBuildInFunction());$$(e.formulaSuggest).clearAll(),$$(e.formulaSuggest).parse(i)}}}},1702:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=(0,n.Z)(e);return class extends t{constructor(e="properties_abfield"){super(`${e}_tree`,{options:"",popup:"",tree:""})}ui(){const e=this.ids;return super.ui([{view:"button",type:"icon",icon:"fa fa-plus",height:30,click:()=>{const t=webix.uid().toString();$$(e.options).data.add({id:t,text:""}),$$(e.options).openAll(),$$(e.options).config.height=28*$$(e.options).count()+18,$$(e.options).resize(),$$(e.options).edit(t)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.options,name:"options",css:{background:"transparent"},view:this.AB.custom.edittree.view,template:"<div style='position: relative;'><i class='ab-new-field-add fa fa-plus' style='position: relative; right: 0px;'></i> #text#<i class='ab-new-field-remove fa fa-remove' style='position: absolute; top: 7px; right: 7px;'></i></div>",autoheight:!0,drag:!0,editor:"text",editable:!0,editValue:"text",onClick:{"ab-new-field-remove":(t,i)=>($$(e.options).remove(i),$$(e.options).config.height=0,$$(e.options).config.height=28*$$(e.options).count()+18,!1),"ab-new-field-add":(t,i)=>{const n=webix.uid().toString(),a=i.toString();return $$(e.options).data.add({id:n,text:""},null,a),$$(e.options).openAll(),$$(e.options).config.height=28*$$(e.options).count()+18,$$(e.options).resize(),$$(e.options).edit(n),!1}}}])}FieldClass(){return super._FieldClass("tree")}clear(){const e=this.ids;$$(e.options).clearAll(),$$(e.options).config.height=0,$$(e.options).resize(),$$(e.options).refresh()}values(){const e=super.values();return e.settings.options=$$(this.ids.options).serialize(),e}populate(e){const t=this.ids;$$(t.options).clearAll(),$$(t.options).parse(e.settings.options),$$(t.options).openAll(),$$(t.options).config.height=28*$$(t.options).count()+18,$$(t.options).resize(),$$(t.options).refresh()}}}},8114:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(917);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_user`,{editable:"",isMultiple:"",isCurrentUser:"",isShowProfileImage:"",isShowUsername:""})}ui(){const e=this.ids;return super.ui([{view:"checkbox",name:"isMultiple",id:e.isMultiple,disallowEdit:!0,labelRight:a("Allow multiple users"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{cols:[{view:"checkbox",name:"isCurrentUser",id:e.isCurrentUser,labelRight:a("Default value as current user"),labelWidth:t.labelWidthCheckbox,on:{onChange:function(t){0==t?($$(e.editable).setValue(0),$$(e.editable).hide()):($$(e.editable).setValue(1),$$(e.editable).show())},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"checkbox",name:"editable",hidden:!0,id:e.editable,labelRight:a("Editable"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"checkbox",name:"isShowProfileImage",id:e.isShowProfileImage,labelRight:a("Show Profile Image"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"checkbox",name:"isShowUsername",id:e.isShowUsername,labelRight:a("Show Username"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}])}FieldClass(){return super._FieldClass("user")}}}},2607:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_end",{name:""})}static get key(){return"End"}ui(){let e=this.ids;return{id:e.component,rows:[{view:"label",label:i("Terminate End Event")},{view:"label",label:i("Stops the flow of the process.")},{view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""}]}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids;$$(t.name).setValue(e.name)}values(){const e={},t=this.ids;return e.label=$$(t.name)?.getValue(),e}}}},5732:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_gateway_exclusive",{name:"",buttonFilter:""})}static get key(){return"GatewayExclusive"}ui(){let e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name"}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids,n=this.ui();this._element=e;const a=(e.process.processDataFields(e)||[]).map((e=>e.field)).filter((e=>e)),o=e.process.connectionsOutgoing(e.diagramID);this.__dfLookup={},this.conditions=e.conditions||this.conditions||{},o.forEach((a=>{const o=this.conditions[a.id]||{},s=e.process.elementForDiagramID(a.to);let r;this.__dfLookup[a.id]||(r=this.AB.filterComplexNew(`${t.component}_${a.id}_filter`),r.myPopup=webix.ui({view:"popup",height:240,width:480,hidden:!0,body:r.ui}),r.init(),r.on("save",(()=>{const e=r.getValue(),i=$$(`${t.buttonFilter}_${a.id}`);i.define("badge",e.rules?.length||null),i.refresh()})),this.__dfLookup[a.id]=r),r=this.__dfLookup[a.id];const l={view:"fieldset",label:i("to {0}",[s?s.name:i("unlabeled Task({0})",[a.id])]),body:{rows:[{id:`${t.component}_${a.id}_label`,view:"text",label:i("Label"),value:o.label||""},{id:`${t.buttonFilter}_${a.id}`,css:"webix_primary",view:"button",label:i("Add Filter"),icon:"fa fa-gear",type:"icon",badge:o.filterValue?.rules?.length||null,click:function(){r.popUp(this.$view,null,{pos:"top"})}}]}};n.elements.push(l)})),webix.ui(n,$$(t.component)),$$(t.component).show(),o.forEach((e=>{const t=this.conditions[e.id]||{},i=this.__dfLookup[e.id];i.fieldsLoad(a),t.filterValue&&i.setValue(t.filterValue),i.init()})),$$(t.name).setValue(e.name)}values(){let e={};const t=this.ids;return e.label=$$(t.name)?.getValue(),e.name=e.label,e.conditions={},this._element.process.connectionsOutgoing(this._element.diagramID).forEach((i=>{if(e.conditions[i.id]={},e.conditions[i.id].label=$$(`${t.component}_${i.id}_label`).getValue(),this.__dfLookup&&this.__dfLookup[i.id]){const t=this.__dfLookup[i.id];e.conditions[i.id].filterValue=t.getValue()}})),e}}}},7670:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),s=(0,a.Z)(e);return class extends t{constructor(){super("properties_process_participant",{name:"",users:""}),this.users=new s(this.ids.component+"_users_")}static get key(){return"process.participant"}uiUser(e){const t=this.users.ui(e??{});return{id:this.ids.users,rows:[t],paddingY:10}}ui(e){let t=this.ids,n={id:t.component,rows:[{view:"label",label:i("Process Participant:")},{view:"label",label:i("This element defines a group of users that are responsible for the tasks contained within.")},{view:"form",id:t.form,elements:[{id:t.name,view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:this.name}]}]},a={id:t.users};return e?.laneIDs&&0==e?.laneIDs.length&&(a=this.uiUser(e??{})),n.rows[2].elements.push(a),n}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids;if($$(t.name).setValue(e.name),e.laneIDs&&0==e.laneIDs.length){const i=this.uiUser(e??{});webix.ui(i,$$(t.users))}}values(){const e={},t=this.ids;e.label=$$(t.name).getValue();const i=this.users.values();return Object.keys(i).forEach((t=>{e[t]=i[t]})),e}}}},5178:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),a=i(8788);function o(e){const t=(0,n.Z)(e),i=(0,a.Z)(e);var o=t.L();return class extends i{constructor(t){super(t,{useField:"",fields:"",userField:"",buttonFilter:""}),this.AB=e,this.filterComponent=this.AB.filterComplexNew(`${this.ids.component}_filter`,e),this.filterComponent.init({isProcessParticipant:!0}),this.filterComponent.on("save",(e=>{this.populateBadgeNumber(e)}))}ui(e={}){const i=e??{},n=super.ui(i),a=i.filterConditions||{glue:"and",rules:[]},s=e.process?.processDataFields(e).map((e=>e.field))||[];this.filterComponent.fieldsLoad(s),this.filterComponent.setValue(a);const r=i.userProcessFieldData?.map((e=>({uuid:e.field.id,id:e.key,value:e.label,key:e.key})))||[],l=this.ids,c=[{},{cols:[{view:"checkbox",id:this.ids.useField,width:34,labelWidth:0,value:"1"==i.useField?1:0,click:function(e){$$(e).getValue()?$$(l.userField).enable():$$(l.userField).disable()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"label",label:o("by Field"),width:88},{view:"multicombo",id:this.ids.userField,value:i.userFields?i.userFields:0,disabled:"1"!=i.useField,suggest:{body:{yCount:4,data:r,on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${l.userField}_${e.id}`)}))},onItemClick:function(e){var t=$$(l.userField),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},placeholder:o("Click to add User"),labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){d.filterComponent.emit("save",a),t.CYPRESS_REF(this.getNode(),l.userField)},onChange:()=>{$$(this.ids.userField).getList().callEvent("onAfterRender")}}}]}],d=this;return n.elements.push(...c,{id:l.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:o("Scope query"),type:"icon",badge:0,click:function(){d.filterComponent.popUp(this.$view,null,{pos:"top"})}}),n}async init(e){this.AB=e}populateBadgeNumber(e={}){const t=this.ids,i=$$(t.buttonFilter);e.rules?(i.define("badge",e.rules?.length||null),i.refresh()):(i.define("badge",null),i.refresh())}values(){const e=super.values(),t=this.ids;return $$(t.useField)&&(e.useField=$$(t.useField).getValue()),$$(t.useField)?e.userFields=$$(t.userField).getValue():e.userFields=[],e.filterConditions=this.filterComponent.getValue(),e}}}},3412:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),s=(0,a.Z)(e);return class extends t{constructor(){super("properties_process_email",{name:"",to:"",from:"",subject:"",fromUser:"",toUser:"",message:"",toCustom:"",toCustomFields:"",fromCustom:"",fromCustomFields:"",customFrom:"",toEmailForm:"",fromEmailForm:""}),this.toUser=new s(this.ids.component+"_to_"),this.fromUser=new s(this.ids.component+"_from_")}static get key(){return"Email"}ui(e){const n=this.toUser.ui(e?.toUsers??{}),a=this.fromUser.ui(e?.fromUsers??{});let s=this.ids;return{id:s.component,rows:[{view:"label",label:i("Send Email:")},{view:"label",label:i("Generate an Email message to be sent.")},{view:"form",elements:[{id:s.name,view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:this.name},{id:s.to,view:"select",label:i("To"),name:"to",value:this.to,options:[{id:0,value:i("Next Participant")},{id:1,value:i("Select Role or User")},{id:2,value:i("Custom")}],on:{onChange:e=>{1==parseInt(e)?($$(s.toUser).show(),$$(s.toEmailForm).hide()):2==parseInt(e)?($$(s.toUser).hide(),$$(s.toEmailForm).show()):($$(s.toUser).hide(),$$(s.toEmailForm).hide())}}},{id:s.toUser,rows:[n],paddingY:10,hidden:1!=parseInt(this.to)},{id:s.toEmailForm,name:"toEmailForm",type:"form",css:"no-margin",rows:[{id:s.toCustom,view:"text",label:i("Email"),placeholder:i("Type email address here..."),name:"toCustom",value:this.toCustom},{id:s.toCustomFields,label:i("toCustomFields"),name:"toCustomFields",value:this.toCustomFields,view:"multicombo",placeholder:i("..."),suggest:{body:{data:[],on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${s.toCustomFields}_${e.id}`)}))},onItemClick:function(e){const t=$$(s.toCustomFields),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),s.toCustomFields)},onChange:()=>{$$(this.ids.toCustomFields).getList().callEvent("onAfterRender")}}}],hidden:2!=parseInt(this.to)},{id:s.from,view:"select",label:i("From"),name:"from",value:this.from,options:[{id:0,value:i("Current Participant")},{id:1,value:i("Select Role or User")},{id:2,value:i("Custom")}],on:{onChange:e=>{1==parseInt(e)?($$(s.fromUser).show(),$$(s.fromEmailForm).hide()):2==parseInt(e)?($$(s.fromUser).hide(),$$(s.fromEmailForm).show()):($$(s.fromUser).hide(),$$(s.fromEmailForm).hide())}}},{id:s.fromUser,rows:[a],paddingY:10,hidden:1!=parseInt(this.from)},{id:s.fromEmailForm,name:"fromEmailForm",type:"form",css:"no-margin",rows:[{id:s.fromCustom,view:"text",label:i("Email"),placeholder:i("Type email address here..."),name:"fromCustom",value:this.fromCustom},{id:s.fromCustomFields,view:"multicombo",label:i("Process"),placeholder:i("..."),name:"fromCustomFields",suggest:{body:{data:[],on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${s.fromCustomFields}_${e.id}`)}))},onItemClick:function(e){const t=$$(s.fromCustomFields),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},labelAlign:"left",value:this.fromCustomFields,stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),s.fromCustomFields)},onChange:()=>{$$(this.ids.fromCustomFields).getList().callEvent("onAfterRender")}}}],hidden:2!=parseInt(this.from)},{id:s.subject,view:"text",label:i("Subject"),name:"subject",value:this.subject},{view:"spacer",height:10},{id:s.message,view:"tinymce-editor",label:i("Message"),name:"message",value:this.message,borderless:!0,minHeight:500,config:{plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"}}]}]}}async init(e){return this.AB=e,Promise.resolve()}applicationLoad(e){super.applicationLoad(e)}processLoad(e){super.processLoad(e),this.process=e}populate(e){let t=this.ids;e.toUsers=e.toUsers??{},e.fromUsers=e.fromUsers??{};const i=e.process.processDataFields(e)||[];let n=i.filter((e=>"user"==e.field?.key));e.toUsers.userProcessFieldData=n,e.fromUsers.userProcessFieldData=n;let a=i.filter((e=>"email"==e.field?.key)).map((e=>({uuid:e.field.id,id:e.key,value:e.label,key:e.key})));$$(t.name).setValue(e.name),$$(t.to).setValue(e.to),$$(t.from).setValue(e.from),$$(t.subject).setValue(e.subject),$$(t.message).setValue(e.message),$$(t.toCustom).setValue(e.toCustom),$$(t.fromCustom).setValue(e.fromCustom),$$(t.fromCustomFields).options_setter(a),$$(t.fromCustomFields).refresh(),$$(t.fromCustomFields).setValue(e.fromCustomFields),$$(t.toCustomFields).options_setter(a),$$(t.toCustomFields).refresh(),$$(t.toCustomFields).setValue(e.toCustomFields);let o=this.toUser.ui(e.toUsers??{}),s={id:t.toUser,rows:[o],paddingY:10,hidden:1!=parseInt(e.to)};webix.ui(s,$$(t.toUser));let r=this.fromUser.ui(e.fromUsers??{}),l={id:t.fromUser,rows:[r],paddingY:10,hidden:1!=parseInt(e.from)};webix.ui(l,$$(t.fromUser))}values(){const e={},t=this.ids;return e.label=$$(t.name).getValue(),e.to=$$(t.to).getValue(),e.from=$$(t.from).getValue(),e.subject=$$(t.subject).getValue(),e.message=$$(t.message).getValue(),e.toCustom=$$(t.toCustom).getValue(),e.toCustomFields=$$(t.toCustomFields).getValue(),e.fromCustom=$$(t.fromCustom).getValue(),e.fromCustomFields=$$(t.fromCustomFields).getValue(),e.toUsers=this.toUser.values(),e.fromUsers=this.fromUser.values(),e}}}},6692:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings(),o=e.Class.ABProcessTaskManager;class s extends t{constructor(){super("properties_process_service",{name:"",option:""})}static get key(){return"TaskService"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:e.option,rows:[{view:"button",label:i("Accounting: Process Batch"),click:()=>{this.switchTo("AccountingBatchProcessing")}},{view:"button",label:i("Accounting: Fiscal Period Close"),click:()=>{this.switchTo("AccountingFPClose")}},{view:"button",label:i("Accounting: Fiscal Period Year Close"),click:()=>{this.switchTo("AccountingFPYearClose",e.component)}},{view:"button",label:i("Accounting: Journal Entry Archive"),click:()=>{this.switchTo("AccountingJEArchive")}},{view:"button",label:i("Query Task"),click:()=>{this.switchTo("TaskServiceQuery")}},{view:"button",label:i("Insert Record Task"),click:()=>{this.switchTo("InsertRecord")}},{view:"button",label:i("Calculate Task"),click:()=>{this.switchTo("Calculate")}},{view:"button",label:i("Get Reset Password Url"),click:()=>{this.switchTo("GetResetPasswordUrl")}}]}]}}async init(e){return this.AB=e,Promise.resolve()}switchTo(e){const t=this.ids,i=this.values();i.id=this.element.id,i.diagramID=this.element.diagramID,i.key=e??s.key;const n=o.newTask(i,this.element.process,this.AB)??null;n&&this.element.switchTo(n,t.component)}values(){const e=this.ids;let t={};const i=$$(e.name);return t.label=i?.getValue()??"",t.name=i?.getValue()??"",t}populate(e){const t=this.ids,i=$$(t.name);this.element=e,i?.setValue(e.label??"")}}return s}},6699:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_calculate",{name:"",formulaText:"",variableList:"",variablePopup:"",operatorPopup:""}),this.element=null}static get key(){return"Calculate"}ui(){const e=this.ids;webix.ui({id:e.variablePopup,view:"popup",hidden:!0,body:{id:e.variableList,view:"list",template:e=>e.value,data:"",on:{onItemClick:function(i){const n=this.getItem(i);t(`{${n.value}}`),$$(e.variablePopup).hide()}}}});const t=t=>{const i=$$(e.formulaText).getValue();$$(e.formulaText).setValue(`${i}${t} `)};return webix.ui({id:e.operatorPopup,view:"popup",hidden:!0,width:180,body:{view:"list",template:e=>{let t="";return e.icon&&(t+=`<i class="fa fa-${e.icon}" aria-hidden="true"></i> `),e.label&&(t+=e.label),t},data:[{label:i("+ Adds"),symbol:"+"},{label:i("- Subtracts"),symbol:"-"},{label:i("* Multiples"),symbol:"*"},{label:i("/ Divides"),symbol:"/"},{label:i("( Open Bracket"),symbol:"("},{label:i(") Closed Bracket"),symbol:")"}],on:{onItemClick:function(i){const n=this.getItem(i);t(n.symbol),$$(e.operatorPopup).hide()}}}}),{rows:[{view:"form",elementsConfig:{labelWidth:120},elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:this.name},{id:e.formulaText,view:"texthighlight",height:200,label:i("Formula"),type:"textarea",value:this.formulaText||"",highlight:e=>e},{cols:[{width:120,fillspace:!0},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-at",label:i("Parameters"),click:function(){$$(e.variablePopup).show(this.$view)}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-hashtag",label:i("Operators"),click:function(){$$(e.operatorPopup).show(this.$view)}}]}]}]}}populate(e){const t=this.ids,i=(e?.process?.processDataFields(e)||[]).map((e=>({id:e.key,value:e.label})));$$(t.name).setValue(e.label),$$(t.formulaText).setValue(e.formulaText),$$(t.variableList).define("data",i),$$(t.variableList).refresh()}values(){const e={},t=this.ids;return e.label=$$(t.name)?.getValue(),e.formulaText=$$(t.formulaText).getValue(),e}}}},1051:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_getResetPasswordUrl",{name:"",email:""})}static get key(){return"GetResetPasswordUrl"}ui(){const e=this.ids;return{id:e.component,view:"form",rows:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:e.email,view:"multicombo",label:i("Email"),name:"email",options:[]}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){const t=(e.process.processDataFields(e)??[]).filter((e=>"email"==e.field?.key)).map((e=>({id:e.key,value:e.label}))),i=this.ids,n=$$(i.name),a=$$(i.email);n.setValue(e.label),a.setValue(e.email),a.define("options",t),a.refresh()}values(){const e={},t=this.ids,i=$$(t.name),n=$$(t.email);return e.label=i?.getValue()??"",e.name=i?.getValue()??"",e.email=n?.getValue()??"",e}}}},8010:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_insertRecord",{name:"",objectID:"",fieldValues:"",repeatLayout:"",repeatMode:"",repeatColumn:""})}static get key(){return"InsertRecord"}ui(){const e=this.ids,t=this.CurrentApplication.objectsIncluded().map((e=>({id:e.id,value:e.label??e.name})));return{id:e.component,view:"form",elementsConfig:{labelWidth:120},elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:e.objectID,view:"select",label:i("Object"),value:"",name:"objectID",options:t,on:{onChange:e=>{this.element.objectID=e,this.refreshFieldValues(e)}}},{id:e.repeatLayout,hidden:!0,cols:[{id:e.repeatMode,view:"select",label:i("Repeat"),value:"",name:"repeatMode",width:330,options:[{id:"rootData",value:i("For Connection in root data")}],on:{onChange:e=>{this.element.repeatMode=e,this.refreshFieldValues()}}},{id:e.repeatColumn,view:"select",label:"",value:this.repeatColumn,name:"repeatColumn",options:[],on:{onChange:e=>{this.element.repeatColumn=e,this.refreshFieldValues()}}}],on:{onViewShow:()=>{this.refreshFieldValues()}}},{view:"fieldset",label:i("Values"),body:{id:e.fieldValues,view:"form",borderless:!0,elements:[]}}]}}async init(e){return this.AB=e,Promise.resolve()}getFieldOptions(e){const t=[];return t.push({id:"PK",value:i("Primary Key")}),e.fields().forEach((e=>{if(e.isConnection){const n=e.datasourceLink;n&&(t.push({id:`${e.id}|PK`,value:`${e.label} -> ${i("Primary Key")}`}),n.fields().forEach((i=>{t.push({id:`${e.id}|${i.id}`,value:`${e.label} -> ${i.label}`})})))}else t.push({id:e.id,value:e.label})})),t}refreshFieldValues(e){const t=this.ids,n=$$(t.fieldValues);if(!n)return;webix.ui([],n);const a=this.AB.objectByID(e??this.element.objectID);if(!a)return;const o=this.element.objectOfStartElement,s=o?this.getFieldOptions(o):[],r=this.element.objectOfPrevElement,l=r?this.getFieldOptions(r):[],c=[{id:0,value:i("Not Set")},{id:1,value:i("Set by custom value")},{id:2,value:i("Set by the root data [{0}]",[o?o.label:""])},{id:3,value:i("Set by previous step data [{0}]",[r?r.label:""])},{id:4,value:i("Set by formula format")}];let d=[];const u=this.element.fieldRepeat;u&&u.datasourceLink&&(c.push({id:5,value:i("Set by the instance [{0}]",[u?.label??""])}),d=this.getFieldOptions(u.datasourceLink)),c.push({id:6,value:i("Set by the parameter of a Query task")});const h=(this.element.process.processDataFields(this.element)??[]).map((e=>({id:e.key,value:e.label})));a.fields().forEach((e=>{n.addView({fieldId:e.id,view:"layout",cols:[{rows:[{view:"label",label:e.label,width:100},{fillspace:!0}]},{rows:[{name:"setSelector",view:"select",options:c,on:{onChange:function(e){this.getParentView().queryView({name:"valuePanel"}).showBatch(e)}}},{name:"valuePanel",view:"multiview",visibleBatch:0,cols:[{batch:0,fillspace:!0},{batch:1,view:"text"},{batch:2,view:"select",options:s},{batch:3,view:"select",options:l},{batch:4,view:"text"},{batch:5,view:"select",options:d},{batch:6,view:"multicombo",label:"",options:h}]}]}]})}))}setFieldValues(){const e=this.ids,t=$$(e.fieldValues).getChildViews()??[];this.element.fieldValues=this.element.fieldValues??{},t.forEach((e=>{const t=e.config.fieldId,i=this.element.fieldValues[t]??{};e.queryView({name:"setSelector"}).setValue(i.set);const n=e.queryView({name:"valuePanel"}),a=n.queryView({batch:n.config.visibleBatch});a&&a.setValue&&a.setValue(i.value)}))}getFieldValues(){const e={},t=this.ids;return($$(t.fieldValues).getChildViews()??[]).forEach((t=>{const i=t.config.fieldId,n=t.queryView({name:"setSelector"}),a=t.queryView({name:"valuePanel"}),o=a.queryView({batch:a.config.visibleBatch});e[i]={},e[i].set=n.getValue(),e[i].value=o?.getValue?.()??null})),e}populate(e){const t=this.ids,i=$$(t.name),n=$$(t.objectID),a=$$(t.repeatLayout),o=$$(t.repeatMode),s=$$(t.repeatColumn),r=e?.objectOfStartElement?.connectFields().map((e=>({id:e.id,value:e.label})))??[];this.element=e,i.setValue(e.label),n.setValue(e.objectID),o.setValue(e.repeatMode),s.define("options",r),s.define("value",e.repeatColumn),s.refresh(),e.isRepeat&&a.show(),this.refreshFieldValues(),this.setFieldValues()}values(){const e={},t=this.ids,i=$$(t.name),n=$$(t.objectID),a=$$(t.repeatMode),o=$$(t.repeatColumn);return e.label=i.getValue()??"",e.name=i.getValue()??"",e.objectID=n.getValue()??"",e.repeatMode=a.getValue()??"",e.repeatColumn=o.getValue()??"",e.fieldValues=this.getFieldValues(),e}}}},2367:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_query",{name:"",query:"",suggestions:""})}static get key(){return"TaskServiceQuery"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:this.name},{id:e.query}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){const t=this.ids,i=e.ABQLManager().builder(e.qlObj,e,this.AB),n=$$(t.name);this.element=e,webix.ui(i.ui(t.query),$$(t.query)),i.init(t.query),n.setValue(e.label)}values(){const e={},t=this.ids,i=$$(t.name);return e.label=i.getValue()??"",e.name=i.getValue()??"",e.qlObj=this.element.ABQLManager().parse(t.query,this.element,this.AB)??null,e}}}},6277:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_subprocess",{name:"",isEnable:"",parameterId:""})}static get key(){return"SubProcess"}ui(){let e=this.ids;return{id:e.component,view:"form",elementsConfig:{labelWidth:120},elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:e.isEnable,view:"switch",label:i("Enable"),value:!1},{id:e.parameterId,view:"richselect",label:i("Repeat for"),options:[{id:"",value:""}],value:""}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids,i=(e.process.processDataFields(e)||[]).map((e=>({id:e.key,value:e.label}))),n=$$(t.parameterId);n.define("options",i),n.refresh(),$$(t.name).setValue(e.name),$$(t.isEnable).setValue(e.isEnable),n.setValue(e.parameterId)}values(){const e={},t=this.ids;return e.name=$$(t.name)?.getValue(),e.label=e.name,e.isEnable=$$(t.isEnable)?.getValue(),e.parameterId=$$(t.parameterId)?.getValue(),e}}}},4490:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings(),o=e.Class.ABProcessTaskManager;class s extends t{constructor(){super("properties_process_user",{name:"",option:""})}static get key(){return"TaskUser"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:e.option,rows:[{view:"button",label:i("Approval Task"),click:()=>{this.switchTo("Approval")}},{view:"button",label:i("External Task"),click:()=>{this.switchTo("External")}}]}]}}async init(e){return this.AB=e,Promise.resolve()}switchTo(e){const t=this.ids,i=this.values();i.id=this.element.id,i.diagramID=this.element.diagramID,i.key=e??s.key;const n=o.newTask(i,this.element.process,this.AB)??null;n&&this.element.switchTo(n,t.component)}values(){const e=this.ids;let t={};const i=$$(e.name);return t.label=i?.getValue()??"",t.name=i?.getValue()??"",t}populate(e){const t=this.ids,i=$$(t.name);this.element=e,i?.setValue(e.label??"")}}return s}},7825:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),s=(0,a.Z)(e);return class extends t{constructor(){super("properties_process_user_approval",{name:"",who:"",toUser:"",formBuilder:"",modalWindow:"",formPreview:""}),this.toUser=new s(`${this.ids.component}_to_`),this.on("save",(()=>{this.processComponents()}))}static get key(){return"Approval"}uiUser(e){const t=this.users.ui(e??{});return{id:this.ids.users,rows:[t],paddingY:10}}ui(e){const t=this.ids,n=[{id:0,value:i("Current Participant")},{id:1,value:i("Select Role or User")}];this.laneDiagramID&&"?laneID?"!=this.laneDiagramID||n.shift();const a=()=>({id:t.modalWindow,view:"window",position:"center",fullscreen:!0,modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"spacer",width:17},{view:"label",label:i("Customize the approval layout")},{view:"spacer"},{view:"button",label:i("Cancel"),autowidth:!0,click:function(){$$(t.modalWindow).close()}},{view:"button",css:"webixtype_form",label:i("Save"),autowidth:!0,click:()=>{this.formBuilder=$$(t.formBuilder).getFormData(),this.element.formBuilder=this.formBuilder,(this.formBuilder.components||[]).forEach((e=>{e._key&&e.key!=e._key&&(e.key=e._key)})),this.emit("save"),$$(t.modalWindow).close()}},{view:"spacer",width:17}]},body:{id:t.formBuilder,view:"formiobuilder",dataFields:this.dataFields,formComponents:this.formIOComponents}}),s=this.toUser.ui(e?.toUsers??{});return{id:t.component,view:"form",rows:[{id:t.name,view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:""},{id:t.who,view:"select",label:i("Who"),name:"who",options:n,value:1==n.length?"1":"",on:{onChange:e=>{1==parseInt(e)?$$(t.toUser).show():$$(t.toUser).hide()}}},{id:t.toUser,rows:[s],paddingY:10},{view:"spacer",height:10},{view:"toolbar",type:"clean",borderless:!0,cols:[{view:"label",label:i("Data To Approve")},{view:"spacer"},{view:"button",value:i("Customize Layout"),autowidth:!0,click:()=>{webix.ui(a()).show()}}]},{view:"layout",type:"form",rows:[{view:"layout",padding:20,rows:[{id:t.formPreview,view:"formiopreview",formComponents:[],height:500}]}]}]}}async init(e){this.AB=e}processComponents(){const e=this.ids;this.dataFields=this.element.process.processDataFields(this.element),this.formIOComponents=this.element.preProcessFormIOComponents();const t=$$(e.formPreview).getParentView();t.removeView(e.formPreview),t.addView({id:e.formPreview,view:"formiopreview",formComponents:this.formIOComponents,height:500})}populate(e){this.element=e;const t=this.ids,i=$$(t.name),n=$$(t.who);if(i.setValue(e.label),null!==e.who)if(n.setValue(e.who),"0"===e.who)$$(t.toUser).hide();else{let i=this.toUser.ui(e.toUsers??{}),n={id:t.toUser,rows:[i],paddingY:10};webix.ui(n,$$(t.toUser))}this.processComponents()}values(){const e={},t=this.ids,i=$$(t.name),n=$$(t.who);return e.label=i?.getValue()??"",e.name=i?.getValue()??"",e.who=n?.getValue()??"",e.formBuilder=this.formBuilder,e.toUsers=this.toUser.values(),e}}}},8866:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),a=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),s=(0,a.Z)(e);return class extends t{constructor(){super("properties_process_user_external",{toUsers:""}),this.toUsers=new s(`${this.ids.component}_to_`)}static get key(){return"External"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:""},{view:"select",label:i("Who"),name:"who",options:[{id:0,value:i("Current Participant")},{id:1,value:i("Select Role or User")}],value:"0",on:{onChange:t=>{const i=$$(e.toUsers);1===parseInt(t)?i.show():i.hide()}}},{id:e.toUsers,rows:[this.toUsers.ui({})]},{view:"texthighlight",label:i("URL"),name:"url",value:"",highlight:e=>e.replace(/{%=[^%]*%}/g,(e=>`<span style="font-weight:500;background-color:#ebedf0;">${e}</span>`))}]}}async init(e){this.AB=e}populate(e){const t=this.ids,i={name:e.name,who:e.who,url:e.url},n=$$(t.component),a=$$(t.toUsers);this.element=e,n.setValues(i),"0"===e.who?a.hide():webix.ui({id:t.toUsers,rows:[this.toUsers.ui(e??{})],paddingY:10},a)}values(){const e=this.ids,t=$$(e.component).getValues();return t.label=t.name,t.toUsers=this.toUsers.values(),t}}}},7358:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_trigger_lifecycle",{name:"",objList:"",lifecycleList:""})}static get key(){return"TriggerLifecycle"}ui(){const e=this.CurrentApplication.objectsIncluded(),t=[];e.forEach((e=>{t.push({id:e.id,value:e.label})}));const n=this.ids;return{id:n.component,rows:[{view:"label",label:i("Object Lifecycle Trigger:")},{view:"label",label:i("Begins a process when an object's data is Added, Updated or Deleted.")},{view:"form",id:n.component,elements:[{id:n.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:n.objList,view:"select",label:i("Object"),options:t},{id:n.lifecycleList,view:"select",label:i("lifecycle"),options:[{id:"added",value:i("after Add")},{id:"updated",value:i("after Update")},{id:"deleted",value:i("after Delete")}]}]}]}}async init(e){this.AB=e}populate(e){const t=this.ids;$$(t.name).setValue(e.label),$$(t.objList).setValue(e.objectID),$$(t.lifecycleList).setValue(e.lifecycleKey)}values(){const e={},t=this.ids;return e.label=$$(t.name)?.getValue(),e.objectID=$$(t.objList)?.getValue(),e.lifecycleKey=$$(t.lifecycleList)?.getValue(),e.triggerKey=`${e.objectID}.${e.lifecycleKey}`,e}}}},9722:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.Config.uiSettings();class o extends t{constructor(){super("properties_process_trigger_lifecycle",{name:"",repeatEvery:"",repeatTime:"",repeatOnPanel:"",repeatDaily:"",repeatWeekly:"",repeatMonthly:"",isEnabled:"",triggerKey:""})}static get key(){return"TimerStartEvent"}ui(){let e=this.ids,t=[];for(let e=1;e<=31;e++)t.push({id:e,value:e});return{view:"form",id:e.component,elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:a.labelWidthLarge,name:"name",value:""},{id:e.repeatEvery,view:"richselect",name:"repeatEvery",label:i("Repeat every"),labelWidth:a.labelWidthLarge,value:s.repeatEvery,options:[{id:"daily",value:i("Daily")},{id:"weekly",value:i("Weekly")},{id:"monthly",value:i("Monthly")}],on:{onChange:t=>{$$(e.repeatOnPanel).showBatch(t)}}},{id:e.repeatTime,view:"datepicker",name:"repeatTime",label:i("Time"),labelWidth:a.labelWidthLarge,value:s.repeatTime,timepicker:!0,type:"time",multiselect:!1},{view:"multiview",id:e.repeatOnPanel,cells:[{view:"radio",id:e.repeatDaily,label:" ",labelWidth:a.labelWidthLarge,batch:"daily",vertical:!0,value:s.repeatDaily,options:[{id:"day",value:i("Day")},{id:"weekday",value:i("Weekday")}]},{view:"multiselect",id:e.repeatWeekly,labelWidth:a.labelWidthLarge,label:i("Every week on:"),batch:"weekly",value:s.repeatWeekly,options:[{id:"SUN",value:i("Sunday")},{id:"MON",value:i("Monday")},{id:"TUE",value:i("Tuesday")},{id:"WED",value:i("Wednesday")},{id:"THU",value:i("Thursday")},{id:"FRI",value:i("Friday")},{id:"SAT",value:i("Saturday")}]},{view:"layout",batch:"monthly",rows:[{id:e.repeatMonthly,view:"richselect",labelWidth:a.labelWidthLarge,label:i("Monthly on day"),options:t,value:s.repeatMonthly}]}]},{id:e.isEnabled,view:"switch",label:i("Enable"),labelWidth:a.labelWidthLarge,value:s.isEnabled},{id:e.triggerKey,view:"text",hidden:!0,value:"triggerKey.??"}]}}async init(e){this.AB=e}populate(e){const t=this.ids;$$(t.name).setValue(e.label),$$(t.repeatEvery).setValue(e.repeatEvery),$$(t.repeatTime).setValue(e.repeatTime),$$(t.repeatDaily).setValue(e.repeatDaily),$$(t.repeatWeekly).setValue(e.repeatWeekly),$$(t.repeatMonthly).setValue(e.repeatMonthly),$$(t.isEnabled).setValue(e.isEnabled),$$(t.triggerKey).setValue(e.triggerKey),null!=e.triggerKey&&"triggerKey.??"!=e.triggerKey||$$(t.triggerKey).setValue(`timer.${e.id||this.AB.uuid()}`)}values(){const e={},t=this.ids;return e.label=$$(t.name).getValue(),e.repeatEvery=$$(t.repeatEvery).getValue(),e.repeatTime=$$(t.repeatTime).getValue().toLocaleTimeString(),e.repeatDaily=$$(t.repeatDaily).getValue(),e.repeatWeekly=$$(t.repeatWeekly).getValue(),e.repeatMonthly=$$(t.repeatMonthly).getValue(),e.isEnabled=$$(t.isEnabled).getValue(),e.triggerKey=$$(t.triggerKey)?.getValue(),e}}const s=e.Class.ABProcessTaskManager.allTasks().filter((e=>e.defaults().key==o.key))[0].defaults();return o}},2135:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(t,i){super(`${t}_ofc`,{queryBuilder:"",queryBuilderContainer:"",queryBuilderLayout:"",showQBButton:""}),this.label=i,this.FilterComplex=e.filterComplexNew(`${this.ids.component}_fc`,{isSaveHidden:!0})}cleanRules(e,t,i){void 0===i&&(i=!0),function e(n){if(n)if(n.glue&&n.rules)n.rules.forEach((t=>{e(t)}));else{var a=t.filter((e=>e.id==n.key))[0];if(a)switch(a.type){case"number":case"formula":"string"==typeof n.value&&(-1==n.value.indexOf(".")?n.value=parseInt(n.value):n.value=parseFloat(n.value));break;case"date":i?n.value instanceof Date&&(n.value=webix.i18n.dateFormatStr(n.value)):"string"==typeof n.value&&(n.value=new Date(n.value))}}}(e)}ui(){const e=this.ids;let t={id:e.queryBuilderLayout,view:"layout",hidden:!0,type:"line",rows:[{id:e.showQBButton,cols:[{fillspace:!0},{view:"button",css:"webix_primary",name:"addqb",value:a("Add Custom Conditions"),autowidth:!0,click:()=>{$$(e.queryBuilderContainer).show(),$$(e.queryBuilderContainer).resize(),$$(e.showQBButton).hide(),this.FilterComplex.fieldsLoad(this.conditionFields(),this.CurrentObject)}},{fillspace:!0}]},{hidden:!0,id:e.queryBuilderContainer,cols:[{view:"layout",height:200,rows:[this.FilterComplex.ui]}]}]};return this.label&&t.rows[1].cols.unshift({view:"label",css:"ab-text-bold",label:this.label,width:i.labelWidthLarge}),t}init(e){this.AB=e,this.FilterComplex.init()}objectLoad(e){super.objectLoad(e),this.FilterComplex.fieldsLoad(this.conditionFields(),e)}getValue(){var e=this.FilterComplex.getValue();let t=this.conditionFields();return e&&this.cleanRules(e,t,!0),e}setValue(e){Array.isArray(e)&&(e=e[0]),e=e||{glue:"and",rules:[]},this.cleanRules(e,this.conditionFields(),!1),this.FilterComplex.setValue(e)}conditionFields(){var e=["string","LongText","number","date","email","formula","calculate"],t=[];return this.CurrentObject&&this.CurrentObject.fields().forEach((i=>{-1!=e.indexOf(i.key)&&t.push(i)})),t}}}},8975:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(2135),a=i(3285);function o(e){const t=(0,a.Z)(e),i=e.Config.uiSettings(),o=t.L(),s=(0,n.Z)(e);return class extends t{constructor(e,t){super(e,{selectAction:"",queryBuilder:"",valueDisplay:""});var i=webix.uid();Object.keys(this.ids).forEach((e=>{this.ids[e]=`${e}_${i}`})),this.listActions=t||[],this.actionDropList=[],this.listActions.forEach((e=>{this.actionDropList.push({id:e.key,value:e.label})})),this.selectedAction=null,this.actionDropList.length>0&&(this.selectedAction=this.actionDropList[0].id),this.removable=!0,this.objectQB=null}init(e){this.AB=e,this.objectQB?.init(e);var t=this.currentAction();t&&t.init(this.AB)}ui(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rules",padding:20,type:"line",rows:[{view:"template",css:"ab-component-form-rules-delete",template:'<i class="fa fa-trash ab-component-remove"></i>',height:30,borderless:!0,hidddatasourceen:0==this.removable,onClick:{"ab-component-remove":()=>{this.emit("delete",this)}}},{id:this.ids.selectAction,view:"richselect",label:o("Action"),placeholder:o("Choose an action"),labelWidth:i.labelWidthLarge,options:this.actionDropList,on:{onChange:(e,t)=>{this.selectAction(e,t)}}},{for:"values",hidden:!0,cells:[{view:"layout",cols:[{view:"label",label:o("Values"),css:"ab-text-bold",width:i.labelWidthLarge},{id:this.ids.valueDisplay,view:"layout",rows:[{label:o(" ABViewRule: This should be the Set Area"),css:"ab-text-bold",height:30}]}]}]},this.objectQB.ui()]}}replaceValueDisplay(e){var t=$$(this.ids.valueDisplay);if(t){var i=t.getChildViews(),n=[];i.forEach((e=>{n.push(e)})),n.forEach((e=>{t.removeView(e)})),t.addView(e.ui())}}selectAction(e,t){e&&$$(this.ids.component).getChildViews().forEach((e=>{e.show()}));var i=this.getAction(t);i&&i.stashCondition(this.objectQB.getValue()),this.selectedAction=e;var n=this.currentAction();n&&(this.objectQB?.setValue(n.condition()),this.replaceValueDisplay(n),n.init(this.AB))}conditionFields(){var e=[],t=this.currentAction();return t&&(e=t.conditionFields()),e}currentAction(){return this.getAction(this.selectedAction)}getAction(e){return this.listActions.filter((t=>t.key==e))[0]}objectLoad(e){super.objectLoad(e),this.listActions.forEach((t=>{t.objectLoad(e)}));var t=o("When");this.objectQB=new s(this.ids.component,t),this.objectQB.objectLoad(e)}formLoad(e){this.viewLoad(e),this.listActions.forEach((t=>{t.formLoad(e)}))}get currentForm(){return this.CurrentView}fromSettings(e){if((e=e||{}).selectedAction){this.selectedAction=e.selectedAction;var t=this.currentAction();if(!t)return;t.stashCondition(e.queryRules||{}),this.ids&&$$(this.ids.selectAction).setValue(this.selectedAction),t.fromSettings(e.actionSettings)}}toSettings(){var e={};if(this.selectedAction){e.selectedAction=this.selectedAction,e.queryRules=this.objectQB.getValue();let t=this.currentAction();t&&(e.actionSettings=t.toSettings())}return e}qbFixAfterShow(){var e=this.currentAction();e&&this.objectQB&&(this.objectQB.setValue(e.condition()),e.qbFixAfterShow())}async isReady(){let e=this.currentAction();return e?e.isReady():Promise.resolve()}isValid(e={}){var t={id:"hiddenQB_"+webix.uid(),hidden:!0,view:"querybuilder"},i=webix.ui(t),n=this.currentAction().condition();this.objectQB&&this.objectQB.cleanRules(n[0],n[1],!1);let a=n[0]||{},o=n[1]||[],s=(e="")=>"number"==typeof e?e:parseFloat(e.replace(/[^-0-9.]/g,""));o.filter((e=>"number"==e.type||"calculate"==e.type||"formula"==e.type)).forEach((t=>{try{a&&a.rules&&Array.isArray(a.rules)&&a.rules.forEach((e=>{e.key==t.id&&(e.value=s(e.value))})),e[t.id]&&"string"==typeof e[t.id]&&(e[t.id]=s(e[t.id]))}catch(e){}})),i.setValue({query:a,fields:o});var r=i.getFilterHelper()(e);return i.destructor(),r}get isPreProcess(){return this.currentAction().isPreProcess||!1}}}},6222:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e);return e.Config.uiSettings(),t.L(),class extends t{constructor(e,t){super(e,t);let i=webix.uid();Object.keys(this.ids).forEach((e=>{this.ids[e]=`${e}_${i}`})),this.key="ABViewRuleAction",this.queryObject=null,this.queryRules={},this.valueRules={}}ui(){return{}}init(e){return this.AB=e,Promise.resolve()}condition(){return[this.conditionRules(),this.conditionFields()]}stashCondition(e){Array.isArray(e)&&(e=e[0]),e&&("or"!=e.glue&&(e.glue="and"),e.rules=e.rules||[],this.queryRules=e)}conditionFields(){var e=["string","number","date","formula","calculate"],t=[];return this.queryObject&&this.queryObject.fields().forEach((i=>{-1!=e.indexOf(i.key)&&t.push({id:i.columnName,value:i.label,type:i.key})})),t}conditionRules(){return this.queryRules}objectLoad(e){super.objectLoad(e),this.queryObjectLoad(e)}queryObjectLoad(e){this.queryObject=e}formLoad(e){this.viewLoad(e)}get currentForm(){return this.CurrentView}valueDisplay(e){return this.valueDisplayComponent(e)}valueDisplayComponent(){return this._ui={ui:{template:"ABViewRuleAction.valueDisplayComponent"},init:e=>{console.error("!!! ABViewRuleAction.valueDisplayComponent() should be overridden."),console.warn(" --\x3e passed in data:",e)}}}fromSettings(e){e=e||{},this.valueRules=e.valueRules||{}}toSettings(){return{}}isReady(){return Promise.resolve()}qbFixAfterShow(){}}}},8791:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e,t){super(e=e||"ABViewRuleList",{rules:"",rulesScrollview:"",action:"",when:"",values:"",set:""}),this.listRules=[],(t=t||{}).labels=t.labels||{},t.labels.header=t.labels.header||i("Rule List"),t.labels.headerDefault=t.labels.headerDefault||i("Rule List"),this.childSettings=t}ui(){const e=this.ids;return{view:"window",id:e.component,modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:this.childSettings.labels.headerDefault},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:i("Add new rule"),width:150,click:()=>{this.addRule(),$$(e.rulesScrollview).scrollTo(0,$$(e.rules).$height)}}]},body:{type:"form",rows:[{view:"scrollview",id:e.rulesScrollview,scroll:"xy",body:{view:"layout",id:e.rules,margin:20,padding:10,rows:[]}},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:i("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}},{fillspace:!0}]}]}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}buttonCancel(){$$(this.ids.component)?.hide()}buttonSave(){var e=this.toSettings();this.emit("save",e),this.hide()}hide(){$$(this.ids.component)?.hide()}show(){$$(this.ids.component)?.show()}addRule(e){var t=this.getRule();if(t){this.listRules.push(t);var i=$$(this.ids.rules);i&&(i.addView(t.ui()),t.objectLoad(this.CurrentObject),t.on("delete",(e=>{$$(this.ids.rules).removeView(t.ids.component);var i=this.listRules.indexOf(e);-1!==i&&this.listRules.splice(i,1)}))),e&&t.fromSettings(e)}}fromSettings(e){this.listRules.forEach((e=>{this.ids?.rules&&e?.ids?.component&&$$(this.ids.rules).removeView(e.ids.component)})),this.listRules=[],e&&e.forEach((e=>{this.addRule(e)}))}objectLoad(e){super.objectLoad(e),this.listRules.forEach((t=>{t.objectLoad(e)}))}toSettings(){var e=[];return this.listRules.forEach((t=>{e.push(t.toSettings())})),e}getRule(){return console.error("!!! ABViewRuleList.getRule() should be overridded by a child object."),null}formLoad(e){this.viewLoad(e)}get currentForm(){return this.CurrentView}rulesReady(){return Promise.resolve()}qbFixAfterShow(){this.listRules.forEach((e=>{e.qbFixAfterShow()}))}}}},1538:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i(8791),a=i(8975),o=i(3285),s=i(6222);const r={filterConditions:{glue:"and",rules:[]}};function l(e){const t=(0,o.Z)(e),i=(0,s.Z)(e),n=e.Config.uiSettings(),a=i.L();class l extends t{constructor(e,t){super(e,{updateForm:""}),this.uniqueIDs(),this.base=e,this.Rule=t,this.valueRules=null}ui(){return{view:"form",id:this.ids.updateForm,elements:[]}}init(e,t){this.AB=e,t=t||this.valueRules,this.setValues(t)}removeAddRow(){const e=this.formGet();if(!e)return;const t=e.getChildViews().filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()}))))[0];t&&e.removeView(t)}addRow(e){const t=this.formGet();if(!t)return;const i=t.getChildViews();if(null==e&&i.filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()})))).length>0)return;const n=new c(this.base,this.Rule);t.addView(n.ui()),n.init(this.AB,e),n.on("add",(()=>{this.addRow()})),n.on("delete",(e=>{this.delRow(e)})),this.Rule.formRows.push(n)}delRow(e){this.Rule.formRows.forEach(((t,i)=>{t.ui.id==e&&this.Rule.formRows.splice(i,0)}));const t=this.formGet();t&&t.removeView($$(e))}formClear(){const e=this.formGet();if(!e)return;const t=e.getChildViews(),i=[];t.forEach((e=>{i.push(e)})),i.forEach((t=>{e.removeView(t)})),this.Rule.formRows=[]}formGet(){const e=$$(this.ids.updateForm);if(!e){let e="ABViewRuleActionFormRecordRuleUpdate.formGet() could not find webix form.";return this.AB.notify.developer(new Error(e),{context:e,updateForm:this.ids.updateForm}),null}return e}setValues(e){(e=e||{}).fieldOperations=e.fieldOperations||[],this.formGet()&&(this.formClear(),e.fieldOperations.length>0&&e.fieldOperations.forEach((e=>{this.addRow(e)})),this.removeAddRow(),this.addRow())}fromSettings(e){const t=e.valueRules||e;this.setValues(t)}toSettings(){const e={fieldOperations:[]};return this.Rule.formRows.forEach((t=>{const i=t.toSettings();i&&e.fieldOperations.push(i)})),e}}class c extends t{constructor(e,t){super(e,{row:"",updateForm:"",field:"",value:"",selectDc:"",selectBy:"",queryField:"",multiview:"",buttonAdd:"",buttonDelete:""}),this.uniqueIDs(),this.base=e,this.FilterComponent=null,this.Rule=t}ui(){const e=this.ids;return{id:e.row,view:"layout",rows:[{cols:[{view:"label",width:n.labelWidthSmall,label:a("Set")},{id:e.field,view:"combo",name:"field",placeholder:a("Choose a field"),height:32,options:this.getFieldList(!0),on:{onChange:e=>{this.selectField(e)}}},{view:"label",width:n.labelWidthSmall,label:a("To")},{},{view:"button",css:"webix_danger",id:e.buttonDelete,icon:"fa fa-trash",type:"icon",width:30,hidden:!0,click:()=>{this.emit("delete",e.row)}}]},{}]}}datacollections(e=(()=>!0)){return this.Rule.CurrentApplication?.datacollectionsIncluded(e)??[]}buttonsToggle(){const e=$$(this.ids.row).getChildViews()[0].getChildViews();e[4].hide(),e[5].show()}getFieldList(e){let t=[];if(this.Rule.CurrentObject&&(t=(this.Rule.CurrentObject.fields()||[]).map((e=>({id:e.id,value:e.label}))),e)){const e={};this.Rule.formRows.forEach((t=>{const i=$$(t.ids.row);if(i){const t=i.getChildViews()[0].getChildViews()[1];e[t.getValue()]=!0}})),t=t.filter((t=>!e[t.id]))}return t}isValid(){const e=this.ids,t=this.AB.Validation.validator(),i=$$(e.row).getChildViews()[0].getChildViews()[3],n=i.getParentView().getParentView(),o=this.Rule.getUpdateObjectField($$(e.field).getValue());if(o){const e=o.getValue(i,{}),s={};return s[o.columnName]=e,o.isValidData(s,t),(""==e||null==e||Array.isArray(e)&&0==e.length)&&t.addError(o.columnName,a("")),n.clearValidation(),t.updateForm(n),t.pass()}{const t=$$(e.row).getChildViews()[0].getChildViews()[1];return t.define("invalidMessage",a("A value is required")),t.define("invalid",!0),t.refresh(),!1}}selectField(e){const t=this.ids,i=this.Rule.getUpdateObjectField(e);if(!i)return;let n,o,s=i.formComponent().newInstance(this.Rule.CurrentApplication).component();if(console.warn("TODO: remove this testing code:"),n="function"==typeof s.ui?s.ui():s.ui,n.rows[0]?n.rows[0].id=t.value:n.id=t.value,"user"==i.key){n.id=`update_container_${i.id}`,s.ids.component=t.value;const e=n.rows[0].rows[0];e.id=t.value;const o=e.suggest.on.onShow;e.suggest.on.onShow=async()=>{await o();const e=$$(t.value);if(!e)return!0;const i=e.getList().find({})??[];i.unshift({id:"ab-current-user",value:`[${a("Current User")}]`}),e.blockEvent(),e.getList().clearAll(),e.getList().define("data",i),e.unblockEvent()},i.on("option.data",(()=>{e.suggest.on.onShow()}))}let r=this.datacollections((e=>e.datasource)),l=[];r.forEach((e=>{l.push({id:e.id,value:e.label,icon:e.settings.isQuery?"fa fa-filter":"fa fa-database"})}));const c=[{id:"select-one",value:a("Current selection")},{id:"filter-select-one",value:a("Select first after filter by...")}],d={type:"clean",rows:[{cols:[{id:t.selectDc,view:"richselect",options:{data:l},placeholder:a("Choose a data source"),on:{onChange:e=>{const n=this.datacollections((t=>t.id==e))[0];if(!n||"query"!=n.sourceType&&"connectObject"==i.key)$$(t.queryField).hide();else{const e=[];n.datasource.fields().forEach((t=>{e.push({id:t.id,value:t.label})})),$$(t.queryField).define("options",e),$$(t.queryField).refresh(),$$(t.queryField).show()}}}},{id:t.queryField,view:"combo",hidden:!0,placeholder:a("Choose value from..."),options:[{id:1,value:"figure this out"}]}]},{id:t.selectBy,view:"combo",options:c,placeholder:a("Choose select option"),on:{onChange:e=>{const i=$$(t.row);if(i.removeView(i.getChildViews()[1]),"select-one"==e)i.addView({},1);else{const e=(this.Rule.CurrentView?.datacollection?.datasource?.fields()??[]).map((function(e){return{id:e.id,value:e.label}}));this.FilterComponent=this.AB.filterComplexNew(this.base,{height:200,isSaveHidden:!0}),this.FilterComponent.init({isRecordRule:!0,recordRuleFieldOptions:e}),console.warn("TODO: remove this transition Code:"),"function"==typeof this.FilterComponent.ui?i.addView(this.FilterComponent.ui(),1):i.addView(this.FilterComponent.ui,1);const n=$$(t.selectDc).getValue(),a=this.datacollections((e=>e.id==n))[0];a&&this.populateFilters(a)}}}}]};if(i.isConnection&&"user"!=i.key){const e=i.datasourceLink;r=r.filter((t=>t.datasource.id==e.id));const n=this.datacollections((t=>"query"==t.sourceType&&t.datasource&&t.datasource.canFilterObject(e)));r=r.concat(n),l=[],r.forEach((e=>{l.push({id:e.id,value:e.label,icon:e.settings.isQuery?"fa fa-filter":"fa fa-database"})})),c.push({id:"filter-select-all",value:a("Select all after filter by...")}),o=d,$$(t.selectDc)?($$(t.selectDc).parse?$$(t.selectDc).parse(l):$$(t.selectDc).define("options",l),$$(t.selectDc).refresh()):o.rows[0].cols[0].options=l,s={init:function(){}}}else o={id:t.multiview,view:"multiview",cells:[{batch:"custom",rows:[n,{view:"label",label:a("<a>Or exists value</a>"),on:{onItemClick:function(){this.getParentView().getParentView().showBatch("exist")}}}]},{batch:"exist",rows:[d,{view:"label",label:a("<a>Or custom value</a>"),on:{onItemClick:function(){const e=this.getParentView().getParentView();$$(t.selectBy).setValue("select-one"),e.showBatch("custom")}}}]}]};const u=$$(t.row).getChildViews()[0];if(u.removeView(u.getChildViews()[3]),u.addView(o,3),s.init(),!i.isConnection&&i.customDisplay){const e=$$(n.id).$view;setTimeout((()=>{i.customDisplay(i,this.AB._App,e,{editable:!0,isForm:!0})}),50)}u.getChildViews()[4].show(),e&&this.emit("add")}setValue(e){const t=this.ids;$$(t.field).setValue(e.fieldID);const i=this.Rule.getUpdateObjectField(e.fieldID);if(i){const n=()=>{$$(t.selectDc).setValue(e.value),e.queryField&&$$(t.queryField).setValue(e.queryField);const i=e.selectBy||"select-one";if($$(t.selectBy).setValue(i),"select-one"!=i){const t=e.value,i=this.datacollections((e=>e.id==t))[0];i&&e.filterConditions&&this.populateFilters(i,e.filterConditions)}};"connectObject"==i.key?n():"exist"==e.valueType?($$(t.multiview)?.showBatch("exist"),n()):($$(t.multiview)?.showBatch("custom"),setTimeout((function(){const n={};n[i.columnName]=e.value,i.setValue($$(t.value),n)}),50))}}populateFilters(e,t){t=t??r.filterConditions,this.FilterComponent.fieldsLoad(e.datasource?e.datasource.fields():[]),this.FilterComponent.setValue(t)}toSettings(){const e=this.ids,t=$$(e.field).getValue();if(!t)return null;const i={fieldID:t},n=$$(e.value),a=this.Rule.getUpdateObjectField(i.fieldID);return"connectObject"==a.key||"exist"==$$(e.multiview).config.visibleBatch?(()=>{i.value=$$(e.selectDc).getValue(),i.queryField=$$(e.queryField).getValue(),i.op="set",i.type=a.key,i.selectBy=$$(e.selectBy).getValue(),i.valueType="exist",this.FilterComponent&&(i.filterConditions=this.FilterComponent.getValue())})():(i.value=a.getValue(n,{}),i.op="set",i.type=a.key,i.valueType="custom"),i}init(e,t){return this.AB=e,t&&this.setValue(t),Promise.resolve()}}return class extends i{constructor(e,t){super(e,t),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=a("Update Record"),this.formRows=[],this.stashRules={}}ui(){return this._uiUpdater||this.valueDisplayComponent(),this._uiUpdater.ui()}init(){this._uiUpdater?.init(e,this.valueRules)}valueDisplayComponent(e){return null==this._uiUpdater&&(this._uiUpdater=new l(e??this.ids.component,this)),this._uiUpdater}getUpdateObjectField(e){return this.CurrentObject.fieldByID(e)}objectLoad(e){this.CurrentObject&&(this.stashRules[this.CurrentObject.id]=this.valueRules),super.objectLoad(e),e&&(this.valueRules=this.stashRules[this.CurrentObject.id]||{})}fromSettings(e){if(e=e||{},super.fromSettings(e),e.updateObjectID){const t=this.AB.objectByID(e.updateObjectID);this.objectLoad(t)}this._uiUpdater&&this._uiUpdater.fromSettings(e)}toSettings(){const e=super.toSettings();return e.valueRules=this._uiUpdater?.toSettings(),e.updateObjectID=this.CurrentObject.id,e}}}var c=i(2135);function d(e){const t=(0,o.Z)(e),i=(0,s.Z)(e),n=l(e),a=n.L(),r=(0,c.Z)(e);class d extends t{constructor(e,t,i){super(e,{updateForm:"",selectConnectedField:"",updateFieldsForm:""}),this.base=e,this.RuleAction=t,this.options=i??{},this.uniqueIDs(),this.ObjectUpdater=new n(`${this.base}_objupdater`,{})}ui(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rule",rows:[{id:this.ids.selectConnectedField,view:"richselect",label:a("Select which connected object to update."),labelWidth:300,value:this.RuleAction.selectedField(),options:this.RuleAction.fieldDropList,on:{onChange:(e,t)=>{this.selectAction(e,t)}}}]}}init(e){return this.ObjectUpdater.init(e)}addDisplay(e){$$(this.ids.component).addView(e)}removePreviousDisplays(){var e=$$(this.ids.component).getChildViews(),t=[];e.forEach((e=>{t.push(e)})),t.forEach((e=>{e.config.id!=this.ids.selectConnectedField&&$$(this.ids.component).removeView(e)}))}selectAction(e){this.removePreviousDisplays(),this.RuleAction.selectedFieldID=e;var t=this.RuleAction.connectedObject();if(t){if(this.ObjectUpdater.objectLoad(t),this.ObjectUpdater.applicationLoad(this.RuleAction.CurrentApplication),this.updateComponent=this.ObjectUpdater.valueDisplayComponent(this.ids.updateFieldsForm),this.showQBIfNeeded(),this.addDisplay(this.updateComponent.ui()),this.updateComponent.init(this.AB),this.options?.isUpdateValueDisabled){let e=this.updateComponent.formGet();e&&(e.disable(),e.hide())}}else this.AB.notify.builder(new Error("No connectedObject found."),{fieldID:this.selectedFieldID})}showQBIfNeeded(){var e=this.RuleAction.queryBuilderDisplay(this.base);this.addDisplay(e.ui()),e.init(this.AB)}fromSettings(e){$$(this.ids.selectConnectedField).setValue(e.selectedFieldID),this.objectQB&&this.objectQB.setValue(this.qbCondition),this.updateComponent&&this.updateComponent.fromSettings(e)}toSettings(){return this.updateComponent?.toSettings()??{}}}return class extends i{constructor(e){super(e,{}),this.key="ABViewRuleActionFormRecordRuleUpdateConnected",this.label=a("Update Connected Record"),this.selectedFieldID=null,this.fieldDropList=[],this.objectQB=null,this.qbCondition=null,this._uiChooser=null}ui(){return this._uiChooser||this.valueDisplayComponent(this.base),this._uiChooser.ui()}objectLoad(e){super.objectLoad(e),this.connectedFieldList().forEach((e=>{this.fieldDropList.push({id:e.id,value:e.label})}))}connectedFieldList(){return this.CurrentObject.connectFields()}connectedObject(){if(this.selectedFieldID){var e=this.selectedField();if(e)return e.datasourceLink}return null}selectedField(){return this.connectedFieldList().filter((e=>e.id==this.selectedFieldID))[0]}valueDisplayComponent(e){return null==this._uiChooser&&(this._uiChooser=new d(e,this,{isUpdateValueDisabled:this.isUpdateValueDisabled})),this._uiChooser}superValueDisplayComponent(e){return super.valueDisplayComponent(e)}queryBuilderDisplay(e){if(!this.objectQB){this.objectQB=new r(e,a("How to choose which object:"));var t=this.connectedObject();t&&this.objectQB.objectLoad(t)}return this.objectQB}fromSettings(e){e=e||{},this.selectedFieldID=e.selectedFieldID||null,this.qbCondition=e.qbCondition||{},super.fromSettings(e),this._uiChooser&&this._uiChooser.fromSettings(e)}toSettings(){var e=super.toSettings();e.selectedFieldID=this.selectedFieldID;var t=null;return this.objectQB&&(t=this.objectQB.getValue(),Array.isArray(t)&&(t=t[0]),t&&(t.glue=t.glue||"and")),e.qbCondition=t,this._uiChooser&&(e.valueRules=this._uiChooser.toSettings()),e}qbFixAfterShow(){this.objectQB&&this.objectQB.setValue(this.qbCondition)}}}function u(e,t){const i=(0,n.Z)(e),o=(0,a.Z)(e),s=i.L(),r=function(e){const t=l(e);return class extends t{constructor(t){super(t,{}),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=((...t)=>e.Multilingual.label(...t))("Update Record")}}}(e),c=function(e){const t=d(e);return class extends t{constructor(t){super(t,{}),this.key="ABViewRuleActionFormRecordRuleInsertConnected",this.label=((...t)=>e.Multilingual.label(...t))("Insert Connected Object")}}}(e),u=d(e),h=function(e){const t=d(e);return class extends t{constructor(t){super(t,{}),this.key="ABViewRuleActionFormRecordRuleRemoveConnected",this.label=((...t)=>e.Multilingual.label(...t))("Remove Connected Record"),this.isUpdateValueDisabled=!0}}}(e);return new class extends i{constructor(e="ABViewRuleListFormRecordRules"){super(e,{labels:{header:s("Record Rules"),headerDefault:s("Record Rules")}}),this.base=e}getRule(){var e=[new r(`${this.base}_ruleActionUpdate`),new c(`${this.base}_ruleActionInsertConnected`),new u(`${this.base}_ruleActionUpdateConnected`),new h(`${this.base}_ruleActionRemoveConnected`)],t=new o(`${this.base}_rule_record`,e);return t.init(this.AB),t.objectLoad(this.CurrentObject),t.formLoad(this.currentForm),t}}(t)}},708:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(8791),a=i(8975),o=i(6222);function s(e,t){const i=(0,n.Z)(e),s=(0,a.Z)(e),r=i.L(),l=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{message:""}),this.key="ABViewRuleActionFormSubmitRuleConfirmMessage",this.label=i("Show a confirmation message"),this.formRows=[]}ui(){return{id:this.ids.message,view:"textarea",height:130}}init(e){return this.AB=e,Promise.resolve()}fromSettings(e){e=e||{},super.fromSettings(e),$$(this.ids.message)?.setValue(e.message||"")}toSettings(){var e=super.toSettings();return e.message=$$(this.ids.message)?.getValue()||"",e}}}(e),c=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{pagesAndTabs:""}),this.key="ABViewRuleActionFormSubmitRuleExistPage",this.label=i("Redirect to an existing page"),this.formRows=[]}ui(){return{id:this.ids.pagesAndTabs,view:"richselect",options:[]}}init(e){this.AB=e,this.refreshUI()}fromSettings(e){super.fromSettings(e);const t=e.valueRules||{};$$(this.ids.pagesAndTabs).setValue(t.tabId??t.pageId??"")}toSettings(){const e=this.ids,t=super.toSettings(),i=$$(e.pagesAndTabs).getValue(),n=$$(e.pagesAndTabs).getPopup().getList().config.data.filter((e=>e.id==i))[0];return n&&("tab"==n.type?t.valueRules={pageId:n.pageId,tabId:i}:t.valueRules={pageId:i}),t}refreshUI(){const e=this.ids,t=[],i=(e,n,a,o)=>{n=n||"";const s="tab"==a?"fa fa-window-maximize":"fa fa-file-o",r=e.pageParent();t.push({id:e.id,value:`${n}${e.label}`,type:a,pageId:r?.id,icon:s}),"page"!=a&&"tab"!=a||((e?.pages?.()??[]).forEach((function(e){i(e,`${n}-`,"page")})),(e?.views?.((e=>"tab"==e.key))??[]).forEach((t=>{t.views().forEach((t=>{i(t,`${n}-`,"tab",e.id)}))})))};i(this.currentForm.pageRoot(),"","page"),$$(e.pagesAndTabs).define("options",t),$$(e.pagesAndTabs).refresh()}}}(e),d=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{}),this.key="ABViewRuleActionFormSubmitRuleParentPage",this.label=i("Redirect to the parent page"),this.formRows=[]}ui(){return{view:"label",label:this.label}}}}(e),u=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{}),this.key="ABViewRuleActionFormSubmitRuleClosePopup",this.label=i("Close the current popup"),this.formRows=[]}ui(){return{view:"layout",rows:[]}}}}(e),h=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{website:""}),this.key="ABViewRuleActionFormSubmitRuleWebsite",this.label=i("Redirect to another website URL"),this.formRows=[]}ui(){return{id:this.ids.website,view:"text"}}fromSettings(e){super.fromSettings(e);const t=e.valueRules||{};$$(this.ids.website).setValue(t.website??"")}toSettings(){const e=this.ids,t=super.toSettings();return t.valueRules={website:$$(e.website).getValue()??""},t}}}(e),p=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{form:"",popup:"",list:"",toEmailsContainer:"",toEmails:"",fromName:"",message:""}),this.key="ABViewRuleActionFormSubmitRuleEmail",this.label=i("Send a custom email"),this.formRows=[]}ui(){const e=this.ids,t=this;return{id:e.form,view:"form",width:450,elementsConfig:{labelPosition:"top",labelWidth:100},cols:[{width:330,rows:[{view:"text",name:"fromName",label:i("From Name")},{view:"text",name:"fromEmail",label:i("From Email"),validate:webix.rules.isEmail,on:{onChange:function(){this.getValue()&&!this.validate()?$$(e.form).markInvalid("fromEmail",i("Email is invalid")):$$(e.form).markInvalid("fromEmail",!1)}}},{id:e.toEmailsContainer,view:"forminput",name:"toEmails",label:i("Send"),css:"ab-rich-text",width:320,body:{width:320,rows:[{height:25},{id:e.toEmails,width:320,view:"layout",rows:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:i("Add a recipient"),width:150,click:()=>{this.toEmailAdd()}}]}},{view:"text",name:"subject",label:i("Subject")},{id:e.message,view:"textarea",name:"message",label:i("Message"),width:320,height:400}]},{rows:[{view:"template",type:"header",template:"Fields"},{id:e.list,view:"list",width:120,css:{"background-color":"#fff !important;"},template:(e,t)=>this.fieldTemplate(e,t),on:{onItemClick:function(e){var i=this.getItem(e);t.enterField(i)}}}]}]}}init(e){this.AB=e;const t=this.ids;this.CurrentObject&&($$(t.list).parse(this.CurrentObject.fields((e=>e.fieldUseAsLabel()))),$$(t.list).refresh()),this.refreshUI()}fromSettings(e){super.fromSettings(e);let t=e.valueRules||{};$$(this.ids.form).setValues(t),(t.toEmails||[]).forEach((e=>{this.toEmailAdd({type:e.type,emailType:e.emailType,value:e.value})})),this.refreshUI()}toSettings(){const e=this.ids;var t=super.toSettings(),i=$$(e.form).getValues()||{},n=[];return $$(e.toEmails).getChildViews().forEach((e=>{var t=e.queryView({name:"emailType"}).getValue(),i=e.queryView({name:t}).getValue();n.push({type:"to",emailType:t,value:i})})),t.valueRules={fromName:i.fromName,fromEmail:i.fromEmail,toEmails:n,subject:i.subject,message:i.message},t}toEmailTemplate(e){const t=this;return{width:320,cols:[{view:"richselect",name:"emailType",value:(e=e||{}).emailType||"email",width:150,options:[{id:"email",value:i("A custom email address")},{id:"field",value:i("An email field")},{id:"query",value:i("From query")}],on:{onChange:function(e){t.emailTypeChange(e,this)}}},{width:150,name:"emailValue",visibleBatch:e.emailType||"email",cols:[{view:"text",name:"email",batch:"email",value:"email"==e.emailType?e.value:"",validate:webix.rules.isEmail,width:150,on:{onChange:()=>{this.toEmailValidate()}}},{view:"richselect",name:"field",batch:"field",value:"field"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:this.emailFieldOptions()}},{view:"richselect",name:"query",batch:"query",value:"query"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:this.queryOptions()}}]},{view:"button",css:"webix_danger",type:"icon",icon:"fa fa-trash-o",width:32,click:function(){var e=this.getParentView();t.toEmailRemove(e)}}]}}toEmailAdd(e){var t=$$(this.ids.toEmails).getChildViews().length;$$(this.ids.toEmails).addView(this.toEmailTemplate(e),t),this.refreshUI()}emailTypeChange(e,t){var n=t.getParentView().queryView({name:"emailValue"});switch(e){case"field":this.emailFieldOptions().length>0?n.showBatch("field"):(t.setValue("email"),webix.message(i("This form's chosen Datacollection has no Email Fields")));break;case"query":this.queryOptions().length>0?n.showBatch("query"):(t.setValue("email"),webix.message(i("There are no queries with Email Fields in this Application")));break;default:n.showBatch("email")}$$(this.ids.toEmailsContainer).adjust()}toEmailRemove(e){$$(this.ids.toEmails).removeView(e),this.refreshUI()}toEmailValidate(){let e=!0;$$(this.ids.toEmails).getChildViews().forEach((t=>{let i=t.queryView({name:"email"});i.getValue()&&!i.validate()&&(e=!1)})),e?$$(this.ids.form).markInvalid("toEmails",!1):$$(this.ids.form).markInvalid("toEmails",i("Email is invalid"))}fieldTemplate(e){return`<i class='fa fa-${e.icon} webix_icon_btn' aria-hidden='true'></i> ${e.label}`}emailFieldOptions(){var e=[],t=[],i=(e,i)=>{var n=e.fields((e=>"email"==e.key)).map((t=>{var n="",a="";return i?(n=`${i.id}|${t.urlPointer()}`,a=`${e.label}.${t.label} (${i.label})`):(n=`|${t.urlPointer()}`,a=`${e.label}.${t.label}`),{id:n,value:a}}));t=t.concat(n)};return i(this.CurrentObject),this.CurrentObject.connectFields().forEach((t=>{e.indexOf(t.id)>-1||(e.push(t.id),i(t.datasourceLink,t))})),t}queryOptions(){var e=[];return this.currentForm.application.datacollectionsIncluded((e=>{let t=e.datasource;return e.settings.isQuery&&t&&t.fields((e=>"email"==e.key)).length>0})).forEach((t=>{t.datasource&&t.datasource.fields((e=>"email"==e.key)).forEach((i=>{e.push({id:`${t.id}|${i.id}`,value:`${t.label}.${i.label}`})}))})),e}enterField(e){var t=webix.UIManager.getFocus(),i="";"text"==t.config.view&&"textarea"==t.config.view||(t.getValue&&(i=t.getValue()),t.setValue&&t.setValue(`${i}${e.label}`),webix.UIManager.setFocus(t))}refreshUI(){$$(this.ids.toEmailsContainer).adjust(),$$(this.ids.message).adjust()}}}(e);return new class extends i{constructor(e="ABViewRuleListFormSubmitRules"){super(e,{labels:{header:r("Submit Rules"),headerDefault:r("Submit Rules")}}),this.base=e}getRule(){var e=[new l(`${this.idBase}_ruleActionConfirmMessage`),new c(`${this.idBase}_ruleActionExistPage`),new d(`${this.idBase}_ruleActionParentPage`),new u(`${this.idBase}_ruleActionClosePopup`),new h(`${this.idBase}_ruleActionWebsite`),new p(`${this.idBase}_ruleActionEmail`)],t=new s(`${this.base}_rule`,e);return t.init(this.AB),t.objectLoad(this.CurrentObject),t.formLoad(this.currentForm),t}}(t)}},2418:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),a=null;function o(e){if(!a){const i=(0,n.Z)(e);var t=i.L();a=class extends i{constructor(t="properties_abview",i={}){var n={label:""};Object.keys(i).forEach((e=>{void 0===n[e]?n[e]="":console.error(`!!! ABFieldProperty:: passed in ids contains a restricted field : ${e}`)})),super(t,n),this.base=t,this.AB=e}ui(e=[],i={}){let n=this.ids,a={view:"form",id:n.component,scroll:!0,elements:[{id:n.label,view:"text",label:t("Name"),name:"name",value:""}],rules:{}};return e.forEach((e=>{a.elements.push(e)})),Object.keys(i).forEach((e=>{a.rules[e]=i[e]})),a}async init(e){this.AB=e,this.ViewClass()}clearEditor(){console.error("!!! Depreciated! call clear() instead."),this.clear()}clear(){$$(this.ids.label).setValue("")}propertyDatacollections(e){return e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label})))}defaults(){var e=this.ViewClass();return e?e.common():(console.error("!!! properties/views/ABView: could not find ViewClass"),null)}editorPopulate(e){console.error("!!! Depreciated. call populate() instead."),this.populate(e)}formValues(){return $$(this.ids.component).getValues()}isValid(){}markInvalid(e,t){$$(this.ids.component).markInvalid(e,t)}onChange(){this.emit("changed")}populate(e){this.viewLoad(e),$$(this.ids.label)?.setValue(e.label)}requiredOnChange(){}values(){let e={};return e.label=$$(this.ids.label).getValue(),e}ViewClass(){return console.error("!!! Child Class has not overwritten ViewClass()"),null}_ViewClass(e){var t=this.CurrentApplication;return t||(t=this.AB.applicationNew({})),t.viewAll((t=>t.common().key==e))[0]}}}return a}},1712:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(t){super(t??"properties_abview_csvexporter",{datacollection:"",buttonLabel:"",hasHeader:"",filename:"",width:"",buttonFilter:""}),this.AB=e,this.propertyFilter=this.AB.filterComplexNew(`${t}_filter`)}static get key(){return"csvExporter"}ui(){const e=this.ids;return super.ui([{view:"fieldset",label:a("Data:"),labelWidth:i.labelWidthLarge,body:{rows:[{id:e.datacollection,name:"datacollection",view:"richselect",label:a("Data Source"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{e!=t&&(this.populateFilter(),this.onChange())}}},{id:e.hasHeader,name:"hasHeader",view:"checkbox",label:a("Header on first line"),labelWidth:i.labelWidthXLarge},{cols:[{view:"label",label:a("Filter Option:"),css:"ab-text-bold",width:i.labelWidthLarge},{id:e.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.showFilterPopup()}}]}]}},{view:"fieldset",label:a("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.buttonLabel,name:"buttonLabel",view:"text",label:a("Label"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.filename,name:"filename",view:"text",label:a("File name"),labelWidth:i.labelWidthLarge},{id:e.width,view:"counter",name:"width",label:a("Width:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}]}}])}async init(e){this.AB=e,await super.init(e),this.propertyFilter.init(),this.propertyFilter.on("save",(e=>{this.onChange(),this.populateBadgeNumber()})),this.filter_popup=webix.ui({view:"popup",width:800,hidden:!0,body:this.propertyFilter.ui})}populate(e){super.populate(e),e.settings=e.settings??{};const t=this.ids,i=this.ViewClass().defaultValues();this.populateDatacollections(),$$(t.hasHeader).setValue(e.settings.hasHeader??i.hasHeader),$$(t.buttonLabel).setValue(e.settings.buttonLabel??i.buttonLabel),$$(t.filename).setValue(e.settings.filename??i.filename),$$(t.width).setValue(e.settings.width??i.width),this.populateFilter(),this.populateBadgeNumber()}populateDatacollections(){const e=this.CurrentView.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"}))),t=$$(this.ids.datacollection);t.define("options",e),t.define("value",this.CurrentView?.settings?.dataviewID??null),t.refresh()}populateBadgeNumber(){const e=this.ids,t=this.CurrentView;$$(e.buttonFilter).define("badge",t?.settings?.where?.rules?.length??null),$$(e.buttonFilter).refresh()}populateFilter(){const e=this.CurrentView,t=e.datacollection?.datasource;this.propertyFilter.fieldsLoad(t?.fields()??[]),this.propertyFilter.setValue(e.settings.where)}showFilterPopup(){const e=$$(this.ids.buttonFilter);this.propertyFilter.popUp(e?.$view)}values(){const e=this.ids,t=this.ViewClass().defaultValues(),i=super.values();return i.settings=i.settings??{},i.settings.dataviewID=$$(e.datacollection).getValue(),i.settings.hasHeader=$$(e.hasHeader).getValue(),i.settings.where=this.propertyFilter.getValue(),i.settings.buttonLabel=$$(e.buttonLabel).getValue()??t.buttonLabel,i.settings.filename=$$(e.filename).getValue()??t.filename,i.settings.width=$$(e.width).getValue()??t.width,i}ViewClass(){return super._ViewClass("csvExporter")}}}},231:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418),a=i(1538);let o=null;function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(t){super(t??"properties_abview_csvimporter",{datacollection:"",fields:"",buttonLabel:"",buttonRecordRules:"",width:""}),this.AB=e}static get key(){return"csvImporter"}ui(){const e=this.ids;return o=(0,a.Z)(this.AB,this.base),super.ui([{view:"fieldset",label:s("Data:"),labelWidth:i.labelWidthLarge,body:{id:e.datacollection,name:"datacollection",view:"richselect",label:s("Data Source"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:e=>this.selectSource(e)}}},{view:"fieldset",label:s("Available Fields:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fields,name:"fields",view:"list",select:!1,minHeight:250,template:this.listTemplate.bind(this),type:{markCheckbox:function(e){return`<span class='check webix_icon fa fa-${e.selected?"check-":""}square-o'></span>`}},onClick:{check:this.check.bind(this)}}]}},{view:"fieldset",label:s("Rules:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:s("Record Rules:"),width:i.labelWidthLarge},{id:e.buttonRecordRules,view:"button",name:"buttonRecordRules",css:"webix_primary",label:s("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:this.recordRuleShow.bind(this)}]}]}},{view:"fieldset",label:s("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.buttonLabel,name:"buttonLabel",view:"text",label:s("Label"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>this.onChange()}},{id:e.width,view:"counter",name:"width",label:s("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>this.onChange()}}]}}])}async init(e){this.AB=e,await super.init(e),o.init(e),o.on("save",(()=>{this.populateBadgeNumber()}))}selectSource(e){const t=this.CurrentView;t.settings=t.settings??{},t.settings.dataviewID=e,this.updateRules(),this.populateAvailableFields({selectAll:!0}),this.onChange()}updateRules(){const e=this.CurrentView.datacollection;e?.datasource&&o.objectLoad(e.datasource),o.fromSettings(this.CurrentView?.settings?.recordRules??[])}populateAvailableFields(e={}){const t=this.ids,i=this.CurrentView,n=this.AB.datacollectionByID(i.settings.dataviewID)?.datasource;i.settings=i.settings??{};const a=i.settings.availableFieldIds??[],o=n?.fields()?.map((t=>(t.selected=!!e.selectAll||a.filter((e=>t.id==e)).length>0,t)));$$(t.fields).clearAll(),$$(t.fields).parse(o)}populateBadgeNumber(){const e=this.ids,t=this.CurrentView;t&&($$(e.buttonRecordRules).define("badge",t.settings?.recordRules?.length??null),$$(e.buttonRecordRules).refresh())}listTemplate(e,t){const i=e.formComponent();if(null==i)return`<i class='fa fa-times'></i>  ${e.label} <div class='ab-component-form-fields-component-info'> Disable </div>`;const n=i.common().key,a=this.CurrentApplication.viewAll((e=>e.common().key==n))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${a?.common()?.icon??"fw"}'></i> ${a?s(a.common().labelKey??"Label"):""} </div>`}check(e,t){const i=this.ids;let n=$$(i.fields).getItem(t);n.selected=n.selected?0:1,$$(i.fields).updateItem(t,n),this.onChange()}recordRuleShow(){this.updateRules(),o.CurrentObject&&o.show(),o.qbFixAfterShow()}populate(e){super.populate(e);const t=this.ids;e.settings=e.settings??{},this.populateDataCollections(),this.populateAvailableFields(),$$(t.buttonLabel).setValue(e.settings.buttonLabel),$$(t.width).setValue(e.settings.width),e.settings.availableFieldIds=[],($$(t.fields).find({selected:!0})||[]).forEach((t=>{e.settings.availableFieldIds.push(t.id)}))}populateDataCollections(){const e=this.ids,t=this.CurrentView,i=this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"}))),n=$$(e.datacollection);n.define("options",i),n.define("value",t.settings.dataviewID),n.refresh()}defaultValues(){const e={dataviewID:null,buttonLabel:"Upload CSV",width:0,recordRules:[],availableFieldIds:[]},t=this.ViewClass();if(t){const i=t.defaultValues();Object.keys(i).forEach((t=>{e[t]=i[t]}))}return e}values(){const e=this.ids,t=super.values();return t.settings=t.settings??{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.recordRules=o.toSettings(),t.settings.buttonLabel=$$(e.buttonLabel).getValue(),t.settings.width=$$(e.width).getValue(),t.settings.availableFieldIds=[],$$(e.fields).find({selected:!0}).forEach((e=>{t.settings.availableFieldIds.push(e.id)})),t}ViewClass(){return super._ViewClass("csvImporter")}toSettings(){var e=this.defaults();return e.settings=this.defaultValues(),e}}}},814:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418),a=i(4245),o=i(8782);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L(),r="properties_abview_carousel",l=new((0,a.Z)(e,r)),c=new o.Z(e,r);return class extends t{constructor(){super(r,{datacollection:"",field:"",filterByCursor:"",width:"",height:"",showLabel:"",hideItem:"",hideButton:"",navigationType:"",gridFilterMenuButton:"",detailsPage:"",editPage:""}),this.ABFieldImage=e.Class.ABFieldManager.fieldByKey("image"),this._preFilterSettings=null,this.linkPageComponent=new c}static get key(){return"carousel"}ui(){let e=this.ids,t=this;return super.ui([{view:"fieldset",label:s("Data:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.datacollection,view:"select",name:"datacollection",label:s("Datacollection:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:(t,i)=>{if(t!=i){this.linkPageComponent.clear();let i=[],n=this.AB.datacollectionByID(t);if(n){let e=n.datasource;e&&(i=e.fields((e=>e instanceof this.ABFieldImage)).map((e=>({id:e.id,value:e.label})))||[])}i.length>0?i.unshift({id:"",value:s("Select a field")}):i.unshift({id:"",value:s("no image fields.")}),$$(e.field).define("options",i),$$(e.field).refresh(),this.onChange()}}}},{id:e.field,view:"select",name:"field",label:s("Image Field:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange()}}},{id:e.filterByCursor,view:"checkbox",name:"filterByCursor",labelWidth:0,labelRight:s("Filter images by cursor"),on:{onChange:()=>{this.onChange()}}}]}},this.linkPageComponent.ui(),{view:"fieldset",label:s("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.navigationType,view:"select",name:"navigationType",label:s("Navigation Type"),labelWidth:i.labelWidthLarge,options:[{id:"corner",value:s("Corner")},{id:"side",value:s("Side")}],on:{onChange:()=>{this.onChange()}}},{id:e.showLabel,view:"checkbox",name:"showLabel",labelRight:s("Show label of image"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.hideItem,view:"checkbox",name:"hideItem",labelRight:s("Hide item list"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.hideButton,view:"checkbox",name:"hideButton",labelRight:s("Hide navigation buttons"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.width,view:"counter",name:"width",label:s("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:s("Height:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{cols:[{view:"label",label:s("Filter Option:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.gridFilterMenuButton,view:"button",css:"webix_primary",label:s("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.filterMenuShow(this.$view)}}]}]}}])}async init(e){super.init(e),this._handler_onCancel=()=>{l.setSettings(this._preFilterSettings),this.filter_property_popup.hide()},this.filter_property_popup=webix.ui({view:"window",modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",hidden:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:s("Filter Menu")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:this._handler_onCancel,on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:l.ui()}),l.on("cancel",this._handler_onCancel),l.on("save",(()=>{this.filter_property_popup.hide(),this.onChange()}));let i=[];return i.push(l.init(e)),i.push(this.linkPageComponent.init(e)),Promise.all(i)}populate(e){super.populate(e);let t=this.ids;if(e){var i=this.propertyDatacollections(e);$$(t.datacollection).define("options",i),$$(t.datacollection).refresh(),$$(t.datacollection).setValue(e.settings.dataviewID),$$(t.field).setValue(e.settings.field),$$(t.filterByCursor).setValue(e.settings.filterByCursor),$$(t.width).setValue(e.settings.width),$$(t.height).setValue(e.settings.height),$$(t.showLabel).setValue(e.settings.showLabel),$$(t.hideItem).setValue(e.settings.hideItem),$$(t.hideButton).setValue(e.settings.hideButton),$$(t.navigationType).setValue(e.settings.navigationType);var n=e.datacollection;n&&(l.objectLoad(n.datasource),l.setSettings(e.settings.filter)),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}filterMenuShow(){this._preFilterSettings=l.getSettings(),this.filter_property_popup.show()}values(){let e=this.ids,t=super.values();t.settings=t.settings||{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.field=$$(e.field).getValue(),t.settings.filterByCursor=$$(e.filterByCursor).getValue()||!1,t.settings.width=$$(e.width).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.hideItem=$$(e.hideItem).getValue(),t.settings.hideButton=$$(e.hideButton).getValue(),t.settings.navigationType=$$(e.navigationType).getValue(),t.settings.filter=l.getSettings();let i=this.linkPageComponent.getSettings();for(let e in i)t.settings[e]=i[e];return t}ViewClass(){return super._ViewClass("carousel")}}}},7887:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3156);function a(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_chart",{dataviewID:"",columnLabel:"",columnValue:"",multipleSeries:"",columnValue2:""}),this.AB=e}static get key(){return"chart"}ui(){const e=this.ids;return super.ui([{id:e.dataviewID,name:"dataviewID",view:"richselect",label:a("Chart Data"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange(),this.populateFieldOptions(),$$(e.multipleSeries).getValue()&&this.populateFieldOptions2()}}},{id:e.columnLabel,name:"columnLabel",view:"richselect",label:a("Label Column"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange()}}},{id:e.columnValue,name:"columnValue",view:"richselect",label:a("Value Column"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange()}}},{id:e.multipleSeries,name:"multipleSeries",view:"checkbox",label:a("Multiple Series"),labelWidth:i.labelWidthLarge,value:0,on:{onChange:t=>{const i=$$(e.columnValue2);t?this.populateFieldOptions2():(i.setValue(""),i.disable()),this.onChange()}}},{id:e.columnValue2,name:"columnValue2",view:"richselect",label:a("Value Column 2"),labelWidth:i.labelWidthLarge,disabled:!0,options:[],on:{onChange:()=>{this.onChange()}}},{name:"isPercentage",view:"checkbox",labelRight:a("Percentage"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{name:"showLabel",view:"checkbox",label:a("Display Label"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{name:"labelPosition",view:"richselect",label:a("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:a("Left")},{id:"top",value:a("Top")}],on:{onChange:()=>{this.onChange()}}},{name:"labelWidth",view:"counter",label:a("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"counter",name:"height",label:`${a("Height")}: `,labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e),webix.extend($$(this.ids.component),webix.ProgressBar)}updateCharts(){this.CurrentView.refreshData()}populateDataview(){const e=this.AB.Account.isSystemDesigner()?e=>!e.isSystemObject:()=>!0,t=this.CurrentApplication.datacollectionsIncluded(e),i=$$(this.ids.dataviewID);i.define("options",t.map((e=>({id:e.id,value:e.label})))),i.refresh()}populateFieldOptions(){const e=this.CurrentView.datacollection;if(!e)return;const t=e.datasource;if(!t)return;const i=this.ids,n=$$(i.columnLabel),a=$$(i.columnValue);n.define("options",t.fields().map((e=>({id:e.id,value:e.columnName,key:e.key})))),n.refresh(),a.define("options",t.fields((e=>"number"===e.key||"formula"===e.key||"calculate"===e.key)).map((e=>({id:e.id,value:e.columnName,key:e.key})))),a.refresh()}populateFieldOptions2(){const e=this.CurrentView.datacollection;if(!e)return;const t=e.datasource;if(!t)return;const i=$$(this.ids.columnValue2);i.define("options",t.fields((e=>"number"===e.key||"formula"===e.key||"calculate"===e.key)).map((e=>({id:e.id,value:e.columnName,key:e.key})))),i.enable(),i.refresh()}populate(e){super.populate(e);const t=this.ids,i=$$(t.component),n=this.defaultValues(),a=Object.assign(i.getValues(),Object.assign(n,e.settings));this.populateDataview(),this.populateFieldOptions(),a.multipleSeries&&this.populateFieldOptions2(),i.setValues(a)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values(),t=this.ids,i=$$(t.component);return e.settings=Object.assign(i.getValues(),e.settings),e}ViewClass(){return super._ViewClass("chart")}}}},7661:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_chart_area",{}),this.AB=e}static get key(){return"area"}ui(){return super.ui([{name:"areaType",view:"richselect",label:a("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"area",value:a("Area")},{id:"stackedArea",value:a("Stacked Area")}],on:{onChange:()=>{this.onChange()}}},{name:"chartHeight",view:"counter",min:1,label:a("Height"),on:{onChange:()=>{this.onChange()}}},{name:"stepValue",view:"counter",min:1,label:a("Step"),on:{onChange:()=>{this.onChange()}}},{name:"maxValue",view:"counter",min:1,label:a("Max Value"),on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:a("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:a("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("area")}}}},2225:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_chart_bar",{}),this.AB=e}static get key(){return"bar"}ui(){return super.ui([{name:"barType",view:"richselect",label:a("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"bar",value:a("Vertical")},{id:"barH",value:a("Horizontal")}],on:{onChange:()=>{this.onChange()}}},{name:"barPreset",view:"richselect",label:a("Chart Preset"),labelWidth:i.labelWidthLarge,options:[{id:"column",value:a("Column")},{id:"stick",value:a("Stick")},{id:"alpha",value:a("Alpha")}],on:{onChange:()=>{this.onChange()}}},{name:"height",view:"counter",min:1,label:a("Height"),on:{onChange:()=>{this.onChange()}}},{name:"stepValue",view:"counter",min:1,label:a("Step"),on:{onChange:()=>{this.onChange()}}},{name:"maxValue",view:"counter",min:1,label:a("Max Value"),on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:a("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:a("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("bar")}}}},992:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_chart_line",{}),this.AB=e}static get key(){return"line"}ui(){return super.ui([{name:"lineType",view:"richselect",label:a("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"line",value:a("Line")},{id:"spline",value:a("Spline")}],on:{onChange:()=>{this.onChange()}}},{name:"linePreset",view:"richselect",label:a("Chart Preset"),labelWidth:i.labelWidthLarge,options:[{id:"plot",value:a("Plot")},{id:"diamond",value:a("Diamond")},{id:"simple",value:a("Simple")}],on:{onChange:()=>{this.onChange()}}},{name:"chartHeight",view:"counter",min:1,label:a("Height"),on:{onChange:()=>{this.onChange()}}},{name:"stepValue",view:"counter",min:1,label:a("Step"),on:{onChange:()=>{this.onChange()}}},{name:"maxValue",view:"counter",min:1,label:a("Max Value"),on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:a("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:a("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("line")}}}},3875:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_chart_pie",{}),this.AB=e}static get key(){return"pie"}ui(){return super.ui([{name:"pieType",view:"richselect",label:a("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"pie",value:a("Standard")},{id:"pie3D",value:a("Pie3D")},{id:"donut",value:a("Donut")}],on:{onChange:()=>{this.onChange()}}},{name:"height",view:"counter",min:1,label:a("Height"),on:{onChange:()=>{this.onChange()}}},{name:"innerFontSize",view:"counter",min:1,label:a("Inner Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:a("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:a("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("pie")}}}},4158:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_comment",{dataviewID:"",columnUser:"",columnComment:"",columnDate:"",height:""}),this.AB=e}static get key(){return"comment"}ui(){const e=this.ids;return super.ui([{id:e.dataviewID,view:"richselect",name:"dataviewID",label:a("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:e=>{this.selectSource(e),this.onChange()}}},{id:e.columnUser,view:"richselect",name:"columnUser",label:a("Select a user field"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.columnComment,view:"richselect",name:"columnComment",label:a("Select a comment field"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.columnDate,view:"richselect",name:"columnDate",label:a("Select a date field"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:a("Height:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}selectSource(e){this.updateUserFieldOptions(e),this.updateCommentFieldOptions(e),this.updateDateFieldOptions(e)}updateDatacollectionOptions(e){const t=this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"}))),i=this.ids;$$(i.dataviewID).define("options",t),$$(i.dataviewID).define("value",e),$$(i.dataviewID).refresh()}updateUserFieldOptions(e){const t=this.CurrentView.AB.datacollectionByID(e),i=t?t.datasource:null,n=i?i.fields((e=>"user"===e.key)).map((e=>({id:e.id,value:e.label}))):[];n.unshift({id:null,value:"[Select]"});const a=this.ids;$$(a.columnUser).define("options",n),$$(a.columnUser).refresh()}updateCommentFieldOptions(e){const t=this.CurrentView.AB.datacollectionByID(e),i=t?t.datasource:null,n=i?i.fields((e=>"string"===e.key||"LongText"===e.key)).map((e=>({id:e.id,value:e.label}))):[];n.unshift({id:null,value:"[Select]"});const a=this.ids;$$(a.columnComment).define("options",n),$$(a.columnComment).refresh()}updateDateFieldOptions(e){const t=this.CurrentView.AB.datacollectionByID(e),i=t?t.datasource:null,n=i?i.fields((e=>"date"===e.key)).map((e=>({id:e.id,value:e.label}))):[];n.unshift({id:null,value:"[Select]"});const a=this.ids;$$(a.columnDate).define("options",n),$$(a.columnDate).refresh()}populate(e){super.populate(e);const t=this.ids,i=e.settings.dataviewID?e.settings.dataviewID:null;this.updateDatacollectionOptions(i),this.updateUserFieldOptions(i),this.updateCommentFieldOptions(i),this.updateDateFieldOptions(i);const n=$$(t.component),a=n.getValues();for(const t in e.settings)a[t]=a[t]||e.settings[t];n.setValues(a)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i}ViewClass(){return super._ViewClass("comment")}}}},4856:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L(),o="properties_abview_conditionalcontainer";let s;return class extends t{constructor(){super(o,{buttonFilter:"",datacollection:""}),this.AB=e,s=this.AB.Class.ABViewManager.viewClass("conditionalcontainer").defaultValues()}static get key(){return"conditionalcontainer"}get filterComponent(){return null==this._filterComponent&&(this._filterComponent=this.AB.filterComplexNew(`${o}_filter`)),this._filterComponent}ui(){return this.filterComponent.init(),this.filterComponent.on("save",(e=>{this.onFilterChange(e)})),null==this._filterPopup&&(this._filterPopup=this.AB.Webix.ui({view:"popup",width:800,hidden:!0,body:this.filterComponent.ui})),super.ui([{id:this.ids.datacollection,name:"datacollection",view:"richselect",label:a("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:e=>{this.changeDatacollection(e)}}},{view:"fieldset",name:"filter",label:a("Filter:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:a("Filter Data:"),width:i.labelWidthLarge},{id:this.ids.buttonFilter,view:"button",name:"buttonFilter",label:a("Settings"),icon:"fa fa-gear",type:"icon",css:"webix_primary",autowidth:!0,badge:0,click:()=>{const e=$$(this.ids.buttonFilter);this.showFilterPopup(e)}}]}]}}])}populate(e){if(super.populate(e),!e)return;const t=this.ids,i=$$(t.datacollection),n=e.application.datacollectionsIncluded().map((e=>{let t="fa-database";return"query"===e.sourceType&&(t="fa-filter"),{id:e.id,value:`<i class="fa ${t}"></i> ${e.label}`}}));i.define("options",n),i.define("value",e?.settings?.dataviewID??null),i.refresh(),e?.settings?.filterConditions&&this.filterComponent.setValue(e.settings.filterConditions),this.populatePopupEditors(e)}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids,t=this.filterComponent.getValue(),i=super.values();return i.settings=i.settings??{},i.settings.dataviewID=$$(e.datacollection).getValue(),i.settings.filterConditions=t,i}ViewClass(){return super._ViewClass("conditionalcontainer")}changeDatacollection(e){const t=this.CurrentView;this.populatePopupEditors(t,e),this.filterComponent.setValue(s.filterConditions),this.onChange(),this.populateBadgeNumber(t)}showFilterPopup(e){this._filterPopup.show(e,{pos:"bottom"})}hideFilterPopup(){this._filterPopup.hide()}onFilterChange(){this.values();const e=this.filterComponent.getValue();this.filterComponent.isConditionComplete(e)&&(this.hideFilterPopup(),setTimeout((()=>{this.onChange();const e=this.CurrentView;this.populateBadgeNumber(e)}),10))}populatePopupEditors(e,t){let i=e.datacollection;t&&(i=e.AB.datacollectionByID(t)),i?.datasource?this.filterComponent.fieldsLoad(i.datasource.fields()):this.filterComponent.fieldsLoad(),this.filterComponent.setValue(e.settings.filterConditions??s.filterConditions),this.populateBadgeNumber(e)}populateBadgeNumber(e){const t=this.ids,i=$$(t.buttonFilter),n=e?.settings?.filterConditions?.rules?.length||null;i.define("badge",n),i.refresh()}}}},3156:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(2418),a=null;function o(e){if(!a){const i=e.Config.uiSettings(),o=(0,n.Z)(e);var t=o.L();a=class extends o{constructor(t="properties_abview_container",i={}){var n={columns:"",gravity:""};Object.keys(i).forEach((e=>{void 0===n[e]?n[e]="":console.error(`!!! ABViewContainerProperty:: passed in ids contains a restricted id : ${e}`)})),super(t,n),this.base=t,this.AB=e}static get key(){return"viewcontainer"}ui(e=[],n={}){let a=this.ids,o=[{id:a.columns,name:"columns",view:"counter",min:1,label:t("Columns"),labelWidth:i.labelWidthXLarge,on:{onChange:(e,n)=>{e>8&&$$(a.columns).setValue(8);let o=$$(a.gravity),s=e=>{var n=o.getParentView().index(o);o.getParentView().addView({view:"counter",value:"1",min:1,label:t("Column {0} Gravity",[e]),labelWidth:i.labelWidthXLarge,css:"gravity_counter",on:{onChange:()=>{this.onChange()}}},n)};function r(){o.getParentView().removeView(o.getParentView().getChildViews()[o.getParentView().index(o)-1])}e>n?(2==e&&s(1),s(e)):e<n&&(r(),1==e&&r()),this.onChange()}}},{id:a.gravity,view:"text",name:"gravity",height:1}];return o=o.concat(e),super.ui(o,n)}clear(){}defaults(){var e=this.ViewClass();return e?e.common():(console.error("!!! properties/views/ABView: could not find ViewClass"),null)}editorPopulate(e){console.error("!!! Depreciated. call populate() instead."),this.populate(e)}formValues(){return $$(this.ids.component).getValues()}isValid(){}markInvalid(e,t){$$(this.ids.component).markInvalid(e,t)}populate(e){super.populate(e);let n=this.ids,a=$$(n.columns);a?.setValue(e.settings.columns||1);let o=$$(n.gravity);if(o){o.getParentView().queryView({css:"gravity_counter"},"all").map((e=>o.getParentView().removeView(e)));let n=a.getValue();if(n>1)for(var s=1;s<=n;s++){var r=o.getParentView().index(o);o.getParentView().addView({view:"counter",min:1,label:t("Column {0} Gravity",[s]),labelWidth:i.labelWidthXLarge,css:"gravity_counter",value:e.settings.gravity&&e.settings.gravity[s-1]?e.settings.gravity[s-1]:1,on:{onChange:()=>{this.onChange()}}},r)}}}requiredOnChange(){}values(){let e=super.values();e.settings={},e.settings.columns=$$(this.ids.columns).getValue();var t=[];return $$(this.ids.gravity).getParentView().queryView({css:"gravity_counter"},"all").map((e=>t.push($$(e).getValue()))),e.settings.gravity=t,e}ViewClass(){return super._ViewClass("viewcontainer")}}}return a}},5786:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),a=i.L();return class extends i{constructor(){super("properties_abview_data_filter",{datacollection:"",fields:"",custom_filters:"",custom_sort:"",batch:""}),this.AB=e}static get key(){return"data-filter"}ui(){let e=this.ids;return super.ui([{id:e.batch,visibleBatch:"advanced",rows:[{id:e.viewtype,name:"viewType",view:"combo",label:a("Display as"),labelWidth:t.labelWidthLarge,on:{onChange:(t,i)=>{t!=i&&($$(e.batch).showBatch(t),this.onChange())}},options:[{id:"advanced",value:"Search & filter"},{id:"connected",value:"Connected field"}]},{id:e.datacollection,name:"dataviewID",view:"combo",label:a("Datacollection"),labelWidth:t.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.populateFields(e),this.onChange())}}},{id:e.fields,batch:"connected",name:"field",view:"combo",label:a("Field"),labelWidth:t.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"checkbox",batch:"advanced",id:e.custom_filters,label:"Show Filters",labelWidth:t.labelWidthLarge,name:"showFilter",on:{onChange:()=>{this.onChange()}}},{view:"checkbox",batch:"advanced",id:e.custom_sort,label:"Show Sort",labelWidth:t.labelWidthLarge,name:"showSort",on:{onChange:()=>{this.onChange()}}},{}]}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);let t=this.ids;if(!e)return;const i=$$(t.component),n=this.defaultValues();let a=i.getValues();for(const e in n)a[e]=n[e]||a[e];for(const t in e.settings)a[t]=void 0!==e.settings[t]?e.settings[t]:a[t];let o=a.dataviewID?a.dataviewID:null;var s=$$(t.datacollection),r=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"})));s.define("options",r),s.define("value",e.datacollection),s.refresh(),o&&this.populateFields(o),i.setValues(a)}populateFields(e){let t=this.ids,i=this.AB.datacollectionByID(e);var n;n=(i?i.datasource:null).connectFields().map((e=>({id:e.columnName,value:e.label}))),$$(t.fields).define("options",n),$$(t.fields).refresh()}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i.text=i.settings.text,i}ViewClass(){return super._ViewClass("data-filter")}}}},3300:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(1377),a=i(8782);function o(e){const t="properties_abview_dataview",i=(0,n.default)(e),o=(0,a.Z)(e,t),s=e.Config.uiSettings(),r=i.L();let l={};return class extends i{constructor(){super(t,{xCount:""}),this.AB=e,l=this.AB.Class.ABViewManager.viewClass("dataview").defaultValues(),this.linkPageComponent=new o(e,t)}static get key(){return"dataview"}ui(){const e=this.ids;return super.ui([{id:e.xCount,view:"counter",name:"xCount",min:1,label:r("Items in a row"),labelWidth:s.labelWidthLarge,step:1,on:{onChange:()=>{this.onChange()}}},this.linkPageComponent.ui()])}init(){super.init(this.AB),this.linkPageComponent.init(),this.linkPageComponent.on("change",(()=>{this.onChange()}))}populate(e){if(super.populate(e),!e)return;const t=this.ids;$$(t.xCount).setValue(e.settings.xCount||l.xCount),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids;let t=super.values();t.settings=t.settings??{},t.settings.xCount=$$(e.xCount).getValue();let i=this.linkPageComponent.getSettings();for(let e in i)t.settings[e]=i[e];return t}ViewClass(){return super._ViewClass("dataview")}}}},1377:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3156);function a(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),a=t.L();let o={};return class extends t{constructor(t,i={}){super(t,Object.assign({datacollection:"",fields:"",showLabel:"",labelPosition:"",labelWidth:"",height:""},i)),this.AB=e,o=this.AB.Class.ABViewManager.viewClass("detail").defaultValues()}static get key(){return"detail"}ui(e){const t=this.ids;let n=[{id:t.datacollection,name:"datacollection",view:"richselect",label:a("Data Source"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{this.selectSource(e,t)}}},{id:t.fields,name:"fields",view:"list",select:!1,minHeight:200,template:this.listTemplate,type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:(...e)=>this.check(...e)}},{id:t.showLabel,name:"showLabel",view:"checkbox",label:a("Display Label"),labelWidth:i.labelWidthLarge},{id:t.labelPosition,name:"labelPosition",view:"richselect",label:a("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:a("Left")},{id:"top",value:a("Top")}],on:{onChange:()=>{this.onChange()}}},{id:t.labelWidth,name:"labelWidth",view:"counter",label:a("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.height,name:"height",view:"counter",label:a("Height:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}];return(e??[]).forEach((e=>{n.push(e)})),super.ui(n)}populate(e){if(super.populate(e),!e)return;const t=this.ids,i=e.settings?.dataviewID,n=$$(t.datacollection),a=e.application.datacollectionsIncluded().filter((e=>{const t=e.datasource;return t&&!t.isImported})).map((e=>{let t={id:e.id,value:e.label};return"query"==e.sourceType?t.icon="fa fa-filter":t.icon="fa fa-database",t}));n.define("options",a),n.define("value",i),n.refresh(),this.propertyUpdateFieldOptions(i,e),$$(t.showLabel).setValue(e.settings.showLabel??o.showLabel),$$(t.labelPosition).setValue(e.settings.labelPosition??o.labelPosition),$$(t.labelWidth).setValue(parseInt(e.settings.labelWidth)??o.labelWidth),$$(t.height).setValue(e.settings.height>=0?e.settings.height:o.height),e?.views().forEach((t=>{t instanceof this.AB.Class.ABViewDetailItem&&t.once("destroyed",(()=>this.populate(e)))}))}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids;let t=super.values();return t.settings=t.settings??{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue(),t.settings.labelWidth=$$(e.labelWidth).getValue(),t.settings.height=$$(e.height).getValue(),t}ViewClass(){return super._ViewClass("detail")}propertyUpdateFieldOptions(e,t){const i=this.ids,n=this.AB.datacollectionByID(e)?.datasource,a=n?.fields().map((e=>(e.selected=t?.views((t=>e.id==t.settings.fieldId)).length>0,e)));$$(i.fields).clearAll(),$$(i.fields).parse(a??[])}async selectSource(e){const t=this.ids;let i=this.CurrentView;i.settings.dataviewID=e;let n=i._views;i._views=[];let a=[];n.forEach((e=>{a.push(e.destroy())})),await Promise.all(a),this.propertyUpdateFieldOptions(e);let o=[],s=$$(t.fields).find({});s.reverse(),s.forEach(((e,n)=>{if(!e.selected){const a=s.length-n-1,r=i.addFieldToDetail(e,a);r&&(r.once("destroyed",(()=>this.populate(i))),o.push(r.save())),e.selected=1,$$(t.fields).updateItem(e.id,e)}})),await Promise.all(o),await i.save(),i.parentDetailComponent()?.emit("properties.updated",i),this.onChange()}listTemplate(e,t){return`${t.markCheckbox(e)} ${e.label}`}check(e,t){const i=this.ids,n=this.CurrentView,a=n.parentDetailComponent(),o=$$(i.fields).getItem(t);o.selected=o.selected?0:1,$$(i.fields).updateItem(t,o);const s=()=>{n.emit("properties.updated",n),this.onChange()};if(o.selected){const e=n.addFieldToDetail(o);e&&e.save().then((()=>{e.once("destroyed",(()=>this.populate(n))),n.viewInsert(e).then((()=>{s()}))}))}else{const e=a.views((e=>e.settings.fieldId==t))[0];e&&(e.destroy(),n.viewRemove(e).then((()=>{s()})))}}}}},9270:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(7420);function a(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abview_detail_checkbox",{height:""}),this.AB=e}static get key(){return"detailcheckbox"}ViewClass(){return super._ViewClass("detailcheckbox")}}}},3381:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(7420);function a(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abview_detail_custom",{height:""}),this.AB=e}static get key(){return"detailcustom"}ViewClass(){return super._ViewClass("detailcustom")}}}},8568:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(7420);function a(e){const t={height:0,width:0},i=(0,n.default)(e);return class extends i{constructor(){super("properties_abview_detail_image",{height:"",width:""}),this.AB=e}static get key(){return"detailimage"}ui(){return super.ui([{id:this.ids.height,name:"height",view:"counter",label:this.label("Height"),on:{onChange:()=>this.onChange()}},{id:this.ids.width,name:"width",view:"counter",label:this.label("Width"),on:{onChange:()=>this.onChange()}}])}ViewClass(){return super._ViewClass("detailimage")}populate(e){super.populate(e);const t=this.defaultValues(),i=e.settings?.height??t.height;$$(this.ids.height).setValue(i);const n=e.settings?.width??t.width;$$(this.ids.width).setValue(n)}defaultValues(){const e=super.defaultValues();return Object.assign(t,e)}values(){const e=super.values()??{};return e.settings=e.settings??{},e.settings.height=$$(this.ids.height).getValue(),e.settings.width=$$(this.ids.width).getValue(),e}}}},7420:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(t,i={}){super(t,Object.assign(i,{field:""})),this.AB=e}ui(e=[],t={}){const n=[{id:this.ids.field,name:"fieldLabel",view:"text",disabled:!0,label:i("Field")}].concat(e);return super.ui(n,t)}populate(e){super.populate(e);const[t]=this.AB.objectByID(e.settings.objectId).fields((t=>t.id==e.settings.fieldId));$$(this.ids.field).setValue(t.label)}defaultValues(){const e=this.ViewClass();let t={};return e&&(t=e.defaultValues()),t}}}},1023:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(7420);function a(e){const t={height:0},i=(0,n.default)(e);return class extends i{constructor(){super("properties_abview_detail_text",{height:""}),this.AB=e}static get key(){return"detailtext"}ui(){return super.ui([{id:this.ids.height,name:"height",view:"counter",label:this.label("Height"),on:{onChange:()=>this.onChange()}}])}ViewClass(){return super._ViewClass("detailtext")}populate(e){super.populate(e);const t=this.defaultValues(),i=e.settings?.height??t.height;$$(this.ids.height).setValue(i)}defaultValues(){const e=super.defaultValues();return Object.assign(t,e)}values(){const e=super.values()??{};return e.settings=e.settings??{},e.settings.height=$$(this.ids.height).getValue(),e}}}},7901:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(7420);function a(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abview_detail_tree",{height:""}),this.AB=e}static get key(){return"detailtree"}ViewClass(){return super._ViewClass("detailtree")}}}},6309:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();let o={};return class extends t{constructor(){super("properties_abview_docxBuilder",{buttonlabel:"",buttonPosition:"",datacollection:"",docxFile:"",docxDownload:"",filelabel:"",language:"",toolbarBackground:"",width:0}),this.AB=e,o=this.AB.Class.ABViewManager.viewClass("docxBuilder").defaultValues()}static get key(){return"docxBuilder"}ui(){const e=this.AB.Multilingual.languages().map((e=>({id:e.language_code,value:e.language_label})));return super.ui([{view:"fieldset",label:a("Data:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.datacollection,name:"datacollection",view:"multiselect",label:a("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:a("Template file:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:a("DOCX file:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:this.ids.docxFile,view:"uploader",value:a("Upload"),name:"docxFile",apiOnly:!0,inputName:"file",multiple:!1,on:{onBeforeFileAdd:e=>this.validateType(e),onFileUpload:(e,t)=>{this.uploadedFile(e)},onFileUploadError:(e,t)=>{}}}]},{id:this.ids.filelabel,name:"filelabel",view:"text",label:a("Filename"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:this.ids.docxDownload,name:"docxDownload",view:"button",type:"icon",css:"webix_primary",icon:"fa fa-file-word-o",label:a("Download Template File"),click:()=>{this.downloadFile()}}]}},{view:"fieldset",label:a("Language:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.language,name:"language",view:"richselect",label:a("Language"),labelWidth:i.labelWidthLarge,options:e,on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:a("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.buttonlabel,name:"buttonlabel",view:"text",label:a("Label"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:this.ids.width,view:"counter",name:"width",label:a("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:this.ids.toolbarBackground,view:"richselect",name:"toolbarBackground",label:a("Page background:"),labelWidth:i.labelWidthXLarge,options:[{id:"ab-background-default",value:a("White (default)")},{id:"webix_dark",value:a("Dark")},{id:"ab-background-lightgray",value:a("Gray")}],on:{onChange:()=>{this.onChange()}}},{id:this.ids.buttonPosition,view:"richselect",name:"buttonPosition",label:a("Button Position:"),labelWidth:i.labelWidthXLarge,options:[{id:"left",value:a("Left (default)")},{id:"center",value:a("Centered")},{id:"right",value:a("Right")}],on:{onChange:()=>{this.onChange()}}}]}}])}populate(e){if(super.populate(e),!e)return;const t=this.ids,i=$$(t.datacollection),n=e.settings.dataviewID??null;$$(t.toolbarBackground).setValue(e.settings.toolbarBackground??o.toolbarBackground),$$(t.buttonPosition).setValue(e.settings.buttonPosition??o.buttonPosition);const a=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"})));i.define("options",a),i.define("value",n),i.refresh(),$$(t.language).setValue(e.settings.language??o.language),$$(t.filelabel).setValue(e.filelabel??e.settings.filelabel),$$(t.buttonlabel).setValue(e.buttonlabel??e.settings.buttonlabel),$$(t.width).setValue(e.settings.width),e.settings.filename?$$(t.docxDownload).show():$$(t.docxDownload).hide()}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids;let t=super.values();return t.settings=t.settings??{},t.settings.buttonlabel=$$(e.buttonlabel).getValue(),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.width=$$(e.width).getValue(),t.filelabel=$$(e.filelabel).getValue(),t.settings.language=$$(e.language).getValue(),t.settings.toolbarBackground=$$(e.toolbarBackground).getValue(),t.settings.buttonPosition=$$(e.buttonPosition).getValue(),t}ViewClass(){return super._ViewClass("docxBuilder")}validateType(e){const t=this.ids,i=["docx"],n=e.type.toLowerCase();if(-1==i.indexOf(n))return this.AB.Webix.message(a(`Only [${i.join(", ")}] files are supported`)),!1;{const e=this.CurrentView.uploadUrl();return $$(t.docxFile).define("upload",e),$$(t.docxFile).refresh(),!0}}uploadedFile(e){if(!e||!e.data)return;const t=this.ids;let i=this.CurrentView;i.settings.filename=e.data.uuid,i.filelabel=e.name,$$(t.filelabel).setValue(i.filelabel),$$(t.docxDownload).show()}downloadFile(){const e=this.CurrentView,t=e.downloadUrl();fetch(t).then((e=>e.blob())).then((t=>{e.letUserDownload(t,e.filelabel)}))}}}},3257:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3156),a=i(1538),o=i(708);function s(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),s=t.L();var r={};const l="properties_abview_form",c=(0,a.Z)(e,`${l}_popupRecordRule`),d=(0,o.Z)(e,`${l}_popupSubmitRule`);return class extends t{constructor(){super(l,{datacollection:"",fields:"",showLabel:"",labelPosition:"",labelWidth:"",height:"",clearOnLoad:"",clearOnSave:"",buttonSubmitRules:"",buttonRecordRules:""}),this.AB=e,r=this.AB.Class.ABViewManager.viewClass("form").defaultValues()}static get key(){return"form"}ui(){let e=this.ids;return super.ui([{id:e.datacollection,view:"richselect",name:"datacollection",label:s("Datacollection"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{this.selectSource(e,t)}}},{view:"fieldset",label:s("Form Fields:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fields,view:"list",name:"fields",select:!1,minHeight:200,template:(...e)=>this.listTemplate(...e),type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:(...e)=>this.check(...e)}}]}},{id:e.showLabel,name:"showLabel",view:"checkbox",label:s("Display Label"),labelWidth:i.labelWidthLarge,click:()=>{this.onChange()}},{id:e.labelPosition,view:"richselect",name:"labelPosition",label:s("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:s("Left")},{id:"top",value:s("Top")}],on:{onChange:()=>{this.onChange()}}},{id:e.labelWidth,view:"counter",name:"labelWidth",label:s("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:s("Height"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.clearOnLoad,view:"checkbox",name:"clearOnLoad",label:s("Clear on load"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.clearOnSave,view:"checkbox",name:"clearOnSave",label:s("Clear on save"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"fieldset",label:s("Rules:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:s("Submit Rules:"),width:i.labelWidthLarge},{id:e.buttonSubmitRules,view:"button",css:"webix_primary",name:"buttonSubmitRules",label:s("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.submitRuleShow()}}]},{cols:[{view:"label",label:s("Record Rules:"),width:i.labelWidthLarge},{id:e.buttonRecordRules,view:"button",name:"buttonRecordRules",css:"webix_primary",label:s("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.recordRuleShow()}}]}]}}])}async init(e){super.init(e),webix.extend($$(this.ids.component),webix.ProgressBar);let t=[];return t.push(c.init(e)),c.on("save",(()=>{this.onChange(),this.populateBadgeNumber()})),t.push(d.init(e)),d.on("save",(()=>{this.onChange(),this.populateBadgeNumber()})),Promise.all(t)}populate(e){super.populate(e);let t=this.ids;if(!e)return;let i=e.parentFormComponent(),n=i.settings.dataviewID?i.settings.dataviewID:null;var a=$$(t.datacollection),o=e.application.datacollectionsIncluded().filter((e=>{const t=e.datasource;return"object"==e.sourceType&&!t?.isImported&&!t?.isReadOnly})).map((e=>{let t={id:e.id,value:e.label};return"query"==e.sourceType?t.icon="fa fa-filter":t.icon="fa fa-database",t}));a.define("options",o),a.define("value",n),a.refresh(),this.propertyUpdateFieldOptions(n),e.views().forEach((t=>{t instanceof this.AB.Class.ABViewFormItem&&t.once("destroyed",(()=>this.populate(e)))})),a.enable(),$$(t.showLabel).setValue(e.settings.showLabel),$$(t.labelPosition).setValue(e.settings.labelPosition||r.labelPosition),$$(t.labelWidth).setValue(e.settings.labelWidth||r.labelWidth),$$(t.height).setValue(e.settings.height||r.height),$$(t.clearOnLoad).setValue(e.settings.clearOnLoad||r.clearOnLoad),$$(t.clearOnSave).setValue(e.settings.clearOnSave||r.clearOnSave),c.objectLoad(this.CurrentObject),c.viewLoad(e),c.fromSettings(e.settings.recordRules||[]),d.objectLoad(this.CurrentObject),d.viewLoad(e),d.fromSettings(e.settings.submitRules||[]),this.populateBadgeNumber(),this.updateEventIds=this.updateEventIds||{},this.updateEventIds[e.id]||(this.updateEventIds[e.id]=!0,e.addListener("properties.updated",(()=>{this.populateBadgeNumber()})))}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){let e=this.ids,t=super.values();return t.settings=t.settings||{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue()||r.labelPosition,t.settings.labelWidth=$$(e.labelWidth).getValue()||r.labelWidth,t.settings.height=$$(e.height).getValue(),t.settings.clearOnLoad=$$(e.clearOnLoad).getValue(),t.settings.clearOnSave=$$(e.clearOnSave).getValue(),t.settings.recordRules=c.toSettings(),t.settings.submitRules=d.toSettings(),t}ViewClass(){return super._ViewClass("carousel")}busy(){$$(this.ids.component)?.showProgress?.({type:"icon"})}check(e,t){const i=this.ids;let n=this.CurrentView,a=n.parentFormComponent(),o=$$(i.fields).getItem(t);o.selected=o.selected?0:1,$$(i.fields).updateItem(t,o);let s=()=>{a.refreshDefaultButton(i).save().then((()=>{n.emit("properties.updated",n),this.onChange()}))};if(o.selected){let e=n.addFieldToForm(o);e&&e.save().then((()=>{e.once("destroyed",(()=>this.populate(n))),n.viewInsert(e).then((()=>{s()}))}))}else{let e=a.fieldComponents().filter((e=>e.settings.fieldId==t))[0];e&&(e.destroy(),n.viewRemove(e).then((()=>{s()})))}}populateBadgeNumber(){const e=this.ids;let t=this.CurrentView;t&&(t.settings.submitRules?$$(e.buttonSubmitRules).define("badge",t.settings.submitRules.length||null):$$(e.buttonSubmitRules).define("badge",null),$$(e.buttonSubmitRules).refresh(),t.settings.recordRules?$$(e.buttonRecordRules).define("badge",t.settings.recordRules.length||null):$$(e.buttonRecordRules).define("badge",null),$$(e.buttonRecordRules).refresh())}ready(){$$(this.ids.component)?.hideProgress?.()}recordRuleShow(){c.fromSettings(this.CurrentView.settings.recordRules),c.show()}submitRuleShow(){d.fromSettings(this.CurrentView.settings.submitRules),d.show()}listTemplate(e,t){let i=this.CurrentView;var n=e.formComponent();if(null==n)return`<i class='fa fa-times'></i>  ${e.label} <div class='ab-component-form-fields-component-info'> Disable </div>`;var a=n.common().key,o=i.application.viewAll((e=>e.common().key==a))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${o?o.common().icon:"fw"}'></i> ${o?s(o.common().labelKey):""} </div>`}propertyUpdateFieldOptions(e){const t=this.ids;var i=this.CurrentView.parentFormComponent().fieldComponents(),n=this.AB.datacollectionByID(e),a=n?n.datasource:null,o=[];null!=a&&(o=a.fields().map((e=>(e.selected=i.filter((t=>e.id==t.settings.fieldId)).length>0,e))),this.objectLoad(a)),$$(t.fields).clearAll(),$$(t.fields).parse(o)}refreshDefaultButton(){const e=this.ids,t=this.AB.Class.ABViewManager.viewClass("button");let i=this.views((e=>e instanceof t&&e.settings.isDefault))[0];null==i?(i=t.newInstance(this.application,this),i.settings.isDefault=!0):this._views=this.views((e=>!(e instanceof t||e.settings.isDefault)));let n=this.views().map((e=>(e.position.y||0)+1));n.push(this._views.length||0),n.push($$(e.fields).length||0);let a=Math.max(...n);return i.position.y=a,this._views.push(i),i}selectSource(e){const t=this.ids;this.busy();let i=this.CurrentView,n=i.parentFormComponent();i.settings.dataviewID=e;var a=i._views;return i._views=[],Promise.resolve().then((()=>{var e=[];return a.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(this.propertyUpdateFieldOptions(e),i._views.length>0)return Promise.resolve();let a=[],o=$$(t.fields).find({});o.reverse(),o.forEach(((e,n)=>{if(!e.selected){let s=o.length-n-1,r=i.addFieldToForm(e,s);r&&(r.once("destroyed",(()=>this.populate(i))),a.push(r.save())),e.selected=1,$$(t.fields).updateItem(e.id,e)}}));let s=n.refreshDefaultButton(t);return s&&a.push(s.save()),Promise.all(a)})).then((()=>i.save())).then((()=>(n.emit("properties.updated",i),this.ready(),this.onChange(),Promise.resolve())))}}}},3020:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_button",{includeSave:"",saveLabel:"",includeCancel:"",cancelLabel:"",includeReset:"",resetLabel:"",afterCancel:"",alignment:""}),this.AB=e}static get key(){return"button"}ui(){const e=this.ids,t=this.AB.UISettings.config();return super.ui([{id:e.includeSave,name:"includeSave",view:"checkbox",label:i("Save"),click:()=>this.onChange()},{id:e.saveLabel,name:"saveLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Save Label"),placeholder:i("Save Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeCancel,name:"includeCancel",view:"checkbox",label:i("Cancel"),click:()=>this.onChange()},{id:e.cancelLabel,name:"cancelLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Cancel Label"),placeholder:i("Cancel Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeReset,name:"includeReset",view:"checkbox",label:i("Reset"),click:()=>this.onChange()},{id:e.resetLabel,name:"resetLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Reset Label"),placeholder:i("Reset Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.afterCancel,name:"afterCancel",view:"richselect",labelWidth:t.labelWidthLarge,label:i("After Cancel"),on:{onChange:()=>this.onChange()}},{id:e.alignment,name:"alignment",view:"richselect",labelWidth:t.labelWidthLarge,label:i("Alignment"),options:[{id:"left",value:i("Left")},{id:"center",value:i("Center")},{id:"right",value:i("Right")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues(),n=[];this.addPagesToList(n,e.application,e.pageRoot().id);const a=n.map((e=>({id:e.id,value:e.value})));$$(t.afterCancel).define("options",a),$$(t.includeSave).setValue(null!=e.settings.includeSave?e.settings.includeSave:i.includeSave),$$(t.includeCancel).setValue(null!=e.settings.includeCancel?e.settings.includeCancel:i.includeCancel),$$(t.includeReset).setValue(null!=e.settings.includeReset?e.settings.includeReset:i.includeReset),$$(t.saveLabel).setValue(e.settings.saveLabel??""),$$(t.cancelLabel).setValue(e.settings.cancelLabel??""),$$(t.resetLabel).setValue(e.settings.resetLabel??""),$$(t.afterCancel).setValue(e.settings.afterCancel??i.afterCancel),$$(t.alignment).setValue(e.settings.alignment??i.alignment)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.includeSave=$$(e.includeSave).getValue(),i.settings.saveLabel=$$(e.saveLabel).getValue(),i.settings.includeCancel=$$(e.includeCancel).getValue(),i.settings.cancelLabel=$$(e.cancelLabel).getValue(),i.settings.includeReset=$$(e.includeReset).getValue(),i.settings.resetLabel=$$(e.resetLabel).getValue(),i.settings.afterCancel=$$(e.afterCancel).getValue(),i.settings.alignment=$$(e.alignment).getValue(),i}ViewClass(){return super._ViewClass("button")}addPagesToList(e,t,i){t&&t.pages&&e&&(t.pages()??[]).forEach((t=>{null==t.parent&&t.id!=i||(e.push({id:t.id,value:t.label}),this.addPagesToList(e,t,t.id))}))}}}},2480:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_checkbox",{}),this.AB=e}static get key(){return"checkbox"}}}},2318:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var n=i(4412),a=i(423),o=i(3285);let s=null,r=null;function l(e){const t="properties_abview_connect",i=(0,n.Z)(e),l=function(e,t){if(!s){const t="properties_abview_connect_viewpropertyaddpage",i=(0,o.Z)(e),n=i.L();s=class extends i{static get default(){return{formView:"none"}}constructor(){super(t,{formView:""}),this.AB=e}ui(){const e=this.ids;return{id:e.formView,name:"formView",view:"richselect",label:n("Add New Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(t,i)=>{t==n("No add new option")&&$$(e.formView).setValue(""),this.emit("change")}}}}setSettings(e,t={}){if(null==e)return;let i=[{id:"none",value:n("No add new option")}];const a=e.pageRoot().pages((t=>t.views((t=>"form"==t?.key&&t?.datacollection?.datasource?.id==e.field().settings.linkObject),!0).length),!0).map((e=>({id:e.id,value:e.label})));i=i.concat(a);const o=$$(this.ids.formView);o&&(o.define("options",i),o.define("value",t.formView??this.constructor.default.formView),o.refresh())}getSettings(e){const t=e.settings??{};return t.formView=$$(this.ids.formView).getValue(),t}}}return s}(e),c=function(e,t){if(!r){const t="properties_abview_connect_viewpropertyeditpage",i=(0,o.Z)(e),n=i.L();r=class extends i{static get default(){return{editForm:"none"}}constructor(){super(t,{formEdit:""}),this.AB=e}ui(){const e=this.ids;return{id:e.formEdit,name:"editForm",view:"richselect",label:n("Edit Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(t,i)=>{t==n("No add new option")&&$$(e.formEdit).setValue(""),this.emit("change")}}}}setSettings(e,t={}){if(null==e)return;const i=[{id:"none",value:n("No add new option")}];(e.pageRoot().pages((()=>!0),!0)??[]).forEach((t=>{t&&t.views((()=>!0),!0).forEach((n=>{"form"==n?.key&&n?.datacollection?.datasource?.id==e.field().settings.linkObject&&i.push({id:n.urlPointer(),value:`${t.label} - ${n.label}`})}))}));const a=$$(this.ids.formEdit);a&&(a.define("options",i),a.define("value",t.editForm??this.constructor.default.editForm),a.refresh())}getSettings(e){const t=e.settings||{},i=$$(this.ids.formEdit),n=(i.getPopup().config.body.data??[]).filter((e=>e.id==i.getValue()))[0];return n&&(t.editForm=n.id),t}}}return r}(e),d=i.L();let u=null,h=null;return class extends i{constructor(){super(t,{addNewSettings:"",popupWidth:"",popupHeight:"",advancedOption:"",buttonFilter:"",filterConnectedValue:"",buttonSort:""}),this.AB=e,u=this.AB.filterComplexNew(`${t}_filter`),u.on("save",(()=>this.onChange())),h=(0,a.Z)(this.AB,`${t}_sort`),h.on("changed",(()=>this.onChange()))}static get key(){return"connect"}ui(){const e=this,t=this.ids,i=this.AB.UISettings.config();return super.ui([this.addPageProperty.ui(),this.editPageProperty.ui(),{id:t.addNewSettings,view:"fieldset",name:"addNewSettings",label:d("Add New Popup Settings:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:t.popupWidth,view:"text",name:"popupWidth",placeholder:d("Set popup width"),label:d("Width:"),labelWidth:i.labelWidthLarge,validate:this.AB.Webix.rules.isNumber,on:{onChange:()=>this.onChange()}},{id:t.popupHeight,view:"text",name:"popupHeight",placeholder:d("Set popup height"),label:d("Height:"),labelWidth:i.labelWidthLarge,validate:this.AB.Webix.rules.isNumber,on:{onChange:()=>this.onChange()}}]}},{id:t.advancedOption,view:"fieldset",name:"advancedOption",label:d("Advanced Options:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:d("Filter Options:"),width:i.labelWidthLarge},{id:t.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:d("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){e.showFilterPopup(this.$view)}}]},{rows:[{view:"label",label:d("Filter by Connected Field Value:")},{id:t.filterConnectedValue,view:"combo",name:"filterConnectedValue",options:[],on:{onChange:()=>this.onChange()}}]},{height:30},{rows:[{cols:[{view:"label",label:d("Sort Options:"),width:i.labelWidthLarge},{id:t.buttonSort,view:"button",name:"buttonSort",css:"webix_primary",label:d("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){e.showSortPopup(this.$view)}}]}]}]}}])}async init(e){this.AB=e,await super.init(e),u.init(),h.init(e),this.addPageProperty.on("change",(()=>{this.onChange()})),this.editPageProperty.on("change",(()=>{this.onChange()}))}populate(e){super.populate(e),this.populateFilterByConnectedFieldValue(e);const t=this.ids,i=this.defaultValues(),n=[{id:null,value:""}],a=this.AB.definitionByID(e.settings.fieldId),o=this.AB.definitionByID(a.settings.linkObject),s=[];o.fieldIDs.forEach((e=>{s.push(this.AB.definitionByID(e))}));const r=e.application.connectedObjects(a.settings.linkObject);e.parent.views().forEach((t=>{if("connect"==t.key){const i=this.AB.definitionByID(t.settings.fieldId);r.forEach((a=>{if(a.id==i.settings.linkObject){let a;if(s.forEach((e=>{if(e.settings.isCustomFK&&""!=e.settings.indexField&&e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==i.settings.linkObject){a=e.id;let t=this.AB.definitionByID(e.settings.indexField);t&&(a=`${e.id}:${t.columnName}`)}else e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==i.settings.linkObject&&(a=`${e.id}:uuid`)})),a){const i=e.parent.viewComponents[t.id].ui(),o=i.rows[0]??i;n.push({id:`${o.name}:${a}`,value:o.label})}}}))}})),this.addPageProperty.setSettings(e,{formView:e.settings.formView}),this.editPageProperty.setSettings(e,{editForm:e.settings.editForm}),$$(t.filterConnectedValue).define("options",n),$$(t.filterConnectedValue).setValue(e.settings.filterConnectedValue),$$(t.popupWidth).setValue(e.settings.popupWidth||i.popupWidth),$$(t.popupHeight).setValue(e.settings.popupHeight||i.popupHeight),this.populatePopupEditors(e),this.populateBadgeNumber(t,e)}_filterCondition(e){return e?.options?.filters?.rules?.length?e.options.filters:e?.settings?.filterConditions?.rules?.length?e.settings.filterConditions:null}populatePopupEditors(e){const t=this._filterCondition(e)??this.defaultValues().filterConditions;let i;const n=e.field();n&&(i=n.datasourceLink,i&&u.fieldsLoad(i.fields(),i)),u.setValue(t),i&&h.objectLoad(i),h.setSettings(e.settings.sortFields)}populateBadgeNumber(e,t){const i=$$(e.buttonFilter),n=this._filterCondition(t);n?.rules?(i.define("badge",n.rules.length||null),i.refresh()):(i.define("badge",null),i.refresh());const a=$$(e.buttonSort);t?.settings?.sortFields?.length?(a.define("badge",t.settings.sortFields.length||null),a.refresh()):(a.define("badge",null),a.refresh())}populateFilterByConnectedFieldValue(e){const t=this.AB.definitionByID(e.settings.fieldId);if("one"==t.settings.linkType&&"many"==t.settings.linkViaType||"one"==t.settings.linkType&&"one"==t.settings.linkViaType&&t.settings.isSource){const i=this.AB.objectByID(t.settings.linkObject);if(!i)return;let n=i.fields((e=>"connectObject"==e.key));if(!n||!n.length)return;n.forEach((t=>{let i=e.parent.views((i=>{let n=this.AB.definitionByID(i.settings.fieldId);return"connect"==i.key&&i.id!=e.id&&t.settings.linkObject==n.settings.linkObject})).map((t=>{const i=e.parent.viewComponents[t.id].ui(),n=i.rows[0]??i;return{id:n.name,value:n.label}}));i&&i.length&&u.addCustomOption(t.id,{conditions:[{id:"filterByConnectValue",value:d("Filter by Connected Field Value:"),batch:"FilterByConnectedFieldValue",handler:()=>!0}],values:[{batch:"FilterByConnectedFieldValue",view:"combo",options:i}]})}))}}values(){const e=this.ids,t=this.CurrentView,i=$$(e.component),n=super.values()??{};n.settings=i.getValues()??{},n.settings.popupWidth=$$(e.popupWidth).getValue(),n.settings.popupHeight=$$(e.popupHeight).getValue(),n.settings.filterConnectedValue=$$(e.filterConnectedValue).getValue(),n.settings.filterConditions=u.getValue(),n.settings.sortFields=h.getSettings();const a=this.addPageProperty.getSettings(t)??{},o=this.editPageProperty.getSettings(t)??{};return n.settings.formView=a.formView,n.settings.editForm=o.editForm,n}ViewClass(){return super._ViewClass("connect")}get addPageProperty(){return this._addPage||(this._addPage=new l),this._addPage}get editPageProperty(){return this._editPage||(this._editPage=new c),this._editPage}showFilterPopup(e){u.popUp(e,null,{pos:"top"})}showSortPopup(e){h.show(e,null,{pos:"top"})}}}},1722:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_custom",{}),this.AB=e}static get key(){return"fieldcustom"}}}},35:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_datepicker",{}),this.AB=e}static get key(){return"datepicker"}}}},4412:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L(),a={required:0,disable:0};return class extends t{constructor(t,i={}){super(t,Object.assign(i,{field:"",required:"",disable:""})),this.AB=e}ui(e=[],t={}){const n=this.ids,a=this.AB.UISettings.config(),o=[{id:n.field,name:"fieldLabel",view:"text",disabled:!0,label:i("Field")},{id:n.required,name:"required",view:"checkbox",labelWidth:a.labelWidthCheckbox,labelRight:i("Required"),click:()=>this.onChange()},{id:n.disable,name:"disable",view:"checkbox",labelWidth:a.labelWidthCheckbox,labelRight:i("Disable"),click:()=>this.onChange()}].concat(e);return super.ui(o,t)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues(),n=e.field();$$(t.field).setValue(n?n.label:""),1==n?.settings?.required?($$(t.required).setValue(n.settings.required),$$(t.required).disable()):$$(t.required).setValue(null!=e.settings?.required?e.settings.required:i.required),1==e.settings?.disable?$$(t.disable).setValue(e.settings.disable):$$(t.disable).setValue(i.disable)}defaultValues(){const e=this.ViewClass();let t={};return e&&(t=e.defaultValues()),Object.assign(a,t)}values(){const e=this.ids,t=super.values()??{};return t.settings=t.settings??{},t.settings.required=$$(e.required).getValue(),t.settings.disable=$$(e.disable).getValue(),t}}}},5670:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_json",{type:"",filterField:""}),this.AB=e}static get key(){return"json"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"radio",label:i("Type"),vertical:!0,options:[{id:"string",value:i("JSON String")},{id:"systemObject",value:i("System Object Chooser UI")},{id:"filter",value:i("Filter UI")}],on:{onChange:t=>{"filter"==t?$$(e.filterField).show():$$(e.filterField).hide(),this.onChange()}}},{id:e.filterField,name:"filterField",view:"combo",hidden:!0,label:i("Object Field to Filter"),labelPosition:"top",placeholder:i("Select a field to filter by"),on:{onChange:e=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();let n=[{id:"",value:""}];e.parent.views().forEach((t=>{if("json"==t.key&&"systemObject"==t.settings.type){let i=e.parent.viewComponents[t.id];n.push({id:t.settings.fieldId,value:i.settings.fieldLabel})}})),$$(t.filterField).define("options",n),e.settings.filterField&&$$(t.filterField).setValue(e.settings.filterField),$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("json")}}}},6378:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_number",{isStepper:""}),this.AB=e}static get key(){return"numberbox"}ui(){const e=this.ids,t=this.AB.UISettings.config();return super.ui([{id:e.isStepper,name:"isStepper",view:"checkbox",labelWidth:t.labelWidthCheckbox,labelRight:i("Plus/Minus Buttons"),on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.isStepper).setValue(null!=e.settings.isStepper?e.settings.isStepper:i.isStepper)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.isStepper=$$(e.isStepper).getValue(),i}ViewClass(){return super._ViewClass("numberbox")}}}},7754:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_select_multiple",{type:""}),this.AB=e}static get key(){return"selectmultiple"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"richselect",label:i("Type"),options:[{id:"multicombo",value:i("Multi Combo")},{id:"checkbox",value:i("Checkboxes")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("selectmultiple")}}}},9720:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_select_single",{type:""}),this.AB=e}static get key(){return"selectsingle"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"richselect",label:i("Type"),options:[{id:"richselect",value:i("Select list")},{id:"radio",value:i("Radio")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("selectsingle")}}}},2651:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_textbox",{type:""}),this.AB=e}static get key(){return"textbox"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"radio",label:i("Type"),vertical:!0,options:[{id:"single",value:i("Single line")},{id:"multiple",value:i("Multiple lines")},{id:"rich",value:i("Rich editor")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("textbox")}}}},9975:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(4412);function a(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_tree",{}),this.AB=e}static get key(){return"formtree"}}}},5177:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418),a=i(4550),o=i(2439);function s(e){const t="properties_abview_gantt",i=(0,n.Z)(e),s=e.Config.uiSettings(),r=i.L(),l=(0,a.Z)(e,`${t}_workspaceView_gantt`);return class extends i{constructor(){super(t,{dataviewID:"",fields:""}),this.AB=e}static get key(){return"gantt"}ui(){const e=this.ids;return super.ui([{view:"fieldset",label:`${r("Gantt Data")}:`,labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.dataviewID,view:"richselect",name:"dataviewID",label:`${r("Datacollection")}:`,labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!==t&&(l.emit("dc.changed",e,this.CurrentView),this.onChange())}}}]}},{view:"fieldset",label:`${r("Gantt Fields")}:`,labelWidth:s.labelWidthLarge,body:{id:e.fields,view:"form",name:"fields",borderless:!0,elements:[l.ui()],on:{onChange:()=>{this.onChange()}}}}])}async init(e){this.AB=e,this.PopupNewDataFieldComponent=(0,o.Z)(e,`${t}_popupNewDataField`),await this.PopupNewDataFieldComponent.init(e),this.PopupNewDataFieldComponent.on("save",((...e)=>{l.emit("field.added",e[0])})),l.on("dc.changed",((e,t)=>{const i=this.AB.datacollectionByID(e);l.init(i.datasource,t),this.PopupNewDataFieldComponent.objectLoad(i.datasource)})),l.on("new.field",(e=>{this.PopupNewDataFieldComponent.show(null,e,!1)})),await super.init(e)}populateDataview(){const e=this.AB.Account.isSystemDesigner()?e=>!e.isSystemObject:()=>!0,t=this.CurrentApplication.datacollectionsIncluded(e),i=$$(this.ids.dataviewID);i.define("options",t.map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})))),i.refresh()}populate(e){super.populate(e);const t=this.ids,i=$$(t.component),n=this.defaultValues(),a=Object.assign(i.getValues(),n,e.settings);this.populateDataview(),i.setValues(a);let o=this.AB.datacollectionByID(a.dataviewID);o&&(l.init(o.datasource,this.CurrentView),this.PopupNewDataFieldComponent.objectLoad(o.datasource))}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values(),t=this.ids;return e.settings=Object.assign($$(t.component).getValues(),$$(t.fields).getValues()),e}ViewClass(){return super._ViewClass("gantt")}}}},4973:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var n=i(2418),a=i(3285),o=i(5997),s=i(6038),r=i(4245),l=i(8782);function c(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),c=t.L(),d="properties_abview_grid",u=new((0,r.Z)(e,d))({isGrid:!0}),h=new l.Z(e,d);return class extends t{constructor(){super(d,{isEditable:"",massUpdate:"",allowDelete:"",isSortable:"",isExportable:"",datacollection:"",groupBy:"",groupByList:"",buttonFieldsVisible:"",buttonFieldsFreeze:"",buttonSummaryFields:"",buttonCountFields:"",height:"",hideHeader:"",labelAsField:"",hideButtons:""}),this._preFilterSettings=null,this.linkPageComponent=new h,this.PopupCountColumnsComponent=function(e,t){t=t||"ui_work_object_workspace_popupCountColumns";const i=(0,a.Z)(e);var n=i.L();return new class extends i{constructor(e){super(e,{list:""}),this.CountFieldIds=[]}ui(){const e=this.ids;return{id:e.component,view:"popup",body:{rows:[{cols:[{view:"button",css:"webix_primary",value:n("Select All"),on:{onItemClick:()=>{this.clickShowAll()}}},{view:"button",value:n("Unselect All"),on:{onItemClick:()=>{this.clickHideAll()}}}]},{id:e.list,view:"list",maxHeight:250,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa ab-count-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)}}}]},on:{onShow:()=>{this.onShow()}}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}onChange(){this.emit("changed",this.CountFieldIds)}clickHideAll(){var e=$$(this.ids.list);this.CountFieldIds=[],e.find({}).forEach((e=>{this.iconHide(e.id)})),this.onChange()}clickShowAll(){var e=$$(this.ids.list);this.CountFieldIds=e.find({}).map((e=>e.id)),e.find({}).forEach((e=>{this.iconShow(e.id)})),this.onChange()}clickListItem(e){this.CountFieldIds.indexOf(e)<0?(this.CountFieldIds.push(e),this.iconShow(e)):(this.CountFieldIds=this.CountFieldIds.filter((t=>t!=e)),this.iconHide(e)),this.onChange()}getValue(){return this.CountFieldIds}iconHide(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-count-field-icon").classList.remove("fa-circle")}iconShow(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-count-field-icon").classList.add("fa-circle")}setValue(e){this.CountFieldIds=e||[],this.onShow()}onShow(){var e=this.CurrentObject.fields().map((e=>({id:e.id,label:e.label})));$$(this.ids.list).clearAll(),$$(this.ids.list).parse(e),this.CountFieldIds.forEach((e=>{this.iconShow(e)}))}show(...e){$$(this.ids.component).show(...e)}}(t)}(e,`${d}_count`),this.PopupCountColumnsComponent.on("changed",(e=>{this.badgesCount(e),this.onChange()})),this.PopupFrozenColumnsComponent=new o.Z(e,`${d}_frozenFields`),this.PopupFrozenColumnsComponent.on("changed",(e=>{this.badgesFrozen(e),this.PopupHideFieldComponent.setFrozenColumnID(e),this.onChange()})),this.PopupHideFieldComponent=(0,s.Z)(e,`${d}_hideFields`),this.PopupHideFieldComponent.on("changed",((e=[])=>{this.badgesHidden(e),this.PopupFrozenColumnsComponent.setHiddenFields(e),this.onChange()})),this.PopupSummaryColumnsComponent=function(e,t){t=t||"ui_work_object_workspace_popupSummaryColumns";const i=(0,a.Z)(e);var n=i.L();return new class extends i{constructor(t){super(t,{list:""}),this.ABFieldNumber=e.Class.ABFieldManager.fieldByKey("number"),this.ABFieldFormula=e.Class.ABFieldManager.fieldByKey("formula"),this.ABFieldCalculate=e.Class.ABFieldManager.fieldByKey("calculate"),this.SummaryFieldIds=[]}ui(){const e=this.ids;return{view:"popup",id:e.component,body:{rows:[{cols:[{view:"button",value:n("Select All"),on:{onItemClick:()=>{this.clickHideAll()}}},{view:"button",css:"webix_primary",value:n("Unselect All"),on:{onItemClick:()=>{this.clickShowAll()}}}]},{view:"list",id:e.list,maxHeight:250,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa ab-summary-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)}}}]},on:{onShow:()=>{this.onShow()}}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}clickHideAll(){var e=$$(this.ids.list);this.SummaryFieldIds=[],e.find({}).forEach((e=>{this.iconHide(e.id)})),this.emit("changed",this.SummaryFieldIds)}clickShowAll(){var e=$$(this.ids.list);this.SummaryFieldIds=e.find({}).map((e=>e.id)),e.find({}).forEach((e=>{this.iconShow(e.id)})),this.emit("changed",this.SummaryFieldIds)}clickListItem(e){this.SummaryFieldIds.indexOf(e)<0?(this.SummaryFieldIds.push(e),this.iconShow(e)):(this.SummaryFieldIds=this.SummaryFieldIds.filter((t=>t!=e)),this.iconHide(e)),this.emit("changed",this.SummaryFieldIds)}getValue(){return this.SummaryFieldIds}iconHide(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-summary-field-icon").classList.remove("fa-circle")}iconShow(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-summary-field-icon").classList.add("fa-circle")}setValue(e){this.SummaryFieldIds=e||[],this.onShow()}onShow(){const e=this.ids;var t=this.CurrentObject.fields((e=>e instanceof this.ABFieldNumber)).map((e=>({id:e.id,label:e.label}))),i=this.CurrentObject.fields((e=>e instanceof this.ABFieldCalculate)).map((e=>({id:e.id,label:e.label}))),n=this.CurrentObject.fields((e=>e instanceof this.ABFieldFormula)).map((e=>({id:e.id,label:e.label}))),a=t.concat(i);a=a.concat(n),$$(e.list).clearAll(),$$(e.list).parse(a),this.SummaryFieldIds.forEach((e=>{this.iconShow(e)}))}show(...e){$$(this.ids.component).show(...e)}}(t)}(e,`${d}_summary`),this.PopupSummaryColumnsComponent.on("changed",(e=>{this.badgesSummary(e),this.onChange()}))}static get key(){return"grid"}ui(){let e=this.ids,t=this;return super.ui([{view:"fieldset",label:c("Grid Properties:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.isEditable,view:"checkbox",name:"isEditable",labelRight:c("User can edit in grid."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.massUpdate,view:"checkbox",name:"massUpdate",labelRight:c("User can edit multiple items at one time."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.allowDelete,view:"checkbox",name:"allowDelete",labelRight:c("User can delete records."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.isSortable,view:"checkbox",name:"isSortable",labelRight:c("User can sort records."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.isExportable,view:"checkbox",name:"isExportable",labelRight:c("User can export."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}}]}},{view:"fieldset",label:c("Grid Data:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.datacollection,view:"richselect",name:"datacollection",label:c("Datacollection:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:(t,i)=>{if(t!=i){this.linkPageComponent.clear();let i=this.CurrentView?.AB.datacollectionByID(t);i&&"query"==i.sourceType?($$(e.isEditable).setValue(!1),$$(e.massUpdate).setValue(!1),$$(e.allowDelete).setValue(!1),$$(e.isEditable).disable(),$$(e.massUpdate).disable(),$$(e.allowDelete).disable()):($$(e.isEditable).enable(),$$(e.massUpdate).enable(),$$(e.allowDelete).enable()),this.refreshGroupBy(i),this.onChange()}}}}]}},{view:"fieldset",label:c("Group:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.groupBy,view:"multiselect",name:"groupBy",label:c("Group by:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:e=>{this.refreshGroupByList(e),this.onChange()}}},{id:e.groupByList,view:"list",name:"groupByList",drag:!0,data:[],height:200,template:"<span class='fa fa-sort'></span>&nbsp;&nbsp; #value#",on:{onAfterDrop:()=>{this.onChange()}}}]}},this.linkPageComponent.ui(),{view:"fieldset",label:c("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:c("Hidden Fields:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonFieldsVisible,view:"button",name:"buttonFieldsVisible",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupHideFieldComponent.show(this.$view)}}]},{cols:[{view:"label",label:c("Filter Option:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonFilterData,view:"button",name:"buttonFilterData",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:()=>{this.filter_property_popup.show()}}]},{cols:[{view:"label",label:c("Freeze Columns:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonFieldsFreeze,view:"button",name:"buttonFieldsFreeze",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupFrozenColumnsComponent.show(this.$view)}}]},{cols:[{view:"label",label:c("Summary Fields:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonSummaryFields,view:"button",name:"buttonSummaryFields",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupSummaryColumnsComponent.show(this.$view)}}]},{cols:[{view:"label",label:c("Count Fields:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonCountFields,view:"button",name:"buttonCountFields",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupCountColumnsComponent.show(this.$view)}}]},{id:e.height,view:"counter",name:"height",label:c("Height:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:e.hideHeader,view:"checkbox",name:"hideHeader",labelRight:c("Hide table header"),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.labelAsField,view:"checkbox",name:"labelAsField",labelRight:c("Show a field using label template"),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.hideButtons,view:"checkbox",name:"hideButtons",labelRight:c("Hide edit and view buttons"),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}}]}},{}])}async init(e){super.init(e);var i=this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));$$(this.ids.datacollection).define("options",i),$$(this.ids.datacollection).refresh(),this._handler_onCancel=()=>{u.setSettings(this._preFilterSettings),this.filter_property_popup.hide()},this.filter_property_popup=webix.ui({view:"window",modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",hidden:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:c("Filter Menu")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:this._handler_onCancel,on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:u.ui()}),u.on("cancel",this._handler_onCancel),u.on("save",(()=>{this.filter_property_popup.hide(),this.onChange()}));let n=[];return n.push(u.init(e)),n.push(this.linkPageComponent.init(e)),n.push(this.PopupFrozenColumnsComponent.init(e)),n.push(this.PopupHideFieldComponent.init(e)),n.push(this.PopupSummaryColumnsComponent.init(e)),n.push(this.PopupCountColumnsComponent.init(e)),Promise.all(n)}badgesCount(e){let t=e.length;0==t&&(t=!1),$$(this.ids.buttonCountFields).config.badge=t,$$(this.ids.buttonCountFields).refresh()}badgesHidden(e){let t=e.length;0==t&&(t=!1),$$(this.ids.buttonFieldsVisible).config.badge=t,$$(this.ids.buttonFieldsVisible).refresh()}badgesFrozen(e){const t=this.CurrentView.settings.hiddenFields||[];let i=this.CurrentView.datacollection.datasource.fields((e=>-1==t.indexOf(e.columnName))).map((e=>e.columnName)).indexOf(e)+1;0==i&&(i=!1),$$(this.ids.buttonFieldsFreeze).config.badge=i,$$(this.ids.buttonFieldsFreeze).refresh()}badgesSummary(e){let t=e.length;0==t&&(t=!1),$$(this.ids.buttonSummaryFields).config.badge=t,$$(this.ids.buttonSummaryFields).refresh()}get datacollection(){return this.AB.datacollectionByID(this.CurrentView.settings?.dataviewID)}populate(e){super.populate(e);let t=this.ids;if(!e)return;$$(t.datacollection).setValue(e.settings.dataviewID),$$(t.isEditable).setValue(e.settings.isEditable),$$(t.massUpdate).setValue(e.settings.massUpdate),$$(t.allowDelete).setValue(e.settings.allowDelete),$$(t.isSortable).setValue(e.settings.isSortable),$$(t.isExportable).setValue(e.settings.isExportable),""!=e.settings.datacollection?$$(t.datacollection).setValue(e.settings.dataviewID):$$(t.datacollection).setValue(""),$$(t.height).setValue(e.settings.height),$$(t.hideHeader).setValue(e.settings.hideHeader),$$(t.labelAsField).setValue(e.settings.labelAsField),$$(t.hideButtons).setValue(e.settings.hideButtons),this.refreshGroupBy(),this.refreshGroupByList(e.settings.groupBy);let i=this.datacollection;i&&(u.objectLoad(i.datasource),u.setSettings(e.settings.gridFilter),this.PopupCountColumnsComponent.objectLoad(i.datasource),this.PopupCountColumnsComponent.setValue(e.settings.countColumns||""),this.PopupFrozenColumnsComponent.objectLoad(i.datasource),this.PopupFrozenColumnsComponent.setValue(e.settings.frozenColumnID||""),this.PopupFrozenColumnsComponent.setHiddenFields(e.settings.hiddenFields),this.PopupHideFieldComponent.objectLoad(i.datasource),this.PopupHideFieldComponent.setSettings(e.settings.hiddenFields),this.PopupHideFieldComponent.setFrozenColumnID(e.settings.frozenColumnID||""),this.PopupSummaryColumnsComponent.objectLoad(i.datasource),this.PopupSummaryColumnsComponent.setValue(e.settings.summaryColumns||[]),this.badgesCount(e.settings.countColumns),this.badgesHidden(e.settings.hiddenFields),this.badgesFrozen(e.settings.frozenColumnID),this.badgesSummary(e.settings.summaryColumns)),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}filterMenuShow(){this._preFilterSettings=u.getSettings(),this.filter_property_popup.show()}refreshGroupBy(e){const t=this.ids;let i=this.CurrentView,n=[];(e=e||this.datacollection)&&e.datasource&&e.datasource.fields((e=>!e.isConnection&&i.settings.hiddenFields.indexOf(e.columnName)<0)).forEach((e=>{n.push({id:e.columnName,value:e.label})})),$$(t.groupBy).define("options",n),$$(t.groupBy).refresh(),$$(t.groupBy).setValue(i.settings.groupBy)}refreshGroupByList(e){const t=this.ids;let i=e||[];"string"==typeof i&&(i=i.split(","));let n=$$(t.groupBy).getList().data.find({});$$(t.groupByList).clearAll(),i.forEach((e=>{let i=n.filter((t=>t.id==e))[0];i&&$$(t.groupByList).add(i)}))}values(){let e=this.ids,t=super.values();t.settings=t.settings||{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.isEditable=$$(e.isEditable).getValue(),t.settings.massUpdate=$$(e.massUpdate).getValue(),t.settings.allowDelete=$$(e.allowDelete).getValue(),t.settings.isSortable=$$(e.isSortable).getValue(),t.settings.isExportable=$$(e.isExportable).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.hideHeader=$$(e.hideHeader).getValue(),t.settings.labelAsField=$$(e.labelAsField).getValue(),t.settings.hideButtons=$$(e.hideButtons).getValue();let i=$$(e.groupByList).serialize()||[];t.settings.groupBy=i.map((e=>e.id)).join(","),t.settings.gridFilter=u.getSettings(),t.settings.hiddenFields=this.PopupHideFieldComponent.getSettings(),t.settings.frozenColumnID=this.PopupFrozenColumnsComponent.getValue(),t.settings.summaryColumns=this.PopupSummaryColumnsComponent.getValue(),t.settings.countColumns=this.PopupCountColumnsComponent.getValue();let n=this.linkPageComponent.getSettings();for(let e in n)t.settings[e]=n[e];return t}ViewClass(){return super._ViewClass("grid")}}}},5281:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_image",{width:"",height:""})}static get key(){return"image"}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:a("Image:"),css:"ab-text-bold",width:i.labelWidthXLarge},{view:"uploader",value:a("Upload image"),name:"file",apiOnly:!0,inputName:"image",multiple:!1,accept:"image/png, image/gif, image/jpeg, image/jpg, image/bmp",upload:"/image/upload/1",on:{onFileUpload:t=>{if(t&&t.data){if(this.filename=t.data.uuid,t.file){let i=new Image;i.onload=function(){$$(e.width).setValue(i.width),$$(e.height).setValue(i.height)},i.src=URL.createObjectURL(t.file)}this.onChange()}},onFileUploadError:(e,t)=>{}}}]},{id:e.width,view:"counter",name:"width",label:a("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:(e,t)=>{e!=t&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout((()=>{this._saveTimeout=null,this.onChange()}),1e3))}}},{id:e.height,view:"counter",name:"height",label:a("Height:"),labelWidth:i.labelWidthXLarge,on:{onChange:(e,t)=>{e!=t&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout((()=>{this._saveTimeout=null,this.onChange()}),1e3))}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e),this.filename=e.settings.filename;const t=this.ids;let i=$$(t.width);i.blockEvent(),i.setValue(e.settings.width),i.unblockEvent();let n=$$(t.height);n.blockEvent(),n.setValue(e.settings.height),n.unblockEvent()}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=super.values();return t.settings=t.settings||{},t.settings.filename=this.filename,t.settings.width=$$(e.width).getValue(),t.settings.height=$$(e.height).getValue(),t}ViewClass(){return super._ViewClass("label")}}}},5711:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var n=i(2418),a=i(5609),o=i(2439),s=i(8782);function r(e){const t="properties_abview_kanban",i=(0,n.Z)(e),r=(0,s.Z)(e,t),l=i.L(),c=e.UISettings.config(),d=(0,a.Z)(e,`${t}_prop`);var u=null;return class extends i{constructor(){super(t,{datacollection:""}),this.linkPageComponent=new r(e,t)}static get key(){return"kanban"}ui(){let e=d.ui(),t=[{view:"fieldset",label:l("Kanban Data:"),labelWidth:c.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.datacollection,view:"richselect",name:"dataviewID",label:l("Data Source:"),placeholder:l("Select a Datacollection"),labelWidth:c.labelWidthLarge,options:[],on:{onChange:(e,t)=>{e!=t&&(this.refreshFields(e),this.onChange())}}}]}},...e.rows,this.linkPageComponent.ui()];return super.ui(t)}async init(e){this.AB=e,d.on("new.field",(e=>{let t=this.AB.datacollectionByID(this.CurrentView.settings.dataviewID);u.objectLoad(t.datasource),u.resetState(),u.show(null,e,!1)})),d.on("changed",(()=>{this.onChange()})),u=(0,o.Z)(e,`${t}_popupNewDataField`),await u.init(e),u.on("save",((...e)=>{d.emit("field.added",e[0])})),this.linkPageComponent.init(),this.linkPageComponent.on("change",(()=>{this.onChange()})),await super.init(e)}populate(e){super.populate(e);var t=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));let i=$$(this.ids.datacollection),n=e.settings.dataviewID||null;i.blockEvent(),i.define("options",t),i.define("value",n),i.unblockEvent(),i.refresh(),this.refreshFields(n),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}refreshFields(e){let t=this.AB.datacollectionByID(e);if(!t)return void d.clearValues();let i=t.datasource;d.init(i,this.CurrentView),u.objectLoad(i)}values(){const e=super.values(),t=this.ids,i=$$(t.component);e.settings=i.getValues();const n=this.linkPageComponent.getSettings();for(const t in n)e.settings[t]=n[t];return e}ViewClass(){return super._ViewClass("kanban")}}}},4247:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_label",{text:"",format:"",alignment:""}),this.AB=e}static get key(){return"label"}ui(){const e=this.defaultValues(),t=this.ids;return super.ui([{id:t.text,view:"text",name:"text",label:i("Text"),placeholder:i("Text Placeholder"),on:{onChange:(e,t)=>{if(e!==t){const t=this.CurrentView;t.text=e,t.save(),this.onChange()}}}},{view:"fieldset",label:i("Format Options:"),body:{type:"clean",padding:10,rows:[{id:t.format,view:"radio",name:"format",vertical:!0,value:e.format,options:[{id:0,value:i("normal")},{id:1,value:i("title")},{id:2,value:i("description")}],on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:i("Alignment:"),body:{type:"clean",padding:10,rows:[{id:t.alignment,view:"radio",name:"alignment",vertical:!0,value:e.alignment,options:[{id:"left",value:i("Left")},{id:"center",value:i("Center")},{id:"right",value:i("Right")}],on:{onChange:()=>{this.onChange()}}}]}},{}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids;$$(t.text).setValue(e.text),$$(t.format).setValue(e.settings.format),$$(t.alignment).setValue(e.settings.alignment)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i.text=i.settings.text,i}ViewClass(){return super._ViewClass("label")}}}},1163:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_layout",{}),this.AB=e}static get key(){return"layout"}ui(){return super.ui([{view:"button",css:"webix_primary",value:i("Add Column "),click:()=>this.addView()}])}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}ViewClass(){return super._ViewClass("layout")}async addView(){const e=this.CurrentView;e.addColumn();const t=[];e.views().forEach((e=>{t.push(e.save())})),await Promise.all(t),this.onChange()}}}},8450:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.UISettings.config();return class extends t{constructor(){super("properties_abview_list",{datacollection:"",field:"",height:""})}static get key(){return"list"}ui(){const e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.propertyUpdateFieldOptions(e),this.onChange())}}},{id:e.field,name:"field",view:"richselect",label:i("Field"),labelWidth:a.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:i("Height:"),labelWidth:a.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}propertyUpdateFieldOptions(e){var t=this.AB.datacollectionByID(e),i=t?t.datasource:null,n=[];null!=i&&(n=i.fields().map((e=>({id:e.id,value:e.label}))));const a=this.ids;$$(a.field).define("options",n),$$(a.field).refresh()}populate(e){super.populate(e);const t=this.ids;var i=e.settings.dataviewID?e.settings.dataviewID:null,n=$$(t.datacollection),a=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));n.define("options",a),n.define("value",i),n.refresh(),this.propertyUpdateFieldOptions(i),$$(t.field).setValue(e.settings.field),$$(t.height).setValue(e.settings.height)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i}ViewClass(){return super._ViewClass("list")}}}},6598:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();let o={};return class extends t{constructor(){super("properties_abview_menu",{orientation:"",buttonStyle:"",menuAlignment:"",menuInToolbar:0,menuPadding:"",menuTheme:"",menuPosition:"",menuTextLeft:"",menuTextCenter:"",menuTextRight:"",pages:"",treeDnD:"",pagesFieldset:"",pageOrderFieldset:""}),this.AB=e,o=this.AB.Class.ABViewManager.viewClass("menu").defaultValues()}static get key(){return"menu"}ui(){const e=this.ids;return super.ui([{id:e.orientation,name:"orientation",view:"richselect",label:a("Orientation"),value:o.orientation,labelWidth:i.labelWidthXLarge,options:[{id:"x",value:a("Horizontal")},{id:"y",value:a("Vertical")}],on:{onChange:()=>{this.onChange()}}},{id:e.buttonStyle,name:"buttonStyle",view:"richselect",label:a("Button Style"),value:o.buttonStyle,labelWidth:i.labelWidthXLarge,options:[{id:"ab-menu-default",value:a("Default")},{id:"ab-menu-link",value:a("Link")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuAlignment,name:"menuAlignment",view:"richselect",label:a("Menu Alignment"),value:o.menuAlignment,labelWidth:i.labelWidthXLarge,options:[{id:"ab-menu-left",value:a("Left")},{id:"ab-menu-center",value:a("Center")},{id:"ab-menu-right",value:a("Right")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuInToolbar,name:"menuInToolbar",view:"checkbox",labelRight:a("Put menu in toolbar"),value:o.menuInToolbar,labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{name:"toolbarFieldset",view:"fieldset",label:a("Toolbar Settings:"),labelWidth:i.labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{id:e.menuPadding,name:"menuPadding",view:"counter",label:a("Toolbar padding"),value:o.menuPadding,labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.menuTheme,name:"menuTheme",view:"richselect",label:a("Toolbar theme"),value:o.menuTheme,labelWidth:i.labelWidthLarge,options:[{id:"white",value:a("White")},{id:"bg_gray",value:a("Gray")},{id:"webix_dark",value:a("Dark")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuPosition,name:"menuPosition",view:"richselect",label:a("Menu Position"),value:o.menuPosition,labelWidth:i.labelWidthLarge,options:[{id:"left",value:a("Left")},{id:"center",value:a("Center")},{id:"right",value:a("Right")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuTextLeft,name:"menuTextLeft",view:"text",label:a("Text Left"),placeholder:a("Place text in left region of toolbar."),labelWidth:i.labelWidthLarge,labelPosition:"top",on:{onChange:()=>{this.onChange()}}},{id:e.menuTextCenter,name:"menuTextCenter",view:"text",label:a("Text Center"),placeholder:a("Place text in center region of toolbar."),labelWidth:i.labelWidthLarge,labelPosition:"top",on:{onChange:()=>{this.onChange()}}},{id:e.menuTextRight,name:"menuTextRight",view:"text",label:a("Text Right"),placeholder:a("Place text in right region of toolbar."),labelWidth:i.labelWidthLarge,labelPosition:"top",on:{onChange:()=>{this.onChange()}}}]}},{id:e.pagesFieldset,name:"pagesFieldset",view:"fieldset",label:a("Page List:"),labelWidth:i.labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{id:e.pages,name:"pages",view:"edittree",borderless:!0,css:"transparent",editable:!0,editValue:"aliasname",editor:"text",template:function(e,t){return`<div class='ab-page-list-item'>\n                              ${t.icon(e)} ${t.checkbox(e,!1)} <div class="fa fa-${"viewcontainer"==e.key?"window-maximize":"file"}"></div> \n                              ${e.label}</div>`},on:{onItemCheck:(e,t)=>{this.onChange(),this.updateTreeDnD(e,t)},onBeforeEditStart:function(e){const t=this.getItem(e);t.aliasname||(t.aliasname=t.label,this.updateItem(t))},onBeforeEditStop:(t,i)=>{const n=$$(e.pages),a=$$(e.treeDnD);let o=n.getItem(i.id);if(o&&(o.translations.forEach((e=>{e.language_code==this.AB.Multilingual.currentLanguage()&&(e.aliasname=t.value)})),o.label=t.value,n.updateItem(i.id,o)),a.exists(i.id)){let e=a.getItem(i.id)||{};e.value=t.value,e.aliasname=t.value,this.onChange(),a.updateItem(i.id,e)}}}}]}},{id:e.pageOrderFieldset,name:"pageOrderFieldset",view:"fieldset",label:a("Drag & Drop to Reorder/Click to Add Icon:"),labelWidth:i.labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{id:e.treeDnD,view:"edittree",borderless:!0,name:"treeDnD",template:"{common.icon()} <i class='fa fa-fw fa-#icon#'></i> <span>#value#</span>",drag:!0,editable:!0,editValue:"icon",editor:"combo",options:this.AB._App.icons,suggest:{template:"#value#",filter:function(e,t){return 0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())},body:{template:"<i class='fa fa-fw fa-#value#'></i> #value#"}},on:{onBeforeDrop:function(e){e.parent=e.target,e.index=-1},onAfterDrop:(e,t)=>{this.reorderPages()},onDataUpdate:()=>{this.reorderPages()}}}]}}])}populate(e){if(super.populate(e),!e)return;const t=this.ids;$$(t.orientation).setValue(e.settings.orientation??o.orientation),$$(t.buttonStyle).setValue(e.settings.buttonStyle??o.buttonStyle),$$(t.menuAlignment).setValue(e.settings.menuAlignment??o.menuAlignment),$$(t.menuInToolbar).setValue(parseInt(e.settings.menuInToolbar)??o.menuInToolbar),$$(t.menuPadding).setValue(e.settings.menuPadding??o.menuPadding),$$(t.menuTheme).setValue(e.settings.menuTheme??o.menuTheme),$$(t.menuPosition).setValue(e.settings.menuPosition??o.menuPosition),e.menuTextLeft=e.menuTextLeft||e.settings.menuTextLeft,$$(t.menuTextLeft).setValue(e.menuTextLeft??o.menuTextLeft),e.menuTextCenter=e.menuTextCenter||e.settings.menuTextCenter,$$(t.menuTextCenter).setValue(e.menuTextCenter??o.menuTextCenter),e.menuTextRight=e.menuTextRight||e.settings.menuTextRight,$$(t.menuTextRight).setValue(e.menuTextRight??o.menuTextRight);const i=new this.AB.Webix.TreeCollection,n=e.application,a=e.pageRoot();n.pages((e=>a?.id==e.id),!0).forEach(((t,n)=>{this.addPage(e,t,n,i)}));const s=$$(t.pages);s.clearAll(),s.data.importData(i),s.refresh(),s.blockEvent(),s.uncheckAll(),s.unblockEvent(),s.openAll();const r=$$(t.treeDnD);r.clearAll(),e?.settings?.order?.forEach((t=>{s.exists(t.tabId??t.pageId)&&(s.blockEvent(),s.checkItem(t.tabId??t.pageId),s.unblockEvent());const i=e.getAliasname(t);r.add({id:t.tabId??t.pageId,value:i,type:t.type,pageId:t.pageId??"",tabId:t.tabId??"",icon:t.icon},t.position?parseInt(t.position):0,t.parent&&"0"!=t.parent?t.parent:"")})),r.openAll(),$$(t.pagesFieldset).config.height=28*s.count()+18+40,$$(t.pagesFieldset).resize(),$$(t.pageOrderFieldset).config.height=28*s.count()+18+40,$$(t.pageOrderFieldset).resize()}values(){const e=this.ids;let t=super.values();if(t.settings=t.settings??{},t.settings.orientation=$$(e.orientation).getValue(),t.settings.buttonStyle=$$(e.buttonStyle).getValue(),t.settings.menuAlignment=$$(e.menuAlignment).getValue(),t.settings.menuInToolbar=$$(e.menuInToolbar).getValue(),t.settings.menuPadding=$$(e.menuPadding).getValue(),t.settings.menuTheme=$$(e.menuTheme).getValue(),t.settings.menuPosition=$$(e.menuPosition).getValue(),t.menuTextLeft=$$(e.menuTextLeft).getValue(),t.menuTextCenter=$$(e.menuTextCenter).getValue(),t.menuTextRight=$$(e.menuTextRight).getValue(),t.menuTextLeft.length&&(t.settings.menuTextLeft=""),t.menuTextCenter.length&&(t.settings.menuTextCenter=""),t.menuTextCenter.length&&(t.settings.menuTextRight=""),$$(e.pages)){for(let t=0;t<$$(e.pages).data.count();t++){let i=$$(e.pages).getIdByIndex(t);const n=$$(e.pages).getItem(i);let a,o="page";"viewcontainer"==n.key?(o="tab",a=i,i=n.pageParent().id):a="";let s=[];n&&n.translations&&(s=n.translations)}t.settings.pages&&delete t.settings.pages}return t}ViewClass(){return super._ViewClass("menu")}updateTreeDnD(e,t){const i=this.ids,n=this.CurrentView,o=$$(i.treeDnD),s=$$(i.pages);let r=n.application.pages((t=>t.id==e),!0)[0];if(r||(r=n.application.views((t=>t.id==e),!0)[0]),t){let e=n.getAliasname(r);o.add({id:r.id,value:e,type:r.type,pageId:r.pageId??"",tabId:r.tabId??""}),this.reorderPages()}else o.exists(e)&&!o.isBranch(e)?(o.remove(e),this.reorderPages()):o.exists(e)&&o.isBranch(e)&&(s.blockEvent(),s.checkItem(e),this.AB.Webix.message({text:a("Item comtains submenu, please remove items in submenu before removing."),type:"error",expire:1e4}),s.unblockEvent())}reorderPages(){const e=this.ids,t=this.CurrentView,i=$$(e.treeDnD);let n=[];i.data.each((e=>{let i=t.application.pages((t=>t.id==e.id),!0)[0];i||(i=t.application.views((t=>t.id==e.id),!0)[0]),n.push(i)}));let a=[];n.forEach((i=>{if(i){const n={},o=i.id,s=$$(e.treeDnD).getItem(o);n.parent=s.$parent,n.position=$$(e.treeDnD).getBranchIndex(o),n.icon=s.icon,n.type="viewcontainer"==i.key?"tab":"page","tab"==n.type?(n.tabId=i.id,n.pageId=t.getParentPageId(i)):n.pageId=i.id,n.isChecked="true",n.translations=i.translations,a.push(n)}})),t.settings.order=a,this.onChange(),i.openAll()}addPage(e,t,i,n,a){e?.settings?.order?.forEach((e=>{(e.pageId==t.id&&!e.id||a&&e.pageId==a&&e.tabId==t.id)&&(t.translations=e.translations)}));const o=e.getAliasname(t);t.label=o||t.label,n.add(t,i,a);const s=t.pages?t.pages():[];s.forEach(((i,a)=>{this.addPage(e,i,a,n,t.id)}));const r=this.AB.Class.ABViewManager.viewClass("tab");t.views((e=>e instanceof r)).forEach(((i,a)=>{i.views().forEach(((i,o)=>{const r=s.length+a+o;this.addPage(e,i,r,n,t.id)}))}))}}}},3348:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(2418),a=i(708);function o(e){const t="properties_abview_pdfImporter",i=(0,n.Z)(e),o=i.L(),s=e.UISettings.config(),r=(0,a.Z)(e,`${t}_popupSubmitRule`);return class extends i{constructor(){super(t,{datacollection:"",field:"",buttonSubmitRules:""}),this.AB=e}static get key(){return"pdfImporter"}ui(){const e=this.ids;return super.ui([{view:"fieldset",label:o("Data:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.datacollection,name:"dataviewID",view:"richselect",label:o("Data Source"),labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.onChange(),this.populateFieldOptions())}}},{id:e.field,name:"fieldID",view:"richselect",label:o("Field"),labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&this.onChange()}}},{view:"fieldset",label:o("Rules:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:o("Submit Rules:"),width:s.labelWidthLarge},{id:e.buttonSubmitRules,view:"button",css:"webix_primary",name:"buttonSubmitRules",label:o("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.submitRuleShow()}}]}]}}]}}])}async init(e){this.AB=e,await super.init(e),r.init(e),r.on("save",(()=>{this.onChange(),this.populateBadgeNumber()}))}populate(e){super.populate(e);const t=this.ids,i=$$(t.datacollection),n=e.settings.dataviewID,a=e.application.datacollectionsIncluded().filter((e=>"object"==e.sourceType&&!e?.datasource?.isReadOnly)).map((e=>({id:e.id,value:e.label,icon:"fa fa-database"})));i.define("options",a),i.define("value",n),i.refresh(),this.populateFieldOptions(e),r.objectLoad(this.CurrentObject),r.viewLoad(e),r.fromSettings(e.settings.submitRules??[])}populateFieldOptions(e){e=e??this.CurrentView;const t=$$(this.ids.datacollection),i=$$(this.ids.field),n=e.settings.fieldID,a=this.AB.datacollections((e=>e.id==t.getValue()))[0]?.datasource?.fields((e=>"image"==e.key))?.map((e=>({id:e.id,value:e.label,icon:"fa fa-file-image-o"})))??[];i.define("options",a),i.define("value",n),i.refresh()}populateBadgeNumber(){const e=this.ids,t=this.CurrentView;t&&($$(e.buttonSubmitRules).define("badge",t?.settings?.submitRules?.length||null),$$(e.buttonSubmitRules).refresh())}values(){const e=$$(this.ids.component),t=super.values();return t.settings=e.getValues(),t.settings.submitRules=r.toSettings(),t}submitRuleShow(){r.fromSettings(this.CurrentView.settings.submitRules),r.show()}ViewClass(){return super._ViewClass("pdfImporter")}}}},9630:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3156);function a(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_page",{type:"",popupSettings:"",popupWidth:"",popupHeight:"",pageSettings:"",fixedPageWidth:"",pageWidth:"",pageBackground:""})}static get key(){return"page"}ui(){let e=this.ids,t=this;return super.ui([{id:e.type,name:"type",view:"richselect",label:a("Type"),options:[{id:"page",value:a("Page")},{id:"popup",value:a("Popup")}],on:{onChange:t=>{"page"==t?($$(e.popupSettings).hide(),$$(e.pageSettings).show()):($$(e.popupSettings).show(),$$(e.pageSettings).hide()),this.onChange()}}},{id:e.popupSettings,view:"fieldset",name:"popupSettings",label:a("Popup Settings"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.popupWidth,view:"text",name:"popupWidth",placeholder:a("Set popup width"),label:a("Width:"),labelWidth:i.labelWidthLarge,validate:webix.rules.isNumber,on:{onChange:()=>{this.onChange()}}},{id:e.popupHeight,view:"text",name:"popupHeight",placeholder:a("Set popup height"),label:a("Height:"),labelWidth:i.labelWidthLarge,validate:webix.rules.isNumber,on:{onChange:()=>{this.onChange()}}}]}},{id:e.pageSettings,view:"fieldset",name:"pageSettings",label:a("Page Settings"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fixedPageWidth,view:"checkbox",name:"fixedPageWidth",labelRight:a("Page has fixed width"),labelWidth:i.labelWidthCheckbox,click:function(){1==this.getValue()?$$(e.pageWidth).show():$$(e.pageWidth).hide(),t.onChange()}},{id:e.pageWidth,view:"text",name:"pageWidth",placeholder:a("Set page width"),label:a("Page width:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.pageBackground,view:"richselect",name:"pageBackground",label:a("Page background:"),labelWidth:i.labelWidthXLarge,options:[{id:"ab-background-default",value:a("White (default)")},{id:"ab-background-gray",value:a("Dark")}],on:{onChange:()=>{this.onChange()}}}]}}])}populate(e){super.populate(e);let t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type),$$(t.popupWidth).setValue(e.settings.popupWidth||i.popupWidth),$$(t.popupHeight).setValue(e.settings.popupHeight||i.popupHeight),$$(t.pageWidth).setValue(e.settings.pageWidth||i.pageWidth),$$(t.fixedPageWidth).setValue(e.settings.fixedPageWidth||i.fixedPageWidth),$$(t.pageBackground).setValue(e.settings.pageBackground||i.pageBackground),e.isRoot()?$$(t.type).hide():$$(t.type).show(),"popup"==e.settings.type?($$(t.popupSettings).show(),$$(t.pageSettings).hide()):($$(t.popupSettings).hide(),$$(t.pageSettings).show()),1==e.settings.fixedPageWidth?$$(t.pageWidth).show():$$(t.pageWidth).hide()}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){let e=this.ids,t=super.values();return t.settings=t.settings||{},t.settings.type=$$(e.type).getValue(),t.settings.popupWidth=$$(e.popupWidth).getValue(),t.settings.popupHeight=$$(e.popupHeight).getValue(),t.settings.pageWidth=$$(e.pageWidth).getValue(),t.settings.fixedPageWidth=$$(e.fixedPageWidth).getValue(),t.settings.pageBackground=$$(e.pageBackground).getValue(),t}ViewClass(){return super._ViewClass("page")}}}},1832:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.UISettings.config();return class extends t{constructor(){super("properties_abview_pivot",{datacollection:"",height:"",removeMissed:"",totalColumn:"",separateLabel:"",min:"",max:"",decimalPlaces:""}),this.AB=e}static get key(){return"pivot"}ui(){const e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&this.onChange()}}},{id:e.height,view:"counter",name:"height",label:i("Height:"),labelWidth:a.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.removeMissed,view:"checkbox",name:"removeMissed",labelRight:i("Remove empty data."),labelWidth:a.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.totalColumn,view:"checkbox",name:"totalColumn",labelRight:i("Show a total column."),labelWidth:a.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.separateLabel,view:"checkbox",name:"separateLabel",labelRight:i("Separate header label."),labelWidth:a.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.min,view:"checkbox",name:"min",labelRight:i("Highlighting of a cell(s) with the least value in a row."),labelWidth:a.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.max,view:"checkbox",name:"max",labelRight:i("Highlighting of a cell(s) with the biggest value in a row."),labelWidth:a.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.decimalPlaces,name:"decimalPlaces",view:"counter",min:1,label:i("Decimal Places"),labelWidth:a.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=e.settings.dataviewID?e.settings.dataviewID:null;var n=$$(t.datacollection),a=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));n.define("options",a),n.define("value",i),n.refresh(),$$(t.removeMissed).setValue(e.settings.removeMissed),$$(t.totalColumn).setValue(e.settings.totalColumn),$$(t.separateLabel).setValue(e.settings.separateLabel),$$(t.min).setValue(e.settings.min),$$(t.max).setValue(e.settings.max),$$(t.height).setValue(e.settings.height),$$(t.decimalPlaces).setValue(null==e.settings.decimalPlaces?2:e.settings.decimalPlaces)}values(){const e=$$(this.ids.component),t=super.values();return t.settings=e.getValues(),t}ViewClass(){return super._ViewClass("pivot")}}}},7375:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_pivot",{dataviewID:"",dataviewFieldsLabel:"",dataviewFields:"",fieldName:"",fieldText:"",fieldQueries:"",datacollectionIDs:"",editMode:"",hideCommonTab:"",hideDataTab:"",hideViewTab:""})}static get key(){return"reportsManager"}ui(){const t=this.ids,n=e.UISettings.config();return super.ui([{id:t.dataviewID,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:n.labelWidthLarge,on:{onChange:(e,t)=>{e!==t&&(this.getDataviewFieldOptions(e),this.onChange())}}},{id:t.dataviewFieldsLabel,view:"label",label:i("Dataview Fields"),hidden:!0},{id:t.dataviewFields,view:"form",hidden:!0,elements:[{id:t.fieldName,view:"richselect",name:"name",label:i("Name"),placeholder:i("Single line text"),labelWidth:n.labelWidthLarge},{id:t.fieldText,view:"richselect",name:"text",label:i("Text"),placeholder:i("JSON"),labelWidth:n.labelWidthLarge},{id:t.fieldQueries,view:"richselect",name:"queries",label:i("Queries"),placeholder:i("JSON"),labelWidth:n.labelWidthLarge}],on:{onChange:(e,t)=>{e!==t&&this.onChange()}}},{view:"label",label:i("Include Datacollections")},{id:t.datacollectionIDs,view:"multicombo",value:[],options:[],placeholder:i("Click to add Datacollections (Include all if nothing selected)"),labelAlign:"left",stringResult:!1,on:{onChange:()=>{this.onChange()}}},{id:t.editMode,name:"editMode",view:"checkbox",label:i("Edit mode"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.hideCommonTab,name:"hideCommonTab",view:"checkbox",label:i("Hide Common tab"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.hideDataTab,name:"hideDataTab",view:"checkbox",label:i("Hide Data tab"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.hideViewTab,name:"hideViewTab",view:"checkbox",label:i("Hide View tab"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e);const t=this.ids,i=this.CurrentApplication.datacollectionsIncluded(),n=$$(t.dataviewID);n.define("options",i.map((e=>({id:e.id,value:e.label})))),n.refresh();const a=$$(t.datacollectionIDs);a.define("options",i.map((e=>({id:e.id,value:e.label})))),a.refresh()}getDataviewFieldOptions(e){const t=this.ids,i=$$(t.dataviewFieldsLabel),n=$$(t.dataviewFields),a=$$(t.fieldName),o=$$(t.fieldText),s=$$(t.fieldQueries),r=this.defaultValues();if(!e)return a.define("options",[]),a.refresh(),i.hide(),n.hide(),void n.setValues(r.dataviewFields);i.show(),n.show();const l=this.AB.datacollectionByID(e).datasource;a.define("options",l.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),a.refresh(),o.define("options",l.fields((e=>"json"===e.key)).map((e=>({id:e.id,value:e.label})))),o.refresh(),s.define("options",l.fields((e=>"json"===e.key)).map((e=>({id:e.id,value:e.label})))),s.refresh()}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();Object.keys(e.settings).forEach((n=>{const a=$$(t[n]);if("dataviewFields"===n){const o=$$(t.dataviewFieldsLabel);if(!e.settings.dataviewID)return a.setValues(i[n]),o.hide(),void a.hide();a.setValues(e.settings[n]),o.show(),a.show()}else a.setValue(e.settings[n])}))}defaultValues(){return this.ViewClass()?.defaultValues()||{}}values(){const e=super.values(),t=this.defaultValues(),i=this.ids;return e.settings=Object.assign({},t,$$(i.component).getValues()),e.settings.dataviewFields=e.settings.dataviewID?Object.assign({},t.$dataviewFields,$$(i.dataviewFields).getValues()):t.dataviewFields,e.settings.datacollectionIDs=$$(i.datacollectionIDs).getValue(),e}ViewClass(){return super._ViewClass("reportsManager")}}}},4333:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=t.L(),a=e.UISettings.config();return class extends t{constructor(){super("properties_abview_scheduler",{dataviewID:"",dataviewFieldsLabel:"",dataviewFields:"",fieldName:"",fieldStart:"",fieldEnd:"",fieldAllDay:"",fieldRepeat:"",fieldCalendar:"",fieldEventColor:"",fieldSectionID:"",fieldUnitID:"",fieldNotes:"",fieldOriginID:"",calendarDataviewID:"",calendarDataviewFieldsLabel:"",calendarDataviewFields:"",fieldTitle:"",fieldCalendarColor:"",fieldActive:"",timeline:"",export:"",sectionAdd:"",timelineSectionList:"",unitAdd:"",unitList:"",readonly:""})}static get key(){return"scheduler"}ui(){const e=this.ids;return super.ui([{id:e.dataviewID,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!==t&&(this.getDataviewFieldOptions(e),this.onChange())}}},{id:e.dataviewFieldsLabel,view:"label",label:i("Dataview Fields"),hidden:!0},{id:e.dataviewFields,view:"form",hidden:!0,elements:[{id:e.fieldName,view:"richselect",name:"name",label:i("Event"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldStart,view:"richselect",name:"start",label:i("Start"),placeholder:i("Date & Time"),labelWidth:a.labelWidthLarge},{id:e.fieldEnd,view:"richselect",name:"end",label:i("End"),placeholder:i("Date & Time"),labelWidth:a.labelWidthLarge},{id:e.fieldAllDay,view:"richselect",name:"allDay",label:i("All day"),placeholder:i("Checkbox"),labelWidth:a.labelWidthLarge},{id:e.fieldRepeat,view:"richselect",name:"repeat",label:i("Repeat"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldCalendar,view:"richselect",name:"calendar",label:i("Calendar"),placeholder:i("Connect to another record (One to Many)"),labelWidth:a.labelWidthLarge},{id:e.fieldEventColor,view:"richselect",name:"color",label:i("Color"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldSectionID,view:"richselect",name:"sectionID",label:i("Section ID"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldUnitID,view:"richselect",name:"unitID",label:i("Unit ID"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldNotes,view:"richselect",name:"notes",label:i("Notes"),placeholder:i("Long text"),labelWidth:a.labelWidthLarge},{id:e.fieldOriginID,view:"richselect",name:"originID",label:i("Origin ID"),placeholder:i("Number"),labelWidth:a.labelWidthLarge}],on:{onChange:(e,t)=>{e!==t&&this.onChange()}}},{id:e.calendarDataviewID,view:"richselect",name:"calendarDataviewID",label:i("Calendar Data Source"),labelWidth:a.labelWidthLarge,hidden:!0,on:{onChange:(e,t)=>{e!==t&&(this.getCalendarDataviewFieldOptions(e),this.onChange())}}},{id:e.calendarDataviewFieldsLabel,view:"label",label:i("Calendar Dataview Fields"),hidden:!0},{id:e.calendarDataviewFields,view:"form",hidden:!0,elements:[{id:e.fieldTitle,view:"richselect",name:"title",label:i("Title"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldCalendarColor,view:"richselect",name:"color",label:i("Color"),placeholder:i("Single line text"),labelWidth:a.labelWidthLarge},{id:e.fieldActive,view:"richselect",name:"active",label:i("Active"),placeholder:i("Checkbox"),labelWidth:a.labelWidthLarge}],on:{onChange:(e,t)=>{e!==t&&this.onChange()}}},{view:"label",label:i("Timeline")},{id:e.timeline,view:"form",elements:[{name:"day",view:"checkbox",label:i("Day"),labelWidth:a.labelWidthLarge},{name:"week",view:"checkbox",label:i("Week"),labelWidth:a.labelWidthLarge},{name:"month",view:"checkbox",label:i("Month"),labelWidth:a.labelWidthLarge},{name:"year",view:"checkbox",label:i("Year"),labelWidth:a.labelWidthLarge},{name:"agenda",view:"checkbox",label:i("Agenda"),labelWidth:a.labelWidthLarge},{name:"timeline",view:"checkbox",label:i("Timeline"),labelWidth:a.labelWidthLarge},{name:"units",view:"checkbox",label:i("Units"),labelWidth:a.labelWidthLarge}],on:{onChange:()=>{this.onChange()}}},{view:"label",label:i("Timeline Section List")},{cols:[{id:e.sectionAdd,view:"text",placeholder:i('Name of Section (not include ",")')},{view:"button",label:i("Add"),maxWidth:100,click:()=>{const t=$$(e.sectionAdd).getValue();if(""===t||t.includes(","))return;const i=$$(e.timelineSectionList);i.data.find((e=>e.value===t)).length>0||(i.data.add({value:t}),this.onChange())}}]},{id:e.timelineSectionList,view:"list",height:200,select:"multiselect",template:"#value#",data:[]},{cols:[{view:"button",label:i("Delete"),click:()=>{const t=$$(e.timelineSectionList);t.remove(t.getSelectedId()),this.onChange()}},{view:"button",label:i("Delete All"),click:()=>{$$(e.timelineSectionList).clearAll(),this.onChange()}}]},{view:"label",label:i("Unit List")},{cols:[{id:e.unitAdd,view:"text",placeholder:i('Name of Unit (not include ",")')},{view:"button",label:i("Add"),maxWidth:100,click:()=>{const t=$$(e.unitAdd).getValue();if(""===t||t.includes(","))return;const i=$$(e.unitList);i.data.find((e=>e.value===t)).length>0||(i.data.add({value:t}),this.onChange())}}]},{id:e.unitList,view:"list",height:200,select:"multiselect",template:"#value#",data:[]},{cols:[{view:"button",label:i("Delete"),click:()=>{const t=$$(e.unitList);t.remove(t.getSelectedId()),this.onChange()}},{view:"button",label:i("Delete All"),click:()=>{$$(e.unitList).clearAll(),this.onChange()}}]},{view:"label",label:i("Export")},{id:e.export,view:"form",elements:[{name:"excel",view:"checkbox",label:i("Excel"),labelWidth:a.labelWidthLarge},{name:"csv",view:"checkbox",label:i("CSV"),labelWidth:a.labelWidthLarge},{name:"pdf",view:"checkbox",label:i("PDF"),labelWidth:a.labelWidthLarge}],on:{onChange:()=>{this.onChange()}}},{id:e.readonly,name:"readonly",view:"checkbox",label:i("Read only"),labelWidth:a.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e);const t=this.ids,i=$$(t.dataviewID);i.define("options",this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label})))),i.refresh()}getDataviewFieldOptions(e){const t=this.ids,i=$$(t.fieldName),n=$$(t.fieldStart),a=$$(t.fieldEnd),o=$$(t.fieldAllDay),s=$$(t.fieldRepeat),r=$$(t.fieldCalendar),l=$$(t.fieldEventColor),c=$$(t.fieldSectionID),d=$$(t.fieldUnitID),u=$$(t.fieldNotes),h=$$(t.fieldOriginID),p=$$(t.dataviewFieldsLabel),m=$$(t.dataviewFields),f=$$(t.calendarDataviewID),g=this.defaultValues();if(f.setValue(g.calendarDataviewID),this.getCalendarDataviewFieldOptions(""),!e)return f.define("options",[]),f.refresh(),i.define("options",[]),i.refresh(),n.define("options",[]),n.refresh(),a.define("options",[]),a.refresh(),o.define("options",[]),o.refresh(),s.define("options",[]),s.refresh(),r.define("options",[]),r.refresh(),l.define("options",[]),l.refresh(),c.define("options",[]),c.refresh(),d.define("options",[]),d.refresh(),u.define("options",[]),u.refresh(),h.define("options",[]),h.refresh(),p.hide(),m.hide(),m.setValues(g.dataviewFields),void f.hide();p.show(),m.show(),f.show();const v=this.AB.datacollectionByID(e).datasource,b=v.fields((e=>"connectObject"===e.key&&"one"===e.settings.linkType&&"many"===e.settings.linkViaType));r.define("options",b.map((e=>({id:e.id,value:e.label})))),r.refresh();const y=b.map((e=>e.settings.linkObject)),w=[];y.forEach((e=>{w.push(...this.CurrentApplication.datacollectionsIncluded().filter((t=>t.settings.datasourceID===e)))})),f.define("options",w.map((e=>({id:e.id,value:e.label})))),f.refresh(),i.define("options",v.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),i.refresh(),n.define("options",v.fields((e=>"datetime"===e.key)).map((e=>({id:e.id,value:e.label})))),n.refresh(),a.define("options",v.fields((e=>"datetime"===e.key)).map((e=>({id:e.id,value:e.label})))),a.refresh(),o.define("options",v.fields((e=>"boolean"===e.key)).map((e=>({id:e.id,value:e.label})))),o.refresh(),s.define("options",v.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),s.refresh(),l.define("options",v.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),l.refresh(),c.define("options",v.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),c.refresh(),d.define("options",v.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),d.refresh(),u.define("options",v.fields((e=>"LongText"===e.key)).map((e=>({id:e.id,value:e.label})))),u.refresh(),h.define("options",v.fields((e=>"number"===e.key)).map((e=>({id:e.id,value:e.label})))),h.refresh()}getCalendarDataviewFieldOptions(e){const t=this.ids,i=$$(t.fieldTitle),n=$$(t.fieldCalendarColor),a=$$(t.fieldActive),o=$$(t.calendarDataviewFieldsLabel),s=$$(t.calendarDataviewFields);if(!e)return i.define("options",[]),i.refresh(),n.define("options",[]),n.refresh(),a.define("options",[]),a.refresh(),o.hide(),s.setValues(this.defaultValues().calendarDataviewFields),void s.hide();o.show(),s.show();const r=this.AB.datacollectionByID(e).datasource;i.define("options",r.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),i.refresh(),n.define("options",r.fields((e=>"string"===e.key&&1===e.settings.required)).map((e=>({id:e.id,value:e.label})))),n.refresh(),a.define("options",r.fields((e=>"boolean"===e.key)).map((e=>({id:e.id,value:e.label})))),a.refresh()}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();Object.keys(e.settings).forEach((n=>{const a=$$(t[n]);if("object"==typeof e.settings[n]){switch(n){case"dataviewFields":{const a=$$(t.dataviewFieldsLabel),o=$$(t[n]),s=$$(t.calendarDataviewID);if(!e.settings.dataviewID)return o.setValues(i[n]),s.setValue(i.calendarDataviewID),a.hide(),o.hide(),void s.hide();a.show(),o.show(),s.show()}break;case"calendarDataviewFields":{const a=$$(t.calendarDataviewFieldsLabel),o=$$(t.calendarDataviewFields);if(!e.settings.dataviewID||!e.settings.calendarDataviewID)return o.setValues(i[n]),a.hide(),void o.hide();a.show(),o.show()}}a.setValues(e.settings[n])}else switch(n){case"timelineSectionList":case"unitList":if(""===e.settings[n])break;e.settings[n].split(", ").forEach((e=>{$$(t[n]).data.add({value:e})}));break;default:a.setValue(e.settings[n])}}))}defaultValues(){return this.ViewClass()?.defaultValues()||{}}values(){const e=super.values(),t=this.defaultValues();e.settings=Object.assign({},t,$$(this.ids.component).getValues());const i=this.ids;return e.settings.dataviewFields=e.settings.dataviewID?$$(i.dataviewFields).getValues():t.dataviewFields,e.settings.calendarDataviewFields=e.settings.calendarDataviewID?$$(i.calendarDataviewFields).getValues():t.calendarDataviewFields,e.settings.timeline=$$(i.timeline).getValues(),e.settings.timelineSectionList=$$(i.timelineSectionList).data.find((()=>!0)).map((e=>e.value)).join(", "),e.settings.unitList=$$(i.unitList).data.find((()=>!0)).map((e=>e.value)).join(", "),e.settings.export=$$(i.export).getValues(),e}ViewClass(){return super._ViewClass("scheduler")}}}},6234:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(2418),a=i(5888);function o(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),o=t.L(),s=(0,a.Z)(e);return class extends t{constructor(){super("properties_abview_tab",{sidebarWidth:"",sidebarPos:"",iconOnTop:"",height:"",minWidth:"",stackTabs:"",darkTheme:""})}static get key(){return"tab"}ui(){const e=this.ids;return super.ui([{id:e.height,name:"height",view:"counter",label:o("Height"),on:{onChange:()=>{this.onChange()}}},{id:e.minWidth,view:"counter",name:"minWidth",label:o("Minimum width"),on:{onChange:()=>{this.onChange()}}},{id:e.stackTabs,view:"checkbox",name:"stackTabs",labelRight:o("Stack Tabs Vertically"),labelWidth:i.labelWidthCheckbox,on:{onChange:t=>{1==t?($$(e.sidebarWidth).show(),$$(e.sidebarPos).show(),$$(e.iconOnTop).hide()):($$(e.sidebarWidth).hide(),$$(e.sidebarPos).hide(),$$(e.iconOnTop).show()),this.onChange()}}},{id:e.iconOnTop,view:"checkbox",name:"iconOnTop",labelRight:o("Position icon above text"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.darkTheme,view:"checkbox",name:"darkTheme",labelRight:o("Use Dark Theme"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.sidebarWidth,view:"counter",name:"sidebarWidth",label:o("Width of Sidebar"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:e.sidebarPos,view:"richselect",name:"sidebarPos",label:o("Position of Sidebar"),labelWidth:i.labelWidthXLarge,options:[{id:"left",value:o("Left")},{id:"right",value:o("Right")}],on:{onChange:()=>{this.onChange()}}},{view:"button",css:"webix_primary",value:o("Add Tab"),click:()=>{this.CurrentView.tabPopup.show()}}])}async init(e){await super.init(e);const t=this.CurrentView;t.tabPopup||(t.tabPopup=new s(t),await t.tabPopup.init(e)),this.__tabPopupSave||(this.__tabPopupSave=t.tabPopup.on("saved",(()=>{this.onChange()})))}populate(e){super.populate(e);const t=this.ids;$$(t.height).setValue(e.settings.height),$$(t.minWidth).setValue(e.settings.minWidth),$$(t.stackTabs).setValue(e.settings.stackTabs),$$(t.darkTheme).setValue(e.settings.darkTheme),$$(t.sidebarWidth).setValue(e.settings.sidebarWidth),$$(t.sidebarPos).setValue(e.settings.sidebarPos),$$(t.iconOnTop).setValue(e.settings.iconOnTop),e.settings.stackTabs?($$(t.sidebarWidth).show(),$$(t.sidebarPos).show(),$$(t.iconOnTop).hide()):($$(t.sidebarWidth).hide(),$$(t.sidebarPos).hide(),$$(t.iconOnTop).show())}values(){const e=super.values(),t=this.ids,i=$$(t.component);return e.settings=i.getValues(),e}ViewClass(){return super._ViewClass("tab")}}}},7669:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(){super("properties_abview_text",{height:"",dataviewID:"",field:""}),this.AB=e}static get key(){return"text"}ui(){const e=this.ids,t=this;return super.ui([{id:e.height,view:"counter",name:"height",label:a("Height:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.dataviewID,name:"dataviewID",view:"richselect",label:a("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:e=>{t.selectSource(e),this.onChange()}}},{id:e.field,name:"field",view:"list",maxHeight:322,template:"#label#",on:{onItemClick:function(e){const i=this.getItem(e);t.selectField(i)}}}])}async init(e){this.AB=e,await super.init(e)}selectSource(e){const t=this.CurrentView;this.updateFieldOptions(t,e)}selectField(e){const t=`{${e.label}}`;tinymce.activeEditor.execCommand("mceInsertContent",!1,t)}updateFieldOptions(e,t){const i=this.ids,n=e.AB.datacollectionByID(t)??e.AB.datacollectionByID(e.parent.settings.dataviewID)??null;"dataview"===e.parent.key&&(t=e.parent.settings.dataviewID);const a=$$(i.dataviewID),o=$$(i.field);if(a.setValue(t),!n)return void o.clearAll();const s=n?.datasource??null;o.clearAll(),s&&o.parse(s.fields()),o.refresh()}populate(e){super.populate(e);const t=this.ids,i=e.settings.dataviewID??"none",n=$$(t.dataviewID),o=this.AB.Account.isSystemDesigner()?()=>!0:e=>!e.isSystemObject,s=this.CurrentApplication.datacollectionsIncluded(o),r=[{id:"none",value:a("None")},...s.map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})))];n.define("options",r),n.define("value",i),n.refresh(),this.updateFieldOptions(e,i),$$(t.height).setValue(e.settings.height)}values(){const e=super.values(),t=this.ids,i=$$(t.component);return e.settings=i.getValues(),"none"==e.settings.dataviewID&&(e.settings.dataviewID=null),e}ViewClass(){return super._ViewClass("text")}}}},4245:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),a=null;function o(e,t){if(!a){const o=`${t}_viewpropertyfilterdata`,s=(0,n.Z)(e),r=e.Config.uiSettings();var i=s.L();class l extends e.Class.ABMLClass{constructor(){super(["label"],e)}fromSettings(e){super.fromValues(e),this.filters=e.filters}toSettings(){let e=super.toObj();return e.filters=this.filters,e}}class c extends s{constructor(e){let t=`${o}_filterrule_${e}`;super(t,{label:"",filter:"",btnDelete:""}),this.indx=e,this.base=t,this.rowFilter=null}ui(){return{id:this.ids.component,cols:[{id:this.ids.label,view:"text",value:""},{id:this.ids.filter,view:"button",css:"webix_primary",value:i("Add Filter"),click:()=>{this.rowFilter.popUp($$(this.ids.filter).getNode())}},{id:this.ids.btnDelete,view:"button",css:"webix_primary",width:28,type:"icon",icon:"fa fa-times",click:()=>{webix.confirm({title:i("Remove Filter?"),message:i("Are you sure you want to remove this filter?"),callback:async e=>{if(e){let e=$$(this.ids.component);e.getParentView().removeView(e),this.emit("deleted")}}})}}]}}init(e){this.AB=e,this.rowFilter=this.AB.filterComplexNew(`${this.ids.filter}_fc`)}fromSettings(e){this.settings=new l,this.settings.fromSettings(e),$$(this.ids.label).setValue(this.settings.label),this.rowFilter?.setValue(this.settings.filters)}toSettings(){return this.settings.label=$$(this.ids.label).getValue(),this.settings.filters=this.rowFilter?.getValue(),this.settings.toSettings()}objectLoad(e){this.object=e,this.rowFilter&&this.rowFilter.fieldsLoad(this.object.fields(),this.object)}}a=class t extends s{static get default(){return{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1}}constructor(t){super(o,{filterRules:"",filterRulesScrollview:"",filterOptionRadio:"",filterUserLayout:"",filterUser:"",filterGlobal:"",filterMenuLayout:"",needLoadAllLabel:"",globalToolbar:""}),this.AB=e,this.queryRules=[],this.isGrid=!1,t?.isGrid&&(this.isGrid=!0)}ui(){const e=this.ids;return{type:"form",rows:[{view:"radio",id:e.filterOptionRadio,value:0,options:[{id:0,value:i("Do not Allow User filters")},{id:1,value:i("Enable User filters")},{id:2,value:i("Use a filter menu")},{id:3,value:i("Use a global filter input")}],vertical:!0,label:"Filter Option",labelWidth:r.labelWidthLarge,on:{onChange:e=>{this.setFilterOption(e)}}},{view:"radio",id:e.filterGlobal,hidden:!0,vertical:!0,label:"Show",labelWidth:r.labelWidthLarge,options:[{id:"default",value:i("All matching records")},{id:"single",value:i("Single records only")}]},{view:"layout",id:e.filterUserLayout,hidden:!0,cols:[{view:"radio",vertical:!0,id:e.filterUser,value:"toolbar",label:"Display",labelWidth:r.labelWidthLarge,width:200,options:[{id:"toolbar",value:i("Toolbar")},{id:"form",value:i("Form")}],on:{onChange:e=>{this.setFilterUser(e)}}},{view:"checkbox",id:e.globalToolbar,width:350,labelRight:i("Include a global filter input")},{}]},{view:"layout",id:e.filterMenuLayout,hidden:!0,rows:[{css:{"padding-bottom":10},cols:[{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:i("Add new filter"),width:150,click:()=>{this.addFilterRule({})}},{id:e.needLoadAllLabel,view:"label",label:i('need "LoadAll" from datasource'),css:{color:"red"},hidden:!0},{fillspace:!0}]},{id:e.filterRulesScrollview,view:"scrollview",scroll:"xy",body:{id:e.filterRules,view:"layout",margin:20,padding:10,rows:[]}}]},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:i("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}},{fillspace:!0}]}]}}init(e){this.AB=e}buttonCancel(){this.emit("cancel")}buttonSave(){this.emit("save")}objectLoad(e,t=!1){this.object=e,this.isLoadAll=t,this.queryRules&&this.queryRules.length&&this.queryRules.forEach((t=>{t.objectLoad(e)}))}setSettings(e={}){const i=this.ids;e||(e={}),(e.queryRules||[]).forEach((e=>{e?.queryRules?.[0]?.rules&&e.queryRules[0].rules.forEach((e=>{/^[+-]?\d+(\.\d+)?$/.exec(e.value)&&(e.value=JSON.parse(e.value))}))}));let n=e.filterOption;(null==n||Number.isNaN(n))&&(n=t.default.filterOption),$$(i.filterOptionRadio).setValue(n),$$(i.filterUser).setValue(e.userFilterPosition||t.default.userFilterPosition),$$(i.globalToolbar).setValue(void 0!==e.isGlobalToolbar?e.isGlobalToolbar:t.default.isGlobalToolbar),$$(i.filterGlobal).setValue(e.globalFilterPosition||t.default.globalFilterPosition),(this.queryRules??[]).forEach((e=>{$$(i.filterRules)&&$$(i.filterRules).removeView(e.ids.component)})),this.queryRules=[],(e.queryRules||[]).forEach((e=>{this.addFilterRule(e)}))}getSettings(){const e=this.ids;var t={};switch(t.filterOption=parseInt($$(e.filterOptionRadio).getValue()),t.queryRules=[],t.filterOption){case 0:t.isGlobalToolbar=0;break;case 1:this.isGrid?(t.userFilterPosition=$$(e.filterUser).getValue(),t.isGlobalToolbar=$$(e.globalToolbar).getValue()):(t.userFilterPosition="form",t.isGlobalToolbar=0);break;case 2:this.queryRules.forEach((e=>{t.queryRules.push(e.toSettings())}));break;case 3:t.globalFilterPosition=$$(e.filterGlobal).getValue()}return t}addFilterRule(e){if(null==this.object)return;e=e??{};let t=0;this.queryRules.forEach((e=>{e.indx>t&&(t=e.indx)})),t++;let i=new c(t);var n=$$(this.ids.filterRules);n&&(n.addView(i.ui()),i.init(this.AB),i.objectLoad(this.object),i.fromSettings(e),i.on("deleted",(()=>{this.queryRules=this.queryRules.filter((e=>e.indx!=i.indx))}))),this.queryRules.push(i)}onShow(){this.isLoadAll?$$(this.ids.needLoadAllLabel).hide():$$(this.ids.needLoadAllLabel).show()}setFilterOption(e){const t=this.ids;switch(JSON.parse(e||0)){case 1:$$(t.filterMenuLayout).hide(),$$(t.filterGlobal).hide(),this.isGrid&&$$(t.filterUserLayout).show();break;case 2:$$(t.filterUserLayout).hide(),$$(t.filterGlobal).hide(),$$(t.filterMenuLayout).show();break;case 3:$$(t.filterUserLayout).hide(),$$(t.filterMenuLayout).hide(),$$(t.filterGlobal).show();break;default:$$(t.filterUserLayout).hide(),$$(t.filterMenuLayout).hide(),$$(t.filterGlobal).hide()}}setFilterUser(e){switch(e){case"toolbar":$$(this.ids.globalToolbar).show();break;case"form":$$(this.ids.globalToolbar).hide()}}}}return a}},8782:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),a=null;function o(e,t){if(!a){const o=`${t}_viewpropertylinkpage`,s=(0,n.Z)(e),r=e.Config.uiSettings();var i=s.L();a=class extends s{constructor(){super(o,{detailsPage:"",editPage:""}),this.AB=e}static get default(){return{detailsPage:null,detailsTab:null,editPage:null,editTab:null}}ui(){return{view:"fieldset",label:i("Linked Pages:"),labelWidth:r.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.detailsPage,view:"combo",clear:!0,placeholder:i("No linked view"),name:"detailsPage",label:i("Details Page:"),labelWidth:r.labelWidthLarge,options:[],on:{onChange:()=>this.emit("change")}},{id:this.ids.editPage,view:"combo",clear:!0,placeholder:i("No linked form"),name:"editPage",label:i("Edit Form:"),labelWidth:r.labelWidthLarge,options:[],on:{onChange:()=>this.emit("change")}}]}}}init(e){return this.AB=e,Promise.resolve()}clear(){$$(this.ids.detailsPage).setValue(""),$$(this.ids.editPage).setValue("")}viewLoad(e){this.view=e;const t=this.ids;let i=(t,i)=>t.key==i&&(t.settings.dataviewID==e.settings.dataviewID||(this.AB??e.AB)?.datacollectionByID(t.settings.dataviewID)?.datacollectionFollow?.id==e.settings.dataviewID),n=[];n=n.concat(e.pageRoot().views((e=>i(e,"detail")),!0).map((e=>({id:e.id,value:e.label})))),n=n.concat(e.pageRoot().pages((e=>e.views((e=>i(e,"detail")),!0).length),!0).map((e=>({id:e.id,value:e.label})))),$$(t.detailsPage).define("options",n),$$(t.detailsPage).refresh();let a=[];a=a.concat(e.pageRoot().views((e=>i(e,"form")),!0).map((e=>({id:e.id,value:e.label})))),a=a.concat(e.pageRoot().pages((e=>e.views((e=>i(e,"form")),!0).length),!0).map((e=>({id:e.id,value:e.label})))),$$(t.editPage).define("options",a),$$(t.editPage).refresh()}setSettings(e){if(e.detailsPage){let t=e.detailsPage;""!=e.detailsTab&&(t+=":"+e.detailsTab),$$(this.ids.detailsPage).setValue(t)}else $$(this.ids.detailsPage).setValue(null);if(e.editPage){var t=e.editPage;""!=e.editTab&&(t+=":"+e.editTab),$$(this.ids.editPage).setValue(t)}else $$(this.ids.editPage).setValue(null)}getSettings(){let e={};var t=$$(this.ids.detailsPage).getValue(),i="";if(t.split(":").length>1){var n=t.split(":");t=n[0],i=n[1]}e.detailsPage=t,e.detailsTab=i;var a=$$(this.ids.editPage).getValue(),o="";if(a.split(":").length>1){var s=a.split(":");a=s[0],o=s[1]}return e.editPage=a,e.editTab=o,e}}}return a}},4550:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285);const a={name:"Default Gantt",filterConditions:[],sortFields:[],settings:{dataviewID:"",titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""}};function o(e,t){const i=(0,n.Z)(e),o=i.L(),s=e.Class.ABFieldManager.fieldByKey("date"),r=e.Class.ABFieldManager.fieldByKey("number"),l=e.Class.ABFieldManager.fieldByKey("string"),c=e.Class.ABFieldManager.fieldByKey("LongText");return new class extends i{constructor(e){super(e,{titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""}),this.on("field.added",(e=>{this.refreshOptions(this.CurrentObject,this._view),this._autoSelectInput&&$$(this._autoSelectInput)?.setValue(e.id)})),this._autoSelectInput=null,this._dateFields=[]}type(){return"gantt"}icon(){return"fa fa-tasks"}refreshOptions(e,t){const i=this.ids,n=e.fields((e=>e instanceof s)).map((({id:e,label:t})=>({id:e,value:t})));n.sort(((e,t)=>e.value>t.value?1:-1)),n.unshift({id:null,value:o("Select a date field")}),this._dateFields=n,$$(i.startDateFieldID).define("options",n),$$(i.endDateFieldID).define("options",n);const d=e.fields((e=>e instanceof r)).map((({id:e,label:t})=>({id:e,value:t})));d.sort(((e,t)=>e.value>t.value?1:-1)),d.unshift({id:null,value:o("Select a number field")}),this._numberFields=d,$$(i.durationFieldID).define("options",d),$$(i.progressFieldID).define("options",d);const u=e.fields((e=>e instanceof l||e instanceof c)).map((({id:e,label:t})=>({id:e,value:t})));u.sort(((e,t)=>e.value>t.value?1:-1)),u.unshift({id:null,value:o("Select a string field")}),this._stringFields=u,$$(i.titleFieldID).define("options",u),$$(i.notesFieldID).define("options",u),t&&(t.titleFieldID&&($$(i.titleFieldID).define("value",t.titleFieldID),$$(i.titleFieldID).refresh(),this.syncCommonLists([i.titleFieldID,i.notesFieldID],this._stringFields)),t.startDateFieldID&&($$(i.startDateFieldID).define("value",t.startDateFieldID),$$(i.startDateFieldID).refresh(),this.syncCommonLists([i.startDateFieldID,i.endDateFieldID],this._dateFields)),t.endDateFieldID&&($$(i.endDateFieldID).define("value",t.endDateFieldID||a.settings.endDateFieldIDFieldID),$$(i.endDateFieldID).refresh(),this.syncCommonLists([i.startDateFieldID,i.endDateFieldID],this._dateFields)),t.durationFieldID&&($$(i.durationFieldID).define("value",t.durationFieldID||a.settings.durationFieldID),$$(i.durationFieldID).refresh(),this.syncCommonLists([i.durationFieldID,i.progressFieldID],this._numberFields)),t.progressFieldID&&($$(i.progressFieldID).define("value",t.progressFieldID),$$(i.progressFieldID).refresh(),this.syncCommonLists([i.durationFieldID,i.progressFieldID],this._numberFields)),t.notesFieldID&&($$(i.notesFieldID).define("value",t.notesFieldID),$$(i.notesFieldID).refresh(),this.syncCommonLists([i.titleFieldID,i.notesFieldID],this._stringFields)))}syncCommonLists(e,t){e.forEach((i=>{const n=[];e.filter((e=>e!=i)).forEach((e=>{n.push($$(e).getValue())}));const a=$$(i),o=t.filter((e=>-1==n.indexOf(e.id)));a.define("options",o),a.refresh()}))}ui(){const e=this.ids;return{batch:"gantt",rows:[{cols:[{id:e.titleFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-calendar'></span> ${o("Title")}`,placeholder:o("Select a string field"),labelWidth:130,name:"titleFieldID",options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.titleFieldID,e.notesFieldID],this._stringFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.titleFieldID,this.emit("new.field",l.defaults().key)}}]},{cols:[{id:e.startDateFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-calendar'></span> ${o("Start Date")}`,placeholder:o("Select a date field"),labelWidth:130,name:"startDateFieldID",required:!0,options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.startDateFieldID,e.endDateFieldID],this._dateFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.startDateFieldID,this.emit("new.field",s.defaults().key)}}]},{cols:[{id:e.endDateFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-calendar'></span> ${o("End Date")}`,placeholder:o("Select a date field"),labelWidth:130,name:"endDateFieldID",options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.startDateFieldID,e.endDateFieldID],this._dateFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.endDateFieldID,this.emit("new.field",s.defaults().key)}}]},{cols:[{id:e.durationFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-hashtag'></span> ${o("Duration")}`,placeholder:o("Select a number field"),labelWidth:130,name:"durationFieldID",options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.durationFieldID,e.progressFieldID],this._numberFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.durationFieldID,this.emit("new.field",r.defaults().key)}}]},{cols:[{id:e.progressFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-hashtag'></span> ${o("Progress")}`,placeholder:o("Select a number field"),labelWidth:130,name:"progressFieldID",required:!1,options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.durationFieldID,e.progressFieldID],this._numberFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.progressFieldID,this.emit("new.field",r.defaults().key)}}]},{cols:[{id:e.notesFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-align-right'></span> ${o("Notes")}`,placeholder:o("Select a string field"),labelWidth:130,name:"notesFieldID",required:!1,options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.titleFieldID,e.notesFieldID],this._stringFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.notesFieldID,this.emit("new.field",c.defaults().key)}}]}]}}init(e,t){this.objectLoad(e),this._view=t,this.refreshOptions(e,t?.settings)}validate(e){const t=this.ids,i=$$(t.endDateFieldID).getValue()||a.settings.endDateFieldID,n=$$(t.durationFieldID).getValue()||a.settings.durationFieldID;return!(!i&&!n&&(e.markInvalid("endDateFieldID","Required"),e.markInvalid("durationFieldID","Required"),1))}values(){const e=this.ids,t={};return t.titleFieldID=$$(e.titleFieldID).getValue()||a.settings.titleFieldID,t.startDateFieldID=$$(e.startDateFieldID).getValue()||a.settings.startDateFieldID,t.endDateFieldID=$$(e.endDateFieldID).getValue()||a.settings.endDateFieldID,t.durationFieldID=$$(e.durationFieldID).getValue()||a.settings.durationFieldID,t.progressFieldID=$$(e.progressFieldID).getValue()||a.settings.progressFieldID,t.notesFieldID=$$(e.notesFieldID).getValue()||a.settings.notesFieldID,t}fromSettings(e){for(const t in a)this[v]=e[t]||a[t];this.settings=Object.assign({},a.settings,e.settings??{}),this.type=this.type()}toSettings(){const e={};for(const t in a)e[t]=this[t]||a[t];return e.settings=Object.assign({},a.settings,e.settings??{}),e.key=this.type(),e.type=this.type(),e}}(t)}},5609:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);const a={name:"Default Kanban",settings:{verticalGroupingField:null,horizontalGroupingField:null,ownerField:null}};var o=null;function s(e,t){const i=(0,n.Z)(e);var s=i.L();const r=e.Class.ABFieldManager.fieldByKey("connectObject"),l=e.Class.ABFieldManager.fieldByKey("list"),c=e.Class.ABFieldManager.fieldByKey("user");return o||(o=class extends i{constructor(e){super(e,{vGroupInput:"",hGroupInput:"",ownerInput:""}),this.on("field.added",(e=>{this.refreshOptions(this.CurrentObject,this._view),this._autoSelectInput&&$$(this._autoSelectInput)?.setValue(e.id)})),this._autoSelectInput=null}type(){return"kanban"}icon(){return"fa fa-columns"}refreshOptions(e,t,i={}){let n=this.ids;const a=(i,n,a=(e=>e.key===l.defaults().key),o)=>{if(null!=i&&null!=e){var r=e.fields().filter(a).map((({id:e,label:t})=>({id:e,value:t})));!o&&r.length&&r.unshift({id:"none",value:s("None")}),i.define("options",r),t?t.settings[n]?i.define("value",t.settings[n]):!o&&r[0]&&i.define("value",r[0].id):1===r.filter((e=>e.id)).length&&i.define("value",r[0].id),i.refresh()}};a(i.vGroupInput||$$(n.vGroupInput),"verticalGroupingField",(e=>[l.defaults().key,c.defaults().key].includes(e.key)),!0),a(i.hGroupInput||$$(n.hGroupInput),"horizontalGroupingField",(e=>[r.defaults().key,l.defaults().key,c.defaults().key].includes(e.key)),!1),a(i.ownerInput||$$(n.ownerInput),"ownerField",(e=>e.key===c.defaults().key||e.key===r.defaults().key&&"one"==e.settings.linkType&&"many"==e.settings.linkViaType),!1)}ui(){let e=this.ids;return{batch:"kanban",rows:[{cols:[{id:e.vGroupInput,view:"richselect",label:`<span style="opacity: 0.6;" class='webix_icon fa fa-columns'></span> ${s("Vertical Grouping")}`,placeholder:s("Select a field"),labelWidth:180,name:"verticalGroupingField",required:!0,options:[],on:{onChange:()=>{$$(e.vGroupInput).validate(),$$(e.hGroupInput).validate(),this.emit("changed")}},invalidMessage:s("Required")},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.vGroupInput,this.emit("new.field",l.defaults().key)}}]},{cols:[{id:e.hGroupInput,view:"richselect",label:`<span style="opacity: 0.6;"class='webix_icon fa fa-list'></span> ${s("Horizontal Grouping")}`,placeholder:s("Select a field"),labelWidth:180,name:"horizontalGroupingField",required:!1,options:[],invalidMessage:s("Cannot be the same as vertical grouping field"),validate:t=>{var i=$$(e.vGroupInput).getValue();return!i||!t||i!==t},on:{onChange:()=>{$$(e.hGroupInput).validate(),this.emit("changed")}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.hGroupInput,this.emit("new.field",l.defaults().key)}}]},{cols:[{id:e.ownerInput,view:"richselect",label:`<span style="opacity: 0.6;" class='webix_icon fa fa-user-circle'></span> ${s("Card Owner")}`,placeholder:s("Select a user field"),labelWidth:180,name:"ownerField",options:[],on:{onChange:(e,t)=>{e!=t&&this.emit("changed")}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.ownerInput,this.emit("new.field",r.defaults().key)}}]}]}}init(e,t){this.objectLoad(e),this._view=t,this.refreshOptions(e,t)}clearValues(){const e=this.ids;[e.vGroupInput,e.hGroupInput,e.ownerInput].forEach((e=>{let t=$$(e);t.blockEvent(),t.define("value",null),t.unblockEvent(),t.refresh()}))}values(){let e=this.ids,t={};return t.verticalGroupingField=$$(e.vGroupInput).getValue()||null,t.horizontalGroupingField=$$(e.hGroupInput).getValue()||null,t.ownerField=$$(e.ownerInput).getValue()||null,t}fromSettings(e){for(var t in a)this[t]=e[t]||a[t];this.type=this.type(),this.key=this.type()}toSettings(){var e={};for(var t in a)e[t]=this[t]||a[t];return e.key=this.type(),e.type=this.type(),e}}),new o(t)}},3285:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=null;function a(e){return n||(n=class extends e.ClassUI{constructor(...t){super(...t),this.AB=e,this.CurrentApplicationID=null,this.CurrentDatacollectionID=null,this.CurrentObjectID=null,this.CurrentProcessID=null,this.CurrentQueryID=null,this.CurrentViewID=null}static L(){return function(...t){return e.Multilingual.labelPlugin("ABDesigner",...t)}}applicationLoad(e){this.CurrentApplicationID=e?.id}datacollectionLoad(e){this.CurrentDatacollectionID=e?.id}objectLoad(e){this.CurrentObjectID=e?.id}processLoad(e){this.CurrentProcessID=e?.id}queryLoad(e){this.CurrentQueryID=e?.id}versionLoad(e){this.CurrentVersionID=e?.id}viewLoad(e){this.CurrentViewID=e?.id,e?.application&&this.applicationLoad(e.application)}get CurrentApplication(){return this.AB.applicationByID(this.CurrentApplicationID)}get CurrentDatacollection(){return this.AB.datacollectionByID(this.CurrentDatacollectionID)}get CurrentObject(){let e=this.AB.objectByID(this.CurrentObjectID);return e||(e=this.AB.queryByID(this.CurrentObjectID)),e}get CurrentProcess(){return this.AB.processByID(this.CurrentProcessID)}get CurrentQuery(){return this.AB.queryByID(this.CurrentQueryID)}get CurrentView(){return this.CurrentApplication?.views((e=>e.id==this.CurrentViewID))[0]}uniqueIDs(){let e=webix.uid();Object.keys(this.ids).forEach((t=>{this.ids[t]=`${this.ids[t]}_${e}`}))}warningsRefresh(e){e?.warningsEval?.(),this.emit("warnings")}warningsPropogate(e=[]){e.forEach((e=>{e.on("warnings",(()=>{this.emit("warnings")}))}))}}),n}},8788:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e){const t=(0,n.Z)(e);var i=t.L();return class extends t{constructor(e,t){super(e,Object.assign({form:"",name:"",role:"",useRole:"",useAccount:"",account:""},t))}ui(n={}){var a=e.Account.rolesAll().map((e=>({id:e.id,value:e.name}))),o=e.Account.userList().map((e=>({id:e.uuid,value:e.username}))),s=this.ids;return{view:"form",id:this.ids.component,css:"no-margin",elements:[{cols:[{view:"checkbox",id:this.ids.useRole,width:34,labelWidth:0,value:"1"==n.useRole?1:0,click:function(e){$$(e).getValue()?$$(s.role).enable():$$(s.role).disable()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"label",label:i("by Role"),width:88},{view:"multicombo",id:this.ids.role,value:n.role?n.role:0,disabled:"1"!=n.useRole,suggest:{body:{yCount:4,data:a,on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${s.role}_${e.id}`)}))},onItemClick:function(e){var t=$$(s.role),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},placeholder:i("Click to add Role"),labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),s.role)},onChange:()=>{$$(this.ids.role).getList().callEvent("onAfterRender")}}}]},{},{cols:[{view:"checkbox",id:this.ids.useAccount,width:34,labelWidth:0,value:"1"==n.useAccount?1:0,click:function(e){$$(e).getValue()?$$(s.account).enable():$$(s.account).disable()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"label",label:i("by Account"),width:88},{view:"multicombo",id:this.ids.account,value:n.account?n.account:0,disabled:"1"!=n.useAccount,suggest:{body:{yCount:4,data:o,on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${s.account}_${e.id}`)}))},onItemClick:function(e){var t=$$(s.account),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},placeholder:i("Click to add User"),labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),s.account)},onChange:()=>{$$(this.ids.account).getList().callEvent("onAfterRender")}}}]}]}}async init(e){return this.AB=e,Promise.resolve()}values(){var e={},t=this.ids;return $$(t.useRole)&&(e.useRole=$$(t.useRole).getValue()),$$(t.role)&&e.useRole?(e.role=$$(t.role).getValue(),"--"===e.role&&(e.role=null)):e.role=null,$$(t.useAccount)&&(e.useAccount=$$(t.useAccount).getValue()),$$(t.account)&&e.useAccount?(e.account=$$(t.account).getValue(),"--"===e.account&&(e.account=null)):e.account=null,e}}}},5997:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e,t){t=t||"ui_work_object_workspace_popupFrozenColumns";const i=(0,n.Z)(e);var a=i.L();return new class extends i{constructor(e){super(e,{list:""}),this._setting=""}ui(){var e=this.ids;return{view:"popup",id:e.component,width:500,body:{rows:[{view:"list",id:e.list,width:250,maxHeight:350,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa fa-circle-o ab-frozen-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)}}},{view:"button",css:"webix_primary",value:a("Clear All"),type:"form",on:{onItemClick:()=>this.clickClearAll()}}]},on:{onShow:()=>{this.onShow(),this.iconsReset()}}}}async init(e){this.AB=e,webix.ui(this.ui())}changed(){this.emit("changed",this._setting)}clickClearAll(){this.setValue(""),this.iconsReset(),this.changed()}clickListItem(e){var t=$$(this.ids.list).getItem(e).columnName;-1==(this._hiddenFields||[]).indexOf(t)?(this.setValue(t),this.iconsReset(),this.changed()):webix.alert({text:a("Sorry, you cannot freeze a hidden column.")})}iconDefault(e){e&&(e.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle"),e.querySelector(".ab-frozen-field-icon").classList.add("fa-circle-o"))}iconFreeze(e){e&&(e.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle-o"),e.querySelector(".ab-frozen-field-icon").classList.add("fa-circle"))}iconsReset(){for(var e=$$(this.ids.list),t=!1,i=e.getFirstId();i;){var n=e.getItem(i).columnName,a=e.getItemNode(i);""==this._setting?this.iconDefault(a):0==t?this.iconFreeze(a):this.iconDefault(a),this._setting==n&&(t=!0),-1!=(this._hiddenFields||[]).indexOf(n)?(a.style.opacity=.4,a.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle"),a.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle-o"),a.querySelector(".ab-frozen-field-icon").classList.add("fa-eye-slash")):(a.style.opacity=1,a.querySelector(".ab-frozen-field-icon").classList.remove("fa-eye-slash")),i=e.getNextId(i)}}onShow(){var e=this.CurrentObject.fields(),t=[];e.forEach((e=>{t.push({id:e.id,label:e.label,columnName:e.columnName,$css:"hidden_fields_"+e.id})})),$$(this.ids.list).clearAll(),$$(this.ids.list).parse(t)}show(e,t){null!=t?$$(this.ids.component).show(e,t):$$(this.ids.component).show(e)}setValue(e){this._setting=e}getValue(){return this._setting}setHiddenFields(e=[]){this._hiddenFields=e??[]}}(t)}},6038:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e,t){t=t||"ui_work_object_workspace_popupHideFields";const i=(0,n.Z)(e);var a=i.L();return new class extends i{constructor(e){super(e,{list:"",buttonHide:"",buttonShow:""}),this._settings=[],this._frozenColumnID=null}ui(){var t=this.ids;return{view:"popup",id:t.component,body:{rows:[{view:"list",id:t.list,maxHeight:350,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa ab-visible-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)},onAfterRender(){this.data.each((i=>{e.ClassUI.CYPRESS_REF(this.getItemNode(i.id),`${t.list}_${i.id}`)}))}}},{cols:[{id:t.buttonHide,view:"button",value:a("Hide All"),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onItemClick:()=>{this.clickHideAll()}}},{id:t.buttonShow,view:"button",css:"webix_primary",value:a("Show All"),type:"form",on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onItemClick:()=>{this.clickShowAll()}}}]}]},on:{onShow:()=>{this.onShow(),this.iconsReset()}}}}init(e){this.AB=e,webix.ui(this.ui()),this.$Component=$$(this.ids.component),this.$List=$$(this.ids.list)}changed(){this.emit("changed",this._settings)}clickHideAll(){var e=this.CurrentObject.fields(),t=[];e.forEach((function(e){t.push(e.columnName)})),this._settings=t,this.iconsReset(),this.changed()}clickShowAll(){this._settings=[],this.iconsReset(),this.changed()}clickListItem(e,t,i){var n=this.$List.getItem(e);if(this._frozenColumnID!=n.columnName){var o=[];(this._settings||[]).filter((e=>e==n.columnName)).length>0?(o=(this._settings||[]).filter((e=>e!=n.columnName)),this.iconShow(i)):((o=this._settings||[]).push(n.columnName),this.iconHide(i)),this._settings=o||[],this.changed()}else webix.alert({text:a("Sorry, you cannot hide your last frozen column.")})}iconFreezeOff(e){e&&e.querySelector(".ab-visible-field-icon").classList.remove("fa-thumb-tack")}iconFreezeOn(e){e&&e.querySelector(".ab-visible-field-icon").classList.add("fa-thumb-tack")}iconHide(e){e&&(e.querySelector(".ab-visible-field-icon").classList.add("fa-eye-slash"),e.style.opacity=.4)}iconShow(e){e&&(e.querySelector(".ab-visible-field-icon").classList.remove("fa-eye-slash"),e.style.opacity=1)}iconsReset(){for(var e=this.$List,t=e.getFirstId();t;){var i=e.getItem(t),n=e.getItemNode(t);this._frozenColumnID==i.columnName?this.iconFreezeOn(n):(this.iconFreezeOff(n),-1==(this._settings||[]).indexOf(i.columnName)?this.iconShow(n):this.iconHide(n)),t=e.getNextId(t)}}onShow(){var e=this.CurrentObject.fields(),t=[];e.forEach((e=>{t.push({id:e.id,label:e.label,columnName:e.columnName})})),this.$List.clearAll(),this.$List.parse(e)}show(e,t=null){null!=t?this.$Component.show(e,t):this.$Component.show(e)}setSettings(e){this._settings=this.AB.cloneDeep(e||[])}getSettings(){return this._settings||[]}setFrozenColumnID(e){this._frozenColumnID=e}}(t)}},2439:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),a=i(7056);function o(e,t){t=t||"abd_work_object_workspace_popupNewDataField";const i=(0,n.Z)(e),o=i.L(),s=(0,a.Z)(e);return new class extends i{constructor(e){super(e,{types:"",editDefinitions:"",buttonSave:"",buttonCancel:"",title:"",buttonMaximize:"",buttonMinimize:"",chooseFieldType:"",searchBar:"",fieldSetting:"",submission:"",buttonBack:""}),this._componentHash={},this._componentsByType={},this._currentEditor=null,this.defaultEditorComponent=null,this.submenus=[],this._editField=null}ui(){const e=this.ids;return{view:"window",position:"center",id:e.component,resize:!0,modal:!0,boarderless:!0,height:500,width:700,head:{view:"toolbar",css:"webix_dark",paddingX:2,elements:[{view:"label",id:e.title,align:"center",label:o("Choose Field-Type"),css:"modal_title"},{cols:[{view:"button",id:e.buttonMaximize,label:'<span class="webix_icon"><i class="nomargin fa fa-expand"></i></span>',css:"webix_transparent",width:40,click:()=>{this.buttonMaximize()}},{view:"button",id:e.buttonMinimize,label:'<span class="webix_icon"><i class="nomargin fa fa-compress"></i></span>',hidden:!0,css:"webix_transparent",width:40,click:()=>{this.buttonMinimize()}},{view:"button",label:'<span class="webix_icon"><i class="nomargin fa fa-times"></i></span>',css:"webix_transparent",width:40,click:()=>{this.buttonCancel()},on:{onAfterRender(){i.CYPRESS_REF(this)}}}]}]},body:{rows:[{id:e.chooseFieldType,rows:[{view:"search",id:e.searchBar,placeholder:o("Search by title..."),align:"center",on:{onTimedKeyPress:()=>{this.searchBar()}}},{view:"dataview",id:e.types,borderless:!0,type:{width:87.5,height:85,borderless:!0,template:'<button type="button" class="webix_button webix_img_btn_top" style="text-align: center;"><span style="font-size: 30px; color: #94a1b3;"><i class="#icon#"></i><br></span><span style="font-size: 12px; line-height: 13px; display: inline-block; margin: 3px 3px 0;">#label#</span></button>',css:"webix_transparent"},data:[],datatype:"json",select:1,click:e=>{this.onClick(e)}}]},{id:e.fieldSetting,minWidth:692,maxWidth:3840,maxHeight:2160,hidden:!0,rows:[{view:"multiview",id:e.editDefinitions,padding:0,cells:[{id:"del_me",view:"label",label:o("edit definition here")}]},{id:e.submission,cols:[{fillspace:!0},{view:"button",value:'<span class="webix_icon"><i class="nomargin fa fa-arrow-left fa-sm"></i></span><span class"text">'+o("Back")+"</span>",id:e.buttonBack,css:"ab-cancel-button webix_transparent icon_back_btn",autowidth:!0,click:()=>{this.buttonBack()}},{view:"button",css:"webix_primary",id:e.buttonSave,label:'<span class="text">'+o("Create")+"</span>",autowidth:!0,type:"form",click:()=>{this.buttonSave()}},{width:17}]},{height:17}]}]},on:{onHide:()=>{this.resetState()}}}}async init(e){e&&(this.AB=e);const i=this.ids;webix.ui(this.ui()),webix.extend($$(i.component),webix.ProgressBar);const n=s.fields(),a={view:"multiview",id:i.editDefinitions,animate:!1,rows:[]};n.forEach((e=>{const i=new e(`${t}_properties`),n=i.defaults().menuName,s=i.defaults().key,r=i.defaults().icon;this.submenus.push({id:n,icon:`nomargin fa fa-${r}`,label:o(n)}),this.defaultEditorComponent||(this.defaultEditorComponent=i),a.rows.push(i.ui()),this._componentHash[n]=i,this._componentsByType[s]=i})),$$(i.types).define("data",this.submenus),$$(i.types).refresh(),webix.ui(a,$$(i.editDefinitions));for(let e in this._componentHash)this._componentHash[e].init(this.AB),this._componentHash[e].hide();this.defaultEditorComponent.show(),this._currentEditor=this.defaultEditorComponent}applicationLoad(e){super.applicationLoad(e);for(const t in this._componentHash)this._componentHash[t]?.applicationLoad(e)}objectLoad(e){super.objectLoad(e);for(const t in this._componentHash)this._componentHash[t]?.objectLoad(e)}buttonCancel(){$$(this.ids.searchBar).setValue(""),this.searchBar(),this.buttonBack(),$$(this.ids.component).hide()}buttonMaximize(){$$(this.ids.buttonMaximize).hide(),$$(this.ids.buttonMinimize).show(),webix.fullscreen.set(this.ids.component)}buttonMinimize(){$$(this.ids.buttonMinimize).hide(),$$(this.ids.buttonMaximize).show(),webix.fullscreen.exit()}searchBar(){const e=$$(this.ids.searchBar).getValue().toLowerCase();$$(this.ids.types).filter((t=>-1!=t.label.toLowerCase().indexOf(e)))}buttonBack(){this.resetState(),this.addPopup();for(const e in this._componentHash)this._componentHash[e].clear()}async buttonSave(){const e=this.ids;$$(e.buttonSave).disable(),$$(e.component).showProgress();const t=this._currentEditor;if(t)if(t.isValid()){const i=this.AB.cloneDeep(t.values());let n,a=null,o=null;if(this._editField){i.label&&(this._editField.label=i.label),o=this._editField.toObj();const e=this.AB.cloneDeep(o);for(let t in i)if("settings"==t&&i.settings&&"object"==typeof i.settings){e.settings=e.settings||{};for(let t in i.settings)e.settings[t]=i.settings[t]}else e[t]=i[t];this._editField.fromValues(e),a=this._editField}else{if(a=this.CurrentObject.fieldNew(i),i.columnName!==a.columnName&&""===a.columnName)return this.AB.Webix.message({text:"The column name can't contain special characters.",type:"error"}),$$(e.buttonSave).enable(),void $$(e.component).hideProgress();let t=20+10*a.label.length;if(a.settings.showIcon&&(t+=20),t<100&&(t=100),a.settings.width=t,"connectObject"==a.key){let e=Math.floor(1e3*Math.random());a.settings.isSource=1;const i=a.datasourceLink;let o=a.columnName;i.fields((e=>e.columnName==o)).length&&(o=`${o}${e}`),"many"==a.settings.linkType&&"many"==a.settings.linkViaType&&(o=`${this.CurrentObject.name}${e}`),n=i.fieldNew({key:a.key,columnName:o,label:this.CurrentObject.label,settings:{showIcon:a.settings.showIcon,linkObject:a.object.id,linkType:a.settings.linkViaType,linkViaType:a.settings.linkType,isCustomFK:a.settings.isCustomFK,indexField:a.settings.indexField,indexField2:a.settings.indexField2,isSource:0,width:t}})}}const s=a.isValid();if(s.fail())s.updateForm($$(t.ids.component)),o&&a.fromValues(o),$$(e.buttonSave).enable(),$$(e.component).hideProgress();else try{await a.save();let t=()=>{$$(e.buttonSave).enable(),$$(e.component).hideProgress(),this._currentEditor.clear(),this.hide(),this.emit("save",a)};null!=n?(n.settings.linkColumn=a.id,await n.save(),a.settings.linkColumn=n.id,await a.save(),this._editField||(await a.migrateCreate(),await n.migrateCreate()),t()):t()}catch(e){this.AB.notify.developer(e,{context:"UIWorkObjectWorkspacePopupNewDataField:buttonSave(): error saving new field",field:a.toObj()})}}else $$(e.buttonSave).enable(),$$(e.component).hideProgress();else this.AB.notify.developer(new Error("Could not find the current editor."),{}),$$(e.buttonSave).enable(),$$(e.component).hideProgress();this.buttonCancel}hide(){$$(this.ids.component).hide()}modeAdd(e,t=!0){this.defaultEditorComponent.show(!1,!1),this._currentEditor=this.defaultEditorComponent;const i=this.ids;if(this.CurrentObject.isImported&&(e="connectObject"),e){const i=Object.keys(this._componentHash).map((e=>this._componentHash[e])).filter((t=>t.defaults().key==e))[0];if(!i)return;const n=i.defaults().menuName;t||$$(this.ids.buttonBack).hide(),this.onClick(n)}else $$(i.chooseFieldType).enable(),this.addPopup()}modeEdit(e){this._currentEditor?.hide();for(const t in this._componentsByType)t==e.key?(this._componentsByType[t].show(!1,!1),this._componentsByType[t].populate(e),this._currentEditor=this._componentsByType[t],this._currentEditor.modeEdit=!0):this._componentsByType[t].hide();const t=this._currentEditor.ui()?.elements;if(t){const e=e=>{e.disallowEdit&&$$(e.id)?.disable?.()};this._currentEditor.eachDeep(t,e)}this.editPopup(e.defaults.menuName)}onClick(e){$$(this.ids.chooseFieldType).hide(),$$(this.ids.fieldSetting).show(),$$(this.ids.title).setValue(o("Create Field:")+" "+e);const t=this._componentHash[e];t&&(t.show(),this._currentEditor=t,this._currentEditor.modeEdit=!1)}resetState(){const e=this._currentEditor.ui()?.elements;if(e){const t=e=>{e.disallowEdit&&$$(e.id)?.enable?.()};this._currentEditor.eachDeep(e,t)}this.defaultEditorComponent.show(),this._currentEditor=this.defaultEditorComponent}addPopup(){this.buttonMinimize(),$$(this.ids.chooseFieldType).show(),$$(this.ids.buttonBack).show(),$$(this.ids.title).setValue(o("Choose Field-Type")),$$(this.ids.fieldSetting).hide(),$$(this.ids.buttonSave).define("label",o("Create")),$$(this.ids.buttonSave).refresh()}editPopup(e){this.buttonMinimize(),$$(this.ids.chooseFieldType).hide(),$$(this.ids.buttonBack).hide(),$$(this.ids.title).setValue(o("Edit Field:")+" "+e),$$(this.ids.fieldSetting).show(),$$(this.ids.buttonSave).define("label",o("Save")),$$(this.ids.buttonSave).refresh()}show(e,t,i=!0){this._editField=e,this._editField?this.modeEdit(e):this.modeAdd(t,i),$$(this.ids.component).show()}typeClick(){const e=this.ids;let t=$$(e.types).config.data[0].submenu;"string"!=typeof t&&($$(e.types).getSubMenu($$(e.types).config.data[0].id),t=$$(e.types).config.data[0].submenu),$$(t)&&$$(t).show()}}(t)}},423:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);function a(e,t){t=t||"ui_work_object_workspace_popupSortFields";const i=(0,n.Z)(e);var a=i.L();return new class extends i{constructor(e){super(e,{list:"",form:""}),this._blockOnChange=!1}uiForm(){return{id:this.ids.form,view:"form",borderless:!0,elements:[{view:"button",type:"form",css:"webix_primary",value:a("Add new sort"),on:{onItemClick:()=>{this.clickAddNewSort()}}}]}}ui(){return{view:"popup",id:this.ids.component,width:600,body:this.uiForm(),on:{onShow:()=>{this.onShow()}}}}init(e){this.AB=e,webix.ui(this.ui())}clickAddNewSort(e,t){var i=this,n=$$(this.ids.form),o=n.getChildViews().length-1,s=this.getFieldList(!0);n.addView({id:`sort_${o+1}`,cols:[{view:"combo",width:220,options:s,on:{onChange:function(e){i.onChangeCombo(e,this)}}},{view:"segmented",width:200,options:[{id:"",value:a("Please select field")}],on:{onChange:()=>{this.triggerOnChange()}}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",width:30,on:{onItemClick:function(){n.removeView(this.getParentView()),i.refreshFieldList(!0),i.triggerOnChange()}}}]},o),e&&n.getChildViews()[o].getChildViews()[0].setValue(e),t&&n.getChildViews()[o].getChildViews()[1].setValue(t)}getFieldList(e){var t=$$(this.ids.form),i=[],n=this.CurrentObject.fields();if(!n)return i;if(n.forEach((e=>{e.fieldIsSortable()&&i.push({id:e.id,value:e.label})})),e){var a=t.getChildViews();a.length>1&&a.forEach((function(e,t){if(a.length-1<=t)return!1;var n=e.getChildViews()[0].getValue();if(n){var o=null;i.map(((e,t)=>e.id==n&&(o=t,!0))),i.splice(o,1)}}))}return i}setSettings(e){this._settings=this.AB.cloneDeep(e)}getSettings(){var e=$$(this.ids.form),t=[],i=e.getChildViews();return i.length>1&&i.forEach((function(e,n){if(i.length-1<=n)return!1;var a=e.getChildViews()[0].getValue(),o=e.getChildViews()[1].getValue();t.push({key:a,dir:o})})),t}onChangeCombo(e,t){var i=this.CurrentObject.fields(),n="",o=t.getParentView().getChildViews()[1],s=null;if(i.forEach((t=>{t.id==e&&(n=t)})),n){switch(n.key){case"date":s=[{id:"asc",value:a("Before -> After")},{id:"desc",value:a("After -> Before")}];break;case"number":s=[{id:"asc",value:a("1 -> 9")},{id:"desc",value:a("9 -> 1")}];break;default:s=[{id:"asc",value:a("A -> Z")},{id:"desc",value:a("Z -> A")}]}o.define("options",s),o.refresh(),this.refreshFieldList(),this.triggerOnChange()}}onShow(){var e=$$(this.ids.form);webix.ui(this.uiForm(),e);var t=this._settings;t&&t.forEach&&t.forEach((e=>{this.clickAddNewSort(e.key,e.dir)})),null!=t&&0!=t.length||this.clickAddNewSort()}refreshFieldList(e){var t=$$(this.ids.form),i=this.getFieldList(!1),n=[],a=[],o=t.getChildViews();o.length>1&&o.forEach((function(e,t){if(o.length-1<=t)return!1;let s=e.getChildViews()[0].getValue(),r=i.filter((e=>e.id==s));r.length>0?n.push(r[0]):a.push(e)})),e||a.forEach((e=>{t.removeView(e)})),(o=t.getChildViews()).length>1&&o.forEach(((e,t)=>{if(o.length-1<=t)return!1;let a=e.getChildViews()[0].getValue(),s=i.filter((e=>e.id==a));var r=n.filter((e=>!Array.isArray(s)||-1===s.indexOf(e))),l=i.filter((e=>!Array.isArray(r)||-1===r.indexOf(e)));e.getChildViews()[0].define("options",l),e.getChildViews()[0].refresh()}))}triggerOnChange(){this._blockOnChange||(this._settings=this.getSettings(),this.emit("changed",this._settings))}blockOnChange(){this._blockOnChange=!0}unblockOnChange(){this._blockOnChange=!1}show(e,t,i){this.blockOnChange(),$$(this.ids.component).show(e,i||null),t&&this.clickAddNewSort(t),this.unblockOnChange()}sort(e,t){var i=0,n=$$(this.ids.form).getChildViews();return n.length>1&&n.forEach(((a,o)=>{if(!(n.length-1<=o||0!=i)){var s=a.getChildViews()[0].getValue(),r=a.getChildViews()[1].getValue(),l=this.CurrentObject.fieldByID(s);if(l){var c=l.columnName,d=e[c],u=t[c];Array.isArray(d)&&(d=(d||[]).map((e=>e.text||e)).join(" ")),Array.isArray(u)&&(u=(u||[]).map((e=>e.text||e)).join(" ")),d!=u&&(i="asc"==r?d>u?1:-1:d<u?1:-1)}}})),i}}(t)}},2770:(e,t,i)=>{const n=i(4009);e.exports=class{constructor(e,t=FileReader){this._AB=e,this._FileReader=t}L(...e){return this._AB.Multilingual.labelPlugin("ABDesigner",...e)}getSeparateItems(){return[{id:",",value:this.L("Comma (,)")},{id:"\t",value:this.L("Tab (&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)")},{id:";",value:this.L("Semicolon (;)")},{id:"s",value:this.L("Space ( )")}]}validateFile(e){if(!e||!e.file||!e.file.type)return!1;let t=e.file.type.toLowerCase();return"text/csv"==t||"application/vnd.ms-excel"==t}async getDataRows(e,t){return this.validateFile(e)?new Promise(((i,n)=>{let a=new this._FileReader;a.onload=e=>{const n=this.convertToArray(a.result,t);i(n)},a.readAsText(e.file)})):Promise.reject(this.L(".fileInfo parameter is invalid"))}convertToArray(e="",t=","){let i=[];return(e.split(/\r\n|\n|\r/).filter((e=>e&&e.length>0))||[]).forEach((e=>{let n=[];n=","==t?(e=e.replace(/,,/g,", ,")).match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g):e.split(t),i.push(n.map((e=>this.reformat(e))))})),i}getGuessDataType(e,t){for(var i,a=1;a<=10;a++){var o=e[a];if(!o)break;if(null!=(i=o[t])&&i.length>0)break}return n.getFieldType(i)}reformat(e){return e?e.trim().replace(/"/g,"").replace(/'/g,""):""}}},4009:e=>{e.exports=class{static getFieldType(e){return null==e||""===e?"string":0==e||1==e||1==e||0==e||"checked"==e||"unchecked"==e?"boolean":isNaN(e)?Date.parse(e)?"date":e.length>100?"LongText":"string":"number"}}},7980:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});class n{get key(){return"formiobuilder"}constructor(e){this.AB=e,this.label=this.AB.Label(),this.view=this.key,this.AB.Webix.protoUI(this.ui(),this.AB.Webix.ui.popup)}ui(){return{name:this.key,defaults:{css:"scrolly forceOpen",hidden:!1,autofit:!0},$init:async function(e){const t=this.parseDataFields(e.dataFields),i=e.formComponents?e.formComponents:{components:[t.approveButton.schema]};try{this.builder=await Formio.builder(this.$view,i,{noDefaultSubmitButton:!0,noNewEdit:!0,builder:{basic:!1,advanced:!1,customBasic:!1,premium:!1,custom:{title:this.label("Fields"),weight:0,default:!0,components:t},layout:{components:{table:!0}}}})}catch(e){this.notify("Error initializing formio builder",e)}},getFormData:function(){return this.builder.schema},label:this.label,parseDataFields:this.parseDataFields,notify:this.AB.notify.developer}}parseDataFields(e){const t={};return e.forEach((({field:e,key:i,label:n})=>{if(!e)return;const a={abFieldID:e.id,label:e.label,disabled:!0,key:i,_key:i,type:"textfield",input:!0};switch(e.key){case"boolean":a.type="checkbox";break;case"calculate":a.inputType="text",a.calculateValue=`value = ${e.settings.formula.replace(/{/g,"data['").replace(/}/g,"']")}`;break;case"connectObject":a.inputType="text",a.calculateValue=`value = data['${i}.format']`;break;case"date":a.type="datetime",a.format="MMMM d, yyyy";break;case"datetime":a.type="datetime",a.format="MMMM d, yyyy h:mm a";break;case"email":a.type="email";break;case"file":a.type="htmlelement",a.tag="a",a.className="btn btn-primary btn-block",a.content=`<i class='fa fa-paperclip'></i> {{data['${i}']?.filename ?? "No File"}}`,a.attrs=[{attr:"href",value:e.urlFile(`{{data['${i}'].uuid}}`)},{attr:"target",value:"_blank"}],a.refreshOnChange=!0,a.input=!1;break;case"image":a.type="htmlelement",a.tag="img",a.className="img-thumbnail max100",a.content="",a.attrs=[{attr:"src",value:e.urlImage(`{{data['${i}']}}`)}],a.refreshOnChange=!0,a.input=!1;break;case"list":var o=[];e.settings.options.forEach((e=>{o.push({label:e.text,value:e.id})})),a.type="select",a.data={values:o},a.multiple=e.settings.isMultiple;break;case"LongText":a.type="textarea";break;case"number":a.type="number";break;case"TextFormula":a.inputType="text",a.calculateValue=`value = '${e.settings.textFormula}'`}t[i]={title:n,key:i,icon:e.icon,schema:a}})),t.approveButton={title:this.label("Approve Button"),key:"approve",icon:"check-square",schema:{label:this.label("Approve"),type:"button",key:"approve",event:"approve",block:!0,size:"lg",input:!1,leftIcon:"fa fa-thumbs-up",action:"event",theme:"success"}},t.denyButton={title:this.label("Deny Button"),key:"deny",icon:"ban",schema:{label:this.label("Deny"),type:"button",key:"deny",event:"deny",block:!0,size:"lg",input:!1,leftIcon:"fa fa-thumbs-down",action:"event",theme:"danger"}},t.customButton={title:this.label("Custom Action Button"),key:"custom",icon:"cog",schema:{label:this.label("Custom Name"),type:"button",key:"custom",event:"yourEvent",block:!0,size:"lg",input:!1,leftIcon:"fa fa-cog",action:"event",theme:"primary"}},t}}}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={id:n,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nc=void 0,(()=>{"use strict";var e=i(5256),t=i.n(e),n=i(3285),a=null;function o(e){if(!a){const i=(0,n.Z)(e);var t=i.L();a=class extends i{constructor(e){var i="abd_common_popupEditMenu";super(i),this.labels={copy:t("Copy"),exclude:t("Exclude"),rename:t("Rename"),delete:t("Delete")},this.ids.menu=`${i}_menu_${e}`,this.ids.list=`${i}_list_${e}`,this.Popup=null,this._menuOptions=[{label:this.labels.rename,icon:"fa fa-pencil-square-o",command:"rename"},{label:this.labels.copy,icon:"fa fa-files-o",command:"copy"},{label:this.labels.exclude,icon:"fa fa-reply",command:"exclude"},{label:this.labels.delete,icon:"fa fa-trash",command:"delete"}]}ui(){return{view:"popup",id:this.ids.menu,head:t("Application Menu"),width:120,body:{view:"list",id:this.ids.list,borderless:!0,data:[],datatype:"json",template:"<i class='fa #icon#' aria-hidden='true'></i> #label#",autoheight:!0,select:!1,on:{onItemClick:e=>{const{command:t}=$$(this.ids.list).getItem(e);return this.trigger(t)}}}}}async init(e,t){if(t=t||{},null==this.Popup&&(this.Popup=webix.ui(this.ui())),this.$list=$$(this.ids.list),this.hide(),this.menuOptions(this._menuOptions),t.hideCopy){let e=this.$list.data.find((e=>e.label==this.labels.copy))[0];if(e&&(this.$list.remove(e.id),this.$list.refresh()),t.hideExclude){let e=this.$list.data.find((e=>e.label==this.labels.exclude))[0];e&&(this.$list.remove(e.id),this.$list.refresh())}}}menuOptions(e){this.$list.clearAll(),this._menuOptions=e;var t=[];e.forEach((e=>{t.push({label:e.label,icon:e.icon,command:e.command})})),this.$list.parse(t),this.$list.refresh()}show(e){this.Popup?.show(e)}trigger(e){if(e)return this.hide(),this.emit("click",e),!1}hide(){this.Popup?.hide()}}}return a}function s(e,t,i){t=t||"ui_warnings";const a=(0,n.Z)(e);var o=a.L();return new class extends a{constructor(e,t={}){super(e,{buttonWarning:"",buttonWarningHide:"",warnings:"",warningsScroll:""})}ui(){var e=this.ids;return{rows:[{view:"button",type:"form",id:e.buttonWarning,css:"webix_primary darkorange",value:`<i class="fa fa-warning"></i> ${o("Show Issues")}`,hidden:!0,click:()=>{$$(e.warnings).show(),$$(e.buttonWarning).hide(),$$(e.buttonWarningHide).show()}},{view:"button",type:"form",id:e.buttonWarningHide,css:"webix_primary darkorange",value:`<i class="fa fa-warning"></i> ${o("Hide Issues")}`,hidden:!0,click:()=>{$$(e.warnings).hide(),$$(e.buttonWarningHide).hide(),$$(e.buttonWarning).show()}},{id:e.warnings,view:"scrollview",scroll:"y",css:"webix_theme_dark",minHeight:300,body:{rows:[{id:e.warningsScroll,template:"Here are my warnings",autoheight:!0,css:"webix_theme_dark"}]},hidden:!0}]}}async init(e){this.AB=e}show(e){super.show();var t=this.ids;let i=e?.warningsAll().map((e=>e.message));if(i=this.AB.uniq(i),i?.length){let e="<ul class='warningslist'>";i.forEach((t=>{t&&(e+=`<li><i class="warningtext fa fa-warning"></i> ${t}</li>`)})),e+="</ul>",$$(t.warningsScroll).setHTML(e),$$(t.warnings).isVisible()?($$(t.buttonWarning).hide(),$$(t.buttonWarningHide).show()):($$(t.buttonWarning).show(),$$(t.buttonWarningHide).hide())}else $$(t.warningsScroll).setHTML(""),$$(t.warnings).hide(),$$(t.buttonWarning).hide(),$$(t.buttonWarningHide).hide()}}(t,i)}var r=i(8788);function l(e,t){var i=o(e);const n=e.Config.uiSettings();var a=function(...t){return e.Multilingual.labelPlugin("ABDesigner",...t)};class s extends e.ClassUI{constructor(e){var t=e.idBase||"ui_common_list";if(super(t,{listSetting:"",list:"",searchText:"",sort:"",group:"",buttonNew:""}),this.idBase=t,this.labels={addNew:"Add new item",confirmDeleteTitle:"Delete Item",title:"Items",searchPlaceholder:"Item name",renameErrorMessage:"error renaming {0}",confirmDeleteMessage:"Do you want to delete <b>{0}</b>?",listSearch:"Search",listSetting:"Settings",listSort:"Sort",listAsc:"A -> Z",listDesc:"Z -> A",listGroup:"Group"},e.labels)for(var i in e.labels)this.labels[i]=e.labels[i];e.menu=e.menu||{},e.menu.copy=void 0===e.menu.copy||e.menu.copy,e.menu.exclude=void 0===e.menu.exclude||e.menu.exclude,this.attributes=e,this._templateListItem=e.templateListItem||["<div class='ab-object-list-item'>","#label##warnings#","{common.iconGear}","</div>"].join(""),this.cacheTemplate={},this.CurrentApplication=null,this.itemList=null,this._initialized=!1,this._settings={}}ui(){this.PopupEditComponent=new i(this.ids.component);var t=this.ids;return{id:this.ids.component,rows:[{view:e.custom.editunitlist.view,id:this.ids.list,width:n.columnWidthLarge,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",uniteBy:()=>a(this.labels.title),template:(e,t)=>this.templateListItem(e,t),tooltip:e=>this.toolTipListItem(e),type:{height:35,headerHeight:35,iconGear:e=>`<div class="ab-object-list-edit"><span class="webix_icon fa fa-cog" data-cy="${this.ids.list}_edit_${e.id}"></span></div>`},on:{onAfterSelect:e=>{this.onSelectItem(e)},onBeforeEditStop:(e,t)=>{this.onBeforeEditStop(e,t)},onAfterEditStop:(e,t,i)=>{this.onAfterEditStop(e,t,i)},onAfterRender(){this.data.each((i=>{e.ClassUI.CYPRESS_REF(this.getItemNode(i.id),`${t.list}_${i.id}`)}))}},onClick:{"ab-object-list-edit":(e,t,i)=>{this.clickEditMenu(e,t,i)}}},{view:"accordion",multi:!0,css:"ab-object-list-filter",rows:[{id:this.ids.listSetting,header:a(this.labels.listSetting),headerHeight:45,headerAltHeight:45,body:{padding:5,rows:[{id:this.ids.searchText,view:"search",icon:"fa fa-search",label:a(this.labels.listSearch),labelWidth:80,placeholder:a(this.labels.searchPlaceholder),height:35,keyPressTimeout:100,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onTimedKeyPress:()=>{this.listSearch(),this.save()}}},{id:this.ids.sort,view:"segmented",label:a(this.labels.listSort),labelWidth:80,height:35,options:[{id:"asc",value:a(this.labels.listAsc)},{id:"desc",value:a(this.labels.listDesc)}],on:{onAfterRender(){this.$view.querySelectorAll("button").forEach((i=>{var n=i.getAttribute("button_id");e.ClassUI.CYPRESS_REF(i,`${t.sort}_${n}`)}))},onChange:e=>{this.listSort(e),this.save()}}},{id:this.ids.group,view:"checkbox",label:a(this.labels.listGroup),labelWidth:80,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onChange:e=>{this.listGroup(e),this.save()}}}]}}],on:{onAfterCollapse:()=>{this.listSettingCollapse(),this.save()},onAfterExpand:()=>{this.listSettingExpand(),this.save()}}},{view:"button",css:"webix_primary",id:this.ids.buttonNew,value:a(this.labels.addNew),type:"form",click:()=>{this.clickAddNew(!0)},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}}init(e){this.AB=e,$$(this.ids.component)&&$$(this.ids.component).adjust(),this.$list=$$(this.ids.list),this.$list&&(webix.extend(this.$list,webix.ProgressBar),this.$list.adjust()),this.PopupEditComponent.init(e,{hideCopy:!this.attributes.menu.copy,hideExclude:!this.attributes.menu.exclude}),this.PopupEditComponent.on("click",(e=>{var t=this.$list.getSelectedItem(!1);switch(e){case"delete":this.remove();break;case"rename":this.rename();break;case"exclude":this.emit("exclude",t);break;case"copy":this.copy(t);break;default:this.emit("menu",{command:e,id:t.id})}})),this._settings=this.AB.Storage.get(this.idBase)||{objectlistIsOpen:!1,objectlistSearchText:"",objectlistSortDirection:"",objectlistIsGroup:!1},this._initialized=!0}dataLoad(e){this.busy(),this.itemList=new webix.DataCollection({data:e});var t=$$(this.ids.listSetting);t.getParentView().blockEvent(),t.define("collapsed",1!=this._settings.objectlistIsOpen),t.refresh(),t.getParentView().unblockEvent();var i=$$(this.ids.searchText);i.blockEvent(),i.setValue(this._settings.objectlistSearchText),i.unblockEvent();var n=$$(this.ids.sort);n.blockEvent(),n.setValue(this._settings.objectlistSortDirection),n.unblockEvent();var a=$$(this.ids.group);a.blockEvent(),a.setValue(this._settings.objectlistIsGroup),a.unblockEvent();var o=this.$list;o&&(o.clearAll(),o.data.unsync(),o.data.sync(this.itemList),o.refresh(),o.unselectAll()),this.listSort(this._settings.objectlistSortDirection),this.listSearch(),this.ready()}clickEditMenu(e,t,i){return this.PopupEditComponent.show(i),!1}copy(e){var t=e.toObj();t.id="copy_"+(this.itemList?this.itemList.count():"01"),delete t.translations,t.name=t.name+" copy",t.label=t.name;var i=this.$list,n=i.getIndexById(i.getSelectedId());i.add(t,n),i.select(t.id),i.edit(t.id)}listSettingCollapse(){this._settings.objectlistIsOpen=!1}listSettingExpand(){this._settings.objectlistIsOpen=!0}busy(){this.$list?.showProgress?.({type:"icon"})}ready(){this.$list?.hideProgress?.()}listSearch(){var e=$$(this.ids.searchText).getValue().toLowerCase();this.$list.filter((function(t){return!t.label||t.label.toLowerCase().indexOf(e)>-1})),this._settings.objectlistSearchText=e}listSort(e){null!=this.itemList&&(this.itemList.sort("label",e),this.listSearch(),this._settings.objectlistSortDirection=e)}listGroup(e){1==e?this.$list.define("uniteBy",(e=>e.label.toUpperCase().substr(0,1))):this.$list.define("uniteBy",(()=>a(this.labels.title))),this.$list.refresh(),this._settings.objectlistIsGroup=e}listCount(){if(this.$list)return this.$list.count()}selectedItem(){return this.$list.getSelectedItem(!1)}onAfterEditStop(e,t){if(this.showGear(t.id),e.value!=e.old){this.busy();var i=this.$list.getSelectedItem(!1);if(i.label=e.value,i.save)i.save().catch((t=>{this.ready(),webix.alert({title:a("Alert"),text:a(this.labels.renameErrorMessage,e.old)}),this.AB.notify.developer(t,{context:"ui_common_list:onAfterEditStop():Error saving item.",id:i.id,value:e.value})})).then((()=>{this.ready()}));else if(0==i.id.indexOf("copy_")){i.name=i.label;var n=i.id;delete i.id,this.emit("copied",{item:i,currID:n})}}}onBeforeEditStop(e){var t=this.$list.getSelectedItem(!1);return t.label=e.value,!t.isValid||!t.isValid().fail()||(t.label=e.old,!1)}onSelectItem(e){var t=this.$list.getItem(e);this.emit("selected",t),this.showGear(e)}save(){this._initialized&&this.AB.Storage.set(this.idBase,this._settings)}selectItem(e){this.$list.blockEvent(),this.select(e),this.$list.unblockEvent()}showGear(e){let t=this.$list.getItemNode(e);if(t){let e=t.querySelector(".ab-object-list-edit");e&&(e.style.visibility="visible",e.style.display="block")}}templateListItem(e,t){if(!this.cacheTemplate[e.id]){e.warningsEval?.();var i=e.warningsAll();if("string"==typeof this._templateListItem){var n="";i.length>0&&(n=this.WARNING_ICON),this.cacheTemplate[e.id]=this._templateListItem.replace("#label#",e.label||"??label??").replace("{common.iconGear}",t.iconGear(e)).replace("#warnings#",n)}else this.cacheTemplate[e.id]=this._templateListItem(e,t,i);setTimeout((()=>{delete this.cacheTemplate[e.id]}),400)}return this.cacheTemplate[e.id]}toolTipListItem(e){let t=$$(this.ids.list).data.getItem(e.id).warningsAll().length;return t?`${t} issues`:""}clickAddNew(e){this.emit("addNew",e)}exclude(){var e=this.$list.getSelectedItem(!1);this.emit("exclude",e)}rename(){var e=this.$list.getSelectedId(!1);this.$list.edit(e)}remove(){var e=this.$list.getSelectedItem(!1);webix.confirm({title:a(this.labels.confirmDeleteTitle),text:a(this.labels.confirmDeleteMessage,[e.label]),ok:a("Yes"),cancel:a("No"),callback:async t=>{if(t){this.busy();try{await e.destroy(),this.ready(),this.itemList.remove(e.id),this.emit("deleted",e),this.emit("selected",null)}catch(e){this.AB.notify.developer(e,{context:"ui_common_list:remove(): error removing item"}),this.ready()}}}})}select(e){this.$list.select(e)}callbackProcessEditorMenu(e){switch(e){case"rename":this.rename();break;case"exclude":this.exclude();break;case"delete":this.remove()}}}return new s(t)}var c=i(2770),d=i.n(c),u=i(4009),h=i.n(u);function p(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject",{tab:""}),this.selectNew=!0,this.BlankTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_blank",{form:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Create"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_object_list_newObject_blank_name")}}},{name:"isSystemObject",view:"checkbox",labelRight:i("is this a System Object?"),labelWidth:0,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_object_list_newObject_blank_isSystemObj")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Object"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){t.CYPRESS_REF(this)}}}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear()}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}save(){var e=$$(this.ids.buttonSave);e.disable();var t=this.$form;if(t.clearValidation(),!t.validate())return e.enable(),!1;var i=t.getValues();i.primaryColumnName="uuid",this.emit("save",i)}show(){$$(this.ids.component)?.show()}}}(e),this.CsvTab=function(e){const t=(0,n.Z)(e);var i=t.L();let a=e.Config.uiSettings();return new class extends t{constructor(){super("ui_work_object_list_newObject_csv",{form:"",uploadFileList:"",separatedBy:"",headerOnFirstLine:"",columnList:"",importButton:""}),this._csvImporter=new(d())(e)}ui(){let e=this.ids;return{id:e.component,header:i("Import CSV"),body:{view:"form",id:e.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:a.labelWidthMedium},{view:"uploader",name:"csvFile",value:i("Choose a CSV file"),accept:"text/csv",multiple:!1,autosend:!1,link:e.uploadFileList,on:{onBeforeFileAdd:e=>this.loadCsvFile(e)}},{id:e.uploadFileList,name:"uploadedFile",view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(e,t)=>{this.removeCsvFile(t)}}},{id:e.separatedBy,view:"richselect",name:"separatedBy",label:i("Separated by"),labelWidth:a.labelWidthXLarge,options:this._csvImporter.getSeparateItems(),value:",",on:{onChange:()=>{this.populateColumnList()}}},{id:e.headerOnFirstLine,view:"checkbox",name:"headerOnFirstLine",labelRight:i("Header on first line"),labelWidth:0,disabled:!0,value:!0,on:{onChange:()=>{this.populateColumnList()}}},{type:"space",rows:[{view:"scrollview",height:260,minHeight:260,maxHeight:260,body:{id:e.columnList,disabled:!0,rows:[]}}]},{margin:5,cols:[{fillspace:!0},{view:"button",name:"cancel",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()}},{view:"button",name:"import",id:e.importButton,value:i("Import"),css:"webix_primary",disabled:!0,autowidth:!0,type:"form",click:()=>{this.import()}}]}]}}}async init(e){return this.AB=e,this.allFields=this.AB.Class.ABFieldManager.allFields(),this._dataRows=[],this.$form=$$(this.ids.form),this.$uploadFileList=$$(this.ids.uploadFileList),this.$separatedBy=$$(this.ids.separatedBy),this.$headerOnFirstLine=$$(this.ids.headerOnFirstLine),this.$columnList=$$(this.ids.columnList),this.$importButton=$$(this.ids.importButton),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}async loadCsvFile(e){if(!this._csvImporter.validateFile(e))return webix.alert({title:i("This file extension is not allowed"),text:i("Please only upload CSV files"),ok:i("OK")}),!1;this.$form.showProgress&&this.$form.showProgress({type:"icon"});let t=this.$separatedBy.getValue();return this._dataRows=await this._csvImporter.getDataRows(e,t),this.$headerOnFirstLine.enable(),this.$columnList.enable(),this.$importButton.enable(),this.populateColumnList(),this.$form.hideProgress&&this.$form.hideProgress(),!0}removeCsvFile(e){return this.$uploadFileList.remove(e),this.formClear(),!0}populateColumnList(){webix.ui([],this.$columnList);var e=this._dataRows[0];if(null==e)return;var t=[];if(this.$headerOnFirstLine.getValue())t=e.map(((e,t)=>({include:!0,columnName:e,dataType:this._csvImporter.getGuessDataType(this._dataRows,t)})));else for(var i=0;i<e.length;i++)t.push({include:!0,columnName:"Field "+(i+1),dataType:this._csvImporter.getGuessDataType(this._dataRows,i)});let n=[];t.forEach((e=>{n.push({height:40,cols:[{view:"checkbox",value:e.include,width:30},{view:"text",value:e.columnName,width:a.labelWidthXLarge},{view:"select",value:e.dataType,options:[{id:"string",value:this.allFields.filter((e=>"string"==e.key))[0].defaults().menuName},{id:"LongText",value:this.allFields.filter((e=>"LongText"==e.key))[0].defaults().menuName},{id:"number",value:this.allFields.filter((e=>"number"==e.key))[0].defaults().menuName},{id:"date",value:this.allFields.filter((e=>"date"==e.key))[0].defaults().menuName},{id:"boolean",value:this.allFields.filter((e=>"boolean"==e.key))[0].defaults().menuName}],width:120}]})})),webix.ui(n,$$(this.$columnList))}import(){if(this.$importButton.disable(),!this.$form.validate())return this.$importButton.enable(),!1;let e=$$(this.$columnList).getChildViews();if(e.filter((e=>e.queryView({view:"checkbox"}).getValue()&&0==e.queryView({view:"text"}).getValue().trim().length)).length>0)return webix.alert({title:i("Column name is required"),text:i("Please enter column name"),ok:i("OK")}),this.$importButton.enable(),!1;if(e.filter((e=>e.queryView({view:"checkbox"}).getValue()&&this.allFields[0].reservedNames.indexOf(e.queryView({view:"text"}).getValue().trim().toLowerCase())>-1)).length>0)return webix.alert({title:i("Column name is invalid"),text:i("Please enter column name that does not match [{0}]",this.allFields[0].reservedNames.join(", ")),ok:i("OK")}),this.$importButton.enable(),!1;let t={primaryColumnName:"uuid",name:this.$form.getValues().name};this.emit("save",t)}onSuccess(t){let i=Promise.resolve();$$(this.$columnList).getChildViews().forEach(((e,n)=>{if(!e.queryView({view:"checkbox"}).getValue())return;let a=e.queryView({view:"text"}).getValue(),o=e.queryView({view:"select"}).getValue(),s={columnName:a,label:a,key:o,settings:{showIcon:1,weight:n}};switch(o){case"string":case"LongText":s.settings.supportMultilingual=0}let r=t.fieldNew(s);i=i.then((()=>r.save()))}));var n=t.model();return this._dataRows.forEach(((e,a)=>{i=i.then((()=>{if(this.$headerOnFirstLine.getValue()&&0==a)return Promise.resolve();var i={},o=e;return t.fields().forEach((e=>{null!=o[e.settings.weight]&&(i[e.columnName]=o[e.settings.weight])})),n.create(i)}))})),i.then((()=>(this.formClear(),this.$importButton.enable(),Promise.resolve()))).catch((t=>{e.notify.developer(t,{message:"Error import data rows from CSV"})}))}onError(e){e&&(e.updateForm&&e.updateForm(this.$form),this.$importButton.enable())}cancel(){this.formClear(),this.emit("cancel")}formClear(){this._dataRows=[],this.$form.clearValidation(),this.$form.clear(),this.$separatedBy.setValue(","),webix.ui([],$$(this.$columnList)),this.$uploadFileList.clearAll(),this.$headerOnFirstLine.disable(),this.$columnList.disable(),this.$importButton.disable()}}}(e),this.ApiTab=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_api",{form:"",buttonSave:"",buttonCancel:""}),this.API_Read=function(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_api_read_request",{requestPanel:"",requestForm:"",tabBasic:"",tabHeaders:"",tabPaging:"",tabSecret:"",pagingType:"",pagingStart:"",pagingLimit:"",pagingTotal:"",headers:"",secrets:""})}ui(){const t=this.ids,n=e.UISettings.config();return{id:t.requestPanel,header:i("Request"),body:{id:t.requestForm,view:"form",autoheight:!1,padding:0,elements:[{view:"layout",borderless:!0,margin:0,cols:[{view:"sidebar",data:[{id:t.tabBasic,value:i("Basic")},{id:t.tabHeaders,value:i("Header")},{id:t.tabPaging,value:i("Paging")},{id:t.tabSecret,value:i("Secret")}],width:120,select:!0,scroll:!1,on:{onAfterSelect:function(t){e.Webix.$$(t).show()}},ready:function(){this.select(this.getFirstId())}},{view:"multiview",animate:!1,cells:[{id:t.tabBasic,view:"layout",padding:10,rows:[{label:i("Verb"),name:"verb",options:["GET"],view:"select",disabled:!0},{view:"text",label:i("URI"),name:"url",placeholder:"https://example.com",type:"url",required:!0,on:{onChange:()=>{this._data.returnData=null}}},{fillspace:!0}]},{id:t.tabHeaders,view:"layout",padding:10,rows:[{padding:0,cols:[{label:i("Headers"),view:"label",padding:0,height:0},{icon:"wxi-plus",view:"icon",padding:0,width:38,click:()=>{this._addHeaderItem($$(this.ids.headers))}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:t.headers,view:"layout",padding:0,margin:0,rows:[]}}]},{id:t.tabPaging,view:"layout",padding:10,rows:[{id:t.pagingType,view:"richselect",label:i("Type"),value:"QueryString",labelWidth:n.labelWidthMedium,options:[{id:"QueryString",value:i("Query String")},{id:"Header",value:i("Headers")}]},{id:t.pagingStart,view:"text",label:i("Start"),labelWidth:n.labelWidthMedium,placeholder:i("Property name of the API for start index")},{id:t.pagingLimit,view:"text",label:i("Limit"),labelWidth:n.labelWidthMedium,placeholder:i("Property name of the API for limit return the item number")},{id:t.pagingTotal,view:"text",label:i("Total"),labelWidth:n.labelWidthMedium,placeholder:i("Property name of the API that returns the total value")},{fillspace:!0}]},{id:t.tabSecret,view:"layout",padding:10,rows:[{padding:0,cols:[{label:i("Secrets"),view:"label",padding:0,height:0},{icon:"wxi-plus",view:"icon",padding:0,width:38,click:()=>{this._addHeaderItem($$(this.ids.secrets))}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:t.secrets,view:"layout",padding:0,margin:0,rows:[]}}]}]}]}]}}}init(e,t){const i=this.ids,n=$$(i.requestForm);e.Webix.extend(n,webix.ProgressBar),this._data=t}getValues(){const e=this.ids,t=$$(e.requestForm).getValues()??{};t.paging={type:$$(e.pagingType).getValue(),start:$$(e.pagingStart).getValue(),limit:$$(e.pagingLimit).getValue(),total:$$(e.pagingTotal).getValue()};const i=$$(e.headers);return t.headers=t.headers??[],i?.getChildViews().forEach((e=>{const i=e.getChildViews()[0],n=e.getChildViews()[1],a=i.getValue(),o=n.getValue();null!=a&&null!=o&&t.headers.push({key:a,value:o})})),t.secrets=this._getSecretValues(),t}validate(){return $$(this.ids.requestForm).validate()}formClear(){const e=this.ids,t=$$(e.requestForm),i=$$(e.headers),n=$$(e.secrets);t.clearValidation(),t.clear(),this.AB.Webix.ui([],i),this.AB.Webix.ui([],n)}busy(){$$(this.ids.requestForm).showProgress({type:"icon"})}ready(){$$(this.ids.requestForm).hideProgress()}_getSecretValues(){const e=[];return $$(this.ids.secrets)?.getChildViews().forEach((t=>{const i=t.getChildViews()[0],n=t.getChildViews()[1],a=i.getValue(),o=n.getValue();null!=a&&null!=o&&e.push({name:a,value:o})})),e}_addHeaderItem(e){const t=this._headerItem(e);e.addView(t)}_headerItem(e,t,i){return{cols:[{placeholder:"key",view:"text",value:t},{placeholder:"value",view:"text",suggest:this._getSecretValues().map((e=>`SECRET:${e.name}`)),value:i},{icon:"wxi-trash",view:"icon",width:38,click:function(){const t=this.getParentView();e.removeView(t)}}]}}}}(e),a=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_api_read_response",{responsePanel:"",responseForm:"",tabBasic:"",tabFields:"",headers:"",dataKey:"",fields:""})}ui(){const t=this.ids;return{id:t.responsePanel,header:i("Response"),collapsed:!0,body:{id:t.responseForm,view:"form",autoheight:!1,padding:0,elements:[{view:"layout",borderless:!0,margin:0,cols:[{view:"sidebar",data:[{id:t.tabBasic,value:i("Basic")},{id:t.tabFields,value:i("Fields")}],width:120,select:!0,scroll:!1,on:{onAfterSelect:function(t){e.Webix.$$(t).show()}},ready:function(){this.select(this.getFirstId())}},{view:"multiview",animate:!1,cells:[{id:t.tabBasic,view:"layout",padding:10,rows:[{id:t.dataKey,view:"text",label:i("Data Key"),placeholder:"data.example",bottomLabel:i("* JSON key containing the relevant data from the resonse object. Can be left blank to use the root level data."),suggest:[],on:{onChange:()=>{this._guessFields()}}},{fillspace:!0}]},{id:t.tabFields,view:"layout",padding:10,rows:[{cols:[{label:i("Fields"),view:"label"},{icon:"wxi-plus",view:"icon",width:38,click:()=>{this._addFieldItem()}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:t.fields,view:"layout",padding:0,margin:0,rows:[]}}]}]}]}]}}}init(e,t){const i=this.ids,n=$$(i.responseForm);e.Webix.extend(n,webix.ProgressBar),this._data=t}getValues(){const e=this.ids,t={dataKey:$$(e.dataKey).getValue()},i=$$(e.fields);return t.fields=[],i?.getChildViews().forEach((e=>{const i=e.getChildViews()[0],n=e.getChildViews()[1];t.fields.push({columnName:i.getValue(),type:n.getValue()})})),t.fields=t.fields.filter((e=>null!=e.columnName&&null!=e.type)),t}validate(){return $$(this.ids.responseForm).validate()}formClear(){const e=this.ids,t=$$(e.responseForm);t.clearValidation(),t.clear(),this._clearDataKeys(),this._clearFieldItems()}busy(){$$(this.ids.responseForm).showProgress({type:"icon"})}ready(){$$(this.ids.responseForm).hideProgress()}async refreshResponse(t){if(!t?.url||this._data?.returnData)return;this.busy();const i=e.objectNew({id:e.uuid(),isAPI:!0,request:t}).model(),n=await i.findAll();this._data.returnData=n?.data,this._populateDataKeys(),this._guessFields(),this.ready()}_fieldItem(e,t){const i=this,n=this.AB.Class.ABFieldManager.allFields();return{cols:[{placeholder:"key",view:"text",value:e},{placeholder:"Type",options:["string","LongText","number","date","boolean"].map((e=>({id:e,value:n.filter((t=>t.defaults().key==e))[0]?.defaults().menuName}))),view:"select",value:t},{icon:"wxi-trash",view:"icon",width:38,click:function(){const e=this.getParentView();$$(i.ids.fields).removeView(e)}}]}}_addFieldItem(e,t){const i=this._fieldItem(e,t);$$(this.ids.fields).addView(i)}_clearFieldItems(){const t=$$(this.ids.fields);e.Webix.ui([],t)}_populateDataKeys(){if(this._clearDataKeys(),!this._data?.returnData)return;const e=$$(this.ids.dataKey),t=$$(e.config.suggest).getList(),i=[],n=(e,t)=>{let a=e;Array.isArray(e)&&e[0]&&(a=e[0]),Object.keys(a??{}).forEach((e=>{const o=t.length?`${t}.${e}`:e;Array.isArray(a[e])?i.push(o):"object"==typeof a[e]&&n(a[e],o)}))};n(this._data?.returnData,""),t.parse(i)}_clearDataKeys(){const e=$$(this.ids.dataKey),t=$$(e.config.suggest).getList();e.setValue(""),t.clearAll()}_guessFields(){if(this._clearFieldItems(),!this._data?.returnData)return;const t=this.getValues();let i=e.objectNew(Object.assign({isAPI:!0},{response:t})).dataFromKey(this._data?.returnData);if(null!=i){for(;i&&Array.isArray(i);)i=i[0];Object.keys(i).forEach((e=>{if("object"==typeof i[e]||Array.isArray(i[e]))return;const t=h().getFieldType(i[e]);this._addFieldItem(e,t)}))}}}}(e);return new class extends t{constructor(){super("ui_work_object_list_newObject_api_read",{})}ui(){const e=a.ui();return{view:"accordion",type:"clean",multi:!1,on:{onAfterExpand:t=>{if(e.id==t){const e=i.getValues();a.refreshResponse(e)}}},rows:[i.ui(),e]}}init(e){this._shareData={},i.init(e,this._shareData),a.init(e,this._shareData)}getValues(){return{request:i.getValues(),response:a.getValues()}}validate(){return i.validate()&&a.validate()}formClear(){i.formClear(),a.formClear()}busy(){i.busy(),a.busy()}ready(){i.ready(),a.ready()}}}(e)}ui(){return{id:this.ids.component,header:i("API"),body:{view:"form",id:this.ids.form,width:800,height:500,rules:{},elements:[{rows:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:70},{view:"checkbox",label:i("Read Only"),name:"readonly",value:1,disabled:!0}]},{view:"tabview",name:"apiType",tabbar:{options:[{value:"Create",disabled:!0},"Read",{value:"Update",disabled:!0},{value:"Delete",disabled:!0}],value:"Read",height:40},cells:[this.API_Read.ui()]},{cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Save"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),e.Webix.extend(this.$form,webix.ProgressBar),this.API_Read.init(e),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(async e=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear(),this.API_Read.formClear()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}async save(){this.busy();const t=this.$form;if(t.clearValidation(),!t.validate()||!this.API_Read.validate())return this.ready(),!1;let i=t.getValues();const n=this.API_Read.getValues();n.secrets=n?.request?.secrets??[],delete n?.request?.secrets,i=Object.assign(i,n);const a=e.objectNew(Object.assign({isAPI:!0},i));try{i.fieldIDs=[];for(const t of i.response?.fields??[]){const n=e.fieldNew({name:t.columnName,label:t.columnName,columnName:t.columnName,key:t.type},a);await n.save(!0),i.fieldIDs.push(n.id)}i.id=a.id,this.emit("save",a.toObj()),this.ready()}catch(e){console.error(e)}}show(){$$(this.ids.component)?.show()}busy(){const e=$$(this.ids.form),t=$$(this.ids.buttonSave);e.showProgress({type:"icon"}),t.disable()}ready(){const e=$$(this.ids.form),t=$$(this.ids.buttonSave);e.hideProgress(),t.enable()}}}(e),this.ImportTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_import",{form:"",filter:"",objectList:"",columnList:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Existing"),body:{view:"form",id:this.ids.form,width:400,elements:[{cols:[{view:"icon",icon:"fa fa-filter",align:"left"},{view:"text",id:this.ids.filter,on:{onTimedKeyPress:()=>this.filter()}}]},{view:"list",id:this.ids.objectList,select:!0,height:200,minHeight:250,maxHeight:250,data:[],template:"<div>#label#</div>",on:{onSelectChange:()=>this.objectSelect()}},{view:"label",label:`<b>${i("Columns")}</b>`,height:20},{view:"list",id:this.ids.columnList,datatype:"json",multiselect:!1,select:!1,height:200,minHeight:200,maxHeight:200,type:{height:40,isvisible:{view:"checkbox",width:30}},template:e=>`\n                               <span style="float: left;"><i class="fa fa-${e.icon}"></i></span>\n                               <span style="float: left;">&nbsp;${e.label}</span>\n                           `},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>this.cancel()},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Import"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$filter=$$(this.ids.filter),this.$objectList=$$(this.ids.objectList),this.$columnList=$$(this.ids.columnList),this.$buttonSave=$$(this.ids.buttonSave),this.$buttonCancel=$$(this.ids.buttonCancel),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}onShow(){this.formClear();let t=this.CurrentApplication.objectsExcluded((t=>!t.isSystemObject||e.Account.isSystemDesigner()));this.$objectList.parse(t,"json")}filter(){let e=this.$filter.getValue();this.$objectList.filter("#label#",e)}objectSelect(){this.$columnList.clearAll();let e=this.$objectList.getSelectedItem(!1);if(e){let t=[];e.fields().forEach((e=>{t.push({id:e.id,label:e.label,isvisible:!0,icon:e.icon})})),0==t.length&&t.push({id:"none",label:i("No Fields Defined"),isvisible:!0}),this.$columnList.parse(t)}}async save(){var e=this.$objectList.getSelectedItem();if(!e)return!1;this.$buttonSave.disable(),await this.CurrentApplication.objectInsert(e),this.emit("imported",e),this.$buttonSave.enable()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear(),this.$objectList.clearAll(),this.$columnList.clearAll()}onError(e){if(e){var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.$buttonSave.enable()}}}(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new object"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},selectNewObject:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui(),this.CsvTab.ui(),this.ApiTab.ui(),this.ImportTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((e=>{var i=e.getAttribute("button_id");t.CYPRESS_REF(e,`${i}_tab`)}))}}}},on:{onBeforeShow:()=>{var e=$$(this.ids.tab).getValue();this.switchTab(e)}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);var t=[];return["BlankTab","CsvTab","ApiTab","ImportTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{this.save(e,i)}))})),this.ImportTab.on("imported",(e=>{this.done(e)})),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.BlankTab.applicationLoad(e),this.CsvTab.applicationLoad(e),this.ApiTab.applicationLoad(e),this.ImportTab.applicationLoad(e)}hide(){this.$component?.hide()}busy(){this.$component?.showProgress?.()}ready(){this.$component?.hideProgress?.()}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}async save(e,t){if(!this.CurrentApplicationID)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;var n=this.AB.objectNew(e),a=n.isValid();if(a.fail())return this[t].emit("save.error",a),!1;n.createdInAppID||(n.createdInAppID=this.CurrentApplicationID),this.busy();var o=this.CurrentApplication;try{var s=await n.save();await o.objectInsert(s),this[t].emit("save.successful",s),this.done(s)}catch(e){this.ready(),await o.objectRemove(n),this[t].emit("save.error",e)}}show(e){null!=e&&(this.selectNew=e),this.$component&&this.$component.show()}switchTab(e){switch(e){case this.BlankTab?.ids.form:this.BlankTab?.onShow?.(this.CurrentApplicationID);break;case this.CsvTab?.ids.form:this.CsvTab?.onShow?.(this.CurrentApplicationID);break;case this.ApiTab?.ids.form:this.ApiTab?.onShow?.(this.CurrentApplicationID);break;case this.ImportTab?.ids.form:this.ImportTab?.onShow?.(this.CurrentApplicationID);break;case this.ExternalTab?.ids.form:this.ExternalTab?.onShow?.(this.CurrentApplicationID)}}}}function m(e,t){t=t||"ui_work_object_workspace_popupIndex";const i=(0,n.Z)(e);var a=i.L();const o=e.Class.ABIndex;return new class extends i{constructor(e){super(e,{popup:"",form:"",name:"",fields:"",unique:"",removeButton:"",saveButton:""})}ui(){let e=this.ids;return{view:"window",id:e.popup,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:a("Custom Index"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.close()},on:{onAfterRender(){i.CYPRESS_REF(this)}}}]},position:"center",resize:!0,modal:!0,editable:!1,width:500,height:500,body:{view:"form",id:e.form,elements:[{id:e.name,view:"text",label:a("Name"),name:"name"},{id:e.fields,view:"multicombo",label:a("Fields"),name:"fieldIDs",options:[]},{id:e.unique,view:"checkbox",label:a("Unique"),name:"unique"},{cols:[{id:e.removeButton,view:"button",type:"icon",icon:"fa fa-trash-o",css:"webix_danger",width:40,click:()=>this.removeIndex()},{fillspace:!0},{view:"button",value:a("Cancel"),width:100,click:()=>this.close()},{id:e.saveButton,view:"button",type:"icon",icon:"fa fa-floppy-o",css:"webix_primary",label:a("Save"),width:100,click:()=>this.save()}]}]}}}init(e){this.AB=e,webix.ui(this.ui());let t=$$(this.ids.form);t&&webix.extend(t,webix.ProgressBar)}open(e,t){this.CurrentObjectID=e.id,this.CurrentIndex=t;let i=this.ids,n=$$(i.popup);if(!n)return;n.show();let a=$$(i.fields);if(a&&this.CurrentObject){var o=["number","date","datetime","boolean","list","email","user","AutoIndex","combined"];let e=this.CurrentObject.fields((e=>o.indexOf(e.key)>-1||("string"==e.key||"LongText"==e.key)&&e.settings&&!e.settings.supportMultilingual||"connectObject"==e.key&&("one"==e.settings.linkType&&"many"==e.settings.linkViaType||"one"==e.settings.linkType&&"one"==e.settings.linkViaType&&e.settings.isSource))).map((e=>({id:e.id,value:e.label})));a.define("options",e),a.refresh()}let s=$$(this.ids.form);s&&(s.clear(),t&&s.setValues(t.toObj()));let r=$$(i.name),l=$$(i.unique),c=$$(i.saveButton),d=$$(i.removeButton);this.CurrentIndex?(r.disable(),a.disable(),l.disable(),c.hide(),d.show()):(r.enable(),a.enable(),l.enable(),c.show(),d.hide())}async save(){let e=$$(this.ids.form);if(!e)return;this.busy();let t=e.getValues();t.fieldIDs=t.fieldIDs.split(","),null==this.CurrentIndex&&(this.CurrentIndex=new o(t,this.CurrentObject)),this.CurrentIndex.fromValues(t);try{await this.CurrentIndex.save(),this.ready(),this.emit("changed"),this.close()}catch(e){let i=a("The system could not create your index.");"ER_DUP_ENTRY"===e.code&&(i=`${i} : ${a("There are duplicated values in this column.")}`),this.AB.notify.developer(e,{context:`${this.ids.component}:save()`,message:i,vals:t}),webix.alert({type:"alert-error",title:a("Failed"),text:i}),this.ready()}}close(){let e=$$(this.ids.popup);e&&e.hide()}busy(){$$(this.ids.form)?.showProgress?.({type:"icon"}),$$(this.ids.saveButton)?.disable(),$$(this.ids.removeButton)?.disable()}ready(){$$(this.ids.form)?.hideProgress?.(),$$(this.ids.saveButton)?.enable(),$$(this.ids.removeButton)?.enable()}removeIndex(){this.CurrentIndex&&webix.confirm({title:a("Delete this Index"),message:a("Do you want to remove this index ?"),callback:async e=>{if(e){this.busy();try{await this.CurrentIndex.destroy(),this.ready(),this.emit("changed"),this.close()}catch(e){this.AB.notify.developer(e,{context:`${this.ids.component}:removeIndex()`,ABIndex:this.CurrentIndex.toObj()}),this.ready()}}}})}}(t)}function f(e,t){t=t||"ui_work_object_workspace_popupDefineLabel";const i=(0,n.Z)(e);var a=i.L();return new class extends i{constructor(e){super(e,{format:"",list:"",buttonSave:""})}ui(){let e=this.ids;return{view:"popup",id:e.component,modal:!0,autoheight:!0,width:500,body:{rows:[{view:"label",label:a("<b>Label format</b>")},{view:"textarea",id:e.format,height:100},{view:"label",label:a("Select field item to generate format.")},{view:"label",label:a("<b>Fields</b>")},{view:"list",name:"columnList",id:e.list,width:500,height:180,maxHeight:180,select:!1,template:"#label#",on:{onItemClick:(e,t,i)=>{this.onItemClick(e,t,i)}}},{height:10},{cols:[{fillspace:!0},{view:"button",name:"cancel",value:a("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",id:e.buttonSave,label:a("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}}]}]},on:{onShow:()=>{this.onShow()}}}}init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.list),webix.ProgressBar)}changed(){this.emit("changed",this._settings)}buttonCancel(){$$(this.ids.component).hide()}async buttonSave(){var e=this.ids,t=$$(e.buttonSave);t.disable();var i=$$(e.format).getValue(),n=$$(e.list);n.showProgress({type:"icon"}),n.data.each((function(e){i=i.replace(new RegExp("{"+e.label+"}","g"),"{"+e.id+"}")})),this.CurrentObject.labelFormat=i;try{await this.CurrentObject.save(),this.hide(),this.changed()}catch(e){this.AB.notify.developer(e,{context:"ui_work_object_workspace_popupDefineLabel:buttonSave(): Error trying to save our Object"})}n.hideProgress(),t.enable()}hide(){$$(this.ids.component).hide()}objectLoad(e){super.objectLoad(e);var t=$$(this.ids.list);t.clearAll();var i=e.fields((e=>e.fieldUseAsLabel())).map((e=>({id:e.id,label:e.label})));t.parse(i),t.refresh()}onItemClick(e){var t=this.ids,i=$$(t.list).getItem(e),n=$$(t.format).getValue();n+=`{${i.label}}`,$$(t.format).setValue(n)}onShow(){var e=this.ids,t=this.CurrentObject.labelFormat,i=$$(e.format),n=$$(e.list);if(i.setValue(""),i.enable(),n.enable(),$$(e.buttonSave).enable(),t)n.data?.count()>0&&n.data.each((function(e){t=t.replace(new RegExp(`{${e.id}}`,"g"),`{${e.label}}`)}));else if(n.data?.count()>0){var a=n.getItem(n.getFirstId());t=`{${a.label}}`}i.setValue(t||"")}show(e){$$(this.ids.component).show(e)}}(t)}function g(e,t){t=t||"ui_work_object_workspace_popupExport";const i=(0,n.Z)(e);return new class extends i{constructor(e){super(e,{popupExport:"",list:""}),this.DatacollectionID=null,this.grid=null,this.filename=null,this.hiddenFields=[]}ui(){var e=this;return{view:"popup",id:this.ids.popupExport,width:160,height:180,select:!1,hidden:!0,body:{id:this.ids.list,view:"list",data:[{name:"CSV",icon:"file-excel-o"},{name:"Excel",icon:"file-excel-o"},{name:"PDF",icon:"file-pdf-o"},{name:"PNG",icon:"file-image-o"}],template:"<div><i class='fa fa-#icon# webix_icon_btn' aria-hidden='true'></i> #name#</div>",on:{onItemClick:function(t){var i=this.getItem(t);e.export(i.name)}}}}}init(e){this.AB=e,webix.ui(this.ui())}get Datacollection(){return this.AB.datacollectionByID(this.DatacollectionID)}dataCollectionLoad(e){this.DatacollectionID=e.id}setHiddenFields(e){this.hiddenFields=e||[]}setFilename(e){this.filename=e}setGridComponent(e){this.grid=e}show(e){$$(this.ids.popupExport).show(e)}async export(e){let t,i={},n=this.Datacollection;!n||n.settings.loadAll&&n.dataStatus!=n.dataStatusFlag.notInitial||(await n.reloadData(0,null),n.settings.loadAll=!0);var a=this.CurrentObject;a&&a.fields().forEach((e=>{this.hiddenFields.indexOf(e.columnName)>-1||(i[e.columnName]={template:t=>e.format(t)})}));var o=this.grid;if(o){var s=this.filename,r=a?a.label:null;switch(e){case"CSV":webix.csv.delimiter.cols=",",t=webix.toCSV(o,{_filename:this.filename||r,columns:i});break;case"Excel":t=webix.toExcel(o,{filename:s||r,name:s||r,columns:i,filterHTML:!0});break;case"PDF":t=webix.toPDF(o,{filename:s||r,filterHTML:!0});break;case"PNG":t=webix.toPNG(o,{filename:s||r})}try{await t,$$(this.ids.popupExport).hide()}catch(t){this.AB.notify.developer(t,{message:`${this.ids.component}:export(): could not export: ${e}`})}}}}(t)}var v=i(5997),b=i(6038),y=i(231);function w(e,t){t=t||"ui_work_object_workspace_popupImport";const i=(0,n.Z)(e),a=new((0,y.default)(e));return new class extends i{constructor(e){super(e),this.popup=null}ui(){return{}}init(e){this.AB=e;var i=a.toSettings(),n=this.AB.viewNewDetatched(i);this.popup=n.component(t),this.popup.init(e),this.popup.objectLoad(this.CurrentObject)}objectLoad(e){super.objectLoad(e),this.popup?.objectLoad(e)}show(){this.popup.showPopup()}hide(){this.popup.hide()}}(t)}var x=i(2439),$=i(423),_=i(4550),C={name:"Default Grid",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};function E(e,t){const i=(0,n.Z)(e);return i.L(),new class extends i{constructor(e){super(e)}type(){return"grid"}icon(){return"fa fa-table"}fromSettings(e){for(var t in C)this[t]=e[t]||C[t];this.type=this.type(),this.key=this.type()}toSettings(){var e={};for(var t in C)e[t]=this[t]||C[t];return e.key=this.type(),e.type=this.type(),e}}(t)}var S=i(5609);function k(e,t){t=t||"ui_work_object_workspace_popupHideFields";const i=(0,n.Z)(e);return new class extends i{constructor(t){super(t,{}),this.AB=e,this.base=t,this.rowFilter=this.AB.filterComplexNew(`${this.ids.component}_filter`),this.rowFilter.on("save",((...e)=>{this.emit("save",...e),this.hide()}))}objectLoad(e){super.objectLoad(e),this.rowFilter&&this.rowFilter.fieldsLoad(e.fields(),e)}viewLoad(e){this.view=e}ui(){return{view:"popup",id:this.ids.component,autoheight:!0,minHeight:350,minWidth:400,body:this.rowFilter.ui,on:{onHide:()=>{this.hide()}}}}init(e){this.AB=e,webix.ui(this.ui()),this.$Component=$$(this.ids.component),this.$List=$$(this.ids.list)}show(e,t=null){this.$Component.isVisible()||(null!=t?this.$Component?.show(e,t):this.$Component?.show(e))}hide(e,t=null){null!=t?this.$Component.hide(e,t):this.$Component.hide(e)}setFilter(e){e.rules?.length||(e=e[0]||[]),this.rowFilter.setValue(e)}}(t)}function A(e,t,i){t=t||"ui_work_object_workspace_view_grid";const a=(0,n.Z)(e);var o=a.L();const s=E(e);return new class extends a{constructor(e,t={}){super(e),t.isReadOnly=t.isReadOnly??!1,this.settings=t}ui(){return{id:this.ids.component,rows:[{},{view:"label",label:"Impressive View -> Grid"},{}]}}async init(e){this.AB=e}defaultSettings(t){var i=s.toSettings();i.label=o(i.name);var n=this.AB.viewNewDetatched(i).toObj();return n.id=t?.id??e.jobID(),["isEditable","massUpdate","allowDelete","trackView"].forEach((e=>{n.settings[e]=1})),n.settings.padding=0,n.settings.showToolbar=0,n.settings.gridFilter={filterOption:0,isGlobalToolbar:0},{id:n.id,isDefaultView:!1,type:n.type,icon:n.icon,name:"Default Grid",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[],component:n}}getColumnIndex(e){return this._currentComponent.getColumnIndex(e)}datacollectionLoad(e){this.datacollection=e}get $grid(){return this._currentComponent?.getDataTable()}ready(){this.ListComponent.ready()}async show(e){await this.viewLoad(e),$$(this.ids.component).show(),this.emit("show")}async viewLoad(e){if(e.id==this.currentViewDef?.id)return;this.currentViewDef=e,this.currentView=this.AB.viewNewDetatched(e.component),this.currentView.warningsSilent=!0;var t=this.currentView.component();t.datacollectionLoad(this.datacollection);var i=t.ui();i.id=this.ids.component,webix.ui(i,$$(this.ids.component));let n=2;(this.settings.isReadOnly||this.datacollection?.datasource?.isReadOnly)&&(n=1),await t.init(this.AB,n),t.datacollectionLoad(this.datacollection),t.on("column.header.clicked",((e,t)=>{this.emit("column.header.clicked",e,t)})),t.on("object.track",((e,t)=>{this.emit("object.track",e,t)})),t.on("selection",(()=>{this.emit("selection")})),t.on("selection.cleared",(()=>{this.emit("selection.cleared")})),t.on("column.order",(e=>{this.emit("column.order",e)})),this._currentComponent=t}viewNew(e){var t=this.defaultSettings(e);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t}deleteSelected(e){return this._currentComponent.toolbarDeleteSelected(e)}massUpdate(e){return this._currentComponent.toolbarMassUpdate(e)}refreshHeader(e=[],t,i,n){var a=this.CurrentObject.columnHeaders(!0,!0,[],[],[]);this._currentComponent&&(this._currentComponent.columnConfig(a),this._currentComponent.settings.hiddenFields=e,this._currentComponent.settings.filterConditions=t,this._currentComponent.settings.sortFields=i,this._currentComponent.settings.frozenColumnID=n,this._currentComponent.refreshHeader(!0))}}(t,i)}function D(e,t){t=t||"ui_work_object_workspace_view_gantt";const i=(0,n.Z)(e),a=(i.L(),(0,_.Z)(e));return new class extends i{constructor(e){super(e)}ui(){return{id:this.ids.component,rows:[{},{view:"label",label:"Impressive View -> Gantt"},{}]}}async init(e){this.AB=e}defaultSettings(t){const i=a.toSettings();i.settings=Object.assign(i.settings,t.settings??{});const n=this.AB.viewNewDetatched(i).toObj();return n.id=t.id??e.jobID(),{id:n.id,isDefaultView:!1,type:n.type,icon:n.icon,name:"Default Gantt",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[],component:n}}datacollectionLoad(e){this.datacollection=e}async show(e){await this.viewLoad(e),$$(this.ids.component).show(),this.emit("show")}async viewLoad(e){if(e.id==this.currentViewDef?.id)return;this.currentViewDef=e,this._currentComponent?.eventsClear(),this.currentView=this.AB.viewNewDetatched(e.component),this.currentView.warningsSilent=!0;const t=this.currentView.component(),i=t.ui();i.id=this.ids.component,webix.ui(i,$$(this.ids.component)),await t.init(this.AB),t.datacollectionLoad(this.datacollection),t.show(),this._currentComponent=t}viewNew(e){return Object.assign(this.defaultSettings(e),e)}}(t)}function R(e,t){t=t||"ui_work_object_workspace_view_kanban";const i=(0,n.Z)(e);var a=i.L();const o=(0,S.Z)(e,`${t}_prop`);return new class extends i{constructor(e){super(e)}ui(){return{id:this.ids.component,rows:[{},{view:"label",label:"Impressive View -> Kanban"},{}]}}async init(e){this.AB=e}defaultSettings(t){var i=o.toSettings();Object.keys(i.settings).forEach((e=>{i.settings[e]=t.settings[e]})),i.label=a(i.name);var n=this.AB.viewNewDetatched({key:"text"}),s=this.CurrentObject,r=s.labelFormat;!r&&s.fields().length>0&&s.fields((e=>e.fieldUseAsLabel())).forEach((e=>{r=`${r}<br>${e.label}: {${n.fieldKey(e)}}`})),i.settings.textTemplate=r,i.settings.editFields=s.fields().map((e=>e.id));var l=this.AB.viewNewDetatched(i).toObj();return l.id=t.id??e.jobID(),{id:l.id,isDefaultView:!1,type:l.type,icon:l.icon,name:"Default Kanban",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[],component:l}}datacollectionLoad(e){this.datacollection=e}async show(e){await this.viewLoad(e),$$(this.ids.component).show(),this.emit("show")}async viewLoad(e){if(e.id!=this.currentViewDef?.id){this.currentViewDef=e,this.currentView=this.AB.viewNewDetatched(e.component),this.currentView.warningsSilent=!0;var t=this.currentView.component(),i=t.ui();i.id=this.ids.component,webix.ui(i,$$(this.ids.component)),await t.init(this.AB),t.datacollectionLoad(this.datacollection),t.show(),this._currentComponent=t}}viewNew(e){var t=this.defaultSettings(e);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t}}(t)}function P(e,t,i){t=t||"ui_work_object_workspace_workspaceviews";const a=(0,n.Z)(e),o=A(e,`${t}_grid`,i),s=D(e),r=R(e),l=(0,_.Z)(e),c=E(e),d=(0,S.Z)(e);var u={};u[l.type()]=l,u[c.type()]=c,u[d.type()]=d;var h={};h[l.type()]=s,h[c.type()]=o,h[d.type()]=r;const p={currentViewID:void 0,list:[]};return new class extends a{constructor(t,i){super(t),this.AB=e,this._settings=null}async init(e){this.AB=e,Object.keys(h).forEach((t=>{h[t].init(e)})),this._settings=await this.AB.Storage.get("workspaceviews")||{}}objectLoad(e){this.CurrentObjectID&&(this._settings[this.CurrentObjectID]=this.toObj()),super.objectLoad(e),Object.keys(h).forEach((t=>{h[t].objectLoad(e)})),this.fromObj(this._settings[this.CurrentObjectID])}fromObj(t){if(0===((t=t||e.cloneDeep(p))?.list??[]).length){var i=o.defaultSettings();i.isDefaultView=!0,t.list.unshift(i)}this.importViews(t),this.currentViewID=t.currentViewID,this.currentViewID||(this.currentViewID=this.list()[0].id)}clearObjectCache(e){delete this._settings?.[e]}toObj(){return{currentViewID:this.currentViewID,list:this._views}}list(e=(()=>!0)){return this._views.filter(e)}importViews(e){this._views=[],e.list.forEach((e=>{this.viewAdd(e,!1)}))}getCurrentView(){return this._views.find((e=>e.id==this.currentViewID))}setCurrentView(e){this.currentViewID=e,this._currentView=this.getCurrentView()}async viewAdd(e,t=!0){return this._views.push(e),t&&await this.save(),e}async viewNew(e){var t=h[e.type];if(t){var i=t.viewNew(e);return await this.viewAdd(i),i}}viewRemove(e){var t=this._views.indexOf(e);this._views.splice(t,1),e.id===this.currentViewID&&(this.currentViewID=this._views[0].id),this.save()}async save(){this._settings[this.CurrentObjectID]=this.toObj();try{await this.AB.Storage.set("workspaceviews",this._settings)}catch(e){console.error(e)}}async viewUpdate(e){var t=h[e.type];if(t){delete e.component;var i=t.viewNew(e),n=[];this._views.forEach((e=>{e.id==i.id?n.push(i):n.push(e)})),this._views=n,await this.save()}}get filterConditions(){return this._currentView.filterConditions}set filterConditions(e){this._currentView.filterConditions=e}get frozenColumnID(){return this._currentView.frozenColumnID}set frozenColumnID(e){this._currentView.frozenColumnID=e}get hiddenFields(){return this._currentView.hiddenFields||[]}set hiddenFields(e){this._currentView.hiddenFields=e}get sortFields(){return this._currentView.sortFields}set sortFields(e=[]){this._currentView.sortFields=e}}(t,i)}function L(e,t,i){t=t||"abd_work_object_workspace";const a=e.Config.uiSettings(),r=(0,n.Z)(e);var l=r.L(),c=A(e,`${t}_view_grid`,i),d=D(e,`${t}_view_gantt`),u=R(e,`${t}_view_kanban`),h=s(e,`${t}_view_warnings`,i),p=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){var e="ui_work_object_workspace_track";super({popup:`${e}_popup`,timeline:`${e}_timeline`})}ui(){let e=this.ids;return{view:"window",id:e.popup,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Record History"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",align:"right",click:()=>{this.close()},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},position:"center",resize:!0,modal:!0,editable:!1,width:500,height:500,body:{view:"timeline",id:e.timeline,type:{height:140,templateDate:e=>this.AB.rules.toDateFormat(e.timestamp,{localeCode:"en",format:"DD MMM, YYYY hh:mma"}),lineColor:e=>{switch(e.level){case"insert":return"#FF5C4C";case"update":return"#1CA1C1";case"delete":return"#94A1B3"}}},scheme:{$init:e=>{switch(e.level){case"insert":e.value=i("Add");break;case"update":e.value=i("Edit");break;case"delete":e.value=i("Delete")}if(e.details=`by <b>${e.username||i("Unknown")}</b>`,e.record){let t="";Object.keys(e.record).forEach((i=>{t=t.concat(`${i}: <b>${null!=e.record[i]?e.record[i]:""}</b> <br />`)})),e.details=e.details.concat("<br />"),e.details=e.details.concat(`<div>${t}</div>`)}}}}}}init(e){this.AB=e,webix.ui(this.ui());let t=$$(this.ids.timeline);t&&webix.extend(t,webix.ProgressBar)}open(e,t){this.objectLoad(e);let i=this.ids,n=$$(i.popup);n&&(n.show(),this.loadData(t))}async loadData(e){if(!this.CurrentObject)return;let t=$$(this.ids.timeline);t.showProgress({type:"icon"});try{var n=this.CurrentObject.model().logs({rowId:e});t.clearAll(!0),t.parse(n)}catch(e){console.error(e),webix.alert({text:i("Unable to display logs for this entry.")})}t.hideProgress()}close(){let e=this.ids,t=$$(e.popup);t&&t.hide()}}}(e);return new class extends r{constructor(t,i={}){super(t,{buttonAddField:"",buttonDeleteSelected:"",buttonDeleteSelectedSpacer:"",buttonExport:"",buttonImport:"",buttonFieldsVisible:"",buttonFieldsVisibleSpacer:"",buttonFilter:"",buttonFrozen:"",buttonFrozenSpacer:"",buttonLabel:"",buttonMassUpdate:"",buttonMassUpdateSpacer:"",buttonRowNew:"",buttonSort:"",buttonSortSpacer:"",layoutIndex:"",listIndex:"",buttonIndex:"",datatable:"",error:"",error_msg:"",viewMenu:"",viewMenuButton:"",viewMenuNewView:"",toolbar:"",noSelection:"",selectedObject:"",spaceAddField:"",spaceLabel:"",spaceImport:""}),i.showWarnings=i.showWarnings??!0,this.isReadOnly=i.isReadOnly??!1,this.settings=i,this.workspaceViews=P(e,`${t}_views`,{isReadOnly:this.isReadOnly}),this.hashViews={},this.hashViews.grid=c,c.on("column.header.clicked",((e,t)=>{this.PopupHeaderEditMenu.show(e,t)})),c.on("object.track",((e,t)=>{p.open(e,t)})),c.on("selection",(()=>{this.callbackCheckboxChecked("enable")})),c.on("selection.cleared",(()=>{this.callbackCheckboxChecked("disable")})),c.on("column.order",(e=>{var t=this.CurrentObject,i=[];e.forEach((e=>{i.push(t.fieldByID(e))})),t._fields=i,t.save()})),this.hashViews.gantt=d,this.hashViews.kanban=u,this.PopupCustomIndex=new m(e,`${t}_customIndex`),this.PopupCustomIndex.on("changed",(()=>{this.refreshIndexes()})),this.PopupHeaderEditMenu=function(e,t){t=t||"ui_work_object_workspace_popupHeaderEditMenu";var i=o(e),a=(0,n.Z)(e).L();return new class extends i{constructor(e){super(e),this._menuOptions=[{label:a("Hide field"),icon:"fa fa-eye-slash",command:"hide",imported:!0},{label:a("Filter field"),icon:"fa fa-filter",command:"filter",imported:!0},{label:a("Sort field"),icon:"fa fa-sort",command:"sort",imported:!0},{label:a("Freeze field"),icon:"fa fa-thumb-tack",command:"freeze",imported:!0},{label:a("Edit field"),icon:"fa fa-pencil-square-o",command:"edit",imported:!1},{label:a("Delete field"),icon:"fa fa-trash",command:"delete",imported:!1}],this.$node=null,this.field=null}show(e,t){this.$node=e,this.field=t,super.show(e)}trigger(e){this.emit("click",e,this.field,this.$node)}}(t)}(e,`${t}_headerEditMenu`),this.PopupHeaderEditMenu.on("click",((e,t,i)=>{this.callbackHeaderEditorMenu(e,t,i)})),this.isReadOnly||(this.PopupDefineLabelComponent=new f(e,`${t}_defineLabel`),this.PopupDefineLabelComponent.on("changed",(()=>{this.callbackDefineLabel()}))),this.PopupFilterDataTableComponent=new k(e,`${t}_popupFilter`),this.PopupFrozenColumnsComponent=new v.Z(e,`${t}_frozenFields`),this.PopupFrozenColumnsComponent.on("changed",(e=>{this.callbackFrozenColumns(e)})),this.PopupHideFieldComponent=(0,b.Z)(e,`${t}_hideFields`),this.PopupHideFieldComponent.on("changed",(e=>{this.callbackFieldsVisible(e)})),this.isReadOnly||(this.PopupNewDataFieldComponent=(0,x.Z)(e,`${t}_popupNewDataField`)),this.PopupSortFieldComponent=(0,$.Z)(e,`${t}_sortFields`),this.PopupSortFieldComponent.on("changed",(e=>{this.callbackSortFields(e)})),this.PopupExportObjectComponent=new g(e,`${t}_export`),this.PopupImportObjectComponent=new w(e,`${t}_import`),this.PopupViewSettingsComponent=function(e,t,i){t=t||"abd_work_object_workspace_popupAddView";const a=(0,n.Z)(e),o=a.L();return new class extends a{constructor(t,i={}){super(t,{form:"",formAdditional:"",nameInput:"",typeInput:"",cancelButton:"",cancelX:"",saveButton:""}),i.isReadOnly=i.isReadOnly??!1,this.settings=i,this.isReadOnly=i.isReadOnly,this._view=null,this.comGrid=E(e,`${t}_grid`),this.comKanban=(0,S.Z)(e,`${t}_kanban`),this.comKanban.on("new.field",(e=>{this._newFieldSource="comKanban",this.emit("new.field",e)})),this.comGantt=(0,_.Z)(e,`${t}_gantt`),this.comGantt.on("new.field",(e=>{this._newFieldSource="comGantt",this.emit("new.field",e)})),this.on("field.added",(e=>{this[this._newFieldSource]?.emit("field.added",e)}))}ui(){const e=this.ids,t={view:"form",id:e.form,visibleBatch:"global",rules:{hGroup:(e,{vGroup:t})=>!e||e!==t},elements:[{view:"text",label:o("Name"),id:e.nameInput,name:"name",placeholder:o("Create a name for the view"),required:!0,invalidMessage:o("this field is required"),on:{onChange:()=>{$$(e.nameInput).validate()},onAfterRender(){a.CYPRESS_REF(this)}}},{view:"richselect",label:o("Type"),id:e.typeInput,name:"type",hidden:this.isReadOnly,options:[{id:this.comGrid.type(),value:o("Grid")},{id:this.comKanban.type(),value:o("Kanban")},{id:this.comGantt.type(),value:o("Gantt")}],value:this.comGrid.type(),required:!0,on:{onChange:e=>{this.switchType(e)}}},{id:e.formAdditional,view:"layout",rows:[this.comKanban.ui(),this.comGantt.ui()]},{margin:5,cols:[{fillspace:!0},{id:e.buttonCancel,view:"button",value:o("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()},on:{onAfterRender(){a.CYPRESS_REF(this)}}},{id:e.buttonSave,view:"button",css:"webix_primary",value:o("Save"),autowidth:!0,type:"form",click:()=>{this.buttonSave()},on:{onAfterRender(){a.CYPRESS_REF(this)}}}]}]};return{view:"window",id:e.component,width:400,resize:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:o("View Settings"),css:"modal_title",align:"center"},{id:e.cancelX,view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.buttonCancel()},on:{onAfterRender(){a.CYPRESS_REF(this)}}}]},position:"center",body:t,modal:!0,on:{onShow:()=>{this.onShow()}}}}async init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}switchType(e){switch($$(this.ids.formAdditional).showBatch(e),e){case"kanban":this.comKanban.init(this.CurrentObject,this._view);break;case"gantt":this.comGantt.init(this.CurrentObject,this._view)}$$(this.ids.component).resize()}onShow(){const e=this.ids;$$(e.form).clear(),$$(e.form).clearValidation(),this._view?($$(e.nameInput).setValue(this._view.name),$$(e.typeInput).setValue(this._view.type)):($$(e.nameInput).setValue(""),$$(e.typeInput).setValue(this.comGrid.type()))}show(e){this._view=e,$$(this.ids.component).show()}hide(){$$(this.ids.component).hide()}buttonCancel(){this.hide()}buttonSave(){const e=this.ids,t=$$(e.form);if(!t.validate())return;const i={},n=$$(e.typeInput);switch(n.getValue()){case this.comKanban.type():if(this.comKanban.validate&&!this.comKanban?.validate(t))return;i.settings=this.comKanban.values();break;case this.comGantt.type():if(this.comGantt.validate&&!this.comGantt.validate(t))return;i.settings=this.comGantt.values()}i.name=$$(e.nameInput).getValue(),i.type=n.getValue(),this._view?(this._view=Object.assign(this._view,i),this.emit("updated",this._view)):this.emit("added",i),this.hide()}get isReadOnly(){return this._isReadOnly??!1}set isReadOnly(e){this._isReadOnly=e,this._isReadOnly?$$(this.ids.typeInput)?.hide():$$(this.ids.typeInput)?.show()}}(t,i)}(e,`${t}_popupAddView`,{isReadOnly:this.isReadOnly}),this.isReadOnly||this.PopupViewSettingsComponent.on("new.field",(e=>{this.PopupNewDataFieldComponent.objectLoad(this.CurrentObject),this.PopupNewDataFieldComponent.show(null,e,!1)})),this.mockDataCollection=null,this.CurrentObjectID=null}ui(){var e=this.ids,t="button",i=this,n={id:this.ids.viewMenuNewView,view:"button",type:"icon",autowidth:!0,css:"webix_transparent",label:l("New view"),icon:"fa fa-plus-circle",align:"center",click:()=>{this.PopupViewSettingsComponent.show()}},o={id:e.viewMenu,view:"menu",data:[],on:{onMenuItemClick:t=>{var i=$$(e.viewMenu).getMenuItem(t);if(t!==e.viewMenuButton)if(i.isView){let e=this.workspaceViews.list((e=>e.id===t))[0];this.switchWorkspaceView(e)}else if("edit"===i.action){let e=this.workspaceViews.list((e=>e.id===i.viewId))[0];this.PopupViewSettingsComponent.show(e)}else"delete"===i.action&&webix.confirm({title:l("Delete View?"),message:l("Are you sure you want to remove this view?"),callback:e=>{if(e){var t=this.workspaceViews.list((e=>e.id===i.viewId))[0];this.workspaceViews.viewRemove(t),this.switchWorkspaceView(this.workspaceViews.getCurrentView())}}})}},type:{subsign:!0}},s={view:"toolbar",id:e.toolbar,hidden:!0,css:"webix_dark",elementsConfig:{autowidth:!0,padding:0,margin:0},margin:0,padding:0,rows:[{cols:[{responsive:"hide"},{view:t,id:e.buttonAddField,label:l("Add field"),icon:"fa fa-plus",css:"webix_transparent",type:"icon",hidden:this.isReadOnly,click:function(){i.toolbarAddFields(this.$view)}},{id:e.spaceAddField,responsive:"hide",hidden:this.isReadOnly},{view:t,id:e.buttonFieldsVisible,label:l("Hide fields"),icon:"fa fa-eye-slash",css:"webix_transparent",type:"icon",badge:null,click:function(){i.toolbarFieldsVisible(this.$view)}},{responsive:"hide",id:e.buttonFieldsVisibleSpacer},{view:t,id:e.buttonFilter,label:l("Filters"),icon:"fa fa-filter",css:"webix_transparent",type:"icon",minWidth:70,autowidth:!0,badge:null,click:function(){i.toolbarFilter(this.$view)}},{responsive:"hide"},{view:t,id:e.buttonSort,label:l("Sort"),icon:"fa fa-sort",css:"webix_transparent",type:"icon",badge:null,click:function(){i.toolbarSort(this.$view)}},{responsive:"hide",id:e.buttonSortSpacer},{view:t,id:e.buttonFrozen,label:l("Freeze"),icon:"fa fa-thumb-tack",css:"webix_transparent",type:"icon",badge:null,click:function(){i.toolbarFrozen(this.$view)}},{responsive:"hide",id:e.buttonFrozenSpacer},{view:t,id:e.buttonLabel,label:l("Label"),icon:"fa fa-crosshairs",css:"webix_transparent",type:"icon",hidden:this.isReadOnly,click:function(){i.toolbarDefineLabel(this.$view)}},{id:e.spaceLabel,responsive:"hide",hidden:this.isReadOnly},{view:t,id:e.buttonImport,label:l("Import"),icon:"fa fa-upload",css:"webix_transparent",type:"icon",hidden:this.isReadOnly,click:function(){i.toolbarButtonImport()}},{id:e.spaceImport,responsive:"hide",hidden:this.isReadOnly},{view:t,id:e.buttonExport,label:l("Export"),icon:"fa fa-download",css:"webix_transparent",type:"icon",click:function(){i.toolbarButtonExport(this.$view)}},{responsive:"hide"},{view:t,id:e.buttonMassUpdate,label:l("Edit"),icon:"fa fa-pencil-square-o",css:"webix_transparent",type:"icon",badge:null,hidden:!0,click:function(){i.toolbarMassUpdate(this.$view)}},{responsive:"hide",hidden:!0,id:e.buttonMassUpdateSpacer},{view:t,id:e.buttonDeleteSelected,label:l("Delete"),icon:"fa fa-trash",css:"webix_transparent",type:"icon",badge:null,hidden:!0,click:function(){i.toolbarDeleteSelected(this.$view)}},{responsive:"hide",hidden:!0,id:e.buttonDeleteSelectedSpacer}]},{id:e.layoutIndex,css:{"background-color":"#747d84 !important"},hidden:this.isReadOnly,cols:[{view:t,id:e.buttonIndex,label:l("Add Index"),icon:"fa fa-plus-circle",css:"webix_transparent",type:"icon",click:()=>{this.PopupCustomIndex.open(this.CurrentObject)}},{id:e.listIndex,cols:[]},{responsive:"hide"}]}]};let r={view:"multiview",animate:!1,id:e.component,borderless:!0,rows:[{id:e.error,rows:[{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-exclamation-triangle'></div>"},{id:e.error_msg,view:"label",align:"center",label:l("There was an error")},{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile}]},{id:e.noSelection,rows:[{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-database'></div>"},{view:"label",align:"center",label:l("Select an object to work with.")},{cols:[{},{view:"button",label:l("Add new object"),type:"form",css:"webix_primary",autowidth:!0,click:()=>{this.emit("addNew",!0)}},{}]},{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile}]},{id:e.selectedObject,type:"wide",paddingY:0,rows:[{cols:[n,o]},s,{padding:0,rows:[{view:"multiview",animate:!1,cells:[c.ui(),u.ui(),d.ui()]},{view:"button",type:"form",id:e.buttonRowNew,css:"webix_primary",value:l("Add new row"),hidden:this.isReadOnly,click:()=>{this.rowAdd()}}]}]}]};return this.settings.showWarnings&&r.rows[2].rows[2].rows.push(h.ui()),r}init(e){this.AB=e;var t=[];return t.push(this.workspaceViews.init(e)),t.push(c.init(e)),t.push(d.init(e)),t.push(u.init(e)),t.push(p.init(e)),this.mockDataCollection=this.AB.datacollectionNew({}),this.mockDataCollection.init(),t.push(this.PopupCustomIndex.init(e)),c.datacollectionLoad(this.mockDataCollection),d.datacollectionLoad(this.mockDataCollection),u.datacollectionLoad(this.mockDataCollection),t.push(this.PopupHeaderEditMenu.init(e)),this.isReadOnly||t.push(this.PopupDefineLabelComponent.init(e)),t.push(this.PopupFilterDataTableComponent.init(e)),this.PopupFilterDataTableComponent.on("save",((...e)=>{this.callbackFilterDataTable(...e)})),t.push(this.PopupFrozenColumnsComponent.init(e)),t.push(this.PopupHideFieldComponent.init(e)),this.isReadOnly||(t.push(this.PopupNewDataFieldComponent.init(e)),this.PopupNewDataFieldComponent.on("save",((...e)=>{this.callbackAddFields(...e),this.PopupViewSettingsComponent.emit("field.added",e[0])}))),t.push(this.PopupSortFieldComponent.init(e)),t.push(this.PopupImportObjectComponent.init(e)),t.push(this.PopupExportObjectComponent.init(e)),t.push(this.PopupViewSettingsComponent.init(e)),this.PopupViewSettingsComponent.on("added",(e=>{this.callbackViewAdded(e)})),this.PopupViewSettingsComponent.on("updated",(e=>{this.callbackViewUpdated(e)})),$$(this.ids.noSelection).show(),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.isReadOnly||this.PopupNewDataFieldComponent.applicationLoad(e)}callbackAddFields(){this.refreshView(),this.loadData()}async callbackFilterDataTable(e){this.mockDataCollection.filterCondition(e),this.updateFilterButton(e),this.workspaceViews.getCurrentView().filterConditions=e;try{await this.workspaceViews.save()}catch(e){console.error(e)}this.mockDataCollection.reloadData(),this.refreshView()}async updateFilterButton(e){var t=this.ids,i=$$(t.buttonFilter);if(i){var n=null;e?.rules?.length&&(n=1),i.define("badge",n),i.refresh()}}async callbackFrozenColumns(e){var t=this.workspaceViews.getCurrentView();t.frozenColumnID=e;try{await this.workspaceViews.save()}catch(e){}this.getBadgeFrozenColumn(),this.PopupHideFieldComponent.setFrozenColumnID(t.frozenColumnID),this.refreshView()}async callbackFieldsVisible(e){this.workspaceViews.getCurrentView().hiddenFields=e;try{await this.workspaceViews.save()}catch(e){}this.getBadgeHiddenFields(),this.PopupFrozenColumnsComponent.setHiddenFields(e),this.refreshView(),this.getBadgeFrozenColumn()}callbackCheckboxChecked(e){"enable"==e?this.enableUpdateDelete():this.disableUpdateDelete()}refreshView(){this.warningsRefresh(this.CurrentObject);var e=this.workspaceViews.getCurrentView();switch(e.type){case"gantt":d.show(e);break;case"grid":c.refreshHeader(e.hiddenFields,e.filterConditions,e.sortFields,e.frozenColumnID);break;case"kanban":u.show(e)}this.settings.showWarnings&&h.show(this.CurrentObject)}async callbackHeaderEditorMenu(e,t){var i=this.workspaceViews.getCurrentView();switch(e){case"hide":var n=[];i.hiddenFields.filter((e=>e==t.columnName)).length>0?n=i.hiddenFields.filter((e=>e!=t.columnName)):(n=i.hiddenFields).push(t.columnName),i.hiddenFields=n;try{await this.workspaceViews.save()}catch(e){}this.PopupHideFieldComponent.setSettings(i.hiddenFields),this.PopupFrozenColumnsComponent.setHiddenFields(i.hiddenFields),this.refreshView(),this.getBadgeHiddenFields(),this.getBadgeFrozenColumn();break;case"filter":this.toolbarFilter($$(this.ids.buttonFilter).$view,t.id);break;case"sort":this.toolbarSort($$(this.ids.buttonSort).$view,t.id);break;case"freeze":i.frozenColumnID=t.columnName;try{await this.workspaceViews.save()}catch(e){}this.PopupFrozenColumnsComponent.setValue(i.frozenColumnID||""),this.PopupHideFieldComponent.setFrozenColumnID(i.frozenColumnID||""),this.refreshView(),this.getBadgeFrozenColumn();break;case"edit":this.isReadOnly||this.PopupNewDataFieldComponent.show(t);break;case"delete":webix.confirm({title:l("Delete data field"),message:l("Do you want to delete <b>{0}</b>?",[t.label]),callback:e=>{e&&(this.busy(),t.destroy().then((()=>{this.ready(),this.refreshView(),this.loadData(),function e(i,n){0==i.length?n():i.shift().removeField(t,(t=>{t?n(t):e(i,n)}))}(this.CurrentApplication.pages(),(()=>{}))})).catch((e=>{this.ready(),e&&e.message&&webix.alert({type:"alert-error",title:l("Could not delete"),text:e.message}),this.AB.notify.developer(e,{context:"Error trying to delete field",fields:t.toObj()})})))}})}}busy(){$$(this.ids.component)?.showProgress?.({type:"icon"})}callbackMassUpdate(){this.loadData()}async callbackSortFields(e){this.workspaceViews.getCurrentView().sortFields=e,await this.workspaceViews.save(),this.getBadgeSortFields(),this.refreshView(),this.loadData()}async callbackViewAdded(e){var t=await this.workspaceViews.viewNew(e);await this.switchWorkspaceView(t),this.refreshView(),this.loadData()}async callbackViewUpdated(e){await this.workspaceViews.viewUpdate(e),this.refreshWorkspaceViewMenu(),this.refreshView()}enableUpdateDelete(){var e=this.ids;$$(e.buttonMassUpdate).show(),$$(e.buttonMassUpdateSpacer).show(),$$(e.buttonDeleteSelected).show(),$$(e.buttonDeleteSelectedSpacer).show()}disableUpdateDelete(){var e=this.ids;$$(e.buttonMassUpdate).hide(),$$(e.buttonMassUpdateSpacer).hide(),$$(e.buttonDeleteSelected).hide(),$$(e.buttonDeleteSelectedSpacer).hide()}getBadgeFilters(){var e=this.ids,t=this.workspaceViews.filterConditions,i=0;t?.rules?.length&&(i=t.rules.length),void 0!==t&&($$(e.buttonFilter).define("badge",i||null),$$(e.buttonFilter).refresh())}getBadgeFrozenColumn(){var e=this.ids,t=this.workspaceViews.frozenColumnID,i=null;""!==t&&void 0!==t&&(i=c.getColumnIndex(t)),$$(e.buttonFrozen).define("badge",i),$$(e.buttonFrozen).refresh()}getBadgeHiddenFields(){var e=this.workspaceViews.hiddenFields;void 0!==e&&($$(this.ids.buttonFieldsVisible).define("badge",e.length||null),$$(this.ids.buttonFieldsVisible).refresh())}getBadgeSortFields(){var e=this.ids,t=(this.workspaceViews.sortFields||[]).filter((e=>""!=e.key));void 0!==t&&($$(e.buttonSort).define("badge",t.length||null),$$(e.buttonSort).refresh())}ready(){$$(this.ids.component)?.hideProgress?.()}async rowAdd(){var e=this.CurrentObject;if(e){var t=e.defaultValues();try{var i=await e.model().create(t);if(null==i)return;var n=this.mockDataCollection.$dc;n&&!n.exists(i.id)&&n.add(i,0)}catch(e){this.AB.notify.developer(e,{context:"ui_work_object_workspace:rowAdd(): error creating empty object",emptyObj:t});var a=this.AB.Label();webix.alert({title:a("Unable to create new row"),text:a("An administrator has already been alerted.")})}}}show(){$$(this.ids.component).show()}toolbarAddFields(){this.PopupNewDataFieldComponent.show()}toolbarButtonImport(){this.PopupImportObjectComponent.show()}toolbarButtonExport(e){this.PopupExportObjectComponent.show(e)}toolbarDeleteSelected(e){c.deleteSelected(e)}toolbarDefineLabel(e){this.PopupDefineLabelComponent.show(e)}toolbarFieldsVisible(e){this.PopupHideFieldComponent.show(e)}toolbarFilter(e,t){this.PopupFilterDataTableComponent.show(e,t)}toolbarFrozen(e){this.PopupFrozenColumnsComponent.show(e)}toolbarPermission(){console.error("TODO: toolbarPermission()")}toolbarMassUpdate(e){c.massUpdate(e)}toolbarSort(e,t){this.PopupSortFieldComponent.show(e,t)}async populateObjectWorkspace(e){$$(this.ids.toolbar).show(),$$(this.ids.selectedObject).show(),this.CurrentObjectID=e;var t=this.CurrentObject;this.isReadOnly=t?.isReadOnly??!1,this.workspaceViews.objectLoad(t);var i=this.workspaceViews.getCurrentView();this.mockDataCollection.datasource=t,c.objectLoad(t),u.objectLoad(t),d.objectLoad(t),this.isReadOnly||(this.PopupNewDataFieldComponent.objectLoad(t),this.PopupDefineLabelComponent.objectLoad(t)),this.PopupFilterDataTableComponent.objectLoad(t),this.PopupFrozenColumnsComponent.objectLoad(t),this.PopupHideFieldComponent.objectLoad(t),this.PopupSortFieldComponent.objectLoad(t),this.PopupImportObjectComponent.objectLoad(t),this.PopupExportObjectComponent.objectLoad(t),this._handler_show||(this._handler_show=()=>{this.PopupExportObjectComponent.setGridComponent(c.$grid)},c.on("show",this._handler_show)),this.PopupExportObjectComponent.setFilename(t.label),this.PopupViewSettingsComponent.objectLoad(t),this.refreshIndexes(),await this.switchWorkspaceView(i),this.refreshWorkspaceViewMenu(),this.refreshView()}clearObjectWorkspace(){$$(this.ids.noSelection).show(!1,!1)}queryLoad(e){this.objectLoad(e)}loadAll(){c.loadAll()}loadData(){var e={glue:"and",rules:[]};this.workspaceViews?.filterConditions[0]?.rules?.length>0?(e=this.workspaceViews.filterConditions[0].rules,this.workspaceViews.filterConditions.rules=this.workspaceViews.filterConditions[0].rules):this.workspaceViews?.filterConditions?.rules?.length>0&&(e=this.workspaceViews.filterConditions);var t=[];this.workspaceViews?.sortFields?.length>0&&(t=this.workspaceViews?.sortFields),this.mockDataCollection.datasource=this.CurrentObject,this.mockDataCollection.fromValues({settings:{datasourceID:this.CurrentObjectID,objectWorkspace:{filterConditions:e,sortFields:t}}}),this.mockDataCollection.filterCondition(e),this.updateFilterButton(e),this.mockDataCollection.refreshFilterConditions(e),this.mockDataCollection.clearAll();let i=this.workspaceViews.getCurrentView();"gantt"===i.type||"kanban"===i.type?(this.mockDataCollection.settings.loadAll=!0,this.mockDataCollection.loadData(0)):this.mockDataCollection.loadData(0,30).catch((e=>{this.toolbarFilter(this.$view);var t=e.toString();if("string"==typeof e)try{var i=JSON.parse(e);i.data&&i.data.sqlMessage&&(t=i.data.sqlMessage)}catch(e){}e.message&&(t=e.message);var n=this.ids;$$(n.error).show(),$$(n.error_msg).define("label",t),$$(n.error_msg).refresh(),this.AB.notify.developer(e,{context:"ui_work_object_workspace.loadData()",message:t,datacollection:this.mockDataCollection.toObj()})}))}async switchWorkspaceView(e){this.hashViews[e.type]&&(this.workspaceViews.setCurrentView(e.id),await this.hashViews[e.type].show(e),this.refreshWorkspaceViewMenu(),this.refreshToolBarView(),this.PopupFilterDataTableComponent.setFilter(e.filterConditions),this.PopupFrozenColumnsComponent.setValue(e.frozenColumnID||""),this.PopupFrozenColumnsComponent.setHiddenFields(e.hiddenFields),this.PopupHideFieldComponent.setSettings(e.hiddenFields),this.PopupHideFieldComponent.setFrozenColumnID(e.frozenColumnID||""),this.PopupSortFieldComponent.setSettings(e.sortFields),this.PopupExportObjectComponent.setHiddenFields(e.hiddenFields),this.workspaceViews.save(),this.loadData())}refreshToolBarView(){var e=this.ids;switch(this.workspaceViews.getCurrentView().type){case"grid":$$(e.buttonFieldsVisible).show(),$$(e.buttonFrozen).show(),$$(e.buttonSort).show(),$$(e.buttonFieldsVisibleSpacer).show(),$$(e.buttonFrozenSpacer).show(),$$(e.buttonSortSpacer).show();break;case"kanban":$$(e.buttonFieldsVisible).hide(),$$(e.buttonFrozen).hide(),$$(e.buttonSort).hide(),$$(e.buttonFieldsVisibleSpacer).hide(),$$(e.buttonFrozenSpacer).hide(),$$(e.buttonSortSpacer).hide()}this.getBadgeHiddenFields(),this.getBadgeFrozenColumn(),this.getBadgeSortFields(),this.getBadgeFilters(),$$(e.selectedObject).show(!0,!1),this.CurrentObject.isExternal||this.CurrentObject.isImported?$$(e.buttonAddField).disable():$$(e.buttonAddField).enable()}refreshWorkspaceViewMenu(){var e=this.workspaceViews.getCurrentView().id,t=this.workspaceViews.list().map((t=>({id:t.id,hash:t.type,value:t.name,isView:!0,$css:t.id===e?"selected":"",icon:`fa fa-${t.icon}`,submenu:t.isDefaultView?null:[{value:l("Edit"),icon:"fa fa-cog",viewId:t.id,action:"edit"},{value:l("Delete"),icon:"fa fa-trash",viewId:t.id,action:"delete"}]}))),i=$$(this.ids.viewMenu);i.clearAll(),i.define("data",t),i.refresh()}refreshIndexes(){let e=this.CurrentObject?.indexes()||[];webix.ui([],$$(this.ids.listIndex)),e.forEach((e=>{this.addNewIndex(e)}))}addNewIndex(e){$$(this.ids.listIndex).addView({view:"button",label:e.label||e.name,icon:"fa fa-key",css:"webix_transparent",type:"icon",width:160,click:()=>{this.PopupCustomIndex.open(this.CurrentObject,e)}})}get isReadOnly(){return this._isReadOnly??!1}set isReadOnly(e){this._isReadOnly=e,this.PopupViewSettingsComponent&&(this.PopupViewSettingsComponent.isReadOnly=e);const t=this.ids,i=$$(t.buttonAddField),n=$$(t.spaceAddField),a=$$(t.buttonLabel),o=$$(t.spaceLabel),s=$$(t.buttonImport),r=$$(t.spaceImport),l=$$(t.layoutIndex),c=$$(t.buttonRowNew);this._isReadOnly?(i?.hide(),n?.hide(),a?.hide(),o?.hide(),s?.hide(),r?.hide(),l?.hide(),c?.hide()):(i?.show(),n?.show(),a?.show(),o?.show(),s?.show(),r?.show(),l?.show(),c?.show())}}(t,i)}function V(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ab_work_query"),this.QueryList=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_query_list"),this.ListComponent=l(e,{idBase:this.ids.component,labels:{addNew:"Add new query",confirmDeleteTitle:"Delete Query",title:"Queries",searchPlaceholder:"Query name"},menu:{copy:!1,exclude:!0}}),this.AddForm=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_query_list_newQuery",{tab:""}),this.selectNew=!0,this.BlankTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_query_list_newQuery_blank",{form:"",buttonSave:"",buttonCancel:"",object:""})}ui(){return{id:this.ids.component,header:i("Create"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Query name"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_query_list_newQuery_blank_name")}}},{id:this.ids.object,view:"richselect",label:i("Object"),name:"object",required:!0,placeholder:i("Select an object"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_query_list_newQuery_blank_object")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Query"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){t.CYPRESS_REF(this)}}}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$buttonSave=$$(this.ids.buttonSave),this.$objectList=$$(this.ids.object),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear())}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating Query: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.formClear(),this.$buttonSave.enable()}save(){this.$buttonSave.disable();var e=this.$form;if(e.clearValidation(),!e.validate())return this.$buttonSave.enable(),!1;let t=e.getValues(),i={name:t.name,label:t.name,joins:{alias:"BASE_OBJECT",objectID:t.object,links:[]}};this.emit("save",i)}show(){$$(this.ids.component)&&$$(this.ids.component).show()}onShow(e){if(this.$objectList&&e){let t=e.objectsIncluded().map((e=>({id:e.id,value:e.label})));this.$objectList.define("options",t),this.$objectList.refresh();let i=this.$objectList.getPopup();i.attachEvent("onShow",(()=>{i.define("width",300),i.resize()}))}this.$form&&this.$form.setValues({name:"",object:""})}}}(e),this.ImportTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_query_list_newQuery_import",{form:"",filter:"",queryList:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Existing"),body:{view:"form",id:this.ids.form,width:400,elements:[{cols:[{view:"icon",icon:"fa fa-filter",align:"left"},{view:"text",id:this.ids.filter,on:{onTimedKeyPress:()=>this.filter()}}]},{view:"list",id:this.ids.queryList,select:!0,height:200,minHeight:250,maxHeight:250,data:[],template:"<div>#label#</div>"},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>this.cancel()},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Import"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$filter=$$(this.ids.filter),this.$queryList=$$(this.ids.queryList),this.$buttonSave=$$(this.ids.buttonSave),this.$buttonCancel=$$(this.ids.buttonCancel),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}onShow(e){this.formClear();const t=e.queriesExcluded();this.$queryList.parse(t,"json")}filter(){let e=this.$filter.getValue();this.$queryList.filter("#label#",e)}save(){let e=this.$queryList.getSelectedItem();if(!e)return!1;this.$buttonSave.disable(),this.emit("save",e)}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear()),this.$queryList&&this.$queryList.clearAll()}onError(e){if(e){let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;let n=this.$form.getValues();webix.alert({title:i("Error creating Query: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.$buttonSave.enable()}}}(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new query"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},selectNewQuery:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui(),this.ImportTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((t=>{var i=t.getAttribute("button_id");e.ClassUI.CYPRESS_REF(t,`${i}_tab`)}))}}}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);let t=[];return["BlankTab","ImportTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{if(e.id)return this.import(e,i);this.save(e,i)}))})),Promise.all(t)}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}async import(e,t){this.busy();try{await this.CurrentApplication.queryInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}async save(e,t){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;let n=this.AB.queryNew(e),a=n.isValid();if(a.fail())return this[t].emit("save.error",a),!1;n.createdInAppID||(n.createdInAppID=this.CurrentApplicationID),this.busy();try{let e=await n.save();await this.CurrentApplication.queryInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}show(e){null!=e&&(this.selectNew=e),this.$component&&this.$component.show();const t=$$(this.ids.tab).getValue();this.switchTab(t)}hide(){this.$component&&this.$component.hide()}busy(){this.$component&&this.$component.showProgress()}ready(){this.$component&&this.$component.hideProgress()}switchTab(e){e!=this.BlankTab?.ui()?.body?.id&&e?e==this.ImportTab?.ui()?.body?.id&&this.ImportTab?.onShow?.(this.CurrentApplication):this.BlankTab?.onShow?.(this.CurrentApplication)}}}(e)}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewQuery(e)}));var t=[];t.push(this.ListComponent.init(e)),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("addNew",(e=>{this.clickNewQuery(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),t.push(this.AddForm.init(e)),this.AddForm.on("cancel",(()=>{this.AddForm.hide()})),this.AddForm.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)})),await Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.ListComponent.dataLoad(e?.queriesIncluded()),this.AddForm.applicationLoad(e)}warningsRefresh(){if(this.CurrentApplication){let e=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.queriesIncluded()),this.ListComponent.selectItem(e.id)}}clickNewQuery(){this.AddForm.show()}async exclude(e){this.ListComponent.busy();var t=this.CurrentApplication;await t.queryRemove(e),this.ListComponent.dataLoad(t.queriesIncluded()),this.emit("selected",null)}ready(){this.ListComponent.ready()}select(e){this.ListComponent.select(e.id)}}}(e),this.QueryWorkspace=function(e,t){const i=(0,n.Z)(e),a=e.Config.uiSettings();var o=i.L();const r="ui_work_query_workspace",l=function(e,t){const i=(0,n.Z)(e),a=e.Config.uiSettings();var o=i.L();return new class extends i{constructor(t={}){super("ui_work_query_workspace_design",{tree:"",tabObjects:"",depth:"",datatable:"",selectedObject:"",grouping:"",hidePrefix:"",filter:""}),this.settings=t,this.mockDatacollection=null,this.CurrentQueryID=null,this.DataFilter=e.filterComplexNew(this.ids.filter,{isSaveHidden:!0}),this.DataFilter.init({showObjectName:!0}),this.DataFilter.on("changed",(()=>{this.DataFilter.isComplete()&&(this.__saveInProcess||(this.__saveInProcess=this.save().finally((()=>{this.__saveInProcess=null}))))}))}ui(){const e=this,t=this.ids;return{view:"scrollview",id:t.component,body:{rows:[{id:t.selectedObject,type:"form",rows:[{cols:[{rows:[{view:"label",label:o("Manage Objects"),css:"ab-query-label"},{view:"tree",id:t.tree,css:"ab-tree",template:"{common.icon()} {common.checkbox()} #value#",data:[],on:{onItemClick:function(e,t,i){this.getItem(e).disabled||(this.isChecked(e)?this.uncheckItem(e):this.checkItem(e))},onItemCheck:(e,t,i)=>{this.checkObjectLink(e,t)},onBeforeOpen:function(i){let n=this.getItem(i);if(-1===n.$count){$$(t.tree).showProgress({type:"icon"});let a=e.getChildItems(n.objectLinkId,i);$$(t.tree).parse(a.treeItems),$$(t.tree).hideProgress()}}}}]},{view:"resizer",borderless:!0},{gravity:3,rows:[{view:"label",label:o("Manage Fields"),css:"ab-query-label"},{view:"tabview",id:t.tabObjects,tabbar:{tabMinWidth:240,css:"webix_dark",type:"bottom",bottomOffset:0},cells:[{}],multiview:{animate:!1,on:{onViewChange:(e,t)=>{this.setSelectedFields(t)}}}}]}]},{id:t.grouping,view:"checkbox",label:o("Grouping"),labelWidth:a.labelWidthXLarge,on:{onChange:()=>{this.save()}}},{id:t.hidePrefix,view:"checkbox",label:o("Hide prefix labels"),labelWidth:a.labelWidthXLarge,on:{onChange:()=>{this.save()}}},{view:"label",label:o("Manage Filters"),css:"ab-query-label"},{view:"button",label:o("Filters"),icon:"fa fa-filter",type:"button",click:function(){e.DataFilter.popUp(this.$view,{pos:"bottom"})}},{id:t.datatable,view:"treetable",minHeight:280,dragColumn:!0,columns:[],data:[],on:{onAfterColumnDrop:()=>{this.save()}}}]}]}}}init(e){this.AB=e;const t=this.ids;return webix.extend($$(t.tree),webix.ProgressBar),webix.extend($$(t.tabObjects),webix.ProgressBar),webix.extend($$(t.datatable),webix.ProgressBar),this.DataFilter.init({showObjectName:!0}),Promise.resolve()}clearWorkspace(){}populateQueryWorkspace(e){console.error("DEPRECIATED! Use queryLoad() instead"),this.queryLoad(e)}queryLoad(e){super.queryLoad(e);let t=this.CurrentQuery;if(null==t)return void this.clearWorkspace();this.mockDatacollection=this.AB.datacollectionNew({query:[t.toObj()],settings:{datasourceID:t.id}}),this.mockDatacollection.datasource=t;const i=t.objectBase(),n=this.ids;$$(n.selectedObject).show(),this.refreshTree();let a=t.joins().links||[];const o=$$(n.tabObjects);o?.showProgress({type:"icon"}),o.addView({body:{id:"temp"}}),o.getTabbar().config.options.map((e=>e.id)).forEach((e=>{"temp"!=e&&o.removeView(e)}));var s=o.getMultiview();if(s.getChildViews().map((e=>e)).forEach((e=>{e&&"temp"!=e.config.id&&s.removeView(e)})),!i)return;let r=this.templateField({object:i,isTypeHidden:!0,aliasName:"BASE_OBJECT"});o.addView(r),o.setValue(r.id),this.setSelectedFields("BASE_OBJECT");var l=(e,i)=>{(i||[]).forEach((i=>{if(!e)return;if(!i.fieldID)return;var n=e.fieldByID(i.fieldID);if(!n)return;var a=t.objectByID(n.settings.linkObject);if(!a)return;let s=this.templateField({field:n,joinType:i.type,aliasName:i.alias});o.addView(s),this.setSelectedFields(i.alias),l(a,i.links)}))};l(i,a),$$(n.grouping).define("value",e.settings.grouping),$$(n.grouping).refresh(),$$(n.hidePrefix).define("value",e.settings.hidePrefix),$$(n.hidePrefix).refresh(),o.removeView("temp"),o.adjust(),o.hideProgress(),this.refreshFilter(),this.refreshDataTable()}getChildItems(e,t){let i={data:[]},n=this.getObject(e);return t&&(i.parent=t),n.connectFields().forEach((e=>{let t=this.getObject(e.settings.linkObject);if(null==t)return;if(!this.CurrentApplication.isSystemObj&&t.isSystemObject)return;let n=e.id;var a=`${t.label} (${e.label})`;i.data.push({value:a,fieldID:n,objectId:t.id,objectLinkId:e.settings.linkObject,checked:!1,disabled:!1,open:!1,webix_kids:!0})})),{object:n,treeItems:i}}aliasName(){return this.AB.uuid().replace(/[^a-zA-Z0-9]+/g,"").substring(0,8)}save(e=null){let t=this.ids,i=this.CurrentQuery;return new Promise(((n,a)=>{var o=$$(t.tree);let s={alias:"BASE_OBJECT",objectID:i.objectBase().id,links:[]},r={};(o.getChecked().map((e=>o.getItem(e))).sort(((e,t)=>e.$level-t.$level))||[]).forEach((e=>{let i=e.alias;i||(i=this.aliasName(),o.updateItem(e.id,{alias:i}));let n="innerjoin",a=$$(t.tabObjects).getMultiview().getChildViews().filter((e=>e.config.id==i))[0];a&&(n=a.queryView({name:"joinType"}).getValue()||"innerjoin");let l=s.links,c={alias:i,fieldID:e.fieldID,type:n,links:[]};if(e.$level>1){let t=o.getParentId(e.id),i=o.getItem(t);l=r[i.alias].links}l.push(c),r[i]=c})),i.importJoins(s),null==e&&(e=$$(t.datatable).config.columns.map((e=>{let t=i.objectByAlias(e.alias);if(t)return!t.fieldByID(e.fieldID)||"BASE_OBJECT"!=e.alias&&i.links((t=>t.alias==e.alias)).length<1?void 0:{alias:e.alias,fieldID:e.fieldID}})).filter((e=>null!=e))),i.importFields(e),i.where=this.DataFilter.getValue(),i.settings={grouping:$$(t.grouping).getValue(),hidePrefix:$$(t.hidePrefix).getValue()},i.save().then((()=>i.migrateCreate())).then((()=>{this.refreshDataTable(),this.warningsRefresh(i),n()})).catch((e=>{this.AB.notify.developer(e,{context:`${t.component}:save(): Error saving Query`,query:i.toObj()}),a(e)}))}))}checkObjectLink(e,t){var i=$$(this.ids.tree);i.blockEvent();var n=e;if(t)for(;i.getParentId(n);)(n=i.getParentId(n))!=e&&i.checkItem(n);else i.data.eachSubItem(n,(function(t){t.id!=e&&i.uncheckItem(t.id)}));this.save().then((()=>{this.populateQueryWorkspace(this.CurrentQuery)})),i.unblockEvent()}depthChange(){this.save().then((()=>{this.populateQueryWorkspace(this.CurrentQuery)}))}setSelectedFields(e){let t=$$(e).queryView({name:"fields"});if(t){let i=this.CurrentQuery.fields((t=>t.alias==e),!0).map((e=>e.id));t.setValue(i)}}checkFields(){let e=this.ids;var t=[];$$(e.tabObjects).getMultiview().getChildViews().forEach((e=>{let i=e.queryView({name:"fields"});if(i&&i.getValue()){let n=i.getValue().split(",").map((t=>({alias:e.config.aliasName,fieldID:t})));t=t.concat(n)}}));var i=$$(e.datatable).config.columns.map((e=>e.fieldID));t.sort(((e,t)=>{var n=i.indexOf(e.fieldID),a=i.indexOf(t.fieldID);return n<0&&(n=999),a<0&&(a=999),n-a})),this.save(t).then((()=>{this.refreshFilter()}))}templateField(e){if(null==e.object&&null==e.field)throw new Error("Invalid params");var t=e.object?e.object:this.CurrentQuery.objectByID(e.field.settings.linkObject),i=t.fields((e=>e.fieldSupportQuery()),!0).map((e=>({id:e.id,value:e.label})));let n="";e.field&&(n=` (${e.field.label})`);var a=`${t.label}${n}`;let s=e.aliasName;return{header:a,body:{id:s,aliasName:s,type:"space",css:"bg-white",rows:[{view:"select",name:"joinType",label:o("join records by"),labelWidth:200,placeholder:o("Choose a type of table join"),hidden:1==e.isTypeHidden,value:e.joinType||"innerjoin",options:[{id:"innerjoin",value:o("Returns records that have matching values in both tables (INNER JOIN).")},{id:"left",value:o("Return all records from the left table, and the matched records from the right table (LEFT JOIN).")},{id:"right",value:o("Return all records from the right table, and the matched records from the left table (RIGHT JOIN).")},{id:"fullouterjoin",value:o("Return all records when there is a match in either left or right table (FULL JOIN)")}],on:{onChange:()=>{this.save()}}},{view:"dbllist",name:"fields",list:{height:300},labelLeft:o("Available Fields"),labelRight:o("Included Fields"),labelBottomLeft:o("Move these fields to the right to include in data set."),labelBottomRight:o("These fields will display in your final data set."),data:i,on:{onChange:()=>{this.checkFields()}}},{fillspace:!0}]}}}refreshTree(){let e=(t,i,a,o=0)=>{(a||[]).forEach((a=>{if(!i)return;let s=i.fieldByID(a.fieldID);if(!s)return;let r={fieldID:s.id};null!=o&&(r.$parent=o);let l=null;if((t.find(r)||[]).forEach((e=>{if(e.$parent){let i=t.getItem(e.$parent);i&&i.checked&&(l=e)}else l=e})),l){t.updateItem(l.id,{alias:a.alias,checked:!0,open:!0});let i=this.getChildItems(s.settings.linkObject,l.id);$$(n.tree).parse(i.treeItems),e(t,i.object,a.links,l.id)}}))};const t=this.CurrentQuery.objectBase();let i=this.CurrentQuery.joins().links||[],n=this.ids;if($$(n.tree).clearAll(),$$(n.tree).showProgress({type:"icon"}),t){let a=this.getChildItems(t.id);$$(n.tree).parse(a.treeItems),e($$(n.tree),t,i),$$(n.tree).hideProgress()}}refreshFilter(){let e=this.CurrentQuery;this.DataFilter.fieldsLoad(e?e.fields():[],e),this.DataFilter.setValue(e.where)}refreshDataTable(){if(null==this.mockDatacollection)return;let e=this.CurrentQuery;if(!e)return;let t=$$(this.ids.datatable);t.clearAll();var i=e.columnHeaders(!1,!1);t.refreshColumns(i);let n=e.workspaceViews.getCurrentView();this.mockDatacollection.clearAll(),this.mockDatacollection.datasource=e,this.mockDatacollection.fromValues({query:[e.toObj()],settings:{datasourceID:e.id,objectWorkspace:{sortFields:n.sortFields}}}),this.mockDatacollection.datasource=e,this.mockDatacollection.unbind(t),this.mockDatacollection.bind(t),t.showProgress({type:"icon"}),this.mockDatacollection.loadData(0,50,(()=>{})).then((()=>{this.mockDatacollection.bind(t)}))}getObject(e){let t=this.CurrentQuery.objectByID(e);return t||(t=this.AB.objectByID(e),t||void 0)}show(){$$(this.ids.component).show()}}(void 0)}(e),c=L(e,`${r}_display`,{isReadOnly:!0,showWarnings:!1});var d=s(e,`${r}_view_warnings`,t);return new class extends i{constructor(e={}){super(r,{multiview:"",toolbar:"",modeButton:"",noSelection:"",run:"",design:""}),this.settings=e}ui(){var e=this.ids;return{view:"multiview",animate:!1,cells:[{id:e.noSelection,rows:[{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-filter'></div>"},{view:"label",align:"center",label:o("Select a query to work with.")},{cols:[{},{view:"button",css:"webix_primary",label:o("Add new query"),type:"form",autowidth:!0,click:()=>{this.emit("query.add")}},{}]},{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile}]},{id:e.component,rows:[{id:e.toolbar,view:"tabbar",css:"webix_dark",type:"bottom",borderless:!1,bottomOffset:0,options:[{id:e.design,value:o("Build Query"),icon:"fa fa-sliders",type:"icon"},{id:e.run,value:o("View Query"),icon:"fa fa-table",type:"icon"}],on:{onChange:(e,t)=>{e!=t&&this.changeMode(e)}}},{height:10},{id:e.multiview,view:"multiview",animate:!1,cells:[l.ui(),c.ui()]},d.ui()]}]}}init(e){return this.AB=e,this.warningsPropogate([l,c]),this.on("warnings",(()=>{d.show(this.CurrentQuery)})),Promise.all([l.init(e),c.init(e)])}changeMode(e){let t=this.ids;$$(this.ids.component).show(),$$(t.toolbar).show(!1,!1),e==t.run?(c.show(),c.populateObjectWorkspace(this.CurrentQueryID)):(l.show(!0),l.queryLoad(this.CurrentQuery))}applicationLoad(e){super.applicationLoad(e),this.clearWorkspace(),l.applicationLoad(e),c.applicationLoad(e)}clearWorkspace(){$$(this.ids.noSelection).show(!1,!1),l.clearWorkspace()}loadAll(){c.loadAll()}queryLoad(e){super.queryLoad(e),d.show(e),l.queryLoad(e),c.queryLoad(e),e?($$(this.ids.component).show(),l.show(!0)):this.clearWorkspace()}resetTabs(){$$(this.ids.toolbar)?.setValue?.(this.ids.design)}}(t)}(e)}ui(){return{id:this.ids.component,type:"space",cols:[this.QueryList.ui(),{view:"resizer"},this.QueryWorkspace.ui()]}}init(e){return this.AB=e,this.QueryList.on("selected",(e=>{this.select(e)})),this.QueryWorkspace.on("query.add",(()=>{this.QueryList.emit("addNew")})),this.warningsPropogate([this.QueryList,this.QueryWorkspace]),this.on("warnings",(()=>{this.QueryList.warningsRefresh()})),Promise.all([this.QueryWorkspace.init(e),this.QueryList.init(e)])}applicationLoad(e){super.applicationLoad(e),this.QueryWorkspace.clearWorkspace(),this.QueryList.applicationLoad(e),this.QueryWorkspace.applicationLoad(e)}show(){$$(this.ids.component).show(!1,!1);var e=this.CurrentApplication;e&&this.QueryList?.applicationLoad(e),this.QueryList?.ready(),this._lastSelectedQuery&&(this.QueryList.select(this._lastSelectedQuery),this.select(this._lastSelectedQuery))}select(e){this._lastSelectedQuery=e,this.QueryWorkspace.resetTabs(),this.QueryWorkspace.queryLoad(e)}}}function F(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_interface_list_newPage_blank",{form:"",buttonSave:"",buttonCancel:"",parentList:""})}ui(){return{id:this.ids.component,header:i("Blank"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"select",id:this.ids.parentList,label:i("Parent Page"),name:"parent",options:[],placeholder:i("Root Page"),labelWidth:110},{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Page name"),labelWidth:110,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"ui_work_interface_list_newPage_blank_name")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Page"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]}}}init(e){return this.AB=e,this.$form=$$(this.ids.form),this.on("save.error",(e=>{this.AB.notify.developer(e,{context:"ui_work_interface_list_newPage:init(): there was an error saving the values from our form."})})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}applicationLoad(e){super.applicationLoad(e);var t=[{id:"-",value:i("Root page")}],n=function(e,i){i=i||"",t.push({id:e.urlPointer(),value:i+e.label}),e.pages().forEach((function(e){n(e,i+"-")}))};e.pages().forEach((function(e){n(e,"")})),$$(this.ids?.parentList)?.define&&($$(this.ids.parentList).define("options",t),$$(this.ids.parentList).refresh())}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear()}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();this.AB.notify.developer(e,{context:"ui_work_interface_list_newPage: the entered data is invalid",base:n}),webix.alert({title:i("Error creating Page: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}save(){var e=$$(this.ids.buttonSave);e.disable();var t=this.$form;if(t.clearValidation(),!t.validate())return e.enable(),!1;var i=t.getValues();"-"===i.parent?i.parent=null:i.parent&&(i.parent=this.CurrentApplication.urlResolve(i.parent)),i.primaryColumnName="uuid",this.emit("save",i)}show(){$$(this.ids.component)&&$$(this.ids.component).show()}}}function I(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ab_work_interface_list_newInterface",{tab:""}),this.selectNew=!0,this.BlankTab=new F(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:i("Add new interface"),selectNewInterface:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((t=>{var i=t.getAttribute("button_id");e.ClassUI.CYPRESS_REF(t,`${i}_tab`)}))}}}},on:{onBeforeShow:()=>{var e=$$(this.ids.tab).getValue();this.switchTab(e)}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component),this.$form=$$(this.ids.form);var t=[];["BlankTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{this.save(e,i)}))})),await Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.BlankTab.applicationLoad(e)}hide(){this?.$component?.hide()}busy(){this?.$component?.showProgress()}ready(){this?.$component?.hideProgress()}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}async save(e,t){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;if(e){var n=null;if((n=e.useParent&&e.parent?e.parent:e.parent?e.parent.pageNew(e):this.CurrentApplication.pageNew(e)).isValid){var a=n.isValid();if(a.fail())return this[t].emit("save.error",a),!1}n.createdInAppID||(n.createdInAppID=this.CurrentApplication.id),this.busy();try{var o=await n.save();this[t].emit("save.successful",o),this.done(o)}catch(e){this.ready(),await this.CurrentApplication.pageRemove(n),this[t].emit("save.error",e)}}}show(){this.$component?.show()}switchTab(e){}}}function B(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ab_work_interface_list_copyInterface",{form:"",buttonSave:"",buttonCancel:""}),this.ids.parentList={}}ui(t){return{view:"window",id:this.ids.component,width:400,position:"center",modal:!0,head:i("Copy interface"),selectNewInterface:!0,body:{view:"form",id:this.ids.form,rules:{},elements:[{view:"select",id:this.ids.parentList,label:i("Parent Page"),name:"parent",options:[],placeholder:i("Root Page"),labelWidth:110},{view:"text",label:i("Name"),name:"name",required:!0,placeholder:`${i("{0} - copy",[t])}`,labelWidth:110,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"ui_work_interface_list_newPage_blank_name")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Paste Page"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]}}}async init(e,t){this.AB=e,this.data=t,console.log(t),webix.ui(this.ui(t.name)),webix.extend($$(this.ids.component),webix.ProgressBar),this.$form=$$(this.ids.form),this.$component=$$(this.ids.component),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()}))}applicationLoad(e){super.applicationLoad(e);var t=[{id:"-",value:i("Root page")}],n=function(e,i){i=i||"",t.push({id:e.id,value:i+e.label}),e.pages().forEach((function(e){n(e,i+"-")}))};e.pages().forEach((function(e){n(e,"")})),$$(this.ids?.parentList)?.define("options",t),$$(this.ids?.parentList)?.refresh()}hide(){this?.$component?.hide()}cancel(){this.formClear(),this.emit("cancel")}busy(){this?.$component?.showProgress()}ready(){this?.$component?.hideProgress()}done(e){this.ready(),this.hide(),this.emit("save",e)}async save(){var e=$$(this.ids.buttonSave);e.disable(),this.busy();var t=this.$form;if(t.clearValidation(),!t.validate())return e.enable(),this.ready(),!1;var n=t.getValues();if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this.emit("save.error",!0),!1;if(!n)return;"-"===n.parent?n.parent=null:n.parent&&(n.parent=this.CurrentApplication.urlResolve(n.parent));var a=this.data;let o=await a.copy(null,n.parent,{newName:n.name}).catch((e=>{this.ready(),this.AB.notify.developer(e,{context:"ui_interface_list_copyPage:save(): Error saving copied page",base:a})}));this.emit("save.successful",o),this.done(o)}show(){this?.$component?.show()}formClear(){this?.$form.clearValidation(),this?.$form.clear()}onError(e){if(e){var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();this.AB.notify.developer(e,{context:"ui_interace_list: error",base:n}),webix.alert({title:i("Error creating Page: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}}}function T(e){const t=(0,n.Z)(e),a=t.L();var o=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_interface_workspace_editor_components",{popup:"",list:""})}ui(){return{id:this.ids.component,css:"webix_primary",view:"button",type:"form",label:i("Add Widget"),align:"center",autowidth:!0,on:{onItemClick:()=>{this.showPopup()}}}}init(e){this.AB=e;let t=this.ids,n=this;webix.ui({view:"window",id:t.popup,modal:!0,width:600,height:550,select:!1,resize:!0,position:"center",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add Widget"),css:"modal_title",align:"center"},{view:"button",label:"Close",autowidth:!0,align:"center",click:()=>{this.hidePopup()}}]},body:{id:t.list,view:"dataview",css:"ab-datacollection-table borderless",borderless:!0,xCount:5,yCount:4,type:{borderless:!0,width:100,height:100},template:(e,t)=>this.template(e,t),on:{onItemClick:function(e){var t=this.getItem(e);n.addWidget(t)}}}})}show(){$$(this.ids.component).show()}hide(){$$(this.ids.component).hide()}showPopup(){$$(this.ids.popup).show()}hidePopup(){$$(this.ids.popup).hide()}addWidget(e){const t=e.newInstance(this.CurrentView.application,this.CurrentView);this.emit("widget.adding"),t.save().then((()=>{this.emit("widget.add"),this.emit("warnings")})),this.hidePopup()}template(e){if(e.common){var t=e.common().label;return t||(t=i(e.common().labelKey)),`<div class='ab-component-in-page'><i class='fa fa-2x fa-${e.common().icon}' aria-hidden='true'></i><br/>${t}</div>`}return e.label}viewLoad(e){super.viewLoad(e);let t=this.ids;var i=$$(t.list),n=$$(t.component),a=this.CurrentView.componentList();i.clearAll(),a&&a.length>0?(i.parse(a),n.show()):n.hide(),i.refresh()}}}(e),s=function(e){const t=(0,n.Z)(e),a=t.L(),o=function(e){const t=[];return[i(3759),i(8442),i(1298),i(6062),i(3725),i(3121),i(5250),i(8971),i(760),i(4713),i(2761),i(6720),i(5903),i(2442),i(559),i(2363),i(803),i(5084),i(9074),i(7895),i(4826),i(6629),i(302),i(5694),i(5025),i(2279),i(7912)].forEach((i=>{const n=i.default(e);t.push(n)})),{editors:function(e=(()=>!0)){return t.filter(e)}}}(e);return new class extends t{constructor(){super("ui_work_interface_workspace_editor_layout",{editArea:"",editAreaContainer:"",editAreaLeft:"",editAreaRight:"",editAreaTop:"",editAreaBottom:"",editAreaSamplePopup:""}),this.CurrentViewMode=1,this._editorsByType={}}ui(){let e=this.ids;return{view:"scrollview",id:e.component,body:{cols:[{id:e.editAreaLeft,width:1},{id:e.editAreaContainer,type:"clean",rows:[{id:e.editAreaTop,height:1},{id:e.editAreaSamplePopup,view:"toolbar",css:"webix_dark",hidden:!0,cols:[{},{view:"label",label:a("Sample Popup")},{}]},{id:e.editArea,view:"layout",borderless:!0,rows:[]},{id:e.editAreaBottom,height:1}]},{id:e.editAreaRight,width:1}]}}}init(e){this.AB=e;let t=$$(this.ids.editArea);return t&&webix.extend(t,webix.ProgressBar),o.editors().forEach((e=>{this._editorsByType[e.key]=e})),Promise.resolve()}show(){$$(this.ids.component).show()}viewLoad(e){this.currentEditor?.detatch?.(),super.viewLoad(e);let t=this.ids;var i;if($$(t.editArea).getChildViews().forEach((e=>{$$(t.editArea)?.removeView(e)})),"preview"==this.CurrentViewMode)i=e.component(),"popup"==this.CurrentView.settings.type&&this.CurrentView.settings.popupWidth&&this.CurrentView.settings.popupHeight?($$(t.editAreaContainer).define({width:parseInt(this.CurrentView.settings.popupWidth)}),$$(t.editArea).define({height:parseInt(this.CurrentView.settings.popupHeight)}),webix.html.addCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.addCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.addCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.addCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:0}),$$(t.editAreaRight).define({width:0}),$$(t.editAreaTop).define({height:0}),$$(t.editAreaBottom).define({height:0}),$$(t.editAreaSamplePopup).show()):"page"==this.CurrentView.settings.type&&1==this.CurrentView.settings.fixedPageWidth&&this.CurrentView.settings.pageWidth?($$(t.editAreaContainer).define({width:parseInt(this.CurrentView.settings.pageWidth)}),$$(t.editArea).define({height:0}),webix.html.removeCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:0}),$$(t.editAreaRight).define({width:0}),$$(t.editAreaTop).define({height:1}),$$(t.editAreaBottom).define({height:1}),$$(t.editAreaSamplePopup).hide()):($$(t.editAreaContainer).define({width:0}),$$(t.editArea).define({height:0}),webix.html.removeCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:1}),$$(t.editAreaRight).define({width:1}),$$(t.editAreaTop).define({height:1}),$$(t.editAreaBottom).define({height:1}),$$(t.editAreaSamplePopup).hide());else{let n=this._editorsByType[e.key];null==n&&(n=this._editorsByType._default),(i=new n(e)).viewLoad(e),$$(t.editAreaContainer).define({width:0}),$$(t.editArea).define({height:0}),webix.html.removeCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:1}),$$(t.editAreaRight).define({width:1}),$$(t.editAreaTop).define({height:1}),$$(t.editAreaBottom).define({height:1}),$$(t.editAreaSamplePopup).hide()}$$(t.editArea).addView(i.ui()),i.init(this.AB,2),i.on("view.edit",(e=>{this.emit("view.load",e)})),i.on("view.destroyed",(()=>{this.emit("view.load",this.CurrentView),this.emit("warnings")})),i.onShow&&i.onShow(),this.currentEditor=i,setTimeout((()=>{$$(t.component).adjust(),$$(t.editAreaContainer).adjust()}),150)}viewModeChange(e){this.CurrentViewMode=e}busy(){let e=$$(this.ids.editArea);e?.disable(),e?.showProgress({type:"icon"})}ready(){let e=$$(this.ids.editArea);e?.enable(),e?.hideProgress()}}}(e);return new class extends t{constructor(){super("ui_work_interface_workspace_editor",{toolbar:"",toolbarMap:"",toolbarViewMode:"",toolbarViewPage:"",layoutView:"",dataView:"",noContent:""}),this.CurrentViewPart="layout",this.CurrentViewMode=0,this.PreviousViews=[],this._handlerViewUpdate=()=>{this.viewLoad(this.CurrentView)}}ui(){let e=this.ids,t=this;return{id:e.component,view:"layout",borderless:!1,rows:[{id:e.toolbar,view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"button",type:"icon",icon:"fa fa-arrow-left",autowidth:!0,click:()=>{this.buttonBack()}},{id:e.toolbarMap,view:"list",layout:"x",borderless:!0,multiselect:!1,select:!1,scroll:!1,padding:0,css:"ab_breadcrumb",template:function(e){let i="";return(e.warningsAll?.()||[]).length>0&&(i=t.WARNING_ICON),'<span class="fa fa-chevron-right" aria-hidden="true"></span> '+e.label+i},on:{onItemClick:e=>{this.pageMap(e)}}},{view:"icon",icon:"fa fa-info-circle",tooltip:a('Check "Preview" to see what your layout will look like, Click "Add Widget" to add new items to the page.'),on:{onItemClick:()=>{this.infoAlert()}}}]},{view:"layout",type:"space",css:"gray",cols:[{id:e.toolbarViewMode,view:"checkbox",labelRight:a("Preview"),labelWidth:0,width:85,on:{onChange:(e,t)=>{this.viewModeChange(e,t)}}},{},o.ui()]},s.ui()]}}init(e){this.AB=e;var t=[];return $$(this.ids.toolbarViewMode).setValue(this.CurrentViewMode),t.push(s.init(e)),t.push(o.init(e)),o.on("widget.adding",(()=>{s.busy()})),o.on("widget.add",(()=>{this.viewLoad(this.CurrentView),s.ready()})),s.on("view.load",(e=>{this.emit("view.load",e)})),this.warningsPropogate([s,o]),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),s.applicationLoad(e),o.applicationLoad(e)}buttonBack(){if(this.PreviousViews.length>0){var e=this.PreviousViews.pop();this.CurrentViewPart="layout",this.emit("view.load",e)}else"data"==this.CurrentViewPart&&(this.CurrentViewPart="layout",this.emit("view.load",this.CurrentView))}pageMap(e){var t=$$(this.ids.toolbarMap).getItem(e);this.CurrentViewPart="layout",this.emit("view.load",t)}infoAlert(){webix.alert({title:a("Tip"),text:a('Check "Preview" to see what your layout will look like, Click "Add Widget" to add new items to the page.')})}show(){$$(this.ids.component).show()}viewLoad(e){this.CurrentView&&e&&e.id!=this.CurrentView.id&&(this.PreviousViews.push(this.CurrentView),this.PreviousViews.length>50&&this.PreviousViews.shift()),super.viewLoad(e),this.CurrentView&&this.CurrentView.removeListener("properties.updated",this._handlerViewUpdate).once("properties.updated",this._handlerViewUpdate);let t=$$(this.ids.toolbarMap);t.clearAll(),t.parse(e.allParents()),t.refresh(),s.viewLoad(e),s.show(),o.viewLoad(e)}viewModeChange(e,t){e!=t&&(e=1==e?"preview":"block",this.CurrentViewMode=e,s.viewModeChange(this.CurrentViewMode),this.CurrentView&&this.viewLoad(this.CurrentView))}}}var j=i(7056);function O(e){var t=function(e){var t=o(e),i=new I(e),a=new B(e);const s=e.Config.uiSettings(),r=(0,n.Z)(e);var l=r.L();return new class extends r{constructor(){var e="ui_work_interface_list";super(e,{list:"",buttonNew:""}),this.EditPopup=new t(e),this.viewList=new webix.TreeCollection}ui(){var t=this.ids;return{id:t.component,rows:[{view:"unitlist",uniteBy:l("Pages"),height:34,data:[" "],type:{height:0,headerHeight:35}},{view:e._App.custom.edittree.view,id:t.list,width:s.columnWidthLarge,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",css:"ab-tree-ui",template:(e,t)=>this.templateListItem(e,t),type:{iconGear:"<span class='webix_icon fa fa-cog'></span>"},on:{onAfterRender:()=>{this.onAfterRender()},onAfterSelect:e=>{this.onAfterSelect(e)},onAfterOpen:()=>{this.onAfterOpen()},onAfterClose:()=>{this.onAfterClose()},onBeforeEditStop:(e,t)=>{this.onBeforeEditStop(e,t)},onAfterEditStop:(e,t,i)=>{this.onAfterEditStop(e,t,i)}},onClick:{"ab-page-list-edit":(e,t,i)=>{this.clickEditMenu(e,t,i)}}},{view:"button",css:"webix_primary",id:t.buttonNew,type:"form",value:l("Add new Page"),click:()=>{this.emit("clickNewView")}}]}}async init(e,t){this.AB=e,this.on("clickNewView",(e=>{this.clickNewView(e)})),$$(this.ids.component)&&$$(this.ids.component).adjust();let n=$$(this.ids.list);this.ListComponent=n,n&&(webix.extend(n,webix.ProgressBar),n.data.unsync(),n.data.sync(this.viewList),n.adjust()),await this.EditPopup.init(e,{hideExclude:!0}),this.EditPopup.menuOptions([{label:l("Rename"),icon:"fa fa-pencil-square-o",command:"rename"},{label:l("Copy"),icon:"fa fa-files-o",command:"copy"},{label:l("Delete"),icon:"fa fa-trash",command:"delete"}]),this.EditPopup.on("click",(e=>{switch(e){case"delete":this.remove();break;case"copy":this.copy();break;case"rename":this.rename()}})),await i.init(e),i.on("cancel",(()=>{i.hide()})),i.on("save",((e,t)=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)})),a.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.callbackNewPage(e),this.ListComponent.select(e.id),this.listReady()})),a.on("cancel",(()=>{a.hide(),this.listReady()}))}addNew(){this.clickNewView(!0)}applicationLoad(e){super.applicationLoad(e),this.listBusy(),this.viewList.clearAll();var t=(e,i,n)=>{e&&(this.viewList.add(e,i,n),e.pages().forEach(((i,n)=>{t(i,n,e.id)})))};e.pages().forEach(((e,i)=>{t(e,i)}));var n=$$(this.ids.list);n.refresh(),n.unselectAll(),this.listReady(),i.applicationLoad(e),a.applicationLoad(e)}clickNewView(){i.show()}showGear(e){var t=$$(this.ids.list).getItemNode(e);if(t){var i=t.querySelector(".ab-page-list-edit");i.style.visibility="visible",i.style.display="block"}}show(){$$(this.ids.component).show()}refreshTemplateItem(e){e=e.updateIcon(e),this.viewList.updateItem(e.id,e)}rename(){var e=$$(this.ids.list).getSelectedId(!1);$$(this.ids.list).edit(e)}copy(){var t=$$(this.ids.list).getSelectedItem(!1);this.listBusy(),a.init(e,t),a.applicationLoad(this.CurrentApplication),a.show()}remove(){var e=$$(this.ids.list).getSelectedItem(!1);e&&webix.confirm({title:l("Delete Page"),text:l("Are you sure you wish to delete this page?"),ok:l("Yes"),cancel:l("No"),callback:async t=>{if(t){this.listBusy();try{await e.destroy(),this.listReady(),$$(this.ids.list).remove($$(this.ids.list).getSelectedId()),this.emit("deleted",e),this.emit("selected",null)}catch(t){this.AB.notify.developer(t,{context:"ui_interface_list:remove(): error removing item",base:e}),this.listReady()}}}})}clickEditMenu(e,t,i){return this.EditPopup.show(i),!1}callbackNewPage(e){var t=e.pageParent()||e.parent,n=t.id!=e.id?t.id:null;this.viewList.exists(e.id)||this.viewList.add(e,null,n),e.pages().forEach(((t,i)=>{this.viewList.exists(t.id)||this.viewList.add(t,i,e.id)})),$$(this.ids.list).refresh(),n&&$$(this.ids.list).open(n),this.select(e),i.hide()}listBusy(){$$(this.ids.list)?.showProgress?.({type:"icon"})}listReady(){$$(this.ids.list)?.hideProgress?.()}select(e){$$(this.ids.list).select(e.id)}templateListItem(e,t,i){i&&console.error("templateListItem(): oldWarnings: How'd we get here?"),e.warningsEval();let n="";e.warningsAll().length>0&&(n=this.WARNING_ICON);var a=`<div class='ab-page-list-item'>\n            ${t.icon(e)} <span class='webix_icon fa fa-${e.icon||e.viewIcon()}'></span> ${e.label}${n}<div class='ab-page-list-edit'>${t.iconGear}</div>\n            </div>`;return e.removeListener("properties.updated",this.refreshTemplateItem).once("properties.updated",this.refreshTemplateItem),a}onAfterOpen(){var e=$$(this.ids.list).getSelectedId(!1);e&&this.showGear(e)}onAfterRender(){var e=$$(this.ids.list).getSelectedId(!1);e&&this.showGear(e)}onAfterSelect(e){this.showGear(e);let t=$$(this.ids.list).getItem(e);this.emit("selected",t)}onBeforeEditStop(e){var t=$$(this.ids.list).getSelectedItem(!1);return t.label=e.value,!t.isValid||!t.isValid().fail()||(t.label=e.old,!1)}onAfterEditStop(e,t,n){if(this.showGear(t.id),e.value!=e.old){this.listBusy();var a=$$(this.ids.list).getSelectedItem(!1);a.label=e.value,a.save().then((()=>{this.listReady(),i.applicationLoad(this.CurrentApplication),webix.alert({text:l("<b>{0}</b> is renamed.",[e.value])})})).catch((t=>{this.listReady(),this.AB.notify.developer(t,{context:"ABFieldProperty: isValid()",base:e.value}),webix.alert({text:l("System could not rename <b>{0}</b>.",[e.value])})}))}}onAfterClose(){$$(this.ids.list).getSelectedId(!0).forEach((e=>{this.showGear(e)}))}}}(e),i=function(e){const t="ui_work_interface_workspace",i=e.Config.uiSettings(),a=(0,n.Z)(e),o=a.L(),r=s(e,`${t}_view_warnings`,{});return new class extends a{constructor(){super(t,{noSelection:"",selectedView:""}),this.ColumnEditor=T(e),this.ColumnDetails=function(e){const t=(0,n.Z)(e);var i=function(e){const t=(0,n.Z)(e),i=t.L(),a=(0,j.Z)(e);return new class extends t{constructor(){super("ui_work_interface_workspace_details_properties",{editors:"",form:""}),this._editorsByType={},this.currentPanel=null,this._handler_onChange=(e=3e3,t=!1)=>{if(!this.CurrentView)return;let i=this.currentPanel.values();Object.keys(i??{}).forEach((e=>{"settings"!=e&&(this.CurrentView[e]=i[e])}));var n=this.CurrentView.toObj();Object.keys(i.settings??{}).forEach((e=>{n.settings[e]=i.settings[e]})),this.CurrentView.fromValues(n);let a=this.CurrentView;this.pendingSave=!0,this.unloadListener||(this.unloadListener=this.AB.Webix.event(window,"beforeunload",(()=>{this._handler_onChange(0,!0)}))),a.__timedSave&&clearTimeout(a.__timedSave),a.__timedSave=setTimeout((async()=>{this.busy();try{await a.save(),delete a.__timedSave}catch(e){this.AB.notify.developer(e,{message:"Error trying to save the View:",view:a.toObj()}),a.AB.message({text:this.label("Error trying to save the View"),type:"error"})}finally{this.ready(),this.pendingSave=!1,this.AB.Webix.eventRemove(this.unloadListener),delete this.unloadListener,this.emit("warnings")}}),e),t||this.emit("view.changed")}}ui(){let e=this.ids;return{id:e.component,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"spacer",width:10},{view:"label",label:i("Properties")},{view:"icon",icon:"fa fa-info-circle",tooltip:i("Tip"),on:{onItemClick:()=>{this.infoAlert()}}}]},{id:e.editors,rows:[{}]}]}}init(e){this.AB=e,a.views().forEach((e=>{this._editorsByType[e.key]=e}));const t=$$(this.ids.component);t&&this.AB.Webix.extend(t,this.AB.Webix.ProgressBar)}infoAlert(){webix.alert({title:i("Tip"),text:i("Edit a widgets properties here.")})}show(){$$(this.ids.component).expand()}viewLoad(e){if(this.currentPanel&&e.id!=this.CurrentViewID&&(this.pendingSave&&this._handler_onChange(10,!0),this.currentPanel.removeAllListeners("changed"),this.currentPanel=null),e.id!=this.CurrentViewID){super.viewLoad(e);let t=this._editorsByType[e.key];if(t){let i=new t;i.applicationLoad(this.CurrentApplication);let n=[i.ui()];webix.ui(n,$$(this.ids.editors)),i.init(this.AB),i.populate(e),i.on("changed",this._handler_onChange),this.currentPanel=i}}}ready(){const e=$$(this.ids.component);e?.enable?.(),e?.hideProgress?.()}busy(){const e=$$(this.ids.component);e?.showProgress?.({type:"icon"}),e?.disable?.()}}}(e);return new class extends t{constructor(){super("ui_work_interface_workspace_details")}ui(){return{id:this.ids.component,width:350,rows:[i.ui()]}}init(e){return this.AB=e,i.on("view.changed",(()=>{this.emit("view.changed")})),this.warningsPropogate([i]),i.init(e)}applicationLoad(e){super.applicationLoad(e),i.applicationLoad(e)}show(){$$(this.ids.component).show()}viewLoad(e){super.viewLoad(e),i.viewLoad(e)}}}(e),this.classABViewPage=e.Class.ABViewManager.viewClass("page")}ui(){let e=this.ids;return{view:"multiview",id:e.component,scroll:!0,cells:[{id:e.noSelection,rows:[{maxHeight:i.xxxLargeSpacer,hidden:i.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-file-text-o'></div>"},{view:"label",align:"center",label:o("Select a page to edit")},{cols:[{},{view:"button",css:"webix_primary",label:o("Add a new page"),type:"form",autowidth:!0,click:()=>{this.emit("view.new")}},{}]},{maxHeight:i.xxxLargeSpacer,hidden:i.hideMobile}]},{id:e.selectedView,view:"layout",rows:[{cols:[this.ColumnEditor.ui(),{view:"resizer",css:"bg_gray",width:11},this.ColumnDetails.ui()]},r.ui()]}]}}init(e){this.AB=e,$$(this.ids.noSelection).show(),$$(this.ids.selectedView).hide();var t=[];return t.push(this.ColumnEditor.init(e)),t.push(this.ColumnDetails.init(e)),this.ColumnEditor.on("view.load",(e=>{this.viewLoad(e)})),this.ColumnDetails.on("view.changed",(()=>{this.ColumnEditor.viewLoad(this.CurrentView)})),this.warningsPropogate([this.ColumnEditor,this.ColumnDetails]),this.on("warnings",(()=>{this.viewLoad(this.CurrentView)})),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.ColumnEditor.applicationLoad(e),this.ColumnDetails.applicationLoad(e)}show(){$$(this.ids.component)?.show()}clearWorkspace(){$$(this.ids.noSelection)?.show(!1,!1)}viewLoad(e){super.viewLoad(e),$$(this.ids.selectedView)?.show(),this.ColumnEditor.viewLoad(e),this.ColumnDetails.viewLoad(e),$$(this.ids.component)?.resize(),e instanceof this.classABViewPage&&this.emit("select.view",e),r.show(e)}}}(e);const a=(0,n.Z)(e);return new class extends a{constructor(){super("ab_work_interface")}ui(){return{id:this.ids.component,type:"space",margin:10,cols:[t.ui(),{view:"resizer"},i.ui()]}}init(e){return this.AB=e,t.on("selected",(e=>{this.select(e)})),i.on("view.new",(()=>{t.clickNewView()})),i.on("select.view",(e=>{t.select(e)})),this.warningsPropogate([t,i]),this.on("warnings",(()=>{t.applicationLoad(this.CurrentApplication)})),Promise.all([i.init(e),t.init(e)])}applicationLoad(e){super.applicationLoad(e),t.applicationLoad(e),i.applicationLoad(e)}show(){$$(this.ids.component).show(),this.CurrentApplication&&t?.applicationLoad(this.CurrentApplication)}select(e){e?i.viewLoad(e):i.clearWorkspace()}}}function M(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_datacollection_list_newDataCollection",{tab:""}),this.selectNew=!0,this.BlankTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_dataCollection_list_newDataCollection_blank",{form:"",buttonSave:"",buttonCancel:"",object:""})}ui(){return{id:this.ids.component,header:i("Create"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Data Collection name"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_dataCollection_list_newDatacollection_blank_name")}}},{id:this.ids.object,view:"richselect",label:i("Object"),name:"object",required:!0,placeholder:i("Select an object"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_dataCollection_list_newDatacollection_blank_object")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Data Collection"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){t.CYPRESS_REF(this)}}}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$buttonSave=$$(this.ids.buttonSave),this.$objectList=$$(this.ids.object),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear())}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating DataCollection: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.formClear(),this.$buttonSave.enable()}save(){this.$buttonSave.disable();var e=this.$form;if(e.clearValidation(),!e.validate())return this.$buttonSave.enable(),!1;let t=e.getValues(),i=t.object,n=this.AB.objectByID(i);n||(n=this.AB.queryByID(i));let a={name:t.name,label:t.name,settings:{datasourceID:i,isQuery:n?.isQuery??!1}};this.emit("save",a)}show(){$$(this.ids.component)&&$$(this.ids.component).show()}onShow(e){if(this.$objectList&&e){let t=[];t=t.concat(e.objectsIncluded().map((e=>({id:e.id,value:e.label,icon:"fa fa-database",isQuery:!1})))),t=t.concat(e.queriesIncluded().map((e=>({id:e.id,value:e.label,icon:"fa fa-filter",isQuery:!0})))),this.$objectList.define("options",t),this.$objectList.refresh();let i=this.$objectList.getPopup();i.attachEvent("onShow",(()=>{i.define("width",350),i.resize()}))}this.$form&&this.$form.setValues({name:"",object:""})}}}(e),this.ImportTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_datacollection_list_newDatacollection_import",{form:"",filter:"",datacollectionList:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Existing"),body:{view:"form",id:this.ids.form,width:400,elements:[{cols:[{view:"icon",icon:"fa fa-filter",align:"left"},{view:"text",id:this.ids.filter,on:{onTimedKeyPress:()=>this.filter()}}]},{view:"list",id:this.ids.datacollectionList,select:!0,height:200,minHeight:250,maxHeight:250,data:[],template:"<div>#label#</div>"},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>this.cancel()},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Import"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}async init(e){this.AB=e,this.$form=$$(this.ids.form),this.$filter=$$(this.ids.filter),this.$datacollectionList=$$(this.ids.datacollectionList),this.$buttonSave=$$(this.ids.buttonSave),this.$buttonCancel=$$(this.ids.buttonCancel),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()}))}onShow(e){this.formClear();const t=e.datacollectionsExcluded();this.$datacollectionList.parse(t,"json")}filter(){let e=this.$filter.getValue();this.$datacollectionList.filter("#label#",e)}save(){let e=this.$datacollectionList.getSelectedItem();if(!e)return!1;this.$buttonSave.disable(),this.emit("save",e)}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear()),this.$datacollectionList&&this.$datacollectionList.clearAll()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;let n=this.$form.getValues();webix.alert({title:i("Error creating DataCollection: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.$buttonSave.enable()}}}(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new Data Collection"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},selectNewDataCollection:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui(),this.ImportTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((t=>{var i=t.getAttribute("button_id");e.ClassUI.CYPRESS_REF(t,`${i}_tab`)}))}}}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);let t=[];return["BlankTab","ImportTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{if(e.id)return this.import(e,i);this.save(e,i)}))})),Promise.all(t)}busy(){this.$component?.showProgress?.()}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}hide(){this.$component?.hide()}async import(e,t){this.busy();try{await this.CurrentApplication.datacollectionInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}ready(){this.$component?.hideProgress?.()}async save(e,t){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;let n=this.AB.datacollectionNew(e),a=n.isValid();if(a.fail())return this[t].emit("save.error",a),!1;n.createdInAppID||(n.createdInAppID=this.CurrentApplicationID),this.busy();try{let e=await n.save();await this.CurrentApplication.datacollectionInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}show(e){null!=e&&(this.selectNew=e),this.$component?.show();const t=$$(this.ids.tab).getValue();this.switchTab(t)}switchTab(e){e!=this.BlankTab?.ui()?.body?.id&&e?e==this.ImportTab?.ui()?.body?.id&&this.ImportTab?.onShow?.(this.CurrentApplication):this.BlankTab?.onShow?.(this.CurrentApplication)}}}(e);return new class extends t{constructor(){super("ui_work_datacollection_list");let t=this;this.ListComponent=l(e,{idBase:this.ids.component,labels:{addNew:"Add new data collection",confirmDeleteTitle:"Delete Data Collection",title:"Data Collections",searchPlaceholder:"Data Collection name"},menu:{copy:!1,exclude:!0},templateListItem:function(e,i,n){let a="";return n?.length>0&&(a=t.WARNING_ICON),`<div class='ab-datacollection-list-item'>\n                  <i class="fa ${e.settings.isQuery?"fa-filter":"fa-database"}"></i>\n                  ${e.label||"??label??"}\n                  ${a}\n                  ${i.iconGear(e)}\n               </div>`}})}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewDataCollection(e)})),await this.ListComponent.init(e),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("addNew",(e=>{this.clickNewDataCollection(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),await i.init(e),i.on("cancel",(()=>{i.hide()})),i.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)}))}applicationLoad(e){var t=this.CurrentApplicationID,n=null;super.applicationLoad(e),t==this.CurrentApplicationID&&(n=this.ListComponent.selectedItem());var a=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(a=()=>!0),this.ListComponent.dataLoad(e?.datacollectionsIncluded(a)),n&&this.ListComponent.selectItem(n.id),i.applicationLoad(e)}warningsRefresh(){if(this.CurrentApplication){var e=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(e=()=>!0);let t=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.datacollectionsIncluded(e)),this.ListComponent.selectItem(t.id)}}async exclude(e){this.ListComponent.busy();var t=this.CurrentApplication;await(t?.datacollectionRemove(e)),this.ListComponent.dataLoad(t?.datacollectionsIncluded()),this.emit("selected",null)}ready(){this.ListComponent.ready()}clickNewDataCollection(){i.show()}}}(e),a=function(e,t){const i="ui_work_datacollection_workspace",a=e.Config.uiSettings(),o=(0,n.Z)(e),r=o.L(),l=A(e,`${i}_view_grid`,t),c=function(e){const t="ui_work_datacollection_workspace_properties",i=(0,n.Z)(e),a=e.Config.uiSettings(),o=e.custom,s=i.L();return new class extends i{constructor(){super(t,{propertyPanel:"",dataSource:"",linkDatacollection:"",linkField:"",followCursor:"",loadAllPanel:"",loadAll:"",fixSelect:"",filterPanel:"",populate:"",populateOptions:"",sortPanel:"",buttonFilter:"",buttonSort:"",list:"",filter:"",sort:""}),this.AB=e,this._templateListItem="\n            <div class='ab-page-list-item'>\n               {common.icon()} <span class='webix_icon fa fa-#typeIcon#'></span> #label# #hasDataCollection#\n            </div>\n         ",this._handler_loadData=e=>{this.populateFixSelector(e)},this.viewList=null,this.FilterComponent=this.AB.filterComplexNew(this.ids.filter),this.PopupSortFieldComponent=(0,$.Z)(e,t)}ui(){const e=this.ids,t=this;return{width:a.columnWidthXLarge,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"spacer",width:10},{view:"label",label:s("Properties")}]},{view:"scrollview",id:e.propertyPanel,body:{padding:15,rows:[{view:"fieldset",label:s("Data Source:"),labelWidth:a.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.dataSource,view:"richselect",name:"dataSource",label:s("Source:"),labelWidth:a.labelWidthLarge,options:{data:[]},on:{onChange:(e,t)=>{e!=t&&(this.selectSource(e,t),this.save())}}},{id:e.linkDatacollection,view:"select",name:"linkDatacollection",label:s("Linked To:"),labelWidth:a.labelWidthLarge,options:[],hidden:1,on:{onChange:e=>{this.initLinkFieldOptions(e),this.save()}}},{id:e.linkField,view:"select",name:"linkField",label:s("Linked Field:"),labelWidth:a.labelWidthLarge,options:[],hidden:1,on:{onChange:()=>{this.save()}}},{id:e.followCursor,view:"select",name:"followCursor",label:s("Follow Cursor:"),labelWidth:a.labelWidthLarge,hidden:1,on:{onChange:()=>{this.changeFollowCursor(),this.save()}}}]}},{view:"fieldset",label:s("Advanced Options:"),labelWidth:a.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.filterPanel,name:"filterPanel",cols:[{view:"label",label:s("Filter Data:"),width:a.labelWidthLarge},{id:e.buttonFilter,css:"webix_primary",view:"button",name:"buttonFilter",label:s("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){t.showFilterPopup(this.$view)}}]},{id:e.sortPanel,name:"sortPanel",cols:[{view:"label",label:s("Sort Data:"),width:a.labelWidthLarge},{id:e.buttonSort,css:"webix_primary",view:"button",name:"buttonSort",label:s("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){t.showSortPopup(this.$view)}}]},{id:e.loadAllPanel,cols:[{view:"label",label:s("Load all:"),width:a.labelWidthLarge},{id:e.loadAll,view:"checkbox",name:"loadAll",label:"",on:{onChange:()=>{this.save()}}}]},{id:e.populate,view:"radio",name:"populate",label:s("Load Connections:"),labelWidth:a.labelWidthXLarge,labelPosition:"top",value:"all",tooltip:"#value# - #description#<br>#tip#",options:[{id:"all",value:s("All"),description:s("Load all the connected data"),tip:s("Will impact perfomance if your object has many connections")},{id:"none",value:s("None"),description:s("Don't load any connected data"),tip:s("Will load fast, but won't work with linked data collections")},{id:"custom",value:s("Custom"),description:s("Select the relevant connections to load"),tip:""}],on:{onItemClick:()=>{"custom"==$$(e.populate).getValue()?$$(e.populateOptions).show():(this.save(),$$(e.populateOptions).hide())}}},{id:e.populateOptions,view:"multicombo",name:"populateOptions",hidden:!0,placeholder:s("Select connections to load"),on:{onChange:()=>this.save()}},{id:e.fixSelect,view:"select",name:"fixSelect",label:s("Select:"),labelWidth:a.labelWidthLarge,options:[],on:{onChange:()=>{this.save()}}}]}},{view:"fieldset",label:s("Data used in..."),labelWidth:a.labelWidthLarge,body:{view:o.edittree.view,id:e.list,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",borderless:!0,padding:0,css:"ab-tree-ui",minHeight:300,template:(e,t)=>this.templateListItem(e,t),type:{iconGear:"<span class='webix_icon fa fa-cog'></span>"},on:{onAfterSelect:e=>{this.onAfterSelect(e)}}}},{maxHeight:a.mediumSpacer,height:a.mediumSpacer,minHeight:a.mediumSpacer,hidden:a.hideMobile}]}}]}}async init(e){this.AB=e;const t=this.ids,i=$$(t.list),n=$$(t.propertyPanel);i&&(webix.extend(i,webix.ProgressBar),i.adjust()),n&&webix.extend(n,webix.ProgressBar),this.initPopupEditors(),this.FilterComponent.myPopup=webix.ui({view:"popup",height:240,width:480,hidden:!0,body:this.FilterComponent.ui}),this.FilterComponent.on("save",(()=>{this.onFilterChange(),this.save()})),this.PopupSortFieldComponent.on("changed",(e=>{this.onSortChange(e),this.save()}))}onAfterSelect(e){const t=this.ids,i=$$(t.list).getItem(e),n=this.CurrentApplication.views((e=>e.id==i.id))[0];setTimeout((()=>{this.emit("interface",n)}),50)}applicationLoad(e){super.applicationLoad(e);const t=this.ids;this.refreshDataSourceOptions(),this.listBusy(),this.viewList=new webix.TreeCollection;const i=(e,t,n)=>{if("docxBuilder"==e.key&&e?.datacollections?.forEach)e.datacollections.forEach((i=>{const a={id:e.id+i.id,label:e.label,icon:e.icon?e.icon:"",viewIcon:e.viewIcon?e.viewIcon():"",datacollection:{id:i.id}};this.viewList.add(a,t,n)}));else{const i={id:e.viewId||e.id,label:e.label,icon:e.icon?e.icon:"",viewIcon:e.viewIcon?e.viewIcon():"",datacollection:{id:e.datacollection?e.datacollection.id:""}};this.viewList.add(i,t,n)}const a=e.pages?e.pages():[];a.forEach(((t,n)=>{i(t,n,e.id)})),a.forEach(((t,n)=>{const o=a.length+n;i(t,o,e.id)})),a.forEach(((t,n)=>{t.views().forEach(((t,o)=>{const s=a.length+n+o;i(t,s,e.id)}))}))};this.CurrentApplication.pages().forEach(((e,t)=>{i(e,t)}));const n=$$(t.list);n.clearAll(),n.data.unsync(),n.data.sync(this.viewList),n.refresh(),n.parse(this.viewList),n.unselectAll(),this.listReady()}datacollectionLoad(e){const t=this.ids;super.datacollectionLoad(e);let i={};const n=$$(t.filterPanel),a=$$(t.sortPanel),o=$$(t.dataSource),s=$$(t.linkDatacollection),r=$$(t.linkField),l=$$(t.followCursor),c=$$(t.loadAll),d=$$(t.fixSelect),u=$$(t.populate),h=$$(t.list);this.CurrentDatacollection&&(i=this.CurrentDatacollection.settings||{},this.CurrentDatacollection.removeListener("loadData",this._handler_loadData),this.CurrentDatacollection.on("loadData",this._handler_loadData)),this.initLinkDatacollectionOptions(),this.initLinkFieldOptions(this.CurrentDatacollection?.datacollectionLink?.id||null),this.populatePopupEditors(),this.populateBadgeNumber(),i.isQuery?(n.hide(),a.hide()):(n.show(),a.show()),this.refreshDataSourceOptions(),o.define("value",i.datasourceID),s.define("value",i.linkDatacollectionID),r.define("value",i.linkFieldID),l.define("value",i.followDatacollectionID),c.define("value",i.loadAll),d.define("value",i.fixSelect);const p=Array.isArray(i.populate)?"custom":i.populate?"all":"none";u.define("value",p),"custom"==p?($$(t.populateOptions).define("value",i.populate),$$(t.populateOptions).refresh(),$$(t.populateOptions).show()):$$(t.populateOptions).hide(),this.initPopulateOptions(),this.initFollowCursorOptions(),this.changeFollowCursor(),o.refresh(),s.refresh(),r.refresh(),l.refresh(),c.refresh(),d.refresh(),u.refresh(),h.openAll()}initPopulateOptions(){const e=this.ids,t=this.CurrentDatacollection?.datasource??null,i=t?.connectFields()??[];t&&i.length>0?($$(e.populate).enable(),$$(e.populateOptions).define("options",i.map((e=>({id:e.columnName,value:e.label})))),$$(e.populateOptions).refresh()):$$(e.populate).disable()}refreshDataSourceOptions(){if(!this.CurrentApplication)return;const e=this.ids;let t=[];const i=this.CurrentApplication.objectsIncluded().map((e=>e?{id:e.id,value:e.label,isQuery:!1,icon:"fa fa-database"}:null));t=t.concat(i);const n=this.CurrentApplication.queriesIncluded().map((e=>e?{id:e.id,value:e.label,isQuery:!0,icon:"fa fa-filter",disabled:e?.isDisabled()}:null));t=t.concat(n),t=t.filter((e=>null!==e)),t.unshift({id:"",value:s("Select a source")}),$$(e.dataSource).define("options",{body:{scheme:{$init:function(e){e.disabled&&(e.$css="disabled")}},data:t}}),$$(e.dataSource).refresh()}initFollowCursorOptions(){const e=$$(this.ids.followCursor),t=[];let i=[];this.CurrentDatacollection?.datasource&&(i=this.CurrentApplication.datacollectionsIncluded().filter((e=>e?.id!=this.CurrentDatacollection.id&&(e?.settings?.datasourceID==this.CurrentDatacollection.datasource.id||1==e?.settings?.isQuery&&e?.datasource?.objectIDs[0]==this.CurrentDatacollection.datasource.id)))),i?.length>0&&i.forEach((e=>{t.push({id:e.id,value:e.label})})),t.unshift({id:"",value:s("Select a data collection")}),e.define("options",t),e.define("value",this.CurrentDatacollection?.settings?.followDatacollectionID??null),e.refresh()}busy(){const e=this.ids,t=$$(e.propertyPanel);t?.showProgress&&t.showProgress({type:"icon"})}ready(){const e=this.ids,t=$$(e.propertyPanel);t?.hideProgress&&t.hideProgress()}changeFollowCursor(){const e=this.ids,t=this.CurrentDatacollection?.settings??{},i=$$(e.followCursor),n=$$(e.linkDatacollection),a=$$(e.linkField),o=$$(e.filterPanel),s=$$(e.sortPanel),r=$$(e.loadAllPanel),l=$$(e.fixSelect);i.getValue()?(n.hide(),a.hide(),o.hide(),s.hide(),r.hide(),l.hide()):(n.show(),t.isQuery||(o.show(),s.show()),r.show(),l.show())}save(){if(!this.CurrentDatacollection)return Promise.resolve();this.busy();const e=this.ids,t=this.CurrentDatacollection.settings||{};t.datasourceID=$$(e.dataSource).getValue(),t.linkDatacollectionID=$$(e.linkDatacollection).getValue(),t.linkFieldID=$$(e.linkField).getValue(),t.followDatacollectionID=$$(e.followCursor).getValue(),t.objectWorkspace={},t.objectWorkspace.filterConditions=this.FilterComponent.getValue(),t.objectWorkspace.sortFields=this.PopupSortFieldComponent.getSettings(),t.loadAll=$$(e.loadAll).getValue(),t.fixSelect=$$(e.fixSelect).getValue();const i=$$(e.populate).getValue();t.populate="all"==i||"none"!=i&&$$(e.populateOptions).getValue().split(","),this.CurrentDatacollection.settings=t;const n=$$(e.dataSource).getPopup().getList().getItem(this.CurrentDatacollection.settings.datasourceID);return this.CurrentDatacollection.settings.isQuery=!!n&&n.isQuery,new Promise(((e,t)=>{this.CurrentDatacollection.save().then((()=>{this.CurrentDatacollection.clearAll(),this.ready(),this.emit("save",this.CurrentDatacollection),e()})).catch((e=>{this.ready(),t(e)}))}))}initLinkDatacollectionOptions(){const e=this.ids,t=this.CurrentDatacollection?.datasource||null,i=$$(e.linkDatacollection),n=$$(e.linkField),a=$$(e.followCursor);if(t){const e=t.connectFields().map((e=>e.settings.linkObject)),o=[],r=this.CurrentApplication.datacollectionsIncluded().filter((t=>e.includes(t?.settings.datasourceID)));r?.length>0?(r.forEach((e=>{o.push({id:e.id,value:e.label})})),o.unshift({id:"",value:s("Select a link source")}),i.show(),i.define("options",o),i.define("value",this.CurrentDatacollection?.settings?.linkDatacollectionID||""),i.refresh(),a.hide()):(i.hide(),n.hide(),a.show())}else i.hide(),n.hide(),a.show()}initLinkFieldOptions(e=null){const t=this.ids,i=[],n=e?this.AB.datacollectionByID(e):null;if(n){const e=this.CurrentDatacollection.datasource,t=n.datasource;e.connectFields().filter((e=>e.settings.linkObject==(t||{}).id)).forEach((e=>{i.push({id:e.id,value:e.label})}))}const a=$$(t.linkField);i.length>0?a.show():a.hide();let o=i[0]?i[0].id:"";this.CurrentDatacollection?.settings&&(o=this.CurrentDatacollection.settings.linkFieldID),a.define("options",i),a.define("value",o),a.refresh();const s=$$(t.followCursor);i.length<1||!o?s.show():s.hide(),s.define("value",this.CurrentDatacollection?.settings?.followCursor),s.refresh()}populatePopupEditors(){const e=this.CurrentDatacollection||null,t=e?.datasource||null;if(t){const i=e?.settings?.objectWorkspace?.filterConditions||{glue:"and",rules:[]},n=e?.settings?.objectWorkspace?.sortFields||[];this.FilterComponent.fieldsLoad(t?t.fields():[]),this.FilterComponent.queriesLoad(this.CurrentApplication?.queriesIncluded()),this.FilterComponent.setValue(i),this.CurrentDatacollection.refreshFilterConditions(i),this.PopupSortFieldComponent.objectLoad(t),this.PopupSortFieldComponent.setSettings(n)}}populateBadgeNumber(){const e=this.ids,t=this.CurrentDatacollection,i=$$(e.buttonFilter),n=$$(e.buttonSort);t?.settings?.objectWorkspace?.filterConditions?.rules?(i.define("badge",t.settings.objectWorkspace.filterConditions.rules?.length||null),i.refresh()):(i.define("badge",null),i.refresh()),t?.settings?.objectWorkspace?.sortFields?(n.define("badge",t.settings.objectWorkspace.sortFields.length||null),n.refresh()):(n.define("badge",null),n.refresh())}populateFixSelector(e){const t=this.ids;let i="";const n=this.CurrentDatacollection.datasource,a=e?.data?.map((e=>({id:e.id,value:n?n.displayData(e):""})))||[];n&&(n.fields((e=>"user"==e.key)).length>0&&a.unshift({id:"_CurrentUser",value:s("Current User")}),a.unshift({id:"_FirstRecord",value:s("First Record")},{id:"_FirstRecordDefault",value:s("Default to First Record")})),a.unshift({id:"",value:s("Select fix cursor")}),i=this.CurrentDatacollection.settings.fixSelect||"";const o=$$(t.fixSelect);o.define("options",a),o.define("value",i),o.refresh()}initPopupEditors(){this.FilterComponent.init(),this.PopupSortFieldComponent.init(this.AB)}selectSource(e,t){const i=this.ids,n=$$(i.dataSource).getList().getItem(e),a=$$(i.dataSource);n?.disabled&&(a.blockEvent(),a.setValue(t||""),a.unblockEvent());const o=this.CurrentDatacollection.toObj()||{};o.settings=o.settings||{},o.settings.datasourceID=e,this.CurrentDatacollection.fromValues(o);const s=$$(i.filterPanel),r=$$(i.sortPanel);n.isQuery?(s.hide(),r.hide()):(this.initLinkDatacollectionOptions(),this.initLinkFieldOptions(this.CurrentDatacollection?.datacollectionLink?.id||null),this.initPopupEditors(),this.populatePopupEditors(),this.populateBadgeNumber(),s.show(),r.show())}showFilterPopup(e){this.FilterComponent.popUp(e,null,{pos:"top"})}showSortPopup(e){this.PopupSortFieldComponent.show(e,null,{pos:"top"})}onFilterChange(){if(!this.CurrentDatacollection)return;const e=this.FilterComponent.getValue();this.FilterComponent.isConditionComplete(e)||this.FilterComponent.setValue({glue:"and",rules:[]}),this.populateBadgeNumber()}onSortChange(e){const t=this.CurrentDatacollection;t&&(t.settings=t.settings||{},t.settings.objectWorkspace=t.settings.objectWorkspace||{},t.settings.objectWorkspace.sortFields=e||[],this.populateBadgeNumber())}switchTab(){}templateListItem(e,t){let i=this._templateListItem,n="";return e.datacollection&&this.CurrentDatacollection?.id&&e.datacollection.id==this.CurrentDatacollection.id&&(n="<i class='webix_icon hasDataCollection fa fa-check-circle'></i>"),i=i.replace("#typeIcon#",e.icon||e.viewIcon()).replace("#label#",e.label).replace("{common.icon()}",t.icon(e)).replace("#hasDataCollection#",n),i}listBusy(){const e=this.ids,t=$$(e.list);t?.showProgress&&t.showProgress({type:"icon"})}listReady(){const e=this.ids,t=$$(e.list);t?.hideProgress&&t.hideProgress()}}}(e),d=s(e,`${i}_view_warnings`,t);return new class extends o{constructor(t,i={}){super(t,{multiview:"",noSelection:"",workspace:""}),this.AB=e,this.settings=i,this.workspaceViews=P(e,`${t}_views`,i),this.hashViewsGrid=l}ui(){const e=this.ids;return{view:"multiview",id:e.multiview,cells:[{id:e.noSelection,rows:[{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-table'></div>"},{view:"label",align:"center",label:r("Select a datacollection to work with.")},{cols:[{},{view:"button",css:"webix_primary",label:r("Add new data collection"),type:"form",autowidth:!0,click:()=>{this.emit("addNew",!0)}},{}]},{maxHeight:a.xxxLargeSpacer,hidden:a.hideMobile}]},{id:e.workspace,view:"layout",rows:[{cols:[l.ui(),{view:"resizer",css:"bg_gray",width:11},c.ui()]},d.ui()]}]}}async init(e){const t=this.ids;this.AB=e,this.warningsPropogate([c,l]),this.on("warnings",(()=>{d.show(this.mockDatacollection)})),this.workspaceViews.init(e),c.on("save",(async e=>{this.datacollectionLoad(e),this.hashViewsGrid&&await this.hashViewsGrid.show(l.defaultSettings()),await this.populateWorkspace(e)})),await l.init(e),await c.init(e),this.mockDatacollection=this.AB.datacollectionNew({}),this.mockDatacollection.init(),l.datacollectionLoad(this.mockDatacollection),c.datacollectionLoad(this.mockDatacollection),$$(t.noSelection).show()}applicationLoad(e){super.applicationLoad(e),l.applicationLoad(e),c.applicationLoad(e)}datacollectionLoad(e){super.datacollectionLoad(e),d.show(e),l.datacollectionLoad(e),c.datacollectionLoad(e),e||this.clearWorkspace()}loadAll(){l.loadAll()}loadData(){this.mockDatacollection.clearAll();try{this.mockDatacollection.loadData(0,20)}catch(e){let t=e.toString();if("string"==typeof e)try{const i=JSON.parse(e);i.data&&i.data.sqlMessage&&(t=i.data.sqlMessage)}catch(e){}this.AB.notify.developer(e,{context:"ui_work_datacollection_workspace.loadData()",message:t,datacollection:this.mockDatacollection.toObj()})}}clearWorkspace(){const e=this.ids;$$(e.noSelection).show(!1,!1)}async populateWorkspace(e){const t=this.ids;$$(t.workspace).show(),this.mockDatacollection=e,this.workspaceViews.objectLoad(null),this.mockDatacollection?.datasource?.id&&this.workspaceViews.clearObjectCache(this.mockDatacollection.datasource.id),this.workspaceViews.objectLoad(this.mockDatacollection.datasource);const i=this.workspaceViews.getCurrentView();this.hashViewsGrid&&(this.workspaceViews.setCurrentView(i.id),await this.hashViewsGrid.show(i)),await this.workspaceViews.save(),this.loadData(),this.warningsRefresh(e)}}(i,t)}(e,{allowDelete:0,configureHeaders:!1,detailsView:"",editView:"",isEditable:0,massUpdate:0,isReadOnly:!0});return new class extends t{constructor(){super("ui_work_datacollection")}ui(){return{id:this.ids.component,type:"space",cols:[i.ui(),{view:"resizer",width:11},a.ui()]}}async init(e){this.AB=e,i.on("selected",(e=>{this.select(e)})),a.on("addNew",(e=>{i.emit("addNew",e)})),this.warningsPropogate([i,a]),this.on("warnings",(()=>{i.warningsRefresh()})),await a.init(e),await i.init(e)}applicationLoad(e){const t=this.CurrentApplicationID;super.applicationLoad(e),t!=this.CurrentApplicationID&&a.clearWorkspace(),i.applicationLoad(e),a.applicationLoad(e)}show(){const e=this.ids;$$(e.component).show(!1,!1);const t=this.CurrentApplication;t&&(a.applicationLoad(t),i.applicationLoad(t)),i.ready()}select(e){null==e&&a.clearWorkspace(),a.datacollectionLoad(e),a.populateWorkspace(e)}}}var N,W,z=i(9293),U=i.n(z),q=(N=function(e){var t=e.exports=function(e,i){if(i||(i=16),void 0===e&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(i),a=2;n===1/0;a*=2)n=Math.log(Math.pow(2,e/a))/Math.log(i)*a;var o=n-Math.floor(n),s="";for(a=0;a<Math.floor(n);a++)s=Math.floor(Math.random()*i).toString(i)+s;if(o){var r=Math.pow(i,o);s=Math.floor(Math.random()*r).toString(i)+s}var l=parseInt(s,i);return l!==1/0&&l>=Math.pow(2,e)?t(e,i):s};t.rack=function(e,i,n){var a=function(a){var s=0;do{if(s++>10){if(!n)throw new Error("too many ID collisions, use more bits");e+=n}var r=t(e,i)}while(Object.hasOwnProperty.call(o,r));return o[r]=a,r},o=a.hats={};return a.get=function(e){return a.hats[e]},a.set=function(e,t){return a.hats[e]=t,a},a.bits=e||128,a.base=i||16,a}},N(W={exports:{}}),W.exports);function H(e){if(!(this instanceof H))return new H(e);e=e||[128,36,1],this._seed=e.length?q.rack(e[0],e[1],e[2]):e}H.prototype.next=function(e){return this._seed(e||!0)},H.prototype.nextPrefixed=function(e,t){var i;do{i=e+this.next(!0)}while(this.assigned(i));return this.claim(i,t),i},H.prototype.claim=function(e,t){this._seed.set(e,t||!0)},H.prototype.assigned=function(e){return this._seed.get(e)||!1},H.prototype.unclaim=function(e){delete this._seed.hats[e]},H.prototype.clear=function(){var e,t=this._seed.hats;for(e in t)this.unclaim(e)};const G=H;function Z(e){return Array.prototype.concat.apply([],e)}var Y=Object.prototype.toString,K=Object.prototype.hasOwnProperty;function X(e){return void 0===e}function Q(e){return void 0!==e}function J(e){return null==e}function ee(e){return"[object Array]"===Y.call(e)}function te(e){return"[object Object]"===Y.call(e)}function ie(e){return"[object Number]"===Y.call(e)}function ne(e){var t=Y.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t||"[object GeneratorFunction]"===t||"[object AsyncGeneratorFunction]"===t||"[object Proxy]"===t}function ae(e){return"[object String]"===Y.call(e)}function oe(e,t){return K.call(e,t)}function se(e,t){var i;return t=$e(t),le(e,(function(e,n){if(t(e,n))return i=e,!1})),i}function re(e,t){var i=[];return le(e,(function(e,n){t(e,n)&&i.push(e)})),i}function le(e,t){var i;if(!X(e)){var n=ee(e)?Ce:_e;for(var a in e)if(oe(e,a)&&!1===t(i=e[a],n(a)))return i}}function ce(e,t,i){return le(e,(function(e,n){i=t(i,e,n)})),i}function de(e,t){return!!ce(e,(function(e,i,n){return e&&t(i,n)}),!0)}function ue(e,t){return!!se(e,t)}function he(e,t){var i=[];return le(e,(function(e,n){i.push(t(e,n))})),i}function pe(e){return e&&Object.keys(e)||[]}function me(e){return pe(e).length}function fe(e){return he(e,(function(e){return e}))}function ge(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t=xe(t),le(e,(function(e){var n=t(e)||"_",a=i[n];a||(a=i[n]=[]),a.push(e)})),i}function ve(e){e=xe(e);for(var t={},i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];le(n,(function(i){return ge(i,e,t)}));var o=he(t,(function(e,t){return e[0]}));return o}var be=ve;function ye(e,t){t=xe(t);var i=[];return le(e,(function(e,n){for(var a=t(e,n),o={d:a,v:e},s=0;s<i.length;s++)if(a<i[s].d)return void i.splice(s,0,o);i.push(o)})),he(i,(function(e){return e.v}))}function we(e){return function(t){return de(e,(function(e,i){return t[i]===e}))}}function xe(e){return ne(e)?e:function(t){return t[e]}}function $e(e){return ne(e)?e:function(t){return t===e}}function _e(e){return e}function Ce(e){return Number(e)}function Ee(e,t){var i,n,a,o;function s(i){var s=Date.now(),c=i?0:o+t-s;if(c>0)return r(c);e.apply(a,n),l()}function r(e){i=setTimeout(s,e)}function l(){i&&clearTimeout(i),i=o=n=a=void 0}function c(){o=Date.now();for(var e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];n=s,a=this,i||r(t)}return c.flush=function(){i&&s(!0),l()},c.cancel=l,c}function Se(e,t){return e.bind(t)}function ke(){return ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ke.apply(this,arguments)}function Ae(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return ke.apply(void 0,[e].concat(i))}function De(e,t){var i={},n=Object(e);return le(t,(function(t){t in n&&(i[t]=e[t])})),i}function Re(e,t){var i={};return le(Object(e),(function(e,n){-1===t.indexOf(n)&&(i[n]=e)})),i}function Pe(e,t,i){return 2==arguments.length?e.getAttribute(t):null===i?e.removeAttribute(t):(e.setAttribute(t,i),e)}var Le=[].indexOf,Ve=function(e,t){if(Le)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1},Fe=/\s+/,Ie=Object.prototype.toString;function Be(e){return new Te(e)}function Te(e){if(!e||!e.nodeType)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}function je(e){for(var t;e.childNodes.length;)t=e.childNodes[0],e.removeChild(t);return e}Te.prototype.add=function(e){if(this.list)return this.list.add(e),this;var t=this.array();return~Ve(t,e)||t.push(e),this.el.className=t.join(" "),this},Te.prototype.remove=function(e){if("[object RegExp]"==Ie.call(e))return this.removeMatching(e);if(this.list)return this.list.remove(e),this;var t=this.array(),i=Ve(t,e);return~i&&t.splice(i,1),this.el.className=t.join(" "),this},Te.prototype.removeMatching=function(e){for(var t=this.array(),i=0;i<t.length;i++)e.test(t[i])&&this.remove(t[i]);return this},Te.prototype.toggle=function(e,t){return this.list?(void 0!==t?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this):(void 0!==t?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e),this)},Te.prototype.array=function(){var e=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(Fe);return""===e[0]&&e.shift(),e},Te.prototype.has=Te.prototype.contains=function(e){return this.list?this.list.contains(e):!!~Ve(this.array(),e)};var Oe="undefined"!=typeof Element?Element.prototype:{},Me=Oe.matches||Oe.matchesSelector||Oe.webkitMatchesSelector||Oe.mozMatchesSelector||Oe.msMatchesSelector||Oe.oMatchesSelector,Ne=function(e,t){if(!e||1!==e.nodeType)return!1;if(Me)return Me.call(e,t);for(var i=e.parentNode.querySelectorAll(t),n=0;n<i.length;n++)if(i[n]==e)return!0;return!1};function We(e,t,i){for(var n=i?e:e.parentNode;n&&n.nodeType!==document.DOCUMENT_NODE&&n.nodeType!==document.DOCUMENT_FRAGMENT_NODE;){if(Ne(n,t))return n;n=n.parentNode}return Ne(n,t)?n:null}var ze,Ue=window.addEventListener?"addEventListener":"attachEvent",qe=window.removeEventListener?"removeEventListener":"detachEvent",He="addEventListener"!==Ue?"on":"",Ge={bind:function(e,t,i,n){return e[Ue](He+t,i,n||!1),i},unbind:function(e,t,i,n){return e[qe](He+t,i,n||!1),i}},Ze=["focus","blur"],Ye=function(e,t,i,n,a){return-1!==Ze.indexOf(i)&&(a=!0),Ge.bind(e,i,(function(i){var a=i.target||i.srcElement;i.delegateTarget=We(a,t,!0),i.delegateTarget&&n.call(e,i)}),a)},Ke=function(e,t,i,n){return-1!==Ze.indexOf(t)&&(n=!0),Ge.unbind(e,t,i,n)},Xe=function(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var i=/<([\w:]+)/.exec(e);if(!i)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var n=i[1];if("body"==n)return(a=t.createElement("html")).innerHTML=e,a.removeChild(a.lastChild);var a,o=Je[n]||Je._default,s=o[0],r=o[1],l=o[2];for((a=t.createElement("div")).innerHTML=r+e+l;s--;)a=a.lastChild;if(a.firstChild==a.lastChild)return a.removeChild(a.firstChild);for(var c=t.createDocumentFragment();a.firstChild;)c.appendChild(a.removeChild(a.firstChild));return c},Qe=!1;"undefined"!=typeof document&&((ze=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',Qe=!ze.getElementsByTagName("link").length,ze=void 0);var Je={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:Qe?[1,"X<div>","</div>"]:[0,"",""]};function et(e,t){return(t=t||document).querySelector(e)}function tt(e,t){return(t=t||document).querySelectorAll(e)}function it(e){e.parentNode&&e.parentNode.removeChild(e)}function nt(e,t){return t.appendChild(function(e,t){if(e.ownerDocument!==t.ownerDocument)try{return t.ownerDocument.importNode(e,!0)}catch(e){}return e}(e,t))}function at(e,t){return nt(t,e),e}Je.td=Je.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],Je.option=Je.optgroup=[1,'<select multiple="multiple">',"</select>"],Je.thead=Je.tbody=Je.colgroup=Je.caption=Je.tfoot=[1,"<table>","</table>"],Je.polyline=Je.ellipse=Je.polygon=Je.circle=Je.text=Je.line=Je.path=Je.rect=Je.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var ot={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function st(e,t,i){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=ot[n];a?(2===a&&"number"==typeof i&&(i=String(i)+"px"),e.style[n]=i):e.setAttributeNS(null,t,i)}function rt(e,t,i){if("string"==typeof t){if(void 0===i)return function(e,t){return ot[t]?e.style[t]:e.getAttributeNS(null,t)}(e,t);st(e,t,i)}else!function(e,t){var i,n,a=Object.keys(t);for(i=0;n=a[i];i++)st(e,n,t[n])}(e,t);return e}function lt(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}var ct=/\s+/,dt=Object.prototype.toString;function ut(e){return void 0!==e}function ht(e){return new pt(e)}function pt(e){if(!e||!e.nodeType)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}function mt(e){var t=e.parentNode;return t&&t.removeChild(e),e}function ft(e){for(var t;t=e.firstChild;)mt(t);return e}function gt(e){return e.cloneNode(!0)}pt.prototype.add=function(e){if(this.list)return this.list.add(e),this;var t=this.array();return~lt(t,e)||t.push(e),ut(this.el.className.baseVal)?this.el.className.baseVal=t.join(" "):this.el.className=t.join(" "),this},pt.prototype.remove=function(e){if("[object RegExp]"===dt.call(e))return this.removeMatching(e);if(this.list)return this.list.remove(e),this;var t=this.array(),i=lt(t,e);return~i&&t.splice(i,1),this.el.className.baseVal=t.join(" "),this},pt.prototype.removeMatching=function(e){for(var t=this.array(),i=0;i<t.length;i++)e.test(t[i])&&this.remove(t[i]);return this},pt.prototype.toggle=function(e,t){return this.list?(ut(t)?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this):(ut(t)?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e),this)},pt.prototype.array=function(){var e=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(ct);return""===e[0]&&e.shift(),e},pt.prototype.has=pt.prototype.contains=function(e){return this.list?this.list.contains(e):!!~lt(this.array(),e)};var vt="http://www.w3.org/2000/svg",bt='<svg xmlns="'+vt+'"';function yt(e){var t=!1;"<svg"===e.substring(0,4)?-1===e.indexOf(vt)&&(e=bt+e.substring(4)):(e=bt+">"+e+"</svg>",t=!0);var i=function(e){var t;return(t=new DOMParser).async=!1,t.parseFromString(e,"text/xml")}(e);if(!t)return i;for(var n=document.createDocumentFragment(),a=i.firstChild;a.firstChild;)n.appendChild(a.firstChild);return n}function wt(e,t){var i;return"<"===e.charAt(0)?(i=yt(e).firstChild,i=document.importNode(i,!0)):i=document.createElementNS(vt,e),t&&rt(i,t),i}var xt=wt("svg");function $t(e,t){var i,n,a=Object.keys(t);for(i=0;n=a[i];i++)e[n]=t[n];return e}function _t(e){return e?xt.createSVGTransformFromMatrix(e):xt.createSVGTransform()}var Ct=/([&<>]{1})/g,Et=/([\n\r"]{1})/g,St={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function kt(e,t){return e.replace(t,(function(e,t){return St[t]||t}))}function At(e,t){var i,n,a,o,s;switch(e.nodeType){case 3:t.push(kt(e.textContent,Ct));break;case 1:if(t.push("<",e.tagName),e.hasAttributes())for(i=0,n=(a=e.attributes).length;i<n;++i)o=a.item(i),t.push(" ",o.name,'="',kt(o.value,Et),'"');if(e.hasChildNodes()){for(t.push(">"),i=0,n=(s=e.childNodes).length;i<n;++i)At(s.item(i),t);t.push("</",e.tagName,">")}else t.push("/>");break;case 8:t.push("\x3c!--",kt(e.nodeValue,Ct),"--\x3e");break;case 4:t.push("<![CDATA[",e.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+e.nodeType)}return t}function Dt(e,t){if(void 0!==t){try{!function(e,t){var i=yt(t);if(ft(e),t){(function(e){return"#document-fragment"===e.nodeName})(i)||(i=i.documentElement);for(var n,a=(n=i.childNodes,Array.prototype.slice.call(n)),o=0;o<a.length;o++)nt(a[o],e)}}(e,t)}catch(e){throw new Error("error parsing SVG: "+e.message)}return e}return function(e){for(var t=e.firstChild,i=[];t;)At(t,i),t=t.nextSibling;return i.join("")}(e)}function Rt(e,t){return t instanceof SVGMatrix?e.createSVGTransformFromMatrix(t):t}function Pt(e,t){var i=e.transform.baseVal;return t&&(Array.isArray(t)||(t=[t]),function(e,t){var i,n;for(e.clear(),i=0;n=t[i];i++)e.appendItem(Rt(e,n))}(i,t)),i.consolidate()}var Lt=/^class /;function Vt(e){return"[object Array]"===Object.prototype.toString.call(e)}function Ft(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function It(){var e=Array.prototype.slice.call(arguments);1===e.length&&Vt(e[0])&&(e=e[0]);var t=e.pop();return t.$inject=e,t}var Bt=/constructor\s*[^(]*\(\s*([^)]*)\)/m,Tt=/^(?:async )?(?:function\s*)?[^(]*\(\s*([^)]*)\)/m,jt=/\/\*([^*]*)\*\//m;function Ot(e){if("function"!=typeof e)throw new Error('Cannot annotate "'+e+'". Expected a function!');var t=e.toString().match(function(e){return Lt.test(e.toString())}(e)?Bt:Tt);return t&&t[1]&&t[1].split(",").map((function(e){return(t=e.match(jt))?t[1].trim():e.trim()}))||[]}function Mt(){var e=[];this.factory=function(t,i){return e.push([t,"factory",i]),this},this.value=function(t,i){return e.push([t,"value",i]),this},this.type=function(t,i){return e.push([t,"type",i]),this},this.forEach=function(t){e.forEach(t)}}function Nt(e,t){t=t||{get:function(e,t){if(i.push(e),!1===t)return null;throw s('No provider for "'+e+'"!')}};var i=[],n=this._providers=Object.create(t._providers||null),a=this._instances=Object.create(null),o=a.injector=this,s=function(e){var t=i.join(" -> ");return i.length=0,new Error(t?e+" (Resolving: "+t+")":e)},r=function(e,o){if(!n[e]&&-1!==e.indexOf(".")){for(var l=e.split("."),c=r(l.shift());l.length;)c=c[l.shift()];return c}if(Ft(a,e))return a[e];if(Ft(n,e)){if(-1!==i.indexOf(e))throw i.push(e),s("Cannot resolve circular dependency!");return i.push(e),a[e]=n[e][0](n[e][1]),i.pop(),a[e]}return t.get(e,o)},l=function(e,t){if(void 0===t&&(t={}),"function"!=typeof e){if(!Vt(e))throw new Error('Cannot invoke "'+e+'". Expected a function!');e=It(e.slice())}return{fn:e,dependencies:(e.$inject||Ot(e)).map((function(e){return Ft(t,e)?t[e]:r(e)}))}},c=function(e){var t=l(e),i=t.fn,n=t.dependencies;return new(Function.prototype.bind.apply(i,[null].concat(n)))},d=function(e,t,i){var n=l(e,i),a=n.fn,o=n.dependencies;return a.apply(t,o)},u=function(e){return It((function(t){return e.get(t)}))},h={factory:d,type:c,value:function(e){return e}};e.forEach((function(e){function t(e,t){return"value"!==e&&Vt(t)&&(t=It(t.slice())),t}if(e instanceof Mt)e.forEach((function(e){var i=e[0],a=e[1],o=e[2];n[i]=[h[a],t(a,o),a]}));else if("object"==typeof e)if(e.__exports__){var i=Object.keys(e).reduce((function(t,i){return"__"!==i.substring(0,2)&&(t[i]=e[i]),t}),Object.create(null)),a=new Nt((e.__modules__||[]).concat([i]),o),s=It((function(e){return a.get(e)}));e.__exports__.forEach((function(e){n[e]=[s,e,"private",a]}))}else Object.keys(e).forEach((function(i){if("private"!==e[i][2]){var a=e[i][0],o=e[i][1];n[i]=[h[a],t(a,o),a]}else n[i]=e[i]}))})),this.get=r,this.invoke=d,this.instantiate=c,this.createChild=function(e,t){if(t&&t.length){var i,a,s,r,l=Object.create(null),c=Object.create(null),d=[],h=[],p=[];for(var m in n)i=n[m],-1!==t.indexOf(m)&&("private"===i[2]?-1===(a=d.indexOf(i[3]))?(s=i[3].createChild([],t),r=u(s),d.push(i[3]),h.push(s),p.push(r),l[m]=[r,m,"private",s]):l[m]=[p[a],m,"private",h[a]]:l[m]=[i[2],i[1]],c[m]=!0),"factory"!==i[2]&&"type"!==i[2]||!i[1].$scope||t.forEach((function(e){-1!==i[1].$scope.indexOf(e)&&(l[m]=[i[2],i[1]],c[e]=!0)}));t.forEach((function(e){if(!c[e])throw new Error('No provider for "'+e+'". Cannot use provider from the parent!')})),e.unshift(l)}return new Nt(e,o)}}var Wt=i(2270),zt=i.n(Wt);function Ut(e,t){var i=this;t=t||1e3,e.on(["render.shape","render.connection"],t,(function(e,t){var n=e.type,a=t.element,o=t.gfx,s=t.attrs;if(i.canRender(a))return"render.shape"===n?i.drawShape(o,a,s):i.drawConnection(o,a,s)})),e.on(["render.getShapePath","render.getConnectionPath"],t,(function(e,t){if(i.canRender(t))return"render.getShapePath"===e.type?i.getShapePath(t):i.getConnectionPath(t)}))}function qt(e){return e.join(",").replace(/,?([A-z]),?/g,"$1")}function Ht(e){for(var t,i="",n=0;t=e[n];n++)i+=t.x+","+t.y+" ";return i}function Gt(e,t){var i=wt("polyline");return rt(i,{points:Ht(e)}),t&&rt(i,t),i}function Zt(e){return re(e,(function(t){return!se(e,(function(e){return e!==t&&Yt(t,e)}))}))}function Yt(e,t){if(t){if(e===t)return t;if(e.parent)return Yt(e.parent,t)}}function Kt(e,t,i){var n=!i||-1===e.indexOf(t);return n&&e.push(t),n}function Xt(e,t,i){i=i||0,ee(e)||(e=[e]),le(e,(function(e,n){var a=t(e,n,i);ee(a)&&a.length&&Xt(a,t,i+1)}))}function Qt(e,t){return function(e,t,i){var n=[],a=[];return Xt(e,(function(e,o,s){Kt(n,e,t);var r=e.children;if((-1===i||s<i)&&r&&Kt(a,r,t))return r})),n}(e,!t,-1)}function Jt(e,t){var i,n,a,o;return t=!!t,ee(e)||(e=[e]),le(e,(function(e){var s=e;e.waypoints&&!t&&(s=Jt(e.waypoints,!0));var r=s.x,l=s.y,c=s.height||0,d=s.width||0;(r<i||void 0===i)&&(i=r),(l<n||void 0===n)&&(n=l),(r+d>a||void 0===a)&&(a=r+d),(l+c>o||void 0===o)&&(o=l+c)})),{x:i,y:n,height:o-n,width:a-i}}function ei(e){return"waypoints"in e?"connection":"x"in e?"shape":"root"}function ti(e){return!(!e||!e.isFrame)}function ii(e,t){return Ae({},e||{},t||{})}function ni(e,t){Ut.call(this,e,1),this.CONNECTION_STYLE=t.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=t.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=t.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}Ut.prototype.canRender=function(){},Ut.prototype.drawShape=function(){},Ut.prototype.drawConnection=function(){},Ut.prototype.getShapePath=function(){},Ut.prototype.getConnectionPath=function(){},zt()(ni,Ut),ni.prototype.canRender=function(){return!0},ni.prototype.drawShape=function(e,t,i){var n=wt("rect");return rt(n,{x:0,y:0,width:t.width||0,height:t.height||0}),ti(t)?rt(n,Ae({},this.FRAME_STYLE,i||{})):rt(n,Ae({},this.SHAPE_STYLE,i||{})),at(e,n),n},ni.prototype.drawConnection=function(e,t,i){var n=Gt(t.waypoints,Ae({},this.CONNECTION_STYLE,i||{}));return at(e,n),n},ni.prototype.getShapePath=function(e){var t=e.x,i=e.y,n=e.width;return qt([["M",t,i],["l",n,0],["l",0,e.height],["l",-n,0],["z"]])},ni.prototype.getConnectionPath=function(e){var t,i,n=e.waypoints,a=[];for(t=0;i=n[t];t++)i=i.original||i,a.push([0===t?"M":"L",i.x,i.y]);return qt(a)},ni.$inject=["eventBus","styles"];const ai={__init__:["defaultRenderer"],defaultRenderer:["type",ni],styles:["type",function(){var e={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},t=this;this.cls=function(e,t,i){return Ae(this.style(t,i),{class:e})},this.style=function(t,i){ee(t)||i||(i=t,t=[]);var n=ce(t,(function(t,i){return Ae(t,e[i]||{})}),{});return i?Ae(n,i):n},this.computeStyle=function(e,i,n){return ee(i)||(n=i,i=[]),t.style(i||[],Ae({},n,e||{}))}}]};function oi(e,t){if(!e||!t)return-1;var i=e.indexOf(t);return-1!==i&&e.splice(i,1),i}function si(e,t,i){if(e&&t){"number"!=typeof i&&(i=-1);var n=e.indexOf(t);if(-1!==n){if(n===i)return;if(-1===i)return;e.splice(n,1)}-1!==i?e.splice(i,0,t):e.push(t)}}function ri(e,t){return e&&t?e.indexOf(t):-1}function li(e,t){return e&&t?Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)):-1}function ci(e,t,i,n){if(void 0===n&&(n=5),!e||!t||!i)return!1;var a=(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x),o=li(e,t);return Math.abs(a/o)<=n}function di(e,t){var i;return function(e,t){var i,n=(i=ee(e)?e:[e,void 0]).slice().shift();return de(i,(function(e){return Math.abs(n.y-e.y)<=2}))}(i=ee(e)?e:[e,t])?"h":!!function(e,t){var i,n=(i=ee(e)?e:[e,void 0]).slice().shift();return de(i,(function(e){return Math.abs(n.x-e.x)<=2}))}(i)&&"v"}function ui(e,t,i){return i=i||0,e.x>t.x-i&&e.y>t.y-i&&e.x<t.x+t.width+i&&e.y<t.y+t.height+i}function hi(e,t){return{x:Math.round(e.x+(t.x-e.x)/2),y:Math.round(e.y+(t.y-e.y)/2)}}var pi=i(2720),mi=i.n(pi);function fi(e){return{x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}}function gi(e){return{x:Math.round(e.x),y:Math.round(e.y)}}function vi(e){return{top:e.y,right:e.x+(e.width||0),bottom:e.y+(e.height||0),left:e.x}}function bi(e){return{x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top}}function yi(e){return gi({x:e.x+(e.width||0)/2,y:e.y+(e.height||0)/2})}function wi(e,t,i){te(i=i||0)||(i={x:i,y:i});var n=vi(e),a=vi(t),o=n.bottom+i.y<=a.top,s=n.left-i.x>=a.right,r=n.top-i.y>=a.bottom,l=o?"top":r?"bottom":null,c=n.right+i.x<=a.left?"left":s?"right":null;return c&&l?l+"-"+c:c||l||"intersect"}function xi(e,t,i){var n,a,o=(n=e,a=t,mi()(n,a));return 1===o.length||2===o.length&&li(o[0],o[1])<1?gi(o[0]):o.length>1?gi((o=ye(o,(function(e){var t=Math.floor(100*e.t2)||1;return t=((t=100-t)<10?"0":"")+t,e.segment2+"#"+t})))[i?0:o.length-1]):null}function $i(e,t){return Math.round(e*t)/t}function _i(e){return ie(e)?e+"px":e}function Ci(e,t,i){var n=wt("g");ht(n).add(t);var a=void 0!==i?i:e.childNodes.length-1;return e.insertBefore(n,e.childNodes[a]||null),n}var Ei={shape:["x","y","width","height"],connection:["waypoints"]};function Si(e,t,i,n){this._eventBus=t,this._elementRegistry=n,this._graphicsFactory=i,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(e||{})}function ki(e,t){var i="matrix("+t.a+","+t.b+","+t.c+","+t.d+","+t.e+","+t.f+")";e.setAttribute("transform",i)}Si.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Si.prototype._init=function(e){var t=this._eventBus,i=this._container=function(e){var t=(e=Ae({},{width:"100%",height:"100%"},e)).container||document.body,i=document.createElement("div");return i.setAttribute("class","djs-container"),Ae(i.style,{position:"relative",overflow:"hidden",width:_i(e.width),height:_i(e.height)}),t.appendChild(i),i}(e),n=this._svg=wt("svg");rt(n,{width:"100%",height:"100%"}),at(i,n);var a=this._viewport=Ci(n,"viewport");!1!==e.deferUpdate&&(this._viewboxChanged=Ee(Se(this._viewboxChanged,this),300)),t.on("diagram.init",(function(){t.fire("canvas.init",{svg:n,viewport:a})}),this),t.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],(function(){delete this._cachedViewbox}),this),t.on("diagram.destroy",500,this._destroy,this),t.on("diagram.clear",500,this._clear,this)},Si.prototype._destroy=function(e){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},Si.prototype._clear=function(){var e=this;this._elementRegistry.getAll().forEach((function(t){var i=ei(t);"root"===i?e.removeRootElement(t):e._removeElement(t,i)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},Si.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Si.prototype.getLayer=function(e,t){if(!e)throw new Error("must specify a name");var i=this._layers[e];if(i||(i=this._layers[e]=this._createLayer(e,t)),void 0!==t&&i.index!==t)throw new Error("layer <"+e+"> already created at index <"+t+">");return i.group},Si.prototype._getChildIndex=function(e){return ce(this._layers,(function(t,i){return i.visible&&e>=i.index&&t++,t}),0)},Si.prototype._createLayer=function(e,t){void 0===t&&(t=1);var i=this._getChildIndex(t);return{group:Ci(this._viewport,"layer-"+e,i),index:t,visible:!0}},Si.prototype.showLayer=function(e){if(!e)throw new Error("must specify a name");var t=this._layers[e];if(!t)throw new Error("layer <"+e+"> does not exist");var i=this._viewport,n=t.group,a=t.index;if(t.visible)return n;var o=this._getChildIndex(a);return i.insertBefore(n,i.childNodes[o]||null),t.visible=!0,n},Si.prototype.hideLayer=function(e){if(!e)throw new Error("must specify a name");var t=this._layers[e];if(!t)throw new Error("layer <"+e+"> does not exist");var i=t.group;return t.visible?(mt(i),t.visible=!1,i):i},Si.prototype._removeLayer=function(e){var t=this._layers[e];t&&(delete this._layers[e],mt(t.group))},Si.prototype.getActiveLayer=function(){var e=this._findPlaneForRoot(this.getRootElement());return e?e.layer:null},Si.prototype.findRoot=function(e){if("string"==typeof e&&(e=this._elementRegistry.get(e)),e){var t=this._findPlaneForRoot(function(e){for(;e.parent;)e=e.parent;return e}(e))||{};return t.rootElement}},Si.prototype.getRootElements=function(){return this._planes.map((function(e){return e.rootElement}))},Si.prototype._findPlaneForRoot=function(e){return se(this._planes,(function(t){return t.rootElement===e}))},Si.prototype.getContainer=function(){return this._container},Si.prototype._updateMarker=function(e,t,i){var n;e.id||(e=this._elementRegistry.get(e)),(n=this._elementRegistry._elements[e.id])&&(le([n.gfx,n.secondaryGfx],(function(e){e&&(i?ht(e).add(t):ht(e).remove(t))})),this._eventBus.fire("element.marker.update",{element:e,gfx:n.gfx,marker:t,add:!!i}))},Si.prototype.addMarker=function(e,t){this._updateMarker(e,t,!0)},Si.prototype.removeMarker=function(e,t){this._updateMarker(e,t,!1)},Si.prototype.hasMarker=function(e,t){return e.id||(e=this._elementRegistry.get(e)),ht(this.getGraphics(e)).has(t)},Si.prototype.toggleMarker=function(e,t){this.hasMarker(e,t)?this.removeMarker(e,t):this.addMarker(e,t)},Si.prototype.getRootElement=function(){var e=this._rootElement;return e||this._planes.length?e:this.setRootElement(this.addRootElement(null))},Si.prototype.addRootElement=function(e){var t=this._rootsIdx++;e||(e={id:"__implicitroot_"+t,children:[],isImplicit:!0});var i=e.layer="root-"+t;this._ensureValid("root",e);var n=this.getLayer(i,0);return this.hideLayer(i),this._addRoot(e,n),this._planes.push({rootElement:e,layer:n}),e},Si.prototype.removeRootElement=function(e){if("string"==typeof e&&(e=this._elementRegistry.get(e)),this._findPlaneForRoot(e))return this._removeRoot(e),this._removeLayer(e.layer),this._planes=this._planes.filter((function(t){return t.rootElement!==e})),this._rootElement===e&&(this._rootElement=null),e},Si.prototype.setRootElement=function(e,t){if(Q(t))throw new Error("override not supported");if(e!==this._rootElement){if(!e)throw new Error("rootElement required");return this._findPlaneForRoot(e)||(e=this.addRootElement(e)),this._setRoot(e),e}},Si.prototype._removeRoot=function(e){var t=this._elementRegistry,i=this._eventBus;i.fire("root.remove",{element:e}),i.fire("root.removed",{element:e}),t.remove(e)},Si.prototype._addRoot=function(e,t){var i=this._elementRegistry,n=this._eventBus;n.fire("root.add",{element:e}),i.add(e,t),n.fire("root.added",{element:e,gfx:t})},Si.prototype._setRoot=function(e,t){var i=this._rootElement;i&&(this._elementRegistry.updateGraphics(i,null,!0),this.hideLayer(i.layer)),e&&(t||(t=this._findPlaneForRoot(e).layer),this._elementRegistry.updateGraphics(e,this._svg,!0),this.showLayer(e.layer)),this._rootElement=e,this._eventBus.fire("root.set",{element:e})},Si.prototype._ensureValid=function(e,t){if(!t.id)throw new Error("element must have an id");if(this._elementRegistry.get(t.id))throw new Error("element <"+t.id+"> already exists");var i=Ei[e],n=de(i,(function(e){return void 0!==t[e]}));if(!n)throw new Error("must supply { "+i.join(", ")+" } with "+e)},Si.prototype._setParent=function(e,t,i){si(t.children,e,i),e.parent=t},Si.prototype._addElement=function(e,t,i,n){i=i||this.getRootElement();var a=this._eventBus,o=this._graphicsFactory;this._ensureValid(e,t),a.fire(e+".add",{element:t,parent:i}),this._setParent(t,i,n);var s=o.create(e,t,n);return this._elementRegistry.add(t,s),o.update(e,t,s),a.fire(e+".added",{element:t,gfx:s}),t},Si.prototype.addShape=function(e,t,i){return this._addElement("shape",e,t,i)},Si.prototype.addConnection=function(e,t,i){return this._addElement("connection",e,t,i)},Si.prototype._removeElement=function(e,t){var i=this._elementRegistry,n=this._graphicsFactory,a=this._eventBus;if(e=i.get(e.id||e))return a.fire(t+".remove",{element:e}),n.remove(e),oi(e.parent&&e.parent.children,e),e.parent=null,a.fire(t+".removed",{element:e}),i.remove(e),e},Si.prototype.removeShape=function(e){return this._removeElement(e,"shape")},Si.prototype.removeConnection=function(e){return this._removeElement(e,"connection")},Si.prototype.getGraphics=function(e,t){return this._elementRegistry.getGraphics(e,t)},Si.prototype._changeViewbox=function(e){this._eventBus.fire("canvas.viewbox.changing"),e.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Si.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Si.prototype.viewbox=function(e){if(void 0===e&&this._cachedViewbox)return this._cachedViewbox;var t,i,n,a,o,s,r,l=this._viewport,c=this.getSize();return e?(this._changeViewbox((function(){o=Math.min(c.width/e.width,c.height/e.height);var t=this._svg.createSVGMatrix().scale(o).translate(-e.x,-e.y);Pt(l,t)})),e):(t=(n=this._rootElement?this.getActiveLayer():null)&&n.getBBox()||{},i=(a=Pt(l))?a.matrix:function(e,t,i,n,a,o){var s=xt.createSVGMatrix();switch(arguments.length){case 0:return s;case 1:return $t(s,e);case 6:return $t(s,{a:e,b:t,c:i,d:n,e:a,f:o})}}(),o=$i(i.a,1e3),s=$i(-i.e||0,1e3),r=$i(-i.f||0,1e3),e=this._cachedViewbox={x:s?s/o:0,y:r?r/o:0,width:c.width/o,height:c.height/o,scale:o,inner:{width:t.width||0,height:t.height||0,x:t.x||0,y:t.y||0},outer:c})},Si.prototype.scroll=function(e){var t=this._viewport,i=t.getCTM();return e&&this._changeViewbox((function(){e=Ae({dx:0,dy:0},e||{}),i=this._svg.createSVGMatrix().translate(e.dx,e.dy).multiply(i),ki(t,i)})),{x:i.e,y:i.f}},Si.prototype.scrollToElement=function(e,t){var i=100;"string"==typeof e&&(e=this._elementRegistry.get(e));var n=this.findRoot(e);n!==this.getRootElement()&&this.setRootElement(n),t||(t={}),"number"==typeof t&&(i=t),t={top:t.top||i,right:t.right||i,bottom:t.bottom||i,left:t.left||i};var a,o,s=Jt(e),r=vi(s),l=this.viewbox(),c=this.zoom();l.y+=t.top/c,l.x+=t.left/c,l.width-=(t.right+t.left)/c,l.height-=(t.bottom+t.top)/c;var d=vi(l);if(s.width<l.width&&s.height<l.height){var u=Math.max(0,r.right-d.right),h=Math.min(0,r.left-d.left),p=Math.max(0,r.bottom-d.bottom),m=Math.min(0,r.top-d.top);a=u||h,o=p||m}else a=s.x-l.x,o=s.y-l.y;this.scroll({dx:-a*c,dy:-o*c})},Si.prototype.zoom=function(e,t){return e?"fit-viewport"===e?this._fitViewport(t):(this._changeViewbox((function(){"object"!=typeof t&&(i=this.viewbox().outer,t={x:i.width/2,y:i.height/2}),n=this._setZoom(e,t)})),$i(n.a,1e3)):this.viewbox(e).scale;var i,n},Si.prototype._fitViewport=function(e){var t,i,n=this.viewbox(),a=n.outer,o=n.inner;return o.x>=0&&o.y>=0&&o.x+o.width<=a.width&&o.y+o.height<=a.height&&!e?i={x:0,y:0,width:Math.max(o.width+o.x,a.width),height:Math.max(o.height+o.y,a.height)}:(t=Math.min(1,a.width/o.width,a.height/o.height),i={x:o.x+(e?o.width/2-a.width/t/2:0),y:o.y+(e?o.height/2-a.height/t/2:0),width:a.width/t,height:a.height/t}),this.viewbox(i),this.viewbox(!1).scale},Si.prototype._setZoom=function(e,t){var i,n,a,o,s=this._svg,r=this._viewport,l=s.createSVGMatrix(),c=s.createSVGPoint(),d=(n=r.getCTM()).a;return t?(i=Ae(c,t).matrixTransform(n.inverse()),a=l.translate(i.x,i.y).scale(1/d*e).translate(-i.x,-i.y),o=n.multiply(a)):o=l.scale(e),ki(this._viewport,o),o},Si.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Si.prototype.getAbsoluteBBox=function(e){var t,i=this.viewbox();return{x:(t=e.waypoints?this.getGraphics(e).getBBox():e).x*i.scale-i.x*i.scale,y:t.y*i.scale-i.y*i.scale,width:t.width*i.scale,height:t.height*i.scale}},Si.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Ai="data-element-id";function Di(e){this._elements={},this._eventBus=e}Di.$inject=["eventBus"],Di.prototype.add=function(e,t,i){var n=e.id;this._validateId(n),rt(t,Ai,n),i&&rt(i,Ai,n),this._elements[n]={element:e,gfx:t,secondaryGfx:i}},Di.prototype.remove=function(e){var t=this._elements,i=e.id||e,n=i&&t[i];n&&(rt(n.gfx,Ai,""),n.secondaryGfx&&rt(n.secondaryGfx,Ai,""),delete t[i])},Di.prototype.updateId=function(e,t){this._validateId(t),"string"==typeof e&&(e=this.get(e)),this._eventBus.fire("element.updateId",{element:e,newId:t});var i=this.getGraphics(e),n=this.getGraphics(e,!0);this.remove(e),e.id=t,this.add(e,i,n)},Di.prototype.updateGraphics=function(e,t,i){var n=e.id||e,a=this._elements[n];return i?a.secondaryGfx=t:a.gfx=t,t&&rt(t,Ai,n),t},Di.prototype.get=function(e){var t;t="string"==typeof e?e:e&&rt(e,Ai);var i=this._elements[t];return i&&i.element},Di.prototype.filter=function(e){var t=[];return this.forEach((function(i,n){e(i,n)&&t.push(i)})),t},Di.prototype.find=function(e){for(var t=this._elements,i=Object.keys(t),n=0;n<i.length;n++){var a=t[i[n]],o=a.element;if(e(o,a.gfx))return o}},Di.prototype.getAll=function(){return this.filter((function(e){return e}))},Di.prototype.forEach=function(e){var t=this._elements;Object.keys(t).forEach((function(i){var n=t[i],a=n.element,o=n.gfx;return e(a,o)}))},Di.prototype.getGraphics=function(e,t){var i=e.id||e,n=this._elements[i];return n&&(t?n.secondaryGfx:n.gfx)},Di.prototype._validateId=function(e){if(!e)throw new Error("element must have an id");if(this._elements[e])throw new Error("element with id "+e+" already added")};var Ri=i(1235),Pi=i.n(Ri),Li=new(Pi())({name:"children",enumerable:!0,collection:!0},{name:"parent"}),Vi=new(Pi())({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),Fi=new(Pi())({name:"attachers",collection:!0},{name:"host"}),Ii=new(Pi())({name:"outgoing",collection:!0},{name:"source"}),Bi=new(Pi())({name:"incoming",collection:!0},{name:"target"});function Ti(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(e){var t=this.label,i=this.labels;!e&&t?i.remove(t):i.add(e,0)}}),Li.bind(this,"parent"),Vi.bind(this,"labels"),Ii.bind(this,"outgoing"),Bi.bind(this,"incoming")}function ji(){Ti.call(this),Li.bind(this,"children"),Fi.bind(this,"host"),Fi.bind(this,"attachers")}function Oi(){ji.call(this)}function Mi(){ji.call(this),Vi.bind(this,"labelTarget")}function Ni(){Ti.call(this),Ii.bind(this,"source"),Bi.bind(this,"target")}zt()(ji,Ti),zt()(Oi,ji),zt()(Mi,ji),zt()(Ni,Ti);var Wi={connection:Ni,shape:ji,label:Mi,root:Oi};function zi(){this._uid=12}zi.prototype.createRoot=function(e){return this.create("root",e)},zi.prototype.createLabel=function(e){return this.create("label",e)},zi.prototype.createShape=function(e){return this.create("shape",e)},zi.prototype.createConnection=function(e){return this.create("connection",e)},zi.prototype.create=function(e,t){return(t=Ae({},t||{})).id||(t.id=e+"_"+this._uid++),function(e,t){var i=Wi[e];if(!i)throw new Error("unknown type: <"+e+">");return Ae(new i,t)}(e,t)};var Ui=Array.prototype.slice;function qi(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function Hi(){}function Gi(e){return e.childNodes[0]}function Zi(e,t,i,n,a){var o=_t();o.setTranslate(t,i);var s=_t();s.setRotate(n||0,0,0);var r=_t();r.setScale(a||1,a||1),Pt(e,[o,s,r])}function Yi(e,t,i){var n=_t();n.setTranslate(t,i),Pt(e,n)}function Ki(e,t){var i=_t();i.setRotate(t,0,0),Pt(e,i)}function Xi(e,t){this._eventBus=e,this._elementRegistry=t}function Qi(e,t,i){var n=i||t.firstChild;e!==n&&t.insertBefore(e,n)}qi.prototype.on=function(e,t,i,n){if(e=ee(e)?e:[e],ne(t)&&(n=i,i=t,t=1e3),!ie(t))throw new Error("priority must be a number");var a=i;n&&((a=Se(i,n)).__fn=i.__fn||i);var o=this;e.forEach((function(e){o._addListener(e,{priority:t,callback:a,next:null})}))},qi.prototype.once=function(e,t,i,n){var a=this;if(ne(t)&&(n=i,i=t,t=1e3),!ie(t))throw new Error("priority must be a number");function o(){o.__isTomb=!0;var t=i.apply(n,arguments);return a.off(e,o),t}o.__fn=i,this.on(e,t,o)},qi.prototype.off=function(e,t){e=ee(e)?e:[e];var i=this;e.forEach((function(e){i._removeListener(e,t)}))},qi.prototype.createEvent=function(e){var t=new Hi;return t.init(e),t},qi.prototype.fire=function(e,t){var i,n,a,o;if(o=Ui.call(arguments),"object"==typeof e&&(e=(t=e).type),!e)throw new Error("no event type specified");if(n=this._listeners[e]){i=t instanceof Hi?t:this.createEvent(t),o[0]=i;var s=i.type;e!==s&&(i.type=e);try{a=this._invokeListeners(i,o,n)}finally{e!==s&&(i.type=s)}return void 0===a&&i.defaultPrevented&&(a=!1),a}},qi.prototype.handleError=function(e){return!1===this.fire("error",{error:e})},qi.prototype._destroy=function(){this._listeners={}},qi.prototype._invokeListeners=function(e,t,i){for(var n;i&&!e.cancelBubble;)n=this._invokeListener(e,t,i),i=i.next;return n},qi.prototype._invokeListener=function(e,t,i){var n;if(i.callback.__isTomb)return n;try{n=function(e,t){return e.apply(null,t)}(i.callback,t),void 0!==n&&(e.returnValue=n,e.stopPropagation()),!1===n&&e.preventDefault()}catch(e){if(!this.handleError(e))throw console.error("unhandled error in event listener",e),e}return n},qi.prototype._addListener=function(e,t){var i,n=this._getListeners(e);if(n){for(;n;){if(n.priority<t.priority)return t.next=n,void(i?i.next=t:this._setListeners(e,t));i=n,n=n.next}i.next=t}else this._setListeners(e,t)},qi.prototype._getListeners=function(e){return this._listeners[e]},qi.prototype._setListeners=function(e,t){this._listeners[e]=t},qi.prototype._removeListener=function(e,t){var i,n,a,o=this._getListeners(e);if(t)for(;o;)i=o.next,(a=o.callback)!==t&&a.__fn!==t||(n?n.next=i:this._setListeners(e,i)),n=o,o=i;else this._setListeners(e,null)},Hi.prototype.stopPropagation=function(){this.cancelBubble=!0},Hi.prototype.preventDefault=function(){this.defaultPrevented=!0},Hi.prototype.init=function(e){Ae(this,e||{})},Xi.$inject=["eventBus","elementRegistry"],Xi.prototype._getChildrenContainer=function(e){var t,i=this._elementRegistry.getGraphics(e);return e.parent?(t=function(e){return e.parentNode.childNodes[1]}(i),t||(ht(t=wt("g")).add("djs-children"),at(i.parentNode,t))):t=i,t},Xi.prototype._clear=function(e){var t=Gi(e);return je(t),t},Xi.prototype._createContainer=function(e,t,i,n){var a=wt("g");ht(a).add("djs-group"),void 0!==i?Qi(a,t,t.childNodes[i]):at(t,a);var o=wt("g");ht(o).add("djs-element"),ht(o).add("djs-"+e),n&&ht(o).add("djs-frame"),at(a,o);var s=wt("g");return ht(s).add("djs-visual"),at(o,s),o},Xi.prototype.create=function(e,t,i){var n=this._getChildrenContainer(t.parent);return this._createContainer(e,n,i,ti(t))},Xi.prototype.updateContainments=function(e){var t,i=this,n=this._elementRegistry;t=ce(e,(function(e,t){return t.parent&&(e[t.parent.id]=t.parent),e}),{}),le(t,(function(e){var t=e.children;if(t){var a=i._getChildrenContainer(e);le(t.slice().reverse(),(function(e){Qi(n.getGraphics(e).parentNode,a)}))}}))},Xi.prototype.drawShape=function(e,t){return this._eventBus.fire("render.shape",{gfx:e,element:t})},Xi.prototype.getShapePath=function(e){return this._eventBus.fire("render.getShapePath",e)},Xi.prototype.drawConnection=function(e,t){return this._eventBus.fire("render.connection",{gfx:e,element:t})},Xi.prototype.getConnectionPath=function(e){return this._eventBus.fire("render.getConnectionPath",e)},Xi.prototype.update=function(e,t,i){if(t.parent){var n=this._clear(i);if("shape"===e)this.drawShape(n,t),Yi(i,t.x,t.y);else{if("connection"!==e)throw new Error("unknown type: "+e);this.drawConnection(n,t)}t.hidden?rt(i,"display","none"):rt(i,"display","block")}},Xi.prototype.remove=function(e){mt(this._elementRegistry.getGraphics(e).parentNode)};const Ji={__depends__:[ai],__init__:["canvas"],canvas:["type",Si],elementRegistry:["type",Di],elementFactory:["type",zi],eventBus:["type",qi],graphicsFactory:["type",Xi]};function en(e,t){this.injector=t=t||function(e){return function(e){var t=[],i=[];function n(e){return t.indexOf(e)>=0}e.forEach((function e(a){n(a)||((a.__depends__||[]).forEach(e),n(a)||(function(e){t.push(e)}(a),(a.__init__||[]).forEach((function(e){i.push(e)}))))}));var a=new Nt(t);return i.forEach((function(e){try{a["string"==typeof e?"get":"invoke"](e)}catch(e){throw console.error("Failed to instantiate component"),console.error(e.stack),e}})),a}([{config:["value",e=e||{}]},Ji].concat(e.modules||[]))}(e),this.get=t.get,this.invoke=t.invoke,this.get("eventBus").fire("diagram.init")}function tn(){}function nn(e,t){this.model=e,this.properties=t}en.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},en.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},tn.prototype.get=function(e){return this.$model.properties.get(this,e)},tn.prototype.set=function(e,t){this.$model.properties.set(this,e,t)},nn.prototype.createType=function(e){var t=this.model,i=this.properties,n=Object.create(tn.prototype);le(e.properties,(function(e){e.isMany||void 0===e.default||(n[e.name]=e.default)})),i.defineModel(n,t),i.defineDescriptor(n,e);var a=e.ns.name;function o(e){i.define(this,"$type",{value:a,enumerable:!0}),i.define(this,"$attrs",{value:{}}),i.define(this,"$parent",{writable:!0}),le(e,Se((function(e,t){this.set(t,e)}),this))}return o.prototype=n,o.hasType=n.$instanceOf=this.model.hasType,i.defineModel(o,t),i.defineDescriptor(o,e),o};var an={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},on={String:function(e){return e},Boolean:function(e){return"true"===e},Integer:function(e){return parseInt(e,10)},Real:function(e){return parseFloat(e)}};function sn(e,t){var i=on[e];return i?i(t):t}function rn(e){return!!an[e]}function ln(e){return!!on[e]}function cn(e,t){var i,n,a=e.split(/:/);if(1===a.length)i=e,n=t;else{if(2!==a.length)throw new Error("expected <prefix:localName> or <localName>, got "+e);i=a[1],n=a[0]}return{name:e=(n?n+":":"")+i,prefix:n,localName:i}}function dn(e){this.ns=e,this.name=e.name,this.allTypes=[],this.allTypesByName={},this.properties=[],this.propertiesByName={}}function un(e,t){this.packageMap={},this.typeMap={},this.packages=[],this.properties=t,le(e,Se(this.registerPackage,this))}function hn(e,t,i){var n=t[i];if(n in e)throw new Error("package with "+i+" <"+n+"> already defined")}function pn(e){this.model=e}function mn(e,t,i){Object.defineProperty(e,t.name,{enumerable:!t.isReference,writable:!0,value:i,configurable:!0})}function fn(e){this.properties=new pn(this),this.factory=new nn(this,this.properties),this.registry=new un(e,this.properties),this.typeCache={}}dn.prototype.build=function(){return De(this,["ns","name","allTypes","allTypesByName","properties","propertiesByName","bodyProperty","idProperty"])},dn.prototype.addProperty=function(e,t,i){"boolean"==typeof t&&(i=t,t=void 0),this.addNamedProperty(e,!1!==i);var n=this.properties;void 0!==t?n.splice(t,0,e):n.push(e)},dn.prototype.replaceProperty=function(e,t,i){var n=e.ns,a=this.properties,o=this.propertiesByName,s=e.name!==t.name;if(e.isId){if(!t.isId)throw new Error("property <"+t.ns.name+"> must be id property to refine <"+e.ns.name+">");this.setIdProperty(t,!1)}if(e.isBody){if(!t.isBody)throw new Error("property <"+t.ns.name+"> must be body property to refine <"+e.ns.name+">");this.setBodyProperty(t,!1)}var r=a.indexOf(e);if(-1===r)throw new Error("property <"+n.name+"> not found in property list");a.splice(r,1),this.addProperty(t,i?void 0:r,s),o[n.name]=o[n.localName]=t},dn.prototype.redefineProperty=function(e,t,i){var n=e.ns.prefix,a=t.split("#"),o=cn(a[0],n),s=cn(a[1],o.prefix).name,r=this.propertiesByName[s];if(!r)throw new Error("refined property <"+s+"> not found");this.replaceProperty(r,e,i),delete e.redefines},dn.prototype.addNamedProperty=function(e,t){var i=e.ns,n=this.propertiesByName;t&&(this.assertNotDefined(e,i.name),this.assertNotDefined(e,i.localName)),n[i.name]=n[i.localName]=e},dn.prototype.removeNamedProperty=function(e){var t=e.ns,i=this.propertiesByName;delete i[t.name],delete i[t.localName]},dn.prototype.setBodyProperty=function(e,t){if(t&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+e.ns.name+">)");this.bodyProperty=e},dn.prototype.setIdProperty=function(e,t){if(t&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+e.ns.name+">)");this.idProperty=e},dn.prototype.assertNotDefined=function(e,t){var i=e.name,n=this.propertiesByName[i];if(n)throw new Error("property <"+i+"> already defined; override of <"+n.definedBy.ns.name+"#"+n.ns.name+"> by <"+e.definedBy.ns.name+"#"+e.ns.name+"> not allowed without redefines")},dn.prototype.hasProperty=function(e){return this.propertiesByName[e]},dn.prototype.addTrait=function(e,t){var i=this.allTypesByName,n=this.allTypes,a=e.name;a in i||(le(e.properties,Se((function(i){i=Ae({},i,{name:i.ns.localName,inherited:t}),Object.defineProperty(i,"definedBy",{value:e});var n=i.replaces,a=i.redefines;n||a?this.redefineProperty(i,n||a,n):(i.isBody&&this.setBodyProperty(i),i.isId&&this.setIdProperty(i),this.addProperty(i))}),this)),n.push(e),i[a]=e)},un.prototype.getPackage=function(e){return this.packageMap[e]},un.prototype.getPackages=function(){return this.packages},un.prototype.registerPackage=function(e){e=Ae({},e);var t=this.packageMap;hn(t,e,"prefix"),hn(t,e,"uri"),le(e.types,Se((function(t){this.registerType(t,e)}),this)),t[e.uri]=t[e.prefix]=e,this.packages.push(e)},un.prototype.registerType=function(e,t){var i=cn((e=Ae({},e,{superClass:(e.superClass||[]).slice(),extends:(e.extends||[]).slice(),properties:(e.properties||[]).slice(),meta:Ae(e.meta||{})})).name,t.prefix),n=i.name,a={};le(e.properties,Se((function(e){var t=cn(e.name,i.prefix),n=t.name;rn(e.type)||(e.type=cn(e.type,t.prefix).name),Ae(e,{ns:t,name:n}),a[n]=e}),this)),Ae(e,{ns:i,name:n,propertiesByName:a}),le(e.extends,Se((function(e){var t=this.typeMap[e];t.traits=t.traits||[],t.traits.push(n)}),this)),this.definePackage(e,t),this.typeMap[n]=e},un.prototype.mapTypes=function(e,t,i){var n=rn(e.name)?{name:e.name}:this.typeMap[e.name],a=this;function o(e){return s(e,!0)}function s(i,n){var o=cn(i,rn(i)?"":e.prefix);a.mapTypes(o,t,n)}if(!n)throw new Error("unknown type <"+e.name+">");le(n.superClass,i?o:s),t(n,!i),le(n.traits,o)},un.prototype.getEffectiveDescriptor=function(e){var t=cn(e),i=new dn(t);this.mapTypes(t,(function(e,t){i.addTrait(e,t)}));var n=i.build();return this.definePackage(n,n.allTypes[n.allTypes.length-1].$pkg),n},un.prototype.definePackage=function(e,t){this.properties.define(e,"$pkg",{value:t})},pn.prototype.set=function(e,t,i){var n=this.model.getPropertyDescriptor(e,t),a=n&&n.name;void 0===i?n?delete e[a]:delete e.$attrs[t]:n?a in e?e[a]=i:mn(e,n,i):e.$attrs[t]=i},pn.prototype.get=function(e,t){var i=this.model.getPropertyDescriptor(e,t);if(!i)return e.$attrs[t];var n=i.name;return!e[n]&&i.isMany&&mn(e,i,[]),e[n]},pn.prototype.define=function(e,t,i){if(!i.writable){var n=i.value;delete(i=Ae({},i,{get:function(){return n}})).value}Object.defineProperty(e,t,i)},pn.prototype.defineDescriptor=function(e,t){this.define(e,"$descriptor",{value:t})},pn.prototype.defineModel=function(e,t){this.define(e,"$model",{value:t})},fn.prototype.create=function(e,t){var i=this.getType(e);if(!i)throw new Error("unknown type <"+e+">");return new i(t)},fn.prototype.getType=function(e){var t=this.typeCache,i=ae(e)?e:e.ns.name,n=t[i];return n||(e=this.registry.getEffectiveDescriptor(i),n=t[i]=this.factory.createType(e)),n},fn.prototype.createAny=function(e,t,i){var n=cn(e),a={$type:e,$instanceOf:function(e){return e===this.$type}},o={name:e,isGeneric:!0,ns:{prefix:n.prefix,localName:n.localName,uri:t}};return this.properties.defineDescriptor(a,o),this.properties.defineModel(a,this),this.properties.define(a,"$parent",{enumerable:!1,writable:!0}),this.properties.define(a,"$instanceOf",{enumerable:!1,writable:!0}),le(i,(function(e,t){te(e)&&void 0!==e.value?a[e.name]=e.value:a[t]=e})),a},fn.prototype.getPackage=function(e){return this.registry.getPackage(e)},fn.prototype.getPackages=function(){return this.registry.getPackages()},fn.prototype.getElementDescriptor=function(e){return e.$descriptor},fn.prototype.hasType=function(e,t){return void 0===t&&(t=e,e=this),t in e.$model.getElementDescriptor(e).allTypesByName},fn.prototype.getPropertyDescriptor=function(e,t){return this.getElementDescriptor(e).propertiesByName[t]},fn.prototype.getTypeDescriptor=function(e){return this.registry.typeMap[e]};var gn=String.fromCharCode,vn=Object.prototype.hasOwnProperty,bn=/&#(\d+);|&#x([0-9a-f]+);|&(\w+);/gi,yn={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'};function wn(e,t,i,n){return n?vn.call(yn,n)?yn[n]:"&"+n+";":gn(t||parseInt(i,16))}function xn(e){return e.length>3&&-1!==e.indexOf("&")?e.replace(bn,wn):e}Object.keys(yn).forEach((function(e){yn[e.toUpperCase()]=yn[e]}));var $n="xsi:type",_n="non-whitespace outside of root node";function Cn(e){return new Error(e)}function En(e){return"missing namespace for prefix <"+e+">"}function Sn(e){return{get:e,enumerable:!0}}function kn(e){var t,i={};for(t in e)i[t]=e[t];return i}function An(e){return e+"$uri"}function Dn(){return{line:0,column:0}}function Rn(e){throw e}function Pn(e){if(!this)return new Pn(e);var t,i,n,a,o,s,r,l,c,d=e&&e.proxy,u=Rn,h=Dn,p=!1,m=!1,f=null,g=!1;function v(e){e instanceof Error||(e=Cn(e)),f=e,u(e,h)}function b(e){o&&(e instanceof Error||(e=Cn(e)),o(e,h))}this.on=function(e,c){if("function"!=typeof c)throw Cn("required args <name, cb>");switch(e){case"openTag":i=c;break;case"text":t=c;break;case"closeTag":n=c;break;case"error":u=c;break;case"warn":o=c;break;case"cdata":a=c;break;case"attention":l=c;break;case"question":r=c;break;case"comment":s=c;break;default:throw Cn("unsupported event: "+e)}return this},this.ns=function(e){if(void 0===e&&(e={}),"object"!=typeof e)throw Cn("required args <nsMap={}>");var t,i={};for(t in e)i[t]=e[t];return i["http://www.w3.org/2001/XMLSchema-instance"]="xsi",m=!0,c=i,this},this.parse=function(e){if("string"!=typeof e)throw Cn("required args <xml=string>");return f=null,function(e){var o,u,f,y,w,x,$,_,C,E,S,k=m?[]:null,A=m?function(e){var t,i,n={};for(t in e)n[i=e[t]]=i,n[An(i)]=t;return n}(c):null,D=[],R=0,P=!1,L=!1,V=0,F=0,I="",B=0;function T(){if(null!==S)return S;var e,t,i,n,a,o,s,r,l,d,u,h=m&&A.xmlns,f=m&&p?[]:null,g=B,v=I,y=v.length,w={},x={};e:for(;g<y;g++)if(l=!1,!(32===(d=v.charCodeAt(g))||d<14&&d>8)){for((d<65||d>122||d>90&&d<97)&&95!==d&&58!==d&&(b("illegal first char attribute name"),l=!0),u=g+1;u<y;u++)if(!((d=v.charCodeAt(u))>96&&d<123||d>64&&d<91||d>47&&d<59||46===d||45===d||95===d)){if(32===d||d<14&&d>8){b("missing attribute value"),g=u;continue e}if(61===d)break;b("illegal attribute name char"),l=!0}if("xmlns:xmlns"===(r=v.substring(g,u))&&(b("illegal declaration of xmlns"),l=!0),34===(d=v.charCodeAt(u+1)))-1===(u=v.indexOf('"',g=u+2))&&-1!==(u=v.indexOf("'",g))&&(b("attribute value quote missmatch"),l=!0);else if(39===d)-1===(u=v.indexOf("'",g=u+2))&&-1!==(u=v.indexOf('"',g))&&(b("attribute value quote missmatch"),l=!0);else for(b("missing attribute value quotes"),l=!0,u+=1;u<y&&!(32===(d=v.charCodeAt(u+1))||d<14&&d>8);u++);for(-1===u&&(b("missing closing quotes"),u=y,l=!0),l||(o=v.substring(g,u)),g=u;u+1<y&&!(32===(d=v.charCodeAt(u+1))||d<14&&d>8);u++)g===u&&(b("illegal character after attribute end"),l=!0);if(g=u+1,!l)if(r in x)b("attribute <"+r+"> already defined");else if(x[r]=!0,m)if(p){if(null!==(a="xmlns"===r?"xmlns":120===r.charCodeAt(0)&&"xmlns:"===r.substr(0,6)?r.substr(6):null)){if(e=xn(o),t=An(a),!(s=c[e])){if("xmlns"===a||t in A&&A[t]!==e)do{s="ns"+R++}while(void 0!==A[s]);else s=a;c[e]=s}A[a]!==s&&(n||(A=kn(A),n=!0),A[a]=s,"xmlns"===a&&(A[An(s)]=e,h=s),A[t]=e),w[r]=o;continue}f.push(r,o)}else-1!==(d=r.indexOf(":"))?(i=A[r.substring(0,d)])?((r=h===i?r.substr(d+1):i+r.substr(d))===$n&&(-1!==(d=o.indexOf(":"))?(i=o.substring(0,d),o=(i=A[i]||i)+o.substring(d)):o=h+":"+o),w[r]=o):b(En(r.substring(0,d))):w[r]=o;else w[r]=o}if(p)for(g=0,y=f.length;g<y;g++){if(r=f[g++],o=f[g],-1!==(d=r.indexOf(":"))){if(!(i=A[r.substring(0,d)])){b(En(r.substring(0,d)));continue}(r=h===i?r.substr(d+1):i+r.substr(d))===$n&&(-1!==(d=o.indexOf(":"))?(i=o.substring(0,d),o=(i=A[i]||i)+o.substring(d)):o=h+":"+o)}w[r]=o}return S=w}for(h=function(){for(var t,i,n=/(\r\n|\r|\n)/g,a=0,o=0,s=0,r=F;V>=s&&(t=n.exec(e))&&!((r=t[0].length+t.index)>V);)a+=1,s=r;return-1==V?(o=r,i=e.substring(F)):0===F?i=e.substring(F,V):(o=V-s,i=-1==F?e.substring(V):e.substring(V,F+1)),{data:i,line:a,column:o}},d&&(E=Object.create({},{name:Sn((function(){return _})),originalName:Sn((function(){return C})),attrs:Sn(T),ns:Sn((function(){return A}))}));-1!==F;){if(-1===(V=60===e.charCodeAt(F)?F:e.indexOf("<",F)))return D.length?v("unexpected end of file"):0===F?v("missing start tag"):void(F<e.length&&e.substring(F).trim()&&b(_n));if(F!==V)if(D.length){if(t&&(t(e.substring(F,V),xn,h),g))return}else if(e.substring(F,V).trim()&&(b(_n),g))return;if(33===(w=e.charCodeAt(V+1))){if(91===(y=e.charCodeAt(V+2))&&"CDATA["===e.substr(V+3,6)){if(-1===(F=e.indexOf("]]>",V)))return v("unclosed cdata");if(a&&(a(e.substring(V+9,F),h),g))return;F+=3;continue}if(45===y&&45===e.charCodeAt(V+3)){if(-1===(F=e.indexOf("--\x3e",V)))return v("unclosed comment");if(s&&(s(e.substring(V+4,F),xn,h),g))return;F+=3;continue}}if(63!==w){for(u=V+1;;u++){if(x=e.charCodeAt(u),isNaN(x))return F=-1,v("unclosed tag");if(34===x)u=-1!==(y=e.indexOf('"',u+1))?y:u;else if(39===x)u=-1!==(y=e.indexOf("'",u+1))?y:u;else if(62===x){F=u;break}}if(33!==w){if(S={},47===w){if(P=!1,L=!0,!D.length)return v("missing open tag");if(u=_=D.pop(),y=V+2+u.length,e.substring(V+2,y)!==u)return v("closing tag mismatch");for(;y<F;y++)if(!(32===(w=e.charCodeAt(y))||w>8&&w<14))return v("close tag")}else{if(47===e.charCodeAt(F-1)?(u=_=e.substring(V+1,F-1),P=!0,L=!0):(u=_=e.substring(V+1,F),P=!0,L=!1),!(w>96&&w<123||w>64&&w<91||95===w||58===w))return v("illegal first char nodeName");for(y=1,f=u.length;y<f;y++)if(!((w=u.charCodeAt(y))>96&&w<123||w>64&&w<91||w>47&&w<59||45===w||95===w||46==w)){if(32===w||w<14&&w>8){_=u.substring(0,y),S=null;break}return v("invalid nodeName")}L||D.push(_)}if(m){if(o=A,P&&(L||k.push(o),null===S&&(p=-1!==u.indexOf("xmlns",y))&&(B=y,I=u,T(),p=!1)),C=_,-1!==(w=_.indexOf(":"))){if(!($=A[_.substring(0,w)]))return v("missing namespace on <"+C+">");_=_.substr(w+1)}else $=A.xmlns;$&&(_=$+":"+_)}if(P&&(B=y,I=u,i&&(d?i(E,xn,L,h):i(_,T,xn,L,h),g)))return;if(L){if(n&&(n(d?E:_,xn,P,h),g))return;m&&(A=P?o:k.pop())}F+=1}else{if(l&&(l(e.substring(V,F+1),xn,h),g))return;F+=1}}else{if(-1===(F=e.indexOf("?>",V)))return v("unclosed question");if(r&&(r(e.substring(V,F+2),h),g))return;F+=2}}}(e),h=Dn,g=!1,f},this.stop=function(){g=!0}}function Ln(e){return e.xml&&"lowerCase"===e.xml.tagAlias}var Vn={xsi:"http://www.w3.org/2001/XMLSchema-instance",xml:"http://www.w3.org/XML/1998/namespace"},Fn="xsi:type";function In(e){return e.xml&&e.xml.serialize}function Bn(e){return In(e)===Fn}function Tn(e,t){return Ln(t)?e.prefix+":"+((i=e.localName).charAt(0).toUpperCase()+i.slice(1)):e.name;var i}function jn(e){return new Error(e)}function On(e){return e.$descriptor}function Mn(e){Ae(this,e),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(e){this.references.push(e)},this.addElement=function(e){if(!e)throw jn("expected element");var t,i=this.elementsById,n=On(e).idProperty;if(n&&(t=e.get(n.name))){if(!/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i.test(t))throw new Error("illegal ID <"+t+">");if(i[t])throw jn("duplicate ID <"+t+">");i[t]=e}},this.addWarning=function(e){this.warnings.push(e)}}function Nn(){}function Wn(){}function zn(){}function Un(e,t){this.property=e,this.context=t}function qn(e,t){this.element=t,this.propertyDesc=e}function Hn(){}function Gn(e,t,i){this.model=e,this.type=e.getType(t),this.context=i}function Zn(e,t,i){Gn.call(this,e,t,i)}function Yn(e,t,i){this.model=e,this.context=i}function Kn(e){e instanceof fn&&(e={model:e}),Ae(this,{lax:!1},e)}Nn.prototype.handleEnd=function(){},Nn.prototype.handleText=function(){},Nn.prototype.handleNode=function(){},Wn.prototype=Object.create(Nn.prototype),Wn.prototype.handleNode=function(){return this},zn.prototype=Object.create(Nn.prototype),zn.prototype.handleText=function(e){this.body=(this.body||"")+e},Un.prototype=Object.create(zn.prototype),Un.prototype.handleNode=function(e){if(this.element)throw jn("expected no sub nodes");return this.element=this.createReference(e),this},Un.prototype.handleEnd=function(){this.element.id=this.body},Un.prototype.createReference=function(e){return{property:this.property.ns.name,id:""}},qn.prototype=Object.create(zn.prototype),qn.prototype.handleEnd=function(){var e=this.body||"",t=this.element,i=this.propertyDesc;e=sn(i.type,e),i.isMany?t.get(i.name).push(e):t.set(i.name,e)},Hn.prototype=Object.create(zn.prototype),Hn.prototype.handleNode=function(e){var t=this,i=this.element;return i?t=this.handleChild(e):(i=this.element=this.createElement(e),this.context.addElement(i)),t},Gn.prototype=Object.create(Hn.prototype),Gn.prototype.addReference=function(e){this.context.addReference(e)},Gn.prototype.handleText=function(e){if(!On(this.element).bodyProperty)throw jn("unexpected body text <"+e+">");zn.prototype.handleText.call(this,e)},Gn.prototype.handleEnd=function(){var e=this.body,t=this.element,i=On(t).bodyProperty;i&&void 0!==e&&(e=sn(i.type,e),t.set(i.name,e))},Gn.prototype.createElement=function(e){var t,i=e.attributes,n=this.type,a=On(n),o=this.context,s=new n({}),r=this.model;return le(i,(function(e,i){var n=a.propertiesByName[i];n&&n.isReference?n.isMany?le(e.split(" "),(function(e){o.addReference({element:s,property:n.ns.name,id:e})})):o.addReference({element:s,property:n.ns.name,id:e}):(n?e=sn(n.type,e):"xmlns"!==i&&(t=cn(i,a.ns.prefix),r.getPackage(t.prefix)&&o.addWarning({message:"unknown attribute <"+i+">",element:s,property:i,value:e})),s.set(i,e))})),s},Gn.prototype.getPropertyForNode=function(e){var t,i,n=cn(e.name),a=this.type,o=this.model,s=On(a),r=n.name,l=s.propertiesByName[r];if(l&&!l.isAttr)return Bn(l)&&(t=e.attributes["xsi:type"])?(t=function(e,t){var i=cn(e);return function(e,t){var i=e.name,n=e.localName,a=t.xml&&t.xml.typePrefix;return a&&0===n.indexOf(a)?e.prefix+":"+n.slice(a.length):i}(i,t.getPackage(i.prefix))}(t,o),Ae({},l,{effectiveType:On(i=o.getType(t)).name})):l;var c=o.getPackage(n.prefix);if(c){if(t=Tn(n,c),i=o.getType(t),l=se(s.properties,(function(e){return!e.isVirtual&&!e.isReference&&!e.isAttribute&&i.hasType(e.type)})))return Ae({},l,{effectiveType:On(i).name})}else if(l=se(s.properties,(function(e){return!e.isReference&&!e.isAttribute&&"Element"===e.type})))return l;throw jn("unrecognized element <"+n.name+">")},Gn.prototype.toString=function(){return"ElementDescriptor["+On(this.type).name+"]"},Gn.prototype.valueHandler=function(e,t){return new qn(e,t)},Gn.prototype.referenceHandler=function(e){return new Un(e,this.context)},Gn.prototype.handler=function(e){return"Element"===e?new Yn(this.model,e,this.context):new Gn(this.model,e,this.context)},Gn.prototype.handleChild=function(e){var t,i,n,a;if(t=this.getPropertyForNode(e),n=this.element,ln(i=t.effectiveType||t.type))return this.valueHandler(t,n);var o=(a=t.isReference?this.referenceHandler(t).handleNode(e):this.handler(i).handleNode(e)).element;return void 0!==o&&(t.isMany?n.get(t.name).push(o):n.set(t.name,o),t.isReference?(Ae(o,{element:n}),this.context.addReference(o)):o.$parent=n),a},Zn.prototype=Object.create(Gn.prototype),Zn.prototype.createElement=function(e){var t=e.name,i=cn(t),n=this.model,a=this.type,o=n.getPackage(i.prefix),s=o&&Tn(i,o)||t;if(!a.hasType(s))throw jn("unexpected element <"+e.originalName+">");return Gn.prototype.createElement.call(this,e)},Yn.prototype=Object.create(Hn.prototype),Yn.prototype.createElement=function(e){var t=e.name,i=cn(t).prefix,n=e.ns[i+"$uri"],a=e.attributes;return this.model.createAny(t,n,a)},Yn.prototype.handleChild=function(e){var t=new Yn(this.model,"Element",this.context).handleNode(e),i=this.element,n=t.element;return void 0!==n&&((i.$children=i.$children||[]).push(n),n.$parent=i),t},Yn.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},Kn.prototype.fromXML=function(e,t,i){var n=t.rootHandler;t instanceof Gn?(n=t,t={}):"string"==typeof t?(n=this.handler(t),t={}):"string"==typeof n&&(n=this.handler(n));var a=this.model,o=this.lax,s=new Mn(Ae({},t,{rootHandler:n})),r=new Pn({proxy:!0}),l=function(){var e=[];return Object.defineProperty(e,"peek",{value:function(){return this[this.length-1]}}),e}();function c(e,t,i){var n=t(),a=n.line,o=n.column,r=n.data;"<"===r.charAt(0)&&-1!==r.indexOf(" ")&&(r=r.slice(0,r.indexOf(" "))+">");var l="unparsable content "+(r?r+" ":"")+"detected\n\tline: "+a+"\n\tcolumn: "+o+"\n\tnested error: "+e.message;if(i)return s.addWarning({message:l,error:e}),!0;throw jn(l)}function d(e,t){return c(e,t,!0)}n.context=s,l.push(n);var u=/^<\?xml /i,h=/ encoding="([^"]+)"/i,p=/^utf-8$/i;function m(e,t){try{l.peek().handleText(e)}catch(e){d(e,t)}}var f=a.getPackages().reduce((function(e,t){return e[t.uri]=t.prefix,e}),{"http://www.w3.org/XML/1998/namespace":"xml"});return r.ns(f).on("openTag",(function(e,t,i,n){var a=e.attrs||{},s=Object.keys(a).reduce((function(e,i){var n=t(a[i]);return e[i]=n,e}),{});!function(e,t){var i=l.peek();try{l.push(i.handleNode(e))}catch(e){c(e,t,o)&&l.push(new Wn)}}({name:e.name,originalName:e.originalName,attributes:s,ns:e.ns},n)})).on("question",(function(e){if(u.test(e)){var t=h.exec(e),i=t&&t[1];i&&!p.test(i)&&s.addWarning({message:"unsupported document encoding <"+i+">, falling back to UTF-8"})}})).on("closeTag",(function(){l.pop().handleEnd()})).on("cdata",m).on("text",(function(e,t,i){!function(e,t){e.trim()&&m(e,t)}(t(e),i)})).on("error",c).on("warn",d),new Promise((function(t,i){var a;try{r.parse(e),function(){var e,t,i=s.elementsById,n=s.references;for(e=0;t=n[e];e++){var a=t.element,o=i[t.id],r=On(a).propertiesByName[t.property];if(o||s.addWarning({message:"unresolved reference <"+t.id+">",element:t.element,property:t.property,value:t.id}),r.isMany){var l=a.get(r.name),c=l.indexOf(t);-1===c&&(c=l.length),o?l[c]=o:l.splice(c,1)}else a.set(r.name,o)}}()}catch(e){a=e}var o=n.element;a||o||(a=jn("failed to parse document as <"+n.type.$descriptor.name+">"));var l=s.warnings,c=s.references,d=s.elementsById;return a?(a.warnings=l,i(a)):t({rootElement:o,elementsById:d,references:c,warnings:l})}))},Kn.prototype.handler=function(e){return new Zn(this.model,e)};var Xn=/<|>|'|"|&|\n\r|\n/g,Qn=/<|>|&/g;function Jn(e){var t={},i={},n={},a=[],o=[];this.byUri=function(t){return i[t]||e&&e.byUri(t)},this.add=function(e,t){i[e.uri]=e,t?a.push(e):o.push(e),this.mapPrefix(e.prefix,e.uri)},this.uriByPrefix=function(e){return t[e||"xmlns"]},this.mapPrefix=function(e,i){t[e||"xmlns"]=i},this.getNSKey=function(e){return void 0!==e.prefix?e.uri+"|"+e.prefix:e.uri},this.logUsed=function(t){var i=t.uri,a=this.getNSKey(t);n[a]=this.byUri(i),e&&e.logUsed(t)},this.getUsed=function(e){var t=this;return[].concat(a,o).filter((function(e){var i=t.getNSKey(e);return n[i]}))}}function ea(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function ta(e){return ae(e)?e:(e.prefix?e.prefix+":":"")+e.localName}var ia={"\n":"#10","\n\r":"#10",'"':"#34","'":"#39","<":"#60",">":"#62","&":"#38"},na={"<":"lt",">":"gt","&":"amp"};function aa(e,t,i){return(e=ae(e)?e:""+e).replace(t,(function(e){return"&"+i[e]+";"}))}function oa(e){this.tagName=e}function sa(){}function ra(e){this.tagName=e}function la(e,t){this.body=[],this.attrs=[],this.parent=e,this.propertyDescriptor=t}function ca(e,t){la.call(this,e,t)}function da(){this.value="",this.write=function(e){this.value+=e}}function ua(e,t){var i=[""];this.append=function(t){return e.write(t),this},this.appendNewLine=function(){return t&&e.write("\n"),this},this.appendIndent=function(){return t&&e.write(i.join("  ")),this},this.indent=function(){return i.push(""),this},this.unindent=function(){return i.pop(),this}}function ha(e){return e=Ae({format:!1,preamble:!0},e||{}),{toXML:function(t,i){var n=i||new da,a=new ua(n,e.format);if(e.preamble&&a.append('<?xml version="1.0" encoding="UTF-8"?>\n'),(new la).build(t).serializeTo(a),!i)return n.value}}}function pa(e,t){fn.call(this,e,t)}oa.prototype.build=function(e){return this.element=e,this},oa.prototype.serializeTo=function(e){e.appendIndent().append("<"+this.tagName+">"+this.element.id+"</"+this.tagName+">").appendNewLine()},sa.prototype.serializeValue=sa.prototype.serializeTo=function(e){e.append(this.escape?aa(this.value,Qn,na):this.value)},sa.prototype.build=function(e,t){return this.value=t,"String"===e.type&&-1!==t.search(Qn)&&(this.escape=!0),this},ea(ra,sa),ra.prototype.serializeTo=function(e){e.appendIndent().append("<"+this.tagName+">"),this.serializeValue(e),e.append("</"+this.tagName+">").appendNewLine()},la.prototype.build=function(e){this.element=e;var t,i,n=e.$descriptor,a=this.propertyDescriptor,o=n.isGeneric;return t=o?this.parseGeneric(e):this.parseNsAttributes(e),this.ns=a?this.nsPropertyTagName(a):this.nsTagName(n),this.tagName=this.addTagName(this.ns),o||(i=function(e){return re(e.$descriptor.properties,(function(t){var i=t.name;if(t.isVirtual)return!1;if(!oe(e,i))return!1;var n=e[i];return n!==t.default&&null!==n&&(!t.isMany||n.length)}))}(e),this.parseAttributes(re(i,(function(e){return e.isAttr}))),this.parseContainments(re(i,(function(e){return!e.isAttr})))),this.parseGenericAttributes(e,t),this},la.prototype.nsTagName=function(e){return function(e,t){return t.isGeneric?Ae({localName:t.ns.localName},e):Ae({localName:(i=t.ns.localName,n=t.$pkg,Ln(n)?(a=i).charAt(0).toLowerCase()+a.slice(1):i)},e);var i,n,a}(this.logNamespaceUsed(e.ns),e)},la.prototype.nsPropertyTagName=function(e){return function(e,t){return Ae({localName:t.ns.localName},e)}(this.logNamespaceUsed(e.ns),e)},la.prototype.isLocalNs=function(e){return e.uri===this.ns.uri},la.prototype.nsAttributeName=function(e){var t;if(t=ae(e)?cn(e):e.ns,e.inherited)return{localName:t.localName};var i=this.logNamespaceUsed(t);return this.getNamespaces().logUsed(i),this.isLocalNs(i)?{localName:t.localName}:Ae({localName:t.localName},i)},la.prototype.parseGeneric=function(e){var t=this,i=this.body,n=[];return le(e,(function(a,o){"$body"===o?i.push((new sa).build({type:"String"},a)):"$children"===o?le(a,(function(e){i.push(new la(t).build(e))})):0!==o.indexOf("$")&&t.parseNsAttribute(e,o,a)&&n.push({name:o,value:a})})),n},la.prototype.parseNsAttribute=function(e,t,i){var n,a=e.$model,o=cn(t);if("xmlns"===o.prefix&&(n={prefix:o.localName,uri:i}),o.prefix||"xmlns"!==o.localName||(n={uri:i}),!n)return{name:t,value:i};if(a&&a.getPackage(i))this.logNamespace(n,!0,!0);else{var s=this.logNamespaceUsed(n,!0);this.getNamespaces().logUsed(s)}},la.prototype.parseNsAttributes=function(e,t){var i=this,n=e.$attrs,a=[];return le(n,(function(t,n){var o=i.parseNsAttribute(e,n,t);o&&a.push(o)})),a},la.prototype.parseGenericAttributes=function(e,t){var i=this;le(t,(function(t){if(t.name!==Fn)try{i.addAttribute(i.nsAttributeName(t.name),t.value)}catch(i){console.warn("missing namespace information for ",t.name,"=",t.value,"on",e,i)}}))},la.prototype.parseContainments=function(e){var t=this,i=this.body,n=this.element;le(e,(function(e){var a=n.get(e.name),o=e.isReference;if(e.isMany||(a=[a]),e.isBody)i.push((new sa).build(e,a[0]));else if(ln(e.type))le(a,(function(n){i.push(new ra(t.addTagName(t.nsPropertyTagName(e))).build(e,n))}));else if(o)le(a,(function(n){i.push(new oa(t.addTagName(t.nsPropertyTagName(e))).build(n))}));else{var s=Bn(e),r=function(e){return"property"===In(e)}(e);le(a,(function(n){var a;a=s?new ca(t,e):r?new la(t,e):new la(t),i.push(a.build(n))}))}}))},la.prototype.getNamespaces=function(e){var t,i=this.namespaces,n=this.parent;return i||(t=n&&n.getNamespaces(),e||!t?this.namespaces=i=new Jn(t):i=t),i},la.prototype.logNamespace=function(e,t,i){var n=this.getNamespaces(i),a=e.uri,o=e.prefix;return n.byUri(a)&&!i||n.add(e,t),n.mapPrefix(o,a),e},la.prototype.logNamespaceUsed=function(e,t){var i,n,a,o=this.element.$model,s=this.getNamespaces(t),r=e.prefix,l=e.uri;if(!r&&!l)return{localName:e.localName};if(a=Vn[r]||o&&(o.getPackage(r)||{}).uri,!(l=l||a||s.uriByPrefix(r)))throw new Error("no namespace uri given for prefix <"+r+">");if(!(e=s.byUri(l))){for(i=r,n=1;s.uriByPrefix(i);)i=r+"_"+n++;e=this.logNamespace({prefix:i,uri:l},a===l)}return r&&s.mapPrefix(r,l),e},la.prototype.parseAttributes=function(e){var t=this,i=this.element;le(e,(function(e){var n=i.get(e.name);if(e.isReference)if(e.isMany){var a=[];le(n,(function(e){a.push(e.id)})),n=a.join(" ")}else n=n.id;t.addAttribute(t.nsAttributeName(e),n)}))},la.prototype.addTagName=function(e){var t=this.logNamespaceUsed(e);return this.getNamespaces().logUsed(t),ta(e)},la.prototype.addAttribute=function(e,t){var i=this.attrs;ae(t)&&(t=aa(t,Xn,ia)),i.push({name:e,value:t})},la.prototype.serializeAttributes=function(e){var t=this.attrs,i=this.namespaces;i&&(t=function(e){return e.getUsed().filter((function(e){return"xml"!==e.prefix})).map((function(e){return{name:"xmlns"+(e.prefix?":"+e.prefix:""),value:e.uri}}))}(i).concat(t)),le(t,(function(t){e.append(" ").append(ta(t.name)).append('="').append(t.value).append('"')}))},la.prototype.serializeTo=function(e){var t=this.body[0],i=t&&t.constructor!==sa;e.appendIndent().append("<"+this.tagName),this.serializeAttributes(e),e.append(t?">":" />"),t&&(i&&e.appendNewLine().indent(),le(this.body,(function(t){t.serializeTo(e)})),i&&e.unindent().appendIndent(),e.append("</"+this.tagName+">")),e.appendNewLine()},ea(ca,la),ca.prototype.parseNsAttributes=function(e){var t=la.prototype.parseNsAttributes.call(this,e),i=e.$descriptor;if(i.name===this.propertyDescriptor.type)return t;var n=this.typeNs=this.nsTagName(i);this.getNamespaces().logUsed(this.typeNs);var a=e.$model.getPackage(n.uri),o=a.xml&&a.xml.typePrefix||"";return this.addAttribute(this.nsAttributeName(Fn),(n.prefix?n.prefix+":":"")+o+i.ns.localName),t},ca.prototype.isLocalNs=function(e){return e.uri===(this.typeNs||this.ns).uri},pa.prototype=Object.create(fn.prototype),pa.prototype.fromXML=function(e,t,i){ae(t)||(i=t,t="bpmn:Definitions");var n=new Kn(Ae({model:this,lax:!0},i)),a=n.handler(t);return n.fromXML(e,a)},pa.prototype.toXML=function(e,t){var i=new ha(t);return new Promise((function(t,n){try{return t({xml:i.toXML(e)})}catch(e){return n(e)}}))};var ma={bpmn:{name:"BPMN20",uri:"http://www.omg.org/spec/BPMN/20100524/MODEL",prefix:"bpmn",associations:[],types:[{name:"Interface",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"operations",type:"Operation",isMany:!0},{name:"implementationRef",isAttr:!0,type:"String"}]},{name:"Operation",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"inMessageRef",type:"Message",isReference:!0},{name:"outMessageRef",type:"Message",isReference:!0},{name:"errorRef",type:"Error",isMany:!0,isReference:!0},{name:"implementationRef",isAttr:!0,type:"String"}]},{name:"EndPoint",superClass:["RootElement"]},{name:"Auditing",superClass:["BaseElement"]},{name:"GlobalTask",superClass:["CallableElement"],properties:[{name:"resources",type:"ResourceRole",isMany:!0}]},{name:"Monitoring",superClass:["BaseElement"]},{name:"Performer",superClass:["ResourceRole"]},{name:"Process",superClass:["FlowElementsContainer","CallableElement"],properties:[{name:"processType",type:"ProcessType",isAttr:!0},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"properties",type:"Property",isMany:!0},{name:"laneSets",isMany:!0,replaces:"FlowElementsContainer#laneSets",type:"LaneSet"},{name:"flowElements",isMany:!0,replaces:"FlowElementsContainer#flowElements",type:"FlowElement"},{name:"artifacts",type:"Artifact",isMany:!0},{name:"resources",type:"ResourceRole",isMany:!0},{name:"correlationSubscriptions",type:"CorrelationSubscription",isMany:!0},{name:"supports",type:"Process",isMany:!0,isReference:!0},{name:"definitionalCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"isExecutable",isAttr:!0,type:"Boolean"}]},{name:"LaneSet",superClass:["BaseElement"],properties:[{name:"lanes",type:"Lane",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Lane",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"partitionElementRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"partitionElement",type:"BaseElement"},{name:"flowNodeRef",type:"FlowNode",isMany:!0,isReference:!0},{name:"childLaneSet",type:"LaneSet",xml:{serialize:"xsi:type"}}]},{name:"GlobalManualTask",superClass:["GlobalTask"]},{name:"ManualTask",superClass:["Task"]},{name:"UserTask",superClass:["Task"],properties:[{name:"renderings",type:"Rendering",isMany:!0},{name:"implementation",isAttr:!0,type:"String"}]},{name:"Rendering",superClass:["BaseElement"]},{name:"HumanPerformer",superClass:["Performer"]},{name:"PotentialOwner",superClass:["HumanPerformer"]},{name:"GlobalUserTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"renderings",type:"Rendering",isMany:!0}]},{name:"Gateway",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"gatewayDirection",type:"GatewayDirection",default:"Unspecified",isAttr:!0}]},{name:"EventBasedGateway",superClass:["Gateway"],properties:[{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"eventGatewayType",type:"EventBasedGatewayType",isAttr:!0,default:"Exclusive"}]},{name:"ComplexGateway",superClass:["Gateway"],properties:[{name:"activationCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ExclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"InclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ParallelGateway",superClass:["Gateway"]},{name:"RootElement",isAbstract:!0,superClass:["BaseElement"]},{name:"Relationship",superClass:["BaseElement"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"direction",type:"RelationshipDirection",isAttr:!0},{name:"source",isMany:!0,isReference:!0,type:"Element"},{name:"target",isMany:!0,isReference:!0,type:"Element"}]},{name:"BaseElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,type:"String",isId:!0},{name:"documentation",type:"Documentation",isMany:!0},{name:"extensionDefinitions",type:"ExtensionDefinition",isMany:!0,isReference:!0},{name:"extensionElements",type:"ExtensionElements"}]},{name:"Extension",properties:[{name:"mustUnderstand",default:!1,isAttr:!0,type:"Boolean"},{name:"definition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"extensionAttributeDefinitions",type:"ExtensionAttributeDefinition",isMany:!0}]},{name:"ExtensionAttributeDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"isReference",default:!1,isAttr:!0,type:"Boolean"},{name:"extensionDefinition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionElements",properties:[{name:"valueRef",isAttr:!0,isReference:!0,type:"Element"},{name:"values",type:"Element",isMany:!0},{name:"extensionAttributeDefinition",type:"ExtensionAttributeDefinition",isAttr:!0,isReference:!0}]},{name:"Documentation",superClass:["BaseElement"],properties:[{name:"text",type:"String",isBody:!0},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Event",isAbstract:!0,superClass:["FlowNode","InteractionNode"],properties:[{name:"properties",type:"Property",isMany:!0}]},{name:"IntermediateCatchEvent",superClass:["CatchEvent"]},{name:"IntermediateThrowEvent",superClass:["ThrowEvent"]},{name:"EndEvent",superClass:["ThrowEvent"]},{name:"StartEvent",superClass:["CatchEvent"],properties:[{name:"isInterrupting",default:!0,isAttr:!0,type:"Boolean"}]},{name:"ThrowEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"inputSet",type:"InputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"CatchEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"parallelMultiple",isAttr:!0,type:"Boolean",default:!1},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"outputSet",type:"OutputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity",default:!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"EventDefinition",isAbstract:!0,superClass:["RootElement"]},{name:"CancelEventDefinition",superClass:["EventDefinition"]},{name:"ErrorEventDefinition",superClass:["EventDefinition"],properties:[{name:"errorRef",type:"Error",isAttr:!0,isReference:!0}]},{name:"TerminateEventDefinition",superClass:["EventDefinition"]},{name:"EscalationEventDefinition",superClass:["EventDefinition"],properties:[{name:"escalationRef",type:"Escalation",isAttr:!0,isReference:!0}]},{name:"Escalation",properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"escalationCode",isAttr:!0,type:"String"}],superClass:["RootElement"]},{name:"CompensateEventDefinition",superClass:["EventDefinition"],properties:[{name:"waitForCompletion",isAttr:!0,type:"Boolean",default:!0},{name:"activityRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"TimerEventDefinition",superClass:["EventDefinition"],properties:[{name:"timeDate",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeCycle",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeDuration",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"LinkEventDefinition",superClass:["EventDefinition"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"target",type:"LinkEventDefinition",isAttr:!0,isReference:!0},{name:"source",type:"LinkEventDefinition",isMany:!0,isReference:!0}]},{name:"MessageEventDefinition",superClass:["EventDefinition"],properties:[{name:"messageRef",type:"Message",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"ConditionalEventDefinition",superClass:["EventDefinition"],properties:[{name:"condition",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"SignalEventDefinition",superClass:["EventDefinition"],properties:[{name:"signalRef",type:"Signal",isAttr:!0,isReference:!0}]},{name:"Signal",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ImplicitThrowEvent",superClass:["ThrowEvent"]},{name:"DataState",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ItemAwareElement",superClass:["BaseElement"],properties:[{name:"itemSubjectRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"dataState",type:"DataState"}]},{name:"DataAssociation",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"ItemAwareElement",isMany:!0,isReference:!0},{name:"targetRef",type:"ItemAwareElement",isReference:!0},{name:"transformation",type:"FormalExpression",xml:{serialize:"property"}},{name:"assignment",type:"Assignment",isMany:!0}]},{name:"DataInput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"inputSetRef",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"inputSetWithOptional",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"inputSetWithWhileExecuting",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"DataOutput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"outputSetRef",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"outputSetWithOptional",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"outputSetWithWhileExecuting",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"InputSet",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"dataInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"optionalInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"whileExecutingInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"outputSetRefs",type:"OutputSet",isMany:!0,isReference:!0}]},{name:"OutputSet",superClass:["BaseElement"],properties:[{name:"dataOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"inputSetRefs",type:"InputSet",isMany:!0,isReference:!0},{name:"optionalOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"whileExecutingOutputRefs",type:"DataOutput",isMany:!0,isReference:!0}]},{name:"Property",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"DataInputAssociation",superClass:["DataAssociation"]},{name:"DataOutputAssociation",superClass:["DataAssociation"]},{name:"InputOutputSpecification",superClass:["BaseElement"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"inputSets",type:"InputSet",isMany:!0},{name:"outputSets",type:"OutputSet",isMany:!0}]},{name:"DataObject",superClass:["FlowElement","ItemAwareElement"],properties:[{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"}]},{name:"InputOutputBinding",properties:[{name:"inputDataRef",type:"InputSet",isAttr:!0,isReference:!0},{name:"outputDataRef",type:"OutputSet",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"Assignment",superClass:["BaseElement"],properties:[{name:"from",type:"Expression",xml:{serialize:"xsi:type"}},{name:"to",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"DataStore",superClass:["RootElement","ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"capacity",isAttr:!0,type:"Integer"},{name:"isUnlimited",default:!0,isAttr:!0,type:"Boolean"}]},{name:"DataStoreReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataStoreRef",type:"DataStore",isAttr:!0,isReference:!0}]},{name:"DataObjectReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataObjectRef",type:"DataObject",isAttr:!0,isReference:!0}]},{name:"ConversationLink",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ConversationAssociation",superClass:["BaseElement"],properties:[{name:"innerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0},{name:"outerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0}]},{name:"CallConversation",superClass:["ConversationNode"],properties:[{name:"calledCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"Conversation",superClass:["ConversationNode"]},{name:"SubConversation",superClass:["ConversationNode"],properties:[{name:"conversationNodes",type:"ConversationNode",isMany:!0}]},{name:"ConversationNode",isAbstract:!0,superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0},{name:"messageFlowRefs",type:"MessageFlow",isMany:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0}]},{name:"GlobalConversation",superClass:["Collaboration"]},{name:"PartnerEntity",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"PartnerRole",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"CorrelationProperty",superClass:["RootElement"],properties:[{name:"correlationPropertyRetrievalExpression",type:"CorrelationPropertyRetrievalExpression",isMany:!0},{name:"name",isAttr:!0,type:"String"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Error",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"errorCode",isAttr:!0,type:"String"}]},{name:"CorrelationKey",superClass:["BaseElement"],properties:[{name:"correlationPropertyRef",type:"CorrelationProperty",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Expression",superClass:["BaseElement"],isAbstract:!1,properties:[{name:"body",isBody:!0,type:"String"}]},{name:"FormalExpression",superClass:["Expression"],properties:[{name:"language",isAttr:!0,type:"String"},{name:"evaluatesToTypeRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Message",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"itemRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"ItemDefinition",superClass:["RootElement"],properties:[{name:"itemKind",type:"ItemKind",isAttr:!0},{name:"structureRef",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"import",type:"Import",isAttr:!0,isReference:!0}]},{name:"FlowElement",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"categoryValueRef",type:"CategoryValue",isMany:!0,isReference:!0}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"sourceRef",type:"FlowNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",isAttr:!0,isReference:!0}]},{name:"FlowElementsContainer",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"laneSets",type:"LaneSet",isMany:!0},{name:"flowElements",type:"FlowElement",isMany:!0}]},{name:"CallableElement",isAbstract:!0,superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"supportedInterfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"ioBinding",type:"InputOutputBinding",isMany:!0,xml:{serialize:"property"}}]},{name:"FlowNode",isAbstract:!0,superClass:["FlowElement"],properties:[{name:"incoming",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"outgoing",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"lanes",type:"Lane",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"CorrelationPropertyRetrievalExpression",superClass:["BaseElement"],properties:[{name:"messagePath",type:"FormalExpression"},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"CorrelationPropertyBinding",superClass:["BaseElement"],properties:[{name:"dataPath",type:"FormalExpression"},{name:"correlationPropertyRef",type:"CorrelationProperty",isAttr:!0,isReference:!0}]},{name:"Resource",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"resourceParameters",type:"ResourceParameter",isMany:!0}]},{name:"ResourceParameter",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isRequired",isAttr:!0,type:"Boolean"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"CorrelationSubscription",superClass:["BaseElement"],properties:[{name:"correlationKeyRef",type:"CorrelationKey",isAttr:!0,isReference:!0},{name:"correlationPropertyBinding",type:"CorrelationPropertyBinding",isMany:!0}]},{name:"MessageFlow",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"MessageFlowAssociation",superClass:["BaseElement"],properties:[{name:"innerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0},{name:"outerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0}]},{name:"InteractionNode",isAbstract:!0,properties:[{name:"incomingConversationLinks",type:"ConversationLink",isMany:!0,isVirtual:!0,isReference:!0},{name:"outgoingConversationLinks",type:"ConversationLink",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"Participant",superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"interfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"participantMultiplicity",type:"ParticipantMultiplicity"},{name:"endPointRefs",type:"EndPoint",isMany:!0,isReference:!0},{name:"processRef",type:"Process",isAttr:!0,isReference:!0}]},{name:"ParticipantAssociation",superClass:["BaseElement"],properties:[{name:"innerParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"outerParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"ParticipantMultiplicity",properties:[{name:"minimum",default:0,isAttr:!0,type:"Integer"},{name:"maximum",default:1,isAttr:!0,type:"Integer"}],superClass:["BaseElement"]},{name:"Collaboration",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"participants",type:"Participant",isMany:!0},{name:"messageFlows",type:"MessageFlow",isMany:!0},{name:"artifacts",type:"Artifact",isMany:!0},{name:"conversations",type:"ConversationNode",isMany:!0},{name:"conversationAssociations",type:"ConversationAssociation"},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0},{name:"messageFlowAssociations",type:"MessageFlowAssociation",isMany:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"choreographyRef",type:"Choreography",isMany:!0,isReference:!0},{name:"conversationLinks",type:"ConversationLink",isMany:!0}]},{name:"ChoreographyActivity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"participantRef",type:"Participant",isMany:!0,isReference:!0},{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"loopType",type:"ChoreographyLoopType",default:"None",isAttr:!0}]},{name:"CallChoreography",superClass:["ChoreographyActivity"],properties:[{name:"calledChoreographyRef",type:"Choreography",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"SubChoreography",superClass:["ChoreographyActivity","FlowElementsContainer"],properties:[{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"ChoreographyTask",superClass:["ChoreographyActivity"],properties:[{name:"messageFlowRef",type:"MessageFlow",isMany:!0,isReference:!0}]},{name:"Choreography",superClass:["Collaboration","FlowElementsContainer"]},{name:"GlobalChoreographyTask",superClass:["Choreography"],properties:[{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Group",superClass:["Artifact"],properties:[{name:"categoryValueRef",type:"CategoryValue",isAttr:!0,isReference:!0}]},{name:"Association",superClass:["Artifact"],properties:[{name:"associationDirection",type:"AssociationDirection",isAttr:!0},{name:"sourceRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"targetRef",type:"BaseElement",isAttr:!0,isReference:!0}]},{name:"Category",superClass:["RootElement"],properties:[{name:"categoryValue",type:"CategoryValue",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Artifact",isAbstract:!0,superClass:["BaseElement"]},{name:"CategoryValue",superClass:["BaseElement"],properties:[{name:"categorizedFlowElements",type:"FlowElement",isMany:!0,isVirtual:!0,isReference:!0},{name:"value",isAttr:!0,type:"String"}]},{name:"Activity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"isForCompensation",default:!1,isAttr:!0,type:"Boolean"},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"boundaryEventRefs",type:"BoundaryEvent",isMany:!0,isReference:!0},{name:"properties",type:"Property",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"startQuantity",default:1,isAttr:!0,type:"Integer"},{name:"resources",type:"ResourceRole",isMany:!0},{name:"completionQuantity",default:1,isAttr:!0,type:"Integer"},{name:"loopCharacteristics",type:"LoopCharacteristics"}]},{name:"ServiceTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"SubProcess",superClass:["Activity","FlowElementsContainer","InteractionNode"],properties:[{name:"triggeredByEvent",default:!1,isAttr:!0,type:"Boolean"},{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"LoopCharacteristics",isAbstract:!0,superClass:["BaseElement"]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential",default:!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior",default:"All",isAttr:!0},{name:"loopCardinality",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopDataInputRef",type:"ItemAwareElement",isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",isReference:!0},{name:"inputDataItem",type:"DataInput",xml:{serialize:"property"}},{name:"outputDataItem",type:"DataOutput",xml:{serialize:"property"}},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",isMany:!0},{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"oneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0}]},{name:"StandardLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"testBefore",default:!1,isAttr:!0,type:"Boolean"},{name:"loopCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopMaximum",type:"Integer",isAttr:!0}]},{name:"CallActivity",superClass:["Activity","InteractionNode"],properties:[{name:"calledElement",type:"String",isAttr:!0}]},{name:"Task",superClass:["Activity","InteractionNode"]},{name:"SendTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ReceiveTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ScriptTask",superClass:["Task"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"script",type:"String"}]},{name:"BusinessRuleTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"AdHocSubProcess",superClass:["SubProcess"],properties:[{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"ordering",type:"AdHocOrdering",isAttr:!0},{name:"cancelRemainingInstances",default:!0,isAttr:!0,type:"Boolean"}]},{name:"Transaction",superClass:["SubProcess"],properties:[{name:"protocol",isAttr:!0,type:"String"},{name:"method",isAttr:!0,type:"String"}]},{name:"GlobalScriptTask",superClass:["GlobalTask"],properties:[{name:"scriptLanguage",isAttr:!0,type:"String"},{name:"script",isAttr:!0,type:"String"}]},{name:"GlobalBusinessRuleTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"ComplexBehaviorDefinition",superClass:["BaseElement"],properties:[{name:"condition",type:"FormalExpression"},{name:"event",type:"ImplicitThrowEvent"}]},{name:"ResourceRole",superClass:["BaseElement"],properties:[{name:"resourceRef",type:"Resource",isReference:!0},{name:"resourceParameterBindings",type:"ResourceParameterBinding",isMany:!0},{name:"resourceAssignmentExpression",type:"ResourceAssignmentExpression"},{name:"name",isAttr:!0,type:"String"}]},{name:"ResourceParameterBinding",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"parameterRef",type:"ResourceParameter",isAttr:!0,isReference:!0}],superClass:["BaseElement"]},{name:"ResourceAssignmentExpression",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}}],superClass:["BaseElement"]},{name:"Import",properties:[{name:"importType",isAttr:!0,type:"String"},{name:"location",isAttr:!0,type:"String"},{name:"namespace",isAttr:!0,type:"String"}]},{name:"Definitions",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"targetNamespace",isAttr:!0,type:"String"},{name:"expressionLanguage",default:"http://www.w3.org/1999/XPath",isAttr:!0,type:"String"},{name:"typeLanguage",default:"http://www.w3.org/2001/XMLSchema",isAttr:!0,type:"String"},{name:"imports",type:"Import",isMany:!0},{name:"extensions",type:"Extension",isMany:!0},{name:"rootElements",type:"RootElement",isMany:!0},{name:"diagrams",isMany:!0,type:"bpmndi:BPMNDiagram"},{name:"exporter",isAttr:!0,type:"String"},{name:"relationships",type:"Relationship",isMany:!0},{name:"exporterVersion",isAttr:!0,type:"String"}]}],enumerations:[{name:"ProcessType",literalValues:[{name:"None"},{name:"Public"},{name:"Private"}]},{name:"GatewayDirection",literalValues:[{name:"Unspecified"},{name:"Converging"},{name:"Diverging"},{name:"Mixed"}]},{name:"EventBasedGatewayType",literalValues:[{name:"Parallel"},{name:"Exclusive"}]},{name:"RelationshipDirection",literalValues:[{name:"None"},{name:"Forward"},{name:"Backward"},{name:"Both"}]},{name:"ItemKind",literalValues:[{name:"Physical"},{name:"Information"}]},{name:"ChoreographyLoopType",literalValues:[{name:"None"},{name:"Standard"},{name:"MultiInstanceSequential"},{name:"MultiInstanceParallel"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"MultiInstanceBehavior",literalValues:[{name:"None"},{name:"One"},{name:"All"},{name:"Complex"}]},{name:"AdHocOrdering",literalValues:[{name:"Parallel"},{name:"Sequential"}]}],xml:{tagAlias:"lowerCase",typePrefix:"t"}},bpmndi:{name:"BPMNDI",uri:"http://www.omg.org/spec/BPMN/20100524/DI",prefix:"bpmndi",types:[{name:"BPMNDiagram",properties:[{name:"plane",type:"BPMNPlane",redefines:"di:Diagram#rootElement"},{name:"labelStyle",type:"BPMNLabelStyle",isMany:!0}],superClass:["di:Diagram"]},{name:"BPMNPlane",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"}],superClass:["di:Plane"]},{name:"BPMNShape",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"isHorizontal",isAttr:!0,type:"Boolean"},{name:"isExpanded",isAttr:!0,type:"Boolean"},{name:"isMarkerVisible",isAttr:!0,type:"Boolean"},{name:"label",type:"BPMNLabel"},{name:"isMessageVisible",isAttr:!0,type:"Boolean"},{name:"participantBandKind",type:"ParticipantBandKind",isAttr:!0},{name:"choreographyActivityShape",type:"BPMNShape",isAttr:!0,isReference:!0}],superClass:["di:LabeledShape"]},{name:"BPMNEdge",properties:[{name:"label",type:"BPMNLabel"},{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"sourceElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#source"},{name:"targetElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#target"},{name:"messageVisibleKind",type:"MessageVisibleKind",isAttr:!0,default:"initiating"}],superClass:["di:LabeledEdge"]},{name:"BPMNLabel",properties:[{name:"labelStyle",type:"BPMNLabelStyle",isAttr:!0,isReference:!0,redefines:"di:DiagramElement#style"}],superClass:["di:Label"]},{name:"BPMNLabelStyle",properties:[{name:"font",type:"dc:Font"}],superClass:["di:Style"]}],enumerations:[{name:"ParticipantBandKind",literalValues:[{name:"top_initiating"},{name:"middle_initiating"},{name:"bottom_initiating"},{name:"top_non_initiating"},{name:"middle_non_initiating"},{name:"bottom_non_initiating"}]},{name:"MessageVisibleKind",literalValues:[{name:"initiating"},{name:"non_initiating"}]}],associations:[]},dc:{name:"DC",uri:"http://www.omg.org/spec/DD/20100524/DC",prefix:"dc",types:[{name:"Boolean"},{name:"Integer"},{name:"Real"},{name:"String"},{name:"Font",properties:[{name:"name",type:"String",isAttr:!0},{name:"size",type:"Real",isAttr:!0},{name:"isBold",type:"Boolean",isAttr:!0},{name:"isItalic",type:"Boolean",isAttr:!0},{name:"isUnderline",type:"Boolean",isAttr:!0},{name:"isStrikeThrough",type:"Boolean",isAttr:!0}]},{name:"Point",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0}]},{name:"Bounds",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0},{name:"width",type:"Real",isAttr:!0},{name:"height",type:"Real",isAttr:!0}]}],associations:[]},di:{name:"DI",uri:"http://www.omg.org/spec/DD/20100524/DI",prefix:"di",types:[{name:"DiagramElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"extension",type:"Extension"},{name:"owningDiagram",type:"Diagram",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"owningElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"modelElement",isReadOnly:!0,isVirtual:!0,isReference:!0,type:"Element"},{name:"style",type:"Style",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"ownedElement",type:"DiagramElement",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:"Node",isAbstract:!0,superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,superClass:["DiagramElement"],properties:[{name:"source",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"target",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"waypoint",isUnique:!1,isMany:!0,type:"dc:Point",xml:{serialize:"xsi:type"}}]},{name:"Diagram",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"rootElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0},{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"},{name:"ownedStyle",type:"Style",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:"Shape",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Plane",isAbstract:!0,superClass:["Node"],properties:[{name:"planeElement",type:"DiagramElement",subsettedProperty:"DiagramElement-ownedElement",isMany:!0}]},{name:"LabeledEdge",isAbstract:!0,superClass:["Edge"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isMany:!0,isVirtual:!0}]},{name:"LabeledShape",isAbstract:!0,superClass:["Shape"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isMany:!0,isVirtual:!0}]},{name:"Label",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Style",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"}]},{name:"Extension",properties:[{name:"values",isMany:!0,type:"Element"}]}],associations:[],xml:{tagAlias:"lowerCase"}},bioc:{name:"bpmn.io colors for BPMN",uri:"http://bpmn.io/schema/bpmn/biocolor/1.0",prefix:"bioc",types:[{name:"ColoredShape",extends:["bpmndi:BPMNShape"],properties:[{name:"stroke",isAttr:!0,type:"String"},{name:"fill",isAttr:!0,type:"String"}]},{name:"ColoredEdge",extends:["bpmndi:BPMNEdge"],properties:[{name:"stroke",isAttr:!0,type:"String"},{name:"fill",isAttr:!0,type:"String"}]}],enumerations:[],associations:[]},color:{name:"BPMN in Color",uri:"http://www.omg.org/spec/BPMN/non-normative/color/1.0",prefix:"color",types:[{name:"ColoredLabel",extends:["bpmndi:BPMNLabel"],properties:[{name:"color",isAttr:!0,type:"String"}]},{name:"ColoredShape",extends:["bpmndi:BPMNShape"],properties:[{name:"background-color",isAttr:!0,type:"String"},{name:"border-color",isAttr:!0,type:"String"}]},{name:"ColoredEdge",extends:["bpmndi:BPMNEdge"],properties:[{name:"border-color",isAttr:!0,type:"String"}]}],enumerations:[],associations:[]}};const fa=function(e,t){return new pa(Ae({},ma,e),t)};function ga(e){return e?"<"+e.$type+(e.id?' id="'+e.id:"")+'" />':"<null>"}function va(e){return function(){if(!window.Promise)throw new Error("Promises is not supported in this environment. Please polyfill Promise.");var t=arguments.length;if(!(t>=1&&ne(arguments[t-1])))return e.apply(this,arguments);var i=arguments[t-1];console.warn(new Error("Passing callbacks to "+e.name+" is deprecated and will be removed in a future major release. Please switch to promises: https://bpmn.io/l/moving-to-promises.html"));var n=Array.prototype.slice.call(arguments,0,-1);e.apply(this,n).then((function(e){var t=Object.keys(e)[0];return i(null,e[t])}),(function(e){return i(e,e.warnings)}))}}function ba(e){oe(e,"di")||Object.defineProperty(e,"di",{get:function(){throw new Error("Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472")}})}function ya(e,t){return e.$instanceOf(t)}function wa(e,t){var i={},n=[],a={};function o(e,t){return function(i){e(i,t)}}function s(e){i[e.id]=e}function r(i,n){try{var o=a[i.id]&&function(i,n){if(i.gfx)throw new Error(t("already rendered {element}",{element:ga(i)}));return e.element(i,a[i.id],n)}(i,n);return s(i),o}catch(e){l(e.message,{element:i,error:e}),console.error(t("failed to import {element}",{element:ga(i)})),console.error(e)}}function l(t,i){e.error(t,i)}function c(e){var i=e.bpmnElement;i?a[i.id]?l(t("multiple DI elements defined for {element}",{element:ga(i)}),{element:i}):(a[i.id]=e,ba(i)):l(t("no bpmnElement referenced in {element}",{element:ga(e)}),{element:e})}function d(e){c(e)}function u(){for(;n.length;)n.shift()()}function h(e,t){C(e,t),y(e.ioSpecification,t),b(e.artifacts,t),s(e)}function p(e,t){r(e,t)}function m(e,t){r(e,t)}function f(e,t){r(e,t)}function g(e,t){r(e,t)}function v(e,t){r(e,t)}function b(e,t){le(e,(function(e){ya(e,"bpmn:Association")?n.push((function(){v(e,t)})):v(e,t)}))}function y(e,t){e&&(le(e.dataInputs,o(f,t)),le(e.dataOutputs,o(g,t)))}function w(e,t){C(e,t),b(e.artifacts,t)}function x(e,t){var i=r(e,t);ya(e,"bpmn:SubProcess")&&w(e,i||t),ya(e,"bpmn:Activity")&&y(e.ioSpecification,t),n.push((function(){le(e.dataInputAssociations,o(m,t)),le(e.dataOutputAssociations,o(m,t))}))}function $(e,t){n.push((function(){var i=r(e,t);e.childLaneSet&&_(e.childLaneSet,i||t),function(e){le(e.flowNodeRef,(function(t){var i=t.get("lanes");i&&i.push(e)}))}(e)}))}function _(e,t){le(e.lanes,o($,t))}function C(e,i){!function(e,i){le(e,(function(e){ya(e,"bpmn:SequenceFlow")?n.push((function(){!function(e,t){r(e,t)}(e,i)})):ya(e,"bpmn:BoundaryEvent")?n.unshift((function(){x(e,i)})):ya(e,"bpmn:FlowNode")?x(e,i):ya(e,"bpmn:DataObject")||(ya(e,"bpmn:DataStoreReference")||ya(e,"bpmn:DataObjectReference")?function(e,t){r(e,t)}(e,i):l(t("unrecognized flowElement {element} in context {context}",{element:ga(e),context:i?ga(i.businessObject):"null"}),{element:e,context:i}))}))}(e.flowElements,i),e.laneSets&&function(e,t){le(e,o(_,t))}(e.laneSets,i)}function E(e,t){var i=r(e,t),n=e.processRef;n&&h(n,i||t)}return{handleDeferred:u,handleDefinitions:function(s,r){var m=s.diagrams;if(r&&-1===m.indexOf(r))throw new Error(t("diagram not part of bpmn:Definitions"));if(!r&&m&&m.length&&(r=m[0]),!r)throw new Error(t("no diagram to display"));a={},function(e){var t;c(t=e.plane),le(t.planeElement,d)}(r);var f=r.plane;if(!f)throw new Error(t("no plane for {element}",{element:ga(r)}));var g=f.bpmnElement;if(!g){if(g=function(e){return se(e.rootElements,(function(e){return ya(e,"bpmn:Process")||ya(e,"bpmn:Collaboration")}))}(s),!g)throw new Error(t("no process or collaboration to display"));l(t("correcting missing bpmnElement on {plane} to {rootElement}",{plane:ga(f),rootElement:ga(g)})),f.bpmnElement=g,c(f)}var v,y,w=function(t,i){return e.root(t,a[t.id],i)}(g,f);if(ya(g,"bpmn:Process")||ya(g,"bpmn:SubProcess"))h(g,w);else{if(!ya(g,"bpmn:Collaboration"))throw new Error(t("unsupported bpmnElement for {plane}: {rootElement}",{plane:ga(f),rootElement:ga(g)}));y=w,le((v=g).participants,o(E,y)),b(v.artifacts,y),n.push((function(){!function(e,t){le(e,o(p,t))}(v.messageFlows,y)})),function(e,t){re(e,(function(e){return!i[e.id]&&ya(e,"bpmn:Process")&&e.laneSets})).forEach(o(h,t))}(s.rootElements,w)}u()},handleSubProcess:w,registerDi:c}}function xa(e,t){var i=_a(e);return i&&"function"==typeof i.$instanceOf&&i.$instanceOf(t)}function $a(e,t){return ue(t,(function(t){return xa(e,t)}))}function _a(e){return e&&e.businessObject||e}function Ca(e){return e&&e.di}function Ea(e,t,i){var n,a,o,s,r=[];function l(e,t){var i=new wa({root:function(e,t){return n.add(e,t)},element:function(e,t,i){return n.add(e,t,i)},error:function(e,t){r.push({message:e,context:t})}},o);t=t||e.diagrams&&e.diagrams[0];var a=function(e,t){if(t){var i,n=t.plane.bpmnElement,a=n;xa(n,"bpmn:Process")||xa(n,"bpmn:Collaboration")||(a=function(e){for(var t=e;t;){if(xa(t,"bpmn:Process"))return t;t=t.$parent}}(n)),i=xa(a,"bpmn:Collaboration")?a:se(e.rootElements,(function(e){if(xa(e,"bpmn:Collaboration"))return se(e.participants,(function(e){return e.processRef===a}))}));var o=[a];i&&(o=he(i.participants,(function(e){return e.processRef}))).push(i);var s=Sa(o),r=[t],l=[n];return le(e.diagrams,(function(e){var t=e.plane.bpmnElement;-1!==s.indexOf(t)&&-1===l.indexOf(t)&&(r.push(e),l.push(t))})),r}}(e,t);if(!a)throw new Error(o("no diagram to display"));le(a,(function(t){i.handleDefinitions(e,t)}));var l=t.plane.bpmnElement.id;s.setRootElement(s.findRoot(l+"_plane")||s.findRoot(l))}return new Promise((function(c,d){try{return n=e.get("bpmnImporter"),a=e.get("eventBus"),o=e.get("translate"),s=e.get("canvas"),a.fire("import.render.start",{definitions:t}),l(t,i),a.fire("import.render.complete",{error:void 0,warnings:r}),c({warnings:r})}catch(e){return e.warnings=r,d(e)}}))}function Sa(e){var t=[];return le(e,(function(e){e&&(t.push(e),t=t.concat(Sa(e.flowElements)))})),t}var ka='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14.02 5.57" width="53" height="21" style="vertical-align:middle"><path fill="currentColor" d="M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z"/><path fill="currentColor" d="M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z"/></svg>';function Aa(e){return e.join(";")}var Da,Ra=Aa(["color: #404040"]),Pa='<div class="bjs-powered-by-lightbox" style="'+Aa(["z-index: 1001","position: fixed","top: 0","left: 0","right: 0","bottom: 0"])+'"><div class="backdrop" style="'+Aa(["width: 100%","height: 100%","background: rgba(40,40,40,0.2)"])+'"></div><div class="notice" style="'+Aa(["position: absolute","left: 50%","top: 40%","transform: translate(-50%)","width: 260px","padding: 10px","background: white","box-shadow: 0 1px 4px rgba(0,0,0,0.3)","font-family: Helvetica, Arial, sans-serif","font-size: 14px","display: flex","line-height: 1.3"])+'"><a href="https://bpmn.io" target="_blank" rel="noopener" style="margin: 15px 20px 15px 10px; align-self: center;'+Ra+'">'+ka+'</a><span>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="https://bpmn.io" target="_blank" rel="noopener">bpmn.io</a>.</span></div></div>';function La(e){var t,i;e=Ae({},Fa,e),this._moddle=this._createModdle(e),this._container=this._createContainer(e),t=this._container,i=Xe('<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" style="position: absolute; bottom: 15px; right: 15px; z-index: 100; '+Ra+'">'+ka+"</a>"),t.appendChild(i),Ge.bind(i,"click",(function(e){Da||(Da=Xe(Pa),Ye(Da,".backdrop","click",(function(e){document.body.removeChild(Da)}))),document.body.appendChild(Da),e.preventDefault()})),this._init(this._container,this._moddle,e)}function Va(e,t){return e.warnings=t,e}U()(La,en),La.prototype.importXML=va((function(e,t){var i=this;return new Promise((function(n,a){e=i._emit("import.parse.start",{xml:e})||e,i._moddle.fromXML(e,"bpmn:Definitions").then((function(e){var o,s,r=e.rootElement,l=e.references,c=e.warnings,d=e.elementsById;r=i._emit("import.parse.complete",(o={error:null,definitions:r,elementsById:d,references:l,warnings:c},s=i.get("eventBus").createEvent(o),Object.defineProperty(s,"context",{enumerable:!0,get:function(){return console.warn(new Error("import.parse.complete <context> is deprecated and will be removed in future library versions")),{warnings:o.warnings,references:o.references,elementsById:o.elementsById}}}),s))||r,i.importDefinitions(r,t).then((function(e){var t=[].concat(c,e.warnings||[]);return i._emit("import.done",{error:null,warnings:t}),n({warnings:t})})).catch((function(e){var t=[].concat(c,e.warnings||[]);return i._emit("import.done",{error:e,warnings:t}),a(Va(e,t))}))})).catch((function(e){return i._emit("import.parse.complete",{error:e}),e=function(e){var t=/unparsable content <([^>]+)> detected([\s\S]*)$/.exec(e.message);return t&&(e.message="unparsable content <"+t[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+t[2]),e}(e),i._emit("import.done",{error:e,warnings:e.warnings}),a(e)}))}))})),La.prototype.importDefinitions=va((function(e,t){var i=this;return new Promise((function(n,a){i._setDefinitions(e),i.open(t).then((function(e){var t=e.warnings;return n({warnings:t})})).catch((function(e){return a(e)}))}))})),La.prototype.open=va((function(e){var t=this._definitions,i=e,n=this;return new Promise((function(a,o){if(!t){var s=new Error("no XML imported");return o(Va(s,[]))}if("string"==typeof e&&(i=function(e,t){return t&&se(e.diagrams,(function(e){return e.id===t}))||null}(t,e),!i)){var r=new Error("BPMNDiagram <"+e+"> not found");return o(Va(r,[]))}try{n.clear()}catch(e){return o(Va(e,[]))}Ea(n,t,i).then((function(e){var t=e.warnings;return a({warnings:t})})).catch((function(e){return o(e)}))}))})),La.prototype.saveXML=va((function(e){e=e||{};var t=this,i=this._definitions;return new Promise((function(n){if(!i)return n({error:new Error("no definitions loaded")});i=t._emit("saveXML.start",{definitions:i})||i,t._moddle.toXML(i,e).then((function(e){var i=e.xml;return i=t._emit("saveXML.serialized",{xml:i})||i,n({xml:i})}))})).catch((function(e){return{error:e}})).then((function(e){t._emit("saveXML.done",e);var i=e.error;return i?Promise.reject(i):e}))})),La.prototype.saveSVG=va((function(e){e=e||{};var t=this;return new Promise((function(e,i){var n,a;t._emit("saveSVG.start");try{var o=t.get("canvas"),s=o.getActiveLayer(),r=et("defs",o._svg),l=Dt(s),c=r?"<defs>"+Dt(r)+"</defs>":"",d=s.getBBox();n='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- created with bpmn-js / http://bpmn.io --\x3e\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+d.width+'" height="'+d.height+'" viewBox="'+d.x+" "+d.y+" "+d.width+" "+d.height+'" version="1.1">'+c+l+"</svg>"}catch(e){a=e}return t._emit("saveSVG.done",{error:a,svg:n}),a?i(a):e({svg:n})}))})),La.prototype._setDefinitions=function(e){this._definitions=e},La.prototype.getModules=function(){return this._modules},La.prototype.clear=function(){this.getDefinitions()&&en.prototype.clear.call(this)},La.prototype.destroy=function(){en.prototype.destroy.call(this),it(this._container)},La.prototype.on=function(e,t,i,n){return this.get("eventBus").on(e,t,i,n)},La.prototype.off=function(e,t){this.get("eventBus").off(e,t)},La.prototype.attachTo=function(e){if(!e)throw new Error("parentNode required");this.detach(),e.get&&e.constructor.prototype.jquery&&(e=e.get(0)),"string"==typeof e&&(e=et(e)),e.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},La.prototype.getDefinitions=function(){return this._definitions},La.prototype.detach=function(){var e=this._container,t=e.parentNode;t&&(this._emit("detach",{}),t.removeChild(e))},La.prototype._init=function(e,t,i){var n=i.modules||this.getModules(),a=i.additionalModules||[],o=[].concat([{bpmnjs:["value",this],moddle:["value",t]}],n,a),s=Ae(Re(i,["additionalModules"]),{canvas:Ae({},i.canvas,{container:e}),modules:o});en.call(this,s),i&&i.container&&this.attachTo(i.container)},La.prototype._emit=function(e,t){return this.get("eventBus").fire(e,t)},La.prototype._createContainer=function(e){var t=Xe('<div class="bjs-container"></div>');return Ae(t.style,{width:Ia(e.width),height:Ia(e.height),position:e.position}),t},La.prototype._createModdle=function(e){var t=Ae({},this._moddleExtensions,e.moddleExtensions);return new fa(t)},La.prototype._modules=[];var Fa={width:"100%",height:"100%",position:"relative"};function Ia(e){return e+(ie(e)?"px":"")}function Ba(e){La.call(this,e),this.on("import.parse.complete",(function(e){e.error||this._collectIds(e.definitions,e.elementsById)}),this),this.on("diagram.destroy",(function(){this.get("moddle").ids.clear()}),this)}function Ta(e,t){return!xa(e,"bpmn:CallActivity")&&(xa(e,"bpmn:SubProcess")?!(!(t=t||Ca(e))||!xa(t,"bpmndi:BPMNPlane"))||t&&!!t.isExpanded:!xa(e,"bpmn:Participant")||!!_a(e).processRef)}function ja(e){return e&&!!_a(e).triggeredByEvent}function Oa(e,t){var i=_a(e),n=!1;return i.eventDefinitions&&le(i.eventDefinitions,(function(e){xa(e,t)&&(n=!0)})),n}function Ma(e){return xa(e,"bpmn:FlowElement")||xa(e,"bpmn:Participant")||xa(e,"bpmn:Lane")||xa(e,"bpmn:SequenceFlow")||xa(e,"bpmn:MessageFlow")||xa(e,"bpmn:DataInput")||xa(e,"bpmn:DataOutput")?"name":xa(e,"bpmn:TextAnnotation")?"text":xa(e,"bpmn:Group")?"categoryValueRef":void 0}function Na(e){var t=e.businessObject,i=Ma(t);if(i)return"categoryValueRef"===i?function(e){var t=e.categoryValueRef;return t&&t.value||""}(t):t[i]||""}function Wa(e,t,i){return ue(e.eventDefinitions,(function(n){return n.$type===t&&function(e,t){return de(t,(function(t,i){return e[i]==t}))}(e,i)}))}function za(e){return e.businessObject}function Ua(e,t){var i=Ca(e);return i.get("color:background-color")||i.get("bioc:fill")||t||"white"}function qa(e,t){var i=Ca(e);return i.get("color:border-color")||i.get("bioc:stroke")||t||"black"}function Ha(e,t,i){var n=Ca(e).get("label");return n&&n.get("color:color")||t||qa(e,i)}function Ga(e,t){var i=e.x,n=e.y,a=e.width,o=e.height;return qt([["M",i+t,n],["l",a-2*t,0],["a",t,t,0,0,1,t,t],["l",0,o-2*t],["a",t,t,0,0,1,-t,t],["l",2*t-a,0],["a",t,t,0,0,1,-t,-t],["l",0,2*t-o],["a",t,t,0,0,1,t,-t],["z"]])}U()(Ba,La),Ba.prototype._createModdle=function(e){var t=La.prototype._createModdle.call(this,e);return t.ids=new G([32,36,1]),t},Ba.prototype._collectIds=function(e,t){var i,n=e.$model.ids;for(i in n.clear(),t)n.claim(i,t[i])};var Za=new G,Ya=.95;function Ka(e,t,i,n,a,o,s){Ut.call(this,t,s);var r=e&&e.defaultFillColor,l=e&&e.defaultStrokeColor,c=e&&e.defaultLabelColor,d=Za.next(),u={},h=i.computeStyle;function p(e,t){var i=Ae({fill:"black",strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},t.attrs),n=t.ref||{x:0,y:0},o=t.scale||1;"none"===i.strokeDasharray&&(i.strokeDasharray=[1e4,1]);var s=wt("marker");rt(t.element,i),at(s,t.element),rt(s,{id:e,viewBox:"0 0 20 20",refX:n.x,refY:n.y,markerWidth:20*o,markerHeight:20*o,orient:"auto"});var r=et("defs",a._svg);r||(r=wt("defs"),at(a._svg,r)),at(r,s),u[e]=s}function m(e){return e.replace(/[^0-9a-zA-z]+/g,"_")}function f(e,t,i){var n=e+"-"+m(t)+"-"+m(i)+"-"+d;return u[n]||function(e,t,i,n){if("sequenceflow-end"===t){var a=wt("path");rt(a,{d:"M 1 5 L 11 10 L 1 15 Z"}),p(e,{element:a,ref:{x:11,y:10},scale:.5,attrs:{fill:n,stroke:n}})}if("messageflow-start"===t){var o=wt("circle");rt(o,{cx:6,cy:6,r:3.5}),p(e,{element:o,attrs:{fill:i,stroke:n},ref:{x:6,y:6}})}if("messageflow-end"===t){var s=wt("path");rt(s,{d:"m 1 5 l 0 -3 l 7 3 l -7 3 z"}),p(e,{element:s,attrs:{fill:i,stroke:n,strokeLinecap:"butt"},ref:{x:8.5,y:5}})}if("association-start"===t){var r=wt("path");rt(r,{d:"M 11 5 L 1 10 L 11 15"}),p(e,{element:r,attrs:{fill:"none",stroke:n,strokeWidth:1.5},ref:{x:1,y:10},scale:.5})}if("association-end"===t){var l=wt("path");rt(l,{d:"M 1 5 L 11 10 L 1 15"}),p(e,{element:l,attrs:{fill:"none",stroke:n,strokeWidth:1.5},ref:{x:12,y:10},scale:.5})}if("conditional-flow-marker"===t){var c=wt("path");rt(c,{d:"M 0 10 L 8 6 L 16 10 L 8 14 Z"}),p(e,{element:c,attrs:{fill:i,stroke:n},ref:{x:-1,y:10},scale:.5})}if("conditional-default-flow-marker"===t){var d=wt("path");rt(d,{d:"M 6 4 L 10 16"}),p(e,{element:d,attrs:{stroke:n},ref:{x:0,y:10},scale:.5})}}(n,e,t,i),"url(#"+n+")"}function g(e,t,i,n,a){te(n)&&(a=n,n=0),n=n||0,"none"===(a=h(a,{stroke:"black",strokeWidth:2,fill:"white"})).fill&&delete a.fillOpacity;var o=t/2,s=i/2,r=wt("circle");return rt(r,{cx:o,cy:s,r:Math.round((t+i)/4-n)}),rt(r,a),at(e,r),r}function v(e,t,i,n,a,o){te(a)&&(o=a,a=0),a=a||0,o=h(o,{stroke:"black",strokeWidth:2,fill:"white"});var s=wt("rect");return rt(s,{x:a,y:a,width:t-2*a,height:i-2*a,rx:n,ry:n}),rt(s,o),at(e,s),s}function b(e,t,i){var n=Gt(t,i=h(i,["no-fill"],{stroke:"black",strokeWidth:2,fill:"none"}));return at(e,n),n}function y(e,t,i){i=h(i,["no-fill"],{strokeWidth:2,stroke:"black"});var n=wt("path");return rt(n,{d:t}),rt(n,i),at(e,n),n}function w(e,t,i,n){return y(t,i,Ae({"data-marker":e},n))}function x(e){return A[e]}function $(e){return function(t,i){return x(e)(t,i)}}function _(e,t){var i=za(e),n=function(e){return"bpmn:IntermediateThrowEvent"===e.$type||"bpmn:EndEvent"===e.$type}(i);return i.eventDefinitions&&i.eventDefinitions.length>1?i.parallelMultiple?x("bpmn:ParallelMultipleEventDefinition")(t,e,n):x("bpmn:MultipleEventDefinition")(t,e,n):Wa(i,"bpmn:MessageEventDefinition")?x("bpmn:MessageEventDefinition")(t,e,n):Wa(i,"bpmn:TimerEventDefinition")?x("bpmn:TimerEventDefinition")(t,e,n):Wa(i,"bpmn:ConditionalEventDefinition")?x("bpmn:ConditionalEventDefinition")(t,e):Wa(i,"bpmn:SignalEventDefinition")?x("bpmn:SignalEventDefinition")(t,e,n):Wa(i,"bpmn:EscalationEventDefinition")?x("bpmn:EscalationEventDefinition")(t,e,n):Wa(i,"bpmn:LinkEventDefinition")?x("bpmn:LinkEventDefinition")(t,e,n):Wa(i,"bpmn:ErrorEventDefinition")?x("bpmn:ErrorEventDefinition")(t,e,n):Wa(i,"bpmn:CancelEventDefinition")?x("bpmn:CancelEventDefinition")(t,e,n):Wa(i,"bpmn:CompensateEventDefinition")?x("bpmn:CompensateEventDefinition")(t,e,n):Wa(i,"bpmn:TerminateEventDefinition")?x("bpmn:TerminateEventDefinition")(t,e,n):null}function C(e,t,i){i=Ae({size:{width:100}},i);var n=o.createText(t||"",i);return ht(n).add("djs-label"),at(e,n),n}function E(e,t,i){return C(e,za(t).name,{box:t,align:i,padding:5,style:{fill:Ha(t,c,l)}})}function S(e,t,i){Zi(C(e,t,{box:{height:30,width:i.height},align:"center-middle",style:{fill:Ha(i,c,l)}}),0,1*i.height,270)}function k(e){for(var t=e.waypoints,i="m  "+t[0].x+","+t[0].y,n=1;n<t.length;n++)i+="L"+t[n].x+","+t[n].y+" ";return i}var A=this.handlers={"bpmn:Event":function(e,t,i){return"fillOpacity"in i||(i.fillOpacity=Ya),g(e,t.width,t.height,i)},"bpmn:StartEvent":function(e,t){var i={fill:Ua(t,r),stroke:qa(t,l)};za(t).isInterrupting||(i={strokeDasharray:"6",strokeLinecap:"round",fill:Ua(t,r),stroke:qa(t,l)});var n=x("bpmn:Event")(e,t,i);return _(t,e),n},"bpmn:MessageEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:t.width,containerHeight:t.height,position:{mx:.235,my:.315}}),{strokeWidth:1,fill:i?qa(t,l):Ua(t,r),stroke:i?Ua(t,r):qa(t,l)})},"bpmn:TimerEventDefinition":function(e,t){var i=g(e,t.width,t.height,.2*t.height,{strokeWidth:2,fill:Ua(t,r),stroke:qa(t,l)});y(e,n.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.5}}),{strokeWidth:2,strokeLinecap:"square",stroke:qa(t,l)});for(var a=0;a<12;a++){var o=n.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.5}}),s=t.width/2;y(e,o,{strokeWidth:1,strokeLinecap:"square",transform:"rotate("+30*a+","+t.height/2+","+s+")",stroke:qa(t,l)})}return i},"bpmn:EscalationEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:i?qa(t,l):"none",stroke:qa(t,l)})},"bpmn:ConditionalEventDefinition":function(e,t){return y(e,n.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.222}}),{strokeWidth:1,stroke:qa(t,l)})},"bpmn:LinkEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.57,my:.263}}),{strokeWidth:1,fill:i?qa(t,l):"none",stroke:qa(t,l)})},"bpmn:ErrorEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:t.width,containerHeight:t.height,position:{mx:.2,my:.722}}),{strokeWidth:1,fill:i?qa(t,l):"none",stroke:qa(t,l)})},"bpmn:CancelEventDefinition":function(e,t,i){var a=y(e,n.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.638,my:-.055}}),{strokeWidth:1,fill:i?qa(t,l):"none",stroke:qa(t,l)});return Ki(a,45),a},"bpmn:CompensateEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.22,my:.5}}),{strokeWidth:1,fill:i?qa(t,l):"none",stroke:qa(t,l)})},"bpmn:SignalEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:i?qa(t,l):"none",stroke:qa(t,l)})},"bpmn:MultipleEventDefinition":function(e,t,i){return y(e,n.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:t.width,containerHeight:t.height,position:{mx:.222,my:.36}}),{strokeWidth:1,fill:i?qa(t,l):"none"})},"bpmn:ParallelMultipleEventDefinition":function(e,t){return y(e,n.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:t.width,containerHeight:t.height,position:{mx:.458,my:.194}}),{strokeWidth:1,fill:qa(t,l),stroke:qa(t,l)})},"bpmn:EndEvent":function(e,t){var i=x("bpmn:Event")(e,t,{strokeWidth:4,fill:Ua(t,r),stroke:qa(t,l)});return _(t,e),i},"bpmn:TerminateEventDefinition":function(e,t){return g(e,t.width,t.height,8,{strokeWidth:4,fill:qa(t,l),stroke:qa(t,l)})},"bpmn:IntermediateEvent":function(e,t){var i=x("bpmn:Event")(e,t,{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)});return g(e,t.width,t.height,3,{strokeWidth:1,fill:Ua(t,"none"),stroke:qa(t,l)}),_(t,e),i},"bpmn:IntermediateCatchEvent":$("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":$("bpmn:IntermediateEvent"),"bpmn:Activity":function(e,t,i){return"fillOpacity"in(i=i||{})||(i.fillOpacity=Ya),v(e,t.width,t.height,10,i)},"bpmn:Task":function(e,t){var i={fill:Ua(t,r),stroke:qa(t,l)},n=x("bpmn:Activity")(e,t,i);return E(e,t,"center-middle"),D(e,t),n},"bpmn:ServiceTask":function(e,t){var i=x("bpmn:Task")(e,t);return y(e,n.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)}),y(e,n.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}}),{strokeWidth:0,fill:Ua(t,r)}),y(e,n.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}),{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)}),i},"bpmn:UserTask":function(e,t){var i=x("bpmn:Task")(e,t);return y(e,n.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:Ua(t,r),stroke:qa(t,l)}),y(e,n.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:Ua(t,r),stroke:qa(t,l)}),y(e,n.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:qa(t,l),stroke:qa(t,l)}),i},"bpmn:ManualTask":function(e,t){var i=x("bpmn:Task")(e,t);return y(e,n.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}}),{strokeWidth:.5,fill:Ua(t,r),stroke:qa(t,l)}),i},"bpmn:SendTask":function(e,t){var i=x("bpmn:Task")(e,t);return y(e,n.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{strokeWidth:1,fill:qa(t,l),stroke:Ua(t,r)}),i},"bpmn:ReceiveTask":function(e,t){var i,a=za(t),o=x("bpmn:Task")(e,t);return a.instantiate?(g(e,28,28,4.4,{strokeWidth:1}),i=n.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):i=n.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),y(e,i,{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)}),o},"bpmn:ScriptTask":function(e,t){var i=x("bpmn:Task")(e,t);return y(e,n.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}}),{strokeWidth:1,stroke:qa(t,l)}),i},"bpmn:BusinessRuleTask":function(e,t){var i=x("bpmn:Task")(e,t);return rt(y(e,n.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}})),{strokeWidth:1,fill:Ua(t,"#aaaaaa"),stroke:qa(t,l)}),rt(y(e,n.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}})),{strokeWidth:1,stroke:qa(t,l)}),i},"bpmn:SubProcess":function(e,t,i){i=Ae({fill:Ua(t,r),stroke:qa(t,l)},i);var n=x("bpmn:Activity")(e,t,i),a=Ta(t);return ja(t)&&rt(n,{strokeDasharray:"1,2"}),E(e,t,a?"center-top":"center-middle"),a?D(e,t):D(e,t,["SubProcessMarker"]),n},"bpmn:AdHocSubProcess":function(e,t){return x("bpmn:SubProcess")(e,t)},"bpmn:Transaction":function(e,t){var n=x("bpmn:SubProcess")(e,t),a=i.style(["no-fill","no-events"],{stroke:qa(t,l)});return v(e,t.width,t.height,8,3,a),n},"bpmn:CallActivity":function(e,t){return x("bpmn:SubProcess")(e,t,{strokeWidth:5})},"bpmn:Participant":function(e,t){var i={fillOpacity:Ya,fill:Ua(t,r),stroke:qa(t,l)},n=x("bpmn:Lane")(e,t,i);return Ta(t)?(b(e,[{x:30,y:0},{x:30,y:t.height}],{stroke:qa(t,l)}),S(e,za(t).name,t)):C(e,za(t).name,{box:t,align:"center-middle",style:{fill:Ha(t,c,l)}}),!!za(t).participantMultiplicity&&x("ParticipantMultiplicityMarker")(e,t),n},"bpmn:Lane":function(e,t,i){var n=v(e,t.width,t.height,0,Ae({fill:Ua(t,r),fillOpacity:.35,stroke:qa(t,l)},i)),a=za(t);return"bpmn:Lane"===a.$type&&S(e,a.name,t),n},"bpmn:InclusiveGateway":function(e,t){var i=x("bpmn:Gateway")(e,t);return g(e,t.width,t.height,.24*t.height,{strokeWidth:2.5,fill:Ua(t,r),stroke:qa(t,l)}),i},"bpmn:ExclusiveGateway":function(e,t){var i=x("bpmn:Gateway")(e,t),a=n.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:t.width,containerHeight:t.height,position:{mx:.32,my:.3}});return Ca(t).isMarkerVisible&&y(e,a,{strokeWidth:1,fill:qa(t,l),stroke:qa(t,l)}),i},"bpmn:ComplexGateway":function(e,t){var i=x("bpmn:Gateway")(e,t);return y(e,n.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:t.width,containerHeight:t.height,position:{mx:.46,my:.26}}),{strokeWidth:1,fill:qa(t,l),stroke:qa(t,l)}),i},"bpmn:ParallelGateway":function(e,t){var i=x("bpmn:Gateway")(e,t);return y(e,n.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:t.width,containerHeight:t.height,position:{mx:.46,my:.2}}),{strokeWidth:1,fill:qa(t,l),stroke:qa(t,l)}),i},"bpmn:EventBasedGateway":function(e,t){var i=za(t),a=x("bpmn:Gateway")(e,t);g(e,t.width,t.height,.2*t.height,{strokeWidth:1,fill:"none",stroke:qa(t,l)});var o=i.eventGatewayType,s=!!i.instantiate;if("Parallel"===o){var r=n.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:t.width,containerHeight:t.height,position:{mx:.474,my:.296}});rt(y(e,r),{strokeWidth:1,fill:"none"})}else"Exclusive"===o&&(s||rt(g(e,t.width,t.height,.26*t.height),{strokeWidth:1,fill:"none",stroke:qa(t,l)}),function(){var i=n.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:t.width,containerHeight:t.height,position:{mx:.36,my:.44}}),a={strokeWidth:2,fill:Ua(t,"none"),stroke:qa(t,l)};y(e,i,a)}());return a},"bpmn:Gateway":function(e,t){var i={fill:Ua(t,r),fillOpacity:Ya,stroke:qa(t,l)};return function(e,t,i,n){var a=t/2,o=i/2,s=[{x:a,y:0},{x:t,y:o},{x:a,y:i},{x:0,y:o}].map((function(e){return e.x+","+e.y})).join(" ");n=h(n,{stroke:"black",strokeWidth:2,fill:"white"});var r=wt("polygon");return rt(r,{points:s}),rt(r,n),at(e,r),r}(e,t.width,t.height,i)},"bpmn:SequenceFlow":function(e,t){var i,n=k(t),a=Ua(t,r),o=qa(t,l),s=y(e,n,{strokeLinejoin:"round",markerEnd:f("sequenceflow-end",a,o),stroke:qa(t,l)}),c=za(t);return t.source&&(i=t.source.businessObject,c.conditionExpression&&i.$instanceOf("bpmn:Activity")&&rt(s,{markerStart:f("conditional-flow-marker",a,o)}),i.default&&(i.$instanceOf("bpmn:Gateway")||i.$instanceOf("bpmn:Activity"))&&i.default===c&&rt(s,{markerStart:f("conditional-default-flow-marker",a,o)})),s},"bpmn:Association":function(e,t,i){var n=za(t),a=Ua(t,r),o=qa(t,l);return i=Ae({strokeDasharray:"0.5, 5",strokeLinecap:"round",strokeLinejoin:"round",stroke:qa(t,l)},i||{}),"One"!==n.associationDirection&&"Both"!==n.associationDirection||(i.markerEnd=f("association-end",a,o)),"Both"===n.associationDirection&&(i.markerStart=f("association-start",a,o)),b(e,t.waypoints,i)},"bpmn:DataInputAssociation":function(e,t){var i=Ua(t,r),n=qa(t,l);return x("bpmn:Association")(e,t,{markerEnd:f("association-end",i,n)})},"bpmn:DataOutputAssociation":function(e,t){var i=Ua(t,r),n=qa(t,l);return x("bpmn:Association")(e,t,{markerEnd:f("association-end",i,n)})},"bpmn:MessageFlow":function(e,t){var i=za(t),a=Ca(t),o=Ua(t,r),s=qa(t,l),d=y(e,k(t),{markerEnd:f("messageflow-end",o,s),markerStart:f("messageflow-start",o,s),strokeDasharray:"10, 12",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px",stroke:qa(t,l)});if(i.messageRef){var u=d.getPointAtLength(d.getTotalLength()/2),h=n.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:u.x,y:u.y}}),p={strokeWidth:1};"initiating"===a.messageVisibleKind?(p.fill="white",p.stroke="black"):(p.fill="#888",p.stroke="white");var m=y(e,h,p),g=C(e,i.messageRef.name,{align:"center-top",fitBox:!0,style:{fill:qa(t,c)}}),v=m.getBBox(),b=g.getBBox();Zi(g,u.x-b.width/2,u.y+v.height/2+10,0)}return d},"bpmn:DataObject":function(e,t){var i=y(e,n.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.474,my:.296}}),{fill:Ua(t,r),fillOpacity:Ya,stroke:qa(t,l)});return function(e){var t=e.dataObjectRef;return e.isCollection||t&&t.isCollection}(za(t))&&function(e,t){var i=(t.height-18)/t.height;y(e,n.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.33,my:i}}),{strokeWidth:2})}(e,t),i},"bpmn:DataObjectReference":$("bpmn:DataObject"),"bpmn:DataInput":function(e,t){var i=n.getRawPath("DATA_ARROW"),a=x("bpmn:DataObject")(e,t);return y(e,i,{strokeWidth:1}),a},"bpmn:DataOutput":function(e,t){var i=n.getRawPath("DATA_ARROW"),a=x("bpmn:DataObject")(e,t);return y(e,i,{strokeWidth:1,fill:"black"}),a},"bpmn:DataStoreReference":function(e,t){return y(e,n.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:0,my:.133}}),{strokeWidth:2,fill:Ua(t,r),fillOpacity:Ya,stroke:qa(t,l)})},"bpmn:BoundaryEvent":function(e,t){var i=za(t).cancelActivity,n={strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)};i||(n.strokeDasharray="6",n.strokeLinecap="round");var a=Ae({},n,{fillOpacity:1}),o=Ae({},n,{fill:"none"}),s=x("bpmn:Event")(e,t,a);return g(e,t.width,t.height,3,o),_(t,e),s},"bpmn:Group":function(e,t){return v(e,t.width,t.height,10,{stroke:qa(t,l),strokeWidth:1,strokeDasharray:"8,3,1,3",fill:"none",pointerEvents:"none"})},label:function(e,t){return function(e,t){var i={width:90,height:30,x:t.width/2+t.x,y:t.height/2+t.y};return C(e,Na(t),{box:i,fitBox:!0,style:Ae({},o.getExternalStyle(),{fill:Ha(t,c,l)})})}(e,t)},"bpmn:TextAnnotation":function(e,t){var i=v(e,t.width,t.height,0,0,{fill:"none",stroke:"none"});return y(e,n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:0,my:0}}),{stroke:qa(t,l)}),C(e,za(t).text||"",{box:t,align:"left-top",padding:5,style:{fill:Ha(t,c,l)}}),i},ParticipantMultiplicityMarker:function(e,t){w("participant-multiplicity",e,n.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:t.width/2/t.width,my:(t.height-15)/t.height}}),{strokeWidth:2,fill:Ua(t,r),stroke:qa(t,l)})},SubProcessMarker:function(e,t){Yi(v(e,14,14,0,{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)}),t.width/2-7.5,t.height-20),w("sub-process",e,n.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2-7.5)/t.width,my:(t.height-20)/t.height}}),{fill:Ua(t,r),stroke:qa(t,l)})},ParallelMarker:function(e,t,i){w("parallel",e,n.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.parallel)/t.width,my:(t.height-20)/t.height}}),{fill:Ua(t,r),stroke:qa(t,l)})},SequentialMarker:function(e,t,i){w("sequential",e,n.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.seq)/t.width,my:(t.height-19)/t.height}}),{fill:Ua(t,r),stroke:qa(t,l)})},CompensationMarker:function(e,t,i){w("compensation",e,n.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.compensation)/t.width,my:(t.height-13)/t.height}}),{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l)})},LoopMarker:function(e,t,i){w("loop",e,n.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.loop)/t.width,my:(t.height-7)/t.height}}),{strokeWidth:1,fill:Ua(t,r),stroke:qa(t,l),strokeLinecap:"round",strokeMiterlimit:.5})},AdhocMarker:function(e,t,i){w("adhoc",e,n.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.adhoc)/t.width,my:(t.height-15)/t.height}}),{strokeWidth:1,fill:qa(t,l),stroke:qa(t,l)})}};function D(e,t,i){var n,a=za(t),o=i&&-1!==i.indexOf("SubProcessMarker");n=o?{seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},le(i,(function(i){x(i)(e,t,n)})),a.isForCompensation&&x("CompensationMarker")(e,t,n),"bpmn:AdHocSubProcess"===a.$type&&x("AdhocMarker")(e,t,n);var s=a.loopCharacteristics,r=s&&s.isSequential;s&&(void 0===r&&x("LoopMarker")(e,t,n),!1===r&&x("ParallelMarker")(e,t,n),!0===r&&x("SequentialMarker")(e,t,n))}this._drawPath=y,this._renderer=x}U()(Ka,Ut),Ka.$inject=["config.bpmnRenderer","eventBus","styles","pathMap","canvas","textRenderer"],Ka.prototype.canRender=function(e){return xa(e,"bpmn:BaseElement")},Ka.prototype.drawShape=function(e,t){var i=t.type;return this._renderer(i)(e,t)},Ka.prototype.drawConnection=function(e,t){var i=t.type;return this._renderer(i)(e,t)},Ka.prototype.getShapePath=function(e){return xa(e,"bpmn:Event")?qt([["M",(t=e).x+t.width/2,t.y+t.height/2],["m",0,-(i=t.width/2)],["a",i,i,0,1,1,0,2*i],["a",i,i,0,1,1,0,-2*i],["z"]]):xa(e,"bpmn:Activity")?Ga(e,10):xa(e,"bpmn:Gateway")?function(e){var t=e.width/2,i=e.height/2;return qt([["M",e.x+t,e.y],["l",t,i],["l",-t,i],["l",-t,-i],["z"]])}(e):function(e){var t=e.x,i=e.y,n=e.width;return qt([["M",t,i],["l",n,0],["l",0,e.height],["l",-n,0],["z"]])}(e);var t,i};var Xa={width:150,height:50};function Qa(e,t){var i;t.textContent=e;try{var n,a=""===e;return t.textContent=a?"dummy":e,n={width:(i=t.getBBox()).width+2*i.x,height:i.height},a&&(n.width=0),n}catch(e){return{width:0,height:0}}}function Ja(e,t,i){for(var n,a=e.shift(),o=a;;){if((n=Qa(o,i)).width=o?n.width:0," "===o||""===o||n.width<Math.round(t)||o.length<2)return eo(e,o,a,n);o=to(o,n.width,t)}}function eo(e,t,i,n){if(t.length<i.length){var a=i.slice(t.length).trim();e.unshift(a)}return{width:n.width,height:n.height,text:t}}function to(e,t,i){var n=Math.max(e.length*(i/t),1),a=function(e,t){var i,n=e.split(/(\s|-|\u00AD)/g),a=[],o=0;if(n.length>1)for(;i=n.shift();){if(!(i.length+o<t)){"-"!==i&&"­"!==i||a.pop();break}a.push(i),o+=i.length}var s=a[a.length-1];return s&&"­"===s&&(a[a.length-1]="-"),a.join("")}(e,n);return a||(a=e.slice(0,Math.max(Math.round(n-1),1))),a}function io(e){this._config=Ae({},{size:Xa,padding:0,style:{},align:"center-top"},e||{})}function no(e){var t=Ae({fontFamily:"Arial, sans-serif",fontSize:12,fontWeight:"normal",lineHeight:1.2},e&&e.defaultStyle||{}),i=parseInt(t.fontSize,10)-1,n=Ae({},t,{fontSize:i},e&&e.externalStyle||{}),a=new io({style:t});this.getExternalLabelBounds=function(e,t){var i=a.getDimensions(t,{box:{width:90,height:30,x:e.width/2+e.x,y:e.height/2+e.y},style:n});return{x:Math.round(e.x+e.width/2-i.width/2),y:Math.round(e.y),width:Math.ceil(i.width),height:Math.ceil(i.height)}},this.getTextAnnotationBounds=function(e,i){var n=a.getDimensions(i,{box:e,style:t,align:"left-top",padding:5});return{x:e.x,y:e.y,width:e.width,height:Math.max(30,Math.round(n.height))}},this.createText=function(e,t){return a.createText(e,t||{})},this.getDefaultStyle=function(){return t},this.getExternalStyle=function(){return n}}io.prototype.createText=function(e,t){return this.layoutText(e,t).element},io.prototype.getDimensions=function(e,t){return this.layoutText(e,t).dimensions},io.prototype.layoutText=function(e,t){var i,n=Ae({},this._config.size,t.box),a=Ae({},this._config.style,t.style),o=function(e){var t=e.split("-");return{horizontal:t[0]||"center",vertical:t[1]||"top"}}(t.align||this._config.align),s=function(e){return te(e)?Ae({top:0,left:0,right:0,bottom:0},e):{top:e,left:e,right:e,bottom:e}}(void 0!==t.padding?t.padding:this._config.padding),r=t.fitBox||!1,l=function(e){if("fontSize"in e&&"lineHeight"in e)return e.lineHeight*parseInt(e.fontSize,10)}(a),c=e.split(/\u00AD?\r?\n/),d=[],u=n.width-s.left-s.right,h=wt("text");for(rt(h,{x:0,y:0}),rt(h,a),at((i=void 0,(i=document.getElementById("helper-svg"))||(rt(i=wt("svg"),{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(i)),i),h);c.length;)d.push(Ja(c,u,h));"middle"===o.vertical&&(s.top=s.bottom=0);var p=ce(d,(function(e,t,i){return e+(l||t.height)}),0)+s.top+s.bottom,m=ce(d,(function(e,t,i){return t.width>e?t.width:e}),0),f=s.top;"middle"===o.vertical&&(f+=(n.height-p)/2),f-=(l||d[0].height)/4;var g=wt("text");return rt(g,a),le(d,(function(e){var t;switch(f+=l||e.height,o.horizontal){case"left":t=s.left;break;case"right":t=(r?m:u)-s.right-e.width;break;default:t=Math.max(((r?m:u)-e.width)/2+s.left,0)}var i=wt("tspan");rt(i,{x:t,y:f}),i.textContent=e.text,at(g,i)})),mt(h),{dimensions:{width:m,height:p},element:g}},no.$inject=["config.textRenderer"];var ao=/\{([^{}]+)\}/g,oo=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;const so={__init__:["bpmnRenderer"],bpmnRenderer:["type",Ka],textRenderer:["type",no],pathMap:["type",function(){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z",height:36,width:36,heightElements:[20,7],widthElements:[8]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(e){return this.pathMap[e].d},this.getScaledPath=function(e,t){var i,n,a=this.pathMap[e];t.abspos?(i=t.abspos.x,n=t.abspos.y):(i=t.containerWidth*t.position.mx,n=t.containerHeight*t.position.my);var o,s,r={};if(t.position){for(var l=t.containerHeight/a.height*t.yScaleFactor,c=t.containerWidth/a.width*t.xScaleFactor,d=0;d<a.heightElements.length;d++)r["y"+d]=a.heightElements[d]*l;for(var u=0;u<a.widthElements.length;u++)r["x"+u]=a.widthElements[u]*c}return o=a.d,s={mx:i,my:n,e:r},String(o).replace(ao,(function(e,t){return function(e,t,i){var n=i;return t.replace(oo,(function(e,t,i,a,o){t=t||a,n&&(t in n&&(n=n[t]),"function"==typeof n&&o&&(n=n()))})),n=(null==n||n==i?e:n)+""}(e,t,s)}))}}]},ro={translate:["value",function(e,t){return t=t||{},e.replace(/{([^}]+)}/g,(function(e,i){return t[i]||"{"+i+"}"}))}]};var lo={width:90,height:20};function co(e){return xa(e,"bpmn:Event")||xa(e,"bpmn:Gateway")||xa(e,"bpmn:DataStoreReference")||xa(e,"bpmn:DataObjectReference")||xa(e,"bpmn:DataInput")||xa(e,"bpmn:DataOutput")||xa(e,"bpmn:SequenceFlow")||xa(e,"bpmn:MessageFlow")||xa(e,"bpmn:Group")}function uo(e){return po(e.label)}function ho(e){return e.waypoints?function(e){var t=e.length/2-1,i=e[Math.floor(t)],n=e[Math.ceil(t+.01)],a=function(e){var t=e.length/2-1,i=e[Math.floor(t)],n=e[Math.ceil(t+.01)];return{x:i.x+(n.x-i.x)/2,y:i.y+(n.y-i.y)/2}}(e),o=Math.atan((n.y-i.y)/(n.x-i.x)),s=a.x,r=a.y;return Math.abs(o)<Math.PI/2?r-=15:s+=15,{x:s,y:r}}(e.waypoints):xa(e,"bpmn:Group")?{x:e.x+e.width/2,y:e.y+lo.height/2}:{x:e.x+e.width/2,y:e.y+e.height+lo.height/2}}function po(e){return e&&!!e.labelTarget}function mo(e,t,i){return Ae({id:e.id,type:e.$type,businessObject:e,di:t},i)}function fo(e,t,i){var n=e.waypoint;return!n||n.length<2?[yi(t),yi(i)]:n.map((function(e){return{x:e.x,y:e.y}}))}function go(e,t,i,n){return new Error(e("element {element} referenced by {referenced}#{property} not yet drawn",{element:ga(i),referenced:ga(t),property:n}))}function vo(e,t,i,n,a,o){this._eventBus=e,this._canvas=t,this._elementFactory=i,this._elementRegistry=n,this._translate=a,this._textRenderer=o}vo.$inject=["eventBus","canvas","elementFactory","elementRegistry","translate","textRenderer"],vo.prototype.add=function(e,t,i){var n,a,o,s,r,l,c,d=this._translate;if(xa(t,"bpmndi:BPMNPlane")){var u=xa(e,"bpmn:SubProcess")?{id:e.id+"_plane"}:{};n=this._elementFactory.createRoot(mo(e,t,u)),this._canvas.addRootElement(n)}else if(xa(t,"bpmndi:BPMNShape")){var h=!Ta(e,t),p=function(e){return xa(e,"bpmn:Group")}(e);a=i&&(i.hidden||i.collapsed);var m=t.bounds;n=this._elementFactory.createShape(mo(e,t,{collapsed:h,hidden:a,x:Math.round(m.x),y:Math.round(m.y),width:Math.round(m.width),height:Math.round(m.height),isFrame:p})),xa(e,"bpmn:BoundaryEvent")&&this._attachBoundary(e,n),xa(e,"bpmn:Lane")&&(o=0),xa(e,"bpmn:DataStoreReference")&&(s=i,l=(r=yi(m)).x,c=r.y,l>=s.x&&l<=s.x+s.width&&c>=s.y&&c<=s.y+s.height||(i=this._canvas.findRoot(i))),this._canvas.addShape(n,i,o)}else{if(!xa(t,"bpmndi:BPMNEdge"))throw new Error(d("unknown di {di} for element {semantic}",{di:ga(t),semantic:ga(e)}));var f=this._getSource(e),g=this._getTarget(e);a=i&&(i.hidden||i.collapsed),n=this._elementFactory.createConnection(mo(e,t,{hidden:a,source:f,target:g,waypoints:fo(t,f,g)})),xa(e,"bpmn:DataAssociation")&&(i=this._canvas.findRoot(i)),xa(e,"bpmn:SequenceFlow")&&(o=0),this._canvas.addConnection(n,i,o)}return co(e)&&Na(n)&&this.addLabel(e,t,n),this._eventBus.fire("bpmnElement.added",{element:n}),n},vo.prototype._attachBoundary=function(e,t){var i=this._translate,n=e.attachedToRef;if(!n)throw new Error(i("missing {semantic}#attachedToRef",{semantic:ga(e)}));var a=this._elementRegistry.get(n.id),o=a&&a.attachers;if(!a)throw go(i,e,n,"attachedToRef");t.host=a,o||(a.attachers=o=[]),-1===o.indexOf(t)&&o.push(t)},vo.prototype.addLabel=function(e,t,i){var n,a,o;return n=function(e,t){var i,n,a,o=e.label;return o&&o.bounds?(a=o.bounds,n={width:Math.max(lo.width,a.width),height:a.height},i={x:a.x+a.width/2,y:a.y+a.height/2}):(i=ho(t),n=lo),Ae({x:i.x-n.width/2,y:i.y-n.height/2},n)}(t,i),(a=Na(i))&&(n=this._textRenderer.getExternalLabelBounds(n,a)),o=this._elementFactory.createLabel(mo(e,t,{id:e.id+"_label",labelTarget:i,type:"label",hidden:i.hidden||!Na(i),x:Math.round(n.x),y:Math.round(n.y),width:Math.round(n.width),height:Math.round(n.height)})),this._canvas.addShape(o,i.parent)},vo.prototype._getEnd=function(e,t){var i,n,a=e.$type,o=this._translate;if(n=e[t+"Ref"],"source"===t&&"bpmn:DataInputAssociation"===a&&(n=n&&n[0]),("source"===t&&"bpmn:DataOutputAssociation"===a||"target"===t&&"bpmn:DataInputAssociation"===a)&&(n=e.$parent),i=n&&this._getElement(n))return i;throw n?go(o,e,n,t+"Ref"):new Error(o("{semantic}#{side} Ref not specified",{semantic:ga(e),side:t}))},vo.prototype._getSource=function(e){return this._getEnd(e,"source")},vo.prototype._getTarget=function(e){return this._getEnd(e,"target")},vo.prototype._getElement=function(e){return this._elementRegistry.get(e.id)};const bo={__depends__:[so,{__depends__:[ro],bpmnImporter:["type",vo]}]};function yo(e){e&&"function"==typeof e.stopPropagation&&e.stopPropagation()}function wo(e){return e.originalEvent||e.srcEvent}function xo(e,t){yo(e),yo(wo(e))}function $o(e){return e.pointers&&e.pointers.length&&(e=e.pointers[0]),e.touches&&e.touches.length&&(e=e.touches[0]),e?{x:e.clientX,y:e.clientY}:null}function _o(e,t){return(wo(e)||e).button===t}function Co(e){return _o(e,0)}function Eo(e){var t=wo(e)||e;return!!Co(e)&&(/mac/i.test(navigator.platform)?t.metaKey:t.ctrlKey)}function So(e){var t=wo(e)||e;return Co(e)&&t.shiftKey}function ko(e){return!0}function Ao(e){return Co(e)||function(e){return _o(e,1)}(e)}function Do(e,t,i){var n=this;function a(i,n,a){var o,s;(function(e,t){return!(l[e]||Co)(t)})(i,n)||(a?s=t.getGraphics(a):(o=n.delegateTarget||n.target)&&(s=o,a=t.get(s)),s&&a&&!1===e.fire(i,{element:a,gfx:s,originalEvent:n})&&(n.stopPropagation(),n.preventDefault()))}var o={};function s(e){return o[e]}var r={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},l={"element.contextmenu":ko,"element.mousedown":Ao,"element.mouseup":Ao,"element.click":Ao,"element.dblclick":Ao};function c(e,t,i,n){var s=o[i]=function(e){a(i,e)};n&&(l[i]=n),s.$delegate=Ye(e,"svg, .djs-element",t,s)}function d(e,t,i){var n=s(i);n&&Ke(e,t,n.$delegate)}e.on("canvas.destroy",(function(e){var t;t=e.svg,le(r,(function(e,i){d(t,i,e)}))})),e.on("canvas.init",(function(e){var t;t=e.svg,le(r,(function(e,i){c(t,i,e)}))})),e.on(["shape.added","connection.added"],(function(t){var i=t.element,n=t.gfx;e.fire("interactionEvents.createHit",{element:i,gfx:n})})),e.on(["shape.changed","connection.changed"],500,(function(t){var i=t.element,n=t.gfx;e.fire("interactionEvents.updateHit",{element:i,gfx:n})})),e.on("interactionEvents.createHit",500,(function(e){var t=e.element,i=e.gfx;n.createDefaultHit(t,i)})),e.on("interactionEvents.updateHit",(function(e){var t=e.element,i=e.gfx;n.updateDefaultHit(t,i)}));var u=m("djs-hit djs-hit-stroke"),h=m("djs-hit djs-hit-click-stroke"),p={all:m("djs-hit djs-hit-all"),"click-stroke":h,stroke:u};function m(e,t){return t=Ae({stroke:"white",strokeWidth:15},t||{}),i.cls(e,["no-fill","no-border"],t)}function f(e,t){var i=p[t];if(!i)throw new Error("invalid hit type <"+t+">");return rt(e,i),e}function g(e,t){at(e,t)}this.removeHits=function(e){le(tt(".djs-hit",e),mt)},this.createDefaultHit=function(e,t){var i,n=e.waypoints,a=e.isFrame;return n?this.createWaypointsHit(t,n):(i=a?"stroke":"all",this.createBoxHit(t,i,{width:e.width,height:e.height}))},this.createWaypointsHit=function(e,t){var i=Gt(t);return f(i,"stroke"),g(e,i),i},this.createBoxHit=function(e,t,i){i=Ae({x:0,y:0},i);var n=wt("rect");return f(n,t),rt(n,i),g(e,n),n},this.updateDefaultHit=function(e,t){var i=et(".djs-hit",t);if(i)return e.waypoints?function(e,t){rt(e,{points:Ht(t)})}(i,e.waypoints):rt(i,{width:e.width,height:e.height}),i},this.fire=a,this.triggerMouseEvent=function(e,t,i){var n=r[e];if(!n)throw new Error("unmapped DOM event name <"+e+">");return a(n,t,i)},this.mouseHandler=s,this.registerEvent=c,this.unregisterEvent=d}Do.$inject=["eventBus","elementRegistry","styles"];const Ro={__init__:["interactionEvents"],interactionEvents:["type",Do]};function Po(e,t,i){this.offset=6;var n=t.cls("djs-outline",["no-fill"]),a=this;function o(e,t){var i=wt("rect");return rt(i,Ae({x:10,y:10,width:100,height:100},n)),at(e,i),i}e.on(["shape.added","shape.changed"],500,(function(e){var t=e.element,i=e.gfx,n=et(".djs-outline",i);n||(n=o(i)),a.updateShapeOutline(n,t)})),e.on(["connection.added","connection.changed"],(function(e){var t=e.element,i=e.gfx,n=et(".djs-outline",i);n||(n=o(i)),a.updateConnectionOutline(n,t)}))}Po.prototype.updateShapeOutline=function(e,t){rt(e,{x:-this.offset,y:-this.offset,width:t.width+2*this.offset,height:t.height+2*this.offset})},Po.prototype.updateConnectionOutline=function(e,t){var i=Jt(t);rt(e,{x:i.x-this.offset,y:i.y-this.offset,width:i.width+2*this.offset,height:i.height+2*this.offset})},Po.$inject=["eventBus","styles","elementRegistry"];const Lo={__init__:["outline"],outline:["type",Po]};function Vo(e,t){this._eventBus=e,this._canvas=t,this._selectedElements=[];var i=this;e.on(["shape.remove","connection.remove"],(function(e){var t=e.element;i.deselect(t)})),e.on(["diagram.clear","root.set"],(function(e){i.select(null)}))}Vo.$inject=["eventBus","canvas"],Vo.prototype.deselect=function(e){var t=this._selectedElements,i=t.indexOf(e);if(-1!==i){var n=t.slice();t.splice(i,1),this._eventBus.fire("selection.changed",{oldSelection:n,newSelection:t})}},Vo.prototype.get=function(){return this._selectedElements},Vo.prototype.isSelected=function(e){return-1!==this._selectedElements.indexOf(e)},Vo.prototype.select=function(e,t){var i=this._selectedElements,n=i.slice();ee(e)||(e=e?[e]:[]);var a=this._canvas,o=a.getRootElement();e=e.filter((function(e){var t=a.findRoot(e);return o===t})),t?le(e,(function(e){-1===i.indexOf(e)&&i.push(e)})):this._selectedElements=i=e.slice(),this._eventBus.fire("selection.changed",{oldSelection:n,newSelection:i})};var Fo="hover",Io="selected";function Bo(e,t,i,n){function a(e,i){t.addMarker(e,i)}function o(e,i){t.removeMarker(e,i)}this._multiSelectionBox=null,e.on("element.hover",(function(e){a(e.element,Fo)})),e.on("element.out",(function(e){o(e.element,Fo)})),e.on("selection.changed",(function(e){var t=e.oldSelection,i=e.newSelection;le(t,(function(e){-1===i.indexOf(e)&&o(e,Io)})),le(i,(function(e){-1===t.indexOf(e)&&a(e,Io)}))}))}function To(e,t,i,n){e.on("create.end",500,(function(e){var i=e.context,n=i.canExecute,a=i.elements,o=(i.hints||{}).autoSelect;if(n){if(!1===o)return;ee(o)?t.select(o):t.select(a.filter(jo))}})),e.on("connect.end",500,(function(e){var i=e.context,n=i.canExecute,a=i.hover;n&&a&&t.select(a)})),e.on("shape.move.end",500,(function(e){var i=e.previousSelection||[],a=n.get(e.context.shape.id);se(i,(function(e){return a.id===e.id}))||t.select(a)})),e.on("element.click",(function(e){if(Co(e)){var n=e.element;n===i.getRootElement()&&(n=null);var a=t.isSelected(n),o=t.get().length>1,s=Eo(e)||So(e);if(a&&o)return s?t.deselect(n):t.select(n);a?t.deselect(n):t.select(n,s)}}))}function jo(e){return!e.hidden}Bo.$inject=["eventBus","canvas","selection","styles"],To.$inject=["eventBus","selection","canvas","elementRegistry"];const Oo={__init__:["selectionVisuals","selectionBehavior"],__depends__:[Ro,Lo],selection:["type",Vo],selectionVisuals:["type",Bo],selectionBehavior:["type",To]};function Mo(e){this._counter=0,this._prefix=(e?e+"-":"")+Math.floor(1e9*Math.random())+"-"}Mo.prototype.next=function(){return this._prefix+ ++this._counter};var No=new Mo("ov");function Wo(e,t,i,n){var a,o;this._eventBus=t,this._canvas=i,this._elementRegistry=n,this._ids=No,this._overlayDefaults=Ae({show:null,scale:!0},e&&e.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(a=i.getContainer(),o=Xe('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />'),a.insertBefore(o,a.firstChild),o),this._init()}function zo(e,t,i){Ae(e.style,{left:t+"px",top:i+"px"})}function Uo(e,t){e.style.display=!1===t?"none":""}function qo(e,t){e.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(i){e.style[i+"transform"]=t}))}Wo.$inject=["config.overlays","eventBus","canvas","elementRegistry"],Wo.prototype.get=function(e){if(ae(e)&&(e={id:e}),ae(e.element)&&(e.element=this._elementRegistry.get(e.element)),e.element){var t=this._getOverlayContainer(e.element,!0);return t?e.type?re(t.overlays,we({type:e.type})):t.overlays.slice():[]}return e.type?re(this._overlays,we({type:e.type})):e.id?this._overlays[e.id]:null},Wo.prototype.add=function(e,t,i){if(te(t)&&(i=t,t=null),e.id||(e=this._elementRegistry.get(e)),!i.position)throw new Error("must specifiy overlay position");if(!i.html)throw new Error("must specifiy overlay html");if(!e)throw new Error("invalid element specified");var n=this._ids.next();return i=Ae({},this._overlayDefaults,i,{id:n,type:t,element:e,html:i.html}),this._addOverlay(i),n},Wo.prototype.remove=function(e){var t=this.get(e)||[];ee(t)||(t=[t]);var i=this;le(t,(function(e){var t=i._getOverlayContainer(e.element,!0);if(e&&(it(e.html),it(e.htmlContainer),delete e.htmlContainer,delete e.element,delete i._overlays[e.id]),t){var n=t.overlays.indexOf(e);-1!==n&&t.overlays.splice(n,1)}}))},Wo.prototype.show=function(){Uo(this._overlayRoot)},Wo.prototype.hide=function(){Uo(this._overlayRoot,!1)},Wo.prototype.clear=function(){this._overlays={},this._overlayContainers=[],je(this._overlayRoot)},Wo.prototype._updateOverlayContainer=function(e){var t=e.element,i=e.html,n=t.x,a=t.y;if(t.waypoints){var o=Jt(t);n=o.x,a=o.y}zo(i,n,a),Pe(e.html,"data-container-id",t.id)},Wo.prototype._updateOverlay=function(e){var t,i,n=e.position,a=e.htmlContainer,o=e.element,s=n.left,r=n.top;void 0!==n.right&&(t=o.waypoints?Jt(o).width:o.width,s=-1*n.right+t),void 0!==n.bottom&&(i=o.waypoints?Jt(o).height:o.height,r=-1*n.bottom+i),zo(a,s||0,r||0),this._updateOverlayVisibilty(e,this._canvas.viewbox())},Wo.prototype._createOverlayContainer=function(e){var t=Xe('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(t);var i={html:t,element:e,overlays:[]};return this._updateOverlayContainer(i),this._overlayContainers.push(i),i},Wo.prototype._updateRoot=function(e){var t=e.scale||1,i="matrix("+[t,0,0,t,-1*e.x*t,-1*e.y*t].join(",")+")";qo(this._overlayRoot,i)},Wo.prototype._getOverlayContainer=function(e,t){var i=se(this._overlayContainers,(function(t){return t.element===e}));return i||t?i:this._createOverlayContainer(e)},Wo.prototype._addOverlay=function(e){var t,i,n=e.id,a=e.element,o=e.html;o.get&&o.constructor.prototype.jquery&&(o=o.get(0)),ae(o)&&(o=Xe(o)),i=this._getOverlayContainer(a),(t=Xe('<div class="djs-overlay" data-overlay-id="'+n+'" style="position: absolute">')).appendChild(o),e.type&&Be(t).add("djs-overlay-"+e.type),Uo(t,this._canvas.findRoot(a)===this._canvas.getRootElement()),e.htmlContainer=t,i.overlays.push(e),i.html.appendChild(t),this._overlays[n]=e,this._updateOverlay(e),this._updateOverlayVisibilty(e,this._canvas.viewbox())},Wo.prototype._updateOverlayVisibilty=function(e,t){var i=e.show,n=this._canvas.findRoot(e.element),a=i&&i.minZoom,o=i&&i.maxZoom,s=e.htmlContainer,r=!0;(n!==this._canvas.getRootElement()||i&&(Q(a)&&a>t.scale||Q(o)&&o<t.scale))&&(r=!1),Uo(s,r),this._updateOverlayScale(e,t)},Wo.prototype._updateOverlayScale=function(e,t){var i,n,a,o=e.scale,s=e.htmlContainer,r="";!0!==o&&(!1===o?(i=1,n=1):(i=o.min,n=o.max),Q(i)&&t.scale<i&&(a=(1/t.scale||1)*i),Q(n)&&t.scale>n&&(a=(1/t.scale||1)*n)),Q(a)&&(r="scale("+a+","+a+")"),qo(s,r)},Wo.prototype._updateOverlaysVisibilty=function(e){var t=this;le(this._overlays,(function(i){t._updateOverlayVisibilty(i,e)}))},Wo.prototype._init=function(){var e=this._eventBus,t=this;e.on("canvas.viewbox.changing",(function(e){t.hide()})),e.on("canvas.viewbox.changed",(function(e){var i;i=e.viewbox,t._updateRoot(i),t._updateOverlaysVisibilty(i),t.show()})),e.on(["shape.remove","connection.remove"],(function(e){var i=e.element;le(t.get({element:i}),(function(e){t.remove(e.id)}));var n=t._getOverlayContainer(i);if(n){it(n.html);var a=t._overlayContainers.indexOf(n);-1!==a&&t._overlayContainers.splice(a,1)}})),e.on("element.changed",500,(function(e){var i=e.element,n=t._getOverlayContainer(i,!0);n&&(le(n.overlays,(function(e){t._updateOverlay(e)})),t._updateOverlayContainer(n))})),e.on("element.marker.update",(function(e){var i=t._getOverlayContainer(e.element,!0);i&&Be(i.html)[e.add?"add":"remove"](e.marker)})),e.on("root.set",(function(){t._updateOverlaysVisibilty(t._canvas.viewbox())})),e.on("diagram.clear",this.clear,this)};const Ho={__init__:["overlays"],overlays:["type",Wo]};function Go(e,t,i,n){e.on("element.changed",(function(n){var a=n.element;(a.parent||a===t.getRootElement())&&(n.gfx=i.getGraphics(a)),n.gfx&&e.fire(ei(a)+".changed",n)})),e.on("elements.changed",(function(t){var i=t.elements;i.forEach((function(t){e.fire("element.changed",{element:t})})),n.updateContainments(i)})),e.on("shape.changed",(function(e){n.update("shape",e.element,e.gfx)})),e.on("connection.changed",(function(e){n.update("connection",e.element,e.gfx)}))}Go.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];const Zo={__init__:["changeSupport"],changeSupport:["type",Go]};function Yo(e){this._eventBus=e}function Ko(e,t){t.invoke(Yo,this),this.executed((function(t){var i=t.context;i.rootElement?e.setRootElement(i.rootElement):i.rootElement=e.getRootElement()})),this.revert((function(t){var i=t.context;i.rootElement&&e.setRootElement(i.rootElement)}))}Yo.$inject=["eventBus"],Yo.prototype.on=function(e,t,i,n,a,o){if((ne(t)||ie(t))&&(o=a,a=n,n=i,i=t,t=null),ne(i)&&(o=a,a=n,n=i,i=1e3),te(a)&&(o=a,a=!1),!ne(n))throw new Error("handlerFn must be a function");ee(e)||(e=[e]);var s=this._eventBus;le(e,(function(e){var r=["commandStack",e,t].filter((function(e){return e})).join(".");s.on(r,i,a?function(e,t){return function(i){return e.call(t||null,i.context,i.command,i)}}(n,o):n,o)}))},le(["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"],(function(e){Yo.prototype[e]=function(t,i,n,a,o){(ne(t)||ie(t))&&(o=a,a=n,n=i,i=t,t=null),this.on(t,e,i,n,a,o)}})),zt()(Ko,Yo),Ko.$inject=["canvas","injector"];const Xo={__init__:["rootElementsBehavior"],rootElementsBehavior:["type",Ko]};var Qo=i(8269),Jo=i.n(Qo),es={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function ts(e){return(e=""+e)&&e.replace(/[&<>"']/g,(function(e){return es[e]}))}function is(e){return e.id.replace(new RegExp("_plane$"),"")}function ns(e){var t=e.id;return xa(e,"bpmn:SubProcess")?ss(t):t}function as(e){return ss(e)}function os(e){return xa(Ca(e),"bpmndi:BPMNPlane")}function ss(e){return e+"_plane"}function rs(e,t,i,n){var a=Xe('<ul class="bjs-breadcrumbs"></ul>'),o=n.getContainer(),s=Be(o);o.appendChild(a);var r=[];function l(e){e&&(r=function(e){for(var t=[],i=_a(e);i;i=i.$parent)(xa(i,"bpmn:SubProcess")||xa(i,"bpmn:Process"))&&t.push(i);return t.reverse()}(e));var i=r.map((function(e){var i=ts(e.name||e.id),a=Xe('<li><span class="bjs-crumb"><a title="'+i+'">'+i+"</a></span></li>"),o=n.findRoot(ns(e))||n.findRoot(e.id);if(!o&&xa(e,"bpmn:Process")){var s=t.find((function(t){var i=_a(t);return i&&i.processRef&&i.processRef===e}));o=n.findRoot(s.id)}return a.addEventListener("click",(function(){n.setRootElement(o)})),a}));a.innerHTML="";var o=i.length>1;s.toggle("bjs-breadcrumbs-shown",o),i.forEach((function(e){a.appendChild(e)}))}e.on("element.changed",(function(e){var t=_a(e.element);se(r,(function(e){return e===t}))&&l()})),e.on("root.set",(function(e){l(e.element)}))}function ls(e,t){var i=null,n=new cs;e.on("root.set",(function(e){var a=e.element,o=t.viewbox(),s=n.get(a);if(n.set(i,{x:o.x,y:o.y,zoom:o.scale}),i=a,!xa(a,"bpmn:Collaboration")||s){s=s||{x:0,y:0,zoom:1};var r=(o.x-s.x)*o.scale,l=(o.y-s.y)*o.scale;0===r&&0===l||t.scroll({dx:r,dy:l}),s.zoom!==o.scale&&t.zoom(s.zoom,{x:0,y:0})}})),e.on("diagram.clear",(function(){n.clear(),i=null}))}function cs(){this._entries=[],this.set=function(e,t){var i=!1;for(var n in this._entries)if(this._entries[n][0]===e){this._entries[n][1]=t,i=!0;break}i||this._entries.push([e,t])},this.get=function(e){for(var t in this._entries)if(this._entries[t][0]===e)return this._entries[t][1];return null},this.clear=function(){this._entries.length=0},this.remove=function(e){var t=-1;for(var i in this._entries)if(this._entries[i][0]===e){t=i;break}-1!==t&&this._entries.splice(t,1)}}rs.$inject=["eventBus","elementRegistry","overlays","canvas"],ls.$inject=["eventBus","canvas"];function ds(e,t){this._eventBus=e,this._moddle=t;var i=this;e.on("import.render.start",1500,(function(e,t){i.handleImport(t.definitions)}))}function us(e){return xa(e,"bpmndi:BPMNDiagram")?e:us(e.$parent)}ds.prototype.handleImport=function(e){if(e.diagrams){var t=this;this._definitions=e,this._processToDiagramMap={},e.diagrams.forEach((function(e){e.plane&&e.plane.bpmnElement&&(t._processToDiagramMap[e.plane.bpmnElement.id]=e)}));var i=[];e.diagrams.forEach((function(e){var n=t.createNewDiagrams(e.plane);Array.prototype.push.apply(i,n)})),i.forEach((function(e){t.movePlaneElementsToOrigin(e.plane)}))}},ds.prototype.createNewDiagrams=function(e){var t=this,i=[],n=[];e.get("planeElement").forEach((function(t){var a=t.bpmnElement;if(a){var o=a.$parent;xa(a,"bpmn:SubProcess")&&!t.isExpanded&&i.push(a),xa(o,"bpmn:SubProcess")&&o!==e.bpmnElement&&n.push({diElement:t,parent:o})}}));var a=[];return i.forEach((function(e){if(!t._processToDiagramMap[e.id]){var i=t.createDiagram(e);t._processToDiagramMap[e.id]=i,a.push(i)}})),n.forEach((function(e){for(var n=e.diElement,a=e.parent;a&&-1===i.indexOf(a);)a=a.$parent;if(a){var o=t._processToDiagramMap[a.id];t.moveToDiPlane(n,o.plane)}})),a},ds.prototype.movePlaneElementsToOrigin=function(e){var t=e.get("planeElement"),i=function(e){var t={top:1/0,right:-1/0,bottom:-1/0,left:1/0};return e.planeElement.forEach((function(e){if(e.bounds){var i=vi(e.bounds);t.top=Math.min(i.top,t.top),t.left=Math.min(i.left,t.left)}})),bi(t)}(e),n=i.x-180,a=i.y-160;t.forEach((function(e){e.waypoint?e.waypoint.forEach((function(e){e.x=e.x-n,e.y=e.y-a})):e.bounds&&(e.bounds.x=e.bounds.x-n,e.bounds.y=e.bounds.y-a)}))},ds.prototype.moveToDiPlane=function(e,t){var i=us(e).plane.get("planeElement");i.splice(i.indexOf(e),1),t.get("planeElement").push(e)},ds.prototype.createDiagram=function(e){var t=this._moddle.create("bpmndi:BPMNPlane",{bpmnElement:e}),i=this._moddle.create("bpmndi:BPMNDiagram",{plane:t});return t.$parent=i,t.bpmnElement=e,i.$parent=this._definitions,this._definitions.diagrams.push(i),i},ds.$inject=["eventBus","moddle"];var hs=250;function ps(e,t,i,n){Yo.call(this,t),this._canvas=e,this._eventBus=t,this._elementRegistry=i,this._overlays=n;var a=this;this.executed("shape.toggleCollapse",hs,(function(e){var t=e.shape;a.canDrillDown(t)?a.addOverlay(t):a.removeOverlay(t)}),!0),this.reverted("shape.toggleCollapse",hs,(function(e){var t=e.shape;a.canDrillDown(t)?a.addOverlay(t):a.removeOverlay(t)}),!0),this.executed(["shape.create","shape.move","shape.delete"],hs,(function(e){var t=e.oldParent,i=e.newParent||e.parent,n=e.shape;a.canDrillDown(n)&&a.addOverlay(n),a.updateDrilldownOverlay(t),a.updateDrilldownOverlay(i),a.updateDrilldownOverlay(n)}),!0),this.reverted(["shape.create","shape.move","shape.delete"],hs,(function(e){var t=e.oldParent,i=e.newParent||e.parent,n=e.shape;a.canDrillDown(n)&&a.addOverlay(n),a.updateDrilldownOverlay(t),a.updateDrilldownOverlay(i),a.updateDrilldownOverlay(n)}),!0),t.on("import.done",(function(){i.filter((function(e){return a.canDrillDown(e)})).map((function(e){a.addOverlay(e)}))}))}U()(ps,Yo),ps.prototype.updateDrilldownOverlay=function(e){var t=this._canvas;if(e){var i=t.findRoot(e);i&&this.updateOverlayVisibility(i)}},ps.prototype.canDrillDown=function(e){var t=this._canvas;return xa(e,"bpmn:SubProcess")&&t.findRoot(ns(e))},ps.prototype.updateOverlayVisibility=function(e){var t=this._overlays,i=e.businessObject,n=t.get({element:i.id,type:"drilldown"})[0];if(n){var a=i&&i.flowElements&&i.flowElements.length;Be(n.html).toggle("bjs-drilldown-empty",!a)}},ps.prototype.addOverlay=function(e){var t=this._canvas,i=this._overlays;i.get({element:e,type:"drilldown"}).length&&this.removeOverlay(e);var n=Xe('<button class="bjs-drilldown"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z"/></svg></button>');n.addEventListener("click",(function(){t.setRootElement(t.findRoot(ns(e)))})),i.add(e,"drilldown",{position:{bottom:-7,right:-8},html:n}),this.updateOverlayVisibility(e)},ps.prototype.removeOverlay=function(e){this._overlays.remove({element:e,type:"drilldown"})},ps.$inject=["canvas","eventBus","elementRegistry","overlays"];const ms={__depends__:[Ho,Zo,Xo],__init__:["drilldownBreadcrumbs","drilldownOverlayBehavior","drilldownCentering","subprocessCompatibility"],drilldownBreadcrumbs:["type",rs],drilldownCentering:["type",ls],drilldownOverlayBehavior:["type",ps],subprocessCompatibility:["type",ds]};function fs(e){La.call(this,e)}function gs(e){return!e.altKey&&(e.ctrlKey||e.metaKey)}function vs(e,t){return-1!==(e=ee(e)?e:[e]).indexOf(t.key)||-1!==e.indexOf(t.keyCode)}function bs(e){return e.shiftKey}U()(fs,La),fs.prototype._modules=[bo,ro,Oo,Ho,ms],fs.prototype._moddleExtensions={};var ys="keyboard.keydown";function ws(e,t){var i=this;this._config=e||{},this._eventBus=t,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),t.on("diagram.destroy",(function(){i._fire("destroy"),i.unbind()})),t.on("diagram.init",(function(){i._fire("init")})),t.on("attach",(function(){e&&e.bindTo&&i.bind(e.bindTo)})),t.on("detach",(function(){i.unbind()}))}ws.$inject=["config.keyboard","eventBus"],ws.prototype._keydownHandler=function(e){this._keyHandler(e,ys)},ws.prototype._keyupHandler=function(e){this._keyHandler(e,"keyboard.keyup")},ws.prototype._keyHandler=function(e,t){if(!this._isEventIgnored(e)){var i={keyEvent:e};this._eventBus.fire(t||ys,i)&&e.preventDefault()}},ws.prototype._isEventIgnored=function(e){return(t=e.target)&&(Ne(t,"input, textarea")||"true"===t.contentEditable)&&this._isModifiedKeyIgnored(e);var t},ws.prototype._isModifiedKeyIgnored=function(e){return!gs(e)||-1===this._getAllowedModifiers(e.target).indexOf(e.key)},ws.prototype._getAllowedModifiers=function(e){var t=We(e,"[input-handle-modified-keys]",!0);return!t||this._node&&!this._node.contains(t)?[]:t.getAttribute("input-handle-modified-keys").split(",")},ws.prototype.bind=function(e){this.unbind(),this._node=e,Ge.bind(e,"keydown",this._keydownHandler,!0),Ge.bind(e,"keyup",this._keyupHandler,!0),this._fire("bind")},ws.prototype.getBinding=function(){return this._node},ws.prototype.unbind=function(){var e=this._node;e&&(this._fire("unbind"),Ge.unbind(e,"keydown",this._keydownHandler,!0),Ge.unbind(e,"keyup",this._keyupHandler,!0)),this._node=null},ws.prototype._fire=function(e){this._eventBus.fire("keyboard."+e,{node:this._node})},ws.prototype.addListener=function(e,t,i){ne(e)&&(i=t,t=e,e=1e3),this._eventBus.on(i||ys,e,t)},ws.prototype.removeListener=function(e,t){this._eventBus.off(t||ys,e)},ws.prototype.hasModifier=function(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey},ws.prototype.isCmd=gs,ws.prototype.isShift=bs,ws.prototype.isKey=vs;var xs=["c","C",67],$s=["v","V",86],_s=["y","Y",89],Cs=["z","Z",90];function Es(e,t){var i=this;e.on("editorActions.init",500,(function(e){var n=e.editorActions;i.registerBindings(t,n)}))}Es.$inject=["eventBus","keyboard"],Es.prototype.registerBindings=function(e,t){function i(i,n){t.isRegistered(i)&&e.addListener(n)}i("undo",(function(e){var i=e.keyEvent;if(gs(i)&&!bs(i)&&vs(Cs,i))return t.trigger("undo"),!0})),i("redo",(function(e){var i=e.keyEvent;if(gs(i)&&(vs(_s,i)||vs(Cs,i)&&bs(i)))return t.trigger("redo"),!0})),i("copy",(function(e){var i=e.keyEvent;if(gs(i)&&vs(xs,i))return t.trigger("copy"),!0})),i("paste",(function(e){var i=e.keyEvent;if(gs(i)&&vs($s,i))return t.trigger("paste"),!0})),i("stepZoom",(function(e){var i=e.keyEvent;if(vs(["+","Add","="],i)&&gs(i))return t.trigger("stepZoom",{value:1}),!0})),i("stepZoom",(function(e){var i=e.keyEvent;if(vs(["-","Subtract"],i)&&gs(i))return t.trigger("stepZoom",{value:-1}),!0})),i("zoom",(function(e){var i=e.keyEvent;if(vs("0",i)&&gs(i))return t.trigger("zoom",{value:1}),!0})),i("removeSelection",(function(e){if(vs(["Backspace","Delete","Del"],e.keyEvent))return t.trigger("removeSelection"),!0}))};const Ss={__init__:["keyboard","keyboardBindings"],keyboard:["type",ws],keyboardBindings:["type",Es]};var ks={moveSpeed:50,moveSpeedAccelerated:200};function As(e,t,i){var n=this;this._config=Ae({},ks,e||{}),t.addListener((function(e){var i=e.keyEvent,a=n._config;if(t.isCmd(i)&&t.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],i)){var o,s=t.isShift(i)?a.moveSpeedAccelerated:a.moveSpeed;switch(i.key){case"ArrowLeft":case"Left":o="left";break;case"ArrowUp":case"Up":o="up";break;case"ArrowRight":case"Right":o="right";break;case"ArrowDown":case"Down":o="down"}return n.moveCanvas({speed:s,direction:o}),!0}})),this.moveCanvas=function(e){var t=0,n=0,a=e.speed/Math.min(Math.sqrt(i.viewbox().scale),1);switch(e.direction){case"left":t=a;break;case"up":n=a;break;case"right":t=-a;break;case"down":n=-a}i.scroll({dx:t,dy:n})}}As.$inject=["config.keyboardMove","keyboard","canvas"];const Ds={__depends__:[Ss],__init__:["keyboardMove"],keyboardMove:["type",As]};var Rs=/^djs-cursor-.*$/;function Ps(e){var t=Be(document.body);t.removeMatching(Rs),e&&t.add("djs-cursor-"+e)}function Ls(){Ps(null)}function Vs(e,t){function i(){return!1}return t=t||"element.click",e.once(t,5e3,i),function(){e.off(t,i)}}function Fs(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function Is(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Bs(e,t){var i;function n(n){var a,o=i.start,s=i.button,r=$o(n),l=Is(r,o);!i.dragging&&(a=l,Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))>15)&&(i.dragging=!0,0===s&&Vs(e),Ps("grab")),i.dragging&&(l=Is(r,i.last||i.start),t.scroll({dx:l.x,dy:l.y}),i.last=r),n.preventDefault()}function a(e){Ge.unbind(document,"mousemove",n),Ge.unbind(document,"mouseup",a),i=null,Ls()}e.on("element.mousedown",500,(function(e){return function(e){if(!We(e.target,".djs-draggable")){var t=e.button;if(!(t>=2||e.ctrlKey||e.shiftKey||e.altKey))return i={button:t,start:$o(e)},Ge.bind(document,"mousemove",n),Ge.bind(document,"mouseup",a),!0}}(e.originalEvent)})),this.isActive=function(){return!!i}}Bs.$inject=["eventBus","canvas"];const Ts={__init__:["moveCanvas"],moveCanvas:["type",Bs]};function js(e){return Math.log(e)/Math.log(10)}function Os(e,t){var i=js(e.min),n=js(e.max);return(Math.abs(i)+Math.abs(n))/t}var Ms=Math.sign||function(e){return e>=0?1:-1},Ns={min:.2,max:4};function Ws(e,t,i){e=e||{},this._enabled=!1,this._canvas=i,this._container=i._container,this._handleWheel=Se(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||.75;var n=this;t.on("canvas.init",(function(t){n._init(!1!==e.enabled)}))}Ws.$inject=["config.zoomScroll","eventBus","canvas"],Ws.prototype.scroll=function(e){this._canvas.scroll(e)},Ws.prototype.reset=function(){this._canvas.zoom("fit-viewport")},Ws.prototype.zoom=function(e,t){var i=Os(Ns,20);this._totalDelta+=e,Math.abs(this._totalDelta)>.1&&(this._zoom(e,t,i),this._totalDelta=0)},Ws.prototype._handleWheel=function(e){if(!We(e.target,".djs-scrollable",!0)){var t=this._container;e.preventDefault();var i,n=e.ctrlKey,a=e.shiftKey,o=-1*this._scale;if(o*=n?0===e.deltaMode?.02:.32:0===e.deltaMode?1:16,n){var s=t.getBoundingClientRect(),r={x:e.clientX-s.left,y:e.clientY-s.top};i=Math.sqrt(Math.pow(e.deltaY,2)+Math.pow(e.deltaX,2))*Ms(e.deltaY)*o,this.zoom(i,r)}else i=a?{dx:o*e.deltaY,dy:0}:{dx:o*e.deltaX,dy:o*e.deltaY},this.scroll(i)}},Ws.prototype.stepZoom=function(e,t){var i=Os(Ns,10);this._zoom(e,t,i)},Ws.prototype._zoom=function(e,t,i){var n=this._canvas,a=e>0?1:-1,o=js(n.zoom()),s=Math.round(o/i)*i;s+=i*a;var r,l,c=Math.pow(10,s);n.zoom((r=Ns,l=c,Math.max(r.min,Math.min(r.max,l))),t)},Ws.prototype.toggle=function(e){var t=this._container,i=this._handleWheel,n=this._enabled;return void 0===e&&(e=!n),n!==e&&Ge[e?"bind":"unbind"](t,"wheel",i,!1),this._enabled=e,e},Ws.prototype._init=function(e){this.toggle(e)};const zs={__init__:["zoomScroll"],zoomScroll:["type",Ws]};function Us(e){fs.call(this,e)}U()(Us,fs),Us.prototype._navigationModules=[Ds,Ts,zs],Us.prototype._modules=[].concat(fs.prototype._modules,Us.prototype._navigationModules);var qs=i(840),Hs=i.n(qs),Gs=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];function Zs(e,t){return t.get(e,!1)}function Ys(e){e.preventDefault(),"function"==typeof e.stopPropagation?e.stopPropagation():e.srcEvent&&"function"==typeof e.srcEvent.stopPropagation&&e.srcEvent.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation()}function Ks(e){function t(t){setTimeout((function(){le(Gs,(function(t){Ge.unbind(e,t,Ys,!0)}))}),500)}Ge.bind(e,"touchstart",(function(t){le(Gs,(function(t){Ge.bind(e,t,Ys,!0)}))}),!0),Ge.bind(e,"touchend",t,!0),Ge.bind(e,"touchcancel",t,!0);var i=new(Hs().Manager)(e,{inputClass:Hs().TouchInput,recognizers:[],domEvents:!0}),n=new(Hs().Tap),a=new(Hs().Pan)({threshold:10}),o=new(Hs().Press),s=new(Hs().Pinch),r=new(Hs().Tap)({event:"doubletap",taps:2});return s.requireFailure(a),s.requireFailure(o),i.add([a,o,s,r,n]),i.reset=function(e){var t=this.recognizers,n=this.session;n.stopped||(i.stop(e),setTimeout((function(){var e,i;for(e=0;i=t[e];e++)i.reset(),i.state=8;n.curRecognizer=null}),0))},i.on("hammer.input",(function(e){e.srcEvent.defaultPrevented&&i.reset(!0)})),i}function Xs(e,t,i,n,a){var o,s=Zs("dragging",e),r=Zs("move",e),l=Zs("contextPad",e),c=Zs("palette",e);function d(e,t){return function(i){var o=u(i.target),s=o&&n.get(o);return t&&(i.srcEvent.button=t),a.fire(e,i,s)}}function u(e){return We(e,"svg, .djs-element",!0)}s&&i.on("drag.move",(function(e){var t=e.originalEvent;if(t&&!(t instanceof MouseEvent)){var i=$o(t),a=u(document.elementFromPoint(i.x,i.y)),o=a&&n.get(a);o!==e.hover&&(e.hover&&s.out(e),o&&(s.hover({element:o,gfx:a}),e.hover=o,e.hoverGfx=a))}})),l&&i.on("contextPad.create",(function(e){var t=Ks(e.pad.html);t.on("panstart",(function(e){l.trigger("dragstart",e,!0)})),t.on("press",(function(e){l.trigger("dragstart",e,!0)})),t.on("tap",(function(e){l.trigger("click",e)}))})),c&&i.on("palette.create",(function(e){var t=Ks(e.container);t.on("panstart",(function(e){c.trigger("dragstart",e,!0)})),t.on("press",(function(e){c.trigger("dragstart",e,!0)})),t.on("tap",(function(e){c.trigger("click",e)}))})),i.on("canvas.init",(function(e){!function(e){function i(e){var i=u(e.target),a=i&&n.get(i);if(r&&t.getRootElement()!==a)return r.start(e,a,!0);!function(e){var i=0,n=0;function a(e){var a=e.deltaX-i,o=e.deltaY-n;t.scroll({dx:a,dy:o}),i=e.deltaX,n=e.deltaY}function s(e){o.off("panmove",a),o.off("panend",s),o.off("pancancel",s)}o.on("panmove",a),o.on("panend",s),o.on("pancancel",s)}()}(o=Ks(e)).on("tap",d("element.click")),o.on("doubletap",d("element.dblclick",1)),o.on("panstart",i),o.on("press",i),o.on("pinchstart",(function(e){var i=t.zoom(),n=e.center;function a(e){var a=1-(1-e.scale)/1.5,o=Math.max(.2,Math.min(4,a*i));t.zoom(o,n),Ys(e)}function s(e){o.off("pinchmove",a),o.off("pinchend",s),o.off("pinchcancel",s),o.reset(!0)}o.on("pinchmove",a),o.on("pinchend",s),o.on("pinchcancel",s)}))}(e.svg)}))}function Qs(e,t){var i=this;t.on("canvas.init",(function(e){i.addBBoxMarker(e.svg)}))}Xs.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"],Qs.$inject=["canvas","eventBus"],Qs.prototype.addBBoxMarker=function(e){var t={fill:"none",class:"outer-bound-marker"},i=wt("rect");rt(i,{x:-1e4,y:1e4,width:10,height:10}),rt(i,t),at(e,i);var n=wt("rect");rt(n,{x:1e4,y:1e4,width:10,height:10}),rt(n,t),at(e,n)};const Js={__depends__:[{__depends__:[Ro],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",Xs],touchFix:["type",Qs]}]};function er(e){return e&&e[e.length-1]}function tr(e){return e.y}function ir(e){return e.x}var nr={left:ir,center:ir,right:function(e){return e.x+e.width},top:tr,middle:tr,bottom:function(e){return e.y+e.height}};function ar(e){this._modeling=e}ar.$inject=["modeling"],ar.prototype._getOrientationDetails=function(e){var t="x",i="width";return-1!==["top","bottom","middle"].indexOf(e)&&(t="y",i="height"),{axis:t,dimension:i}},ar.prototype._isType=function(e,t){return-1!==t.indexOf(e)},ar.prototype._alignmentPosition=function(e,t){var i,n,a,o=this._getOrientationDetails(e),s=o.axis,r=o.dimension,l={},c={},d=!1;if(this._isType(e,["left","top"]))l[e]=t[0][s];else if(this._isType(e,["right","bottom"]))a=er(t),l[e]=a[s]+a[r];else if(this._isType(e,["center","middle"])){if(le(t,(function(e){var t=e[s]+Math.round(e[r]/2);c[t]?c[t].elements.push(e):c[t]={elements:[e],center:t}})),i=ye(c,(function(e){return e.elements.length>1&&(d=!0),e.elements.length})),d)return l[e]=er(i).center,l;n=t[0],a=er(t=ye(t,(function(e){return e[s]+e[r]}))),l[e]=function(e,t){return Math.round((e[s]+t[s]+t[r])/2)}(n,a)}return l},ar.prototype.trigger=function(e,t){var i=this._modeling,n=re(e,(function(e){return!(e.waypoints||e.host||e.labelTarget)}));if(!(n.length<2)){var a=ye(n,nr[t]),o=this._alignmentPosition(t,a);i.alignElements(a,o)}};const or={__init__:["alignElements"],alignElements:["type",ar]};function sr(e,t,i,n){for(var a;a=lr(e,i,t);)i=n(t,i,a);return i}function rr(e){return function(t,i,n){var a={x:i.x,y:i.y};return["x","y"].forEach((function(o){var s=e[o];if(s){var r="x"===o?"width":"height",l=s.margin,c=s.minDistance;a[o]=l<0?Math.min(n[o]+l-t[r]/2,i[o]-c+l):Math.max(n[o]+n[r]+l+t[r]/2,i[o]+c+l)}})),a}}function lr(e,t,i){var n={x:t.x-i.width/2,y:t.y-i.height/2,width:i.width,height:i.height},a=function(e){var t=cr(e);return e.host&&(t=t.concat(cr(e.host))),e.attachers&&(t=t.concat(e.attachers.reduce((function(e,t){return e.concat(cr(t))}),[]))),t}(e);return se(a,(function(e){return e!==i&&"intersect"===wi(e,n,10)}))}function cr(e){return(t=e,t.outgoing.map((function(e){return e.target}))).concat(function(e){return e.incoming.map((function(e){return e.source}))}(e));var t}function dr(){return!0}function ur(e,t,i){e.on("autoPlace",100,(function(e){var t=e.shape;return function(e,t,i){i||(i={});var n=i.defaultDistance||50,a=yi(e);return{x:vi(e).right+n+t.width/2,y:a.y}}(e.source,t)})),e.on("autoPlace.end",(function(e){i.scrollToElement(e.shape)})),this.append=function(i,n,a){e.fire("autoPlace.start",{source:i,shape:n});var o=e.fire("autoPlace",{source:i,shape:n}),s=t.appendShape(i,n,o,i.parent,a);return e.fire("autoPlace.end",{source:i,shape:s}),s}}function hr(e,t){e.on("autoPlace.end",500,(function(e){t.select(e.shape)}))}ur.$inject=["eventBus","modeling","canvas"],hr.$inject=["eventBus","selection"];const pr={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",ur],autoPlaceSelectionBehavior:["type",hr]};function mr(e,t){return xa(t,"bpmn:TextAnnotation")?function(e,t){var i=vi(e);return sr(e,t,{x:i.right+t.width/2,y:i.top-50-t.height/2},rr({y:{margin:-30,minDistance:20}}))}(e,t):$a(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])?function(e,t){var i=vi(e);return sr(e,t,{x:i.right-10+t.width/2,y:i.bottom+40+t.width/2},rr({x:{margin:30,minDistance:30}}))}(e,t):xa(t,"bpmn:FlowNode")?function(e,t){var i=vi(e),n=yi(e),a=function(e,t){t||(t={});var i=t.defaultDistance||50,n=t.direction||"e",a=t.filter,o=t.getWeight||function(t){return t.source===e?1:-1},s=t.maxDistance||250,r=t.reference||"start";function l(e,t){return"n"===n?"start"===r?vi(e).top-vi(t).bottom:"center"===r?vi(e).top-yi(t).y:vi(e).top-vi(t).top:"w"===n?"start"===r?vi(e).left-vi(t).right:"center"===r?vi(e).left-yi(t).x:vi(e).left-vi(t).left:"s"===n?"start"===r?vi(t).top-vi(e).bottom:"center"===r?yi(t).y-vi(e).bottom:vi(t).bottom-vi(e).bottom:"start"===r?vi(t).left-vi(e).right:"center"===r?yi(t).x-vi(e).right:vi(t).right-vi(e).right}a||(a=dr);var c=e.incoming.filter(a).map((function(t){var i=o(t),n=i<0?l(t.source,e):l(e,t.source);return{id:t.source.id,distance:n,weight:i}})),d=e.outgoing.filter(a).map((function(t){var i=o(t),n=i>0?l(e,t.target):l(t.target,e);return{id:t.target.id,distance:n,weight:i}}));return ce(c.concat(d).reduce((function(e,t){return e[t.id+"__weight_"+t.weight]=t,e}),{}),(function(e,t){var i=t.distance,n=t.weight;return i<0||i>s||(e[String(i)]||(e[String(i)]=0),e[String(i)]+=1*n,(!e.distance||e[e.distance]<e[String(i)])&&(e.distance=i)),e}),{}).distance||i}(e,{filter:function(e){return xa(e,"bpmn:SequenceFlow")}}),o=30,s="left";return xa(e,"bpmn:BoundaryEvent")&&-1!==(s=wi(e,e.host,-25)).indexOf("top")&&(o*=-1),sr(e,t,{x:i.right+a+t.width/2,y:n.y+fr(s,80)},rr({y:{margin:o,minDistance:80}}))}(e,t):void 0}function fr(e,t){return-1!=e.indexOf("top")?-1*t:-1!=e.indexOf("bottom")?t:0}function gr(e){e.on("autoPlace",(function(e){var t=e.shape;return mr(e.source,t)}))}gr.$inject=["eventBus"];const vr={__depends__:[pr],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",gr]};function br(e,t,i,n){Yo.call(this,e),this._elementRegistry=t,this._modeling=i,this._rules=n;var a=this;this.postExecuted(["shape.create"],(function(e){var t=e.context,i=t.hints||{},n=t.shape,o=t.parent||t.newParent;!1!==i.autoResize&&a._expand([n],o)})),this.postExecuted(["elements.move"],(function(e){var t=e.context,i=Z(fe(t.closure.topLevel)),n=t.hints,o=!n||n.autoResize;!1!==o&&le(ge(i,(function(e){return e.parent.id})),(function(e,t){ee(o)&&(e=e.filter((function(e){return se(o,we({id:e.id}))}))),a._expand(e,t)}))})),this.postExecuted(["shape.toggleCollapse"],(function(e){var t=e.context,i=t.hints,n=t.shape;i&&!1===i.autoResize||n.collapsed||a._expand(n.children||[],n)})),this.postExecuted(["shape.resize"],(function(e){var t=e.context,i=t.hints,n=t.shape,o=n.parent;i&&!1===i.autoResize||o&&a._expand([n],o)}))}function yr(e){e.invoke(br,this)}function wr(e){Yo.call(this,e),this.init()}function xr(e){wr.call(this,e);var t=this;this.addRule("element.autoResize",(function(e){return t.canResize(e.elements,e.target)}))}function $r(e,t){xr.call(this,e),this._modeling=t}br.$inject=["eventBus","elementRegistry","modeling","rules"],zt()(br,Yo),br.prototype._getOptimalBounds=function(e,t){var i=this.getOffset(t),n=this.getPadding(t),a=vi(Jt(e)),o=vi(t),s={};return a.top-o.top<n.top&&(s.top=a.top-i.top),a.left-o.left<n.left&&(s.left=a.left-i.left),o.right-a.right<n.right&&(s.right=a.right+i.right),o.bottom-a.bottom<n.bottom&&(s.bottom=a.bottom+i.bottom),bi(Ae({},o,s))},br.prototype._expand=function(e,t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),this._rules.allowed("element.autoResize",{elements:e,target:t})){var i=this._getOptimalBounds(e,t);if(function(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}(i,t)){var n=function(e,t){var i="";return e=vi(e),t=vi(t),e.top>t.top&&(i=i.concat("n")),e.right<t.right&&(i=i.concat("w")),e.bottom<t.bottom&&(i=i.concat("s")),e.left>t.left&&(i=i.concat("e")),i}(De(t,["x","y","width","height"]),i);this.resize(t,i,{autoResize:n});var a=t.parent;a&&this._expand([t],a)}}},br.prototype.getOffset=function(e){return{top:60,bottom:60,left:100,right:100}},br.prototype.getPadding=function(e){return{top:2,bottom:2,left:15,right:15}},br.prototype.resize=function(e,t,i){this._modeling.resizeShape(e,t,null,i)},yr.$inject=["injector"],U()(yr,br),yr.prototype.resize=function(e,t,i){xa(e,"bpmn:Participant")?this._modeling.resizeLane(e,t,null,i):this._modeling.resizeShape(e,t,null,i)},wr.$inject=["eventBus"],zt()(wr,Yo),wr.prototype.addRule=function(e,t,i){var n=this;"string"==typeof e&&(e=[e]),e.forEach((function(e){n.canExecute(e,t,(function(e,t,n){return i(e)}),!0)}))},wr.prototype.init=function(){},xr.$inject=["eventBus"],zt()(xr,wr),xr.prototype.canResize=function(e,t){return!1},U()($r,xr),$r.$inject=["eventBus","modeling"],$r.prototype.canResize=function(e,t){if(xa(t.di,"bpmndi:BPMNPlane"))return!1;if(!xa(t,"bpmn:Participant")&&!xa(t,"bpmn:Lane")&&!xa(t,"bpmn:SubProcess"))return!1;var i=!0;return le(e,(function(e){(xa(e,"bpmn:Lane")||e.labelTarget)&&(i=!1)})),i};const _r={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",yr],bpmnAutoResizeProvider:["type",$r]};function Cr(e,t,i){var n,a,o=this,s=i.get("dragging",!1);s&&t.on("drag.start",(function(i){t.once("drag.move",1500,(function(t){!function(t){if(!t.hover){var i=t.originalEvent,n=o._findTargetGfx(i),a=n&&e.get(n);n&&a&&(t.stopPropagation(),s.hover({element:a,gfx:n}),s.move(i))}}(t)}))})),t.on("element.hover",(function(e){n=e.gfx,a=e.element})),t.on("element.hover",1500,(function(e){a&&t.fire("element.out",{element:a,gfx:n})})),t.on("element.out",(function(){n=null,a=null})),this._findTargetGfx=function(e){var t;if(e instanceof MouseEvent)return t=$o(e),We(document.elementFromPoint(t.x,t.y),"svg, .djs-element",!0)}}Cr.$inject=["elementRegistry","eventBus","injector"];const Er={__init__:["hoverFix"],hoverFix:["type",Cr]};var Sr=Math.round,kr="djs-drag-active";function Ar(e){e.preventDefault()}function Dr(e,t,i,n){var a,o={threshold:5,trapClick:!0};function s(e){var i=t.viewbox(),n=t._container.getBoundingClientRect();return{x:i.x+(e.x-n.left)/i.scale,y:i.y+(e.y-n.top)/i.scale}}function r(t,i){i=i||a;var n=e.createEvent(Ae({},i.payload,i.data,{isTouch:i.isTouch}));return!1!==e.fire("drag."+t,n)&&e.fire(i.prefix+"."+t,n)}function l(e,n){var o,l=a.payload,c=a.displacement,d=a.globalStart,u=$o(e),h=Is(u,d),p=a.localStart,m=s(u),g=Is(m,p);if(!a.active&&(n||(o=h,Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))>a.threshold))){if(Ae(l,{x:Sr(p.x+c.x),y:Sr(p.y+c.y),dx:0,dy:0},{originalEvent:e}),!1===r("start"))return f();a.active=!0,a.keepSelection||(l.previousSelection=i.get(),i.select(null)),a.cursor&&Ps(a.cursor),t.addMarker(t.getRootElement(),kr)}xo(e),a.active&&(Ae(l,{x:Sr(m.x+c.x),y:Sr(m.y+c.y),dx:Sr(g.x),dy:Sr(g.y)},{originalEvent:e}),r("move"))}function c(e){var t=!0;a.active&&(e&&(a.payload.originalEvent=e,xo(e)),t=r("end")),!1===t&&r("rejected"),r("ended",g(!0!==t))}function d(e){27===e.which&&(Ar(e),f())}function u(t){var i;a.active&&(i=Vs(e),setTimeout(i,400),Ar(t)),c(t)}function h(e){l(e)}function p(e){var t=a.payload;t.hoverGfx=e.gfx,t.hover=e.element,r("hover")}function m(e){r("out");var t=a.payload;t.hoverGfx=null,t.hover=null}function f(e){var t;if(a){var i=a.active;i&&r("cancel"),t=g(e),i&&r("canceled",t)}}function g(o){var s,g;r("cleanup"),Ls(),g=a.trapClick?u:c,Ge.unbind(document,"mousemove",l),Ge.unbind(document,"dragstart",Ar),Ge.unbind(document,"selectstart",Ar),Ge.unbind(document,"mousedown",g,!0),Ge.unbind(document,"mouseup",g,!0),Ge.unbind(document,"keyup",d),Ge.unbind(document,"touchstart",h,!0),Ge.unbind(document,"touchcancel",f,!0),Ge.unbind(document,"touchmove",l,!0),Ge.unbind(document,"touchend",c,!0),e.off("element.hover",p),e.off("element.out",m),t.removeMarker(t.getRootElement(),kr);var v=a.payload.previousSelection;return!1!==o&&v&&!i.get().length&&function(e){var t=e.filter((function(e){return n.get(e.id)}));t.length&&i.select(t)}(v),s=a,a=null,s}e.on("diagram.destroy",f),this.init=function(t,i,n,g){a&&f(!1),"string"==typeof i&&(g=n,n=i,i=null);var v,b,y,w,x,$=(g=Ae({},o,g||{})).data||{};w=g.trapClick?u:c,t?(v=wo(t)||t,b=$o(t),xo(t),"dragstart"===v.type&&Ar(v)):(v=null,b={x:0,y:0}),y=s(b),i||(i=y),x=function(e){return"undefined"!=typeof TouchEvent&&e instanceof TouchEvent}(v),a=Ae({prefix:n,data:$,payload:{},globalStart:b,displacement:Is(i,y),localStart:y,isTouch:x},g),g.manual||(x?(Ge.bind(document,"touchstart",h,!0),Ge.bind(document,"touchcancel",f,!0),Ge.bind(document,"touchmove",l,!0),Ge.bind(document,"touchend",c,!0)):(Ge.bind(document,"mousemove",l),Ge.bind(document,"dragstart",Ar),Ge.bind(document,"selectstart",Ar),Ge.bind(document,"mousedown",w,!0),Ge.bind(document,"mouseup",w,!0)),Ge.bind(document,"keyup",d),e.on("element.hover",p),e.on("element.out",m)),r("init"),g.autoActivate&&l(t,!0)},this.move=l,this.hover=p,this.out=m,this.end=c,this.cancel=f,this.context=function(){return a},this.setOptions=function(e){Ae(o,e)}}Dr.$inject=["eventBus","canvas","selection","elementRegistry"];const Rr={__depends__:[Er,Oo],dragging:["type",Dr]};function Pr(e,t,i){this._canvas=i,this._opts=Ae({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},e);var n=this;t.on("drag.move",(function(e){var t=n._toBorderPoint(e);n.startScroll(t)})),t.on(["drag.cleanup"],(function(){n.stopScroll()}))}Pr.$inject=["config.autoScroll","eventBus","canvas"],Pr.prototype.startScroll=function(e){var t,i,n,a=this._canvas,o=this._opts,s=this,r=a.getContainer().getBoundingClientRect(),l=[e.x,e.y,r.width-e.x,r.height-e.y];this.stopScroll();for(var c=0,d=0,u=0;u<4;u++)t=l[u],i=o.scrollThresholdOut[u],n=o.scrollThresholdIn[u],i<t&&t<n&&(0===u?c=o.scrollStep:1==u?d=o.scrollStep:2==u?c=-o.scrollStep:3==u&&(d=-o.scrollStep));0===c&&0===d||(a.scroll({dx:c,dy:d}),this._scrolling=setTimeout((function(){s.startScroll(e)}),o.scrollRepeatTimeout))},Pr.prototype.stopScroll=function(){clearTimeout(this._scrolling)},Pr.prototype.setOptions=function(e){this._opts=Ae({},this._opts,e)},Pr.prototype._toBorderPoint=function(e){var t=this._canvas._container.getBoundingClientRect(),i=$o(e.originalEvent);return{x:i.x-t.left,y:i.y-t.top}};const Lr={__depends__:[Rr],__init__:["autoScroll"],autoScroll:["type",Pr]};function Vr(e){this._commandStack=e.get("commandStack",!1)}Vr.$inject=["injector"],Vr.prototype.allowed=function(e,t){var i=!0,n=this._commandStack;return n&&(i=n.canExecute(e,t)),void 0===i||i};const Fr={__init__:["rules"],rules:["type",Vr]};var Ir=Math.round,Br=Math.max;function Tr(e,t){return function(e,t){var i,n;for(i=0;n=e[i];i++)if(li(n,t)<=10)return{point:e[i],bendpoint:!0,index:i};return null}(e,t)||function(e,t){var i,n,a=mi()(function(e,t){return[["M",e.x,e.y],["m",0,-t],["a",t,t,0,1,1,0,20],["a",t,t,0,1,1,0,-20],["z"]]}(t,10),(i=[],e.forEach((function(e,t){i.push([0===t?"M":"L",e.x,e.y])})),i)),o=a[0],s=a[a.length-1];return o?o!==s?o.segment2!==s.segment2?{point:e[n=Br(o.segment2,s.segment2)-1],bendpoint:!0,index:n}:{point:{x:Ir(o.x+s.x)/2,y:Ir(o.y+s.y)/2},index:o.segment2}:{point:{x:Ir(o.x),y:Ir(o.y)},index:o.segment2}:null}(e,t)}function jr(e,t,i){var n=function(e,t){var i,n=$o(t),a=e._container.getBoundingClientRect();i={x:a.left,y:a.top};var o=e.viewbox();return{x:o.x+(n.x-i.x)/o.scale,y:o.y+(n.y-i.y)/o.scale}}(e,i);return Tr(t,n)}function Or(e,t){var i=wt("g");ht(i).add("djs-bendpoint"),at(e,i);var n=wt("circle");rt(n,{cx:0,cy:0,r:4}),ht(n).add("djs-visual"),at(i,n);var a=wt("circle");return rt(a,{cx:0,cy:0,r:10}),ht(a).add("djs-hit"),at(i,a),t&&ht(i).add(t),i}function Mr(e,t,i){var n=wt("g"),a=hi(t,i),o=di(t,i);return at(e,n),function(e,t,i,n){var a=wt("g");at(e,a);var o=function(e,t,i){var n=t.x-e.x,a=t.y-e.y;return Nr("h"===i?n:a)}(t,i,n),s=wt("rect");rt(s,{x:-7,y:-1.5,width:14,height:3}),ht(s).add("djs-visual"),at(a,s);var r=wt("rect");rt(r,{x:-o/2,y:-7,width:o,height:14}),ht(r).add("djs-hit"),at(a,r),Ki(a,"v"===n?90:0)}(n,t,i,o),ht(n).add("djs-segment-dragger"),ht(n).add("h"===o?"horizontal":"vertical"),Yi(n,a.x,a.y),n}function Nr(e){return Math.abs(Math.round(2*e/3))}function Wr(e,t,i,n,a){function o(e,t,n){Ge.bind(e,t,(function(e){i.triggerMouseEvent(t,e,n),e.stopPropagation()}))}function s(e,i){var n=t.getLayer("overlays"),a=et('.djs-bendpoints[data-element-id="'+Jo()(e.id)+'"]',n);return!a&&i&&(rt(a=wt("g"),{"data-element-id":e.id}),ht(a).add("djs-bendpoints"),at(n,a),o(a,"mousedown",e),o(a,"click",e),o(a,"dblclick",e)),a}function r(e,t){return et('.djs-segment-dragger[data-segment-idx="'+e+'"]',t)}function l(e,t){t.waypoints.forEach((function(t,i){var n=Or(e);at(e,n),Yi(n,t.x,t.y)})),Or(e,"floating")}function c(e,t){for(var i,n,a,s=t.waypoints,r=1;r<s.length;r++)di(i=s[r-1],n=s[r])&&(rt(a=Mr(e,i,n),{"data-segment-idx":r}),o(a,"mousemove",t))}function d(e){var t=s(e);return t||(l(t=s(e,!0),e),c(t,e)),t}function u(e){var t=s(e);t&&(function(e){le(tt(".djs-segment-dragger",e),(function(e){mt(e)}))}(t),function(e){le(tt(".djs-bendpoint",e),(function(e){mt(e)}))}(t),c(t,e),l(t,e))}e.on("connection.changed",(function(e){u(e.element)})),e.on("connection.remove",(function(e){var t=s(e.element);t&&mt(t)})),e.on("element.marker.update",(function(e){var t,i=e.element;i.waypoints&&(t=d(i),e.add?ht(t).add(e.marker):ht(t).remove(e.marker))})),e.on("element.mousemove",(function(e){var i,n,a=e.element,o=a.waypoints;if(o){if(i=s(a,!0),!(n=jr(t,o,e.originalEvent)))return;!function(e,t){var i=et(".floating",e),n=t.point;i&&Yi(i,n.x,n.y)}(i,n),n.bendpoint||function(e,t,i){var n,a,o=r(t.index,e),s=i[t.index-1],l=i[t.index],c=t.point,d=hi(s,l),u=di(s,l);o&&(n=function(e){return et(".djs-visual",e)}(o),a={x:c.x-d.x,y:c.y-d.y},"v"===u&&(a={x:a.y,y:a.x}),Yi(n,a.x,a.y))}(i,n,o)}})),e.on("element.mousedown",(function(e){if(Co(e)){var i=e.originalEvent,o=e.element;if(o.waypoints)return function(e,i){var o,s=i.waypoints,r=jr(t,s,e);if(r)return o=function(e,t){var i,n,a=e.waypoints;return t.index<=0||t.bendpoint?null:(n=di((i={start:a[t.index-1],end:a[t.index]}).start,i.end))?Nr("h"===n?i.end.x-i.start.x:i.end.y-i.start.y)/2:null}(i,r),function(e,t,i){var n,a,o,s,r,l,c=e.index,d=e.point;return!(c<=0||e.bendpoint)&&(o=hi(n=t[c-1],a=t[c]),s=di(n,a),r=Math.abs(d.x-o.x),l=Math.abs(d.y-o.y),s&&r<=i&&l<=i)}(r,s,o)?a.start(e,i,r.index):n.start(e,i,r.index,!r.bendpoint),!0}(i,o)}})),e.on("selection.changed",(function(e){var t=e.newSelection[0];t&&t.waypoints&&d(t)})),e.on("element.hover",(function(e){var t=e.element;t.waypoints&&(d(t),i.registerEvent(e.gfx,"mousemove","element.mousemove"))})),e.on("element.out",(function(e){i.unregisterEvent(e.gfx,"mousemove","element.mousemove")})),e.on("element.updateId",(function(e){var t=e.element,i=e.newId;if(t.waypoints){var n=s(t);n&&rt(n,{"data-element-id":i})}})),this.addHandles=d,this.updateHandles=u,this.getBendpointsContainer=s,this.getSegmentDragger=r}Wr.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var zr=Math.round,Ur="reconnectStart",qr="reconnectEnd",Hr="updateWaypoints";function Gr(e,t,i,n,a,o){this._injector=e,this.start=function(e,t,o,s){var r,l=i.getGraphics(t),c=t.source,d=t.target,u=t.waypoints,h=(r=s||0!==o?s||o!==u.length-1?Hr:qr:Ur)===Hr?"connection.updateWaypoints":"connection.reconnect",p=a.allowed(h,{connection:t,source:c,target:d});!1===p&&(p=a.allowed(h,{connection:t,source:d,target:c})),!1!==p&&n.init(e,"bendpoint.move",{data:{connection:t,connectionGfx:l,context:{allowed:p,bendpointIndex:o,connection:t,source:c,target:d,insert:s,type:r}}})},t.on("bendpoint.move.hover",(function(e){var t,i=e.context,n=i.connection,o=n.source,s=n.target,r=e.hover,l=i.type;if(i.hover=r,r){var c=l===Hr?"connection.updateWaypoints":"connection.reconnect";if(t=i.allowed=a.allowed(c,{connection:n,source:l===Ur?r:o,target:l===qr?r:s}))return i.source=l===Ur?r:o,void(i.target=l===qr?r:s);!1===t&&(t=i.allowed=a.allowed(c,{connection:n,source:l===qr?r:s,target:l===Ur?r:o})),t&&(i.source=l===qr?r:s,i.target=l===Ur?r:o)}})),t.on(["bendpoint.move.out","bendpoint.move.cleanup"],(function(e){var t=e.context,i=t.type;t.hover=null,t.source=null,t.target=null,i!==Hr&&(t.allowed=!1)})),t.on("bendpoint.move.end",(function(e){var t=e.context,i=t.allowed,n=t.bendpointIndex,a=t.connection,s=t.insert,r=a.waypoints.slice(),l=t.source,c=t.target,d=t.type,u=t.hints||{},h={x:zr(e.x),y:zr(e.y)};if(!i)return!1;d===Hr?(s?r.splice(n,0,h):r[n]=h,u.bendpointMove={insert:s,bendpointIndex:n},r=this.cropWaypoints(a,r),o.updateWaypoints(a,function(e){e=e.slice();for(var t,i,n,a=0;e[a];)t=e[a],i=e[a-1],0===li(t,n=e[a+1])||ci(i,n,t)?e.splice(a,1):a++;return e}(r),u)):(d===Ur?(u.docking="source",Zr(t)&&(u.docking="target",u.newWaypoints=r.reverse())):d===qr&&(u.docking="target",Zr(t)&&(u.docking="source",u.newWaypoints=r.reverse())),o.reconnect(a,l,c,h,u))}),this)}function Zr(e){var t=e.hover,i=e.source,n=e.target,a=e.type;return a===Ur?t&&n&&t===n&&i!==n:a===qr?t&&i&&t===i&&i!==n:void 0}Gr.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],Gr.prototype.cropWaypoints=function(e,t){var i=this._injector.get("connectionDocking",!1);if(!i)return t;var n=e.waypoints;return e.waypoints=t,e.waypoints=i.getCroppedWaypoints(e),t=e.waypoints,e.waypoints=n,t};var Yr="updateWaypoints",Kr="connect-ok",Xr="connect-not-ok",Qr="connect-hover",Jr="djs-updating",el="djs-element-hidden";function tl(e,t,i,n){this._injector=t;var a=t.get("connectionPreview",!1);i.on("bendpoint.move.start",(function(e){var t=e.context,i=t.bendpointIndex,a=t.connection,o=t.insert,s=a.waypoints,r=s.slice();t.waypoints=s,o&&r.splice(i,0,{x:e.x,y:e.y}),a.waypoints=r,ht(t.draggerGfx=Or(n.getLayer("overlays"))).add("djs-dragging"),n.addMarker(a,el),n.addMarker(a,Jr)})),i.on("bendpoint.move.hover",(function(e){var t=e.context,i=t.allowed,a=t.hover,o=t.type;if(a){if(n.addMarker(a,Qr),o===Yr)return;i?(n.removeMarker(a,Xr),n.addMarker(a,Kr)):!1===i&&(n.removeMarker(a,Kr),n.addMarker(a,Xr))}})),i.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,(function(e){var t=e.context,i=t.hover,a=t.target;i&&(n.removeMarker(i,Qr),n.removeMarker(i,a?Kr:Xr))})),i.on("bendpoint.move.move",(function(t){var i=t.context,n=i.allowed,o=i.bendpointIndex,s=i.draggerGfx,r=i.hover,l=i.type,c=i.connection,d=c.source,u=c.target,h=c.waypoints.slice(),p={x:t.x,y:t.y},m=i.hints||{},f={};a&&(m.connectionStart&&(f.connectionStart=m.connectionStart),m.connectionEnd&&(f.connectionEnd=m.connectionEnd),"reconnectStart"===l?Zr(i)?(f.connectionEnd=f.connectionEnd||p,f.source=u,f.target=r||d,h=h.reverse()):(f.connectionStart=f.connectionStart||p,f.source=r||d,f.target=u):"reconnectEnd"===l?Zr(i)?(f.connectionStart=f.connectionStart||p,f.source=r||u,f.target=d,h=h.reverse()):(f.connectionEnd=f.connectionEnd||p,f.source=d,f.target=r||u):(f.noCropping=!0,f.noLayout=!0,h[o]=p),l===Yr&&(h=e.cropWaypoints(c,h)),f.waypoints=h,a.drawPreview(i,n,f)),Yi(s,t.x,t.y)}),this),i.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,(function(e){var t=e.context,i=t.connection,o=t.draggerGfx,s=t.hover,r=t.target,l=t.waypoints;i.waypoints=l,mt(o),n.removeMarker(i,Jr),n.removeMarker(i,el),s&&(n.removeMarker(s,Kr),n.removeMarker(s,r?Kr:Xr)),a&&a.cleanUp(t)}))}tl.$inject=["bendpointMove","injector","eventBus","canvas"];var il="connect-hover",nl="djs-updating";function al(e,t,i){return ol(e,t,e[t]+i)}function ol(e,t,i){return{x:"x"===t?i:e.x,y:"y"===t?i:e.y}}function sl(e){return"x"===e?"y":"x"}function rl(e,t,i){var n,a;return e.original?e.original:(n=yi(t),ol(e,a=sl(i),n[a]))}function ll(e,t,i,n,a,o){var s=e.get("connectionDocking",!1);function r(e,t){if(!s)return t;var i,n=e.waypoints;return e.waypoints=t,i=s.getCroppedWaypoints(e),e.waypoints=n,i}function l(e){a.update("connection",e.connection,e.connectionGfx)}this.start=function(e,t,a){var o,s,r,l,c=i.getGraphics(t),d=a-1,u=a,h=t.waypoints,p=h[d],m=h[u],f=jr(i,h,e);(s=di(p,m))&&(r="v"===s?"x":"y",0===d&&(p=rl(p,t.source,r)),u===h.length-1&&(m=rl(m,t.target,r)),o={connection:t,segmentStartIndex:d,segmentEndIndex:u,segmentStart:p,segmentEnd:m,axis:r,dragPosition:l=f?f.point:{x:(p.x+m.x)/2,y:(p.y+m.y)/2}},n.init(e,l,"connectionSegment.move",{cursor:"x"===r?"resize-ew":"resize-ns",data:{connection:t,connectionGfx:c,context:o}}))},t.on("connectionSegment.move.start",(function(e){var t=e.context,n=e.connection,a=i.getLayer("overlays");t.originalWaypoints=n.waypoints.slice(),t.draggerGfx=Mr(a,t.segmentStart,t.segmentEnd),ht(t.draggerGfx).add("djs-dragging"),i.addMarker(n,nl)})),t.on("connectionSegment.move.move",(function(e){var t,i,n=e.context,a=n.connection,o=n.segmentStartIndex,s=n.segmentEndIndex,c=n.segmentStart,d=n.segmentEnd,u=n.axis,h=n.originalWaypoints.slice(),p=al(c,u,e["d"+u]),m=al(d,u,e["d"+u]),f=h.length,g=0;h[o]=p,h[s]=m,o<2&&(t=wi(a.source,p),1===o?"intersect"===t&&(h.shift(),h[0]=p,g--):"intersect"!==t&&(h.unshift(c),g++)),s>f-3&&(i=wi(a.target,m),s===f-2?"intersect"===i&&(h.pop(),h[h.length-1]=m):"intersect"!==i&&h.push(d)),n.newWaypoints=a.waypoints=r(a,h),function(e,t,i){var n,a,o,s,r,l,c=e.newWaypoints,d=(n=i,a=c[e.segmentStartIndex+t],o=c[e.segmentEndIndex+t],s=sl(e.axis),r=Math.max(a[s],o[s]),l=Math.min(a[s],o[s]),ol(a,s,Math.min(Math.max(l+20,n[s]),r-20)));Yi(e.draggerGfx,d.x,d.y)}(n,g,e),n.newSegmentStartIndex=o+g,l(e)})),t.on("connectionSegment.move.hover",(function(e){e.context.hover=e.hover,i.addMarker(e.hover,il)})),t.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],(function(e){var t=e.context.hover;t&&i.removeMarker(t,il)})),t.on("connectionSegment.move.cleanup",(function(e){var t=e.context,n=t.connection;t.draggerGfx&&mt(t.draggerGfx),i.removeMarker(n,nl)})),t.on(["connectionSegment.move.cancel","connectionSegment.move.end"],(function(e){var t=e.context;t.connection.waypoints=t.originalWaypoints,l(e)})),t.on("connectionSegment.move.end",(function(e){var t=e.context,i=t.connection,n=t.newWaypoints,a=t.newSegmentStartIndex,s=function(e,t){var i=0;return{waypoints:e.filter((function(n,a){return!ci(e[a-1],e[a+1],n)||(i=a<=t?i-1:i,!1)})),segmentOffset:i}}(n=n.map((function(e){return{original:e.original,x:Math.round(e.x),y:Math.round(e.y)}})),a),l=r(i,s.waypoints),c=s.segmentOffset,d={segmentMove:{segmentStartIndex:t.segmentStartIndex,newSegmentStartIndex:a+c}};o.updateWaypoints(i,l,d)}))}ll.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var cl=Math.abs,dl=Math.round;function ul(e){return{x:e.x,y:e.y}}function hl(e){return{x:e.x+e.width,y:e.y+e.height}}function pl(e,t){return!e||isNaN(e.x)||isNaN(e.y)?t:{x:dl(e.x+e.width/2),y:dl(e.y+e.height/2)}}function ml(e,t){var i=e.snapped;return!!i&&("string"==typeof t?i[t]:i.x&&i.y)}function fl(e,t,i){if("string"!=typeof t)throw new Error("axis must be in [x, y]");if("number"!=typeof i&&!1!==i)throw new Error("value must be Number or false");var n,a=e[t],o=e.snapped=e.snapped||{};return!1===i?o[t]=!1:(o[t]=!0,n=i-a,e[t]+=n,e["d"+t]+=n),a}function gl(e){return e.children||[]}var vl=Math.abs,bl=Math.round;function yl(e){function t(e,t){if(ee(e)){for(var i=e.length;i--;)if(vl(e[i]-t)<=10)return e[i]}else{var n=t%(e=+e);if(n<10)return t-n;if(n>e-10)return t-n+e}return t}function i(e){if(e.width)return{x:bl(e.width/2+e.x),y:bl(e.height/2+e.y)}}e.on("connectionSegment.move.move",1500,(function(e){var n,a,o=function(e){var t=e.snapPoints,n=e.connection,a=n.waypoints,o=e.segmentStart,s=e.segmentStartIndex,r=e.segmentEnd,l=e.segmentEndIndex,c=e.axis;if(t)return t;var d=[a[s-1],o,r,a[l+1]];return s<2&&d.unshift(i(n.source)),l>a.length-3&&d.unshift(i(n.target)),e.snapPoints=t={horizontal:[],vertical:[]},le(d,(function(e){e&&(e=e.original||e,"y"===c&&t.horizontal.push(e.y),"x"===c&&t.vertical.push(e.x))})),t}(e.context),s=e.x,r=e.y;if(o){var l=s-(n=t(o.vertical,s)),c=r-(a=t(o.horizontal,r));Ae(e,{dx:e.dx-l,dy:e.dy-c,x:n,y:a}),(l||-1!==o.vertical.indexOf(s))&&fl(e,"x",n),(c||-1!==o.horizontal.indexOf(r))&&fl(e,"y",a)}})),e.on(["bendpoint.move.move","bendpoint.move.end"],1500,(function(e){var n,a,o=e.context,s=function(e){var t=e.snapPoints,i=e.connection.waypoints,n=e.bendpointIndex;if(t)return t;var a=[i[n-1],i[n+1]];return e.snapPoints=t={horizontal:[],vertical:[]},le(a,(function(e){e&&(e=e.original||e,t.horizontal.push(e.y),t.vertical.push(e.x))})),t}(o),r=o.hover,l=r&&i(r),c=e.x,d=e.y;if(s){var u=c-(n=t(l?s.vertical.concat([l.x]):s.vertical,c)),h=d-(a=t(l?s.horizontal.concat([l.y]):s.horizontal,d));Ae(e,{dx:e.dx-u,dy:e.dy-h,x:e.x-u,y:e.y-h}),(u||-1!==s.vertical.indexOf(c))&&fl(e,"x",n),(h||-1!==s.horizontal.indexOf(d))&&fl(e,"y",a)}}))}yl.$inject=["eventBus"];const wl={__depends__:[Rr,Fr],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",Wr],bendpointMove:["type",Gr],bendpointMovePreview:["type",tl],connectionSegmentMove:["type",ll],bendpointSnapping:["type",yl]};function xl(e,t,i,n){function a(e,t){return n.allowed("connection.create",{source:e,target:t})}e.on("connect.hover",(function(e){var t,i=e.context,n=i.start,o=e.hover;if(i.hover=o,!J(t=i.canExecute=a(n,o))){if(!1!==t)return i.source=n,void(i.target=o);J(t=i.canExecute=a(o,n))||!1!==t&&(i.source=o,i.target=n)}})),e.on(["connect.out","connect.cleanup"],(function(e){var t=e.context;t.hover=null,t.source=null,t.target=null,t.canExecute=!1})),e.on("connect.end",(function(e){var t=e.context,n=t.canExecute,a=t.connectionStart,o={x:e.x,y:e.y},s=t.source,r=t.target;if(!n)return!1;var l=null,c={connectionStart:$l(t)?o:a,connectionEnd:$l(t)?a:o};te(n)&&(l=n),i.connect(s,r,l,c)})),this.start=function(e,i,n,a){te(n)||(a=n,n=yi(i)),t.init(e,"connect",{autoActivate:a,data:{shape:i,context:{start:i,connectionStart:n}}})}}function $l(e){var t=e.hover,i=e.source,n=e.target;return t&&i&&t===i&&i!==n}xl.$inject=["eventBus","dragging","modeling","rules"];var _l="connect-ok",Cl="connect-not-ok";function El(e,t,i){var n=e.get("connectionPreview",!1);n&&t.on("connect.move",(function(e){var t=e.context,i=t.canExecute,a=t.hover,o=t.source,s=t.start,r=t.startPosition,l=t.target,c=t.connectionStart||r,d=t.connectionEnd||{x:e.x,y:e.y},u=c,h=d;$l(t)&&(u=d,h=c),n.drawPreview(t,i,{source:o||s,target:l||a,connectionStart:u,connectionEnd:h})})),t.on("connect.hover",900,(function(e){var t=e.context,n=e.hover,a=t.canExecute;null!==a&&i.addMarker(n,a?_l:Cl)})),t.on(["connect.out","connect.cleanup"],1100,(function(e){var t=e.hover;t&&(i.removeMarker(t,_l),i.removeMarker(t,Cl))})),n&&t.on("connect.cleanup",(function(e){n.cleanUp(e.context)}))}El.$inject=["injector","eventBus","canvas"];const Sl={__depends__:[Oo,Fr,Rr],__init__:["connectPreview"],connect:["type",xl],connectPreview:["type",El]};function kl(e,t,i,n){this._canvas=t,this._graphicsFactory=i,this._elementFactory=n,this._connectionDocking=e.get("connectionDocking",!1),this._layouter=e.get("layouter",!1)}kl.$inject=["injector","canvas","graphicsFactory","elementFactory"],kl.prototype.drawPreview=function(e,t,i){i=i||{};var n,a=e.connectionPreviewGfx,o=e.getConnection,s=i.source,r=i.target,l=i.waypoints,c=i.connectionStart,d=i.connectionEnd,u=i.noLayout,h=i.noCropping,p=i.noNoop,m=this;a||(a=e.connectionPreviewGfx=this.createConnectionPreviewGfx()),ft(a),o||(o=e.getConnection=function(e){var t={};return function(i){var n=JSON.stringify(i),a=t[n];return a||(a=t[n]=e.apply(null,arguments)),a}}((function(e,t,i){return m.getConnection(e,t,i)}))),t&&(n=o(t,s,r)),n?(n.waypoints=l||[],this._layouter&&!u&&(n.waypoints=this._layouter.layoutConnection(n,{source:s,target:r,connectionStart:c,connectionEnd:d,waypoints:i.waypoints||n.waypoints})),n.waypoints&&n.waypoints.length||(n.waypoints=[s?yi(s):c,r?yi(r):d]),this._connectionDocking&&(s||r)&&!h&&(n.waypoints=this._connectionDocking.getCroppedWaypoints(n,s,r)),this._graphicsFactory.drawConnection(a,n)):!p&&this.drawNoopPreview(a,i)},kl.prototype.drawNoopPreview=function(e,t){var i=t.source,n=t.target,a=t.connectionStart||yi(i),o=t.connectionEnd||yi(n),s=this.cropWaypoints(a,o,i,n);at(e,this.createNoopConnection(s[0],s[1]))},kl.prototype.cropWaypoints=function(e,t,i,n){var a=this._graphicsFactory,o=i&&a.getShapePath(i),s=n&&a.getShapePath(n),r=a.getConnectionPath({waypoints:[e,t]});return[e=i&&xi(o,r,!0)||e,t=n&&xi(s,r,!1)||t]},kl.prototype.cleanUp=function(e){e&&e.connectionPreviewGfx&&mt(e.connectionPreviewGfx)},kl.prototype.getConnection=function(e){var t=function(e){return te(e)?e:{}}(e);return this._elementFactory.createConnection(t)},kl.prototype.createConnectionPreviewGfx=function(){var e=wt("g");return rt(e,{pointerEvents:"none"}),ht(e).add("djs-connection-preview"),at(this._canvas.getActiveLayer(),e),e},kl.prototype.createNoopConnection=function(e,t){var i=wt("polyline");return rt(i,{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),rt(i,{points:[e.x,e.y,t.x,t.y]}),i};const Al={__init__:["connectionPreview"],connectionPreview:["type",kl]};var Dl=Math.min,Rl=Math.max;function Pl(e){e.preventDefault()}function Ll(e){e.stopPropagation()}function Vl(e){this.container=e.container,this.parent=Xe('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=et("[contenteditable]",this.parent),this.keyHandler=e.keyHandler||function(){},this.resizeHandler=e.resizeHandler||function(){},this.autoResize=Se(this.autoResize,this),this.handlePaste=Se(this.handlePaste,this)}function Fl(e,t){this._eventBus=e,this._providers=[],this._textbox=new Vl({container:t.getContainer(),keyHandler:Se(this._handleKey,this),resizeHandler:Se(this._handleResize,this)})}Vl.prototype.create=function(e,t,i,n){var a=this.parent,o=this.content,s=this.container;n=this.options=n||{};var r=De(t=this.style=t||{},["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);Ae(a.style,{width:e.width+"px",height:e.height+"px",maxWidth:e.maxWidth+"px",maxHeight:e.maxHeight+"px",minWidth:e.minWidth+"px",minHeight:e.minHeight+"px",left:e.x+"px",top:e.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},r);var l=De(t,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return Ae(o.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},l),n.centerVertically&&Ae(o.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},l),o.innerText=i,Ge.bind(o,"keydown",this.keyHandler),Ge.bind(o,"mousedown",Ll),Ge.bind(o,"paste",this.handlePaste),n.autoResize&&Ge.bind(o,"input",this.autoResize),n.resizable&&this.resizable(t),s.appendChild(a),this.setSelection(o.lastChild,o.lastChild&&o.lastChild.length),a},Vl.prototype.handlePaste=function(e){var t,i=this.options,n=this.style;if(e.preventDefault(),t=e.clipboardData?e.clipboardData.getData("text/plain"):window.clipboardData.getData("Text"),this.insertText(t),i.autoResize){var a=this.autoResize(n);a&&this.resizeHandler(a)}},Vl.prototype.insertText=function(e){e=e.replace(/\r\n|\r|\n/g,"\n"),document.execCommand("insertText",!1,e)||this._insertTextIE(e)},Vl.prototype._insertTextIE=function(e){var t,i,n,a=this.getSelection(),o=a.startContainer,s=a.endContainer,r=a.startOffset,l=a.endOffset,c=a.commonAncestorContainer,d=(t=c.childNodes,[].slice.call(t));if(function(e){return e.nodeType===Node.TEXT_NODE}(c)){var u=o.textContent;o.textContent=u.substring(0,r)+e+u.substring(l),i=o,n=r+e.length}else if(o===this.content&&s===this.content){var h=document.createTextNode(e);this.content.insertBefore(h,d[r]),i=h,n=h.textContent.length}else{var p=d.indexOf(o),m=d.indexOf(s);d.forEach((function(t,i){i===p?t.textContent=o.textContent.substring(0,r)+e+s.textContent.substring(l):i>p&&i<=m&&it(t)})),i=o,n=r+e.length}i&&void 0!==n&&setTimeout((function(){self.setSelection(i,n)}))},Vl.prototype.autoResize=function(){var e=this.parent,t=this.content,i=parseInt(this.style.fontSize)||12;if(t.scrollHeight>e.offsetHeight||t.scrollHeight<e.offsetHeight-i){var n=e.getBoundingClientRect(),a=t.scrollHeight;e.style.height=a+"px",this.resizeHandler({width:n.width,height:n.height,dx:0,dy:a-n.height})}},Vl.prototype.resizable=function(){var e=this,t=this.parent,i=this.resizeHandle,n=parseInt(this.style.minWidth)||0,a=parseInt(this.style.minHeight)||0,o=parseInt(this.style.maxWidth)||1/0,s=parseInt(this.style.maxHeight)||1/0;if(!i){var r,l,c,d;i=this.resizeHandle=Xe('<div class="djs-direct-editing-resize-handle"></div>');var u=function(i){Pl(i),Ll(i);var u=Dl(Rl(c+i.clientX-r,n),o),h=Dl(Rl(d+i.clientY-l,a),s);t.style.width=u+"px",t.style.height=h+"px",e.resizeHandler({width:c,height:d,dx:i.clientX-r,dy:i.clientY-l})},h=function(e){Pl(e),Ll(e),Ge.unbind(document,"mousemove",u,!1),Ge.unbind(document,"mouseup",h,!1)};Ge.bind(i,"mousedown",(function(e){Pl(e),Ll(e),r=e.clientX,l=e.clientY;var i=t.getBoundingClientRect();c=i.width,d=i.height,Ge.bind(document,"mousemove",u),Ge.bind(document,"mouseup",h)}))}Ae(i.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),t.appendChild(i)},Vl.prototype.destroy=function(){var e=this.parent,t=this.content,i=this.resizeHandle;t.innerText="",e.removeAttribute("style"),t.removeAttribute("style"),Ge.unbind(t,"keydown",this.keyHandler),Ge.unbind(t,"mousedown",Ll),Ge.unbind(t,"input",this.autoResize),Ge.unbind(t,"paste",this.handlePaste),i&&(i.removeAttribute("style"),it(i)),it(e)},Vl.prototype.getValue=function(){return this.content.innerText.trim()},Vl.prototype.getSelection=function(){return window.getSelection().getRangeAt(0)},Vl.prototype.setSelection=function(e,t){var i=document.createRange();null===e?i.selectNodeContents(this.content):(i.setStart(e,t),i.setEnd(e,t));var n=window.getSelection();n.removeAllRanges(),n.addRange(i)},Fl.$inject=["eventBus","canvas"],Fl.prototype.registerProvider=function(e){this._providers.push(e)},Fl.prototype.isActive=function(){return!!this._active},Fl.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},Fl.prototype._fire=function(e,t){this._eventBus.fire("directEditing."+e,t||{active:this._active})},Fl.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0},Fl.prototype.complete=function(){var e=this._active;if(e){var t,i=e.context.bounds,n=this.$textbox.getBoundingClientRect(),a=this.getValue();a===e.context.text&&n.height===i.height&&n.width===i.width||(t=this._textbox.container.getBoundingClientRect(),e.provider.update(e.element,a,e.context.text,{x:n.left-t.left,y:n.top-t.top,width:n.width,height:n.height})),this._fire("complete"),this.close()}},Fl.prototype.getValue=function(){return this._textbox.getValue()},Fl.prototype._handleKey=function(e){e.stopPropagation();var t=e.keyCode||e.charCode;return 27===t?(e.preventDefault(),this.cancel()):13!==t||e.shiftKey?void 0:(e.preventDefault(),this.complete())},Fl.prototype._handleResize=function(e){this._fire("resize",e)},Fl.prototype.activate=function(e){var t;this.isActive()&&this.cancel();var i=se(this._providers,(function(i){return(t=i.activate(e))?i:null}));return t&&(this.$textbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this._active={element:e,context:t,provider:i},t.options&&t.options.resizable&&(this.resizable=!0),this._fire("activate")),!!t};const Il={__depends__:[Ro],__init__:["directEditing"],directEditing:["type",Fl]};var Bl=".entry";function Tl(e,t,i){this._eventBus=t,this._overlays=i;var n=Q(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={position:{right:-9,top:-6},scale:n},this._current=null,this._init()}Tl.$inject=["config.contextPad","eventBus","overlays"],Tl.prototype._init=function(){var e=this._eventBus,t=this;e.on("selection.changed",(function(e){var i=e.newSelection;1===i.length?t.open(i[0]):t.close()})),e.on("elements.delete",(function(e){le(e.elements,(function(e){t.isOpen(e)&&t.close()}))})),e.on("element.changed",(function(e){var i=e.element,n=t._current;n&&n.element===i&&t.open(i,!0)}))},Tl.prototype.registerProvider=function(e,t){t||(t=e,e=1e3),this._eventBus.on("contextPad.getProviders",e,(function(e){e.providers.push(t)}))},Tl.prototype.getEntries=function(e){var t=this._getProviders(),i={};return le(t,(function(t){var n=t.getContextPadEntries(e);ne(n)?i=n(i):le(n,(function(e,t){i[t]=e}))})),i},Tl.prototype.trigger=function(e,t,i){var n,a,o=this._current.element,s=this._current.entries,r=t.delegateTarget||t.target;if(!r)return t.preventDefault();if(n=s[Pe(r,"data-action")].action,a=t.originalEvent||t,ne(n)){if("click"===e)return n(a,o,i)}else if(n[e])return n[e](a,o,i);t.preventDefault()},Tl.prototype.open=function(e,t){!t&&this.isOpen(e)||(this.close(),this._updateAndOpen(e))},Tl.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},Tl.prototype._updateAndOpen=function(e){var t=this.getEntries(e),i=this.getPad(e),n=i.html;le(t,(function(e,t){var i,a=e.group||"default",o=Xe(e.html||'<div class="entry" draggable="true"></div>');Pe(o,"data-action",t),(i=et("[data-group="+a+"]",n))||(i=Xe('<div class="group" data-group="'+a+'"></div>'),n.appendChild(i)),i.appendChild(o),e.className&&function(e,t){var i=Be(e);(ee(t)?t:t.split(/\s+/g)).forEach((function(e){i.add(e)}))}(o,e.className),e.title&&Pe(o,"title",e.title),e.imageUrl&&o.appendChild(Xe('<img src="'+e.imageUrl+'">'))})),Be(n).add("open"),this._current={element:e,pad:i,entries:t},this._eventBus.fire("contextPad.open",{current:this._current})},Tl.prototype.getPad=function(e){if(this.isOpen())return this._current.pad;var t=this,i=this._overlays,n=Xe('<div class="djs-context-pad"></div>'),a=Ae({html:n},this._overlaysConfig);Ye(n,Bl,"click",(function(e){t.trigger("click",e)})),Ye(n,Bl,"dragstart",(function(e){t.trigger("dragstart",e)})),Ge.bind(n,"mousedown",(function(e){e.stopPropagation()})),this._overlayId=i.add(e,"context-pad",a);var o=i.get(this._overlayId);return this._eventBus.fire("contextPad.create",{element:e,pad:o}),o},Tl.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},Tl.prototype.isOpen=function(e){return!(!this._current||e&&this._current.element!==e)};const jl={__depends__:[Ro,Ho],contextPad:["type",Tl]};var Ol=["marker-start","marker-mid","marker-end"],Ml=["circle","ellipse","line","path","polygon","polyline","rect"];function Nl(e,t,i,n){this._elementRegistry=e,this._canvas=i,this._styles=n,this._clonedMarkers={};var a=this;t.on("drag.cleanup",(function(){le(a._clonedMarkers,(function(e){mt(e)})),a._clonedMarkers={}}))}Nl.$inject=["elementRegistry","eventBus","canvas","styles"],Nl.prototype.getGfx=function(e){return this._elementRegistry.getGraphics(e)},Nl.prototype.addDragger=function(e,t,i){var n=gt(i=i||this.getGfx(e)),a=i.getBoundingClientRect();return this._cloneMarkers(Gi(n)),rt(n,this._styles.cls("djs-dragger",[],{x:a.top,y:a.left})),at(t,n),n},Nl.prototype.addFrame=function(e,t){var i=wt("rect",{class:"djs-resize-overlay",width:e.width,height:e.height,x:e.x,y:e.y});return at(t,i),i},Nl.prototype._cloneMarkers=function(e){var t=this;if(e.childNodes)for(var i=0;i<e.childNodes.length;i++)t._cloneMarkers(e.childNodes[i]);(function(e){return-1!==Ml.indexOf(e.nodeName)})(e)&&Ol.forEach((function(i){if(rt(e,i)){var n=function(e,t,i){return et("marker#"+rt(e,t).match(/url\(['"]?#([^'"]*)['"]?\)/)[1],i||document)}(e,i,t._canvas.getContainer());t._cloneMarker(e,n,i)}}))},Nl.prototype._cloneMarker=function(e,t,i){var n=t.id,a=this._clonedMarkers[n];if(!a){var o=n+"-clone";(a=gt(t)).id=o,ht(a).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[n]=a;var s=et("defs",this._canvas._svg);s||(s=wt("defs"),at(this._canvas._svg,s)),at(s,a)}rt(e,i,"url(#"+this._clonedMarkers[n].id+")")};const Wl={__init__:["previewSupport"],previewSupport:["type",Nl]};var zl="drop-ok",Ul="drop-not-ok",ql="attach-ok",Hl="new-parent",Gl="create";function Zl(e,t,i,n,a){function o(t,i){[ql,zl,Ul,Hl].forEach((function(n){n===i?e.addMarker(t,n):e.removeMarker(t,n)}))}function s(){var e=t.context();e&&e.prefix===Gl&&t.cancel()}i.on(["create.move","create.hover"],(function(e){var t=e.context,i=t.elements,n=e.hover,s=t.source,r=t.hints||{};if(!n)return t.canExecute=!1,void(t.target=null);Yl(e);var l={x:e.x,y:e.y},c=t.canExecute=n&&function(e,t,i,n,o){if(!t)return!1;var s=se(e=re(e,(function(t){var i=t.labelTarget;return!(t.parent||function(e){return!!e.labelTarget}(t)&&-1!==e.indexOf(i))})),(function(e){return!Kl(e)})),r=!1,l=!1,c=!1;Xl(e)&&(r=a.allowed("shape.attach",{position:i,shape:s,target:t})),r||(c=Xl(e)?a.allowed("shape.create",{position:i,shape:s,source:n,target:t}):a.allowed("elements.create",{elements:e,position:i,target:t}));var d=o.connectionTarget;return c||r?(s&&n&&(l=a.allowed("connection.create",{source:d===n?s:n,target:d===n?n:s,hints:{targetParent:t,targetAttach:r}})),{attach:r,connect:l}):(null===c||null===r)&&null}(i,n,l,s,r);n&&null!==c&&(t.target=n,c&&c.attach?o(n,ql):o(n,c?Hl:Ul))})),i.on(["create.end","create.out","create.cleanup"],(function(e){var t=e.hover;t&&o(t,null)})),i.on("create.end",(function(e){var t=e.context,i=t.source,a=t.shape,o=t.elements,s=t.target,r=t.canExecute,l=r&&r.attach,c=r&&r.connect,d=t.hints||{};if(!1===r||!s)return!1;Yl(e);var u={x:e.x,y:e.y};a=c?n.appendShape(i,a,u,s,{attach:l,connection:!0===c?{}:c,connectionTarget:d.connectionTarget}):se(o=n.createElements(o,u,s,Ae({},d,{attach:l})),(function(e){return!Kl(e)})),Ae(t,{elements:o,shape:a}),Ae(e,{elements:o,shape:a})})),i.on("create.init",(function(){i.on("elements.changed",s),i.once(["create.cancel","create.end"],2e3,(function(){i.off("elements.changed",s)}))})),this.start=function(e,i,n){ee(i)||(i=[i]);var a=se(i,(function(e){return!Kl(e)}));if(a){n=Ae({elements:i,hints:{},shape:a},n||{}),le(i,(function(e){ie(e.x)||(e.x=0),ie(e.y)||(e.y=0)}));var o=Jt(re(i,(function(e){return!e.hidden})));le(i,(function(e){Kl(e)&&(e.waypoints=he(e.waypoints,(function(e){return{x:e.x-o.x-o.width/2,y:e.y-o.y-o.height/2}}))),Ae(e,{x:e.x-o.x-o.width/2,y:e.y-o.y-o.height/2})})),t.init(e,Gl,{cursor:"grabbing",autoActivate:!0,data:{shape:a,elements:i,context:n}})}}}function Yl(e){var t=e.context.createConstraints;t&&(t.left&&(e.x=Math.max(e.x,t.left)),t.right&&(e.x=Math.min(e.x,t.right)),t.top&&(e.y=Math.max(e.y,t.top)),t.bottom&&(e.y=Math.min(e.y,t.bottom)))}function Kl(e){return!!e.waypoints}function Xl(e){return e&&1===e.length&&!Kl(e[0])}function Ql(e,t,i,n,a){t.on("create.move",750,(function(t){var o=t.hover,s=t.context,r=s.elements,l=s.dragGroup;l||(l=s.dragGroup=function(e){var t=wt("g");rt(t,a.cls("djs-drag-group",["no-events"]));var o=wt("g");return e.forEach((function(e){var a;e.hidden||(e.waypoints?(a=i._createContainer("connection",o),i.drawConnection(Gi(a),e)):(a=i._createContainer("shape",o),i.drawShape(Gi(a),e),Yi(a,e.x,e.y)),n.addDragger(e,t,a))})),t}(r)),o?(l.parentNode||at(e.getActiveLayer(),l),Yi(l,t.x,t.y)):mt(l)})),t.on("create.cleanup",(function(e){var t=e.context.dragGroup;t&&mt(t)}))}Zl.$inject=["canvas","dragging","eventBus","modeling","rules"],Ql.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const Jl={__depends__:[Rr,Wl,Fr,Oo],__init__:["create","createPreview"],create:["type",Zl],createPreview:["type",Ql]};var ec="data-id",tc=["contextPad.close","canvas.viewbox.changing","commandStack.changed"];function ic(e,t,i){var n=Q(e&&e.scale)?e.scale:{min:1,max:1.5};this._config={scale:n},this._eventBus=t,this._canvas=i,this._providers={},this._current={}}ic.$inject=["config.popupMenu","eventBus","canvas"],ic.prototype.registerProvider=function(e,t,i){i||(i=t,t=1e3),this._eventBus.on("popupMenu.getProviders."+e,t,(function(e){e.providers.push(i)}))},ic.prototype.isEmpty=function(e,t){if(!e)throw new Error("element parameter is missing");if(!t)throw new Error("providerId parameter is missing");var i=this._getProviders(t);if(!i)return!0;var n=this._getEntries(e,i),a=this._getHeaderEntries(e,i),o=me(n)>0,s=a&&me(a)>0;return!o&&!s},ic.prototype.open=function(e,t,i){var n=this._getProviders(t);if(!e)throw new Error("Element is missing");if(!n||!n.length)throw new Error("No registered providers for: "+t);if(!i)throw new Error("the position argument is missing");this.isOpen()&&this.close(),this._emit("open");var a=this._current={className:t,element:e,position:i},o=this._getEntries(e,n),s=this._getHeaderEntries(e,n);a.entries=Ae({},o,s),a.container=this._createContainer(),me(s)&&a.container.appendChild(this._createEntries(s,"djs-popup-header")),me(o)&&a.container.appendChild(this._createEntries(o,"djs-popup-body"));var r=this._canvas.getContainer();this._attachContainer(a.container,r,i.cursor),this._bindAutoClose()},ic.prototype.close=function(){this.isOpen()&&(this._emit("close"),this._unbindAutoClose(),it(this._current.container),this._current.container=null)},ic.prototype.isOpen=function(){return!!this._current.container},ic.prototype.trigger=function(e){e.preventDefault();var t=Pe(e.delegateTarget||e.target,ec),i=this._getEntry(t);if(i.action)return i.action.call(null,e,i)},ic.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"popupMenu.getProviders."+e,providers:[]});return this._eventBus.fire(t),t.providers},ic.prototype._getEntries=function(e,t){var i={};return le(t,(function(t){if(t.getPopupMenuEntries){var n=t.getPopupMenuEntries(e);ne(n)?i=n(i):le(n,(function(e,t){i[t]=e}))}else le(t.getEntries(e),(function(e){var t=e.id;if(!t)throw new Error("every entry must have the id property set");i[t]=Re(e,["id"])}))})),i},ic.prototype._getHeaderEntries=function(e,t){var i={};return le(t,(function(t){if(t.getPopupMenuHeaderEntries){var n=t.getPopupMenuHeaderEntries(e);ne(n)?i=n(i):le(n,(function(e,t){i[t]=e}))}else{if(!t.getHeaderEntries)return;le(t.getHeaderEntries(e),(function(e){var t=e.id;if(!t)throw new Error("every entry must have the id property set");i[t]=Re(e,["id"])}))}})),i},ic.prototype._getEntry=function(e){var t=this._current.entries[e];if(!t)throw new Error("entry not found");return t},ic.prototype._emit=function(e){this._eventBus.fire("popupMenu."+e)},ic.prototype._createContainer=function(){var e=Xe('<div class="djs-popup">'),t=this._current.position,i=this._current.className;return Ae(e.style,{position:"absolute",left:t.x+"px",top:t.y+"px",visibility:"hidden"}),Be(e).add(i),e},ic.prototype._attachContainer=function(e,t,i){var n=this;Ye(e,".entry","click",(function(e){n.trigger(e)})),this._updateScale(e),t.appendChild(e),i&&this._assureIsInbounds(e,i)},ic.prototype._updateScale=function(e){var t,i,n=this._canvas.zoom(),a=this._config.scale,o=n;!0!==a&&(!1===a?(t=1,i=1):(t=a.min,i=a.max),Q(t)&&n<t&&(o=t),Q(i)&&n>i&&(o=i)),function(e,t){e.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(i){e.style[i+"transform"]=t}))}(e,"scale("+o+")")},ic.prototype._assureIsInbounds=function(e,t){var i,n,a=this._canvas._container.getBoundingClientRect(),o=e.offsetLeft,s=e.offsetTop,r=e.scrollWidth,l=e.scrollHeight,c={},d=t.x-a.left,u=t.y-a.top;o+r>a.width&&(c.x=!0),s+l>a.height&&(c.y=!0),c.x&&c.y?(i=d-r+"px",n=u-l+"px"):c.x?(i=d-r+"px",n=u+"px"):c.y&&u<l?(i=d+"px",n="10px"):c.y&&(i=d+"px",n=u-l+"px"),Ae(e.style,{left:i,top:n},{visibility:"visible","z-index":1e3})},ic.prototype._createEntries=function(e,t){var i=Xe("<div>"),n=this;return Be(i).add(t),le(e,(function(e,t){var a=n._createEntry(e,t);i.appendChild(a)})),i},ic.prototype._createEntry=function(e,t){var i=Xe("<div>"),n=Be(i);if(n.add("entry"),e.className&&e.className.split(" ").forEach((function(e){n.add(e)})),Pe(i,ec,t),e.label){var a=Xe("<span>");a.textContent=e.label,i.appendChild(a)}return e.imageUrl&&i.appendChild(Xe('<img src="'+e.imageUrl+'" />')),!0===e.active&&n.add("active"),!0===e.disabled&&n.add("disabled"),e.title&&(i.title=e.title),i},ic.prototype._bindAutoClose=function(){this._eventBus.once(tc,this.close,this)},ic.prototype._unbindAutoClose=function(){this._eventBus.off(tc,this.close,this)};const nc={__init__:["popupMenu"],popupMenu:["type",ic]};function ac(){}ac.prototype.get=function(){return this._data},ac.prototype.set=function(e){this._data=e},ac.prototype.clear=function(){var e=this._data;return delete this._data,e},ac.prototype.isEmpty=function(){return!this._data};const oc={clipboard:["type",ac]};function sc(e){var t=this;function i(e){t._lastMoveEvent=e}this._lastMoveEvent=null,e.on("canvas.init",(function(e){(t._svg=e.svg).addEventListener("mousemove",i)})),e.on("canvas.destroy",(function(){t._lastMouseEvent=null,t._svg.removeEventListener("mousemove",i)}))}sc.$inject=["eventBus"],sc.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||((e=document.createEvent("MouseEvent")).initMouseEvent&&e.initMouseEvent("mousemove",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e);var e};const rc={__init__:["mouse"],mouse:["type",sc]};function lc(e,t,i,n,a,o,s,r){this._canvas=e,this._create=t,this._clipboard=i,this._elementFactory=n,this._eventBus=a,this._modeling=o,this._mouse=s,this._rules=r,a.on("copyPaste.copyElement",(function(e){var t=e.descriptor,i=e.element,n=e.elements;t.priority=1,t.id=i.id,se(n,(function(e){return e===i.parent}))&&(t.parent=i.parent.id),function(e){return!!e.host}(i)&&(t.priority=2,t.host=i.host.id),cc(i)&&(t.priority=3,t.source=i.source.id,t.target=i.target.id,t.waypoints=function(e){return he(e.waypoints,(function(e){return(e=uc(e)).original&&(e.original=uc(e.original)),e}))}(i)),dc(i)&&(t.priority=4,t.labelTarget=i.labelTarget.id),le(["x","y","width","height"],(function(e){ie(i[e])&&(t[e]=i[e])})),t.hidden=i.hidden,t.collapsed=i.collapsed})),a.on("copyPaste.pasteElements",(function(e){Ae(e.hints,{createElementsBehavior:!1})}))}function cc(e){return!!e.waypoints}function dc(e){return!!e.labelTarget}function uc(e){return Ae({},e)}function hc(e,t){var i=t.indexOf(e);return-1===i?t:t.splice(i,1)}lc.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"],lc.prototype.copy=function(e){var t,i;return ee(e)||(e=e?[e]:[]),i=!1===(t=this._eventBus.fire("copyPaste.canCopyElements",{elements:e}))?{}:this.createTree(ee(t)?t:e),this._clipboard.set(i),this._eventBus.fire("copyPaste.elementsCopied",{elements:e,tree:i}),i},lc.prototype.paste=function(e){var t=this._clipboard.get();if(!this._clipboard.isEmpty()){var i=e&&e.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:i});var n=this._createElements(t);if(e&&e.element&&e.point)return this._paste(n,e.element,e.point,i);this._create.start(this._mouse.getLastMoveEvent(),n,{hints:i||{}})}},lc.prototype._paste=function(e,t,i,n){le(e,(function(e){ie(e.x)||(e.x=0),ie(e.y)||(e.y=0)}));var a=Jt(e);return le(e,(function(e){cc(e)&&(e.waypoints=he(e.waypoints,(function(e){return{x:e.x-a.x-a.width/2,y:e.y-a.y-a.height/2}}))),Ae(e,{x:e.x-a.x-a.width/2,y:e.y-a.y-a.height/2})})),this._modeling.createElements(e,i,t,Ae({},n))},lc.prototype._createElements=function(e){var t=this,i=this._eventBus,n={},a=[];return le(e,(function(e,o){o=parseInt(o,10),le(e=ye(e,"priority"),(function(e){var o,s=Ae({},Re(e,["priority"]));return n[e.parent]?s.parent=n[e.parent]:delete s.parent,i.fire("copyPaste.pasteElement",{cache:n,descriptor:s}),cc(s)?(s.source=n[e.source],s.target=n[e.target],o=n[e.id]=t.createConnection(s),void a.push(o)):dc(s)?(s.labelTarget=n[s.labelTarget],o=n[e.id]=t.createLabel(s),void a.push(o)):(s.host&&(s.host=n[s.host]),o=n[e.id]=t.createShape(s),void a.push(o))}))})),a},lc.prototype.createConnection=function(e){return this._elementFactory.createConnection(Re(e,["id"]))},lc.prototype.createLabel=function(e){return this._elementFactory.createLabel(Re(e,["id"]))},lc.prototype.createShape=function(e){return this._elementFactory.createShape(Re(e,["id"]))},lc.prototype.hasRelations=function(e,t){var i,n;return!(cc(e)&&(i=se(t,we({id:e.source.id})),n=se(t,we({id:e.target.id})),!i||!n)||dc(e)&&!se(t,we({id:e.labelTarget.id})))},lc.prototype.createTree=function(e){var t=this._rules,i=this,n={},a=[];function o(e,t){var i=se(a,(function(t){return e===t.element}));i?i.depth<t&&(a=function(e,t){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t}(i,a),a.push({element:i.element,depth:t})):a.push({element:e,depth:t})}return Xt(Zt(e),(function(e,t,n){if(!dc(e)){le(e.labels,(function(e){o(e,n)})),le([e.attachers,e.incoming,e.outgoing],(function(e){e&&e.length&&le(e,(function(e){le(e.labels,(function(e){o(e,n)})),o(e,n)}))})),o(e,n);var a=[];return e.children&&(a=e.children.slice()),i._eventBus.fire("copyPaste.createTree",{element:e,children:a}),a}})),e=he(a,(function(e){return e.element})),a=he(a,(function(t){return t.descriptor={},i._eventBus.fire("copyPaste.copyElement",{descriptor:t.descriptor,element:t.element,elements:e}),t})),a=ye(a,(function(e){return e.descriptor.priority})),e=he(a,(function(e){return e.element})),le(a,(function(a){var o=a.depth;i.hasRelations(a.element,e)&&function(e,i){return t.allowed("element.copy",{element:e,elements:i})}(a.element,e)?(n[o]||(n[o]=[]),n[o].push(a.descriptor)):hc(a.element,e)})),n};const pc={__depends__:[oc,Jl,rc,Fr],__init__:["copyPaste"],copyPaste:["type",lc]};function mc(e,t,i){ee(i)||(i=[i]),le(i,(function(i){X(e[i])||(t[i]=e[i])}))}function fc(e,t,i){var n;t.on("copyPaste.copyElement",750,(function(e){var t=e.descriptor,i=e.element,n=t.oldBusinessObject=_a(i),a=t.oldDi=Ca(i);if(t.type=i.type,mc(n,t,"name"),mc(a,t,"isExpanded"),gc(t))return t;n.default&&(t.default=n.default.id)})),t.on("moddleCopy.canCopyProperty",(function(t){var n,a=t.parent,o=t.property;if("processRef"===t.propertyName&&xa(a,"bpmn:Participant")&&xa(o,"bpmn:Process"))return n=e.create("bpmn:Process"),i.copyElement(o,n)})),t.on("copyPaste.pasteElements",(function(){n={}})),t.on("copyPaste.pasteElement",(function(t){var a,o,s,r,l=t.cache,c=t.descriptor,d=c.oldBusinessObject,u=c.oldDi;if(gc(c))return c.businessObject=_a(l[c.labelTarget]),void(c.di=Ca(l[c.labelTarget]));a=e.create(d.$type),c.businessObject=i.copyElement(d,a),(o=e.create(u.$type)).bpmnElement=a,c.di=i.copyElement(u,o),function(e,t){var i=_a(e);e.default&&(n[e.default]={element:i,property:"default"}),e.host&&(_a(e).attachedToRef=_a(t[e.host])),n=Re(n,ce(n,(function(t,n,a){var o=n.element,s=n.property;return a===e.id&&(o[s]=i,t.push(e.id)),t}),[]))}(c,l),mc(c,a,["isExpanded","name"]),s=c,ee(r="oldBusinessObject")||(r=[r]),le(r,(function(e){s[e]&&delete s[e]}))}))}function gc(e){return!!e.labelTarget}fc.$inject=["bpmnFactory","eventBus","moddleCopy"];var vc=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing"];function bc(e,t,i){this._bpmnFactory=t,this._eventBus=e,this._moddle=i,e.on("moddleCopy.canCopyProperties",(function(e){var t=e.propertyNames;if(t&&t.length)return ye(t,(function(e){return"extensionElements"===e}))})),e.on("moddleCopy.canCopyProperty",(function(e){var t=e.parent,i=te(t)&&t.$descriptor,n=e.propertyName;return(!n||-1===vc.indexOf(n))&&!(n&&i&&!se(i.properties,we({name:n})))&&void 0})),e.on("moddleCopy.canSetCopiedProperty",(function(e){var t,i=e.property;if("bpmn:ExtensionElements",(t=i)&&"function"==typeof t.$instanceOf&&t.$instanceOf("bpmn:ExtensionElements")&&(!i.values||!i.values.length))return!1}))}function yc(e,t){return ce(e.properties,(function(e,i){return t&&i.default?e:e.concat(i.name)}),[])}bc.$inject=["eventBus","bpmnFactory","moddle"],bc.prototype.copyElement=function(e,t,i){var n=this;i&&!ee(i)&&(i=[i]),i=i||yc(e.$descriptor);var a=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:i,sourceElement:e,targetElement:t});return!1===a||(ee(a)&&(i=a),le(i,(function(i){var a;oe(e,i)&&(a=e.get(i));var o=n.copyProperty(a,t,i);!1!==n._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:t,property:o,propertyName:i})&&Q(o)&&t.set(i,o)}))),t},bc.prototype.copyProperty=function(e,t,i){var n=this,a=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:t,property:e,propertyName:i});if(!1!==a){if(a)return te(a)&&a.$type&&!a.$parent&&(a.$parent=t),a;var o=this._moddle.getPropertyDescriptor(t,i);if(!o.isReference){if(o.isId)return this._copyId(e,t);if(ee(e))return ce(e,(function(e,o){return(a=n.copyProperty(o,t,i))?(a.$parent=t,e.concat(a)):e}),[]);if(te(e)&&e.$type){if(this._moddle.getElementDescriptor(e).isGeneric)return;return(a=n._bpmnFactory.create(e.$type)).$parent=t,a=n.copyElement(e,a)}return e}}},bc.prototype._copyId=function(e,t){return this._moddle.ids.assigned(e)?void 0:(this._moddle.ids.claim(e,t),e)};const wc={__depends__:[pc],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",fc],moddleCopy:["type",bc]};var xc=Math.round;function $c(e){this._modeling=e}$c.$inject=["modeling"],$c.prototype.replaceElement=function(e,t,i){if(e.waypoints)return null;var n=this._modeling,a=t.width||e.width,o=t.height||e.height,s=t.x||e.x,r=t.y||e.y,l=xc(s+a/2),c=xc(r+o/2);return n.replaceShape(e,Ae({},t,{x:l,y:c,width:a,height:o}),i)};const _c={__init__:["replace"],replace:["type",$c]};var Cc=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function Ec(e,t,i,n,a,o,s){this.replaceElement=function(r,l,c){c=c||{};var d=l.type,u=r.businessObject;if(Sc(u)&&"bpmn:SubProcess"===d&&function(e,t){var i=e&&oe(e,"collapsed")?e.collapsed:!Ta(e);return i!==(t&&(oe(t,"collapsed")||oe(t,"isExpanded"))?oe(t,"collapsed")?t.collapsed:!t.isExpanded:i)}(r,l))return n.toggleCollapse(r),r;var h=e.create(d),p={type:d,businessObject:h,di:{}};!function(e,t,i){ee(i)||(i=[i]),le(i,(function(i){X(e[i])||(t[i]=e[i])}))}(r.di,p.di,["fill","stroke","background-color","border-color","color"]);var m,f=yc(u.$descriptor),g=yc(h.$descriptor,!0),v=(m=g,f.filter((function(e){return-1!==m.indexOf(e)})));Ae(h,De(l,Cc));var b=re(v,(function(e){return"eventDefinitions"===e?kc(r,l.eventDefinitionType):"loopCharacteristics"===e?!ja(h):!oe(h,e)&&("processRef"!==e||!1!==l.isExpanded)&&"triggeredByEvent"!==e}));return h=i.copyElement(u,h,b),l.eventDefinitionType&&(kc(h,l.eventDefinitionType)||(p.eventDefinitionType=l.eventDefinitionType,p.eventDefinitionAttrs=l.eventDefinitionAttrs)),xa(u,"bpmn:Activity")&&(Sc(u)?p.isExpanded=Ta(r):l&&oe(l,"isExpanded")&&(p.isExpanded=l.isExpanded),Ta(r)&&!xa(u,"bpmn:Task")&&p.isExpanded&&(p.width=r.width,p.height=r.height)),Sc(u)&&!Sc(h)&&(c.moveChildren=!1),xa(u,"bpmn:Participant")&&(!0===l.isExpanded?h.processRef=e.create("bpmn:Process"):c.moveChildren=!1,p.width=r.width,p.height=t.getDefaultSize(p).height),o.allowed("shape.resize",{shape:h})||(p.height=t.getDefaultSize(p).height,p.width=t.getDefaultSize(p).width),h.name=u.name,$a(u,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&$a(h,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(h.default=u.default),l.host&&!xa(u,"bpmn:BoundaryEvent")&&xa(h,"bpmn:BoundaryEvent")&&(p.host=l.host),"bpmn:DataStoreReference"!==p.type&&"bpmn:DataObjectReference"!==p.type||(p.x=r.x+(r.width-p.width)/2),p=a.replaceElement(r,p,c),!1!==c.select&&s.select(p),p}}function Sc(e){return xa(e,"bpmn:SubProcess")}function kc(e,t){var i=_a(e);return t&&i.get("eventDefinitions").some((function(e){return xa(e,t)}))}Ec.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules","selection"];const Ac={__depends__:[wc,_c,Oo],bpmnReplace:["type",Ec]};function Dc(e){return function(t){var i=t.target,n=_a(e),a=n.eventDefinitions&&n.eventDefinitions[0],o=n.$type===i.type,s=(a&&a.$type)===i.eventDefinitionType,r=n.triggeredByEvent===i.triggeredByEvent,l=void 0===i.isExpanded||i.isExpanded===Ta(e);return!(o&&s&&r&&l)}}var Rc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],Pc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],Lc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Intermediate Catch Event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message Intermediate Throw Event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Intermediate Catch Event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Intermediate Throw Event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Intermediate Catch Event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link Intermediate Catch Event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link Intermediate Throw Event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation Intermediate Throw Event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal Intermediate Catch Event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal Intermediate Throw Event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],Vc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message End Event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation End Event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error End Event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel End Event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation End Event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal End Event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],Fc=[{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel Gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive Gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex Gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event based Gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],Ic=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],Bc=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],Tc=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}}],jc=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive Task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Manual Task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business Rule Task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Script Task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call Activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub Process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],Oc=[{label:"Data Store Reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],Mc=[{label:"Data Object Reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],Nc=[{label:"Message Boundary Event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Boundary Event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Boundary Event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Boundary Event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Error Boundary Event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel Boundary Event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Signal Boundary Event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Compensation Boundary Event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],Wc=[{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Error Start Event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Escalation Start Event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Compensation Start Event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],zc=[{label:"Sequence Flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default Flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional Flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],Uc=[{label:"Expanded Pool",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(e){var t="Empty Pool";return e.children&&e.children.length&&(t+=" (removes content)"),t},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}];function qc(e,t,i,n,a,o,s){this._bpmnFactory=e,this._popupMenu=t,this._modeling=i,this._moddle=n,this._bpmnReplace=a,this._rules=o,this._translate=s,this.register()}qc.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate"],qc.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)},qc.prototype.getEntries=function(e){var t,i=e.businessObject;if(!this._rules.allowed("shape.replace",{element:e}))return[];var n=Dc(e);return xa(i,"bpmn:DataObjectReference")?this._createEntries(e,Oc):xa(i,"bpmn:DataStoreReference")&&!xa(e.parent,"bpmn:Collaboration")?this._createEntries(e,Mc):xa(i,"bpmn:StartEvent")&&!xa(i.$parent,"bpmn:SubProcess")?(t=re(Rc,n),this._createEntries(e,t)):xa(i,"bpmn:Participant")?(t=re(Uc,(function(t){return Ta(e)!==t.target.isExpanded})),this._createEntries(e,t)):xa(i,"bpmn:StartEvent")&&ja(i.$parent)?(t=re(Wc,(function(t){var i=!1!==t.target.isInterrupting,a=_a(e).isInterrupting===i;return n(t)||!n(t)&&!a})),this._createEntries(e,t)):xa(i,"bpmn:StartEvent")&&!ja(i.$parent)&&xa(i.$parent,"bpmn:SubProcess")?(t=re(Pc,n),this._createEntries(e,t)):xa(i,"bpmn:EndEvent")?(t=re(Vc,(function(e){return!("bpmn:CancelEventDefinition"==e.target.eventDefinitionType&&!xa(i.$parent,"bpmn:Transaction"))&&n(e)})),this._createEntries(e,t)):xa(i,"bpmn:BoundaryEvent")?(t=re(Nc,(function(e){var t=e.target;if("bpmn:CancelEventDefinition"==t.eventDefinitionType&&!xa(i.attachedToRef,"bpmn:Transaction"))return!1;var a=!1!==t.cancelActivity,o=i.cancelActivity==a;return n(e)||!n(e)&&!o})),this._createEntries(e,t)):xa(i,"bpmn:IntermediateCatchEvent")||xa(i,"bpmn:IntermediateThrowEvent")?(t=re(Lc,n),this._createEntries(e,t)):xa(i,"bpmn:Gateway")?(t=re(Fc,n),this._createEntries(e,t)):xa(i,"bpmn:Transaction")?(t=re(Bc,n),this._createEntries(e,t)):ja(i)&&Ta(e)?(t=re(Tc,n),this._createEntries(e,t)):xa(i,"bpmn:SubProcess")&&Ta(e)?(t=re(Ic,n),this._createEntries(e,t)):xa(i,"bpmn:AdHocSubProcess")&&!Ta(e)?(t=re(jc,(function(t){var i=t.target,n="bpmn:SubProcess"===i.type,a=!0===i.isExpanded;return Dc(e)&&(!n||a)})),this._createEntries(e,t)):xa(i,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,zc):xa(i,"bpmn:FlowNode")?(t=re(jc,n),xa(i,"bpmn:SubProcess")&&!Ta(e)&&(t=re(t,(function(e){return"Sub Process (collapsed)"!==e.label}))),this._createEntries(e,t)):[]},qc.prototype.getHeaderEntries=function(e){var t=[];return xa(e,"bpmn:Activity")&&!ja(e)&&(t=t.concat(this._getLoopEntries(e))),xa(e,"bpmn:DataObjectReference")&&(t=t.concat(this._getDataObjectIsCollection(e))),xa(e,"bpmn:Participant")&&(t=t.concat(this._getParticipantMultiplicity(e))),!xa(e,"bpmn:SubProcess")||xa(e,"bpmn:Transaction")||ja(e)||t.push(this._getAdHocEntry(e)),t},qc.prototype._createEntries=function(e,t){var i=[],n=this;return le(t,(function(t){var a=n._createMenuEntry(t,e);i.push(a)})),i},qc.prototype._createSequenceFlowEntries=function(e,t){var i=_a(e),n=[],a=this._modeling,o=this._moddle,s=this;return le(t,(function(t){switch(t.actionName){case"replace-with-default-flow":i.sourceRef.default!==i&&(xa(i.sourceRef,"bpmn:ExclusiveGateway")||xa(i.sourceRef,"bpmn:InclusiveGateway")||xa(i.sourceRef,"bpmn:ComplexGateway")||xa(i.sourceRef,"bpmn:Activity"))&&n.push(s._createMenuEntry(t,e,(function(){a.updateProperties(e.source,{default:i})})));break;case"replace-with-conditional-flow":!i.conditionExpression&&xa(i.sourceRef,"bpmn:Activity")&&n.push(s._createMenuEntry(t,e,(function(){var t=o.create("bpmn:FormalExpression",{body:""});a.updateProperties(e,{conditionExpression:t})})));break;default:if(xa(i.sourceRef,"bpmn:Activity")&&i.conditionExpression)return n.push(s._createMenuEntry(t,e,(function(){a.updateProperties(e,{conditionExpression:void 0})})));if((xa(i.sourceRef,"bpmn:ExclusiveGateway")||xa(i.sourceRef,"bpmn:InclusiveGateway")||xa(i.sourceRef,"bpmn:ComplexGateway")||xa(i.sourceRef,"bpmn:Activity"))&&i.sourceRef.default===i)return n.push(s._createMenuEntry(t,e,(function(){a.updateProperties(e.source,{default:void 0})})))}})),n},qc.prototype._createMenuEntry=function(e,t,i){var n=this._translate,a=this._bpmnReplace.replaceElement,o=e.label;return o&&"function"==typeof o&&(o=o(t)),i=i||function(){return a(t,e.target)},{label:n(o),className:e.className,id:e.actionName,action:i}},qc.prototype._getLoopEntries=function(e){var t=this,i=this._translate;function n(i,n){var a;n.active?a=void 0:(a=t._moddle.create(n.options.loopCharacteristics),n.options.isSequential&&(a.isSequential=n.options.isSequential)),t._modeling.updateProperties(e,{loopCharacteristics:a})}var a,o,s,r=_a(e).loopCharacteristics;return r&&(a=r.isSequential,o=void 0===r.isSequential,s=void 0!==r.isSequential&&!r.isSequential),[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:i("Parallel Multi Instance"),active:s,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:i("Sequential Multi Instance"),active:a,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:i("Loop"),active:o,action:n,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}]},qc.prototype._getDataObjectIsCollection=function(e){var t=this,i=this._translate,n=e.businessObject.dataObjectRef,a=n.isCollection;return[{id:"toggle-is-collection",className:"bpmn-icon-parallel-mi-marker",title:i("Collection"),active:a,action:function(i,a){t._modeling.updateModdleProperties(e,n,{isCollection:!a.active})}}]},qc.prototype._getParticipantMultiplicity=function(e){var t=this,i=this._bpmnFactory,n=this._translate,a=e.businessObject.participantMultiplicity,o=[{id:"toggle-participant-multiplicity",className:"bpmn-icon-parallel-mi-marker",title:n("Participant Multiplicity"),active:!!a,action:function(n,a){var o;a.active||(o=i.create("bpmn:ParticipantMultiplicity")),t._modeling.updateProperties(e,{participantMultiplicity:o})}}];return o},qc.prototype._getAdHocEntry=function(e){var t=this._translate,i=xa(_a(e),"bpmn:AdHocSubProcess"),n=this._bpmnReplace.replaceElement;return{id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:i,action:function(t,a){return n(e,i?{type:"bpmn:SubProcess"}:{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}}};const Hc={__depends__:[nc,Ac],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",qc]};function Gc(e,t){for("string"==typeof t&&(t=[t]);e=e.parent;)if($a(e,t))return e;return null}var Zc=Math.max,Yc=Math.min;function Kc(e,t){return{top:e.top-t.top,right:e.right-t.right,bottom:e.bottom-t.bottom,left:e.left-t.left}}function Xc(e,t){return{x:e.x+(t.left||0),y:e.y+(t.top||0),width:e.width-(t.left||0)+(t.right||0),height:e.height-(t.top||0)+(t.bottom||0)}}function Qc(e,t,i){var n=t[e],a=i.min&&i.min[e],o=i.max&&i.max[e];return ie(a)&&(n=(/top|left/.test(e)?Yc:Zc)(n,a)),ie(o)&&(n=(/top|left/.test(e)?Zc:Yc)(n,o)),n}function Jc(e,t){return void 0!==e?e:20}function ed(e){return!e.waypoints&&"label"!==e.type}function td(e,t){var i;if((i=void 0===e.length?re(e.children,ed):e).length)return function(e,t){var i,n,a,o;return"object"==typeof t?(i=Jc(t.left),n=Jc(t.right),a=Jc(t.top),o=Jc(t.bottom)):i=n=a=o=Jc(t),{x:e.x-i,y:e.y-a,width:e.width+i+n,height:e.height+a+o}}(Jt(i),t)}var id=Math.abs,nd=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],ad=30;function od(e,t){return t=t||[],e.children.filter((function(e){xa(e,"bpmn:Lane")&&(od(e,t),t.push(e))})),t}function sd(e){return e.children.filter((function(e){return xa(e,"bpmn:Lane")}))}function rd(e){return Gc(e,nd)||e}function ld(e,t,i,n,a,o,s,r,l,c,d,u){e=e||{},n.registerProvider(this),this._contextPad=n,this._modeling=a,this._elementFactory=o,this._connect=s,this._create=r,this._popupMenu=l,this._canvas=c,this._rules=d,this._translate=u,!1!==e.autoPlace&&(this._autoPlace=t.get("autoPlace",!1)),i.on("create.end",250,(function(e){var t=e.context.shape;if(Eo(e)&&n.isOpen(t)){var i=n.getEntries(t);i.replace&&i.replace.action.click(e,t)}}))}function cd(e,t,i){var n=e.$instanceOf(t),a=!1;return le(e.eventDefinitions||[],(function(e){e.$type===i&&(a=!0)})),n&&a}ld.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"],ld.prototype.getContextPadEntries=function(e){var t=this._contextPad,i=this._modeling,n=this._elementFactory,a=this._connect,o=this._create,s=this._popupMenu,r=this._canvas,l=this._rules,c=this._autoPlace,d=this._translate,u={};if("label"===e.type)return u;var h=e.businessObject;function p(e,t){a.start(e,t)}function m(e,t,i,a){function s(t,i){var s=n.createShape(Ae({type:e},a));o.start(t,s,{source:i})}"string"!=typeof i&&(a=i,i=d("Append {type}",{type:e.replace(/^bpmn:/,"")}));var r=c?function(t,i){var o=n.createShape(Ae({type:e},a));c.append(i,o)}:s;return{group:"model",className:t,title:i,action:{dragstart:s,click:r}}}function f(e){return function(n,a){i.splitLane(a,e),t.open(a,!0)}}if($a(h,["bpmn:Lane","bpmn:Participant"])&&Ta(e)){var g=sd(e);Ae(u,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:d("Add Lane above"),action:{click:function(e,t){i.addLane(t,"top")}}}}),g.length<2&&(e.height>=120&&Ae(u,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:d("Divide into two Lanes"),action:{click:f(2)}}}),e.height>=180&&Ae(u,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:d("Divide into three Lanes"),action:{click:f(3)}}})),Ae(u,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:d("Add Lane below"),action:{click:function(e,t){i.addLane(t,"bottom")}}}})}xa(h,"bpmn:FlowNode")&&(xa(h,"bpmn:EventBasedGateway")?Ae(u,{"append.receive-task":m("bpmn:ReceiveTask","bpmn-icon-receive-task",d("Append ReceiveTask")),"append.message-intermediate-event":m("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",d("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":m("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",d("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":m("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",d("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":m("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",d("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):cd(h,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?Ae(u,{"append.compensation-activity":m("bpmn:Task","bpmn-icon-task",d("Append compensation activity"),{isForCompensation:!0})}):xa(h,"bpmn:EndEvent")||h.isForCompensation||cd(h,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||ja(h)||Ae(u,{"append.end-event":m("bpmn:EndEvent","bpmn-icon-end-event-none",d("Append EndEvent")),"append.gateway":m("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",d("Append Gateway")),"append.append-task":m("bpmn:Task","bpmn-icon-task",d("Append Task")),"append.intermediate-event":m("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",d("Append Intermediate/Boundary Event"))})),s.isEmpty(e,"bpmn-replace")||Ae(u,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:d("Change type"),action:{click:function(e,i){var n=Ae(function(e){var i=r.getContainer(),n=t.getPad(e).html,a=i.getBoundingClientRect(),o=n.getBoundingClientRect(),s=o.top-a.top;return{x:o.left-a.left,y:s+o.height+5}}(i),{cursor:{x:e.x,y:e.y}});s.open(i,"bpmn-replace",n)}}}}),$a(h,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&Ae(u,{"append.text-annotation":m("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:d("Connect using "+(h.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:p,dragstart:p}}}),xa(h,"bpmn:TextAnnotation")&&Ae(u,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:d("Connect using Association"),action:{click:p,dragstart:p}}}),$a(h,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&Ae(u,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:d("Connect using DataInputAssociation"),action:{click:p,dragstart:p}}}),xa(h,"bpmn:Group")&&Ae(u,{"append.text-annotation":m("bpmn:TextAnnotation","bpmn-icon-text-annotation")});var v=l.allowed("elements.delete",{elements:[e]});return ee(v)&&(v=v[0]===e),v&&Ae(u,{delete:{group:"edit",className:"bpmn-icon-trash",title:d("Remove"),action:{click:function(t){i.removeElements([e])}}}}),u};const dd={__depends__:[Il,jl,Oo,Sl,Jl,Hc],__init__:["contextPadProvider"],contextPadProvider:["type",ld]};var ud={horizontal:["x","width"],vertical:["y","height"]};function hd(e){this._modeling=e,this._filters=[],this.registerFilter((function(e,t,i){var n,a=0,o=0;return le(e,(function(e){e.waypoints||e.labelTarget||(a+=e[i],o+=1)})),n=Math.round(a/o),re(e,(function(e){return e[i]<n+50}))}))}hd.$inject=["modeling"],hd.prototype.registerFilter=function(e){if("function"!=typeof e)throw new Error("the filter has to be a function");this._filters.push(e)},hd.prototype.trigger=function(e,t){var i,n,a=this._modeling;if(!(e.length<3||(this._setOrientation(t),n=this._filterElements(e),(i=this._createGroups(n)).length<=2)))return a.distributeElements(i,this._axis,this._dimension),i},hd.prototype._filterElements=function(e){var t=this._filters,i=this._axis,n=this._dimension,a=[].concat(e);return t.length?(le(t,(function(e){a=e(a,i,n)})),a):e},hd.prototype._createGroups=function(e){var t=[],i=this,n=this._axis,a=this._dimension;if(!n)throw new Error('must have a defined "axis" and "dimension"');return le(ye(e,n),(function(e,o){var s,r=i._findRange(e,n,a),l=t[t.length-1];l&&i._hasIntersection(l.range,r)?t[t.length-1].elements.push(e):(s={range:r,elements:[e]},t.push(s))})),t},hd.prototype._setOrientation=function(e){var t=ud[e];this._axis=t[0],this._dimension=t[1]},hd.prototype._hasIntersection=function(e,t){return Math.max(e.min,e.max)>=Math.min(t.min,t.max)&&Math.min(e.min,e.max)<=Math.max(t.min,t.max)},hd.prototype._findRange=function(e){var t=e[this._axis];return{min:t+5,max:t+e[this._dimension]-5}};const pd={__init__:["distributeElements"],distributeElements:["type",hd]};function md(e){e.registerFilter((function(e){return re(e,(function(e){var t=$a(e,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:Participant","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(e.labelTarget||t)}))}))}md.$inject=["distributeElements"];const fd={__depends__:[pd],__init__:["bpmnDistributeElements"],bpmnDistributeElements:["type",md]};var gd="is not a registered action";function vd(e,t){this._actions={};var i=this;e.on("diagram.init",(function(){i._registerDefaultActions(t),e.fire("editorActions.init",{editorActions:i})}))}function bd(e,t){return new Error(e+" "+t)}vd.$inject=["eventBus","injector"],vd.prototype._registerDefaultActions=function(e){var t=e.get("commandStack",!1),i=e.get("modeling",!1),n=e.get("selection",!1),a=e.get("zoomScroll",!1),o=e.get("copyPaste",!1),s=e.get("canvas",!1),r=e.get("rules",!1),l=e.get("keyboardMove",!1),c=e.get("keyboardMoveSelection",!1);t&&(this.register("undo",(function(){t.undo()})),this.register("redo",(function(){t.redo()}))),o&&n&&this.register("copy",(function(){var e=n.get();o.copy(e)})),o&&this.register("paste",(function(){o.paste()})),a&&this.register("stepZoom",(function(e){a.stepZoom(e.value)})),s&&this.register("zoom",(function(e){s.zoom(e.value)})),i&&n&&r&&this.register("removeSelection",(function(){var e=n.get();if(e.length){var t,a=r.allowed("elements.delete",{elements:e});!1!==a&&(t=ee(a)?a:e).length&&i.removeElements(t.slice())}})),l&&this.register("moveCanvas",(function(e){l.moveCanvas(e)})),c&&this.register("moveSelection",(function(e){c.moveSelection(e.direction,e.accelerated)}))},vd.prototype.trigger=function(e,t){if(!this._actions[e])throw bd(e,gd);return this._actions[e](t)},vd.prototype.register=function(e,t){var i=this;if("string"==typeof e)return this._registerAction(e,t);le(e,(function(e,t){i._registerAction(t,e)}))},vd.prototype._registerAction=function(e,t){if(this.isRegistered(e))throw bd(e,"is already registered");this._actions[e]=t},vd.prototype.unregister=function(e){if(!this.isRegistered(e))throw bd(e,gd);this._actions[e]=void 0},vd.prototype.getActions=function(){return Object.keys(this._actions)},vd.prototype.isRegistered=function(e){return!!this._actions[e]};const yd={__init__:["editorActions"],editorActions:["type",vd]};function wd(e){e.invoke(vd,this)}U()(wd,vd),wd.$inject=["injector"],wd.prototype._registerDefaultActions=function(e){vd.prototype._registerDefaultActions.call(this,e);var t=e.get("canvas",!1),i=e.get("elementRegistry",!1),n=e.get("selection",!1),a=e.get("spaceTool",!1),o=e.get("lassoTool",!1),s=e.get("handTool",!1),r=e.get("globalConnect",!1),l=e.get("distributeElements",!1),c=e.get("alignElements",!1),d=e.get("directEditing",!1),u=e.get("searchPad",!1),h=e.get("modeling",!1);t&&i&&n&&this._registerAction("selectElements",(function(){var e=t.getRootElement(),a=i.filter((function(t){return t!==e}));return n.select(a),a})),a&&this._registerAction("spaceTool",(function(){a.toggle()})),o&&this._registerAction("lassoTool",(function(){o.toggle()})),s&&this._registerAction("handTool",(function(){s.toggle()})),r&&this._registerAction("globalConnectTool",(function(){r.toggle()})),n&&l&&this._registerAction("distributeElements",(function(e){var t=n.get(),i=e.type;t.length&&l.trigger(t,i)})),n&&c&&this._registerAction("alignElements",(function(e){var t=n.get(),i=[],a=e.type;t.length&&(i=re(t,(function(e){return!xa(e,"bpmn:Lane")})),c.trigger(i,a))})),n&&h&&this._registerAction("setColor",(function(e){var t=n.get();t.length&&h.setColor(t,e)})),n&&d&&this._registerAction("directEditing",(function(){var e=n.get();e.length&&d.activate(e[0])})),u&&this._registerAction("find",(function(){u.toggle()})),t&&h&&this._registerAction("moveToOrigin",(function(){var e,n,a=t.getRootElement();e=Jt(n=xa(a,"bpmn:Collaboration")?i.filter((function(e){return xa(e.parent,"bpmn:Collaboration")})):i.filter((function(e){return e!==a&&!xa(e.parent,"bpmn:SubProcess")}))),h.moveElements(n,{x:-e.x,y:-e.y},a)}))};const xd={__depends__:[yd],editorActions:["type",wd]};function $d(e){e.on(["create.init","shape.move.init"],(function(e){var t=e.context;$a(e.shape,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(t.gridSnappingContext||(t.gridSnappingContext={}),t.gridSnappingContext.snapLocation="top-left")}))}function _d(e,t,i){return i||(i="round"),Math[i](e/t)*t}function Cd(e,t,i){var n=!i||!1!==i.active;this._eventBus=t;var a=this;t.on("diagram.init",800,(function(){a.setActive(n)})),t.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],1200,(function(t){var i=t.originalEvent;if(!(!a.active||i&&gs(i))){var n=t.context,o=n.gridSnappingContext;o||(o=n.gridSnappingContext={}),["x","y"].forEach((function(i){var n={},o=function(e,t,i){var n=e.context,a=e.shape,o=n.gridSnappingContext,s=o.snapLocation,r=o.snapOffset;return r&&ie(r[t])?r[t]:(r||(r=o.snapOffset={}),ie(r[t])||(r[t]=0),a?(i.get(a.id)||(Ed(t)?r[t]+=a[t]+a.width/2:r[t]+=a[t]+a.height/2),s?("x"===t?/left/.test(s)?r[t]-=a.width/2:/right/.test(s)&&(r[t]+=a.width/2):/top/.test(s)?r[t]-=a.height/2:/bottom/.test(s)&&(r[t]+=a.height/2),r[t]):r[t]):r[t])}(t,i,e);o&&(n.offset=o);var s=function(e,t){var i=e.context,n=i.createConstraints,a=i.resizeConstraints||{},o=i.gridSnappingContext,s=o.snapConstraints;if(s&&s[t])return s[t];s||(s=o.snapConstraints={}),s[t]||(s[t]={});var r=i.direction;n&&(Ed(t)?(s.x.min=n.left,s.x.max=n.right):(s.y.min=n.top,s.y.max=n.bottom));var l=a.min,c=a.max;return l&&(Ed(t)?kd(r)?s.x.max=l.left:s.x.min=l.right:Sd(r)?s.y.max=l.top:s.y.min=l.bottom),c&&(Ed(t)?kd(r)?s.x.min=c.left:s.x.max=c.right:Sd(r)?s.y.min=c.top:s.y.max=c.bottom),s[t]}(t,i);s&&Ae(n,s),ml(t,i)||a.snapEvent(t,i,n)}))}}))}function Ed(e){return"x"===e}function Sd(e){return-1!==e.indexOf("n")}function kd(e){return-1!==e.indexOf("w")}function Ad(e,t){Yo.call(this,e),this._gridSnapping=t;var i=this;this.preExecute("shape.resize",(function(e){var t=e.context,n=(t.hints||{}).autoResize;if(n){var a=t.shape,o=t.newBounds;ae(n)?t.newBounds=i.snapComplex(o,n):t.newBounds=i.snapSimple(a,o)}}))}function Dd(e,t){e.on(["spaceTool.move","spaceTool.end"],2e3,(function(e){var i,n=e.context;n.initialized&&("x"===n.axis?(i=t.snapValue(e.dx),e.x=e.x+i-e.dx,e.dx=i):(i=t.snapValue(e.dy),e.y=e.y+i-e.dy,e.dy=i))}))}$d.$inject=["eventBus"],Cd.prototype.snapEvent=function(e,t,i){fl(e,t,this.snapValue(e[t],i))},Cd.prototype.getGridSpacing=function(){return 10},Cd.prototype.snapValue=function(e,t){var i,n,a=0;return t&&t.offset&&(a=t.offset),e=_d(e+=a,10),t&&t.min&&ie(i=t.min)&&(i=_d(i+a,10,"ceil"),e=Math.max(e,i)),t&&t.max&&ie(n=t.max)&&(n=_d(n+a,10,"floor"),e=Math.min(e,n)),e-a},Cd.prototype.isActive=function(){return this.active},Cd.prototype.setActive=function(e){this.active=e,this._eventBus.fire("gridSnapping.toggle",{active:e})},Cd.prototype.toggleActive=function(){this.setActive(!this.active)},Cd.$inject=["elementRegistry","eventBus","config.gridSnapping"],Ad.$inject=["eventBus","gridSnapping","modeling"],zt()(Ad,Yo),Ad.prototype.snapSimple=function(e,t){var i=this._gridSnapping;return t.width=i.snapValue(t.width,{min:t.width}),t.height=i.snapValue(t.height,{min:t.height}),t.x=e.x+e.width/2-t.width/2,t.y=e.y+e.height/2-t.height/2,t},Ad.prototype.snapComplex=function(e,t){return/w|e/.test(t)&&(e=this.snapHorizontally(e,t)),/n|s/.test(t)&&(e=this.snapVertically(e,t)),e},Ad.prototype.snapHorizontally=function(e,t){var i=this._gridSnapping,n=/w/.test(t),a=/e/.test(t),o={};return o.width=i.snapValue(e.width,{min:e.width}),a&&(n?(o.x=i.snapValue(e.x,{max:e.x}),o.width+=i.snapValue(e.x-o.x,{min:e.x-o.x})):e.x=e.x+e.width-o.width),Ae(e,o),e},Ad.prototype.snapVertically=function(e,t){var i=this._gridSnapping,n=/n/.test(t),a=/s/.test(t),o={};return o.height=i.snapValue(e.height,{min:e.height}),n&&(a?(o.y=i.snapValue(e.y,{max:e.y}),o.height+=i.snapValue(e.y-o.y,{min:e.y-o.y})):e.y=e.y+e.height-o.height),Ae(e,o),e},Dd.$inject=["eventBus","gridSnapping"];const Rd={__depends__:[{__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",Ad],gridSnappingSpaceToolBehavior:["type",Dd]}],__init__:["gridSnapping"],gridSnapping:["type",Cd]};function Pd(e,t){e.on("autoPlace",2e3,(function(e){var i=e.source,n=yi(i),a=e.shape,o=mr(i,a);return["x","y"].forEach((function(e){var i={};o[e]!==n[e]&&(o[e]>n[e]?i.min=o[e]:i.max=o[e],xa(a,"bpmn:TextAnnotation")&&(function(e){return"x"===e}(e)?i.offset=-a.width/2:i.offset=-a.height/2),o[e]=t.snapValue(o[e],i))})),o}))}function Ld(e,t,i){t.on(["create.start","shape.move.start"],1750,(function(t){var n=t.context,a=n.shape,o=e.getRootElement();xa(a,"bpmn:Participant")&&xa(o,"bpmn:Process")&&o.children.length&&n.createConstraints&&(a.width=i.snapValue(a.width,{min:a.width}),a.height=i.snapValue(a.height,{min:a.height}))}))}function Vd(e,t,i){Yo.call(this,e),this._gridSnapping=t;var n=this;this.postExecuted(["connection.create","connection.layout"],3e3,(function(e){var t=e.context,a=t.connection,o=t.hints||{},s=a.waypoints;o.connectionStart||o.connectionEnd||!1===o.createElementsBehavior||function(e){return e.length>3}(s)&&i.updateWaypoints(a,n.snapMiddleSegments(s))}))}function Fd(e,t,i){var n=di(t,i),a={};return function(e){return"h"===e}(n)&&(a.y=e.snapValue(t.y)),function(e){return"v"===e}(n)&&(a.x=e.snapValue(t.x)),("x"in a||"y"in a)&&(t=Ae({},t,a),i=Ae({},i,a)),[t,i]}Pd.$inject=["eventBus","gridSnapping"],Ld.$inject=["canvas","eventBus","gridSnapping"],Vd.$inject=["eventBus","gridSnapping","modeling"],U()(Vd,Yo),Vd.prototype.snapMiddleSegments=function(e){var t,i=this._gridSnapping;e=e.slice();for(var n=1;n<e.length-2;n++)t=Fd(i,e[n],e[n+1]),e[n]=t[0],e[n+1]=t[1];return e};const Id={__depends__:[Rd,{__init__:["gridSnappingAutoPlaceBehavior","gridSnappingCreateParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",Pd],gridSnappingCreateParticipantBehavior:["type",Ld],gridSnappingLayoutConnectionBehavior:["type",Vd]}],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",$d]};function Bd(e,t){this._interactionEvents=t;var i=this;e.on(["interactionEvents.createHit","interactionEvents.updateHit"],(function(e){var t=e.element,n=e.gfx;return xa(t,"bpmn:Lane")?i.createParticipantHit(t,n):xa(t,"bpmn:Participant")?Ta(t)?i.createParticipantHit(t,n):i.createDefaultHit(t,n):xa(t,"bpmn:SubProcess")?Ta(t)?i.createSubProcessHit(t,n):i.createDefaultHit(t,n):void 0}))}Bd.$inject=["eventBus","interactionEvents"],Bd.prototype.createDefaultHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createDefaultHit(e,t),!0},Bd.prototype.createParticipantHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:30,height:e.height}),!0},Bd.prototype.createSubProcessHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:e.width,height:30}),!0};const Td={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",Bd]};function jd(e){e.invoke(Es,this)}U()(jd,Es),jd.$inject=["injector"],jd.prototype.registerBindings=function(e,t){function i(i,n){t.isRegistered(i)&&e.addListener(n)}Es.prototype.registerBindings.call(this,e,t),i("selectElements",(function(i){var n=i.keyEvent;if(e.isKey(["a","A"],n)&&e.isCmd(n))return t.trigger("selectElements"),!0})),i("find",(function(i){var n=i.keyEvent;if(e.isKey(["f","F"],n)&&e.isCmd(n))return t.trigger("find"),!0})),i("spaceTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["s","S"],n)?(t.trigger("spaceTool"),!0):void 0})),i("lassoTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["l","L"],n)?(t.trigger("lassoTool"),!0):void 0})),i("handTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["h","H"],n)?(t.trigger("handTool"),!0):void 0})),i("globalConnectTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["c","C"],n)?(t.trigger("globalConnectTool"),!0):void 0})),i("directEditing",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["e","E"],n)?(t.trigger("directEditing"),!0):void 0}))};const Od={__depends__:[Ss],__init__:["keyboardBindings"],keyboardBindings:["type",jd]};var Md={moveSpeed:1,moveSpeedAccelerated:10},Nd="left",Wd="right",zd="down",Ud={ArrowLeft:Nd,Left:Nd,ArrowUp:"up",Up:"up",ArrowRight:Wd,Right:Wd,ArrowDown:zd,Down:zd},qd={left:function(e){return{x:-e,y:0}},up:function(e){return{x:0,y:-e}},right:function(e){return{x:e,y:0}},down:function(e){return{x:0,y:e}}};function Hd(e,t,i,n,a){var o=this;this._config=Ae({},Md,e||{}),t.addListener(1500,(function(e){var i=e.keyEvent,n=Ud[i.key];if(n&&!t.isCmd(i)){var a=t.isShift(i);return o.moveSelection(n,a),!0}})),this.moveSelection=function(e,t){var o=a.get();if(o.length){var s=this._config[t?"moveSpeedAccelerated":"moveSpeed"],r=qd[e](s);n.allowed("elements.move",{shapes:o})&&i.moveElements(o,r)}}}Hd.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const Gd={__depends__:[Ss,Oo],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",Hd]};function Zd(e,t,i,n){this._dragging=n,this._rules=t;var a=this;e.on("resize.start",(function(e){var t,i,n;i=(t=e.context).resizeConstraints,n=t.minBounds,void 0===i&&(void 0===n&&(n=a.computeMinResizeBox(t)),t.resizeConstraints={min:vi(n)})})),e.on("resize.move",(function(e){var t={x:e.dx,y:e.dy};!function(e,t){var i,n=e.shape,o=e.direction,s=e.resizeConstraints;e.delta=t,i=function(e,t,i){var n=i.x,a=i.y,o={x:e.x,y:e.y,width:e.width,height:e.height};return-1!==t.indexOf("n")?(o.y=e.y+a,o.height=e.height-a):-1!==t.indexOf("s")&&(o.height=e.height+a),-1!==t.indexOf("e")?o.width=e.width+n:-1!==t.indexOf("w")&&(o.x=e.x+n,o.width=e.width-n),o}(n,o,t),e.newBounds=function(e,t){if(!t)return e;var i=vi(e);return bi({top:Qc("top",i,t),right:Qc("right",i,t),bottom:Qc("bottom",i,t),left:Qc("left",i,t)})}(i,s),e.canExecute=a.canResize(e)}(e.context,t)})),e.on("resize.end",(function(e){!function(e){var t=e.shape,n=e.canExecute,a=e.newBounds;if(n){if(!function(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}(t,a=fi(a)))return;i.resizeShape(t,a)}}(e.context)}))}function Yd(e,t){var i=yi(e),n=vi(e),a={x:i.x,y:i.y};return-1!==t.indexOf("n")?a.y=n.top:-1!==t.indexOf("s")&&(a.y=n.bottom),-1!==t.indexOf("e")?a.x=n.right:-1!==t.indexOf("w")&&(a.x=n.left),a}function Kd(e){return"n"===e||"s"===e?"resize-ns":"e"===e||"w"===e?"resize-ew":"nw"===e||"se"===e?"resize-nwse":"resize-nesw"}Zd.prototype.canResize=function(e){var t=this._rules,i=De(e,["newBounds","shape","delta","direction"]);return t.allowed("shape.resize",i)},Zd.prototype.activate=function(e,t,i){var n,a,o=this._dragging;if("string"==typeof i&&(i={direction:i}),!(a=(n=Ae({shape:t},i)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");o.init(e,Yd(t,a),"resize",{autoActivate:!0,cursor:Kd(a),data:{shape:t,context:n}})},Zd.prototype.computeMinResizeBox=function(e){var t,i,n,a,o,s,r,l=e.shape;return t=e.direction,i=l,n=e.minDimensions||{width:10,height:10},a=td(l,e.childrenBoxPadding),o=vi(i),s={top:/n/.test(t)?o.bottom-n.height:o.top,left:/w/.test(t)?o.right-n.width:o.left,bottom:/s/.test(t)?o.top+n.height:o.bottom,right:/e/.test(t)?o.left+n.width:o.right},r=a?vi(a):s,bi({top:Yc(s.top,r.top),left:Yc(s.left,r.left),bottom:Zc(s.bottom,r.bottom),right:Zc(s.right,r.right)})},Zd.$inject=["eventBus","rules","modeling","dragging"];var Xd="djs-resizing",Qd="resize-not-ok";function Jd(e,t,i){e.on("resize.move",500,(function(e){var n,a,o,s;a=(n=e.context).shape,o=n.newBounds,(s=n.frame)||(s=n.frame=i.addFrame(a,t.getActiveLayer()),t.addMarker(a,Xd)),o.width>5&&rt(s,{x:o.x,width:o.width}),o.height>5&&rt(s,{y:o.y,height:o.height}),n.canExecute?ht(s).remove(Qd):ht(s).add(Qd)})),e.on("resize.cleanup",(function(e){var i,n;n=(i=e.context).shape,i.frame&&mt(i.frame),t.removeMarker(n,Xd)}))}Jd.$inject=["eventBus","canvas","previewSupport"];var eu=["n","w","s","e","nw","ne","se","sw"];function tu(e,t,i,n){this._resize=n,this._canvas=t;var a=this;e.on("selection.changed",(function(e){var t=e.newSelection;a.removeResizers(),1===t.length&&le(t,Se(a.addResizer,a))})),e.on("shape.changed",(function(e){var t=e.element;i.isSelected(t)&&(a.removeResizers(),a.addResizer(t))}))}tu.prototype.makeDraggable=function(e,t,i){var n=this._resize;function a(t){Co(t)&&n.activate(t,e,i)}Ge.bind(t,"mousedown",a),Ge.bind(t,"touchstart",a)},tu.prototype._createResizer=function(e,t,i,n){var a=this._getResizersParent(),o=function(e){var t={x:0,y:0};return-1!==e.indexOf("e")?t.x=6:-1!==e.indexOf("w")&&(t.x=-6),-1!==e.indexOf("s")?t.y=6:-1!==e.indexOf("n")&&(t.y=-6),t}(n),s=wt("g");ht(s).add("djs-resizer"),ht(s).add("djs-resizer-"+e.id),ht(s).add("djs-resizer-"+n),at(a,s);var r=wt("rect");rt(r,{x:-2+o.x,y:-2+o.y,width:4,height:4}),ht(r).add("djs-resizer-visual"),at(s,r);var l=wt("rect");return rt(l,{x:-10+o.x,y:-10+o.y,width:20,height:20}),ht(l).add("djs-resizer-hit"),at(s,l),Zi(s,t,i),s},tu.prototype.createResizer=function(e,t){var i=Yd(e,t),n=this._createResizer(e,i.x,i.y,t);this.makeDraggable(e,n,t)},tu.prototype.addResizer=function(e){var t=this;this._resize.canResize({shape:e})&&le(eu,(function(i){t.createResizer(e,i)}))},tu.prototype.removeResizers=function(){ft(this._getResizersParent())},tu.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},tu.$inject=["eventBus","canvas","selection","resize"];const iu={__depends__:[Fr,Rr,Wl],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Zd],resizePreview:["type",Jd],resizeHandles:["type",tu]};function nu(e,t){var i=t.create("bpmn:CategoryValue"),n=t.create("bpmn:Category",{categoryValue:[i]});return si(e.get("rootElements"),n),_a(n).$parent=e,_a(i).$parent=n,i}function au(e,t,i,n,a,o,s){function r(e,t){(t||$a(e,["bpmn:Task","bpmn:TextAnnotation"])||ou(e))&&n.activate(e)}this._bpmnFactory=t,this._canvas=i,this._modeling=a,this._textRenderer=s,n.registerProvider(this),e.on("element.dblclick",(function(e){r(e.element,!0)})),e.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set"],(function(e){n.isActive()&&n.complete()})),e.on(["commandStack.changed"],(function(e){n.isActive()&&n.cancel()})),e.on("directEditing.activate",(function(e){o.removeResizers()})),e.on("create.end",500,(function(e){var t=e.context,i=t.shape,n=e.context.canExecute;e.isTouch||n&&(t.hints&&!1===t.hints.createElementsBehavior||r(i))})),e.on("autoPlace.end",500,(function(e){r(e.shape)}))}function ou(e){return xa(e,"bpmn:SubProcess")&&!Ta(e)}au.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"],au.prototype.activate=function(e){var t=Na(e);if(void 0!==t){var i={text:t};Ae(i,this.getEditingBBox(e));var n={};return($a(e,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||ou(e))&&Ae(n,{centerVertically:!0}),co(e)&&Ae(n,{autoResize:!0}),xa(e,"bpmn:TextAnnotation")&&Ae(n,{resizable:!0,autoResize:!0}),Ae(i,{options:n}),i}},au.prototype.getEditingBBox=function(e){var t=this._canvas,i=e.label||e,n=t.getAbsoluteBBox(i),a=n.x+n.width/2,o=n.y+n.height/2,s={x:n.x,y:n.y},r=t.zoom(),l=this._textRenderer.getDefaultStyle(),c=this._textRenderer.getExternalStyle(),d=c.fontSize*r,u=c.lineHeight,h=l.fontSize*r,p=l.lineHeight,m={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};(xa(e,"bpmn:Lane")||function(e){return xa(e,"bpmn:Participant")&&Ta(e)}(e))&&(Ae(s,{width:n.height,height:30*r,x:n.x-n.height/2+15*r,y:o-30*r/2}),Ae(m,{fontSize:h+"px",lineHeight:p,paddingTop:7*r+"px",paddingBottom:7*r+"px",paddingLeft:5*r+"px",paddingRight:5*r+"px",transform:"rotate(-90deg)"})),($a(e,["bpmn:Task","bpmn:CallActivity"])||function(e){return xa(e,"bpmn:Participant")&&!Ta(e)}(e)||ou(e))&&(Ae(s,{width:n.width,height:n.height}),Ae(m,{fontSize:h+"px",lineHeight:p,paddingTop:7*r+"px",paddingBottom:7*r+"px",paddingLeft:5*r+"px",paddingRight:5*r+"px"})),function(e){return xa(e,"bpmn:SubProcess")&&Ta(e)}(e)&&(Ae(s,{width:n.width,x:n.x}),Ae(m,{fontSize:h+"px",lineHeight:p,paddingTop:7*r+"px",paddingBottom:7*r+"px",paddingLeft:5*r+"px",paddingRight:5*r+"px"}));var f=90*r,g=7*r,v=4*r;if(i.labelTarget&&(Ae(s,{width:f,height:n.height+g+v,x:a-f/2,y:n.y-g}),Ae(m,{fontSize:d+"px",lineHeight:u,paddingTop:g+"px",paddingBottom:v+"px"})),co(i)&&!uo(i)&&!po(i)){var b=ho(e),y=t.getAbsoluteBBox({x:b.x,y:b.y,width:0,height:0}),w=d+g+v;Ae(s,{width:f,height:w,x:y.x-f/2,y:y.y-w/2}),Ae(m,{fontSize:d+"px",lineHeight:u,paddingTop:g+"px",paddingBottom:v+"px"})}return xa(e,"bpmn:TextAnnotation")&&(Ae(s,{width:n.width,height:n.height,minWidth:30*r,minHeight:10*r}),Ae(m,{textAlign:"left",paddingTop:5*r+"px",paddingBottom:7*r+"px",paddingLeft:7*r+"px",paddingRight:5*r+"px",fontSize:h+"px",lineHeight:p})),{bounds:s,style:m}},au.prototype.update=function(e,t,i,n){var a,o,s;if(xa(e,"bpmn:TextAnnotation")&&(o=this._canvas.getAbsoluteBBox(e),a={x:e.x,y:e.y,width:e.width/o.width*n.width,height:e.height/o.height*n.height}),xa(e,"bpmn:Group")&&!_a(e).categoryValueRef){var r=nu(_a(this._canvas.getRootElement()).$parent,this._bpmnFactory);_a(e).categoryValueRef=r}(s=t)&&s.trim()||(t=null),this._modeling.updateLabel(e,t,a)};var su="djs-element-hidden",ru="djs-label-hidden";function lu(e,t,i,n){var a,o,s,r=this,l=t.getDefaultLayer();e.on("directEditing.activate",(function(e){var i=e.active;if(xa(a=i.element.label||i.element,"bpmn:TextAnnotation")){o=t.getAbsoluteBBox(a),s=wt("g");var c=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:a.width,containerHeight:a.height,position:{mx:0,my:0}}),d=r.path=wt("path");rt(d,{d:c,strokeWidth:2,stroke:cu(a)}),at(s,d),at(l,s),Yi(s,a.x,a.y)}xa(a,"bpmn:TextAnnotation")||a.labelTarget?t.addMarker(a,su):(xa(a,"bpmn:Task")||xa(a,"bpmn:CallActivity")||xa(a,"bpmn:SubProcess")||xa(a,"bpmn:Participant"))&&t.addMarker(a,ru)})),e.on("directEditing.resize",(function(e){if(xa(a,"bpmn:TextAnnotation")){var t=e.height,i=e.dy,s=Math.max(a.height/o.height*(t+i),0),l=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:a.width,containerHeight:s,position:{mx:0,my:0}});rt(r.path,{d:l})}})),e.on(["directEditing.complete","directEditing.cancel"],(function(e){var i=e.active;i&&(t.removeMarker(i.element.label||i.element,su),t.removeMarker(a,ru)),a=void 0,o=void 0,s&&(mt(s),s=void 0)}))}function cu(e,t){return Ca(e).get("stroke")||t||"black"}lu.$inject=["eventBus","canvas","elementRegistry","pathMap"];const du={__depends__:[Zo,iu,Il],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",au],labelEditingPreview:["type",lu]};var uu=["top","bottom","left","right"];function hu(e,t){function i(e){if(uo(e)){var i=function(e){var t=yi(e.label),i=pu(yi(e),t);if(n=i,-1!==uu.indexOf(n)){var n,a=function(e){var t=yi(e);return[].concat(e.incoming.map((function(e){return e.waypoints[e.waypoints.length-2]})),e.outgoing.map((function(e){return e.waypoints[1]}))).map((function(e){return pu(t,e)}))}(e);if(e.host){var o=function(e){var t,i=e.host,n=wi(yi(e),i);return t=n.indexOf("-")>=0?n.split("-"):[n],uu.filter((function(e){return-1===t.indexOf(e)}))}(e);a=a.concat(o)}var s=uu.filter((function(e){return-1===a.indexOf(e)}));if(-1===s.indexOf(i))return s[0]}}(e);i&&function(e,i){var n=yi(e),a=e.label,o=yi(a);if(a.parent){var s,r=vi(e);switch(i){case"top":s={x:n.x,y:r.top-10-a.height/2};break;case"left":s={x:r.left-10-a.width/2,y:n.y};break;case"bottom":s={x:n.x,y:r.bottom+10+a.height/2};break;case"right":s={x:r.right+10+a.width/2,y:n.y}}var l=Is(s,o);t.moveShape(a,l)}}(e,i)}}Yo.call(this,e),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],(function(e){var t=e.context,n=t.connection,a=n.source,o=n.target;!1!==(t.hints||{}).createElementsBehavior&&(i(a),i(o))})),this.postExecuted(["label.create"],(function(e){var t=e.context,n=t.shape;!1!==(t.hints||{}).createElementsBehavior&&i(n.labelTarget)})),this.postExecuted(["elements.create"],(function(e){var t=e.context,n=t.elements;!1!==(t.hints||{}).createElementsBehavior&&n.forEach((function(e){i(e)}))}))}function pu(e,t){return wi(t,e,5)}function mu(e,t,i){Yo.call(this,e),this.preExecute("shape.append",(function(e){var t=e.source,i=e.shape;e.position||(xa(i,"bpmn:TextAnnotation")?e.position={x:t.x+t.width/2+75,y:t.y-50-i.height/2}:e.position={x:t.x+t.width+80+i.width/2,y:t.y+t.height/2})}),!0)}function fu(e,t){e.invoke(Yo,this),this.postExecute("shape.move",(function(e){var i=e.newParent,n=e.shape;le(re(n.incoming.concat(n.outgoing),(function(e){return xa(e,"bpmn:Association")})),(function(e){t.moveConnection(e,{x:0,y:0},i)}))}),!0)}function gu(e,t){t.invoke(Yo,this),this._bpmnReplace=e;var i=this;this.postExecuted("elements.create",500,(function(e){var t=e.elements;1===(t=t.filter((function(e){return vu(e,e.host)}))).length&&t.map((function(e){return t.indexOf(e)})).forEach((function(n){var a=t[n];e.elements[n]=i.replaceShape(t[n],a)}))}),!0),this.preExecute("elements.move",500,(function(e){var t=e.shapes,n=e.newHost;if(1===t.length){var a=t[0];vu(a,n)&&(e.shapes=[i.replaceShape(a,n)])}}),!0)}function vu(e,t){return!po(e)&&$a(e,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!t}function bu(e,t,i){function n(e){return re(e.attachers,(function(e){return xa(e,"bpmn:BoundaryEvent")}))}Yo.call(this,e),this.postExecute("connection.create",(function(e){var t=e.context.source,a=e.context.target,o=n(a);xa(t,"bpmn:EventBasedGateway")&&xa(a,"bpmn:ReceiveTask")&&o.length>0&&i.removeElements(o)})),this.postExecute("connection.reconnect",(function(e){var t=e.context.oldSource,a=e.context.newSource;xa(t,"bpmn:Gateway")&&xa(a,"bpmn:EventBasedGateway")&&le(a.outgoing,(function(e){var t=e.target,a=n(t);xa(t,"bpmn:ReceiveTask")&&a.length>0&&i.removeElements(a)}))})),e.on("moddleCopy.canCopyProperty",2e3,(function(e){var i=e.parent,n=e.property,a=e.propertyName,o=t.getPropertyDescriptor(i,a);o&&o.isReference&&xa(n,"bpmn:RootElement")&&i.set(a,n)}))}function yu(e){e.invoke(Yo,this),this.preExecute("shape.create",1500,(function(e){var t=e.context,i=t.parent,n=t.shape;xa(i,"bpmn:Lane")&&!xa(n,"bpmn:Lane")&&(t.parent=Gc(i,"bpmn:Participant"))}))}function wu(e,t,i){Yo.call(this,e),this.preExecute("shape.create",(function(e){var i=e.context.shape;if(xa(i,"bpmn:DataObjectReference")&&"label"!==i.type){var n=t.create("bpmn:DataObject");i.businessObject.dataObjectRef=n}}))}U()(hu,Yo),hu.$inject=["eventBus","modeling"],U()(mu,Yo),mu.$inject=["eventBus","elementFactory","bpmnRules"],U()(fu,Yo),fu.$inject=["injector","modeling"],gu.$inject=["bpmnReplace","injector"],U()(gu,Yo),gu.prototype.replaceShape=function(e,t){var i,n=(i=_a(e).eventDefinitions)&&i[0],a={type:"bpmn:BoundaryEvent",host:t};return n&&(a.eventDefinitionType=n.$type),this._bpmnReplace.replaceElement(e,a,{layoutConnection:!1})},bu.$inject=["eventBus","moddle","modeling"],U()(bu,Yo),yu.$inject=["injector"],U()(yu,Yo),wu.$inject=["eventBus","bpmnFactory","moddle"],U()(wu,Yo);var xu=2e3;function $u(e,t,i){function n(){var t=e.getRootElement();return xa(t,"bpmn:Collaboration")?t:i.makeCollaboration()}Yo.call(this,t),t.on(["create.start","shape.move.start"],xu,(function(t){var i=t.context,n=i.shape,a=e.getRootElement();if(xa(n,"bpmn:Participant")&&xa(a,"bpmn:Process")&&a.children.length){var o=a.children.filter((function(e){return!xa(e,"bpmn:Group")&&!po(e)&&!function(e){return!!e.waypoints}(e)}));if(o.length){var s=Jt(o),r=function(e,t){t={width:t.width+40+30,height:t.height+40};var i=Math.max(e.width,t.width),n=Math.max(e.height,t.height);return{x:-i/2,y:-n/2,width:i,height:n}}(n,s);Ae(n,r),i.createConstraints=function(e,t){return{bottom:(t=vi(t)).top+e.height/2-20,left:t.right-e.width/2+20,top:t.bottom-e.height/2+20,right:t.left+e.width/2-20-30}}(n,s)}}})),t.on("create.start",xu,(function(i){var n=i.context.shape,a=e.getRootElement(),o=e.getGraphics(a);function s(e){e.element=a,e.gfx=o}xa(n,"bpmn:Participant")&&xa(a,"bpmn:Process")&&(t.on("element.hover",xu,s),t.once("create.cleanup",(function(){t.off("element.hover",s)})))})),this.preExecute("elements.create",xu,(function(e){var t,i=e.elements,a=e.parent,o=function(e){return se(e,(function(e){return xa(e,"bpmn:Participant")}))}(i);o&&xa(a,"bpmn:Process")&&(e.parent=n(),(t=e.hints=e.hints||{}).participant=o,t.process=a,t.processRef=_a(o).get("processRef"))}),!0),this.preExecute("shape.create",(function(e){var t=e.parent,i=e.shape;xa(i,"bpmn:Participant")&&xa(t,"bpmn:Process")&&(e.parent=n(),e.process=t,e.processRef=_a(i).get("processRef"))}),!0),this.execute("shape.create",(function(e){var t=e.hints||{},i=e.process||t.process,n=e.shape,a=t.participant;!i||a&&n!==a||_a(n).set("processRef",_a(i))}),!0),this.revert("shape.create",(function(e){var t=e.hints||{},i=e.process||t.process,n=e.processRef||t.processRef,a=e.shape,o=t.participant;!i||o&&a!==o||_a(a).set("processRef",n)}),!0),this.postExecute("shape.create",(function(e){var t=e.hints||{},n=e.process||e.hints.process,a=e.shape,o=t.participant;if(n){var s=n.children.slice();o?a===o&&i.moveElements(s,{x:0,y:0},o):i.moveElements(s,{x:0,y:0},a)}}),!0)}$u.$inject=["canvas","eventBus","modeling"],U()($u,Yo);var _u="__targetRef_placeholder";function Cu(e,t){function i(e,i){var n=e.get("properties"),a=se(n,(function(e){return e.name===_u}));return!a&&i&&si(n,a=t.create("bpmn:Property",{name:_u})),a}function n(e,t){var n=i(e);n&&(function(e,t,i){return se(e.get("dataInputAssociations"),(function(e){return e!==i&&e.targetRef===t}))}(e,n,t)||oi(e.get("properties"),n))}function a(e){var t,a=e.context,o=a.connection,s=o.businessObject,r=o.target,l=r&&r.businessObject,c=a.newTarget,d=c&&c.businessObject,u=a.oldTarget||a.target,h=u&&u.businessObject,p=o.businessObject;h&&h!==l&&n(h,s),d&&d!==l&&n(d,s),l?(t=i(l,!0),p.targetRef=t):p.targetRef=null}Yo.call(this,e),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],Eu(a)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],Eu(a))}function Eu(e){return function(t){if(xa(t.context.connection,"bpmn:DataInputAssociation"))return e(t)}}function Su(e){this._bpmnUpdater=e}function ku(e,t,i,n){function a(e){return e.children.filter((function(e){return xa(e,"bpmn:DataStoreReference")&&!e.labelTarget}))}function o(e,n){var a=e.businessObject||e;if(n=n||i.filter((function(e){return xa(e,"bpmn:Participant")&&_a(e).processRef}))[0]){var o=n.businessObject||n;t.execute("dataStore.updateContainment",{dataStoreBo:a,dataStoreDi:Ca(e),newSemanticParent:o.processRef||o,newDiParent:Ca(n)})}}Yo.call(this,n),t.registerHandler("dataStore.updateContainment",Su),this.preExecute("shape.create",(function(e){var t=e.context,i=t.shape;xa(i,"bpmn:DataStoreReference")&&"label"!==i.type&&(t.hints||(t.hints={}),t.hints.autoResize=!1)})),this.preExecute("elements.move",(function(e){var t=e.context,i=t.shapes;i.filter((function(e){return xa(e,"bpmn:DataStoreReference")})).length&&(t.hints||(t.hints={}),t.hints.autoResize=i.filter((function(e){return!xa(e,"bpmn:DataStoreReference")})))})),this.postExecute("shape.create",(function(e){var t=e.context.shape,i=t.parent;xa(t,"bpmn:DataStoreReference")&&"label"!==t.type&&xa(i,"bpmn:Collaboration")&&o(t)})),this.postExecute("shape.move",(function(e){var t=e.context,i=t.shape,n=t.oldParent,a=i.parent;xa(n,"bpmn:Collaboration")||xa(i,"bpmn:DataStoreReference")&&"label"!==i.type&&xa(a,"bpmn:Collaboration")&&o(i,xa(n,"bpmn:Participant")?n:function(e,t){for(;e.parent;){if(xa(e.parent,"bpmn:Participant"))return e.parent;e=e.parent}}(n))})),this.postExecute("shape.delete",(function(t){var i=t.context.shape,n=e.getRootElement();$a(i,["bpmn:Participant","bpmn:SubProcess"])&&xa(n,"bpmn:Collaboration")&&a(n).filter((function(e){return function(e,t){for(var i=e.businessObject||e,n=t.businessObject||t;i.$parent;){if(i.$parent===n.processRef||n)return!0;i=i.$parent}return!1}(e,i)})).forEach((function(e){o(e)}))})),this.postExecute("canvas.updateRoot",(function(e){var t=e.context,i=t.oldRoot,n=t.newRoot;a(i).forEach((function(e){xa(n,"bpmn:Process")&&o(e,n)}))}))}function Au(e,t,i){Yo.call(this,e),this.postExecuted("shape.delete",500,(function(e){var t=e.context,n=t.hints,a=t.shape,o=t.oldParent;xa(a,"bpmn:Lane")&&(n&&n.nested||function(e,t){var n,a,o,s=sd(t),r=[],l=[];Xt(s,(function(t){return t.y>e.y?l.push(t):r.push(t),t.children})),s.length&&(n=l.length&&r.length?e.height/2:e.height,r.length&&(a=i.calculateAdjustments(r,"y",n,e.y-10),i.makeSpace(a.movingShapes,a.resizingShapes,{x:0,y:n},"s")),l.length&&(o=i.calculateAdjustments(l,"y",-n,e.y+e.height+10),i.makeSpace(o.movingShapes,o.resizingShapes,{x:0,y:-n},"n")))}(a,o))}))}function Du(e,t){t.invoke(Yo,this),this._bpmnReplace=e;var i=this;this.postExecuted("elements.create",500,(function(e){var t=e.elements;t.filter((function(e){return Ru(e,e.host)})).map((function(e){return t.indexOf(e)})).forEach((function(n){e.elements[n]=i.replaceShape(t[n])}))}),!0),this.preExecute("elements.move",500,(function(e){var t=e.shapes,n=e.newHost;t.forEach((function(e,a){var o,s=e.host;Ru(e,(o=s,-1!==t.indexOf(o)?s:n))&&(t[a]=i.replaceShape(e))}))}),!0)}function Ru(e,t){return!po(e)&&xa(e,"bpmn:BoundaryEvent")&&!t}function Pu(e,t,i){function n(e,n,a){var o,s,r,l,c,d,u,h,p=n.waypoints,m=e.outgoing.slice(),f=e.incoming.slice(),g=Tr(p,h=ie(a.width)?yi(a):a);if(g){if(o=p.slice(0,g.index),s=p.slice(g.index+(g.bendpoint?1:0)),!o.length||!s.length)return;r=g.bendpoint?p[g.index]:h,1!==o.length&&Lu(e,o[o.length-1])||o.push(Vu(r)),1!==s.length&&Lu(e,s[0])||s.unshift(Vu(r))}l=n.source,c=n.target,t.canConnect(l,e,n)&&(i.reconnectEnd(n,e,o||h),d=n),t.canConnect(e,c,n)&&(d?u=i.connect(e,c,{type:n.type,waypoints:s}):(i.reconnectStart(n,e,s||h),u=n));var v=[].concat(d&&re(f,(function(e){return e.source===d.source}))||[],u&&re(m,(function(e){return e.target===u.target}))||[]);v.length&&i.removeElements(v)}Yo.call(this,e),this.preExecute("elements.move",(function(e){var i=e.newParent,n=e.shapes,a=e.delta,o=n[0];if(o&&i){i&&i.waypoints&&(e.newParent=i=i.parent);var s=yi(o),r={x:s.x+a.x,y:s.y+a.y},l=se(i.children,(function(e){return t.canInsert(n,e)&&Tr(e.waypoints,r)}));l&&(e.targetFlow=l,e.position=r)}}),!0),this.postExecuted("elements.move",(function(e){var t=e.shapes,i=e.targetFlow,a=e.position;i&&n(t[0],i,a)}),!0),this.preExecute("shape.create",(function(e){var i=e.parent,n=e.shape;t.canInsert(n,i)&&(e.targetFlow=i,e.parent=i.parent)}),!0),this.postExecuted("shape.create",(function(e){var t=e.shape,i=e.targetFlow,a=e.position;i&&n(t,i,a)}),!0)}function Lu(e,t){var i=t.x,n=t.y;return i>=e.x&&i<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function Vu(e){return Ae({},e)}function Fu(e,t){Yo.call(this,e),this.preExecuted("connection.create",(function(e){var i=e.context,n=i.source,a=i.target,o=a.incoming.slice();i.hints&&!1===i.hints.createElementsBehavior||xa(n,"bpmn:EventBasedGateway")&&a.incoming.length&&o.filter(Iu).forEach((function(e){t.removeConnection(e)}))})),this.preExecuted("shape.replace",(function(e){var i=e.context.newShape;xa(i,"bpmn:EventBasedGateway")&&i.outgoing.filter(Iu).map((function(e){return e.target})).reduce((function(e,t){var i=t.incoming.filter(Iu);return e.concat(i)}),[]).forEach((function(e){e.source!==i&&t.removeConnection(e)}))}))}function Iu(e){return xa(e,"bpmn:SequenceFlow")}Cu.$inject=["eventBus","bpmnFactory"],U()(Cu,Yo),Su.$inject=["bpmnUpdater"],Su.prototype.execute=function(e){var t=e.dataStoreBo,i=e.dataStoreDi,n=e.newSemanticParent,a=e.newDiParent;e.oldSemanticParent=t.$parent,e.oldDiParent=i.$parent,this._bpmnUpdater.updateSemanticParent(t,n),this._bpmnUpdater.updateDiParent(i,a)},Su.prototype.revert=function(e){var t=e.dataStoreBo,i=e.dataStoreDi,n=e.oldSemanticParent,a=e.oldDiParent;this._bpmnUpdater.updateSemanticParent(t,n),this._bpmnUpdater.updateDiParent(i,a)},ku.$inject=["canvas","commandStack","elementRegistry","eventBus"],U()(ku,Yo),Au.$inject=["eventBus","modeling","spaceTool"],U()(Au,Yo),Du.$inject=["bpmnReplace","injector"],U()(Du,Yo),Du.prototype.replaceShape=function(e){var t,i,n=(i=_a(e).eventDefinitions)&&i[0];return t=n?{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:n.$type}:{type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(e,t,{layoutConnection:!1})},U()(Pu,Yo),Pu.$inject=["eventBus","bpmnRules","modeling"],Fu.$inject=["eventBus","modeling"],U()(Fu,Yo);var Bu=1500;function Tu(e,t,i){t.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],Bu,(function(t){var n=t.context.shape||t.shape,a=t.hover;xa(a,"bpmn:Lane")&&!$a(n,["bpmn:Lane","bpmn:Participant"])&&(t.hover=rd(a),t.hoverGfx=e.getGraphics(t.hover));var o=i.getRootElement();a!==o&&(n.labelTarget||xa(n,"bpmn:Group"))&&(t.hover=o,t.hoverGfx=e.getGraphics(t.hover))})),t.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],Bu,(function(t){var i=t.hover;xa(i,"bpmn:Lane")&&(t.hover=rd(i)||i,t.hoverGfx=e.getGraphics(t.hover))})),t.on(["bendpoint.move.hover"],Bu,(function(t){var i=t.context,n=t.hover,a=i.type;xa(n,"bpmn:Lane")&&/reconnect/.test(a)&&(t.hover=rd(n)||n,t.hoverGfx=e.getGraphics(t.hover))})),t.on(["connect.start"],Bu,(function(e){var t=e.context,i=t.start;xa(i,"bpmn:Lane")&&(t.start=rd(i)||i)})),t.on("shape.move.start",2e3,(function(e){var t=e.shape;xa(t,"bpmn:Lane")&&(e.shape=rd(t)||t)}))}function ju(e,t,i,n,a,o){function s(e){var i=_a(e).categoryValueRef;if(i){var n=i.$parent;i&&(oi(n.categoryValue,i),n&&!n.categoryValue.length&&function(e){oi(t.getDefinitions().get("rootElements"),e)}(n))}}a.invoke(Yo,this),this.executed("shape.delete",(function(e){var t,n=e.context.shape;if(xa(n,"bpmn:Group")){var a=_a(n).categoryValueRef,o=i.filter((function(e){return xa(e,"bpmn:Group")}));t=a,o.some((function(e){var i=_a(e);return i.categoryValueRef&&i.categoryValueRef===t}))||s(n)}})),this.reverted("shape.delete",(function(e){var i=e.context.shape;if(xa(i,"bpmn:Group")){var n=_a(i).categoryValueRef,a=t.getDefinitions(),o=n?n.$parent:null;si(o.get("categoryValue"),n),si(a.get("rootElements"),o)}})),this.execute("shape.create",(function(i){var n=_a(i.context.shape);if(xa(n,"bpmn:Group")&&!n.categoryValueRef){var a=nu(t.getDefinitions(),e);n.categoryValueRef=a}})),this.revert("shape.create",(function(e){var t=e.context.shape;xa(t,"bpmn:Group")&&(s(t),delete _a(t).categoryValueRef)})),n.on("moddleCopy.canCopyProperty",2e3,(function(i){var n,a=i.property;if(xa(a,"bpmn:CategoryValue"))return n=nu(t.getDefinitions(),e),o.copyElement(a,n)}))}function Ou(e,t,i,n){var a,o,s,r;return 0==(a=(n.y-i.y)*(t.x-e.x)-(n.x-i.x)*(t.y-e.y))?null:(o=e.y-i.y,s=e.x-i.x,r=((n.x-i.x)*o-(n.y-i.y)*s)/a,{x:Math.round(e.x+r*(t.x-e.x)),y:Math.round(e.y+r*(t.y-e.y))})}function Mu(e){function t(e,t,i){var n,a={x:i.x,y:i.y-50},o={x:i.x-50,y:i.y},s=Ou(e,t,i,a),r=Ou(e,t,i,o);n=s&&r?Nu(s,i)>Nu(r,i)?r:s:s||r,e.original=n}e.on("bpmnElement.added",(function(e){var i,n,a=e.element;a.waypoints&&(t((n=(i=a).waypoints)[0],n[1],yi(i.source)),t(n[n.length-1],n[n.length-2],yi(i.target)))}))}function Nu(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Wu(e){Yo.call(this,e);var t=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],(function(e){var i=e.context.shape,n=_a(i),a=Ca(i);$a(n,t)&&!a.get("isHorizontal")&&a.set("isHorizontal",!0)}))}function zu(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Uu(e){return Math.atan((e[1].y-e[0].y)/(e[1].x-e[0].x))}function qu(e,t){var i=t[0],n=t[1],a={x:n.x-i.x,y:n.y-i.y},o=function(e,t,i){var n=[{n:e[0]-i[0],lambda:t[0]},{n:e[1]-i[1],lambda:t[1]}];return-(n[0].n*t[0]+n[1].n*t[1])/(n[0].lambda*t[0]+n[1].lambda*t[1])}([i.x,i.y],[a.x,a.y],[e.x,e.y]);return{x:i.x+o*a.x,y:i.y+o*a.y}}function Hu(e,t){var i=qu(e,t);return zu({x:i.x-e.x,y:i.y-e.y})}function Gu(e,t){return zu({x:e.x-t.x,y:e.y-t.y})}Tu.$inject=["elementRegistry","eventBus","canvas"],ju.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"],U()(ju,Yo),Mu.$inject=["eventBus"],Wu.$inject=["eventBus"],U()(Wu,Yo);var Zu=Math.sqrt,Yu=Math.min,Ku=Math.max,Xu=Math.abs;function Qu(e){return Math.pow(e,2)}function Ju(e,t){return Zu(Qu(e.x-t.x)+Qu(e.y-t.y))}function eh(e,t,i,n){var a=t.x-e.x,o=t.y-e.y,s=i.x-e.x,r=i.y-e.y,l=a*a+o*o,c=(a*s+o*r)/l,d=c*c-(s*s+r*r-n*n)/l;if(d<0&&d>-1e-6&&(d=0),d<0)return[];var u=Zu(d),h=-c+u,p=-c-u,m={x:e.x-a*h,y:e.y-o*h};return 0===d?[m]:[m,{x:e.x-a*p,y:e.y-o*p}].filter((function(i){return function(e,t,i){return th(e.x,t.x,i.x)&&th(e.y,t.y,i.y)}(i,e,t)}))}function th(e,t,i){return e>=Yu(t,i)-ih&&e<=Ku(t,i)+ih}var ih=.1;function nh(e,t){return Xu(e.x-t.x)<=ih&&Xu(e.y-t.y)<=ih}function ah(e,t){var i=Gu(e[t-1],e[t]);return i/(i+Gu(e[t],e[t+1]))}function oh(e,t){return[e[t],e[t+1]]}function sh(e,t,i){var n=Fs(t),a=Fs(i),o=Is(e,n),s=o.x*(i.width/t.width),r=o.y*(i.height/t.height);return gi({x:a.x+s,y:a.y+r})}function rh(e,t,i){var n=Fs(e),a=Fs(t),o=Fs(i),s=Is(e,n),r=Is(n,a),l=function(e,t,i){var n=vi(t),a=vi(i);if(function(e,t){return function(e,t){return e.right!==t.right&&e.left!==t.left}(e,t)||function(e,t){return e.top!==t.top&&e.bottom!==t.bottom}(e,t)}(n,a))return null;var o,s=wi(t,e);if("top"===s)o={x:0,y:a.bottom-n.bottom};else if("bottom"===s)o={x:0,y:a.top-n.top};else if("right"===s)o={x:a.left-n.left,y:0};else{if("left"!==s)return null;o={x:a.right-n.right,y:0}}return wi(i,{x:e.x+o.x,y:e.y+o.y})!==s?null:o}(n,t,i);if(l)return l;var c=r.x*(i.width/t.width),d=r.y*(i.height/t.height),u=o.x+c,h=o.y+d;return gi({x:u+s.x-e.x,y:h+s.y-e.y})}var lh={width:90,height:20};function ch(e,t,i,n){Yo.call(this,e),this.postExecute("element.updateProperties",(function(e){var i=e.context,a=i.element,o=i.properties;if("name"in o&&t.updateLabel(a,o.name),"text"in o&&xa(a,"bpmn:TextAnnotation")){var s=n.getTextAnnotationBounds({x:a.x,y:a.y,width:a.width,height:a.height},o.text||"");t.updateLabel(a,o.text,s)}})),this.postExecute(["shape.create","connection.create"],(function(e){var i=e.context;if(!1!==(i.hints||{}).createElementsBehavior){var a=i.shape||i.connection,o=a.businessObject;if(!po(a)&&co(a)&&Na(a)){var s=ho(a),r=n.getExternalLabelBounds(lh,Na(a));t.createLabel(a,s,{id:o.id+"_label",businessObject:o,width:r.width,height:r.height})}}})),this.postExecute("shape.delete",(function(e){var i=e.context,n=i.labelTarget,a=i.hints||{};n&&!1!==a.unsetLabel&&t.updateLabel(n,null,null,{removeShape:!1})})),this.postExecute(["label.create"],(function(e){var t,n=e.context,a=n.shape,o=n.labelTarget;o&&xa(o,"bpmn:BaseElement")&&((t=Ca(o)).label||(t.label=i.create("bpmndi:BPMNLabel",{bounds:i.create("dc:Bounds")}),a.di=t),Ae(t.label.bounds,{x:a.x,y:a.y,width:a.width,height:a.height}))})),this.postExecute(["connection.layout","connection.updateWaypoints"],(function(e){var i=e.context;if(!1!==(i.hints||{}).labelBehavior){var n,a=i.connection.label;a&&a.parent&&(n=function(e){var t=e.context,i=t.connection,n=i.label,a=Ae({},t.hints),o=t.newWaypoints||i.waypoints,s=t.oldWaypoints;return void 0===a.startChanged&&(a.startChanged=!!a.connectionStart),void 0===a.endChanged&&(a.endChanged=!!a.connectionEnd),function(e,t,i,n){var a=0,o=0,s=function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}(e),r=function(e,t){var i,n,a,o,s,r,l,c,d,u,h,p,m=0;for(m=0;m<t.length-1;m++){if(nh(i=t[m],n=t[m+1])?r=[i]:(a=Ju(e,i),o=Ju(e,n),r=eh(i,n,e,Yu(a,o))),r.length<1)throw new Error("expected between [1, 2] circle -> line intersections");1===r.length&&(l={type:"bendpoint",position:r[0],segmentIndex:m,bendpointIndex:nh(i,r[0])?m:m+1}),2===r.length&&(h=r[0],p=r[1],l={type:"segment",position:s={x:(h.x+p.x)/2,y:(h.y+p.y)/2},segmentIndex:m,relativeLocation:Ju(i,s)/Ju(i,n)}),c=Ju(l.position,e),(!u||d>c)&&(u=l,d=c)}return u}(s,i),l=r.segmentIndex,c=function(e,t,i,n){var a=i.segmentIndex,o=t.length-e.length;if(n.segmentMove){var s=n.segmentMove.segmentStartIndex,r=n.segmentMove.newSegmentStartIndex;return a===s?r:a>=r?a+o<r?r:a+o:a}if(n.bendpointMove){var l,c=n.bendpointMove.insert,d=n.bendpointMove.bendpointIndex;return 0===o?a:(a>=d&&(l=c?a+1:a-1),a<d&&(l=a,c&&"bendpoint"!==i.type&&d-1===a&&ah(t,d)<i.relativeLocation&&l++),l)}return 0===o?a:n.connectionStart?0===a?0:null:n.connectionEnd&&a===e.length-2?t.length-2:null}(i,t,r,n);if(null===c)return{x:a,y:o};if(c<0||c>t.length-2)return{x:a,y:o};var d,u,h,p,m,f,g=oh(i,l),v=oh(t,c),b=r.position,y=(p=b,m=Gu((h=g)[0],h[1]),f=Gu(h[0],p),0===m?0:f/m),w=(d=v,u=Uu(g),Uu(d)-u);if("bendpoint"===r.type){var x=t.length-i.length,$=r.bendpointIndex,_=i[$];if(-1!==t.indexOf(_))return{x:a,y:o};if(0===x){var C=t[$];return{x:C.x-r.position.x,y:C.y-r.position.y}}x<0&&0!==$&&$<i.length-1&&(y=ah(i,$))}var E,S,k=(v[1].x-v[0].x)*y+v[0].x,A=(v[1].y-v[0].y)*y+v[0].y,D=(E={x:s.x-b.x,y:s.y-b.y},(S=w)?{x:Math.cos(S)*E.x-Math.sin(S)*E.y,y:Math.sin(S)*E.x+Math.cos(S)*E.y}:E);return gi({x:a=k+D.x-s.x,y:o=A+D.y-s.y})}(n,o,s,a)}(e),t.moveShape(a,n))}})),this.postExecute(["shape.replace"],(function(e){var t=e.context,i=t.newShape,n=t.oldShape,a=_a(i);a&&co(a)&&n.label&&i.label&&(i.label.x=n.label.x,i.label.y=n.label.y)})),this.postExecute("shape.resize",(function(e){var i,n=e.context,a=n.shape,o=n.newBounds,s=n.oldBounds;if(uo(a)){var r=a.label,l=function(e,t,i){return gi(Is(sh(e,t,i),e))}(function(e,t){if(t.length){var i=function(e,t){return ye(t.map((function(t){return{line:t,distance:Hu(e,t)}})),"distance")[0].line}(e,t);return qu(e,i)}}(yi(r),[[{x:(i=s).x,y:i.y},{x:i.x+(i.width||0),y:i.y}],[{x:i.x+(i.width||0),y:i.y},{x:i.x+(i.width||0),y:i.y+(i.height||0)}],[{x:i.x,y:i.y+(i.height||0)},{x:i.x+(i.width||0),y:i.y+(i.height||0)}],[{x:i.x,y:i.y},{x:i.x,y:i.y+(i.height||0)}]]),s,o);t.moveShape(r,l)}}))}function dh(e,t,i){var n=fh(e),a=gh(n,t),o=n[0];return a.length?a[a.length-1]:sh(o.original||o,i,t)}function uh(e,t,i){var n=fh(e),a=gh(n,t),o=n[n.length-1];return a.length?a[0]:sh(o.original||o,i,t)}function hh(e,t,i){var n=fh(e),a=mh(t,i),o=n[0];return sh(o.original||o,a,t)}function ph(e,t,i){var n=fh(e),a=mh(t,i),o=n[n.length-1];return sh(o.original||o,a,t)}function mh(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}function fh(e){var t=e.waypoints;if(!t.length)throw new Error("connection#"+e.id+": no waypoints");return t}function gh(e,t){return re(he(e,vh),(function(e){return function(e,t){return"intersect"===wi(t,e,1)}(e,t)}))}function vh(e){return e.original||e}function bh(e,t){Yo.call(this,e),this.postExecute("shape.replace",(function(e){var i=e.oldShape,n=e.newShape;if(function(e,t){return xa(e,"bpmn:Participant")&&Ta(e)&&xa(t,"bpmn:Participant")&&!Ta(t)}(i,n)){var a,o,s,r,l=(o=Qt([a=i],!1),s=[],r=[],o.forEach((function(e){e!==a&&(e.incoming.forEach((function(e){xa(e,"bpmn:MessageFlow")&&s.push(e)})),e.outgoing.forEach((function(e){xa(e,"bpmn:MessageFlow")&&r.push(e)})))}),[]),{incoming:s,outgoing:r});l.incoming.forEach((function(e){var a=uh(e,n,i);t.reconnectEnd(e,n,a)})),l.outgoing.forEach((function(e){var a=dh(e,n,i);t.reconnectStart(e,n,a)}))}}),!0)}function yh(e,t,i){e.on(["shape.move.rejected","create.rejected"],(function(e){var n,a,o=e.context,s=o.shape;xa(o.target,"bpmn:Collaboration")&&xa(s,"bpmn:FlowNode")&&(n=e,a=i("flow elements must be children of pools/participants"),t.add({position:{x:n.x+5,y:n.y+5},type:"error",timeout:2e3,html:"<div>"+a+"</div>"}))}))}function wh(e,t){Yo.call(this,e),this.preExecute("shape.resize",(function(e){var i=e.shape,n=Ca(i),a=n&&n.get("label");a&&a.get("bounds")&&t.updateModdleProperties(i,a,{bounds:void 0})}),!0)}function xh(e,t,i){Yo.call(this,e),this.preExecute("shape.delete",(function(e){var n,a,o,s=e.context.shape;if(1===s.incoming.length&&1===s.outgoing.length){var r=s.incoming[0],l=s.outgoing[0];if(xa(r,"bpmn:SequenceFlow")&&xa(l,"bpmn:SequenceFlow")&&t.canConnect(r.source,l.target,r)){var c=(n=r.waypoints,a=l.waypoints,(o=Ou($h(n[n.length-2]),$h(n[n.length-1]),$h(a[1]),$h(a[0])))?[].concat(n.slice(0,n.length-1),[o],a.slice(1)):[$h(n[0]),$h(a[a.length-1])]);i.reconnectEnd(r,l.target,c)}}}))}function $h(e){return e.original||e}function _h(e,t){Yo.call(this,e),this.preExecute("shape.delete",(function(e){var t=e.shape,i=t.parent;xa(t,"bpmn:Participant")&&(e.collaborationRoot=i)}),!0),this.postExecute("shape.delete",(function(e){var i=e.collaborationRoot;i&&!i.businessObject.participants.length&&t.makeProcess()}),!0)}function Ch(e,t,i,n){Yo.call(this,e);var a=n.get("dragging",!1);function o(e){var n,a,o=e.source,s=e.target;e.parent&&(xa(e,"bpmn:SequenceFlow")&&(i.canConnectSequenceFlow(o,s)||(a=!0),i.canConnectMessageFlow(o,s)&&(n="bpmn:MessageFlow")),xa(e,"bpmn:MessageFlow")&&(i.canConnectMessageFlow(o,s)||(a=!0),i.canConnectSequenceFlow(o,s)&&(n="bpmn:SequenceFlow")),xa(e,"bpmn:Association")&&!i.canConnectAssociation(o,s)&&(a=!0),a&&t.removeConnection(e),n&&t.connect(o,s,{type:n,waypoints:e.waypoints.slice()}))}this.postExecuted("elements.move",(function(e){le(e.closure.allConnections,o)}),!0),this.preExecute("connection.reconnect",(function(e){var n,o,s=e.context,r=s.connection,l=s.newSource||r.source,c=s.newTarget||r.target;(n=i.canConnect(l,c))&&n.type!==r.type&&(o=t.connect(l,c,{type:n.type,waypoints:r.waypoints.slice()}),t.removeConnection(r),s.connection=o,a&&function(e,t){var i,n=a.context(),o=n&&n.payload.previousSelection;o&&o.length&&-1!==(i=o.indexOf(e))&&o.splice(i,1,t)}(r,o))})),this.postExecuted("element.updateProperties",(function(e){var i,n=e.context,a=n.properties,o=n.element,s=o.businessObject;a.default&&(i=se(o.outgoing,we({id:o.businessObject.default.id})))&&t.updateProperties(i,{conditionExpression:void 0}),a.conditionExpression&&s.sourceRef.default===s&&t.updateProperties(o.source,{default:void 0})}))}function Eh(e,t,i,n,a,o){n.invoke(Yo,this),this._bpmnReplace=e,this._elementRegistry=i,this._selection=o,this.postExecuted(["elements.create"],500,(function(e){var i=e.context,n=i.parent,a=i.elements,o=t.canReplace(a,n);o&&this.replaceElements(a,o.replacements)}),this),this.postExecuted(["elements.move"],500,(function(e){var i=e.context,n=i.newParent,a=i.newHost,o=[];le(i.closure.topLevel,(function(e){o=ja(e)?o.concat(e.children):o.concat(e)})),1===o.length&&a&&(n=a);var s=t.canReplace(o,n);s&&this.replaceElements(o,s.replacements,a)}),this),this.postExecute(["shape.replace"],1500,(function(e){var i,n=e.context,a=n.oldShape,o=n.newShape,s=a.attachers;s&&s.length&&(i=t.canReplace(s,o),this.replaceElements(s,i.replacements))}),this),this.postExecuted(["shape.replace"],1500,(function(e){var t=e.context,i=t.oldShape,n=t.newShape;a.unclaimId(i.businessObject.id,i.businessObject),a.updateProperties(n,{id:i.id})}))}U()(ch,Yo),ch.$inject=["eventBus","modeling","bpmnFactory","textRenderer"],bh.$inject=["eventBus","modeling"],U()(bh,Yo),yh.$inject=["eventBus","tooltips","translate"],U()(wh,Yo),wh.$inject=["eventBus","modeling"],U()(xh,Yo),xh.$inject=["eventBus","bpmnRules","modeling"],_h.$inject=["eventBus","modeling"],U()(_h,Yo),U()(Ch,Yo),Ch.$inject=["eventBus","modeling","bpmnRules","injector"],U()(Eh,Yo),Eh.prototype.replaceElements=function(e,t){var i=this._elementRegistry,n=this._bpmnReplace,a=this._selection;le(t,(function(t){var a={type:t.newElementType},o=i.get(t.oldElementId),s=e.indexOf(o);e[s]=n.replaceElement(o,a,{select:!1})})),t&&a.select(e)},Eh.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var Sh={width:300,height:150},kh={width:140,height:120},Ah={width:50,height:30};function Dh(e){e.on("resize.start",1500,(function(e){var t=e.context,i=t.shape,n=t.direction,a=t.balanced;(xa(i,"bpmn:Lane")||xa(i,"bpmn:Participant"))&&(t.resizeConstraints=function(e,t,i){var n=rd(e),a=!0,o=!0,s=od(n,[n]),r=vi(e),l={},c={};return/e/.test(t)?c.right=r.left+300:/w/.test(t)&&(c.left=r.right-300),s.forEach((function(e){var n=vi(e);/n/.test(t)&&(n.top<r.top-10&&(a=!1),i&&Rh(r.top-n.bottom)<10&&Ih(l,"top",n.top+60),Rh(r.top-n.top)<5&&Fh(c,"top",n.bottom-60)),/s/.test(t)&&(n.bottom>r.bottom+10&&(o=!1),i&&Rh(r.bottom-n.top)<10&&Fh(l,"bottom",n.bottom-60),Rh(r.bottom-n.bottom)<5&&Ih(c,"bottom",n.top+60))})),n.children.filter((function(e){return!e.hidden&&!e.waypoints&&(xa(e,"bpmn:FlowElement")||xa(e,"bpmn:Artifact"))})).forEach((function(e){var i=vi(e);a&&/n/.test(t)&&Fh(c,"top",i.top-20),/e/.test(t)&&Ih(c,"right",i.right+20),o&&/s/.test(t)&&Ih(c,"bottom",i.bottom+20),/w/.test(t)&&Fh(c,"left",i.left-50)})),{min:c,max:l}}(i,n,a)),xa(i,"bpmn:Participant")&&(t.minDimensions=Sh),xa(i,"bpmn:SubProcess")&&Ta(i)&&(t.minDimensions=kh),xa(i,"bpmn:TextAnnotation")&&(t.minDimensions=Ah)}))}Dh.$inject=["eventBus"];var Rh=Math.abs,Ph=Math.min,Lh=Math.max;function Vh(e,t,i,n){var a=e[t];e[t]=void 0===a?i:n(i,a)}function Fh(e,t,i){return Vh(e,t,i,Ph)}function Ih(e,t,i){return Vh(e,t,i,Lh)}function Bh(e,t){e.on("resize.start",1501,(function(e){var t=e.context,i=t.shape;(xa(i,"bpmn:Lane")||xa(i,"bpmn:Participant"))&&(t.balanced=!Eo(e))})),e.on("resize.end",1001,(function(e){var i=e.context,n=i.shape,a=i.canExecute,o=i.newBounds;if(xa(n,"bpmn:Lane")||xa(n,"bpmn:Participant"))return a&&(o=fi(o),t.resizeLane(n,o,i.balanced)),!1}))}function Th(e,t,i,n,a){function o(e){return $a(e,["bpmn:ReceiveTask","bpmn:SendTask"])||function(e,t){return ee(t)||(t=[t]),ue(t,(function(t){return Oa(e,t)}))}(e,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function s(t){return!!se(e.getDefinitions().get("rootElements"),we({id:t.id}))}function r(e){return xa(e,"bpmn:ErrorEventDefinition")?"errorRef":xa(e,"bpmn:EscalationEventDefinition")?"escalationRef":xa(e,"bpmn:MessageEventDefinition")?"messageRef":xa(e,"bpmn:SignalEventDefinition")?"signalRef":void 0}function l(e){if($a(e,["bpmn:ReceiveTask","bpmn:SendTask"]))return e.get("messageRef");var t=e.get("eventDefinitions")[0];return t.get(r(t))}i.invoke(Yo,this),this.executed("shape.create",(function(t){var i=t.shape;if(o(i)){var n=l(_a(i));n&&!s(n)&&(si(e.getDefinitions().get("rootElements"),n),t.addedRootElement=n)}}),!0),this.reverted("shape.create",(function(t){var i=t.addedRootElement;i&&oi(e.getDefinitions().get("rootElements"),i)}),!0),t.on("copyPaste.copyElement",(function(e){var t=e.descriptor,i=e.element;if(o(i)){var n=l(_a(i));n&&(t.referencedRootElement=n)}})),t.on("copyPaste.pasteElement",500,(function(e){var t=e.descriptor,i=t.businessObject;if(o(i)){var l=t.referencedRootElement;l&&(s(l)||(l=n.copyElement(l,a.create(l.$type))),function(e,t){if($a(e,["bpmn:ReceiveTask","bpmn:SendTask"]))return e.set("messageRef",t);var i=e.get("eventDefinitions")[0];i.set(r(i),t)}(i,l))}}))}Bh.$inject=["eventBus","modeling"],Th.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"],U()(Th,Yo);var jh=Math.max;function Oh(e){e.on("spaceTool.getMinDimensions",(function(e){var t=e.shapes,i=e.axis,n=e.start,a={};return le(t,(function(e){var t=e.id;xa(e,"bpmn:Participant")&&(function(e){return"x"===e}(i)?a[t]=Sh:a[t]={width:Sh.width,height:Mh(e,n)}),xa(e,"bpmn:SubProcess")&&Ta(e)&&(a[t]=kh),xa(e,"bpmn:TextAnnotation")&&(a[t]=Ah)})),a}))}function Mh(e,t){var i;return sd(e).length?(i=function(e,t){var i;return i=Nh(sd(e),t),e.height-i.height+60}(e,t),jh(Sh.height,i)):Sh.height}function Nh(e,t){var i,n,a;for(i=0;i<e.length;i++)if(t>=(n=e[i]).y&&t<=n.y+n.height)return(a=sd(n)).length?Nh(a,t):n}Oh.$inject=["eventBus"];function Wh(e,t,i,n,a,o,s){Yo.call(this,t),this._canvas=e,this._eventBus=t,this._modeling=i,this._elementFactory=n,this._bpmnFactory=a,this._bpmnjs=o,this._elementRegistry=s;var r=this;function l(e){return xa(e,"bpmn:SubProcess")&&!Ta(e)}function c(t){var i=t.shape,n=t.newRootElement,a=_a(i);n=r._addDiagram(n||a),t.newRootElement=e.addRootElement(n)}function d(t){var i=_a(t.shape);r._removeDiagram(i);var n=t.newRootElement=s.get(ns(i));e.removeRootElement(n)}this.executed("shape.create",(function(e){l(e.shape)&&c(e)}),!0),this.postExecuted("shape.create",(function(e){var t=e.shape,i=e.newRootElement;i&&t.children&&(r._showRecursively(t.children),r._moveChildrenToShape(t,i))}),!0),this.reverted("shape.create",(function(e){l(e.shape)&&d(e)}),!0),this.preExecuted("shape.delete",(function(e){var t=e.shape;if(l(t)){var n=s.get(ns(t));n&&i.removeElements(n.children.slice())}}),!0),this.executed("shape.delete",(function(e){l(e.shape)&&d(e)}),!0),this.reverted("shape.delete",(function(e){l(e.shape)&&c(e)}),!0),this.preExecuted("shape.replace",(function(t){var i=t.oldShape,n=t.newShape;l(i)&&l(n)&&(t.oldRoot=e.removeRootElement(ns(i)))}),!0),this.postExecuted("shape.replace",(function(t){var n=t.newShape,a=t.oldRoot,o=e.findRoot(ns(n));if(a&&o){var s=a.children;i.moveElements(s,{x:0,y:0},o)}}),!0),this.executed("element.updateProperties",(function(e){var t=e.element;if(xa(t,"bpmn:SubProcess")){var i=e.properties,n=e.oldProperties.id,a=i.id;if(n!==a){if(os(t))return s.updateId(t,as(a)),void s.updateId(n,a);s.get(as(n))&&s.updateId(as(n),as(a))}}}),!0),this.reverted("element.updateProperties",(function(e){var t=e.element;if(xa(t,"bpmn:SubProcess")){var i=e.properties,n=e.oldProperties.id,a=i.id;if(n!==a){if(os(t))return s.updateId(t,as(n)),void s.updateId(a,n);var o=s.get(as(a));o&&s.updateId(o,as(n))}}}),!0),t.on("element.changed",(function(e){var i=e.element;if(os(i)){var n=i,a=s.get(is(n));a&&a!==n&&t.fire("element.changed",{element:a})}})),this.executed("shape.toggleCollapse",400,(function(e){var t=e.shape;xa(t,"bpmn:SubProcess")&&(Ta(t)?d(e):(c(e),r._showRecursively(t.children)))}),!0),this.reverted("shape.toggleCollapse",400,(function(e){var t=e.shape;xa(t,"bpmn:SubProcess")&&(Ta(t)?d(e):(c(e),r._showRecursively(t.children)))}),!0),this.postExecuted("shape.toggleCollapse",600,(function(e){var t=e.shape;if(xa(t,"bpmn:SubProcess")){var i=e.newRootElement;i&&(Ta(t)?r._moveChildrenToShape(i,t):r._moveChildrenToShape(t,i))}}),!0),t.on("copyPaste.createTree",(function(e){var t=e.element,i=e.children;if(l(t)){var n=ns(t),a=s.get(n);a&&i.push.apply(i,a.children)}})),t.on("copyPaste.copyElement",(function(e){var t=e.descriptor,i=e.element,n=e.elements,a=i.parent;if(xa(Ca(a),"bpmndi:BPMNPlane")){var o=is(a),s=se(n,(function(e){return e.id===o}));s&&(t.parent=s.id)}})),t.on("copyPaste.pasteElement",(function(e){var t=e.descriptor;t.parent&&(l(t.parent)||t.parent.hidden)&&(t.hidden=!0)}))}function zh(e,t){e.invoke(Yo,this),this.postExecuted("shape.replace",(function(e){var i=e.context.oldShape,n=e.context.newShape;if(xa(n,"bpmn:SubProcess")&&xa(i,"bpmn:Task")&&Ta(n)){var a,o={x:(a=n).x+a.width/6,y:a.y+a.height/2};t.createShape({type:"bpmn:StartEvent"},o,n)}}))}function Uh(e,t){Yo.call(this,e),this.postExecuted("shape.toggleCollapse",1500,(function(e){var i=e.shape;if(!Ta(i)){var n=Qt(i);n.forEach((function(e){var t=e.incoming.slice(),i=e.outgoing.slice();le(t,(function(e){a(e,!0)})),le(i,(function(e){a(e,!1)}))}))}function a(e,a){-1!==n.indexOf(e.source)&&-1!==n.indexOf(e.target)||(a?t.reconnectEnd(e,i,yi(i)):t.reconnectStart(e,i,yi(i)))}}),!0)}function qh(e,t,i,n){Yo.call(this,e),this.executed(["shape.toggleCollapse"],500,(function(e){var t,i=e.context.shape;xa(i,"bpmn:SubProcess")&&(i.collapsed?Ca(i).isExpanded=!1:((t=i.children).length&&t.forEach((function(e){"label"!==e.type||e.businessObject.name||(e.hidden=!0)})),Ca(i).isExpanded=!0))})),this.reverted(["shape.toggleCollapse"],500,(function(e){var t=e.context.shape;t.collapsed?Ca(t).isExpanded=!1:Ca(t).isExpanded=!0})),this.postExecuted(["shape.toggleCollapse"],500,(function(e){var n,a=e.context.shape,o=t.getDefaultSize(a);n=a.collapsed?function(e,t){return{x:e.x+(e.width-t.width)/2,y:e.y+(e.height-t.height)/2,width:t.width,height:t.height}}(a,o):function(e,t){var i,n,a=t;return(i=td((n=e.children,n.filter((function(e){return!e.hidden}))).concat([e])))?(a.width=Math.max(i.width,a.width),a.height=Math.max(i.height,a.height),a.x=i.x+(i.width-a.width)/2,a.y=i.y+(i.height-a.height)/2):(a.x=e.x+(e.width-a.width)/2,a.y=e.y+(e.height-a.height)/2),a}(a,o),i.resizeShape(a,n,null,{autoResize:!a.collapsed&&"nwse"})}))}function Hh(e,t,i,n){t.invoke(Yo,this),this.preExecute("shape.delete",(function(e){var t=e.context.shape,a=t.businessObject;po(t)||(xa(t,"bpmn:Participant")&&Ta(t)&&i.ids.unclaim(a.processRef.id),n.unclaimId(a.id,a))})),this.preExecute("connection.delete",(function(e){var t=e.context.connection.businessObject;n.unclaimId(t.id,t)})),this.preExecute("canvas.updateRoot",(function(){var t=e.getRootElement(),n=t.businessObject;xa(t,"bpmn:Collaboration")&&i.ids.unclaim(n.id)}))}function Gh(e,t){Yo.call(this,e),this.preExecute("connection.delete",(function(e){var i=e.context.connection,n=i.source;(function(e,t){if(!xa(e,"bpmn:SequenceFlow"))return!1;var i=_a(t),n=_a(e);return i.get("default")===n})(i,n)&&t.updateProperties(n,{default:null})}))}function Zh(e,t,i){var n;Yo.call(this,e);var a=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(a,5e3,(function(e){(n=n||new Yh).enter()})),this.postExecuted(a,500,(function(e){!function(){if(!n)throw new Error(i("out of bounds release"));n.leave()&&(t.updateLaneRefs(n.flowNodes,n.lanes),n=null)}()})),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],(function(e){var t=e.context.shape,a=function(){if(!n)throw new Error(i("out of bounds release"));return n}();t.labelTarget||(xa(t,"bpmn:Lane")&&a.addLane(t),xa(t,"bpmn:FlowNode")&&a.addFlowNode(t))}))}function Yh(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}U()(Wh,Yo),Wh.prototype._moveChildrenToShape=function(e,t){var i,n=this._modeling,a=e.children;if(a){var o=a.filter((function(e){return!e.hidden}));if(o.length){var s=Jt(o);if(t.x){var r=yi(t),l=yi(s);i={x:r.x-l.x,y:r.y-l.y}}else i={x:180-s.x,y:160-s.y};n.moveElements(a,i,t,{autoResize:!1})}else n.moveElements(a,{x:0,y:0},t,{autoResize:!1})}},Wh.prototype._showRecursively=function(e,t){var i=this,n=[];return e.forEach((function(e){e.hidden=!!t,n=n.concat(e),e.children&&(n=n.concat(i._showRecursively(e.children,e.collapsed||t)))})),n},Wh.prototype._addDiagram=function(e){var t=this._bpmnjs.getDefinitions().diagrams;return e.businessObject||(e=this._createNewDiagram(e)),t.push(e.di.$parent),e},Wh.prototype._createNewDiagram=function(e){var t=this._bpmnFactory,i=this._elementFactory,n=t.create("bpmndi:BPMNPlane",{bpmnElement:e}),a=t.create("bpmndi:BPMNDiagram",{plane:n});return n.$parent=a,i.createRoot({id:ns(e),type:e.$type,di:n,businessObject:e,collapsed:!0})},Wh.prototype._removeDiagram=function(e){var t=this._bpmnjs.getDefinitions().diagrams,i=se(t,(function(t){return t.plane.bpmnElement.id===e.id}));return t.splice(t.indexOf(i),1),i},Wh.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"],zh.$inject=["injector","modeling"],U()(zh,Yo),U()(Uh,Yo),Uh.$inject=["eventBus","modeling"],U()(qh,Yo),qh.$inject=["eventBus","elementFactory","modeling"],U()(Hh,Yo),Hh.$inject=["canvas","injector","moddle","modeling"],U()(Gh,Yo),Gh.$inject=["eventBus","modeling"],Zh.$inject=["eventBus","modeling","translate"],U()(Zh,Yo);const Kh={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","messageFlowBehavior","modelingFeedback","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior"],adaptiveLabelPositioningBehavior:["type",hu],appendBehavior:["type",mu],associationBehavior:["type",fu],attachEventBehavior:["type",gu],boundaryEventBehavior:["type",bu],createBehavior:["type",yu],createDataObjectBehavior:["type",wu],createParticipantBehavior:["type",$u],dataInputAssociationBehavior:["type",Cu],dataStoreBehavior:["type",ku],deleteLaneBehavior:["type",Au],detachEventBehavior:["type",Du],dropOnFlowBehavior:["type",Pu],eventBasedGatewayBehavior:["type",Fu],fixHoverBehavior:["type",Tu],groupBehavior:["type",ju],importDockingFix:["type",Mu],isHorizontalFix:["type",Wu],labelBehavior:["type",ch],messageFlowBehavior:["type",bh],modelingFeedback:["type",yh],removeElementBehavior:["type",xh],removeEmbeddedLabelBoundsBehavior:["type",wh],removeParticipantBehavior:["type",_h],replaceConnectionBehavior:["type",Ch],replaceElementBehaviour:["type",Eh],resizeBehavior:["type",Dh],resizeLaneBehavior:["type",Bh],rootElementReferenceBehavior:["type",Th],spaceToolBehavior:["type",Oh],subProcessPlaneBehavior:["type",Wh],subProcessStartEventBehavior:["type",zh],toggleCollapseConnectionBehaviour:["type",Uh],toggleElementCollapseBehaviour:["type",qh],unclaimIdBehavior:["type",Hh],unsetDefaultFlowBehavior:["type",Gh],updateFlowNodeRefsBehavior:["type",Zh]};function Xh(e,t){var i=wi(e,t,-15);return"intersect"!==i?i:null}function Qh(e){wr.call(this,e)}function Jh(e){return!e||po(e)}function ep(e){do{if(xa(e,"bpmn:Process"))return _a(e);if(xa(e,"bpmn:Participant"))return _a(e).processRef||_a(e)}while(e=e.parent)}function tp(e){return xa(e,"bpmn:TextAnnotation")}function ip(e){return xa(e,"bpmn:Group")&&!e.labelTarget}function np(e){return xa(e,"bpmn:BoundaryEvent")&&sp(e,"bpmn:CompensateEventDefinition")}function ap(e){return _a(e).isForCompensation}function op(e){for(var t=e;t=t.parent;){if(xa(t,"bpmn:FlowElementsContainer"))return _a(t);if(xa(t,"bpmn:Participant"))return _a(t).processRef}return null}function sp(e,t){return!!se(_a(e).eventDefinitions||[],(function(e){return xa(e,t)}))}function rp(e,t){return(_a(e).eventDefinitions||[]).every((function(e){return xa(e,t)}))}function lp(e){return xa(e,"bpmn:ReceiveTask")||xa(e,"bpmn:IntermediateCatchEvent")&&(sp(e,"bpmn:MessageEventDefinition")||sp(e,"bpmn:TimerEventDefinition")||sp(e,"bpmn:ConditionalEventDefinition")||sp(e,"bpmn:SignalEventDefinition"))}function cp(e){return e.waypoints}function dp(e,t){var i=function(e){for(var t=[];e;)(e=e.parent)&&t.push(e);return t}(t);return-1!==i.indexOf(e)}function up(e,t,i){if(Jh(e)||Jh(t))return null;if(!xa(i,"bpmn:DataAssociation")){if(_p(e,t))return{type:"bpmn:MessageFlow"};if(Cp(e,t))return{type:"bpmn:SequenceFlow"}}return Ep(e,t)||(np(e)&&ap(t)?{type:"bpmn:Association",associationDirection:"One"}:!!$p(e,t)&&{type:"bpmn:Association"})}function hp(e,t,i){return!(!po(e)&&!ip(e))||!(xa(t,"bpmn:Participant")&&!Ta(t))&&(xa(e,"bpmn:Participant")?xa(t,"bpmn:Process")||xa(t,"bpmn:Collaboration"):$a(e,["bpmn:DataInput","bpmn:DataOutput"])&&e.parent?t===e.parent:xa(e,"bpmn:Lane")?xa(t,"bpmn:Participant")||xa(t,"bpmn:Lane"):!(xa(e,"bpmn:BoundaryEvent")&&(n=e,!_a(n).cancelActivity||!mp(n)&&!fp(n)))&&(xa(e,"bpmn:FlowElement")&&!xa(e,"bpmn:DataStoreReference")?xa(t,"bpmn:FlowElementsContainer")?Ta(t):$a(t,["bpmn:Participant","bpmn:Lane"]):xa(e,"bpmn:DataStoreReference")&&xa(t,"bpmn:Collaboration")?ue(_a(t).get("participants"),(function(e){return!!e.get("processRef")})):$a(e,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?$a(t,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):!!xa(e,"bpmn:MessageFlow")&&(xa(t,"bpmn:Collaboration")||e.source.parent==t||e.target.parent==t)));var n}function pp(e){return xa(e,"bpmn:Lane")}function mp(e){var t=_a(e);return t&&!(t.eventDefinitions&&t.eventDefinitions.length)}function fp(e){return gp(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function gp(e,t){return t.some((function(t){return sp(e,t)}))}function vp(e,t,i,n){if(Array.isArray(e)||(e=[e]),1!==e.length)return!1;var a=e[0];return!po(a)&&!!function(e){return!!function(e){return!po(e)&&xa(e,"bpmn:BoundaryEvent")}(e)||!(!xa(e,"bpmn:IntermediateThrowEvent")||!mp(e))||xa(e,"bpmn:IntermediateCatchEvent")&&fp(e)}(a)&&!ja(t)&&!(!xa(t,"bpmn:Activity")||ap(t))&&!(n&&!Xh(n,t))&&!function(e){return xa(e,"bpmn:ReceiveTask")&&se(e.incoming,(function(e){return xa(e.source,"bpmn:EventBasedGateway")}))}(t)&&"attach"}function bp(e,t,i){if(!t)return!1;var n={replacements:[]};return le(e,(function(e){ja(t)||xa(e,"bpmn:StartEvent")&&"label"!==e.type&&hp(e,t)&&(function(e){return e&&!1!==_a(e).isInterrupting}(e)||n.replacements.push({oldElementId:e.id,newElementType:"bpmn:StartEvent"}),(function(e){return Oa(e,"bpmn:ErrorEventDefinition")}(e)||function(e){return Oa(e,"bpmn:EscalationEventDefinition")}(e)||function(e){return Oa(e,"bpmn:CompensateEventDefinition")}(e))&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:StartEvent"}),gp(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&xa(t,"bpmn:SubProcess")&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:StartEvent"})),xa(t,"bpmn:Transaction")||sp(e,"bpmn:CancelEventDefinition")&&"label"!==e.type&&(xa(e,"bpmn:EndEvent")&&hp(e,t)&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:EndEvent"}),xa(e,"bpmn:BoundaryEvent")&&vp(e,t,0,i)&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:BoundaryEvent"}))})),!!n.replacements.length&&n}function yp(e,t){return!ue(e,pp)&&(!t||e.every((function(e){return hp(e,t)})))}function wp(e,t,i,n){return!!t&&(!(!po(e)&&!ip(e))||i!==t&&(!i||!dp(i,t))&&(hp(e,t)||Sp(e,t)))}function xp(e,t){return xa(e,"bpmn:SubProcess")?Ta(e)&&(!t||t.width>=100&&t.height>=80):xa(e,"bpmn:Lane")?!t||t.width>=130&&t.height>=60:xa(e,"bpmn:Participant")?!t||t.width>=250&&t.height>=50:!!tp(e)||!!ip(e)}function $p(e,t){return!(cp(e)||cp(t)||(!np(e)||!ap(t))&&(dp(t,e)||dp(e,t)||!function(e,t){var i=tp(e),n=tp(t);return(i||n)&&i!==n}(e,t)&&!Ep(e,t)))}function _p(e,t){return!(Dp(e)&&!Dp(t))&&xa(n=e,"bpmn:InteractionNode")&&!xa(n,"bpmn:BoundaryEvent")&&(!xa(n,"bpmn:Event")||xa(n,"bpmn:ThrowEvent")&&rp(n,"bpmn:MessageEventDefinition"))&&function(e){return xa(e,"bpmn:InteractionNode")&&!ap(e)&&(!xa(e,"bpmn:Event")||xa(e,"bpmn:CatchEvent")&&rp(e,"bpmn:MessageEventDefinition"))&&!(xa(e,"bpmn:BoundaryEvent")&&!sp(e,"bpmn:MessageEventDefinition"))}(t)&&(i=t,!(ep(e)===ep(i)));var i,n}function Cp(e,t){return!(lp(t)&&t.incoming.length>0&&(i=t.incoming,(i=i||[]).some(Ap))&&!xa(e,"bpmn:EventBasedGateway"))&&xa(a=e,"bpmn:FlowNode")&&!xa(a,"bpmn:EndEvent")&&!ja(a)&&!(xa(a,"bpmn:IntermediateThrowEvent")&&sp(a,"bpmn:LinkEventDefinition"))&&!np(a)&&!ap(a)&&function(e){return xa(e,"bpmn:FlowNode")&&!xa(e,"bpmn:StartEvent")&&!xa(e,"bpmn:BoundaryEvent")&&!ja(e)&&!(xa(e,"bpmn:IntermediateCatchEvent")&&sp(e,"bpmn:LinkEventDefinition"))&&!ap(e)}(t)&&(n=t,op(e)===op(n))&&!(xa(e,"bpmn:EventBasedGateway")&&!lp(t));var i,n,a}function Ep(e,t){return $a(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&$a(t,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:!(!$a(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])||!$a(e,["bpmn:Activity","bpmn:CatchEvent"]))&&{type:"bpmn:DataOutputAssociation"}}function Sp(e,t,i){if(!t)return!1;if(Array.isArray(e)){if(1!==e.length)return!1;e=e[0]}return t.source!==e&&t.target!==e&&$a(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!po(t)&&xa(e,"bpmn:FlowNode")&&!xa(e,"bpmn:BoundaryEvent")&&hp(e,t.parent)}function kp(e,t){return!!po(t)||!(xa(t,"bpmn:Lane")&&!function(e,t){return e&&t&&-1!==e.indexOf(t)}(e,t.parent))}function Ap(e){if(e&&e.source)return xa(e.source,"bpmn:EventBasedGateway")}function Dp(e){return Gc(e,"bpmn:Process")||Gc(e,"bpmn:Collaboration")}U()(Qh,wr),Qh.$inject=["eventBus"],Qh.prototype.init=function(){this.addRule("connection.start",(function(e){return Jh(t=e.source)?null:$a(t,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"]);var t})),this.addRule("connection.create",(function(e){var t=e.source,i=e.target,n=e.hints||{},a=n.targetParent;if(n.targetAttach)return!1;a&&(i.parent=a);try{return up(t,i)}finally{a&&(i.parent=null)}})),this.addRule("connection.reconnect",(function(e){var t=e.connection;return up(e.source,e.target,t)})),this.addRule("connection.updateWaypoints",(function(e){return{type:e.connection.type}})),this.addRule("shape.resize",(function(e){return xp(e.shape,e.newBounds)})),this.addRule("elements.create",(function(e){var t=e.elements,i=e.position,n=e.target;return!(cp(n)&&!Sp(t,n))&&de(t,(function(e){return cp(e)?up(e.source,e.target,e):e.host?vp(e,e.host,0,i):wp(e,n,null)}))})),this.addRule("elements.move",(function(e){var t=e.target,i=e.shapes,n=e.position;return vp(i,t,0,n)||bp(i,t,n)||yp(i,t)||Sp(i,t)})),this.addRule("shape.create",(function(e){return wp(e.shape,e.target,e.source,e.position)})),this.addRule("shape.attach",(function(e){return vp(e.shape,e.target,0,e.position)})),this.addRule("element.copy",(function(e){var t=e.element;return kp(e.elements,t)}))},Qh.prototype.canConnectMessageFlow=_p,Qh.prototype.canConnectSequenceFlow=Cp,Qh.prototype.canConnectDataAssociation=Ep,Qh.prototype.canConnectAssociation=$p,Qh.prototype.canMove=yp,Qh.prototype.canAttach=vp,Qh.prototype.canReplace=bp,Qh.prototype.canDrop=hp,Qh.prototype.canInsert=Sp,Qh.prototype.canCreate=wp,Qh.prototype.canConnect=up,Qh.prototype.canResize=xp,Qh.prototype.canCopy=kp;const Rp={__depends__:[Fr],__init__:["bpmnRules"],bpmnRules:["type",Qh]};function Pp(e,t){e.on("saveXML.start",2e3,(function(){le(t.getRootElements(),(function(e){var t,i=Ca(e);t=he(re(Qt([e],!1),(function(t){return t!==e&&!t.labelTarget})),Ca),i.set("planeElement",t)}))}))}Pp.$inject=["eventBus","canvas"];const Lp={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",Pp]};function Vp(e){Yo.call(this,e);var t=this;this.preExecute(["shape.create","connection.create"],(function(e){var i=e.context,n=i.shape||i.connection,a=i.parent,o=t.getOrdering(n,a);o&&(void 0!==o.parent&&(i.parent=o.parent),i.parentIndex=o.index)})),this.preExecute(["shape.move","connection.move"],(function(e){var i=e.context,n=i.shape||i.connection,a=i.newParent||n.parent,o=t.getOrdering(n,a);o&&(void 0!==o.parent&&(i.newParent=o.parent),i.newParentIndex=o.index)}))}function Fp(e,t,i){Vp.call(this,e);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:3,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function a(e){var t=e.order;if(t||(e.order=t=function(e){if(e.labelTarget)return{level:10};var t=se(n,(function(t){return $a(e,[t.type])}));return t&&t.order||{level:1}}(e)),!t)throw new Error("no order for <"+e.id+">");return t}this.getOrdering=function(e,i){if(e.labelTarget)return{parent:t.findRoot(e.labelTarget)||t.getRootElement(),index:-1};var n=a(e);n.containers&&(i=function(e,t,i){for(var n=t;n&&!$a(n,i);)n=n.parent;if(!n)throw new Error("no parent for <"+e.id+"> in <"+(t&&t.id)+">");return n}(e,i,n.containers));var o=i.children.indexOf(e),s=function(e,t){t=$e(t);var i=ee(e)?-1:void 0;return le(e,(function(e,n){if(t(e,n))return i=n,!1})),i}(i.children,(function(t){return!(!e.labelTarget&&t.labelTarget)&&n.level<a(t).level}));return-1!==s&&-1!==o&&o<s&&(s-=1),{index:s,parent:i}}}Vp.prototype.getOrdering=function(e,t){return null},zt()(Vp,Yo),Fp.$inject=["eventBus","canvas","translate"],U()(Fp,Vp);const Ip={__depends__:[ro],__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",Fp]};function Bp(e,t){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=t,this._eventBus=e,this._uid=1,e.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}Bp.$inject=["eventBus","injector"],Bp.prototype.execute=function(e,t){if(!e)throw new Error("command required");this._currentExecution.trigger="execute";var i={command:e,context:t};this._pushAction(i),this._internalExecute(i),this._popAction(i)},Bp.prototype.canExecute=function(e,t){var i={command:e,context:t},n=this._getHandler(e),a=this._fire(e,"canExecute",i);if(void 0===a){if(!n)return!1;n.canExecute&&(a=n.canExecute(t))}return a},Bp.prototype.clear=function(e){this._stack.length=0,this._stackIdx=-1,!1!==e&&this._fire("changed",{trigger:"clear"})},Bp.prototype.undo=function(){var e,t=this._getUndoAction();if(t){for(this._currentExecution.trigger="undo",this._pushAction(t);t&&(this._internalUndo(t),(e=this._getUndoAction())&&e.id===t.id);)t=e;this._popAction()}},Bp.prototype.redo=function(){var e,t=this._getRedoAction();if(t){for(this._currentExecution.trigger="redo",this._pushAction(t);t&&(this._internalExecute(t,!0),(e=this._getRedoAction())&&e.id===t.id);)t=e;this._popAction()}},Bp.prototype.register=function(e,t){this._setHandler(e,t)},Bp.prototype.registerHandler=function(e,t){if(!e||!t)throw new Error("command and handlerCls must be defined");var i=this._injector.instantiate(t);this.register(e,i)},Bp.prototype.canUndo=function(){return!!this._getUndoAction()},Bp.prototype.canRedo=function(){return!!this._getRedoAction()},Bp.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},Bp.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},Bp.prototype._internalUndo=function(e){var t=this,i=e.command,n=e.context,a=this._getHandler(i);this._atomicDo((function(){t._fire(i,"revert",e),a.revert&&t._markDirty(a.revert(n)),t._revertedAction(e),t._fire(i,"reverted",e)}))},Bp.prototype._fire=function(e,t,i){arguments.length<3&&(i=t,t=null);var n,a,o,s=t?[e+"."+t,t]:[e];for(i=this._eventBus.createEvent(i),n=0;(a=s[n])&&(o=this._eventBus.fire("commandStack."+a,i),!i.cancelBubble);n++);return o},Bp.prototype._createId=function(){return this._uid++},Bp.prototype._atomicDo=function(e){var t=this._currentExecution;t.atomic=!0;try{e()}finally{t.atomic=!1}},Bp.prototype._internalExecute=function(e,t){var i=this,n=e.command,a=e.context,o=this._getHandler(n);if(!o)throw new Error("no command handler registered for <"+n+">");this._pushAction(e),t||(this._fire(n,"preExecute",e),o.preExecute&&o.preExecute(a),this._fire(n,"preExecuted",e)),this._atomicDo((function(){i._fire(n,"execute",e),o.execute&&i._markDirty(o.execute(a)),i._executedAction(e,t),i._fire(n,"executed",e)})),t||(this._fire(n,"postExecute",e),o.postExecute&&o.postExecute(a),this._fire(n,"postExecuted",e)),this._popAction(e)},Bp.prototype._pushAction=function(e){var t=this._currentExecution,i=t.actions,n=i[0];if(t.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+e.command+")");e.id||(e.id=n&&n.id||this._createId()),i.push(e)},Bp.prototype._popAction=function(){var e=this._currentExecution,t=e.trigger,i=e.actions,n=e.dirty;i.pop(),i.length||(this._eventBus.fire("elements.changed",{elements:ve("id",n.reverse())}),n.length=0,this._fire("changed",{trigger:t}),e.trigger=null)},Bp.prototype._markDirty=function(e){var t=this._currentExecution;e&&(e=ee(e)?e:[e],t.dirty=t.dirty.concat(e))},Bp.prototype._executedAction=function(e,t){var i=++this._stackIdx;t||this._stack.splice(i,this._stack.length,e)},Bp.prototype._revertedAction=function(e){this._stackIdx--},Bp.prototype._getHandler=function(e){return this._handlerMap[e]},Bp.prototype._setHandler=function(e,t){if(!e||!t)throw new Error("command and handler required");if(this._handlerMap[e])throw new Error("overriding handler for command <"+e+">");this._handlerMap[e]=t};const Tp={commandStack:["type",Bp]};var jp=new Mo("tt");function Op(e,t){e.style.display=!1===t?"none":""}var Mp=".djs-tooltip";function Np(e,t){var i,n;this._eventBus=e,this._canvas=t,this._ids=jp,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=(i=t.getContainer(),n=Xe('<div class="djs-tooltip-container" style="position: absolute; width: 0; height: 0;" />'),i.insertBefore(n,i.firstChild),n);var a=this;Ye(this._tooltipRoot,Mp,"mousedown",(function(e){e.stopPropagation()})),Ye(this._tooltipRoot,Mp,"mouseover",(function(e){a.trigger("mouseover",e)})),Ye(this._tooltipRoot,Mp,"mouseout",(function(e){a.trigger("mouseout",e)})),this._init()}Np.$inject=["eventBus","canvas"],Np.prototype.add=function(e){if(!e.position)throw new Error("must specifiy tooltip position");if(!e.html)throw new Error("must specifiy tooltip html");var t=this._ids.next();return e=Ae({},this._tooltipDefaults,e,{id:t}),this._addTooltip(e),e.timeout&&this.setTimeout(e),t},Np.prototype.trigger=function(e,t){var i=t.delegateTarget||t.target,n=this.get(Pe(i,"data-tooltip-id"));n&&("mouseover"===e&&n.timeout&&this.clearTimeout(n),"mouseout"===e&&n.timeout&&(n.timeout=1e3,this.setTimeout(n)))},Np.prototype.get=function(e){return"string"!=typeof e&&(e=e.id),this._tooltips[e]},Np.prototype.clearTimeout=function(e){if(e=this.get(e)){var t=e.removeTimer;t&&(clearTimeout(t),e.removeTimer=null)}},Np.prototype.setTimeout=function(e){if(e=this.get(e)){this.clearTimeout(e);var t=this;e.removeTimer=setTimeout((function(){t.remove(e)}),e.timeout)}},Np.prototype.remove=function(e){var t=this.get(e);t&&(it(t.html),it(t.htmlContainer),delete t.htmlContainer,delete this._tooltips[t.id])},Np.prototype.show=function(){Op(this._tooltipRoot)},Np.prototype.hide=function(){Op(this._tooltipRoot,!1)},Np.prototype._updateRoot=function(e){var t=e.scale||1,i=e.scale||1,n="matrix("+t+",0,0,"+i+","+-1*e.x*t+","+-1*e.y*i+")";this._tooltipRoot.style.transform=n,this._tooltipRoot.style["-ms-transform"]=n},Np.prototype._addTooltip=function(e){var t,i=e.id,n=e.html,a=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),ae(n)&&(n=Xe(n)),(t=Xe('<div data-tooltip-id="'+i+'" class="djs-tooltip" style="position: absolute">')).appendChild(n),e.type&&Be(t).add("djs-tooltip-"+e.type),e.className&&Be(t).add(e.className),e.htmlContainer=t,a.appendChild(t),this._tooltips[i]=e,this._updateTooltip(e)},Np.prototype._updateTooltip=function(e){var t,i,n,a=e.position;t=e.htmlContainer,i=a.x,n=a.y,Ae(t.style,{left:i+"px",top:n+"px"})},Np.prototype._updateTooltipVisibilty=function(e){le(this._tooltips,(function(t){var i=t.show,n=t.htmlContainer,a=!0;i&&((i.minZoom>e.scale||i.maxZoom<e.scale)&&(a=!1),Op(n,a))}))},Np.prototype._init=function(){var e=this;this._eventBus.on("canvas.viewbox.changing",(function(t){e.hide()})),this._eventBus.on("canvas.viewbox.changed",(function(t){var i;i=t.viewbox,e._updateRoot(i),e._updateTooltipVisibilty(i),e.show()}))};const Wp={__init__:["tooltips"],tooltips:["type",Np]};function zp(e,t){if("function"!=typeof t)throw new Error("removeFn iterator must be a function");if(e){for(var i;i=e[0];)t(i);return e}}function Up(e,t,i){Yo.call(this,t);var n=e.get("movePreview",!1);t.on("shape.move.start",1400,(function(e){var t=e.context,i=t.shapes,n=t.validatedShapes;t.shapes=qp(i),t.validatedShapes=qp(n)})),n&&t.on("shape.move.start",250,(function(e){var t=e.context,i=t.shapes,a=[];le(i,(function(e){le(e.labels,(function(i){i.hidden||-1!==t.shapes.indexOf(i)||a.push(i),e.labelTarget&&a.push(e)}))})),le(a,(function(e){n.makeDraggable(t,e,!0)}))})),this.preExecuted("elements.move",1400,(function(e){var t=e.context.closure,i=t.enclosedElements,n=[];le(i,(function(e){le(e.labels,(function(e){i[e.id]||n.push(e)}))})),t.addAll(n)})),this.preExecute(["connection.delete","shape.delete"],(function(e){var t=e.context;zp((t.connection||t.shape).labels,(function(e){i.removeShape(e,{nested:!0})}))})),this.execute("shape.delete",(function(e){var t=e.context,i=t.shape,n=i.labelTarget;n&&(t.labelTargetIndex=ri(n.labels,i),t.labelTarget=n,i.labelTarget=null)})),this.revert("shape.delete",(function(e){var t=e.context,i=t.shape,n=t.labelTarget,a=t.labelTargetIndex;n&&(si(n.labels,i,a),i.labelTarget=n)}))}function qp(e){return re(e,(function(t){return-1===e.indexOf(t.labelTarget)}))}zt()(Up,Yo),Up.$inject=["injector","eventBus","modeling"];const Hp={__init__:["labelSupport"],labelSupport:["type",Up]};var Gp="attach-ok";function Zp(e,t,i,n,a){Yo.call(this,t);var o=e.get("movePreview",!1);t.on("shape.move.start",1401,(function(e){var t,i,n=e.context,a=n.shapes,o=n.validatedShapes;n.shapes=(i=Yp(t=a),be("id",t,i)),n.validatedShapes=function(e){var t=ge(e,"id");return re(e,(function(e){for(;e;){if(e.host&&t[e.host.id])return!1;e=e.parent}return!0}))}(o)})),o&&t.on("shape.move.start",251,(function(e){var t=e.context;le(Yp(t.shapes),(function(e){o.makeDraggable(t,e,!0),le(e.labels,(function(e){o.makeDraggable(t,e,!0)}))}))})),o&&t.on("shape.move.start",(function(e){var n=e.context.shapes;if(1===n.length){var a=n[0].host;a&&(i.addMarker(a,Gp),t.once(["shape.move.out","shape.move.cleanup"],(function(){i.removeMarker(a,Gp)})))}})),this.preExecuted("elements.move",1401,(function(e){var t=e.context,i=t.closure;le(Yp(t.shapes),(function(e){i.add(e,i.topLevel[e.host.id])}))})),this.postExecuted("elements.move",(function(e){var t=e.context,i=t.shapes,n=t.newHost;n&&1!==i.length||le(n?i:re(i,(function(e){var t,n=e.host;return function(e){return!!e.host}(e)&&(t=n,!(-1!==i.indexOf(t)))})),(function(e){a.updateAttachment(e,n)}))})),this.postExecuted("elements.move",(function(e){le(e.context.shapes,(function(e){le(e.attachers,(function(e){le(e.outgoing.slice(),(function(e){n.allowed("connection.reconnect",{connection:e,source:e.source,target:e.target})||a.removeConnection(e)})),le(e.incoming.slice(),(function(e){n.allowed("connection.reconnect",{connection:e,source:e.source,target:e.target})||a.removeConnection(e)}))}))}))})),this.postExecute("shape.create",(function(e){var t=e.context,i=t.shape,n=t.host;n&&a.updateAttachment(i,n)})),this.postExecute("shape.replace",(function(e){var t=e.context,i=t.oldShape,o=t.newShape;zp(i.attachers,(function(e){"attach"===n.allowed("elements.move",{target:o,shapes:[e]})?a.updateAttachment(e,o):a.removeShape(e)})),o.attachers.length&&le(o.attachers,(function(e){var t=rh(e,i,o);a.moveShape(e,t,e.parent)}))})),this.postExecute("shape.resize",(function(e){var t=e.context,i=t.shape,n=t.oldBounds,o=t.newBounds,s=i.attachers;!1!==(t.hints||{}).attachSupport&&le(s,(function(e){var t=rh(e,n,o);a.moveShape(e,t,e.parent),le(e.labels,(function(e){a.moveShape(e,t,e.parent)}))}))})),this.preExecute("shape.delete",(function(e){var t=e.context.shape;zp(t.attachers,(function(e){a.removeShape(e)})),t.host&&a.updateAttachment(t,null)}))}function Yp(e){return Z(he(e,(function(e){return e.attachers||[]})))}zt()(Zp,Yo),Zp.$inject=["injector","eventBus","canvas","rules","modeling"];const Kp={__depends__:[Fr],__init__:["attachSupport"],attachSupport:["type",Zp]};function Xp(e,t){this._eventBus=e,this._dragging=t,this._tools=[],this._active=null}Xp.$inject=["eventBus","dragging"],Xp.prototype.registerTool=function(e,t){var i=this._tools;if(!t)throw new Error('A tool has to be registered with it\'s "events"');i.push(e),this.bindEvents(e,t)},Xp.prototype.isActive=function(e){return e&&this._active===e},Xp.prototype.length=function(e){return this._tools.length},Xp.prototype.setActive=function(e){var t=this._eventBus;this._active!==e&&(this._active=e,t.fire("tool-manager.update",{tool:e}))},Xp.prototype.bindEvents=function(e,t){var i=this._eventBus,n=this._dragging,a=[];i.on(t.tool+".init",(function(t){if(!t.context.reactivate&&this.isActive(e))return this.setActive(null),void n.cancel();this.setActive(e)}),this),le(t,(function(e){a.push(e+".ended"),a.push(e+".canceled")})),i.on(a,250,(function(e){this._active&&(function(e){var t=e.originalEvent&&e.originalEvent.target;return t&&We(t,'.group[data-group="tools"]')}(e)||this.setActive(null))}),this)};const Qp={__depends__:[Rr],__init__:["toolManager"],toolManager:["type",Xp]};function Jp(e,t){return-1!==e.indexOf(t)}var em=Math.abs,tm=Math.round,im={x:"width",y:"height"},nm="crosshair",am={n:"top",w:"left",s:"bottom",e:"right"},om={n:"s",w:"e",s:"n",e:"w"};function sm(e,t,i,n,a,o,s){this._canvas=e,this._dragging=t,this._eventBus=i,this._modeling=n,this._rules=a,this._toolManager=o,this._mouse=s;var r=this;o.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),i.on("spaceTool.selection.end",(function(e){i.once("spaceTool.selection.ended",(function(){r.activateMakeSpace(e.originalEvent)}))})),i.on("spaceTool.move",1500,(function(e){var t=e.context,i=t.initialized;i||(i=t.initialized=r.init(e,t)),i&&lm(e)})),i.on("spaceTool.end",(function(e){var t=e.context,n=t.axis,a=t.direction,o=t.movingShapes,s=t.resizingShapes,l=t.start;if(t.initialized){lm(e);var c={x:0,y:0};c[n]=tm(e["d"+n]),r.makeSpace(o,s,c,a,l),i.once("spaceTool.ended",(function(e){r.activateSelection(e.originalEvent,!0,!0)}))}}))}function rm(e){return{top:e.top-20,right:e.right+20,bottom:e.bottom+20,left:e.left-20}}function lm(e){var t,i,n=e.context.spaceToolConstraints;n&&(ie(n.left)&&(t=Math.max(e.x,n.left),e.dx=e.dx+t-e.x,e.x=t),ie(n.right)&&(t=Math.min(e.x,n.right),e.dx=e.dx+t-e.x,e.x=t),ie(n.top)&&(i=Math.max(e.y,n.top),e.dy=e.dy+i-e.y,e.y=i),ie(n.bottom)&&(i=Math.min(e.y,n.bottom),e.dy=e.dy+i-e.y,e.y=i))}function cm(e,t){return-1!==e.indexOf(t)}function dm(e){return!!e.waypoints}function um(e){return!!e.labelTarget}sm.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"],sm.prototype.activateSelection=function(e,t,i){this._dragging.init(e,"spaceTool.selection",{autoActivate:t,cursor:nm,data:{context:{reactivate:i}},trapClick:!1})},sm.prototype.activateMakeSpace=function(e){this._dragging.init(e,"spaceTool",{autoActivate:!0,cursor:nm,data:{context:{}}})},sm.prototype.makeSpace=function(e,t,i,n,a){return this._modeling.createSpace(e,t,i,n,a)},sm.prototype.init=function(e,t){var i=em(e.dx)>em(e.dy)?"x":"y",n=e["d"+i],a=e[i]-n;if(em(n)<5)return!1;n<0&&(n*=-1),Eo(e)&&(n*=-1);var o=function(e,t){if("x"===e){if(t>0)return"e";if(t<0)return"w"}if("y"===e){if(t>0)return"s";if(t<0)return"n"}return null}(i,n),s=Qt(this._canvas.getRootElement(),!0),r=this.calculateAdjustments(s,i,n,a),l=function(e,t,i,n,a){var o=e.movingShapes,s=e.resizingShapes;if(s.length){var r,l,c={};return le(s,(function(e){var d,u,h,p=vi(e),m=re(e.children,(function(e){return!(dm(e)||um(e)||cm(o,e)||cm(s,e))})),f=re(e.children,(function(e){return!dm(e)&&!um(e)&&cm(o,e)}));m.length&&(u=rm(vi(Jt(m))),d=n-p[am[i]]+u[am[i]],"n"===i?c.bottom=l=ie(l)?Math.min(l,d):d:"w"===i?c.right=l=ie(l)?Math.min(l,d):d:"s"===i?c.top=r=ie(r)?Math.max(r,d):d:"e"===i&&(c.left=r=ie(r)?Math.max(r,d):d)),f.length&&(h=rm(vi(Jt(f))),d=n-h[am[om[i]]]+p[am[om[i]]],"n"===i?c.bottom=l=ie(l)?Math.min(l,d):d:"w"===i?c.right=l=ie(l)?Math.min(l,d):d:"s"===i?c.top=r=ie(r)?Math.max(r,d):d:"e"===i&&(c.left=r=ie(r)?Math.max(r,d):d));var g=a&&a[e.id];g&&("n"===i?(d=n+e[im[t]]-g[im[t]],c.bottom=l=ie(l)?Math.min(l,d):d):"w"===i?(d=n+e[im[t]]-g[im[t]],c.right=l=ie(l)?Math.min(l,d):d):"s"===i?(d=n-e[im[t]]+g[im[t]],c.top=r=ie(r)?Math.max(r,d):d):"e"===i&&(d=n-e[im[t]]+g[im[t]],c.left=r=ie(r)?Math.max(r,d):d))})),c}}(r,i,o,a,this._eventBus.fire("spaceTool.getMinDimensions",{axis:i,direction:o,shapes:r.resizingShapes,start:a}));return Ae(t,r,{axis:i,direction:o,spaceToolConstraints:l,start:a}),Ps("resize-"+("x"===i?"ew":"ns")),!0},sm.prototype.calculateAdjustments=function(e,t,i,n){var a=this._rules,o=[],s=[];return le(e,(function(e){if(e.parent&&!dm(e)){var r=e[t],l=r+e[im[t]];return i>0&&r>n||i<0&&l<n?o.push(e):r<n&&l>n&&a.allowed("shape.resize",{shape:e})?s.push(e):void 0}})),{movingShapes:o,resizingShapes:s}},sm.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)},sm.prototype.isActive=function(){var e=this._dragging.context();return e&&/^spaceTool/.test(e.prefix)};var hm="djs-dragging",pm="djs-resizing",mm=Math.max;function fm(e,t,i,n,a){function o(e,t){le(e,(function(e){a.addDragger(e,t),i.addMarker(e,hm)}))}e.on("spaceTool.selection.start",(function(e){var t=i.getLayer("space"),a=e.context,o=wt("g");rt(o,n.cls("djs-crosshair-group",["no-events"])),at(t,o);var s=wt("path");rt(s,"d","M 0,-10000 L 0,10000"),ht(s).add("djs-crosshair"),at(o,s);var r=wt("path");rt(r,"d","M -10000,0 L 10000,0"),ht(r).add("djs-crosshair"),at(o,r),a.crosshairGroup=o})),e.on("spaceTool.selection.move",(function(e){Yi(e.context.crosshairGroup,e.x,e.y)})),e.on("spaceTool.selection.cleanup",(function(e){var t=e.context.crosshairGroup;t&&mt(t)})),e.on("spaceTool.move",250,(function(e){var s=e.context,r=s.line,l=s.axis,c=s.movingShapes,d=s.resizingShapes;if(s.initialized){if(!s.dragGroup){var u=i.getLayer("space");rt(r=wt("path"),"d","M0,0 L0,0"),ht(r).add("djs-crosshair"),at(u,r),s.line=r;var h=wt("g");rt(h,n.cls("djs-drag-group",["no-events"])),at(i.getActiveLayer(),h),o(c,h),o(s.movingConnections=t.filter((function(e){var t=!1;le(c,(function(i){le(i.outgoing,(function(i){e===i&&(t=!0)}))}));var i=!1;le(c,(function(t){le(t.incoming,(function(t){e===t&&(i=!0)}))}));var n=!1;le(d,(function(t){le(t.outgoing,(function(t){e===t&&(n=!0)}))}));var a=!1;return le(d,(function(t){le(t.incoming,(function(t){e===t&&(a=!0)}))})),function(e){return e.waypoints}(e)&&(t||n)&&(i||a)})),h),s.dragGroup=h}if(!s.frameGroup){var p=wt("g");rt(p,n.cls("djs-frame-group",["no-events"])),at(i.getActiveLayer(),p);var m=[];le(d,(function(e){var t=a.addFrame(e,p),n=t.getBBox();m.push({element:t,initialBounds:n}),i.addMarker(e,pm)})),s.frameGroup=p,s.frames=m}rt(r,{d:{x:"M"+e.x+", -10000 L"+e.x+", 10000",y:"M -10000, "+e.y+" L 10000, "+e.y}[l]});var f={x:e.dx,y:e.dy};f[{x:"y",y:"x"}[s.axis]]=0,Yi(s.dragGroup,f.x,f.y),le(s.frames,(function(e){var t,i,n=e.element,a=e.initialBounds;"e"===s.direction?rt(n,{width:mm(a.width+f.x,5)}):rt(n,{width:t=mm(a.width-f.x,5),x:a.x+a.width-t}),"s"===s.direction?rt(n,{height:mm(a.height+f.y,5)}):rt(n,{height:i=mm(a.height-f.y,5),y:a.y+a.height-i})}))}})),e.on("spaceTool.cleanup",(function(e){var t=e.context,n=t.movingShapes,a=t.movingConnections,o=t.resizingShapes,s=t.line,r=t.dragGroup,l=t.frameGroup;le(n,(function(e){i.removeMarker(e,hm)})),le(a,(function(e){i.removeMarker(e,hm)})),r&&(mt(s),mt(r)),le(o,(function(e){i.removeMarker(e,pm)})),l&&mt(l)}))}fm.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const gm={__init__:["spaceToolPreview"],__depends__:[Rr,Fr,Qp,Wl,rc],spaceTool:["type",sm],spaceToolPreview:["type",fm]};function vm(e){this._model=e}function bm(e,t,i,n){Yo.call(this,e),this._bpmnFactory=t,this._translate=n;var a=this;function o(e){le(e.context.oldRoot.children,(function(e){xa(e,"bpmn:BaseElement")&&a.updateParent(e)}))}function s(e){var t=e.context.shape;xa(t,"bpmn:BaseElement")&&a.updateBounds(t)}function r(e){a.updateConnection(e.context)}function l(e){a.updateConnectionWaypoints(e.context.connection)}function c(e){a.updateAttachment(e.context)}this.executed(["connection.layout","connection.create"],(function(e){var t,n=e.context,a=n.hints||{};n.cropped||!1===a.createElementsBehavior||((t=n.connection).waypoints=i.getCroppedWaypoints(t),n.cropped=!0)})),this.reverted(["connection.layout"],(function(e){delete e.context.cropped})),this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ym((function(e){var t=e.context;a.updateParent(t.shape||t.connection,t.oldParent)}))),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ym((function(e){var t=e.context,i=t.shape||t.connection,n=t.parent||t.newParent;a.updateParent(i,n)}))),this.executed(["canvas.updateRoot"],o),this.reverted(["canvas.updateRoot"],o),this.executed(["shape.move","shape.create","shape.resize"],ym((function(e){"label"!==e.context.shape.type&&s(e)}))),this.reverted(["shape.move","shape.create","shape.resize"],ym((function(e){"label"!==e.context.shape.type&&s(e)}))),e.on("shape.changed",(function(e){"label"===e.element.type&&s({context:{shape:e.element}})})),this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],ym(r)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],ym(r)),this.executed(["connection.layout","connection.move","connection.updateWaypoints"],ym(l)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],ym(l)),this.executed("connection.reconnect",ym((function(e){var t=e.context,i=t.connection,n=t.oldSource,a=t.newSource,o=_a(i),s=_a(n),r=_a(a);o.conditionExpression&&!$a(r,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(t.oldConditionExpression=o.conditionExpression,delete o.conditionExpression),n!==a&&s.default===o&&(t.oldDefault=s.default,delete s.default)}))),this.reverted("connection.reconnect",ym((function(e){var t=e.context,i=t.connection,n=t.oldSource,a=t.newSource,o=_a(i),s=_a(n),r=_a(a);t.oldConditionExpression&&(o.conditionExpression=t.oldConditionExpression),t.oldDefault&&(s.default=t.oldDefault,delete r.default)}))),this.executed(["element.updateAttachment"],ym(c)),this.reverted(["element.updateAttachment"],ym(c))}function ym(e){return function(t){var i=t.context;xa(i.shape||i.connection,"bpmn:BaseElement")&&e(t)}}function wm(e,t,i){zi.call(this),this._bpmnFactory=e,this._moddle=t,this._translate=i}function xm(e,t,i){e[i]=t[i],delete t[i]}function $m(e,t){this._modeling=e,this._canvas=t}function _m(e){this._modeling=e}function Cm(e,t){this._canvas=e,this._layouter=t}vm.$inject=["moddle"],vm.prototype._needsId=function(e){return $a(e,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])},vm.prototype._ensureId=function(e){var t;e.id?this._model.ids.claim(e.id,e):(t=xa(e,"bpmn:Activity")?"Activity":xa(e,"bpmn:Event")?"Event":xa(e,"bpmn:Gateway")?"Gateway":$a(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])?"Flow":(e.$type||"").replace(/^[^:]*:/g,""),t+="_",!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(t,e)))},vm.prototype.create=function(e,t){var i=this._model.create(e,t||{});return this._ensureId(i),i},vm.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})},vm.prototype.createDiShape=function(e,t){return this.create("bpmndi:BPMNShape",Ae({bpmnElement:e,bounds:this.createDiBounds()},t))},vm.prototype.createDiBounds=function(e){return this.create("dc:Bounds",e)},vm.prototype.createDiWaypoints=function(e){var t=this;return he(e,(function(e){return t.createDiWaypoint(e)}))},vm.prototype.createDiWaypoint=function(e){return this.create("dc:Point",De(e,["x","y"]))},vm.prototype.createDiEdge=function(e,t){return this.create("bpmndi:BPMNEdge",Ae({bpmnElement:e,waypoint:this.createDiWaypoints([])},t))},vm.prototype.createDiPlane=function(e,t){return this.create("bpmndi:BPMNPlane",Ae({bpmnElement:e},t))},U()(bm,Yo),bm.$inject=["eventBus","bpmnFactory","connectionDocking","translate"],bm.prototype.updateAttachment=function(e){var t=e.shape,i=t.businessObject,n=t.host;i.attachedToRef=n&&n.businessObject},bm.prototype.updateParent=function(e,t){if(!(e instanceof Mi||xa(e,"bpmn:DataStoreReference")&&e.parent&&xa(e.parent,"bpmn:Collaboration"))){var i=e.parent,n=e.businessObject,a=Ca(e),o=i&&i.businessObject,s=Ca(i);xa(e,"bpmn:FlowNode")&&this.updateFlowNodeRefs(n,o,t&&t.businessObject),xa(e,"bpmn:DataOutputAssociation")&&(o=e.source?e.source.businessObject:null),xa(e,"bpmn:DataInputAssociation")&&(o=e.target?e.target.businessObject:null),this.updateSemanticParent(n,o),xa(e,"bpmn:DataObjectReference")&&n.dataObjectRef&&this.updateSemanticParent(n.dataObjectRef,o),this.updateDiParent(a,s)}},bm.prototype.updateBounds=function(e){var t=Ca(e),i=function(e){if(xa(e,"bpmn:Activity")){var t=Ca(e);if(t){var i=t.get("label");if(i)return i.get("bounds")}}}(e);if(i){var n=Is(i,t.get("bounds"));Ae(i,{x:e.x+n.x,y:e.y+n.y})}var a=e instanceof Mi?this._getLabel(t):t,o=a.bounds;o||(o=this._bpmnFactory.createDiBounds(),a.set("bounds",o)),Ae(o,{x:e.x,y:e.y,width:e.width,height:e.height})},bm.prototype.updateFlowNodeRefs=function(e,t,i){i!==t&&(xa(i,"bpmn:Lane")&&oi(i.get("flowNodeRef"),e),xa(t,"bpmn:Lane")&&si(t.get("flowNodeRef"),e))},bm.prototype.updateDiConnection=function(e,t,i){var n=Ca(e),a=Ca(t),o=Ca(i);n.sourceElement&&n.sourceElement.bpmnElement!==_a(t)&&(n.sourceElement=t&&a),n.targetElement&&n.targetElement.bpmnElement!==_a(i)&&(n.targetElement=i&&o)},bm.prototype.updateDiParent=function(e,t){if(t&&!xa(t,"bpmndi:BPMNPlane")&&(t=t.$parent),e.$parent!==t){var i=(t||e.$parent).get("planeElement");t?(i.push(e),e.$parent=t):(oi(i,e),e.$parent=null)}},bm.prototype.getLaneSet=function(e){var t,i;return xa(e,"bpmn:Lane")?((t=e.childLaneSet)||(t=this._bpmnFactory.create("bpmn:LaneSet"),e.childLaneSet=t,t.$parent=e),t):(xa(e,"bpmn:Participant")&&(e=e.processRef),(t=(i=e.get("laneSets"))[0])||((t=this._bpmnFactory.create("bpmn:LaneSet")).$parent=e,i.push(t)),t)},bm.prototype.updateSemanticParent=function(e,t,i){var n,a=this._translate;if(e.$parent!==t&&(!xa(e,"bpmn:DataInput")&&!xa(e,"bpmn:DataOutput")||(xa(t,"bpmn:Participant")&&"processRef"in t&&(t=t.processRef),!("ioSpecification"in t)||t.ioSpecification!==e.$parent))){if(xa(e,"bpmn:Lane"))t&&(t=this.getLaneSet(t)),n="lanes";else if(xa(e,"bpmn:FlowElement")){if(t)if(xa(t,"bpmn:Participant"))t=t.processRef;else if(xa(t,"bpmn:Lane"))do{t=t.$parent.$parent}while(xa(t,"bpmn:Lane"));n="flowElements"}else if(xa(e,"bpmn:Artifact")){for(;t&&!xa(t,"bpmn:Process")&&!xa(t,"bpmn:SubProcess")&&!xa(t,"bpmn:Collaboration");){if(xa(t,"bpmn:Participant")){t=t.processRef;break}t=t.$parent}n="artifacts"}else if(xa(e,"bpmn:MessageFlow"))n="messageFlows";else if(xa(e,"bpmn:Participant")){n="participants";var o,s=e.processRef;s&&(o=function(e){for(;e&&!xa(e,"bpmn:Definitions");)e=e.$parent;return e}(e.$parent||t),e.$parent&&(oi(o.get("rootElements"),s),s.$parent=null),t&&(si(o.get("rootElements"),s),s.$parent=o))}else xa(e,"bpmn:DataOutputAssociation")?n="dataOutputAssociations":xa(e,"bpmn:DataInputAssociation")&&(n="dataInputAssociations");if(!n)throw new Error(a("no parent for {element} in {parent}",{element:e.id,parent:t.id}));var r;if(e.$parent&&oi(r=e.$parent.get(n),e),t?((r=t.get(n)).push(e),e.$parent=t):e.$parent=null,i){var l=i.get(n);oi(r,e),t&&(l||(l=[],t.set(n,l)),l.push(e))}}},bm.prototype.updateConnectionWaypoints=function(e){Ca(e).set("waypoint",this._bpmnFactory.createDiWaypoints(e.waypoints))},bm.prototype.updateConnection=function(e){var t,i=e.connection,n=_a(i),a=i.source,o=_a(a),s=i.target,r=_a(i.target);if(xa(n,"bpmn:DataAssociation"))xa(n,"bpmn:DataInputAssociation")?(n.get("sourceRef")[0]=o,t=e.parent||e.newParent||r,this.updateSemanticParent(n,r,t)):xa(n,"bpmn:DataOutputAssociation")&&(t=e.parent||e.newParent||o,this.updateSemanticParent(n,o,t),n.targetRef=r);else{var l=xa(n,"bpmn:SequenceFlow");n.sourceRef!==o&&(l&&(oi(n.sourceRef&&n.sourceRef.get("outgoing"),n),o&&o.get("outgoing")&&o.get("outgoing").push(n)),n.sourceRef=o),n.targetRef!==r&&(l&&(oi(n.targetRef&&n.targetRef.get("incoming"),n),r&&r.get("incoming")&&r.get("incoming").push(n)),n.targetRef=r)}this.updateConnectionWaypoints(i),this.updateDiConnection(i,a,s)},bm.prototype._getLabel=function(e){return e.label||(e.label=this._bpmnFactory.createDiLabel()),e.label},U()(wm,zi),wm.$inject=["bpmnFactory","moddle","translate"],wm.prototype.baseCreate=zi.prototype.create,wm.prototype.create=function(e,t){if("label"===e){var i=t.di||this._bpmnFactory.createDiLabel();return this.baseCreate(e,Ae({type:"label",di:i},lo,t))}return this.createBpmnElement(e,t)},wm.prototype.createBpmnElement=function(e,t){var i,n,a,o=this._translate,s=(t=t||{}).businessObject,r=t.di;if(!s){if(!t.type)throw new Error(o("no shape type specified"));ba(s=this._bpmnFactory.create(t.type))}if(!$a(r,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])){var l=Ae(r||{},{id:s.id+"_di"});r="root"===e?this._bpmnFactory.createDiPlane(s,l):"connection"===e?this._bpmnFactory.createDiEdge(s,l):this._bpmnFactory.createDiShape(s,l)}return xa(s,"bpmn:Group")&&(t=Ae({isFrame:!0},t)),function(e,t,i){le(["processRef","isInterrupting","associationDirection","isForCompensation"],(function(i){void 0!==t[i]&&xm(e,t,i)}))}(s,t),t.isExpanded&&xm(r,t,"isExpanded"),xa(s,"bpmn:SubProcess")&&(t.collapsed=!Ta(s,r)),xa(s,"bpmn:ExclusiveGateway")&&(r.isMarkerVisible=!0),t.eventDefinitionType&&(n=s.get("eventDefinitions")||[],a=this._bpmnFactory.create(t.eventDefinitionType,t.eventDefinitionAttrs),"bpmn:ConditionalEventDefinition"===t.eventDefinitionType&&(a.condition=this._bpmnFactory.create("bpmn:FormalExpression")),n.push(a),a.$parent=s,s.eventDefinitions=n,delete t.eventDefinitionType),i=this.getDefaultSize(s,r),t=Ae({id:s.id},i,t,{businessObject:s,di:r}),this.baseCreate(e,t)},wm.prototype.getDefaultSize=function(e,t){var i=_a(e);return t=t||Ca(e),xa(i,"bpmn:SubProcess")?Ta(i,t)?{width:350,height:200}:{width:100,height:80}:xa(i,"bpmn:Task")?{width:100,height:80}:xa(i,"bpmn:Gateway")?{width:50,height:50}:xa(i,"bpmn:Event")?{width:36,height:36}:xa(i,"bpmn:Participant")?Ta(i,t)?{width:600,height:250}:{width:400,height:60}:xa(i,"bpmn:Lane")?{width:400,height:100}:xa(i,"bpmn:DataObjectReference")?{width:36,height:50}:xa(i,"bpmn:DataStoreReference")?{width:50,height:50}:xa(i,"bpmn:TextAnnotation")?{width:100,height:30}:xa(i,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}},wm.prototype.createParticipantShape=function(e){return te(e)||(e={isExpanded:e}),!1!==(e=Ae({type:"bpmn:Participant"},e||{})).isExpanded&&(e.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(e)},$m.$inject=["modeling","canvas"],$m.prototype.preExecute=function(e){var t=this._modeling,i=e.elements,n=e.alignment;le(i,(function(e){var i={x:0,y:0};n.left?i.x=n.left-e.x:n.right?i.x=n.right-e.width-e.x:n.center?i.x=n.center-Math.round(e.width/2)-e.x:n.top?i.y=n.top-e.y:n.bottom?i.y=n.bottom-e.height-e.y:n.middle&&(i.y=n.middle-Math.round(e.height/2)-e.y),t.moveElements([e],i,e.parent)}))},$m.prototype.postExecute=function(e){},_m.$inject=["modeling"],_m.prototype.preExecute=function(e){var t=e.source;if(!t)throw new Error("source required");var i=e.target||t.parent,n=e.shape,a=e.hints||{};n=e.shape=this._modeling.createShape(n,e.position,i,{attach:a.attach}),e.shape=n},_m.prototype.postExecute=function(e){var t,i,n=e.hints||{};t=e.source,i=e.shape,ue(t.outgoing,(function(e){return e.target===i}))||(n.connectionTarget===e.source?this._modeling.connect(e.shape,e.source,e.connection):this._modeling.connect(e.source,e.shape,e.connection))},Cm.$inject=["canvas","layouter"],Cm.prototype.execute=function(e){var t=e.connection,i=e.source,n=e.target,a=e.parent,o=e.parentIndex,s=e.hints;if(!i||!n)throw new Error("source and target required");if(!a)throw new Error("parent required");return t.source=i,t.target=n,t.waypoints||(t.waypoints=this._layouter.layoutConnection(t,s)),this._canvas.addConnection(t,a,o),t},Cm.prototype.revert=function(e){var t=e.connection;return this._canvas.removeConnection(t),t.source=null,t.target=null,t};var Em=Math.round;function Sm(e){this._modeling=e}function km(e){return!!e.waypoints}Sm.$inject=["modeling"],Sm.prototype.preExecute=function(e){var t=e.elements,i=e.parent,n=e.parentIndex,a=e.position,o=e.hints,s=this._modeling;le(t,(function(e){ie(e.x)||(e.x=0),ie(e.y)||(e.y=0)}));var r=Jt(re(t,(function(e){return!e.hidden})));le(t,(function(e){km(e)&&(e.waypoints=he(e.waypoints,(function(e){return{x:Em(e.x-r.x-r.width/2+a.x),y:Em(e.y-r.y-r.height/2+a.y)}}))),Ae(e,{x:Em(e.x-r.x-r.width/2+a.x),y:Em(e.y-r.y-r.height/2+a.y)})}));var l=Zt(t),c={};le(t,(function(e){if(km(e))c[e.id]=ie(n)?s.createConnection(c[e.source.id],c[e.target.id],n,e,e.parent||i,o):s.createConnection(c[e.source.id],c[e.target.id],e,e.parent||i,o);else{var t=Ae({},o);-1===l.indexOf(e)&&(t.autoResize=!1),c[e.id]=ie(n)?s.createShape(e,De(e,["x","y","width","height"]),e.parent||i,n,t):s.createShape(e,De(e,["x","y","width","height"]),e.parent||i,t)}})),e.elements=fe(c)};var Am=Math.round;function Dm(e){this._canvas=e}function Rm(e){Dm.call(this,e)}Dm.$inject=["canvas"],Dm.prototype.execute=function(e){var t=e.shape,i=e.position,n=e.parent,a=e.parentIndex;if(!n)throw new Error("parent required");if(!i)throw new Error("position required");return void 0!==i.width?Ae(t,i):Ae(t,{x:i.x-Am(t.width/2),y:i.y-Am(t.height/2)}),this._canvas.addShape(t,n,a),t},Dm.prototype.revert=function(e){var t=e.shape;return this._canvas.removeShape(t),t},zt()(Rm,Dm),Rm.$inject=["canvas"];var Pm=Dm.prototype.execute;Rm.prototype.execute=function(e){var t=e.shape;return function(e){["width","height"].forEach((function(t){void 0===e[t]&&(e[t]=0)}))}(t),t.labelTarget=e.labelTarget,Pm.call(this,e)};var Lm=Dm.prototype.revert;function Vm(e,t){this._canvas=e,this._modeling=t}function Fm(e,t){this._modeling=e,this._elementRegistry=t}function Im(e,t){this._canvas=e,this._modeling=t}function Bm(e){this._modeling=e}Rm.prototype.revert=function(e){return e.shape.labelTarget=null,Lm.call(this,e)},Vm.$inject=["canvas","modeling"],Vm.prototype.execute=function(e){var t=e.connection,i=t.parent;return e.parent=i,e.parentIndex=ri(i.children,t),e.source=t.source,e.target=t.target,this._canvas.removeConnection(t),t.source=null,t.target=null,t},Vm.prototype.revert=function(e){var t=e.connection,i=e.parent,n=e.parentIndex;return t.source=e.source,t.target=e.target,si(i.children,t,n),this._canvas.addConnection(t,i),t},Fm.$inject=["modeling","elementRegistry"],Fm.prototype.postExecute=function(e){var t=this._modeling,i=this._elementRegistry;le(e.elements,(function(e){i.get(e.id)&&(e.waypoints?t.removeConnection(e):t.removeShape(e))}))},Im.$inject=["canvas","modeling"],Im.prototype.preExecute=function(e){var t=this._modeling,i=e.shape;zp(i.incoming,(function(e){t.removeConnection(e,{nested:!0})})),zp(i.outgoing,(function(e){t.removeConnection(e,{nested:!0})})),zp(i.children,(function(e){e.waypoints?t.removeConnection(e,{nested:!0}):t.removeShape(e,{nested:!0})}))},Im.prototype.execute=function(e){var t=this._canvas,i=e.shape,n=i.parent;return e.oldParent=n,e.oldParentIndex=ri(n.children,i),t.removeShape(i),i},Im.prototype.revert=function(e){var t=this._canvas,i=e.shape,n=e.oldParent,a=e.oldParentIndex;return si(n.children,i,a),t.addShape(i,n),i},Bm.$inject=["modeling"];var Tm={x:"y",y:"x"};function jm(e,t){this._layouter=e,this._canvas=t}function Om(){}function Mm(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function Nm(e){this._modeling=e}function Wm(e){this._helper=new Nm(e)}function zm(e){this._modeling=e,this._helper=new Nm(e)}function Um(e){this._modeling=e}function qm(e){return e.original||e}function Hm(e,t){this._modeling=e,this._rules=t}function Gm(e){this._modeling=e}function Zm(e){this._modeling=e}function Ym(e){return Ae({},e)}function Km(e){switch(e){case"n":case"s":return"y";case"w":case"e":return"x"}}function Xm(e,t,i){var n=Km(i);return/e|s/.test(i)?e[n]>t:/n|w/.test(i)?e[n]<t:void 0}function Qm(e,t){return-1!==e.indexOf(t)}function Jm(e){this._modeling=e}function ef(e){var t={};return le(e,(function(e){t[e.id]=e.hidden,e.children&&(t=Ae({},t,ef(e.children)))})),t}function tf(e,t){var i=[];return le(e,(function(e){e.hidden=t,i=i.concat(e),e.children&&(i=i.concat(tf(e.children,e.collapsed||t)))})),i}function nf(e,t){var i=[];return le(e,(function(e){e.hidden=t[e.id],i=i.concat(e),e.children&&(i=i.concat(nf(e.children,t)))})),i}function af(e){this._modeling=e}function of(e,t){return oi(e&&e.attachers,t)}function sf(e,t,i){if(e){var n=e.attachers;n||(e.attachers=n=[]),si(n,t,i)}}function rf(){}function lf(e,t,i){this._eventBus=e,this._elementFactory=t,this._commandStack=i;var n=this;e.on("diagram.init",(function(){n.registerHandlers(i)}))}function cf(e){this._elementRegistry=e}function df(e,t){le(t,(function(t,i){e.set(i,t)}))}Bm.prototype.preExecute=function(e){var t=this._modeling,i=e.groups,n=e.axis,a=e.dimension;function o(e,t){e.range.min=Math.min(t[n],e.range.min),e.range.max=Math.max(t[n]+t[a],e.range.max)}function s(e){return e[n]+e[a]/2}function r(e){return e.length-1}function l(e){return e.max-e.min}var c,d,u=i[0],h=r(i),p=i[h],m=0;le(i,(function(e,c){var d,u,p;e.elements.length<2?c&&c!==i.length-1&&(o(e,e.elements[0]),m+=l(e.range)):(u=(d=ye(e.elements,n))[0],c===h&&(u=d[r(d)]),p=s(u),e.range=null,le(d,(function(i){!function(e,i){var a={y:0};a[n]=e-s(i),a[n]&&(a[Tm[n]]=0,t.moveElements([i],a,i.parent))}(p,i),null!==e.range?o(e,i):e.range={min:i[n],max:i[n]+i[a]}})),c&&c!==i.length-1&&(m+=l(e.range)))})),d=Math.abs(p.range.min-u.range.max),(c=Math.round((d-m)/(i.length-1)))<i.length-1||le(i,(function(e,o){var s,r={};e!==u&&e!==p&&(s=i[o-1],e.range.max=0,le(e.elements,(function(i,o){r[Tm[n]]=0,r[n]=s.range.max-i[n]+c,e.range.min!==i[n]&&(r[n]+=i[n]-e.range.min),r[n]&&t.moveElements([i],r,i.parent),e.range.max=Math.max(i[n]+i[a],o?e.range.max:0)})))}))},Bm.prototype.postExecute=function(e){},jm.$inject=["layouter","canvas"],jm.prototype.execute=function(e){var t=e.connection;return Ae(e,{oldWaypoints:t.waypoints}),t.waypoints=this._layouter.layoutConnection(t,e.hints),t},jm.prototype.revert=function(e){var t=e.connection;return t.waypoints=e.oldWaypoints,t},Om.prototype.execute=function(e){var t=e.connection,i=e.delta,n=e.newParent||t.parent,a=e.newParentIndex,o=t.parent;return e.oldParent=o,e.oldParentIndex=oi(o.children,t),si(n.children,t,a),t.parent=n,le(t.waypoints,(function(e){e.x+=i.x,e.y+=i.y,e.original&&(e.original.x+=i.x,e.original.y+=i.y)})),t},Om.prototype.revert=function(e){var t=e.connection,i=t.parent,n=e.oldParent,a=e.oldParentIndex,o=e.delta;return oi(i.children,t),si(n.children,t,a),t.parent=n,le(t.waypoints,(function(e){e.x-=o.x,e.y-=o.y,e.original&&(e.original.x-=o.x,e.original.y-=o.y)})),t},Mm.prototype.add=function(e,t){return this.addAll([e],t)},Mm.prototype.addAll=function(e,t){var i=function(e,t,i){X(t)&&(t=!0),te(t)&&(i=t,t=!0);var n=ii((i=i||{}).allShapes),a=ii(i.allConnections),o=ii(i.enclosedElements),s=ii(i.enclosedConnections),r=ii(i.topLevel,t&&ge(e,(function(e){return e.id})));function l(e){r[e.source.id]&&r[e.target.id]&&(r[e.id]=[e]),n[e.source.id]&&n[e.target.id]&&(s[e.id]=o[e.id]=e),a[e.id]=e}return Xt(e,(function(e){if(o[e.id]=e,!e.waypoints)return n[e.id]=e,le(e.incoming,l),le(e.outgoing,l),e.children;s[e.id]=a[e.id]=e})),{allShapes:n,allConnections:a,topLevel:r,enclosedConnections:s,enclosedElements:o}}(e,!!t,this);return Ae(this,i),this},Nm.prototype.moveRecursive=function(e,t,i){return e?this.moveClosure(this.getClosure(e),t,i):[]},Nm.prototype.moveClosure=function(e,t,i,n,a){var o=this._modeling,s=e.allShapes,r=e.allConnections,l=e.enclosedConnections,c=e.topLevel,d=!1;a&&a.parent===i&&(d=!0),le(s,(function(e){o.moveShape(e,t,c[e.id]&&!d&&i,{recurse:!1,layout:!1})})),le(r,(function(e){var n=!!s[e.source.id],a=!!s[e.target.id];l[e.id]&&n&&a?o.moveConnection(e,t,c[e.id]&&!d&&i):o.layoutConnection(e,{connectionStart:n&&hh(e,e.source,t),connectionEnd:a&&ph(e,e.target,t)})}))},Nm.prototype.getClosure=function(e){return(new Mm).addAll(e,!0)},Wm.$inject=["modeling"],Wm.prototype.preExecute=function(e){e.closure=this._helper.getClosure(e.shapes)},Wm.prototype.postExecute=function(e){var t,i=e.hints;i&&i.primaryShape&&(t=i.primaryShape,i.oldParent=t.parent),this._helper.moveClosure(e.closure,e.delta,e.newParent,e.newHost,t)},zm.$inject=["modeling"],zm.prototype.execute=function(e){var t=e.shape,i=e.delta,n=e.newParent||t.parent,a=e.newParentIndex,o=t.parent;return e.oldBounds=De(t,["x","y","width","height"]),e.oldParent=o,e.oldParentIndex=oi(o.children,t),si(n.children,t,a),Ae(t,{parent:n,x:t.x+i.x,y:t.y+i.y}),t},zm.prototype.postExecute=function(e){var t=e.shape,i=e.delta,n=e.hints,a=this._modeling;!1!==n.layout&&(le(t.incoming,(function(e){a.layoutConnection(e,{connectionEnd:ph(e,t,i)})})),le(t.outgoing,(function(e){a.layoutConnection(e,{connectionStart:hh(e,t,i)})}))),!1!==n.recurse&&this.moveChildren(e)},zm.prototype.revert=function(e){var t=e.shape,i=e.oldParent,n=e.oldParentIndex,a=e.delta;return si(i.children,t,n),Ae(t,{parent:i,x:t.x-a.x,y:t.y-a.y}),t},zm.prototype.moveChildren=function(e){var t=e.delta,i=e.shape;this._helper.moveRecursive(i.children,t,null)},zm.prototype.getNewParent=function(e){return e.newParent||e.shape.parent},Um.$inject=["modeling"],Um.prototype.execute=function(e){var t=e.newSource,i=e.newTarget,n=e.connection,a=e.dockingOrPoints;if(!t&&!i)throw new Error("newSource or newTarget required");return ee(a)&&(e.oldWaypoints=n.waypoints,n.waypoints=a),t&&(e.oldSource=n.source,n.source=t),i&&(e.oldTarget=n.target,n.target=i),n},Um.prototype.postExecute=function(e){var t=e.connection,i=e.newSource,n=e.newTarget,a=e.dockingOrPoints,o=e.hints||{},s={};o.connectionStart&&(s.connectionStart=o.connectionStart),o.connectionEnd&&(s.connectionEnd=o.connectionEnd),!1!==o.layoutConnection&&(!i||n&&"source"!==o.docking||(s.connectionStart=s.connectionStart||qm(ee(a)?a[0]:a)),!n||i&&"target"!==o.docking||(s.connectionEnd=s.connectionEnd||qm(ee(a)?a[a.length-1]:a)),o.newWaypoints&&(s.waypoints=o.newWaypoints),this._modeling.layoutConnection(t,s))},Um.prototype.revert=function(e){var t=e.oldSource,i=e.oldTarget,n=e.oldWaypoints,a=e.connection;return t&&(a.source=t),i&&(a.target=i),n&&(a.waypoints=n),a},Hm.$inject=["modeling","rules"],Hm.prototype.preExecute=function(e){var t,i=this,n=this._modeling,a=this._rules,o=e.oldShape,s=e.newData,r=e.hints||{};function l(e,t,i){return a.allowed("connection.reconnect",{connection:i,source:e,target:t})}var c,d={x:s.x,y:s.y},u={x:o.x,y:o.y,width:o.width,height:o.height};t=e.newShape=e.newShape||i.createShape(s,d,o.parent,r),o.host&&n.updateAttachment(t,o.host),!1!==r.moveChildren&&(c=o.children.slice(),n.moveElements(c,{x:0,y:0},t,r));var h=o.incoming.slice(),p=o.outgoing.slice();le(h,(function(e){l(e.source,t,e)&&i.reconnectEnd(e,t,uh(e,t,u),r)})),le(p,(function(e){var n=e.target;l(t,n,e)&&i.reconnectStart(e,t,dh(e,t,u),r)}))},Hm.prototype.postExecute=function(e){var t=e.oldShape;this._modeling.removeShape(t)},Hm.prototype.execute=function(e){},Hm.prototype.revert=function(e){},Hm.prototype.createShape=function(e,t,i,n){return this._modeling.createShape(e,t,i,n)},Hm.prototype.reconnectStart=function(e,t,i,n){this._modeling.reconnectStart(e,t,i,n)},Hm.prototype.reconnectEnd=function(e,t,i,n){this._modeling.reconnectEnd(e,t,i,n)},Gm.$inject=["modeling"],Gm.prototype.execute=function(e){var t=e.shape,i=e.newBounds,n=e.minBounds;if(void 0===i.x||void 0===i.y||void 0===i.width||void 0===i.height)throw new Error("newBounds must have {x, y, width, height} properties");if(n&&(i.width<n.width||i.height<n.height))throw new Error("width and height cannot be less than minimum height and width");if(!n&&i.width<10||i.height<10)throw new Error("width and height cannot be less than 10px");return e.oldBounds={width:t.width,height:t.height,x:t.x,y:t.y},Ae(t,{width:i.width,height:i.height,x:i.x,y:i.y}),t},Gm.prototype.postExecute=function(e){var t=this._modeling,i=e.shape,n=e.oldBounds;!1!==(e.hints||{}).layout&&(le(i.incoming,(function(e){t.layoutConnection(e,{connectionEnd:uh(e,i,n)})})),le(i.outgoing,(function(e){t.layoutConnection(e,{connectionStart:dh(e,i,n)})})))},Gm.prototype.revert=function(e){var t=e.shape,i=e.oldBounds;return Ae(t,{width:i.width,height:i.height,x:i.x,y:i.y}),t},Zm.$inject=["modeling"],Zm.prototype.preExecute=function(e){var t=e.delta,i=e.direction,n=e.movingShapes,a=e.resizingShapes,o=e.start,s={};this.moveShapes(n,t),le(a,(function(e){s[e.id]=function(e){return{x:e.x,y:e.y,height:e.height,width:e.width}}(e)})),this.resizeShapes(a,t,i),this.updateConnectionWaypoints(function(e,t){var i=[];return le(e.concat(t),(function(n){var a=n.incoming,o=n.outgoing;le(a.concat(o),(function(n){var a=n.source,o=n.target;(Jp(e,a)||Jp(e,o)||Jp(t,a)||Jp(t,o))&&(Jp(i,n)||i.push(n))}))})),i}(n,a),t,i,o,n,a,s)},Zm.prototype.execute=function(){},Zm.prototype.revert=function(){},Zm.prototype.moveShapes=function(e,t){var i=this;le(e,(function(e){i._modeling.moveShape(e,t,null,{autoResize:!1,layout:!1,recurse:!1})}))},Zm.prototype.resizeShapes=function(e,t,i){var n=this;le(e,(function(e){var a=function(e,t,i){var n=e.x,a=e.y,o=e.width,s=e.height,r=i.x,l=i.y;switch(t){case"n":return{x:n,y:a+l,width:o,height:s-l};case"s":return{x:n,y:a,width:o,height:s+l};case"w":return{x:n+r,y:a,width:o-r,height:s};case"e":return{x:n,y:a,width:o+r,height:s};default:throw new Error("unknown direction: "+t)}}(e,i,t);n._modeling.resizeShape(e,a,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},Zm.prototype.updateConnectionWaypoints=function(e,t,i,n,a,o,s){var r=this,l=a.concat(o);le(e,(function(e){var c=e.source,d=e.target,u=function(e){return he(e.waypoints,(function(e){return(e=Ym(e)).original&&(e.original=Ym(e.original)),e}))}(e),h=Km(i),p={labelBehavior:!1};Qm(l,c)&&Qm(l,d)?(u=he(u,(function(e){return Xm(e,n,i)&&(e[h]=e[h]+t[h]),e.original&&Xm(e.original,n,i)&&(e.original[h]=e.original[h]+t[h]),e})),r._modeling.updateWaypoints(e,u,{labelBehavior:!1})):(Qm(l,c)||Qm(l,d))&&(Qm(a,c)?p.connectionStart=hh(e,c,t):Qm(a,d)?p.connectionEnd=ph(e,d,t):Qm(o,c)?p.connectionStart=dh(e,c,s[c.id]):Qm(o,d)&&(p.connectionEnd=uh(e,d,s[d.id])),r._modeling.layoutConnection(e,p))}))},Jm.$inject=["modeling"],Jm.prototype.execute=function(e){var t=e.shape,i=t.children;e.oldChildrenVisibility=ef(i),t.collapsed=!t.collapsed;var n=tf(i,t.collapsed);return[t].concat(n)},Jm.prototype.revert=function(e){var t=e.shape,i=e.oldChildrenVisibility,n=nf(t.children,i);return t.collapsed=!t.collapsed,[t].concat(n)},af.$inject=["modeling"],af.prototype.execute=function(e){var t=e.shape,i=e.newHost,n=t.host;return e.oldHost=n,e.attacherIdx=of(n,t),sf(i,t),t.host=i,t},af.prototype.revert=function(e){var t=e.shape,i=e.newHost,n=e.oldHost,a=e.attacherIdx;return t.host=n,of(i,t),sf(n,t,a),t},rf.prototype.execute=function(e){var t=e.connection,i=e.newWaypoints;return e.oldWaypoints=t.waypoints,t.waypoints=i,t},rf.prototype.revert=function(e){var t=e.connection,i=e.oldWaypoints;return t.waypoints=i,t},lf.$inject=["eventBus","elementFactory","commandStack"],lf.prototype.getHandlers=function(){return{"shape.append":_m,"shape.create":Dm,"shape.delete":Im,"shape.move":zm,"shape.resize":Gm,"shape.replace":Hm,"shape.toggleCollapse":Jm,spaceTool:Zm,"label.create":Rm,"connection.create":Cm,"connection.delete":Vm,"connection.move":Om,"connection.layout":jm,"connection.updateWaypoints":rf,"connection.reconnect":Um,"elements.create":Sm,"elements.move":Wm,"elements.delete":Fm,"elements.distribute":Bm,"elements.align":$m,"element.updateAttachment":af}},lf.prototype.registerHandlers=function(e){le(this.getHandlers(),(function(t,i){e.registerHandler(i,t)}))},lf.prototype.moveShape=function(e,t,i,n,a){"object"==typeof n&&(a=n,n=null);var o={shape:e,delta:t,newParent:i,newParentIndex:n,hints:a||{}};this._commandStack.execute("shape.move",o)},lf.prototype.updateAttachment=function(e,t){var i={shape:e,newHost:t};this._commandStack.execute("element.updateAttachment",i)},lf.prototype.moveElements=function(e,t,i,n){var a,o=(n=n||{}).attach,s=i;!0===o?(a=i,s=i.parent):!1===o&&(a=null);var r={shapes:e,delta:t,newParent:s,newHost:a,hints:n};this._commandStack.execute("elements.move",r)},lf.prototype.moveConnection=function(e,t,i,n,a){"object"==typeof n&&(a=n,n=void 0);var o={connection:e,delta:t,newParent:i,newParentIndex:n,hints:a||{}};this._commandStack.execute("connection.move",o)},lf.prototype.layoutConnection=function(e,t){var i={connection:e,hints:t||{}};this._commandStack.execute("connection.layout",i)},lf.prototype.createConnection=function(e,t,i,n,a,o){"object"==typeof i&&(o=a,a=n,n=i,i=void 0);var s={source:e,target:t,parent:a,parentIndex:i,connection:n=this._create("connection",n),hints:o};return this._commandStack.execute("connection.create",s),s.connection},lf.prototype.createShape=function(e,t,i,n,a){"number"!=typeof n&&(a=n,n=void 0);var o,s,r=(a=a||{}).attach;e=this._create("shape",e),r?(o=i.parent,s=i):o=i;var l={position:t,shape:e,parent:o,parentIndex:n,host:s,hints:a};return this._commandStack.execute("shape.create",l),l.shape},lf.prototype.createElements=function(e,t,i,n,a){ee(e)||(e=[e]),"number"!=typeof n&&(a=n,n=void 0);var o={position:t,elements:e,parent:i,parentIndex:n,hints:a=a||{}};return this._commandStack.execute("elements.create",o),o.elements},lf.prototype.createLabel=function(e,t,i,n){i=this._create("label",i);var a={labelTarget:e,position:t,parent:n||e.parent,shape:i};return this._commandStack.execute("label.create",a),a.shape},lf.prototype.appendShape=function(e,t,i,n,a){a=a||{};var o={source:e,position:i,target:n,shape:t=this._create("shape",t),connection:a.connection,connectionParent:a.connectionParent,hints:a};return this._commandStack.execute("shape.append",o),o.shape},lf.prototype.removeElements=function(e){var t={elements:e};this._commandStack.execute("elements.delete",t)},lf.prototype.distributeElements=function(e,t,i){var n={groups:e,axis:t,dimension:i};this._commandStack.execute("elements.distribute",n)},lf.prototype.removeShape=function(e,t){var i={shape:e,hints:t||{}};this._commandStack.execute("shape.delete",i)},lf.prototype.removeConnection=function(e,t){var i={connection:e,hints:t||{}};this._commandStack.execute("connection.delete",i)},lf.prototype.replaceShape=function(e,t,i){var n={oldShape:e,newData:t,hints:i||{}};return this._commandStack.execute("shape.replace",n),n.newShape},lf.prototype.alignElements=function(e,t){var i={elements:e,alignment:t};this._commandStack.execute("elements.align",i)},lf.prototype.resizeShape=function(e,t,i,n){var a={shape:e,newBounds:t,minBounds:i,hints:n};this._commandStack.execute("shape.resize",a)},lf.prototype.createSpace=function(e,t,i,n,a){var o={delta:i,direction:n,movingShapes:e,resizingShapes:t,start:a};this._commandStack.execute("spaceTool",o)},lf.prototype.updateWaypoints=function(e,t,i){var n={connection:e,newWaypoints:t,hints:i||{}};this._commandStack.execute("connection.updateWaypoints",n)},lf.prototype.reconnect=function(e,t,i,n,a){var o={connection:e,newSource:t,newTarget:i,dockingOrPoints:n,hints:a||{}};this._commandStack.execute("connection.reconnect",o)},lf.prototype.reconnectStart=function(e,t,i,n){n||(n={}),this.reconnect(e,t,e.target,i,Ae(n,{docking:"source"}))},lf.prototype.reconnectEnd=function(e,t,i,n){n||(n={}),this.reconnect(e,e.source,t,i,Ae(n,{docking:"target"}))},lf.prototype.connect=function(e,t,i,n){return this.createConnection(e,t,i||{},e.parent,n)},lf.prototype._create=function(e,t){return t instanceof Ti?t:this._elementFactory.create(e,t)},lf.prototype.toggleCollapse=function(e,t){var i={shape:e,hints:t||{}};this._commandStack.execute("shape.toggleCollapse",i)},cf.$inject=["elementRegistry"],cf.prototype.execute=function(e){var t=e.element,i=e.moddleElement,n=e.properties;if(!i)throw new Error("<moddleElement> required");var a=e.changed||this.getVisualReferences(i).concat(t),o=e.oldProperties||function(e,t){return ce(t,(function(t,i){return t[i]=e.get(i),t}),{})}(i,pe(n));return df(i,n),e.oldProperties=o,e.changed=a,a},cf.prototype.revert=function(e){var t=e.oldProperties,i=e.moddleElement,n=e.changed;return df(i,t),n},cf.prototype.getVisualReferences=function(e){var t=this._elementRegistry;return xa(e,"bpmn:DataObject")?function(e,t){return t.filter((function(t){return xa(t,"bpmn:DataObjectReference")&&_a(t).dataObjectRef===e}))}(e,t):[]};var uf={width:0,height:0};function hf(e,t,i,n,a){this._elementRegistry=e,this._moddle=t,this._translate=i,this._modeling=n,this._textRenderer=a}function pf(e,t){return"id"in e&&e.id!==t.id}function mf(e,t){var i=e.businessObject,n=Ca(e);le(t,(function(e,t){"di"!==t?i.set(t,e):n&&function(e,t){le(t,(function(t,i){e.set(i,t)}))}(n,e)}))}hf.$inject=["elementRegistry","moddle","translate","modeling","textRenderer"],hf.prototype.execute=function(e){var t=e.element,i=[t],n=this._translate;if(!t)throw new Error(n("element required"));var a=this._elementRegistry,o=this._moddle.ids,s=t.businessObject,r=function(e){var t=Ae({},e);return ff.forEach((function(i){i in e&&(t[i]=_a(t[i]))})),t}(e.properties),l=e.oldProperties||function(e,t){var i=pe(t),n=e.businessObject,a=Ca(e);return ce(i,(function(e,i){return e[i]="di"!==i?n.get(i):function(e,t){return ce(t,(function(t,i){return t[i]=e&&e.get(i),t}),{})}(a,pe(t.di)),e}),{})}(t,r);return pf(r,s)&&(o.unclaim(s.id),a.updateId(t,r.id),o.claim(r.id,s)),"default"in r&&(r.default&&i.push(a.get(r.default.id)),s.default&&i.push(a.get(s.default.id))),mf(t,r),e.oldProperties=l,e.changed=i,i},hf.prototype.postExecute=function(e){var t=e.element.label,i=t&&_a(t).name;if(i){var n=this._textRenderer.getExternalLabelBounds(t,i);this._modeling.resizeShape(t,n,uf)}},hf.prototype.revert=function(e){var t=e.element,i=e.properties,n=e.oldProperties,a=t.businessObject,o=this._elementRegistry,s=this._moddle.ids;return mf(t,n),pf(i,a)&&(s.unclaim(i.id),o.updateId(t,n.id),s.claim(n.id,a)),e.changed};var ff=["default"];function gf(e,t){this._canvas=e,this._modeling=t}function vf(e,t){this._modeling=e,this._spaceTool=t}function bf(e,t){this._modeling=e,this._translate=t}function yf(e,t){this._modeling=e,this._spaceTool=t}gf.$inject=["canvas","modeling"],gf.prototype.execute=function(e){var t=this._canvas,i=e.newRoot,n=i.businessObject,a=t.getRootElement(),o=a.businessObject,s=o.$parent,r=Ca(a);t.setRootElement(i),t.removeRootElement(a),si(s.rootElements,n),n.$parent=s,oi(s.rootElements,o),o.$parent=null,a.di=null,r.bpmnElement=n,i.di=r,e.oldRoot=a},gf.prototype.revert=function(e){var t=this._canvas,i=e.newRoot,n=i.businessObject,a=e.oldRoot,o=a.businessObject,s=n.$parent,r=Ca(i);t.setRootElement(a),t.removeRootElement(i),oi(s.rootElements,n),n.$parent=null,si(s.rootElements,o),o.$parent=s,i.di=null,r.bpmnElement=o,a.di=r},vf.$inject=["modeling","spaceTool"],vf.prototype.preExecute=function(e){var t=this._spaceTool,i=this._modeling,n=e.shape,a=e.location,o=rd(n),s=o===n,r=s?n:n.parent;sd(r).length||i.createShape({type:"bpmn:Lane"},{x:n.x+ad,y:n.y,width:n.width-ad,height:n.height},r);var l=[];Xt(o,(function(e){return l.push(e),e.label&&l.push(e.label),e===n?[]:re(e.children,(function(e){return e!==n}))}));var c="top"===a?-120:120,d="top"===a?n.y:n.y+n.height,u=d+("top"===a?10:-10),h="top"===a?"n":"s",p=t.calculateAdjustments(l,"y",c,u);t.makeSpace(p.movingShapes,p.resizingShapes,{x:0,y:c},h,u),e.newLane=i.createShape({type:"bpmn:Lane"},{x:n.x+(s?ad:0),y:d-("top"===a?120:0),width:n.width-(s?ad:0),height:120},r)},bf.$inject=["modeling","translate"],bf.prototype.preExecute=function(e){var t=this._modeling,i=this._translate,n=e.shape,a=e.count,o=sd(n),s=o.length;if(s>a)throw new Error(i("more than {count} child lanes",{count:a}));var r,l,c,d,u,h=Math.round(n.height/a);for(u=0;u<a;u++)r=n.y+u*h,l=u===a-1?n.height-h*u:h,c={x:n.x+ad,y:r,width:n.width-ad,height:l},u<s?t.resizeShape(o[u],c):(d={type:"bpmn:Lane"},t.createShape(d,c,n))},yf.$inject=["modeling","spaceTool"],yf.prototype.preExecute=function(e){var t=e.shape,i=e.newBounds;!1!==e.balanced?this.resizeBalanced(t,i):this.resizeSpace(t,i)},yf.prototype.resizeBalanced=function(e,t){var i=this._modeling,n=function(e,t){var i=rd(e),n=od(i,xa(i,"bpmn:Process")?[]:[i]),a=vi(e),o=vi(t),s=function(e,t){return Kc(vi(t),vi(e))}(e,t),r=[];return n.forEach((function(t){if(t!==e){var i=0,n=s.right,l=0,c=s.left,d=vi(t);s.top&&(id(d.bottom-a.top)<10&&(l=o.top-d.bottom),id(d.top-a.top)<5&&(i=o.top-d.top)),s.bottom&&(id(d.top-a.bottom)<10&&(i=o.bottom-d.top),id(d.bottom-a.bottom)<5&&(l=o.bottom-d.bottom)),(i||n||l||c)&&r.push({shape:t,newBounds:Xc(t,{top:i,right:n,bottom:l,left:c})})}})),r}(e,t);i.resizeShape(e,t),n.forEach((function(e){i.resizeShape(e.shape,e.newBounds)}))},yf.prototype.resizeSpace=function(e,t){var i,n,a,o,s,r=this._spaceTool,l=vi(e),c=Kc(vi(t),l),d=rd(e),u=[],h=[];Xt(d,(function(e){return u.push(e),(xa(e,"bpmn:Lane")||xa(e,"bpmn:Participant"))&&h.push(e),e.children})),(c.bottom||c.top)&&(i=c.bottom||c.top,n=e.y+(c.bottom?e.height:0)+(c.bottom?-10:10),a=c.bottom?"s":"n",o=c.top>0||c.bottom<0?-i:i,s=r.calculateAdjustments(u,"y",o,n),r.makeSpace(s.movingShapes,s.resizingShapes,{x:0,y:i},a)),(c.left||c.right)&&(i=c.right||c.left,n=e.x+(c.right?e.width:0)+(c.right?-10:100),a=c.right?"e":"w",o=c.left>0||c.right<0?-i:i,s=r.calculateAdjustments(h,"x",o,n),r.makeSpace(s.movingShapes,s.resizingShapes,{x:i,y:0},a))};var wf="flowNodeRef",xf="lanes";function $f(e){this._elementRegistry=e}function _f(e){this._moddle=e}$f.$inject=["elementRegistry"],$f.prototype.computeUpdates=function(e,t){var i=[],n=[],a={},o=[];function s(e){-1===i.indexOf(e)&&(o.push(e),i.push(e))}return t.forEach((function(e){var t=rd(e);t&&-1===i.indexOf(t)&&(t.children.filter((function(e){return xa(e,"bpmn:FlowNode")})).forEach(s),i.push(t))})),e.forEach(s),o.forEach((function(e){var t=e.businessObject,i=t.get(xf).slice(),o=function(e){if(!e.parent)return[];var t=function(e){var t=rd(e);return a[t.id]||(a[t.id]=od(t)),a[t.id]}(e);return t.filter((function(t){return i=e,n=vi(t),a=i.x+i.width/2,o=i.y+i.height/2,a>n.left&&a<n.right&&o>n.top&&o<n.bottom;var i,n,a,o})).map((function(e){return e.businessObject}))}(e);n.push({flowNode:t,remove:i,add:o})})),t.forEach((function(e){var t=e.businessObject;e.parent||t.get(wf).forEach((function(e){n.push({flowNode:e,remove:[t],add:[]})}))})),n},$f.prototype.execute=function(e){var t=e.updates;t||(t=e.updates=this.computeUpdates(e.flowNodeShapes,e.laneShapes)),t.forEach((function(e){var t=e.flowNode,i=t.get(xf);e.remove.forEach((function(e){oi(i,e),oi(e.get(wf),t)})),e.add.forEach((function(e){si(i,e),si(e.get(wf),t)}))}))},$f.prototype.revert=function(e){e.updates.forEach((function(e){var t=e.flowNode,i=t.get(xf);e.add.forEach((function(e){oi(i,e),oi(e.get(wf),t)})),e.remove.forEach((function(e){si(i,e),si(e.get(wf),t)}))}))},_f.$inject=["moddle"],_f.prototype.execute=function(e){var t=this._moddle.ids,i=e.id,n=e.element;e.claiming?t.claim(i,n):t.unclaim(i)},_f.prototype.revert=function(e){var t=this._moddle.ids,i=e.id,n=e.element;e.claiming?t.unclaim(i):t.claim(i,n)};var Cf={fill:void 0,stroke:void 0};function Ef(e){this._commandStack=e,this._normalizeColor=function(e){if(e){if(ae(e)){var t=function(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="transparent",t.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(t.fillStyle)?t.fillStyle:null}(e);if(t)return t}throw new Error("invalid color value: "+e)}}}Ef.$inject=["commandStack"],Ef.prototype.postExecute=function(e){var t=e.elements,i=e.colors||Cf,n=this,a={};"fill"in i&&Ae(a,{"background-color":this._normalizeColor(i.fill)}),"stroke"in i&&Ae(a,{"border-color":this._normalizeColor(i.stroke)}),le(t,(function(e){var t=function(e){return!!e.waypoints}(e)?De(a,["border-color"]):a;!function(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}(t),e.labelTarget?n._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:Ca(e).label,properties:{color:a["background-color"]}}):n._commandStack.execute("element.updateProperties",{element:e,properties:{di:t}})}))};var Sf={width:0,height:0};function kf(e,t,i){function n(e,t){var n=e.label||e,a=e.labelTarget||e;return function(e,t,i){var n=e.businessObject,a=Ma(n);a&&("categoryValueRef"===a?n.categoryValueRef.value=t:n[a]=t)}(n,t),function(e,t){if(!co(e)){var n=Ca(e);t&&!n.label&&(n.label=i.create("bpmndi:BPMNLabel")),!t&&n.label&&(n.label=null)}}(e,t),[n,a]}this.preExecute=function(t){var i=t.element,n=i.businessObject,a=t.newLabel;if(!po(i)&&co(i)&&!uo(i)&&!Af(a)){var o=ho(i);o={x:o.x,y:o.y+7},e.createLabel(i,o,{id:n.id+"_label",businessObject:n,di:i.di})}},this.execute=function(e){return e.oldLabel=Na(e.element),n(e.element,e.newLabel)},this.revert=function(e){return n(e.element,e.oldLabel)},this.postExecute=function(i){var n=i.element,a=n.label||n,o=i.newLabel,s=i.newBounds,r=i.hints||{};if(po(a)||xa(a,"bpmn:TextAnnotation"))if(po(a)&&Af(o))!1!==r.removeShape&&e.removeShape(a,{unsetLabel:!1});else{var l=Na(a);void 0===s&&(s=t.getExternalLabelBounds(a,l)),s&&e.resizeShape(a,s,Sf)}}}function Af(e){return!e||!e.trim()}function Df(e,t,i,n){lf.call(this,e,t,i),this._bpmnRules=n}function Rf(){}kf.$inject=["modeling","textRenderer","bpmnFactory"],U()(Df,lf),Df.$inject=["eventBus","elementFactory","commandStack","bpmnRules"],Df.prototype.getHandlers=function(){var e=lf.prototype.getHandlers.call(this);return e["element.updateModdleProperties"]=cf,e["element.updateProperties"]=hf,e["canvas.updateRoot"]=gf,e["lane.add"]=vf,e["lane.resize"]=yf,e["lane.split"]=bf,e["lane.updateRefs"]=$f,e["id.updateClaim"]=_f,e["element.setColor"]=Ef,e["element.updateLabel"]=kf,e},Df.prototype.updateLabel=function(e,t,i,n){this._commandStack.execute("element.updateLabel",{element:e,newLabel:t,newBounds:i,hints:n||{}})},Df.prototype.connect=function(e,t,i,n){var a=this._bpmnRules;if(i||(i=a.canConnect(e,t)),i)return this.createConnection(e,t,i,e.parent,n)},Df.prototype.updateModdleProperties=function(e,t,i){this._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:t,properties:i})},Df.prototype.updateProperties=function(e,t){this._commandStack.execute("element.updateProperties",{element:e,properties:t})},Df.prototype.resizeLane=function(e,t,i){this._commandStack.execute("lane.resize",{shape:e,newBounds:t,balanced:i})},Df.prototype.addLane=function(e,t){var i={shape:e,location:t};return this._commandStack.execute("lane.add",i),i.newLane},Df.prototype.splitLane=function(e,t){this._commandStack.execute("lane.split",{shape:e,count:t})},Df.prototype.makeCollaboration=function(){var e=this._create("root",{type:"bpmn:Collaboration"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e},Df.prototype.updateLaneRefs=function(e,t){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:e,laneShapes:t})},Df.prototype.makeProcess=function(){var e={newRoot:this._create("root",{type:"bpmn:Process"})};this._commandStack.execute("canvas.updateRoot",e)},Df.prototype.claimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t,claiming:!0})},Df.prototype.unclaimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t})},Df.prototype.setColor=function(e,t){e.length||(e=[e]),this._commandStack.execute("element.setColor",{elements:e,colors:t})},Rf.prototype.layoutConnection=function(e,t){return[(t=t||{}).connectionStart||yi(t.source||e.source),t.connectionEnd||yi(t.target||e.target)]};var Pf=Math.round,Lf={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Vf(e,t,i){var n,a,o,s=wi(t,e,5),r=i.split(":")[0],l=Pf((t.x-e.x)/2+e.x),c=Pf((t.y-e.y)/2+e.y),d=(o=s,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[r].test(o)),u=/h|r|l/.test(r),h=!1,p=!1;return d?(n=u?{x:l,y:e.y}:{x:e.x,y:c},a=u?"h:h":"v:v"):(h=function(e,t){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[t].test(e)}(s,r),a=u?"h:v":"v:h",h?u?(p=c===e.y,n={x:e.x+20*(/l/.test(r)?-1:1),y:p?c+20:c}):n={x:(p=l===e.x)?l+20:l,y:e.y+20*(/t/.test(r)?-1:1)}:n={x:l,y:c}),{waypoints:If(e,n,a).concat(n),directions:a,turnNextDirections:p}}function Ff(e){return e.split(":").reverse().join(":")}function If(e,t,i){if(!function(e){return e&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(e)}(i=i||"h:h"))throw new Error("unknown directions: <"+i+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(Of(i)){var n=function(e,t,i){return Vf(e,t,i)}(e,t,i),a=function(e,t,i){var n=Vf(t,e,Ff(i));return{waypoints:n.waypoints.slice().reverse(),directions:Ff(n.directions),turnNextDirections:n.turnNextDirections}}(e,t,i),o=function(e,t){var i=e.directions.split(":")[1],n=t.directions.split(":")[0];e.turnNextDirections&&(i="h"==i?"v":"h"),t.turnNextDirections&&(n="h"==n?"v":"h");var a=i+":"+n;return{waypoints:If(e.waypoints[e.waypoints.length-1],t.waypoints[0],a),directions:a}}(n,a);return[].concat(n.waypoints,o.waypoints,a.waypoints)}return function(e,t,i){var n=Pf((t.x-e.x)/2+e.x),a=Pf((t.y-e.y)/2+e.y);if("h:v"===i)return[{x:t.x,y:e.y}];if("v:h"===i)return[{x:e.x,y:t.y}];if("h:h"===i)return[{x:n,y:e.y},{x:n,y:t.y}];if("v:v"===i)return[{x:e.x,y:a},{x:t.x,y:a}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(e,t,i)}function Bf(e,t,i,n,a){var o,s,r=(o=a&&a.preferredLayouts||[],s="straight",X(o)?[]:(function(e){if(!ee(e))throw new Error("must supply array")}(o),s=$e(s),o.filter((function(e,t){return!s(e,t)}))))[0]||"h:h",l=wi(e,t,Lf[r]||0),c=function(e,t){if(Of(t))return t;switch(e){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return t}}(l,r);i=i||yi(e),n=n||yi(t);var d=c.split(":"),u=Mf(i,e,d[0],function(e){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[e]}(l));return function(e,t,i){var n=If(e,t,i);return n.unshift(e),n.push(t),Nf(n)}(u,Mf(n,t,d[1],l),c)}function Tf(e,t,i){return function(e,t,i){return e>=t&&e<=i}(t[e],i[e],i[e]+i[{x:"width",y:"height"}[e]])}function jf(e,t,i,n){if(function(e){return e.length<3||!(e.length>4)&&!!se(e,(function(t,i){var n=e[i-1];return n&&li(t,n)<3}))}(n))return null;var a,o=n[0],s=n.slice();return s[0]=i,s[1]=function(e,t,i){switch(di(t,e)){case"v":return{x:i.x,y:e.y};case"h":return{x:e.x,y:i.y}}return{x:e.x,y:e.y}}(s[1],o,i),a=function(e,t,i){var n;for(n=e.length-2;0!==n;n--)if(ui(e[n],t,20)||ui(e[n],i,20))return e.slice(n);return e}(s,e,t),a!==s&&(s=jf(e,t,i,a)),s&&di(s)?null:s}function Of(e){return e&&/t|r|b|l/.test(e)}function Mf(e,t,i,n){if("h"===i&&(i=/left/.test(n)?"l":"r"),"v"===i&&(i=/top/.test(n)?"t":"b"),"t"===i)return{original:e,x:e.x,y:t.y};if("r"===i)return{original:e,x:t.x+t.width,y:e.y};if("b"===i)return{original:e,x:e.x,y:t.y+t.height};if("l"===i)return{original:e,x:t.x,y:e.y};throw new Error("unexpected dockingDirection: <"+i+">")}function Nf(e){return e.reduce((function(t,i,n){return ci(t[t.length-1],e[n+1],i,0)||t.push(i),t}),[])}var Wf={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},zf={top:"t",right:"r",bottom:"b",left:"l"};function Uf(){}function qf(e,t){return xa(t,"bpmn:Participant")?"source":xa(e,"bpmn:Participant")?"target":Yf(t)?"source":Yf(e)||xa(t,"bpmn:Event")?"target":xa(e,"bpmn:Event")?"source":null}function Hf(e){return Yf(e)?"target":"source"}function Gf(e,t){return e?e.original||e:yi(t)}function Zf(e,t){return xa(t,"bpmn:Activity")&&xa(e,"bpmn:BoundaryEvent")&&t.businessObject.isForCompensation}function Yf(e){return xa(e,"bpmn:SubProcess")&&Ta(e)}function Kf(e,t){return e===t}function Xf(e){var t=/right|left/.exec(e);return t&&t[0]}function Qf(e){var t=/top|bottom/.exec(e);return t&&t[0]}function Jf(e){return"right"===e||"left"===e}function eg(e,t){var i=t.waypoints,n=i&&i.length&&wi(i[0],e);return"top"===n?["t:r"]:"right"===n?["r:b"]:"left"===n?["l:t"]:["b:l"]}function tg(e,t,i){var n,a,o,s,r=yi(e),l=yi(t),c=(s=(o=e).host,wi(yi(o),s,-10)),d=Kf(e.host,t),u=-1!==["top","right","bottom","left"].indexOf(c),h=wi(l,r,{x:e.width/2+t.width/2,y:e.height/2+t.height/2});return d?function(e,t,i,n,a){var o=t?e:Qf(e);return[zf[o]+":"+(t?Jf(e)?ig("y",i,n,a)?"h":"b":ig("x",i,n,a)?"v":"l":"v")]}(c,u,e,t,i):(n=function(e,t,i){return i?zf[e]:Kf(Qf(e),Qf(t))||(n=Xf(e),a=Xf(t),Wf[n]===a)?zf[Qf(e)]:zf[Xf(e)];var n,a}(c,h,u),a=function(e,t,i){return i?Jf(e)?(n=t,a=Xf(e),o=Wf[a],-1!==n.indexOf(o)||Kf(e,t)?"h":"v"):function(e,t){var i=Qf(e),n=Wf[i];return-1!==t.indexOf(n)}(e,t)||Kf(e,t)?"v":"h":Jf(t)||Kf(Qf(e),Qf(t))&&Xf(t)?"h":"v";var n,a,o}(c,h,u),[n+":"+a])}function ig(e,t,i,n){return!(ng(e,n,i,40)||ng(e,n,{x:i.x+i.width,y:i.y+i.height},40)||ng(e,n,yi(t),40))}function ng(e,t,i,n){return Math.abs(t[e]-i[e])<n}function ag(e){return Ae({original:e.point.original||e.point},e.actual)}function og(e,t){this._elementRegistry=e,this._graphicsFactory=t}U()(Uf,Rf),Uf.prototype.layoutConnection=function(e,t){t||(t={});var i,n,a=t.source||e.source,o=t.target||e.target,s=t.waypoints||e.waypoints,r=t.connectionStart,l=t.connectionEnd;return r||(r=Gf(s&&s[0],a)),l||(l=Gf(s&&s[s.length-1],o)),(xa(e,"bpmn:Association")||xa(e,"bpmn:DataAssociation"))&&s&&!Zf(a,o)?[].concat([r],s.slice(1,-1),[l]):(xa(e,"bpmn:MessageFlow")?i=function(e,t){return{preferredLayouts:["straight","v:v"],preserveDocking:qf(e,t)}}(a,o):(xa(e,"bpmn:SequenceFlow")||Zf(a,o))&&(i=a===o?{preferredLayouts:eg(a,e)}:xa(a,"bpmn:BoundaryEvent")?{preferredLayouts:tg(a,o,l)}:Yf(a)||Yf(o)?function(e){return{preferredLayouts:["straight","h:h"],preserveDocking:Hf(e)}}(a):xa(a,"bpmn:Gateway")?{preferredLayouts:["v:h"]}:xa(o,"bpmn:Gateway")?{preferredLayouts:["h:v"]}:{preferredLayouts:["h:h"]}),i&&(n=Nf(function(e,t,i,n,a,o){var s;return ee(i)&&(a=i,o=n,i=yi(e),n=yi(t)),a=a||[],s=-1!==(o=Ae({preferredLayouts:[]},o)).preferredLayouts.indexOf("straight")&&function(e,t,i,n,a){var o,s,r={};return s=wi(e,t),/^(top|bottom|left|right)$/.test(s)?(/top|bottom/.test(s)&&(o="x"),/left|right/.test(s)&&(o="y"),"target"===a.preserveDocking?Tf(o,n,e)?(r[o]=n[o],[{x:void 0!==r.x?r.x:i.x,y:void 0!==r.y?r.y:i.y,original:{x:void 0!==r.x?r.x:i.x,y:void 0!==r.y?r.y:i.y}},{x:n.x,y:n.y}]):null:Tf(o,i,t)?(r[o]=i[o],[{x:i.x,y:i.y},{x:void 0!==r.x?r.x:n.x,y:void 0!==r.y?r.y:n.y,original:{x:void 0!==r.x?r.x:n.x,y:void 0!==r.y?r.y:n.y}}]):null):null}(e,t,i,n,o),s||(s=o.connectionEnd&&function(e,t,i,n){var a=n.slice().reverse();return(a=jf(e,t,i,a))?a.reverse():null}(t,e,n,a),s||(s=o.connectionStart&&jf(e,t,i,a))||(!o.connectionStart&&!o.connectionEnd&&a&&a.length?a:Bf(e,t,i,n,o)))}(a,o,r,l,s,i=Ae(i,t)))),n||[r,l])},og.$inject=["elementRegistry","graphicsFactory"],og.prototype.getCroppedWaypoints=function(e,t,i){t=t||e.source,i=i||e.target;var n=this.getDockingPoint(e,t,!0),a=this.getDockingPoint(e,i),o=e.waypoints.slice(n.idx+1,a.idx);return o.unshift(ag(n)),o.push(ag(a)),o},og.prototype.getDockingPoint=function(e,t,i){var n,a,o=e.waypoints;return{point:a=o[n=i?0:o.length-1],actual:this._getIntersection(t,e,i)||a,idx:n}},og.prototype._getIntersection=function(e,t,i){return xi(this._getShapePath(e),this._getConnectionPath(t),i)},og.prototype._getConnectionPath=function(e){return this._graphicsFactory.getConnectionPath(e)},og.prototype._getShapePath=function(e){return this._graphicsFactory.getShapePath(e)},og.prototype._getGfx=function(e){return this._elementRegistry.getGraphics(e)};const sg={__init__:["modeling","bpmnUpdater"],__depends__:[Kh,Rp,Lp,Ip,Ac,Tp,Wp,Hp,Kp,Oo,Zo,gm],bpmnFactory:["type",vm],bpmnUpdater:["type",bm],elementFactory:["type",wm],modeling:["type",Df],layouter:["type",Uf],connectionDocking:["type",og]};var rg=Math.round;function lg(e,t,i,n,a){function o(e,t,i,n){return a.allowed("elements.move",{shapes:e,delta:t,position:i,target:n})}function s(e,i,n,a){if(te(n)&&(a=n,n=!1),!i.waypoints&&i.parent){var o=function(e){return{x:e.x+rg(e.width/2),y:e.y+rg(e.height/2)}}(i);return t.init(e,o,"shape.move",{cursor:"grabbing",autoActivate:n,data:{shape:i,context:a||{}}}),!0}}e.on("shape.move.start",1500,(function(e){var t=e.context,i=e.shape,a=n.get().slice();-1===a.indexOf(i)&&(a=[i]),a=function(e){var t=ge(e,"id");return re(e,(function(e){for(;e=e.parent;)if(t[e.id])return!1;return!0}))}(a),Ae(t,{shapes:a,validatedShapes:a,shape:i})})),e.on("shape.move.start",1250,(function(e){var t=e.context,i=t.validatedShapes;if(!(t.canExecute=o(i)))return!1})),e.on("shape.move.move",500,(function(e){var t,i=e.context,n=i.validatedShapes,a=e.hover,s={x:e.dx,y:e.dy};t=o(n,s,{x:e.x,y:e.y},a),i.delta=s,i.canExecute=t,i.target=null!==t?a:null})),e.on("shape.move.end",(function(e){var t=e.context,n=t.delta,a=t.canExecute,o="attach"===a,s=t.shapes;if(!1===a)return!1;n.x=rg(n.x),n.y=rg(n.y),0===n.x&&0===n.y||i.moveElements(s,n,t.target,{primaryShape:t.shape,attach:o})})),e.on("element.mousedown",(function(e){if(Co(e)){var t=wo(e);if(!t)throw new Error("must supply DOM mousedown event");return s(t,e.element)}})),this.start=s}lg.$inject=["eventBus","dragging","modeling","selection","rules"];var cg="djs-dragging",dg="drop-ok",ug="drop-not-ok",hg="new-parent",pg="attach-ok";function mg(e,t,i,n){function a(e){var t=Qt(e,!0),i=he(t,(function(e){return(e.incoming||[]).concat(e.outgoing||[])}));return Z(t.concat(i))}function o(e,i){[pg,dg,ug,hg].forEach((function(n){n===i?t.addMarker(e,n):t.removeMarker(e,n)}))}e.on("shape.move.start",499,(function(e){var o,s=e.context,r=s.shapes,l=s.allDraggedElements,c=re(o=a(r),(function(e){return!function(e){return e.waypoints}(e)||se(o,we({id:e.source.id}))&&se(o,we({id:e.target.id}))}));if(!s.dragGroup){var d=wt("g");rt(d,i.cls("djs-drag-group",["no-events"])),at(t.getActiveLayer(),d),s.dragGroup=d}c.forEach((function(e){n.addDragger(e,s.dragGroup)})),le(l=l?Z([l,a(r)]):a(r),(function(e){t.addMarker(e,cg)})),s.allDraggedElements=l,s.differentParents=1!==me(ge(r,(function(e){return e.parent&&e.parent.id})))})),e.on("shape.move.move",499,(function(e){var t=e.context,i=t.dragGroup,n=t.target,a=t.shape.parent,s=t.canExecute;n&&("attach"===s?o(n,pg):t.canExecute&&n&&n.id!==a.id?o(n,hg):o(n,t.canExecute?dg:ug)),Yi(i,e.dx,e.dy)})),e.on(["shape.move.out","shape.move.cleanup"],(function(e){var t=e.context.target;t&&o(t,null)})),e.on("shape.move.cleanup",(function(e){var i=e.context,n=i.allDraggedElements,a=i.dragGroup;le(n,(function(e){t.removeMarker(e,cg)})),a&&mt(a)})),this.makeDraggable=function(e,i,a){n.addDragger(i,e.dragGroup),a&&t.addMarker(i,cg),e.allDraggedElements?e.allDraggedElements.push(i):e.allDraggedElements=[i]}}mg.$inject=["eventBus","canvas","styles","previewSupport"];const fg={__depends__:[Ro,Oo,Lo,Fr,Rr,Wl],__init__:["move","movePreview"],move:["type",lg],movePreview:["type",mg]};var gg="open";function vg(e,t){this._eventBus=e,this._canvas=t;var i=this;e.on("tool-manager.update",(function(e){var t=e.tool;i.updateToolHighlight(t)})),e.on("i18n.changed",(function(){i._update()})),e.on("diagram.init",(function(){i._diagramInitialized=!0,i._rebuild()}))}function bg(e,t){var i=t.getPaletteEntries();return ne(i)?i(e):(le(i,(function(t,i){e[i]=t})),e)}vg.$inject=["eventBus","canvas"],vg.prototype.registerProvider=function(e,t){t||(t=e,e=1e3),this._eventBus.on("palette.getProviders",e,(function(e){e.providers.push(t)})),this._rebuild()},vg.prototype.getEntries=function(){return this._getProviders().reduce(bg,{})},vg.prototype._rebuild=function(){this._diagramInitialized&&this._getProviders().length&&(this._container||this._init(),this._update())},vg.prototype._init=function(){var e=this,t=this._eventBus,i=this._getParentContainer(),n=this._container=Xe(vg.HTML_MARKUP);i.appendChild(n),Be(i).add("djs-palette-shown"),Ye(n,".djs-palette-toggle, .entry","click",(function(t){var i=t.delegateTarget;if(Ne(i,".djs-palette-toggle"))return e.toggle();e.trigger("click",t)})),Ge.bind(n,"mousedown",(function(e){e.stopPropagation()})),Ye(n,".entry","dragstart",(function(t){e.trigger("dragstart",t)})),t.on("canvas.resized",this._layoutChanged,this),t.fire("palette.create",{container:n})},vg.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},vg.prototype._toggleState=function(e){e=e||{};var t,i=this._getParentContainer(),n=this._container,a=this._eventBus,o=Be(n),s=Be(i);t="twoColumn"in e?e.twoColumn:this._needsCollapse(i.clientHeight,this._entries||{}),o.toggle("two-column",t),s.toggle("djs-palette-two-column",t),"open"in e&&(o.toggle(gg,e.open),s.toggle("djs-palette-open",e.open)),a.fire("palette.changed",{twoColumn:t,open:this.isOpen()})},vg.prototype._update=function(){var e=et(".djs-palette-entries",this._container),t=this._entries=this.getEntries();je(e),le(t,(function(t,i){var n=t.group||"default",a=et("[data-group="+n+"]",e);a||(a=Xe('<div class="group" data-group="'+n+'"></div>'),e.appendChild(a));var o=t.html||(t.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),s=Xe(o);a.appendChild(s),t.separator||(Pe(s,"data-action",i),t.title&&Pe(s,"title",t.title),t.className&&function(e,t){var i=Be(e);(ee(t)?t:t.split(/\s+/g)).forEach((function(e){i.add(e)}))}(s,t.className),t.imageUrl&&s.appendChild(Xe('<img src="'+t.imageUrl+'">')))})),this.open()},vg.prototype.trigger=function(e,t,i){var n,a,o,s=this._entries,r=t.delegateTarget||t.target;if(!r)return t.preventDefault();(n=s[Pe(r,"data-action")])&&(a=n.action,o=t.originalEvent||t,ne(a)?"click"===e&&a(o,i):a[e]&&a[e](o,i),t.preventDefault())},vg.prototype._layoutChanged=function(){this._toggleState({})},vg.prototype._needsCollapse=function(e,t){return e<46*Object.keys(t).length+50},vg.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},vg.prototype.open=function(){this._toggleState({open:!0})},vg.prototype.toggle=function(e){this.isOpen()?this.close():this.open()},vg.prototype.isActiveTool=function(e){return e&&this._activeTool===e},vg.prototype.updateToolHighlight=function(e){var t;this._toolsContainer||(t=et(".djs-palette-entries",this._container),this._toolsContainer=et("[data-group=tools]",t)),le(this._toolsContainer.children,(function(t){var i=t.getAttribute("data-action");if(i){var n=Be(t);i=i.replace("-tool",""),n.contains("entry")&&i===e?n.add("highlighted-entry"):n.remove("highlighted-entry")}}))},vg.prototype.isOpen=function(){return Be(this._container).has(gg)},vg.prototype._getParentContainer=function(){return this._canvas.getContainer()},vg.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';const yg={__init__:["palette"],palette:["type",vg]};var wg="crosshair";function xg(e,t,i,n,a,o,s){this._selection=a,this._dragging=i,this._mouse=s;var r=this;o.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),e.on("lasso.selection.end",(function(t){var i=t.originalEvent.target;(t.hover||i instanceof SVGElement)&&e.once("lasso.selection.ended",(function(){r.activateLasso(t.originalEvent,!0)}))})),e.on("lasso.end",(function(e){var t=$g(e),i=n.filter((function(e){return e}));r.select(i,t)})),e.on("lasso.start",(function(e){var i=e.context;i.bbox=$g(e),function(e){var i,n=t.getActiveLayer();rt(i=e.frame=wt("rect"),{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),at(n,i)}(i)})),e.on("lasso.move",(function(e){var t=e.context;t.bbox=$g(e),function(e){var t=e.frame,i=e.bbox;rt(t,{x:i.x,y:i.y,width:i.width,height:i.height})}(t)})),e.on("lasso.cleanup",(function(e){!function(e){e.frame&&mt(e.frame)}(e.context)})),e.on("element.mousedown",1500,(function(e){if(So(e))return r.activateLasso(e.originalEvent),!0}))}function $g(e){var t={x:e.x-e.dx,y:e.y-e.dy},i={x:e.x,y:e.y};return t.x<=i.x&&t.y<i.y||t.x<i.x&&t.y<=i.y?{x:t.x,y:t.y,width:i.x-t.x,height:i.y-t.y}:t.x>=i.x&&t.y<i.y||t.x>i.x&&t.y<=i.y?{x:i.x,y:t.y,width:t.x-i.x,height:i.y-t.y}:t.x<=i.x&&t.y>i.y||t.x<i.x&&t.y>=i.y?{x:t.x,y:i.y,width:i.x-t.x,height:t.y-i.y}:t.x>=i.x&&t.y>i.y||t.x>i.x&&t.y>=i.y?{x:i.x,y:i.y,width:t.x-i.x,height:t.y-i.y}:{x:i.x,y:i.y,width:0,height:0}}xg.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],xg.prototype.activateLasso=function(e,t){this._dragging.init(e,"lasso",{autoActivate:t,cursor:wg,data:{context:{}}})},xg.prototype.activateSelection=function(e,t){this._dragging.init(e,"lasso.selection",{trapClick:!1,autoActivate:t,cursor:wg,data:{context:{}}})},xg.prototype.select=function(e,t){var i=function(e,t){var i={};return le(e,(function(e){var n=e;n.waypoints&&(n=Jt(n)),!ie(t.y)&&n.x>t.x&&(i[e.id]=e),!ie(t.x)&&n.y>t.y&&(i[e.id]=e),n.x>t.x&&n.y>t.y&&(ie(t.width)&&ie(t.height)&&n.width+n.x<t.width+t.x&&n.height+n.y<t.height+t.y?i[e.id]=e:ie(t.width)&&ie(t.height)||(i[e.id]=e))})),i}(e,t);this._selection.select(fe(i))},xg.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)},xg.prototype.isActive=function(){var e=this._dragging.context();return e&&/^lasso/.test(e.prefix)};const _g={__depends__:[Qp,rc],__init__:["lassoTool"],lassoTool:["type",xg]};var Cg=1500,Eg="grab";function Sg(e,t,i,n,a,o){this._dragging=i,this._mouse=o;var s=this,r=n.get("keyboard",!1);a.registerTool("hand",{tool:"hand",dragging:"hand.move"}),e.on("element.mousedown",Cg,(function(e){if(Eo(e))return s.activateMove(e.originalEvent,!0),!1})),r&&r.addListener(Cg,(function(e){if(kg(e.keyEvent)&&!s.isActive()){var t=s._mouse.getLastMoveEvent();s.activateMove(t,!!t)}}),"keyboard.keydown"),r&&r.addListener(Cg,(function(e){kg(e.keyEvent)&&s.isActive()&&s.toggle()}),"keyboard.keyup"),e.on("hand.end",(function(t){var i=t.originalEvent.target;if(!(t.hover||i instanceof SVGElement))return!1;e.once("hand.ended",(function(){s.activateMove(t.originalEvent,{reactivate:!0})}))})),e.on("hand.move.move",(function(e){var i=t.viewbox().scale;t.scroll({dx:e.dx*i,dy:e.dy*i})})),e.on("hand.move.end",(function(t){var i=t.context.reactivate;return!Eo(t)&&i&&e.once("hand.move.ended",(function(e){s.activateHand(e.originalEvent,!0,!0)})),!1}))}function kg(e){return vs(" ",e)}Sg.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"],Sg.prototype.activateMove=function(e,t,i){"object"==typeof t&&(i=t,t=!1),this._dragging.init(e,"hand.move",{autoActivate:t,cursor:Eg,data:{context:i||{}}})},Sg.prototype.activateHand=function(e,t,i){this._dragging.init(e,"hand",{trapClick:!1,autoActivate:t,cursor:Eg,data:{context:{reactivate:i}}})},Sg.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateHand(e,!!e)},Sg.prototype.isActive=function(){var e=this._dragging.context();return!!e&&/^(hand|hand\.move)$/.test(e.prefix)};const Ag={__depends__:[Qp,rc],__init__:["handTool"],handTool:["type",Sg]};var Dg="connect-ok",Rg="connect-not-ok";function Pg(e,t,i,n,a,o,s){var r=this;this._dragging=t,this._rules=o,this._mouse=s,a.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),e.on("global-connect.hover",(function(e){var t=e.context,i=e.hover,a=t.canStartConnect=r.canStartConnect(i);null!==a&&(t.startTarget=i,n.addMarker(i,a?Dg:Rg))})),e.on(["global-connect.out","global-connect.cleanup"],(function(e){var t=e.context.startTarget,i=e.context.canStartConnect;t&&n.removeMarker(t,i?Dg:Rg)})),e.on(["global-connect.ended"],(function(t){var n=t.context.startTarget,a={x:t.x,y:t.y};if(r.canStartConnect(n))return e.once("element.out",(function(){e.once(["connect.ended","connect.canceled"],(function(){e.fire("global-connect.drag.ended")})),i.start(null,n,a)})),!1}))}Pg.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"],Pg.prototype.start=function(e,t){this._dragging.init(e,"global-connect",{autoActivate:t,trapClick:!1,data:{context:{}}})},Pg.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();return this.start(e,!!e)},Pg.prototype.isActive=function(){var e=this._dragging.context();return e&&/^global-connect/.test(e.prefix)},Pg.prototype.canStartConnect=function(e){return this._rules.allowed("connection.start",{source:e})};const Lg={__depends__:[Sl,Fr,Rr,Qp,rc],globalConnect:["type",Pg]};function Vg(e,t,i,n,a,o,s,r){this._palette=e,this._create=t,this._elementFactory=i,this._spaceTool=n,this._lassoTool=a,this._handTool=o,this._globalConnect=s,this._translate=r,e.registerProvider(this)}Vg.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],Vg.prototype.getPaletteEntries=function(e){var t={},i=this._create,n=this._elementFactory,a=this._spaceTool,o=this._lassoTool,s=this._handTool,r=this._globalConnect,l=this._translate;function c(e,t,a,o,s){function r(t){var a=n.createShape(Ae({type:e},s));s&&(Ca(a).isExpanded=s.isExpanded),i.start(t,a)}var c=e.replace(/^bpmn:/,"");return{group:t,className:a,title:o||l("Create {type}",{type:c}),action:{dragstart:r,click:r}}}function d(e){var t=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),a=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:t});i.start(e,[t,a],{hints:{autoSelect:[t]}})}function u(e){i.start(e,n.createParticipantShape())}return Ae(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:l("Activate the hand tool"),action:{click:function(e){s.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:l("Activate the lasso tool"),action:{click:function(e){o.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:l("Activate the create/remove space tool"),action:{click:function(e){a.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:l("Activate the global connect tool"),action:{click:function(e){r.start(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":c("bpmn:StartEvent","event","bpmn-icon-start-event-none",l("Create StartEvent")),"create.intermediate-event":c("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",l("Create Intermediate/Boundary Event")),"create.end-event":c("bpmn:EndEvent","event","bpmn-icon-end-event-none",l("Create EndEvent")),"create.exclusive-gateway":c("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",l("Create Gateway")),"create.task":c("bpmn:Task","activity","bpmn-icon-task",l("Create Task")),"create.data-object":c("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",l("Create DataObjectReference")),"create.data-store":c("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",l("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:l("Create expanded SubProcess"),action:{dragstart:d,click:d}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:l("Create Pool/Participant"),action:{dragstart:u,click:u}},"create.group":c("bpmn:Group","artifact","bpmn-icon-group",l("Create Group"))}),t};const Fg={__depends__:[yg,Jl,gm,_g,Ag,Lg,ro],__init__:["paletteProvider"],paletteProvider:["type",Vg]};function Ig(e,t,i,n,a){Yo.call(this,e),e.on("shape.move.move",250,(function(e){var o=e.context,s=o.canExecute;o.visualReplacements||(o.visualReplacements={}),s&&s.replacements?function(e){le(e.canExecute.replacements,(function(o){var s=o.oldElementId,r={type:o.newElementType};if(!e.visualReplacements[s]){var l=t.get(s);Ae(r,{x:l.x,y:l.y});var c=i.createShape(r);n.addShape(c,l.parent);var d=et('[data-element-id="'+Jo()(l.id)+'"]',e.dragGroup);d&&rt(d,{display:"none"});var u=a.addDragger(c,e.dragGroup);e.visualReplacements[s]=u,n.removeShape(c)}}))}(o):function(e){var t=e.visualReplacements;le(t,(function(i,n){var a=et('[data-element-id="'+Jo()(n)+'"]',e.dragGroup);a&&rt(a,{display:"inline"}),i.remove(),t[n]&&delete t[n]}))}(o)}))}Ig.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"],U()(Ig,Yo);const Bg={__depends__:[Wl],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",Ig]};var Tg=["x","y"],jg=Math.abs;function Og(e){e.on(["connect.hover","connect.move","connect.end"],1250,(function(e){var t,i=e.context,n=i.canExecute,a=i.start,o=i.hover,s=i.source,r=i.target;e.originalEvent&&gs(e.originalEvent)||(i.initialConnectionStart||(i.initialConnectionStart=i.connectionStart),n&&o&&function(e,t,i){Tg.forEach((function(n){var a=Wg(n,t);e[n]<t[n]+i?fl(e,n,t[n]+i):e[n]>t[n]+a-i&&fl(e,n,t[n]+a-i)}))}(e,o,function(e){return xa(e,"bpmn:Task")?10:20}(o)),o&&(t=n,ue(["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"],(function(e){return Ng(t,e)})))?(i.connectionStart=pl(a),$a(o,["bpmn:Event","bpmn:Gateway"])&&Mg(e,pl(o)),$a(o,["bpmn:Task","bpmn:SubProcess"])&&function(e,t){var i=pl(t);Tg.forEach((function(n){(function(e,t,i){return e[i]>t[i]+20&&e[i]<t[i]+Wg(i,t)-20})(e,t,n)&&fl(e,n,i[n])}))}(e,o),xa(s,"bpmn:BoundaryEvent")&&r===s.host&&function(e){var t=e.context,i=t.source,n=t.target;if(!function(e){var t=e.hover,i=e.source;return t&&i&&t===i}(t)){var a=pl(i),o=wi(a,n,-10),s=[];/top|bottom/.test(o)&&s.push("x"),/left|right/.test(o)&&s.push("y"),s.forEach((function(t){var i,n=e[t];jg(n-a[t])<40&&(i=n>a[t]?a[t]+40:a[t]-40,fl(e,t,i))}))}}(e)):Ng(n,"bpmn:MessageFlow")?(xa(a,"bpmn:Event")&&(i.connectionStart=pl(a)),xa(o,"bpmn:Event")&&Mg(e,pl(o))):i.connectionStart=i.initialConnectionStart)}))}function Mg(e,t){fl(e,"x",t.x),fl(e,"y",t.y)}function Ng(e,t){return e&&e.type===t}function Wg(e,t){return"x"===e?t.width:t.height}function zg(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}function Ug(e){this._snapValues={}}function qg(e,t,i){var n=this;this._elementRegistry=e,t.on(["create.start","shape.move.start"],(function(e){n.initSnap(e)})),t.on(["create.move","create.end","shape.move.move","shape.move.end"],1250,(function(e){var t=e.context,a=t.shape,o=t.snapContext,s=t.target;if((!e.originalEvent||!gs(e.originalEvent))&&!ml(e)&&s){var r=o.pointsForTarget(s);r.initialized||((r=n.addSnapTargetPoints(r,a,s)).initialized=!0),i.snap(e,r)}})),t.on(["create.cleanup","shape.move.cleanup"],(function(){i.hide()}))}function Hg(e){return!!e.labelTarget}function Gg(e,t){t.invoke(qg,this),e.on(["create.move","create.end"],1500,Zg),e.on(["create.move","create.end","shape.move.move","shape.move.end"],1500,(function(e){var t=e.context,i=t.canExecute,n=t.target;i&&("attach"===i||i.attach)&&!ml(e)&&function(e,t){var i,n=vi(t),a=Xh(e,t),o=e.context.shape;i=o.parent?{x:0,y:0}:yi(o),/top/.test(a)?fl(e,"y",n.top-i.y):/bottom/.test(a)&&fl(e,"y",n.bottom-i.y),/left/.test(a)?fl(e,"x",n.left-i.x):/right/.test(a)&&fl(e,"x",n.right-i.x)}(e,n)}))}function Zg(e){var t=e.context.createConstraints;if(t){var i=t.top,n=t.right,a=t.bottom,o=t.left;(o&&o>=e.x||n&&n<=e.x)&&fl(e,"x",e.x),(i&&i>=e.y||a&&a<=e.y)&&fl(e,"y",e.y)}}function Yg(e,t){return-1!==e.indexOf(t)}function Kg(e,t,i){return t?{x:e.x-i.x,y:e.y-i.y}:{x:e.x,y:e.y}}function Xg(e,t){var i=this;e.on(["resize.start"],(function(e){i.initSnap(e)})),e.on(["resize.move","resize.end"],1250,(function(e){var n=e.context,a=n.shape,o=a.parent,s=n.direction,r=n.snapContext;if(!(e.originalEvent&&gs(e.originalEvent)||ml(e))){var l=r.pointsForTarget(o);l.initialized||((l=i.addSnapTargetPoints(l,a,o,s)).initialized=!0),function(e){return"n"===e||"s"===e}(s)&&fl(e,"x",e.x),function(e){return"e"===e||"w"===e}(s)&&fl(e,"y",e.y),t.snap(e,l)}})),e.on(["resize.cleanup"],(function(){t.hide()}))}function Qg(e,t){var i=yi(e),n=vi(e),a={x:i.x,y:i.y};return-1!==t.indexOf("n")?a.y=n.top:-1!==t.indexOf("s")&&(a.y=n.bottom),-1!==t.indexOf("e")?a.x=n.right:-1!==t.indexOf("w")&&(a.x=n.left),a}function Jg(e){this._canvas=e,this._asyncHide=Ee(Se(this.hide,this),1e3)}Og.$inject=["eventBus"],zg.prototype.getSnapOrigin=function(e){return this._snapOrigins[e]},zg.prototype.setSnapOrigin=function(e,t){this._snapOrigins[e]=t,-1===this._snapLocations.indexOf(e)&&this._snapLocations.push(e)},zg.prototype.addDefaultSnap=function(e,t){var i=this._defaultSnaps[e];i||(i=this._defaultSnaps[e]=[]),i.push(t)},zg.prototype.getSnapLocations=function(){return this._snapLocations},zg.prototype.setSnapLocations=function(e){this._snapLocations=e},zg.prototype.pointsForTarget=function(e){var t=e.id||e,i=this._targets[t];return i||(i=this._targets[t]=new Ug).initDefaults(this._defaultSnaps),i},Ug.prototype.add=function(e,t){var i=this._snapValues[e];i||(i=this._snapValues[e]={x:[],y:[]}),-1===i.x.indexOf(t.x)&&i.x.push(t.x),-1===i.y.indexOf(t.y)&&i.y.push(t.y)},Ug.prototype.snap=function(e,t,i,n){var a=this._snapValues[t];return a&&function(e,t,i){var n,a;for(i=void 0===i?10:i,n=0;n<t.length;n++)if(a=t[n],cl(a-e)<=i)return a}(e[i],a[i],n)},Ug.prototype.initDefaults=function(e){var t=this;le(e||{},(function(e,i){le(e,(function(e){t.add(i,e)}))}))},qg.$inject=["elementRegistry","eventBus","snapping"],qg.prototype.initSnap=function(e){var t,i=this._elementRegistry,n=e.context,a=n.shape,o=n.snapContext;o||(o=n.snapContext=new zg);var s=(t=i.get(a.id)?pl(a,e):{x:e.x+pl(a).x,y:e.y+pl(a).y}).x-a.width/2,r=t.y-a.height/2,l=t.x+a.width/2,c=t.y+a.height/2;return o.setSnapOrigin("mid",{x:t.x-e.x,y:t.y-e.y}),Hg(a)||(o.setSnapOrigin("top-left",{x:s-e.x,y:r-e.y}),o.setSnapOrigin("bottom-right",{x:l-e.x,y:c-e.y})),o},qg.prototype.addSnapTargetPoints=function(e,t,i){return le(this.getSnapTargets(t,i),(function(i){if(Hg(i))Hg(t)&&e.add("mid",pl(i));else if(i.waypoints){if(i.waypoints.length<3)return;le(i.waypoints.slice(1,-1),(function(t){e.add("mid",t)}))}else e.add("mid",pl(i))})),ie(t.x)&&ie(t.y)?(this._elementRegistry.get(t.id)&&e.add("mid",pl(t)),e):e},qg.prototype.getSnapTargets=function(e,t){return gl(t).filter((function(e){return!e.hidden}))},U()(Gg,qg),Gg.$inject=["eventBus","injector"],Gg.prototype.initSnap=function(e){var t=qg.prototype.initSnap.call(this,e),i=e.shape,n=!!this._elementRegistry.get(i.id);return le(i.outgoing,(function(i){var a=i.waypoints[0];a=a.original||a,t.setSnapOrigin(i.id+"-docking",Kg(a,n,e))})),le(i.incoming,(function(i){var a=i.waypoints[i.waypoints.length-1];a=a.original||a,t.setSnapOrigin(i.id+"-docking",Kg(a,n,e))})),xa(i,"bpmn:Participant")&&t.setSnapLocations(["top-left","bottom-right","mid"]),t},Gg.prototype.addSnapTargetPoints=function(e,t,i){qg.prototype.addSnapTargetPoints.call(this,e,t,i);var n=this.getSnapTargets(t,i);le(n,(function(i){var n;(xa(n=i,"bpmn:SubProcess")&&Ta(n)||xa(n,"bpmn:Participant")||("bpmn:TextAnnotation",[t,i].every((function(e){return xa(e,"bpmn:TextAnnotation")}))))&&(e.add("top-left",ul(i)),e.add("bottom-right",hl(i)))}));var a=this._elementRegistry;return le(t.incoming,(function(i){if(a.get(t.id)){Yg(n,i.source)||e.add("mid",yi(i.source));var o=i.waypoints[0];e.add(i.id+"-docking",o.original||o)}})),le(t.outgoing,(function(i){if(a.get(t.id)){Yg(n,i.target)||e.add("mid",yi(i.target));var o=i.waypoints[i.waypoints.length-1];e.add(i.id+"-docking",o.original||o)}})),xa(i,"bpmn:SequenceFlow")&&(e=this.addSnapTargetPoints(e,t,i.parent)),e},Gg.prototype.getSnapTargets=function(e,t){return qg.prototype.getSnapTargets.call(this,e,t).filter((function(e){return!xa(e,"bpmn:Lane")}))},Xg.prototype.initSnap=function(e){var t=e.context,i=t.shape,n=t.direction,a=t.snapContext;a||(a=t.snapContext=new zg);var o=Qg(i,n);return a.setSnapOrigin("corner",{x:o.x-e.x,y:o.y-e.y}),a},Xg.prototype.addSnapTargetPoints=function(e,t,i,n){return le(this.getSnapTargets(t,i),(function(t){e.add("corner",hl(t)),e.add("corner",ul(t))})),e.add("corner",Qg(t,n)),e},Xg.$inject=["eventBus","snapping"],Xg.prototype.getSnapTargets=function(e,t){return gl(t).filter((function(t){return i=e,!(t.host===i||function(e){return!!e.waypoints}(t)||function(e){return!!e.hidden}(t)||function(e){return!!e.labelTarget}(t));var i}))},Jg.$inject=["canvas"],Jg.prototype.snap=function(e,t){var i=e.context.snapContext,n=i.getSnapLocations(),a={x:ml(e,"x"),y:ml(e,"y")};le(n,(function(n){var o=i.getSnapOrigin(n),s={x:e.x+o.x,y:e.y+o.y};if(le(["x","y"],(function(e){var i;a[e]||void 0!==(i=t.snap(s,n,e,7))&&(a[e]={value:i,originValue:i-o[e]})})),a.x&&a.y)return!1})),this.showSnapLine("vertical",a.x&&a.x.value),this.showSnapLine("horizontal",a.y&&a.y.value),le(["x","y"],(function(t){var i=a[t];te(i)&&fl(e,t,i.originValue)}))},Jg.prototype._createLine=function(e){var t=this._canvas.getLayer("snap"),i=wt("path");return rt(i,{d:"M0,0 L0,0"}),ht(i).add("djs-snap-line"),at(t,i),{update:function(t){ie(t)?rt(i,"horizontal"===e?{d:"M-100000,"+t+" L+100000,"+t,display:""}:{d:"M "+t+",-100000 L "+t+", +100000",display:""}):rt(i,{display:"none"})}}},Jg.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}},Jg.prototype.showSnapLine=function(e,t){var i=this.getSnapLine(e);i&&i.update(t),this._asyncHide()},Jg.prototype.getSnapLine=function(e){return this._snapLines||this._createSnapLines(),this._snapLines[e]},Jg.prototype.hide=function(){le(this._snapLines,(function(e){e.update()}))};const ev={__depends__:[{__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",qg],resizeSnapping:["type",Xg],snapping:["type",Jg]}],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",Og],createMoveSnapping:["type",Gg]};function tv(e,t,i,n){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=e,this._eventBus=t,this._overlays=i,this._selection=n,this._container=Xe(tv.BOX_HTML),this._searchInput=et(tv.INPUT_SELECTOR,this._container),this._resultsContainer=et(tv.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),t.on(["canvas.destroy","diagram.destroy"],this.close,this)}function iv(e,t,i){var n=function(e){var t="";return e.forEach((function(e){e.matched?t+='<strong class="'+tv.RESULT_HIGHLIGHT_CLASS+'">'+ts(e.matched)+"</strong>":t+=ts(e.normal)})),""!==t?t:null}(t),a=Xe(i);a.innerHTML=n,e.appendChild(a)}tv.$inject=["canvas","eventBus","overlays","selection"],tv.prototype._bindEvents=function(){var e=this;function t(t,i,n,a){e._eventMaps.push({el:t,type:n,listener:Ye(t,i,n,a)})}t(document,"html","click",(function(t){e.close()})),t(this._container,tv.INPUT_SELECTOR,"click",(function(e){e.stopPropagation(),e.delegateTarget.focus()})),t(this._container,tv.RESULT_SELECTOR,"mouseover",(function(t){t.stopPropagation(),e._scrollToNode(t.delegateTarget),e._preselect(t.delegateTarget)})),t(this._container,tv.RESULT_SELECTOR,"click",(function(t){t.stopPropagation(),e._select(t.delegateTarget)})),t(this._container,tv.INPUT_SELECTOR,"keydown",(function(e){38===e.keyCode&&e.preventDefault(),40===e.keyCode&&e.preventDefault()})),t(this._container,tv.INPUT_SELECTOR,"keyup",(function(t){if(27===t.keyCode)return e.close();if(13===t.keyCode){var i=e._getCurrentResult();return i?e._select(i):e.close()}return 38===t.keyCode?e._scrollToDirection(!0):40===t.keyCode?e._scrollToDirection():void(37!==t.keyCode&&39!==t.keyCode&&e._search(t.delegateTarget.value))}))},tv.prototype._unbindEvents=function(){this._eventMaps.forEach((function(e){Ke(e.el,e.type,e.listener)}))},tv.prototype._search=function(e){var t=this;if(this._clearResults(),e&&""!==e){var i=this._searchProvider.find(e);if(i.length){i.forEach((function(e){var i=e.element.id,n=t._createResultNode(e,i);t._results[i]={element:e.element,node:n}}));var n=et(tv.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(n),this._preselect(n)}}},tv.prototype._scrollToDirection=function(e){var t=this._getCurrentResult();if(t){var i=e?t.previousElementSibling:t.nextElementSibling;i&&(this._scrollToNode(i),this._preselect(i))}},tv.prototype._scrollToNode=function(e){if(e&&e!==this._getCurrentResult()){var t=e.offsetTop,i=this._resultsContainer.scrollTop,n=t-this._resultsContainer.clientHeight+e.clientHeight;t<i?this._resultsContainer.scrollTop=t:i<n&&(this._resultsContainer.scrollTop=n)}},tv.prototype._clearResults=function(){je(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")},tv.prototype._getCurrentResult=function(){return et(tv.RESULT_SELECTED_SELECTOR,this._resultsContainer)},tv.prototype._createResultNode=function(e,t){var i=Xe(tv.RESULT_HTML);return e.primaryTokens.length>0&&iv(i,e.primaryTokens,tv.RESULT_PRIMARY_HTML),iv(i,e.secondaryTokens,tv.RESULT_SECONDARY_HTML),Pe(i,tv.RESULT_ID_ATTRIBUTE,t),this._resultsContainer.appendChild(i),i},tv.prototype.registerProvider=function(e){this._searchProvider=e},tv.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,Be(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))},tv.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,Be(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))},tv.prototype.toggle=function(){this.isOpen()?this.close():this.open()},tv.prototype.isOpen=function(){return this._open},tv.prototype._preselect=function(e){var t=this._getCurrentResult();if(e!==t){t&&Be(t).remove(tv.RESULT_SELECTED_CLASS);var i=Pe(e,tv.RESULT_ID_ATTRIBUTE),n=this._results[i].element;Be(e).add(tv.RESULT_SELECTED_CLASS),this._resetOverlay(n),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.preselected",n)}},tv.prototype._select=function(e){var t=Pe(e,tv.RESULT_ID_ATTRIBUTE),i=this._results[t].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(i,{top:400}),this._selection.select(i),this._eventBus.fire("searchPad.selected",i)},tv.prototype._resetOverlay=function(e){if(this._overlayId&&this._overlays.remove(this._overlayId),e){var t=(i=Jt(e),n=i.width+12,{position:{bottom:(a=i.height+12)-6,right:n-6},show:!0,html:'<div style="'+["width: "+n+"px","height: "+a+"px"].join("; ")+'" class="'+tv.OVERLAY_CLASS+'"></div>'});this._overlayId=this._overlays.add(e,t)}var i,n,a},tv.CONTAINER_SELECTOR=".djs-search-container",tv.INPUT_SELECTOR=".djs-search-input input",tv.RESULTS_CONTAINER_SELECTOR=".djs-search-results",tv.RESULT_SELECTOR=".djs-search-result",tv.RESULT_SELECTED_CLASS="djs-search-result-selected",tv.RESULT_SELECTED_SELECTOR="."+tv.RESULT_SELECTED_CLASS,tv.RESULT_ID_ATTRIBUTE="data-result-id",tv.RESULT_HIGHLIGHT_CLASS="djs-search-highlight",tv.OVERLAY_CLASS="djs-search-overlay",tv.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>',tv.RESULT_HTML='<div class="djs-search-result"></div>',tv.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>',tv.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const nv={__depends__:[Ho,Oo],searchPad:["type",tv]};function av(e,t,i){this._elementRegistry=e,this._canvas=i,t.registerProvider(this)}function ov(e){return re(e,(function(e){return!!e.matched})).length>0}function sv(e,t){var i=[],n=e;if(!e)return i;e=e.toLowerCase(),t=t.toLowerCase();var a=e.indexOf(t);return a>-1?(0!==a&&i.push({normal:n.substr(0,a)}),i.push({matched:n.substr(a,t.length)}),t.length+a<e.length&&i.push({normal:n.substr(t.length+a,e.length)})):i.push({normal:n}),i}av.$inject=["elementRegistry","searchPad","canvas"],av.prototype.find=function(e){var t=this._canvas.getRootElement(),i=this._elementRegistry.filter((function(e){return!e.labelTarget}));return i=re(i,(function(e){return e!==t})),ye(i=re(i=he(i,(function(t){return{primaryTokens:sv(Na(t),e),secondaryTokens:sv(t.id,e),element:t}})),(function(e){return ov(e.primaryTokens)||ov(e.secondaryTokens)})),(function(e){return Na(e.element)+e.element.id}))};const rv={__depends__:[nv],__init__:["bpmnSearch"],bpmnSearch:["type",av]};function lv(e){Ba.call(this,e)}U()(lv,Ba),lv.Viewer=fs,lv.NavigatedViewer=Us,lv.prototype.createDiagram=va((function(){return this.importXML('<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>')})),lv.prototype._interactionModules=[Ds,Ts,Js,zs],lv.prototype._modelingModules=[or,vr,Lr,_r,wl,Sl,Al,dd,wc,Jl,fd,xd,Id,Td,Od,Gd,du,sg,fg,Fg,Bg,iu,ev,rv],lv.prototype._modules=[].concat(fs.prototype._modules,lv.prototype._interactionModules,lv.prototype._modelingModules);var cv=i(3379),dv=i.n(cv),uv=i(7795),hv=i.n(uv),pv=i(569),mv=i.n(pv),fv=i(3565),gv=i.n(fv),vv=i(9216),bv=i.n(vv),yv=i(4589),wv=i.n(yv),xv=i(1629),$v={};$v.styleTagTransform=wv(),$v.setAttributes=gv(),$v.insert=mv().bind(null,"head"),$v.domAPI=hv(),$v.insertStyleElement=bv(),dv()(xv.Z,$v),xv.Z&&xv.Z.locals&&xv.Z.locals;var _v=i(2622),Cv={};Cv.styleTagTransform=wv(),Cv.setAttributes=gv(),Cv.insert=mv().bind(null,"head"),Cv.domAPI=hv(),Cv.insertStyleElement=bv(),dv()(_v.Z,Cv),_v.Z&&_v.Z.locals&&_v.Z.locals;var Ev=i(5367),Sv={};Sv.styleTagTransform=wv(),Sv.setAttributes=gv(),Sv.insert=mv().bind(null,"head"),Sv.domAPI=hv(),Sv.insertStyleElement=bv(),dv()(Ev.Z,Sv),Ev.Z&&Ev.Z.locals&&Ev.Z.locals;class kv extends Ut{constructor(e,t){super(e,1500),this.bpmnRenderer=t}canRender(e){return $a(e,["bpmn:Task","bpmn:Event","bpmn:ExclusiveGateway"])&&!e.labelTarget}drawShape(e,t){const i=this.bpmnRenderer.drawShape(e,t);if(t.___abwarnings){const t=function(e,t,i){let n=[{x:0,y:0},{x:t,y:0},{x:t/2,y:-20}].map((function(e){return e.x+","+e.y})).join(" ");const a=wt("polygon");return rt(a,{points:n,stroke:"#f90",strokeWidth:2,fill:"#f90"}),at(e,a),a}(e,20);rt(t,{transform:"translate(-10, 10)"})}return i}getShapePath(e){return xa(e,"bpmn:Task")?Ga(e,2):this.bpmnRenderer.getShapePath(e)}}function Av(){return kv}function Dv(e,t,i,n,a,o,s){this._palette=e,this._create=t,this._elementFactory=i,this._spaceTool=n,this._lassoTool=a,this._handTool=o,this._translate=s,e.registerProvider(this)}kv.$inject=["eventBus","bpmnRenderer"],Dv.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","translate","eventBus"],Dv.prototype.getPaletteEntries=function(){var e=this._create,t=this._elementFactory,i=this._spaceTool,n=this._lassoTool,a=this._handTool,o=this._translate;function s(i,n,a,s,r){function l(n){var a={type:i};if(r)for(var o in r)a[o]=r[o];var s=t.createShape(a);r&&(s.businessObject.di.isExpanded=r.isExpanded),e.start(n,s)}var c=i.replace(/^bpmn:/,"");return{group:n,className:a,title:s||o("Create {type}",{type:c}),action:{dragstart:l,click:l}}}function r(i,n){e.start(i,t.createParticipantShape(n))}return{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:o("Activate the hand tool"),action:{click:function(e){a.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:o("Activate the lasso tool"),action:{click:function(e){n.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:o("Activate the create/remove space tool"),action:{click:function(e){i.activateSelection(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":s("bpmn:StartEvent","event","bpmn-icon-start-event-none"),"create.end-event":s("bpmn:EndEvent","event","bpmn-icon-end-event-none"),"create.exclusive-gateway":s("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-xor"),"create.task":s("bpmn:Task","activity","bpmn-icon-task"),"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:o("Create Pool/Participant"),action:{dragstart:r,click:r}}}};const Rv=["bpmn:Task","bpmn:StartEvent","bpmn:EndEvent"];function Pv(e,t){0==e.length?t():e.shift()((i=>{if(i)return t(i);Pv(e,t)}))}function Lv(e){return"bpmn:SubProcess"==e.parent?.type}function Vv(e){const t="ui_work_process_workspace_model",i=e.Config.uiSettings(),a=(0,n.Z)(e),o=a.L(),r=s(e,`${t}_view_warnings`),l=function(e){const t=Av(),i=Dv,n=function(e){const t=e.Class.ABProcessTaskManager;function i(e,t,i,n,a,o){this._popupMenu=e,this._modeling=t,this._moddle=i,this._bpmnReplace=n,this._rules=a,this._translate=o,this.register()}return i.$inject=["popupMenu","modeling","moddle","bpmnReplace","rules","translate"],i.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)},i.prototype.getEntries=function(e){var i,n=e.businessObject;if(!this._rules.allowed("shape.replace",{element:e}))return[];var a=Dc(e);return xa(n,"bpmn:StartEvent")&&!ja(n.$parent)?n.$parent&&"bpmn:SubProcess"==n.$parent.$type?[]:(i=re(t.StartEvents(),a),this._createEntries(e,i)):xa(n,"bpmn:Participant")?(i=re(Uc,(function(e){return Ta(n)!==e.target.isExpanded})),this._createEntries(e,i)):xa(n,"bpmn:StartEvent")&&ja(n.$parent)?n.$parent&&"bpmn:SubProcess"==n.$parent.$type?[]:(i=re(Wc,(function(t){var i=!1!==t.target.isInterrupting,n=_a(e).isInterrupting===i;return a(t)||!a(t)&&!n})),this._createEntries(e,i)):xa(n,"bpmn:EndEvent")?(i=re(t.EndEvents(),(function(e){return!("bpmn:CancelEventDefinition"==e.target.eventDefinitionType&&!xa(n.$parent,"bpmn:Transaction"))&&a(e)})),this._createEntries(e,i)):xa(n,"bpmn:BoundaryEvent")?(i=re(Nc,(function(e){var t=e.target;if("bpmn:CancelEventDefinition"==t.eventDefinition&&!xa(n.attachedToRef,"bpmn:Transaction"))return!1;var i=!1!==t.cancelActivity,o=n.cancelActivity==i;return a(e)||!a(e)&&!o})),this._createEntries(e,i)):xa(n,"bpmn:IntermediateCatchEvent")||xa(n,"bpmn:IntermediateThrowEvent")?(i=re(Lc,a),this._createEntries(e,i)):xa(n,"bpmn:Gateway")?(i=re(t.Gateways(),a),this._createEntries(e,i)):xa(n,"bpmn:Transaction")?(i=re(Bc,a),this._createEntries(e,i)):ja(n)&&Ta(n)?(i=re(Tc,a),this._createEntries(e,i)):xa(e,"bpmn:SubProcess")&&Ta(e)?(i=re(Ic,a),this._createEntries(e,i)):xa(n,"bpmn:AdHocSubProcess")&&!Ta(n)?(i=re(jc,(function(t){var i=t.target,n="bpmn:SubProcess"===i.type,a=!0===i.isExpanded;return Dc(e)&&(!n||a)})),this._createEntries(e,i)):xa(n,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,zc):xa(n,"bpmn:FlowNode")?(i=re(t.Tasks(),a),xa(n,"bpmn:SubProcess")&&!Ta(n)&&(i=re(i,(function(e){return"Sub Process (collapsed)"!==e.label}))),this._createEntries(e,i)):[]},i.prototype.getHeaderEntries=function(e){var t=[];return xa(e,"bpmn:Activity")&&!ja(e)&&(t=t.concat(this._getLoopEntries(e))),!xa(e,"bpmn:SubProcess")||xa(e,"bpmn:Transaction")||ja(e)||t.push(this._getAdHocEntry(e)),t},i.prototype._createEntries=function(e,t){var i=[],n=this;return le(t,(function(t){var a=n._createMenuEntry(t,e);i.push(a)})),i},i.prototype._createSequenceFlowEntries=function(e,t){var i=_a(e),n=[],a=this._modeling,o=this._moddle,s=this;return le(t,(function(t){switch(t.actionName){case"replace-with-default-flow":i.sourceRef.default!==i&&(xa(i.sourceRef,"bpmn:ExclusiveGateway")||xa(i.sourceRef,"bpmn:InclusiveGateway")||xa(i.sourceRef,"bpmn:ComplexGateway")||xa(i.sourceRef,"bpmn:Activity"))&&n.push(s._createMenuEntry(t,e,(function(){a.updateProperties(e.source,{default:i})})));break;case"replace-with-conditional-flow":!i.conditionExpression&&xa(i.sourceRef,"bpmn:Activity")&&n.push(s._createMenuEntry(t,e,(function(){var t=o.create("bpmn:FormalExpression",{body:""});a.updateProperties(e,{conditionExpression:t})})));break;default:if(xa(i.sourceRef,"bpmn:Activity")&&i.conditionExpression)return n.push(s._createMenuEntry(t,e,(function(){a.updateProperties(e,{conditionExpression:void 0})})));if((xa(i.sourceRef,"bpmn:ExclusiveGateway")||xa(i.sourceRef,"bpmn:InclusiveGateway")||xa(i.sourceRef,"bpmn:ComplexGateway")||xa(i.sourceRef,"bpmn:Activity"))&&i.sourceRef.default===i)return n.push(s._createMenuEntry(t,e,(function(){a.updateProperties(e.source,{default:void 0})})))}})),n},i.prototype._createMenuEntry=function(e,t,i){var n=this._translate,a=this._bpmnReplace.replaceElement;i=i||function(){return a(t,e.target)};let o=e.label;return"function"==typeof e.label&&(o=e.label(t)),{label:n(o),className:e.className,id:e.actionName,action:i}},i.prototype._getLoopEntries=function(e){var t=this,i=this._translate;function n(i,n){var a;n.active?a=void 0:(a=t._moddle.create(n.options.loopCharacteristics),n.options.isSequential&&(a.isSequential=n.options.isSequential)),t._modeling.updateProperties(e,{loopCharacteristics:a})}var a,o,s,r=_a(e).loopCharacteristics;return r&&(a=r.isSequential,o=void 0===r.isSequential,s=void 0!==r.isSequential&&!r.isSequential),[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:i("Parallel Multi Instance"),active:s,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:i("Sequential Multi Instance"),active:a,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:i("Loop"),active:o,action:n,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}]},i.prototype._getAdHocEntry=function(e){var t=this._translate,i=xa(_a(e),"bpmn:AdHocSubProcess"),n=this._bpmnReplace.replaceElement;return{id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:i,action:function(){return n(e,i?{type:"bpmn:SubProcess"}:{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}}},i}(e);return{__init__:["customRenderer","paletteProvider","replaceMenuProvider"],customRenderer:["type",t],paletteProvider:["type",i],replaceMenuProvider:["type",n]}}(e),c=(0,j.Z)(e);return new class extends a{constructor(){super(t,{button:"",component:"",modeler:"",modelerBroken:"",modelerWorking:"",properties:"",propertyPanel:""}),this.viewer=null,this.unsavedChanges=!1,this.CurrentPropertiesObj=null,this.panelsByType={},this.panelSelectElement={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("Select an element to edit.")}</div>`},this.panelGenericEndEvent={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("This is a generic BPMN End Event placeholder. Change it to one of our Specific End Event Types to edit.")}</div>`},this.panelGenericTrigger={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("This is a generic BPMN Trigger placeholder. Change it to one of our Specific Trigger Types to edit.")}</div>`},this.panelGenericService={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("This is a generic BPMN Task placeholder. Change it to one of our Specific Tasks to edit.")}</div>`}}ui(){let e=this.ids;return{id:e.component,css:"bg_gray",rows:[{id:e.button,view:"button",css:"webix_primary",type:"form",label:o("Save"),icon:"fa fa-save",click:()=>{this.saveProcess(this.CurrentProcess)}},{id:e.modelerWorking,cols:[{view:"template",template:`<div id="${e.modeler}" style="width: 100%; height: 100%;"></div>`},{view:"resizer",css:"bg_gray",width:11},{width:i.columnWidthXXLarge,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{type:"spacer",width:15},{view:"label",label:o("Properties")}]},{view:"scrollview",id:e.propertyPanel,body:{padding:15,rows:[{id:e.properties,view:"template",template:`<div id="${e.properties}_div">properties here!</div>`}]}}]}]},{id:e.modelerBroken,view:"template",template:'<div  style="width: 100%; height: 100%;"> Big Broken Icon Here </div>'},r.ui()]}}init(e){this.AB=e;let t=this.ids;$$(t.button)?.hide(),$$(t.modelerBroken)?.hide(),$$(t.modelerWorking)?.show(),c.processElements().forEach((e=>{this.panelsByType[e.key]=new e})),webix.ui(this.panelSelectElement,$$(t.properties))}applicationLoad(e){super.applicationLoad(e),Object.keys(this.panelsByType).forEach((t=>{this.panelsByType[t].applicationLoad(e)}))}checkKnownElement(e,t){const i=this.CurrentProcess.elementForDiagramID(e.id);if(Rv.indexOf(e.type)>-1&&!i){let i=t?.type??"unknown";i=e.parent?.type??e.businessObject?.$parent?.$type??i,"bpmn:SubProcess"!=i||-1==["bpmn:StartEvent","bpmn:EndEvent"].indexOf(e.type)?(e.___abwarnings=["generic task"],this.CurrentProcess.unknownShape(e),this.emit("warnings")):delete e.___abwarnings}if(i){const t=i.warnings();t.length>0&&(e.___abwarnings=t)}}clearWorkspace(){this.CurrentProcessID=null,this.unsavedChanges=!1}async saveProcess(e){this.CurrentPropertiesObj&&this.propertiesSave();try{let{xml:t}=await this.viewer.saveXML({preamble:!0});e.modelUpdate(t),await e.save(),this.unsavedChanges=!1,this.warningsRefresh(this.CurrentProcess),r.show(this.CurrentProcess),$$(this.ids.button).hide()}catch(e){this.AB.notify.developer(e,{context:"ui_work_process_workspace_model:saveProcess()"})}}processLoad(e){var t=this.ids;if(Object.keys(this.panelsByType).forEach((t=>{this.panelsByType[t]?.processLoad?.(e)})),!this.viewer){$$(t.modelerBroken).hide(),$$(t.modelerWorking).show();const e=document.getElementById(t.modeler);this.viewer=new lv({container:e,additionalModules:[l],moddleExtensions:{ab:{name:"AppBuilder",uri:"http://some-company/schema/bpmn/ab",prefix:"ab",xml:{tagAlias:"lowerCase"},types:[{name:"SignalLifecycle",extends:["bpmn:SignalEventDefinition"],properties:[]},{name:"SignalTriggerTimer",extends:["bpmn:SignalEventDefinition"],properties:[]}],emumerations:[],associations:[]}}}),this.viewer.on(["bpmnElement.added"],(e=>{var t=e.element;"bpmn:SequenceFlow"!=t.type&&"bpmn:MessageFlow"!=t.type||this.CurrentProcess?.connectionUpsert(t)})),this.viewer.on("shape.add",(e=>{this.checkKnownElement(e.element,e.parent)})),this.viewer.on("shape.remove",(e=>{if(this.CurrentProcess){let n=this.CurrentProcess;var t=e.element;if(Lv(t)&&(n=this.CurrentProcess.elementForDiagramID(t.parent.id)||this.CurrentProcess),"bpmn:SequenceFlow"==t.type||"bpmn:MessageFlow"==t.type)n.connectionRemove(t);else{var i=n.elementForDiagramID(t.id);i&&i.destroy(),this.CurrentProcess.connectionsIncoming(t.id).forEach((e=>{this.CurrentProcess.connectionRemove(e);var t=this.CurrentProcess.elementForDiagramID(e.from);t&&(t.warningsEval(),this.timedUpdate(t))}))}this.CurrentProcess.unknownShapeRemove(t)}})),this.viewer.on("element.changed",(e=>{let i=e.element;if("label"==i.type)return;let n=this.CurrentProcess;if(Lv(i)&&(n=this.CurrentProcess.elementForDiagramID(i.parent.id)||this.CurrentProcess),null!=n)if("bpmn:SequenceFlow"!=i.type&&"bpmn:MessageFlow"!=i.type){var a=n.elementForDiagramID(i.id);if(a)a.onChange(i,t.properties);else if(this.viewer.get("elementRegistry").get(i.id)){var o=null,s=null;e.element.businessObject.eventDefinitions&&(o=e.element.businessObject.eventDefinitions[0]),o&&(s=o.$type),-1==Rv.indexOf(i.type)||s?n.elementNewForModelDefinition(i)?this.viewer.get("canvas").removeMarker(i.id,"highlight-undefined-task"):this.AB.notify.developer(new Error("no ProcessElement for BPMN Element"),{element:i}):this.viewer.get("canvas").addMarker(i.id,"highlight-undefined-task")}}else{n.connectionUpsert(i);let e=this.CurrentProcess.connectionForDiagramID(i.id);if(e){let t=this.CurrentProcess.elementForDiagramID(e.from);if(t)if(t.___pendingUpdate)t.___pendingUpdate--,0==t.___pendingUpdate&&delete t.___pendingUpdate;else{let e=t.diagramProperties(this.viewer);e=e.filter((e=>e.id.indexOf("Flow")>-1)),e.length>0&&(t.___pendingUpdate=e.length),t.warningsEval(),this.timedUpdate(t)}}}})),this.viewer.on("selection.changed",(e=>{if(this.CurrentProcess)if(1==e.newSelection.length){let n=e.newSelection[0];var i=this.CurrentProcess.elementForDiagramID(n.id);if(Lv(n)&&null==i){let e=this.CurrentProcess.elementForDiagramID(n.parent.id);e&&(i=e.elementForDiagramID(n.id))}if(i)this.CurrentPropertiesObj&&this.CurrentPropertiesObj.diagramID!=i.diagramID&&this.propertiesSave(),this.CurrentPropertiesObj=i,this.CurrentPropertiesObj._handlerSwitchTo||(this.CurrentPropertiesObj._handlerSwitchTo=e=>{this.CurrentPropertiesObj=e,this.panelShow(e)},this.CurrentPropertiesObj.on("switchTo",this.CurrentPropertiesObj._handlerSwitchTo)),this.panelShow(i),this.CurrentPropertiesObj._handlerSave||(this.CurrentPropertiesObj._handlerSave=()=>{this.saveProcess(this.CurrentProcess),this.CurrentPropertiesObj?.propertiesShow(t.properties)},this.CurrentPropertiesObj.on("save",this.CurrentPropertiesObj._handlerSave));else{this.CurrentPropertiesObj=null,Lv(n)&&-1!=["bpmn:StartEvent","bpmn:EndEvent"].indexOf(n.type)||console.warn("Selected Element is unknown to this Process: "+e.newSelection[0].id);let i=this.panelSelectElement;switch(n.type){case"bpmn:EndEvent":i=this.panelGenericEndEvent;break;case"bpmn:StartEvent":i=this.panelGenericTrigger;break;case"bpmn:Task":i=this.panelGenericService}webix.ui(i,$$(t.properties)),this.CurrentPanel=i}}else this.CurrentPropertiesObj&&this.propertiesSave(),this.CurrentPropertiesObj=null,$$(t.properties).hide()})),this.viewer.on("commandStack.changed",(()=>{this.unsavedChanges=!0,$$(t.button).show()}))}var i=[];this.CurrentProcess&&this.unsavedChanges&&i.push((e=>{webix.confirm({title:o("Save?"),text:o("Save your changes to {0}?",[this.CurrentProcess.label]),callback:i=>{i?this.saveProcess(this.CurrentProcess).then((()=>{e()})).catch(e):(this.unsavedChanges=!1,$$(t.button).hide(),e())}})})),i.push((async i=>{this.CurrentProcessID=null,this.viewer.clear(),super.processLoad(e),this.CurrentPropertiesObj=null,$$(t.properties).hide();var n=e.modelDefinition();n||(e.modelNew(),n=e.modelDefinition());try{await this.viewer.importXML(n),this.viewer.get("canvas").zoom("fit-viewport","auto"),i()}catch(e){i(e)}})),Pv(i,(i=>{i&&(i.toString().indexOf("no diagram to display")&&webix.confirm({title:o("Error Displaying Process"),message:o("Could not display the process definition for {0}. Do you want to start a blank process?",[this.CurrentProcess.name]),callback:i=>{i?(e.modelNew(),this.processLoad(this.CurrentProcess)):($$(t.modelerWorking).hide(),$$(t.modelerBroken).show(),this.viewer.clear(),this.viewer.destroy(),this.viewer=null)}}),this.AB.notify.developer(i,{context:"error during the process of changing the Process"})),$$(t.modelerBroken).hide(),$$(t.modelerWorking).show(),this.warningsRefresh(this.CurrentProcess),r.show(this.CurrentProcess)}))}panelShow(e){let t={ui:()=>this.panelSelectElement};this.panelsByType[e.key]&&(t=this.panelsByType[e.key]);let i={id:this.ids.properties,rows:[t.ui(e),{}]};webix.ui(i,$$(this.ids.properties)),t.populate?.(e),this.CurrentPanel=t}propertiesSave(){if(this.CurrentPanel&&"function"==typeof this.CurrentPanel.values){var e=this.CurrentPropertiesObj,t=this.CurrentPanel.values(),i=e.toObj();Object.keys(t).forEach((e=>{i[e]=t[e]})),e.name||(i.name=t.label),e.fromValues(i),e.warningsEval(),this.timedUpdate(e)}}show(){$$(this.ids.component).show()}timedUpdate(e){setTimeout((()=>{e.diagramProperties(this.viewer).forEach((e=>{this.updateElementProperties(e.id,e.def,e.warn)})),this.warningsRefresh(this.CurrentProcess),r.show(this.CurrentProcess)}),0)}updateElementProperties(e,t,i){var n=this.viewer.get("elementRegistry").get(e);n&&(i?n.___abwarnings=i:delete n.___abwarnings,this.viewer.get("modeling").updateProperties(n,t))}warningsRefresh(e){let t=e.elements();super.warningsRefresh(e),t.forEach((t=>e.elementAdd(t)))}}}function Fv(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_version_list"),this.AB={},this.ListComponent=function(e,t){const i=e.Config.uiSettings();var n=function(...t){return e.Multilingual.labelPlugin("ABDesigner",...t)};class a extends e.ClassUI{constructor(e){e.idBase=e.idBase||"ui_common_list";var t=e.idBase||"ui_common_list";if(super(t,{listSetting:"",vList:"",buttonNew:""}),this.idBase=t,this.labels={addNew:"Add new item",confirmDeleteTitle:"Delete Item"},e.labels)for(var i in e.labels)this.labels[i]=e.labels[i];e.menu=e.menu||{},e.menu.copy=void 0===e.menu.copy||e.menu.copy,e.menu.exclude=void 0===e.menu.exclude||e.menu.exclude,this.attributes=e,this._templateListItem="<div class='ab-object-list-item'>#version# - #changelog.author# <div style='padding-left:18px'>#changelog.commitMessage#</div></div>",this.cacheTemplate={},this.CurrentApplication=null,this.itemList=null,this._initialized=!1,this._settings={}}ui(){var t=this.ids;return{id:this.ids.component,rows:[{view:"list",id:this.ids.vList,width:i.columnWidthLarge,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",type:{height:57},template:(e,t)=>this.templateListItem(e,t),on:{onAfterSelect:e=>{this.onSelectItem(e)},onBeforeEditStop:(e,t)=>{this.onBeforeEditStop(e,t)},onAfterEditStop:(e,t,i)=>{this.onAfterEditStop(e,t,i)},onAfterRender(){this.data.each((i=>{e.ClassUI.CYPRESS_REF(this.getItemNode(i.id),`${t.list}_${i.id}`)}))}}},{view:"button",css:"webix_primary",id:this.ids.buttonNew,value:"Clear",type:"form",click:()=>{this.clearForm(!0)},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}}init(e){this.AB=e,$$(this.ids.component)&&$$(this.ids.component).adjust(),this.$list=$$(this.ids.vList),this._initialized=!0}applicationLoad(e){this.CurrentApplication=e}dataLoad(t){if(this.busy(),!t)return this.AB.notify.developer("No version Data",{context:"ui_work_version_list:dataLoad()",versionData:t}),this.clearForm(),void this.ready();var i=t.changeLog;this.itemList=new webix.DataCollection({data:function(t){const i=t,n=Object.keys(t).sort(((e,t)=>{const[i,n,a]=e.split(".").map((e=>parseInt(e))),[o,s,r]=t.split(".").map((e=>parseInt(e)));return i!==o?o-i:n!==s?s-n:r-a})).map(((n,a)=>"string"==typeof t[n]?(e.notify.developer(new Error,{context:"ui_version_list.loadData()",message:"The changelog object is not in the correct format.",version:n}),{version:n,id:a}):(t[n].versionNumber=n,{id:a,label:n,version:n,changelog:t[n],commitMessage:i[n].commitMessage,author:i[n].author,timestamp:i[n].timestamp,changeSize:i[n].changeSize})));return n}(i)});var n=this.$list||$$(this.ids.vList);n&&(n.clearAll(),n.data.unsync(),n.data.sync(this.itemList),n.refresh(),n.unselectAll()),this.ready()}busy(){this.$list?.showProgress?.({type:"icon"})}ready(){this.$list?.hideProgress?.()}onSelectItem(e){var t=this.$list.getItem(e);this.emit("selected",t)}clearForm(){this.emit("selected")}save(){this._initialized&&this.AB.Storage.set(this.idBase,this._settings)}selectItem(e){this.$list.blockEvent(),this.select(e),this.$list.unblockEvent()}templateListItem(e,t){return this.cacheTemplate[e.id]||("string"==typeof this._templateListItem?this.cacheTemplate[e.id]=this._templateListItem.replace("#label#",e.label||"??label??").replace("#title#",e.title||"??title??").replace("#year#",e.year||"??year??").replace("#version#",e.version||"??version??").replace("#changelog.author#",e.changelog?.author||"??changelog.author??").replace("#changelog.commitMessage#",e.changelog?.commitMessage||"??changelog.commitMessage??"):this.cacheTemplate[e.id]=this._templateListItem(e,t),setTimeout((()=>{delete this.cacheTemplate[e.id]}),400)),this.cacheTemplate[e.id]}exclude(){var e=this.$list.getSelectedItem(!1);this.emit("exclude",e)}rename(){var e=this.$list.getSelectedId(!1);this.$list.edit(e)}remove(){var e=this.$list.getSelectedItem(!1);webix.confirm({title:n(this.labels.confirmDeleteTitle),text:n(this.labels.confirmDeleteMessage,[e.label]),ok:n("Yes"),cancel:n("No"),callback:async t=>{if(t){this.busy();try{await e.destroy(),this.ready(),this.itemList.remove(e.id),this.emit("deleted",e),this.emit("selected",null)}catch(e){this.AB.notify.developer(e,{context:"ui_common_list:remove(): error removing item"}),this.ready()}}}})}select(e){this.$list.select(e)}callbackProcessEditorMenu(e){switch(e){case"rename":this.rename();break;case"exclude":this.exclude();break;case"delete":this.remove()}}}return new a(t)}(e,{idBase:this.ids.component,labels:{addNew:"Add new Version",title:"Versions",searchPlaceholder:"Version"}})}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,await this.ListComponent.init(e),this.on("addNew",((e,t)=>{let i=e.versionData||e.json.versionData;this.ListComponent.dataLoad(i),this.emit("selected",t)})),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("clearForm",(()=>{this.emit("clearForm")}))}applicationLoad(e){super.applicationLoad(e),this.AB=e;let t=e.versionData||e.json.versionData;this.ListComponent.dataLoad(t)}ready(){this.ListComponent.ready()}}}(e),a=function(e,t){e.Config.uiSettings();const i=(0,n.Z)(e),a=i.L();return new class extends i{constructor(t,i={}){super(t,{form:"",versionForm:"",versionOption:"",multiview:"",noSelection:"",workspace:""}),this.AB=e,this.versionNumber="1.0.0",this.settings=i}ui(){return{cells:[{id:this.ids.noSelection,rows:[{css:"webix_dark",id:this.ids.versionOption,view:"toolbar",cols:[{width:12},{view:"label",label:"App Version"}]},{view:"form",id:this.ids.form,rows:[{label:"Version number options for Current Changes",view:"label",height:10},{cols:[{id:this.ids.versionOption,options:this.getVersionOptions(this.versionNumber||"1.0.0"),view:"segmented",height:40},{width:15}]},{view:"text",label:"Author",name:"author",id:"author",labelPosition:"top"},{label:"Release Notes",view:"textarea",name:"commitMessage",id:"commitMessage",labelPosition:"top",placeholder:"Explain your changes. Users will see this."},{view:"text",label:"Version Number",name:"version",id:"version",labelPosition:"top",hidden:!0},{view:"text",label:"Date",name:"timestamp",id:"timestamp",labelPosition:"top",hidden:!0},{view:"checkbox",label:"Force keep this version",name:"keepVersion",id:"keepVersion",labelPosition:"top",hidden:!0},{id:"save_button",label:"Save Log Message",view:"button",height:38,type:"icon",css:"webix_primary",disabled:!1,click:()=>this.saveNew()},{id:"update_button",label:"Update Change Log",view:"button",height:38,type:"icon",css:"webix_primary",disabled:!1,hidden:!0,click:()=>this.saveUpdate()},{id:"rollback_button",label:"Rollback module to this version",view:"button",height:38,type:"icon",css:"webix_primary",disabled:!1,hidden:!0},{id:"export_button",label:"Export",view:"button",height:38,type:"icon",css:"webix_primary",icon:"fa fa-download",disabled:!1}]}]}]}}async init(e){const t=this.ids;this.AB=e,this.$form=$$(this.ids.form),this.$versionOption=$$(this.ids.versionOption),$$(t.noSelection).show()}applicationLoad(e){super.applicationLoad(e);let t=this.getVersionData(e);this.versionNumber=t?.versionNumber?t.versionNumber:"1.0.0",this.CurrentVersionID=this.versionNumber,this.setOptions(this.versionNumber)}getVersionData(e){let t=(e=e||this.CurrentApplication).versionData||e.json.versionData;return t||(this.AB.notify.developer("there is no versionData",{context:"ui_work_version_workspace:getVersionData()",application:e.toObj()}),t={}),t}setOptions(e){let t=this.$versionOption;t&&(t.data.options=this.getVersionOptions(e),t.refresh())}versionLoad(e){if(!e)return this.clearForm(),!1;super.versionLoad(e),this.$versionOption.disable(),$$("save_button").hide(),$$("update_button").show(),$$("version").show(),$$("timestamp").show(),$$("export_button").hide(),this.$form.setValues(e),this.setOptions(this.versionNumber),this.$versionOption.refresh(),this.versionData=e}clearForm(){this.$versionOption.enable(),$$("save_button").show(),$$("update_button").hide(),$$("version").hide(),$$("timestamp").hide(),$$("export_button").show(),this.$form.setValues({}),this.setOptions(this.versionNumber),this.$versionOption.refresh()}loadData(e){console.error("no function should be here",e)}async saveNew(){let e=this.$form.getValues();if(e.version=this.getVersionNumber(this.$versionOption.$getValue()),e.timestamp=(new Date).toISOString(),!this.CurrentApplication)return webix.alert({title:a("Shoot!"),test:a("No Application Set!  Why?")}),!1;try{await this.applicationChangeLogAdd(this.CurrentApplication,e),this.emit("versionDataUpdate",!0),this.toList()}catch(e){}}async saveUpdate(){let e=this.$form.getValues(),t={};if(t.version=e.version,t.author=e.author,t.date=e.date,t.commitMessage=e.commitMessage,!this.CurrentApplication)return webix.alert({title:a("Shoot!"),test:a("No Application Set!  Why?")}),!1;try{await this.applicationChangeLogUpdate(this.CurrentApplication,e),this.emit("versionDataUpdate",!0),this.toList()}catch(e){}}getVersionNumber(e){const t=/^(\d+\.\d+\.\d+)/.exec(e);if(t)return t[1];{const t=new Error("Failed to extract version number from input string.");return this.AB.notify.developer(t,{context:"ui_work_version_workspace:getVersionNumber()",application:this.Application.toObj(),string:e}),null}}getVersionOptions(e){const t=e.split(".")[0],i=e.split(".")[1],n=e.split(".")[2];return[`${parseInt(t)+1}.0.0 <i>major</i>`,`${t}.${parseInt(i)+1}.0 <i>minor</i>`,`${t}.${i}.${parseInt(n)+1} <i>patch</i>`]}async applicationChangeLogAdd(e,t){let i=this.getVersionData(e);var n=i?.versionNumber;let o=t.version;i.changeLog[o]=t,i.versionNumber=o,e.json.versionData=i;try{await e.save(),webix.message({type:"success",text:a("{0} Successfully logged update of ",[e.label]," to version: ",o)}),this.versionNumber=o,this.clearForm(),this.emit("addNew",e,o)}catch(i){webix.message({type:"error",text:a("Error Updating {0}",[e.label]," to version: ",o)}),this.AB.notify.developer(i,{context:"ui_work_version_workspace:applicationChangeLogAdd()",application:e.toObj(),values:t}),e.versionData.versionNumber=n,Reflect.deleteProperty(e.versionData.changeLog,o)}}async applicationChangeLogUpdate(e,t){e=this.CurrentApplication||e;let i=t.version;var n=this.getVersionData(e).changeLog[i];n||console.error("They are trying to change the version number..."),e.json.versionData.changeLog[i]=t;try{await e.save(),webix.message({type:"success",text:a("{0} Successfully logged update of ",[e.label]," to version: ",i)}),this.emit("addNew",e,t)}catch(o){webix.message({type:"error",text:a("Error Updating {0}",[e.label]," to version: ",i)}),this.AB.notify.developer(o,{context:"ui_work_version_workspace:applicationChangeLogUpdate()",application:e.toObj(),values:t}),e.json.versionData.versionNumber=n.versionNumber,Reflect.deleteProperty(e.json.versionData.changeLog,i)}}}("ui_work_version_workspace",{allowDelete:0,configureHeaders:!1,detailsView:"",editView:"",isEditable:0,massUpdate:0,isReadOnly:!0})}(e);return new class extends t{constructor(){super("ui_work_version")}ui(){return{id:this.ids.component,type:"space",cols:[i.ui(),{view:"resizer",width:11},a.ui()]}}async init(e){this.AB=e,i.on("selected",(e=>{this.select(e)})),a.on("addNew",((e,t)=>{i.emit("addNew",e,t)})),await a.init(e),await i.init(e),this.on("versionDataUpdate",(()=>{this.VersionList.refresh()})),this.on("clearForm",(()=>{this.VersionWorkspace.clearForm()}))}applicationLoad(e){const t=this.CurrentApplicationID;super.applicationLoad(e),t&&t!=this.CurrentApplicationID&&a.clearForm(),i.applicationLoad(e),a.applicationLoad(e)}show(){const e=this.ids;$$(e.component).show(!1,!1);const t=this.CurrentApplication;t&&(a.applicationLoad(t),i.applicationLoad(t)),i.ready()}select(e){null==e&&a.clearForm(),a.versionLoad(e)}}}function Iv(e){const t=(0,n.Z)(e);var i=t.L();const a=function(e){const t=(0,n.Z)(e);var i=function(e){const t=(0,n.Z)(e);var i=new p(e);return new class extends t{constructor(){super("ui_work_object_list"),this.ListComponent=l(e,{idBase:this.ids.component,labels:{addNew:"Add new object",confirmDeleteTitle:"Delete Object",title:"Objects",searchPlaceholder:"Object name"},menu:{copy:!1,exclude:!0}})}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewProcess(e)})),await this.ListComponent.init(e),this.ListComponent.on("selected",(e=>{this.emit("selected",e?.id)})),this.ListComponent.on("addNew",(e=>{this.clickNewProcess(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),await i.init(e),i.on("cancel",(()=>{i.hide()})),i.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)}))}applicationLoad(e){var t=this.CurrentApplicationID,n=null;super.applicationLoad(e),t==this.CurrentApplicationID&&(n=this.ListComponent.selectedItem());var a=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(a=()=>!0),this.ListComponent.dataLoad(e?.objectsIncluded(a)),n&&this.ListComponent.selectItem(n.id),i.applicationLoad(e)}warningsRefresh(){if(this.CurrentApplication){var e=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(e=()=>!0);let t=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.objectsIncluded(e)),this.ListComponent.selectItem(t.id)}}clickNewProcess(){i.show()}async exclude(e){this.ListComponent.busy();var t=this.CurrentApplication;await t.objectRemove(e),this.ListComponent.dataLoad(t.objectsIncluded()),this.emit("selected",null)}ready(){this.ListComponent.ready()}}}(e),a=L(e);return new class extends t{constructor(){super("ui_work_object")}ui(){return{id:this.ids.component,type:"space",margin:10,cols:[i.ui(),{view:"resizer"},a.ui()]}}init(e){return this.AB=e,this.warningsPropogate([i,a]),this.on("warnings",(()=>{i.warningsRefresh()})),i.on("selected",(e=>{null==e?a.clearObjectWorkspace():a.populateObjectWorkspace(e)})),a.on("addNew",(e=>{i.emit("addNew",e)})),Promise.all([a.init(e),i.init(e)])}applicationLoad(e){var t=this.CurrentApplicationID;super.applicationLoad(e),t!=this.CurrentApplicationID&&a.clearObjectWorkspace(),i.applicationLoad(e),a.applicationLoad(e)}show(){$$(this.ids.component).show(!1,!1),i?.ready()}}}(e),o=V(e),s=M(e),r=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_process"),this.CurrentProcessID=null,this.ProcessList=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_process_list"),this.ListComponent=l(e,{idBase:this.ids.component,labels:{addNew:"Add new process",confirmDeleteTitle:"Delete Process",title:"Processes",searchPlaceholder:"Process name"},menu:{copy:!1,exclude:!0}}),this.AddForm=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_process_list_newProcess",{form:"",buttonCancel:"",buttonSave:""}),this.selectNew=!0}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new Process"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Enter process name"),labelWidth:70},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.emit("cancel")}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Save"),autowidth:!0,type:"form",click:()=>{let e=$$(this.ids.form).getValues();return this.save(e)}}]}]}}}init(e){this.AB=e,webix.ui(this.ui()),this.$component=$$(this.ids.component),this.$form=$$(this.ids.form),this.$buttonSave=$$(this.ids.buttonSave),webix.extend(this.$component,webix.ProgressBar),this.hide()}async save(e){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this.emit("save.error",!0),!1;this.busy();try{let t=await this.AB.processNew(e);await t.save(),await this.CurrentApplication.processInsert(t),this.emit("save",t),this.clear(),this.hide()}catch(e){return console.error(e),this.emit("save.error",e),!1}return this.ready(),!0}show(){this.$component&&this.$component.show()}hide(){this.$component&&this.$component.hide()}clear(){this.$form.clearValidation(),this.$form.clear(),this.$buttonSave.enable()}busy(){this.$component&&this.$component.showProgress&&this.$component.showProgress({type:"icon"})}ready(){this.$component&&this.$component.hideProgress&&this.$component.hideProgress()}}}(e)}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewProcess(e)})),await this.ListComponent.init(e),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("addNew",(e=>{this.clickNewProcess(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),this.ListComponent.on("copied",(e=>{this.copy(e)})),await this.AddForm.init(e),this.AddForm.on("cancel",(()=>{this.AddForm.hide()})),this.AddForm.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)}))}applicationLoad(e){super.applicationLoad(e),this.ListComponent.dataLoad(e?.processes()),this.AddForm.applicationLoad(e)}clickNewProcess(){this.AddForm.show()}copy(e){this.ListComponent.busy(),this.CurrentApplication.processCreate(e.item).then((e=>{this.ListComponent.ready(),this.ListComponent.dataLoad(this.CurrentApplication.processes()),this.ListComponent.select(e.id)}))}async exclude(e){this.ListComponent.busy(),await this.CurrentApplication.processRemove(e),this.ListComponent.dataLoad(this.CurrentApplication.processes()),this.emit("selected",null)}busy(){this.ListComponent.busy()}ready(){this.ListComponent.ready()}warningsRefresh(){if(this.CurrentApplication){var e=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(e=()=>!0);let t=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.processes(e)),this.ListComponent.selectItem(t?.id)}}}}(e),this.ProcessWorkspace=function(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e);var a=i.L();let o={ui:()=>{},init:()=>Promise.resolve(),applicationLoad:()=>{},clearWorkspace:()=>{},processLoad:()=>{}};const s=Vv(e),r=o,l=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_process_workspace_monitor",{component:"",taskList:"",processLogs:"",detailView:"",resetButton:"",deleteButton:"",context:"",error:"",tabGroup:""})}ui(){const e=this.ids;return{id:e.component,cols:[{gravity:1,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{type:"spacer",width:15},{view:"label",label:i("Instances")},{view:"icon",id:"filterIcon",css:"icon-disable",icon:"fa fa-filter",align:"right",popup:{view:"checksuggest",id:"instanceFilter",button:!1,body:{template:`${i("Hide")} #value#`},data:[{id:"completed",value:i("Completed")},{id:"created",value:i("Created")},{id:"error",value:i("Error")}],on:{onValueSuggest:()=>{const t=$$("instanceFilter").config.value.split(",").filter((e=>""!==e)),i=this.instances.filter((e=>-1==t.indexOf(e.status)));$$(e.taskList).clearAll(),$$(e.taskList).parse(i),$$("filterIcon").config.badge=0==t.length?"":t.length,$$("filterIcon").refresh()}}}}]},{view:"list",id:e.taskList,select:!0,navigation:!0,item:{height:74,template:e=>{const{icon:t,color:i}={error:{icon:"fa-times-circle",color:"#FF5C4C"},created:{icon:"fa-clock-o",color:"#FFAE38"},completed:{icon:"fa-check-circle",color:"#38AEA2"}}[e.status]??{icon:"fa-question",color:"gray"};return`<div\n                                    style="float:left;height:70px;line-height:70px;margin-right:10px;color:${i};"\n                                    class="fa ${t} fa-2x">\n                                 </div>\n                                 <div style="margin:5px 0;height:60px;overflow:hidden;line-height:20px">\n                                    <div style="font-size: 16px; font-weight: 600;">\n                                       ${new Date(e.updated_at).toLocaleString(window?.webixLocale??"en-US")}\n                                    </div>\n                                    <div>${e.log[e.log.length-1].split(":")[2]}</div>\n                                 </div>`}},on:{onItemClick:e=>this.showInstance(e)}}]},{view:"resizer",css:"bg_gray",width:11},{gravity:2,rows:[{gravity:2,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{type:"spacer",width:15},{view:"label",label:i("Instance Details")},{id:e.resetButton,view:"button",width:100,css:"webix_secondary",type:"icon",icon:"fa fa-refresh",label:i("Reset"),click:()=>this.resetInstance()},{id:e.deleteButton,view:"button",width:100,css:"webix_danger",type:"icon",icon:"fa fa-trash",label:i("Delete"),click:()=>this.deleteInstance()},{type:"spacer",width:1}]},{view:"property",height:200,id:e.detailView,editable:!1,elements:[{label:i("Instance"),type:"label"},{label:i("ID"),type:"text",id:"id"},{label:i("Created"),type:"date",id:"created"},{label:i("Updated"),type:"date",id:"updated"},{label:i("Job ID"),type:"text",id:"jobId"},{label:i("Status"),type:"text",id:"status"},{label:i("Triggered By"),type:"text",id:"triggeredBy"}]}]},{view:"tabview",id:e.tabGroup,css:"webix_dark",cells:[{header:i("Logs"),body:{id:e.processLogs,view:"list",type:{height:"auto"},template:'<div style="padding:5px 0; line-height:20px;color:black">#value#</div>'}},{header:i("Context"),body:{view:"treetable",id:e.context,css:{color:"black !important"},resizable:!0,scroll:!0,columns:[{id:"title",header:i("Property"),width:300,template:"{common.treetable()} #key#"},{id:"value",header:i("Value"),width:500}]}}]}]}]}}async init(e){this.model=e.objectProcessInstance().model()}async processLoad(e){super.processLoad(e);const t={};t["d5afbc83-17dd-4b38-bded-1bf3f4594135"]=e.id;const i=await this.model.findAll({where:t});this.instances=i.data.sort(((e,t)=>new Date(t.updated_at)-new Date(e.updated_at)));const n=$$(this.ids.taskList);n.clearAll(),n.parse(this.instances),this.instances[0]&&(this.showInstance(this.instances[0].id),n.select(this.instances[0].id))}showInstance(e){this.instance=e;const t=this.ids;if(!e)return $$(t.processLogs).clearAll(),$$(t.detailView).clear(),$$(t.tabGroup).removeView(t.error),$$(t.context).clearAll(),$$(t.resetButton).hide(),void $$(t.deleteButton).hide();const i=$$(t.taskList).getItem(e),n=i.log.map(((e,t)=>({id:t,value:e})));if($$(t.processLogs).clearAll(),$$(t.processLogs).parse(n),$$(t.detailView).setValues({id:i.id,created:new Date(i.created_at),updated:new Date(i.updated_at),jobId:i.jobID,status:i.status,triggeredBy:i.triggeredBy}),$$(t.context).clearAll(),$$(t.context).parse(this.processContext(i.context),"json"),$$(t.context).refresh(),$$(t.detailView).refresh(),$$(t.tabGroup).removeView(t.error),i.errorTasks){const e=[];for(var a in i.errorTasks)e.push({key:a,error:i.errorTasks[a]});$$(t.tabGroup).addView({header:"Errors",body:{id:t.error,view:"list",type:{height:"auto"},template:'<div style="color:black">#key# #error#</div>',data:e}})}"error"==i.status?$$(t.resetButton).show():$$(t.resetButton).hide(),$$(t.deleteButton).show()}async deleteInstance(){const e=this.instance;if(await webix.confirm({title:i("Delete Instance"),text:i("Are you sure? This can't be undone."),type:"confirm-warning"}).catch((()=>{})))if((await this.model.delete(e)).numRows>0){const t=$$(this.ids.taskList),n=t.getNextId(this.instance);t.remove(this.instance),this.showInstance(n),webix.message({text:`${i("Deleted Instance")} ${e}`,type:"success"})}else webix.messages({text:i("No rows were effected.  This does not seem right."),type:"warn"})}async resetInstance(){const e=$$(this.ids.taskList).getItem(this.instance),t=Object.keys(e.errorTasks);if(t.length<1)return;const n=this.CurrentProcess.elements().filter((e=>e.diagramID===t[0]))[0];await webix.confirm({title:i("Reset Instance"),text:`${i("Restart from")} '${n.label}' (${n.key} ${i("Task")})?`}).catch((()=>{}))&&1==await this.AB.Network.put({url:`/process/reset/${n.id}`,params:{instanceID:this.instance}})&&(webix.message({text:i("Instance Reset"),type:"success"}),this.processLoad(this.CurrentProcess))}processContext(e){const t=[];for(const i in e)"object"!=typeof e[i]||Array.isArray(e[i])||null===e[i]?t.push({key:i,value:e[i]}):t.push({key:i,open:!0,data:this.processContext(e[i])});return t}show(){$$(this.ids.component).show()}}}(e);return new class extends i{constructor(){super("ui_work_process_workspace",{multiview:"",tabbar:"",tabModel:"",tabTest:"",tabMonitor:"",noSelection:"",selectedItem:""})}ui(){let e=this.ids;return{view:"multiview",id:e.component,keepViews:!0,rows:[{id:e.noSelection,rows:[{maxHeight:t.xxxLargeSpacer,hidden:t.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-code-fork'></div>"},{view:"label",align:"center",label:a("Select a process to work with.")},{cols:[{},{view:"button",label:a("Add new process"),type:"form",css:"webix_primary",autowidth:!0,click:()=>{this.addNewProcess()}},{}]},{maxHeight:t.xxxLargeSpacer,hidden:t.hideMobile}]},{id:e.selectedItem,type:"wide",paddingY:0,rows:[{id:e.tabbar,view:"tabbar",css:"webix_dark",type:"bottom",borderless:!1,bottomOffset:0,options:[{id:e.tabModel,value:a("Model"),icon:"fa fa-code-fork",type:"icon",on:{click:()=>{this.changeTab("model")}}},{id:e.tabTest,value:a("Test"),icon:"fa fa-check-square",type:"icon",on:{click:()=>{this.changeTab("test")}}},{id:e.tabMonitor,value:a("Monitor"),icon:"fa fa-tachometer",type:"icon",on:{click:()=>{this.changeTab("monitor")}}}],on:{onChange:(e,t)=>{e!=t&&this.changeTab(e)}}},{id:e.multiview,view:"multiview",cells:[s.ui(),l.ui()]}]}]}}async init(e){this.AB=e,this.warningsPropogate([s,l]),$$(this.ids.noSelection).show();var t=[s.init(e),r.init(e),l.init(e)];await Promise.all(t)}addNewProcess(){this.emit("addNew")}applicationLoad(e){super.applicationLoad(e),s.applicationLoad(e),r.applicationLoad(e),l.applicationLoad(e)}changeTab(e){let t=this.ids;switch(e){case t.tabModel:$$(t.multiview).setValue(s.ids.component);break;case t.tabTest:$$(t.multiview).setValue(r.ids.component);break;case t.tabMonitor:$$(t.multiview).setValue(l.ids.component)}}clearWorkspace(){$$(this.ids.noSelection).show(!1,!1),s.clearWorkspace(),r.clearWorkspace(),l.clearWorkspace()}processLoad(e){super.processLoad(e),$$(this.ids.selectedItem).show(),s.processLoad(this.CurrentProcess),r.processLoad(this.CurrentProcess),l.processLoad(this.CurrentProcess)}}}(e)}ui(){return{id:this.ids.component,type:"space",margin:10,cols:[this.ProcessList.ui(),{view:"resizer",css:"bg_gray",width:11},this.ProcessWorkspace.ui()]}}init(e){return this.AB=e,this.warningsPropogate([this.ProcessList,this.ProcessWorkspace]),this.on("warnings",(()=>{this.ProcessList.warningsRefresh()})),this.ProcessWorkspace.on("addNew",(()=>{this.ProcessList.clickNewProcess(!0)})),this.ProcessList.on("selected",(e=>{this.select(e)})),this.ProcessList.on("deleted",(e=>{this.CurrentProcessID==e.id&&this.select(null)})),Promise.all([this.ProcessWorkspace.init(e),this.ProcessList.init(e)])}applicationLoad(e){super.applicationLoad(e),this.ProcessWorkspace.applicationLoad(e),this.ProcessList.applicationLoad(e)}show(){$$(this.ids.component).show(!1,!1);var e=this.CurrentApplication;e&&(!e.loadedProcesss||this.ProcessList?.count()<1)&&(this.ProcessList?.busy(),this.ProcessList?.applicationLoad(e),this.ProcessList?.ready())}select(e){this.CurrentProcessID=e?.id,e?this.ProcessWorkspace?.processLoad(e):this.ProcessWorkspace?.clearWorkspace()}}}(e),c=O(e),d=Fv(e);return new class extends t{constructor(e={}){super("abd_work",{toolBar:"",labelAppName:"",tabbar:"",tab_object:"",tab_query:"",tab_datacollection:"",tab_processview:"",tab_interface:"",tab_version:"",workspace:"",collapseMenu:"",expandMenu:""}),this.options=e,this.cacheSidebarItems={},this.selectedItem=this.ids.tab_object}scanTopic(e,t){let i=0,n={};return e&&e[t]().forEach((e=>{e.warningsEval(),i+=(e.warningsAll()||[]).length})),i&&(n.icon=this.WARNING_ICON_DARK,n.count=i),n}sidebarItems(e){let t=e?.id??null;if(!this.cacheSidebarItems[t]){const n=this.scanTopic(e,"objectsIncluded"),a=this.scanTopic(e,"queriesIncluded"),o=this.scanTopic(e,"datacollectionsIncluded"),s=this.scanTopic(e,"processes"),r=this.scanTopic(e,"pages");this.cacheSidebarItems[t]=[{id:this.ids.tab_object,value:`${i("Objects")}`,icon:"fa fa-fw fa-database",issues:n},{id:this.ids.tab_query,value:`${i("Queries")}`,icon:"fa fa-fw fa-filter",issues:a},{id:this.ids.tab_datacollection,value:i("Data Collections"),icon:"fa fa-fw fa-table",issues:o},{id:this.ids.tab_processview,value:i("Process"),icon:"fa fa-fw fa-code-fork",issues:s},{id:this.ids.tab_interface,value:i("Interface"),icon:"fa fa-fw fa-id-card-o",issues:r},{id:this.ids.tab_version,value:i("Version"),icon:"fa fa-fw fa-code-fork",on:{onclick:()=>{d.show()}}}],setTimeout((()=>{this.cacheSidebarItems[t]=null}),500)}return this.cacheSidebarItems[t]}ui(){var e=this.sidebarItems(),t=this.expandMenu={id:this.ids.expandMenu,value:i("Expand Menu"),icon:"fa fa-fw fa-chevron-circle-right"},n={id:this.ids.collapseMenu,value:i("Collapse Menu"),icon:"fa fa-fw fa-chevron-circle-left"};return{id:this.ids.component,rows:[{view:"toolbar",id:this.ids.toolBar,autowidth:!0,elements:[{view:"button",css:"webix_transparent",label:i("Back to Applications page"),autowidth:!0,type:"icon",icon:"fa fa-arrow-left",hidden:this.options?.IsBackHidden??!1,click:()=>{this.emit("view.chooser")}},{},{view:"label",css:"appTitle",id:this.ids.labelAppName,align:"center"},{}]},{cols:[{id:this.ids.tabbar,css:"webix_dark",view:"sidebar",animate:!1,width:160,data:e.concat(n),on:{onAfterSelect:e=>{e==this.ids.collapseMenu?setTimeout((()=>{this.$tabbar.remove(this.ids.collapseMenu),this.$tabbar.add(t),this.$tabbar.toggle(),this.$tabbar.select(this.selectedItem),this.saveState()}),0):e==this.ids.expandMenu?setTimeout((()=>{this.$tabbar.remove(this.ids.expandMenu),this.$tabbar.add(n),this.$tabbar.toggle(),this.$tabbar.select(this.selectedItem),this.saveState()}),0):(this.tabSwitch(e),this.selectedItem=e)}},template:function(e,t){return t.collapsed?t.icon(e,t):(e.issues?.icon||"")+t.icon(e,t)+"<span>"+e.value+"</span>"},tooltip:{template:function(e){return e.issues?.count?`${e.issues?.count} issues`:""}}},{id:this.ids.workspace,cells:[a.ui(),o.ui(),s.ui(),r.ui(),c.ui(),d.ui()]}]}]}}async init(e){this.AB=e,this.warningsPropogate([a,o,s,r,c]),this.on("warnings",(()=>{this.CurrentApplication.warningsEval(),this.refreshSideBar(this.CurrentApplication)})),a.init(e),o.init(e),s.init(e),r.init(e),c.init(e),d.init(e),this.$tabbar=$$(this.ids.tabbar);var t=this.AB.Storage.get(this.ids.component);t&&(this.$tabbar.setState(t),t.collapsed&&setTimeout((()=>{this.$tabbar.remove(this.ids.collapseMenu),this.$tabbar.add(this.expandMenu)}),0)),this.tabSwitch(this.ids.tab_object),this.$tabbar.select(this.ids.tab_object)}applicationInit(e){if(e){var t=$$(this.ids.labelAppName);t.define("label",e?.label),t.refresh()}super.applicationLoad(e)}saveState(){this.AB.Storage.set(this.ids.component,this.$tabbar.getState())}show(){$$(this.ids.component).show();let e=this.$tabbar.getSelectedId();this.tabSwitch(e)}refreshSideBar(e){let t=$$(this.ids.tabbar),i=this.sidebarItems(e);t?.define("data",i),t?.refresh()}transitionWorkspace(e){this.CurrentApplicationID!=e?.id&&this.applicationInit(e),a.applicationLoad(e),o.applicationLoad(e),s.applicationLoad(e),r.applicationLoad(e),c.applicationLoad(e),d.applicationLoad(e),this.refreshSideBar(e),this.show()}tabSwitch(e){switch(e){case this.ids.tab_object:a.show();break;case this.ids.tab_query:o.show();break;case this.ids.tab_datacollection:s.show();break;case this.ids.tab_processview:r.show();break;case this.ids.tab_interface:c.show();break;case"interface":c.show(),this.$tabbar.select(this.ids.tab_interface);break;case this.ids.tab_version:d.show()}}}}const Bv=[i(7980).Z];function Tv(e){var t=function(e){const t=(0,n.Z)(e),i=function(e){const t=function(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e);var a=i.L();const s=o(e);return new class extends i{constructor(){super("abd_choose_list",{toolbar:"",buttonCreateNewApplication:"",uploader:"",exporter:"",list:""}),this.cacheTemplate={}}ui(){return{id:this.ids.component,responsive:"hide",type:"space",cols:[{maxWidth:t.appListSpacerColMaxWidth,minWidth:t.appListSpacerColMinWidth,width:t.appListSpacerColMaxWidth},{responsiveCell:!1,rows:[{maxHeight:t.appListSpacerRowHeight,hidden:t.hideMobile},{view:"toolbar",css:"webix_dark",id:this.ids.toolBar,cols:[{view:"spacer",width:10},{view:"label",label:a("Applications"),fillspace:!0,on:{onAfterRender(){i.CYPRESS_REF(this)}}},{id:this.ids.buttonCreateNewApplication,view:"button",label:a("Add new application"),autowidth:!0,type:"icon",icon:"fa fa-plus",css:"webix_transparent",click:()=>{this.emit("view.form",null)},on:{onAfterRender(){i.CYPRESS_REF(this)}}},{view:"uploader",id:this.ids.uploader,label:a("Import"),autowidth:!0,upload:"/definition/import",multiple:!1,type:"icon",icon:"fa fa-upload no-margin",autosend:!0,css:"webix_transparent",on:{onAfterFileAdd:()=>{$$(this.ids.uploader).disable()},onFileUpload:()=>(window.location.reload(),!1),onFileUploadError:e=>(this.AB.notify.developer("Error uploading file",{url:e.xhr.responseURL,status:e.status,code:e.xhr.status,response:e.xhr.responseText}),$$(this.ids.uploader).enable(),!1),onAfterRender(){i.CYPRESS_REF(this)}}},{view:"button",id:this.ids.exporter,label:a("Export All"),autowidth:!0,type:"icon",icon:"fa fa-download",css:"webix_transparent",click:function(){window.location.assign("/definition/export/all?download=1")},on:{onAfterRender(){i.CYPRESS_REF(this)}}}]},{id:this.ids.list,view:"list",css:"ab-app-select-list",template:(e,t)=>this.templateListItem(e,t),tooltip:e=>this.toolTipListItem(e),type:{height:t.appListRowHeight,iconGear:function(e){return`<span class="webix_icon fa fa-cog" data-cy="edit_${e.id}"></span>`},iconAdmin:function(e){return e.isAdminApp?"<span class='webix_icon fa fa-circle-o-notch'></span> ":""}},select:!1,onClick:{"ab-app-list-item":(e,t,i)=>this.onClickListItem(e,t,i),"ab-app-list-edit":(e,t,i)=>this.onClickListEdit(e,t,i)},onHover:{},on:{onAfterRender(){this.data.each((e=>{i.CYPRESS_REF(this.getItemNode(e.id),e.id)}))}}},{maxHeight:t.appListSpacerRowHeight,hidden:t.hideMobile}]},{maxWidth:t.appListSpacerColMaxWidth,minWidth:t.appListSpacerColMinWidth,width:t.appListSpacerColMaxWidth}]}}async init(e){this.AB=e,this.$list=$$(this.ids.list),webix.extend(this.$list,webix.ProgressBar),webix.extend(this.$list,webix.OverlayBox),this.MenuComponent=new s(this.ids.component),this.MenuComponent.init(e);var t=[{label:a("Edit"),icon:"fa fa-pencil-square-o",command:"edit"},{label:a("Export"),icon:"fa fa-download",command:"export"},{label:a("Delete"),icon:"fa fa-trash",command:"delete"}];this.MenuComponent.menuOptions(t),this.MenuComponent.on("click",(e=>{var t=this.$list.getSelectedItem();switch(e){case"edit":this.emit("edit.form",t);break;case"delete":webix.confirm({title:a("Delete {0}?",[a("Application")]),text:a("Do you want to delete <b>{0}</b>?",[t.label]),ok:a("Yes"),cancel:a("No"),callback:async e=>{if(e){this.busy();try{await t.destroy(),this.refreshList(),webix.message({type:"success",text:a("{0}&nbsp; Successfully Deleted",[t.label])})}catch(e){webix.message({type:"error",text:a("There was an error deleting {0}.",[t.label])})}this.ready()}}});break;case"export":window.location.assign(`/definition/export/${t.id}?download=1`)}})),this.AB.Network.on("definitions.allapplications",((e,t,i)=>{if(this.ready(),t)return this.AB.notify.developer(t,{plugin:"ABDesigner",context:"ui_choose_list:init(): /definition/allapplications"}),void e?.reject?.(t);this.AB.definitionsParse(i),e?.resolve?.()})),this._handler_create=e=>{"application"==e?.type&&(this.AB.applications((t=>t.id==e.id)).length<1&&this.AB.definitionSync("created",e.id,e),this.refresh())},this._handler_reload=e=>{"application"==e?.type?this.refresh():e||this.AB.notify.developer(new Error("No def passed"),{plugin:"ABDesigner",context:"_handler_reload(): /definition/allapplications"})},this.AB.on("definition.created",this._handler_create)}busy(){this.$list.disable(),this.$list.showProgress&&this.$list.showProgress({type:"icon"})}refresh(){this.busy();var e=e=>!e.isSystemObj;this.AB.Account.isSystemDesigner()&&(e=()=>!0);var t=this.AB.applications(e);this.dcEditableApplications=new webix.DataCollection({data:t||[]}),["definition.updated","definition.deleted"].forEach((e=>{t.forEach((t=>{t.removeListener(e,this._handler_reload),t.on(e,this._handler_reload)}))})),this.dcEditableApplications.attachEvent("onAfterAdd",(()=>{this.refreshOverlay()})),this.dcEditableApplications.attachEvent("onAfterDelete",(()=>{this.refreshOverlay()})),this.refreshList(),this.ready()}onClickListEdit(e,t,i){return this.MenuComponent.show(i),this.$list.select(t),!1}onClickListItem(e,t){this.$list.select(t);let i=this.$list.getItem(t);return i&&(i.App=this.AB.App,this.emit("view.workplace",i)),!1}ready(){this.$list.enable(),this.$list.hideProgress&&this.$list.hideProgress()}refreshList(){this.$list.clearAll(),this.$list.data.unsync(),this.$list.data.sync(this.dcEditableApplications),this.$list.sort("label","asc"),this.refreshOverlay(),this.$list.refresh(),this.ready()}refreshOverlay(){this.$list.count()?this.$list.hideOverlay():this.$list.showOverlay(a("There is no application data"))}show(){super.show(),this.refresh()}templateListItem(e,t){if(!this.cacheTemplate[e.id]){var i={icon:"",count:0};e.warningsAll().length&&(i.icon=this.WARNING_ICON,i.count=e.warningsAll().length),this.cacheTemplate[e.id]=`<div class='ab-app-list-item'>\n   <div class='ab-app-list-info'>\n      <div class='ab-app-list-name'><i class="lighten fa-fw fa ${e.icon}"></i> ${t.iconAdmin(e)}${e.label??""}</div>\n      <div class='ab-app-list-description'>${e.description??""}</div>\n   </div>\n   <div class='ab-app-list-edit'>\n      ${i.icon}\n      ${t.iconGear(e)}\n   </div>\n</div>`,setTimeout((()=>{delete this.cacheTemplate[e.id]}),400)}return this.cacheTemplate[e.id]}toolTipListItem(e){let t=$$(this.ids.list).data.getItem(e.id).warningsAll().length;return t?`${t} issues`:""}}}(e),i=function(e,t){const i=e.Config.uiSettings(),a=(0,n.Z)(e);var o=a.L();const l=(0,r.Z)(e);s(e,"view_warnings",void 0);var c="<span class='webix_icon wxi-alert' style='font-size:18px; color:#EED202;'>&nbsp;</span>",d=e.UISettings.icons.map((e=>`fa-${e}`));return new class extends a{constructor(){super("abd_choose_form",{form:"",appFormPermissionList:"",appFormCreateRoleButton:"",saveButton:"",accessManager:"",accessManagerToolbar:"",translationManager:"",translationManagerToolbar:"",tutorialManager:"",tutorialManagerToolbar:"",icon:"",issue_id:"",issue_list:""})}ui(){return this.accessManagerUI=new l("application_amp"),this.translationManagerUI=new l("application_translate"),this.tutorialManagerUI=new l("application_tutorial"),{view:"window",id:this.ids.component,css:"app_form_window",height:670,width:770,position:"center",move:!0,scroll:!0,resize:!0,modal:!0,head:{type:"clean",cols:[{view:"spacer",width:4},{view:"icon",icon:"wxi-alert",css:"alert",on:{onItemClick:()=>{const e=$$(this.ids.issue_id),t=$$(this.ids.issue_list);t.define("data",this.warningData()),t.refresh(),e.show()}}},{template:o("Application Info"),type:"header",css:"webix_win_title"},{view:"icon",icon:"wxi-close",click(){this.getTopParentView().hide()}},{view:"spacer",width:4}]},body:{view:"scrollview",scroll:!0,body:{padding:4,cols:[{view:"spacer",width:2},{rows:[{view:"form",id:this.ids.form,rules:{label:e=>0<e.length&&e.length<=20},borderless:!0,elements:[{name:"label",view:"text",label:o("Name"),labelWidth:100,placeholder:o("Application Name"),invalidMessage:o("&nbsp; Name must be less than or equal to 20 letters."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_label")}}},{name:"version",view:"text",label:o("Version"),labelWidth:100,placeholder:o("1.0.0"),invalidMessage:o("&nbsp; can only contain numbers or '.'s ."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_version_number")}}},{name:"icon",view:"richselect",id:"richselect1",label:o("Icon"),labelWidth:100,placeholder:o("Menu Icon"),options:{body:{template:"<span class='fa #value#' style='color: #33b5e5;'></span>&nbsp; #value#",yCount:3,data:d}},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_icon")}}},{height:i.smallSpacer},{name:"description",view:"textarea",label:o("Description"),labelWidth:100,height:100,placeholder:o("Application Description"),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_description")}}},{view:"spacer",height:4},{name:"isSystemObject",view:"checkbox",labelRight:o("Is this a System Object?"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isSystemObj")}}},{view:"label",label:o("Who can use this app?"),css:"npr_smallLabels"},{name:"roleAccess",view:"multicombo",id:this.ids.appFormPermissionList,label:"",labelPosition:"top",placeholder:o("Click to add Role"),button:!0,on:{onAfterRender(){this.data.value.forEach((t=>{e.ClassUI.CYPRESS_REF(`perm_role_${t.id}`)}))}}},{name:"isAccessManaged",view:"checkbox",labelRight:o("Enable Page / Tab Access Management"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isAccessManaged")},onChange:e=>{e?($$(this.ids.accessManager).show(),$$(this.ids.accessManagerToolbar).show()):($$(this.ids.accessManager).hide(),$$(this.ids.accessManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.accessManager).show(),$$(this.ids.accessManagerToolbar).show()):($$(this.ids.accessManager).hide(),$$(this.ids.accessManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.accessManagerToolbar,cols:[{view:"label",label:o("Who can manage page / tab access for this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.accessManagement)},{id:this.ids.accessManager,rows:[this.accessManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.accessManagement)},{view:"spacer",height:6},{name:"isTranslationManaged",view:"checkbox",labelRight:o("Enable Translation Tool"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isTranslationManaged")},onChange:e=>{e?($$(this.ids.translationManager).show(),$$(this.ids.translationManagerToolbar).show()):($$(this.ids.translationManager).hide(),$$(this.ids.translationManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.translationManager).show(),$$(this.ids.translationManagerToolbar).show()):($$(this.ids.translationManager).hide(),$$(this.ids.translationManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.translationManagerToolbar,cols:[{view:"label",label:o("Who can translate this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.translationManagement)},{id:this.ids.translationManager,rows:[this.translationManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.translationManagement)},{name:"isTutorialManaged",view:"checkbox",labelRight:o("Enable Tutorial Tool"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isTutorialManaged")},onChange:e=>{e?($$(this.ids.tutorialManager).show(),$$(this.ids.tutorialManagerToolbar).show()):($$(this.ids.tutorialManager).hide(),$$(this.ids.tutorialManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.tutorialManager).show(),$$(this.ids.tutorialManagerToolbar).show()):($$(this.ids.tutorialManager).hide(),$$(this.ids.tutorialManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.tutorialManagerToolbar,cols:[{view:"label",label:o("Who can create tutorials for this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.tutorialManagement)},{id:this.ids.tutorialManager,rows:[this.tutorialManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.tutorialManagement)},{view:"spacer",height:2},{view:"toolbar",margin:14,paddingY:20,cols:[{view:"button",value:o("Cancel"),css:"ab-cancel-button",inputWidth:100,align:"right",click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_cancel")}}},{view:"button",id:this.ids.saveButton,value:o("Save"),css:"webix_primary",inputWidth:100,click:()=>{this.buttonSaveClick()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}],borderless:!0}]}]},{view:"spacer",width:8}]}}}}init(e){this.AB=e,this.AB.Webix.ui(this.ui()),webix.extend($$(this.ids.form),this.AB.Webix.ProgressBar),webix.extend($$(this.ids.appFormPermissionList),this.AB.Webix.ProgressBar),this.AB.Webix.ui({view:"window",id:this.ids.issue_id,css:"app_form_window_2",height:222,width:700,head:{type:"clean",cols:[{view:"spacer",width:50},{template:c+o(" Issues"),type:"header",css:"webix_win_title"},{view:"icon",icon:"wxi-close",click(){this.getTopParentView().hide()}},{view:"spacer",width:4}]},position:"center",close:!0,modal:!0,move:!0,scroll:!0,body:{rows:[{view:"list",id:this.ids.issue_list,template:c+" #issue#",scrollX:!0,scrollY:!0,select:!0,editable:!1,autoheight:!1,autowidth:!1,data:[],click(){this.getParentView().show()}}]}}),this.permissionPopulate()}toList(){this.emit("view.list")}warningData(){const e=this.AB.applications(),t=[];return e.forEach((e=>{t.push(...e.warningsAll())})),t?.length?t.map(((e,t)=>({id:t,issue:o(e.message)}))):[{id:1,issue:o("No Issues Found")}]}async applicationCreate(e){e.name=e.label;var t=this.AB.applicationNew(e);try{await t.save(),webix.message({type:"success",text:o("{0}&nbsp; Successfully Created",[e.label])})}catch(t){webix.message({type:"error",text:o("Error Creating {0}",[e.label])}),this.AB.notify.developer(t,{plugin:"ABDesigner",context:"ui_choose_form:applicationCreate()",values:e})}}async applicationUpdate(e){var t=this.formValues(),i={};Object.keys(t).forEach((n=>{i[n]=e[n],e[n]=t[n]}));try{await e.save(),webix.message({type:"success",text:o("{0} Successfully Updated",[e.label])})}catch(n){webix.message({type:"error",text:o("Error Updating {0}",[e.label])}),this.AB.notify.developer(n,{context:"ui_choose_form:applicationUpdate()",application:e.toObj(),values:t}),Object.keys(i).forEach((t=>{e[t]=i[t]}))}}async buttonSaveClick(){if(this.buttonSaveDisable(),this.formBusy(),this.CurrentApplication){if(this.formValidate("update")){try{await this.applicationUpdate(this.CurrentApplication),this.toList()}catch(e){}this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}}else if(this.formValidate("add")){try{await this.applicationCreate(this.formValues()),this.formReset(),this.toList()}catch(e){}this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}}buttonSaveDisable(){$$(this.ids.saveButton).disable()}buttonSaveEnable(){$$(this.ids.saveButton).enable()}cancel(){this.formReset(),this.toList(),$$(this.ids.component).hide()}formBusy(){$$(this.ids.form).showProgress({type:"icon"})}formPopulate(e){if(super.applicationLoad(e),e){["label","description","version","icon","isSystemObject","isAccessManaged","isTranslationManaged","isTutorialManaged"].forEach((t=>{$$(this.ids.form).elements[t]&&$$(this.ids.form).elements[t].setValue(e[t]||e.json[t])}));var t=$$(this.ids.accessManager);t.removeView(t.getChildViews()[0]),t.addView(this.accessManagerUI.ui(e.accessManagers||{}),0);var i=$$(this.ids.translationManager);i.removeView(i.getChildViews()[0]),i.addView(this.translationManagerUI.ui(e.translationManagers||{}),0);var n=$$(this.ids.tutorialManager);n.removeView(n.getChildViews()[0]),n.addView(this.tutorialManagerUI.ui(e.tutorialManagers||{}),0)}this.permissionPopulate(e)}formReady(){$$(this.ids.form).hideProgress()}formReset(){super.applicationLoad(null),$$(this.ids.form).clear(),$$(this.ids.form).clearValidation(),this.permissionPopulate(),$$(this.ids.accessManager).removeView($$(this.ids.accessManager).getChildViews()[0]),$$(this.ids.translationManager).removeView($$(this.ids.translationManager).getChildViews()[0]),$$(this.ids.accessManager).addView(this.accessManagerUI.ui(),0),$$(this.ids.translationManager).addView(this.translationManagerUI.ui(),0),$$(this.ids.tutorialManager).addView(this.tutorialManagerUI.ui(),0)}formValidate(e){if(!$$(this.ids.form).validate())return this.formReady(),this.buttonSaveEnable(),!1;var t=[];if("add"===e){var i=this.formValues();i.name=i.label;var n=this.AB.applicationNew(i),a=[];(this.AB.applications()||[]).forEach((e=>{e.areaKey()==n.areaKey()&&a.push(e)})),a.length>0&&t.push({attr:"label",msg:o("&nbsp; Name ({0}) is already in use.",[n.label])})}if(t.length>0){var s=!1;return t.forEach((e=>{$$(this.ids.form).markInvalid(e.attr,e.msg),s||($$(this.ids.form).elements[e.attr].focus(),s=!0)})),this.formReady(),this.buttonSaveEnable(),!1}return!0}formValues(){const e=$$(this.ids.form).getValues();return e.roleAccess=(e.roleAccess??"").split(","),e.accessManagers=this.accessManagerUI.values(),e.translationManagers=this.translationManagerUI.values(),e.tutorialManagers=this.tutorialManagerUI.values(),e}permissionPopulate(e){const t=$$(this.ids.appFormPermissionList),i=this.AB.Account.rolesAll().map((e=>({id:e.id,value:e.name})));e&&i.filter((t=>e.roleAccess.indexOf(t.id)>-1)).map((e=>{e.markCheckbox=1}));const n=i.filter((e=>e.markCheckbox)).map((e=>e.id));t.define("suggest",i),t.setValue(n),t.refresh()}show(){$$(this.ids.component).show()}}}(e),a=(0,n.Z)(e);return new class extends a{constructor(){super("abd_choose")}ui(){return{id:this.ids.component,view:"multiview",animate:!1,cells:[t.ui()]}}async init(e){return this.AB=e,this.warningsPropogate([t,i]),this.on("warnings",(()=>{t.refreshList()})),t.on("view.workplace",(e=>{this.emit("view.workplace",e)})),t.on("view.form",(()=>{i.formReset(),i.show()})),t.on("edit.form",(e=>{i.formPopulate(e),i.show()})),i.on("view.list",(()=>{t.show()})),Promise.all([t.init(e),i.init(e)])}show(){super.show(),t.show()}}}(e),a=Iv(e);var l=t.L();return new class extends t{constructor(){super("abd"),this.id=this.ids.component,this.icon="connectdevelop"}label(){return l("AB Designer")}type(){return"page"}pages(){return[]}component(){return{ui:this.ui(),init:()=>this.init(e),onShow:()=>{this.show()}}}getUserAccess(){return 2}ui(){return{id:this.ids.component,view:"multiview",borderless:!0,animate:!1,rows:[i.ui(),a.ui()]}}async init(e){this.AB=e,i.on("view.workplace",(e=>{a.transitionWorkspace(e)})),a.on("view.chooser",(()=>{i.show()})),a.on("warnings",(()=>{i.emit("warnings")})),await Promise.all([i.init(e),a.init(e)]);try{await this.AB.Network.post({url:"/definition/register"})}catch(e){"E_NOPERM"==e?.code&&this.AB.notify.developer(e,{plugin:"ABDesigner",context:"ui::init():/definition/register",msg:"User is not able to access /definition/register"})}}isRoot(){return!0}show(){super.show(),i.show()}}}(e),i={id:"ABDesigner",label:"AB Designer",icon:"fa-connectdevelop",isPlugin:!0,pages:function(){return this._pages},_pages:[t],datacollectionsIncluded:()=>{var t=[];return e.datacollections((e=>t.indexOf(e.id)>-1))}};return t.application=i,function(e){Bv.forEach((t=>{new t(e)}))}(e),i}var jv=i(8023),Ov=i.n(jv),Mv=i(1597),Nv={};Nv.styleTagTransform=wv(),Nv.setAttributes=gv(),Nv.insert=mv().bind(null,"head"),Nv.domAPI=hv(),Nv.insertStyleElement=bv(),dv()(Mv.Z,Nv),Mv.Z&&Mv.Z.locals&&Mv.Z.locals,window.__ABBS&&window.__ABBS.addPlugin({version:"0.0.0",key:"ABDesigner",apply:function(e){e.pluginLoad(Tv(e))},definitions:function(){return t()},labels:function(e){return Ov()[e]||Ov().en}})})()})();