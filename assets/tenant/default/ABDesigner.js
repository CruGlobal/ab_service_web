/*! For license information please see ABDesigner.js.LICENSE.txt */
(()=>{var e={9293:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},5367:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),s=i.n(n),o=i(3645),a=i.n(o)()(s());a.push([e.id,"@font-face {\n  font-family: 'bpmn';\n  src: url('../font/bpmn.eot?26374340');\n  src: url('../font/bpmn.eot?26374340#iefix') format('embedded-opentype'),\n       url('../font/bpmn.woff2?26374340') format('woff2'),\n       url('../font/bpmn.woff?26374340') format('woff'),\n       url('../font/bpmn.ttf?26374340') format('truetype'),\n       url('../font/bpmn.svg?26374340#bpmn') format('svg');\n  font-weight: normal;\n  font-style: normal;\n}\n/* Chrome hack: SVG is rendered more smooth in Windozze. 100% magic, uncomment if you need it. */\n/* Note, that will break hinting! In other OS-es font will be not as sharp as it could be */\n/*\n@media screen and (-webkit-min-device-pixel-ratio:0) {\n  @font-face {\n    font-family: 'bpmn';\n    src: url('../font/bpmn.svg?26374340#bpmn') format('svg');\n  }\n}\n*/\n\n [class^=\"bpmn-icon-\"]:before, [class*=\" bpmn-icon-\"]:before {\n  font-family: \"bpmn\";\n  font-style: normal;\n  font-weight: normal;\n  speak: never;\n\n  display: inline-block;\n  text-decoration: inherit;\n  width: 1em;\n  /* margin-right: .2em; */\n  text-align: center;\n  /* opacity: .8; */\n\n  /* For safety - reset parent styles, that can break glyph codes*/\n  font-variant: normal;\n  text-transform: none;\n\n  /* fix buttons height, for twitter bootstrap */\n  line-height: 1em;\n\n  /* Animation center compensation - margins should be symmetric */\n  /* remove if not needed */\n  /* margin-left: .2em; */\n\n  /* you can be more comfortable with increased icons size */\n  /* font-size: 120%; */\n\n  /* Font smoothing. That was taken from TWBS */\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n\n  /* Uncomment for 3D effect */\n  /* text-shadow: 1px 1px 1px rgba(127, 127, 127, 0.3); */\n}\n\n.bpmn-icon-screw-wrench:before { content: '\\e800'; } /* '' */\n.bpmn-icon-trash:before { content: '\\e801'; } /* '' */\n.bpmn-icon-conditional-flow:before { content: '\\e802'; } /* '' */\n.bpmn-icon-default-flow:before { content: '\\e803'; } /* '' */\n.bpmn-icon-gateway-parallel:before { content: '\\e804'; } /* '' */\n.bpmn-icon-intermediate-event-catch-cancel:before { content: '\\e805'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-message:before { content: '\\e806'; } /* '' */\n.bpmn-icon-start-event-compensation:before { content: '\\e807'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-parallel-multiple:before { content: '\\e808'; } /* '' */\n.bpmn-icon-loop-marker:before { content: '\\e809'; } /* '' */\n.bpmn-icon-parallel-mi-marker:before { content: '\\e80a'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-signal:before { content: '\\e80b'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-timer:before { content: '\\e80c'; } /* '' */\n.bpmn-icon-intermediate-event-catch-parallel-multiple:before { content: '\\e80d'; } /* '' */\n.bpmn-icon-intermediate-event-catch-compensation:before { content: '\\e80e'; } /* '' */\n.bpmn-icon-gateway-xor:before { content: '\\e80f'; } /* '' */\n.bpmn-icon-connection:before { content: '\\e810'; } /* '' */\n.bpmn-icon-end-event-cancel:before { content: '\\e811'; } /* '' */\n.bpmn-icon-intermediate-event-catch-condition:before { content: '\\e812'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-parallel-multiple:before { content: '\\e813'; } /* '' */\n.bpmn-icon-start-event-condition:before { content: '\\e814'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-timer:before { content: '\\e815'; } /* '' */\n.bpmn-icon-sequential-mi-marker:before { content: '\\e816'; } /* '' */\n.bpmn-icon-user-task:before { content: '\\e817'; } /* '' */\n.bpmn-icon-business-rule:before { content: '\\e818'; } /* '' */\n.bpmn-icon-sub-process-marker:before { content: '\\e819'; } /* '' */\n.bpmn-icon-start-event-parallel-multiple:before { content: '\\e81a'; } /* '' */\n.bpmn-icon-start-event-error:before { content: '\\e81b'; } /* '' */\n.bpmn-icon-intermediate-event-catch-signal:before { content: '\\e81c'; } /* '' */\n.bpmn-icon-intermediate-event-catch-error:before { content: '\\e81d'; } /* '' */\n.bpmn-icon-end-event-compensation:before { content: '\\e81e'; } /* '' */\n.bpmn-icon-subprocess-collapsed:before { content: '\\e81f'; } /* '' */\n.bpmn-icon-subprocess-expanded:before { content: '\\e820'; } /* '' */\n.bpmn-icon-task:before { content: '\\e821'; } /* '' */\n.bpmn-icon-end-event-error:before { content: '\\e822'; } /* '' */\n.bpmn-icon-intermediate-event-catch-escalation:before { content: '\\e823'; } /* '' */\n.bpmn-icon-intermediate-event-catch-timer:before { content: '\\e824'; } /* '' */\n.bpmn-icon-start-event-escalation:before { content: '\\e825'; } /* '' */\n.bpmn-icon-start-event-signal:before { content: '\\e826'; } /* '' */\n.bpmn-icon-business-rule-task:before { content: '\\e827'; } /* '' */\n.bpmn-icon-manual:before { content: '\\e828'; } /* '' */\n.bpmn-icon-receive:before { content: '\\e829'; } /* '' */\n.bpmn-icon-call-activity:before { content: '\\e82a'; } /* '' */\n.bpmn-icon-start-event-timer:before { content: '\\e82b'; } /* '' */\n.bpmn-icon-start-event-message:before { content: '\\e82c'; } /* '' */\n.bpmn-icon-intermediate-event-none:before { content: '\\e82d'; } /* '' */\n.bpmn-icon-intermediate-event-catch-link:before { content: '\\e82e'; } /* '' */\n.bpmn-icon-end-event-escalation:before { content: '\\e82f'; } /* '' */\n.bpmn-icon-text-annotation:before { content: '\\e830'; } /* '' */\n.bpmn-icon-bpmn-io:before { content: '\\e831'; } /* '' */\n.bpmn-icon-gateway-complex:before { content: '\\e832'; } /* '' */\n.bpmn-icon-gateway-eventbased:before { content: '\\e833'; } /* '' */\n.bpmn-icon-gateway-none:before { content: '\\e834'; } /* '' */\n.bpmn-icon-gateway-or:before { content: '\\e835'; } /* '' */\n.bpmn-icon-end-event-terminate:before { content: '\\e836'; } /* '' */\n.bpmn-icon-end-event-signal:before { content: '\\e837'; } /* '' */\n.bpmn-icon-end-event-none:before { content: '\\e838'; } /* '' */\n.bpmn-icon-end-event-multiple:before { content: '\\e839'; } /* '' */\n.bpmn-icon-end-event-message:before { content: '\\e83a'; } /* '' */\n.bpmn-icon-end-event-link:before { content: '\\e83b'; } /* '' */\n.bpmn-icon-intermediate-event-catch-message:before { content: '\\e83c'; } /* '' */\n.bpmn-icon-intermediate-event-throw-compensation:before { content: '\\e83d'; } /* '' */\n.bpmn-icon-start-event-multiple:before { content: '\\e83e'; } /* '' */\n.bpmn-icon-script:before { content: '\\e83f'; } /* '' */\n.bpmn-icon-manual-task:before { content: '\\e840'; } /* '' */\n.bpmn-icon-send:before { content: '\\e841'; } /* '' */\n.bpmn-icon-service:before { content: '\\e842'; } /* '' */\n.bpmn-icon-receive-task:before { content: '\\e843'; } /* '' */\n.bpmn-icon-user:before { content: '\\e844'; } /* '' */\n.bpmn-icon-start-event-none:before { content: '\\e845'; } /* '' */\n.bpmn-icon-intermediate-event-throw-escalation:before { content: '\\e846'; } /* '' */\n.bpmn-icon-intermediate-event-catch-multiple:before { content: '\\e847'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-escalation:before { content: '\\e848'; } /* '' */\n.bpmn-icon-intermediate-event-throw-link:before { content: '\\e849'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-condition:before { content: '\\e84a'; } /* '' */\n.bpmn-icon-data-object:before { content: '\\e84b'; } /* '' */\n.bpmn-icon-script-task:before { content: '\\e84c'; } /* '' */\n.bpmn-icon-send-task:before { content: '\\e84d'; } /* '' */\n.bpmn-icon-data-store:before { content: '\\e84e'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-escalation:before { content: '\\e84f'; } /* '' */\n.bpmn-icon-intermediate-event-throw-message:before { content: '\\e850'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-multiple:before { content: '\\e851'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-signal:before { content: '\\e852'; } /* '' */\n.bpmn-icon-intermediate-event-throw-multiple:before { content: '\\e853'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-message:before { content: '\\e854'; } /* '' */\n.bpmn-icon-ad-hoc-marker:before { content: '\\e855'; } /* '' */\n.bpmn-icon-service-task:before { content: '\\e856'; } /* '' */\n.bpmn-icon-task-none:before { content: '\\e857'; } /* '' */\n.bpmn-icon-compensation-marker:before { content: '\\e858'; } /* '' */\n.bpmn-icon-start-event-non-interrupting-multiple:before { content: '\\e859'; } /* '' */\n.bpmn-icon-intermediate-event-throw-signal:before { content: '\\e85a'; } /* '' */\n.bpmn-icon-intermediate-event-catch-non-interrupting-condition:before { content: '\\e85b'; } /* '' */\n.bpmn-icon-participant:before { content: '\\e85c'; } /* '' */\n.bpmn-icon-event-subprocess-expanded:before { content: '\\e85d'; } /* '' */\n.bpmn-icon-lane-insert-below:before { content: '\\e85e'; } /* '' */\n.bpmn-icon-space-tool:before { content: '\\e85f'; } /* '' */\n.bpmn-icon-connection-multi:before { content: '\\e860'; } /* '' */\n.bpmn-icon-lane:before { content: '\\e861'; } /* '' */\n.bpmn-icon-lasso-tool:before { content: '\\e862'; } /* '' */\n.bpmn-icon-lane-insert-above:before { content: '\\e863'; } /* '' */\n.bpmn-icon-lane-divide-three:before { content: '\\e864'; } /* '' */\n.bpmn-icon-lane-divide-two:before { content: '\\e865'; } /* '' */\n.bpmn-icon-data-input:before { content: '\\e866'; } /* '' */\n.bpmn-icon-data-output:before { content: '\\e867'; } /* '' */\n.bpmn-icon-hand-tool:before { content: '\\e868'; } /* '' */\n.bpmn-icon-group:before { content: '\\e869'; } /* '' */\n.bpmn-icon-transaction:before { content: '\\e8c4'; } /* '' */",""]);const r=a},1629:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),s=i.n(n),o=i(3645),a=i.n(o)()(s());a.push([e.id,'.bjs-container {\n  --bjs-font-family: Arial, sans-serif;\n\n  --color-grey-225-10-15: hsl(225, 10%, 15%);\n  --color-grey-225-10-35: hsl(225, 10%, 35%);\n  --color-grey-225-10-55: hsl(225, 10%, 55%);\n  --color-grey-225-10-75: hsl(225, 10%, 75%);\n  --color-grey-225-10-80: hsl(225, 10%, 80%);\n  --color-grey-225-10-85: hsl(225, 10%, 85%);\n  --color-grey-225-10-90: hsl(225, 10%, 90%);\n  --color-grey-225-10-95: hsl(225, 10%, 95%); \n  --color-grey-225-10-97: hsl(225, 10%, 97%);\n\n  --color-blue-205-100-45: hsl(205, 100%, 45%);\n  --color-blue-205-100-45-opacity-30: hsla(205, 100%, 45%, 30%);\n  --color-blue-205-100-50: hsl(205, 100%, 50%);\n  --color-blue-205-100-95: hsl(205, 100%, 95%);\n\n  --color-green-150-86-44: hsl(150, 86%, 44%);\n\n  --color-red-360-100-40: hsl(360, 100%, 40%);\n  --color-red-360-100-45: hsl(360, 100%, 45%);\n  --color-red-360-100-92: hsl(360, 100%, 92%);\n  --color-red-360-100-97: hsl(360, 100%, 97%);\n\n  --color-white: hsl(0, 0%, 100%);\n  --color-black: hsl(0, 0%, 0%); \n  --color-black-opacity-05: hsla(0, 0%, 0%, 5%); \n  --color-black-opacity-10: hsla(0, 0%, 0%, 10%);\n\n  --breadcrumbs-font-family: var(--bjs-font-family);\n  --breadcrumbs-item-color: var(--color-blue-205-100-50);\n  --breadcrumbs-arrow-color: var(--color-black);\n  --drilldown-fill-color: var(--color-white);\n  --drilldown-background-color: var(--color-blue-205-100-50);\n}\n\n.bjs-breadcrumbs {\n  position: absolute;\n  display: none;\n  flex-wrap: wrap;\n  align-items: center;\n  top: 30px;\n  left: 30px;\n  padding: 0px;\n  margin: 0px;\n  font-family: var(--breadcrumbs-font-family);\n  font-size: 16px;\n  line-height: normal;\n}\n\n.bjs-breadcrumbs-shown .bjs-breadcrumbs {\n  display: flex;\n}\n\n.djs-palette-shown .bjs-breadcrumbs {\n  left: 90px;\n}\n\n.djs-palette-shown.djs-palette-two-column .bjs-breadcrumbs {\n  left: 140px;\n}\n\n.bjs-breadcrumbs li {\n  display: inline-flex;\n  padding-bottom: 5px;\n}\n\n.bjs-breadcrumbs li a {\n  cursor: pointer;\n  color: var(--breadcrumbs-item-color);\n}\n\n.bjs-breadcrumbs li:last-of-type a {\n  color: inherit;\n  cursor: default;\n}\n\n.bjs-breadcrumbs li:not(:first-child)::before {\n  content: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" /><path d="M0 0h24v24H0z" fill="none" /></svg>\');\n  padding: 0 8px;\n  color: var(--breadcrumbs-arrow-color);\n  height: 1em;\n}\n\n.bjs-breadcrumbs .bjs-crumb {\n  display: inline-block;\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.bjs-drilldown {\n  width: 20px;\n  height: 20px;\n\n  padding: 0px;\n  margin-left: -20px;\n\n  cursor: pointer;\n  border: none;\n  border-radius: 2px;\n  outline: none;\n\n  fill: var(--drilldown-fill-color);\n  background-color: var(--drilldown-background-color);\n}\n\n.bjs-drilldown-empty {\n  display: none;\n}\n\n.selected .bjs-drilldown-empty {\n  display: inherit;\n}',""]);const r=a},2622:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),s=i.n(n),o=i(3645),a=i.n(o)()(s());a.push([e.id,"/**\n * color definitions\n */\n.djs-container {\n  --color-grey-225-10-15: hsl(225, 10%, 15%);\n  --color-grey-225-10-35: hsl(225, 10%, 35%);\n  --color-grey-225-10-55: hsl(225, 10%, 55%);\n  --color-grey-225-10-75: hsl(225, 10%, 75%);\n  --color-grey-225-10-80: hsl(225, 10%, 80%);\n  --color-grey-225-10-85: hsl(225, 10%, 85%);\n  --color-grey-225-10-90: hsl(225, 10%, 90%);\n  --color-grey-225-10-95: hsl(225, 10%, 95%); \n  --color-grey-225-10-97: hsl(225, 10%, 97%);\n\n  --color-blue-205-100-45: hsl(205, 100%, 45%);\n  --color-blue-205-100-45-opacity-30: hsla(205, 100%, 45%, 30%);\n  --color-blue-205-100-50: hsl(205, 100%, 50%);\n  --color-blue-205-100-95: hsl(205, 100%, 95%);\n\n  --color-green-150-86-44: hsl(150, 86%, 44%);\n\n  --color-red-360-100-40: hsl(360, 100%, 40%);\n  --color-red-360-100-45: hsl(360, 100%, 45%);\n  --color-red-360-100-92: hsl(360, 100%, 92%);\n  --color-red-360-100-97: hsl(360, 100%, 97%);\n\n  --color-white: hsl(0, 0%, 100%);\n  --color-black: hsl(0, 0%, 0%); \n  --color-black-opacity-05: hsla(0, 0%, 0%, 5%); \n  --color-black-opacity-10: hsla(0, 0%, 0%, 10%);\n\n  --bendpoint-fill-color: var(--color-blue-205-100-45-opacity-30);\n  --bendpoint-stroke-color: var(--color-blue-205-100-50);\n\n  --context-pad-entry-background-color: var(--color-white);\n  --context-pad-entry-hover-background-color: var(--color-grey-225-10-95);\n\n  --element-dragger-color: var(--color-blue-205-100-50);\n  --element-hover-outline-fill-color: var(--color-blue-205-100-45);\n  --element-selected-outline-stroke-color: var(--color-blue-205-100-50);\n\n  --lasso-fill-color: var(--color-black-opacity-05);\n  --lasso-stroke-color: var(--color-black);\n\n  --palette-entry-color: var(--color-grey-225-10-15);\n  --palette-entry-hover-color: var(--color-blue-205-100-45);\n  --palette-entry-selected-color: var(--color-blue-205-100-50);\n  --palette-separator-color: var(--color-grey-225-10-75);\n  --palette-toggle-hover-background-color: var(--color-grey-225-10-55);\n  --palette-background-color: var(--color-grey-225-10-97);\n  --palette-border-color: var(--color-grey-225-10-75);\n\n  --popup-body-background-color: var(--color-white);\n  --popup-header-entry-selected-color: var(--color-blue-205-100-50);\n  --popup-header-entry-selected-background-color: var(--color-black-opacity-10);\n  --popup-header-separator-color: var(--color-grey-225-10-75);\n  --popup-background-color: var(--color-grey-225-10-97);\n  --popup-border-color: var(--color-grey-225-10-75);\n\n  --resizer-fill-color: var(--color-blue-205-100-45-opacity-30);\n  --resizer-stroke-color: var(--color-blue-205-100-50);\n\n  --search-container-background-color: var(--color-grey-225-10-97);\n  --search-container-border-color: var(--color-blue-205-100-50);\n  --search-container-box-shadow-color: var(--color-blue-205-100-95);\n  --search-container-box-shadow-inset-color: var(--color-grey-225-10-80);\n  --search-input-border-color: var(--color-grey-225-10-75);\n  --search-result-border-color: var(--color-grey-225-10-75);\n  --search-result-highlight-color: var(--color-black);\n  --search-result-selected-color: var(--color-blue-205-100-45-opacity-30);\n\n  --shape-attach-allowed-stroke-color: var(--color-blue-205-100-50);\n  --shape-connect-allowed-fill-color: var(--color-grey-225-10-97);\n  --shape-drop-allowed-fill-color: var(--color-grey-225-10-97);\n  --shape-drop-not-allowed-fill-color: var(--color-red-360-100-97);\n  --shape-resize-preview-stroke-color: var(--color-blue-205-100-50);\n\n  --snap-line-stroke-color: var(--color-blue-205-100-45-opacity-30);\n\n  --space-tool-crosshair-stroke-color: var(--color-black);\n\n  --tooltip-error-background-color: var(--color-red-360-100-97);\n  --tooltip-error-border-color: var(--color-red-360-100-45);\n  --tooltip-error-color: var(--color-red-360-100-45);\n}\n\n/**\n * outline styles\n */\n\n.djs-outline {\n  fill: none;\n  visibility: hidden;\n}\n\n.djs-element.hover .djs-outline,\n.djs-element.selected .djs-outline {\n  visibility: visible;\n  shape-rendering: geometricPrecision;\n  stroke-dasharray: 3,3;\n}\n\n.djs-element.selected .djs-outline {\n  stroke: var(--element-selected-outline-stroke-color);\n  stroke-width: 1px;\n}\n\n.djs-element.hover .djs-outline {\n  stroke: var(--element-hover-outline-fill-color);\n  stroke-width: 1px;\n}\n\n.djs-shape.connect-ok .djs-visual > :nth-child(1) {\n  fill: var(--shape-connect-allowed-fill-color) !important;\n}\n\n.djs-shape.connect-not-ok .djs-visual > :nth-child(1),\n.djs-shape.drop-not-ok .djs-visual > :nth-child(1) {\n  fill: var(--shape-drop-not-allowed-fill-color) !important;\n}\n\n.djs-shape.new-parent .djs-visual > :nth-child(1) {\n  fill: var(--shape-drop-allowed-fill-color) !important;\n}\n\nsvg.drop-not-ok {\n  background: var(--shape-drop-not-allowed-fill-color) !important;\n}\n\nsvg.new-parent {\n  background: var(--shape-drop-allowed-fill-color) !important;\n}\n\n.djs-connection.connect-ok .djs-visual > :nth-child(1),\n.djs-connection.drop-ok .djs-visual > :nth-child(1) {\n  stroke: var(--shape-drop-allowed-fill-color) !important;\n}\n\n.djs-connection.connect-not-ok .djs-visual > :nth-child(1),\n.djs-connection.drop-not-ok .djs-visual > :nth-child(1) {\n  stroke: var(--shape-drop-not-allowed-fill-color) !important;\n}\n\n.drop-not-ok,\n.connect-not-ok {\n  cursor: not-allowed;\n}\n\n.djs-element.attach-ok .djs-visual > :nth-child(1) {\n  stroke-width: 5px !important;\n  stroke: var(--shape-attach-allowed-stroke-color) !important;\n}\n\n.djs-frame.connect-not-ok .djs-visual > :nth-child(1),\n.djs-frame.drop-not-ok .djs-visual > :nth-child(1) {\n  stroke-width: 3px !important;\n  stroke: var(--shape-drop-not-allowed-fill-color) !important;\n  fill: none !important;\n}\n\n/**\n* Selection box style\n*\n*/\n.djs-lasso-overlay {\n  fill: var(--lasso-fill-color);\n\n  stroke-dasharray: 5 1 3 1;\n  stroke: var(--lasso-stroke-color);\n\n  shape-rendering: geometricPrecision;\n  pointer-events: none;\n}\n\n/**\n * Resize styles\n */\n.djs-resize-overlay {\n  fill: none;\n\n  stroke-dasharray: 5 1 3 1;\n  stroke: var(--shape-resize-preview-stroke-color);\n\n  pointer-events: none;\n}\n\n.djs-resizer-hit {\n  fill: none;\n  pointer-events: all;\n}\n\n.djs-resizer-visual {\n  fill: var(--resizer-fill-color);\n  stroke-width: 1px;\n  stroke-opacity: 0.5;\n  stroke: var(--resizer-stroke-color);\n  shape-rendering: geometricprecision;\n}\n\n.djs-resizer:hover .djs-resizer-visual {\n  stroke: var(--resizer-stroke-color);\n  stroke-opacity: 1;\n}\n\n.djs-cursor-resize-ns,\n.djs-resizer-n,\n.djs-resizer-s {\n  cursor: ns-resize;\n}\n\n.djs-cursor-resize-ew,\n.djs-resizer-e,\n.djs-resizer-w {\n  cursor: ew-resize;\n}\n\n.djs-cursor-resize-nwse,\n.djs-resizer-nw,\n.djs-resizer-se {\n  cursor: nwse-resize;\n}\n\n.djs-cursor-resize-nesw,\n.djs-resizer-ne,\n.djs-resizer-sw {\n  cursor: nesw-resize;\n}\n\n.djs-shape.djs-resizing > .djs-outline {\n  visibility: hidden !important;\n}\n\n.djs-shape.djs-resizing > .djs-resizer {\n  visibility: hidden;\n}\n\n.djs-dragger > .djs-resizer {\n  visibility: hidden;\n}\n\n/**\n * drag styles\n */\n.djs-dragger * {\n  fill: none !important;\n  stroke: var(--element-dragger-color) !important;\n}\n\n.djs-dragger tspan,\n.djs-dragger text {\n  fill: var(--element-dragger-color) !important;\n  stroke: none !important;\n}\n\nmarker.djs-dragger circle,\nmarker.djs-dragger path,\nmarker.djs-dragger polygon,\nmarker.djs-dragger polyline,\nmarker.djs-dragger rect {\n  fill: var(--element-dragger-color) !important;\n  stroke: none !important;\n}\n\nmarker.djs-dragger text,\nmarker.djs-dragger tspan {\n  fill: none !important;\n  stroke: var(--element-dragger-color) !important;\n}\n\n.djs-dragging {\n  opacity: 0.3;\n}\n\n.djs-dragging,\n.djs-dragging > * {\n  pointer-events: none !important;\n}\n\n.djs-dragging .djs-context-pad,\n.djs-dragging .djs-outline {\n  display: none !important;\n}\n\n/**\n * no pointer events for visual\n */\n.djs-visual,\n.djs-outline {\n  pointer-events: none;\n}\n\n.djs-element.attach-ok .djs-hit {\n  stroke-width: 60px !important;\n}\n\n/**\n * all pointer events for hit shape\n */\n.djs-element > .djs-hit-all {\n  pointer-events: all;\n}\n\n.djs-element > .djs-hit-stroke,\n.djs-element > .djs-hit-click-stroke {\n  pointer-events: stroke;\n}\n\n/**\n * all pointer events for hit shape\n */\n.djs-drag-active .djs-element > .djs-hit-click-stroke {\n  pointer-events: all;\n}\n\n/**\n * shape / connection basic styles\n */\n.djs-connection .djs-visual {\n  stroke-width: 2px;\n  fill: none;\n}\n\n.djs-cursor-grab {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n}\n\n.djs-cursor-grabbing {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.djs-cursor-crosshair {\n  cursor: crosshair;\n}\n\n.djs-cursor-move {\n  cursor: move;\n}\n\n.djs-cursor-resize-ns {\n  cursor: ns-resize;\n}\n\n.djs-cursor-resize-ew {\n  cursor: ew-resize;\n}\n\n\n/**\n * snapping\n */\n.djs-snap-line {\n  stroke: var(--snap-line-stroke-color);\n  stroke-linecap: round;\n  stroke-width: 2px;\n  pointer-events: none;\n}\n\n/**\n * snapping\n */\n.djs-crosshair {\n  stroke: var(--space-tool-crosshair-stroke-color);\n  stroke-linecap: round;\n  stroke-width: 1px;\n  pointer-events: none;\n  shape-rendering: crispEdges;\n  stroke-dasharray: 5, 5;\n}\n\n/**\n * palette\n */\n\n.djs-palette {\n  position: absolute;\n  left: 20px;\n  top: 20px;\n\n  box-sizing: border-box;\n  width: 48px;\n}\n\n.djs-palette .separator {\n  margin: 0 5px;\n  padding-top: 5px;\n\n  border: none;\n  border-bottom: solid 1px var(--palette-separator-color);\n\n  clear: both;\n}\n\n.djs-palette .entry:before {\n  vertical-align: text-bottom;\n}\n\n.djs-palette .djs-palette-toggle {\n  cursor: pointer;\n}\n\n.djs-palette .entry,\n.djs-palette .djs-palette-toggle {\n  color: var(--palette-entry-color);\n  font-size: 30px;\n\n  text-align: center;\n}\n\n.djs-palette .entry {\n  float: left;\n}\n\n.djs-palette .entry img {\n  max-width: 100%;\n}\n\n.djs-palette .djs-palette-entries:after {\n  content: '';\n  display: table;\n  clear: both;\n}\n\n.djs-palette .djs-palette-toggle:hover {\n  background: var(--palette-toggle-hover-background-color);\n}\n\n.djs-palette .entry:hover {\n  color: var(--palette-entry-hover-color);\n}\n\n.djs-palette .highlighted-entry {\n  color: var(--palette-entry-selected-color) !important;\n}\n\n.djs-palette .entry,\n.djs-palette .djs-palette-toggle {\n  width: 46px;\n  height: 46px;\n  line-height: 46px;\n  cursor: default;\n}\n\n/**\n * Palette open / two-column layout is controlled via\n * classes on the palette. Events to hook into palette\n * changed life-cycle are available in addition.\n */\n.djs-palette.two-column.open {\n  width: 94px;\n}\n\n.djs-palette:not(.open) .djs-palette-entries {\n  display: none;\n}\n\n.djs-palette:not(.open) {\n  overflow: hidden;\n}\n\n.djs-palette.open .djs-palette-toggle {\n  display: none;\n}\n\n/**\n * context-pad\n */\n.djs-overlay-context-pad {\n  width: 72px;\n  z-index: 100;\n}\n\n.djs-context-pad {\n  position: absolute;\n  display: none;\n  pointer-events: none;\n}\n\n.djs-context-pad .entry {\n  width: 22px;\n  height: 22px;\n  text-align: center;\n  display: inline-block;\n  font-size: 22px;\n  margin: 0 2px 2px 0;\n\n  border-radius: 3px;\n\n  cursor: default;\n\n  background-color: var(--context-pad-entry-background-color);\n  box-shadow: 0 0 2px 1px var(--context-pad-entry-background-color);\n  pointer-events: all;\n}\n\n.djs-context-pad .entry:before {\n  vertical-align: top;\n}\n\n.djs-context-pad .entry:hover {\n  background: var(--context-pad-entry-hover-background-color);\n}\n\n.djs-context-pad.open {\n  display: block;\n}\n\n/**\n * popup styles\n */\n.djs-popup .entry {\n  line-height: 20px;\n  white-space: nowrap;\n  cursor: default;\n}\n\n/* larger font for prefixed icons */\n.djs-popup .entry:before {\n  vertical-align: middle;\n  font-size: 20px;\n}\n\n.djs-popup .entry > span {\n  vertical-align: middle;\n  font-size: 14px;\n}\n\n.djs-popup .entry:hover,\n.djs-popup .entry.active:hover {\n  background: var(--popup-header-entry-selected-background-color);\n}\n\n.djs-popup .entry.disabled {\n  background: inherit;\n}\n\n.djs-popup .djs-popup-header .entry {\n  display: inline-block;\n  padding: 2px 3px 2px 3px;\n\n  border: solid 1px transparent;\n  border-radius: 3px;\n}\n\n.djs-popup .djs-popup-header .entry.active {\n  color: var(--popup-header-entry-selected-color);\n  border: solid 1px var(--popup-header-entry-selected-color);\n  background-color: var(--popup-header-entry-selected-background-color);\n}\n\n.djs-popup-body .entry {\n  padding: 4px 10px 4px 5px;\n}\n\n.djs-popup-body .entry > span {\n  margin-left: 5px;\n}\n\n.djs-popup-body {\n  background-color: var(--popup-body-background-color);\n}\n\n.djs-popup-header {\n  border-bottom: 1px solid var(--popup-header-separator-color);\n}\n\n.djs-popup-header .entry {\n  margin: 1px;\n  margin-left: 3px;\n}\n\n.djs-popup-header .entry:last-child {\n  margin-right: 3px;\n}\n\n/**\n * popup / palette styles\n */\n.djs-palette {\n  background: var(--palette-background-color);\n  border: solid 1px var(--palette-border-color);\n  border-radius: 2px;\n}\n\n.djs-popup {\n  background: var(--popup-background-color);\n  border: solid 1px var(--popup-border-color);\n  border-radius: 2px;\n}\n\n/**\n * touch\n */\n\n.djs-shape,\n.djs-connection {\n  touch-action: none;\n}\n\n.djs-segment-dragger,\n.djs-bendpoint {\n  display: none;\n}\n\n/**\n * bendpoints\n */\n.djs-segment-dragger .djs-visual {\n  display: none;\n\n  fill: var(--bendpoint-fill-color);\n  stroke: var(--bendpoint-stroke-color);\n  stroke-width: 1px;\n  stroke-opacity: 1;\n}\n\n.djs-segment-dragger:hover .djs-visual {\n  display: block;\n}\n\n.djs-bendpoint .djs-visual {\n  fill: var(--bendpoint-fill-color);\n  stroke: var(--bendpoint-stroke-color);\n  stroke-width: 1px;\n  stroke-opacity: 0.5;\n}\n\n.djs-segment-dragger:hover,\n.djs-bendpoints.hover .djs-segment-dragger,\n.djs-bendpoints.selected .djs-segment-dragger,\n.djs-bendpoint:hover,\n.djs-bendpoints.hover .djs-bendpoint,\n.djs-bendpoints.selected .djs-bendpoint {\n  display: block;\n}\n\n.djs-drag-active .djs-bendpoints * {\n  display: none;\n}\n\n.djs-bendpoints:not(.hover) .floating {\n  display: none;\n}\n\n.djs-segment-dragger:hover .djs-visual,\n.djs-segment-dragger.djs-dragging .djs-visual,\n.djs-bendpoint:hover .djs-visual,\n.djs-bendpoint.floating .djs-visual {\n  fill: var(--bendpoint-fill-color);\n  stroke: var(--bendpoint-stroke-color);\n  stroke-opacity: 1;\n}\n\n.djs-bendpoint.floating .djs-hit {\n  pointer-events: none;\n}\n\n.djs-segment-dragger .djs-hit,\n.djs-bendpoint .djs-hit {\n  fill: none;\n  pointer-events: all;\n}\n\n.djs-segment-dragger.horizontal .djs-hit {\n  cursor: ns-resize;\n}\n\n.djs-segment-dragger.vertical .djs-hit {\n  cursor: ew-resize;\n}\n\n.djs-segment-dragger.djs-dragging .djs-hit {\n  pointer-events: none;\n}\n\n.djs-updating,\n.djs-updating > * {\n  pointer-events: none !important;\n}\n\n.djs-updating .djs-context-pad,\n.djs-updating .djs-outline,\n.djs-updating .djs-bendpoint,\n.connect-ok .djs-bendpoint,\n.connect-not-ok .djs-bendpoint,\n.drop-ok .djs-bendpoint,\n.drop-not-ok .djs-bendpoint {\n  display: none !important;\n}\n\n.djs-segment-dragger.djs-dragging,\n.djs-bendpoint.djs-dragging {\n  display: block;\n  opacity: 1.0;\n}\n\n\n/**\n * tooltips\n */\n.djs-tooltip-error {\n  width: 160px;\n  padding: 6px;\n\n  background: var(--tooltip-error-background-color);\n  border: solid 1px var(--tooltip-error-border-color);\n  border-radius: 2px;\n  color: var(--tooltip-error-color);\n  font-size: 12px;\n  line-height: 16px;\n\n  opacity: 0.75;\n}\n\n.djs-tooltip-error:hover {\n  opacity: 1;\n}\n\n\n/**\n * search pad\n */\n.djs-search-container {\n  position: absolute;\n  top: 20px;\n  left: 0;\n  right: 0;\n  margin-left: auto;\n  margin-right: auto;\n\n  width: 25%;\n  min-width: 300px;\n  max-width: 400px;\n  z-index: 10;\n\n  font-size: 1.05em;\n  opacity: 0.9;\n  background: var(--search-container-background-color);\n  border: solid 1px var(--search-container-border-color);\n  border-radius: 2px;\n  box-shadow: 0 0 0 2px var(--search-container-box-shadow-color), 0 0 0 1px var(--search-container-box-shadow-inset-color) inset;\n}\n\n.djs-search-container:not(.open) {\n  display: none;\n}\n\n.djs-search-input input {\n  font-size: 1.05em;\n  width: 100%;\n  padding: 6px 10px;\n  border: 1px solid var(--search-input-border-color);\n  box-sizing: border-box;\n}\n\n.djs-search-input input:focus {\n  outline: none;\n  border-color: var(--search-input-border-color);\n}\n\n.djs-search-results {\n  position: relative;\n  overflow-y: auto;\n  max-height: 200px;\n}\n\n.djs-search-results:hover {\n  cursor: pointer;\n}\n\n.djs-search-result {\n  width: 100%;\n  padding: 6px 10px;\n  background: white;\n  border-bottom: solid 1px var(--search-result-border-color);\n  border-radius: 1px;\n}\n\n.djs-search-highlight {\n  color: var(--search-result-highlight-color);\n}\n\n.djs-search-result-primary {\n  margin: 0 0 10px;\n}\n\n.djs-search-result-secondary {\n  font-family: monospace;\n  margin: 0;\n}\n\n.djs-search-result:hover {\n  background: var(--search-result-selected-color);\n}\n\n.djs-search-result-selected {\n  background: var(--search-result-selected-color);\n}\n\n.djs-search-result-selected:hover {\n  background: var(--search-result-selected-color);\n}\n\n.djs-search-overlay {\n  background: var(--search-result-selected-color);\n}\n\n/**\n * hidden styles\n */\n.djs-element-hidden,\n.djs-element-hidden .djs-hit,\n.djs-element-hidden .djs-outline,\n.djs-label-hidden .djs-label {\n  display: none !important;\n}\n",""]);const r=a},1597:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(8081),s=i.n(n),o=i(3645),a=i.n(o)()(s());a.push([e.id,"@keyframes pulseDark {\n   0% {\n      /* color: darkorange; */\n      transform: scale(1);\n      text-shadow: 0 0 1px rgba(0, 0, 0, 0.4);\n   }\n   50% {\n      /* color: orange; */\n   }\n   100% {\n      /* color: darkorange; */\n      transform: scale(1.25);\n      text-shadow: 0 3px 3px rgba(0, 0, 0, 0.4);\n   }\n}\n@keyframes pulseLight {\n   0% {\n      /* color: darkorange; */\n      transform: scale(1);\n      text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);\n   }\n   50% {\n      /* color: orange; */\n   }\n   100% {\n      /* color: darkorange; */\n      transform: scale(1.25);\n      text-shadow: 0 3px 3px rgba(0, 0, 0, 0.1);\n   }\n}\n.pulseDark {\n   animation-name: pulseDark;\n   animation-duration: 1s;\n   animation-timing-function: ease-out;\n   animation-direction: alternate;\n   animation-iteration-count: infinite;\n   animation-play-state: running;\n   color: orange !important;\n}\n.pulseLight {\n   animation-name: pulseLight;\n   animation-duration: 1s;\n   animation-timing-function: ease-out;\n   animation-direction: alternate;\n   animation-iteration-count: infinite;\n   animation-play-state: running;\n   color: orange !important;\n}\n.smalltext {\n   font-size: small !important;\n}\n.ab-object-list-item .webix_sidebar_dir_icon {\n   margin-right: 20px;\n}\n.ab-datacollection-list-item .webix_sidebar_dir_icon {\n   margin-right: 20px;\n}\n.ab-interface-list-item .webix_sidebar_dir_icon {\n   margin-right: 20px;\n}\n.darkorange .webix_button {\n   background-color: darkorange !important;\n}\n.warningtext {\n   color: orange;\n}\n.warningslist {\n   list-style-type: none;\n   margin: 0;\n   padding: 0;\n   line-height: 28px;\n   background-color: transparent;\n   color: white;\n}\n.warningslist li {\n   border-bottom: 1px solid rgba(0, 0, 0, 0.2);\n}\n.webix_theme_dark {\n   background-color: #4a4e58;\n}\n.lighten {\n   opacity: 0.4;\n}\n.app_form_window {\n   border-radius: 8px;\n}\n.app_form_window .webix_win_head {\n   background-color: #b8b8b8;\n}\n.app_form_window div.webix_view.webix_control.webix_el_icon.alert {\n   padding: 0px;\n}\n/* main view background (transparent by default) */\n.app_form_window .alert {\n   background-color: transparent;\n}\n/* main font color */\n.app_form_window .alert .webix_icon {\n   color: #eed202;\n}\n/* circle background (hover) */\n.app_form_window .alert .webix_icon_button:hover:before {\n   opacity: 0.8;\n}\n/* hover: font color */\n.app_form_window .alert .webix_icon_button:hover .webix_icon {\n   color: #d6bd01;\n}\n.app_form_window .webix_template {\n   font-size: 18px;\n   background-color: #b8b8b8;\n}\n.app_form_window .webix_label_right {\n   font-weight: 500;\n   color: rgb(49, 49, 49);\n   width: 340px;\n   padding-left: 10px;\n}\n.app_form_window .webix_scroll_cont .npr_smallLabels .webix_el_box {\n   font-size: 16px;\n   font-weight: 500;\n   color: #33b5e5;\n   text-align: right;\n}\n.app_form_window .webix_multicombo {\n   border: 2px solid #eee;\n   border-radius: 6px;\n}\n.app_form_window .webix_view .webix_layout_form {\n   border: 1px solid #eee;\n   border-radius: 6px;\n}\n.app_form_window div.webix_view.webix_form.no-margin.webix_layout_form {\n   background-color: #eee;\n}\n.app_form_window .webix_button {\n   border-radius: 6px;\n}\n.app_form_window_2 {\n   border-radius: 6px;\n}\n.app_form_window_2 .webix_win_head {\n   background-color: #b8b8b8;\n}\n.app_form_window_2 .webix_template {\n   font-size: 18px;\n   background-color: #b8b8b8;\n}\n/* Tab editing */\n.ab-tab-back:hover,\n.ab-tab-next:hover,\n.ab-tab-up:hover,\n.ab-tab-down:hover {\n   cursor: e-resize;\n   opacity: 1;\n}\n.ab-tab-back:hover {\n   cursor: w-resize;\n}\n.ab-tab-up:hover {\n   cursor: n-resize;\n   opacity: 1;\n}\n.ab-tab-down:hover {\n   cursor: s-resize;\n}\n.ab-tab-back,\n.ab-tab-next,\n.ab-tab-up,\n.ab-tab-down {\n   float: left;\n   margin-left: 10px;\n   background: #1ca1c1;\n   opacity: 0.8;\n   width: 20px;\n   height: 20px;\n   border-radius: 10px;\n   line-height: 20px !important;\n   padding-right: 2px;\n   color: white;\n}\n.fa-pencil-square.ab-tab-edit {\n   opacity: 0.4;\n}\n.fa-pencil.ab-tab-edit {\n   opacity: 0;\n   position: absolute;\n   left: 12px;\n   top: 12px;\n   background: #1ca1c1;\n   width: 20px;\n   height: 20px;\n   text-align: center;\n   line-height: 20px !important;\n   border-radius: 100%;\n   font-size: 11px;\n}\n.ab-tab-edit:hover {\n   opacity: 1;\n   transform: scale(1.2);\n}\n.webix_tree_item:hover .fa-pencil.ab-tab-edit {\n   opacity: 1;\n}\n.ab-tab-next {\n   float: right;\n   margin-right: 10px;\n   padding-left: 6px;\n}\n.ab-tab-up,\n.ab-tab-down {\n   /*   float: right;*/\n   /*   margin: 12px -2px 12px 15px;*/\n   /*   padding-left: 6px;*/\n   opacity: 0.2;\n   border-radius: 0 !important;\n   position: absolute;\n   right: 1px;\n   top: 0;\n   line-height: 22px !important;\n   width: 22px;\n   height: 21px;\n   text-align: center;\n   margin: 0;\n}\n.ab-tab-down {\n   top: 22px;\n}\n.webix_tree_item {\n   position: relative;\n   cursor: grab;\n}\n.webix_all_tabs div:nth-child(1) .ab-tab-back {\n   display: none;\n}\n.webix_all_tabs div:nth-last-child(1) .ab-tab-next {\n   display: none;\n}\n\n\n/* PWA Designer */\n\n.dragme {\n   display:inline-block;\n   color: #CCC;\n   padding: 5px 7px;\n   float: right;\n   cursor: grab;\n}\n.webix_drag_zone .fa {\n   display: none;\n}\n.circleme {\n   background: #AAA;\n   color: #FFF;\n   font-size:8px;\n   width: 15px;\n   height: 15px;\n   text-align: center;\n   line-height: 15px;\n   border-radius: 15px;\n   vertical-align: text-top;\n}\n\n.webix_tree_leaves {\n   display: block !important;\n}",""]);const r=a},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,s,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(n)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);n&&a[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),s&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=s):h[4]="".concat(s)),t.push(h))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},8269:function(e,t,i){var n;n=void 0!==i.g?i.g:this,e.exports=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var t=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var t,i=String(e),n=i.length,s=-1,o="",a=i.charCodeAt(0);++s<n;)0!=(t=i.charCodeAt(s))?o+=t>=1&&t<=31||127==t||0==s&&t>=48&&t<=57||1==s&&t>=48&&t<=57&&45==a?"\\"+t.toString(16)+" ":0==s&&1==n&&45==t||!(t>=128||45==t||95==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)?"\\"+i.charAt(s):i.charAt(s):o+="�";return o};return e.CSS||(e.CSS={}),e.CSS.escape=t,t}(n)},2270:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},840:(e,t,i)=>{var n;!function(s,o,a,r){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],h=o.createElement("div"),d=Math.round,u=Math.abs,p=Date.now;function f(e,t,i){return setTimeout(O(e,i),t)}function m(e,t,i){return!!Array.isArray(e)&&(g(e,i[t],i),!0)}function g(e,t,i){var n;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==r)for(n=0;n<e.length;)t.call(i,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n,e)}function b(e,t,i){var n="DEPRECATED METHOD: "+t+"\n"+i+" AT \n";return function(){var t=new Error("get-stack-trace"),i=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=s.console&&(s.console.warn||s.console.log);return o&&o.call(s.console,n,i),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===r||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==r&&null!==n)for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])}return t}:Object.assign;var v=b((function(e,t,i){for(var n=Object.keys(t),s=0;s<n.length;)(!i||i&&e[n[s]]===r)&&(e[n[s]]=t[n[s]]),s++;return e}),"extend","Use `assign`."),w=b((function(e,t){return v(e,t,!0)}),"merge","Use `assign`.");function y(e,t,i){var n,s=t.prototype;(n=e.prototype=Object.create(s)).constructor=e,n._super=s,i&&l(n,i)}function O(e,t){return function(){return e.apply(t,arguments)}}function x(e,t){return"function"==typeof e?e.apply(t&&t[0]||r,t):e}function $(e,t){return e===r?t:e}function C(e,t,i){g(E(t),(function(t){e.addEventListener(t,i,!1)}))}function S(e,t,i){g(E(t),(function(t){e.removeEventListener(t,i,!1)}))}function _(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function k(e,t){return e.indexOf(t)>-1}function E(e){return e.trim().split(/\s+/g)}function P(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function A(e){return Array.prototype.slice.call(e,0)}function R(e,t,i){for(var n=[],s=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];P(s,a)<0&&n.push(e[o]),s[o]=a,o++}return i&&(n=t?n.sort((function(e,i){return e[t]>i[t]})):n.sort()),n}function D(e,t){for(var i,n,s=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((n=(i=c[o])?i+s:t)in e)return n;o++}return r}var V=1;function L(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||s}var T="ontouchstart"in s,B=D(s,"PointerEvent")!==r,F=T&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),I="touch",j="mouse",M=["x","y"],Q=["clientX","clientY"];function W(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){x(e.options.enable,[e])&&i.handler(t)},this.init()}function N(e,t,i){var n=i.pointers.length,s=i.changedPointers.length,o=1&t&&n-s==0,a=12&t&&n-s==0;i.isFirst=!!o,i.isFinal=!!a,o&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,n=t.pointers,s=n.length;i.firstInput||(i.firstInput=Z(t)),s>1&&!i.firstMultiple?i.firstMultiple=Z(t):1===s&&(i.firstMultiple=!1);var o=i.firstInput,a=i.firstMultiple,l=a?a.center:o.center,c=t.center=q(n);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=G(l,c),t.distance=X(l,c),function(e,t){var i=t.center,n=e.offsetDelta||{},s=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(s=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=s.x+(i.x-n.x),t.deltaY=s.y+(i.y-n.y)}(i,t),t.offsetDirection=U(t.deltaX,t.deltaY);var h,d,f=z(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=u(f.x)>u(f.y)?f.x:f.y,t.scale=a?(h=a.pointers,X((d=n)[0],d[1],Q)/X(h[0],h[1],Q)):1,t.rotation=a?function(e,t){return G(t[1],t[0],Q)+G(e[1],e[0],Q)}(a.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,n,s,o,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(l>25||a.velocity===r)){var c=t.deltaX-a.deltaX,h=t.deltaY-a.deltaY,d=z(l,c,h);n=d.x,s=d.y,i=u(d.x)>u(d.y)?d.x:d.y,o=U(c,h),e.lastInterval=t}else i=a.velocity,n=a.velocityX,s=a.velocityY,o=a.direction;t.velocity=i,t.velocityX=n,t.velocityY=s,t.direction=o}(i,t);var m=e.element;_(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function Z(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:d(e.pointers[i].clientX),clientY:d(e.pointers[i].clientY)},i++;return{timeStamp:p(),pointers:t,center:q(t),deltaX:e.deltaX,deltaY:e.deltaY}}function q(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var i=0,n=0,s=0;s<t;)i+=e[s].clientX,n+=e[s].clientY,s++;return{x:d(i/t),y:d(n/t)}}function z(e,t,i){return{x:t/e||0,y:i/e||0}}function U(e,t){return e===t?1:u(e)>=u(t)?e<0?2:4:t<0?8:16}function X(e,t,i){i||(i=M);var n=t[i[0]]-e[i[0]],s=t[i[1]]-e[i[1]];return Math.sqrt(n*n+s*s)}function G(e,t,i){i||(i=M);var n=t[i[0]]-e[i[0]],s=t[i[1]]-e[i[1]];return 180*Math.atan2(s,n)/Math.PI}W.prototype={handler:function(){},init:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(L(this.element),this.evWin,this.domHandler)}};var Y={mousedown:1,mousemove:2,mouseup:4},H="mousedown",K="mousemove mouseup";function J(){this.evEl=H,this.evWin=K,this.pressed=!1,W.apply(this,arguments)}y(J,W,{handler:function(e){var t=Y[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:j,srcEvent:e}))}});var ee={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},te={2:I,3:"pen",4:j,5:"kinect"},ie="pointerdown",ne="pointermove pointerup pointercancel";function se(){this.evEl=ie,this.evWin=ne,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}s.MSPointerEvent&&!s.PointerEvent&&(ie="MSPointerDown",ne="MSPointerMove MSPointerUp MSPointerCancel"),y(se,W,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),s=ee[n],o=te[e.pointerType]||e.pointerType,a=o==I,r=P(t,e.pointerId,"pointerId");1&s&&(0===e.button||a)?r<0&&(t.push(e),r=t.length-1):12&s&&(i=!0),r<0||(t[r]=e,this.callback(this.manager,s,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),i&&t.splice(r,1))}});var oe={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ae="touchstart",re="touchstart touchmove touchend touchcancel";function le(){this.evTarget=ae,this.evWin=re,this.started=!1,W.apply(this,arguments)}function ce(e,t){var i=A(e.touches),n=A(e.changedTouches);return 12&t&&(i=R(i.concat(n),"identifier",!0)),[i,n]}y(le,W,{handler:function(e){var t=oe[e.type];if(1===t&&(this.started=!0),this.started){var i=ce.call(this,e,t);12&t&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:I,srcEvent:e})}}});var he={touchstart:1,touchmove:2,touchend:4,touchcancel:8},de="touchstart touchmove touchend touchcancel";function ue(){this.evTarget=de,this.targetIds={},W.apply(this,arguments)}function pe(e,t){var i=A(e.touches),n=this.targetIds;if(3&t&&1===i.length)return n[i[0].identifier]=!0,[i,i];var s,o,a=A(e.changedTouches),r=[],l=this.target;if(o=i.filter((function(e){return _(e.target,l)})),1===t)for(s=0;s<o.length;)n[o[s].identifier]=!0,s++;for(s=0;s<a.length;)n[a[s].identifier]&&r.push(a[s]),12&t&&delete n[a[s].identifier],s++;return r.length?[R(o.concat(r),"identifier",!0),r]:void 0}function fe(){W.apply(this,arguments);var e=O(this.handler,this);this.touch=new ue(this.manager,e),this.mouse=new J(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function me(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ge.call(this,t)):12&e&&ge.call(this,t)}function ge(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout((function(){var e=n.indexOf(i);e>-1&&n.splice(e,1)}),2500)}}function be(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var s=this.lastTouches[n],o=Math.abs(t-s.x),a=Math.abs(i-s.y);if(o<=25&&a<=25)return!0}return!1}y(ue,W,{handler:function(e){var t=he[e.type],i=pe.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:I,srcEvent:e})}}),y(fe,W,{handler:function(e,t,i){var n=i.pointerType==I,s=i.pointerType==j;if(!(s&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)me.call(this,t,i);else if(s&&be.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ve=D(h.style,"touchAction"),we=ve!==r,ye="compute",Oe="auto",xe="manipulation",$e="none",Ce="pan-x",Se="pan-y",_e=function(){if(!we)return!1;var e={},t=s.CSS&&s.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){e[i]=!t||s.CSS.supports("touch-action",i)})),e}();function ke(e,t){this.manager=e,this.set(t)}ke.prototype={set:function(e){e==ye&&(e=this.compute()),we&&this.manager.element.style&&_e[e]&&(this.manager.element.style[ve]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){x(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(k(e,$e))return $e;var t=k(e,Ce),i=k(e,Se);return t&&i?$e:t||i?t?Ce:Se:k(e,xe)?xe:Oe}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var n=this.actions,s=k(n,$e)&&!_e.none,o=k(n,Se)&&!_e["pan-y"],a=k(n,Ce)&&!_e["pan-x"];if(s){var r=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(r&&l&&c)return}if(!a||!o)return s||o&&6&i||a&&24&i?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ee=32;function Pe(e){this.options=l({},this.defaults,e||{}),this.id=V++,this.manager=null,this.options.enable=$(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ae(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Re(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function De(e,t){var i=t.manager;return i?i.get(e):e}function Ve(){Pe.apply(this,arguments)}function Le(){Ve.apply(this,arguments),this.pX=null,this.pY=null}function Te(){Ve.apply(this,arguments)}function Be(){Pe.apply(this,arguments),this._timer=null,this._input=null}function Fe(){Ve.apply(this,arguments)}function Ie(){Ve.apply(this,arguments)}function je(){Pe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Me(e,t){return(t=t||{}).recognizers=$(t.recognizers,Me.defaults.preset),new Qe(e,t)}function Qe(e,t){this.options=l({},Me.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(B?se:F?ue:T?fe:J))(this,N),this.touchAction=new ke(this,this.options.touchAction),We(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function We(e,t){var i,n=e.element;n.style&&(g(e.options.cssProps,(function(s,o){i=D(n.style,o),t?(e.oldCssProps[i]=n.style[i],n.style[i]=s):n.style[i]=e.oldCssProps[i]||""})),t||(e.oldCssProps={}))}Pe.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=De(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=De(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===P(t,e=De(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=De(e,this);var t=P(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function n(i){t.manager.emit(i,e)}i<8&&n(t.options.event+Ae(i)),n(t.options.event),e.additionalEvent&&n(e.additionalEvent),i>=8&&n(t.options.event+Ae(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ee},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!x(this.options.enable,[this,t]))return this.reset(),void(this.state=Ee);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},y(Ve,Pe,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=6&t,s=this.attrTest(e);return n&&(8&i||!s)?16|t:n||s?4&i?8|t:2&t?4|t:2:Ee}}),y(Le,Ve,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Se),24&e&&t.push(Ce),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,s=e.direction,o=e.deltaX,a=e.deltaY;return s&t.direction||(6&t.direction?(s=0===o?1:o<0?2:4,i=o!=this.pX,n=Math.abs(e.deltaX)):(s=0===a?1:a<0?8:16,i=a!=this.pY,n=Math.abs(e.deltaY))),e.direction=s,i&&n>t.threshold&&s&t.direction},attrTest:function(e){return Ve.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Re(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),y(Te,Ve,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),y(Be,Pe,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Oe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,s=e.deltaTime>t.time;if(this._input=e,!n||!i||12&e.eventType&&!s)this.reset();else if(1&e.eventType)this.reset(),this._timer=f((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Ee},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),y(Fe,Ve,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),y(Ie,Ve,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Le.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return 30&i?t=e.overallVelocity:6&i?t=e.overallVelocityX:24&i&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&u(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Re(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),y(je,Pe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(n&&s&&i){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||X(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=f((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ee},failTimeout:function(){return this._timer=f((function(){this.state=Ee}),this.options.interval,this),Ee},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Me.VERSION="2.0.7",Me.defaults={domEvents:!1,touchAction:ye,enable:!0,inputTarget:null,inputClass:null,preset:[[Fe,{enable:!1}],[Te,{enable:!1},["rotate"]],[Ie,{direction:6}],[Le,{direction:6},["swipe"]],[je],[je,{event:"doubletap",taps:2},["tap"]],[Be]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Qe.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var i;this.touchAction.preventDefaults(e);var n=this.recognizers,s=t.curRecognizer;(!s||s&&8&s.state)&&(s=t.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],2===t.stopped||s&&i!=s&&!i.canRecognizeWith(s)?i.reset():i.recognize(e),!s&&14&i.state&&(s=t.curRecognizer=i),o++}},get:function(e){if(e instanceof Pe)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=P(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==r&&t!==r){var i=this.handlers;return g(E(e),(function(e){i[e]=i[e]||[],i[e].push(t)})),this}},off:function(e,t){if(e!==r){var i=this.handlers;return g(E(e),(function(e){t?i[e]&&i[e].splice(P(i[e],t),1):delete i[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=o.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&We(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Me,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ee,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Qe,Input:W,TouchAction:ke,TouchInput:ue,MouseInput:J,PointerEventInput:se,TouchMouseInput:fe,SingleTouchInput:le,Recognizer:Pe,AttrRecognizer:Ve,Tap:je,Pan:Le,Swipe:Ie,Pinch:Te,Rotate:Fe,Press:Be,on:C,off:S,each:g,merge:w,extend:v,assign:l,inherit:y,bindFn:O,prefixed:D}),(void 0!==s?s:"undefined"!=typeof self?self:{}).Hammer=Me,(n=function(){return Me}.call(t,i,t,e))===r||(e.exports=n)}(window,document)},1235:(e,t,i)=>{e.exports=i(8302),e.exports.Collection=i(5048)},5048:e=>{"use strict";e.exports.extend=function(e,t,i,n){var s=i.inverse;return Object.defineProperty(e,"remove",{value:function(e){var i=this.indexOf(e);return-1!==i&&(this.splice(i,1),t.unset(e,s,n)),e}}),Object.defineProperty(e,"contains",{value:function(e){return-1!==this.indexOf(e)}}),Object.defineProperty(e,"add",{value:function(e,i){var o=this.indexOf(e);if(void 0===i){if(-1!==o)return;i=this.length}-1!==o&&this.splice(o,1),this.splice(i,0,e),-1===o&&t.set(e,s,n)}}),Object.defineProperty(e,"__refs_collection",{value:!0}),e},e.exports.isExtended=function(e){return!0===e.__refs_collection}},8302:(e,t,i)=>{"use strict";var n=i(5048);function s(e,t,i){var s=n.extend(i[t.name]||[],e,t,i);Object.defineProperty(i,t.name,{enumerable:t.enumerable,value:s}),s.length&&s.forEach((function(n){e.set(n,t.inverse,i)}))}function o(e,t){if(!(this instanceof o))return new o(e,t);e.inverse=t,t.inverse=e,this.props={},this.props[e.name]=e,this.props[t.name]=t}o.prototype.bind=function(e,t){if("string"==typeof t){if(!this.props[t])throw new Error("no property <"+t+"> in ref");t=this.props[t]}t.collection?s(this,t,e):function(e,t,i){var n=t.inverse,s=i[t.name];Object.defineProperty(i,t.name,{configurable:t.configurable,enumerable:t.enumerable,get:function(){return s},set:function(t){if(t!==s){var o=s;s=null,o&&e.unset(o,n,i),s=t,e.set(s,n,i)}}})}(this,t,e)},o.prototype.ensureRefsCollection=function(e,t){var i=e[t.name];return n.isExtended(i)||s(this,t,e),i},o.prototype.ensureBound=function(e,t){(function(e,t){return Object.prototype.hasOwnProperty.call(e,t.name||t)})(e,t)||this.bind(e,t)},o.prototype.unset=function(e,t,i){e&&(this.ensureBound(e,t),t.collection?this.ensureRefsCollection(e,t).remove(i):e[t.name]=void 0)},o.prototype.set=function(e,t,i){e&&(this.ensureBound(e,t),t.collection?this.ensureRefsCollection(e,t).add(i):e[t.name]=i)},e.exports=o},2720:e=>{"use strict";var t=/,?([a-z]),?/gi,i=parseFloat,n=Math,s=n.PI,o=n.min,a=n.max,r=n.pow,l=n.abs,c=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,h=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi,d=Array.isArray||function(e){return e instanceof Array};function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function p(e){if("function"==typeof e||Object(e)!==e)return e;var t=new e.constructor;for(var i in e)u(e,i)&&(t[i]=p(e[i]));return t}function f(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return e.push(e.splice(i,1)[0])}function m(e){var t=m.ps=m.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout((function(){for(var i in t)u(t,i)&&i!=e&&(t[i].sleep--,!t[i].sleep&&delete t[i])})),t[e]}function g(e,t,i,n){return 1===arguments.length&&(t=e.y,i=e.width,n=e.height,e=e.x),{x:e,y:t,width:i,height:n,x2:e+i,y2:t+n}}function b(){return this.join(",").replace(t,"$1")}function v(e){var t=p(e);return t.toString=b,t}function w(e,t,i,n,s,o,a,l,c){var h=1-c,d=r(h,3),u=r(h,2),p=c*c*c,f=d*t+3*u*c*n+3*h*c*c*o+p*l;return{x:S(d*e+3*u*c*i+3*h*c*c*s+p*a),y:S(f)}}function y(e){var t=D.apply(null,e);return g(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0)}function O(e,t,i){return t>=e.x&&t<=e.x+e.width&&i>=e.y&&i<=e.y+e.height}function x(e,t,i,n,s){return e*(e*(-3*t+9*i-9*n+3*s)+6*t-12*i+6*n)-3*t+3*i}function $(e,t,i,s,o,a,r,l,c){null==c&&(c=1);for(var h=(c=c>1?1:c<0?0:c)/2,d=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],u=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0,f=0;f<12;f++){var m=h*d[f]+h,g=x(m,e,i,o,r),b=x(m,t,s,a,l),v=g*g+b*b;p+=u[f]*n.sqrt(v)}return h*p}function C(e,t,i,n,s,r,l,c){if(!(a(e,i)<o(s,l)||o(e,i)>a(s,l)||a(t,n)<o(r,c)||o(t,n)>a(r,c))){var h=(e*n-t*i)*(r-c)-(t-n)*(s*c-r*l),d=(e-i)*(r-c)-(t-n)*(s-l);if(d){var u=S(((e*n-t*i)*(s-l)-(e-i)*(s*c-r*l))/d),p=S(h/d),f=+u.toFixed(2),m=+p.toFixed(2);if(!(f<+o(e,i).toFixed(2)||f>+a(e,i).toFixed(2)||f<+o(s,l).toFixed(2)||f>+a(s,l).toFixed(2)||m<+o(t,n).toFixed(2)||m>+a(t,n).toFixed(2)||m<+o(r,c).toFixed(2)||m>+a(r,c).toFixed(2)))return{x:u,y:p}}}}function S(e){return Math.round(1e11*e)/1e11}function _(e,t,i){if(n=y(e),s=y(t),n=g(n),!(O(s=g(s),n.x,n.y)||O(s,n.x2,n.y)||O(s,n.x,n.y2)||O(s,n.x2,n.y2)||O(n,s.x,s.y)||O(n,s.x2,s.y)||O(n,s.x,s.y2)||O(n,s.x2,s.y2)||(n.x<s.x2&&n.x>s.x||s.x<n.x2&&s.x>n.x)&&(n.y<s.y2&&n.y>s.y||s.y<n.y2&&s.y>n.y)))return i?0:[];for(var n,s,o=$.apply(0,e),a=$.apply(0,t),r=E(e)?1:~~(o/5)||1,c=E(t)?1:~~(a/5)||1,h=[],d=[],u={},p=i?0:[],f=0;f<r+1;f++){var m=w.apply(0,e.concat(f/r));h.push({x:m.x,y:m.y,t:f/r})}for(f=0;f<c+1;f++)m=w.apply(0,t.concat(f/c)),d.push({x:m.x,y:m.y,t:f/c});for(f=0;f<r;f++)for(var b=0;b<c;b++){var v,x=h[f],S=h[f+1],_=d[b],k=d[b+1],P=l(S.x-x.x)<.01?"y":"x",A=l(k.x-_.x)<.01?"y":"x",R=C(x.x,x.y,S.x,S.y,_.x,_.y,k.x,k.y);if(R){if(u[v=R.x.toFixed(9)+"#"+R.y.toFixed(9)])continue;u[v]=!0;var D=x.t+l((R[P]-x[P])/(S[P]-x[P]))*(S.t-x.t),V=_.t+l((R[A]-_[A])/(k[A]-_[A]))*(k.t-_.t);D>=0&&D<=1&&V>=0&&V<=1&&(i?p++:p.push({x:R.x,y:R.y,t1:D,t2:V}))}}return p}function k(e){var t=m(e);if(t.abs)return v(t.abs);if(d(e)&&d(e&&e[0])||(e=function(e){if(!e)return null;var t=m(e);if(t.arr)return p(t.arr);var i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=[];return d(e)&&d(e[0])&&(n=p(e)),n.length||String(e).replace(c,(function(e,t,s){var o=[],a=t.toLowerCase();for(s.replace(h,(function(e,t){t&&o.push(+t)})),"m"==a&&o.length>2&&(n.push([t].concat(o.splice(0,2))),a="l",t="m"==t?"l":"L");o.length>=i[a]&&(n.push([t].concat(o.splice(0,i[a]))),i[a]););})),n.toString=m.toString,t.arr=p(n),n}(e)),!e||!e.length)return[["M",0,0]];var i,n=[],s=0,o=0,a=0,r=0,l=0;"M"==e[0][0]&&(a=s=+e[0][1],r=o=+e[0][2],l++,n[0]=["M",s,o]);for(var u,f,g=l,w=e.length;g<w;g++){if(n.push(u=[]),(i=(f=e[g])[0])!=i.toUpperCase())switch(u[0]=i.toUpperCase(),u[0]){case"A":u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=+f[6]+s,u[7]=+f[7]+o;break;case"V":u[1]=+f[1]+o;break;case"H":u[1]=+f[1]+s;break;case"M":a=+f[1]+s,r=+f[2]+o;default:for(var y=1,O=f.length;y<O;y++)u[y]=+f[y]+(y%2?s:o)}else for(var x=0,$=f.length;x<$;x++)u[x]=f[x];switch(i=i.toUpperCase(),u[0]){case"Z":s=+a,o=+r;break;case"H":s=u[1];break;case"V":o=u[1];break;case"M":a=u[u.length-2],r=u[u.length-1];default:s=u[u.length-2],o=u[u.length-1]}}return n.toString=b,t.abs=v(n),n}function E(e){return e[0]===e[2]&&e[1]===e[3]&&e[4]===e[6]&&e[5]===e[7]}function P(e,t,i,n){return[e,t,i,n,i,n]}function A(e,t,i,n,s,o){var a=1/3,r=2/3;return[a*e+r*i,a*t+r*n,a*s+r*i,a*o+r*n,s,o]}function R(e,t,i,o,a,r,c,h,d,p){var m,g,b=120*s/180,v=s/180*(+a||0),w=[],y=(g=function(e,t,i){return{x:e*n.cos(i)-t*n.sin(i),y:e*n.sin(i)+t*n.cos(i)}},function e(){var t=Array.prototype.slice.call(arguments,0),i=t.join("␀"),n=e.cache=e.cache||{},s=e.count=e.count||[];return u(n,i)?(f(s,i),n[i]):(s.length>=1e3&&delete n[s.shift()],s.push(i),n[i]=g.apply(0,t),n[i])});if(p)P=p[0],A=p[1],k=p[2],E=p[3];else{e=(m=y(e,t,-v)).x,t=m.y;var O=(e-(h=(m=y(h,d,-v)).x))/2,x=(t-(d=m.y))/2,$=O*O/(i*i)+x*x/(o*o);$>1&&(i*=$=n.sqrt($),o*=$);var C=i*i,S=o*o,_=(r==c?-1:1)*n.sqrt(l((C*S-C*x*x-S*O*O)/(C*x*x+S*O*O))),k=_*i*x/o+(e+h)/2,E=_*-o*O/i+(t+d)/2,P=n.asin(((t-E)/o).toFixed(9)),A=n.asin(((d-E)/o).toFixed(9));(P=e<k?s-P:P)<0&&(P=2*s+P),(A=h<k?s-A:A)<0&&(A=2*s+A),c&&P>A&&(P-=2*s),!c&&A>P&&(A-=2*s)}var D=A-P;if(l(D)>b){var V=A,L=h,T=d;A=P+b*(c&&A>P?1:-1),w=R(h=k+i*n.cos(A),d=E+o*n.sin(A),i,o,a,0,c,L,T,[A,V,k,E])}D=A-P;var B=n.cos(P),F=n.sin(P),I=n.cos(A),j=n.sin(A),M=n.tan(D/4),Q=4/3*i*M,W=4/3*o*M,N=[e,t],Z=[e+Q*F,t-W*B],q=[h+Q*j,d-W*I],z=[h,d];if(Z[0]=2*N[0]-Z[0],Z[1]=2*N[1]-Z[1],p)return[Z,q,z].concat(w);for(var U=[],X=0,G=(w=[Z,q,z].concat(w).join().split(",")).length;X<G;X++)U[X]=X%2?y(w[X-1],w[X],v).y:y(w[X],w[X+1],v).x;return U}function D(e,t,i,s,r,c,h,d){for(var u,p,f,m,g,b,v,w,y=[],O=[[],[]],x=0;x<2;++x)if(0==x?(p=6*e-12*i+6*r,u=-3*e+9*i-9*r+3*h,f=3*i-3*e):(p=6*t-12*s+6*c,u=-3*t+9*s-9*c+3*d,f=3*s-3*t),l(u)<1e-12){if(l(p)<1e-12)continue;0<(m=-f/p)&&m<1&&y.push(m)}else v=p*p-4*f*u,w=n.sqrt(v),v<0||(0<(g=(-p+w)/(2*u))&&g<1&&y.push(g),0<(b=(-p-w)/(2*u))&&b<1&&y.push(b));for(var $,C=y.length,S=C;C--;)$=1-(m=y[C]),O[0][C]=$*$*$*e+3*$*$*m*i+3*$*m*m*r+m*m*m*h,O[1][C]=$*$*$*t+3*$*$*m*s+3*$*m*m*c+m*m*m*d;return O[0][S]=e,O[1][S]=t,O[0][S+1]=h,O[1][S+1]=d,O[0].length=O[1].length=S+2,{x0:o.apply(0,O[0]),y0:o.apply(0,O[1]),x1:a.apply(0,O[0]),y1:a.apply(0,O[1])}}function V(e){var t=m(e);if(t.curve)return v(t.curve);for(var n=k(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=function(e,t,i){var n,s;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"].concat(R.apply(0,[t.x,t.y].concat(e.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*t.x-t.bx,s=2*t.y-t.by):(n=t.x,s=t.y),e=["C",n,s].concat(e.slice(1));break;case"T":"Q"==i||"T"==i?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"].concat(A(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat(A(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"].concat(P(t.x,t.y,e[1],e[2]));break;case"H":e=["C"].concat(P(t.x,t.y,e[1],t.y));break;case"V":e=["C"].concat(P(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"].concat(P(t.x,t.y,t.X,t.Y))}return e},a=function(e,t){if(e[t].length>7){e[t].shift();for(var i=e[t];i.length;)r[t]="A",e.splice(t++,0,["C"].concat(i.splice(0,6)));e.splice(t,1),d=n.length}},r=[],l="",c="",h=0,d=n.length;h<d;h++){n[h]&&(l=n[h][0]),"C"!=l&&(r[h]=l,h&&(c=r[h-1])),n[h]=o(n[h],s,c),"A"!=r[h]&&"C"==l&&(r[h]="C"),a(n,h);var u=n[h],p=u.length;s.x=u[p-2],s.y=u[p-1],s.bx=i(u[p-4])||s.x,s.by=i(u[p-3])||s.y}return t.curve=v(n),n}e.exports=function(e,t,i){e=V(e),t=V(t);for(var n,s,o,a,r,l,c,h,d,u,p=i?0:[],f=0,m=e.length;f<m;f++){var g=e[f];if("M"==g[0])n=r=g[1],s=l=g[2];else{"C"==g[0]?(d=[n,s].concat(g.slice(1)),n=d[6],s=d[7]):(d=[n,s,n,s,r,l,r,l],n=r,s=l);for(var b=0,v=t.length;b<v;b++){var w=t[b];if("M"==w[0])o=c=w[1],a=h=w[2];else{"C"==w[0]?(u=[o,a].concat(w.slice(1)),o=u[6],a=u[7]):(u=[o,a,o,a,c,h,c,h],o=c,a=h);var y=_(d,u,i);if(i)p+=y;else{for(var O=0,x=y.length;O<x;O++)y[O].segment1=f,y[O].segment2=b,y[O].bez1=d,y[O].bez2=u;p=p.concat(y)}}}}}return p}},3379:e=>{"use strict";var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var o={},a=[],r=0;r<e.length;r++){var l=e[r],c=n.base?l[0]+n.base:l[0],h=o[c]||0,d="".concat(c," ").concat(h);o[c]=h+1;var u=i(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(p);else{var f=s(p,n);n.byIndex=r,t.splice(r,0,{identifier:d,updater:f,references:1})}a.push(d)}return a}function s(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,s){var o=n(e=e||[],s=s||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var r=i(o[a]);t[r].references--}for(var l=n(e,s),c=0;c<o.length;c++){var h=i(o[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}o=l}}},569:e=>{"use strict";var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var s=void 0!==i.layer;s&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,s&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},5256:e=>{e.exports=[]},3880:e=>{e.exports={}},8023:(e,t,i)=>{var n={};n.en=i(3880),e.exports=n},2761:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"csvExporter"}constructor(e,t="interface_editor_csvExporter"){super(e,t),this.view=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){this.AB=e,this.component.init(this.AB)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return s}},6720:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"csvImporter"}constructor(e,t="interface_editor_csvImporter"){super(e,t),this.view=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){this.AB=e,this.component.init(this.AB)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return s}},8442:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"carousel"}constructor(t,i="interface_editor_viewcarousel"){super(i,{label:""}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){return this.AB=e,this.component.init(e,2)}detatch(){this.component.detatch()}onShow(){this.component.onShow()}}}return s}},1298:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let s=null;function o(e){if(!s){const t="interface_editor_viewchart",i=(0,n.default)(e);s=class extends i{static get key(){return"chart"}constructor(e,i=t){super(e,i)}ui(){const e=super.ui();return e.rows[0].cellHeight=400,e}async init(e){this.AB=e,await super.init(e)}detatch(){}onShow(){super.onShow()}}}return s}},6062:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewchart_area",i=(0,n.Z)(e);s=class extends i{static get key(){return"area"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},3725:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewchart_bar",i=(0,n.Z)(e);s=class extends i{static get key(){return"bar"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},3121:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewchart_line",i=(0,n.Z)(e);s=class extends i{static get key(){return"line"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},5250:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewchart_pie",i=(0,n.Z)(e);s=class extends i{static get key(){return"pie"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},8971:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewcomment",i=(0,n.Z)(e);s=class extends i{static get key(){return"comment"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},760:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let s=null;function o(e){if(s)return s;const t=(0,n.default)(e);return s=class extends t{static get key(){return"conditionalcontainer"}constructor(e,t="interface_editor_viewconditionalContainer"){super(e,t)}},s}},4713:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=null;function o(e){if(!s){const i=(0,n.Z)(e);var t=i.L();s=class n extends i{static get key(){return"viewcontainer"}constructor(t,i="interface_editor_viewcontainer",n={}){var s={label:""};Object.keys(n).forEach((e=>{void 0===s[e]?s[e]="":console.error(`!!! ABFieldProperty:: passed in ids contains a restricted field : ${e}`)})),super(i,s),this.view=t,this.settings=t.settings,this.viewLoad(t),this.base=i,this.AB=e,this.subComponents={},this.cellHeight=250}ui(){let t=n.key,i=e.Class.ABViewManager.viewClass(t).defaultValues();return{rows:[{id:this.ids.component,view:"dashboard",css:`ab-${t}-container`,cellHeight:this.cellHeight,gridColumns:this.settings.columns||i.columns}]}}init(e){var t=$$(this.ids.component);t&&(webix.extend(t,webix.OverlayBox),webix.extend(t,webix.ProgressBar)),this.CurrentView.viewsSortByPosition().forEach((i=>{let n;i.warningsSilent=!0;try{n=i.component()}catch(e){n=i.component(this.AB._App);let t=n.ui;n.ui=(()=>t).bind(n)}this.subComponents[i.id]=n;let s="panel";0==i.settings.movable&&(s="scrollview"),t.addView({view:s,name:i.id,icon:"fa fa-arrows",css:"ab-widget-container",body:{rows:[{view:"template",height:30,css:"ab-widget-header",template:this.template(i),onClick:{"ab-component-edit":(e,t,n)=>{this.viewEdit(e,i.id,n)},"ab-component-remove":(e,t,n)=>{this.viewDelete(e,i.id,n)}}},n.ui()]},dx:i.position.dx||1,dy:i.position.dy||1,x:this.validatePosition(i.position.x,0,t.config.gridColumns-1),y:i.position.y||0}),n.init(e,2)})),this._onChangeId&&t.detachEvent(this._onChangeId),this._onChangeId=t.attachEvent("onChange",(()=>{this.onReorder()})),this.showEmptyPlaceholder(),t.adjust()}detatch(){Object.keys(this.subComponents).forEach((e=>{this.subComponents[e]?.detatch?.()}));var e=$$(this.ids.component);e&&this._onChangeId&&e.detachEvent(this._onChangeId)}busy(){let e=$$(this.ids.component);e?.disable(),e?.showProgress({type:"icon"})}async onReorder(){this.busy();var e=$$(this.ids.component).serialize(),t=[];this.CurrentView.views().forEach((i=>{var n=e.filter((e=>e.name==i.id))[0];n&&(i.position.x=n.x,i.position.y=n.y,i.position.x<0&&(i.position.x=0),i.position.y<0&&(i.position.y=0),t.push(i.save()))}));try{await Promise.all(t),await this.CurrentView.save(),this.ready()}catch(e){this.AB.notify.developer(e,{message:"Error trying to save selected View:",view:this.CurrentView.toObj()}),this.ready()}}onShow(){let e=!1;this.CurrentView.views().forEach((t=>{"text"===t.key&&(e=!0),this.subComponents[t.id]?.onShow?.()})),e&&this.initTinyMCE();let t=this.CurrentView.datacollection;t&&t.dataStatus==t.dataStatusFlag.notInitial&&t.loadData()}ready(){let e=$$(this.ids.component);e?.enable(),e?.hideProgress()}showEmptyPlaceholder(){var e=$$(this.ids.component);0==e.getChildViews().length&&e.showOverlay("<div class='drop-zone'><div>"+t("Add Widgets Here")+"</div></div>")}template(e){let t="";return(e.warningsAll()||[]).length>0&&(t=this.WARNING_ICON),`<div>\n               <i class="fa fa-${e.icon} webix_icon_btn"></i> ${e.label}\n               <div class="ab-component-tools">\n               ${t}${0==e.settings.removable?"":'<i class="fa fa-trash ab-component-remove"></i>'}\n               <i class="fa fa-edit ab-component-edit"></i>\n               </div></div>`}validatePosition(e,t,i){return e<t?t:e>i?i:e}viewDelete(e,i){var n=this.CurrentView.views((e=>e.id==i))[0];if(!n)return!1;webix.confirm({title:t("Delete component"),text:t("Do you want to delete <b>{0}</b>?",[n.label]),callback:async e=>{if(e){this.busy();try{await n.destroy(),n.emit("destroyed",n),this.emit("view.destroyed",n);let e=$$(this.ids.component);var t=e.queryView({name:i});t&&(e.blockEvent(),e.removeView(t),e.unblockEvent()),this.showEmptyPlaceholder()}catch(e){this.AB.notify.developer(e,{message:"Error trying to delete selected View:",view:n})}this.ready()}}}),e.preventDefault()}viewEdit(e,t){var i=this.CurrentView.views((e=>e.id==t))[0];return!!i&&(setTimeout((()=>{try{this.emit("view.edit",i)}catch(e){console.error(e)}}),15),e.preventDefault(),!1)}async initTinyMCE(){await this.AB.custom["tinymce-editor"].init()}}}return s}},1926:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewdataselect",i=(0,n.Z)(e);s=class extends i{static get key(){return"data-select"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},5903:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let s=null;function o(e){if(!s){const t=(0,n.default)(e);s=class extends t{static get key(){return"dataview"}constructor(e,t="interface_editor_viewdataview"){super(e,t)}ui(){let e=super.ui();return e.rows[0].cellHeight=75,e}init(e){return this.AB=e,super.init(e)}detatch(){this.component?.detatch?.()}onShow(){super.onShow(),this.component?.onShow?.()}}}return s}},2442:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713);let s=null;function o(e){if(!s){const t=(0,n.default)(e);s=class extends t{static get key(){return"detail"}constructor(e,t="interface_editor_viewdetail"){super(e,t)}ui(){let e=super.ui();return e.rows[0].cellHeight=75,e}init(e){return this.AB=e,super.init(e)}detatch(){this.component?.detatch?.()}onShow(){super.onShow(),this.component?.onShow?.()}}}return s}},559:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(s)return s;const t=(0,n.Z)(e);return s=class extends t{static get key(){return"docxBuilder"}constructor(t,i="interface_editor_viewdocxBuilder"){super(i,{}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){return this.AB=e,this.component.init(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}},s}},2363:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713),s=null;function o(e){if(!s){const t=(0,n.default)(e);s=class extends t{static get key(){return"form"}constructor(e,t="interface_editor_viewform"){super(e,t)}ui(){let e=super.ui();return e.rows[0].cellHeight=75,e}init(e){return this.AB=e,super.init(e)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return s}},803:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewgantt",i=(0,n.Z)(e);s=class extends i{static get key(){return"gantt"}constructor(i,n=t){super(n,{label:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){return this.component.ui()}async init(e){this.AB=e,this.component.ignoreLocal=!0,await this.component.init(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}}}return s}},5084:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"grid"}constructor(t,i="interface_editor_viewgrid"){super(i,{label:""}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){return this.AB=e,this.component.ignoreLocal=!0,this.component.init(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}}}return s}},9074:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewkanban",i=(0,n.Z)(e);s=class extends i{static get key(){return"kanban"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.component.ui();return e.minWidth=400,{view:"layout",cols:[e,{fillspace:!0}]}}init(e){this.AB=e,this.component?.init?.(e)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return s}},7895:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewlabel",i=(0,n.Z)(e);s=class extends i{static get key(){return"label"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.ids,t=this.view,i=this.component,n={type:"form",margin:10,padding:10,borderless:!0,rows:[{id:e.component,view:"label",label:t.text||"",align:t.settings.alignment},{}]};return i.uiFormatting(n)}async init(e){this.AB=e,webix.codebase="/js/webix/extras/",await this.component.init(this.AB)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},4826:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e),i=(...t)=>e.Multilingual.label(...t);s=class extends t{static get key(){return"layout"}constructor(e,t="interface_editor_view_layout"){super(t)}get viewComponent(){const e=this.CurrentView;return e&&!this._component&&(this._component=e.component()),this._component}ui(){const e=this.CurrentView.views(),t=this.viewComponent.ui().rows.find((e=>"layout"===e.view));return t.type="form",e.length?e.forEach(((e,i)=>{const n=e.component().ui();t.cols[i]={rows:[{type:"template",css:"ab-layout-header",height:30,template:this.templateButton({icon:e.icon,label:e.label,warnings:e._warnings}),onClick:{"ab-component-edit":(t,i,n)=>{this.viewEdit(t,e.id,n)},"ab-component-remove":(t,i,n)=>{this.viewDelete(t,e.id,n)}}},n,{}]}})):t.cols[0]={},t}init(e,t){this.AB=e,this.viewComponent.init(e,t),this.viewComponent.onShow?.(),this.CurrentView.views().forEach((i=>{const n=i.component();n.init(e,t),n.onShow?.()}))}onShow(){this.CurrentView.views().some((e=>"text"===e.key))&&this.AB.custom["tinymce-editor"].init()}detatch(){this.viewComponent?.detatch?.()}templateButton(e){let t="";return(e.warnings||[]).length>0&&(t=this.WARNING_ICON),`<div class="ab-widget-header ab-layout-header">\n               <i class="fa fa-${e.icon} webix_icon_btn"></i> ${e.label}\n               <div class="ab-component-tools">\n               ${t}\n               <i class="fa fa-trash ab-component-remove"></i>\n               <i class="fa fa-edit ab-component-edit"></i>\n               </div></div>`}viewEdit(e,t){const i=this.CurrentView.views((e=>e.id==t))[0];return!!i&&(setTimeout((()=>{try{this.emit("view.edit",i)}catch(e){console.error(e)}}),50),e.preventDefault(),!1)}viewDelete(e,t){const n=this.CurrentView.views((e=>e.id==t))[0];if(!n)return!1;this.AB.Webix.confirm({title:i("Delete component"),text:i("Do you want to delete <b>{0}</b>?",[n.label]),callback:e=>{e&&n.destroy().then((()=>{n.emit("destroyed",n),this.emit("view.destroyed",n)}))}}),e.preventDefault()}}}return s}},6629:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"menu"}constructor(e,t="interface_editor_viewmenu"){super(t),this.view=e,this.component=this.view.component()}ui(){return{type:"space",rows:[this.component.ui(),{}]}}init(e){this.AB=e,this.onShow()}detatch(){this.component?.detatch?.()}onShow(){const e=this.component.ids,t=this.view,i=$$(e.menu);t.ClearPagesInView(i),t?.settings?.order?.length&&t.AddPagesToView(i,t.settings.order),this.component?.onShow?.()}}}return s}},5694:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"pdfImporter"}constructor(e,t="interface_editor_pdfImporter"){super(e,t),this.view=e,this.component=this.view.component()}ui(){return this.component.ui()}init(e){this.AB=e,this.component.init(this.AB)}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}}}return s}},302:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(4713),s=null;function o(e){if(!s){const t=(0,n.default)(e);s=class extends t{static get key(){return"page"}}}return s}},5025:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"pivot"}constructor(e,t="interface_editor_viewpivot"){super(t),this.view=e,this.component=this.view.component()}ui(){const e=this.component.ui().rows[0];return e.readonly=!1,e}init(e){this.AB=e,this.component?.init?.();const t=this.ui().id;$$(t).getState().$observe("structure",(e=>{this._saveStructure(e)}))}detatch(){this.component?.detatch?.()}onShow(){this.component?.onShow?.()}_saveStructure(e){this.view.settings.structure=e,this.view.save()}}}return s}},2279:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3285),s=i(5888);let o=null;function a(e){if(!o){const t="interface_editor_viewtab",i=(0,n.Z)(e),a=i.L(),r=(0,s.Z)(e);o=class extends i{static get key(){return"tab"}constructor(i,n=t){super(n,{view:""}),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.ids,t=this.view,i=this.component,n=this.component.ui()?.rows[0];if(n.rows){n.rows[0].id=e.component,n.rows[0].tabbar={height:60,type:"bottom",css:t.settings.darkTheme?"webix_dark":"",on:{onItemClick:(i,n)=>{const s=$$(e.component).getValue(),o=t.views((e=>e.id===s))[0],a=t._views.findIndex((e=>e.id===s));n.target.classList.contains("rename")?t.tabPopup.show(o):n.target.classList.contains("move-back")?(t.viewReorder(s,a-1),t.emit("properties.updated",t)):n.target.classList.contains("move-next")&&(t.viewReorder(s,a+1),t.emit("properties.updated",t))}}};for(let e=0;e<(n.rows[0]?.cells??[]).length;e++){let i=n.rows[0].cells[e];i.header=`<i class="fa fa-caret-left move-back ab-tab-back"></i>${n.rows[0]?.cells[e].header}`;let s=t.views((e=>e.id==i.body.id))[0];(!s||(s.warningsAll()||[]).length>0)&&(i.header+=this.WARNING_ICON),i.header+=' <i class="fa fa-pencil-square rename ab-tab-edit"></i>',i.header+=' <i class="fa fa-caret-right move-next ab-tab-next"></i>'}}else if(n.cols){let s=1,o=0;"right"===t.settings.sidebarPos&&(s=0,o=1),n.cols[s].id=e.component,n.cols[o].on={onItemClick:(e,n)=>{const s=e.replace("_menu",""),o=t.views((e=>e.id==s))[0],a=t._views.findIndex((e=>e.id===s));i.onShow(s),n.target.classList.contains("rename")?t.tabPopup.show(o):n.target.classList.contains("move-back")?(t.viewReorder(s,a-1),t.emit("properties.updated",t)):n.target.classList.contains("move-next")&&(t.viewReorder(s,a+1),t.emit("properties.updated",t))}};for(let e=0;e<(n.cols[o].data??[]).length;e++)n.cols[o].data[e].value=n.cols[o].data[e].value+' <i class="fa fa-pencil rename ab-tab-edit"></i>',n.cols[o].data[e].value+='<i class="fa fa-caret-up move-back ab-tab-up"></i>',n.cols[o].data[e].value+=' <i class="fa fa-caret-down move-next ab-tab-down"></i>'}return{rows:[n]}}async init(e){this.AB=e;const t=this.ids;await this.component.init(this.AB);const i=$$(t.component);if(i){const e=i.getValue(),t=this.view.views((t=>t.id===e))[0];let n="";(!t||(t.warningsAll()||[]).length>0)&&(n=this.WARNING_ICON),"tabview"===i.config.view?webix.ui({container:i.getMultiview().$view,view:"template",autoheight:!1,height:1,width:0,template:['<div class="ab-component-tools ab-layout-view ab-tab-tools">','<i class="fa fa-trash ab-component-remove"></i>','<i class="fa fa-edit ab-component-edit"></i>',n,"</div>"].join(""),onClick:{"ab-component-edit":(e,t,i)=>{this.tabEdit(e,t,i)},"ab-component-remove":(e,t,i)=>{this.tabRemove(e,t,i)}}}):"multiview"===i.config.view&&webix.ui({container:i.$view,view:"template",autoheight:!1,height:1,width:0,template:['<div class="ab-component-tools ab-layout-view ab-tab-tools">',n,'<i class="fa fa-trash ab-component-remove"></i>','<i class="fa fa-edit ab-component-edit"></i>',"</div>"].join(""),onClick:{"ab-component-edit":e=>{this.tabEdit(e)},"ab-component-remove":e=>{this.tabRemove(e)}}})}const n=this.view;n.tabPopup||(n.tabPopup=new r(n),n.tabPopup.init(e))}tabEdit(e){const t=$$(this.ids.component).getValue(),i=this.view.views((e=>e.id==t))[0];return!!i&&(setTimeout((()=>{try{this.emit("view.edit",i)}catch(e){console.error(e)}}),50),e.preventDefault(),!1)}tabRemove(e){const t=this.ids,i=$$(t.component),n=i.getValue(),s=this.view.views((e=>e.id==n))[0];return s&&webix.confirm({title:a("Delete tab"),text:a("Do you want to delete <b>{0}</b>?",[s.label]),callback:e=>{if(e){s.destroy();const e=this.component.ui();if(e.rows)i.removeView(n);else{let t=null;for(let i=0;i<e.cols.length;i++)if("sidebar"===e.cols[i].view){t=$$(e.cols[i].id);break}t.remove(`${n}_menu`)}}}}),e.preventDefault(),!1}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return o}},7912:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t="interface_editor_viewtext",i=(0,n.Z)(e);s=class extends i{static get key(){return"text"}constructor(i,n=t){super(n),this.AB=e,this.view=i,this.component=this.view.component()}ui(){const e=this.ids,t=this.view;return{id:e.component,view:"tinymce-editor",value:t.text,config:{plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",init_instance_callback:e=>{e.on("Change",(()=>{this.onChange()}))}}}}async init(e){this.AB=e,webix.codebase="/js/webix/extras/",await this.component.init(this.AB)}async viewLoad(e){await this.AB.custom["tinymce-editor"].init(),super.viewLoad(e)}onChange(){const e=this.ids,t=this.view;t._onChangeFunction&&(clearTimeout(t._onChangeFunction),t._onChangeFunction=null);const i=$$(e.component);t._onChangeFunction=setTimeout((()=>{t.text=i.getValue(),t.save()}),400)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow()}}}return s}},3759:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{static get key(){return"_default"}constructor(t,i="interface_editor_viewdefault"){super(i,{label:""}),this.view=t,this.settings=t.settings,this.base=i,this.AB=e,this.component=this.view.component(this.AB._App)}ui(){return"function"==typeof this.component.ui?this.component.ui():this.component.ui}init(e){return this.AB=e,this.component.init?.(e,2)}detatch(){this.component.detatch?.()}onShow(){this.component.onShow?.()}}}return s}},5888:(e,t,i)=>{"use strict";function n(e){const t=(...t)=>e.Multilingual.label(...t);class i extends e.ClassUI{constructor(e){super(`${e.id}_popup`,{popupTabManager:"",popupTabManagerForm:"",popupTabManagerSaveButton:""}),this.view=e}async init(e){this.view.AB=e,this.create()}ui(){const e=this.ids;return{id:e.popupTabManager,view:"window",height:250,width:300,modal:!0,position:"center",head:" ",body:{id:e.popupTabManagerForm,view:"form",elements:[{view:"text",name:"label",label:t("Label"),required:!0},{view:"combo",name:"tabicon",label:t("Icon"),options:{filter:(e,t)=>0===e.value.toString().toLowerCase().indexOf(t.toLowerCase()),body:{data:this.view.AB._App.icons??[],template:"<i class='fa fa-fw fa-#value#'></i> #value#"}}},{cols:[{fillspace:!0},{view:"button",value:t("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.hide()}},{id:e.popupTabManagerSaveButton,view:"button",css:"webix_primary",value:t("Add Tab"),autowidth:!0,type:"form",click:()=>{const t=$$(e.popupTabManagerForm);if(t.validate()){this.busy();const e=t.getValues(),i=()=>{this.ready(),this.hide(),this.emit("saved")};e.id?this.editTab(e).then((()=>i())):this.addTab(e).then((()=>i()))}}}]}]}}}create(){this.view.AB.Webix.ui(this.ui()).hide()}show(e){const i=this.ids,n=$$(i.popupTabManager),s=$$(i.popupTabManagerForm),o=$$(i.popupTabManagerSaveButton);n&&(e?(s.setValues({id:e.id,label:e.label,tabicon:e.tabicon}),n.getHead().setHTML(t("Edit Tab")),o.setValue(t("Save"))):(s.setValues({id:null,label:"",tabicon:""}),n.getHead().setHTML(t("Add Tab")),o.setValue(t("Add"))),o.refresh(),n.show())}hide(){const e=this.ids,t=$$(e.popupTabManager);t&&t.hide()}busy(){const e=this.ids,t=$$(e.popupTabManagerSaveButton);t&&t.disable()}ready(){const e=this.ids,t=$$(e.popupTabManagerSaveButton);t&&t.enable()}addTab(e){return this.view.addTab(e.label??"",e.tabicon??null)}editTab(e){const t=this.view.views((t=>t.id===e.id))[0];if(t)return t.label=e.label,t.tabicon=e.tabicon,t.save()}}return i}i.d(t,{Z:()=>n})},7056:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(2418),s=null;function o(e){if(!s){var t=[];[i(6063),i(1573),i(9263),i(1134),i(2818),i(2970),i(2250),i(6393),i(727),i(6139),i(7380),i(7341),i(4074),i(3820),i(6771),i(401),i(8546),i(1702),i(8114)].forEach((i=>{t.push(i.default(e))}));var o=[];[i(2607),i(5732),i(7670),i(3412),i(6692),i(9941),i(2914),i(2967),i(9113),i(6699),i(1051),i(8010),i(2367),i(6277),i(4490),i(7825),i(8866),i(5778),i(7358),i(9722)].forEach((t=>{o.push(t.default(e))}));var a=[];[i(814),i(7887),i(7661),i(2225),i(992),i(3875),i(4158),i(4856),i(3156),i(1712),i(231),i(5786),i(2100),i(3300),i(1377),i(9270),i(3381),i(8568),i(7420),i(1023),i(7901),i(6309),i(3257),i(3020),i(2480),i(2318),i(1722),i(6929),i(5670),i(6378),i(7754),i(9720),i(2651),i(9975),i(5177),i(4973),i(5281),i(5711),i(4247),i(1163),i(8450),i(6598),i(9630),i(3348),i(1832),i(7375),i(4333),i(6234),i(7669)].forEach((t=>{a.push(t.default(e))})),e.plugins().forEach((t=>{t.viewProperty&&a.push(t.viewProperty(e,n.Z))}));var r=[];[i(3312),i(5662),i(4149),i(2155),i(8804),i(3819),i(698),i(7595),i(7119),i(8904),i(2425),i(2724),i(82),i(1511),i(7041),i(5496),i(2857),i(6088),i(4710),i(9190)].forEach((t=>{r.push(t.default(e))})),s={fields:function(e=(()=>!0)){return t.filter(e)},processElements:function(e=(()=>!0)){return o.filter(e)},views:function(e=(()=>!0)){return a.filter(e)},mobileViews:function(e=(()=>!0)){return r.filter(e)}}}return s}},917:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285);let s=null;function o(e){if(!s){const t=e.Config.uiSettings(),i=(0,n.Z)(e),o=i.L();s=class extends i{constructor(t="properties_abfield",i={}){const n={label:"",columnName:"",fieldDescription:"",showIcon:"",required:"",numberOfNull:"",unique:"",filterComplex:"",addValidation:"",shorthand:"",validationRules:"",buttonCog:"",editFieldName:"",editFieldNameForm:"",editFieldNameFormDatabaseColumn:"",filterView:"",uniqueView:""};Object.keys(i).forEach((e=>{void 0===n[e]?n[e]="":console.error(`!!! ABFieldProperty:: passed in ids contains a restricted field : ${e}`)})),super(t,n),this.base=t,this.AB=e}ui(e=[]){const t=this.ids,n=this.FieldClass(),s={view:"form",id:t.component,borderless:!0,autowidth:!0,elements:[{cols:[{view:"label",label:o("Field Name:"),align:"left",width:87},{name:"label",id:t.label,view:"text",placeholder:o("Database field name"),fillspace:!0,on:{onChange:e=>{this.textFieldName(e)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"text",id:t.columnName,name:"columnName",hidden:!0,on:{onAfterRender(){i.CYPRESS_REF(this)}}},{view:"button",id:t.buttonCog,css:"webix_transparent",label:'<span class="webix_icon_btn" style="margin: 0px;"><i class="nomargin fa fa-cog"></i></span>',width:40,on:{onItemClick:()=>{this.buttonCog()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:o("Show icon:"),align:"left",width:75},{view:"switch",id:t.showIcon,name:"showIcon",value:1,width:55,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:20},{view:"label",label:o("Required:"),align:"left",width:66},{view:"switch",id:t.required,name:"required",disabled:!n.defaults().supportRequire,value:0,width:55,on:{onChange:(e,i)=>{this.requiredOnChange(e,i,t),this.getNumberOfNullValue(e)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:20},{view:"label",id:t.numberOfNull,css:{color:"#f00"},label:"",hidden:!0,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"label",label:o("Unique:"),align:"left",width:59},{view:"switch",id:t.unique,name:"unique",disabled:!n.defaults().supportUnique,disallowEdit:!0,value:0,width:55,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:20},{id:t.addValidation,view:"button",label:o("Add Field Validation"),css:"webix_primary",popup:t.filterView,on:{onItemClick:()=>{$$(t.filterView).adjust(),this.populateValidationRules(!0)},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{id:t.validationRules,view:"text",hidden:!0,name:"validationRules",on:{onAfterRender(){i.CYPRESS_REF(this)}}},{cols:[{view:"label",label:o("Custom Settings:"),align:"left",width:200},{},{view:"label",id:t.fieldDescription,label:o("Description"),align:"right",on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{id:t.uniqueView,view:"scrollview",borderless:!0,scroll:"y",css:{background:"#ddd"},body:{padding:{top:25,bottom:25,left:25,right:25},rows:e.map((e=>(!e.id&&e.name&&(this.ids[e.name]||(this.ids[e.name]=`${this.base}_${e.name}`),e.id=this.ids[e.name]),e)))}}],rules:{label:webix.rules.isNotEmpty,columnName:webix.rules.isNotEmpty}};return webix.ui({view:"window",id:t.editFieldName,modal:!0,hidden:!0,position:"center",width:450,height:250,head:{view:"toolbar",css:"webix_dark",paddingX:2,elements:[{view:"label",align:"center",label:o("Edit field name")}]},body:{view:"form",id:t.editFieldNameForm,elements:[{cols:[{view:"label",label:o("Database Column:"),align:"right",width:125},{view:"text",id:t.editFieldNameFormDatabaseColumn,name:"columnName",placeholder:o("Database Column"),on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:30}]},{cols:[{},{view:"button",value:o("Cancel"),css:"webix_danger",width:100,on:{onItemClick:()=>{this.buttonEditFieldNameButtonCancel()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"button",value:o("Submit"),css:"webix_primary",width:100,on:{onItemClick:()=>{this.buttonEditFieldNameButtonSubmit()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{width:30}]}]}}),webix.ui({id:t.filterView,view:"popup",resize:!0,height:503,width:692,position:"center",body:{rows:[{view:"toolbar",css:"webix_dark",paddingX:0,elements:[{view:"label",align:"center",label:o("Field Validation")},{view:"button",label:'<span class="webix_icon"><i class="nomargin fa fa-times"></i></span>',css:"webix_transparent",width:40,click:()=>{$$(t.filterView).hide()},on:{onAfterRender:()=>{i.CYPRESS_REF(this)}}}]},{cols:[{view:"button",label:o("Add"),css:"webix_secondary",on:{onItemClick:()=>{this.addValidation()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"button",label:o("Delete All"),css:"webix_danger",on:{onItemClick:()=>{this.filterViewDeleteAllValidation()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"scrollview",scroll:"y",body:{id:t.filterComplex,rows:[]}}]},on:{onViewResize:()=>{$$(t.filterView).show()}}}),s}async init(e){this.AB=e;const t=this.FieldClass();t?$$(this.ids.fieldDescription).define("label","*"+o(t.defaults().description)):$$(this.ids.fieldDescription).hide()}textFieldName(e){const t=this.formValues();this.modeEdit?t.label=e:(t.label=e,t.columnName=t.label),$$(this.ids.component).setValues(t)}buttonCog(){if(this.isValid()){const e=this.formValues();$$(this.ids.editFieldNameForm).setValues({columnName:e.columnName}),this.modeEdit?$$(this.ids.editFieldNameFormDatabaseColumn).disable():$$(this.ids.editFieldNameFormDatabaseColumn).enable(),$$(this.ids.editFieldName).show()}}buttonEditFieldNameButtonCancel(){const e=$$(this.ids.component).getValues();$$(this.ids.editFieldNameForm).setValues({columnName:e.columnName}),$$(this.ids.editFieldName).hide()}buttonEditFieldNameButtonSubmit(){const e=this.formValues(),t=$$(this.ids.editFieldNameForm).getValues().columnName;e.columnName=""!==t?t:e.columnName,$$(this.ids.component).setValues(e),$$(this.ids.editFieldName).hide()}addValidation(e){const n=this.ids,s=new this.AB.Class.FilterComplex(`${this.AB.uuid()}_field_validation_rules`,this.AB);s.ui.height=220;const a=$$(n.filterComplex).addView({view:"form",css:"abValidationForm",cols:[{rows:[{cols:[{view:"text",name:"invalidMessage",labelWidth:t.labelWidthLarge,value:e?.invalidMessage?e.invalidMessage:"",label:o("Invalid Message")},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const e=this.getParentView().getParentView().getParentView();$$(n.filterComplex).removeView(e);const t=$$(n.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");$$(n.addValidation).define("badge",0!==t.length?t.length:null),$$(n.addValidation).refresh()},on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},s.ui]}]});$$(a)._Filter=s,this.resetDefaultValidation(),$$(s.ids.save).hide(),s.fieldsLoad(this.CurrentObject.fields()),e&&e.rules&&s.setValue(e.rules)}filterViewDeleteAllValidation(){const e=this.ids,t=$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");t.length&&t.forEach((t=>{$$(e.filterComplex).removeView(t)})),this.resetDefaultValidation()}clearEditor(){console.error("!!! Depreciated! call clear() instead."),this.clear()}clear(){const e=this.ids;this._CurrentField=null;const t=this.defaultValues();for(const i in t){const n=$$(e[i]);n&&n.setValue(t[i])}this.filterViewDeleteAllValidation(),$$(e.numberOfNull).hide()}clearInvalid(e){$$(this.ids.component).markInvalid(e,!1)}resetDefaultValidation(){const e=this.ids,t=$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all");$$(e.addValidation).define("badge",0!==t.length?t.length:null),$$(e.addValidation).refresh()}defaults(){const e=this.FieldClass();return e?e.defaults():(console.error("!!! ABFieldStringProperty: could not find FieldClass[]"),null)}defaultValues(){const e={label:"",columnName:"",showIcon:1,required:0,unique:0,validationRules:""},t=this.FieldClass();if(t){const i=t.defaultValues();Object.keys(i).forEach((t=>{void 0===e[t]&&(e[t]=i[t])}))}return e}eachDeep(e,t){e.forEach((e=>{e.cols?this.eachDeep(e.cols,t):e.body?.cols?this.eachDeep(e.body.cols,t):e.rows?this.eachDeep(e.rows,t):e.body?.rows?this.eachDeep(e.body.rows,t):t(e)}))}editorPopulate(e){console.error("!!! Depreciated. call populate() instead."),this.populate(e)}FieldClass(){return console.error("!!! Child Class has not overwritten FieldClass()"),null}_FieldClass(e){return this.AB.Class.ABFieldManager.fieldByKey(e)}formValues(){return $$(this.ids.component).getValues()}async getNumberOfNullValue(e){const t=this.ids;if(e&&this._CurrentField&&this._CurrentField.id&&this._CurrentField.settings.required!=e)try{const e=await this._CurrentField.object.model().count({where:{glue:"and",rules:[{key:this._CurrentField.id,rule:"is_null"}]}});e.count>0?($$(t.numberOfNull).setValue(o("** There are {0} rows that will be updated to default value",[e.count])),$$(t.numberOfNull).show()):$$(t.numberOfNull).hide()}catch(e){}else $$(t.numberOfNull).hide()}isValid(){const e=this.ids;let t=$$(e.component).validate(),i=this.formValues().columnName;const n=this.FieldClass();n||this.AB.notify.developer(new Error("Unable to resolve FieldClass"),{context:"ABFieldProperty: isValid()",base:this.ids.component}),n?.reservedNames.indexOf(i.trim().toLowerCase())>-1&&(this.markInvalid("columnName",o("This is a reserved name")),t=!1);let s=this.CurrentObject?.fields((e=>e.columnName==i));return this._CurrentField&&(s=s.filter((e=>e.id!=this._CurrentField.id))),s.length>0&&(this.markInvalid("columnName",o("This column name is in use by another field ({0})",[s.label])),t=!1),t}markInvalid(e,t){$$(this.ids.component).markInvalid(e,t)}populate(e){const t=this.ids;this._CurrentField=e,["label","columnName"].forEach((i=>{$$(t[i]).setValue?.(e[i])})),$$(t.fieldDescription).setValue(e.fieldDescription()),Object.keys(t).forEach((i=>{void 0!==e.settings[i]&&$$(t[i])?.setValue?.(e.settings[i])})),$$(t.label).setValue(e.label),$$(t.columnName).setValue(e.columnName),$$(t.showIcon).setValue(e.settings.showIcon),$$(t.required).setValue(e.settings.required),$$(t.unique).setValue(e.settings.unique),this.populateValidationRules()}populateValidationRules(e=!1){const t=this.ids,i=this._CurrentField;let n=i?.settings?.validationRules??[];if(n&&"string"==typeof n)try{n=JSON.parse(n)}catch(e){this.AB.notify.builder(e,{context:`ABField[${i.id}][${i.name}]: has invalid validationRules`,validationRules:i.settings.validationRules}),n=[]}$$(t.addValidation).define("badge",0!==n?.length?n?.length:null),$$(t.addValidation).refresh(),e&&0!=$$(t.filterComplex).getChildViews().length||(n??[]).forEach((e=>{this.addValidation(e)}))}requiredOnChange(){}values(){const e=this.ids,t=$$(e.component).getValues();if($$(e.filterComplex)){const i=[];$$(e.filterComplex).queryView({view:"form",css:"abValidationForm"},"all").forEach((e=>{const t=e._Filter.getValue(),n={invalidMessage:e.queryView({name:"invalidMessage"}).getValue(),rules:t};i.push(n)})),t.validationRules=JSON.stringify(i)}const i=this.FieldClass(),n=i.editorValues(t);return n.key=i.defaults().key,n}}}return s}},6063:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_autoindex`,{prefix:"",delimiter:"",displayLength:"",previewText:""})}ui(){const e=this.ids,n=this.FieldClass();return super.ui([{cols:[{view:"label",label:i("Prefix:"),align:"right",width:75},{id:e.prefix,view:"text",name:"prefix",placeholder:i("Prefix"),on:{onTimedKeyPress:()=>{this.previewChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Delimiter:"),align:"right",width:75},{id:e.delimiter,view:"richselect",name:"delimiter",value:"none",options:n.delimiterList(),on:{onChange:()=>{this.previewChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Length:"),align:"right",width:75},{id:e.displayLength,view:"counter",name:"displayLength",step:1,value:4,min:1,max:10,width:104,on:{onChange:()=>{this.previewChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Preview:"),align:"right",width:75},{id:e.previewText,view:"text",name:"previewText",value:"0000",disabled:!0,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}])}previewChange(){const e=this.ids,t=this.FieldClass().setValueToIndex($$(e.prefix).getValue(),$$(e.delimiter).getValue(),$$(e.displayLength).getValue(),0);$$(e.previewText).setValue(t)}FieldClass(){return super._FieldClass("AutoIndex")}populate(e){super.populate(e),this.previewChange()}}}},1573:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_boolean`,{checkBoxLabel:"",default:""})}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Default:"),align:"right",width:65},{id:e.default,name:"default",view:"checkbox",css:"webix_table_checkbox",width:30,on:{onChange:t=>{let n=i("Check"),s=i("Uncheck");$$(e.checkBoxLabel).setValue(t?n:s)},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.checkBoxLabel,view:"label",label:i("Uncheck"),width:60}]}])}FieldClass(){return super._FieldClass("boolean")}}}},9263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_calculate`,{formula:"",fieldPopup:"",fieldList:"",numberOperatorPopup:"",numberOperatorPopupList:"",dateOperatorPopup:"",dateFieldList:"",decimalSign:"",decimalPlaces:""})}ui(){const e=this.ids,n=[{id:"none",value:i("None")},{id:"comma",value:i("Comma"),sign:","},{id:"period",value:i("Period"),sign:"."},{id:"space",value:i("Space"),sign:" "}];return webix.ui({id:e.fieldPopup,view:"popup",hidden:!0,width:200,body:{id:e.fieldList,view:"list",data:[],template:this.itemTemplate,on:{onItemClick:t=>{const i="{"+$$(e.fieldList).getItem(t).columnName+"}";this.insertEquation(i),$$(e.fieldPopup).hide()},onAfterRender:function(){t.CYPRESS_REF(this)}}},on:{onBeforeShow:()=>{$$(e.fieldList).clearAll(),$$(e.fieldList).parse(this.getNumberFields())}}}),webix.ui({id:e.numberOperatorPopup,view:"popup",hidden:!0,width:200,body:{id:e.numberOperatorPopupList,view:"list",template:this.itemTemplate,data:[{label:i("+ Adds"),symbol:"+"},{label:i("- Subtracts"),symbol:"-"},{label:i("* Multiples"),symbol:"*"},{label:i("/ Divides"),symbol:"/"},{label:i("( Open Bracket"),symbol:"("},{label:i(") Closed Bracket"),symbol:")"}],on:{onItemClick:t=>{const i=$$(e.numberOperatorPopupList).getItem(t);this.insertEquation(i.symbol),$$(e.numberOperatorPopup).hide()},onAfterRender:function(){t.CYPRESS_REF(this)}}}}),webix.ui({id:e.dateOperatorPopup,view:"popup",hidden:!0,width:280,data:[],body:{id:e.dateFieldList,view:"list",template:this.itemTemplate,data:[],on:{onItemClick:t=>{const i=$$(e.dateFieldList).getItem(t);this.insertEquation(i.function),$$(e.dateOperatorPopup).hide()},onAfterRender:function(){t.CYPRESS_REF(this)}}},on:{onBeforeShow:()=>{$$(e.dateFieldList).clearAll(),$$(e.dateFieldList).parse(this.getDateFields())}}}),super.ui([{rows:[{cols:[{view:"label",label:i("Equation:"),align:"left",width:75},{}]},{id:e.formula,name:"formula",view:"textarea",height:100,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{rows:[{cols:[{view:"button",type:"icon",css:"webix_primary",icon:"fa fa-hashtag",label:i("Number Fields"),width:185,click:function(){$$(e.fieldPopup).show(this.$view)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"button",type:"icon",css:"webix_primary",icon:"fa fa-calendar",label:i("Date Fields"),click:function(){$$(e.dateOperatorPopup).show(this.$view)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-hashtag",label:i("Number Operators"),width:185,click:function(){$$(e.numberOperatorPopup).show(this.$view)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{}]},{cols:[{view:"label",label:i("Decimals:"),align:"right",width:67},{id:e.decimalSign,view:"richselect",name:"decimalSign",value:"none",options:n,on:{onChange:t=>{"none"==t?$$(e.decimalPlaces).disable():$$(e.decimalPlaces).enable()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"label",label:i("Places:"),align:"right",width:67},{id:e.decimalPlaces,view:"counter",name:"decimalPlaces",step:1,value:1,min:1,max:10,disabled:!0,width:104,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]}])}getNumberFields(){return this.CurrentObject?this.CurrentObject.fields((e=>"number"==e.key||"calculate"==e.key||"formula"==e.key)):[]}getDateFields(){if(this.CurrentObject){const e=[{label:i("Convert minutes to hours (Format: hours.minutes)"),function:"MINUTE_TO_HOUR()"},{label:i("Year of [{0}]",["Current"]),function:"YEAR(CURRENT)"},{label:i("Month of [{0}]",["Current"]),function:"MONTH(CURRENT)"},{label:i("Day of [{0}]",["Current"]),function:"DAY(CURRENT)"},{label:i("Get days of [{0}] (since January 1, 1970)",["Current"]),function:"DATE(CURRENT)"},{label:i("Get hours of [{0}] (since January 1, 1970)",["Current"]),function:"HOUR(CURRENT)"},{label:i("Get minutes of [{0}] (since January 1, 1970)",["Current"]),function:"MINUTE(CURRENT)"}];return this.CurrentObject.fields((e=>"date"==e.key||"datetime"==e.key)).forEach((t=>{e.push({label:i("Calculate age from [{0}]",[t.label]),function:`AGE({${t.columnName}})`},{label:i("Year of [{0}]",[t.label]),function:`YEAR({${t.columnName}})`},{label:i("Month of [{0}]",[t.label]),function:`MONTH({${t.columnName}})`},{label:i("Day of [{0}]",[t.label]),function:`DAY({${t.columnName}})`},{label:i("Get days of [{0}] (since January 1, 1970)",[t.label]),function:`DATE({${t.columnName}})`},{label:i("Get hours of [{0}] (since January 1, 1970)",[t.label]),function:`HOUR({${t.columnName}})`},{label:i("Get minutes of [{0}] (since January 1, 1970)",[t.label]),function:`MINUTE({${t.columnName}})`})})),e}return[]}itemTemplate(e){let t="";return e.icon&&(t+=`<i class="fa fa-${e.icon}" aria-hidden="true"></i> `),e.label&&(t+=e.label),t}insertEquation(e){const t=this.ids,i=$$(t.formula).getValue();$$(t.formula).setValue(i+e)}FieldClass(){return super._FieldClass("calculate")}isValid(){const e=this.ids,t=this.FieldClass();let i=super.isValid();if(i){$$(e.component).markInvalid("formula",!1);const n=$$(e.formula).getValue();try{t.convertToJs(this.CurrentObject,n,{}),i=!0}catch(t){$$(e.component).markInvalid("formula",t.message??""),i=!1}}return i}}}},1134:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_combine`,{combinedFields:"",delimiter:""})}ui(){const e=this.ids,n=this.FieldClass();return super.ui([{cols:[{view:"label",label:s("Combined Fields:"),align:"right",width:125},{id:e.combinedFields,name:"combinedFields",view:"multicombo",labelWidth:t.labelWidthXLarge,disallowEdit:!0,options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:s("Delimiter:"),align:"right",width:125},{id:e.delimiter,view:"richselect",name:"delimiter",value:n.defaultValues().delimiter,labelWidth:t.labelWidthXLarge,disallowEdit:!0,options:[{id:"plus",value:s("Plus ( + )")},{id:"dash",value:s("Dash ( - )")},{id:"period",value:s("Period ( . )")},{id:"space",value:s("Space ( )")}],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]}])}FieldClass(){return super._FieldClass("combined")}show(){const e=this.ids,t=this.CurrentObject.fields((e=>["string","LongText","number","date","datetime","boolean","list","email","user","AutoIndex","combined"].indexOf(e.key)>-1||e.isConnection&&("one"==e.settings.linkType&&"many"==e.settings.linkViaType||"one"==e.settings.linkType&&"one"==e.settings.linkViaType&&e.settings.isSource))).map((e=>({id:e.id,value:e.label})));super.show();const i=$$(e.combinedFields);i&&(i.define("options",t),i.refresh())}}}},2818:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_connect`,{linkObject:"",objectCreateNew:"",fieldLink:"",fieldLink2:"",linkType:"",linkViaType:"",fieldLinkVia:"",fieldLinkVia2:"",link1:"",link2:"",isCustomFK:"",indexField:"",indexField2:"",netsuite_one:"",netsuiteOneLabel:"",netsuiteOneColumn:"",netsuite_many:"",connectDataPopup:""})}ui(){const e=this.FieldClass(),n=this.ids;return super.ui([{cols:[{view:"label",label:s("Connected to:"),align:"right",width:94},{id:n.linkObject,view:"richselect",disallowEdit:!0,name:"linkObject",labelWidth:t.labelWidthLarge,placeholder:s("Select object"),options:[],on:{onChange:(e,t)=>{this.selectObjectTo(e,t)},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"layout",id:n.link1,hidden:!0,cols:[{id:n.fieldLink,view:"label",width:300},{id:n.linkType,disallowEdit:!0,name:"linkType",view:"richselect",value:e.defaultValues().linkType,width:95,options:[{id:"many",value:s("many")},{id:"one",value:s("one")}],on:{onChange:(e,t)=>{this.selectLinkType(e,t)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.fieldLinkVia,view:"label",label:s("<b>[Select Object]</b> entry."),width:200}]},{view:"layout",id:n.link2,hidden:!0,cols:[{id:n.fieldLinkVia2,view:"label",label:s("Each <b>[Select object]</b> entry connects with"),width:300},{id:n.linkViaType,name:"linkViaType",disallowEdit:!0,view:"richselect",value:e.defaultValues().linkViaType,width:95,options:[{id:"many",value:s("many")},{id:"one",value:s("one")}],on:{onChange:(e,t)=>{this.selectLinkViaType(e,t)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.fieldLink2,view:"label",width:200}]},{name:"linkColumn",view:"text",hidden:!0},{name:"isSource",view:"text",hidden:!0},{id:n.isCustomFK,name:"isCustomFK",view:"checkbox",disallowEdit:!0,labelWidth:0,labelRight:s("Custom Foreign Key"),hidden:!0,on:{onChange:()=>{this.checkCustomFK()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.indexField,name:"indexField",view:"richselect",disallowEdit:!0,hidden:!0,labelWidth:t.labelWidthLarge,label:s("Index Field:"),placeholder:s("Select index field"),options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:n.indexField2,name:"indexField2",view:"richselect",disallowEdit:!0,hidden:!0,labelWidth:t.labelWidthLarge,label:s("Index Field:"),placeholder:s("Select index field"),options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"layout",id:n.netsuite_one,hidden:!0,cols:[{id:n.netsuiteOneLabel,view:"label",label:s(" <b>[Select object]</b>'s field"),width:300},{id:n.netsuiteOneColumn,name:"netsuiteOneColumn",disallowEdit:!0,view:"richselect",fillspace:!0,options:[],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]}])}clear(){super.clear(),$$(this.ids.linkObject).setValue(this.FieldClass().defaultValues().linkObject)}FieldClass(){return super._FieldClass("connectObject")}isValid(){const e=this.ids;let t=super.isValid();return $$(e.linkObject).getValue()?this.clearInvalid("linkObject"):(this.markInvalid("linkObject",s("Select an object")),t=!1),t}selectLinkViaType(e){let t=s("entry"),i=s("entries"),n=$$(this.ids.fieldLink2),o=n.getValue()||"";o="many"==e?o.replace(t,i):o.replace(i,t),n.define("label",o),n.refresh(),this.updateCustomIndex(),this.checkNetsuiteObjects()}show(){super.show(),this.populateSelect(!1);const e=this.ids;$$(e.fieldLink).setValue(s("Each <b>{0}</b> entry connects with",[this.CurrentObject?.label])),$$(e.fieldLink2).setValue(s("<b>{0}</b> entry.",[this.CurrentObject?.label])),this.updateCustomIndex()}checkCustomFK(){const e=this.ids;if($$(e.indexField).hide(),$$(e.indexField2).hide(),$$(e.isCustomFK).getValue()){let t=$$(e.indexField).getList().config.data;t&&t.length&&$$(e.indexField).show();let i=$$(e.indexField2).getList().config.data;i&&i.length&&$$(e.indexField2).show()}}populateSelect(){const e=[],t=this.CurrentApplication;let i=()=>!0;this.CurrentObject.isNetsuite&&(i=e=>e.isNetsuite),t?t.objectsIncluded(i).forEach((t=>{e.push({id:t.id,value:t.label})})):this.AB.objects(i).forEach((t=>{e.push({id:t.id,value:t.label})})),e.sort(((e,t)=>e.value<t.value?-1:e.value>t.value?1:0));const n=this.ids,s=$$(n.linkObject);s.define("options",e),s.refresh()}selectLinkType(e){let t=s("entry"),i=s("entries"),n=$$(this.ids.fieldLinkVia),o=n.getValue()||"";o="many"==e?o.replace(t,i):o.replace(i,t),n.define("label",o),n.refresh(),this.updateCustomIndex(),this.checkNetsuiteObjects()}selectObjectTo(e,t){const i=this.ids;if(e||($$(i.link1).hide(),$$(i.link2).hide()),e==t||""==e)return;let n=$$(i.linkObject).getList().getItem(e);if(!n)return;let o=n.value;$$(i.fieldLinkVia).setValue(s("<b>{0}</b> entry.",[o])),$$(i.fieldLinkVia2).setValue(s("Each <b>{0}</b> entry connects with",[o])),$$(i.link1).show(),$$(i.link2).show(),this.updateCustomIndex(),this.checkNetsuiteObjects()}updateCustomIndex(){const e=this.ids;let t=$$(e.linkObject).getValue(),i=$$(e.linkType).getValue(),n=$$(e.linkViaType).getValue(),s=null,o=null;$$(e.indexField2).define("options",[]),$$(e.indexField2).refresh();let a=`${i}:${n}`;if(["one:one","one:many"].indexOf(a)>-1)s=this.AB.objectByID(t);else if("many:one"==a)s=this.CurrentObject;else if("many:many"==a){s=this.CurrentObject;let i=this.AB.objectByID(t),n=[];o=i.indexes((e=>e.unique)),(o||[]).forEach((e=>{(e.fields||[]).forEach((e=>{(e&&e.settings&&e.settings.required&&!n.filter((t=>t.id==e.id)).length||"AutoIndex"==e.key||"combined"==e.key)&&n.push({id:e.id,value:e.label})}))})),$$(e.indexField2).define("options",n),$$(e.indexField2).refresh()}if($$(e.indexField).hide(),$$(e.indexField2).hide(),!s)return void $$(e.isCustomFK).hide();let r=s.indexes((e=>e.unique));if((!r||r.length<1)&&(!o||o.length<1))return $$(e.isCustomFK).hide(),$$(e.indexField).define("options",[]),void $$(e.indexField).refresh();let l=[];(r||[]).forEach((e=>{(e.fields||[]).forEach((e=>{(e&&e.settings&&e.settings.required&&!l.filter((t=>t.id==e.id)).length||"AutoIndex"==e.key||"combined"==e.key)&&l.push({id:e.id,value:e.label,field:e})}))})),$$(e.indexField).define("options",l),$$(e.indexField).refresh(),l&&l.length&&$$(e.isCustomFK).show(),this.checkCustomFK()}async checkNetsuiteObjects(){let e=this.ids;if(!this.CurrentObject.isNetsuite)return $$(e.netsuite_one)?.hide(),void $$(e.netsuite_many)?.hide();let t=$$(e.linkType).getValue(),i=$$(e.linkViaType).getValue();if("one"==t)await this.updateNetsuiteOneUI(this.CurrentObject),$$(e.netsuite_one)?.show(),$$(e.netsuite_many)?.hide();else if("one"==i){let t=$$(e.linkObject).getValue(),i=this.AB.objectByID(t);if(!i)return;await this.updateNetsuiteOneUI(i),$$(e.netsuite_one)?.show(),$$(e.netsuite_many)?.hide()}else $$(e.netsuite_one)?.hide(),$$(e.netsuite_many)?.show()}async updateNetsuiteOneUI(e){let t=this.ids;$$(t.netsuiteOneLabel).setValue(s(" <b>{0}</b>'s field",[e.label]));let i=(await this.AB.Network.get({url:`/netsuite/table/${e.tableName}`,params:{credentials:JSON.stringify(e.credentials)}})).filter((e=>"object"==e.type)).map((e=>({id:e.column,value:e.column})));$$(t.netsuiteOneColumn).define("options",i),$$(t.netsuiteOneColumn).refresh()}}}},2970:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_date`,{default:"",currentToDefault:"",dateDisplay:"",dateFormat:"",defaultDate:"",defaultDateValue:"",validateCondition:"",validateRange:"",validateRangeUnit:"",validateRangeBefore:"",validateRangeAfter:"",validateRangeBeforeLabel:"",validateRangeAfterLabel:"",validateStartDateContainer:"",validateStartDateContainerLabel:"",validateEndDateContainer:""})}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Date Format:"),align:"right",width:88},{view:"richselect",name:"dateFormat",id:e.dateFormat,value:2,options:[{id:2,value:"dd/mm/yyyy"},{id:3,value:"mm/dd/yyyy"},{id:4,value:"M D, yyyy"},{id:5,value:"D M, yyyy"}],on:{onChange:()=>{this.refreshDateValue()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default:"),align:"right",width:88},{view:"richselect",name:"defaultDate",id:e.defaultDate,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Date")},{id:3,value:i("Specific Date")}],on:{onChange:()=>{this.defaultDateChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultDateValue",id:e.defaultDateValue,gravity:.5,disabled:!0,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:i("Validation criteria:"),width:123,css:"ab-text-bold"},{cols:[{view:"label",label:i("Condition:"),align:"right",width:88,css:"ab-text-bold"},{id:e.validateCondition,view:"select",name:"validateCondition",value:"none",options:[{id:"none",value:i("None")},{id:"dateRange",value:i("Range")},{id:"between",value:i("Between")},{id:"notBetween",value:i("Not between")},{id:"=",value:i("Equal to")},{id:"<>",value:i("Not equal to")},{id:">",value:i("Greater than")},{id:"<",value:i("Less than")},{id:">=",value:i("Greater than or Equal to")},{id:"<=",value:i("Less than or Equal to")},{id:"lessCurrentDate",value:i("Less than current date")},{id:"lessEqualCurrentDate",value:i("Less than or Equal to current date")}],on:{onChange:t=>{switch(t){case"none":case"lessCurrentDate":case"lessEqualCurrentDate":$$(e.validateRange).hide(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"dateRange":$$(e.validateRange).show(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"between":case"notBetween":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Start Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).show();break;case"=":case"<>":case">":case"<":case">=":case"<=":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).hide()}},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateRange,hidden:!0,rows:[{cols:[{view:"label",label:i("Unit:"),align:"right",width:88},{id:e.validateRangeUnit,view:"select",name:"validateRangeUnit",options:[{id:"days",value:i("Days")},{id:"months",value:i("Months")},{id:"years",value:i("Years")}],on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh(),$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{id:e.validateRangeBeforeLabel,view:"template",align:"left",width:140,borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("Before")} ${$$(e.validateRangeBefore).getValue()} ${n.value}`}},{view:"label",label:"",align:"center",width:1},{id:e.validateRangeAfterLabel,view:"template",align:"right",borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("After")} ${$$(e.validateRangeAfter).getValue()} ${n.value}`}}]},{cols:[{id:e.validateRangeBefore,view:"slider",name:"validateRangeBefore",on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.validateRangeAfter,view:"slider",name:"validateRangeAfter",on:{onChange:()=>{$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]},{id:e.validateStartDateContainer,hidden:!0,cols:[{id:e.validateStartDateContainerLabel,view:"label",label:i("Start Date:"),align:"right",width:88},{name:"validateStartDate",view:"datepicker",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateEndDateContainer,hidden:!0,cols:[{view:"label",label:i("End Date:"),align:"right",width:88},{name:"validateEndDate",view:"datepicker",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}])}defaultDateChange(){const e=this.ids,t=$$(e.defaultDate).getValue();switch(parseInt(t)){case 1:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue();break;case 2:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue(new Date),this.refreshDateValue();break;case 3:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue();break;default:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue(new Date)}}refreshDateValue(){const e=this.ids,t=$$(e.dateFormat).getValue();let i="";switch(parseInt(t)){case 2:default:i="%d/%m/%Y";break;case 3:i="%m/%d/%Y";break;case 4:i="%M %d, %Y";break;case 5:i="%d %M, %Y"}$$(e.defaultDateValue).define("format",i),$$(e.defaultDateValue).refresh()}defaultTimeChange(){const e=this.ids;switch(console.log("defaultTimeChange"),parseInt($$(e.defaultTime).getValue())){case 1:default:$$(e.defaultTimeValue).disable(),$$(e.defaultTimeValue).setValue();break;case 2:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue(new Date);break;case 3:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue()}}FieldClass(){return super._FieldClass("date")}populate(e){const t=this.ids;super.populate(e),$$(t.defaultDateValue).setValue(new Date(e.settings.defaultDateValue))}show(){this.refreshDateValue(),super.show()}}}},2250:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_datetime`,{default:"",currentToDefault:"",dateDisplay:"",dateFormat:"",defaultDate:"",defaultDateValue:"",timeFormat:"",defaultTime:"",defaultTimeValue:"",validateCondition:"",validateRange:"",validateRangeUnit:"",validateRangeBefore:"",validateRangeAfter:"",validateRangeBeforeLabel:"",validateRangeAfterLabel:"",validateStartDateContainer:"",validateStartDateContainerLabel:"",validateEndDateContainer:""})}ui(){const e=this.ids;return super.ui([{view:"label",label:i("Date:"),align:"left"},{cols:[{view:"label",label:i("Format:"),align:"right",width:88},{id:e.dateFormat,view:"richselect",name:"dateFormat",value:1,options:[{id:1,value:i("Ignore Date")},{id:2,value:"dd/mm/yyyy"},{id:3,value:"mm/dd/yyyy"},{id:4,value:"M D, yyyy"},{id:5,value:"D M, yyyy"}],on:{onChange:()=>{this.refreshDateValue()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default:"),align:"right",width:88},{view:"richselect",name:"defaultDate",id:e.defaultDate,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Date")},{id:3,value:i("Specific Date")}],on:{onChange:()=>{this.defaultDateChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultDateValue",id:e.defaultDateValue,gravity:.5,disabled:!0,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:i("Validation criteria:"),width:123,css:"ab-text-bold"},{cols:[{view:"label",label:i("Condition:"),align:"right",width:88,css:"ab-text-bold"},{id:e.validateCondition,view:"select",name:"validateCondition",value:"none",options:[{id:"none",value:i("None")},{id:"dateRange",value:i("Range")},{id:"between",value:i("Between")},{id:"notBetween",value:i("Not between")},{id:"=",value:i("Equal to")},{id:"<>",value:i("Not equal to")},{id:">",value:i("Greater than")},{id:"<",value:i("Less than")},{id:">=",value:i("Greater than or Equal to")},{id:"<=",value:i("Less than or Equal to")}],on:{onChange:t=>{switch(t){case"none":$$(e.validateRange).hide(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"dateRange":$$(e.validateRange).show(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"between":case"notBetween":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Start Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).show();break;case"=":case"<>":case">":case"<":case">=":case"<=":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).hide()}},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateRange,hidden:!0,rows:[{cols:[{view:"label",label:i("Unit:"),align:"right",width:88},{id:e.validateRangeUnit,view:"select",name:"validateRangeUnit",options:[{id:"days",value:i("Days")},{id:"months",value:i("Months")},{id:"years",value:i("Years")}],on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh(),$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{id:e.validateRangeBeforeLabel,view:"template",align:"left",width:140,borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("Before")} ${$$(e.validateRangeBefore).getValue()} ${n.value}`}},{view:"label",label:"",align:"center",width:1},{id:e.validateRangeAfterLabel,view:"template",align:"right",borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("After")} ${$$(e.validateRangeAfter).getValue()} ${n.value}`}}]},{cols:[{id:e.validateRangeBefore,view:"slider",name:"validateRangeBefore",on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.validateRangeAfter,view:"slider",name:"validateRangeAfter",on:{onChange:()=>{$$(e.validateRangeAfterLabel).refresh()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]},{id:e.validateStartDateContainer,hidden:!0,cols:[{id:e.validateStartDateContainerLabel,view:"label",label:i("Start Date:"),align:"right",width:88},{name:"validateStartDate",view:"datepicker",om:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateEndDateContainer,hidden:!0,cols:[{view:"label",label:i("End Date:"),align:"right",width:88},{name:"validateEndDate",view:"datepicker",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:i("Time:"),align:"left"},{cols:[{view:"label",label:i("Format:"),align:"right",width:88},{view:"richselect",name:"timeFormat",id:e.timeFormat,value:2,options:[{id:2,value:i("HH:MM AM/PM")},{id:3,value:i("HH:MM (military)")}],on:{onChange:()=>{this.refreshTimevalue()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default Time:"),align:"right",width:88},{view:"richselect",name:"defaultTime",id:e.defaultTime,labelWidth:110,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Time")},{id:3,value:i("Specific Time")}],on:{onChange:()=>{this.defaultTimeChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultTimeValue",type:"time",id:e.defaultTimeValue,gravity:.5,disabled:!0,onAfterRender:function(){t.CYPRESS_REF(this)}}]}])}defaultDateChange(){const e=this.ids,t=$$(e.defaultDate).getValue();switch(parseInt(t)){case 1:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue();break;case 2:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue(new Date),this.refreshDateValue();break;case 3:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue();break;default:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue(new Date)}}refreshDateValue(){const e=this.ids,t=$$(e.dateFormat).getValue();let i="";switch(parseInt(t)){case 2:default:i="%d/%m/%Y";break;case 3:i="%m/%d/%Y";break;case 4:i="%M %d, %Y";break;case 5:i="%d %M, %Y"}$$(e.defaultDateValue).define("format",i),$$(e.defaultDateValue).refresh()}defaultTimeChange(){const e=this.ids;switch(parseInt($$(e.defaultTime).getValue())){case 1:default:$$(e.defaultTimeValue).disable(),$$(e.defaultTimeValue).setValue();break;case 2:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue(new Date);break;case 3:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue()}this.refreshTimevalue()}refreshTimevalue(){const e=this.ids;let t="";switch(parseInt($$(e.timeFormat).getValue())){case 2:default:t="%h:%i %A";break;case 3:t="%H:%i"}$$(e.defaultTimeValue).define("format",t),$$(e.defaultTimeValue).refresh()}FieldClass(){return super._FieldClass("datetime")}populate(e){const t=this.ids;super.populate(e),$$(t.defaultDateValue).setValue(new Date(e.settings.defaultDateValue)),$$(t.defaultTimeValue).setValue(new Date(e.settings.defaultTimeValue))}show(){this.refreshDateValue(),this.refreshTimevalue(),super.show()}}}},6393:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_email`,{default:"",defaultCheckbox:""})}ui(){const i=this.ids;return super.ui([{cols:[{view:"label",label:s("Default Value:"),align:"right",width:100},{id:i.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{view:"text",id:i.default,name:"default",placeholder:s("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}])}checkboxDefaultValue(e){0===e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}FieldClass(){return super._FieldClass("email")}isValid(){const e=this.ids;let t=super.isValid();$$(e.component).clearValidation();const i=$$(e.required).getValue(),n=$$(e.default).getValue();return i||n?webix.rules.isEmail(n)?t=!0:($$(e.component).markInvalid("default",s("This email is invalid")),t=!1):t=!0,t}populate(e){const t=this.ids;super.populate(e),""===e.settings.default?$$(t.defaultCheckbox).setValue(0):$$(t.defaultCheckbox).setValue(1)}}}},727:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_file`,{fileSize:"",fileType:""})}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Size (MB):"),align:"right",width:75},{view:"checkbox",name:"limitFileSize",value:1,width:30,click:function(){this.getValue()?$$(e.fileSize).enable():$$(e.fileSize).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"counter",name:"fileSize",id:e.fileSize,width:104,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Type:"),align:"right",width:75},{view:"checkbox",name:"limitFileType",width:30,labelWidth:0,value:1,click:function(){this.getValue()?$$(e.fileType).enable():$$(e.fileType).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.fileType,view:"text",name:"fileType",placeholder:i("txt,rtf,doc,docx,..."),on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]}])}FieldClass(){return super._FieldClass("file")}clear(){const e=this.ids;super.clear(),$$(e.fileSize).setValue(0),$$(e.fileType).setValue("")}}}},6139:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_formula`,{field:"",fieldList:"",rowFilterContainer:""})}ui(){this.FieldClass();const n=this.ids;return this.rowFilter=e.filterComplexNew(n.component,{isSaveHidden:!0}),super.ui([{cols:[{view:"label",label:s("Type:"),align:"right",width:40},{view:"richselect",name:"type",labelWidth:t.labelWidthMedium,value:"sum",options:[{id:"sum",value:s("Sum")},{id:"max",value:s("Max")},{id:"min",value:s("Min")},{id:"average",value:s("Average")},{id:"count",value:s("Count")}],on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:s("Field:"),align:"right",width:40},{id:n.field,view:"richselect",name:"field",labelWidth:t.labelWidthMedium,options:{view:"suggest",body:{id:n.fieldList,view:"list",template:this.itemTemplate,data:[]}},on:{onChange:()=>{this.refreshFilter()},onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{id:n.rowFilterContainer,height:200,rows:[{fillspace:!0,height:10},this.rowFilter.ui]}])}getFieldList(){const e=[];return this.CurrentObject.connectFields().forEach((t=>{t.datasourceLink.fields().forEach((i=>{"number"==i.key&&e.push({id:`${t.id}:${i.id}`,field:t,fieldLink:i})}))})),e}itemTemplate(e){return`[${e.field.label}] ${e.fieldLink.object.label} -> <i class="fa fa-${e.fieldLink.icon}" aria-hidden="true"></i><b>${e.fieldLink.label}</b>`}getSelectedField(){const e=this.ids,t=$$(e.field).getValue();return $$(e.field).getList().data.find({id:t})[0]}refreshFilter(){const e=$$(this.ids.rowFilterContainer),t=this.getSelectedField();t?.fieldLink?.object?(this.rowFilter.fieldsLoad(t.fieldLink.object.fields()),e.show()):(this.rowFilter.fieldsLoad([]),e.hide())}FieldClass(){return super._FieldClass("formula")}populate(e){const t=this.ids;if(super.populate(e),e.settings.field){const i=`${e.settings.field}:${e.settings.fieldLink}`;$$(t.field).setValue(i||"")}else $$(t.field).setValue("");this.refreshFilter(),this.rowFilter.setValue(e.settings.where||{})}show(){const e=this.ids,t=this.getFieldList();$$(e.fieldList).clearAll(),$$(e.fieldList).parse(t),super.show(),this.refreshFilter()}values(){const e=this.ids,t=$$(e.component).getValues(),i=this.getSelectedField();return i?(t.field=i.field.id,t.fieldLink=i.fieldLink.id,t.object=i.fieldLink.object.id):(t.field="",t.fieldLink="",t.object=""),this.refreshFilter(),t.where=this.rowFilter.getValue(),$$(e.component).setValues(t),super.values()}}}},7380:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e="properties_abfield"){super(`${e}_image`,{imageWidth:"",imageHeight:"",imageContainer:"",defaultImageUrl:"",useWidth:"",useHeight:"",useDefaultImage:""})}ui(){const n=this.ids;return super.ui([{cols:[{view:"label",label:i("Width:"),align:"right",width:60},{id:n.useWidth,view:"checkbox",name:"useWidth",width:30,value:1,click:function(){this.getValue()?$$(n.imageWidth).enable():$$(n.imageWidth).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:n.imageWidth,view:"text",name:"imageWidth",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Height:"),align:"right",width:60},{id:n.useHeight,view:"checkbox",name:"useHeight",width:30,value:1,click:function(){this.getValue()?$$(n.imageHeight).enable():$$(n.imageHeight).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"text",name:"imageHeight",id:n.imageHeight,on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default image:"),align:"right",width:100},{id:n.useDefaultImage,view:"checkbox",name:"useDefaultImage",value:0,click:function(){this.getValue()?$$(n.imageContainer).enable():$$(n.imageContainer).disable()},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:n.imageContainer,disabled:!0,cols:[{},{view:"uploader",id:n.defaultImageUrl,template:`<div style="text-align:center; font-size: 30px;">\n                           <div class="default-image-holder">\n                              <div class="image-data-field-icon">\n                                 <i class="fa fa-picture-o fa-2x"></i>\n                                 <div style="font-size: 15px;">${i("Drag and drop or click here")}</div>\n                              </div>\n                              <div class="image-data-field-image" style="display:none;">\n                                 <a style="" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image" style="display:none;"></i></a>\n                              </div>\n                           </div>\n                        </div>`,apiOnly:!0,inputName:"file",multiple:!1,name:"defaultImageUrl",height:105,width:150,on:{onBeforeFileAdd:function(e){const t=["jpg","jpeg","bmp","png","gif"],n=e.type.toLowerCase();if(-1==t.indexOf(n))return webix.message(i("Only [{0}] images are supported",[t.join(", ")])),!1},onFileUploadError:function(t,i){e.notify.developer(new Error("Error loading image"),{message:"Error loading image",response:i})},onAfterRender:function(){t.CYPRESS_REF(this)}}},{}]}])}urlImage(e){return`/file/${e}`}urlUpload(e=!0){return`/file/upload/${this.CurrentObjectID}/${this.CurrentFieldID}/${e?"1":"0"}`}FieldClass(){return super._FieldClass("image")}populate(e){const t=this.ids,i=$$(t.defaultImageUrl),n=e.settings.defaultImageUrl,s=e.settings.useDefaultImage;super.populate(e),e.settings.useDefaultImage&&$$(t.imageContainer).enable(),n&&s&&(i.attachEvent("onAfterRender",(()=>{const e=i.$view.querySelector(".default-image-holder");e.querySelector(".image-data-field-icon").style.display="none";const t=e.querySelector(".image-data-field-image");t.style.display="",t.style.backgroundImage=`url('${this.urlImage(n)}')`,t.setAttribute("image-uuid",n),e.querySelector(".delete-image").style.display="table-cell"})),i.$view.addEventListener("click",(e=>{if(e.target.className.indexOf("delete-image")>-1){const e=i.$view.querySelector(".default-image-holder");e.querySelector(".image-data-field-icon").style.display="";const t=e.querySelector(".image-data-field-image");t.style.display="none",t.style.backgroundImage="",t.setAttribute("image-uuid",""),e.querySelector(".delete-image").style.display="none"}})))}show(){const e=this.ids,t=this.urlUpload(!0),i=$$(e.defaultImageUrl);i.config.upload=t,i.attachEvent("onFileUpload",((t,n)=>{$$(e.defaultImageUrl).setValue(n.data.uuid);const s=i.$view.querySelector(".default-image-holder");s.querySelector(".image-data-field-icon").style.display="none";const o=s.querySelector(".image-data-field-image");o.style.display="",o.style.backgroundImage=`url('${this.urlImage(n.data.uuid)}')`,o.setAttribute("image-uuid",n.data.uuid),s.querySelector(".delete-image").style.display="table-cell"})),i.attachEvent("onAfterRender",(()=>{const e=i.$view.querySelector(".default-image-holder");e.querySelector(".image-data-field-icon").style.display="";const t=e.querySelector(".image-data-field-image");t.style.display="none",t.style.backgroundImage="",t.setAttribute("image-uuid",""),e.querySelector(".delete-image").style.display="none"})),i.addDropZone(i.$view),i.render(),super.show()}clear(){const e=this.ids;super.clear(),$$(e.useWidth).setValue(0),$$(e.useHeight).setValue(0),$$(e.useDefaultImage).setValue(0),$$(e.imageWidth).setValue(""),$$(e.imageHeight).setValue(""),$$(e.defaultImageUrl).setValue("")}}}},7341:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(e="properties_abfield"){super(`${e}_json`,{})}ui(){return super.ui([])}FieldClass(){return super._FieldClass("json")}}}},4074:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Class.ABFieldManager.fieldByKey("selectivity");return class extends t{constructor(e="properties_abfield"){super(`${e}_list`,{isMultiple:"",hasColors:"",default:"",multipleDefault:"",options:"",colorboard:""}),this.colors=[["#F44336","#E91E63","#9C27B0","#673AB7"],["#3F51B5","#2196F3","#03A9F4","#00BCD4"],["#009688","#4CAF50","#8BC34A","#CDDC39"],["#FFEB3B","#FFC107","#FF9800","#FF5722"],["#795548","#9E9E9E","#607D8B","#000000"]],this._originalOptions=[]}ui(){const e=this.ids;return super.ui([{view:"checkbox",name:"isMultiple",disallowEdit:!0,id:e.isMultiple,labelRight:i("Multiselect"),labelWidth:0,value:!1,on:{onChange:t=>{1==t?($$(e.default).hide(),$$(e.multipleDefault).show()):($$(e.default).show(),$$(e.multipleDefault).hide()),this.updateDefaultList()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"checkbox",name:"hasColors",id:e.hasColors,labelRight:i("Customize Colors"),labelWidth:0,value:!1,on:{onChange:(e,t)=>{if(e==t)return!1;this.toggleColorControl(e)},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"label",label:`<b>${i("Options")}</b>: `},{id:e.options,name:"options",css:"padList",view:this.AB._App.custom.editlist.view,template:"<div style='position: relative;'><i class='ab-color-picker fa fa-lg fa-chevron-circle-down' style='color:#hex#'></i> #value#<i class='ab-new-field-remove fa fa-remove' style='position: absolute; top: 7px; right: 7px;'></i></div>",autoheight:!0,drag:!0,editable:!0,hex:"",editor:"text",editValue:"value",onClick:{"ab-new-field-remove":(t,n)=>((this._originalOptions||[]).filter((e=>e.id==n))[0]?webix.confirm({title:i("Delete Option"),text:i("All exisiting entries with this value will be cleared. Are you sure you want to delete this option?"),type:"confirm-warning"}).then((()=>{this._CurrentField.pendingDeletions=this._CurrentField.pendingDeletions||[],this._CurrentField.pendingDeletions.push(n),$$(e.options).remove(n)})):$$(e.options).remove(n),!1),"ab-color-picker":(t,i,n)=>(webix.ui({id:e.colorboard,view:"popup",body:{view:"colorboard",type:"classic",id:"color",width:125,height:150,palette:this.colors,left:125,top:150,on:{onSelect:t=>{const n=$$(e.options).getItem(i);n.hex=t,$$(e.options).updateItem(i,n),$$(e.colorboard).hide()}}}}).show(n,{x:-7}),!1)},on:{onAfterAdd:()=>{this.updateDefaultList()},onAfterEditStop:()=>{this.updateDefaultList()},onAfterDelete:()=>{this.updateDefaultList()},onAfterRender:()=>{this.toggleColorControl($$(e.hasColors).getValue())}}},{view:"button",css:"webix_primary",value:i("Add new option"),click:()=>{let t=webix.uid(),i=this.getNextHex(),n=$$(e.options);n&&(n.add({id:t,value:"",hex:i,isNew:!0},n.count()),n.exists(t)&&n.edit(t))},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{cols:[{view:"label",label:i("Default:"),width:55},{id:e.default,placeholder:i("Select Default"),name:"default",view:"richselect",on:{onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.multipleDefault,name:"multipleDefault",view:"forminput",labelWidth:0,height:44,borderless:!0,hidden:!0,body:{view:this.AB._App.custom.focusabletemplate.view,css:"customFieldCls",borderless:!0,template:`<label style="width: 80px;text-align: left;line-height:32px;" class="webix_inp_label">${i("Default")}</label><div style="margin-left: 80px; height: 36px;" class="list-data-values form-entry"></div>`}}])}clear(){const e=this.ids;$$(e.isMultiple).setValue(0),$$(e.hasColors).setValue(0),$$(e.options).clearAll(),$$(e.default).define("options",[]),$$(e.default).setValue(this.FieldClass()?.defaultValues()?.default);const t=$$(e.multipleDefault).$view.querySelector(".list-data-values");t&&t.selectivity&&t.selectivity.setData([])}FieldClass(){return super._FieldClass("list")}getNextHex(){const e=[];$$(this.ids.options)?.data.each((function(t){e.push(t.hex)}));const t=[];this.colors.forEach((e=>{e?.forEach?.((e=>{t.push(e)}))}));let i="#3498db";for(let n=0;n<t.length;n++)if(-1==e.indexOf(t[n])){i=t[n];break}return i}populate(e){super.populate(e),this._originalOptions=e?.settings?.options??[];let t=[];this._CurrentField=e,this._CurrentField&&(this._CurrentField.pendingDeletions=[],t=(e?.settings.options||[]).map((e=>({id:e.id,value:e.text,hex:e.hex,translations:e.translations}))));const i=$$(this.ids.options);i.parse(t),i.refresh(),setTimeout((()=>{this.updateDefaultList()}),10)}toggleColorControl(e){const t=$$(this.ids.options)?.$view.querySelectorAll(".ab-color-picker");t?.forEach((function(t){1==e?t.classList.remove("hide"):t.classList.add("hide")}))}updateDefaultList(){const e=this.ids,t=this._CurrentField?.settings,n=$$(e.options).find({}).map((function(e){return{id:e.id,value:e.value,hex:e.hex}}));if($$(e.isMultiple).getValue()){const o=$$(e.multipleDefault).$view.querySelector(".list-data-values");if(!o)return!1;const a=this.values();new s(a,this).selectivityRender(o,{multiple:!0,data:t?.multipleDefault??[],placeholder:i("Select items"),items:n.map((function(e){return{id:e.id,text:e.value,hex:e.hex}}))}),o.addEventListener("change",(function(t){t.value.length?$$(e.multipleDefault).define("required",!1):$$(e.multipleDefault).$view.querySelector(".webix_inp_label").classList.contains("webix_required")&&$$(e.multipleDefault).define("required",!0)}))}else $$(e.default).define("options",n),t?.default&&$$(e.default).setValue(t.default),$$(e.default).refresh()}values(){const e=super.values(),t=this.ids;e.settings.options=[],$$(t.options).data.each((t=>{let i=t.id;t.isNew&&t.value&&!e.settings.options.filter((e=>e.id==t.value)).length&&(i=t.value),e.settings.options.push({id:i,text:t.value,hex:t.hex,translations:t.translations})})),e.settings.options.forEach((e=>{this.AB.Multilingual.unTranslate(e,e,["text"])})),e.settings.multipleDefault=[];const i=$$(t.multipleDefault).$view.querySelector(".list-data-values");return i&&i.selectivity&&(e.settings.multipleDefault=i.selectivity.getData()||[]),e}}}},3820:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_longtext`,{default:"",defaultCheckbox:""})}ui(){const e=this.ids;return super.ui([{view:"layout",cols:[{view:"label",label:s("Default Value:"),align:"right",width:100},{id:e.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:function(){i.CYPRESS_REF(this)}}},{id:e.default,view:"text",name:"default",placeholder:s("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"checkbox",name:"supportMultilingual",disallowEdit:!0,labelRight:s("Support multilingual"),labelWidth:t.labelWidthCheckbox,value:!1,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}])}FieldClass(){return super._FieldClass("LongText")}populate(e){super.populate(e);const t=""===e.settings.default?0:1;$$(this.ids.defaultCheckbox).setValue(t)}show(){super.show(),$$(this.ids.defaultCheckbox).setValue(0)}checkboxDefaultValue(e){0==e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}}}},6771:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_number`,{default:"",decimalOptions:"",typeDecimalPlaces:"",typeRounding:"",validation:"",validateMinimum:"",validateMaximum:"",defaultCheckbox:"",validateView:"",typeDecimals:"",typeFormat:"",typeThousands:""})}ui(){const i=this.FieldClass(),n=this.ids;return super.ui([{cols:[{view:"label",label:s("Default Value:"),align:"right",width:100},{id:n.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{id:n.default,view:"text",name:"default",placeholder:s("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onChange:(e,t)=>{this.numValidation(e,t,n.default)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:s("Format:"),align:"right",width:100},{id:n.typeFormat,view:"richselect",name:"typeFormat",value:"none",labelWidth:t.labelWidthXLarge,options:i.formatList(s),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:s("Decimals:"),align:"right",width:100},{id:n.typeDecimals,view:"segmented",name:"typeDecimals",disallowEdit:!0,labelWidth:t.labelWidthXLarge,value:"none",options:i.delimiterList(),on:{onChange:e=>{this.segmentedDecimals(e)},onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{id:n.decimalOptions,hidden:!0,disabled:!0,rows:[{cols:[{width:20},{view:"label",label:s("Places:"),align:"right",width:100},{id:n.typeDecimalPlaces,view:"counter",disallowEdit:!0,name:"typeDecimalPlaces",width:102,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}},{width:20},{view:"label",label:s("Rounding:"),align:"right",width:100},{id:n.typeRounding,view:"richselect",name:"typeRounding",value:"none",vertical:!0,options:[{id:"none",value:s("Default")},{id:"roundUp",value:s("Round Up")},{id:"roundDown",value:s("Round Down")}],on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]},{cols:[{view:"label",label:s("Thousands:"),align:"right",width:100},{id:n.typeThousands,view:"segmented",name:"typeThousands",value:"none",options:i.delimiterList(),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:s("Validation:"),align:"right",width:100},{view:"switch",id:n.validation,name:"validation",value:0,width:55,on:{onChange:e=>{this.switchValidation(e)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}}]},{id:n.validateView,hidden:!0,disabld:!0,rows:[{cols:[{width:20},{view:"label",label:s("Minimum:"),align:"right",width:100},{view:"text",id:n.validateMinimum,name:"validateMinimum",placeholder:s("Minimum Number"),on:{onChange:(e,t)=>{this.numValidation(e,t,n.validateMinimum)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{width:20},{view:"label",label:s("Maximum:"),align:"right",width:100},{view:"text",id:n.validateMaximum,name:"validateMaximum",placeholder:s("Maximum Number"),on:{onChange:(e,t)=>{this.numValidation(e,t,n.validateMaximum)},onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]}])}numValidation(e,t,i){new RegExp("^[0-9.]*$").test(e)||$$(i).setValue(t||"")}checkboxDefaultValue(e){0==e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}segmentedDecimals(e){"none"==e?($$(this.ids.decimalOptions).disable(),$$(this.ids.decimalOptions).hide()):($$(this.ids.decimalOptions).enable(),$$(this.ids.decimalOptions).show())}switchValidation(e){e?($$(this.ids.validateView).enable(),$$(this.ids.validateView).show()):($$(this.ids.validateView).disable(),$$(this.ids.validateView).hide())}FieldClass(){return super._FieldClass("number")}isValid(){let e=super.isValid();const t=this.formValues(),i=t.default;let n=0;if(""!==i&&(n=parseFloat(i)),t.required&&""===i&&(this.markInvalid("default",s("If a field is required, you must set a default value.")),e=!1),t.validation){const o=t.validateMinimum,a=t.validateMaximum;let r=0,l=0;""!==o&&(r=parseFloat(o)),""!==a&&(l=parseFloat(a)),""!==i&&(""!==o&&n<r&&(this.markInvalid("default",s("default value must be within any min / max value setting")),e=!1),""!==a&&n>l&&(this.markInvalid("default",s("default value must be within any min / max value setting")),e=!1)),""!=o&&""!=a&&r>l&&(this.markInvalid("validateMinimum",s("minimum value must be <= maximum value")),this.markInvalid("validateMaximum",s("maximum value must be >= minimum value")),e=!1)}return e}populate(e){const t=this.ids;super.populate(e),""===e.settings.default?$$(t.defaultCheckbox).setValue(0):$$(t.defaultCheckbox).setValue(1),0===e.settings.validation?$$(t.validateView).hide():$$(t.validateView).show(),"none"===e.settings.typeDecimals?($$(t.decimalOptions).hide(),$$(t.decimalOptions).disable()):($$(t.decimalOptions).enable(),$$(t.decimalOptions).show(),$$(t.typeDecimalPlaces).enable(),$$(t.typeDecimalPlaces).show(),$$(t.typeRounding).enable(),$$(t.typeRounding).show())}}}},401:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_string`,{default:"",supportMultilingual:"",defaultCheckbox:"",maxLength:"",maxLengthCheckbox:""})}ui(){const i=this.ids;return super.ui([{cols:[{view:"label",label:s("Default Value:"),align:"right",width:100},{id:i.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e,i.default)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{view:"text",id:i.default,name:"default",placeholder:s("Enter default value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:"Max Length",align:"right",width:100},{id:i.maxLengthCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e,i.maxLength)},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{view:"text",type:"number",id:i.maxLength,name:"maxLength",placeholder:s("Enter Max Length value"),disabled:!0,labelWidth:t.labelWidthXLarge,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},{view:"checkbox",id:i.supportMultilingual,name:"supportMultilingual",disallowEdit:!0,labelRight:s("Support multilingual"),labelWidth:t.labelWidthCheckbox,value:!1,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}])}checkboxDefaultValue(e,t){0===e?($$(t).disable(),$$(t).setValue("")):$$(t).enable()}FieldClass(){return super._FieldClass("string")}populate(e){const t=this.ids;super.populate(e),$$(t.defaultCheckbox).setValue(""===e.settings.default?0:1),$$(t.maxLengthCheckbox).setValue(""===e.settings.maxLength?0:1)}}}},8546:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_textformula`,{textFormula:"",formulaSuggest:""})}ui(){const e=this.ids;return super.ui([{view:"layout",cols:[{id:e.textFormula,view:"textarea",name:"textFormula",editor:"text",labelWidth:t.labelWidthLarge,placeholder:s("Text Formula"),on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"spacer",width:15},{view:"layout",rows:[{view:"spacer",height:5},{id:e.formulaSuggest,name:"formulaSuggest",view:"dataview",xCount:1,select:!0,type:{height:30,width:246},template:"#value#",on:{onItemClick:t=>{const i=$$(e.formulaSuggest).getItem(t),n="field"==i.type?"{"+i.value+"}":i.value;$$(e.textFormula).setValue($$(e.textFormula).getValue()+n),$$(e.formulaSuggest).unselect()},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"spacer",height:5}]}]}])}FieldClass(){return super._FieldClass("TextFormula")}show(){super.show(),this.loadSuggestions()}populate(e){super.populate(e),this.loadSuggestions()}loadSuggestions(){const e=this.ids,t=this.FieldClass(),i=this.CurrentObject.fields().filter((e=>"formula"!=e.key&&"TextFormula"!=e.key&&!e.isConnection)).map((e=>({id:e.id,value:e.columnName,type:"field"}))).concat(t.getBuildInFunction());$$(e.formulaSuggest).clearAll(),$$(e.formulaSuggest).parse(i)}}}},1702:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(e="properties_abfield"){super(`${e}_tree`,{options:"",popup:"",tree:""})}ui(){const e=this.ids;return super.ui([{view:"button",type:"icon",icon:"fa fa-plus",height:30,click:()=>{const t=webix.uid().toString();$$(e.options).data.add({id:t,text:""}),$$(e.options).openAll(),$$(e.options).config.height=28*$$(e.options).count()+18,$$(e.options).resize(),$$(e.options).edit(t)},on:{onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.options,name:"options",css:{background:"transparent"},view:this.AB.custom.edittree.view,template:"<div style='position: relative;'><i class='ab-new-field-add fa fa-plus' style='position: relative; right: 0px;'></i> #text#<i class='ab-new-field-remove fa fa-remove' style='position: absolute; top: 7px; right: 7px;'></i></div>",autoheight:!0,drag:!0,editor:"text",editable:!0,editValue:"text",onClick:{"ab-new-field-remove":(t,i)=>($$(e.options).remove(i),$$(e.options).config.height=0,$$(e.options).config.height=28*$$(e.options).count()+18,!1),"ab-new-field-add":(t,i)=>{const n=webix.uid().toString(),s=i.toString();return $$(e.options).data.add({id:n,text:""},null,s),$$(e.options).openAll(),$$(e.options).config.height=28*$$(e.options).count()+18,$$(e.options).resize(),$$(e.options).edit(n),!1}}}])}FieldClass(){return super._FieldClass("tree")}clear(){const e=this.ids;$$(e.options).clearAll(),$$(e.options).config.height=0,$$(e.options).resize(),$$(e.options).refresh()}values(){const e=super.values();return e.settings.options=$$(this.ids.options).serialize(),e}populate(e){const t=this.ids;$$(t.options).clearAll(),$$(t.options).parse(e.settings.options),$$(t.options).openAll(),$$(t.options).config.height=28*$$(t.options).count()+18,$$(t.options).resize(),$$(t.options).refresh()}}}},8114:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(917);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(e="properties_abfield"){super(`${e}_user`,{editable:"",isMultiple:"",isCurrentUser:"",isShowProfileImage:"",isShowUsername:""})}ui(){const e=this.ids;return super.ui([{view:"checkbox",name:"isMultiple",id:e.isMultiple,disallowEdit:!0,labelRight:s("Allow multiple users"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{cols:[{view:"checkbox",name:"isCurrentUser",id:e.isCurrentUser,labelRight:s("Default value as current user"),labelWidth:t.labelWidthCheckbox,on:{onChange:function(t){0==t?($$(e.editable).setValue(0),$$(e.editable).hide()):($$(e.editable).setValue(1),$$(e.editable).show())},onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"checkbox",name:"editable",hidden:!0,id:e.editable,labelRight:s("Editable"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}]},{view:"checkbox",name:"isShowProfileImage",id:e.isShowProfileImage,labelRight:s("Show Profile Image"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}},{view:"checkbox",name:"isShowUsername",id:e.isShowUsername,labelRight:s("Show Username"),labelWidth:t.labelWidthCheckbox,on:{onAfterRender:function(){i.CYPRESS_REF(this)}}}])}FieldClass(){return super._FieldClass("user")}}}},3312:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(9018);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abmobile_page",{type:"",popupSettings:"",popupWidth:"",popupHeight:"",pageSettings:"",defaultPage:"",fixedPageWidth:"",pageWidth:"",pageBackground:"",hideTitle:"",hideTabs:""})}static get key(){return"mobile-page"}ui(){let e=this.ids,t=this;return super.ui([{id:e.type,name:"type",view:"richselect",label:s("Type"),options:[{id:"page",value:s("Page")},{id:"popup",value:s("Popup")}],on:{onChange:t=>{"page"==t?($$(e.popupSettings).hide(),$$(e.pageSettings).show()):($$(e.popupSettings).show(),$$(e.pageSettings).hide()),this.onChange()}}},{id:e.popupSettings,view:"fieldset",name:"popupSettings",label:s("Popup Settings"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.popupWidth,view:"text",name:"popupWidth",placeholder:s("Set popup width"),label:s("Width:"),labelWidth:i.labelWidthLarge,validate:webix.rules.isNumber,on:{onChange:()=>{this.onChange()}}},{id:e.popupHeight,view:"text",name:"popupHeight",placeholder:s("Set popup height"),label:s("Height:"),labelWidth:i.labelWidthLarge,validate:webix.rules.isNumber,on:{onChange:()=>{this.onChange()}}}]}},{id:e.pageSettings,view:"fieldset",name:"pageSettings",label:s("Page Settings"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.defaultPage,view:"checkbox",name:"defaultPage",labelRight:s("Make this the default page"),labelWidth:i.labelWidthCheckbox,click:function(){t.onChange()}},{id:e.hideTitle,view:"checkbox",name:"hideTitle",labelRight:s("Hide the Page Title"),labelWidth:i.labelWidthCheckbox,click:function(){t.onChange()}},{id:e.hideTabs,view:"checkbox",name:"hideTabs",labelRight:s("Hide the Tabs on this page"),labelWidth:i.labelWidthCheckbox,click:function(){t.onChange()}},{id:e.fixedPageWidth,view:"checkbox",name:"fixedPageWidth",labelRight:s("Page has fixed width"),labelWidth:i.labelWidthCheckbox,click:function(){1==this.getValue()?$$(e.pageWidth).show():$$(e.pageWidth).hide(),t.onChange()}},{id:e.pageWidth,view:"text",name:"pageWidth",placeholder:s("Set page width"),label:s("Page width:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.pageBackground,view:"richselect",name:"pageBackground",label:s("Page background:"),labelWidth:i.labelWidthXLarge,options:[{id:"ab-background-default",value:s("White (default)")},{id:"ab-background-gray",value:s("Dark")}],on:{onChange:()=>{this.onChange()}}}]}}])}populate(e){super.populate(e);let t=this.ids,i=this.defaultValues();Object.keys(i).forEach((n=>{"defaultPage"!=n&&$$(t[n]).setValue(e.settings[n]||i[n])})),$$(t.defaultPage).setValue(e.defaultPage||0),e.isRoot()?$$(t.type).hide():$$(t.type).show(),"popup"==e.settings.type?($$(t.popupSettings).show(),$$(t.pageSettings).hide()):($$(t.popupSettings).hide(),$$(t.pageSettings).show()),1==e.settings.fixedPageWidth?$$(t.pageWidth).show():$$(t.pageWidth).hide()}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){let e=this.ids,t=super.values();return t.settings=$$(e.component).getValues(),t.defaultPage=parseInt($$(e.defaultPage).getValue()||0),delete t.settings.defaultPage,t}}}},9018:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(2418),s=null;function o(e){if(!s){const t=(0,n.Z)(e);s=class extends t{constructor(e="properties_abmobileview",t={}){super(e,t)}defaults(){var e=this.ViewClass();return e?e.common():(console.error("!!! properties/views/ABView: could not find ViewClass"),null)}}}return s}},5662:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>nm});var n=i(9018);let s=[],o=[];function a(e){if(e<768)return!1;for(let t=0,i=s.length;;){let n=t+i>>1;if(e<s[n])i=n;else{if(!(e>=o[n]))return!0;t=n+1}if(t==i)return!1}}function r(e){return e>=127462&&e<=127487}function l(e,t,i=!0,n=!0){return(i?c:h)(e,t,n)}function c(e,t,i){if(t==e.length)return t;t&&u(e.charCodeAt(t))&&p(e.charCodeAt(t-1))&&t--;let n=d(e,t);for(t+=f(n);t<e.length;){let s=d(e,t);if(8205==n||8205==s||i&&a(s))t+=f(s),n=s;else{if(!r(s))break;{let i=0,n=t-2;for(;n>=0&&r(d(e,n));)i++,n-=2;if(i%2==0)break;t+=2}}}return t}function h(e,t,i){for(;t>0;){let n=c(e,t-2,i);if(n<t)return n;t--}return 0}function d(e,t){let i=e.charCodeAt(t);if(!p(i)||t+1==e.length)return i;let n=e.charCodeAt(t+1);return u(n)?n-56320+(i-55296<<10)+65536:i}function u(e){return e>=56320&&e<57344}function p(e){return e>=55296&&e<56320}function f(e){return e<65536?1:2}(()=>{let e="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((e=>e?parseInt(e,36):1));for(let t=0,i=0;t<e.length;t++)(t%2?o:s).push(i+=e[t])})();class m{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=C(this,e,t);let n=[];return this.decompose(0,e,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(t,this.length,n,1),b.from(n,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=C(this,e,t);let i=[];return this.decompose(e,t,i,0),b.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),n=new y(this),s=new y(e);for(let e=t,o=t;;){if(n.next(e),s.next(e),e=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(o+=n.value.length,n.done||o>=i)return!0}}iter(e=1){return new y(this,e)}iterRange(e,t=this.length){return new O(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let n=this.line(e).from;i=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new x(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new g(e):b.from(g.split(e,[])):m.empty}}class g extends m{constructor(e,t=function(e){let t=-1;for(let i of e)t+=i.length+1;return t}(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,n){for(let s=0;;s++){let o=this.text[s],a=n+o.length;if((t?i:a)>=e)return new $(n,a,i,o);n=a+1,i++}}decompose(e,t,i,n){let s=e<=0&&t>=this.length?this:new g(w(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&n){let e=i.pop(),t=v(s.text,e.text.slice(),0,s.length);if(t.length<=32)i.push(new g(t,e.length+s.length));else{let e=t.length>>1;i.push(new g(t.slice(0,e)),new g(t.slice(e)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof g))return super.replace(e,t,i);[e,t]=C(this,e,t);let n=v(this.text,v(i.text,w(this.text,0,e)),t),s=this.length+i.length-(t-e);return n.length<=32?new g(n,s):b.from(g.split(n,[]),s)}sliceString(e,t=this.length,i="\n"){[e,t]=C(this,e,t);let n="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let a=this.text[o],r=s+a.length;s>e&&o&&(n+=i),e<r&&t>s&&(n+=a.slice(Math.max(0,e-s),t-s)),s=r+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],n=-1;for(let s of e)i.push(s),n+=s.length+1,32==i.length&&(t.push(new g(i,n)),i=[],n=-1);return n>-1&&t.push(new g(i,n)),t}}class b extends m{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let t of e)this.lines+=t.lines}lineInner(e,t,i,n){for(let s=0;;s++){let o=this.children[s],a=n+o.length,r=i+o.lines-1;if((t?r:a)>=e)return o.lineInner(e,t,i,n);n=a+1,i=r+1}}decompose(e,t,i,n){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let a=this.children[s],r=o+a.length;if(e<=r&&t>=o){let s=n&((o<=e?1:0)|(r>=t?2:0));o>=e&&r<=t&&!s?i.push(a):a.decompose(e-o,t-o,i,s)}o=r+1}}replace(e,t,i){if([e,t]=C(this,e,t),i.lines<this.lines)for(let n=0,s=0;n<this.children.length;n++){let o=this.children[n],a=s+o.length;if(e>=s&&t<=a){let r=o.replace(e-s,t-s,i),l=this.lines-o.lines+r.lines;if(r.lines<l>>4&&r.lines>l>>6){let s=this.children.slice();return s[n]=r,new b(s,this.length-(t-e)+i.length)}return super.replace(s,a,r)}s=a+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i="\n"){[e,t]=C(this,e,t);let n="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let a=this.children[s],r=o+a.length;o>e&&s&&(n+=i),e<r&&t>o&&(n+=a.sliceString(e-o,t-o,i)),o=r+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof b))return 0;let i=0,[n,s,o,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,s+=t){if(n==o||s==a)return i;let r=this.children[n],l=e.children[s];if(r!=l)return i+r.scanIdentical(l,t);i+=r.length+1}}static from(e,t=e.reduce(((e,t)=>e+t.length+1),-1)){let i=0;for(let t of e)i+=t.lines;if(i<32){let i=[];for(let t of e)t.flatten(i);return new g(i,t)}let n=Math.max(32,i>>5),s=n<<1,o=n>>1,a=[],r=0,l=-1,c=[];function h(e){let t;if(e.lines>s&&e instanceof b)for(let t of e.children)h(t);else e.lines>o&&(r>o||!r)?(d(),a.push(e)):e instanceof g&&r&&(t=c[c.length-1])instanceof g&&e.lines+t.lines<=32?(r+=e.lines,l+=e.length+1,c[c.length-1]=new g(t.text.concat(e.text),t.length+1+e.length)):(r+e.lines>n&&d(),r+=e.lines,l+=e.length+1,c.push(e))}function d(){0!=r&&(a.push(1==c.length?c[0]:b.from(c,l)),l=-1,r=c.length=0)}for(let t of e)h(t);return d(),1==a.length?a[0]:new b(a,t)}}function v(e,t,i=0,n=1e9){for(let s=0,o=0,a=!0;o<e.length&&s<=n;o++){let r=e[o],l=s+r.length;l>=i&&(l>n&&(r=r.slice(0,n-s)),s<i&&(r=r.slice(i-s)),a?(t[t.length-1]+=r,a=!1):t.push(r)),s=l+1}return t}function w(e,t,i){return v(e,[""],t,i)}m.empty=new g([""],0);class y{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof g?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],s=this.offsets[i],o=s>>1,a=n instanceof g?n.text.length:n.children.length;if(o==(t>0?a:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&s)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(n instanceof g){let s=n.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,s.length>Math.max(0,e))return this.value=0==e?s:t>0?s.slice(e):s.slice(0,s.length-e),this;e-=s.length}else{let s=n.children[o+(t<0?-1:0)];e>s.length?(e-=s.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(s),this.offsets.push(t>0?1:(s instanceof g?s.text.length:s.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class O{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new y(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=i?n:t<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class x{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:n}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(m.prototype[Symbol.iterator]=function(){return this.iter()},y.prototype[Symbol.iterator]=O.prototype[Symbol.iterator]=x.prototype[Symbol.iterator]=function(){return this});class ${constructor(e,t,i,n){this.from=e,this.to=t,this.number=i,this.text=n}get length(){return this.to-this.from}}function C(e,t,i){return[t=Math.max(0,Math.min(e.length,t)),Math.max(t,Math.min(e.length,i))]}function S(e,t,i=!0,n=!0){return l(e,t,i,n)}function _(e,t){let i=e.charCodeAt(t);if(!((n=i)>=55296&&n<56320&&t+1!=e.length))return i;var n;let s=e.charCodeAt(t+1);return function(e){return e>=56320&&e<57344}(s)?s-56320+(i-55296<<10)+65536:i}function k(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function E(e){return e<65536?1:2}const P=/\r\n?|\n/;var A=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(A||(A={}));class R{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,n=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,n,s),n+=s):n+=o,i+=s}}iterChangedRanges(e,t=!1){T(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];n<0?e.push(i,n):e.push(n,i)}return new R(e)}composeDesc(e){return this.empty?e:e.empty?this:F(this,e)}mapDesc(e,t=!1){return e.empty?this:B(this,e,t)}mapPos(e,t=-1,i=A.Simple){let n=0,s=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],r=this.sections[o++],l=n+a;if(r<0){if(l>e)return s+(e-n);s+=a}else{if(i!=A.Simple&&l>=e&&(i==A.TrackDel&&n<e&&l>e||i==A.TrackBefore&&n<e||i==A.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!a)return e==n||t<0?s:s+r;s+=r}n=l}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return s}touchesRange(e,t=e){for(let i=0,n=0;i<this.sections.length&&n<=t;){let s=n+this.sections[i++];if(this.sections[i++]>=0&&n<=t&&s>=e)return!(n<e&&s>t)||"cover";n=s}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+i+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some((e=>"number"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new R(e)}static create(e){return new R(e)}}class D extends R{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return T(this,((t,i,n,s,o)=>e=e.replace(n,n+(i-t),o)),!1),e}mapDesc(e,t=!1){return B(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let n=0,s=0;n<t.length;n+=2){let o=t[n],a=t[n+1];if(a>=0){t[n]=a,t[n+1]=o;let r=n>>1;for(;i.length<r;)i.push(m.empty);i.push(o?e.slice(s,s+o):m.empty)}s+=o}return new D(t,i)}compose(e){return this.empty?e:e.empty?this:F(this,e,!0)}map(e,t=!1){return e.empty?this:B(this,e,t,!0)}iterChanges(e,t=!1){T(this,e,t)}get desc(){return R.create(this.sections)}filter(e){let t=[],i=[],n=[],s=new I(this);e:for(let o=0,a=0;;){let r=o==e.length?1e9:e[o++];for(;a<r||a==r&&0==s.len;){if(s.done)break e;let e=Math.min(s.len,r-a);V(n,e,-1);let o=-1==s.ins?-1:0==s.off?s.ins:0;V(t,e,o),o>0&&L(i,t,s.text),s.forward(e),a+=e}let l=e[o++];for(;a<l;){if(s.done)break e;let e=Math.min(s.len,l-a);V(t,e,-1),V(n,e,-1==s.ins?-1:0==s.off?s.ins:0),s.forward(e),a+=e}}return{changes:new D(t,i),filtered:R.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],n=this.sections[t+1];n<0?e.push(i):0==n?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let n=[],s=[],o=0,a=null;function r(e=!1){if(!e&&!n.length)return;o<t&&V(n,t-o,-1);let i=new D(n,s);a=a?a.compose(i.map(a)):i,n=[],s=[],o=0}return function e(l){if(Array.isArray(l))for(let t of l)e(t);else if(l instanceof D){if(l.length!=t)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${t})`);r(),a=a?a.compose(l.map(a)):l}else{let{from:e,to:a=e,insert:c}=l;if(e>a||e<0||a>t)throw new RangeError(`Invalid change range ${e} to ${a} (in doc of length ${t})`);let h=c?"string"==typeof c?m.of(c.split(i||P)):c:m.empty,d=h.length;if(e==a&&0==d)return;e<o&&r(),e>o&&V(n,e-o,-1),V(n,a-e,d),L(s,n,h),o=a}}(e),r(!a),a}static empty(e){return new D(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let n=0;n<e.length;n++){let s=e[n];if("number"==typeof s)t.push(s,-1);else{if(!Array.isArray(s)||"number"!=typeof s[0]||s.some(((e,t)=>t&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==s.length)t.push(s[0],0);else{for(;i.length<n;)i.push(m.empty);i[n]=m.of(s.slice(1)),t.push(s[0],i[n].length)}}}return new D(t,i)}static createSet(e,t){return new D(e,t)}}function V(e,t,i,n=!1){if(0==t&&i<=0)return;let s=e.length-2;s>=0&&i<=0&&i==e[s+1]?e[s]+=t:s>=0&&0==t&&0==e[s]?e[s+1]+=i:n?(e[s]+=t,e[s+1]+=i):e.push(t,i)}function L(e,t,i){if(0==i.length)return;let n=t.length-2>>1;if(n<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<n;)e.push(m.empty);e.push(i)}}function T(e,t,i){let n=e.inserted;for(let s=0,o=0,a=0;a<e.sections.length;){let r=e.sections[a++],l=e.sections[a++];if(l<0)s+=r,o+=r;else{let c=s,h=o,d=m.empty;for(;c+=r,h+=l,l&&n&&(d=d.append(n[a-2>>1])),!(i||a==e.sections.length||e.sections[a+1]<0);)r=e.sections[a++],l=e.sections[a++];t(s,c,o,h,d),s=c,o=h}}}function B(e,t,i,n=!1){let s=[],o=n?[]:null,a=new I(e),r=new I(t);for(let e=-1;;){if(a.done&&r.len||r.done&&a.len)throw new Error("Mismatched change set lengths");if(-1==a.ins&&-1==r.ins){let e=Math.min(a.len,r.len);V(s,e,-1),a.forward(e),r.forward(e)}else if(r.ins>=0&&(a.ins<0||e==a.i||0==a.off&&(r.len<a.len||r.len==a.len&&!i))){let t=r.len;for(V(s,r.ins,-1);t;){let i=Math.min(a.len,t);a.ins>=0&&e<a.i&&a.len<=i&&(V(s,0,a.ins),o&&L(o,s,a.text),e=a.i),a.forward(i),t-=i}r.next()}else{if(!(a.ins>=0)){if(a.done&&r.done)return o?D.createSet(s,o):R.create(s);throw new Error("Mismatched change set lengths")}{let t=0,i=a.len;for(;i;)if(-1==r.ins){let e=Math.min(i,r.len);t+=e,i-=e,r.forward(e)}else{if(!(0==r.ins&&r.len<i))break;i-=r.len,r.next()}V(s,t,e<a.i?a.ins:0),o&&e<a.i&&L(o,s,a.text),e=a.i,a.forward(a.len-i)}}}}function F(e,t,i=!1){let n=[],s=i?[]:null,o=new I(e),a=new I(t);for(let e=!1;;){if(o.done&&a.done)return s?D.createSet(n,s):R.create(n);if(0==o.ins)V(n,o.len,0,e),o.next();else if(0!=a.len||a.done){if(o.done||a.done)throw new Error("Mismatched change set lengths");{let t=Math.min(o.len2,a.len),i=n.length;if(-1==o.ins){let i=-1==a.ins?-1:a.off?0:a.ins;V(n,t,i,e),s&&i&&L(s,n,a.text)}else-1==a.ins?(V(n,o.off?0:o.len,t,e),s&&L(s,n,o.textBit(t))):(V(n,o.off?0:o.len,a.off?0:a.ins,e),s&&!a.off&&L(s,n,a.text));e=(o.ins>t||a.ins>=0&&a.len>t)&&(e||n.length>i),o.forward2(t),a.forward(t)}}else V(n,0,a.ins,e),s&&L(s,n,a.text),a.next()}}class I{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?m.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?m.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class j{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let e=7&this.flags;return 7==e?null:e}get goalColumn(){let e=this.flags>>6;return 16777215==e?void 0:e}map(e,t=-1){let i,n;return this.empty?i=n=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new j(i,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return M.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return M.range(this.anchor,i)}eq(e,t=!1){return!(this.anchor!=e.anchor||this.head!=e.head||t&&this.empty&&this.assoc!=e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return M.range(e.anchor,e.head)}static create(e,t,i){return new j(e,t,i)}}class M{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:M.create(this.ranges.map((i=>i.map(e,t))),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new M([this.main],0)}addRange(e,t=!0){return M.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,M.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((e=>e.toJSON())),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new M(e.ranges.map((e=>j.fromJSON(e))),e.main)}static single(e,t=e){return new M([M.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<e.length;n++){let s=e[n];if(s.empty?s.from<=i:s.from<i)return M.normalized(e.slice(),t);i=s.to}return new M(e,t)}static cursor(e,t=0,i,n){return j.create(e,e,(0==t?0:t<0?8:16)|(null==i?7:Math.min(6,i))|(null!=n?n:16777215)<<6)}static range(e,t,i,n){let s=(null!=i?i:16777215)<<6|(null==n?7:Math.min(6,n));return t<e?j.create(t,e,48|s):j.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let i=e[t];e.sort(((e,t)=>e.from-t.from)),t=e.indexOf(i);for(let i=1;i<e.length;i++){let n=e[i],s=e[i-1];if(n.empty?n.from<=s.to:n.from<s.to){let o=s.from,a=Math.max(n.to,s.to);i<=t&&t--,e.splice(--i,2,n.anchor>n.head?M.range(a,o):M.range(o,a))}}return new M(e,t)}}function Q(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let W=0;class N{constructor(e,t,i,n,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=n,this.id=W++,this.default=e([]),this.extensions="function"==typeof s?s(this):s}get reader(){return this}static define(e={}){return new N(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:Z),!!e.static,e.enables)}of(e){return new q([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new q(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new q(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],(i=>t(i.field(e))))}}function Z(e,t){return e==t||e.length==t.length&&e.every(((e,i)=>e===t[i]))}class q{constructor(e,t,i,n){this.dependencies=e,this.facet=t,this.type=i,this.value=n,this.id=W++}dynamicSlot(e){var t;let i=this.value,n=this.facet.compareInput,s=this.id,o=e[s]>>1,a=2==this.type,r=!1,l=!1,c=[];for(let i of this.dependencies)"doc"==i?r=!0:"selection"==i?l=!0:0==(1&(null!==(t=e[i.id])&&void 0!==t?t:1))&&c.push(e[i.id]);return{create:e=>(e.values[o]=i(e),1),update(e,t){if(r&&t.docChanged||l&&(t.docChanged||t.selection)||U(e,c)){let t=i(e);if(a?!z(t,e.values[o],n):!n(t,e.values[o]))return e.values[o]=t,1}return 0},reconfigure:(e,t)=>{let r,l=t.config.address[s];if(null!=l){let s=se(t,l);if(this.dependencies.every((i=>i instanceof N?t.facet(i)===e.facet(i):!(i instanceof Y)||t.field(i,!1)==e.field(i,!1)))||(a?z(r=i(e),s,n):n(r=i(e),s)))return e.values[o]=s,0}else r=i(e);return e.values[o]=r,1}}}}function z(e,t,i){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1;return!0}function U(e,t){let i=!1;for(let n of t)1&ne(e,n)&&(i=!0);return i}function X(e,t,i){let n=i.map((t=>e[t.id])),s=i.map((e=>e.type)),o=n.filter((e=>!(1&e))),a=e[t.id]>>1;function r(e){let i=[];for(let t=0;t<n.length;t++){let o=se(e,n[t]);if(2==s[t])for(let e of o)i.push(e);else i.push(o)}return t.combine(i)}return{create(e){for(let t of n)ne(e,t);return e.values[a]=r(e),1},update(e,i){if(!U(e,o))return 0;let n=r(e);return t.compare(n,e.values[a])?0:(e.values[a]=n,1)},reconfigure(e,s){let o=U(e,n),l=s.config.facets[t.id],c=s.facet(t);if(l&&!o&&Z(i,l))return e.values[a]=c,0;let h=r(e);return t.compare(h,c)?(e.values[a]=c,0):(e.values[a]=h,1)}}}const G=N.define({static:!0});class Y{constructor(e,t,i,n,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=n,this.spec=s,this.provides=void 0}static define(e){let t=new Y(W++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(G).find((e=>e.field==this));return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let n=e.values[t],s=this.updateF(n,i);return this.compareF(n,s)?0:(e.values[t]=s,1)},reconfigure:(e,i)=>{let n,s=e.facet(G),o=i.facet(G);return(n=s.find((e=>e.field==this)))&&n!=o.find((e=>e.field==this))?(e.values[t]=n.create(e),1):null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}}init(e){return[this,G.of({field:this,create:e})]}get extension(){return this}}function H(e){return t=>new J(t,e)}const K={highest:H(0),high:H(1),default:H(2),low:H(3),lowest:H(4)};class J{constructor(e,t){this.inner=e,this.prec=t}}class ee{of(e){return new te(this,e)}reconfigure(e){return ee.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class te{constructor(e,t){this.compartment=e,this.inner=t}}class ie{constructor(e,t,i,n,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=n,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let n=[],s=Object.create(null),o=new Map;for(let i of function(e,t,i){let n=[[],[],[],[],[]],s=new Map;return function e(o,a){let r=s.get(o);if(null!=r){if(r<=a)return;let e=n[r].indexOf(o);e>-1&&n[r].splice(e,1),o instanceof te&&i.delete(o.compartment)}if(s.set(o,a),Array.isArray(o))for(let t of o)e(t,a);else if(o instanceof te){if(i.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let n=t.get(o.compartment)||o.inner;i.set(o.compartment,n),e(n,a)}else if(o instanceof J)e(o.inner,o.prec);else if(o instanceof Y)n[a].push(o),o.provides&&e(o.provides,a);else if(o instanceof q)n[a].push(o),o.facet.extensions&&e(o.facet.extensions,2);else{let t=o.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);e(t,a)}}(e,2),n.reduce(((e,t)=>e.concat(t)))}(e,t,o))i instanceof Y?n.push(i):(s[i.facet.id]||(s[i.facet.id]=[])).push(i);let a=Object.create(null),r=[],l=[];for(let e of n)a[e.id]=l.length<<1,l.push((t=>e.slot(t)));let c=null==i?void 0:i.config.facets;for(let e in s){let t=s[e],n=t[0].facet,o=c&&c[e]||[];if(t.every((e=>0==e.type)))if(a[n.id]=r.length<<1|1,Z(o,t))r.push(i.facet(n));else{let e=n.combine(t.map((e=>e.value)));r.push(i&&n.compare(e,i.facet(n))?i.facet(n):e)}else{for(let e of t)0==e.type?(a[e.id]=r.length<<1|1,r.push(e.value)):(a[e.id]=l.length<<1,l.push((t=>e.dynamicSlot(t))));a[n.id]=l.length<<1,l.push((e=>X(e,n,t)))}}let h=l.map((e=>e(a)));return new ie(e,o,h,a,r,s)}}function ne(e,t){if(1&t)return 2;let i=t>>1,n=e.status[i];if(4==n)throw new Error("Cyclic dependency between fields and/or facets");if(2&n)return n;e.status[i]=4;let s=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|s}function se(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const oe=N.define(),ae=N.define({combine:e=>e.some((e=>e)),static:!0}),re=N.define({combine:e=>e.length?e[0]:void 0,static:!0}),le=N.define(),ce=N.define(),he=N.define(),de=N.define({combine:e=>!!e.length&&e[0]});class ue{constructor(e,t){this.type=e,this.value=t}static define(){return new pe}}class pe{of(e){return new ue(this,e)}}class fe{constructor(e){this.map=e}of(e){return new me(this,e)}}class me{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new me(this.type,t)}is(e){return this.type==e}static define(e={}){return new fe(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let n of e){let e=n.map(t);e&&i.push(e)}return i}}me.reconfigure=me.define(),me.appendConfig=me.define();class ge{constructor(e,t,i,n,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=n,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Q(i,t.newLength),s.some((e=>e.type==ge.time))||(this.annotations=s.concat(ge.time.of(Date.now())))}static create(e,t,i,n,s,o){return new ge(e,t,i,n,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(ge.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function be(e,t){let i=[];for(let n=0,s=0;;){let o,a;if(n<e.length&&(s==t.length||t[s]>=e[n]))o=e[n++],a=e[n++];else{if(!(s<t.length))return i;o=t[s++],a=t[s++]}!i.length||i[i.length-1]<o?i.push(o,a):i[i.length-1]<a&&(i[i.length-1]=a)}}function ve(e,t,i){var n;let s,o,a;return i?(s=t.changes,o=D.empty(t.changes.length),a=e.changes.compose(t.changes)):(s=t.changes.map(e.changes),o=e.changes.mapDesc(t.changes,!0),a=e.changes.compose(s)),{changes:a,selection:t.selection?t.selection.map(o):null===(n=e.selection)||void 0===n?void 0:n.map(s),effects:me.mapEffects(e.effects,s).concat(me.mapEffects(t.effects,o)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function we(e,t,i){let n=t.selection,s=xe(t.annotations);return t.userEvent&&(s=s.concat(ge.userEvent.of(t.userEvent))),{changes:t.changes instanceof D?t.changes:D.of(t.changes||[],i,e.facet(re)),selection:n&&(n instanceof M?n:M.single(n.anchor,n.head)),effects:xe(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function ye(e,t,i){let n=we(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let s=1;s<t.length;s++){!1===t[s].filter&&(i=!1);let o=!!t[s].sequential;n=ve(n,we(e,t[s],o?n.changes.newLength:e.doc.length),o)}let s=ge.create(e,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return function(e){let t=e.startState,i=t.facet(he),n=e;for(let s=i.length-1;s>=0;s--){let o=i[s](e);o&&Object.keys(o).length&&(n=ve(n,we(t,o,e.changes.newLength),!0))}return n==e?e:ge.create(t,e.changes,e.selection,n.effects,n.annotations,n.scrollIntoView)}(i?function(e){let t=e.startState,i=!0;for(let n of t.facet(le)){let t=n(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:be(i,t))}if(!0!==i){let n,s;if(!1===i)s=e.changes.invertedDesc,n=D.empty(t.doc.length);else{let t=e.changes.filter(i);n=t.changes,s=t.filtered.mapDesc(t.changes).invertedDesc}e=ge.create(t,n,e.selection&&e.selection.map(s),me.mapEffects(e.effects,s),e.annotations,e.scrollIntoView)}let n=t.facet(ce);for(let i=n.length-1;i>=0;i--){let s=n[i](e);e=s instanceof ge?s:Array.isArray(s)&&1==s.length&&s[0]instanceof ge?s[0]:ye(t,xe(s),!1)}return e}(s):s)}ge.time=ue.define(),ge.userEvent=ue.define(),ge.addToHistory=ue.define(),ge.remote=ue.define();const Oe=[];function xe(e){return null==e?Oe:Array.isArray(e)?e:[e]}var $e=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}($e||($e={}));const Ce=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Se;try{Se=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(e){}class _e{constructor(e,t,i,n,s,o){this.config=e,this.doc=t,this.selection=i,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let e=0;e<this.config.dynamicSlots.length;e++)ne(this,e<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return ne(this,i),se(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return ye(this,e,!0)}applyTransaction(e){let t,i=this.config,{base:n,compartments:s}=i;for(let t of e.effects)t.is(ee.reconfigure)?(i&&(s=new Map,i.compartments.forEach(((e,t)=>s.set(t,e))),i=null),s.set(t.value.compartment,t.value.extension)):t.is(me.reconfigure)?(i=null,n=t.value):t.is(me.appendConfig)&&(i=null,n=xe(n).concat(t.value));i?t=e.startState.values.slice():(i=ie.resolve(n,s,this),t=new _e(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((e,t)=>t.reconfigure(e,this)),null).values);let o=e.startState.facet(ae)?e.newSelection:e.newSelection.asSingle();new _e(i,e.newDoc,o,t,((t,i)=>i.update(t,e)),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:e},range:M.cursor(t.from+e.length)})))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),n=this.changes(i.changes),s=[i.range],o=xe(i.effects);for(let i=1;i<t.ranges.length;i++){let a=e(t.ranges[i]),r=this.changes(a.changes),l=r.map(n);for(let e=0;e<i;e++)s[e]=s[e].map(l);let c=n.mapDesc(r,!0);s.push(a.range.map(c)),n=n.compose(l),o=me.mapEffects(o,l).concat(me.mapEffects(xe(a.effects),c))}return{changes:n,selection:M.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof D?e:D.of(e,this.doc.length,this.facet(_e.lineSeparator))}toText(e){return m.of(e.split(this.facet(_e.lineSeparator)||P))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(ne(this,t),se(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let n=e[i];n instanceof Y&&null!=this.config.address[n.id]&&(t[i]=n.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let t in i)if(Object.prototype.hasOwnProperty.call(e,t)){let s=i[t],o=e[t];n.push(s.init((e=>s.spec.fromJSON(o,e))))}return _e.create({doc:e.doc,selection:M.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=ie.resolve(e.extensions||[],new Map),i=e.doc instanceof m?e.doc:m.of((e.doc||"").split(t.staticFacet(_e.lineSeparator)||P)),n=e.selection?e.selection instanceof M?e.selection:M.single(e.selection.anchor,e.selection.head):M.single(0);return Q(n,i.length),t.staticFacet(ae)||(n=n.asSingle()),new _e(t,i,n,t.dynamicSlots.map((()=>null)),((e,t)=>t.create(e)),null)}get tabSize(){return this.facet(_e.tabSize)}get lineBreak(){return this.facet(_e.lineSeparator)||"\n"}get readOnly(){return this.facet(de)}phrase(e,...t){for(let t of this.facet(_e.phrases))if(Object.prototype.hasOwnProperty.call(t,e)){e=t[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,((e,i)=>{if("$"==i)return"$";let n=+(i||1);return!n||n>t.length?e:t[n-1]}))),e}languageDataAt(e,t,i=-1){let n=[];for(let s of this.facet(oe))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&n.push(o[e]);return n}charCategorizer(e){return t=this.languageDataAt("wordChars",e).join(""),e=>{if(!/\S/.test(e))return $e.Space;if(function(e){if(Se)return Se.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||Ce.test(i)))return!0}return!1}(e))return $e.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return $e.Word;return $e.Other};var t}wordAt(e){let{text:t,from:i,length:n}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,a=e-i;for(;o>0;){let e=S(t,o,!1);if(s(t.slice(e,o))!=$e.Word)break;o=e}for(;a<n;){let e=S(t,a);if(s(t.slice(a,e))!=$e.Word)break;a=e}return o==a?null:M.range(o+i,a+i)}}function ke(e,t,i={}){let n={};for(let t of e)for(let e of Object.keys(t)){let s=t[e],o=n[e];if(void 0===o)n[e]=s;else if(o===s||void 0===s);else{if(!Object.hasOwnProperty.call(i,e))throw new Error("Config merge conflict for field "+e);n[e]=i[e](o,s)}}for(let e in t)void 0===n[e]&&(n[e]=t[e]);return n}_e.allowMultipleSelections=ae,_e.tabSize=N.define({combine:e=>e.length?e[0]:4}),_e.lineSeparator=re,_e.readOnly=de,_e.phrases=N.define({compare(e,t){let i=Object.keys(e),n=Object.keys(t);return i.length==n.length&&i.every((i=>e[i]==t[i]))}}),_e.languageData=oe,_e.changeFilter=le,_e.transactionFilter=ce,_e.transactionExtender=he,ee.reconfigure=me.define();class Ee{eq(e){return this==e}range(e,t=e){return Pe.create(e,t,this)}}Ee.prototype.startSide=Ee.prototype.endSide=0,Ee.prototype.point=!1,Ee.prototype.mapMode=A.TrackDel;class Pe{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Pe(e,t,i)}}function Ae(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Re{constructor(e,t,i,n){this.from=e,this.to=t,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,n=0){let s=i?this.to:this.from;for(let o=n,a=s.length;;){if(o==a)return o;let n=o+a>>1,r=s[n]-e||(i?this.value[n].endSide:this.value[n].startSide)-t;if(n==o)return r>=0?o:a;r>=0?a=n:o=n+1}}between(e,t,i,n){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,s);s<o;s++)if(!1===n(this.from[s]+e,this.to[s]+e,this.value[s]))return!1}map(e,t){let i=[],n=[],s=[],o=-1,a=-1;for(let r=0;r<this.value.length;r++){let l,c,h=this.value[r],d=this.from[r]+e,u=this.to[r]+e;if(d==u){let e=t.mapPos(d,h.startSide,h.mapMode);if(null==e)continue;if(l=c=e,h.startSide!=h.endSide&&(c=t.mapPos(d,h.endSide),c<l))continue}else if(l=t.mapPos(d,h.startSide),c=t.mapPos(u,h.endSide),l>c||l==c&&h.startSide>0&&h.endSide<=0)continue;(c-l||h.endSide-h.startSide)<0||(o<0&&(o=l),h.point&&(a=Math.max(a,c-l)),i.push(h),n.push(l-o),s.push(c-o))}return{mapped:i.length?new Re(n,s,i,a):null,pos:o}}}class De{constructor(e,t,i,n){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=n}static create(e,t,i,n){return new De(e,t,i,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:n=0,filterTo:s=this.length}=e,o=e.filter;if(0==t.length&&!o)return this;if(i&&(t=t.slice().sort(Ae)),this.isEmpty)return t.length?De.of(t):this;let a=new Te(this,null,-1).goto(0),r=0,l=[],c=new Ve;for(;a.value||r<t.length;)if(r<t.length&&(a.from-t[r].from||a.startSide-t[r].value.startSide)>=0){let e=t[r++];c.addInner(e.from,e.to,e.value)||l.push(e)}else 1==a.rangeIndex&&a.chunkIndex<this.chunk.length&&(r==t.length||this.chunkEnd(a.chunkIndex)<t[r].from)&&(!o||n>this.chunkEnd(a.chunkIndex)||s<this.chunkPos[a.chunkIndex])&&c.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||n>a.to||s<a.from||o(a.from,a.to,a.value))&&(c.addInner(a.from,a.to,a.value)||l.push(Pe.create(a.from,a.to,a.value))),a.next());return c.finishInner(this.nextLayer.isEmpty&&!l.length?De.empty:this.nextLayer.update({add:l,filter:o,filterFrom:n,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],n=-1;for(let s=0;s<this.chunk.length;s++){let o=this.chunkPos[s],a=this.chunk[s],r=e.touchesRange(o,o+a.length);if(!1===r)n=Math.max(n,a.maxPoint),t.push(a),i.push(e.mapPos(o));else if(!0===r){let{mapped:s,pos:r}=a.map(o,e);s&&(n=Math.max(n,s.maxPoint),t.push(s),i.push(r))}}let s=this.nextLayer.map(e);return 0==t.length?s:new De(i,t,s||De.empty,n)}between(e,t,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let s=this.chunkPos[n],o=this.chunk[n];if(t>=s&&e<=s+o.length&&!1===o.between(s,e-s,t-s,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return Be.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Be.from(e).goto(t)}static compare(e,t,i,n,s=-1){let o=e.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=s)),a=t.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=s)),r=Le(o,a,i),l=new Ie(o,r,s),c=new Ie(a,r,s);i.iterGaps(((e,t,i)=>je(l,e,c,t,i,n))),i.empty&&0==i.length&&je(l,0,c,0,0,n)}static eq(e,t,i=0,n){null==n&&(n=999999999);let s=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0)),o=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0));if(s.length!=o.length)return!1;if(!s.length)return!0;let a=Le(s,o),r=new Ie(s,a,0).goto(i),l=new Ie(o,a,0).goto(i);for(;;){if(r.to!=l.to||!Me(r.active,l.active)||r.point&&(!l.point||!r.point.eq(l.point)))return!1;if(r.to>n)return!0;r.next(),l.next()}}static spans(e,t,i,n,s=-1){let o=new Ie(e,null,s).goto(t),a=t,r=o.openStart;for(;;){let e=Math.min(o.to,i);if(o.point){let i=o.activeForPoint(o.to),s=o.pointFrom<t?i.length+1:o.point.startSide<0?i.length:Math.min(i.length,r);n.point(a,e,o.point,i,s,o.pointRank),r=Math.min(o.openEnd(e),i.length)}else e>a&&(n.span(a,e,o.active,r),r=o.openEnd(e));if(o.to>i)return r+(o.point&&o.to>i?1:0);a=o.to,o.next()}}static of(e,t=!1){let i=new Ve;for(let n of e instanceof Pe?[e]:t?function(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let n=e[i];if(Ae(t,n)>0)return e.slice().sort(Ae);t=n}return e}(e):e)i.add(n.from,n.to,n.value);return i.finish()}static join(e){if(!e.length)return De.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let n=e[i];n!=De.empty;n=n.nextLayer)t=new De(n.chunkPos,n.chunk,t,Math.max(n.maxPoint,t.maxPoint));return t}}De.empty=new De([],[],null,-1),De.empty.nextLayer=De.empty;class Ve{finishChunk(e){this.chunks.push(new Re(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Ve)).add(e,t,i)}addInner(e,t,i){let n=e-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(n<0||(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),0))}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(De.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=De.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Le(e,t,i){let n=new Map;for(let t of e)for(let e=0;e<t.chunk.length;e++)t.chunk[e].maxPoint<=0&&n.set(t.chunk[e],t.chunkPos[e]);let s=new Set;for(let e of t)for(let t=0;t<e.chunk.length;t++){let o=n.get(e.chunk[t]);null==o||(i?i.mapPos(o):o)!=e.chunkPos[t]||(null==i?void 0:i.touchesRange(o,o+e.chunk[t].length))||s.add(e.chunk[t])}return s}class Te{constructor(e,t,i,n=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Be{constructor(e){this.heap=e}static from(e,t=null,i=-1){let n=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new Te(o,t,i,s));return 1==n.length?n[0]:new Be(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let e=this.heap.length>>1;e>=0;e--)Fe(this.heap,e);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let e=this.heap.length>>1;e>=0;e--)Fe(this.heap,e);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Fe(this.heap,0)}}}function Fe(e,t){for(let i=e[t];;){let n=1+(t<<1);if(n>=e.length)break;let s=e[n];if(n+1<e.length&&s.compare(e[n+1])>=0&&(s=e[n+1],n++),i.compare(s)<0)break;e[n]=i,e[t]=s,t=n}}class Ie{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Be.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Qe(this.active,e),Qe(this.activeTo,e),Qe(this.activeRank,e),this.minActive=Ne(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:n,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||n-this.activeTo[t])>0;)t++;We(this.active,t,i),We(this.activeTo,t,n),We(this.activeRank,t,s),e&&We(e,t,this.cursor.from),this.minActive=Ne(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&Qe(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let e=this.cursor.value;if(e.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=e,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=e.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){this.openStart=0;for(let t=i.length-1;t>=0&&i[t]<e;t--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function je(e,t,i,n,s,o){e.goto(t),i.goto(n);let a=n+s,r=n,l=n-t;for(;;){let t=e.to+l-i.to,n=t||e.endSide-i.endSide,s=n<0?e.to+l:i.to,c=Math.min(s,a);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&Me(e.activeForPoint(e.to),i.activeForPoint(i.to))||o.comparePoint(r,c,e.point,i.point):c>r&&!Me(e.active,i.active)&&o.compareRange(r,c,e.active,i.active),s>a)break;(t||e.openEnd!=i.openEnd)&&o.boundChange&&o.boundChange(s),r=s,n<=0&&e.next(),n>=0&&i.next()}}function Me(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function Qe(e,t){for(let i=t,n=e.length-1;i<n;i++)e[i]=e[i+1];e.pop()}function We(e,t,i){for(let i=e.length-1;i>=t;i--)e[i+1]=e[i];e[t]=i}function Ne(e,t){let i=-1,n=1e9;for(let s=0;s<t.length;s++)(t[s]-n||e[s].endSide-e[i].endSide)<0&&(i=s,n=t[s]);return i}function Ze(e,t,i=e.length){let n=0;for(let s=0;s<i&&s<e.length;)9==e.charCodeAt(s)?(n+=t-n%t,s++):(n++,s=S(e,s));return n}function qe(e,t,i,n){for(let n=0,s=0;;){if(s>=t)return n;if(n==e.length)break;s+=9==e.charCodeAt(n)?i-s%i:1,n=S(e,n)}return!0===n?-1:e.length}const ze="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),Ue="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Ge{constructor(e,t){this.rules=[];let{finish:i}=t||{};function n(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function s(e,t,o,a){let r=[],l=/^@(\w+)\b/.exec(e[0]),c=l&&"keyframes"==l[1];if(l&&null==t)return o.push(e[0]+";");for(let i in t){let a=t[i];if(/&/.test(i))s(i.split(/,\s*/).map((t=>e.map((e=>t.replace(/&/,e))))).reduce(((e,t)=>e.concat(t))),a,o);else if(a&&"object"==typeof a){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");s(n(i),a,r,c)}else null!=a&&r.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))+": "+a+";")}(r.length||c)&&o.push((!i||l||a?e:e.map(i)).join(", ")+" {"+r.join(" ")+"}")}for(let t in e)s(n(t),e[t],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=Xe[ze]||1;return Xe[ze]=e+1,"ͼ"+e.toString(36)}static mount(e,t,i){let n=e[Ue],s=i&&i.nonce;n?s&&n.setNonce(s):n=new He(e,s),n.mount(Array.isArray(t)?t:[t],e)}}let Ye=new Map;class He{constructor(e,t){let i=e.ownerDocument||e,n=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let t=Ye.get(i);if(t)return e[Ue]=t;this.sheet=new n.CSSStyleSheet,Ye.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Ue]=this}mount(e,t){let i=this.sheet,n=0,s=0;for(let t=0;t<e.length;t++){let o=e[t],a=this.modules.indexOf(o);if(a<s&&a>-1&&(this.modules.splice(a,1),s--,a=-1),-1==a){if(this.modules.splice(s++,0,o),i)for(let e=0;e<o.rules.length;e++)i.insertRule(o.rules[e],n++)}else{for(;s<a;)n+=this.modules[s++].rules.length;n+=o.rules.length,s++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e;let i=t.head||t;this.styleTag.parentNode!=i&&i.insertBefore(this.styleTag,i.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}for(var Ke={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Je={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},et="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),tt="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),it=0;it<10;it++)Ke[48+it]=Ke[96+it]=String(it);for(it=1;it<=24;it++)Ke[it+111]="F"+it;for(it=65;it<=90;it++)Ke[it]=String.fromCharCode(it+32),Je[it]=String.fromCharCode(it);for(var nt in Ke)Je.hasOwnProperty(nt)||(Je[nt]=Ke[nt]);function st(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function ot(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function at(e,t){if(!t.anchorNode)return!1;try{return ot(e,t.anchorNode)}catch(e){return!1}}function rt(e){return 3==e.nodeType?yt(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function lt(e,t,i,n){return!!i&&(dt(e,t,i,n,-1)||dt(e,t,i,n,1))}function ct(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function ht(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}function dt(e,t,i,n,s){for(;;){if(e==i&&t==n)return!0;if(t==(s<0?0:ut(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=ct(e)+(s<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(s<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=s<0?ut(e):0}}}function ut(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function pt(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function ft(e){let t=e.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}function mt(e,t){let i=t.width/e.offsetWidth,n=t.height/e.offsetHeight;return(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.width-e.offsetWidth)<1)&&(i=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(t.height-e.offsetHeight)<1)&&(n=1),{scaleX:i,scaleY:n}}class gt{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?ut(t):0),i,Math.min(e.focusOffset,i?ut(i):0))}set(e,t,i,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=n}}let bt,vt=null;function wt(e){if(e.setActive)return e.setActive();if(vt)return e.focus(vt);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==vt?{get preventScroll(){return vt={preventScroll:!0},!0}}:void 0),!vt){vt=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],s=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function yt(e,t,i=t){let n=bt||(bt=document.createRange());return n.setEnd(e,i),n.setStart(e,t),n}function Ot(e,t,i,n){let s={key:t,code:t,keyCode:i,which:i,cancelable:!0};n&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=n);let o=new KeyboardEvent("keydown",s);o.synthetic=!0,e.dispatchEvent(o);let a=new KeyboardEvent("keyup",s);return a.synthetic=!0,e.dispatchEvent(a),o.defaultPrevented||a.defaultPrevented}function xt(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}function $t(e){return e.scrollTop>Math.max(1,e.scrollHeight-e.clientHeight-4)}function Ct(e,t){for(let i=e,n=t;;){if(3==i.nodeType&&n>0)return{node:i,offset:n};if(1==i.nodeType&&n>0){if("false"==i.contentEditable)return null;i=i.childNodes[n-1],n=ut(i)}else{if(!i.parentNode||ht(i))return null;n=ct(i),i=i.parentNode}}}function St(e,t){for(let i=e,n=t;;){if(3==i.nodeType&&n<i.nodeValue.length)return{node:i,offset:n};if(1==i.nodeType&&n<i.childNodes.length){if("false"==i.contentEditable)return null;i=i.childNodes[n],n=0}else{if(!i.parentNode||ht(i))return null;n=ct(i)+1,i=i.parentNode}}}class _t{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new _t(e.parentNode,ct(e),t)}static after(e,t){return new _t(e.parentNode,ct(e)+1,t)}}const kt=[];class Et{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(2&this.flags){let i,n=this.dom,s=null;for(let o of this.children){if(7&o.flags){if(!o.dom&&(i=s?s.nextSibling:n.firstChild)){let e=Et.get(i);(!e||!e.parent&&e.canReuseDOM(o))&&o.reuseDOM(i)}o.sync(e,t),o.flags&=-8}if(i=s?s.nextSibling:n.firstChild,t&&!t.written&&t.node==n&&i!=o.dom&&(t.written=!0),o.dom.parentNode==n)for(;i&&i!=o.dom;)i=Pt(i);else n.insertBefore(o.dom,i);s=o.dom}for(i=s?s.nextSibling:n.firstChild,i&&t&&t.node==n&&(t.written=!0);i;)i=Pt(i)}else if(1&this.flags)for(let i of this.children)7&i.flags&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let n=0==ut(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==n&&t.firstChild!=t.lastChild&&(n=e==t.firstChild?-1:1),e=t}i=n<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Et.get(i);)i=i.nextSibling;if(!i)return this.length;for(let e=0,t=0;;e++){let n=this.children[e];if(n.dom==i)return t;t+=n.length+n.breakAfter}}domBoundsAround(e,t,i=0){let n=-1,s=-1,o=-1,a=-1;for(let r=0,l=i,c=i;r<this.children.length;r++){let i=this.children[r],h=l+i.length;if(l<e&&h>t)return i.domBoundsAround(e,t,l);if(h>=e&&-1==n&&(n=r,s=l),l>t&&i.dom.parentNode==this.dom){o=r,a=c;break}c=h,l=h+i.breakAfter}return{from:s,to:a<0?i+this.length:a,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),1&t.flags)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,7&this.flags&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=kt){this.markDirty();for(let n=e;n<t;n++){let e=this.children[n];e.parent==this&&i.indexOf(e)<0&&e.destroy()}i.length<250?this.children.splice(e,t-e,...i):this.children=[].concat(this.children.slice(0,e),i,this.children.slice(t));for(let e=0;e<i.length;e++)i[e].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new At(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,n,s,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!(8&(this.flags|e.flags))}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}function Pt(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}Et.prototype.breakAfter=0;class At{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Rt(e,t,i,n,s,o,a,r,l){let{children:c}=e,h=c.length?c[t]:null,d=o.length?o[o.length-1]:null,u=d?d.breakAfter:a;if(!(t==n&&h&&!a&&!u&&o.length<2&&h.merge(i,s,o.length?d:null,0==i,r,l))){if(n<c.length){let e=c[n];e&&(s<e.length||e.breakAfter&&(null==d?void 0:d.breakAfter))?(t==n&&(e=e.split(s),s=0),!u&&d&&e.merge(0,s,d,!0,0,l)?o[o.length-1]=e:((s||e.children.length&&!e.children[0].length)&&e.merge(0,s,null,!1,0,l),o.push(e))):(null==e?void 0:e.breakAfter)&&(d?d.breakAfter=1:a=1),n++}for(h&&(h.breakAfter=a,i>0&&(!a&&o.length&&h.merge(i,h.length,o[0],!1,r,0)?h.breakAfter=o.shift().breakAfter:(i<h.length||h.children.length&&0==h.children[h.children.length-1].length)&&h.merge(i,h.length,null,!1,r,0),t++));t<n&&o.length;)if(c[n-1].become(o[o.length-1]))n--,o.pop(),l=o.length?0:r;else{if(!c[t].become(o[0]))break;t++,o.shift(),r=o.length?0:l}!o.length&&t&&n<c.length&&!c[t-1].breakAfter&&c[n].merge(0,0,c[t-1],!1,r,l)&&t--,(t<n||o.length)&&e.replaceChildren(t,n,o)}}function Dt(e,t,i,n,s,o){let a=e.childCursor(),{i:r,off:l}=a.findPos(i,1),{i:c,off:h}=a.findPos(t,-1),d=t-i;for(let e of n)d+=e.length;e.length+=d,Rt(e,c,h,r,l,n,0,s,o)}let Vt="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Lt="undefined"!=typeof document?document:{documentElement:{style:{}}};const Tt=/Edge\/(\d+)/.exec(Vt.userAgent),Bt=/MSIE \d/.test(Vt.userAgent),Ft=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Vt.userAgent),It=!!(Bt||Ft||Tt),jt=!It&&/gecko\/(\d+)/i.test(Vt.userAgent),Mt=!It&&/Chrome\/(\d+)/.exec(Vt.userAgent),Qt="webkitFontSmoothing"in Lt.documentElement.style,Wt=!It&&/Apple Computer/.test(Vt.vendor),Nt=Wt&&(/Mobile\/\w+/.test(Vt.userAgent)||Vt.maxTouchPoints>2);var Zt={mac:Nt||/Mac/.test(Vt.platform),windows:/Win/.test(Vt.platform),linux:/Linux|X11/.test(Vt.platform),ie:It,ie_version:Bt?Lt.documentMode||6:Ft?+Ft[1]:Tt?+Tt[1]:0,gecko:jt,gecko_version:jt?+(/Firefox\/(\d+)/.exec(Vt.userAgent)||[0,0])[1]:0,chrome:!!Mt,chrome_version:Mt?+Mt[1]:0,ios:Nt,android:/Android\b/.test(Vt.userAgent),webkit:Qt,safari:Wt,webkit_version:Qt?+(/\bAppleWebKit\/(\d+)/.exec(Vt.userAgent)||[0,0])[1]:0,tabSize:null!=Lt.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class qt extends Et{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,i){return!(8&this.flags||i&&(!(i instanceof qt)||this.length-(t-e)+i.length>256||8&i.flags)||(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),0))}split(e){let t=new qt(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=8&this.flags,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new _t(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return function(e,t,i){let n=e.nodeValue.length;t>n&&(t=n);let s=t,o=t,a=0;0==t&&i<0||t==n&&i>=0?Zt.chrome||Zt.gecko||(t?(s--,a=1):o<n&&(o++,a=-1)):i<0?s--:o<n&&o++;let r=yt(e,s,o).getClientRects();if(!r.length)return null;let l=r[(a?a<0:i>=0)?0:r.length-1];return Zt.safari&&!a&&0==l.width&&(l=Array.prototype.find.call(r,(e=>e.width))||l),a?pt(l,a<0):l||null}(this.dom,e,t)}}class zt extends Et{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let e of t)e.setParent(this)}setAttrs(e){if(xt(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!(8&(this.flags|e.flags))}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,n,s,o){return!(i&&(!(i instanceof zt&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)||(Dt(this,e,t,i?i.children.slice():[],s-1,o-1),this.markDirty(),0))}split(e){let t=[],i=0,n=-1,s=0;for(let o of this.children){let a=i+o.length;a>e&&t.push(i<e?o.split(e-i):o),n<0&&i>=e&&(n=s),i=a,s++}let o=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new zt(this.mark,t,o)}domAtPos(e){return Gt(this,e)}coordsAt(e,t){return Ht(this,e,t)}}class Ut extends Et{static create(e,t,i){return new Ut(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=Ut.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,n,s,o){return!(i&&(!(i instanceof Ut&&this.widget.compare(i.widget))||e>0&&s<=0||t<this.length&&o<=0)||(this.length=e+(i?i.length:0)+(this.length-t),0))}become(e){return e instanceof Ut&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return m.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):m.empty}domAtPos(e){return(this.length?0==e:this.side>0)?_t.before(this.dom):_t.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let n=this.dom.getClientRects(),s=null;if(!n.length)return null;let o=this.side?this.side<0:e>0;for(let t=o?n.length-1:0;s=n[t],!(e>0?0==t:t==n.length-1||s.top<s.bottom);t+=o?-1:1);return pt(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Xt extends Et{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Xt&&e.side==this.side}split(){return new Xt(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?_t.before(this.dom):_t.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return m.empty}get isHidden(){return!0}}function Gt(e,t){let i=e.dom,{children:n}=e,s=0;for(let e=0;s<n.length;s++){let o=n[s],a=e+o.length;if(!(a==e&&o.getSide()<=0)){if(t>e&&t<a&&o.dom.parentNode==i)return o.domAtPos(t-e);if(t<=e)break;e=a}}for(let e=s;e>0;e--){let t=n[e-1];if(t.dom.parentNode==i)return t.domAtPos(t.length)}for(let e=s;e<n.length;e++){let t=n[e];if(t.dom.parentNode==i)return t.domAtPos(0)}return new _t(i,0)}function Yt(e,t,i){let n,{children:s}=e;i>0&&t instanceof zt&&s.length&&(n=s[s.length-1])instanceof zt&&n.mark.eq(t.mark)?Yt(n,t.children[0],i-1):(s.push(t),t.setParent(e)),e.length+=t.length}function Ht(e,t,i){let n=null,s=-1,o=null,a=-1;!function e(t,r){for(let l=0,c=0;l<t.children.length&&c<=r;l++){let h=t.children[l],d=c+h.length;d>=r&&(h.children.length?e(h,r-c):(!o||o.isHidden&&i>0)&&(d>r||c==d&&h.getSide()>0)?(o=h,a=r-c):(c<r||c==d&&h.getSide()<0&&!h.isHidden)&&(n=h,s=r-c)),c=d}}(e,t);let r=(i<0?n:o)||n||o;return r?r.coordsAt(Math.max(0,r==n?s:a),i):function(e){let t=e.dom.lastChild;if(!t)return e.dom.getBoundingClientRect();let i=rt(t);return i[i.length-1]||null}(e)}function Kt(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}qt.prototype.children=Ut.prototype.children=Xt.prototype.children=kt;const Jt=Object.create(null);function ei(e,t,i){if(e==t)return!0;e||(e=Jt),t||(t=Jt);let n=Object.keys(e),s=Object.keys(t);if(n.length-(i&&n.indexOf(i)>-1?1:0)!=s.length-(i&&s.indexOf(i)>-1?1:0))return!1;for(let o of n)if(o!=i&&(-1==s.indexOf(o)||e[o]!==t[o]))return!1;return!0}function ti(e,t,i){let n=!1;if(t)for(let s in t)i&&s in i||(n=!0,"style"==s?e.style.cssText="":e.removeAttribute(s));if(i)for(let s in i)t&&t[s]==i[s]||(n=!0,"style"==s?e.style.cssText=i[s]:e.setAttribute(s,i[s]));return n}function ii(e){let t=Object.create(null);for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i];t[n.name]=n.value}return t}class ni{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var si=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(si||(si={}));class oi extends Ee{constructor(e,t,i,n){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(e){return new ai(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new li(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,n=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:s,end:o}=ci(e,n);t=(s?n?-3e8:-1:5e8)-1,i=1+(o?n?2e8:1:-6e8)}return new li(e,t,i,n,e.widget||null,!0)}static line(e){return new ri(e)}static set(e,t=!1){return De.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}oi.none=De.empty;class ai extends oi{constructor(e){let{start:t,end:i}=ci(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof ai&&this.tagName==e.tagName&&(this.class||(null===(t=this.attrs)||void 0===t?void 0:t.class))==(e.class||(null===(i=e.attrs)||void 0===i?void 0:i.class))&&ei(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}ai.prototype.point=!1;class ri extends oi{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof ri&&this.spec.class==e.spec.class&&ei(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}ri.prototype.mapMode=A.TrackBefore,ri.prototype.point=!0;class li extends oi{constructor(e,t,i,n,s,o){super(t,i,s,e),this.block=n,this.isReplace=o,this.mapMode=n?t<=0?A.TrackBefore:A.TrackAfter:A.TrackDel}get type(){return this.startSide!=this.endSide?si.WidgetRange:this.startSide<=0?si.WidgetBefore:si.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof li&&((t=this.widget)==(i=e.widget)||!!(t&&i&&t.compare(i)))&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide;var t,i}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function ci(e,t=!1){let{inclusiveStart:i,inclusiveEnd:n}=e;return null==i&&(i=e.inclusive),null==n&&(n=e.inclusive),{start:null!=i?i:t,end:null!=n?n:t}}function hi(e,t,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=e?i[s]=Math.max(i[s],t):i.push(e,t)}li.prototype.point=!0;class di extends Et{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,n,s,o){if(i){if(!(i instanceof di))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Dt(this,e,t,i?i.children.slice():[],s,o),!0}split(e){let t=new di;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i,off:n}=this.childPos(e);n&&(t.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let e=i;e<this.children.length;e++)t.append(this.children[e],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){ei(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Yt(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=Kt(t,this.attrs||{})),i&&(this.attrs=Kt({class:i},this.attrs||{}))}domAtPos(e){return Gt(this,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?4&this.flags&&(xt(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(ti(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let n=this.dom.lastChild;for(;n&&Et.get(n)instanceof zt;)n=n.lastChild;if(!(n&&this.length&&("BR"==n.nodeName||0!=(null===(i=Et.get(n))||void 0===i?void 0:i.isEditable)||Zt.ios&&this.children.some((e=>e instanceof qt))))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e,t=0;for(let i of this.children){if(!(i instanceof qt)||/[^ -~]/.test(i.text))return null;let n=rt(i.dom);if(1!=n.length)return null;t+=n[0].width,e=n[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(e,t){let i=Ht(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:e}=this.parent.view.viewState,t=i.bottom-i.top;if(Math.abs(t-e.lineHeight)<2&&e.textHeight<t){let n=(t-e.textHeight)/2;return{top:i.top+n,bottom:i.bottom-n,left:i.left,right:i.left}}}return i}become(e){return e instanceof di&&0==this.children.length&&0==e.children.length&&ei(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let i=0,n=0;i<e.children.length;i++){let s=e.children[i],o=n+s.length;if(o>=t){if(s instanceof di)return s;if(o>t)break}n=o+s.breakAfter}return null}}class ui extends Et{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,n,s,o){return!(i&&(!(i instanceof ui&&this.widget.compare(i.widget))||e>0&&s<=0||t<this.length&&o<=0)||(this.length=e+(i?i.length:0)+(this.length-t),0))}domAtPos(e){return 0==e?_t.before(this.dom):_t.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new ui(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return kt}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):m.empty}domBoundsAround(){return null}become(e){return e instanceof ui&&e.widget.constructor==this.widget.constructor&&(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)||(this.widget instanceof pi?null:pt(this.dom.getBoundingClientRect(),this.length?0==e:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t!=i&&(e<0?t<0:i>0)}}class pi extends ni{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class fi{constructor(e,t,i,n){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof ui&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new di),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(mi(new Xt(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||e&&this.content.length&&this.content[this.content.length-1]instanceof ui||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}this.text=t,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(mi(new qt(this.text.slice(this.textOff,this.textOff+n)),t),i),this.atCursorPos=!0,this.textOff+=n,e-=n,i=0}}span(e,t,i,n){this.buildText(t-e,i,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,i,n,s,o){if(this.disallowBlockEffectsFor[o]&&i instanceof li){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=t-e;if(i instanceof li)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new ui(i.widget||gi.block,a,i));else{let o=Ut.create(i.widget||gi.inline,a,a?0:i.startSide),r=this.atCursorPos&&!o.isEditable&&s<=n.length&&(e<t||i.startSide>0),l=!o.isEditable&&(e<t||s>n.length||i.startSide<=0),c=this.getLine();2!=this.pendingBuffer||r||o.isEditable||(this.pendingBuffer=0),this.flushBuffer(n),r&&(c.append(mi(new Xt(1),n),s),s=n.length+Math.max(0,s-n.length)),c.append(mi(o,n),s),this.atCursorPos=l,this.pendingBuffer=l?e<t||s>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,i,n,s){let o=new fi(e,t,i,s);return o.openEnd=De.spans(n,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function mi(e,t){for(let i of t)e=new zt(i,[e],e.length);return e}class gi extends ni{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}gi.inline=new gi("span"),gi.block=new gi("div");var bi=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(bi||(bi={}));const vi=bi.LTR,wi=bi.RTL;function yi(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const Oi=yi("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),xi=yi("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),$i=Object.create(null),Ci=[];for(let e of["()","[]","{}"]){let t=e.charCodeAt(0),i=e.charCodeAt(1);$i[t]=i,$i[i]=-t}function Si(e){return e<=247?Oi[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?xi[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8204?256:64336<=e&&e<=65023?4:1}const _i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ki{get dir(){return this.level%2?wi:vi}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,n){let s=-1;for(let o=0;o<e.length;o++){let a=e[o];if(a.from<=t&&a.to>=t){if(a.level==i)return o;(s<0||(0!=n?n<0?a.from<t:a.to>t:e[s].level>a.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}function Ei(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],s=t[i];if(n.from!=s.from||n.to!=s.to||n.direction!=s.direction||!Ei(n.inner,s.inner))return!1}return!0}const Pi=[];function Ai(e,t,i,n,s,o,a){let r=n%2?2:1;if(n%2==s%2)for(let l=t,c=0;l<i;){let t=!0,h=!1;if(c==o.length||l<o[c].from){let e=Pi[l];e!=r&&(t=!1,h=16==e)}let d=t||1!=r?null:[],u=t?n:n+1,p=l;e:for(;;)if(c<o.length&&p==o[c].from){if(h)break e;let f=o[c];if(!t)for(let e=f.to,t=c+1;;){if(e==i)break e;if(!(t<o.length&&o[t].from==e)){if(Pi[e]==r)break e;break}e=o[t++].to}c++,d?d.push(f):(f.from>l&&a.push(new ki(l,f.from,u)),Ri(e,f.direction==vi!=!(u%2)?n+1:n,s,f.inner,f.from,f.to,a),l=f.to),p=f.to}else{if(p==i||(t?Pi[p]!=r:Pi[p]==r))break;p++}d?Ai(e,l,p,n+1,s,d,a):l<p&&a.push(new ki(l,p,u)),l=p}else for(let l=i,c=o.length;l>t;){let i=!0,h=!1;if(!c||l>o[c-1].to){let e=Pi[l-1];e!=r&&(i=!1,h=16==e)}let d=i||1!=r?null:[],u=i?n:n+1,p=l;e:for(;;)if(c&&p==o[c-1].to){if(h)break e;let f=o[--c];if(!i)for(let e=f.from,i=c;;){if(e==t)break e;if(!i||o[i-1].to!=e){if(Pi[e-1]==r)break e;break}e=o[--i].from}d?d.push(f):(f.to<l&&a.push(new ki(f.to,l,u)),Ri(e,f.direction==vi!=!(u%2)?n+1:n,s,f.inner,f.from,f.to,a),l=f.from),p=f.from}else{if(p==t||(i?Pi[p-1]!=r:Pi[p-1]==r))break;p--}d?Ai(e,p,l,n+1,s,d,a):p<l&&a.push(new ki(p,l,u)),l=p}}function Ri(e,t,i,n,s,o,a){let r=t%2?2:1;!function(e,t,i,n,s){for(let o=0;o<=n.length;o++){let a=o?n[o-1].to:t,r=o<n.length?n[o].from:i,l=o?256:s;for(let t=a,i=l,n=l;t<r;t++){let s=Si(e.charCodeAt(t));512==s?s=i:8==s&&4==n&&(s=16),Pi[t]=4==s?2:s,7&s&&(n=s),i=s}for(let e=a,t=l,n=l;e<r;e++){let s=Pi[e];if(128==s)e<r-1&&t==Pi[e+1]&&24&t?s=Pi[e]=t:Pi[e]=256;else if(64==s){let s=e+1;for(;s<r&&64==Pi[s];)s++;let o=e&&8==t||s<i&&8==Pi[s]?1==n?1:8:256;for(let t=e;t<s;t++)Pi[t]=o;e=s-1}else 8==s&&1==n&&(Pi[e]=1);t=s,7&s&&(n=s)}}}(e,s,o,n,r),function(e,t,i,n,s){let o=1==s?2:1;for(let a=0,r=0,l=0;a<=n.length;a++){let c=a?n[a-1].to:t,h=a<n.length?n[a].from:i;for(let t,i,n,a=c;a<h;a++)if(i=$i[t=e.charCodeAt(a)])if(i<0){for(let e=r-3;e>=0;e-=3)if(Ci[e+1]==-i){let t=Ci[e+2],i=2&t?s:4&t?1&t?o:s:0;i&&(Pi[a]=Pi[Ci[e]]=i),r=e;break}}else{if(189==Ci.length)break;Ci[r++]=a,Ci[r++]=t,Ci[r++]=l}else if(2==(n=Pi[a])||1==n){let e=n==s;l=e?0:1;for(let t=r-3;t>=0;t-=3){let i=Ci[t+2];if(2&i)break;if(e)Ci[t+2]|=2;else{if(4&i)break;Ci[t+2]|=4}}}}}(e,s,o,n,r),function(e,t,i,n){for(let s=0,o=n;s<=i.length;s++){let a=s?i[s-1].to:e,r=s<i.length?i[s].from:t;for(let l=a;l<r;){let a=Pi[l];if(256==a){let a=l+1;for(;;)if(a==r){if(s==i.length)break;a=i[s++].to,r=s<i.length?i[s].from:t}else{if(256!=Pi[a])break;a++}let c=1==o,h=c==(1==(a<t?Pi[a]:n))?c?1:2:n;for(let t=a,n=s,o=n?i[n-1].to:e;t>l;)t==o&&(t=i[--n].from,o=n?i[n-1].to:e),Pi[--t]=h;l=a}else o=a,l++}}}(s,o,n,r),Ai(e,s,o,t,i,n,a)}function Di(e){return[new ki(0,e,0)]}let Vi="";function Li(e,t,i,n,s){var o;let a=n.head-e.from,r=ki.find(t,a,null!==(o=n.bidiLevel)&&void 0!==o?o:-1,n.assoc),l=t[r],c=l.side(s,i);if(a==c){let e=r+=s?1:-1;if(e<0||e>=t.length)return null;l=t[r=e],a=l.side(!s,i),c=l.side(s,i)}let h=S(e.text,a,l.forward(s,i));(h<l.from||h>l.to)&&(h=c),Vi=e.text.slice(Math.min(a,h),Math.max(a,h));let d=r==(s?t.length-1:0)?null:t[r+(s?1:-1)];return d&&h==c&&d.level+(s?0:1)<l.level?M.cursor(d.side(!s,i)+e.from,d.forward(s,i)?1:-1,d.level):M.cursor(h+e.from,l.forward(s,i)?-1:1,l.level)}function Ti(e,t,i){for(let n=t;n<i;n++){let t=Si(e.charCodeAt(n));if(1==t)return vi;if(2==t||4==t)return wi}return vi}const Bi=N.define(),Fi=N.define(),Ii=N.define(),ji=N.define(),Mi=N.define(),Qi=N.define(),Wi=N.define(),Ni=N.define(),Zi=N.define(),qi=N.define({combine:e=>e.some((e=>e))}),zi=N.define({combine:e=>e.some((e=>e))}),Ui=N.define();class Xi{constructor(e,t="nearest",i="nearest",n=5,s=5,o=!1){this.range=e,this.y=t,this.x=i,this.yMargin=n,this.xMargin=s,this.isSnapshot=o}map(e){return e.empty?this:new Xi(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Xi(M.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Gi=me.define({map:(e,t)=>e.map(t)}),Yi=me.define();function Hi(e,t,i){let n=e.facet(ji);n.length?n[0](t):window.onerror?window.onerror(String(t),i,void 0,void 0,t):i?console.error(i+":",t):console.error(t)}const Ki=N.define({combine:e=>!e.length||e[0]});let Ji=0;const en=N.define();class tn{constructor(e,t,i,n,s){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=n,this.extension=s(this)}static define(e,t){const{eventHandlers:i,eventObservers:n,provide:s,decorations:o}=t||{};return new tn(Ji++,e,i,n,(e=>{let t=[en.of(e)];return o&&t.push(an.of((t=>{let i=t.plugin(e);return i?o(i):oi.none}))),s&&t.push(s(e)),t}))}static fromClass(e,t){return tn.define((t=>new e(t)),t)}}class nn{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(Hi(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(e){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Hi(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(t){Hi(e.state,t,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const sn=N.define(),on=N.define(),an=N.define(),rn=N.define(),ln=N.define(),cn=N.define();function hn(e,t){let i=e.state.facet(cn);if(!i.length)return i;let n=i.map((t=>t instanceof Function?t(e):t)),s=[];return De.spans(n,t.from,t.to,{point(){},span(e,i,n,o){let a=e-t.from,r=i-t.from,l=s;for(let e=n.length-1;e>=0;e--,o--){let i,s=n[e].spec.bidiIsolate;if(null==s&&(s=Ti(t.text,a,r)),o>0&&l.length&&(i=l[l.length-1]).to==a&&i.direction==s)i.to=r,l=i.inner;else{let e={from:a,to:r,direction:s,inner:[]};l.push(e),l=e.inner}}}}),s}const dn=N.define();function un(e){let t=0,i=0,n=0,s=0;for(let o of e.state.facet(dn)){let a=o(e);a&&(null!=a.left&&(t=Math.max(t,a.left)),null!=a.right&&(i=Math.max(i,a.right)),null!=a.top&&(n=Math.max(n,a.top)),null!=a.bottom&&(s=Math.max(s,a.bottom)))}return{left:t,right:i,top:n,bottom:s}}const pn=N.define();class fn{constructor(e,t,i,n){this.fromA=e,this.toA=t,this.fromB=i,this.toB=n}join(e){return new fn(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(0==t.length)return e;let i=[];for(let n=0,s=0,o=0,a=0;;n++){let r=n==e.length?null:e[n],l=o-a,c=r?r.fromB:1e9;for(;s<t.length&&t[s]<c;){let e=t[s],n=t[s+1],o=Math.max(a,e),r=Math.min(c,n);if(o<=r&&new fn(o+l,r+l,o,r).addToSet(i),n>c)break;s+=2}if(!r)return i;new fn(r.fromA,r.toA,r.fromB,r.toB).addToSet(i),o=r.toA,a=r.toB}}}class mn{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=D.empty(this.startState.doc.length);for(let e of i)this.changes=this.changes.compose(e.changes);let n=[];this.changes.iterChangedRanges(((e,t,i,s)=>n.push(new fn(e,t,i,s)))),this.changedRanges=n}static create(e,t,i){return new mn(e,t,i)}get viewportChanged(){return(4&this.flags)>0}get viewportMoved(){return(8&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(18&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((e=>e.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}class gn extends Et{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=oi.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new di],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new fn(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every((({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo))?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let n=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&((null===(t=this.domChanged)||void 0===t?void 0:t.newSel)?n=this.domChanged.newSel.head:function(e,t){let i=!1;return t&&e.iterChangedRanges(((e,n)=>{e<t.to&&n>t.from&&(i=!0)})),i}(e.changes,this.hasComposition)||e.selectionSet||(n=e.state.selection.main.head));let s=n>-1?function(e,t,i){let n=bn(e,i);if(!n)return null;let{node:s,from:o,to:a}=n,r=s.nodeValue;if(/[\n\r]/.test(r))return null;if(e.state.doc.sliceString(n.from,n.to)!=r)return null;let l=t.invertedDesc,c=new fn(l.mapPos(o),l.mapPos(a),o,a),h=[];for(let t=s.parentNode;;t=t.parentNode){let i=Et.get(t);if(i instanceof zt)h.push({node:t,deco:i.mark});else{if(i instanceof di||"DIV"==t.nodeName&&t.parentNode==e.contentDOM)return{range:c,text:s,marks:h,line:t};if(t==e.contentDOM)return null;h.push({node:t,deco:new ai({inclusive:!0,attributes:ii(t),tagName:t.tagName.toLowerCase()})})}}}(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:t,to:n}=this.hasComposition;i=new fn(t,n,e.changes.mapPos(t,-1),e.changes.mapPos(n,1)).addToSet(i.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(Zt.ie||Zt.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=function(e,t,i){let n=new class{constructor(){this.changes=[]}compareRange(e,t){hi(e,t,this.changes)}comparePoint(e,t){hi(e,t,this.changes)}boundChange(e){hi(e,e,this.changes)}};return De.compare(e,t,i,n),n.changes}(this.decorations,this.updateDeco(),e.changes);return i=fn.extendWithRanges(i,o),!!(7&this.flags||0!=i.length)&&(this.updateInner(i,e.startState.doc.length,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:n}=this.view;n.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=Zt.chrome||Zt.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,e),this.flags&=-8,e&&(e.written||n.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""})),this.markedForComposition.forEach((e=>e.flags&=-9));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let e of this.children)e instanceof ui&&e.widget instanceof pi&&s.push(e.dom);n.updateGaps(s)}updateChildren(e,t,i){let n=i?i.range.addToSet(e.slice()):e,s=this.childCursor(t);for(let e=n.length-1;;e--){let t=e>=0?n[e]:null;if(!t)break;let o,a,r,l,{fromA:c,toA:h,fromB:d,toB:u}=t;if(i&&i.range.fromB<u&&i.range.toB>d){let e=fi.build(this.view.state.doc,d,i.range.fromB,this.decorations,this.dynamicDecorationMap),t=fi.build(this.view.state.doc,i.range.toB,u,this.decorations,this.dynamicDecorationMap);a=e.breakAtStart,r=e.openStart,l=t.openEnd;let n=this.compositionView(i);t.breakAtStart?n.breakAfter=1:t.content.length&&n.merge(n.length,n.length,t.content[0],!1,t.openStart,0)&&(n.breakAfter=t.content[0].breakAfter,t.content.shift()),e.content.length&&n.merge(0,0,e.content[e.content.length-1],!0,0,e.openEnd)&&e.content.pop(),o=e.content.concat(n).concat(t.content)}else({content:o,breakAtStart:a,openStart:r,openEnd:l}=fi.build(this.view.state.doc,d,u,this.decorations,this.dynamicDecorationMap));let{i:p,off:f}=s.findPos(h,1),{i:m,off:g}=s.findPos(c,-1);Rt(this,m,g,p,f,o,a,r,l)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let e of t.effects)e.is(Yi)&&(this.editContextFormatting=e.value)}compositionView(e){let t=new qt(e.text.nodeValue);t.flags|=8;for(let{deco:i}of e.marks)t=new zt(i,[t],t.length);let i=new di;return i.append(t,0),i}fixCompositionDOM(e){let t=(e,t)=>{t.flags|=8|(t.children.some((e=>7&e.flags))?1:0),this.markedForComposition.add(t);let i=Et.get(e);i&&i!=t&&(i.dom=null),t.setDOM(e)},i=this.childPos(e.range.fromB,1),n=this.children[i.i];t(e.line,n);for(let s=e.marks.length-1;s>=-1;s--)i=n.childPos(i.off,1),n=n.children[i.i],t(s>=0?e.marks[s].node:e.text,n)}updateSelection(e=!1,t=!1){!e&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let i=this.view.root.activeElement,n=i==this.dom,s=!n&&!(this.view.state.facet(Ki)||this.dom.tabIndex>-1)&&at(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(n||t||s))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,r=this.moveToLine(this.domAtPos(a.anchor)),l=a.empty?r:this.moveToLine(this.domAtPos(a.head));if(Zt.gecko&&a.empty&&!this.hasComposition&&1==(c=r).node.nodeType&&c.node.firstChild&&(0==c.offset||"false"==c.node.childNodes[c.offset-1].contentEditable)&&(c.offset==c.node.childNodes.length||"false"==c.node.childNodes[c.offset].contentEditable)){let e=document.createTextNode("");this.view.observer.ignore((()=>r.node.insertBefore(e,r.node.childNodes[r.offset]||null))),r=l=new _t(e,0),o=!0}var c;let h=this.view.observer.selectionRange;!o&&h.focusNode&&(lt(r.node,r.offset,h.anchorNode,h.anchorOffset)&&lt(l.node,l.offset,h.focusNode,h.focusOffset)||this.suppressWidgetCursorChange(h,a))||(this.view.observer.ignore((()=>{Zt.android&&Zt.chrome&&this.dom.contains(h.focusNode)&&function(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=st(this.view.root);if(e)if(a.empty){if(Zt.gecko){let e=(t=r.node,n=r.offset,1!=t.nodeType?0:(n&&"false"==t.childNodes[n-1].contentEditable?1:0)|(n<t.childNodes.length&&"false"==t.childNodes[n].contentEditable?2:0));if(e&&3!=e){let t=(1==e?Ct:St)(r.node,r.offset);t&&(r=new _t(t.node,t.offset))}}e.collapse(r.node,r.offset),null!=a.bidiLevel&&void 0!==e.caretBidiLevel&&(e.caretBidiLevel=a.bidiLevel)}else if(e.extend){e.collapse(r.node,r.offset);try{e.extend(l.node,l.offset)}catch(e){}}else{let t=document.createRange();a.anchor>a.head&&([r,l]=[l,r]),t.setEnd(l.node,l.offset),t.setStart(r.node,r.offset),e.removeAllRanges(),e.addRange(t)}var t,n;s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())})),this.view.observer.setSelectionRange(r,l)),this.impreciseAnchor=r.precise?null:new _t(h.anchorNode,h.anchorOffset),this.impreciseHead=l.precise?null:new _t(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&lt(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=st(e.root),{anchorNode:n,anchorOffset:s}=e.observer.selectionRange;if(!(i&&t.empty&&t.assoc&&i.modify))return;let o=di.find(this,t.head);if(!o)return;let a=o.posAtStart;if(t.head==a||t.head==a+o.length)return;let r=this.coordsAt(t.head,-1),l=this.coordsAt(t.head,1);if(!r||!l||r.bottom>l.top)return;let c=this.domAtPos(t.head+t.assoc);i.collapse(c.node,c.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&i.collapse(n,s)}moveToLine(e){let t,i=this.dom;if(e.node!=i)return e;for(let n=e.offset;!t&&n<i.childNodes.length;n++){let e=Et.get(i.childNodes[n]);e instanceof di&&(t=e.domAtPos(0))}for(let n=e.offset-1;!t&&n>=0;n--){let e=Et.get(i.childNodes[n]);e instanceof di&&(t=e.domAtPos(e.length))}return t?new _t(t.node,t.offset,!0):e}nearest(e){for(let t=e;t;){let e=Et.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof di)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,n=0;for(let s=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],r=s-a.breakAfter,l=r-a.length;if(r<e)break;if(l<=e&&(l<e||a.covers(-1))&&(r>e||a.covers(1))&&(!i||a instanceof di&&!(i instanceof di&&t>=0)))i=a,n=l;else if(i&&l==e&&r==e&&a instanceof ui&&Math.abs(t)<2){if(a.deco.startSide<0)break;o&&(i=null)}s=l}return i?i.coordsAt(e-n,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),n=this.children[t];if(!(n instanceof di))return null;for(;n.children.length;){let{i:e,off:t}=n.childPos(i,1);for(;;e++){if(e==n.children.length)return null;if((n=n.children[e]).length)break}i=t}if(!(n instanceof qt))return null;let s=S(n.text,i);if(s==i)return null;let o=yt(n.dom,i,s).getClientRects();for(let e=0;e<o.length;e++){let t=o[e];if(e==o.length-1||t.top<t.bottom&&t.left<t.right)return t}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:n}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,r=this.view.textDirection==bi.LTR;for(let e=0,l=0;l<this.children.length;l++){let c=this.children[l],h=e+c.length;if(h>n)break;if(e>=i){let i=c.dom.getBoundingClientRect();if(t.push(i.height),o){let t=c.dom.lastChild,n=t?rt(t):[];if(n.length){let t=n[n.length-1],o=r?t.right-i.left:i.right-t.left;o>a&&(a=o,this.minWidth=s,this.minWidthFrom=e,this.minWidthTo=h)}}}e=h+c.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?bi.RTL:bi.LTR}measureTextSize(){for(let e of this.children)if(e instanceof di){let t=e.measureTextSize();if(t)return t}let e,t,i,n=document.createElement("div");return n.className="cm-line",n.style.width="99999px",n.style.position="absolute",n.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(n);let s=rt(n.firstChild)[0];e=n.getBoundingClientRect().height,t=s?s.width/27:7,i=s?s.height:e,n.remove()})),{lineHeight:e,charWidth:t,textHeight:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new At(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,n=0;;n++){let s=n==t.viewports.length?null:t.viewports[n],o=s?s.from-1:this.length;if(o>i){let n=(t.lineBlockAt(o).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(oi.replace({widget:new pi(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return oi.set(e)}updateDeco(){let e=1,t=this.view.state.facet(an).map((t=>(this.dynamicDecorationMap[e++]="function"==typeof t)?t(this.view):t)),i=!1,n=this.view.state.facet(rn).map(((e,t)=>{let n="function"==typeof e;return n&&(i=!0),n?e(this.view):e}));for(n.length&&(this.dynamicDecorationMap[e++]=i,t.push(De.join(n))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let t=this.view.viewState.lineBlockAt(e.range.head);return this.view.scrollDOM.scrollTop=t.top-e.yMargin,void(this.view.scrollDOM.scrollLeft=e.xMargin)}for(let t of this.view.state.facet(Ui))try{if(t(this.view,e.range,e))return!0}catch(e){Hi(this.view.state,e,"scroll handler")}let t,{range:i}=e,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,t.left),top:Math.min(n.top,t.top),right:Math.max(n.right,t.right),bottom:Math.max(n.bottom,t.bottom)});let s=un(this.view),o={left:n.left-s.left,top:n.top-s.top,right:n.right+s.right,bottom:n.bottom+s.bottom},{offsetWidth:a,offsetHeight:r}=this.view.scrollDOM;!function(e,t,i,n,s,o,a,r){let l=e.ownerDocument,c=l.defaultView||window;for(let h=e,d=!1;h&&!d;)if(1==h.nodeType){let e,u=h==l.body,p=1,f=1;if(u)e=ft(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(d=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let t=h.getBoundingClientRect();({scaleX:p,scaleY:f}=mt(h,t)),e={left:t.left,right:t.left+h.clientWidth*p,top:t.top,bottom:t.top+h.clientHeight*f}}let m=0,g=0;if("nearest"==s)t.top<e.top?(g=-(e.top-t.top+a),i>0&&t.bottom>e.bottom+g&&(g=t.bottom-e.bottom+g+a)):t.bottom>e.bottom&&(g=t.bottom-e.bottom+a,i<0&&t.top-g<e.top&&(g=-(e.top+g-t.top+a)));else{let n=t.bottom-t.top,o=e.bottom-e.top;g=("center"==s&&n<=o?t.top+n/2-o/2:"start"==s||"center"==s&&i<0?t.top-a:t.bottom-o+a)-e.top}if("nearest"==n?t.left<e.left?(m=-(e.left-t.left+o),i>0&&t.right>e.right+m&&(m=t.right-e.right+m+o)):t.right>e.right&&(m=t.right-e.right+o,i<0&&t.left<e.left+m&&(m=-(e.left+m-t.left+o))):m=("center"==n?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==n==r?t.left-o:t.right-(e.right-e.left)+o)-e.left,m||g)if(u)c.scrollBy(m,g);else{let e=0,i=0;if(g){let e=h.scrollTop;h.scrollTop+=g/f,i=(h.scrollTop-e)*f}if(m){let t=h.scrollLeft;h.scrollLeft+=m/p,e=(h.scrollLeft-t)*p}t={left:t.left-e,top:t.top-i,right:t.right-e,bottom:t.bottom-i},e&&Math.abs(e-m)<1&&(n="nearest"),i&&Math.abs(i-g)<1&&(s="nearest")}if(u)break;h=h.assignedSlot||h.parentNode}else{if(11!=h.nodeType)break;h=h.host}}(this.view.scrollDOM,o,i.head<i.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,r),-r),this.view.textDirection==bi.LTR)}}function bn(e,t){let i=e.observer.selectionRange;if(!i.focusNode)return null;let n=Ct(i.focusNode,i.focusOffset),s=St(i.focusNode,i.focusOffset),o=n||s;if(s&&n&&s.node!=n.node){let t=Et.get(s.node);if(!t||t instanceof qt&&t.text!=s.node.nodeValue)o=s;else if(e.docView.lastCompositionAfterCursor){let e=Et.get(n.node);!e||e instanceof qt&&e.text!=n.node.nodeValue||(o=s)}}if(e.docView.lastCompositionAfterCursor=o!=n,!o)return null;let a=t-o.offset;return{from:a,to:a+o.node.nodeValue.length,node:o.node}}function vn(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function wn(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function yn(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function On(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function xn(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function $n(e,t,i){let n,s,o,a,r,l,c,h,d=!1;for(let u=e.firstChild;u;u=u.nextSibling){let e=rt(u);for(let p=0;p<e.length;p++){let f=e[p];s&&yn(s,f)&&(f=On(xn(f,s.bottom),s.top));let m=vn(t,f),g=wn(i,f);if(0==m&&0==g)return 3==u.nodeType?Cn(u,t,i):$n(u,t,i);if(!n||a>g||a==g&&o>m){n=u,s=f,o=m,a=g;let r=g?i<f.top?-1:1:m?t<f.left?-1:1:0;d=!r||(r>0?p<e.length-1:p>0)}0==m?i>f.bottom&&(!c||c.bottom<f.bottom)?(r=u,c=f):i<f.top&&(!h||h.top>f.top)&&(l=u,h=f):c&&yn(c,f)?c=xn(c,f.bottom):h&&yn(h,f)&&(h=On(h,f.top))}}if(c&&c.bottom>=i?(n=r,s=c):h&&h.top<=i&&(n=l,s=h),!n)return{node:e,offset:0};let u=Math.max(s.left,Math.min(s.right,t));return 3==n.nodeType?Cn(n,u,i):d&&"false"!=n.contentEditable?$n(n,u,i):{node:e,offset:Array.prototype.indexOf.call(e.childNodes,n)+(t>=(s.left+s.right)/2?1:0)}}function Cn(e,t,i){let n=e.nodeValue.length,s=-1,o=1e9,a=0;for(let r=0;r<n;r++){let n=yt(e,r,r+1).getClientRects();for(let l=0;l<n.length;l++){let c=n[l];if(c.top==c.bottom)continue;a||(a=t-c.left);let h=(c.top>i?c.top-i:i-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&h<o){let i=t>=(c.left+c.right)/2,n=i;if((Zt.chrome||Zt.gecko)&&yt(e,r).getBoundingClientRect().left==c.right&&(n=!i),h<=0)return{node:e,offset:r+(n?1:0)};s=r+(n?1:0),o=h}}}return{node:e,offset:s>-1?s:a>0?e.nodeValue.length:0}}function Sn(e,t,i,n=-1){var s,o;let a,r=e.contentDOM.getBoundingClientRect(),l=r.top+e.viewState.paddingTop,{docHeight:c}=e.viewState,{x:h,y:d}=t,u=d-l;if(u<0)return 0;if(u>c)return e.state.doc.length;for(let t=e.viewState.heightOracle.textHeight/2,s=!1;a=e.elementAtHeight(u),a.type!=si.Text;)for(;u=n>0?a.bottom+t:a.top-t,!(u>=0&&u<=c);){if(s)return i?null:0;s=!0,n=-n}d=l+u;let p=a.from;if(p<e.viewport.from)return 0==e.viewport.from?0:i?null:_n(e,r,a,h,d);if(p>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:i?null:_n(e,r,a,h,d);let f=e.dom.ownerDocument,m=e.root.elementFromPoint?e.root:f,g=m.elementFromPoint(h,d);g&&!e.contentDOM.contains(g)&&(g=null),g||(h=Math.max(r.left+1,Math.min(r.right-1,h)),g=m.elementFromPoint(h,d),g&&!e.contentDOM.contains(g)&&(g=null));let b,v=-1;if(g&&0!=(null===(s=e.docView.nearest(g))||void 0===s?void 0:s.isEditable)){if(f.caretPositionFromPoint){let e=f.caretPositionFromPoint(h,d);e&&({offsetNode:b,offset:v}=e)}else if(f.caretRangeFromPoint){let t=f.caretRangeFromPoint(h,d);t&&(({startContainer:b,startOffset:v}=t),(!e.contentDOM.contains(b)||Zt.safari&&function(e,t,i){let n;if(3!=e.nodeType||t!=(n=e.nodeValue.length))return!1;for(let t=e.nextSibling;t;t=t.nextSibling)if(1!=t.nodeType||"BR"!=t.nodeName)return!1;return yt(e,n-1,n).getBoundingClientRect().left>i}(b,v,h)||Zt.chrome&&function(e,t,i){if(0!=t)return!1;for(let t=e;;){let e=t.parentNode;if(!e||1!=e.nodeType||e.firstChild!=t)return!1;if(e.classList.contains("cm-line"))break;t=e}return i-(1==e.nodeType?e.getBoundingClientRect():yt(e,0,Math.max(e.nodeValue.length,1)).getBoundingClientRect()).left>5}(b,v,h))&&(b=void 0))}b&&(v=Math.min(ut(b),v))}if(!b||!e.docView.dom.contains(b)){let t=di.find(e.docView,p);if(!t)return u>a.top+a.height/2?a.to:a.from;({node:b,offset:v}=$n(t.dom,h,d))}let w=e.docView.nearest(b);if(!w)return null;if(w.isWidget&&1==(null===(o=w.dom)||void 0===o?void 0:o.nodeType)){let e=w.dom.getBoundingClientRect();return t.y<e.top||t.y<=e.bottom&&t.x<=(e.left+e.right)/2?w.posAtStart:w.posAtEnd}return w.localPosFromDOM(b,v)+w.posAtStart}function _n(e,t,i,n,s){let o=Math.round((n-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){let t=e.viewState.heightOracle.textHeight;o+=Math.floor((s-i.top-.5*(e.defaultLineHeight-t))/t)*e.viewState.heightOracle.lineLength}let a=e.state.sliceDoc(i.from,i.to);return i.from+qe(a,o,e.state.tabSize)}function kn(e,t){let i=e.lineBlockAt(t);if(Array.isArray(i.type))for(let e of i.type)if(e.to>t||e.to==t&&(e.to==i.to||e.type==si.Text))return e;return i}function En(e,t,i,n){let s=e.state.doc.lineAt(t.head),o=e.bidiSpans(s),a=e.textDirectionAt(s.from);for(let r=t,l=null;;){let t=Li(s,o,a,r,i),c=Vi;if(!t){if(s.number==(i?e.state.doc.lines:1))return r;c="\n",s=e.state.doc.line(s.number+(i?1:-1)),o=e.bidiSpans(s),t=e.visualLineSide(s,!i)}if(l){if(!l(c))return r}else{if(!n)return t;l=n(c)}r=t}}function Pn(e,t,i){for(;;){let n=0;for(let s of e)s.between(t-1,t+1,((e,s,o)=>{if(t>e&&t<s){let o=n||i||(t-e<s-t?-1:1);t=o<0?e:s,n=o}}));if(!n)return t}}function An(e,t,i){let n=Pn(e.state.facet(ln).map((t=>t(e))),i.from,t.head>i.from?-1:1);return n==i.from?i:M.cursor(n,n<i.from?1:-1)}class Rn{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(_e.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+="￿"}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let n=e;;){this.findPointBefore(i,n);let e=this.text.length;this.readNode(n);let s=n.nextSibling;if(s==t)break;let o=Et.get(n),a=Et.get(s);(o&&a?o.breakAfter:(o?o.breakAfter:ht(n))||ht(s)&&("BR"!=n.nodeName||n.cmIgnore)&&this.text.length>e)&&this.lineBreak(),n=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,o=-1,a=1;if(this.lineSeparator?(o=t.indexOf(this.lineSeparator,i),a=this.lineSeparator.length):(s=n.exec(t))&&(o=s.index,a=s[0].length),this.append(t.slice(i,o<0?t.length:o)),o<0)break;if(this.lineBreak(),a>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=a-1);i=o+a}}readNode(e){if(e.cmIgnore)return;let t=Et.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(Dn(e,i.node,i.offset)?t:0))}}function Dn(e,t,i){for(;;){if(!t||i<ut(t))return!1;if(t==e)return!0;i=ct(t)+1,t=t.parentNode}}class Vn{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Ln{constructor(e,t,i,n){this.typeOver=n,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let t=s||o?[]:function(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:o}=e.observer.selectionRange;return i&&(t.push(new Vn(i,n)),s==i&&o==n||t.push(new Vn(s,o))),t}(e),i=new Rn(t,e.state);i.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=i.text,this.newSel=function(e,t){if(0==e.length)return null;let i=e[0].pos,n=2==e.length?e[1].pos:i;return i>-1&&n>-1?M.single(i+t,n+t):null}(t,this.bounds.from)}else{let t=e.observer.selectionRange,i=s&&s.node==t.focusNode&&s.offset==t.focusOffset||!ot(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),n=o&&o.node==t.anchorNode&&o.offset==t.anchorOffset||!ot(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset),a=e.viewport;if((Zt.ios||Zt.chrome)&&e.state.selection.main.empty&&i!=n&&(a.from>0||a.to<e.state.doc.length)){let t=Math.min(i,n),s=Math.max(i,n),o=a.from-t,r=a.to-s;0!=o&&1!=o&&0!=t||0!=r&&-1!=r&&s!=e.state.doc.length||(i=0,n=e.state.doc.length)}this.newSel=M.single(n,i)}}}function Tn(e,t){let i,{newSel:n}=t,s=e.state.selection.main,o=e.inputState.lastKeyTime>Date.now()-100?e.inputState.lastKeyCode:-1;if(t.bounds){let{from:n,to:a}=t.bounds,r=s.from,l=null;(8===o||Zt.android&&t.text.length<a-n)&&(r=s.to,l="end");let c=function(e,t,i,n){let s=Math.min(e.length,t.length),o=0;for(;o<s&&e.charCodeAt(o)==t.charCodeAt(o);)o++;if(o==s&&e.length==t.length)return null;let a=e.length,r=t.length;for(;a>0&&r>0&&e.charCodeAt(a-1)==t.charCodeAt(r-1);)a--,r--;return"end"==n&&(i-=a+Math.max(0,o-Math.min(a,r))-o),a<o&&e.length<t.length?(o-=i<=o&&i>=a?o-i:0,r=o+(r-a),a=o):r<o&&(o-=i<=o&&i>=r?o-i:0,a=o+(a-r),r=o),{from:o,toA:a,toB:r}}(e.state.doc.sliceString(n,a,"￿"),t.text,r-n,l);c&&(Zt.chrome&&13==o&&c.toB==c.from+2&&"￿￿"==t.text.slice(c.from,c.toB)&&c.toB--,i={from:n+c.from,to:n+c.toA,insert:m.of(t.text.slice(c.from,c.toB).split("￿"))})}else n&&(!e.hasFocus&&e.state.facet(Ki)||n.main.eq(s))&&(n=null);if(!i&&!n)return!1;if(!i&&t.typeOver&&!s.empty&&n&&n.main.empty?i={from:s.from,to:s.to,insert:e.state.doc.slice(s.from,s.to)}:(Zt.mac||Zt.android)&&i&&i.from==i.to&&i.from==s.head-1&&/^\. ?$/.test(i.insert.toString())&&"off"==e.contentDOM.getAttribute("autocorrect")?(n&&2==i.insert.length&&(n=M.single(n.main.anchor-1,n.main.head-1)),i={from:i.from,to:i.to,insert:m.of([i.insert.toString().replace("."," ")])}):i&&i.from>=s.from&&i.to<=s.to&&(i.from!=s.from||i.to!=s.to)&&s.to-s.from-(i.to-i.from)<=4?i={from:s.from,to:s.to,insert:e.state.doc.slice(s.from,i.from).append(i.insert).append(e.state.doc.slice(i.to,s.to))}:Zt.chrome&&i&&i.from==i.to&&i.from==s.head&&"\n "==i.insert.toString()&&e.lineWrapping&&(n&&(n=M.single(n.main.anchor-1,n.main.head-1)),i={from:s.from,to:s.to,insert:m.of([" "])}),i)return Bn(e,i,n,o);if(n&&!n.main.eq(s)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin),e.dispatch({selection:n,scrollIntoView:t,userEvent:i}),!0}return!1}function Bn(e,t,i,n=-1){if(Zt.ios&&e.inputState.flushIOSKey(t))return!0;let s=e.state.selection.main;if(Zt.android&&(t.to==s.to&&(t.from==s.from||t.from==s.from-1&&" "==e.state.sliceDoc(t.from,s.from))&&1==t.insert.length&&2==t.insert.lines&&Ot(e.contentDOM,"Enter",13)||(t.from==s.from-1&&t.to==s.to&&0==t.insert.length||8==n&&t.insert.length<t.to-t.from&&t.to>s.head)&&Ot(e.contentDOM,"Backspace",8)||t.from==s.from&&t.to==s.to+1&&0==t.insert.length&&Ot(e.contentDOM,"Delete",46)))return!0;let o,a=t.insert.toString();e.inputState.composing>=0&&e.inputState.composing++;let r=()=>o||(o=function(e,t,i){let n,s=e.state,o=s.selection.main;if(t.from>=o.from&&t.to<=o.to&&t.to-t.from>=(o.to-o.from)/3&&(!i||i.main.empty&&i.main.from==t.from+t.insert.length)&&e.inputState.composing<0){let i=o.from<t.from?s.sliceDoc(o.from,t.from):"",a=o.to>t.to?s.sliceDoc(t.to,o.to):"";n=s.replaceSelection(e.state.toText(i+t.insert.sliceString(0,void 0,e.state.lineBreak)+a))}else{let a=s.changes(t),r=i&&i.main.to<=a.newLength?i.main:void 0;if(s.selection.ranges.length>1&&e.inputState.composing>=0&&t.to<=o.to&&t.to>=o.to-10){let l,c=e.state.sliceDoc(t.from,t.to),h=i&&bn(e,i.main.head);if(h){let e=t.insert.length-(t.to-t.from);l={from:h.from,to:h.to-e}}else l=e.state.doc.lineAt(o.head);let d=o.to-t.to,u=o.to-o.from;n=s.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:a,range:r||i.map(a)};let n=i.to-d,h=n-c.length;if(i.to-i.from!=u||e.state.sliceDoc(h,n)!=c||i.to>=l.from&&i.from<=l.to)return{range:i};let p=s.changes({from:h,to:n,insert:t.insert}),f=i.to-o.to;return{changes:p,range:r?M.range(Math.max(0,r.anchor+f),Math.max(0,r.head+f)):i.map(p)}}))}else n={changes:a,selection:r&&s.selection.replaceRange(r)}}let a="input.type";return(e.composing||e.inputState.compositionPendingChange&&e.inputState.compositionEndedAt>Date.now()-50)&&(e.inputState.compositionPendingChange=!1,a+=".compose",e.inputState.compositionFirstChange&&(a+=".start",e.inputState.compositionFirstChange=!1)),s.update(n,{userEvent:a,scrollIntoView:!0})}(e,t,i));return e.state.facet(Qi).some((i=>i(e,t.from,t.to,a,r)))||e.dispatch(r()),!0}class Fn{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Zt.safari&&e.contentDOM.addEventListener("input",(()=>null)),Zt.gecko&&function(e){hs.has(e)||(hs.add(e),e.addEventListener("copy",(()=>{})),e.addEventListener("cut",(()=>{})))}(e.contentDOM.ownerDocument)}handleEvent(e){(function(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,n=t.target;n!=e.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=Et.get(n))&&i.ignoreEvent(t))return!1;return!0})(this.view,e)&&!this.ignoreDuringComposition(e)&&("keydown"==e.type&&this.keydown(e)||(0!=this.view.updateState?Promise.resolve().then((()=>this.runHandlers(e.type,e))):this.runHandlers(e.type,e)))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let e of i.observers)e(this.view,t);for(let e of i.handlers){if(t.defaultPrevented)break;if(e(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=jn(e),i=this.handlers,n=this.view.contentDOM;for(let e in t)if("scroll"!=e){let s=!t[e].handlers.length,o=i[e];o&&s!=!o.handlers.length&&(n.removeEventListener(e,this.handleEvent),o=null),o||n.addEventListener(e,this.handleEvent,{passive:s})}for(let e in i)"scroll"==e||t[e]||n.removeEventListener(e,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&27!=e.keyCode&&Wn.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Zt.android&&Zt.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return!Zt.ios||e.synthetic||e.altKey||e.metaKey||!((t=Mn.find((t=>t.keyCode==e.keyCode)))&&!e.ctrlKey||Qn.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(229!=e.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=t||e,setTimeout((()=>this.flushIOSKey()),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&!("Enter"==t.key&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString()))&&(this.pendingIOSKey=void 0,Ot(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(Zt.safari&&!Zt.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function In(e,t){return(i,n)=>{try{return t.call(e,n,i)}catch(e){Hi(i.state,e)}}}function jn(e){let t=Object.create(null);function i(e){return t[e]||(t[e]={observers:[],handlers:[]})}for(let t of e){let e=t.spec;if(e&&e.domEventHandlers)for(let n in e.domEventHandlers){let s=e.domEventHandlers[n];s&&i(n).handlers.push(In(t.value,s))}if(e&&e.domEventObservers)for(let n in e.domEventObservers){let s=e.domEventObservers[n];s&&i(n).observers.push(In(t.value,s))}}for(let e in qn)i(e).handlers.push(qn[e]);for(let e in zn)i(e).observers.push(zn[e]);return t}const Mn=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Qn="dthko",Wn=[16,17,18,20,91,92,224,225];function Nn(e){return.7*Math.max(0,e)+8}class Zn{constructor(e,t,i,n){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=function(e){let t,i,n=e.ownerDocument;for(let s=e.parentNode;s&&!(s==n.body||t&&i);)if(1==s.nodeType)!i&&s.scrollHeight>s.clientHeight&&(i=s),!t&&s.scrollWidth>s.clientWidth&&(t=s),s=s.assignedSlot||s.parentNode;else{if(11!=s.nodeType)break;s=s.host}return{x:t,y:i}}(e.contentDOM),this.atoms=e.state.facet(ln).map((t=>t(e)));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(_e.allowMultipleSelections)&&function(e,t){let i=e.state.facet(Bi);return i.length?i[0](t):Zt.mac?t.metaKey:t.ctrlKey}(e,t),this.dragging=!(!function(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let n=st(e.root);if(!n||0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let e=0;e<s.length;e++){let i=s[e];if(i.left<=t.clientX&&i.right>=t.clientX&&i.top<=t.clientY&&i.bottom>=t.clientY)return!0}return!1}(e,t)||1!=ss(t))&&null}start(e){!1===this.dragging&&this.select(e)}move(e){if(0==e.buttons)return this.destroy();if(this.dragging||null==this.dragging&&(t=this.startEvent,i=e,Math.max(Math.abs(t.clientX-i.clientX),Math.abs(t.clientY-i.clientY))<10))return;var t,i;this.select(this.lastEvent=e);let n=0,s=0,o=0,a=0,r=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:o,right:r}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:a,bottom:l}=this.scrollParents.y.getBoundingClientRect());let c=un(this.view);e.clientX-c.left<=o+6?n=-Nn(o-e.clientX):e.clientX+c.right>=r-6&&(n=Nn(e.clientX-r)),e.clientY-c.top<=a+6?s=-Nn(a-e.clientY):e.clientY+c.bottom>=l-6&&(s=Nn(e.clientY-l)),this.setScrollSpeed(n,s)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval((()=>this.scroll()),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),!1===this.dragging&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let i=0;i<e.ranges.length;i++){let n=e.ranges[i],s=null;if(n.empty){let e=Pn(this.atoms,n.from,0);e!=n.from&&(s=M.cursor(e,-1))}else{let e=Pn(this.atoms,n.from,-1),t=Pn(this.atoms,n.to,1);e==n.from&&t==n.to||(s=M.range(n.from==n.anchor?e:t,n.from==n.head?e:t))}s&&(t||(t=e.ranges.slice()),t[i]=s)}return t?M.create(t,e.mainIndex):e}select(e){let{view:t}=this,i=this.skipAtoms(this.style.get(e,this.extend,this.multiple));!this.mustSelect&&i.eq(t.state.selection,!1===this.dragging)||this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some((e=>e.isUserEvent("input.type")))?this.destroy():this.style.update(e)&&setTimeout((()=>this.select(this.lastEvent)),20)}}const qn=Object.create(null),zn=Object.create(null),Un=Zt.ie&&Zt.ie_version<15||Zt.ios&&Zt.webkit_version<604;function Xn(e,t,i){for(let n of e.facet(t))i=n(i,e);return i}function Gn(e,t){t=Xn(e.state,Ni,t);let i,{state:n}=e,s=1,o=n.toText(t),a=o.lines==n.selection.ranges.length;if(null!=as&&n.selection.ranges.every((e=>e.empty))&&as==o.toString()){let e=-1;i=n.changeByRange((i=>{let r=n.doc.lineAt(i.from);if(r.from==e)return{range:i};e=r.from;let l=n.toText((a?o.line(s++).text:t)+n.lineBreak);return{changes:{from:r.from,insert:l},range:M.cursor(i.from+l.length)}}))}else i=a?n.changeByRange((e=>{let t=o.line(s++);return{changes:{from:e.from,to:e.to,insert:t.text},range:M.cursor(e.from+t.length)}})):n.replaceSelection(o);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}function Yn(e,t,i,n){if(1==n)return M.cursor(t,i);if(2==n)return function(e,t,i=1){let n=e.charCategorizer(t),s=e.doc.lineAt(t),o=t-s.from;if(0==s.length)return M.cursor(t);0==o?i=1:o==s.length&&(i=-1);let a=o,r=o;i<0?a=S(s.text,o,!1):r=S(s.text,o);let l=n(s.text.slice(a,r));for(;a>0;){let e=S(s.text,a,!1);if(n(s.text.slice(e,a))!=l)break;a=e}for(;r<s.length;){let e=S(s.text,r);if(n(s.text.slice(r,e))!=l)break;r=e}return M.range(a+s.from,r+s.from)}(e.state,t,i);{let i=di.find(e.docView,t),n=e.state.doc.lineAt(i?i.posAtEnd:t),s=i?i.posAtStart:n.from,o=i?i.posAtEnd:n.to;return o<e.state.doc.length&&o==n.to&&o++,M.range(s,o)}}zn.scroll=e=>{e.inputState.lastScrollTop=e.scrollDOM.scrollTop,e.inputState.lastScrollLeft=e.scrollDOM.scrollLeft},qn.keydown=(e,t)=>(e.inputState.setSelectionOrigin("select"),27==t.keyCode&&0!=e.inputState.tabFocusMode&&(e.inputState.tabFocusMode=Date.now()+2e3),!1),zn.touchstart=(e,t)=>{e.inputState.lastTouchTime=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},zn.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},qn.mousedown=(e,t)=>{if(e.observer.flush(),e.inputState.lastTouchTime>Date.now()-2e3)return!1;let i=null;for(let n of e.state.facet(Ii))if(i=n(e,t),i)break;if(i||0!=t.button||(i=function(e,t){let i=Jn(e,t),n=ss(t),s=e.state.selection;return{update(e){e.docChanged&&(i.pos=e.changes.mapPos(i.pos),s=s.map(e.changes))},get(t,o,a){let r,l=Jn(e,t),c=Yn(e,l.pos,l.bias,n);if(i.pos!=l.pos&&!o){let t=Yn(e,i.pos,i.bias,n),s=Math.min(t.from,c.from),o=Math.max(t.to,c.to);c=s<c.from?M.range(s,o):M.range(o,s)}return o?s.replaceRange(s.main.extend(c.from,c.to)):a&&1==n&&s.ranges.length>1&&(r=function(e,t){for(let i=0;i<e.ranges.length;i++){let{from:n,to:s}=e.ranges[i];if(n<=t&&s>=t)return M.create(e.ranges.slice(0,i).concat(e.ranges.slice(i+1)),e.mainIndex==i?0:e.mainIndex-(e.mainIndex>i?1:0))}return null}(s,l.pos))?r:a?s.addRange(c):M.create([c])}}}(e,t)),i){let n=!e.hasFocus;e.inputState.startMouseSelection(new Zn(e,t,i,n)),n&&e.observer.ignore((()=>{wt(e.contentDOM);let t=e.root.activeElement;t&&!t.contains(e.contentDOM)&&t.blur()}));let s=e.inputState.mouseSelection;if(s)return s.start(t),!1===s.dragging}return!1};let Hn=(e,t,i)=>t>=i.top&&t<=i.bottom&&e>=i.left&&e<=i.right;function Kn(e,t,i,n){let s=di.find(e.docView,t);if(!s)return 1;let o=t-s.posAtStart;if(0==o)return 1;if(o==s.length)return-1;let a=s.coordsAt(o,-1);if(a&&Hn(i,n,a))return-1;let r=s.coordsAt(o,1);return r&&Hn(i,n,r)?1:a&&a.bottom>=n?-1:1}function Jn(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:Kn(e,i,t.clientX,t.clientY)}}const es=Zt.ie&&Zt.ie_version<=11;let ts=null,is=0,ns=0;function ss(e){if(!es)return e.detail;let t=ts,i=ns;return ts=e,ns=Date.now(),is=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(is+1)%3:1}function os(e,t,i,n){if(!(i=Xn(e.state,Ni,i)))return;let s=e.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:o}=e.inputState,a=n&&o&&function(e,t){let i=e.state.facet(Fi);return i.length?i[0](t):Zt.mac?!t.altKey:!t.ctrlKey}(e,t)?{from:o.from,to:o.to}:null,r={from:s,insert:i},l=e.state.changes(a?[a,r]:r);e.focus(),e.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:a?"move.drop":"input.drop"}),e.inputState.draggedContent=null}qn.dragstart=(e,t)=>{let{selection:{main:i}}=e.state;if(t.target.draggable){let n=e.docView.nearest(t.target);if(n&&n.isWidget){let e=n.posAtStart,t=e+n.length;(e>=i.to||t<=i.from)&&(i=M.range(e,t))}}let{inputState:n}=e;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=i,t.dataTransfer&&(t.dataTransfer.setData("Text",Xn(e.state,Zi,e.state.sliceDoc(i.from,i.to))),t.dataTransfer.effectAllowed="copyMove"),!1},qn.dragend=e=>(e.inputState.draggedContent=null,!1),qn.drop=(e,t)=>{if(!t.dataTransfer)return!1;if(e.state.readOnly)return!0;let i=t.dataTransfer.files;if(i&&i.length){let n=Array(i.length),s=0,o=()=>{++s==i.length&&os(e,t,n.filter((e=>null!=e)).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=o,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(n[e]=t.result),o()},t.readAsText(i[e])}return!0}{let i=t.dataTransfer.getData("Text");if(i)return os(e,t,i,!0),!0}return!1},qn.paste=(e,t)=>{if(e.state.readOnly)return!0;e.observer.flush();let i=Un?null:t.clipboardData;return i?(Gn(e,i.getData("text/plain")||i.getData("text/uri-list")),!0):(function(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{e.focus(),i.remove(),Gn(e,i.value)}),50)}(e),!1)};let as=null;qn.copy=qn.cut=(e,t)=>{let{text:i,ranges:n,linewise:s}=function(e){let t=[],i=[],n=!1;for(let n of e.selection.ranges)n.empty||(t.push(e.sliceDoc(n.from,n.to)),i.push(n));if(!t.length){let s=-1;for(let{from:n}of e.selection.ranges){let o=e.doc.lineAt(n);o.number>s&&(t.push(o.text),i.push({from:o.from,to:Math.min(e.doc.length,o.to+1)})),s=o.number}n=!0}return{text:Xn(e,Zi,t.join(e.lineBreak)),ranges:i,linewise:n}}(e.state);if(!i&&!s)return!1;as=s?i:null,"cut"!=t.type||e.state.readOnly||e.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let o=Un?null:t.clipboardData;return o?(o.clearData(),o.setData("text/plain",i),!0):(function(e,t){let i=e.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=t,n.focus(),n.selectionEnd=t.length,n.selectionStart=0,setTimeout((()=>{n.remove(),e.focus()}),50)}(e,i),!1)};const rs=ue.define();function ls(e,t){let i=[];for(let n of e.facet(Wi)){let s=n(e,t);s&&i.push(s)}return i?e.update({effects:i,annotations:rs.of(!0)}):null}function cs(e){setTimeout((()=>{let t=e.hasFocus;if(t!=e.inputState.notifiedFocused){let i=ls(e.state,t);i?e.dispatch(i):e.update([])}}),10)}zn.focus=e=>{e.inputState.lastFocusTime=Date.now(),e.scrollDOM.scrollTop||!e.inputState.lastScrollTop&&!e.inputState.lastScrollLeft||(e.scrollDOM.scrollTop=e.inputState.lastScrollTop,e.scrollDOM.scrollLeft=e.inputState.lastScrollLeft),cs(e)},zn.blur=e=>{e.observer.clearSelectionRange(),cs(e)},zn.compositionstart=zn.compositionupdate=e=>{e.observer.editContext||(null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0))},zn.compositionend=e=>{e.observer.editContext||(e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionPendingKey=!0,e.inputState.compositionPendingChange=e.observer.pendingRecords().length>0,e.inputState.compositionFirstChange=null,Zt.chrome&&Zt.android?e.observer.flushSoon():e.inputState.compositionPendingChange?Promise.resolve().then((()=>e.observer.flush())):setTimeout((()=>{e.inputState.composing<0&&e.docView.hasComposition&&e.update([])}),50))},zn.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},qn.beforeinput=(e,t)=>{var i,n;if("insertReplacementText"==t.inputType&&e.observer.editContext){let n=null===(i=t.dataTransfer)||void 0===i?void 0:i.getData("text/plain"),s=t.getTargetRanges();if(n&&s.length){let t=s[0],i=e.posAtDOM(t.startContainer,t.startOffset),o=e.posAtDOM(t.endContainer,t.endOffset);return Bn(e,{from:i,to:o,insert:e.state.toText(n)},null),!0}}let s;if(Zt.chrome&&Zt.android&&(s=Mn.find((e=>e.inputType==t.inputType)))&&(e.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let t=(null===(n=window.visualViewport)||void 0===n?void 0:n.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())}),100)}return Zt.ios&&"deleteContentForward"==t.inputType&&e.observer.flushSoon(),Zt.safari&&"insertText"==t.inputType&&e.inputState.composing>=0&&setTimeout((()=>zn.compositionend(e,t)),20),!1};const hs=new Set,ds=["pre-wrap","normal","pre-line","break-spaces"];let us=!1;function ps(){us=!1}class fs{constructor(e){this.lineWrapping=e,this.doc=m.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return ds.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let n=e[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(t=!0,this.heightSamples[Math.floor(10*n)]=!0)}return t}refresh(e,t,i,n,s,o){let a=ds.indexOf(e)>-1,r=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=t,this.charWidth=i,this.textHeight=n,this.lineLength=s,r){this.heightSamples={};for(let e=0;e<o.length;e++){let t=o[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return r}}class ms{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class gs{constructor(e,t,i,n,s){this.from=e,this.length=t,this.top=i,this.height=n,this._content=s}get type(){return"number"==typeof this._content?si.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof li?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new gs(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var bs=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(bs||(bs={}));const vs=.001;class ws{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>vs&&(us=!0),this.height=e)}replace(e,t,i){return ws.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,n){let s=this,o=i.doc;for(let a=n.length-1;a>=0;a--){let{fromA:r,toA:l,fromB:c,toB:h}=n[a],d=s.lineAt(r,bs.ByPosNoHeight,i.setDoc(t),0,0),u=d.to>=l?d:s.lineAt(l,bs.ByPosNoHeight,i,0,0);for(h+=u.to-l,l=u.to;a>0&&d.from<=n[a-1].toA;)r=n[a-1].fromA,c=n[a-1].fromB,a--,r<d.from&&(d=s.lineAt(r,bs.ByPosNoHeight,i,0,0));c+=d.from-r,r=d.from;let p=_s.build(i.setDoc(o),e,c,h);s=ys(s,s.replace(r,l,p))}return s.updateHeight(i,0)}static empty(){return new xs(0,0)}static of(e){if(1==e.length)return e[0];let t=0,i=e.length,n=0,s=0;for(;;)if(t==i)if(n>2*s){let s=e[t-1];s.break?e.splice(--t,1,s.left,null,s.right):e.splice(--t,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let t=e[i];t.break?e.splice(i,1,t.left,null,t.right):e.splice(i,1,t.left,t.right),i+=2+t.break,s-=t.size}}else if(n<s){let i=e[t++];i&&(n+=i.size)}else{let t=e[--i];t&&(s+=t.size)}let o=0;return null==e[t-1]?(o=1,t--):null==e[t]&&(o=1,i++),new Cs(ws.of(e.slice(0,t)),o,ws.of(e.slice(i)))}}function ys(e,t){return e==t?e:(e.constructor!=t.constructor&&(us=!0),t)}ws.prototype.size=1;class Os extends ws{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,n){return new gs(n,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(e,t,i,n,s,o){e<=s+this.length&&t>=s&&o(this.blockAt(0,i,n,s))}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class xs extends Os{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,n){return new gs(n,this.length,i,this.height,this.breaks)}replace(e,t,i){let n=i[0];return 1==i.length&&(n instanceof xs||n instanceof $s&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof $s?n=new xs(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):ws.of(i)}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more?this.setHeight(n.heights[n.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class $s extends ws{constructor(e){super(e,0)}heightMetrics(e,t){let i,n=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,o=s-n+1,a=0;if(e.lineWrapping){let t=Math.min(this.height,e.lineHeight*o);i=t/o,this.length>o+1&&(a=(this.height-t)/(this.length-o-1))}else i=this.height/o;return{firstLine:n,lastLine:s,perLine:i,perChar:a}}blockAt(e,t,i,n){let{firstLine:s,lastLine:o,perLine:a,perChar:r}=this.heightMetrics(t,n);if(t.lineWrapping){let s=n+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),o=t.doc.lineAt(s),l=a+o.length*r,c=Math.max(i,e-l/2);return new gs(o.from,o.length,c,l,0)}{let n=Math.max(0,Math.min(o-s,Math.floor((e-i)/a))),{from:r,length:l}=t.doc.line(s+n);return new gs(r,l,i+a*n,a,0)}}lineAt(e,t,i,n,s){if(t==bs.ByHeight)return this.blockAt(e,i,n,s);if(t==bs.ByPosNoHeight){let{from:t,to:n}=i.doc.lineAt(e);return new gs(t,n-t,0,0,0)}let{firstLine:o,perLine:a,perChar:r}=this.heightMetrics(i,s),l=i.doc.lineAt(e),c=a+l.length*r,h=l.number-o,d=n+a*h+r*(l.from-s-h);return new gs(l.from,l.length,Math.max(n,Math.min(d,n+this.height-c)),c,0)}forEachLine(e,t,i,n,s,o){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:a,perLine:r,perChar:l}=this.heightMetrics(i,s);for(let c=e,h=n;c<=t;){let t=i.doc.lineAt(c);if(c==e){let i=t.number-a;h+=r*i+l*(e-s-i)}let n=r+l*t.length;o(new gs(t.from,t.length,h,n,0)),h+=n,c=t.to+1}}replace(e,t,i){let n=this.length-t;if(n>0){let e=i[i.length-1];e instanceof $s?i[i.length-1]=new $s(e.length+n):i.push(null,new $s(n-1))}if(e>0){let t=i[0];t instanceof $s?i[0]=new $s(e+t.length):i.unshift(new $s(e-1),null)}return ws.of(i)}decomposeLeft(e,t){t.push(new $s(e-1),null)}decomposeRight(e,t){t.push(null,new $s(this.length-e-1))}updateHeight(e,t=0,i=!1,n){let s=t+this.length;if(n&&n.from<=t+this.length&&n.more){let i=[],o=Math.max(t,n.from),a=-1;for(n.from>t&&i.push(new $s(n.from-t-1).updateHeight(e,t));o<=s&&n.more;){let t=e.doc.lineAt(o).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==a?a=s:Math.abs(s-a)>=vs&&(a=-2);let r=new xs(t,s);r.outdated=!1,i.push(r),o+=t+1}o<=s&&i.push(null,new $s(s-o).updateHeight(e,o));let r=ws.of(i);return(a<0||Math.abs(r.height-this.height)>=vs||Math.abs(a-this.heightMetrics(e,t).perLine)>=vs)&&(us=!0),ys(this,r)}return(i||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Cs extends ws{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,n){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,n):this.right.blockAt(e,t,s,n+this.left.length+this.break)}lineAt(e,t,i,n,s){let o=n+this.left.height,a=s+this.left.length+this.break,r=t==bs.ByHeight?e<o:e<a,l=r?this.left.lineAt(e,t,i,n,s):this.right.lineAt(e,t,i,o,a);if(this.break||(r?l.to<a:l.from>a))return l;let c=t==bs.ByPosNoHeight?bs.ByPosNoHeight:bs.ByPos;return r?l.join(this.right.lineAt(a,c,i,o,a)):this.left.lineAt(a,c,i,n,s).join(l)}forEachLine(e,t,i,n,s,o){let a=n+this.left.height,r=s+this.left.length+this.break;if(this.break)e<r&&this.left.forEachLine(e,t,i,n,s,o),t>=r&&this.right.forEachLine(e,t,i,a,r,o);else{let l=this.lineAt(r,bs.ByPos,i,n,s);e<l.from&&this.left.forEachLine(e,l.from-1,i,n,s,o),l.to>=e&&l.from<=t&&o(l),t>l.to&&this.right.forEachLine(l.to+1,t,i,a,r,o)}}replace(e,t,i){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let e of i)s.push(e);if(e>0&&Ss(s,o-1),t<this.length){let e=s.length;this.decomposeRight(t,s),Ss(s,e)}return ws.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,n=i+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?ws.of(this.break?[e,null,t]:[e,t]):(this.left=ys(this.left,e),this.right=ys(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,n){let{left:s,right:o}=this,a=t+s.length+this.break,r=null;return n&&n.from<=t+s.length&&n.more?r=s=s.updateHeight(e,t,i,n):s.updateHeight(e,t,i),n&&n.from<=a+o.length&&n.more?r=o=o.updateHeight(e,a,i,n):o.updateHeight(e,a,i),r?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Ss(e,t){let i,n;null==e[t]&&(i=e[t-1])instanceof $s&&(n=e[t+1])instanceof $s&&e.splice(t-1,3,new $s(i.length+1+n.length))}class _s{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof xs?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new xs(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0,s=i.widget?i.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let o=t-e;i.block?this.addBlock(new Os(o,n,i)):(o||s||n>=5)&&this.addLineDeco(n,s,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new xs(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new $s(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof xs)return e;let t=new xs(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let n=this.ensureLine();n.length+=i,n.collapsed+=i,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof xs||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new xs(0,-1));let i=e;for(let e of this.nodes)e instanceof xs&&e.updateHeight(this.oracle,i),i+=e?e.length:1;return this.nodes}static build(e,t,i,n){let s=new _s(i,e);return De.spans(t,i,n,s,0),s.finish(i)}}class ks{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,n){(e<t||i&&i.heightRelevant||n&&n.heightRelevant)&&hi(e,t,this.changes,5)}}function Es(e,t){let i=e.getBoundingClientRect(),n=e.ownerDocument,s=n.defaultView||window,o=Math.max(0,i.left),a=Math.min(s.innerWidth,i.right),r=Math.max(0,i.top),l=Math.min(s.innerHeight,i.bottom);for(let t=e.parentNode;t&&t!=n.body;)if(1==t.nodeType){let i=t,n=window.getComputedStyle(i);if((i.scrollHeight>i.clientHeight||i.scrollWidth>i.clientWidth)&&"visible"!=n.overflow){let n=i.getBoundingClientRect();o=Math.max(o,n.left),a=Math.min(a,n.right),r=Math.max(r,n.top),l=Math.min(t==e.parentNode?s.innerHeight:l,n.bottom)}t="absolute"==n.position||"fixed"==n.position?i.offsetParent:i.parentNode}else{if(11!=t.nodeType)break;t=t.host}return{left:o-i.left,right:Math.max(o,a)-i.left,top:r-(i.top+t),bottom:Math.max(r,l)-(i.top+t)}}function Ps(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}class As{constructor(e,t,i,n){this.from=e,this.to=t,this.size=i,this.displaySize=n}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],s=t[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(e,t){return oi.replace({widget:new Rs(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Rs extends ni{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class Ds{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Bs,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=bi.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(on).some((e=>"function"!=typeof e&&"cm-lineWrapping"==e.class));this.heightOracle=new fs(t),this.stateDeco=e.facet(an).filter((e=>"function"!=typeof e)),this.heightMap=ws.empty().applyChanges(this.stateDeco,m.empty,this.heightOracle.setDoc(e.doc),[new fn(0,0,0,e.doc.length)]);for(let e=0;e<2&&(this.viewport=this.getViewport(0,null),this.updateForViewport());e++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=oi.set(this.lineGaps.map((e=>e.draw(this,!1)))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let n=i?t.head:t.anchor;if(!e.some((({from:e,to:t})=>n>=e&&n<=t))){let{from:t,to:i}=this.lineBlockAt(n);e.push(new Vs(t,i))}}return this.viewports=e.sort(((e,t)=>e.from-t.from)),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?Bs:new Fs(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,(e=>{this.viewportLines.push(Is(e,this.scaler))}))}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(an).filter((e=>"function"!=typeof e));let n=e.changedRanges,s=fn.extendWithRanges(n,function(e,t,i){let n=new ks;return De.compare(e,t,i,n,0),n.changes}(i,this.stateDeco,e?e.changes:D.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);ps(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=o||us)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let r=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<r.from||t.range.head>r.to)||!this.viewportIsAppropriate(r))&&(r=this.getViewport(0,t));let l=r.from!=this.viewport.from||r.to!=this.viewport.to;this.viewport=r,e.flags|=this.updateForViewport(),(l||!e.changes.empty||2&e.flags)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(zi)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),n=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?bi.RTL:bi.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),a=t.getBoundingClientRect(),r=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let l=0,c=0;if(a.width&&a.height){let{scaleX:e,scaleY:i}=mt(t,a);(e>.005&&Math.abs(this.scaleX-e)>.005||i>.005&&Math.abs(this.scaleY-i)>.005)&&(this.scaleX=e,this.scaleY=i,l|=16,o=r=!0)}let h=(parseInt(i.paddingTop)||0)*this.scaleY,d=(parseInt(i.paddingBottom)||0)*this.scaleY;this.paddingTop==h&&this.paddingBottom==d||(this.paddingTop=h,this.paddingBottom=d,l|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(r=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=16);let u=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=u&&(this.scrollAnchorHeight=-1,this.scrollTop=u),this.scrolledToBottom=$t(e.scrollDOM);let p=(this.printing?Ps:Es)(t,this.paddingTop),f=p.top-this.pixelViewport.top,g=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let b=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(b!=this.inView&&(this.inView=b,b&&(r=!0)),!this.inView&&!this.scrollTarget&&!function(e){let t=e.getBoundingClientRect(),i=e.ownerDocument.defaultView||window;return t.left<i.innerWidth&&t.right>0&&t.top<i.innerHeight&&t.bottom>0}(e.dom))return 0;let v=a.width;if(this.contentDOMWidth==v&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,l|=16),r){let t=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(t)&&(o=!0),o||n.lineWrapping&&Math.abs(v-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:a,textHeight:r}=e.docView.measureTextSize();o=i>0&&n.refresh(s,i,a,r,v/a,t),o&&(e.docView.minWidth=0,l|=16)}f>0&&g>0?c=Math.max(f,g):f<0&&g<0&&(c=Math.min(f,g)),ps();for(let i of this.viewports){let s=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=(o?ws.empty().applyChanges(this.stateDeco,m.empty,this.heightOracle,[new fn(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,o,new ms(i.from,s))}us&&(l|=2)}let w=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return w&&(2&l&&(l|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),l|=this.updateForViewport()),(2&l||w)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,r=new Vs(n.lineAt(o-1e3*i,bs.ByHeight,s,0,0).from,n.lineAt(a+1e3*(1-i),bs.ByHeight,s,0,0).to);if(t){let{head:e}=t.range;if(e<r.from||e>r.to){let i,o=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),a=n.lineAt(e,bs.ByPos,s,0,0);i="center"==t.y?(a.top+a.bottom)/2-o/2:"start"==t.y||"nearest"==t.y&&e<r.from?a.top:a.bottom-o,r=new Vs(n.lineAt(i-500,bs.ByHeight,s,0,0).from,n.lineAt(i+o+500,bs.ByHeight,s,0,0).to)}}return r}mapViewport(e,t){let i=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new Vs(this.heightMap.lineAt(i,bs.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,bs.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,bs.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,bs.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(0==e||n<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=a+Math.max(10,Math.min(i,250)))&&n>o-2e3&&s<a+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let n of e)t.touchesRange(n.from,n.to)||i.push(new As(t.mapPos(n.from),t.mapPos(n.to),n.size,n.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,n=i?1e4:2e3,s=n>>1,o=n<<1;if(this.defaultTextDirection!=bi.LTR&&!i)return[];let a=[],r=(n,o,l,c)=>{if(o-n<s)return;let h=this.state.selection.main,d=[h.from];h.empty||d.push(h.to);for(let e of d)if(e>n&&e<o)return r(n,e-10,l,c),void r(e+10,o,l,c);let u=function(e,t){for(let i of e)if(t(i))return i}(e,(e=>e.from>=l.from&&e.to<=l.to&&Math.abs(e.from-n)<s&&Math.abs(e.to-o)<s&&!d.some((t=>e.from<t&&e.to>t))));if(!u){if(o<l.to&&t&&i&&t.visibleRanges.some((e=>e.from<=o&&e.to>=o))){let e=t.moveToLineBoundary(M.cursor(o),!1,!0).head;e>n&&(o=e)}let e=this.gapSize(l,n,o,c);u=new As(n,o,e,i||e<2e6?e:2e6)}a.push(u)},l=t=>{if(t.length<o||t.type!=si.Text)return;let s=function(e,t,i){let n=[],s=e,o=0;return De.spans(i,e,t,{span(){},point(e,t){e>s&&(n.push({from:s,to:e}),o+=e-s),s=t}},20),s<t&&(n.push({from:s,to:t}),o+=t-s),{total:o,ranges:n}}(t.from,t.to,this.stateDeco);if(s.total<o)return;let a,l,c=this.scrollTarget?this.scrollTarget.range.head:null;if(i){let e,i,o=n/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=c){let n=Ts(s,c),a=((this.visibleBottom-this.visibleTop)/2+o)/t.height;e=n-a,i=n+a}else e=(this.visibleTop-t.top-o)/t.height,i=(this.visibleBottom-t.top+o)/t.height;a=Ls(s,e),l=Ls(s,i)}else{let i=s.total*this.heightOracle.charWidth,o=n*this.heightOracle.charWidth,r=0;if(i>2e6)for(let i of e)i.from>=t.from&&i.from<t.to&&i.size!=i.displaySize&&i.from*this.heightOracle.charWidth+r<this.pixelViewport.left&&(r=i.size-i.displaySize);let h,d,u=this.pixelViewport.left+r,p=this.pixelViewport.right+r;if(null!=c){let e=Ts(s,c),t=((p-u)/2+o)/i;h=e-t,d=e+t}else h=(u-o)/i,d=(p+o)/i;a=Ls(s,h),l=Ls(s,d)}a>t.from&&r(t.from,a,t,s),l<t.to&&r(l,t.to,t,s)};for(let e of this.viewportLines)Array.isArray(e.type)?e.type.forEach(l):l(e);return a}gapSize(e,t,i,n){let s=Ts(n,i)-Ts(n,t);return this.heightOracle.lineWrapping?e.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(e){As.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=oi.set(e.map((e=>e.draw(this,this.heightOracle.lineWrapping)))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];De.spans(t,this.viewport.from,this.viewport.to,{span(e,t){i.push({from:e,to:t})},point(){}},20);let n=0;if(i.length!=this.visibleRanges.length)n=12;else for(let t=0;t<i.length&&!(8&n);t++){let s=this.visibleRanges[t],o=i[t];s.from==o.from&&s.to==o.to||(n|=4,e&&e.mapPos(s.from,-1)==o.from&&e.mapPos(s.to,1)==o.to||(n|=8))}return this.visibleRanges=i,n}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find((t=>t.from<=e&&t.to>=e))||Is(this.heightMap.lineAt(e,bs.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find((t=>t.top<=e&&t.bottom>=e))||Is(this.heightMap.lineAt(this.scaler.fromDOM(e),bs.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Is(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Vs{constructor(e,t){this.from=e,this.to=t}}function Ls({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let n=Math.floor(e*i);for(let e=0;;e++){let{from:i,to:s}=t[e],o=s-i;if(n<=o)return i+n;n-=o}}function Ts(e,t){let i=0;for(let{from:n,to:s}of e.ranges){if(t<=s){i+=t-n;break}i+=s-n}return i/e.total}const Bs={toDOM:e=>e,fromDOM:e=>e,scale:1,eq(e){return e==this}};class Fs{constructor(e,t,i){let n=0,s=0,o=0;this.viewports=i.map((({from:i,to:s})=>{let o=t.lineAt(i,bs.ByPos,e,0,0).top,a=t.lineAt(s,bs.ByPos,e,0,0).bottom;return n+=a-o,{from:i,to:s,top:o,bottom:a,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(t.height-n);for(let e of this.viewports)e.domTop=o+(e.top-s)*this.scale,o=e.domBottom=e.domTop+(e.bottom-e.top),s=e.bottom}toDOM(e){for(let t=0,i=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return n+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,n=s.domBottom}}fromDOM(e){for(let t=0,i=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-n)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,n=s.domBottom}}eq(e){return e instanceof Fs&&this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every(((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to))}}function Is(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),n=t.toDOM(e.bottom);return new gs(e.from,e.length,i,n-i,Array.isArray(e._content)?e._content.map((e=>Is(e,t))):e._content)}const js=N.define({combine:e=>e.join(" ")}),Ms=N.define({combine:e=>e.indexOf(!0)>-1}),Qs=Ge.newName(),Ws=Ge.newName(),Ns=Ge.newName(),Zs={"&light":"."+Ws,"&dark":"."+Ns};function qs(e,t,i){return new Ge(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,(t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]})):e+" "+t})}const zs=qs("."+Qs,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Zs),Us={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Xs=Zt.ie&&Zt.ie_version<=11;class Gs{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new gt,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver((t=>{for(let e of t)this.queue.push(e);(Zt.ie&&Zt.ie_version<=11||Zt.ios&&e.composing)&&t.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),!window.EditContext||!1===e.constructor.EDIT_CONTEXT||Zt.chrome&&Zt.chrome_version<126||(this.editContext=new Ks(e),e.state.facet(Ki)&&(e.contentDOM.editContext=this.editContext.editContext)),Xs&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver((()=>{var e;(null===(e=this.view.docView)||void 0===e?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()})),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(e){("change"!=e.type&&e.type||e.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some(((t,i)=>t!=e[i])))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,n=this.selectionRange;if(i.state.facet(Ki)?i.root.activeElement!=this.dom:!at(this.dom,n))return;let s=n.anchorNode&&i.docView.nearest(n.anchorNode);s&&s.ignoreEvent(e)?t||(this.selectionChanged=!1):(Zt.ie&&Zt.ie_version<=11||Zt.android&&Zt.chrome)&&!i.state.selection.main.empty&&n.focusNode&&lt(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=st(e.root);if(!t)return!1;let i=Zt.safari&&11==e.root.nodeType&&e.root.activeElement==this.dom&&function(e,t){if(t.getComposedRanges){let i=t.getComposedRanges(e.root)[0];if(i)return Hs(e,i)}let i=null;function n(e){e.preventDefault(),e.stopImmediatePropagation(),i=e.getTargetRanges()[0]}return e.contentDOM.addEventListener("beforeinput",n,!0),e.dom.ownerDocument.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",n,!0),i?Hs(e,i):null}(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let n=at(this.dom,i);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&function(e,t){let i=t.focusNode,n=t.focusOffset;if(!i||t.anchorNode!=i||t.anchorOffset!=n)return!1;for(n=Math.min(n,ut(i));;)if(n){if(1!=i.nodeType)return!1;let e=i.childNodes[n-1];"false"==e.contentEditable?n--:(i=e,n=ut(i))}else{if(i==e)return!0;n=ct(i),i=i.parentNode}}(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Us),Xs&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Xs&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let e=()=>{let e=this.delayedAndroidKey;e&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=e.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&e.force&&Ot(this.dom,e.key,e.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(e)}this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(null===(i=this.delayedAndroidKey)||void 0===i?void 0:i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame((()=>{this.delayedFlush=-1,this.flush()})))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,n=!1;for(let s of e){let e=this.readMutation(s);e&&(e.typeOver&&(n=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:n}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),n=this.selectionChanged&&at(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new Ln(this.view,e,t,i);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,n=Tn(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),n}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.flags|=4),"childList"==e.type){let i=Ys(t,e.previousSibling||e.target.previousSibling,-1),n=Ys(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(Ki)!=e.state.facet(Ki)&&(e.view.contentDOM.editContext=e.state.facet(Ki)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resizeScroll)||void 0===i||i.disconnect();for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Ys(e,t,i){for(;t;){let n=Et.get(t);if(n&&n.parent==e)return n;let s=t.parentNode;t=s!=e.dom?s:i>0?t.nextSibling:t.previousSibling}return null}function Hs(e,t){let i=t.startContainer,n=t.startOffset,s=t.endContainer,o=t.endOffset,a=e.docView.domAtPos(e.state.selection.main.anchor);return lt(a.node,a.offset,s,o)&&([i,n,s,o]=[s,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:o}}class Ks{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=t=>{let i=e.state.selection.main,{anchor:n,head:s}=i,o=this.toEditorPos(t.updateRangeStart),a=this.toEditorPos(t.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:t.updateRangeStart,editorBase:o,drifted:!1});let r={from:o,to:a,insert:m.of(t.text.split("\n"))};if(r.from==this.from&&n<this.from?r.from=n:r.to==this.to&&n>this.to&&(r.to=n),r.from!=r.to||r.insert.length){if((Zt.mac||Zt.android)&&r.from==s-1&&/^\. ?$/.test(t.text)&&"off"==e.contentDOM.getAttribute("autocorrect")&&(r={from:o,to:a,insert:m.of([t.text.replace("."," ")])}),this.pendingContextChange=r,!e.state.readOnly){let i=this.to-this.from+(r.to-r.from+r.insert.length);Bn(e,r,M.single(this.toEditorPos(t.selectionStart,i),this.toEditorPos(t.selectionEnd,i)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))}else{let n=M.single(this.toEditorPos(t.selectionStart),this.toEditorPos(t.selectionEnd));n.main.eq(i)||e.dispatch({selection:n,userEvent:"select"})}},this.handlers.characterboundsupdate=i=>{let n=[],s=null;for(let t=this.toEditorPos(i.rangeStart),o=this.toEditorPos(i.rangeEnd);t<o;t++){let i=e.coordsForChar(t);s=i&&new DOMRect(i.left,i.top,i.right-i.left,i.bottom-i.top)||s||new DOMRect,n.push(s)}t.updateCharacterBounds(i.rangeStart,n)},this.handlers.textformatupdate=t=>{let i=[];for(let e of t.getTextFormats()){let t=e.underlineStyle,n=e.underlineThickness;if("None"!=t&&"None"!=n){let s=this.toEditorPos(e.rangeStart),o=this.toEditorPos(e.rangeEnd);if(s<o){let e=`text-decoration: underline ${"Dashed"==t?"dashed ":"Squiggle"==t?"wavy ":""}${"Thin"==n?1:2}px`;i.push(oi.mark({attributes:{style:e}}).range(s,o))}}}e.dispatch({effects:Yi.of(oi.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:t}=this.composing;this.composing=null,t&&this.reset(e.state)}};for(let e in this.handlers)t.addEventListener(e,this.handlers[e]);this.measureReq={read:e=>{this.editContext.updateControlBounds(e.contentDOM.getBoundingClientRect());let t=st(e.root);t&&t.rangeCount&&this.editContext.updateSelectionBounds(t.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,n=this.pendingContextChange;return e.changes.iterChanges(((s,o,a,r,l)=>{if(i)return;let c=l.length-(o-s);if(n&&o>=n.to){if(n.from==s&&n.to==o&&n.insert.eq(l))return n=this.pendingContextChange=null,t+=c,void(this.to+=c);n=null,this.revertPending(e.state)}if(s+=t,(o+=t)<=this.from)this.from+=c,this.to+=c;else if(s<this.to){if(s<this.from||o>this.to||this.to-this.from+l.length>3e4)return void(i=!0);this.editContext.updateText(this.toContextPos(s),this.toContextPos(o),l.toString()),this.to+=c}t+=c})),n&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some((e=>!e.isUserEvent("input.type")&&e.changes.touchesRange(this.from,this.to))))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):this.applyEdits(e)&&this.rangeIsValid(e.state)?(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state):(this.pendingContextChange=null,this.reset(e.state)),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),n=this.toContextPos(t.head);this.editContext.selectionStart==i&&this.editContext.selectionEnd==n||this.editContext.updateSelection(i,n)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>3e4)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Js{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(e=>e.forEach((e=>i(e,this))))||(e=>this.update(e)),this.dispatch=this.dispatch.bind(this),this._root=e.root||function(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}(e.parent)||document,this.viewState=new Ds(e.state||_e.create(e)),e.scrollTo&&e.scrollTo.is(Gi)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(en).map((e=>new nn(e)));for(let e of this.plugins)e.update(this);this.observer=new Gs(this),this.inputState=new Fn(this),this.inputState.ensureHandlers(this.plugins),this.docView=new gn(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),(null===(t=document.fonts)||void 0===t?void 0:t.ready)&&document.fonts.ready.then((()=>this.requestMeasure()))}dispatch(...e){let t=1==e.length&&e[0]instanceof ge?e:1==e.length&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,n=!1,s=this.state;for(let t of e){if(t.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=t.state}if(this.destroyed)return void(this.viewState.state=s);let o=this.hasFocus,a=0,r=null;e.some((e=>e.annotation(rs)))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,r=ls(s,o),r||(a=1));let l=this.observer.delayedAndroidKey,c=null;if(l?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(c=null)):this.observer.clear(),s.facet(_e.phrases)!=this.state.facet(_e.phrases))return this.setState(s);t=mn.create(this,s,e),t.flags|=a;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(h&&(h=h.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;h=new Xi(e.empty?e:M.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(Gi)&&(h=e.value.clip(this.state))}this.viewState.update(t,h),this.bidiCache=io.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(pn)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some((e=>e.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(t.startState.facet(js)!=t.state.facet(js)&&(this.viewState.mustMeasureContent=!0),(i||n||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),i&&this.docViewUpdate(),!t.empty)for(let e of this.state.facet(Mi))try{e(t)}catch(e){Hi(this.state,e,"update listener")}(r||c)&&Promise.resolve().then((()=>{r&&this.state==r.startState&&this.dispatch(r),c&&!Tn(this,c)&&l.force&&Ot(this.contentDOM,l.key,l.keyCode)}))}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new Ds(e),this.plugins=e.facet(en).map((e=>new nn(e))),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView.destroy(),this.docView=new gn(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(en),i=e.state.facet(en);if(t!=i){let n=[];for(let s of i){let i=t.indexOf(s);if(i<0)n.push(new nn(s));else{let t=this.plugins[i];t.mustUpdate=e,n.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let t of this.plugins)t.mustUpdate=e;for(let e=0;e<this.plugins.length;e++)this.plugins[e].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(e){Hi(this.state,e,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,n=i.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let e=0;;e++){if(o<0)if($t(i))s=-1,o=this.viewState.heightMap.height;else{let e=this.viewState.scrollAnchorAt(n);s=e.from,o=e.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let r=[];4&a||([this.measureRequests,r]=[r,this.measureRequests]);let l=r.map((e=>{try{return e.read(this)}catch(e){return Hi(this.state,e),to}})),c=mn.create(this,this.state,[]),h=!1;c.flags|=a,t?t.flags|=a:t=c,this.updateState=2,c.empty||(this.updatePlugins(c),this.inputState.update(c),this.updateAttrs(),h=this.docView.update(c),h&&this.docViewUpdate());for(let e=0;e<r.length;e++)if(l[e]!=to)try{let t=r[e];t.write&&t.write(l[e],this)}catch(e){Hi(this.state,e)}if(h&&this.docView.updateSelection(!0),!c.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}{let e=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(e>1||e<-1){n+=e,i.scrollTop=n/this.scaleY,o=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let e of this.state.facet(Mi))e(t)}get themeClasses(){return Qs+" "+(this.state.facet(Ms)?Ns:Ws)+" "+this.state.facet(js)}updateAttrs(){let e=no(this,sn,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(Ki)?"true":"false",class:"cm-content",style:`${Zt.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),no(this,on,t);let i=this.observer.ignore((()=>{let i=ti(this.contentDOM,this.contentAttrs,t),n=ti(this.dom,this.editorAttrs,e);return i||n}));return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let e of i.effects)e.is(Js.announce)&&(t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value)}mountStyles(){this.styleModules=this.state.facet(pn);let e=this.state.facet(Js.cspNonce);Ge.mount(this.root,this.styleModules.concat(zs).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame((()=>this.measure()))),e){if(this.measureRequests.indexOf(e)>-1)return;if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find((t=>t.spec==e))||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return An(this,e,En(this,e,t,i))}moveByGroup(e,t){return An(this,e,En(this,e,t,(t=>function(e,t,i){let n=e.state.charCategorizer(t),s=n(i);return e=>{let t=n(e);return s==$e.Space&&(s=t),s==t}}(this,e.head,t))))}visualLineSide(e,t){let i=this.bidiSpans(e),n=this.textDirectionAt(e.from),s=i[t?i.length-1:0];return M.cursor(s.side(t,n)+e.from,s.forward(!t,n)?1:-1)}moveToLineBoundary(e,t,i=!0){return function(e,t,i,n){let s=kn(e,t.head),o=n&&s.type==si.Text&&(e.lineWrapping||s.widgetLineBreaks)?e.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head):null;if(o){let t=e.dom.getBoundingClientRect(),n=e.textDirectionAt(s.from),a=e.posAtCoords({x:i==(n==bi.LTR)?t.right-1:t.left+1,y:(o.top+o.bottom)/2});if(null!=a)return M.cursor(a,i?-1:1)}return M.cursor(i?s.to:s.from,i?-1:1)}(this,e,t,i)}moveVertically(e,t,i){return An(this,e,function(e,t,i,n){let s=t.head,o=i?1:-1;if(s==(i?e.state.doc.length:0))return M.cursor(s,t.assoc);let a,r=t.goalColumn,l=e.contentDOM.getBoundingClientRect(),c=e.coordsAtPos(s,t.assoc||-1),h=e.documentTop;if(c)null==r&&(r=c.left-l.left),a=o<0?c.top:c.bottom;else{let t=e.viewState.lineBlockAt(s);null==r&&(r=Math.min(l.right-l.left,e.defaultCharacterWidth*(s-t.from))),a=(o<0?t.top:t.bottom)+h}let d=l.left+r,u=null!=n?n:e.viewState.heightOracle.textHeight>>1;for(let t=0;;t+=10){let i=a+(u+t)*o,n=Sn(e,{x:d,y:i},!1,o);if(i<l.top||i>l.bottom||(o<0?n<s:n>s)){let t=e.docView.coordsForChar(n),s=!t||i<t.top?-1:1;return M.cursor(n,s,void 0,r)}}}(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),Sn(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(e),s=this.bidiSpans(n);return pt(i,s[ki.find(s,e-n.from,-1,t)].dir==bi.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(qi)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>eo)return Di(e.length);let t,i=this.textDirectionAt(e.from);for(let n of this.bidiCache)if(n.from==e.from&&n.dir==i&&(n.fresh||Ei(n.isolates,t=hn(this,e))))return n.order;t||(t=hn(this,e));let n=function(e,t,i){if(!e)return[new ki(0,0,t==wi?1:0)];if(t==vi&&!i.length&&!_i.test(e))return Di(e.length);if(i.length)for(;e.length>Pi.length;)Pi[Pi.length]=256;let n=[],s=t==vi?0:1;return Ri(e,s,s,i,0,e.length,n),n}(e.text,i,t);return this.bidiCache.push(new io(e.from,e.to,i,t,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Zt.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{wt(this.contentDOM),this.docView.updateSelection()}))}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((9==e.nodeType?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Gi.of(new Xi("number"==typeof e?M.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return Gi.of(new Xi(M.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){null==e?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:"boolean"==typeof e?this.inputState.tabFocusMode=e?0:-1:0!=this.inputState.tabFocusMode&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return tn.define((()=>({})),{eventHandlers:e})}static domEventObservers(e){return tn.define((()=>({})),{eventObservers:e})}static theme(e,t){let i=Ge.newName(),n=[js.of(i),pn.of(qs(`.${i}`,e))];return t&&t.dark&&n.push(Ms.of(!0)),n}static baseTheme(e){return K.lowest(pn.of(qs("."+Qs,e,Zs)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),n=i&&Et.get(i)||Et.get(e);return(null===(t=null==n?void 0:n.rootView)||void 0===t?void 0:t.view)||null}}Js.styleModule=pn,Js.inputHandler=Qi,Js.clipboardInputFilter=Ni,Js.clipboardOutputFilter=Zi,Js.scrollHandler=Ui,Js.focusChangeEffect=Wi,Js.perLineTextDirection=qi,Js.exceptionSink=ji,Js.updateListener=Mi,Js.editable=Ki,Js.mouseSelectionStyle=Ii,Js.dragMovesSelection=Fi,Js.clickAddsSelectionRange=Bi,Js.decorations=an,Js.outerDecorations=rn,Js.atomicRanges=ln,Js.bidiIsolatedRanges=cn,Js.scrollMargins=dn,Js.darkTheme=Ms,Js.cspNonce=N.define({combine:e=>e.length?e[0]:""}),Js.contentAttributes=on,Js.editorAttributes=sn,Js.lineWrapping=Js.contentAttributes.of({class:"cm-lineWrapping"}),Js.announce=me.define();const eo=4096,to={};class io{constructor(e,t,i,n,s,o){this.from=e,this.to=t,this.dir=i,this.isolates=n,this.fresh=s,this.order=o}static update(e,t){if(t.empty&&!e.some((e=>e.fresh)))return e;let i=[],n=e.length?e[e.length-1].dir:bi.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir!=n||t.touchesRange(o.from,o.to)||i.push(new io(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function no(e,t,i){for(let n=e.state.facet(t),s=n.length-1;s>=0;s--){let t=n[s],o="function"==typeof t?t(e):t;o&&Kt(o,i)}return i}const so=Zt.mac?"mac":Zt.windows?"win":Zt.linux?"linux":"key";function oo(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const ao=K.default(Js.domEventHandlers({keydown:(e,t)=>po(co(t.state),e,t,"editor")})),ro=N.define({enables:ao}),lo=new WeakMap;function co(e){let t=e.facet(ro),i=lo.get(t);return i||lo.set(t,i=function(e,t=so){let i=Object.create(null),n=Object.create(null),s=(e,t)=>{let i=n[e];if(null==i)n[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},o=(e,n,o,a,r)=>{var l,c;let h=i[e]||(i[e]=Object.create(null)),d=n.split(/ (?!$)/).map((e=>function(e,t){const i=e.split(/-(?!$)/);let n,s,o,a,r=i[i.length-1];"Space"==r&&(r=" ");for(let e=0;e<i.length-1;++e){const r=i[e];if(/^(cmd|meta|m)$/i.test(r))a=!0;else if(/^a(lt)?$/i.test(r))n=!0;else if(/^(c|ctrl|control)$/i.test(r))s=!0;else if(/^s(hift)?$/i.test(r))o=!0;else{if(!/^mod$/i.test(r))throw new Error("Unrecognized modifier name: "+r);"mac"==t?a=!0:s=!0}}return n&&(r="Alt-"+r),s&&(r="Ctrl-"+r),a&&(r="Meta-"+r),o&&(r="Shift-"+r),r}(e,t)));for(let t=1;t<d.length;t++){let i=d.slice(0,t).join(" ");s(i,!0),h[i]||(h[i]={preventDefault:!0,stopPropagation:!1,run:[t=>{let n=ho={view:t,prefix:i,scope:e};return setTimeout((()=>{ho==n&&(ho=null)}),4e3),!0}]})}let u=d.join(" ");s(u,!1);let p=h[u]||(h[u]={preventDefault:!1,stopPropagation:!1,run:(null===(c=null===(l=h._any)||void 0===l?void 0:l.run)||void 0===c?void 0:c.slice())||[]});o&&p.run.push(o),a&&(p.preventDefault=!0),r&&(p.stopPropagation=!0)};for(let n of e){let e=n.scope?n.scope.split(" "):["editor"];if(n.any)for(let t of e){let e=i[t]||(i[t]=Object.create(null));e._any||(e._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:s}=n;for(let t in e)e[t].run.push((e=>s(e,uo)))}let s=n[t]||n.key;if(s)for(let t of e)o(t,s,n.run,n.preventDefault,n.stopPropagation),n.shift&&o(t,"Shift-"+s,n.shift,n.preventDefault,n.stopPropagation)}return i}(t.reduce(((e,t)=>e.concat(t)),[]))),i}let ho=null,uo=null;function po(e,t,i,n){uo=t;let s=function(e){var t=!(et&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||tt&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?Je:Ke)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(t),o=E(_(s,0))==s.length&&" "!=s,a="",r=!1,l=!1,c=!1;ho&&ho.view==i&&ho.scope==n&&(a=ho.prefix+" ",Wn.indexOf(t.keyCode)<0&&(l=!0,ho=null));let h,d,u=new Set,p=e=>{if(e){for(let t of e.run)if(!u.has(t)&&(u.add(t),t(i)))return e.stopPropagation&&(c=!0),!0;e.preventDefault&&(e.stopPropagation&&(c=!0),l=!0)}return!1},f=e[n];return f&&(p(f[a+oo(s,t,!o)])?r=!0:o&&(t.altKey||t.metaKey||t.ctrlKey)&&!(Zt.windows&&t.ctrlKey&&t.altKey)&&(h=Ke[t.keyCode])&&h!=s?(p(f[a+oo(h,t,!0)])||t.shiftKey&&(d=Je[t.keyCode])!=s&&d!=h&&p(f[a+oo(d,t,!1)]))&&(r=!0):o&&t.shiftKey&&p(f[a+oo(s,t,!0)])&&(r=!0),!r&&p(f._any)&&(r=!0)),l&&(r=!0),r&&c&&t.stopPropagation(),uo=null,r}class fo{constructor(e,t,i,n,s){this.className=e,this.left=t,this.top=i,this.width=n,this.height=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className==this.className&&(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",null!=this.width&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,i){if(i.empty){let n=e.coordsAtPos(i.head,i.assoc||1);if(!n)return[];let s=mo(e);return[new fo(t,n.left-s.left,n.top-s.top,null,n.bottom-n.top)]}return function(e,t,i){if(i.to<=e.viewport.from||i.from>=e.viewport.to)return[];let n=Math.max(i.from,e.viewport.from),s=Math.min(i.to,e.viewport.to),o=e.textDirection==bi.LTR,a=e.contentDOM,r=a.getBoundingClientRect(),l=mo(e),c=a.querySelector(".cm-line"),h=c&&window.getComputedStyle(c),d=r.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),u=r.right-(h?parseInt(h.paddingRight):0),p=kn(e,n),f=kn(e,s),m=p.type==si.Text?p:null,g=f.type==si.Text?f:null;if(m&&(e.lineWrapping||p.widgetLineBreaks)&&(m=go(e,n,1,m)),g&&(e.lineWrapping||f.widgetLineBreaks)&&(g=go(e,s,-1,g)),m&&g&&m.from==g.from&&m.to==g.to)return v(w(i.from,i.to,m));{let t=m?w(i.from,null,m):y(p,!1),n=g?w(null,i.to,g):y(f,!0),s=[];return(m||p).to<(g||f).from-(m&&g?1:0)||p.widgetLineBreaks>1&&t.bottom+e.defaultLineHeight/2<n.top?s.push(b(d,t.bottom,u,n.top)):t.bottom<n.top&&e.elementAtHeight((t.bottom+n.top)/2).type==si.Text&&(t.bottom=n.top=(t.bottom+n.top)/2),v(t).concat(s).concat(v(n))}function b(e,i,n,s){return new fo(t,e-l.left,i-l.top,n-e,s-i)}function v({top:e,bottom:t,horizontal:i}){let n=[];for(let s=0;s<i.length;s+=2)n.push(b(i[s],e,i[s+1],t));return n}function w(t,i,n){let s=1e9,a=-1e9,r=[];function l(t,i,l,c,h){let p=e.coordsAtPos(t,t==n.to?-2:2),f=e.coordsAtPos(l,l==n.from?2:-2);p&&f&&(s=Math.min(p.top,f.top,s),a=Math.max(p.bottom,f.bottom,a),h==bi.LTR?r.push(o&&i?d:p.left,o&&c?u:f.right):r.push(!o&&c?d:f.left,!o&&i?u:p.right))}let c=null!=t?t:n.from,h=null!=i?i:n.to;for(let n of e.visibleRanges)if(n.to>c&&n.from<h)for(let s=Math.max(n.from,c),o=Math.min(n.to,h);;){let n=e.state.doc.lineAt(s);for(let a of e.bidiSpans(n)){let e=a.from+n.from,r=a.to+n.from;if(e>=o)break;r>s&&l(Math.max(e,s),null==t&&e<=c,Math.min(r,o),null==i&&r>=h,a.dir)}if(s=n.to+1,s>=o)break}return 0==r.length&&l(c,null==t,h,null==i,e.textDirection),{top:s,bottom:a,horizontal:r}}function y(e,t){let i=r.top+(t?e.top:e.bottom);return{top:i,bottom:i,horizontal:[]}}}(e,t,i)}}function mo(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==bi.LTR?t.left:t.right-e.scrollDOM.clientWidth*e.scaleX)-e.scrollDOM.scrollLeft*e.scaleX,top:t.top-e.scrollDOM.scrollTop*e.scaleY}}function go(e,t,i,n){let s=e.coordsAtPos(t,2*i);if(!s)return n;let o=e.dom.getBoundingClientRect(),a=(s.top+s.bottom)/2,r=e.posAtCoords({x:o.left+1,y:a}),l=e.posAtCoords({x:o.right-1,y:a});return null==r||null==l?n:{from:Math.max(n.from,Math.min(r,l)),to:Math.min(n.to,Math.max(r,l))}}class bo{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(vo)!=e.state.facet(vo)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){!1!==this.layer.updateOnDocViewUpdate&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,i=e.facet(vo);for(;t<i.length&&i[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;e==this.scaleX&&t==this.scaleY||(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some(((e,t)=>{return i=e,n=this.drawn[t],!(i.constructor==n.constructor&&i.eq(n));var i,n}))){let t=this.dom.firstChild,i=0;for(let n of e)n.update&&t&&n.constructor&&this.drawn[i].constructor&&n.update(t,this.drawn[i])?(t=t.nextSibling,i++):this.dom.insertBefore(n.draw(),t);for(;t;){let e=t.nextSibling;t.remove(),t=e}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const vo=N.define();function wo(e){return[tn.define((t=>new bo(t,e))),vo.of(e)]}const yo=!(Zt.ios&&Zt.webkit&&Zt.webkit_version<534),Oo=N.define({combine:e=>ke(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function xo(e={}){return[Oo.of(e),Co,_o,Eo,zi.of(!0)]}function $o(e){return e.startState.facet(Oo)!=e.state.facet(Oo)}const Co=wo({above:!0,markers(e){let{state:t}=e,i=t.facet(Oo),n=[];for(let s of t.selection.ranges){let o=s==t.selection.main;if(s.empty?!o||yo:i.drawRangeCursor){let t=o?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",i=s.empty?s:M.cursor(s.head,s.head>s.anchor?-1:1);for(let s of fo.forRange(e,t,i))n.push(s)}}return n},update(e,t){e.transactions.some((e=>e.selection))&&(t.style.animationName="cm-blink"==t.style.animationName?"cm-blink2":"cm-blink");let i=$o(e);return i&&So(e.state,t),e.docChanged||e.selectionSet||i},mount(e,t){So(t.state,e)},class:"cm-cursorLayer"});function So(e,t){t.style.animationDuration=e.facet(Oo).cursorBlinkRate+"ms"}const _o=wo({above:!1,markers:e=>e.state.selection.ranges.map((t=>t.empty?[]:fo.forRange(e,"cm-selectionBackground",t))).reduce(((e,t)=>e.concat(t))),update:(e,t)=>e.docChanged||e.selectionSet||e.viewportChanged||$o(e),class:"cm-selectionLayer"}),ko={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};yo&&(ko[".cm-line"].caretColor=ko[".cm-content"].caretColor="transparent !important");const Eo=K.highest(Js.theme(ko)),Po=me.define({map:(e,t)=>null==e?null:t.mapPos(e)}),Ao=Y.define({create:()=>null,update:(e,t)=>(null!=e&&(e=t.changes.mapPos(e)),t.effects.reduce(((e,t)=>t.is(Po)?t.value:e),e))}),Ro=tn.fromClass(class{constructor(e){this.view=e,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(e){var t;let i=e.state.field(Ao);null==i?null!=this.cursor&&(null===(t=this.cursor)||void 0===t||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(e.startState.field(Ao)!=i||e.docChanged||e.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:e}=this,t=e.state.field(Ao),i=null!=t&&e.coordsAtPos(t);if(!i)return null;let n=e.scrollDOM.getBoundingClientRect();return{left:i.left-n.left+e.scrollDOM.scrollLeft*e.scaleX,top:i.top-n.top+e.scrollDOM.scrollTop*e.scaleY,height:i.bottom-i.top}}drawCursor(e){if(this.cursor){let{scaleX:t,scaleY:i}=this.view;e?(this.cursor.style.left=e.left/t+"px",this.cursor.style.top=e.top/i+"px",this.cursor.style.height=e.height/i+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(e){this.view.state.field(Ao)!=e&&this.view.dispatch({effects:Po.of(e)})}},{eventObservers:{dragover(e){this.setDropPos(this.view.posAtCoords({x:e.clientX,y:e.clientY}))},dragleave(e){e.target!=this.view.contentDOM&&this.view.contentDOM.contains(e.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Do(e,t,i,n,s){t.lastIndex=0;for(let o,a=e.iterRange(i,n),r=i;!a.next().done;r+=a.value.length)if(!a.lineBreak)for(;o=t.exec(a.value);)s(r+o.index,o)}class Vo{constructor(e){const{regexp:t,decoration:i,decorate:n,boundary:s,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,n)this.addMatch=(e,t,i,s)=>n(s,i,i+e[0].length,e,t);else if("function"==typeof i)this.addMatch=(e,t,n,s)=>{let o=i(e,t,n);o&&s(n,n+e[0].length,o)};else{if(!i)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(e,t,n,s)=>s(n,n+e[0].length,i)}this.boundary=s,this.maxLength=o}createDeco(e){let t=new Ve,i=t.add.bind(t);for(let{from:t,to:n}of function(e,t){let i=e.visibleRanges;if(1==i.length&&i[0].from==e.viewport.from&&i[0].to==e.viewport.to)return i;let n=[];for(let{from:s,to:o}of i)s=Math.max(e.state.doc.lineAt(s).from,s-t),o=Math.min(e.state.doc.lineAt(o).to,o+t),n.length&&n[n.length-1].to>=s?n[n.length-1].to=o:n.push({from:s,to:o});return n}(e,this.maxLength))Do(e.state.doc,this.regexp,t,n,((t,n)=>this.addMatch(n,e,t,i)));return t.finish()}updateDeco(e,t){let i=1e9,n=-1;return e.docChanged&&e.changes.iterChanges(((t,s,o,a)=>{a>=e.view.viewport.from&&o<=e.view.viewport.to&&(i=Math.min(o,i),n=Math.max(a,n))})),e.viewportMoved||n-i>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),i,n):t}updateRange(e,t,i,n){for(let s of e.visibleRanges){let o=Math.max(s.from,i),a=Math.min(s.to,n);if(a>o){let i=e.state.doc.lineAt(o),n=i.to<a?e.state.doc.lineAt(a):i,r=Math.max(s.from,i.from),l=Math.min(s.to,n.to);if(this.boundary){for(;o>i.from;o--)if(this.boundary.test(i.text[o-1-i.from])){r=o;break}for(;a<n.to;a++)if(this.boundary.test(n.text[a-n.from])){l=a;break}}let c,h=[],d=(e,t,i)=>h.push(i.range(e,t));if(i==n)for(this.regexp.lastIndex=r-i.from;(c=this.regexp.exec(i.text))&&c.index<l-i.from;)this.addMatch(c,e,c.index+i.from,d);else Do(e.state.doc,this.regexp,r,l,((t,i)=>this.addMatch(i,e,t,d)));t=t.update({filterFrom:r,filterTo:l,filter:(e,t)=>e<r||t>l,add:h})}}return t}}const Lo=null!=/x/.unicode?"gu":"g",To=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\ufeff￹-￼]",Lo),Bo={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Fo=null;const Io=N.define({combine(e){let t=ke(e,{render:null,specialChars:To,addSpecialChars:null});return(t.replaceTabs=!function(){var e;if(null==Fo&&"undefined"!=typeof document&&document.body){let t=document.body.style;Fo=null!=(null!==(e=t.tabSize)&&void 0!==e?e:t.MozTabSize)}return Fo||!1}())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,Lo)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,Lo)),t}});function jo(e={}){return[Io.of(e),Mo||(Mo=tn.fromClass(class{constructor(e){this.view=e,this.decorations=oi.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(e.state.facet(Io)),this.decorations=this.decorator.createDeco(e)}makeDecorator(e){return new Vo({regexp:e.specialChars,decoration:(t,i,n)=>{let{doc:s}=i.state,o=_(t[0],0);if(9==o){let e=s.lineAt(n),t=i.state.tabSize,o=Ze(e.text,t,n-e.from);return oi.replace({widget:new Wo((t-o%t)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[o]||(this.decorationCache[o]=oi.replace({widget:new Qo(e,o)}))},boundary:e.replaceTabs?void 0:/[^]/})}update(e){let t=e.state.facet(Io);e.startState.facet(Io)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(e.view)):this.decorations=this.decorator.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations}))]}let Mo=null;class Qo extends ni{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=function(e){return e>=32?"•":10==e?"␤":String.fromCharCode(9216+e)}(this.code),i=e.state.phrase("Control character")+" "+(Bo[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,i,t);if(n)return n;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class Wo extends ni{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="\t",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const No=oi.line({class:"cm-activeLine"}),Zo=tn.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,i=[];for(let n of e.state.selection.ranges){let s=e.lineBlockAt(n.head);s.from>t&&(i.push(No.range(s.from)),t=s.from)}return oi.set(i)}},{decorations:e=>e.decorations}),qo=2e3;function zo(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1),n=e.state.doc.lineAt(i),s=i-n.from,o=s>qo?-1:s==n.length?function(e,t){let i=e.coordsAtPos(e.viewport.from);return i?Math.round(Math.abs((i.left-t)/e.defaultCharacterWidth)):-1}(e,t.clientX):Ze(n.text,e.state.tabSize,i-n.from);return{line:n.number,col:o,off:s}}function Uo(e){let t=(null==e?void 0:e.eventFilter)||(e=>e.altKey&&0==e.button);return Js.mouseSelectionStyle.of(((e,i)=>t(i)?function(e,t){let i=zo(e,t),n=e.state.selection;return i?{update(e){if(e.docChanged){let t=e.changes.mapPos(e.startState.doc.line(i.line).from),s=e.state.doc.lineAt(t);i={line:s.number,col:i.col,off:Math.min(i.off,s.length)},n=n.map(e.changes)}},get(t,s,o){let a=zo(e,t);if(!a)return n;let r=function(e,t,i){let n=Math.min(t.line,i.line),s=Math.max(t.line,i.line),o=[];if(t.off>qo||i.off>qo||t.col<0||i.col<0){let a=Math.min(t.off,i.off),r=Math.max(t.off,i.off);for(let t=n;t<=s;t++){let i=e.doc.line(t);i.length<=r&&o.push(M.range(i.from+a,i.to+r))}}else{let a=Math.min(t.col,i.col),r=Math.max(t.col,i.col);for(let t=n;t<=s;t++){let i=e.doc.line(t),n=qe(i.text,a,e.tabSize,!0);if(n<0)o.push(M.cursor(i.to));else{let t=qe(i.text,r,e.tabSize);o.push(M.range(i.from+n,i.from+t))}}}return o}(e.state,i,a);return r.length?o?M.create(r.concat(n.ranges)):M.create(r):n}}:null}(e,i):null))}const Xo={Alt:[18,e=>!!e.altKey],Control:[17,e=>!!e.ctrlKey],Shift:[16,e=>!!e.shiftKey],Meta:[91,e=>!!e.metaKey]},Go={style:"cursor: crosshair"};function Yo(e={}){let[t,i]=Xo[e.key||"Alt"],n=tn.fromClass(class{constructor(e){this.view=e,this.isDown=!1}set(e){this.isDown!=e&&(this.isDown=e,this.view.update([]))}},{eventObservers:{keydown(e){this.set(e.keyCode==t||i(e))},keyup(e){e.keyCode!=t&&i(e)||this.set(!1)},mousemove(e){this.set(i(e))}}});return[n,Js.contentAttributes.of((e=>{var t;return(null===(t=e.plugin(n))||void 0===t?void 0:t.isDown)?Go:null}))]}const Ho="-10000px";class Ko{constructor(e,t,i,n){this.facet=t,this.createTooltipView=i,this.removeTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter((e=>e));let s=null;this.tooltipViews=this.tooltips.map((e=>s=i(e,s)))}update(e,t){var i;let n=e.state.facet(this.facet),s=n.filter((e=>e));if(n===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let o=[],a=t?[]:null;for(let i=0;i<s.length;i++){let n=s[i],r=-1;if(n){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==n.create&&(r=e)}if(r<0)o[i]=this.createTooltipView(n,i?o[i-1]:null),a&&(a[i]=!!n.above);else{let n=o[i]=this.tooltipViews[r];a&&(a[i]=t[r]),n.update&&n.update(e)}}}for(let e of this.tooltipViews)o.indexOf(e)<0&&(this.removeTooltipView(e),null===(i=e.destroy)||void 0===i||i.call(e));return t&&(a.forEach(((e,i)=>t[i]=e)),t.length=a.length),this.input=n,this.tooltips=s,this.tooltipViews=o,!0}}function Jo(e){let t=e.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const ea=N.define({combine:e=>{var t,i,n;return{position:Zt.ios?"absolute":(null===(t=e.find((e=>e.position)))||void 0===t?void 0:t.position)||"fixed",parent:(null===(i=e.find((e=>e.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(n=e.find((e=>e.tooltipSpace)))||void 0===n?void 0:n.tooltipSpace)||Jo}}}),ta=new WeakMap,ia=tn.fromClass(class{constructor(e){this.view=e,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=e.state.facet(ea);this.position=t.position,this.parent=t.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver="function"==typeof ResizeObserver?new ResizeObserver((()=>this.measureSoon())):null,this.manager=new Ko(e,aa,((e,t)=>this.createTooltip(e,t)),(e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()})),this.above=this.manager.tooltips.map((e=>!!e.above)),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),e.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e,this.above);t&&this.observeIntersection();let i=t||e.geometryChanged,n=e.state.facet(ea);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;i=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(e,t){let i=e.create(this.view),n=t?t.dom:null;if(i.dom.classList.add("cm-tooltip"),e.arrow&&!i.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",i.dom.appendChild(e)}return i.dom.style.position=this.position,i.dom.style.top=Ho,i.dom.style.left="0px",this.container.insertBefore(i.dom,n),i.mount&&i.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(i.dom),i}destroy(){var e,t,i;this.view.win.removeEventListener("resize",this.measureSoon);for(let t of this.manager.tooltipViews)t.dom.remove(),null===(e=t.destroy)||void 0===e||e.call(t);this.parent&&this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(i=this.intersectionObserver)||void 0===i||i.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=1,t=1,i=!1;if("fixed"==this.position&&this.manager.tooltipViews.length){let{dom:e}=this.manager.tooltipViews[0];if(Zt.gecko)i=e.offsetParent!=this.container.ownerDocument.body;else if(e.style.top==Ho&&"0px"==e.style.left){let t=e.getBoundingClientRect();i=Math.abs(t.top+1e4)>1||Math.abs(t.left)>1}}if(i||"absolute"==this.position)if(this.parent){let i=this.parent.getBoundingClientRect();i.width&&i.height&&(e=i.width/this.parent.offsetWidth,t=i.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);let n=this.view.scrollDOM.getBoundingClientRect(),s=un(this.view);return{visible:{left:n.left+s.left,top:n.top+s.top,right:n.right-s.right,bottom:n.bottom-s.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map(((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)})),size:this.manager.tooltipViews.map((({dom:e})=>e.getBoundingClientRect())),space:this.view.state.facet(ea).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:i}}writeMeasure(e){var t;if(e.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let e of this.manager.tooltipViews)e.dom.style.position="absolute"}let{visible:i,space:n,scaleX:s,scaleY:o}=e,a=[];for(let r=0;r<this.manager.tooltips.length;r++){let l=this.manager.tooltips[r],c=this.manager.tooltipViews[r],{dom:h}=c,d=e.pos[r],u=e.size[r];if(!d||!1!==l.clip&&(d.bottom<=Math.max(i.top,n.top)||d.top>=Math.min(i.bottom,n.bottom)||d.right<Math.max(i.left,n.left)-.1||d.left>Math.min(i.right,n.right)+.1)){h.style.top=Ho;continue}let p=l.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,f=p?7:0,m=u.right-u.left,g=null!==(t=ta.get(c))&&void 0!==t?t:u.bottom-u.top,b=c.offset||oa,v=this.view.textDirection==bi.LTR,w=u.width>n.right-n.left?v?n.left:n.right-u.width:v?Math.max(n.left,Math.min(d.left-(p?14:0)+b.x,n.right-m)):Math.min(Math.max(n.left,d.left-m+(p?14:0)-b.x),n.right-m),y=this.above[r];!l.strictSide&&(y?d.top-g-f-b.y<n.top:d.bottom+g+f+b.y>n.bottom)&&y==n.bottom-d.bottom>d.top-n.top&&(y=this.above[r]=!y);let O=(y?d.top-n.top:n.bottom-d.bottom)-f;if(O<g&&!1!==c.resize){if(O<this.view.defaultLineHeight){h.style.top=Ho;continue}ta.set(c,g),h.style.height=(g=O)/o+"px"}else h.style.height&&(h.style.height="");let x=y?d.top-g-f-b.y:d.bottom+f+b.y,$=w+m;if(!0!==c.overlap)for(let e of a)e.left<$&&e.right>w&&e.top<x+g&&e.bottom>x&&(x=y?e.top-g-2-f:e.bottom+f+2);if("absolute"==this.position?(h.style.top=(x-e.parent.top)/o+"px",na(h,(w-e.parent.left)/s)):(h.style.top=x/o+"px",na(h,w/s)),p){let e=d.left+(v?b.x:-b.x)-(w+14-7);p.style.left=e/s+"px"}!0!==c.overlap&&a.push({left:w,top:x,right:$,bottom:x+g}),h.classList.toggle("cm-tooltip-above",y),h.classList.toggle("cm-tooltip-below",!y),c.positioned&&c.positioned(e.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top=Ho}},{eventObservers:{scroll(){this.maybeMeasure()}}});function na(e,t){let i=parseInt(e.style.left,10);(isNaN(i)||Math.abs(t-i)>1)&&(e.style.left=t+"px")}const sa=Js.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),oa={x:0,y:0},aa=N.define({enables:[ia,sa]}),ra=N.define({combine:e=>e.reduce(((e,t)=>e.concat(t)),[])});class la{static create(e){return new la(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new Ko(e,ra,((e,t)=>this.createHostedView(e,t)),(e=>e.dom.remove()))}createHostedView(e,t){let i=e.create(this.view);return i.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(i.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&i.mount&&i.mount(this.view),i}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)null===(e=t.destroy)||void 0===e||e.call(t)}passProp(e){let t;for(let i of this.manager.tooltipViews){let n=i[e];if(void 0!==n)if(void 0===t)t=n;else if(t!==n)return}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const ca=aa.compute([ra],(e=>{let t=e.facet(ra);return 0===t.length?null:{pos:Math.min(...t.map((e=>e.pos))),end:Math.max(...t.map((e=>{var t;return null!==(t=e.end)&&void 0!==t?t:e.pos}))),create:la.create,above:t[0].above,arrow:t.some((e=>e.arrow))}}));class ha{constructor(e,t,i,n,s){this.view=e,this.source=t,this.field=i,this.setHover=n,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,i=e.docView.nearest(t.target);if(!i)return;let n,s=1;if(i instanceof Ut)n=i.posAtStart;else{if(n=e.posAtCoords(t),null==n)return;let i=e.coordsAtPos(n);if(!i||t.y<i.top||t.y>i.bottom||t.x<i.left-e.defaultCharacterWidth||t.x>i.right+e.defaultCharacterWidth)return;let o=e.bidiSpans(e.state.doc.lineAt(n)).find((e=>e.from<=n&&e.to>=n)),a=o&&o.dir==bi.RTL?-1:1;s=t.x<i.left?-a:a}let o=this.source(e,n,s);if(null==o?void 0:o.then){let t=this.pending={pos:n};o.then((i=>{this.pending==t&&(this.pending=null,!i||Array.isArray(i)&&!i.length||e.dispatch({effects:this.setHover.of(Array.isArray(i)?i:[i])}))}),(t=>Hi(e.state,t,"hover tooltip")))}else!o||Array.isArray(o)&&!o.length||e.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let e=this.view.plugin(ia),t=e?e.manager.tooltips.findIndex((e=>e.create==la.create)):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,i;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:n,tooltip:s}=this;if(n.length&&s&&!function(e,t){let i,{left:n,right:s,top:o,bottom:a}=e.getBoundingClientRect();if(i=e.querySelector(".cm-tooltip-arrow")){let e=i.getBoundingClientRect();o=Math.min(e.top,o),a=Math.max(e.bottom,a)}return t.clientX>=n-4&&t.clientX<=s+4&&t.clientY>=o-4&&t.clientY<=a+4}(s.dom,e)||this.pending){let{pos:s}=n[0]||this.pending,o=null!==(i=null===(t=n[0])||void 0===t?void 0:t.end)&&void 0!==i?i:s;(s==o?this.view.posAtCoords(this.lastMove)==s:function(e,t,i,n,s,o){let a=e.scrollDOM.getBoundingClientRect(),r=e.documentTop+e.documentPadding.top+e.contentHeight;if(a.left>n||a.right<n||a.top>s||Math.min(a.bottom,r)<s)return!1;let l=e.posAtCoords({x:n,y:s},!1);return l>=t&&l<=i}(this.view,s,o,e.clientX,e.clientY))||(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:t}=this;t&&t.dom.contains(e.relatedTarget)?this.watchTooltipLeave(t.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=i=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(i.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function da(e,t={}){let i=me.define(),n=Y.define({create:()=>[],update(e,n){if(e.length&&(t.hideOnChange&&(n.docChanged||n.selection)?e=[]:t.hideOn&&(e=e.filter((e=>!t.hideOn(n,e)))),n.docChanged)){let t=[];for(let i of e){let e=n.changes.mapPos(i.pos,-1,A.TrackDel);if(null!=e){let s=Object.assign(Object.create(null),i);s.pos=e,null!=s.end&&(s.end=n.changes.mapPos(s.end)),t.push(s)}}e=t}for(let t of n.effects)t.is(i)&&(e=t.value),t.is(pa)&&(e=[]);return e},provide:e=>ra.from(e)});return{active:n,extension:[n,tn.define((s=>new ha(s,e,n,i,t.hoverTime||300))),ca]}}function ua(e,t){let i=e.plugin(ia);if(!i)return null;let n=i.manager.tooltips.indexOf(t);return n<0?null:i.manager.tooltipViews[n]}const pa=me.define(),fa=N.define({combine(e){let t,i;for(let n of e)t=t||n.topContainer,i=i||n.bottomContainer;return{topContainer:t,bottomContainer:i}}});function ma(e,t){let i=e.plugin(ga),n=i?i.specs.indexOf(t):-1;return n>-1?i.panels[n]:null}const ga=tn.fromClass(class{constructor(e){this.input=e.state.facet(wa),this.specs=this.input.filter((e=>e)),this.panels=this.specs.map((t=>t(e)));let t=e.state.facet(fa);this.top=new ba(e,!0,t.topContainer),this.bottom=new ba(e,!1,t.bottomContainer),this.top.sync(this.panels.filter((e=>e.top))),this.bottom.sync(this.panels.filter((e=>!e.top)));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(e){let t=e.state.facet(fa);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new ba(e.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new ba(e.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=e.state.facet(wa);if(i!=this.input){let t=i.filter((e=>e)),n=[],s=[],o=[],a=[];for(let i of t){let t,r=this.specs.indexOf(i);r<0?(t=i(e.view),a.push(t)):(t=this.panels[r],t.update&&t.update(e)),n.push(t),(t.top?s:o).push(t)}this.specs=t,this.panels=n,this.top.sync(s),this.bottom.sync(o);for(let e of a)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(let t of this.panels)t.update&&t.update(e)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>Js.scrollMargins.of((t=>{let i=t.plugin(e);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}}))});class ba{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=va(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=va(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function va(e){let t=e.nextSibling;return e.remove(),t}const wa=N.define({enables:ga});class ya extends Ee{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}ya.prototype.elementClass="",ya.prototype.toDOM=void 0,ya.prototype.mapMode=A.TrackBefore,ya.prototype.startSide=ya.prototype.endSide=-1,ya.prototype.point=!0;const Oa=N.define(),xa=N.define(),$a={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>De.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Ca=N.define();function Sa(e){return[ka(),Ca.of(Object.assign(Object.assign({},$a),e))]}const _a=N.define({combine:e=>e.some((e=>e))});function ka(e){let t=[Ea];return e&&!1===e.fixed&&t.push(_a.of(!0)),t}const Ea=tn.fromClass(class{constructor(e){this.view=e,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=e.state.facet(Ca).map((t=>new Da(e,t)));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!e.state.facet(_a),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}update(e){if(this.updateGutters(e)){let t=this.prevViewport,i=e.view.viewport,n=Math.min(t.to,i.to)-Math.max(t.from,i.from);this.syncGutters(n<.8*(i.to-i.from))}e.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(_a)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&this.dom.remove();let i=De.iter(this.view.state.facet(Oa),this.view.viewport.from),n=[],s=this.gutters.map((e=>new Ra(e,this.view.viewport,-this.view.documentPadding.top)));for(let e of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(e.type)){let t=!0;for(let o of e.type)if(o.type==si.Text&&t){Aa(i,n,o.from);for(let e of s)e.line(this.view,o,n);t=!1}else if(o.widget)for(let e of s)e.widget(this.view,o)}else if(e.type==si.Text){Aa(i,n,e.from);for(let t of s)t.line(this.view,e,n)}else if(e.widget)for(let t of s)t.widget(this.view,e);for(let e of s)e.finish();e&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(e){let t=e.startState.facet(Ca),i=e.state.facet(Ca),n=e.docChanged||e.heightChanged||e.viewportChanged||!De.eq(e.startState.facet(Oa),e.state.facet(Oa),e.view.viewport.from,e.view.viewport.to);if(t==i)for(let t of this.gutters)t.update(e)&&(n=!0);else{n=!0;let s=[];for(let n of i){let i=t.indexOf(n);i<0?s.push(new Da(this.view,n)):(this.gutters[i].update(e),s.push(this.gutters[i]))}for(let e of this.gutters)e.dom.remove(),s.indexOf(e)<0&&e.destroy();for(let e of s)this.dom.appendChild(e.dom);this.gutters=s}return n}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove()}},{provide:e=>Js.scrollMargins.of((t=>{let i=t.plugin(e);return i&&0!=i.gutters.length&&i.fixed?t.textDirection==bi.LTR?{left:i.dom.offsetWidth*t.scaleX}:{right:i.dom.offsetWidth*t.scaleX}:null}))});function Pa(e){return Array.isArray(e)?e:[e]}function Aa(e,t,i){for(;e.value&&e.from<=i;)e.from==i&&t.push(e.value),e.next()}class Ra{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=De.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:n}=this,s=(t.top-this.height)/e.scaleY,o=t.height/e.scaleY;if(this.i==n.elements.length){let t=new Va(e,o,s,i);n.elements.push(t),n.dom.appendChild(t.dom)}else n.elements[this.i].update(e,o,s,i);this.height=t.bottom,this.i++}line(e,t,i){let n=[];Aa(this.cursor,n,t.from),i.length&&(n=n.concat(i));let s=this.gutter.config.lineMarker(e,t,n);s&&n.unshift(s);let o=this.gutter;(0!=n.length||o.config.renderEmptyElements)&&this.addElement(e,t,n)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),n=i?[i]:null;for(let i of e.state.facet(xa)){let s=i(e,t.widget,t);s&&(n||(n=[])).push(s)}n&&this.addElement(e,t,n)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Da{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,(n=>{let s,o=n.target;if(o!=this.dom&&this.dom.contains(o)){for(;o.parentNode!=this.dom;)o=o.parentNode;let e=o.getBoundingClientRect();s=(e.top+e.bottom)/2}else s=n.clientY;let a=e.lineBlockAtHeight(s-e.documentTop);t.domEventHandlers[i](e,a,n)&&n.preventDefault()}));this.markers=Pa(t.markers(e)),t.initialSpacer&&(this.spacer=new Va(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Pa(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let i=e.view.viewport;return!De.eq(this.markers,t,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class Va{constructor(e,t,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,n)}update(e,t,i,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].compare(t[i]))return!1;return!0}(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let i="cm-gutterElement",n=this.dom.firstChild;for(let s=0,o=0;;){let a=o,r=s<t.length?t[s++]:null,l=!1;if(r){let e=r.elementClass;e&&(i+=" "+e);for(let e=o;e<this.markers.length;e++)if(this.markers[e].compare(r)){a=e,l=!0;break}}else a=this.markers.length;for(;o<a;){let e=this.markers[o++];if(e.toDOM){e.destroy(n);let t=n.nextSibling;n.remove(),n=t}}if(!r)break;r.toDOM&&(l?n=n.nextSibling:this.dom.insertBefore(r.toDOM(e),n)),l&&o++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}const La=N.define(),Ta=N.define(),Ba=N.define({combine:e=>ke(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let e in t){let n=i[e],s=t[e];i[e]=n?(e,t,i)=>n(e,t,i)||s(e,t,i):s}return i}})});class Fa extends ya{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Ia(e,t){return e.state.facet(Ba).formatNumber(t,e.state)}const ja=Ca.compute([Ba],(e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(La),lineMarker:(e,t,i)=>i.some((e=>e.toDOM))?null:new Fa(Ia(e,e.state.doc.lineAt(t.from).number)),widgetMarker:(e,t,i)=>{for(let n of e.state.facet(Ta)){let s=n(e,t,i);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(Ba)!=e.state.facet(Ba),initialSpacer:e=>new Fa(Ia(e,Qa(e.state.doc.lines))),updateSpacer(e,t){let i=Ia(t.view,Qa(t.view.state.doc.lines));return i==e.number?e:new Fa(i)},domEventHandlers:e.facet(Ba).domEventHandlers})));function Ma(e={}){return[Ba.of(e),ka(),ja]}function Qa(e){let t=9;for(;t<e;)t=10*t+9;return t}const Wa=new class extends ya{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Na=Oa.compute(["selection"],(e=>{let t=[],i=-1;for(let n of e.selection.ranges){let s=e.doc.lineAt(n.head).from;s>i&&(i=s,t.push(Wa.range(s)))}return De.of(t)})),Za=1024;let qa=0;class za{constructor(e,t){this.from=e,this.to=t}}class Ua{constructor(e={}){this.id=qa++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=Ya.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}Ua.closedBy=new Ua({deserialize:e=>e.split(" ")}),Ua.openedBy=new Ua({deserialize:e=>e.split(" ")}),Ua.group=new Ua({deserialize:e=>e.split(" ")}),Ua.isolate=new Ua({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),Ua.contextHash=new Ua({perNode:!0}),Ua.lookAhead=new Ua({perNode:!0}),Ua.mounted=new Ua({perNode:!0});class Xa{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[Ua.mounted.id]}}const Ga=Object.create(null);class Ya{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):Ga,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new Ya(e.name||"",t,e.id,i);if(e.props)for(let i of e.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(Ua.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return e=>{for(let i=e.prop(Ua.group),n=-1;n<(i?i.length:0);n++){let s=t[n<0?e.name:i[n]];if(s)return s}}}}Ya.none=new Ya("",Object.create(null),0,8);class Ha{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let n=null;for(let t of e){let e=t(i);e&&(n||(n=Object.assign({},i.props)),n[e[0].id]=e[1])}t.push(n?new Ya(i.name,n,i.id,i.flags):i)}return new Ha(t)}}const Ka=new WeakMap,Ja=new WeakMap;var er;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(er||(er={}));class tr{constructor(e,t,i,n,s){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[e,t]of s)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=Xa.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let i=e.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new fr(this.topNode,e)}cursorAt(e,t=0,i=0){let n=Ka.get(this)||this.topNode,s=new fr(n);return s.moveTo(e,t),Ka.set(this,s._tree),s}get topNode(){return new rr(this,0,0,null)}resolve(e,t=0){let i=or(Ka.get(this)||this.topNode,e,t,!1);return Ka.set(this,i),i}resolveInner(e,t=0){let i=or(Ja.get(this)||this.topNode,e,t,!0);return Ja.set(this,i),i}resolveStack(e,t=0){return function(e,t,i){let n=e.resolveInner(t,i),s=null;for(let e=n instanceof rr?n:n.context.parent;e;e=e.parent)if(e.index<0){let o=e.parent;(s||(s=[n])).push(o.resolve(t,i)),e=o}else{let o=Xa.get(e.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let a=new rr(o.tree,o.overlay[0].from+e.from,-1,e);(s||(s=[n])).push(or(a,t,i,!1))}}return s?ur(s):n}(this,e,t)}iterate(e){let{enter:t,leave:i,from:n=0,to:s=this.length}=e,o=e.mode||0,a=(o&er.IncludeAnonymous)>0;for(let e=this.cursor(o|er.IncludeAnonymous);;){let o=!1;if(e.from<=s&&e.to>=n&&(!a&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;o=!0}for(;o&&i&&(a||!e.type.isAnonymous)&&i(e),!e.nextSibling();){if(!e.parent())return;o=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:vr(Ya.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,i)=>new tr(this.type,e,t,i,this.propValues)),e.makeTree||((e,t,i)=>new tr(Ya.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:n,maxBufferLength:s=Za,reused:o=[],minRepeatType:a=n.types.length}=e,r=Array.isArray(i)?new ir(i,i.length):i,l=n.types,c=0,h=0;function d(e,t,i,g,b,v){let{id:w,start:y,end:O,size:x}=r,$=h,C=c;for(;x<0;){if(r.next(),-1==x){let t=o[w];return i.push(t),void g.push(y-e)}if(-3==x)return void(c=w);if(-4==x)return void(h=w);throw new RangeError(`Unrecognized record size: ${x}`)}let S,_,k=l[w],E=y-e;if(O-y<=s&&(_=function(e,t){let i=r.fork(),n=0,o=0,l=0,c=i.end-s,h={size:0,start:0,skip:0};e:for(let s=i.pos-e;i.pos>s;){let e=i.size;if(i.id==t&&e>=0){h.size=n,h.start=o,h.skip=l,l+=4,n+=4,i.next();continue}let r=i.pos-e;if(e<0||r<s||i.start<c)break;let d=i.id>=a?4:0,u=i.start;for(i.next();i.pos>r;){if(i.size<0){if(-3!=i.size)break e;d+=4}else i.id>=a&&(d+=4);i.next()}o=u,n+=e,l+=d}return(t<0||n==e)&&(h.size=n,h.start=o,h.skip=l),h.size>4?h:void 0}(r.pos-t,b))){let t=new Uint16Array(_.size-_.skip),i=r.pos-_.size,s=t.length;for(;r.pos>i;)s=m(_.start,t,s);S=new nr(t,O-_.start,n),E=_.start-e}else{let e=r.pos-x;r.next();let t=[],i=[],n=w>=a?w:-1,o=0,l=O;for(;r.pos>e;)n>=0&&r.id==n&&r.size>=0?(r.end<=l-s&&(p(t,i,y,o,r.end,l,n,$,C),o=t.length,l=r.end),r.next()):v>2500?u(y,e,t,i):d(y,e,t,i,n,v+1);if(n>=0&&o>0&&o<t.length&&p(t,i,y,o,y,l,n,$,C),t.reverse(),i.reverse(),n>-1&&o>0){let e=function(e,t){return(i,n,s)=>{let o,a,r=0,l=i.length-1;if(l>=0&&(o=i[l])instanceof tr){if(!l&&o.type==e&&o.length==s)return o;(a=o.prop(Ua.lookAhead))&&(r=n[l]+o.length+a)}return f(e,i,n,s,r,t)}}(k,C);S=vr(k,t,i,0,t.length,0,O-y,e,e)}else S=f(k,t,i,O-y,$-O,C)}i.push(S),g.push(E)}function u(e,t,i,o){let a=[],l=0,c=-1;for(;r.pos>t;){let{id:e,start:t,end:i,size:n}=r;if(n>4)r.next();else{if(c>-1&&t<c)break;c<0&&(c=i-s),a.push(e,t,i),l++,r.next()}}if(l){let t=new Uint16Array(4*l),s=a[a.length-2];for(let e=a.length-3,i=0;e>=0;e-=3)t[i++]=a[e],t[i++]=a[e+1]-s,t[i++]=a[e+2]-s,t[i++]=i;i.push(new nr(t,a[2]-s,n)),o.push(s-e)}}function p(e,t,i,s,o,a,r,l,c){let h=[],d=[];for(;e.length>s;)h.push(e.pop()),d.push(t.pop()+i-o);e.push(f(n.types[r],h,d,a-o,l-a,c)),t.push(o-i)}function f(e,t,i,n,s,o,a){if(o){let e=[Ua.contextHash,o];a=a?[e].concat(a):[e]}if(s>25){let e=[Ua.lookAhead,s];a=a?[e].concat(a):[e]}return new tr(e,t,i,n,a)}function m(e,t,i){let{id:n,start:s,end:o,size:l}=r;if(r.next(),l>=0&&n<a){let a=i;if(l>4){let n=r.pos-(l-4);for(;r.pos>n;)i=m(e,t,i)}t[--i]=a,t[--i]=o-e,t[--i]=s-e,t[--i]=n}else-3==l?c=n:-4==l&&(h=n);return i}let g=[],b=[];for(;r.pos>0;)d(e.start||0,e.bufferStart||0,g,b,-1,0);let v=null!==(t=e.length)&&void 0!==t?t:g.length?b[0]+g[0].length:0;return new tr(l[e.topID],g.reverse(),b.reverse(),v)}(e)}}tr.empty=new tr(Ya.none,[],[],0);class ir{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ir(this.buffer,this.index)}}class nr{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return Ya.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),i==(e+=4))return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,n,s){let{buffer:o}=this,a=-1;for(let r=e;r!=t&&!(sr(s,n,o[r+1],o[r+2])&&(a=r,i>0));r=o[r+3]);return a}slice(e,t,i){let n=this.buffer,s=new Uint16Array(t-e),o=0;for(let a=e,r=0;a<t;){s[r++]=n[a++],s[r++]=n[a++]-i;let t=s[r++]=n[a++]-i;s[r++]=n[a++]-e,o=Math.max(o,t)}return new nr(s,o,this.set)}}function sr(e,t,i,n){switch(e){case-2:return i<t;case-1:return n>=t&&i<t;case 0:return i<t&&n>t;case 1:return i<=t&&n>t;case 2:return n>t;case 4:return!0}}function or(e,t,i,n){for(var s;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof rr&&e.index<0?null:e.parent;if(!t)return e;e=t}let o=n?0:er.IgnoreOverlays;if(n)for(let n=e,a=n.parent;a;n=a,a=n.parent)n instanceof rr&&n.index<0&&(null===(s=a.enter(t,i,o))||void 0===s?void 0:s.from)!=n.from&&(e=a);for(;;){let n=e.enter(t,i,o);if(!n)return e;e=n}}class ar{cursor(e=0){return new fr(this,e)}getChild(e,t=null,i=null){let n=lr(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return lr(this,e,t,i)}resolve(e,t=0){return or(this,e,t,!1)}resolveInner(e,t=0){return or(this,e,t,!0)}matchContext(e){return cr(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(i=t,t=e.prevSibling):t=e}return i}get node(){return this}get next(){return this.parent}}class rr extends ar{constructor(e,t,i,n){super(),this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,s=0){for(let o=this;;){for(let{children:a,positions:r}=o._tree,l=t>0?a.length:-1;e!=l;e+=t){let l=a[e],c=r[e]+o.from;if(sr(n,i,c,c+l.length))if(l instanceof nr){if(s&er.ExcludeBuffers)continue;let a=l.findChild(0,l.buffer.length,t,i-c,n);if(a>-1)return new dr(new hr(o,l,e,c),null,a)}else if(s&er.IncludeAnonymous||!l.type.isAnonymous||mr(l)){let a;if(!(s&er.IgnoreMounts)&&(a=Xa.get(l))&&!a.overlay)return new rr(a.tree,c,e,o);let r=new rr(l,c,e,o);return s&er.IncludeAnonymous||!r.type.isAnonymous?r:r.nextChild(t<0?l.children.length-1:0,t,i,n)}}if(s&er.IncludeAnonymous||!o.type.isAnonymous)return null;if(e=o.index>=0?o.index+t:t<0?-1:o._parent._tree.children.length,o=o._parent,!o)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let n;if(!(i&er.IgnoreOverlays)&&(n=Xa.get(this._tree))&&n.overlay){let i=e-this.from;for(let{from:e,to:s}of n.overlay)if((t>0?e<=i:e<i)&&(t<0?s>=i:s>i))return new rr(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function lr(e,t,i,n){let s=e.cursor(),o=[];if(!s.firstChild())return o;if(null!=i)for(let e=!1;!e;)if(e=s.type.is(i),!s.nextSibling())return o;for(;;){if(null!=n&&s.type.is(n))return o;if(s.type.is(t)&&o.push(s.node),!s.nextSibling())return null==n?o:[]}}function cr(e,t,i=t.length-1){for(let n=e;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[i]&&t[i]!=n.name)return!1;i--}}return!0}class hr{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class dr extends ar{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new dr(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&er.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new dr(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new dr(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new dr(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let o=i.buffer[this.index+1];e.push(i.slice(n,s,o)),t.push(0)}return new tr(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function ur(e){if(!e.length)return null;let t=0,i=e[0];for(let n=1;n<e.length;n++){let s=e[n];(s.from>i.from||s.to<i.to)&&(i=s,t=n)}let n=i instanceof rr&&i.index<0?null:i.parent,s=e.slice();return n?s[t]=n:s.splice(t,1),new pr(s,i)}class pr{constructor(e,t){this.heads=e,this.node=t}get next(){return ur(this.heads)}}class fr{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof rr)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof rr?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&er.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&er.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&er.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let n=t+e,s=e<0?-1:i._tree.children.length;n!=s;n+=e){let e=i._tree.children[n];if(this.mode&er.IncludeAnonymous||e instanceof nr||!e.type.isAnonymous||mr(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==n){if(n==this.index)return o;t=o,i=s+1;break e}n=this.stack[--s]}for(let e=i;e<this.stack.length;e++)t=new dr(this.buffer,t,this.stack[e]);return this.bufferNode=new dr(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return cr(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return cr(this._tree,e,n);let o=i[t.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[n]&&e[n]!=o.name)return!1;n--}}return!0}}function mr(e){return e.children.some((e=>e instanceof nr||!e.type.isAnonymous||mr(e)))}const gr=new WeakMap;function br(e,t){if(!e.isAnonymous||t instanceof nr||t.type!=e)return 1;let i=gr.get(t);if(null==i){i=1;for(let n of t.children){if(n.type!=e||!(n instanceof tr)){i=1;break}i+=br(e,n)}gr.set(t,i)}return i}function vr(e,t,i,n,s,o,a,r,l){let c=0;for(let i=n;i<s;i++)c+=br(e,t[i]);let h=Math.ceil(1.5*c/8),d=[],u=[];return function t(i,n,s,a,r){for(let c=s;c<a;){let s=c,p=n[c],f=br(e,i[c]);for(c++;c<a;c++){let t=br(e,i[c]);if(f+t>=h)break;f+=t}if(c==s+1){if(f>h){let e=i[s];t(e.children,e.positions,0,e.children.length,n[s]+r);continue}d.push(i[s])}else{let t=n[c-1]+i[c-1].length-p;d.push(vr(e,i,n,s,c,p,t,null,l))}u.push(p+r-o)}}(t,i,n,s,0),(r||l)(d,u,a)}class wr{constructor(){this.map=new WeakMap}setBuffer(e,t,i){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(t,i)}getBuffer(e,t){let i=this.map.get(e);return i&&i.get(t)}set(e,t){e instanceof dr?this.setBuffer(e.context.buffer,e.index,t):e instanceof rr&&this.map.set(e.tree,t)}get(e){return e instanceof dr?this.getBuffer(e.context.buffer,e.index):e instanceof rr?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class yr{constructor(e,t,i,n,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=n,this.open=(s?1:0)|(o?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],i=!1){let n=[new yr(0,e.length,e,0,!1,i)];for(let i of t)i.to>e.length&&n.push(i);return n}static applyChanges(e,t,i=128){if(!t.length)return e;let n=[],s=1,o=e.length?e[0]:null;for(let a=0,r=0,l=0;;a++){let c=a<t.length?t[a]:null,h=c?c.fromA:1e9;if(h-r>=i)for(;o&&o.from<h;){let t=o;if(r>=t.from||h<=t.to||l){let e=Math.max(t.from,r)-l,i=Math.min(t.to,h)-l;t=e>=i?null:new yr(e,i,t.tree,t.offset+l,a>0,!!c)}if(t&&n.push(t),o.to>h)break;o=s<e.length?e[s++]:null}if(!c)break;r=c.toA,l=c.toA-c.toB}return n}}class Or{startParse(e,t,i){return"string"==typeof e&&(e=new xr(e)),i=i?i.length?i.map((e=>new za(e.from,e.to))):[new za(0,0)]:[new za(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let n=this.startParse(e,t,i);for(;;){let e=n.advance();if(e)return e}}}class xr{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new Ua({perNode:!0});let $r=0;class Cr{constructor(e,t,i,n){this.name=e,this.set=t,this.base=i,this.modified=n,this.id=$r++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i="string"==typeof e?e:"?";if(e instanceof Cr&&(t=e),null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let n=new Cr(i,[],null,[]);if(n.set.push(n),t)for(let e of t.set)n.set.push(e);return n}static defineModifier(e){let t=new _r(e);return e=>e.modified.indexOf(t)>-1?e:_r.get(e.base||e,e.modified.concat(t).sort(((e,t)=>e.id-t.id)))}}let Sr=0;class _r{constructor(e){this.name=e,this.instances=[],this.id=Sr++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find((i=>{return i.base==e&&(n=t,s=i.modified,n.length==s.length&&n.every(((e,t)=>e==s[t])));var n,s}));if(i)return i;let n=[],s=new Cr(e.name,n,e,t);for(let e of t)e.instances.push(s);let o=function(e){let t=[[]];for(let i=0;i<e.length;i++)for(let n=0,s=t.length;n<s;n++)t.push(t[n].concat(e[i]));return t.sort(((e,t)=>t.length-e.length))}(t);for(let t of e.set)if(!t.modified.length)for(let e of o)n.push(_r.get(t,e));return s}}function kr(e){let t=Object.create(null);for(let i in e){let n=e[i];Array.isArray(n)||(n=[n]);for(let e of i.split(" "))if(e){let i=[],s=2,o=e;for(let t=0;;){if("..."==o&&t>0&&t+3==e.length){s=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!n)throw new RangeError("Invalid path: "+e);if(i.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),t+=n[0].length,t==e.length)break;let a=e[t++];if(t==e.length&&"!"==a){s=0;break}if("/"!=a)throw new RangeError("Invalid path: "+e);o=e.slice(t)}let a=i.length-1,r=i[a];if(!r)throw new RangeError("Invalid path: "+e);let l=new Pr(n,s,a>0?i.slice(0,a):null);t[r]=l.sort(t[r])}}return Er.add(t)}const Er=new Ua;class Pr{constructor(e,t,i,n){this.tags=e,this.mode=t,this.context=i,this.next=n}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function Ar(e,t){let i=Object.create(null);for(let t of e)if(Array.isArray(t.tag))for(let e of t.tag)i[e.id]=t.class;else i[t.tag.id]=t.class;let{scope:n,all:s=null}=t||{};return{style:e=>{let t=s;for(let n of e)for(let e of n.set){let n=i[e.id];if(n){t=t?t+" "+n:n;break}}return t},scope:n}}function Rr(e,t,i,n=0,s=e.length){let o=new Dr(n,Array.isArray(t)?t:[t],i);o.highlightRange(e.cursor(),n,s,"",o.highlighters),o.flush(s)}Pr.empty=new Pr([],2,null);class Dr{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,n,s){let{type:o,from:a,to:r}=e;if(a>=i||r<=t)return;o.isTop&&(s=this.highlighters.filter((e=>!e.scope||e.scope(o))));let l=n,c=function(e){let t=e.type.prop(Er);for(;t&&t.context&&!e.matchContext(t.context);)t=t.next;return t||null}(e)||Pr.empty,h=function(e,t){let i=null;for(let n of e){let e=n.style(t);e&&(i=i?i+" "+e:e)}return i}(s,c.tags);if(h&&(l&&(l+=" "),l+=h,1==c.mode&&(n+=(n?" ":"")+h)),this.startSpan(Math.max(t,a),l),c.opaque)return;let d=e.tree&&e.tree.prop(Ua.mounted);if(d&&d.overlay){let o=e.node.enter(d.overlay[0].from+a,1),c=this.highlighters.filter((e=>!e.scope||e.scope(d.tree.type))),h=e.firstChild();for(let u=0,p=a;;u++){let f=u<d.overlay.length?d.overlay[u]:null,m=f?f.from+a:r,g=Math.max(t,p),b=Math.min(i,m);if(g<b&&h)for(;e.from<b&&(this.highlightRange(e,g,b,n,s),this.startSpan(Math.min(b,e.to),l),!(e.to>=m)&&e.nextSibling()););if(!f||m>i)break;p=f.to+a,p>t&&(this.highlightRange(o.cursor(),Math.max(t,f.from+a),Math.min(i,p),"",c),this.startSpan(Math.min(i,p),l))}h&&e.parent()}else if(e.firstChild()){d&&(n="");do{if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,n,s),this.startSpan(Math.min(i,e.to),l)}}while(e.nextSibling());e.parent()}}}const Vr=Cr.define,Lr=Vr(),Tr=Vr(),Br=Vr(Tr),Fr=Vr(Tr),Ir=Vr(),jr=Vr(Ir),Mr=Vr(Ir),Qr=Vr(),Wr=Vr(Qr),Nr=Vr(),Zr=Vr(),qr=Vr(),zr=Vr(qr),Ur=Vr(),Xr={comment:Lr,lineComment:Vr(Lr),blockComment:Vr(Lr),docComment:Vr(Lr),name:Tr,variableName:Vr(Tr),typeName:Br,tagName:Vr(Br),propertyName:Fr,attributeName:Vr(Fr),className:Vr(Tr),labelName:Vr(Tr),namespace:Vr(Tr),macroName:Vr(Tr),literal:Ir,string:jr,docString:Vr(jr),character:Vr(jr),attributeValue:Vr(jr),number:Mr,integer:Vr(Mr),float:Vr(Mr),bool:Vr(Ir),regexp:Vr(Ir),escape:Vr(Ir),color:Vr(Ir),url:Vr(Ir),keyword:Nr,self:Vr(Nr),null:Vr(Nr),atom:Vr(Nr),unit:Vr(Nr),modifier:Vr(Nr),operatorKeyword:Vr(Nr),controlKeyword:Vr(Nr),definitionKeyword:Vr(Nr),moduleKeyword:Vr(Nr),operator:Zr,derefOperator:Vr(Zr),arithmeticOperator:Vr(Zr),logicOperator:Vr(Zr),bitwiseOperator:Vr(Zr),compareOperator:Vr(Zr),updateOperator:Vr(Zr),definitionOperator:Vr(Zr),typeOperator:Vr(Zr),controlOperator:Vr(Zr),punctuation:qr,separator:Vr(qr),bracket:zr,angleBracket:Vr(zr),squareBracket:Vr(zr),paren:Vr(zr),brace:Vr(zr),content:Qr,heading:Wr,heading1:Vr(Wr),heading2:Vr(Wr),heading3:Vr(Wr),heading4:Vr(Wr),heading5:Vr(Wr),heading6:Vr(Wr),contentSeparator:Vr(Qr),list:Vr(Qr),quote:Vr(Qr),emphasis:Vr(Qr),strong:Vr(Qr),link:Vr(Qr),monospace:Vr(Qr),strikethrough:Vr(Qr),inserted:Vr(),deleted:Vr(),changed:Vr(),invalid:Vr(),meta:Ur,documentMeta:Vr(Ur),annotation:Vr(Ur),processingInstruction:Vr(Ur),definition:Cr.defineModifier("definition"),constant:Cr.defineModifier("constant"),function:Cr.defineModifier("function"),standard:Cr.defineModifier("standard"),local:Cr.defineModifier("local"),special:Cr.defineModifier("special")};for(let e in Xr){let t=Xr[e];t instanceof Cr&&(t.name=e)}var Gr;Ar([{tag:Xr.link,class:"tok-link"},{tag:Xr.heading,class:"tok-heading"},{tag:Xr.emphasis,class:"tok-emphasis"},{tag:Xr.strong,class:"tok-strong"},{tag:Xr.keyword,class:"tok-keyword"},{tag:Xr.atom,class:"tok-atom"},{tag:Xr.bool,class:"tok-bool"},{tag:Xr.url,class:"tok-url"},{tag:Xr.labelName,class:"tok-labelName"},{tag:Xr.inserted,class:"tok-inserted"},{tag:Xr.deleted,class:"tok-deleted"},{tag:Xr.literal,class:"tok-literal"},{tag:Xr.string,class:"tok-string"},{tag:Xr.number,class:"tok-number"},{tag:[Xr.regexp,Xr.escape,Xr.special(Xr.string)],class:"tok-string2"},{tag:Xr.variableName,class:"tok-variableName"},{tag:Xr.local(Xr.variableName),class:"tok-variableName tok-local"},{tag:Xr.definition(Xr.variableName),class:"tok-variableName tok-definition"},{tag:Xr.special(Xr.variableName),class:"tok-variableName2"},{tag:Xr.definition(Xr.propertyName),class:"tok-propertyName tok-definition"},{tag:Xr.typeName,class:"tok-typeName"},{tag:Xr.namespace,class:"tok-namespace"},{tag:Xr.className,class:"tok-className"},{tag:Xr.macroName,class:"tok-macroName"},{tag:Xr.propertyName,class:"tok-propertyName"},{tag:Xr.operator,class:"tok-operator"},{tag:Xr.comment,class:"tok-comment"},{tag:Xr.meta,class:"tok-meta"},{tag:Xr.invalid,class:"tok-invalid"},{tag:Xr.punctuation,class:"tok-punctuation"}]);const Yr=new Ua;function Hr(e){return N.define({combine:e?t=>t.concat(e):void 0})}const Kr=new Ua;class Jr{constructor(e,t,i=[],n=""){this.data=e,this.name=n,_e.prototype.hasOwnProperty("tree")||Object.defineProperty(_e.prototype,"tree",{get(){return il(this)}}),this.parser=t,this.extension=[dl.of(this),_e.languageData.of(((e,t,i)=>{let n=el(e,t,i),s=n.type.prop(Yr);if(!s)return[];let o=e.facet(s),a=n.type.prop(Kr);if(a){let s=n.resolve(t-n.from,i);for(let t of a)if(t.test(s,e)){let i=e.facet(t.facet);return"replace"==t.type?i:i.concat(o)}}return o}))].concat(i)}isActiveAt(e,t,i=-1){return el(e,t,i).type.prop(Yr)==this.data}findRegions(e){let t=e.facet(dl);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],n=(e,t)=>{if(e.prop(Yr)==this.data)return void i.push({from:t,to:t+e.length});let s=e.prop(Ua.mounted);if(s){if(s.tree.prop(Yr)==this.data){if(s.overlay)for(let e of s.overlay)i.push({from:e.from+t,to:e.to+t});else i.push({from:t,to:t+e.length});return}if(s.overlay){let e=i.length;if(n(s.tree,s.overlay[0].from+t),i.length>e)return}}for(let i=0;i<e.children.length;i++){let s=e.children[i];s instanceof tr&&n(s,e.positions[i]+t)}};return n(il(e),0),i}get allowsNesting(){return!0}}function el(e,t,i){let n=e.facet(dl),s=il(e).topNode;if(!n||n.allowsNesting)for(let e=s;e;e=e.enter(t,i,er.ExcludeBuffers))e.type.isTop&&(s=e);return s}Jr.setState=me.define();class tl extends Jr{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=Hr(e.languageData);return new tl(t,e.parser.configure({props:[Yr.add((e=>e.isTop?t:void 0))]}),e.name)}configure(e,t){return new tl(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function il(e){let t=e.field(Jr.state,!1);return t?t.tree:tr.empty}class nl{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let sl=null;class ol{constructor(e,t,i=[],n,s,o,a,r){this.parser=e,this.state=t,this.fragments=i,this.tree=n,this.treeLen=s,this.viewport=o,this.skipped=a,this.scheduleOn=r,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new ol(e,t,[],tr.empty,0,i,[],null)}startParse(){return this.parser.startParse(new nl(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=tr.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n){if(this.fragments=this.withoutTempSkipped(yr.addTree(n,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=n,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}}))}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext((()=>{for(;!(t=this.parse.advance()););})),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(yr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=sl;sl=this;try{return e()}finally{sl=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=al(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:n,treeLen:s,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges(((e,i,n,s)=>t.push({fromA:e,toA:i,fromB:n,toB:s}))),i=yr.applyChanges(i,t),n=tr.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let t of this.skipped){let i=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);i<n&&a.push({from:i,to:n})}}}return new ol(this.parser,t,i,n,s,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:i,to:n}=this.skipped[t];i<e.to&&n>e.from&&(this.fragments=al(this.fragments,i,n),this.skipped.splice(t--,1))}return!(this.skipped.length>=t||(this.reset(),0))}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Or{createParse(t,i,n){let s=n[0].from,o=n[n.length-1].to;return{parsedPos:s,advance(){let t=sl;if(t){for(let e of n)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=o,new tr(Ya.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return sl}}function al(e,t,i){return yr.applyChanges(e,[{fromA:t,toA:i,fromB:t,toB:i}])}class rl{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new rl(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=ol.create(e.facet(dl).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new rl(i)}}Jr.state=Y.define({create:rl.init,update(e,t){for(let e of t.effects)if(e.is(Jr.setState))return e.value;return t.startState.facet(dl)!=t.state.facet(dl)?rl.init(t.state):e.apply(t)}});let ll=e=>{let t=setTimeout((()=>e()),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(ll=e=>{let t=-1,i=setTimeout((()=>{t=requestIdleCallback(e,{timeout:400})}),100);return()=>t<0?clearTimeout(i):cancelIdleCallback(t)});const cl="undefined"!=typeof navigator&&(null===(Gr=navigator.scheduling)||void 0===Gr?void 0:Gr.isInputPending)?()=>navigator.scheduling.isInputPending():null,hl=tn.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Jr.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Jr.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=ll(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,s=i.field(Jr.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!cl?Math.max(25,e.timeRemaining()-5):1e9),a=s.context.treeLen<n&&i.doc.length>n+1e3,r=s.context.work((()=>cl&&cl()||Date.now()>o),n+(a?0:1e5));this.chunkBudget-=Date.now()-t,(r||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Jr.setState.of(new rl(s.context))})),this.chunkBudget>0&&(!r||a)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then((()=>this.scheduleWork())).catch((e=>Hi(this.view.state,e))).then((()=>this.workScheduled--)),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),dl=N.define({combine:e=>e.length?e[0]:null,enables:e=>[Jr.state,hl,Js.contentAttributes.compute([e],(t=>{let i=t.facet(e);return i&&i.name?{"data-language":i.name}:{}}))]});class ul{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const pl=N.define(),fl=N.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some((e=>e!=t[0])))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function ml(e){let t=e.facet(fl);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function gl(e,t){let i="",n=e.tabSize,s=e.facet(fl)[0];if("\t"==s){for(;t>=n;)i+="\t",t-=n;s=" "}for(let e=0;e<t;e++)i+=s;return i}function bl(e,t){e instanceof _e&&(e=new vl(e));for(let i of e.state.facet(pl)){let n=i(e,t);if(void 0!==n)return n}let i=il(e.state);return i.length>=t?function(e,t,i){let n=t.resolveStack(i),s=t.resolveInner(i,-1).resolve(i,0).enterUnfinishedNodesBefore(i);if(s!=n.node){let e=[];for(let t=s;t&&(t.from!=n.node.from||t.type!=n.node.type);t=t.parent)e.push(t);for(let t=e.length-1;t>=0;t--)n={node:e[t],next:n}}return yl(n,e,i)}(e,i,t):null}class vl{constructor(e,t={}){this.state=e,this.options=t,this.unit=ml(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return null!=n&&n>=i.from&&n<=i.to?s&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(e,t);return i.slice(e-n,Math.min(i.length,e+100-n))}column(e,t=1){let{text:i,from:n}=this.lineAt(e,t),s=this.countColumn(i,e-n),o=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return Ze(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:n}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let e=s(n);if(e>-1)return e}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const wl=new Ua;function yl(e,t,i){for(let n=e;n;n=n.next){let e=Ol(n.node);if(e)return e($l.create(t,i,n))}return 0}function Ol(e){let t=e.type.prop(wl);if(t)return t;let i,n=e.firstChild;if(n&&(i=n.type.prop(Ua.closedBy))){let t=e.lastChild,n=t&&i.indexOf(t.name)>-1;return e=>_l(e,!0,1,void 0,n&&!function(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?xl:null}function xl(){return 0}class $l extends vl{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new $l(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(Cl(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return yl(this.context.next,this.base,this.pos)}}function Cl(e,t){for(let i=t;i;i=i.parent)if(e==i)return!0;return!1}function Sl({closing:e,align:t=!0,units:i=1}){return n=>_l(n,t,i,e)}function _l(e,t,i,n,s){let o=e.textAfter,a=o.match(/^\s*/)[0].length,r=n&&o.slice(a,a+n.length)==n||s==e.pos+a,l=t?function(e){let t=e.node,i=t.childAfter(t.from),n=t.lastChild;if(!i)return null;let s=e.options.simulateBreak,o=e.state.doc.lineAt(i.from),a=null==s||s<=o.from?o.to:Math.min(o.to,s);for(let e=i.to;;){let s=t.childAfter(e);if(!s||s==n)return null;if(!s.type.isSkipped){if(s.from>=a)return null;let e=/^ */.exec(o.text.slice(i.to-o.from))[0].length;return{from:i.from,to:i.to+e}}e=s.to}}(e):null;return l?r?e.column(l.from):e.column(l.to):e.baseIndent+(r?0:e.unit*i)}function kl({except:e,units:t=1}={}){return i=>{let n=e&&e.test(i.textAfter);return i.baseIndent+(n?0:t*i.unit)}}const El=N.define(),Pl=new Ua;function Al(e){let t=e.lastChild;return t&&t.to==e.to&&t.type.isError}function Rl(e,t,i){for(let n of e.facet(El)){let s=n(e,t,i);if(s)return s}return function(e,t,i){let n=il(e);if(n.length<i)return null;let s=null;for(let o=n.resolveStack(i,1);o;o=o.next){let a=o.node;if(a.to<=i||a.from>i)continue;if(s&&a.from<t)break;let r=a.type.prop(Pl);if(r&&(a.to<n.length-50||n.length==e.doc.length||!Al(a))){let n=r(a,e);n&&n.from<=i&&n.from>=t&&n.to>i&&(s=n)}}return s}(e,t,i)}function Dl(e,t){let i=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);return i>=n?void 0:{from:i,to:n}}const Vl=me.define({map:Dl}),Ll=me.define({map:Dl});function Tl(e){let t=[];for(let{head:i}of e.state.selection.ranges)t.some((e=>e.from<=i&&e.to>=i))||t.push(e.lineBlockAt(i));return t}const Bl=Y.define({create:()=>oi.none,update(e,t){e=e.map(t.changes);for(let i of t.effects)if(i.is(Vl)&&!Il(e,i.value.from,i.value.to)){let{preparePlaceholder:n}=t.state.facet(Nl),s=n?oi.replace({widget:new Ul(n(t.state,i.value))}):zl;e=e.update({add:[s.range(i.value.from,i.value.to)]})}else i.is(Ll)&&(e=e.update({filter:(e,t)=>i.value.from!=e||i.value.to!=t,filterFrom:i.value.from,filterTo:i.value.to}));if(t.selection){let i=!1,{head:n}=t.selection.main;e.between(n,n,((e,t)=>{e<n&&t>n&&(i=!0)})),i&&(e=e.update({filterFrom:n,filterTo:n,filter:(e,t)=>t<=n||e>=n}))}return e},provide:e=>Js.decorations.from(e),toJSON(e,t){let i=[];return e.between(0,t.doc.length,((e,t)=>{i.push(e,t)})),i},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let i=0;i<e.length;){let n=e[i++],s=e[i++];if("number"!=typeof n||"number"!=typeof s)throw new RangeError("Invalid JSON for fold state");t.push(zl.range(n,s))}return oi.set(t,!0)}});function Fl(e,t,i){var n;let s=null;return null===(n=e.field(Bl,!1))||void 0===n||n.between(t,i,((e,t)=>{(!s||s.from>e)&&(s={from:e,to:t})})),s}function Il(e,t,i){let n=!1;return e.between(t,t,((e,s)=>{e==t&&s==i&&(n=!0)})),n}function jl(e,t){return e.field(Bl,!1)?t:t.concat(me.appendConfig.of(Zl()))}function Ml(e,t,i=!0){let n=e.state.doc.lineAt(t.from).number,s=e.state.doc.lineAt(t.to).number;return Js.announce.of(`${e.state.phrase(i?"Folded lines":"Unfolded lines")} ${n} ${e.state.phrase("to")} ${s}.`)}const Ql=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:e=>{for(let t of Tl(e)){let i=Rl(e.state,t.from,t.to);if(i)return e.dispatch({effects:jl(e.state,[Vl.of(i),Ml(e,i)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:e=>{if(!e.state.field(Bl,!1))return!1;let t=[];for(let i of Tl(e)){let n=Fl(e.state,i.from,i.to);n&&t.push(Ll.of(n),Ml(e,n,!1))}return t.length&&e.dispatch({effects:t}),t.length>0}},{key:"Ctrl-Alt-[",run:e=>{let{state:t}=e,i=[];for(let n=0;n<t.doc.length;){let s=e.lineBlockAt(n),o=Rl(t,s.from,s.to);o&&i.push(Vl.of(o)),n=(o?e.lineBlockAt(o.to):s).to+1}return i.length&&e.dispatch({effects:jl(e.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:e=>{let t=e.state.field(Bl,!1);if(!t||!t.size)return!1;let i=[];return t.between(0,e.state.doc.length,((e,t)=>{i.push(Ll.of({from:e,to:t}))})),e.dispatch({effects:i}),!0}}],Wl={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},Nl=N.define({combine:e=>ke(e,Wl)});function Zl(e){let t=[Bl,Hl];return e&&t.push(Nl.of(e)),t}function ql(e,t){let{state:i}=e,n=i.facet(Nl),s=t=>{let i=e.lineBlockAt(e.posAtDOM(t.target)),n=Fl(e.state,i.from,i.to);n&&e.dispatch({effects:Ll.of(n)}),t.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(e,s,t);let o=document.createElement("span");return o.textContent=n.placeholderText,o.setAttribute("aria-label",i.phrase("folded code")),o.title=i.phrase("unfold"),o.className="cm-foldPlaceholder",o.onclick=s,o}const zl=oi.replace({widget:new class extends ni{toDOM(e){return ql(e,null)}}});class Ul extends ni{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return ql(e,this.value)}}const Xl={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Gl extends ya{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function Yl(e={}){let t=Object.assign(Object.assign({},Xl),e),i=new Gl(t,!0),n=new Gl(t,!1),s=tn.fromClass(class{constructor(e){this.from=e.viewport.from,this.markers=this.buildMarkers(e)}update(e){(e.docChanged||e.viewportChanged||e.startState.facet(dl)!=e.state.facet(dl)||e.startState.field(Bl,!1)!=e.state.field(Bl,!1)||il(e.startState)!=il(e.state)||t.foldingChanged(e))&&(this.markers=this.buildMarkers(e.view))}buildMarkers(e){let t=new Ve;for(let s of e.viewportLineBlocks){let o=Fl(e.state,s.from,s.to)?n:Rl(e.state,s.from,s.to)?i:null;o&&t.add(s.from,s.from,o)}return t.finish()}}),{domEventHandlers:o}=t;return[s,Sa({class:"cm-foldGutter",markers(e){var t;return(null===(t=e.plugin(s))||void 0===t?void 0:t.markers)||De.empty},initialSpacer:()=>new Gl(t,!1),domEventHandlers:Object.assign(Object.assign({},o),{click:(e,t,i)=>{if(o.click&&o.click(e,t,i))return!0;let n=Fl(e.state,t.from,t.to);if(n)return e.dispatch({effects:Ll.of(n)}),!0;let s=Rl(e.state,t.from,t.to);return!!s&&(e.dispatch({effects:Vl.of(s)}),!0)}})}),Zl()]}const Hl=Js.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Kl{constructor(e,t){let i;function n(e){let t=Ge.newName();return(i||(i=Object.create(null)))["."+t]=e,t}this.specs=e;const s="string"==typeof t.all?t.all:t.all?n(t.all):void 0,o=t.scope;this.scope=o instanceof Jr?e=>e.prop(Yr)==o.data:o?e=>e==o:void 0,this.style=Ar(e.map((e=>({tag:e.tag,class:e.class||n(Object.assign({},e,{tag:null}))}))),{all:s}).style,this.module=i?new Ge(i):null,this.themeType=t.themeType}static define(e,t){return new Kl(e,t||{})}}const Jl=N.define(),ec=N.define({combine:e=>e.length?[e[0]]:null});function tc(e){let t=e.facet(Jl);return t.length?t:e.facet(ec)}function ic(e,t){let i,n=[sc];return e instanceof Kl&&(e.module&&n.push(Js.styleModule.of(e.module)),i=e.themeType),(null==t?void 0:t.fallback)?n.push(ec.of(e)):i?n.push(Jl.computeN([Js.darkTheme],(t=>t.facet(Js.darkTheme)==("dark"==i)?[e]:[]))):n.push(Jl.of(e)),n}class nc{constructor(e){this.markCache=Object.create(null),this.tree=il(e.state),this.decorations=this.buildDeco(e,tc(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=il(e.state),i=tc(e.state),n=i!=tc(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!n&&t.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return oi.none;let i=new Ve;for(let{from:n,to:s}of e.visibleRanges)Rr(this.tree,t,((e,t,n)=>{i.add(e,t,this.markCache[n]||(this.markCache[n]=oi.mark({class:n})))}),n,s);return i.finish()}}const sc=K.high(tn.fromClass(nc,{decorations:e=>e.decorations})),oc=Kl.define([{tag:Xr.meta,color:"#404740"},{tag:Xr.link,textDecoration:"underline"},{tag:Xr.heading,textDecoration:"underline",fontWeight:"bold"},{tag:Xr.emphasis,fontStyle:"italic"},{tag:Xr.strong,fontWeight:"bold"},{tag:Xr.strikethrough,textDecoration:"line-through"},{tag:Xr.keyword,color:"#708"},{tag:[Xr.atom,Xr.bool,Xr.url,Xr.contentSeparator,Xr.labelName],color:"#219"},{tag:[Xr.literal,Xr.inserted],color:"#164"},{tag:[Xr.string,Xr.deleted],color:"#a11"},{tag:[Xr.regexp,Xr.escape,Xr.special(Xr.string)],color:"#e40"},{tag:Xr.definition(Xr.variableName),color:"#00f"},{tag:Xr.local(Xr.variableName),color:"#30a"},{tag:[Xr.typeName,Xr.namespace],color:"#085"},{tag:Xr.className,color:"#167"},{tag:[Xr.special(Xr.variableName),Xr.macroName],color:"#256"},{tag:Xr.definition(Xr.propertyName),color:"#00c"},{tag:Xr.comment,color:"#940"},{tag:Xr.invalid,color:"#f00"}]),ac=Js.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),rc="()[]{}",lc=N.define({combine:e=>ke(e,{afterCursor:!0,brackets:rc,maxScanDistance:1e4,renderMatch:dc})}),cc=oi.mark({class:"cm-matchingBracket"}),hc=oi.mark({class:"cm-nonmatchingBracket"});function dc(e){let t=[],i=e.matched?cc:hc;return t.push(i.range(e.start.from,e.start.to)),e.end&&t.push(i.range(e.end.from,e.end.to)),t}const uc=Y.define({create:()=>oi.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let i=[],n=t.state.facet(lc);for(let e of t.state.selection.ranges){if(!e.empty)continue;let s=vc(t.state,e.head,-1,n)||e.head>0&&vc(t.state,e.head-1,1,n)||n.afterCursor&&(vc(t.state,e.head,1,n)||e.head<t.state.doc.length&&vc(t.state,e.head+1,-1,n));s&&(i=i.concat(n.renderMatch(s,t.state)))}return oi.set(i,!0)},provide:e=>Js.decorations.from(e)}),pc=[uc,ac];function fc(e={}){return[lc.of(e),pc]}const mc=new Ua;function gc(e,t,i){let n=e.prop(t<0?Ua.openedBy:Ua.closedBy);if(n)return n;if(1==e.name.length){let n=i.indexOf(e.name);if(n>-1&&n%2==(t<0?1:0))return[i[n+t]]}return null}function bc(e){let t=e.type.prop(mc);return t?t(e.node):e}function vc(e,t,i,n={}){let s=n.maxScanDistance||1e4,o=n.brackets||rc,a=il(e),r=a.resolveInner(t,i);for(let e=r;e;e=e.parent){let n=gc(e.type,i,o);if(n&&e.from<e.to){let s=bc(e);if(s&&(i>0?t>=s.from&&t<s.to:t>s.from&&t<=s.to))return wc(0,0,i,e,s,n,o)}}return function(e,t,i,n,s,o,a){let r=i<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),l=a.indexOf(r);if(l<0||l%2==0!=i>0)return null;let c={from:i<0?t-1:t,to:i>0?t+1:t},h=e.doc.iterRange(t,i>0?e.doc.length:0),d=0;for(let e=0;!h.next().done&&e<=o;){let o=h.value;i<0&&(e+=o.length);let r=t+e*i;for(let e=i>0?0:o.length-1,t=i>0?o.length:-1;e!=t;e+=i){let t=a.indexOf(o[e]);if(!(t<0||n.resolveInner(r+e,1).type!=s))if(t%2==0==i>0)d++;else{if(1==d)return{start:c,end:{from:r+e,to:r+e+1},matched:t>>1==l>>1};d--}}i>0&&(e+=o.length)}return h.done?{start:c,matched:!1}:null}(e,t,i,a,r.type,s,o)}function wc(e,t,i,n,s,o,a){let r=n.parent,l={from:s.from,to:s.to},c=0,h=null==r?void 0:r.cursor();if(h&&(i<0?h.childBefore(n.from):h.childAfter(n.to)))do{if(i<0?h.to<=n.from:h.from>=n.to){if(0==c&&o.indexOf(h.type.name)>-1&&h.from<h.to){let e=bc(h);return{start:l,end:e?{from:e.from,to:e.to}:void 0,matched:!0}}if(gc(h.type,i,a))c++;else if(gc(h.type,-i,a)){if(0==c){let e=bc(h);return{start:l,end:e&&e.from<e.to?{from:e.from,to:e.to}:void 0,matched:!1}}c--}}}while(i<0?h.prevSibling():h.nextSibling());return{start:l,matched:!1}}const yc=Object.create(null),Oc=[Ya.none],xc=[],$c=Object.create(null),Cc=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Cc[e]=_c(yc,t);function Sc(e,t){xc.indexOf(e)>-1||(xc.push(e),console.warn(t))}function _c(e,t){let i=[];for(let n of t.split(" ")){let t=[];for(let i of n.split(".")){let n=e[i]||Xr[i];n?"function"==typeof n?t.length?t=t.map(n):Sc(i,`Modifier ${i} used at start of tag`):t.length?Sc(i,`Tag ${i} used as modifier`):t=Array.isArray(n)?n:[n]:Sc(i,`Unknown highlighting tag ${i}`)}for(let e of t)i.push(e)}if(!i.length)return 0;let n=t.replace(/ /g,"_"),s=n+" "+i.map((e=>e.id)),o=$c[s];if(o)return o.id;let a=$c[s]=Ya.define({id:Oc.length,name:n,props:[kr({[n]:i})]});return Oc.push(a),a.id}function kc(e,t){return({state:i,dispatch:n})=>{if(i.readOnly)return!1;let s=e(t,i);return!!s&&(n(i.update(s)),!0)}}bi.RTL,bi.LTR;const Ec=kc(Vc,0),Pc=kc(Dc,0),Ac=kc(((e,t)=>Dc(e,t,function(e){let t=[];for(let i of e.selection.ranges){let n=e.doc.lineAt(i.from),s=i.to<=n.to?n:e.doc.lineAt(i.to);s.from>n.from&&s.from==i.to&&(s=i.to==n.to+1?n:e.doc.lineAt(i.to-1));let o=t.length-1;o>=0&&t[o].to>n.from?t[o].to=s.to:t.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:s.to})}return t}(t))),0);function Rc(e,t){let i=e.languageDataAt("commentTokens",t);return i.length?i[0]:{}}function Dc(e,t,i=t.selection.ranges){let n=i.map((e=>Rc(t,e.from).block));if(!n.every((e=>e)))return null;let s=i.map(((e,i)=>function(e,{open:t,close:i},n,s){let o,a,r=e.sliceDoc(n-50,n),l=e.sliceDoc(s,s+50),c=/\s*$/.exec(r)[0].length,h=/^\s*/.exec(l)[0].length,d=r.length-c;if(r.slice(d-t.length,d)==t&&l.slice(h,h+i.length)==i)return{open:{pos:n-c,margin:c&&1},close:{pos:s+h,margin:h&&1}};s-n<=100?o=a=e.sliceDoc(n,s):(o=e.sliceDoc(n,n+50),a=e.sliceDoc(s-50,s));let u=/^\s*/.exec(o)[0].length,p=/\s*$/.exec(a)[0].length,f=a.length-p-i.length;return o.slice(u,u+t.length)==t&&a.slice(f,f+i.length)==i?{open:{pos:n+u+t.length,margin:/\s/.test(o.charAt(u+t.length))?1:0},close:{pos:s-p-i.length,margin:/\s/.test(a.charAt(f-1))?1:0}}:null}(t,n[i],e.from,e.to)));if(2!=e&&!s.every((e=>e)))return{changes:t.changes(i.map(((e,t)=>s[t]?[]:[{from:e.from,insert:n[t].open+" "},{from:e.to,insert:" "+n[t].close}])))};if(1!=e&&s.some((e=>e))){let e=[];for(let t,i=0;i<s.length;i++)if(t=s[i]){let s=n[i],{open:o,close:a}=t;e.push({from:o.pos-s.open.length,to:o.pos+o.margin},{from:a.pos-a.margin,to:a.pos+s.close.length})}return{changes:e}}return null}function Vc(e,t,i=t.selection.ranges){let n=[],s=-1;for(let{from:e,to:o}of i){let i=n.length,a=1e9,r=Rc(t,e).line;if(r){for(let i=e;i<=o;){let l=t.doc.lineAt(i);if(l.from>s&&(e==o||o>l.from)){s=l.from;let e=/^\s*/.exec(l.text)[0].length,t=e==l.length,i=l.text.slice(e,e+r.length)==r?e:-1;e<l.text.length&&e<a&&(a=e),n.push({line:l,comment:i,token:r,indent:e,empty:t,single:!1})}i=l.to+1}if(a<1e9)for(let e=i;e<n.length;e++)n[e].indent<n[e].line.text.length&&(n[e].indent=a);n.length==i+1&&(n[i].single=!0)}}if(2!=e&&n.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:i,indent:s,empty:o,single:a}of n)!a&&o||e.push({from:t.from+s,insert:i+" "});let i=t.changes(e);return{changes:i,selection:t.selection.map(i,1)}}if(1!=e&&n.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:i,token:s}of n)if(i>=0){let n=t.from+i,o=n+s.length;" "==t.text[o-t.from]&&o++,e.push({from:n,to:o})}return{changes:e}}return null}const Lc=ue.define(),Tc=ue.define(),Bc=N.define(),Fc=N.define({combine:e=>ke(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,n)=>e(i,n)||t(i,n)})}),Ic=Y.define({create:()=>eh.empty,update(e,t){let i=t.state.facet(Fc),n=t.annotation(Lc);if(n){let s=qc.fromTransaction(t,n.selection),o=n.side,a=0==o?e.undone:e.done;return a=s?zc(a,a.length,i.minDepth,s):Gc(a,t.startState.selection),new eh(0==o?n.rest:a,0==o?a:n.rest)}let s=t.annotation(Tc);if("full"!=s&&"before"!=s||(e=e.isolate()),!1===t.annotation(ge.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let o=qc.fromTransaction(t),a=t.annotation(ge.time),r=t.annotation(ge.userEvent);return o?e=e.addChanges(o,a,r,i,t):t.selection&&(e=e.addSelection(t.startState.selection,a,r,i.newGroupDelay)),"full"!=s&&"after"!=s||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new eh(e.done.map(qc.fromJSON),e.undone.map(qc.fromJSON))});function jc(e={}){return[Ic,Fc.of(e),Js.domEventHandlers({beforeinput(e,t){let i="historyUndo"==e.inputType?Qc:"historyRedo"==e.inputType?Wc:null;return!!i&&(e.preventDefault(),i(t))}})]}function Mc(e,t){return function({state:i,dispatch:n}){if(!t&&i.readOnly)return!1;let s=i.field(Ic,!1);if(!s)return!1;let o=s.pop(e,i,t);return!!o&&(n(o),!0)}}const Qc=Mc(0,!1),Wc=Mc(1,!1),Nc=Mc(0,!0),Zc=Mc(1,!0);class qc{constructor(e,t,i,n,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=n,this.selectionsAfter=s}setSelAfter(e){return new qc(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new qc(e.changes&&D.fromJSON(e.changes),[],e.mapped&&R.fromJSON(e.mapped),e.startSelection&&M.fromJSON(e.startSelection),e.selectionsAfter.map(M.fromJSON))}static fromTransaction(e,t){let i=Xc;for(let t of e.startState.facet(Bc)){let n=t(e);n.length&&(i=i.concat(n))}return!i.length&&e.changes.empty?null:new qc(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,Xc)}static selection(e){return new qc(void 0,Xc,void 0,void 0,e)}}function zc(e,t,i,n){let s=t+1>i+20?t-i-1:0,o=e.slice(s,t);return o.push(n),o}function Uc(e,t){return e.length?t.length?e.concat(t):e:t}const Xc=[];function Gc(e,t){if(e.length){let i=e[e.length-1],n=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-200));return n.length&&n[n.length-1].eq(t)?e:(n.push(t),zc(e,e.length-1,1e9,i.setSelAfter(n)))}return[qc.selection([t])]}function Yc(e){let t=e[e.length-1],i=e.slice();return i[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),i}function Hc(e,t){if(!e.length)return e;let i=e.length,n=Xc;for(;i;){let s=Kc(e[i-1],t,n);if(s.changes&&!s.changes.empty||s.effects.length){let t=e.slice(0,i);return t[i-1]=s,t}t=s.mapped,i--,n=s.selectionsAfter}return n.length?[qc.selection(n)]:Xc}function Kc(e,t,i){let n=Uc(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):Xc,i);if(!e.changes)return qc.selection(n);let s=e.changes.map(t),o=t.mapDesc(e.changes,!0),a=e.mapped?e.mapped.composeDesc(o):o;return new qc(s,me.mapEffects(e.effects,t),a,e.startSelection.map(o),n)}const Jc=/^(input\.type|delete)($|\.)/;class eh{constructor(e,t,i=0,n){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new eh(this.done,this.undone):this}addChanges(e,t,i,n,s){let o=this.done,a=o[o.length-1];return o=a&&a.changes&&!a.changes.empty&&e.changes&&(!i||Jc.test(i))&&(!a.selectionsAfter.length&&t-this.prevTime<n.newGroupDelay&&n.joinToEvent(s,function(e,t){let i=[],n=!1;return e.iterChangedRanges(((e,t)=>i.push(e,t))),t.iterChangedRanges(((e,t,s,o)=>{for(let e=0;e<i.length;){let t=i[e++],a=i[e++];o>=t&&s<=a&&(n=!0)}})),n}(a.changes,e.changes))||"input.type.compose"==i)?zc(o,o.length-1,n.minDepth,new qc(e.changes.compose(a.changes),Uc(me.mapEffects(e.effects,a.changes),a.effects),a.mapped,a.startSelection,Xc)):zc(o,o.length,n.minDepth,e),new eh(o,Xc,t,i)}addSelection(e,t,i,n){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Xc;return s.length>0&&t-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(o=s[s.length-1],a=e,o.ranges.length==a.ranges.length&&0===o.ranges.filter(((e,t)=>e.empty!=a.ranges[t].empty)).length)?this:new eh(Gc(this.done,e),this.undone,t,i);var o,a}addMapping(e){return new eh(Hc(this.done,e),Hc(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let n=0==e?this.done:this.undone;if(0==n.length)return null;let s=n[n.length-1],o=s.selectionsAfter[0]||t.selection;if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Lc.of({side:e,rest:Yc(n),selection:o}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let i=1==n.length?Xc:n.slice(0,n.length-1);return s.mapped&&(i=Hc(i,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Lc.of({side:e,rest:i,selection:o}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}eh.empty=new eh(Xc,Xc);const th=[{key:"Mod-z",run:Qc,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Wc,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Wc,preventDefault:!0},{key:"Mod-u",run:Nc,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Zc,preventDefault:!0}];function ih(e,t){return M.create(e.ranges.map(t),e.mainIndex)}function nh(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function sh({state:e,dispatch:t},i){let n=ih(e.selection,i);return!n.eq(e.selection,!0)&&(t(nh(e,n)),!0)}function oh(e,t){return M.cursor(t?e.to:e.from)}function ah(e,t){return sh(e,(i=>i.empty?e.moveByChar(i,t):oh(i,t)))}function rh(e){return e.textDirectionAt(e.state.selection.main.head)==bi.LTR}const lh=e=>ah(e,!rh(e)),ch=e=>ah(e,rh(e));function hh(e,t){return sh(e,(i=>i.empty?e.moveByGroup(i,t):oh(i,t)))}function dh(e,t,i){if(t.type.prop(i))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function uh(e,t,i){let n,s,o=il(e).resolveInner(t.head),a=i?Ua.closedBy:Ua.openedBy;for(let n=t.head;;){let t=i?o.childAfter(n):o.childBefore(n);if(!t)break;dh(e,t,a)?o=t:n=i?t.to:t.from}return s=o.type.prop(a)&&(n=i?vc(e,o.from,1):vc(e,o.to,-1))&&n.matched?i?n.end.to:n.end.from:i?o.to:o.from,M.cursor(s,i?-1:1)}function ph(e,t){return sh(e,(i=>{if(!i.empty)return oh(i,t);let n=e.moveVertically(i,t);return n.head!=i.head?n:e.moveToLineBoundary(i,t)}))}"undefined"!=typeof Intl&&Intl.Segmenter;const fh=e=>ph(e,!1),mh=e=>ph(e,!0);function gh(e){let t,i=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,n=0,s=0;if(i){for(let t of e.state.facet(Js.scrollMargins)){let i=t(e);(null==i?void 0:i.top)&&(n=Math.max(null==i?void 0:i.top,n)),(null==i?void 0:i.bottom)&&(s=Math.max(null==i?void 0:i.bottom,s))}t=e.scrollDOM.clientHeight-n-s}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:s,selfScroll:i,height:Math.max(e.defaultLineHeight,t-5)}}function bh(e,t){let i,n=gh(e),{state:s}=e,o=ih(s.selection,(i=>i.empty?e.moveVertically(i,t,n.height):oh(i,t)));if(o.eq(s.selection))return!1;if(n.selfScroll){let t=e.coordsAtPos(s.selection.main.head),a=e.scrollDOM.getBoundingClientRect(),r=a.top+n.marginTop,l=a.bottom-n.marginBottom;t&&t.top>r&&t.bottom<l&&(i=Js.scrollIntoView(o.main.head,{y:"start",yMargin:t.top-r}))}return e.dispatch(nh(s,o),{effects:i}),!0}const vh=e=>bh(e,!1),wh=e=>bh(e,!0);function yh(e,t,i){let n=e.lineBlockAt(t.head),s=e.moveToLineBoundary(t,i);if(s.head==t.head&&s.head!=(i?n.to:n.from)&&(s=e.moveToLineBoundary(t,i,!1)),!i&&s.head==n.from&&n.length){let i=/^\s*/.exec(e.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&t.head!=n.from+i&&(s=M.cursor(n.from+i))}return s}function Oh(e,t){let i=ih(e.state.selection,(e=>{let i=t(e);return M.range(e.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)}));return!i.eq(e.state.selection)&&(e.dispatch(nh(e.state,i)),!0)}function xh(e,t){return Oh(e,(i=>e.moveByChar(i,t)))}const $h=e=>xh(e,!rh(e)),Ch=e=>xh(e,rh(e));function Sh(e,t){return Oh(e,(i=>e.moveByGroup(i,t)))}function _h(e,t){return Oh(e,(i=>e.moveVertically(i,t)))}const kh=e=>_h(e,!1),Eh=e=>_h(e,!0);function Ph(e,t){return Oh(e,(i=>e.moveVertically(i,t,gh(e).height)))}const Ah=e=>Ph(e,!1),Rh=e=>Ph(e,!0),Dh=({state:e,dispatch:t})=>(t(nh(e,{anchor:0})),!0),Vh=({state:e,dispatch:t})=>(t(nh(e,{anchor:e.doc.length})),!0),Lh=({state:e,dispatch:t})=>(t(nh(e,{anchor:e.selection.main.anchor,head:0})),!0),Th=({state:e,dispatch:t})=>(t(nh(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0);function Bh(e,t){if(e.state.readOnly)return!1;let i="delete.selection",{state:n}=e,s=n.changeByRange((n=>{let{from:s,to:o}=n;if(s==o){let a=t(n);a<s?(i="delete.backward",a=Fh(e,a,!1)):a>s&&(i="delete.forward",a=Fh(e,a,!0)),s=Math.min(s,a),o=Math.max(o,a)}else s=Fh(e,s,!1),o=Fh(e,o,!0);return s==o?{range:n}:{changes:{from:s,to:o},range:M.cursor(s,s<n.head?-1:1)}}));return!s.changes.empty&&(e.dispatch(n.update(s,{scrollIntoView:!0,userEvent:i,effects:"delete.selection"==i?Js.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function Fh(e,t,i){if(e instanceof Js)for(let n of e.state.facet(Js.atomicRanges).map((t=>t(e))))n.between(t,t,((e,n)=>{e<t&&n>t&&(t=i?n:e)}));return t}const Ih=(e,t,i)=>Bh(e,(n=>{let s,o,a=n.from,{state:r}=e,l=r.doc.lineAt(a);if(i&&!t&&a>l.from&&a<l.from+200&&!/[^ \t]/.test(s=l.text.slice(0,a-l.from))){if("\t"==s[s.length-1])return a-1;let e=Ze(s,r.tabSize)%ml(r)||ml(r);for(let t=0;t<e&&" "==s[s.length-1-t];t++)a--;o=a}else o=S(l.text,a-l.from,t,t)+l.from,o==a&&l.number!=(t?r.doc.lines:1)?o+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(l.text.slice(o-l.from,a-l.from))&&(o=S(l.text,o-l.from,!1,!1)+l.from);return o})),jh=e=>Ih(e,!1,!0),Mh=e=>Ih(e,!0,!1),Qh=(e,t)=>Bh(e,(i=>{let n=i.head,{state:s}=e,o=s.doc.lineAt(n),a=s.charCategorizer(n);for(let e=null;;){if(n==(t?o.to:o.from)){n==i.head&&o.number!=(t?s.doc.lines:1)&&(n+=t?1:-1);break}let r=S(o.text,n-o.from,t)+o.from,l=o.text.slice(Math.min(n,r)-o.from,Math.max(n,r)-o.from),c=a(l);if(null!=e&&c!=e)break;" "==l&&n==i.head||(e=c),n=r}return n})),Wh=e=>Qh(e,!1);function Nh(e){let t=[],i=-1;for(let n of e.selection.ranges){let s=e.doc.lineAt(n.from),o=e.doc.lineAt(n.to);if(n.empty||n.to!=o.from||(o=e.doc.lineAt(n.to-1)),i>=s.number){let e=t[t.length-1];e.to=o.to,e.ranges.push(n)}else t.push({from:s.from,to:o.to,ranges:[n]});i=o.number+1}return t}function Zh(e,t,i){if(e.readOnly)return!1;let n=[],s=[];for(let t of Nh(e)){if(i?t.to==e.doc.length:0==t.from)continue;let o=e.doc.lineAt(i?t.to+1:t.from-1),a=o.length+1;if(i){n.push({from:t.to,to:o.to},{from:t.from,insert:o.text+e.lineBreak});for(let i of t.ranges)s.push(M.range(Math.min(e.doc.length,i.anchor+a),Math.min(e.doc.length,i.head+a)))}else{n.push({from:o.from,to:t.from},{from:t.to,insert:e.lineBreak+o.text});for(let e of t.ranges)s.push(M.range(e.anchor-a,e.head-a))}}return!!n.length&&(t(e.update({changes:n,scrollIntoView:!0,selection:M.create(s,e.selection.mainIndex),userEvent:"move.line"})),!0)}function qh(e,t,i){if(e.readOnly)return!1;let n=[];for(let t of Nh(e))i?n.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):n.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const zh=Uh(!1);function Uh(e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let n=t.changeByRange((i=>{let{from:n,to:s}=i,o=t.doc.lineAt(n),a=!e&&n==s&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let i,n=il(e).resolveInner(t),s=n.childBefore(t),o=n.childAfter(t);return s&&o&&s.to<=t&&o.from>=t&&(i=s.type.prop(Ua.closedBy))&&i.indexOf(o.name)>-1&&e.doc.lineAt(s.to).from==e.doc.lineAt(o.from).from&&!/\S/.test(e.sliceDoc(s.to,o.from))?{from:s.to,to:o.from}:null}(t,n);e&&(n=s=(s<=o.to?o:t.doc.lineAt(s)).to);let r=new vl(t,{simulateBreak:n,simulateDoubleBreak:!!a}),l=bl(r,n);for(null==l&&(l=Ze(/^\s*/.exec(t.doc.lineAt(n).text)[0],t.tabSize));s<o.to&&/\s/.test(o.text[s-o.from]);)s++;a?({from:n,to:s}=a):n>o.from&&n<o.from+100&&!/\S/.test(o.text.slice(0,n))&&(n=o.from);let c=["",gl(t,l)];return a&&c.push(gl(t,r.lineIndent(o.from,-1))),{changes:{from:n,to:s,insert:m.of(c)},range:M.cursor(n+1+c[1].length)}}));return i(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function Xh(e,t){let i=-1;return e.changeByRange((n=>{let s=[];for(let o=n.from;o<=n.to;){let a=e.doc.lineAt(o);a.number>i&&(n.empty||n.to>a.from)&&(t(a,s,n),i=a.number),o=a.to+1}let o=e.changes(s);return{changes:s,range:M.range(o.mapPos(n.anchor,1),o.mapPos(n.head,1))}}))}const Gh=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e=>sh(e,(t=>uh(e.state,t,!rh(e)))),shift:e=>Oh(e,(t=>uh(e.state,t,!rh(e))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:e=>sh(e,(t=>uh(e.state,t,rh(e)))),shift:e=>Oh(e,(t=>uh(e.state,t,rh(e))))},{key:"Alt-ArrowUp",run:({state:e,dispatch:t})=>Zh(e,t,!1)},{key:"Shift-Alt-ArrowUp",run:({state:e,dispatch:t})=>qh(e,t,!1)},{key:"Alt-ArrowDown",run:({state:e,dispatch:t})=>Zh(e,t,!0)},{key:"Shift-Alt-ArrowDown",run:({state:e,dispatch:t})=>qh(e,t,!0)},{key:"Escape",run:({state:e,dispatch:t})=>{let i=e.selection,n=null;return i.ranges.length>1?n=M.create([i.main]):i.main.empty||(n=M.create([M.cursor(i.main.head)])),!!n&&(t(nh(e,n)),!0)}},{key:"Mod-Enter",run:Uh(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:e,dispatch:t})=>{let i=Nh(e).map((({from:t,to:i})=>M.range(t,Math.min(i+1,e.doc.length))));return t(e.update({selection:M.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:e,dispatch:t})=>{let i=ih(e.selection,(t=>{let i=il(e),n=i.resolveStack(t.from,1);if(t.empty){let e=i.resolveStack(t.from,-1);e.node.from>=n.node.from&&e.node.to<=n.node.to&&(n=e)}for(let e=n;e;e=e.next){let{node:i}=e;if((i.from<t.from&&i.to>=t.to||i.to>t.to&&i.from<=t.from)&&e.next)return M.range(i.to,i.from)}return t}));return!i.eq(e.selection)&&(t(nh(e,i)),!0)},preventDefault:!0},{key:"Mod-[",run:({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(Xh(e,((t,i)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let s=Ze(n,e.tabSize),o=0,a=gl(e,Math.max(0,s-ml(e)));for(;o<n.length&&o<a.length&&n.charCodeAt(o)==a.charCodeAt(o);)o++;i.push({from:t.from+o,to:t.from+n.length,insert:a.slice(o)})})),{userEvent:"delete.dedent"})),!0)},{key:"Mod-]",run:({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(Xh(e,((t,i)=>{i.push({from:t.from,insert:e.facet(fl)})})),{userEvent:"input.indent"})),!0)},{key:"Mod-Alt-\\",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=Object.create(null),n=new vl(e,{overrideIndentation:e=>{let t=i[e];return null==t?-1:t}}),s=Xh(e,((t,s,o)=>{let a=bl(n,t.from);if(null==a)return;/\S/.test(t.text)||(a=0);let r=/^\s*/.exec(t.text)[0],l=gl(e,a);(r!=l||o.from<t.from+r.length)&&(i[t.from]=a,s.push({from:t.from,to:t.from+r.length,insert:l}))}));return s.changes.empty||t(e.update(s,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:e=>{if(e.state.readOnly)return!1;let{state:t}=e,i=t.changes(Nh(t).map((({from:e,to:i})=>(e>0?e--:i<t.doc.length&&i++,{from:e,to:i})))),n=ih(t.selection,(t=>{let i;if(e.lineWrapping){let n=e.lineBlockAt(t.head),s=e.coordsAtPos(t.head,t.assoc||1);s&&(i=n.bottom+e.documentTop-s.bottom+e.defaultLineHeight/2)}return e.moveVertically(t,!0,i)})).map(i);return e.dispatch({changes:i,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:e,dispatch:t})=>function(e,t,i){let n=!1,s=ih(e.selection,(t=>{let s=vc(e,t.head,-1)||vc(e,t.head,1)||t.head>0&&vc(e,t.head-1,1)||t.head<e.doc.length&&vc(e,t.head+1,-1);if(!s||!s.end)return t;n=!0;let o=s.start.from==t.head?s.end.to:s.end.from;return i?M.range(t.anchor,o):M.cursor(o)}));return!!n&&(t(nh(e,s)),!0)}(e,t,!1)},{key:"Mod-/",run:e=>{let{state:t}=e,i=t.doc.lineAt(t.selection.main.from),n=Rc(e.state,i.from);return n.line?Ec(e):!!n.block&&Ac(e)}},{key:"Alt-A",run:Pc},{key:"Ctrl-m",mac:"Shift-Alt-m",run:e=>(e.setTabFocusMode(),!0)}].concat([{key:"ArrowLeft",run:lh,shift:$h,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e=>hh(e,!rh(e)),shift:e=>Sh(e,!rh(e)),preventDefault:!0},{mac:"Cmd-ArrowLeft",run:e=>sh(e,(t=>yh(e,t,!rh(e)))),shift:e=>Oh(e,(t=>yh(e,t,!rh(e)))),preventDefault:!0},{key:"ArrowRight",run:ch,shift:Ch,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:e=>hh(e,rh(e)),shift:e=>Sh(e,rh(e)),preventDefault:!0},{mac:"Cmd-ArrowRight",run:e=>sh(e,(t=>yh(e,t,rh(e)))),shift:e=>Oh(e,(t=>yh(e,t,rh(e)))),preventDefault:!0},{key:"ArrowUp",run:fh,shift:kh,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Dh,shift:Lh},{mac:"Ctrl-ArrowUp",run:vh,shift:Ah},{key:"ArrowDown",run:mh,shift:Eh,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Vh,shift:Th},{mac:"Ctrl-ArrowDown",run:wh,shift:Rh},{key:"PageUp",run:vh,shift:Ah},{key:"PageDown",run:wh,shift:Rh},{key:"Home",run:e=>sh(e,(t=>yh(e,t,!1))),shift:e=>Oh(e,(t=>yh(e,t,!1))),preventDefault:!0},{key:"Mod-Home",run:Dh,shift:Lh},{key:"End",run:e=>sh(e,(t=>yh(e,t,!0))),shift:e=>Oh(e,(t=>yh(e,t,!0))),preventDefault:!0},{key:"Mod-End",run:Vh,shift:Th},{key:"Enter",run:zh,shift:zh},{key:"Mod-a",run:({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:jh,shift:jh},{key:"Delete",run:Mh},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Wh},{key:"Mod-Delete",mac:"Alt-Delete",run:e=>Qh(e,!0)},{mac:"Mod-Backspace",run:e=>Bh(e,(t=>{let i=e.moveToLineBoundary(t,!1).head;return t.head>i?i:Math.max(0,t.head-1)}))},{mac:"Mod-Delete",run:e=>Bh(e,(t=>{let i=e.moveToLineBoundary(t,!0).head;return t.head<i?i:Math.min(e.state.doc.length,t.head+1)}))}].concat([{key:"Ctrl-b",run:lh,shift:$h,preventDefault:!0},{key:"Ctrl-f",run:ch,shift:Ch},{key:"Ctrl-p",run:fh,shift:kh},{key:"Ctrl-n",run:mh,shift:Eh},{key:"Ctrl-a",run:e=>sh(e,(t=>M.cursor(e.lineBlockAt(t.head).from,1))),shift:e=>Oh(e,(t=>M.cursor(e.lineBlockAt(t.head).from)))},{key:"Ctrl-e",run:e=>sh(e,(t=>M.cursor(e.lineBlockAt(t.head).to,-1))),shift:e=>Oh(e,(t=>M.cursor(e.lineBlockAt(t.head).to)))},{key:"Ctrl-d",run:Mh},{key:"Ctrl-h",run:jh},{key:"Ctrl-k",run:e=>Bh(e,(t=>{let i=e.lineBlockAt(t.head).to;return t.head<i?i:Math.min(e.state.doc.length,t.head+1)}))},{key:"Ctrl-Alt-h",run:Wh},{key:"Ctrl-o",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:m.of(["",""])},range:M.cursor(e.from)})));return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let i=t.from,n=e.doc.lineAt(i),s=i==n.from?i-1:S(n.text,i-n.from,!1)+n.from,o=i==n.to?i+1:S(n.text,i-n.from,!0)+n.from;return{changes:{from:s,to:o,insert:e.doc.slice(i,o).append(e.doc.slice(s,i))},range:M.cursor(o)}}));return!i.changes.empty&&(t(e.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:wh}].map((e=>({mac:e.key,run:e.run,shift:e.shift})))));function Yh(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];"string"==typeof s?e.setAttribute(n,s):null!=s&&(e[n]=s)}t++}for(;t<arguments.length;t++)Hh(e,arguments[t]);return e}function Hh(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var i=0;i<t.length;i++)Hh(e,t[i])}}const Kh="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class Jh{constructor(e,t,i=0,n=e.length,s,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,n),this.bufferStart=i,this.normalize=s?e=>s(Kh(e)):Kh,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return _(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=k(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=E(e);let n=this.normalize(t);if(n.length)for(let e=0,s=i;;e++){let o=n.charCodeAt(e),a=this.match(o,s,this.bufferPos+this.bufferStart);if(e==n.length-1){if(a)return this.value=a,this;break}s==i&&e<t.length&&t.charCodeAt(e)==o&&s++}}}match(e,t,i){let n=null;for(let t=0;t<this.matches.length;t+=2){let s=this.matches[t],o=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?n={from:this.matches[t+1],to:i}:(this.matches[t]++,o=!0)),o||(this.matches.splice(t,2),t-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?n={from:t,to:i}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}"undefined"!=typeof Symbol&&(Jh.prototype[Symbol.iterator]=function(){return this});const ed={from:-1,to:-1,match:/.*/.exec("")},td="gm"+(null==/x/.unicode?"":"u");class id{constructor(e,t,i,n=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=ed,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new od(e,t,i,n,s);this.re=new RegExp(t,td+((null==i?void 0:i.ignoreCase)?"i":"")),this.test=null==i?void 0:i.test,this.iter=e.iter();let o=e.lineAt(n);this.curLineStart=o.from,this.matchPos=ad(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,n=i+t[0].length;if(this.matchPos=ad(this.text,n+(i==n?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<n||i>this.value.to)&&(!this.test||this.test(i,n,t)))return this.value={from:i,to:n,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const nd=new WeakMap;class sd{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let n=nd.get(e);if(!n||n.from>=i||n.to<=t){let n=new sd(t,e.sliceString(t,i));return nd.set(e,n),n}if(n.from==t&&n.to==i)return n;let{text:s,from:o}=n;return o>t&&(s=e.sliceString(t,o)+s,o=t),n.to<i&&(s+=e.sliceString(n.to,i)),nd.set(e,new sd(o,s)),new sd(t,s.slice(t-o,i-o))}}class od{constructor(e,t,i,n,s){this.text=e,this.to=s,this.done=!1,this.value=ed,this.matchPos=ad(e,n),this.re=new RegExp(t,td+((null==i?void 0:i.ignoreCase)?"i":"")),this.test=null==i?void 0:i.test,this.flat=sd.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let e=this.flat.from+t.index,i=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,i,t)))return this.value={from:e,to:i,match:t},this.matchPos=ad(this.text,i+(e==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=sd.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function ad(e,t){if(t>=e.length)return t;let i,n=e.lineAt(t);for(;t<n.to&&(i=n.text.charCodeAt(t-n.from))>=56320&&i<57344;)t++;return t}function rd(e){let t=Yh("input",{class:"cm-textfield",name:"line",value:String(e.state.doc.lineAt(e.state.selection.main.head).number)});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!i)return;let{state:n}=e,s=n.doc.lineAt(n.selection.main.head),[,o,a,r,l]=i,c=r?+r.slice(1):0,h=a?+a:s.number;if(a&&l){let e=h/100;o&&(e=e*("-"==o?-1:1)+s.number/n.doc.lines),h=Math.round(n.doc.lines*e)}else a&&o&&(h=h*("-"==o?-1:1)+s.number);let d=n.doc.line(Math.max(1,Math.min(n.doc.lines,h))),u=M.cursor(d.from+Math.max(0,Math.min(c,d.length)));e.dispatch({effects:[ld.of(!1),Js.scrollIntoView(u.from,{y:"center"})],selection:u}),e.focus()}return{dom:Yh("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:ld.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),i())},onsubmit:e=>{e.preventDefault(),i()}},Yh("label",e.state.phrase("Go to line"),": ",t)," ",Yh("button",{class:"cm-button",type:"submit"},e.state.phrase("go")))}}"undefined"!=typeof Symbol&&(id.prototype[Symbol.iterator]=od.prototype[Symbol.iterator]=function(){return this});const ld=me.define(),cd=Y.define({create:()=>!0,update(e,t){for(let i of t.effects)i.is(ld)&&(e=i.value);return e},provide:e=>wa.from(e,(e=>e?rd:null))}),hd=Js.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),dd={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},ud=N.define({combine:e=>ke(e,dd,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})});function pd(e){let t=[vd,bd];return e&&t.push(ud.of(e)),t}const fd=oi.mark({class:"cm-selectionMatch"}),md=oi.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function gd(e,t,i,n){return!(0!=i&&e(t.sliceDoc(i-1,i))==$e.Word||n!=t.doc.length&&e(t.sliceDoc(n,n+1))==$e.Word)}const bd=tn.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(ud),{state:i}=e,n=i.selection;if(n.ranges.length>1)return oi.none;let s,o=n.main,a=null;if(o.empty){if(!t.highlightWordAroundCursor)return oi.none;let e=i.wordAt(o.head);if(!e)return oi.none;a=i.charCategorizer(o.head),s=i.sliceDoc(e.from,e.to)}else{let e=o.to-o.from;if(e<t.minSelectionLength||e>200)return oi.none;if(t.wholeWords){if(s=i.sliceDoc(o.from,o.to),a=i.charCategorizer(o.head),!gd(a,i,o.from,o.to)||!function(e,t,i,n){return e(t.sliceDoc(i,i+1))==$e.Word&&e(t.sliceDoc(n-1,n))==$e.Word}(a,i,o.from,o.to))return oi.none}else if(s=i.sliceDoc(o.from,o.to),!s)return oi.none}let r=[];for(let n of e.visibleRanges){let e=new Jh(i.doc,s,n.from,n.to);for(;!e.next().done;){let{from:n,to:s}=e.value;if((!a||gd(a,i,n,s))&&(o.empty&&n<=o.from&&s>=o.to?r.push(md.range(n,s)):(n>=o.to||s<=o.from)&&r.push(fd.range(n,s)),r.length>t.maxMatches))return oi.none}}return oi.set(r)}},{decorations:e=>e.decorations}),vd=Js.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),wd=N.define({combine:e=>ke(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Xd(e),scrollToMatch:e=>Js.scrollIntoView(e)})});class yd{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,td),!0}catch(e){return!1}}(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,((e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new kd(this):new $d(this)}getCursor(e,t=0,i){let n=e.doc?e:_e.create({doc:e});return null==i&&(i=n.doc.length),this.regexp?Cd(this,n,t,i):xd(this,n,t,i)}}class Od{constructor(e){this.spec=e}}function xd(e,t,i,n){return new Jh(t.doc,e.unquoted,i,n,e.caseSensitive?void 0:e=>e.toLowerCase(),e.wholeWord?function(e,t){return(i,n,s,o)=>((o>i||o+s.length<n)&&(o=Math.max(0,i-2),s=e.sliceString(o,Math.min(e.length,n+2))),!(t(Sd(s,i-o))==$e.Word&&t(_d(s,i-o))==$e.Word||t(_d(s,n-o))==$e.Word&&t(Sd(s,n-o))==$e.Word))}(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}class $d extends Od{constructor(e){super(e)}nextMatch(e,t,i){let n=xd(this.spec,e,i,e.doc.length).nextOverlapping();if(n.done){let i=Math.min(e.doc.length,t+this.spec.unquoted.length);n=xd(this.spec,e,0,i).nextOverlapping()}return n.done||n.value.from==t&&n.value.to==i?null:n.value}prevMatchInRange(e,t,i){for(let n=i;;){let i=Math.max(t,n-1e4-this.spec.unquoted.length),s=xd(this.spec,e,i,n),o=null;for(;!s.nextOverlapping().done;)o=s.value;if(o)return o;if(i==t)return null;n-=1e4}}prevMatch(e,t,i){let n=this.prevMatchInRange(e,0,t);return n||(n=this.prevMatchInRange(e,Math.max(0,i-this.spec.unquoted.length),e.doc.length)),!n||n.from==t&&n.to==i?null:n}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let i=xd(this.spec,e,0,e.doc.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let s=xd(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}function Cd(e,t,i,n){return new id(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?(s=t.charCategorizer(t.selection.main.head),(e,t,i)=>!i[0].length||(s(Sd(i.input,i.index))!=$e.Word||s(_d(i.input,i.index))!=$e.Word)&&(s(_d(i.input,i.index+i[0].length))!=$e.Word||s(Sd(i.input,i.index+i[0].length))!=$e.Word)):void 0},i,n);var s}function Sd(e,t){return e.slice(S(e,t,!1),t)}function _d(e,t){return e.slice(t,S(e,t))}class kd extends Od{nextMatch(e,t,i){let n=Cd(this.spec,e,i,e.doc.length).next();return n.done&&(n=Cd(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=1;;n++){let s=Math.max(t,i-1e4*n),o=Cd(this.spec,e,s,i),a=null;for(;!o.next().done;)a=o.value;if(a&&(s==t||a.from>s+10))return a;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,((t,i)=>{if("&"==i)return e.match[0];if("$"==i)return"$";for(let t=i.length;t>0;t--){let n=+i.slice(0,t);if(n>0&&n<e.match.length)return e.match[n]+i.slice(t)}return t}))}matchAll(e,t){let i=Cd(this.spec,e,0,e.doc.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let s=Cd(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.doc.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}const Ed=me.define(),Pd=me.define(),Ad=Y.define({create:e=>new Rd(Wd(e).create(),null),update(e,t){for(let i of t.effects)i.is(Ed)?e=new Rd(i.value.create(),e.panel):i.is(Pd)&&(e=new Rd(e.query,i.value?Qd:null));return e},provide:e=>wa.from(e,(e=>e.panel))});class Rd{constructor(e,t){this.query=e,this.panel=t}}const Dd=oi.mark({class:"cm-searchMatch"}),Vd=oi.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Ld=tn.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(Ad))}update(e){let t=e.state.field(Ad);(t!=e.startState.field(Ad)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return oi.none;let{view:i}=this,n=new Ve;for(let t=0,s=i.visibleRanges,o=s.length;t<o;t++){let{from:a,to:r}=s[t];for(;t<o-1&&r>s[t+1].from-500;)r=s[++t].to;e.highlight(i.state,a,r,((e,t)=>{let s=i.state.selection.ranges.some((i=>i.from==e&&i.to==t));n.add(e,t,s?Vd:Dd)}))}return n.finish()}},{decorations:e=>e.decorations});function Td(e){return t=>{let i=t.state.field(Ad,!1);return i&&i.query.spec.valid?e(t,i):qd(t)}}const Bd=Td(((e,{query:t})=>{let{to:i}=e.state.selection.main,n=t.nextMatch(e.state,i,i);if(!n)return!1;let s=M.single(n.from,n.to),o=e.state.facet(wd);return e.dispatch({selection:s,effects:[Hd(e,n),o.scrollToMatch(s.main,e)],userEvent:"select.search"}),Zd(e),!0})),Fd=Td(((e,{query:t})=>{let{state:i}=e,{from:n}=i.selection.main,s=t.prevMatch(i,n,n);if(!s)return!1;let o=M.single(s.from,s.to),a=e.state.facet(wd);return e.dispatch({selection:o,effects:[Hd(e,s),a.scrollToMatch(o.main,e)],userEvent:"select.search"}),Zd(e),!0})),Id=Td(((e,{query:t})=>{let i=t.matchAll(e.state,1e3);return!(!i||!i.length||(e.dispatch({selection:M.create(i.map((e=>M.range(e.from,e.to)))),userEvent:"select.search.matches"}),0))})),jd=Td(((e,{query:t})=>{let{state:i}=e,{from:n,to:s}=i.selection.main;if(i.readOnly)return!1;let o=t.nextMatch(i,n,n);if(!o)return!1;let a,r,l=o,c=[],h=[];if(l.from==n&&l.to==s&&(r=i.toText(t.getReplacement(l)),c.push({from:l.from,to:l.to,insert:r}),l=t.nextMatch(i,l.from,l.to),h.push(Js.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(n).number)+"."))),l){let t=0==c.length||c[0].from>=o.to?0:o.to-o.from-r.length;a=M.single(l.from-t,l.to-t),h.push(Hd(e,l)),h.push(i.facet(wd).scrollToMatch(a.main,e))}return e.dispatch({changes:c,selection:a,effects:h,userEvent:"input.replace"}),!0})),Md=Td(((e,{query:t})=>{if(e.state.readOnly)return!1;let i=t.matchAll(e.state,1e9).map((e=>{let{from:i,to:n}=e;return{from:i,to:n,insert:t.getReplacement(e)}}));if(!i.length)return!1;let n=e.state.phrase("replaced $ matches",i.length)+".";return e.dispatch({changes:i,effects:Js.announce.of(n),userEvent:"input.replace.all"}),!0}));function Qd(e){return e.state.facet(wd).createPanel(e)}function Wd(e,t){var i,n,s,o,a;let r=e.selection.main,l=r.empty||r.to>r.from+100?"":e.sliceDoc(r.from,r.to);if(t&&!l)return t;let c=e.facet(wd);return new yd({search:(null!==(i=null==t?void 0:t.literal)&&void 0!==i?i:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:null!==(n=null==t?void 0:t.caseSensitive)&&void 0!==n?n:c.caseSensitive,literal:null!==(s=null==t?void 0:t.literal)&&void 0!==s?s:c.literal,regexp:null!==(o=null==t?void 0:t.regexp)&&void 0!==o?o:c.regexp,wholeWord:null!==(a=null==t?void 0:t.wholeWord)&&void 0!==a?a:c.wholeWord})}function Nd(e){let t=ma(e,Qd);return t&&t.dom.querySelector("[main-field]")}function Zd(e){let t=Nd(e);t&&t==e.root.activeElement&&t.select()}const qd=e=>{let t=e.state.field(Ad,!1);if(t&&t.panel){let i=Nd(e);if(i&&i!=e.root.activeElement){let n=Wd(e.state,t.query.spec);n.valid&&e.dispatch({effects:Ed.of(n)}),i.focus(),i.select()}}else e.dispatch({effects:[Pd.of(!0),t?Ed.of(Wd(e.state,t.query.spec)):me.appendConfig.of(Jd)]});return!0},zd=e=>{let t=e.state.field(Ad,!1);if(!t||!t.panel)return!1;let i=ma(e,Qd);return i&&i.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:Pd.of(!1)}),!0},Ud=[{key:"Mod-f",run:qd,scope:"editor search-panel"},{key:"F3",run:Bd,shift:Fd,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Bd,shift:Fd,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:zd,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:e,dispatch:t})=>{let i=e.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:s}=i.main,o=[],a=0;for(let t=new Jh(e.doc,e.sliceDoc(n,s));!t.next().done;){if(o.length>1e3)return!1;t.value.from==n&&(a=o.length),o.push(M.range(t.value.from,t.value.to))}return t(e.update({selection:M.create(o,a),userEvent:"select.search.matches"})),!0}},{key:"Mod-Alt-g",run:e=>{let t=ma(e,rd);if(!t){let i=[ld.of(!0)];null==e.state.field(cd,!1)&&i.push(me.appendConfig.of([cd,hd])),e.dispatch({effects:i}),t=ma(e,rd)}return t&&t.dom.querySelector("input").select(),!0}},{key:"Mod-d",run:({state:e,dispatch:t})=>{let{ranges:i}=e.selection;if(i.some((e=>e.from===e.to)))return(({state:e,dispatch:t})=>{let{selection:i}=e,n=M.create(i.ranges.map((t=>e.wordAt(t.head)||M.cursor(t.head))),i.mainIndex);return!n.eq(i)&&(t(e.update({selection:n})),!0)})({state:e,dispatch:t});let n=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=n)))return!1;let s=function(e,t){let{main:i,ranges:n}=e.selection,s=e.wordAt(i.head),o=s&&s.from==i.from&&s.to==i.to;for(let i=!1,s=new Jh(e.doc,t,n[n.length-1].to);;){if(s.next(),!s.done){if(i&&n.some((e=>e.from==s.value.from)))continue;if(o){let t=e.wordAt(s.value.from);if(!t||t.from!=s.value.from||t.to!=s.value.to)continue}return s.value}if(i)return null;s=new Jh(e.doc,t,0,Math.max(0,n[n.length-1].from-1)),i=!0}}(e,n);return!!s&&(t(e.update({selection:e.selection.addRange(M.range(s.from,s.to),!1),effects:Js.scrollIntoView(s.to)})),!0)},preventDefault:!0}];class Xd{constructor(e){this.view=e;let t=this.query=e.state.field(Ad).query.spec;function i(e,t,i){return Yh("button",{class:"cm-button",name:e,onclick:t,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=Yh("input",{value:t.search,placeholder:Gd(e,"Find"),"aria-label":Gd(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Yh("input",{value:t.replace,placeholder:Gd(e,"Replace"),"aria-label":Gd(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Yh("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Yh("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Yh("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit}),this.dom=Yh("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,i("next",(()=>Bd(e)),[Gd(e,"next")]),i("prev",(()=>Fd(e)),[Gd(e,"previous")]),i("select",(()=>Id(e)),[Gd(e,"all")]),Yh("label",null,[this.caseField,Gd(e,"match case")]),Yh("label",null,[this.reField,Gd(e,"regexp")]),Yh("label",null,[this.wordField,Gd(e,"by word")]),...e.state.readOnly?[]:[Yh("br"),this.replaceField,i("replace",(()=>jd(e)),[Gd(e,"replace")]),i("replaceAll",(()=>Md(e)),[Gd(e,"replace all")])],Yh("button",{name:"close",onclick:()=>zd(e),"aria-label":Gd(e,"close"),type:"button"},["×"])])}commit(){let e=new yd({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Ed.of(e)}))}keydown(e){var t,i;i=e,po(co((t=this.view).state),i,t,"search-panel")?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Fd:Bd)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),jd(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(Ed)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(wd).top}}function Gd(e,t){return e.state.phrase(t)}const Yd=/[\s\.,:;?!]/;function Hd(e,{from:t,to:i}){let n=e.state.doc.lineAt(t),s=e.state.doc.lineAt(i).to,o=Math.max(n.from,t-30),a=Math.min(s,i+30),r=e.state.sliceDoc(o,a);if(o!=n.from)for(let e=0;e<30;e++)if(!Yd.test(r[e+1])&&Yd.test(r[e])){r=r.slice(e);break}if(a!=s)for(let e=r.length-1;e>r.length-30;e--)if(!Yd.test(r[e-1])&&Yd.test(r[e])){r=r.slice(0,e);break}return Js.announce.of(`${e.state.phrase("current match")}. ${r} ${e.state.phrase("on line")} ${n.number}.`)}const Kd=Js.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Jd=[Ad,K.low(Ld),Kd];class eu{constructor(e,t,i,n){this.state=e,this.pos=t,this.explicit=i,this.view=n,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=il(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),n=t.text.slice(i-t.from,this.pos-t.from),s=n.search(ou(e,!1));return s<0?null:{from:i+s,to:this.pos,text:n.slice(s)}}get aborted(){return null==this.abortListeners}addEventListener(e,t,i){"abort"==e&&this.abortListeners&&(this.abortListeners.push(t),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function tu(e){let t=Object.keys(e).join(""),i=/\w/.test(t);return i&&(t=t.replace(/\w/g,"")),`[${i?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function iu(e){let t=e.map((e=>"string"==typeof e?{label:e}:e)),[i,n]=t.every((e=>/^\w+$/.test(e.label)))?[/\w*$/,/\w+$/]:function(e){let t=Object.create(null),i=Object.create(null);for(let{label:n}of e){t[n[0]]=!0;for(let e=1;e<n.length;e++)i[n[e]]=!0}let n=tu(t)+tu(i)+"*$";return[new RegExp("^"+n),new RegExp(n)]}(t);return e=>{let s=e.matchBefore(n);return s||e.explicit?{from:s?s.from:e.pos,options:t,validFor:i}:null}}class nu{constructor(e,t,i,n){this.completion=e,this.source=t,this.match=i,this.score=n}}function su(e){return e.selection.main.from}function ou(e,t){var i;let{source:n}=e,s=t&&"^"!=n[0],o="$"!=n[n.length-1];return s||o?new RegExp(`${s?"^":""}(?:${n})${o?"$":""}`,null!==(i=e.flags)&&void 0!==i?i:e.ignoreCase?"i":""):e}const au=ue.define(),ru=new WeakMap;function lu(e){if(!Array.isArray(e))return e;let t=ru.get(e);return t||ru.set(e,t=iu(e)),t}const cu=me.define(),hu=me.define();class du{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=_(e,t),n=E(i);this.chars.push(i);let s=e.slice(t,t+n),o=s.toUpperCase();this.folded.push(_(o==s?s.toLowerCase():o,0)),t+=n}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(0==this.pattern.length)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:n,precise:s,byWord:o}=this;if(1==t.length){let n=_(e,0),s=E(n),o=s==e.length?0:-100;if(n==t[0]);else{if(n!=i[0])return null;o+=-200}return this.ret(o,[0,s])}let a=e.indexOf(this.pattern);if(0==a)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let r=t.length,l=0;if(a<0){for(let s=0,o=Math.min(e.length,200);s<o&&l<r;){let o=_(e,s);o!=t[l]&&o!=i[l]||(n[l++]=s),s+=E(o)}if(l<r)return null}let c=0,h=0,d=!1,u=0,p=-1,f=-1,m=/[a-z]/.test(e),g=!0;for(let n=0,l=Math.min(e.length,200),b=0;n<l&&h<r;){let l=_(e,n);a<0&&(c<r&&l==t[c]&&(s[c++]=n),u<r&&(l==t[u]||l==i[u]?(0==u&&(p=n),f=n+1,u++):u=0));let v,w=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(v=k(l))!=v.toLowerCase()?1:v!=v.toUpperCase()?2:0;(!n||1==w&&m||0==b&&0!=w)&&(t[h]==l||i[h]==l&&(d=!0)?o[h++]=n:o.length&&(g=!1)),b=w,n+=E(l)}return h==r&&0==o[0]&&g?this.result((d?-200:0)-100,o,e):u==r&&0==p?this.ret(-200-e.length+(f==e.length?0:-100),[0,f]):a>-1?this.ret(-700-e.length,[a,a+this.pattern.length]):u==r?this.ret(-900-e.length,[p,f]):h==r?this.result((d?-200:0)-100-700+(g?0:-1100),o,e):2==t.length?null:this.result((n[0]?-700:0)-200-1100,n,e)}result(e,t,i){let n=[],s=0;for(let e of t){let t=e+(this.astral?E(_(i,e)):1);s&&n[s-1]==e?n[s-1]=t:(n[s++]=e,n[s++]=t)}return this.ret(e-i.length,n)}}class uu{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),i=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return null==i?null:(this.matched=[0,t.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const pu=N.define({combine:e=>ke(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:mu,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>fu(e(i),t(i)),optionClass:(e,t)=>i=>fu(e(i),t(i)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})});function fu(e,t){return e?t?e+" "+t:e:t}function mu(e,t,i,n,s,o){let a,r,l=e.textDirection==bi.RTL,c=l,h=!1,d="top",u=t.left-s.left,p=s.right-t.right,f=n.right-n.left,m=n.bottom-n.top;if(c&&u<Math.min(f,p)?c=!1:!c&&p<Math.min(f,u)&&(c=!0),f<=(c?u:p))a=Math.max(s.top,Math.min(i.top,s.bottom-m))-t.top,r=Math.min(400,c?u:p);else{h=!0,r=Math.min(400,(l?t.right:s.right-t.left)-30);let e=s.bottom-t.bottom;e>=m||e>t.top?a=i.bottom-t.top:(d="bottom",a=t.bottom-i.top)}return{style:`${d}: ${a/((t.bottom-t.top)/o.offsetHeight)}px; max-width: ${r/((t.right-t.left)/o.offsetWidth)}px`,class:"cm-completionInfo-"+(h?l?"left-narrow":"right-narrow":c?"left":"right")}}function gu(e,t,i){if(e<=i)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let e=Math.floor(t/i);return{from:e*i,to:(e+1)*i}}let n=Math.floor((e-t)/i);return{from:e-(n+1)*i,to:e-n*i}}class bu{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:e=>this.placeInfo(e),key:this},this.space=null,this.currentClass="";let n=e.state.field(t),{options:s,selected:o}=n.open,a=e.state.facet(pu);this.optionContent=function(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map((e=>"cm-completionIcon-"+e))),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,i,n){let s=document.createElement("span");s.className="cm-completionLabel";let o=e.displayLabel||e.label,a=0;for(let e=0;e<n.length;){let t=n[e++],i=n[e++];t>a&&s.appendChild(document.createTextNode(o.slice(a,t)));let r=s.appendChild(document.createElement("span"));r.appendChild(document.createTextNode(o.slice(t,i))),r.className="cm-completionMatchedText",a=i}return a<o.length&&s.appendChild(document.createTextNode(o.slice(a))),s},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort(((e,t)=>e.position-t.position)).map((e=>e.render))}(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=gu(s.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",(i=>{let{options:n}=e.state.field(t).open;for(let t,s=i.target;s&&s!=this.dom;s=s.parentNode)if("LI"==s.nodeName&&(t=/-(\d+)$/.exec(s.id))&&+t[1]<n.length)return this.applyCompletion(e,n[+t[1]]),void i.preventDefault()})),this.dom.addEventListener("focusout",(t=>{let i=e.state.field(this.stateField,!1);i&&i.tooltip&&e.state.facet(pu).closeOnBlur&&t.relatedTarget!=e.contentDOM&&e.dispatch({effects:hu.of(null)})})),this.showOptions(s,n.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)}))}update(e){var t;let i=e.state.field(this.stateField),n=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=n){let{options:s,selected:o,disabled:a}=i.open;n.open&&n.open.options==s||(this.range=gu(s.length,o,e.state.facet(pu).maxRenderedOptions),this.showOptions(s,i.id)),this.updateSel(),a!=(null===(t=n.open)||void 0===t?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(let e of t.split(" "))e&&this.dom.classList.add(e);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=gu(t.options.length,t.selected,this.view.state.facet(pu).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:n}=i;if(!n)return;let s="string"==typeof n?document.createTextNode(n):n(i);if(!s)return;"then"in s?s.then((t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t,i)})).catch((e=>Hi(this.view.state,e,"completion info"))):this.addInfoPane(s,i)}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",null!=e.nodeType)i.appendChild(e),this.infoDestroy=null;else{let{dom:t,destroy:n}=e;i.appendChild(t),this.infoDestroy=n||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)"LI"==i.nodeName&&i.id?n==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected"):n--;return t&&function(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect(),s=i.height/e.offsetHeight;n.top<i.top?e.scrollTop-=(i.top-n.top)/s:n.bottom>i.bottom&&(e.scrollTop+=(n.bottom-i.bottom)/s)}(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),s=this.space;if(!s){let e=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:e.clientWidth,bottom:e.clientHeight}}return n.top>Math.min(s.bottom,t.bottom)-10||n.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(pu).positionInfo(this.view,t,n,i,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions")),n.addEventListener("mousedown",(e=>{e.target==n&&e.preventDefault()}));let s=null;for(let o=i.from;o<i.to;o++){let{completion:a,match:r}=e[o],{section:l}=a;if(l){let e="string"==typeof l?l:l.name;e!=s&&(o>i.from||0==i.from)&&(s=e,"string"!=typeof l&&l.header?n.appendChild(l.header(l)):n.appendChild(document.createElement("completion-section")).textContent=e)}const c=n.appendChild(document.createElement("li"));c.id=t+"-"+o,c.setAttribute("role","option");let h=this.optionClass(a);h&&(c.className=h);for(let e of this.optionContent){let t=e(a,this.view.state,this.view,r);t&&c.appendChild(t)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function vu(e,t){return i=>new bu(i,e,t)}function wu(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}class yu{constructor(e,t,i,n,s,o){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=n,this.selected=s,this.disabled=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new yu(this.options,Cu(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,n,s,o){if(n&&!o&&e.some((e=>e.isPending)))return n.setDisabled();let a=function(e,t){let i=[],n=null,s=e=>{i.push(e);let{section:t}=e.completion;if(t){n||(n=[]);let e="string"==typeof t?t:t.name;n.some((t=>t.name==e))||n.push("string"==typeof t?{name:e}:t)}},o=t.facet(pu);for(let n of e)if(n.hasResult()){let e=n.result.getMatch;if(!1===n.result.filter)for(let t of n.result.options)s(new nu(t,n.source,e?e(t):[],1e9-i.length));else{let i,a=t.sliceDoc(n.from,n.to),r=o.filterStrict?new uu(a):new du(a);for(let t of n.result.options)if(i=r.match(t.label)){let o=t.displayLabel?e?e(t,i.matched):[]:i.matched;s(new nu(t,n.source,o,i.score+(t.boost||0)))}}}if(n){let e=Object.create(null),t=0,s=(e,t)=>{var i,n;return(null!==(i=e.rank)&&void 0!==i?i:1e9)-(null!==(n=t.rank)&&void 0!==n?n:1e9)||(e.name<t.name?-1:1)};for(let i of n.sort(s))t-=1e5,e[i.name]=t;for(let t of i){let{section:i}=t.completion;i&&(t.score+=e["string"==typeof i?i:i.name])}}let a=[],r=null,l=o.compareCompletions;for(let e of i.sort(((e,t)=>t.score-e.score||l(e.completion,t.completion)))){let t=e.completion;!r||r.label!=t.label||r.detail!=t.detail||null!=r.type&&null!=t.type&&r.type!=t.type||r.apply!=t.apply||r.boost!=t.boost?a.push(e):wu(e.completion)>wu(r)&&(a[a.length-1]=e),r=e.completion}return a}(e,t);if(!a.length)return n&&e.some((e=>e.isPending))?n.setDisabled():null;let r=t.facet(pu).selectOnOpen?0:-1;if(n&&n.selected!=r&&-1!=n.selected){let e=n.options[n.selected].completion;for(let t=0;t<a.length;t++)if(a[t].completion==e){r=t;break}}return new yu(a,Cu(i,r),{pos:e.reduce(((e,t)=>t.hasResult()?Math.min(e,t.from):e),1e8),create:Vu,above:s.aboveCursor},n?n.timestamp:Date.now(),r,!1)}map(e){return new yu(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new yu(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class Ou{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new Ou(Su,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,i=t.facet(pu),n=(i.override||t.languageDataAt("autocomplete",su(t)).map(lu)).map((t=>(this.active.find((e=>e.source==t))||new ku(t,this.active.some((e=>0!=e.state))?1:0)).update(e,i)));n.length==this.active.length&&n.every(((e,t)=>e==this.active[t]))&&(n=this.active);let s=this.open,o=e.effects.some((e=>e.is(Pu)));s&&e.docChanged&&(s=s.map(e.changes)),e.selection||n.some((t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to)))||!function(e,t){if(e==t)return!0;for(let i=0,n=0;;){for(;i<e.length&&!e[i].hasResult();)i++;for(;n<t.length&&!t[n].hasResult();)n++;let s=i==e.length,o=n==t.length;if(s||o)return s==o;if(e[i++].result!=t[n++].result)return!1}}(n,this.active)||o?s=yu.build(n,t,this.id,s,i,o):s&&s.disabled&&!n.some((e=>e.isPending))&&(s=null),!s&&n.every((e=>!e.isPending))&&n.some((e=>e.hasResult()))&&(n=n.map((e=>e.hasResult()?new ku(e.source,0):e)));for(let t of e.effects)t.is(Au)&&(s=s&&s.setSelected(t.value,this.id));return n==this.active&&s==this.open?this:new Ou(n,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?xu:$u}}const xu={"aria-autocomplete":"list"},$u={};function Cu(e,t){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(i["aria-activedescendant"]=e+"-"+t),i}const Su=[];function _u(e,t){if(e.isUserEvent("input.complete")){let i=e.annotation(au);if(i&&t.activateOnCompletion(i))return 12}let i=e.isUserEvent("input.type");return i&&t.activateOnTyping?5:i?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class ku{constructor(e,t,i=!1){this.source=e,this.state=t,this.explicit=i}hasResult(){return!1}get isPending(){return 1==this.state}update(e,t){let i=_u(e,t),n=this;(8&i||16&i&&this.touches(e))&&(n=new ku(n.source,0)),4&i&&0==n.state&&(n=new ku(this.source,1)),n=n.updateFor(e,i);for(let t of e.effects)if(t.is(cu))n=new ku(n.source,1,t.value);else if(t.is(hu))n=new ku(n.source,0);else if(t.is(Pu))for(let e of t.value)e.source==n.source&&(n=e);return n}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(su(e.state))}}class Eu extends ku{constructor(e,t,i,n,s,o){super(e,3,t),this.limit=i,this.result=n,this.from=s,this.to=o}hasResult(){return!0}updateFor(e,t){var i;if(!(3&t))return this.map(e.changes);let n=this.result;n.map&&!e.changes.empty&&(n=n.map(n,e.changes));let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),a=su(e.state);if(a>o||!n||2&t&&(su(e.startState)==this.from||a<this.limit))return new ku(this.source,4&t?1:0);let r=e.changes.mapPos(this.limit);return function(e,t,i,n){if(!e)return!1;let s=t.sliceDoc(i,n);return"function"==typeof e?e(s,i,n,t):ou(e,!0).test(s)}(n.validFor,e.state,s,o)?new Eu(this.source,this.explicit,r,n,s,o):n.update&&(n=n.update(n,s,o,new eu(e.state,a,!1)))?new Eu(this.source,this.explicit,r,n,n.from,null!==(i=n.to)&&void 0!==i?i:su(e.state)):new ku(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new Eu(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new ku(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}const Pu=me.define({map:(e,t)=>e.map((e=>e.map(t)))}),Au=me.define(),Ru=Y.define({create:()=>Ou.start(),update:(e,t)=>e.update(t),provide:e=>[aa.from(e,(e=>e.tooltip)),Js.contentAttributes.from(e,(e=>e.attrs))]});function Du(e,t){const i=t.completion.apply||t.completion.label;let n=e.state.field(Ru).active.find((e=>e.source==t.source));return n instanceof Eu&&("string"==typeof i?e.dispatch(Object.assign(Object.assign({},function(e,t,i,n){let{main:s}=e.selection,o=i-s.from,a=n-s.from;return Object.assign(Object.assign({},e.changeByRange((r=>{if(r!=s&&i!=n&&e.sliceDoc(r.from+o,r.from+a)!=e.sliceDoc(i,n))return{range:r};let l=e.toText(t);return{changes:{from:r.from+o,to:n==s.from?r.to:r.from+a,insert:l},range:M.cursor(r.from+o+l.length)}}))),{scrollIntoView:!0,userEvent:"input.complete"})}(e.state,i,n.from,n.to)),{annotations:au.of(t.completion)})):i(e,t.completion,n.from,n.to),!0)}const Vu=vu(Ru,Du);function Lu(e,t="option"){return i=>{let n=i.state.field(Ru,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<i.state.facet(pu).interactionDelay)return!1;let s,o=1;"page"==t&&(s=ua(i,n.open.tooltip))&&(o=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:a}=n.open.options,r=n.open.selected>-1?n.open.selected+o*(e?1:-1):e?0:a-1;return r<0?r="page"==t?0:a-1:r>=a&&(r="page"==t?a-1:0),i.dispatch({effects:Au.of(r)}),!0}}const Tu=e=>!!e.state.field(Ru,!1)&&(e.dispatch({effects:cu.of(!0)}),!0);class Bu{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Fu=tn.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(Ru).active)t.isPending&&this.startQuery(t)}update(e){let t=e.state.field(Ru),i=e.state.facet(pu);if(!e.selectionSet&&!e.docChanged&&e.startState.field(Ru)==t)return;let n=e.transactions.some((e=>{let t=_u(e,i);return 8&t||(e.selection||e.docChanged)&&!(3&t)}));for(let t=0;t<this.running.length;t++){let i=this.running[t];if(n||i.context.abortOnDocChange&&e.docChanged||i.updates.length+e.transactions.length>50&&Date.now()-i.time>1e3){for(let e of i.context.abortListeners)try{e()}catch(e){Hi(this.view.state,e)}i.context.abortListeners=null,this.running.splice(t--,1)}else i.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some((e=>e.effects.some((e=>e.is(cu)))))&&(this.pendingStart=!0);let s=this.pendingStart?50:i.activateOnTypingDelay;if(this.debounceUpdate=t.active.some((e=>e.isPending&&!this.running.some((t=>t.active.source==e.source))))?setTimeout((()=>this.startUpdate()),s):-1,0!=this.composing)for(let t of e.transactions)t.isUserEvent("input.type")?this.composing=2:2==this.composing&&t.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(Ru);for(let e of t.active)e.isPending&&!this.running.some((t=>t.active.source==e.source))&&this.startQuery(e);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(pu).updateSyncTime))}startQuery(e){let{state:t}=this.view,i=su(t),n=new eu(t,i,e.explicit,this.view),s=new Bu(e,n);this.running.push(s),Promise.resolve(e.source(n)).then((e=>{s.context.aborted||(s.done=e||null,this.scheduleAccept())}),(e=>{this.view.dispatch({effects:hu.of(null)}),Hi(this.view.state,e)}))}scheduleAccept(){this.running.every((e=>void 0!==e.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(pu).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],i=this.view.state.facet(pu),n=this.view.state.field(Ru);for(let s=0;s<this.running.length;s++){let o=this.running[s];if(void 0===o.done)continue;if(this.running.splice(s--,1),o.done){let n=su(o.updates.length?o.updates[0].startState:this.view.state),s=Math.min(n,o.done.from+(o.active.explicit?0:1)),a=new Eu(o.active.source,o.active.explicit,s,o.done,o.done.from,null!==(e=o.done.to)&&void 0!==e?e:n);for(let e of o.updates)a=a.update(e,i);if(a.hasResult()){t.push(a);continue}}let a=n.active.find((e=>e.source==o.active.source));if(a&&a.isPending)if(null==o.done){let e=new ku(o.active.source,0);for(let t of o.updates)e=e.update(t,i);e.isPending||t.push(e)}else this.startQuery(a)}(t.length||n.open&&n.open.disabled)&&this.view.dispatch({effects:Pu.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(Ru,!1);if(t&&t.tooltip&&this.view.state.facet(pu).closeOnBlur){let i=t.open&&ua(this.view,t.open.tooltip);i&&i.dom.contains(e.relatedTarget)||setTimeout((()=>this.view.dispatch({effects:hu.of(null)})),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:cu.of(!1)})),20),this.composing=0}}}),Iu="object"==typeof navigator&&/Win/.test(navigator.platform),ju=K.highest(Js.domEventHandlers({keydown(e,t){let i=t.state.field(Ru,!1);if(!i||!i.open||i.open.disabled||i.open.selected<0||e.key.length>1||e.ctrlKey&&(!Iu||!e.altKey)||e.metaKey)return!1;let n=i.open.options[i.open.selected],s=i.active.find((e=>e.source==n.source)),o=n.completion.commitCharacters||s.result.commitCharacters;return o&&o.indexOf(e.key)>-1&&Du(t,n),!1}})),Mu=Js.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Qu{constructor(e,t,i,n){this.field=e,this.line=t,this.from=i,this.to=n}}class Wu{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,A.TrackDel),i=e.mapPos(this.to,1,A.TrackDel);return null==t||null==i?null:new Wu(this.field,t,i)}}class Nu{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],n=[t],s=e.doc.lineAt(t),o=/^\s*/.exec(s.text)[0];for(let s of this.lines){if(i.length){let i=o,a=/^\t*/.exec(s)[0].length;for(let t=0;t<a;t++)i+=e.facet(fl);n.push(t+i.length-a),s=i+s.slice(a)}i.push(s),t+=s.length+1}let a=this.fieldPositions.map((e=>new Wu(e.field,n[e.line]+e.from,n[e.line]+e.to)));return{text:i,ranges:a}}static parse(e){let t,i=[],n=[],s=[];for(let o of e.split(/\r\n?|\n/)){for(;t=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(o);){let e=t[1]?+t[1]:null,a=t[2]||t[3]||"",r=-1,l=a.replace(/\\[{}]/g,(e=>e[1]));for(let t=0;t<i.length;t++)(null!=e?i[t].seq==e:l&&i[t].name==l)&&(r=t);if(r<0){let t=0;for(;t<i.length&&(null==e||null!=i[t].seq&&i[t].seq<e);)t++;i.splice(t,0,{seq:e,name:l}),r=t;for(let e of s)e.field>=r&&e.field++}s.push(new Qu(r,n.length,t.index,t.index+l.length)),o=o.slice(0,t.index)+a+o.slice(t.index+t[0].length)}o=o.replace(/\\([{}])/g,((e,t,i)=>{for(let e of s)e.line==n.length&&e.from>i&&(e.from--,e.to--);return t})),n.push(o)}return new Nu(n,s)}}let Zu=oi.widget({widget:new class extends ni{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),qu=oi.mark({class:"cm-snippetField"});class zu{constructor(e,t){this.ranges=e,this.active=t,this.deco=oi.set(e.map((e=>(e.from==e.to?Zu:qu).range(e.from,e.to))))}map(e){let t=[];for(let i of this.ranges){let n=i.map(e);if(!n)return null;t.push(n)}return new zu(t,this.active)}selectionInsideField(e){return e.ranges.every((e=>this.ranges.some((t=>t.field==this.active&&t.from<=e.from&&t.to>=e.to))))}}const Uu=me.define({map:(e,t)=>e&&e.map(t)}),Xu=me.define(),Gu=Y.define({create:()=>null,update(e,t){for(let i of t.effects){if(i.is(Uu))return i.value;if(i.is(Xu)&&e)return new zu(e.ranges,i.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>Js.decorations.from(e,(e=>e?e.deco:oi.none))});function Yu(e,t){return M.create(e.filter((e=>e.field==t)).map((e=>M.range(e.from,e.to))))}function Hu(e){let t=Nu.parse(e);return(e,i,n,s)=>{let{text:o,ranges:a}=t.instantiate(e.state,n),{main:r}=e.state.selection,l={changes:{from:n,to:s==r.from?r.to:s,insert:m.of(o)},scrollIntoView:!0,annotations:i?[au.of(i),ge.userEvent.of("input.complete")]:void 0};if(a.length&&(l.selection=Yu(a,0)),a.some((e=>e.field>0))){let t=new zu(a,0),i=l.effects=[Uu.of(t)];void 0===e.state.field(Gu,!1)&&i.push(me.appendConfig.of([Gu,tp,np,Mu]))}e.dispatch(e.state.update(l))}}function Ku(e){return({state:t,dispatch:i})=>{let n=t.field(Gu,!1);if(!n||e<0&&0==n.active)return!1;let s=n.active+e,o=e>0&&!n.ranges.some((t=>t.field==s+e));return i(t.update({selection:Yu(n.ranges,s),effects:Uu.of(o?null:new zu(n.ranges,s)),scrollIntoView:!0})),!0}}const Ju=[{key:"Tab",run:Ku(1),shift:Ku(-1)},{key:"Escape",run:({state:e,dispatch:t})=>!!e.field(Gu,!1)&&(t(e.update({effects:Uu.of(null)})),!0)}],ep=N.define({combine:e=>e.length?e[0]:Ju}),tp=K.highest(ro.compute([ep],(e=>e.facet(ep))));function ip(e,t){return Object.assign(Object.assign({},t),{apply:Hu(e)})}const np=Js.domEventHandlers({mousedown(e,t){let i,n=t.state.field(Gu,!1);if(!n||null==(i=t.posAtCoords({x:e.clientX,y:e.clientY})))return!1;let s=n.ranges.find((e=>e.from<=i&&e.to>=i));return!(!s||s.field==n.active||(t.dispatch({selection:Yu(n.ranges,s.field),effects:Uu.of(n.ranges.some((e=>e.field>s.field))?new zu(n.ranges,s.field):null),scrollIntoView:!0}),0))}}),sp={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},op=me.define({map(e,t){let i=t.mapPos(e,-1,A.TrackAfter);return null==i?void 0:i}}),ap=new class extends Ee{};ap.startSide=1,ap.endSide=-1;const rp=Y.define({create:()=>De.empty,update(e,t){if(e=e.map(t.changes),t.selection){let i=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:e=>e>=i.from&&e<=i.to})}for(let i of t.effects)i.is(op)&&(e=e.update({add:[ap.range(i.value,i.value+1)]}));return e}}),lp="()[]{}<>«»»«［］｛｝";function cp(e){for(let t=0;t<lp.length;t+=2)if(lp.charCodeAt(t)==e)return lp.charAt(t+1);return k(e<128?e:e+1)}function hp(e,t){return e.languageDataAt("closeBrackets",t)[0]||sp}const dp="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),up=Js.inputHandler.of(((e,t,i,n)=>{if((dp?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let s=e.state.selection.main;if(n.length>2||2==n.length&&1==E(_(n,0))||t!=s.from||i!=s.to)return!1;let o=function(e,t){let i=hp(e,e.selection.main.head),n=i.brackets||sp.brackets;for(let s of n){let o=cp(_(s,0));if(t==s)return o==s?vp(e,s,n.indexOf(s+s+s)>-1,i):gp(e,s,o,i.before||sp.before);if(t==o&&fp(e,e.selection.main.from))return bp(e,0,o)}return null}(e.state,n);return!!o&&(e.dispatch(o),!0)})),pp=[{key:"Backspace",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=hp(e,e.selection.main.head).brackets||sp.brackets,n=null,s=e.changeByRange((t=>{if(t.empty){let n=function(e,t){let i=e.sliceString(t-2,t);return E(_(i,0))==i.length?i:i.slice(1)}(e.doc,t.head);for(let s of i)if(s==n&&mp(e.doc,t.head)==cp(_(s,0)))return{changes:{from:t.head-s.length,to:t.head+s.length},range:M.cursor(t.head-s.length)}}return{range:n=t}}));return n||t(e.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!n}}];function fp(e,t){let i=!1;return e.field(rp).between(0,e.doc.length,(e=>{e==t&&(i=!0)})),i}function mp(e,t){let i=e.sliceString(t,t+2);return i.slice(0,E(_(i,0)))}function gp(e,t,i,n){let s=null,o=e.changeByRange((o=>{if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:i,from:o.to}],effects:op.of(o.to+t.length),range:M.range(o.anchor+t.length,o.head+t.length)};let a=mp(e.doc,o.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:t+i,from:o.head},effects:op.of(o.head+t.length),range:M.cursor(o.head+t.length)}:{range:s=o}}));return s?null:e.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function bp(e,t,i){let n=null,s=e.changeByRange((t=>t.empty&&mp(e.doc,t.head)==i?{changes:{from:t.head,to:t.head+i.length,insert:i},range:M.cursor(t.head+i.length)}:n={range:t}));return n?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function vp(e,t,i,n){let s=n.stringPrefixes||sp.stringPrefixes,o=null,a=e.changeByRange((n=>{if(!n.empty)return{changes:[{insert:t,from:n.from},{insert:t,from:n.to}],effects:op.of(n.to+t.length),range:M.range(n.anchor+t.length,n.head+t.length)};let a,r=n.head,l=mp(e.doc,r);if(l==t){if(wp(e,r))return{changes:{insert:t+t,from:r},effects:op.of(r+t.length),range:M.cursor(r+t.length)};if(fp(e,r)){let n=i&&e.sliceDoc(r,r+3*t.length)==t+t+t?t+t+t:t;return{changes:{from:r,to:r+n.length,insert:n},range:M.cursor(r+n.length)}}}else{if(i&&e.sliceDoc(r-2*t.length,r)==t+t&&(a=yp(e,r-2*t.length,s))>-1&&wp(e,a))return{changes:{insert:t+t+t+t,from:r},effects:op.of(r+t.length),range:M.cursor(r+t.length)};if(e.charCategorizer(r)(l)!=$e.Word&&yp(e,r,s)>-1&&!function(e,t,i,n){let s=il(e).resolveInner(t,-1),o=n.reduce(((e,t)=>Math.max(e,t.length)),0);for(let a=0;a<5;a++){let a=e.sliceDoc(s.from,Math.min(s.to,s.from+i.length+o)),r=a.indexOf(i);if(!r||r>-1&&n.indexOf(a.slice(0,r))>-1){let t=s.firstChild;for(;t&&t.from==s.from&&t.to-t.from>i.length+r;){if(e.sliceDoc(t.to-i.length,t.to)==i)return!1;t=t.firstChild}return!0}let l=s.to==t&&s.parent;if(!l)break;s=l}return!1}(e,r,t,s))return{changes:{insert:t+t,from:r},effects:op.of(r+t.length),range:M.cursor(r+t.length)}}return{range:o=n}}));return o?null:e.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function wp(e,t){let i=il(e).resolveInner(t+1);return i.parent&&i.from==t}function yp(e,t,i){let n=e.charCategorizer(t);if(n(e.sliceDoc(t-1,t))!=$e.Word)return t;for(let s of i){let i=t-s.length;if(e.sliceDoc(i,t)==s&&n(e.sliceDoc(i-1,i))!=$e.Word)return i}return-1}function Op(e={}){return[ju,Ru,pu.of(e),Fu,$p,Mu]}const xp=[{key:"Ctrl-Space",run:Tu},{mac:"Alt-`",run:Tu},{key:"Escape",run:e=>{let t=e.state.field(Ru,!1);return!(!t||!t.active.some((e=>0!=e.state))||(e.dispatch({effects:hu.of(null)}),0))}},{key:"ArrowDown",run:Lu(!0)},{key:"ArrowUp",run:Lu(!1)},{key:"PageDown",run:Lu(!0,"page")},{key:"PageUp",run:Lu(!1,"page")},{key:"Enter",run:e=>{let t=e.state.field(Ru,!1);return!(e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(pu).interactionDelay)&&Du(e,t.open.options[t.open.selected])}}],$p=K.highest(ro.computeN([pu],(e=>e.facet(pu).defaultKeymap?[xp]:[])));class Cp{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class Sp{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let n=e,s=i.facet(Bp).markerFilter;s&&(n=s(n,i));let o=e.slice().sort(((e,t)=>e.from-t.from||e.to-t.to)),a=new Ve,r=[],l=0;for(let e=0;;){let t,n,s=e==o.length?null:o[e];if(!s&&!r.length)break;for(r.length?(t=l,n=r.reduce(((e,t)=>Math.min(e,t.to)),s&&s.from>t?s.from:1e8)):(t=s.from,n=s.to,r.push(s),e++);e<o.length;){let i=o[e];if(i.from!=t||!(i.to>i.from||i.to==t)){n=Math.min(i.from,n);break}r.push(i),e++,n=Math.min(i.to,n)}let c=qp(r);if(r.some((e=>e.from==e.to||e.from==e.to-1&&i.doc.lineAt(e.from).to==e.from)))a.add(t,t,oi.widget({widget:new jp(c),diagnostics:r.slice()}));else{let e=r.reduce(((e,t)=>t.markClass?e+" "+t.markClass:e),"");a.add(t,n,oi.mark({class:"cm-lintRange cm-lintRange-"+c+e,diagnostics:r.slice(),inclusiveEnd:r.some((e=>e.to>n))}))}l=n;for(let e=0;e<r.length;e++)r[e].to<=l&&r.splice(e--,1)}let c=a.finish();return new Sp(c,t,_p(c))}}function _p(e,t=null,i=0){let n=null;return e.between(i,1e9,((e,i,{spec:s})=>{if(!(t&&s.diagnostics.indexOf(t)<0))if(n){if(s.diagnostics.indexOf(n.diagnostic)<0)return!1;n=new Cp(n.from,i,n.diagnostic)}else n=new Cp(e,i,t||s.diagnostics[0])})),n}const kp=me.define(),Ep=me.define(),Pp=me.define(),Ap=Y.define({create:()=>new Sp(oi.none,null,null),update(e,t){if(t.docChanged&&e.diagnostics.size){let i=e.diagnostics.map(t.changes),n=null,s=e.panel;if(e.selected){let s=t.changes.mapPos(e.selected.from,1);n=_p(i,e.selected.diagnostic,s)||_p(i,null,s)}!i.size&&s&&t.state.facet(Bp).autoPanel&&(s=null),e=new Sp(i,s,n)}for(let i of t.effects)if(i.is(kp)){let n=t.state.facet(Bp).autoPanel?i.value.length?Qp.open:null:e.panel;e=Sp.init(i.value,n,t.state)}else i.is(Ep)?e=new Sp(e.diagnostics,i.value?Qp.open:null,e.selected):i.is(Pp)&&(e=new Sp(e.diagnostics,e.panel,i.value));return e},provide:e=>[wa.from(e,(e=>e.panel)),Js.decorations.from(e,(e=>e.diagnostics))]}),Rp=oi.mark({class:"cm-lintRange cm-lintRange-active"});function Dp(e,t,i){let n,{diagnostics:s}=e.state.field(Ap),o=-1,a=-1;s.between(t-(i<0?1:0),t+(i>0?1:0),((e,s,{spec:r})=>{if(t>=e&&t<=s&&(e==s||(t>e||i>0)&&(t<s||i<0)))return n=r.diagnostics,o=e,a=s,!1}));let r=e.state.facet(Bp).tooltipFilter;return n&&r&&(n=r(n,e.state)),n?{pos:o,end:a,above:e.state.doc.lineAt(o).to<a,create:()=>({dom:Vp(e,n)})}:null}function Vp(e,t){return Yh("ul",{class:"cm-tooltip-lint"},t.map((t=>Ip(e,t,!1))))}const Lp=e=>{let t=e.state.field(Ap,!1);return!(!t||!t.panel||(e.dispatch({effects:Ep.of(!1)}),0))},Tp=[{key:"Mod-Shift-m",run:e=>{let t=e.state.field(Ap,!1);var i,n;t&&t.panel||e.dispatch({effects:(i=e.state,n=[Ep.of(!0)],i.field(Ap,!1)?n:n.concat(me.appendConfig.of(zp)))});let s=ma(e,Qp.open);return s&&s.dom.querySelector(".cm-panel-lint ul").focus(),!0},preventDefault:!0},{key:"F8",run:e=>{let t=e.state.field(Ap,!1);if(!t)return!1;let i=e.state.selection.main,n=t.diagnostics.iter(i.to+1);return!(!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to)||(e.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),0))}}],Bp=N.define({combine:e=>Object.assign({sources:e.map((e=>e.source)).filter((e=>null!=e))},ke(e.map((e=>e.config)),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t}))});function Fp(e){let t=[];if(e)e:for(let{name:i}of e){for(let e=0;e<i.length;e++){let n=i[e];if(/[a-zA-Z]/.test(n)&&!t.some((e=>e.toLowerCase()==n.toLowerCase()))){t.push(n);continue e}}t.push("")}return t}function Ip(e,t,i){var n;let s=i?Fp(t.actions):[];return Yh("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},Yh("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(e):t.message),null===(n=t.actions)||void 0===n?void 0:n.map(((i,n)=>{let o=!1,a=n=>{if(n.preventDefault(),o)return;o=!0;let s=_p(e.state.field(Ap).diagnostics,t);s&&i.apply(e,s.from,s.to)},{name:r}=i,l=s[n]?r.indexOf(s[n]):-1,c=l<0?r:[r.slice(0,l),Yh("u",r.slice(l,l+1)),r.slice(l+1)];return Yh("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${r}${l<0?"":` (access key "${s[n]})"`}.`},c)})),t.source&&Yh("div",{class:"cm-diagnosticSource"},t.source))}class jp extends ni{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return Yh("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class Mp{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=Ip(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Qp{constructor(e){this.view=e,this.items=[],this.list=Yh("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t=>{if(27==t.keyCode)Lp(this.view),this.view.focus();else if(38==t.keyCode||33==t.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==t.keyCode||34==t.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==t.keyCode)this.moveSelection(0);else if(35==t.keyCode)this.moveSelection(this.items.length-1);else if(13==t.keyCode)this.view.focus();else{if(!(t.keyCode>=65&&t.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],n=Fp(i.actions);for(let s=0;s<n.length;s++)if(n[s].toUpperCase().charCodeAt(0)==t.keyCode){let t=_p(this.view.state.field(Ap).diagnostics,i);t&&i.actions[s].apply(e,t.from,t.to)}}}t.preventDefault()},onclick:e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)}}),this.dom=Yh("div",{class:"cm-panel-lint"},this.list,Yh("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Lp(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(Ap).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Ap),i=0,n=!1,s=null,o=new Set;for(e.between(0,this.view.state.doc.length,((e,a,{spec:r})=>{for(let e of r.diagnostics){if(o.has(e))continue;o.add(e);let a,r=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==e){r=t;break}r<0?(a=new Mp(this.view,e),this.items.splice(i,0,a),n=!0):(a=this.items[r],r>i&&(this.items.splice(i,r-i),n=!0)),t&&a.diagnostic==t.diagnostic?a.dom.hasAttribute("aria-selected")||(a.dom.setAttribute("aria-selected","true"),s=a):a.dom.hasAttribute("aria-selected")&&a.dom.removeAttribute("aria-selected"),i++}}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();0==this.items.length&&(this.items.push(new Mp(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:e,panel:t})=>{let i=t.height/this.list.offsetHeight;e.top<t.top?this.list.scrollTop-=(t.top-e.top)/i:e.bottom>t.bottom&&(this.list.scrollTop+=(e.bottom-t.bottom)/i)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let t=e;e=t.nextSibling,t.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=_p(this.view.state.field(Ap).diagnostics,this.items[e].diagnostic);t&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:Pp.of(t)})}static open(e){return new Qp(e)}}function Wp(e){return function(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Np=Js.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Wp("#d11")},".cm-lintRange-warning":{backgroundImage:Wp("orange")},".cm-lintRange-info":{backgroundImage:Wp("#999")},".cm-lintRange-hint":{backgroundImage:Wp("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function Zp(e){return"error"==e?4:"warning"==e?3:"info"==e?2:1}function qp(e){let t="hint",i=1;for(let n of e){let e=Zp(n.severity);e>i&&(i=e,t=n.severity)}return t}const zp=[Ap,Js.decorations.compute([Ap],(e=>{let{selected:t,panel:i}=e.field(Ap);return t&&i&&t.from!=t.to?oi.set([Rp.range(t.from,t.to)]):oi.none})),da(Dp,{hideOn:function(e,t){let i=t.pos,n=t.end||i,s=e.state.facet(Bp).hideOn(e,i,n);if(null!=s)return s;let o=e.startState.doc.lineAt(t.pos);return!(!e.effects.some((e=>e.is(kp)))&&!e.changes.touchesRange(o.from,Math.max(o.to,n)))}}),Np],Up=(()=>[Ma(),Na,jo(),jc(),Yl(),xo(),[Ao,Ro],_e.allowMultipleSelections.of(!0),_e.transactionFilter.of((e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let i=e.newDoc,{head:n}=e.newSelection.main,s=i.lineAt(n);if(n>s.from+200)return e;let o=i.sliceString(s.from,n);if(!t.some((e=>e.test(o))))return e;let{state:a}=e,r=-1,l=[];for(let{head:e}of a.selection.ranges){let t=a.doc.lineAt(e);if(t.from==r)continue;r=t.from;let i=bl(a,t.from);if(null==i)continue;let n=/^\s*/.exec(t.text)[0],s=gl(a,i);n!=s&&l.push({from:t.from,to:t.from+n.length,insert:s})}return l.length?[e,{changes:l,sequential:!0}]:e})),ic(oc,{fallback:!0}),fc(),[up,rp],Op(),Uo(),Yo(),Zo,pd(),ro.of([...pp,...Gh,...Ud,...th,...Ql,...xp,...Tp])])();class Xp{constructor(e,t,i,n,s,o,a,r,l,c=0,h){this.p=e,this.stack=t,this.state=i,this.reducePos=n,this.pos=s,this.score=o,this.buffer=a,this.bufferBase=r,this.curContext=l,this.lookAhead=c,this.parent=h}toString(){return`[${this.stack.filter(((e,t)=>t%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,i=0){let n=e.parser.context;return new Xp(e,[],t,i,i,0,[],0,n?new Gp(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let i=e>>19,n=65535&e,{parser:s}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let a=s.dynamicPrecedence(n);if(a&&(this.score+=a),0==i)return this.pushState(s.getGoto(this.state,n,!0),this.reducePos),n<s.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,o?8:4,!0),void this.reduceContext(n,this.reducePos);let r=this.stack.length-3*(i-1)-(262144&e?6:0),l=r?this.stack[r-2]:this.p.ranges[0].from,c=this.reducePos-l;c>=2e3&&!(null===(t=this.p.parser.nodeSet.types[n])||void 0===t?void 0:t.isAnonymous)&&(l==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=c):this.p.lastBigReductionSize<c&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=l,this.p.lastBigReductionSize=c));let h=r?this.stack[r-1]:0,d=this.bufferBase+this.buffer.length-h;if(n<s.minRepeatTerm||131072&e){let e=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,l,e,d+4,!0)}if(262144&e)this.state=this.stack[r];else{let e=this.stack[r-3];this.state=s.getGoto(e,n,!0)}for(;this.stack.length>r;)this.stack.pop();this.reduceContext(n,l)}storeNode(e,t,i,n=4,s=!1){if(0==e&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let e=this,n=this.buffer.length;if(0==n&&e.parent&&(n=e.bufferBase-e.parent.bufferBase,e=e.parent),n>0&&0==e.buffer[n-4]&&e.buffer[n-1]>-1){if(t==i)return;if(e.buffer[n-2]>=t)return void(e.buffer[n-2]=i)}}if(s&&this.pos!=i){let s=this.buffer.length;if(s>0&&0!=this.buffer[s-4]){let e=!1;for(let t=s;t>0&&this.buffer[t-2]>i;t-=4)if(this.buffer[t-1]>=0){e=!0;break}if(e)for(;s>0&&this.buffer[s-2]>i;)this.buffer[s]=this.buffer[s-4],this.buffer[s+1]=this.buffer[s-3],this.buffer[s+2]=this.buffer[s-2],this.buffer[s+3]=this.buffer[s-1],s-=4,n>4&&(n-=4)}this.buffer[s]=e,this.buffer[s+1]=t,this.buffer[s+2]=i,this.buffer[s+3]=n}else this.buffer.push(e,t,i,n)}shift(e,t,i,n){if(131072&e)this.pushState(65535&e,this.pos);else if(0==(262144&e)){let s=e,{parser:o}=this.p;(n>this.pos||t<=o.maxNode)&&(this.pos=n,o.stateFlag(s,1)||(this.reducePos=n)),this.pushState(s,i),this.shiftContext(t,i),t<=o.maxNode&&this.buffer.push(t,i,n,4)}else this.pos=n,this.shiftContext(t,i),t<=this.p.parser.maxNode&&this.buffer.push(t,i,n,4)}apply(e,t,i,n){65536&e?this.reduce(e):this.shift(e,t,i,n)}useNode(e,t){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=e)&&(this.p.reused.push(e),i++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(t,n),this.buffer.push(i,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let i=e.buffer.slice(t),n=e.bufferBase+t;for(;e&&n==e.bufferBase;)e=e.parent;return new Xp(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let i=e<=this.p.parser.maxNode;i&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,i?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new Yp(this);;){let i=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==i)return!1;if(0==(65536&i))return!0;t.reduce(i)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let i=[];for(let n,s=0;s<t.length;s+=2)(n=t[s+1])!=this.state&&this.p.parser.hasAction(n,e)&&i.push(t[s],n);if(this.stack.length<120)for(let e=0;i.length<8&&e<t.length;e+=2){let n=t[e+1];i.some(((e,t)=>1&t&&e==n))||i.push(t[e],n)}t=i}let i=[];for(let e=0;e<t.length&&i.length<4;e+=2){let n=t[e+1];if(n==this.state)continue;let s=this.split();s.pushState(n,this.pos),s.storeNode(0,s.pos,s.pos,4,!0),s.shiftContext(t[e],this.pos),s.reducePos=this.pos,s.score-=200,i.push(s)}return i}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(0==(65536&t))return!1;if(!e.validAction(this.state,t)){let i=t>>19,n=65535&t,s=this.stack.length-3*i;if(s<0||e.getGoto(this.stack[s],n,!1)<0){let e=this.findForcedReduction();if(null==e)return!1;t=e}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],i=(n,s)=>{if(!t.includes(n))return t.push(n),e.allActions(n,(t=>{if(393216&t);else if(65536&t){let i=(t>>19)-s;if(i>1){let n=65535&t,s=this.stack.length-3*i;if(s>=0&&e.getGoto(this.stack[s],n,!1)>=0)return i<<19|65536|n}}else{let e=i(t,s+1);if(null!=e)return e}}))};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new Gp(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class Gp{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class Yp{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,i=e>>19;0==i?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(i-1);let n=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=n}}class Hp{constructor(e,t,i){this.stack=e,this.pos=t,this.index=i,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new Hp(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new Hp(this.stack,this.pos,this.index)}}function Kp(e,t=Uint16Array){if("string"!=typeof e)return e;let i=null;for(let n=0,s=0;n<e.length;){let o=0;for(;;){let t=e.charCodeAt(n++),i=!1;if(126==t){o=65535;break}t>=92&&t--,t>=34&&t--;let s=t-32;if(s>=46&&(s-=46,i=!0),o+=s,i)break;o*=46}i?i[s++]=o:i=new t(o)}return i}class Jp{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const ef=new Jp;class tf{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=ef,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let i=this.range,n=this.rangeIndex,s=this.pos+e;for(;s<i.from;){if(!n)return null;let e=this.ranges[--n];s-=i.from-e.to,i=e}for(;t<0?s>i.to:s>=i.to;){if(n==this.ranges.length-1)return null;let e=this.ranges[++n];s+=e.from-i.to,i=e}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t,i,n=this.chunkOff+e;if(n>=0&&n<this.chunk.length)t=this.pos+e,i=this.chunk.charCodeAt(n);else{let n=this.resolveOffset(e,1);if(null==n)return-1;if(t=n,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,n=this.range;for(;n.to<=t;)n=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>n.to&&(this.chunk2=this.chunk2.slice(0,n.to-t)),i=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),i}acceptToken(e,t=0){let i=t?this.resolveOffset(t,-1):this.pos;if(null==i||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=i}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=ef,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let i="";for(let n of this.ranges){if(n.from>=t)break;n.to>e&&(i+=this.input.read(Math.max(n.from,e),Math.min(n.to,t)))}return i}}class nf{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:i}=t.p;af(this.data,e,t,this.id,i.data,i.tokenPrecTable)}}nf.prototype.contextual=nf.prototype.fallback=nf.prototype.extend=!1;class sf{constructor(e,t,i){this.precTable=t,this.elseToken=i,this.data="string"==typeof e?Kp(e):e}token(e,t){let i=e.pos,n=0;for(;;){let i=e.next<0,s=e.resolveOffset(1,1);if(af(this.data,e,t,0,this.data,this.precTable),e.token.value>-1)break;if(null==this.elseToken)return;if(i||n++,null==s)break;e.reset(s,e.token)}n&&(e.reset(i,e.token),e.acceptToken(this.elseToken,n))}}sf.prototype.contextual=nf.prototype.fallback=nf.prototype.extend=!1;class of{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function af(e,t,i,n,s,o){let a=0,r=1<<n,{dialect:l}=i.p.parser;e:for(;0!=(r&e[a]);){let i=e[a+1];for(let n=a+3;n<i;n+=2)if((e[n+1]&r)>0){let i=e[n];if(l.allows(i)&&(-1==t.token.value||t.token.value==i||lf(i,t.token.value,s,o))){t.acceptToken(i);break}}let n=t.next,c=0,h=e[a+2];if(!(t.next<0&&h>c&&65535==e[i+3*h-3])){for(;c<h;){let s=c+h>>1,o=i+s+(s<<1),r=e[o],l=e[o+1]||65536;if(n<r)h=s;else{if(!(n>=l)){a=e[o+2],t.advance();continue e}c=s+1}}break}a=e[i+3*h-1]}}function rf(e,t,i){for(let n,s=t;65535!=(n=e[s]);s++)if(n==i)return s-t;return-1}function lf(e,t,i,n){let s=rf(i,n,t);return s<0||rf(i,n,e)<s}const cf="undefined"!=typeof process&&process.env&&/\bparse\b/.test(process.env.LOG);let hf=null;function df(e,t,i){let n=e.cursor(er.IncludeAnonymous);for(n.moveTo(t);;)if(!(i<0?n.childBefore(t):n.childAfter(t)))for(;;){if((i<0?n.to<t:n.from>t)&&!n.type.isError)return i<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(e.length,Math.max(n.from+1,t+25));if(i<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return i<0?0:e.length}}class uf{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?df(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?df(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let i=this.trees[t],n=this.index[t];if(n==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=i.children[n],o=this.start[t]+i.positions[n];if(o>e)return this.nextStart=o,null;if(s instanceof tr){if(o==e){if(o<this.safeFrom)return null;let e=o+s.length;if(e<=this.safeTo){let t=s.prop(Ua.lookAhead);if(!t||e+t<this.fragment.to)return s}}this.index[t]++,o+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[t]++,this.nextStart=o+s.length}}}class pf{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new Jp))}getActions(e){let t=0,i=null,{parser:n}=e.p,{tokenizers:s}=n,o=n.stateSlot(e.state,3),a=e.curContext?e.curContext.hash:0,r=0;for(let n=0;n<s.length;n++){if(0==(1<<n&o))continue;let l=s[n],c=this.tokens[n];if((!i||l.fallback)&&((l.contextual||c.start!=e.pos||c.mask!=o||c.context!=a)&&(this.updateCachedToken(c,l,e),c.mask=o,c.context=a),c.lookAhead>c.end+25&&(r=Math.max(c.lookAhead,r)),0!=c.value)){let n=t;if(c.extended>-1&&(t=this.addActions(e,c.extended,c.end,t)),t=this.addActions(e,c.value,c.end,t),!l.extend&&(i=c,t>n))break}}for(;this.actions.length>t;)this.actions.pop();return r&&e.setLookAhead(r),i||e.pos!=this.stream.end||(i=new Jp,i.value=e.p.parser.eofTerm,i.start=i.end=e.pos,t=this.addActions(e,i.value,i.end,t)),this.mainToken=i,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new Jp,{pos:i,p:n}=e;return t.start=i,t.end=Math.min(i+1,n.stream.end),t.value=i==n.stream.end?n.parser.eofTerm:0,t}updateCachedToken(e,t,i){let n=this.stream.clipPos(i.pos);if(t.token(this.stream.reset(n,e),i),e.value>-1){let{parser:t}=i.p;for(let n=0;n<t.specialized.length;n++)if(t.specialized[n]==e.value){let s=t.specializers[n](this.stream.read(e.start,e.end),i);if(s>=0&&i.p.parser.dialect.allows(s>>1)){0==(1&s)?e.value=s>>1:e.extended=s>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,t,i,n){for(let t=0;t<n;t+=3)if(this.actions[t]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=i,n}addActions(e,t,i,n){let{state:s}=e,{parser:o}=e.p,{data:a}=o;for(let e=0;e<2;e++)for(let r=o.stateSlot(s,e?2:1);;r+=3){if(65535==a[r]){if(1!=a[r+1]){0==n&&2==a[r+1]&&(n=this.putAction(wf(a,r+2),t,i,n));break}r=wf(a,r+2)}a[r]==t&&(n=this.putAction(wf(a,r+1),t,i,n))}return n}}class ff{constructor(e,t,i,n){this.parser=e,this.input=t,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new tf(t,n),this.tokens=new pf(e,this.stream),this.topTerm=e.top[1];let{from:s}=n[0];this.stacks=[Xp.start(this,e.top[0],s)],this.fragments=i.length&&this.stream.end-s>4*e.bufferLength?new uf(i,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,i=this.stacks,n=this.minStackPos,s=this.stacks=[];if(this.bigReductionCount>300&&1==i.length){let[e]=i;for(;e.forceReduce()&&e.stack.length&&e.stack[e.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<i.length;o++){let a=i[o];for(;;){if(this.tokens.mainToken=null,a.pos>n)s.push(a);else{if(this.advanceStack(a,s,i))continue;{e||(e=[],t=[]),e.push(a);let i=this.tokens.getMainToken(a);t.push(i.value,i.end)}}break}}if(!s.length){let t=e&&function(e){let t=null;for(let i of e){let e=i.p.stoppedAt;(i.pos==i.p.stream.end||null!=e&&i.pos>e)&&i.p.parser.stateFlag(i.state,2)&&(!t||t.score<i.score)&&(t=i)}return t}(e);if(t)return cf&&console.log("Finish with "+this.stackID(t)),this.stackToTree(t);if(this.parser.strict)throw cf&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+n);this.recovering||(this.recovering=5)}if(this.recovering&&e){let i=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,s);if(i)return cf&&console.log("Force-finish "+this.stackID(i)),this.stackToTree(i.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(s.length>e)for(s.sort(((e,t)=>t.score-e.score));s.length>e;)s.pop();s.some((e=>e.reducePos>n))&&this.recovering--}else if(s.length>1){e:for(let e=0;e<s.length-1;e++){let t=s[e];for(let i=e+1;i<s.length;i++){let n=s[i];if(t.sameState(n)||t.buffer.length>500&&n.buffer.length>500){if(!((t.score-n.score||t.buffer.length-n.buffer.length)>0)){s.splice(e--,1);continue e}s.splice(i--,1)}}}s.length>12&&s.splice(12,s.length-12)}this.minStackPos=s[0].pos;for(let e=1;e<s.length;e++)s[e].pos<this.minStackPos&&(this.minStackPos=s[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,i){let n=e.pos,{parser:s}=this,o=cf?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,i=t?e.curContext.hash:0;for(let a=this.fragments.nodeAt(n);a;){let n=this.parser.nodeSet.types[a.type.id]==a.type?s.getGoto(e.state,a.type.id):-1;if(n>-1&&a.length&&(!t||(a.prop(Ua.contextHash)||0)==i))return e.useNode(a,n),cf&&console.log(o+this.stackID(e)+` (via reuse of ${s.getName(a.type.id)})`),!0;if(!(a instanceof tr)||0==a.children.length||a.positions[0]>0)break;let r=a.children[0];if(!(r instanceof tr&&0==a.positions[0]))break;a=r}}let a=s.stateSlot(e.state,4);if(a>0)return e.reduce(a),cf&&console.log(o+this.stackID(e)+` (via always-reduce ${s.getName(65535&a)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let r=this.tokens.getActions(e);for(let a=0;a<r.length;){let l=r[a++],c=r[a++],h=r[a++],d=a==r.length||!i,u=d?e:e.split(),p=this.tokens.mainToken;if(u.apply(l,c,p?p.start:u.pos,h),cf&&console.log(o+this.stackID(u)+` (via ${0==(65536&l)?"shift":`reduce of ${s.getName(65535&l)}`} for ${s.getName(c)} @ ${n}${u==e?"":", split"})`),d)return!0;u.pos>n?t.push(u):i.push(u)}return!1}advanceFully(e,t){let i=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>i)return mf(e,t),!0}}runRecovery(e,t,i){let n=null,s=!1;for(let o=0;o<e.length;o++){let a=e[o],r=t[o<<1],l=t[1+(o<<1)],c=cf?this.stackID(a)+" -> ":"";if(a.deadEnd){if(s)continue;if(s=!0,a.restart(),cf&&console.log(c+this.stackID(a)+" (restarted)"),this.advanceFully(a,i))continue}let h=a.split(),d=c;for(let e=0;h.forceReduce()&&e<10&&(cf&&console.log(d+this.stackID(h)+" (via force-reduce)"),!this.advanceFully(h,i));e++)cf&&(d=this.stackID(h)+" -> ");for(let e of a.recoverByInsert(r))cf&&console.log(c+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,i);this.stream.end>a.pos?(l==a.pos&&(l++,r=0),a.recoverByDelete(r,l),cf&&console.log(c+this.stackID(a)+` (via recover-delete ${this.parser.getName(r)})`),mf(a,i)):(!n||n.score<a.score)&&(n=a)}return n}stackToTree(e){return e.close(),tr.build({buffer:Hp.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(hf||(hf=new WeakMap)).get(e);return t||hf.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function mf(e,t){for(let i=0;i<t.length;i++){let n=t[i];if(n.pos==e.pos&&n.sameState(e))return void(t[i].score<e.score&&(t[i]=e))}t.push(e)}class gf{constructor(e,t,i){this.source=e,this.flags=t,this.disabled=i}allows(e){return!this.disabled||0==this.disabled[e]}}const bf=e=>e;class vf extends Or{constructor(e){if(super(),this.wrappers=[],14!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let i=0;i<e.repeatNodeCount;i++)t.push("");let i=Object.keys(e.topRules).map((t=>e.topRules[t][1])),n=[];for(let e=0;e<t.length;e++)n.push([]);function s(e,t,i){n[e].push([t,t.deserialize(String(i))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];"string"==typeof e&&(e=Ua[e]);for(let i=1;i<t.length;){let n=t[i++];if(n>=0)s(n,e,t[i++]);else{let o=t[i+-n];for(let a=-n;a>0;a--)s(t[i++],e,o);i++}}}this.nodeSet=new Ha(t.map(((t,s)=>Ya.define({name:s>=this.minRepeatTerm?void 0:t,id:s,props:n[s],top:i.indexOf(s)>-1,error:0==s,skipped:e.skippedNodes&&e.skippedNodes.indexOf(s)>-1})))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=Za;let o=Kp(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let e=0;e<this.specializerSpecs.length;e++)this.specialized[e]=this.specializerSpecs[e].term;this.specializers=this.specializerSpecs.map(yf),this.states=Kp(e.states,Uint32Array),this.data=Kp(e.stateData),this.goto=Kp(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new nf(o,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,i){let n=new ff(this,e,t,i);for(let s of this.wrappers)n=s(n,e,t,i);return n}getGoto(e,t,i=!1){let n=this.goto;if(t>=n[0])return-1;for(let s=n[t+1];;){let t=n[s++],o=1&t,a=n[s++];if(o&&i)return a;for(let i=s+(t>>1);s<i;s++)if(n[s]==e)return a;if(o)return-1}}hasAction(e,t){let i=this.data;for(let n=0;n<2;n++)for(let s,o=this.stateSlot(e,n?2:1);;o+=3){if(65535==(s=i[o])){if(1!=i[o+1]){if(2==i[o+1])return wf(i,o+2);break}s=i[o=wf(i,o+2)]}if(s==t||0==s)return wf(i,o+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,(e=>e==t||null))}allActions(e,t){let i=this.stateSlot(e,4),n=i?t(i):void 0;for(let i=this.stateSlot(e,1);null==n;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=wf(this.data,i+2)}n=t(wf(this.data,i+1))}return n}nextStates(e){let t=[];for(let i=this.stateSlot(e,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=wf(this.data,i+2)}if(0==(1&this.data[i+2])){let e=this.data[i+1];t.some(((t,i)=>1&i&&t==e))||t.push(this.data[i],e)}}return t}configure(e){let t=Object.assign(Object.create(vf.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let i=this.topRules[e.top];if(!i)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=i}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let i=e.tokenizers.find((e=>e.from==t));return i?i.to:t}))),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map(((i,n)=>{let s=e.specializers.find((e=>e.from==i.external));if(!s)return i;let o=Object.assign(Object.assign({},i),{external:s.to});return t.specializers[n]=yf(o),o}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),i=t.map((()=>!1));if(e)for(let n of e.split(" ")){let e=t.indexOf(n);e>=0&&(i[e]=!0)}let n=null;for(let e=0;e<t.length;e++)if(!i[e])for(let i,s=this.dialects[t[e]];65535!=(i=this.data[s++]);)(n||(n=new Uint8Array(this.maxTerm+1)))[i]=1;return new gf(e,i,n)}static deserialize(e){return new vf(e)}}function wf(e,t){return e[t]|e[t+1]<<16}function yf(e){if(e.external){let t=e.extend?1:0;return(i,n)=>e.external(i,n)<<1|t}return e.get}const Of=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],xf=new class{constructor(e){this.start=e.start,this.shift=e.shift||bf,this.reduce=e.reduce||bf,this.reuse=e.reuse||bf,this.hash=e.hash||(()=>0),this.strict=!1!==e.strict}}({start:!1,shift:(e,t)=>5==t||6==t||318==t?e:319==t,strict:!1}),$f=new of(((e,t)=>{let{next:i}=e;(125==i||-1==i||t.context)&&e.acceptToken(316)}),{contextual:!0,fallback:!0}),Cf=new of(((e,t)=>{let i,{next:n}=e;Of.indexOf(n)>-1||(47!=n||47!=(i=e.peek(1))&&42!=i)&&(125==n||59==n||-1==n||t.context||e.acceptToken(314))}),{contextual:!0}),Sf=new of(((e,t)=>{91!=e.next||t.context||e.acceptToken(315)}),{contextual:!0}),_f=new of(((e,t)=>{let{next:i}=e;if(43==i||45==i){if(e.advance(),i==e.next){e.advance();let i=!t.context&&t.canShift(1);e.acceptToken(i?1:2)}}else 63==i&&46==e.peek(1)&&(e.advance(),e.advance(),(e.next<48||e.next>57)&&e.acceptToken(3))}),{contextual:!0});function kf(e,t){return e>=65&&e<=90||e>=97&&e<=122||95==e||e>=192||!t&&e>=48&&e<=57}const Ef=new of(((e,t)=>{if(60!=e.next||!t.dialectEnabled(0))return;if(e.advance(),47==e.next)return;let i=0;for(;Of.indexOf(e.next)>-1;)e.advance(),i++;if(kf(e.next,!0)){for(e.advance(),i++;kf(e.next,!1);)e.advance(),i++;for(;Of.indexOf(e.next)>-1;)e.advance(),i++;if(44==e.next)return;for(let t=0;;t++){if(7==t){if(!kf(e.next,!0))return;break}if(e.next!="extends".charCodeAt(t))break;e.advance(),i++}}e.acceptToken(4,-i)})),Pf=kr({"get set async static":Xr.modifier,"for while do if else switch try catch finally return throw break continue default case":Xr.controlKeyword,"in of await yield void typeof delete instanceof":Xr.operatorKeyword,"let var const using function class extends":Xr.definitionKeyword,"import export from":Xr.moduleKeyword,"with debugger as new":Xr.keyword,TemplateString:Xr.special(Xr.string),super:Xr.atom,BooleanLiteral:Xr.bool,this:Xr.self,null:Xr.null,Star:Xr.modifier,VariableName:Xr.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":Xr.function(Xr.variableName),VariableDefinition:Xr.definition(Xr.variableName),Label:Xr.labelName,PropertyName:Xr.propertyName,PrivatePropertyName:Xr.special(Xr.propertyName),"CallExpression/MemberExpression/PropertyName":Xr.function(Xr.propertyName),"FunctionDeclaration/VariableDefinition":Xr.function(Xr.definition(Xr.variableName)),"ClassDeclaration/VariableDefinition":Xr.definition(Xr.className),"NewExpression/VariableName":Xr.className,PropertyDefinition:Xr.definition(Xr.propertyName),PrivatePropertyDefinition:Xr.definition(Xr.special(Xr.propertyName)),UpdateOp:Xr.updateOperator,"LineComment Hashbang":Xr.lineComment,BlockComment:Xr.blockComment,Number:Xr.number,String:Xr.string,Escape:Xr.escape,ArithOp:Xr.arithmeticOperator,LogicOp:Xr.logicOperator,BitOp:Xr.bitwiseOperator,CompareOp:Xr.compareOperator,RegExp:Xr.regexp,Equals:Xr.definitionOperator,Arrow:Xr.function(Xr.punctuation),": Spread":Xr.punctuation,"( )":Xr.paren,"[ ]":Xr.squareBracket,"{ }":Xr.brace,"InterpolationStart InterpolationEnd":Xr.special(Xr.brace),".":Xr.derefOperator,", ;":Xr.separator,"@":Xr.meta,TypeName:Xr.typeName,TypeDefinition:Xr.definition(Xr.typeName),"type enum interface implements namespace module declare":Xr.definitionKeyword,"abstract global Privacy readonly override":Xr.modifier,"is keyof unique infer asserts":Xr.operatorKeyword,JSXAttributeValue:Xr.attributeValue,JSXText:Xr.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":Xr.angleBracket,"JSXIdentifier JSXNameSpacedName":Xr.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":Xr.attributeName,"JSXBuiltin/JSXIdentifier":Xr.standard(Xr.tagName)}),Af={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,const:52,extends:56,this:60,true:68,false:68,null:80,void:84,typeof:88,super:104,new:138,delete:150,yield:159,await:163,class:168,public:231,private:231,protected:231,readonly:233,instanceof:252,satisfies:255,in:256,import:290,keyof:347,unique:351,infer:357,asserts:393,is:395,abstract:415,implements:417,type:419,let:422,var:424,using:427,interface:433,enum:437,namespace:443,module:445,declare:449,global:453,for:472,of:481,while:484,with:488,do:492,if:496,else:498,switch:502,case:508,try:514,catch:518,finally:522,return:526,throw:530,break:534,continue:538,debugger:542},Rf={__proto__:null,async:125,get:127,set:129,declare:191,public:193,private:193,protected:193,static:195,abstract:197,override:199,readonly:205,accessor:207,new:399},Df={__proto__:null,"<":189},Vf=vf.deserialize({version:14,states:"$EOQ%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#D_O.QQlO'#DeO.bQlO'#DpO%[QlO'#DxO0fQlO'#EQOOQ!0Lf'#EY'#EYO1PQ`O'#EVOOQO'#En'#EnOOQO'#Ij'#IjO1XQ`O'#GrO1dQ`O'#EmO1iQ`O'#EmO3hQ!0MxO'#JpO6[Q!0MxO'#JqO6uQ`O'#F[O6zQ,UO'#FsOOQ!0Lf'#Fe'#FeO7VO7dO'#FeO7eQMhO'#F{O9UQ`O'#FzOOQ!0Lf'#Jq'#JqOOQ!0Lb'#Jp'#JpO9ZQ`O'#GvOOQ['#K]'#K]O9fQ`O'#IWO9kQ!0LrO'#IXOOQ['#J^'#J^OOQ['#I]'#I]Q`QlOOQ`QlOOO9sQ!L^O'#DtO9zQlO'#D|O:RQlO'#EOO9aQ`O'#GrO:YQMhO'#CoO:hQ`O'#ElO:sQ`O'#EwO:xQMhO'#FdO;gQ`O'#GrOOQO'#K^'#K^O;lQ`O'#K^O;zQ`O'#GzO;zQ`O'#G{O;zQ`O'#G}O9aQ`O'#HQO<qQ`O'#HTO>YQ`O'#CeO>jQ`O'#HaO>rQ`O'#HgO>rQ`O'#HiO`QlO'#HkO>rQ`O'#HmO>rQ`O'#HpO>wQ`O'#HvO>|Q!0LsO'#H|O%[QlO'#IOO?XQ!0LsO'#IQO?dQ!0LsO'#ISO9kQ!0LrO'#IUO?oQ!0MxO'#CiO@qQpO'#DjQOQ`OOO%[QlO'#EOOAXQ`O'#ERO:YQMhO'#ElOAdQ`O'#ElOAoQ!bO'#FdOOQ['#Cg'#CgOOQ!0Lb'#Do'#DoOOQ!0Lb'#Jt'#JtO%[QlO'#JtOOQO'#Jw'#JwOOQO'#If'#IfOBoQpO'#EeOOQ!0Lb'#Ed'#EdOOQ!0Lb'#J{'#J{OCkQ!0MSO'#EeOCuQpO'#EUOOQO'#Jv'#JvODZQpO'#JwOEhQpO'#EUOCuQpO'#EePEuO&2DjO'#CbPOOO)CD{)CD{OOOO'#I^'#I^OFQO#tO,59UOOQ!0Lh,59U,59UOOOO'#I_'#I_OF`O&jO,59UOFnQ!L^O'#DaOOOO'#Ia'#IaOFuO#@ItO,59yOOQ!0Lf,59y,59yOGTQlO'#IbOGhQ`O'#JrOIgQ!fO'#JrO+}QlO'#JrOInQ`O,5:POJUQ`O'#EnOJcQ`O'#KROJnQ`O'#KQOJnQ`O'#KQOJvQ`O,5;[OJ{Q`O'#KPOOQ!0Ln,5:[,5:[OKSQlO,5:[OMQQ!0MxO,5:dOMqQ`O,5:lON[Q!0LrO'#KOONcQ`O'#J}O9ZQ`O'#J}ONwQ`O'#J}O! PQ`O,5;ZO! UQ`O'#J}O!#ZQ!fO'#JqOOQ!0Lh'#Ci'#CiO%[QlO'#EQO!#yQ!fO,5:qOOQS'#Jx'#JxOOQO-E<h-E<hO9aQ`O,5=^O!$aQ`O,5=^O!$fQlO,5;XO!&iQMhO'#EiO!(SQ`O,5;XO!(XQlO'#DwO!(cQpO,5;bO!(kQpO,5;bO%[QlO,5;bOOQ['#FS'#FSOOQ['#FU'#FUO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cOOQ['#FY'#FYO!(yQlO,5;sOOQ!0Lf,5;x,5;xOOQ!0Lf,5;y,5;yOOQ!0Lf,5;{,5;{O%[QlO'#InO!*|Q!0LrO,5<hO%[QlO,5;cO!&iQMhO,5;cO!+kQMhO,5;cO!-]QMhO'#E[O%[QlO,5;vOOQ!0Lf,5;z,5;zO!-dQ,UO'#FiO!.aQ,UO'#KVO!-{Q,UO'#KVO!.hQ,UO'#KVOOQO'#KV'#KVO!.|Q,UO,5<ROOOW,5<_,5<_O!/_QlO'#FuOOOW'#Im'#ImO7VO7dO,5<PO!/fQ,UO'#FwOOQ!0Lf,5<P,5<PO!0VQ$IUO'#CwOOQ!0Lh'#C{'#C{O!0jO#@ItO'#DPO!1WQMjO,5<dO!1_Q`O,5<gO!2zQ(CWO'#GWO!3XQ`O'#GXO!3^Q`O'#GXO!4|Q(CWO'#G]O!6RQpO'#GaOOQO'#Gm'#GmO!+rQMhO'#GlOOQO'#Go'#GoO!+rQMhO'#GnO!6tQ$IUO'#JjOOQ!0Lh'#Jj'#JjO!7OQ`O'#JiO!7^Q`O'#JhO!7fQ`O'#CuOOQ!0Lh'#Cy'#CyO!7qQ`O'#C{OOQ!0Lh'#DT'#DTOOQ!0Lh'#DV'#DVO1SQ`O'#DXO!+rQMhO'#GOO!+rQMhO'#GQO!7vQ`O'#GSO!7{Q`O'#GTO!3^Q`O'#GZO!+rQMhO'#G`O;zQ`O'#JiO!8QQ`O'#EoO!8oQ`O,5<fOOQ!0Lb'#Cr'#CrO!8wQ`O'#EpO!9qQpO'#EqOOQ!0Lb'#KP'#KPO!9xQ!0LrO'#K_O9kQ!0LrO,5=bO`QlO,5>rOOQ['#Jf'#JfOOQ[,5>s,5>sOOQ[-E<Z-E<ZO!;wQ!0MxO,5:`O!9lQpO,5:^O!>bQ!0MxO,5:hO%[QlO,5:hO!@xQ!0MxO,5:jOOQO,5@x,5@xO!AiQMhO,5=^O!AwQ!0LrO'#JgO9UQ`O'#JgO!BYQ!0LrO,59ZO!BeQpO,59ZO!BmQMhO,59ZO:YQMhO,59ZO!BxQ`O,5;XO!CQQ`O'#H`O!CfQ`O'#KbO%[QlO,5;|O!9lQpO,5<OO!CnQ`O,5=yO!CsQ`O,5=yO!CxQ`O,5=yO9kQ!0LrO,5=yO;zQ`O,5=iOOQO'#Cw'#CwO!DWQpO,5=fO!D`QMhO,5=gO!DkQ`O,5=iO!DpQ!bO,5=lO!DxQ`O'#K^O>wQ`O'#HVO9aQ`O'#HXO!D}Q`O'#HXO:YQMhO'#HZO!ESQ`O'#HZOOQ[,5=o,5=oO!EXQ`O'#H[O!EjQ`O'#CoO!EoQ`O,59PO!EyQ`O,59PO!HOQlO,59POOQ[,59P,59PO!H`Q!0LrO,59PO%[QlO,59PO!JkQlO'#HcOOQ['#Hd'#HdOOQ['#He'#HeO`QlO,5={O!KRQ`O,5={O`QlO,5>RO`QlO,5>TO!KWQ`O,5>VO`QlO,5>XO!K]Q`O,5>[O!KbQlO,5>bOOQ[,5>h,5>hO%[QlO,5>hO9kQ!0LrO,5>jOOQ[,5>l,5>lO# lQ`O,5>lOOQ[,5>n,5>nO# lQ`O,5>nOOQ[,5>p,5>pO#!YQpO'#D]O%[QlO'#JtO#!{QpO'#JtO##VQpO'#DkO##hQpO'#DkO#%yQlO'#DkO#&QQ`O'#JsO#&YQ`O,5:UO#&_Q`O'#ErO#&mQ`O'#KSO#&uQ`O,5;]O#&zQpO'#DkO#'XQpO'#ETOOQ!0Lf,5:m,5:mO%[QlO,5:mO#'`Q`O,5:mO>wQ`O,5;WO!BeQpO,5;WO!BmQMhO,5;WO:YQMhO,5;WO#'hQ`O,5@`O#'mQ07dO,5:qOOQO-E<d-E<dO#(sQ!0MSO,5;POCuQpO,5:pO#(}QpO,5:pOCuQpO,5;PO!BYQ!0LrO,5:pOOQ!0Lb'#Eh'#EhOOQO,5;P,5;PO%[QlO,5;PO#)[Q!0LrO,5;PO#)gQ!0LrO,5;PO!BeQpO,5:pOOQO,5;V,5;VO#)uQ!0LrO,5;PPOOO'#I['#I[P#*ZO&2DjO,58|POOO,58|,58|OOOO-E<[-E<[OOQ!0Lh1G.p1G.pOOOO-E<]-E<]OOOO,59{,59{O#*fQ!bO,59{OOOO-E<_-E<_OOQ!0Lf1G/e1G/eO#*kQ!fO,5>|O+}QlO,5>|OOQO,5?S,5?SO#*uQlO'#IbOOQO-E<`-E<`O#+SQ`O,5@^O#+[Q!fO,5@^O#+cQ`O,5@lOOQ!0Lf1G/k1G/kO%[QlO,5@mO#+kQ`O'#IhOOQO-E<f-E<fO#+cQ`O,5@lOOQ!0Lb1G0v1G0vOOQ!0Ln1G/v1G/vOOQ!0Ln1G0W1G0WO%[QlO,5@jO#,PQ!0LrO,5@jO#,bQ!0LrO,5@jO#,iQ`O,5@iO9ZQ`O,5@iO#,qQ`O,5@iO#-PQ`O'#IkO#,iQ`O,5@iOOQ!0Lb1G0u1G0uO!(cQpO,5:sO!(nQpO,5:sOOQS,5:u,5:uO#-qQdO,5:uO#-yQMhO1G2xO9aQ`O1G2xOOQ!0Lf1G0s1G0sO#.XQ!0MxO1G0sO#/^Q!0MvO,5;TOOQ!0Lh'#GV'#GVO#/zQ!0MzO'#JjO!$fQlO1G0sO#2VQ!fO'#JuO%[QlO'#JuO#2aQ`O,5:cOOQ!0Lh'#D]'#D]OOQ!0Lf1G0|1G0|O%[QlO1G0|OOQ!0Lf1G1e1G1eO#2fQ`O1G0|O#4zQ!0MxO1G0}O#5RQ!0MxO1G0}O#7iQ!0MxO1G0}O#7pQ!0MxO1G0}O#:WQ!0MxO1G0}O#<nQ!0MxO1G0}O#<uQ!0MxO1G0}O#<|Q!0MxO1G0}O#?dQ!0MxO1G0}O#?kQ!0MxO1G0}O#AxQ?MtO'#CiO#CsQ?MtO1G1_O#CzQ?MtO'#JqO#D_Q!0MxO,5?YOOQ!0Lb-E<l-E<lO#FlQ!0MxO1G0}O#GiQ!0MzO1G0}OOQ!0Lf1G0}1G0}O#HlQMjO'#JzO#HvQ`O,5:vO#H{Q!0MxO1G1bO#IoQ,UO,5<VO#IwQ,UO,5<WO#JPQ,UO'#FnO#JhQ`O'#FmOOQO'#KW'#KWOOQO'#Il'#IlO#JmQ,UO1G1mOOQ!0Lf1G1m1G1mOOOW1G1x1G1xO#KOQ?MtO'#JpO#KYQ`O,5<aO!(yQlO,5<aOOOW-E<k-E<kOOQ!0Lf1G1k1G1kO#K_QpO'#KVOOQ!0Lf,5<c,5<cO#KgQpO,5<cO#KlQMhO'#DROOOO'#I`'#I`O#KsO#@ItO,59kOOQ!0Lh,59k,59kO%[QlO1G2OO!7{Q`O'#IpO#LOQ`O,5<yOOQ!0Lh,5<v,5<vO!+rQMhO'#IsO#LlQMjO,5=WO!+rQMhO'#IuO#M_QMjO,5=YO!&iQMhO,5=[OOQO1G2R1G2RO#MiQ!dO'#CrO#M|Q(CWO'#EpO$ RQpO'#GaO$ iQ!dO,5<rO$ pQ`O'#KYO9ZQ`O'#KYO$!OQ`O,5<tO!+rQMhO,5<sO$!TQ`O'#GYO$!fQ`O,5<sO$!kQ!dO'#GVO$!xQ!dO'#KZO$#SQ`O'#KZO!&iQMhO'#KZO$#XQ`O,5<wO$#^QlO'#JtO$#hQpO'#GbO##hQpO'#GbO$#yQ`O'#GfO!3^Q`O'#GjO$$OQ!0LrO'#IrO$$ZQpO,5<{OOQ!0Lp,5<{,5<{O$$bQpO'#GbO$$oQpO'#GcO$%QQpO'#GcO$%VQMjO,5=WO$%gQMjO,5=YOOQ!0Lh,5=],5=]O!+rQMhO,5@TO!+rQMhO,5@TO$%wQ`O'#IwO$&VQ`O,5@SO$&_Q`O,59aOOQ!0Lh,59g,59gO$'UQ$IYO,59sOOQ!0Lh'#Jn'#JnO$'wQMjO,5<jO$(jQMjO,5<lO@iQ`O,5<nOOQ!0Lh,5<o,5<oO$(tQ`O,5<uO$(yQMjO,5<zO$)ZQ`O,5@TO$)iQ`O'#J}O!$fQlO1G2QO$)nQ`O1G2QO9ZQ`O'#KQO9ZQ`O'#ErO%[QlO'#ErO9ZQ`O'#IyO$)sQ!0LrO,5@yOOQ[1G2|1G2|OOQ[1G4^1G4^OOQ!0Lf1G/z1G/zOOQ!0Lf1G/x1G/xO$+uQ!0MxO1G0SOOQ[1G2x1G2xO!&iQMhO1G2xO%[QlO1G2xO#-|Q`O1G2xO$-yQMhO'#EiOOQ!0Lb,5@R,5@RO$.WQ!0LrO,5@ROOQ[1G.u1G.uO!BYQ!0LrO1G.uO!BeQpO1G.uO!BmQMhO1G.uO$.iQ`O1G0sO$.nQ`O'#CiO$.yQ`O'#KcO$/RQ`O,5=zO$/WQ`O'#KcO$/]Q`O'#KcO$/kQ`O'#JPO$/yQ`O,5@|O$0RQ!fO1G1hOOQ!0Lf1G1j1G1jO9aQ`O1G3eO@iQ`O1G3eO$0YQ`O1G3eO$0_Q`O1G3eOOQ[1G3e1G3eO!DkQ`O1G3TO!&iQMhO1G3QO$0dQ`O1G3QOOQ[1G3R1G3RO!&iQMhO1G3RO$0iQ`O1G3RO$0qQpO'#HPOOQ[1G3T1G3TO!5|QpO'#I{O!DpQ!bO1G3WOOQ[1G3W1G3WOOQ[,5=q,5=qO$0yQMhO,5=sO9aQ`O,5=sO$#yQ`O,5=uO9UQ`O,5=uO!BeQpO,5=uO!BmQMhO,5=uO:YQMhO,5=uO$1XQ`O'#KaO$1dQ`O,5=vOOQ[1G.k1G.kO$1iQ!0LrO1G.kO@iQ`O1G.kO$1tQ`O1G.kO9kQ!0LrO1G.kO$3|Q!fO,5AOO$4ZQ`O,5AOO9ZQ`O,5AOO$4fQlO,5=}O$4mQ`O,5=}OOQ[1G3g1G3gO`QlO1G3gOOQ[1G3m1G3mOOQ[1G3o1G3oO>rQ`O1G3qO$4rQlO1G3sO$8vQlO'#HrOOQ[1G3v1G3vO$9TQ`O'#HxO>wQ`O'#HzOOQ[1G3|1G3|O$9]QlO1G3|O9kQ!0LrO1G4SOOQ[1G4U1G4UOOQ!0Lb'#G^'#G^O9kQ!0LrO1G4WO9kQ!0LrO1G4YO$=dQ`O,5@`O!(yQlO,5;^O9ZQ`O,5;^O>wQ`O,5:VO!(yQlO,5:VO!BeQpO,5:VO$=iQ?MtO,5:VOOQO,5;^,5;^O$=sQpO'#IcO$>ZQ`O,5@_OOQ!0Lf1G/p1G/pO$>cQpO'#IiO$>mQ`O,5@nOOQ!0Lb1G0w1G0wO##hQpO,5:VOOQO'#Ie'#IeO$>uQpO,5:oOOQ!0Ln,5:o,5:oO#'cQ`O1G0XOOQ!0Lf1G0X1G0XO%[QlO1G0XOOQ!0Lf1G0r1G0rO>wQ`O1G0rO!BeQpO1G0rO!BmQMhO1G0rOOQ!0Lb1G5z1G5zO!BYQ!0LrO1G0[OOQO1G0k1G0kO%[QlO1G0kO$>|Q!0LrO1G0kO$?XQ!0LrO1G0kO!BeQpO1G0[OCuQpO1G0[O$?gQ!0LrO1G0kOOQO1G0[1G0[O$?{Q!0MxO1G0kPOOO-E<Y-E<YPOOO1G.h1G.hOOOO1G/g1G/gO$@VQ!bO,5<hO$@_Q!fO1G4hOOQO1G4n1G4nO%[QlO,5>|O$@iQ`O1G5xO$@qQ`O1G6WO$@yQ!fO1G6XO9ZQ`O,5?SO$ATQ!0MxO1G6UO%[QlO1G6UO$AeQ!0LrO1G6UO$AvQ`O1G6TO$AvQ`O1G6TO9ZQ`O1G6TO$BOQ`O,5?VO9ZQ`O,5?VOOQO,5?V,5?VO$BdQ`O,5?VO$)iQ`O,5?VOOQO-E<i-E<iOOQS1G0_1G0_OOQS1G0a1G0aO#-tQ`O1G0aOOQ[7+(d7+(dO!&iQMhO7+(dO%[QlO7+(dO$BrQ`O7+(dO$B}QMhO7+(dO$C]Q!0MzO,5=WO$EhQ!0MzO,5=YO$GsQ!0MzO,5=WO$JUQ!0MzO,5=YO$LgQ!0MzO,59sO$NlQ!0MzO,5<jO%!wQ!0MzO,5<lO%%SQ!0MzO,5<zOOQ!0Lf7+&_7+&_O%'eQ!0MxO7+&_O%(XQlO'#IdO%(fQ`O,5@aO%(nQ!fO,5@aOOQ!0Lf1G/}1G/}O%(xQ`O7+&hOOQ!0Lf7+&h7+&hO%(}Q?MtO,5:dO%[QlO7+&yO%)XQ?MtO,5:`O%)fQ?MtO,5:hO%)pQ?MtO,5:jO%)zQMhO'#IgO%*UQ`O,5@fOOQ!0Lh1G0b1G0bOOQO1G1q1G1qOOQO1G1r1G1rO%*^Q!jO,5<YO!(yQlO,5<XOOQO-E<j-E<jOOQ!0Lf7+'X7+'XOOOW7+'d7+'dOOOW1G1{1G1{O%*iQ`O1G1{OOQ!0Lf1G1}1G1}OOOO,59m,59mO%*nQ!dO,59mOOOO-E<^-E<^OOQ!0Lh1G/V1G/VO%*uQ!0MxO7+'jOOQ!0Lh,5?[,5?[O%+iQMhO1G2eP%+pQ`O'#IpPOQ!0Lh-E<n-E<nO%,^QMjO,5?_OOQ!0Lh-E<q-E<qO%-PQMjO,5?aOOQ!0Lh-E<s-E<sO%-ZQ!dO1G2vO%-bQ!dO'#CrO%-xQMhO'#KQO$#^QlO'#JtOOQ!0Lh1G2^1G2^O%.PQ`O'#IoO%.eQ`O,5@tO%.eQ`O,5@tO%.mQ`O,5@tO%.xQ`O,5@tOOQO1G2`1G2`O%/WQMjO1G2_O!+rQMhO1G2_O%/hQ(CWO'#IqO%/uQ`O,5@uO!&iQMhO,5@uO%/}Q!dO,5@uOOQ!0Lh1G2c1G2cO%2_Q!fO'#CiO%2iQ`O,5=OOOQ!0Lb,5<|,5<|O%2qQpO,5<|OOQ!0Lb,5<},5<}OCfQ`O,5<|O%2|QpO,5<|OOQ!0Lb,5=Q,5=QO$)iQ`O,5=UOOQO,5?^,5?^OOQO-E<p-E<pOOQ!0Lp1G2g1G2gO##hQpO,5<|O$#^QlO,5=OO%3[Q`O,5<}O%3gQpO,5<}O!+rQMhO'#IsO%4aQMjO1G2rO!+rQMhO'#IuO%5SQMjO1G2tO%5^QMjO1G5oO%5hQMjO1G5oOOQO,5?c,5?cOOQO-E<u-E<uOOQO1G.{1G.{O!9lQpO,59uO%[QlO,59uOOQ!0Lh,5<i,5<iO%5uQ`O1G2YO!+rQMhO1G2aO!+rQMhO1G5oO!+rQMhO1G5oO%5zQ!0MxO7+'lOOQ!0Lf7+'l7+'lO!$fQlO7+'lO%6nQ`O,5;^OOQ!0Lb,5?e,5?eOOQ!0Lb-E<w-E<wO%6sQ!dO'#K[O#'cQ`O7+(dO4UQ!fO7+(dO$BuQ`O7+(dO%6}Q!0MvO'#CiO%7nQ!0LrO,5=RO%8PQ!0MvO,5=RO%8dQ`O,5=ROOQ!0Lb1G5m1G5mOOQ[7+$a7+$aO!BYQ!0LrO7+$aO!BeQpO7+$aO!$fQlO7+&_O%8lQ`O'#JOO%9TQ`O,5@}OOQO1G3f1G3fO9aQ`O,5@}O%9TQ`O,5@}O%9]Q`O,5@}OOQO,5?k,5?kOOQO-E<}-E<}OOQ!0Lf7+'S7+'SO%9bQ`O7+)PO9kQ!0LrO7+)PO9aQ`O7+)PO@iQ`O7+)POOQ[7+(o7+(oO%9gQ!0MvO7+(lO!&iQMhO7+(lO!DfQ`O7+(mOOQ[7+(m7+(mO!&iQMhO7+(mO%9qQ`O'#K`O%9|Q`O,5=kOOQO,5?g,5?gOOQO-E<y-E<yOOQ[7+(r7+(rO%;`QpO'#HYOOQ[1G3_1G3_O!&iQMhO1G3_O%[QlO1G3_O%;gQ`O1G3_O%;rQMhO1G3_O9kQ!0LrO1G3aO$#yQ`O1G3aO9UQ`O1G3aO!BeQpO1G3aO!BmQMhO1G3aO%<QQ`O'#I}O%<fQ`O,5@{O%<nQpO,5@{OOQ!0Lb1G3b1G3bOOQ[7+$V7+$VO@iQ`O7+$VO9kQ!0LrO7+$VO%<yQ`O7+$VO%[QlO1G6jO%[QlO1G6kO%=OQ!0LrO1G6jO%=YQlO1G3iO%=aQ`O1G3iO%=fQlO1G3iOOQ[7+)R7+)RO9kQ!0LrO7+)]O`QlO7+)_OOQ['#Kf'#KfOOQ['#JQ'#JQO%=mQlO,5>^OOQ[,5>^,5>^O%[QlO'#HsO%=zQ`O'#HuOOQ[,5>d,5>dO9ZQ`O,5>dOOQ[,5>f,5>fOOQ[7+)h7+)hOOQ[7+)n7+)nOOQ[7+)r7+)rOOQ[7+)t7+)tO%>PQpO1G5zO%>kQ?MtO1G0xO%>uQ`O1G0xOOQO1G/q1G/qO%?QQ?MtO1G/qO>wQ`O1G/qO!(yQlO'#DkOOQO,5>},5>}OOQO-E<a-E<aOOQO,5?T,5?TOOQO-E<g-E<gO!BeQpO1G/qOOQO-E<c-E<cOOQ!0Ln1G0Z1G0ZOOQ!0Lf7+%s7+%sO#'cQ`O7+%sOOQ!0Lf7+&^7+&^O>wQ`O7+&^O!BeQpO7+&^OOQO7+%v7+%vO$?{Q!0MxO7+&VOOQO7+&V7+&VO%[QlO7+&VO%?[Q!0LrO7+&VO!BYQ!0LrO7+%vO!BeQpO7+%vO%?gQ!0LrO7+&VO%?uQ!0MxO7++pO%[QlO7++pO%@VQ`O7++oO%@VQ`O7++oOOQO1G4q1G4qO9ZQ`O1G4qO%@_Q`O1G4qOOQS7+%{7+%{O#'cQ`O<<LOO4UQ!fO<<LOO%@mQ`O<<LOOOQ[<<LO<<LOO!&iQMhO<<LOO%[QlO<<LOO%@uQ`O<<LOO%AQQ!0MzO,5?_O%C]Q!0MzO,5?aO%EhQ!0MzO1G2_O%GyQ!0MzO1G2rO%JUQ!0MzO1G2tO%LaQ!fO,5?OO%[QlO,5?OOOQO-E<b-E<bO%LkQ`O1G5{OOQ!0Lf<<JS<<JSO%LsQ?MtO1G0sO%NzQ?MtO1G0}O& RQ?MtO1G0}O&#SQ?MtO1G0}O&#ZQ?MtO1G0}O&%[Q?MtO1G0}O&']Q?MtO1G0}O&'dQ?MtO1G0}O&'kQ?MtO1G0}O&)lQ?MtO1G0}O&)sQ?MtO1G0}O&)zQ!0MxO<<JeO&+rQ?MtO1G0}O&,oQ?MvO1G0}O&-rQ?MvO'#JjO&/xQ?MtO1G1bO&0VQ?MtO1G0SO&0aQMjO,5?ROOQO-E<e-E<eO!(yQlO'#FpOOQO'#KX'#KXOOQO1G1t1G1tO&0kQ`O1G1sO&0pQ?MtO,5?YOOOW7+'g7+'gOOOO1G/X1G/XO&0zQ!dO1G4vOOQ!0Lh7+(P7+(PP!&iQMhO,5?[O!+rQMhO7+(bO&1RQ`O,5?ZO9ZQ`O,5?ZOOQO-E<m-E<mO&1aQ`O1G6`O&1aQ`O1G6`O&1iQ`O1G6`O&1tQMjO7+'yO&2UQ!dO,5?]O&2`Q`O,5?]O!&iQMhO,5?]OOQO-E<o-E<oO&2eQ!dO1G6aO&2oQ`O1G6aO&2wQ`O1G2jO!&iQMhO1G2jOOQ!0Lb1G2h1G2hOOQ!0Lb1G2i1G2iO%2qQpO1G2hO!BeQpO1G2hOCfQ`O1G2hOOQ!0Lb1G2p1G2pO&2|QpO1G2hO&3[Q`O1G2jO$)iQ`O1G2iOCfQ`O1G2iO$#^QlO1G2jO&3dQ`O1G2iO&4WQMjO,5?_OOQ!0Lh-E<r-E<rO&4yQMjO,5?aOOQ!0Lh-E<t-E<tO!+rQMhO7++ZOOQ!0Lh1G/a1G/aO&5TQ`O1G/aOOQ!0Lh7+'t7+'tO&5YQMjO7+'{O&5jQMjO7++ZO&5tQMjO7++ZO&6RQ!0MxO<<KWOOQ!0Lf<<KW<<KWO&6uQ`O1G0xO!&iQMhO'#IxO&6zQ`O,5@vO&8|Q!fO<<LOO!&iQMhO1G2mO&9TQ!0LrO1G2mOOQ[<<G{<<G{O!BYQ!0LrO<<G{O&9fQ!0MxO<<IyOOQ!0Lf<<Iy<<IyOOQO,5?j,5?jO&:YQ`O,5?jO&:_Q`O,5?jOOQO-E<|-E<|O&:mQ`O1G6iO&:mQ`O1G6iO9aQ`O1G6iO@iQ`O<<LkOOQ[<<Lk<<LkO&:uQ`O<<LkO9kQ!0LrO<<LkOOQ[<<LW<<LWO%9gQ!0MvO<<LWOOQ[<<LX<<LXO!DfQ`O<<LXO&:zQpO'#IzO&;VQ`O,5@zO!(yQlO,5@zOOQ[1G3V1G3VOOQO'#I|'#I|O9kQ!0LrO'#I|O&;_QpO,5=tOOQ[,5=t,5=tO&;fQpO'#EeO&;mQpO'#GdO&;rQ`O7+(yO&;wQ`O7+(yOOQ[7+(y7+(yO!&iQMhO7+(yO%[QlO7+(yO&<PQ`O7+(yOOQ[7+({7+({O9kQ!0LrO7+({O$#yQ`O7+({O9UQ`O7+({O!BeQpO7+({O&<[Q`O,5?iOOQO-E<{-E<{OOQO'#H]'#H]O&<gQ`O1G6gO9kQ!0LrO<<GqOOQ[<<Gq<<GqO@iQ`O<<GqO&<oQ`O7+,UO&<tQ`O7+,VO%[QlO7+,UO%[QlO7+,VOOQ[7+)T7+)TO&<yQ`O7+)TO&=OQlO7+)TO&=VQ`O7+)TOOQ[<<Lw<<LwOOQ[<<Ly<<LyOOQ[-E=O-E=OOOQ[1G3x1G3xO&=[Q`O,5>_OOQ[,5>a,5>aO&=aQ`O1G4OO9ZQ`O7+&dO!(yQlO7+&dOOQO7+%]7+%]O&=fQ?MtO1G6XO>wQ`O7+%]OOQ!0Lf<<I_<<I_OOQ!0Lf<<Ix<<IxO>wQ`O<<IxOOQO<<Iq<<IqO$?{Q!0MxO<<IqO%[QlO<<IqOOQO<<Ib<<IbO!BYQ!0LrO<<IbO&=pQ!0LrO<<IqO&={Q!0MxO<= [O&>]Q`O<= ZOOQO7+*]7+*]O9ZQ`O7+*]OOQ[ANAjANAjO&>eQ!fOANAjO!&iQMhOANAjO#'cQ`OANAjO4UQ!fOANAjO&>lQ`OANAjO%[QlOANAjO&>tQ!0MzO7+'yO&AVQ!0MzO,5?_O&CbQ!0MzO,5?aO&EmQ!0MzO7+'{O&HOQ!fO1G4jO&HYQ?MtO7+&_O&J^Q?MvO,5=WO&LeQ?MvO,5=YO&LuQ?MvO,5=WO&MVQ?MvO,5=YO&MgQ?MvO,59sO' mQ?MvO,5<jO'#pQ?MvO,5<lO'&UQ?MvO,5<zO''zQ?MtO7+'jO'(XQ?MtO7+'lO'(fQ`O,5<[OOQO7+'_7+'_OOQ!0Lh7+*b7+*bO'(kQMjO<<K|OOQO1G4u1G4uO'(rQ`O1G4uO'(}Q`O1G4uO')]Q`O7++zO')]Q`O7++zO!&iQMhO1G4wO')eQ!dO1G4wO')oQ`O7++{O')wQ`O7+(UO'*SQ!dO7+(UOOQ!0Lb7+(S7+(SOOQ!0Lb7+(T7+(TO!BeQpO7+(SOCfQ`O7+(SO'*^Q`O7+(UO!&iQMhO7+(UO$)iQ`O7+(TO'*cQ`O7+(UOCfQ`O7+(TO'*kQMjO<<NuOOQ!0Lh7+${7+${O!+rQMhO<<NuO'*uQ!dO,5?dOOQO-E<v-E<vO'+PQ!0MvO7+(XO!&iQMhO7+(XOOQ[AN=gAN=gO9aQ`O1G5UOOQO1G5U1G5UO'+aQ`O1G5UO'+fQ`O7+,TO'+fQ`O7+,TO9kQ!0LrOANBVO@iQ`OANBVOOQ[ANBVANBVOOQ[ANArANArOOQ[ANAsANAsO'+nQ`O,5?fOOQO-E<x-E<xO'+yQ?MtO1G6fOOQO,5?h,5?hOOQO-E<z-E<zOOQ[1G3`1G3`O',TQ`O,5=OOOQ[<<Le<<LeO!&iQMhO<<LeO&;rQ`O<<LeO',YQ`O<<LeO%[QlO<<LeOOQ[<<Lg<<LgO9kQ!0LrO<<LgO$#yQ`O<<LgO9UQ`O<<LgO',bQpO1G5TO',mQ`O7+,ROOQ[AN=]AN=]O9kQ!0LrOAN=]OOQ[<= p<= pOOQ[<= q<= qO',uQ`O<= pO',zQ`O<= qOOQ[<<Lo<<LoO'-PQ`O<<LoO'-UQlO<<LoOOQ[1G3y1G3yO>wQ`O7+)jO'-]Q`O<<JOO'-hQ?MtO<<JOOOQO<<Hw<<HwOOQ!0LfAN?dAN?dOOQOAN?]AN?]O$?{Q!0MxOAN?]OOQOAN>|AN>|O%[QlOAN?]OOQO<<Mw<<MwOOQ[G27UG27UO!&iQMhOG27UO#'cQ`OG27UO'-rQ!fOG27UO4UQ!fOG27UO'-yQ`OG27UO'.RQ?MtO<<JeO'.`Q?MvO1G2_O'0UQ?MvO,5?_O'2XQ?MvO,5?aO'4[Q?MvO1G2rO'6_Q?MvO1G2tO'8bQ?MtO<<KWO'8oQ?MtO<<IyOOQO1G1v1G1vO!+rQMhOANAhOOQO7+*a7+*aO'8|Q`O7+*aO'9XQ`O<= fO'9aQ!dO7+*cOOQ!0Lb<<Kp<<KpO$)iQ`O<<KpOCfQ`O<<KpO'9kQ`O<<KpO!&iQMhO<<KpOOQ!0Lb<<Kn<<KnO!BeQpO<<KnO'9vQ!dO<<KpOOQ!0Lb<<Ko<<KoO':QQ`O<<KpO!&iQMhO<<KpO$)iQ`O<<KoO':VQMjOANDaO':aQ!0MvO<<KsOOQO7+*p7+*pO9aQ`O7+*pO':qQ`O<= oOOQ[G27qG27qO9kQ!0LrOG27qO!(yQlO1G5QO':yQ`O7+,QO';RQ`O1G2jO&;rQ`OANBPOOQ[ANBPANBPO!&iQMhOANBPO';WQ`OANBPOOQ[ANBRANBRO9kQ!0LrOANBRO$#yQ`OANBROOQO'#H^'#H^OOQO7+*o7+*oOOQ[G22wG22wOOQ[ANE[ANE[OOQ[ANE]ANE]OOQ[ANBZANBZO';`Q`OANBZOOQ[<<MU<<MUO!(yQlOAN?jOOQOG24wG24wO$?{Q!0MxOG24wO#'cQ`OLD,pOOQ[LD,pLD,pO!&iQMhOLD,pO';eQ!fOLD,pO';lQ?MvO7+'yO'=bQ?MvO,5?_O'?eQ?MvO,5?aO'AhQ?MvO7+'{O'C^QMjOG27SOOQO<<M{<<M{OOQ!0LbANA[ANA[O$)iQ`OANA[OCfQ`OANA[O'CnQ!dOANA[OOQ!0LbANAYANAYO'CuQ`OANA[O!&iQMhOANA[O'DQQ!dOANA[OOQ!0LbANAZANAZOOQO<<N[<<N[OOQ[LD-]LD-]O'D[Q?MtO7+*lOOQO'#Ge'#GeOOQ[G27kG27kO&;rQ`OG27kO!&iQMhOG27kOOQ[G27mG27mO9kQ!0LrOG27mOOQ[G27uG27uO'DfQ?MtOG25UOOQOLD*cLD*cOOQ[!$(![!$(![O#'cQ`O!$(![O!&iQMhO!$(![O'DpQ!0MzOG27SOOQ!0LbG26vG26vO$)iQ`OG26vO'GRQ`OG26vOCfQ`OG26vO'G^Q!dOG26vO!&iQMhOG26vOOQ[LD-VLD-VO&;rQ`OLD-VOOQ[LD-XLD-XOOQ[!)9Ev!)9EvO#'cQ`O!)9EvOOQ!0LbLD,bLD,bO$)iQ`OLD,bOCfQ`OLD,bO'GeQ`OLD,bO'GpQ!dOLD,bOOQ[!$(!q!$(!qOOQ[!.K;b!.K;bO'GwQ?MvOG27SOOQ!0Lb!$( |!$( |O$)iQ`O!$( |OCfQ`O!$( |O'ImQ`O!$( |OOQ!0Lb!)9Eh!)9EhO$)iQ`O!)9EhOCfQ`O!)9EhOOQ!0Lb!.K;S!.K;SO$)iQ`O!.K;SOOQ!0Lb!4/0n!4/0nO!(yQlO'#DxO1PQ`O'#EVO'IxQ!fO'#JpO'JPQ!L^O'#DtO'JWQlO'#D|O'J_Q!fO'#CiO'LuQ!fO'#CiO!(yQlO'#EOO'MVQlO,5;XO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO'#InO( YQ`O,5<hO!(yQlO,5;cO( bQMhO,5;cO(!{QMhO,5;cO!(yQlO,5;vO!&iQMhO'#GlO( bQMhO'#GlO!&iQMhO'#GnO( bQMhO'#GnO1SQ`O'#DXO1SQ`O'#DXO!&iQMhO'#GOO( bQMhO'#GOO!&iQMhO'#GQO( bQMhO'#GQO!&iQMhO'#G`O( bQMhO'#G`O!(yQlO,5:hO(#SQpO'#D]O(#^QpO'#JtO!(yQlO,5@mO'MVQlO1G0sO(#hQ?MtO'#CiO!(yQlO1G2OO!&iQMhO'#IsO( bQMhO'#IsO!&iQMhO'#IuO( bQMhO'#IuO(#rQ!dO'#CrO!&iQMhO,5<sO( bQMhO,5<sO'MVQlO1G2QO!(yQlO7+&yO!&iQMhO1G2_O( bQMhO1G2_O!&iQMhO'#IsO( bQMhO'#IsO!&iQMhO'#IuO( bQMhO'#IuO!&iQMhO1G2aO( bQMhO1G2aO'MVQlO7+'lO'MVQlO7+&_O!&iQMhOANAhO( bQMhOANAhO($VQ`O'#EmO($[Q`O'#EmO($dQ`O'#F[O($iQ`O'#EwO($nQ`O'#KRO($yQ`O'#KPO(%UQ`O,5;XO(%ZQMjO,5<dO(%bQ`O'#GXO(%gQ`O'#GXO(%lQ`O,5<fO(%tQ`O,5;XO(%|Q?MtO1G1_O(&TQ`O,5<sO(&YQ`O,5<sO(&_Q`O,5<uO(&dQ`O,5<uO(&iQ`O1G2QO(&nQ`O1G0sO(&sQMjO<<K|O(&zQMjO<<K|O7eQMhO'#F{O9UQ`O'#FzOAdQ`O'#ElO!(yQlO,5;sO!3^Q`O'#GXO!3^Q`O'#GXO!3^Q`O'#GZO!3^Q`O'#GZO!+rQMhO7+(bO!+rQMhO7+(bO%-ZQ!dO1G2vO%-ZQ!dO1G2vO!&iQMhO,5=[O!&iQMhO,5=[",stateData:"((P~O'zOS'{OSTOS'|RQ~OPYOQYOSfOY!VOaqOdzOeyOj!POnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]XO!guO!jZO!mYO!nYO!oYO!qvO!swO!vxO!z]O$V|O$miO%g}O%i!QO%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO%x!UO&U!WO&[!XO&^!YO&`!ZO&b![O&e!]O&k!^O&q!_O&s!`O&u!aO&w!bO&y!cO(RSO(TTO(WUO(_VO(m[O~OWtO~P`OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oa!wOq!nO!Q!oO!`!yO!a!vO!b!vO!z;wO#R!pO#S!pO#T!xO#U!pO#V!pO#Y!zO#Z!zO(S!lO(TTO(WUO(c!mO(m!sO~O'|!{O~OP]XR]X[]Xa]Xp]X!O]X!Q]X!Z]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X'x]X(_]X(p]X(w]X(x]X~O!e%QX~P(qO_!}O(T#PO(U!}O(V#PO~O_#QO(V#PO(W#PO(X#QO~Ov#SO!S#TO(`#TO(a#VO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R;{O(TTO(WUO(_VO(m[O~O!Y#ZO!Z#WO!W(fP!W(tP~P+}O![#cO~P`OPYOQYOSfOd!jOe!iOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(TTO(WUO(_VO(m[O~On#mO!Y#iO!z]O#g#lO#h#iO(R;|O!i(qP~P.iO!j#oO(R#nO~O!v#sO!z]O%g#tO~O#i#uO~O!e#vO#i#uO~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!Z$_O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~Oa(dX'x(dX'u(dX!i(dX!W(dX!](dX%h(dX!e(dX~P1qO#Q$dO#^$eO$P$eOP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#t(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX!](eX%h(eX~Oa(eX'x(eX'u(eX!W(eX!i(eXt(eX!e(eX~P4UO#^$eO~O$[$hO$^$gO$e$mO~OSfO!]$nO$h$oO$j$qO~Oh%VOj%cOn%WOp%XOq$tOr$tOx%YOz%ZO|%[O!Q${O!]$|O!g%aO!j$xO#h%bO$V%_O$s%]O$u%^O$x%`O(R$sO(TTO(WUO(_$uO(w$}O(x%POg([P~O!j%dO~O!Q%gO!]%hO(R%fO~O!e%lO~Oa%mO'x%mO~O!O%qO~P%[O(S!lO~P%[O%m%uO~P%[Oh%VO!j%dO(R%fO(S!lO~Oe%|O!j%dO(R%fO~O#t$RO~O!O&RO!]&OO!j&QO%i&UO(R%fO(S!lO(TTO(WUO`)UP~O!v#sO~O%r&WO!Q)QX!])QX(R)QX~O(R&XO~Oj!PO!s&^O%i!QO%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO~Od&cOe&bO!v&`O%g&aO%z&_O~P<POd&fOeyOj!PO!]&eO!s&^O!vxO!z]O%g}O%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO%x!UO~Ob&iO#^&lO%i&gO(S!lO~P=UO!j&mO!s&qO~O!j#oO~O!]XO~Oa%mO'v&yO'x%mO~Oa%mO'v&|O'x%mO~Oa%mO'v'OO'x%mO~O'u]X!W]Xt]X!i]X&Y]X!]]X%h]X!e]X~P(qO!`']O!a'UO!b'UO(S!lO(TTO(WUO~Oq'SO!Q'RO!Y'VO(c'QO![(gP![(vP~P@]Ol'`O!]'^O(R%fO~Oe'eO!j%dO(R%fO~O!O&RO!j&QO~Oq!nO!Q!oO!z;wO#R!pO#S!pO#U!pO#V!pO(S!lO(TTO(WUO(c!mO(m!sO~O!`'kO!a'jO!b'jO#T!pO#Y'lO#Z'lO~PAwOa%mOh%VO!e#vO!j%dO'x%mO(p'nO~O!n'rO#^'pO~PCVOq!nO!Q!oO(TTO(WUO(c!mO(m!sO~O!]XOq(kX!Q(kX!`(kX!a(kX!b(kX!z(kX#R(kX#S(kX#T(kX#U(kX#V(kX#Y(kX#Z(kX(S(kX(T(kX(W(kX(c(kX(m(kX~O!a'jO!b'jO(S!lO~PCuO'}'vO(O'vO(P'xO~O_!}O(T'zO(U!}O(V'zO~O_#QO(V'zO(W'zO(X#QO~Ot'|O~P%[Ov#SO!S#TO(`#TO(a(PO~O!Y(RO!W'UX!W'[X!Z'UX!Z'[X~P+}O!Z(TO!W(fX~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!Z(TO!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~O!W(fX~PGpO!W(YO~O!W(sX!Z(sX!e(sX!i(sX(p(sX~O#^(sX#i#bX![(sX~PIsO#^(ZO!W(uX!Z(uX~O!Z([O!W(tX~O!W(_O~O#^$eO~PIsO![(`O~P`OR#zO!O#yO!Q#{O!j#xO(_VOP!la[!lap!la!Z!la!n!la#P!la#l!la#m!la#n!la#o!la#p!la#q!la#r!la#s!la#t!la#u!la#w!la#y!la#z!la(p!la(w!la(x!la~Oa!la'x!la'u!la!W!la!i!lat!la!]!la%h!la!e!la~PKZO!i(aO~O!e#vO#^(bO(p'nO!Z(rXa(rX'x(rX~O!i(rX~PMvO!Q%gO!]%hO!z]O#g(gO#h(fO(R%fO~O!Z(hO!i(qX~O!i(jO~O!Q%gO!]%hO#h(fO(R%fO~OP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#t(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX~O!e#vO!i(eX~P! dOR(lO!O(kO!j#xO#Q$dO!z!ya!Q!ya~O!v!ya%g!ya!]!ya#g!ya#h!ya(R!ya~P!#eO!v(pO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]XO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~O#i(vO~O!Y(xO!i(iP~P%[O(c(zO(m[O~O!Q(|O!j#xO(c(zO(m[O~OP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]!eO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(R)ZO(TTO(WUO(_VO(m[O~O!Z$_Oa$pa'x$pa'u$pa!i$pa!W$pa!]$pa%h$pa!e$pa~Oj)bO~P!&iOh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|%[O!Q${O!]$|O!g%aO!j$xO#h%bO$V%_O$s%]O$u%^O$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~Og(nP~P!+rO!O)gO!e)fO!]$]X$Y$]X$[$]X$^$]X$e$]X~O!e)fO!](yX$Y(yX$[(yX$^(yX$e(yX~O!O)gO~P!-{O!O)gO!](yX$Y(yX$[(yX$^(yX$e(yX~O!])iO$Y)mO$[)hO$^)hO$e)nO~O!Y)qO~P!(yO$[$hO$^$gO$e)uO~Ol$yX!O$yX#Q$yX'w$yX(w$yX(x$yX~OgkXg$yXlkX!ZkX#^kX~P!/qOv)wO(`)xO(a)zO~Ol*TO!O)|O'w)}O(w$}O(x%PO~Og){O~P!0uOg*UO~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q*WO!]*XO!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(TTO(WUO(_$uO(w$}O(x%PO~O!Y*[O(R*VO!i(|P~P!1dO#i*^O~O!j*_O~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(R*aO(TTO(WUO(_$uO(w$}O(x%PO~O!Y*dO!W(}P~P!3cOp*pOq!nO!Q*fO!`*nO!a*hO!b*hO!j*_O#Y*oO%_*jO(S!lO(TTO(WUO(c!mO~O![*mO~P!5WO#Q$dOl(^X!O(^X'w(^X(w(^X(x(^X!Z(^X#^(^X~Og(^X#}(^X~P!6YOl*uO#^*tOg(]X!Z(]X~O!Z*vOg([X~Oj%cO(R&XOg([P~Oq*yO~O!j+OO~O(R(tO~On+TO!Q%gO!Y#iO!]%hO!z]O#g#lO#h#iO(R%fO!i(qP~O!e#vO#i+UO~O!Q%gO!Y+WO!Z([O!]%hO(R%fO!W(tP~Oq'YO!Q+YO!Y+XO(TTO(WUO(c(zO~O![(vP~P!9]O!Z+ZOa)RX'x)RX~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~Oa!ha!Z!ha'x!ha'u!ha!W!ha!i!hat!ha!]!ha%h!ha!e!ha~P!:TOR#zO!O#yO!Q#{O!j#xO(_VOP!pa[!pap!pa!Z!pa!n!pa#P!pa#l!pa#m!pa#n!pa#o!pa#p!pa#q!pa#r!pa#s!pa#t!pa#u!pa#w!pa#y!pa#z!pa(p!pa(w!pa(x!pa~Oa!pa'x!pa'u!pa!W!pa!i!pat!pa!]!pa%h!pa!e!pa~P!<kOR#zO!O#yO!Q#{O!j#xO(_VOP!ra[!rap!ra!Z!ra!n!ra#P!ra#l!ra#m!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#w!ra#y!ra#z!ra(p!ra(w!ra(x!ra~Oa!ra'x!ra'u!ra!W!ra!i!rat!ra!]!ra%h!ra!e!ra~P!?ROh%VOl+dO!]'^O%h+cO~O!e+fOa(ZX!](ZX'x(ZX!Z(ZX~Oa%mO!]XO'x%mO~Oh%VO!j%dO~Oh%VO!j%dO(R%fO~O!e#vO#i(vO~Ob+qO%i+rO(R+nO(TTO(WUO![)VP~O!Z+sO`)UX~O[+wO~O`+xO~O!]&OO(R%fO(S!lO`)UP~Oh%VO#^+}O~Oh%VOl,QO!]$|O~O!],SO~O!O,UO!]XO~O%m%uO~O!v,ZO~Oe,`O~Ob,aO(R#nO(TTO(WUO![)TP~Oe%|O~O%i!QO(R&XO~P=UO[,fO`,eO~OPYOQYOSfOdzOeyOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!guO!jZO!mYO!nYO!oYO!qvO!vxO!z]O$miO%g}O(TTO(WUO(_VO(m[O~O!]!eO!s!gO$V!kO(R!dO~P!FRO`,eOa%mO'x%mO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oa,kOj!OO!swO%k!OO%l!OO%m!OO~P!HkO!j&mO~O&[,qO~O!],sO~O&m,uO&o,vOP&jaQ&jaS&jaY&jaa&jad&jae&jaj&jan&jap&jaq&jar&jax&jaz&ja|&ja!Q&ja!U&ja!V&ja!]&ja!g&ja!j&ja!m&ja!n&ja!o&ja!q&ja!s&ja!v&ja!z&ja$V&ja$m&ja%g&ja%i&ja%k&ja%l&ja%m&ja%p&ja%r&ja%u&ja%v&ja%x&ja&U&ja&[&ja&^&ja&`&ja&b&ja&e&ja&k&ja&q&ja&s&ja&u&ja&w&ja&y&ja'u&ja(R&ja(T&ja(W&ja(_&ja(m&ja![&ja&c&jab&ja&h&ja~O(R,{O~Oh!cX!Z!PX![!PX!e!PX!e!cX!j!cX#^!PX~O!Z!cX![!cX~P# qO!e-QO#^-POh(hX!Z#fX![#fX!e(hX!j(hX~O!Z(hX![(hX~P#!dOh%VO!e-SO!j%dO!Z!_X![!_X~Oq!nO!Q!oO(TTO(WUO(c!mO~OP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]!eO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(TTO(WUO(_VO(m[O~O(R<rO~P##yO!Z-WO![(gX~O![-YO~O!e-QO#^-PO!Z#fX![#fX~O!Z-ZO![(vX~O![-]O~O!a-^O!b-^O(S!lO~P##hO![-aO~P'_Ol-dO!]'^O~O!W-iO~Oq!ya!`!ya!a!ya!b!ya#R!ya#S!ya#T!ya#U!ya#V!ya#Y!ya#Z!ya(S!ya(T!ya(W!ya(c!ya(m!ya~P!#eO!n-nO#^-lO~PCVO!a-pO!b-pO(S!lO~PCuOa%mO#^-lO'x%mO~Oa%mO!e#vO#^-lO'x%mO~Oa%mO!e#vO!n-nO#^-lO'x%mO(p'nO~O'}'vO(O'vO(P-uO~Ot-vO~O!W'Ua!Z'Ua~P!:TO!Y-zO!W'UX!Z'UX~P%[O!Z(TO!W(fa~O!W(fa~PGpO!Z([O!W(ta~O!Q%gO!Y.OO!]%hO(R%fO!W'[X!Z'[X~O#^.QO!Z(ra!i(raa(ra'x(ra~O!e#vO~P#,PO!Z(hO!i(qa~O!Q%gO!]%hO#h.UO(R%fO~On.ZO!Q%gO!Y.WO!]%hO!z]O#g.YO#h.WO(R%fO!Z'_X!i'_X~OR._O!j#xO~Oh%VOl.bO!]'^O%h.aO~Oa#ai!Z#ai'x#ai'u#ai!W#ai!i#ait#ai!]#ai%h#ai!e#ai~P!:TOl=|O!O)|O'w)}O(w$}O(x%PO~O#i#]aa#]a#^#]a'x#]a!Z#]a!i#]a!]#]a!W#]a~P#.{O#i(^XP(^XR(^X[(^Xa(^Xp(^X!Q(^X!j(^X!n(^X#P(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#s(^X#t(^X#u(^X#w(^X#y(^X#z(^X'x(^X(_(^X(p(^X!i(^X!W(^X'u(^Xt(^X!](^X%h(^X!e(^X~P!6YO!Z.oO!i(iX~P!:TO!i.rO~O!W.tO~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O(_VO[#kia#kip#ki!Z#ki#P#ki#m#ki#n#ki#o#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#l#ki~P#2kO#l$OO~P#2kOP$[OR#zOp$aO!O#yO!Q#{O!j#xO!n$[O#l$OO#m$PO#n$PO#o$PO(_VO[#kia#ki!Z#ki#P#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#p#ki~P#5YO#p$QO~P#5YOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO(_VOa#ki!Z#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#u#ki~P#7wOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO(_VO(x#}Oa#ki!Z#ki#y#ki#z#ki'x#ki(p#ki(w#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#w$UO~P#:_O#w#ki~P#:_O#u$SO~P#7wOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO(_VO(w#|O(x#}Oa#ki!Z#ki#z#ki'x#ki(p#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#y#ki~P#=TO#y$WO~P#=TOP]XR]X[]Xp]X!O]X!Q]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X!Z]X![]X~O#}]X~P#?rOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO#w<VO#y<XO#z<YO(_VO(p$YO(w#|O(x#}O~O#}.vO~P#BPO#Q$dO#^<`O$P<`O#}(eX![(eX~P! dOa'ba!Z'ba'x'ba'u'ba!i'ba!W'bat'ba!]'ba%h'ba!e'ba~P!:TO[#kia#kip#ki!Z#ki#P#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O#l$OO#m$PO#n$PO#o$PO(_VO(w#ki(x#ki~P#EROl=|O!O)|O'w)}O(w$}O(x%POP#kiR#ki!Q#ki!j#ki!n#ki#l#ki#m#ki#n#ki#o#ki(_#ki~P#ERO!Z.zOg(nX~P!0uOg.|O~Oa$Oi!Z$Oi'x$Oi'u$Oi!W$Oi!i$Oit$Oi!]$Oi%h$Oi!e$Oi~P!:TO$[.}O$^.}O~O$[/OO$^/OO~O!e)fO#^/PO!]$bX$Y$bX$[$bX$^$bX$e$bX~O!Y/QO~O!])iO$Y/SO$[)hO$^)hO$e/TO~O!Z<ZO![(dX~P#BPO![/UO~O!e)fO$e(yX~O$e/WO~Ot/XO~P!&iOv)wO(`)xO(a/[O~O!Q/_O~O(w$}Ol%`a!O%`a'w%`a(x%`a!Z%`a#^%`a~Og%`a#}%`a~P#LTO(x%POl%ba!O%ba'w%ba(w%ba!Z%ba#^%ba~Og%ba#}%ba~P#LvO!ZfX!efX!ifX!i$yX(pfX~P!/qO!Y/hO!Z([O(R/gO!W(tP!W(}P~P!1dOp*pO!`*nO!a*hO!b*hO!j*_O#Y*oO%_*jO(S!lO(TTO(WUO~Oq<oO!Q/iO!Y+XO![*mO(c<nO![(vP~P#NaO!i/jO~P#.{O!Z/kO!e#vO(p'nO!i(|X~O!i/pO~O!Q%gO!Y*[O!]%hO(R%fO!i(|P~O#i/rO~O!W$yX!Z$yX!e%QX~P!/qO!Z/sO!W(}X~P#.{O!e/uO~O!W/wO~OnkO(R/xO~P.iOh%VOp/}O!e#vO!j%dO(p'nO~O!e+fO~Oa%mO!Z0RO'x%mO~O![0TO~P!5WO!a0UO!b0UO(S!lO~P##hOq!nO!Q0VO(TTO(WUO(c!mO~O#Y0XO~Og%`a!Z%`a#^%`a#}%`a~P!0uOg%ba!Z%ba#^%ba#}%ba~P!0uOj%cO(R&XOg'kX!Z'kX~O!Z*vOg([a~Og0bO~OR0cO!O0cO!Q0dO#Q$dOl{a'w{a(w{a(x{a!Z{a#^{a~Og{a#}{a~P$&dO!O)|O'w)}Ol$ra(w$ra(x$ra!Z$ra#^$ra~Og$ra#}$ra~P$'`O!O)|O'w)}Ol$ta(w$ta(x$ta!Z$ta#^$ta~Og$ta#}$ta~P$(RO#i0gO~Og%Sa!Z%Sa#^%Sa#}%Sa~P!0uOl0iO#^0hOg(]a!Z(]a~O!e#vO~O#i0lO~O!Z+ZOa)Ra'x)Ra~OR#zO!O#yO!Q#{O!j#xO(_VOP!pi[!pip!pi!Z!pi!n!pi#P!pi#l!pi#m!pi#n!pi#o!pi#p!pi#q!pi#r!pi#s!pi#t!pi#u!pi#w!pi#y!pi#z!pi(p!pi(w!pi(x!pi~Oa!pi'x!pi'u!pi!W!pi!i!pit!pi!]!pi%h!pi!e!pi~P$*OOh%VOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(TTO(WUO(_$uO(w$}O(x%PO~On0vO%[0wO(R0tO~P$,fO!e+fOa(Za!](Za'x(Za!Z(Za~O#i0|O~O[]X!ZfX![fX~O!Z0}O![)VX~O![1PO~O[1QO~Ob1SO(R+nO(TTO(WUO~O!]&OO(R%fO`'sX!Z'sX~O!Z+sO`)Ua~O!i1VO~P!:TO[1YO~O`1ZO~O#^1^O~Ol1aO!]$|O~O(c(zO![)SP~Oh%VOl1jO!]1gO%h1iO~O[1tO!Z1rO![)TX~O![1uO~O`1wOa%mO'x%mO~O(R#nO(TTO(WUO~O#Q$dO#^$eO$P$eOP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX~O#t1zO&Y1{Oa(eX~P$2PO#^$eO#t1zO&Y1{O~Oa1}O~P%[Oa2PO~O&c2SOP&aiQ&aiS&aiY&aia&aid&aie&aij&ain&aip&aiq&air&aix&aiz&ai|&ai!Q&ai!U&ai!V&ai!]&ai!g&ai!j&ai!m&ai!n&ai!o&ai!q&ai!s&ai!v&ai!z&ai$V&ai$m&ai%g&ai%i&ai%k&ai%l&ai%m&ai%p&ai%r&ai%u&ai%v&ai%x&ai&U&ai&[&ai&^&ai&`&ai&b&ai&e&ai&k&ai&q&ai&s&ai&u&ai&w&ai&y&ai'u&ai(R&ai(T&ai(W&ai(_&ai(m&ai![&aib&ai&h&ai~Ob2YO![2WO&h2XO~P`O!]XO!j2[O~O&o,vOP&jiQ&jiS&jiY&jia&jid&jie&jij&jin&jip&jiq&jir&jix&jiz&ji|&ji!Q&ji!U&ji!V&ji!]&ji!g&ji!j&ji!m&ji!n&ji!o&ji!q&ji!s&ji!v&ji!z&ji$V&ji$m&ji%g&ji%i&ji%k&ji%l&ji%m&ji%p&ji%r&ji%u&ji%v&ji%x&ji&U&ji&[&ji&^&ji&`&ji&b&ji&e&ji&k&ji&q&ji&s&ji&u&ji&w&ji&y&ji'u&ji(R&ji(T&ji(W&ji(_&ji(m&ji![&ji&c&jib&ji&h&ji~O!W2bO~O!Z!_a![!_a~P#BPOq!nO!Q!oO!Y2hO(c!mO!Z'VX!['VX~P@]O!Z-WO![(ga~O!Z']X![']X~P!9]O!Z-ZO![(va~O![2oO~P'_Oa%mO#^2xO'x%mO~Oa%mO!e#vO#^2xO'x%mO~Oa%mO!e#vO!n2|O#^2xO'x%mO(p'nO~Oa%mO'x%mO~P!:TO!Z$_Ot$pa~O!W'Ui!Z'Ui~P!:TO!Z(TO!W(fi~O!Z([O!W(ti~O!W(ui!Z(ui~P!:TO!Z(ri!i(ria(ri'x(ri~P!:TO#^3OO!Z(ri!i(ria(ri'x(ri~O!Z(hO!i(qi~O!Q%gO!]%hO!z]O#g3TO#h3SO(R%fO~O!Q%gO!]%hO#h3SO(R%fO~Ol3[O!]'^O%h3ZO~Oh%VOl3[O!]'^O%h3ZO~O#i%`aP%`aR%`a[%`aa%`ap%`a!Q%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a'x%`a(_%`a(p%`a!i%`a!W%`a'u%`at%`a!]%`a%h%`a!e%`a~P#LTO#i%baP%baR%ba[%baa%bap%ba!Q%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba'x%ba(_%ba(p%ba!i%ba!W%ba'u%bat%ba!]%ba%h%ba!e%ba~P#LvO#i%`aP%`aR%`a[%`aa%`ap%`a!Q%`a!Z%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a'x%`a(_%`a(p%`a!i%`a!W%`a'u%`a#^%`at%`a!]%`a%h%`a!e%`a~P#.{O#i%baP%baR%ba[%baa%bap%ba!Q%ba!Z%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba'x%ba(_%ba(p%ba!i%ba!W%ba'u%ba#^%bat%ba!]%ba%h%ba!e%ba~P#.{O#i{aP{a[{aa{ap{a!j{a!n{a#P{a#l{a#m{a#n{a#o{a#p{a#q{a#r{a#s{a#t{a#u{a#w{a#y{a#z{a'x{a(_{a(p{a!i{a!W{a'u{at{a!]{a%h{a!e{a~P$&dO#i$raP$raR$ra[$raa$rap$ra!Q$ra!j$ra!n$ra#P$ra#l$ra#m$ra#n$ra#o$ra#p$ra#q$ra#r$ra#s$ra#t$ra#u$ra#w$ra#y$ra#z$ra'x$ra(_$ra(p$ra!i$ra!W$ra'u$rat$ra!]$ra%h$ra!e$ra~P$'`O#i$taP$taR$ta[$taa$tap$ta!Q$ta!j$ta!n$ta#P$ta#l$ta#m$ta#n$ta#o$ta#p$ta#q$ta#r$ta#s$ta#t$ta#u$ta#w$ta#y$ta#z$ta'x$ta(_$ta(p$ta!i$ta!W$ta'u$tat$ta!]$ta%h$ta!e$ta~P$(RO#i%SaP%SaR%Sa[%Saa%Sap%Sa!Q%Sa!Z%Sa!j%Sa!n%Sa#P%Sa#l%Sa#m%Sa#n%Sa#o%Sa#p%Sa#q%Sa#r%Sa#s%Sa#t%Sa#u%Sa#w%Sa#y%Sa#z%Sa'x%Sa(_%Sa(p%Sa!i%Sa!W%Sa'u%Sa#^%Sat%Sa!]%Sa%h%Sa!e%Sa~P#.{Oa#aq!Z#aq'x#aq'u#aq!W#aq!i#aqt#aq!]#aq%h#aq!e#aq~P!:TO!Y3dO!Z'WX!i'WX~P%[O!Z.oO!i(ia~O!Z.oO!i(ia~P!:TO!W3gO~O#}!la![!la~PKZO#}!ha!Z!ha![!ha~P#BPO#}!pa![!pa~P!<kO#}!ra![!ra~P!?ROg'ZX!Z'ZX~P!+rO!Z.zOg(na~OSfO!]3{O$c3|O~O![4QO~Ot4RO~P#.{Oa$lq!Z$lq'x$lq'u$lq!W$lq!i$lqt$lq!]$lq%h$lq!e$lq~P!:TO!W4TO~P!&iO!Q4UO~O!O)|O'w)}O(x%POl'ga(w'ga!Z'ga#^'ga~Og'ga#}'ga~P%+uO!O)|O'w)}Ol'ia(w'ia(x'ia!Z'ia#^'ia~Og'ia#}'ia~P%,hO(p$YO~P#.{O!WfX!W$yX!ZfX!Z$yX!e%QX#^fX~P!/qO(R<xO~P!1dO!Q%gO!Y4XO!]%hO(R%fO!Z'cX!i'cX~O!Z/kO!i(|a~O!Z/kO!e#vO!i(|a~O!Z/kO!e#vO(p'nO!i(|a~Og${i!Z${i#^${i#}${i~P!0uO!Y4aO!W'eX!Z'eX~P!3cO!Z/sO!W(}a~O!Z/sO!W(}a~P#.{OP]XR]X[]Xp]X!O]X!Q]X!W]X!Z]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X~O!e%XX#t%XX~P%0XO!e#vO#t4fO~Oh%VO!e#vO!j%dO~Oh%VOp4kO!j%dO(p'nO~Op4pO!e#vO(p'nO~Oq!nO!Q4qO(TTO(WUO(c!mO~O(w$}Ol%`i!O%`i'w%`i(x%`i!Z%`i#^%`i~Og%`i#}%`i~P%3xO(x%POl%bi!O%bi'w%bi(w%bi!Z%bi#^%bi~Og%bi#}%bi~P%4kOg(]i!Z(]i~P!0uO#^4wOg(]i!Z(]i~P!0uO!i4zO~Oa$nq!Z$nq'x$nq'u$nq!W$nq!i$nqt$nq!]$nq%h$nq!e$nq~P!:TO!W5QO~O!Z5RO!])OX~P#.{Oa]Xa$yX!]]X!]$yX%]]X'x]X'x$yX!Z]X!Z$yX~P!/qO%]5UOa%Za!]%Za'x%Za!Z%Za~OlmX!OmX'wmX(wmX(xmX~P%7nOn5VO(R#nO~Ob5]O%i5^O(R+nO(TTO(WUO!Z'rX!['rX~O!Z0}O![)Va~O[5bO~O`5cO~Oa%mO'x%mO~P#.{O!Z5kO#^5mO![)SX~O![5nO~Op5tOq!nO!Q*fO!`!yO!a!vO!b!vO!z;wO#R!pO#S!pO#T!pO#U!pO#V!pO#Y5sO#Z!zO(S!lO(TTO(WUO(c!mO(m!sO~O![5rO~P%:ROl5yO!]1gO%h5xO~Oh%VOl5yO!]1gO%h5xO~Ob6QO(R#nO(TTO(WUO!Z'qX!['qX~O!Z1rO![)Ta~O(TTO(WUO(c6SO~O`6WO~O#t6ZO&Y6[O~PMvO!i6]O~P%[Oa6_O~Oa6_O~P%[Ob2YO![6dO&h2XO~P`O!e6fO~O!e6hOh(hi!Z(hi![(hi!e(hi!j(hip(hi(p(hi~O!Z#fi![#fi~P#BPO#^6iO!Z#fi![#fi~O!Z!_i![!_i~P#BPOa%mO#^6rO'x%mO~Oa%mO!e#vO#^6rO'x%mO~O!Z(rq!i(rqa(rq'x(rq~P!:TO!Z(hO!i(qq~O!Q%gO!]%hO#h6yO(R%fO~O!]'^O%h6|O~Ol7QO!]'^O%h6|O~O#i'gaP'gaR'ga['gaa'gap'ga!Q'ga!j'ga!n'ga#P'ga#l'ga#m'ga#n'ga#o'ga#p'ga#q'ga#r'ga#s'ga#t'ga#u'ga#w'ga#y'ga#z'ga'x'ga(_'ga(p'ga!i'ga!W'ga'u'gat'ga!]'ga%h'ga!e'ga~P%+uO#i'iaP'iaR'ia['iaa'iap'ia!Q'ia!j'ia!n'ia#P'ia#l'ia#m'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#w'ia#y'ia#z'ia'x'ia(_'ia(p'ia!i'ia!W'ia'u'iat'ia!]'ia%h'ia!e'ia~P%,hO#i${iP${iR${i[${ia${ip${i!Q${i!Z${i!j${i!n${i#P${i#l${i#m${i#n${i#o${i#p${i#q${i#r${i#s${i#t${i#u${i#w${i#y${i#z${i'x${i(_${i(p${i!i${i!W${i'u${i#^${it${i!]${i%h${i!e${i~P#.{O#i%`iP%`iR%`i[%`ia%`ip%`i!Q%`i!j%`i!n%`i#P%`i#l%`i#m%`i#n%`i#o%`i#p%`i#q%`i#r%`i#s%`i#t%`i#u%`i#w%`i#y%`i#z%`i'x%`i(_%`i(p%`i!i%`i!W%`i'u%`it%`i!]%`i%h%`i!e%`i~P%3xO#i%biP%biR%bi[%bia%bip%bi!Q%bi!j%bi!n%bi#P%bi#l%bi#m%bi#n%bi#o%bi#p%bi#q%bi#r%bi#s%bi#t%bi#u%bi#w%bi#y%bi#z%bi'x%bi(_%bi(p%bi!i%bi!W%bi'u%bit%bi!]%bi%h%bi!e%bi~P%4kO!Z'Wa!i'Wa~P!:TO!Z.oO!i(ii~O#}#ai!Z#ai![#ai~P#BPOP$[OR#zO!O#yO!Q#{O!j#xO!n$[O(_VO[#kip#ki#P#ki#m#ki#n#ki#o#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#l#ki~P%MQO#l<PO~P%MQOP$[OR#zOp<]O!O#yO!Q#{O!j#xO!n$[O#l<PO#m<QO#n<QO#o<QO(_VO[#ki#P#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#p#ki~P& YO#p<RO~P& YOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO(_VO#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#u#ki~P&#bOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO(_VO(x#}O#y#ki#z#ki#}#ki(p#ki(w#ki!Z#ki![#ki~O#w<VO~P&%cO#w#ki~P&%cO#u<TO~P&#bOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO#w<VO(_VO(w#|O(x#}O#z#ki#}#ki(p#ki!Z#ki![#ki~O#y#ki~P&'rO#y<XO~P&'rOa#{y!Z#{y'x#{y'u#{y!W#{y!i#{yt#{y!]#{y%h#{y!e#{y~P!:TO[#kip#ki#P#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki!Z#ki![#ki~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O#l<PO#m<QO#n<QO#o<QO(_VO(w#ki(x#ki~P&*nOl=}O!O)|O'w)}O(w$}O(x%POP#kiR#ki!Q#ki!j#ki!n#ki#l#ki#m#ki#n#ki#o#ki(_#ki~P&*nO#Q$dOP(^XR(^X[(^Xl(^Xp(^X!O(^X!Q(^X!j(^X!n(^X#P(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#s(^X#t(^X#u(^X#w(^X#y(^X#z(^X#}(^X'w(^X(_(^X(p(^X(w(^X(x(^X!Z(^X![(^X~O#}$Oi!Z$Oi![$Oi~P#BPO#}!pi![!pi~P$*OOg'Za!Z'Za~P!0uO![7dO~O!Z'ba!['ba~P#BPO!W7eO~P#.{O!e#vO(p'nO!Z'ca!i'ca~O!Z/kO!i(|i~O!Z/kO!e#vO!i(|i~Og${q!Z${q#^${q#}${q~P!0uO!W'ea!Z'ea~P#.{O!e7lO~O!Z/sO!W(}i~P#.{O!Z/sO!W(}i~O!W7oO~Oh%VOp7tO!j%dO(p'nO~O!e#vO#t7vO~Op7yO!e#vO(p'nO~O!O)|O'w)}O(x%POl'ha(w'ha!Z'ha#^'ha~Og'ha#}'ha~P&3oO!O)|O'w)}Ol'ja(w'ja(x'ja!Z'ja#^'ja~Og'ja#}'ja~P&4bO!W7{O~Og$}q!Z$}q#^$}q#}$}q~P!0uOg(]q!Z(]q~P!0uO#^7|Og(]q!Z(]q~P!0uOa$ny!Z$ny'x$ny'u$ny!W$ny!i$nyt$ny!]$ny%h$ny!e$ny~P!:TO!e6hO~O!Z5RO!])Oa~O!]'^OP$SaR$Sa[$Sap$Sa!O$Sa!Q$Sa!Z$Sa!j$Sa!n$Sa#P$Sa#l$Sa#m$Sa#n$Sa#o$Sa#p$Sa#q$Sa#r$Sa#s$Sa#t$Sa#u$Sa#w$Sa#y$Sa#z$Sa(_$Sa(p$Sa(w$Sa(x$Sa~O%h6|O~P&7SO%]8QOa%Zi!]%Zi'x%Zi!Z%Zi~Oa#ay!Z#ay'x#ay'u#ay!W#ay!i#ayt#ay!]#ay%h#ay!e#ay~P!:TO[8SO~Ob8UO(R+nO(TTO(WUO~O!Z0}O![)Vi~O`8YO~O(c(zO!Z'nX!['nX~O!Z5kO![)Sa~O![8cO~P%:RO(m!sO~P$$oO#Y8dO~O!]1gO~O!]1gO%h8fO~Ol8iO!]1gO%h8fO~O[8nO!Z'qa!['qa~O!Z1rO![)Ti~O!i8rO~O!i8sO~O!i8vO~O!i8vO~P%[Oa8xO~O!e8yO~O!i8zO~O!Z(ui![(ui~P#BPOa%mO#^9SO'x%mO~O!Z(ry!i(rya(ry'x(ry~P!:TO!Z(hO!i(qy~O%h9VO~P&7SO!]'^O%h9VO~O#i${qP${qR${q[${qa${qp${q!Q${q!Z${q!j${q!n${q#P${q#l${q#m${q#n${q#o${q#p${q#q${q#r${q#s${q#t${q#u${q#w${q#y${q#z${q'x${q(_${q(p${q!i${q!W${q'u${q#^${qt${q!]${q%h${q!e${q~P#.{O#i'haP'haR'ha['haa'hap'ha!Q'ha!j'ha!n'ha#P'ha#l'ha#m'ha#n'ha#o'ha#p'ha#q'ha#r'ha#s'ha#t'ha#u'ha#w'ha#y'ha#z'ha'x'ha(_'ha(p'ha!i'ha!W'ha'u'hat'ha!]'ha%h'ha!e'ha~P&3oO#i'jaP'jaR'ja['jaa'jap'ja!Q'ja!j'ja!n'ja#P'ja#l'ja#m'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#w'ja#y'ja#z'ja'x'ja(_'ja(p'ja!i'ja!W'ja'u'jat'ja!]'ja%h'ja!e'ja~P&4bO#i$}qP$}qR$}q[$}qa$}qp$}q!Q$}q!Z$}q!j$}q!n$}q#P$}q#l$}q#m$}q#n$}q#o$}q#p$}q#q$}q#r$}q#s$}q#t$}q#u$}q#w$}q#y$}q#z$}q'x$}q(_$}q(p$}q!i$}q!W$}q'u$}q#^$}qt$}q!]$}q%h$}q!e$}q~P#.{O!Z'Wi!i'Wi~P!:TO#}#aq!Z#aq![#aq~P#BPO(w$}OP%`aR%`a[%`ap%`a!Q%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a#}%`a(_%`a(p%`a!Z%`a![%`a~Ol%`a!O%`a'w%`a(x%`a~P&HgO(x%POP%baR%ba[%bap%ba!Q%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba#}%ba(_%ba(p%ba!Z%ba![%ba~Ol%ba!O%ba'w%ba(w%ba~P&JnOl=}O!O)|O'w)}O(x%PO~P&HgOl=}O!O)|O'w)}O(w$}O~P&JnOR0cO!O0cO!Q0dO#Q$dOP{a[{al{ap{a!j{a!n{a#P{a#l{a#m{a#n{a#o{a#p{a#q{a#r{a#s{a#t{a#u{a#w{a#y{a#z{a#}{a'w{a(_{a(p{a(w{a(x{a!Z{a![{a~O!O)|O'w)}OP$raR$ra[$ral$rap$ra!Q$ra!j$ra!n$ra#P$ra#l$ra#m$ra#n$ra#o$ra#p$ra#q$ra#r$ra#s$ra#t$ra#u$ra#w$ra#y$ra#z$ra#}$ra(_$ra(p$ra(w$ra(x$ra!Z$ra![$ra~O!O)|O'w)}OP$taR$ta[$tal$tap$ta!Q$ta!j$ta!n$ta#P$ta#l$ta#m$ta#n$ta#o$ta#p$ta#q$ta#r$ta#s$ta#t$ta#u$ta#w$ta#y$ta#z$ta#}$ta(_$ta(p$ta(w$ta(x$ta!Z$ta![$ta~Ol=}O!O)|O'w)}O(w$}O(x%PO~OP%SaR%Sa[%Sap%Sa!Q%Sa!j%Sa!n%Sa#P%Sa#l%Sa#m%Sa#n%Sa#o%Sa#p%Sa#q%Sa#r%Sa#s%Sa#t%Sa#u%Sa#w%Sa#y%Sa#z%Sa#}%Sa(_%Sa(p%Sa!Z%Sa![%Sa~P'%sO#}$lq!Z$lq![$lq~P#BPO#}$nq!Z$nq![$nq~P#BPO![9dO~O#}9eO~P!0uO!e#vO!Z'ci!i'ci~O!e#vO(p'nO!Z'ci!i'ci~O!Z/kO!i(|q~O!W'ei!Z'ei~P#.{O!Z/sO!W(}q~Op9lO!e#vO(p'nO~O[9nO!W9mO~P#.{O!W9mO~O!e#vO#t9tO~Og(]y!Z(]y~P!0uO!Z'la!]'la~P#.{Oa%Zq!]%Zq'x%Zq!Z%Zq~P#.{O[9yO~O!Z0}O![)Vq~O#^9}O!Z'na!['na~O!Z5kO![)Si~P#BPO!Q:PO~O!]1gO%h:SO~O(TTO(WUO(c:XO~O!Z1rO![)Tq~O!i:[O~O!i:]O~O!i:^O~O!i:^O~P%[O#^:aO!Z#fy![#fy~O!Z#fy![#fy~P#BPO%h:fO~P&7SO!]'^O%h:fO~O#}#{y!Z#{y![#{y~P#BPOP${iR${i[${ip${i!Q${i!j${i!n${i#P${i#l${i#m${i#n${i#o${i#p${i#q${i#r${i#s${i#t${i#u${i#w${i#y${i#z${i#}${i(_${i(p${i!Z${i![${i~P'%sO!O)|O'w)}O(x%POP'gaR'ga['gal'gap'ga!Q'ga!j'ga!n'ga#P'ga#l'ga#m'ga#n'ga#o'ga#p'ga#q'ga#r'ga#s'ga#t'ga#u'ga#w'ga#y'ga#z'ga#}'ga(_'ga(p'ga(w'ga!Z'ga!['ga~O!O)|O'w)}OP'iaR'ia['ial'iap'ia!Q'ia!j'ia!n'ia#P'ia#l'ia#m'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#w'ia#y'ia#z'ia#}'ia(_'ia(p'ia(w'ia(x'ia!Z'ia!['ia~O(w$}OP%`iR%`i[%`il%`ip%`i!O%`i!Q%`i!j%`i!n%`i#P%`i#l%`i#m%`i#n%`i#o%`i#p%`i#q%`i#r%`i#s%`i#t%`i#u%`i#w%`i#y%`i#z%`i#}%`i'w%`i(_%`i(p%`i(x%`i!Z%`i![%`i~O(x%POP%biR%bi[%bil%bip%bi!O%bi!Q%bi!j%bi!n%bi#P%bi#l%bi#m%bi#n%bi#o%bi#p%bi#q%bi#r%bi#s%bi#t%bi#u%bi#w%bi#y%bi#z%bi#}%bi'w%bi(_%bi(p%bi(w%bi!Z%bi![%bi~O#}$ny!Z$ny![$ny~P#BPO#}#ay!Z#ay![#ay~P#BPO!e#vO!Z'cq!i'cq~O!Z/kO!i(|y~O!W'eq!Z'eq~P#.{Op:pO!e#vO(p'nO~O[:tO!W:sO~P#.{O!W:sO~Og(]!R!Z(]!R~P!0uOa%Zy!]%Zy'x%Zy!Z%Zy~P#.{O!Z0}O![)Vy~O!Z5kO![)Sq~O(R:zO~O!]1gO%h:}O~O!i;QO~O%h;VO~P&7SOP${qR${q[${qp${q!Q${q!j${q!n${q#P${q#l${q#m${q#n${q#o${q#p${q#q${q#r${q#s${q#t${q#u${q#w${q#y${q#z${q#}${q(_${q(p${q!Z${q![${q~P'%sO!O)|O'w)}O(x%POP'haR'ha['hal'hap'ha!Q'ha!j'ha!n'ha#P'ha#l'ha#m'ha#n'ha#o'ha#p'ha#q'ha#r'ha#s'ha#t'ha#u'ha#w'ha#y'ha#z'ha#}'ha(_'ha(p'ha(w'ha!Z'ha!['ha~O!O)|O'w)}OP'jaR'ja['jal'jap'ja!Q'ja!j'ja!n'ja#P'ja#l'ja#m'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#w'ja#y'ja#z'ja#}'ja(_'ja(p'ja(w'ja(x'ja!Z'ja!['ja~OP$}qR$}q[$}qp$}q!Q$}q!j$}q!n$}q#P$}q#l$}q#m$}q#n$}q#o$}q#p$}q#q$}q#r$}q#s$}q#t$}q#u$}q#w$}q#y$}q#z$}q#}$}q(_$}q(p$}q!Z$}q![$}q~P'%sOg%d!Z!Z%d!Z#^%d!Z#}%d!Z~P!0uO!W;ZO~P#.{Op;[O!e#vO(p'nO~O[;^O!W;ZO~P#.{O!Z'nq!['nq~P#BPO!Z#f!Z![#f!Z~P#BPO#i%d!ZP%d!ZR%d!Z[%d!Za%d!Zp%d!Z!Q%d!Z!Z%d!Z!j%d!Z!n%d!Z#P%d!Z#l%d!Z#m%d!Z#n%d!Z#o%d!Z#p%d!Z#q%d!Z#r%d!Z#s%d!Z#t%d!Z#u%d!Z#w%d!Z#y%d!Z#z%d!Z'x%d!Z(_%d!Z(p%d!Z!i%d!Z!W%d!Z'u%d!Z#^%d!Zt%d!Z!]%d!Z%h%d!Z!e%d!Z~P#.{Op;fO!e#vO(p'nO~O!W;gO~P#.{Op;nO!e#vO(p'nO~O!W;oO~P#.{OP%d!ZR%d!Z[%d!Zp%d!Z!Q%d!Z!j%d!Z!n%d!Z#P%d!Z#l%d!Z#m%d!Z#n%d!Z#o%d!Z#p%d!Z#q%d!Z#r%d!Z#s%d!Z#t%d!Z#u%d!Z#w%d!Z#y%d!Z#z%d!Z#}%d!Z(_%d!Z(p%d!Z!Z%d!Z![%d!Z~P'%sOp;rO!e#vO(p'nO~Ot(dX~P1qO!O%qO~P!(yO(S!lO~P!(yO!WfX!ZfX#^fX~P%0XOP]XR]X[]Xp]X!O]X!Q]X!Z]X!ZfX!j]X!n]X#P]X#Q]X#^]X#^fX#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X~O!efX!i]X!ifX(pfX~P'JlOP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]XO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(R)ZO(TTO(WUO(_VO(m[O~O!Z<ZO![$pa~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<fO!Q${O!]$|O!g=wO!j$xO#h<lO$V%_O$s<hO$u<jO$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~Oj)bO~P( bOp!cX(p!cX~P# qOp(hX(p(hX~P#!dO![]X![fX~P'JlO!WfX!W$yX!ZfX!Z$yX#^fX~P!/qO#i<OO~O!e#vO#i<OO~O#^<`O~O#t<SO~O#^<pO!Z(uX![(uX~O#^<`O!Z(sX![(sX~O#i<qO~Og<sO~P!0uO#i<yO~O#i<zO~O!e#vO#i<{O~O!e#vO#i<qO~O#}<|O~P#BPO#i<}O~O#i=OO~O#i=TO~O#i=UO~O#i=VO~O#i=WO~O#}=XO~P!0uO#}=YO~P!0uO#Q#R#S#U#V#Y#g#h#s$m$s$u$x%[%]%g%h%i%p%r%u%v%x%z~'|T#m!V'z(S#nq#l#op!O'{$['{(R$^(c~",goto:"$8f)ZPPPPPP)[PP)_P)pP+Q/VPPPP6aPP6wPP<oP@cP@yP@yPPP@yPCRP@yP@yP@yPCVPC[PCyPHsPPPHwPPPPHwKzPPPLQLrPHwPHwPP! QHwPPPHwPHwP!#XHwP!&o!'t!'}P!(q!(u!(q!,SPPPPPPP!,s!'tPP!-T!.uP!2RHwHw!2W!5d!:Q!:Q!>PPPP!>XHwPPPPPPPPPP!AhP!BuPPHw!DWPHwPHwHwHwHwHwPHw!EjP!HtP!KzP!LO!LY!L^!L^P!HqP!Lb!LbP# hP# lHwPHw# r#$wCV@yP@yP@y@yP#&U@y@y#(h@y#+`@y#-l@y@y#.[#0p#0p#0u#1O#0p#1ZPP#0pP@y#1s@y#5r@y@y6aPPP#9wPPP#:b#:bP#:bP#:x#:bPP#;OP#:uP#:u#;c#:u#;}#<T#<W)_#<Z)_P#<b#<b#<bP)_P)_P)_P)_PP)_P#<h#<kP#<k)_P#<oP#<rP)_P)_P)_P)_P)_P)_)_PP#<x#=O#=Z#=a#=g#=m#=s#>R#>X#>c#>i#>s#>y#?Z#?a#@R#@e#@k#@q#AP#Af#CZ#Ci#Cp#E[#Ej#G[#Gj#Gp#Gv#G|#HW#H^#Hd#Hn#IQ#IWPPPPPPPPPPP#I^PPPPPPP#JR#MY#Nr#Ny$ RPPP$&mP$&v$)o$0Y$0]$0`$1_$1b$1i$1qP$1w$1zP$2h$2l$3d$4r$4w$5_PP$5d$5j$5n$5q$5u$5y$6u$7^$7u$7y$7|$8P$8V$8Y$8^$8bR!|RoqOXst!Z#d%l&p&r&s&u,n,s2S2VY!vQ'^-`1g5qQ%svQ%{yQ&S|Q&h!VS'U!e-WQ'd!iS'j!r!yU*h$|*X*lQ+l%|Q+y&UQ,_&bQ-^']Q-h'eQ-p'kQ0U*nQ1q,`R<m;z%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y,k,n,s-d-l-z.Q.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3d4q5y6Z6[6_6r8i8x9SS#q];w!r)]$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sU*{%[<e<fQ+q&OQ,a&eQ,h&mQ0r+dQ0u+fQ1S+rQ1y,fQ3W.bQ5V0wQ5]0}Q6Q1rQ7O3[Q8U5^R9Y7Q'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s!S!nQ!r!v!y!z$|'U']'^'j'k'l*h*l*n*o-W-^-`-p0U0X1g5q5s%[$ti#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}Q&V|Q'S!eS'Y%h-ZQ+q&OQ,a&eQ0f+OQ1S+rQ1X+xQ1x,eQ1y,fQ5]0}Q5f1ZQ6Q1rQ6T1tQ6U1wQ8U5^Q8X5cQ8q6WQ9|8YQ:Y8nR<o*XrnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VR,c&i&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=r=s[#]WZ#W#Z'V(R!b%im#h#i#l$x%d%g([(f(g(h*W*[*_+W+X+Z,j-Q.O.U.V.W.Y/h/k2[3S3T4X6h6yQ%vxQ%zyS&P|&UQ&]!TQ'a!hQ'c!iQ(o#sS+k%{%|Q+o&OQ,Y&`Q,^&bS-g'd'eQ.d(pQ0{+lQ1R+rQ1T+sQ1W+wQ1l,ZS1p,_,`Q2t-hQ5[0}Q5`1QQ5e1YQ6P1qQ8T5^Q8W5bQ9x8SR:w9y!U$zi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y!^%xy!i!u%z%{%|'T'c'd'e'i's*g+k+l-T-g-h-o/{0O0{2m2t2{4i4j4m7s9pQ+e%vQ,O&YQ,R&ZQ,]&bQ.c(oQ1k,YU1o,^,_,`Q3].dQ5z1lS6O1p1qQ8m6P#f=t#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}o=u<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YW%Ti%V*v=pS&Y!Q&gQ&Z!RQ&[!SQ+S%cR+|&W%]%Si#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}T)x$u)yV*{%[<e<fW'Y!e%h*X-ZS({#y#zQ+`%qQ+v&RS.](k(lQ1b,SQ4x0cR8^5k'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s$i$^c#Y#e%p%r%t(Q(W(r(w)P)Q)R)S)T)U)V)W)X)Y)[)^)`)e)o+a+u-U-s-x-}.P.n.q.u.w.x.y/]0j2c2f2v2}3c3h3i3j3k3l3m3n3o3p3q3r3s3t3w3x4P5O5Y6k6q6v7V7W7a7b8`8|9Q9[9b9c:c:y;R;x=gT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ'W!eR2i-W!W!nQ!e!r!v!y!z$|'U']'^'j'k'l*X*h*l*n*o-W-^-`-p0U0X1g5q5sR1d,UnqOXst!Z#d%l&p&r&s&u,n,s2S2VQ&w!^Q't!xS(q#u<OQ+i%yQ,W&]Q,X&_Q-e'bQ-r'mS.m(v<qS0k+U<{Q0y+jQ1f,VQ2Z,uQ2],vQ2e-RQ2r-fQ2u-jS5P0l=VQ5W0zS5Z0|=WQ6j2gQ6n2sQ6s2zQ8R5XQ8}6lQ9O6oQ9R6tR:`8z$d$]c#Y#e%r%t(Q(W(r(w)P)Q)R)S)T)U)V)W)X)Y)[)^)`)e)o+a+u-U-s-x-}.P.n.q.u.x.y/]0j2c2f2v2}3c3h3i3j3k3l3m3n3o3p3q3r3s3t3w3x4P5O5Y6k6q6v7V7W7a7b8`8|9Q9[9b9c:c:y;R;x=gS(m#p'gQ(}#zS+_%p.wS.^(l(nR3U._'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sS#q];wQ&r!XQ&s!YQ&u![Q&v!]R2R,qQ'_!hQ+b%vQ-c'aS.`(o+eQ2p-bW3Y.c.d0q0sQ6m2qW6z3V3X3]5TU9U6{6}7PU:e9W9X9ZS;T:d:gQ;b;UR;j;cU!wQ'^-`T5o1g5q!Q_OXZ`st!V!Z#d#h%d%l&g&i&p&r&s&u(h,n,s.V2S2V]!pQ!r'^-`1g5qT#q];w%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SS({#y#zS.](k(l!s=^$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sU$fd)],hS(n#p'gU*s%R(u3vU0e*z.i7]Q5T0rQ6{3WQ9X7OR:g9Ym!tQ!r!v!y!z'^'j'k'l-`-p1g5q5sQ'r!uS(d#g1|S-n'i'uQ/n*ZQ/{*gQ2|-qQ4]/oQ4i/}Q4j0OQ4o0WQ7h4WS7s4k4mS7w4p4rQ9g7iQ9k7oQ9p7tQ9u7yS:o9l9mS;Y:p:sS;e;Z;[S;m;f;gS;q;n;oR;t;rQ#wbQ'q!uS(c#g1|S(e#m+TQ+V%eQ+g%wQ+m%}U-m'i'r'uQ.R(dQ/m*ZQ/|*gQ0P*iQ0x+hQ1m,[S2y-n-qQ3R.ZS4[/n/oQ4e/yS4h/{0WQ4l0QQ5|1nQ6u2|Q7g4WQ7k4]U7r4i4o4rQ7u4nQ8k5}S9f7h7iQ9j7oQ9r7wQ9s7xQ:V8lQ:m9gS:n9k9mQ:v9uQ;P:WS;X:o:sS;d;Y;ZS;l;e;gS;p;m;oQ;s;qQ;u;tQ=a=[Q=l=eR=m=fV!wQ'^-`%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SS#wz!j!r=Z$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sR=a=r%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SQ%ej!^%wy!i!u%z%{%|'T'c'd'e'i's*g+k+l-T-g-h-o/{0O0{2m2t2{4i4j4m7s9pS%}z!jQ+h%xQ,[&bW1n,],^,_,`U5}1o1p1qS8l6O6PQ:W8m!r=[$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ=e=qR=f=r%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SY#bWZ#W#Z(R!b%im#h#i#l$x%d%g([(f(g(h*W*[*_+W+X+Z,j-Q.O.U.V.W.Y/h/k2[3S3T4X6h6yQ,i&m!p=]$Z$n)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sR=`'VU'Z!e%h*XR2k-Z%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y,k,n,s-d-l-z.Q.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3d4q5y6Z6[6_6r8i8x9S!r)]$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ,h&mQ0r+dQ3W.bQ7O3[R9Y7Q!b$Tc#Y%p(Q(W(r(w)X)Y)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;x!P<U)[)o-U.w2c2f3h3q3r3w4P6k7W7a7b8`8|9[9b9c:y;R=g!f$Vc#Y%p(Q(W(r(w)U)V)X)Y)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;x!T<W)[)o-U.w2c2f3h3n3o3q3r3w4P6k7W7a7b8`8|9[9b9c:y;R=g!^$Zc#Y%p(Q(W(r(w)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;xQ4V/fz=s)[)o-U.w2c2f3h3w4P6k7W7a7b8`8|9[9b9c:y;R=gQ=x=zR=y={'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sS$oh$pR3|/P'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/P/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sT$kf$qQ$ifS)h$l)lR)t$qT$jf$qT)j$l)l'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/P/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sT$oh$pQ$rhR)s$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9S!s=q$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s#glOPXZst!Z!`!o#S#d#o#{$n%l&i&l&m&p&r&s&u&y'R'`(|)q*f+Y+d,k,n,s-d.b/Q/i0V0d1j1z1{1}2P2S2V2X3[3{4q5y6Z6[6_7Q8i8x!U%Ri$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y#f(u#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}Q+P%`Q/^)|o3v<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!U$yi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=yQ*`$zU*i$|*X*lQ+Q%aQ0Q*j#f=c#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n=d<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YQ=h=tQ=i=uQ=j=vR=k=w!U%Ri$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y#f(u#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}o3v<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YnoOXst!Z#d%l&p&r&s&u,n,s2S2VS*c${*WQ,|&|Q,}'OR4`/s%[%Si#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}Q,P&ZQ1`,RQ5i1_R8]5jV*k$|*X*lU*k$|*X*lT5p1g5qS/y*f/iQ4n0VT7x4q:PQ+g%wQ0P*iQ0x+hQ1m,[Q5|1nQ8k5}Q:V8lR;P:W!U%Oi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=yx*P$v)c*Q*r+R/q0^0_3y4^4{4|4}7f7z9v:l=b=n=oS0Y*q0Z#f<a#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n<b<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!d<t(s)a*Y*b.e.h.l/Y/f/v0p1]3`4S4_4c5h7R7U7m7p7}8P9i9q9w:q:u;W;];h=z={`<u3u7X7[7`9]:h:k;kS=P.g3aT=Q7Z9`!U%Qi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y|*R$v)c*S*q+R/b/q0^0_3y4^4s4{4|4}7f7z9v:l=b=n=oS0[*r0]#f<c#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n<d<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!h<v(s)a*Y*b.f.g.l/Y/f/v0p1]3^3`4S4_4c5h7R7S7U7m7p7}8P9i9q9w:q:u;W;];h=z={d<w3u7Y7Z7`9]9^:h:i:k;kS=R.h3bT=S7[9arnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VQ&d!UR,k&mrnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VR&d!UQ,T&[R1[+|snOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VQ1h,YS5w1k1lU8e5u5v5zS:R8g8hS:{:Q:TQ;_:|R;i;`Q&k!VR,d&gR6T1tR:Y8nS&P|&UR1T+sQ&p!WR,n&qR,t&vT2T,s2VR,x&wQ,w&wR2^,xQ'w!{R-t'wSsOtQ#dXT%os#dQ#OTR'y#OQ#RUR'{#RQ)y$uR/Z)yQ#UVR(O#UQ#XWU(U#X(V-{Q(V#YR-{(WQ-X'WR2j-XQ.p(wS3e.p3fR3f.qQ-`'^R2n-`Y!rQ'^-`1g5qR'h!rQ.{)cR3z.{U#_W%g*WU(]#_(^-|Q(^#`R-|(XQ-['ZR2l-[t`OXst!V!Z#d%l&g&i&p&r&s&u,n,s2S2VS#hZ%dU#r`#h.VR.V(hQ(i#jQ.S(eW.[(i.S3P6wQ3P.TR6w3QQ)l$lR/R)lQ$phR)r$pQ$`cU)_$`-w<[Q-w;xR<[)oQ/l*ZW4Y/l4Z7j9hU4Z/m/n/oS7j4[4]R9h7k$e*O$v(s)a)c*Y*b*q*r*|*}+R.g.h.j.k.l/Y/b/d/f/q/v0^0_0p1]3^3_3`3u3y4S4^4_4c4s4u4{4|4}5h7R7S7T7U7Z7[7^7_7`7f7m7p7z7}8P9]9^9_9i9q9v9w:h:i:j:k:l:q:u;W;];h;k=b=n=o=z={Q/t*bU4b/t4d7nQ4d/vR7n4cS*l$|*XR0S*lx*Q$v)c*q*r+R/q0^0_3y4^4{4|4}7f7z9v:l=b=n=o!d.e(s)a*Y*b.g.h.l/Y/f/v0p1]3`4S4_4c5h7R7U7m7p7}8P9i9q9w:q:u;W;];h=z={U/c*Q.e7Xa7X3u7Z7[7`9]:h:k;kQ0Z*qQ3a.gU4t0Z3a9`R9`7Z|*S$v)c*q*r+R/b/q0^0_3y4^4s4{4|4}7f7z9v:l=b=n=o!h.f(s)a*Y*b.g.h.l/Y/f/v0p1]3^3`4S4_4c5h7R7S7U7m7p7}8P9i9q9w:q:u;W;];h=z={U/e*S.f7Ye7Y3u7Z7[7`9]9^:h:i:k;kQ0]*rQ3b.hU4v0]3b9aR9a7[Q*w%UR0a*wQ5S0pR8O5SQ+[%jR0o+[Q5l1bS8_5l:OR:O8`Q,V&]R1e,VQ5q1gR8b5qQ1s,aS6R1s8oR8o6TQ1O+oW5_1O5a8V9zQ5a1RQ8V5`R9z8WQ+t&PR1U+tQ2V,sR6c2VYrOXst#dQ&t!ZQ+^%lQ,m&pQ,o&rQ,p&sQ,r&uQ2Q,nS2T,s2VR6b2SQ%npQ&x!_Q&{!aQ&}!bQ'P!cQ'o!uQ+]%kQ+i%yQ+{&VQ,c&kQ,z&zW-k'i'q'r'uQ-r'mQ0R*kQ0y+jS1v,d,gQ2_,yQ2`,|Q2a,}Q2u-jW2w-m-n-q-sQ5W0zQ5d1XQ5g1]Q5{1mQ6V1xQ6a2RU6p2v2y2|Q6s2zQ8R5XQ8Z5fQ8[5hQ8a5pQ8j5|Q8p6US9P6q6uQ9R6tQ9{8XQ:U8kQ:Z8qQ:b9QQ:x9|Q;O:VQ;S:cR;a;PQ%yyQ'b!iQ'm!uU+j%z%{%|Q-R'TU-f'c'd'eS-j'i'sQ/z*gS0z+k+lQ2g-TS2s-g-hQ2z-oS4g/{0OQ5X0{Q6l2mQ6o2tQ6t2{U7q4i4j4mQ9o7sR:r9pS$wi=pR*x%VU%Ui%V=pR0`*vQ$viS(s#v+fS)a$b$cQ)c$dQ*Y$xS*b${*WQ*q%OQ*r%QQ*|%]Q*}%^Q+R%bQ.g<aQ.h<cQ.j<gQ.k<iQ.l<kQ/Y)wQ/b*PQ/d*RQ/f*TQ/q*^S/v*d/hQ0^*tQ0_*ul0p+c,Q.a1a1i3Z5x6|8f9V:S:f:};VQ1]+}Q3^<tQ3_<vQ3`<yS3u<^<_Q3y.zS4S/_4UQ4^/rQ4_/sQ4c/uQ4s0YQ4u0[Q4{0gQ4|0hQ4}0iQ5h1^Q7R<}Q7S=PQ7T=RQ7U=TQ7Z<bQ7[<dQ7^<hQ7_<jQ7`<lQ7f4VQ7m4aQ7p4fQ7z4wQ7}5RQ8P5UQ9]<zQ9^<uQ9_<wQ9i7lQ9q7vQ9v7|Q9w8QQ:h=OQ:i=QQ:j=SQ:k=UQ:l9eQ:q9nQ:u9tQ;W=XQ;]:tQ;h;^Q;k=YQ=b=pQ=n=xQ=o=yQ=z=|R={=}Q*z%[Q.i<eR7]<fnpOXst!Z#d%l&p&r&s&u,n,s2S2VQ!fPS#fZ#oQ&z!`W'f!o*f0V4qQ'}#SQ)O#{Q)p$nS,g&i&lQ,l&mQ,y&yS-O'R/iQ-b'`Q.s(|Q/V)qQ0m+YQ0s+dQ2O,kQ2q-dQ3X.bQ4O/QQ4y0dQ5v1jQ6X1zQ6Y1{Q6^1}Q6`2PQ6e2XQ7P3[Q7c3{Q8h5yQ8t6ZQ8u6[Q8w6_Q9Z7QQ:T8iR:_8x#[cOPXZst!Z!`!o#d#o#{%l&i&l&m&p&r&s&u&y'R'`(|*f+Y+d,k,n,s-d.b/i0V0d1j1z1{1}2P2S2V2X3[4q5y6Z6[6_7Q8i8xQ#YWQ#eYQ%puQ%rvS%tw!gS(Q#W(TQ(W#ZQ(r#uQ(w#xQ)P$OQ)Q$PQ)R$QQ)S$RQ)T$SQ)U$TQ)V$UQ)W$VQ)X$WQ)Y$XQ)[$ZQ)^$_Q)`$aQ)e$eW)o$n)q/Q3{Q+a%sQ+u&QS-U'V2hQ-s'pS-x(R-zQ-}(ZQ.P(bQ.n(vQ.q(xQ.u;vQ.w;yQ.x;zQ.y;}Q/]){Q0j+UQ2c-PQ2f-SQ2v-lQ2}.QQ3c.oQ3h<OQ3i<PQ3j<QQ3k<RQ3l<SQ3m<TQ3n<UQ3o<VQ3p<WQ3q<XQ3r<YQ3s.vQ3t<]Q3w<`Q3x<mQ4P<ZQ5O0lQ5Y0|Q6k<pQ6q2xQ6v3OQ7V3dQ7W<qQ7a<sQ7b<{Q8`5mQ8|6iQ9Q6rQ9[<|Q9b=VQ9c=WQ:c9SQ:y9}Q;R:aQ;x#SR=g=sR#[WR'X!el!tQ!r!v!y!z'^'j'k'l-`-p1g5q5sS'T!e-WU*g$|*X*lS-T'U']S0O*h*nQ0W*oQ2m-^Q4m0UR4r0XR(y#xQ!fQT-_'^-`]!qQ!r'^-`1g5qQ#p]R'g;wR)d$dY!uQ'^-`1g5qQ'i!rS's!v!yS'u!z5sS-o'j'kQ-q'lR2{-pT#kZ%dS#jZ%dS%jm,jU(e#h#i#lS.T(f(gQ.X(hQ0n+ZQ3Q.UU3R.V.W.YS6x3S3TR9T6yd#^W#W#Z%g(R([*W+W.O/hr#gZm#h#i#l%d(f(g(h+Z.U.V.W.Y3S3T6yS*Z$x*_Q/o*[Q1|,jQ2d-QQ4W/kQ6g2[Q7i4XQ8{6hT=_'V+XV#aW%g*WU#`W%g*WS(S#W([U(X#Z+W/hS-V'V+XT-y(R.OV'[!e%h*XQ$lfR)v$qT)k$l)lR3}/PT*]$x*_T*e${*WQ0q+cQ1_,QQ3V.aQ5j1aQ5u1iQ6}3ZQ8g5xQ9W6|Q:Q8fQ:d9VQ:|:SQ;U:fQ;`:}R;c;VnqOXst!Z#d%l&p&r&s&u,n,s2S2VQ&j!VR,c&gtmOXst!U!V!Z#d%l&g&p&r&s&u,n,s2S2VR,j&mT%km,jR1c,SR,b&eQ&T|R+z&UR+p&OT&n!W&qT&o!W&qT2U,s2V",nodeNames:"⚠ ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies in CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:378,context:xf,nodeProps:[["isolate",-8,5,6,14,35,37,49,51,53,""],["group",-26,9,17,19,66,206,210,214,215,217,220,223,233,235,241,243,245,247,250,256,262,264,266,268,270,272,273,"Statement",-34,13,14,30,33,34,40,49,52,53,55,60,68,70,74,78,80,82,83,108,109,118,119,135,138,140,141,142,143,144,146,147,166,168,170,"Expression",-23,29,31,35,39,41,43,172,174,176,177,179,180,181,183,184,185,187,188,189,200,202,204,205,"Type",-3,86,101,107,"ClassItem"],["openedBy",23,"<",36,"InterpolationStart",54,"[",58,"{",71,"(",159,"JSXStartCloseTag"],["closedBy",-2,24,167,">",38,"InterpolationEnd",48,"]",59,"}",72,")",164,"JSXEndTag"]],propSources:[Pf],skippedNodes:[0,5,6,276],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$h&j(X!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(X!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$h&j(UpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(UpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$h&j(Up(X!b'z0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(V#S$h&j'{0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$h&j(Up(X!b'{0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$h&j!n),Q(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#u(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#u(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(T':f$h&j(X!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$h&j(X!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$h&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$c`$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$c``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$c`$h&j(X!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(X!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$c`(X!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$h&j(Up(X!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$h&j(Up(X!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$h&j(X!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$h&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(X!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$h&j(UpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(UpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Up(X!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$h&j(m%1l(Up(X!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$h&j(Up(X!b$[#t(R,2j(c$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$h&j(Up(X!b$[#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$h&j(Up(X!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$h&j$P(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(x+JY$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$h&j#y(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(W';W$h&j(UpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$h&j(UpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$h&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$c`$h&j(UpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(UpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$c`(UpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!j/.^$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!i!Lf$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$h&j(Up(X!b(S%&f#o(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$h&j(Up(X!b#l(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$h&j(Up(X!bp+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!Z+Jf$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$h&j(Up(X!b!O.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_!Y!L^$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$h&j(Up(X!b#m(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$h&j(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$h&j(X!b!V7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$h&j!V7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$h&j!V7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!V7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!V7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$h&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$h&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$h&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$h&j(X!b!V7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(X!b!V7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(X!b!V7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(X!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$h&j(X!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$h&j(Up!V7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$h&j(Up!V7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Up!V7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Up!V7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(UpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$h&j(UpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$h&j(Up(X!b!V7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Up(X!b!V7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Up(X!b!V7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Up(X!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$h&j(Up(X!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$h&j(Up(X!b'|0/l!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$h&j(Up(X!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$h&j(X!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$h&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(X!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$h&j(UpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(UpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Up(X!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$h&j$P(Ch(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Y#t$h&j(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!e$b$h&j#})Lv(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#P-<U(Up(X!b$m7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$j&j(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#p(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$P(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#q(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#^*!Y$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#i(Cl$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#q(Ch$e#|$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#q(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#p(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#p(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(p(Ct$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$h&j#z(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!z$Ip$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!Q0,v$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$h&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$h&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$h&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$h&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$h&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!W#)l$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#w(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$h&j(Up(X!b(_+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$h&j(Up(X!b(R,2j$^#t(c$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$h&j(Up(X!b$^#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!]#Hb(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(w+JY$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_![(CdtBr$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!o7`$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$h&j(Up(X!b'z0/l$[#t(R,2j(c$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$h&j(Up(X!b'{0/l$[#t(R,2j(c$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[Cf,Sf,_f,Ef,2,3,4,5,6,7,8,9,10,11,12,13,14,$f,new sf("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOv~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!S~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(a~~",141,338),new sf("j~RQYZXz{^~^O(O~~aP!P!Qd~iO(P~~",25,321)],topRules:{Script:[0,7],SingleExpression:[1,274],SingleClassItem:[2,275]},dialects:{jsx:0,ts:15091},dynamicPrecedences:{78:1,80:1,92:1,168:1,198:1},specialized:[{term:325,get:e=>Af[e]||-1},{term:341,get:e=>Rf[e]||-1},{term:93,get:e=>Df[e]||-1}],tokenPrec:15116}),Lf=[ip("function ${name}(${params}) {\n\t${}\n}",{label:"function",detail:"definition",type:"keyword"}),ip("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n\t${}\n}",{label:"for",detail:"loop",type:"keyword"}),ip("for (let ${name} of ${collection}) {\n\t${}\n}",{label:"for",detail:"of loop",type:"keyword"}),ip("do {\n\t${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),ip("while (${}) {\n\t${}\n}",{label:"while",detail:"loop",type:"keyword"}),ip("try {\n\t${}\n} catch (${error}) {\n\t${}\n}",{label:"try",detail:"/ catch block",type:"keyword"}),ip("if (${}) {\n\t${}\n}",{label:"if",detail:"block",type:"keyword"}),ip("if (${}) {\n\t${}\n} else {\n\t${}\n}",{label:"if",detail:"/ else block",type:"keyword"}),ip("class ${name} {\n\tconstructor(${params}) {\n\t\t${}\n\t}\n}",{label:"class",detail:"definition",type:"keyword"}),ip('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),ip('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],Tf=Lf.concat([ip("interface ${name} {\n\t${}\n}",{label:"interface",detail:"definition",type:"keyword"}),ip("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),ip("enum ${name} {\n\t${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),Bf=new wr,Ff=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function If(e){return(t,i)=>{let n=t.node.getChild("VariableDefinition");return n&&i(n,e),!0}}const jf=["FunctionDeclaration"],Mf={FunctionDeclaration:If("function"),ClassDeclaration:If("class"),ClassExpression:()=>!0,EnumDeclaration:If("constant"),TypeAliasDeclaration:If("type"),NamespaceDeclaration:If("namespace"),VariableDefinition(e,t){e.matchContext(jf)||t(e,"variable")},TypeDefinition(e,t){t(e,"type")},__proto__:null};function Qf(e,t){let i=Bf.get(t);if(i)return i;let n=[],s=!0;function o(t,i){let s=e.sliceString(t.from,t.to);n.push({label:s,type:i})}return t.cursor(er.IncludeAnonymous).iterate((t=>{if(s)s=!1;else if(t.name){let e=Mf[t.name];if(e&&e(t,o)||Ff.has(t.name))return!1}else if(t.to-t.from>8192){for(let i of Qf(e,t.node))n.push(i);return!1}})),Bf.set(t,n),n}const Wf=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,Nf=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName","JSXText","JSXAttributeValue","JSXOpenTag","JSXCloseTag","JSXSelfClosingTag",".","?."];function Zf(e){let t=il(e.state).resolveInner(e.pos,-1);if(Nf.indexOf(t.name)>-1)return null;let i="VariableName"==t.name||t.to-t.from<20&&Wf.test(e.state.sliceDoc(t.from,t.to));if(!i&&!e.explicit)return null;let n=[];for(let i=t;i;i=i.parent)Ff.has(i.name)&&(n=n.concat(Qf(e.state.doc,i)));return{options:n,from:i?t.from:e.pos,validFor:Wf}}const qf=tl.define({name:"javascript",parser:Vf.configure({props:[wl.add({IfStatement:kl({except:/^\s*({|else\b)/}),TryStatement:kl({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:e=>e.baseIndent,SwitchBody:e=>{let t=e.textAfter,i=/^\s*\}/.test(t),n=/^\s*(case|default)\b/.test(t);return e.baseIndent+(i?0:n?1:2)*e.unit},Block:Sl({closing:"}"}),ArrowFunction:e=>e.baseIndent+e.unit,"TemplateString BlockComment":()=>null,"Statement Property":kl({except:/^{/}),JSXElement(e){let t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},JSXEscape(e){let t=/\s*\}/.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},"JSXOpenTag JSXSelfClosingTag":e=>e.column(e.node.from)+e.unit}),Pl.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":function(e){let t=e.firstChild,i=e.lastChild;return t&&t.to<i.from?{from:t.to,to:i.type.isError?e.to:i.from}:null},BlockComment:e=>({from:e.from+2,to:e.to-2})})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),zf={test:e=>/^JSX/.test(e.name),facet:Hr({commentTokens:{block:{open:"{/*",close:"*/}"}}})},Uf=qf.configure({dialect:"ts"},"typescript"),Xf=qf.configure({dialect:"jsx",props:[Kr.add((e=>e.isTop?[zf]:void 0))]}),Gf=qf.configure({dialect:"jsx ts",props:[Kr.add((e=>e.isTop?[zf]:void 0))]},"typescript");let Yf=e=>({label:e,type:"keyword"});const Hf="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(Yf),Kf=Hf.concat(["declare","implements","private","protected","public"].map(Yf));function Jf(e={}){let t=e.jsx?e.typescript?Gf:Xf:e.typescript?Uf:qf,i=e.typescript?Tf.concat(Kf):Lf.concat(Hf);return new ul(t,[qf.data.of({autocomplete:(n=Nf,s=iu(i),e=>{for(let t=il(e.state).resolveInner(e.pos,-1);t;t=t.parent){if(n.indexOf(t.name)>-1)return null;if(t.type.isTop)break}return s(e)})}),qf.data.of({autocomplete:Zf}),e.jsx?im:[]]);var n,s}function em(e,t,i=e.length){for(let n=null==t?void 0:t.firstChild;n;n=n.nextSibling)if("JSXIdentifier"==n.name||"JSXBuiltin"==n.name||"JSXNamespacedName"==n.name||"JSXMemberExpression"==n.name)return e.sliceString(n.from,Math.min(n.to,i));return""}const tm="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),im=Js.inputHandler.of(((e,t,i,n,s)=>{if((tm?e.composing:e.compositionStarted)||e.state.readOnly||t!=i||">"!=n&&"/"!=n||!qf.isActiveAt(e.state,t,-1))return!1;let o=s(),{state:a}=o,r=a.changeByRange((e=>{var t;let i,{head:s}=e,o=il(a).resolveInner(s-1,-1);if("JSXStartTag"==o.name&&(o=o.parent),a.doc.sliceString(s-1,s)!=n||"JSXAttributeValue"==o.name&&o.to>s);else{if(">"==n&&"JSXFragmentTag"==o.name)return{range:e,changes:{from:s,insert:"</>"}};if("/"==n&&"JSXStartCloseTag"==o.name){let e=o.parent,n=e.parent;if(n&&e.from==s-2&&((i=em(a.doc,n.firstChild,s))||"JSXFragmentTag"==(null===(t=n.firstChild)||void 0===t?void 0:t.name))){let e=`${i}>`;return{range:M.cursor(s+e.length,-1),changes:{from:s,insert:e}}}}else if(">"==n){let t=function(e){for(;;){if("JSXOpenTag"==e.name||"JSXSelfClosingTag"==e.name||"JSXFragmentTag"==e.name)return e;if("JSXEscape"==e.name||!e.parent)return null;e=e.parent}}(o);if(t&&"JSXOpenTag"==t.name&&!/^\/?>|^<\//.test(a.doc.sliceString(s,s+2))&&(i=em(a.doc,t,s)))return{range:e,changes:{from:s,insert:`</${i}>`}}}}return{range:e}}));return!r.changes.empty&&(e.dispatch([o,a.update(r,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}));function nm(e){const t=(0,n.Z)(e),i=e.UISettings.config();return class extends t{constructor(){super("properties_abmobileview_custom",{dataCollectionList:"",dataCollectionForm:"",dataCollection:"",initCodeTemplate:"",initCode:"",htmlCodeTemplate:"",htmlCode:""})}static get key(){return"mobile-custom"}ui(){const e=this.ids;return super.ui([{view:"tabview",cells:[{header:"DataCollections",body:{rows:[{view:"list",id:e.dataCollectionList,template:"#name# - #dataCollection# <span class='webix_icon wxi-trash' style='float:right; cursor:pointer;'></span>",autoheight:!0,onClick:{"wxi-trash":(e,t)=>(this.removeDataCollection(t),!1)}},{view:"form",id:e.dataCollectionForm,elements:[{cols:[{view:"text",name:"name",label:"Name",labelWidth:i.labelWidthSmall,labelPosition:"top"},{id:e.dataCollection,view:"richselect",name:"id",label:"Data Collection",labelWidth:i.labelWidthLarge,labelPosition:"top",options:[]},{view:"button",value:"Add",click:()=>{this.addDataCollection()}}]}]}]}},{header:"init",body:{id:e.initCodeTemplate,view:"form",elements:[{view:"template",labelWidth:i.labelWidthLarge,template:"<div id='"+e.initCode+"'></div>"}]}},{header:"html",body:{id:e.htmlCodeTemplate,view:"form",elements:[{view:"template",labelWidth:i.labelWidthLarge,template:"<div id='"+e.htmlCode+"'></div>"}]}}],multiview:{keepViews:!0},tabbar:{on:{onAfterTabClick:t=>{t!==e.initCodeTemplate&&t!==e.htmlCodeTemplate||this.initTab(t),this.onChange()}}}}])}initTab(e){const t=this.ids;e!=t.initCodeTemplate||this.initView||(this.initView=new Js({state:_e.create({doc:this.CurrentView.settings?.initCode??"// init code here\n// the following variables are available:\n// $AB: the ABFactory\n// $DC[<label>]: the list of datacollections you defined\n",extensions:[Up,Jf(),Js.updateListener.of((e=>{e.docChanged&&this.onChange()}))]}),parent:document.getElementById(t.initCode)})),e!=t.htmlCodeTemplate||this.htmlView||(this.htmlView=new Js({state:_e.create({doc:this.CurrentView.settings?.htmlCode??`// html code here\n// the following varialbes are available:\n// $AB: the ABFactory\n// $h: the F7 template function\n// $DC[<label>]: the list of datacollections you defined\n\n// any returned html needs to be wrapped in $h\`...\` like so:\n// return $h\`<div>Hello World</div>\`;\n\nreturn $h\`${this.CurrentView.label} has no html defined.\``,extensions:[Up,Jf(),Js.updateListener.of((e=>{e.docChanged&&this.onChange()}))]}),parent:document.getElementById(t.htmlCode)}))}dcListRefresh(){const e=this.ids;let t=this.datacollectionsIncluded();this.listAll().forEach((e=>{t=t.filter((t=>t.id!=e.id))})),$$(e.dataCollection).define("options",t),$$(e.dataCollection).refresh()}addDataCollection(){const e=$$(this.ids.dataCollectionForm),t=e.getValues();if(t.name&&t.id){let i=this.AB.datacollectionByID(t.id);i&&(t.dataCollection=i.label,this.listInsert(t)),e.clear()}this.dcListRefresh(),this.onChange()}listAll(){return $$(this.ids.dataCollectionList).serialize(!0)}listInsert(e){$$(this.ids.dataCollectionList).add(e)}listReset(){const e=$$(this.ids.dataCollectionList);e.clearAll(),e.refresh()}removeDataCollection(e){$$(this.ids.dataCollectionList).remove(e),this.dcListRefresh(),this.onChange()}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);let t=e.settings?.datacollections??{};this.listReset(),Object.keys(t).forEach((e=>{let i=t[e],n=this.AB.datacollectionByID(i);this.listInsert({id:i,name:e,dataCollection:n?n.label:"??"})})),this.dcListRefresh()}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component);let i=super.values();i.settings=t.getValues();let n=this.listAll();return i.settings.datacollections={},n.forEach((e=>{i.settings.datacollections[e.name]=e.id})),i.settings.initCode=this.initView?.state.doc.toString(),i.settings.initCode||(i.settings.initCode=this.CurrentView.settings?.initCode),i.settings.htmlCode=this.htmlView?.state.doc.toString(),i.settings.htmlCode||(i.settings.htmlCode=this.CurrentView.settings?.htmlCode),i}}}},4149:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(9018),s=i(1538),o=i(708);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L(),r="properties_abmobileview_form",l=(0,s.Z)(e,`${r}_popupRecordRule`),c=(0,o.Z)(e,`${r}_popupSubmitRule`);return class extends t{constructor(){super(r,{datacollection:"",fields:"",showLabel:"",labelPosition:"",labelWidth:"",height:"",clearOnLoad:"",clearOnSave:"",buttonSubmitRules:"",buttonRecordRules:""}),this.AB=e}static get key(){return"mobile-form"}ui(){let e=this.ids;return super.ui([{id:e.datacollection,view:"richselect",name:"dataviewID",label:a("Datacollection"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{this.selectSource(e,t)}}},{view:"fieldset",label:a("Form Fields:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fields,view:"list",name:"fields",select:!1,minHeight:200,template:(...e)=>this.listTemplate(...e),type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:(...e)=>this.check(...e)}}]}},{id:e.showLabel,name:"showLabel",view:"checkbox",label:a("Display Label"),labelWidth:i.labelWidthLarge,click:()=>{this.onChange()}},{id:e.labelPosition,view:"richselect",name:"labelPosition",label:a("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:a("Left")},{id:"top",value:a("Top")}],on:{onChange:()=>{this.onChange()}}},{id:e.labelWidth,view:"counter",name:"labelWidth",label:a("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:a("Height"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.clearOnLoad,view:"checkbox",name:"clearOnLoad",label:a("Clear on load"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.clearOnSave,view:"checkbox",name:"clearOnSave",label:a("Clear on save"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"fieldset",label:a("Rules:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:a("Submit Rules:"),width:i.labelWidthLarge},{id:e.buttonSubmitRules,view:"button",css:"webix_primary",name:"buttonSubmitRules",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.submitRuleShow()}}]},{cols:[{view:"label",label:a("Record Rules:"),width:i.labelWidthLarge},{id:e.buttonRecordRules,view:"button",name:"buttonRecordRules",css:"webix_primary",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.recordRuleShow()}}]}]}}])}async init(e){super.init(e),webix.extend($$(this.ids.component),webix.ProgressBar);let t=[];return t.push(l.init(e)),l.on("save",(()=>{this.onChange(),this.populateBadgeNumber()})),t.push(c.init(e)),c.on("save",(()=>{this.onChange(),this.populateBadgeNumber()})),Promise.all(t)}populate(e){super.populate(e);let t=this.ids;if(!e)return;let i=e.parentFormComponent(),n=i.settings.dataviewID?i.settings.dataviewID:null;var s=$$(t.datacollection),o=e.application.datacollectionsIncluded().filter((e=>{const t=e.datasource;return"object"==e.sourceType&&!t?.isImported&&!t?.isReadOnly})).map((e=>{let t={id:e.id,value:e.label};return"query"==e.sourceType?t.icon="fa fa-filter":t.icon="fa fa-database",t}));s.define("options",o),s.define("value",n),s.refresh(),this.propertyUpdateFieldOptions(n),e.views().forEach((t=>{t instanceof this.AB.Class.ABMobileViewFormItem&&t.once("destroyed",(()=>this.populate(e)))})),s.enable(),$$(t.showLabel).setValue(e.settings.showLabel);let a=this.defaultValues();Object.keys(a).forEach((i=>{$$(t[i])?.setValue(e.settings[i]||a[i])})),l.objectLoad(this.CurrentObject),l.viewLoad(e),l.fromSettings(e.settings.recordRules||[]),c.objectLoad(this.CurrentObject),c.viewLoad(e),c.fromSettings(e.settings.submitRules||[]),this.populateBadgeNumber(),this.updateEventIds=this.updateEventIds||{},this.updateEventIds[e.id]||(this.updateEventIds[e.id]=!0,e.addListener("properties.updated",(()=>{this.populateBadgeNumber()})))}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){let e=this.ids,t=super.values(),i=this.defaultValues();const n=$$(e.component);return t.settings=t.settings||{},t.settings=n.getValues(),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue()||i.labelPosition,t.settings.labelWidth=$$(e.labelWidth).getValue()||i.labelWidth,t.settings.height=$$(e.height).getValue(),t.settings.clearOnLoad=$$(e.clearOnLoad).getValue(),t.settings.clearOnSave=$$(e.clearOnSave).getValue(),t.settings.recordRules=l.toSettings(),t.settings.submitRules=c.toSettings(),t}busy(){$$(this.ids.component)?.showProgress?.({type:"icon"})}check(e,t){const i=this.ids;let n=this.CurrentView,s=n.parentFormComponent(),o=$$(i.fields).getItem(t);o.selected=o.selected?0:1,$$(i.fields).updateItem(t,o);let a=()=>{s.refreshDefaultButton(i).save().then((()=>{n.emit("properties.updated",n),this.onChange()}))};if(o.selected){let e=n.addFieldToForm(o);e&&e.save().then((()=>{e.once("destroyed",(()=>this.populate(n))),n.viewInsert(e).then((()=>{a()}))}))}else{let e=s.fieldComponents().filter((e=>e.settings.fieldId==t))[0];e&&(e.destroy(),n.viewRemove(e).then((()=>{a()})))}}populateBadgeNumber(){const e=this.ids;let t=this.CurrentView;t&&(t.settings.submitRules?$$(e.buttonSubmitRules).define("badge",t.settings.submitRules.length||null):$$(e.buttonSubmitRules).define("badge",null),$$(e.buttonSubmitRules).refresh(),t.settings.recordRules?$$(e.buttonRecordRules).define("badge",t.settings.recordRules.length||null):$$(e.buttonRecordRules).define("badge",null),$$(e.buttonRecordRules).refresh())}ready(){$$(this.ids.component)?.hideProgress?.()}recordRuleShow(){l.fromSettings(this.CurrentView.settings.recordRules),l.show()}submitRuleShow(){c.fromSettings(this.CurrentView.settings.submitRules),c.show()}listTemplate(e,t){let i=this.CurrentView;var n=e.formComponent();if(null==n)return`<i class='fa fa-times'></i>  ${e.label} <div class='ab-component-form-fields-component-info'> Disable </div>`;var s=n.common().key,o=i.application.viewAll((e=>e.common().key==s))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${o?o.common().icon:"fw"}'></i> ${o?a(o.common().labelKey):""} </div>`}propertyUpdateFieldOptions(e){const t=this.ids;var i=this.CurrentView?.parentFormComponent(),n=i?.fieldComponents()??[],s=this.AB.datacollectionByID(e),o=s?s.datasource:null,a=[];null!=o&&(a=o.fields().map((e=>(e.selected=n.filter((t=>e.id==t.settings.fieldId)).length>0,e))),this.objectLoad(o)),$$(t.fields).clearAll(),$$(t.fields).parse(a)}refreshDefaultButton(){const e=this.ids,t=this.AB.Class.ABViewManager.viewClass("button");let i=this.views((e=>e instanceof t&&e.settings.isDefault))[0];null==i?(i=t.newInstance(this.application,this),i.settings.isDefault=!0):this._views=this.views((e=>!(e instanceof t||e.settings.isDefault)));let n=this.views().map((e=>(e.position.y||0)+1));n.push(this._views.length||0),n.push($$(e.fields).length||0);let s=Math.max(...n);return i.position.y=s,this._views.push(i),i}selectSource(e){const t=this.ids;this.busy();let i=this.CurrentView,n=i.parentFormComponent();i.settings.dataviewID=e;var s=i._views;return i._views=[],Promise.resolve().then((()=>{var e=[];return s.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(this.propertyUpdateFieldOptions(e),i._views.length>0)return Promise.resolve();let s=[],o=$$(t.fields).find({});o.forEach(((e,n)=>{if(!e.selected){let a=o.length-n-1,r=i.addFieldToForm(e,a);if(!r)return;if("mobile-view"==r.defaults.key)return;r.once("destroyed",(()=>this.populate(i))),s.push(r.save()),e.selected=1,$$(t.fields).updateItem(e.id,e)}}));let a=n.refreshDefaultButton(t);return a&&s.push(a.save()),Promise.all(s)})).then((()=>i.save())).then((()=>(n.emit("properties.updated",i),this.ready(),this.onChange(),Promise.resolve())))}}}},2155:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(9018);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_button",{includeSave:"",saveLabel:"",includeCancel:"",cancelLabel:"",includeReset:"",resetLabel:"",afterCancel:"",alignment:""}),this.AB=e}static get key(){return"mobile-button"}ui(){const e=this.ids,t=this.AB.UISettings.config();return super.ui([{id:e.includeSave,name:"includeSave",view:"checkbox",label:i("Save"),click:()=>this.onChange()},{id:e.saveLabel,name:"saveLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Save Label"),placeholder:i("Save Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeCancel,name:"includeCancel",view:"checkbox",label:i("Cancel"),click:()=>this.onChange()},{id:e.cancelLabel,name:"cancelLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Cancel Label"),placeholder:i("Cancel Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeReset,name:"includeReset",view:"checkbox",label:i("Reset"),click:()=>this.onChange()},{id:e.resetLabel,name:"resetLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Reset Label"),placeholder:i("Reset Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.afterCancel,name:"afterCancel",view:"richselect",labelWidth:t.labelWidthLarge,label:i("After Cancel"),on:{onChange:()=>this.onChange()}},{id:e.alignment,name:"alignment",view:"richselect",labelWidth:t.labelWidthLarge,label:i("Alignment"),options:[{id:"left",value:i("Left")},{id:"center",value:i("Center")},{id:"right",value:i("Right")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues(),n=[];this.addPagesToList(n,e.application,e.pageRoot().id);const s=n.map((e=>({id:e.id,value:e.value})));$$(t.afterCancel).define("options",s),$$(t.includeSave).setValue(null!=e.settings.includeSave?e.settings.includeSave:i.includeSave),$$(t.includeCancel).setValue(null!=e.settings.includeCancel?e.settings.includeCancel:i.includeCancel),$$(t.includeReset).setValue(null!=e.settings.includeReset?e.settings.includeReset:i.includeReset),$$(t.saveLabel).setValue(e.settings.saveLabel??""),$$(t.cancelLabel).setValue(e.settings.cancelLabel??""),$$(t.resetLabel).setValue(e.settings.resetLabel??""),$$(t.afterCancel).setValue(e.settings.afterCancel??i.afterCancel),$$(t.alignment).setValue(e.settings.alignment??i.alignment)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.includeSave=$$(e.includeSave).getValue(),i.settings.saveLabel=$$(e.saveLabel).getValue(),i.settings.includeCancel=$$(e.includeCancel).getValue(),i.settings.cancelLabel=$$(e.cancelLabel).getValue(),i.settings.includeReset=$$(e.includeReset).getValue(),i.settings.resetLabel=$$(e.resetLabel).getValue(),i.settings.afterCancel=$$(e.afterCancel).getValue(),i.settings.alignment=$$(e.alignment).getValue(),i}addPagesToList(e,t,i){t&&t.pages&&e&&(t.pages()??[]).forEach((t=>{null==t.parent&&t.id!=i||(e.push({id:t.id,value:t.label}),this.addPagesToList(e,t,t.id))}))}}}},8804:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abmobileview_form_checkbox",{}),this.AB=e}static get key(){return"mobile-checkbox"}ui(){return this.fieldsHide.required=1,super.ui([])}}}},3819:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(5303),s=i(423);function o(e){const t="properties_abmobileview_connect",i=(0,n.Z)(e),o=i.L();let a=null,r=null;return class extends i{constructor(){super(t,{addNewSettings:"",popupWidth:"",popupHeight:"",advancedOption:"",buttonFilter:"",filterConnectedValue:"",buttonSort:""}),this.AB=e,a=this.AB.filterComplexNew(`${t}_filter`),a.on("save",(()=>{this.onChange(),this.populateBadgeNumber(this.ids,this.CurrentView)})),r=(0,s.Z)(this.AB,`${t}_sort`),r.on("changed",(()=>{this.onChange(),this.populateBadgeNumber(this.ids,this.CurrentView)}))}static get key(){return"mobile-connect"}ui(){const e=this,t=this.ids,i=this.AB.UISettings.config();return super.ui([{id:t.advancedOption,view:"fieldset",name:"advancedOption",label:o("Advanced Options:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:o("Filter Options:"),width:i.labelWidthLarge},{id:t.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:o("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){e.showFilterPopup(this.$view)}}]},{rows:[{view:"label",label:o("Filter by Connected Field Value:")},{id:t.filterConnectedValue,view:"combo",name:"filterConnectedValue",options:[],on:{onChange:()=>this.onChange()}}]},{height:30},{rows:[{cols:[{view:"label",label:o("Sort Options:"),width:i.labelWidthLarge},{id:t.buttonSort,view:"button",name:"buttonSort",css:"webix_primary",label:o("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){e.showSortPopup(this.$view)}}]}]}]}}])}async init(e){this.AB=e,await super.init(e),a.init(),r.init(e)}populate(e){super.populate(e),this.populateFilterByConnectedFieldValue(e);const t=this.ids,i=[{id:null,value:""}],n=this.AB.definitionByID(e.settings.fieldId),s=this.AB.definitionByID(n.settings.linkObject),o=[];s.fieldIDs.forEach((e=>{o.push(this.AB.definitionByID(e))}));const a=e.application.connectedObjects(n.settings.linkObject);e.parent.views().forEach((t=>{if("mobile-connect"==t.key){const n=this.AB.definitionByID(t.settings.fieldId);a.forEach((s=>{if(s.id==n.settings.linkObject){let s;if(o.forEach((e=>{if(e.settings.isCustomFK&&""!=e.settings.indexField&&e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==n.settings.linkObject){s=e.id;let t=this.AB.definitionByID(e.settings.indexField);t&&(s=`${e.id}:${t.columnName}`)}else e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==n.settings.linkObject&&(s=`${e.id}:uuid`)})),s){const n=e.parent.viewComponents[t.id].ui(),o=n.rows[0]??n;i.push({id:`${o.name}:${s}`,value:o.label})}}}))}})),$$(t.filterConnectedValue).define("options",i),$$(t.filterConnectedValue).setValue(e.settings.filterConnectedValue),this.populatePopupEditors(e),this.populateBadgeNumber(t,e)}_filterCondition(e){return e?.options?.filters?.rules?.length?e.options.filters:e?.settings?.filterConditions?.rules?.length?e.settings.filterConditions:null}populatePopupEditors(e){const t=this._filterCondition(e)??this.defaultValues().filterConditions;let i;const n=e.field();n&&(i=n.datasourceLink,i&&a.fieldsLoad(i.fields(),i)),a.setValue(t),i&&r.objectLoad(i),r.setSettings(e.settings.sortFields)}populateBadgeNumber(e,t){const i=$$(e.buttonFilter),n=this._filterCondition(t);n?.rules?(i.define("badge",n.rules.length||null),i.refresh()):(i.define("badge",null),i.refresh());const s=$$(e.buttonSort);t?.settings?.sortFields?.length?(s.define("badge",t.settings.sortFields.length||null),s.refresh()):(s.define("badge",null),s.refresh())}populateFilterByConnectedFieldValue(e){const t=this.AB.definitionByID(e.settings.fieldId);if("one"==t.settings.linkType&&"many"==t.settings.linkViaType||"one"==t.settings.linkType&&"one"==t.settings.linkViaType&&t.settings.isSource){const i=this.AB.objectByID(t.settings.linkObject);if(!i)return;let n=i.fields((e=>"connectObject"==e.key));if(!n||!n.length)return;n.forEach((t=>{let i=e.parent.views((i=>{let n=this.AB.definitionByID(i.settings.fieldId);return"connect"==i.key&&i.id!=e.id&&t.settings.linkObject==n.settings.linkObject})).map((t=>{const i=e.parent.viewComponents[t.id].ui(),n=i.rows[0]??i;return{id:n.name,value:n.label}}));i&&i.length&&a.addCustomOption(t.id,{conditions:[{id:"filterByConnectValue",value:o("Filter by Connected Field Value:"),batch:"FilterByConnectedFieldValue",handler:()=>!0}],values:[{batch:"FilterByConnectedFieldValue",view:"combo",options:i}]})}))}}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.filterConnectedValue=$$(e.filterConnectedValue).getValue(),i.settings.filterConditions=a.getValue(),i.settings.sortFields=r.getSettings(),i}showFilterPopup(e){a.popUp(e,null,{pos:"top"})}showSortPopup(e){r.show(e,null,{pos:"top"})}}}},8111:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abmobileview_form_custom",{}),this.AB=e}static get key(){return"mobile-fieldcustom"}}}},698:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_abmobileview_form_date",{default:"",currentToDefault:"",dateDisplay:"",dateFormat:"",defaultDate:"",defaultDateValue:"",validateCondition:"",validateRange:"",validateRangeUnit:"",validateRangeBefore:"",validateRangeAfter:"",validateRangeBeforeLabel:"",validateRangeAfterLabel:"",validateStartDateContainer:"",validateStartDateContainerLabel:"",validateEndDateContainer:""})}static get key(){return"mobile-date"}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:i("Date Format:"),align:"right",width:s.labelWidthLarge},{view:"richselect",name:"dateFormat",id:e.dateFormat,value:2,options:[{id:2,value:"dd/mm/yyyy"},{id:3,value:"mm/dd/yyyy"},{id:4,value:"M D, yyyy"},{id:5,value:"D M, yyyy"}],on:{onChange:()=>{this.refreshDateValue(),this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default:"),align:"right",width:s.labelWidthLarge},{view:"richselect",name:"defaultDate",id:e.defaultDate,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Date")},{id:3,value:i("Specific Date")}],on:{onChange:()=>{this.defaultDateChange(),this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultDateValue",id:e.defaultDateValue,gravity:.5,disabled:!0,on:{onChange:()=>{this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{view:"label",label:"",height:10},{view:"fieldset",label:i("Validation criteria:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:i("Condition:"),align:"right",width:s.labelWidthLarge,css:"ab-text-bold"},{id:e.validateCondition,view:"select",name:"validateCondition",value:"none",options:[{id:"none",value:i("None")},{id:"dateRange",value:i("Range")},{id:"between",value:i("Between")},{id:"notBetween",value:i("Not between")},{id:"=",value:i("Equal to")},{id:"<>",value:i("Not equal to")},{id:">",value:i("Greater than")},{id:"<",value:i("Less than")},{id:">=",value:i("Greater than or Equal to")},{id:"<=",value:i("Less than or Equal to")}],on:{onChange:t=>{switch(t){case"none":$$(e.validateRange).hide(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"dateRange":$$(e.validateRange).show(),$$(e.validateStartDateContainer).hide(),$$(e.validateEndDateContainer).hide();break;case"between":case"notBetween":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Start Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).show();break;case"=":case"<>":case">":case"<":case">=":case"<=":$$(e.validateRange).hide(),$$(e.validateStartDateContainerLabel).define("label",i("Date:")),$$(e.validateStartDateContainerLabel).refresh(),$$(e.validateStartDateContainer).show(),$$(e.validateEndDateContainer).hide()}this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateRange,hidden:!0,rows:[{cols:[{view:"label",label:i("Unit:"),align:"right",width:s.labelWidthLarge},{id:e.validateRangeUnit,view:"select",name:"validateRangeUnit",options:[{id:"days",value:i("Days")},{id:"months",value:i("Months")},{id:"years",value:i("Years")}],on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh(),$$(e.validateRangeAfterLabel).refresh(),this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{cols:[{id:e.validateRangeBeforeLabel,view:"template",align:"left",borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("Before")} ${$$(e.validateRangeBefore).getValue()} ${n.value}`}},{view:"label",label:"",align:"center",width:1},{id:e.validateRangeAfterLabel,view:"template",align:"right",borderless:!0,template:()=>{let t=$$(e.validateRangeUnit).getValue(),n=$$(e.validateRangeUnit).config.options.filter((e=>e.id==t))[0];return`${i("After")} ${$$(e.validateRangeAfter).getValue()} ${n.value}`}}]},{cols:[{id:e.validateRangeBefore,view:"slider",name:"validateRangeBefore",on:{onChange:()=>{$$(e.validateRangeBeforeLabel).refresh(),this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}},{id:e.validateRangeAfter,view:"slider",name:"validateRangeAfter",on:{onChange:()=>{$$(e.validateRangeAfterLabel).refresh(),this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]},{id:e.validateStartDateContainer,hidden:!0,cols:[{id:e.validateStartDateContainerLabel,view:"label",label:i("Start Date:"),align:"right",width:s.labelWidthLarge},{name:"validateStartDate",view:"datepicker",on:{onChange:()=>{this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]},{id:e.validateEndDateContainer,hidden:!0,cols:[{view:"label",label:i("End Date:"),align:"right",width:s.labelWidthLarge},{name:"validateEndDate",view:"datepicker",on:{onChange:()=>{this.onChange()},onAfterRender:function(){t.CYPRESS_REF(this)}}}]}]}}])}defaultDateChange(){const e=this.ids,t=$$(e.defaultDate).getValue();switch(parseInt(t)){case 1:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue();break;case 2:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue(new Date),this.refreshDateValue();break;case 3:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue();break;default:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue(new Date)}}refreshDateValue(){const e=this.ids,t=$$(e.dateFormat).getValue();let i="";switch(parseInt(t)){case 1:case 2:default:i="%d/%m/%Y";break;case 3:i="%m/%d/%Y";break;case 4:i="%M %d, %Y";break;case 5:i="%d %M, %Y"}$$(e.defaultDateValue).define("format",i),$$(e.defaultDateValue).refresh()}populate(e){const t=this.ids;super.populate(e);let i=this.defaultValues();Object.keys(t).forEach((n=>{let s=$$(t[n]);if(s){let t=e.settings[n]??i[n];void 0!==t&&s.setValue?.(t)}})),$$(t.defaultDateValue).setValue(new Date(e.settings.defaultDateValue))}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i}}}},7595:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_abmobileview_form_datetime",{default:"",currentToDefault:"",dateDisplay:"",dateFormat:"",defaultDate:"",defaultDateValue:"",timeFormat:"",defaultTime:"",defaultTimeValue:"",validateCondition:"",validateRange:"",validateRangeUnit:"",validateRangeBefore:"",validateRangeAfter:"",validateRangeBeforeLabel:"",validateRangeAfterLabel:"",validateStartDateContainer:"",validateStartDateContainerLabel:"",validateEndDateContainer:""})}static get key(){return"mobile-datetime"}ui(){const t=this.ids;return super.ui([{view:"fieldset",label:i("Date:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:i("Format:"),align:"right",width:s.labelWidthLarge},{id:t.dateFormat,view:"richselect",name:"dateFormat",value:1,options:[{id:1,value:i("Ignore Date")},{id:2,value:"dd/mm/yyyy"},{id:3,value:"mm/dd/yyyy"},{id:4,value:"M D, yyyy"},{id:5,value:"D M, yyyy"}],on:{onChange:()=>{this.refreshDateValue(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default:"),align:"right",width:s.labelWidthLarge},{view:"richselect",name:"defaultDate",id:t.defaultDate,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Date")},{id:3,value:i("Specific Date")}],on:{onChange:()=>{this.defaultDateChange(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultDateValue",id:t.defaultDateValue,gravity:.5,disabled:!0,on:{onChange:()=>{this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]},{view:"label",label:i("Validation criteria:"),css:"ab-text-bold"},{cols:[{view:"label",label:i("Condition:"),align:"right",width:s.labelWidthLarge,css:"ab-text-bold"},{id:t.validateCondition,view:"select",name:"validateCondition",value:"none",options:[{id:"none",value:i("None")},{id:"dateRange",value:i("Range")},{id:"between",value:i("Between")},{id:"notBetween",value:i("Not between")},{id:"=",value:i("Equal to")},{id:"<>",value:i("Not equal to")},{id:">",value:i("Greater than")},{id:"<",value:i("Less than")},{id:">=",value:i("Greater than or Equal to")},{id:"<=",value:i("Less than or Equal to")}],on:{onChange:e=>{switch(e){case"none":$$(t.validateRange).hide(),$$(t.validateStartDateContainer).hide(),$$(t.validateEndDateContainer).hide();break;case"dateRange":$$(t.validateRange).show(),$$(t.validateStartDateContainer).hide(),$$(t.validateEndDateContainer).hide();break;case"between":case"notBetween":$$(t.validateRange).hide(),$$(t.validateStartDateContainerLabel).define("label",i("Start Date:")),$$(t.validateStartDateContainerLabel).refresh(),$$(t.validateStartDateContainer).show(),$$(t.validateEndDateContainer).show();break;case"=":case"<>":case">":case"<":case">=":case"<=":$$(t.validateRange).hide(),$$(t.validateStartDateContainerLabel).define("label",i("Date:")),$$(t.validateStartDateContainerLabel).refresh(),$$(t.validateStartDateContainer).show(),$$(t.validateEndDateContainer).hide()}this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]},{id:t.validateRange,hidden:!0,rows:[{cols:[{view:"label",label:i("Unit:"),align:"right",width:s.labelWidthLarge},{id:t.validateRangeUnit,view:"select",name:"validateRangeUnit",options:[{id:"days",value:i("Days")},{id:"months",value:i("Months")},{id:"years",value:i("Years")}],on:{onChange:()=>{$$(t.validateRangeBeforeLabel).refresh(),$$(t.validateRangeAfterLabel).refresh(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{id:t.validateRangeBeforeLabel,view:"template",align:"left",width:140,borderless:!0,template:()=>{let e=$$(t.validateRangeUnit).getValue(),n=$$(t.validateRangeUnit).config.options.filter((t=>t.id==e))[0];return`${i("Before")} ${$$(t.validateRangeBefore).getValue()} ${n.value}`}},{view:"label",label:"",align:"center"},{id:t.validateRangeAfterLabel,view:"template",align:"right",borderless:!0,template:()=>{let e=$$(t.validateRangeUnit).getValue(),n=$$(t.validateRangeUnit).config.options.filter((t=>t.id==e))[0];return`${i("After")} ${$$(t.validateRangeAfter).getValue()} ${n.value}`}}]},{cols:[{id:t.validateRangeBefore,view:"slider",name:"validateRangeBefore",on:{onChange:()=>{$$(t.validateRangeBeforeLabel).refresh(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}},{id:t.validateRangeAfter,view:"slider",name:"validateRangeAfter",on:{onChange:()=>{$$(t.validateRangeAfterLabel).refresh(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]}]},{id:t.validateStartDateContainer,hidden:!0,cols:[{id:t.validateStartDateContainerLabel,view:"label",label:i("Start Date:"),align:"right",width:s.labelWidthLarge},{name:"validateStartDate",view:"datepicker",om:{onChange:()=>{this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]},{id:t.validateEndDateContainer,hidden:!0,cols:[{view:"label",label:i("End Date:"),align:"right",width:s.labelWidthLarge},{name:"validateEndDate",view:"datepicker",on:{onChange:()=>{this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]}]}},{view:"fieldset",label:i("Time:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:i("Format:"),align:"right",width:s.labelWidthLarge},{view:"richselect",name:"timeFormat",id:t.timeFormat,value:2,options:[{id:2,value:i("HH:MM AM/PM")},{id:3,value:i("HH:MM (military)")}],on:{onChange:()=>{this.refreshTimevalue(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]},{cols:[{view:"label",label:i("Default Time:"),align:"right",width:s.labelWidthLarge},{view:"richselect",name:"defaultTime",id:t.defaultTime,value:1,options:[{id:1,value:i("None")},{id:2,value:i("Current Time")},{id:3,value:i("Specific Time")}],on:{onChange:()=>{this.defaultTimeChange(),this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}},{view:"datepicker",name:"defaultTimeValue",type:"time",id:t.defaultTimeValue,gravity:.5,disabled:!0,on:{onChange:()=>{this.onChange()},onAfterRender:function(){e.ClassUI.CYPRESS_REF(this)}}}]}]}}])}defaultDateChange(){const e=this.ids,t=$$(e.defaultDate).getValue();switch(parseInt(t)){case 1:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue();break;case 2:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue(new Date),this.refreshDateValue();break;case 3:$$(e.defaultDateValue).enable(),$$(e.defaultDateValue).setValue();break;default:$$(e.defaultDateValue).disable(),$$(e.defaultDateValue).setValue(new Date)}}refreshDateValue(){const e=this.ids,t=$$(e.dateFormat).getValue();let i="";switch(parseInt(t)){case 1:case 2:default:i="%d/%m/%Y";break;case 3:i="%m/%d/%Y";break;case 4:i="%M %d, %Y";break;case 5:i="%d %M, %Y"}$$(e.defaultDateValue).define("format",i),$$(e.defaultDateValue).refresh()}defaultTimeChange(){const e=this.ids;switch(parseInt($$(e.defaultTime).getValue())){case 1:default:$$(e.defaultTimeValue).disable(),$$(e.defaultTimeValue).setValue();break;case 2:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue(new Date);break;case 3:$$(e.defaultTimeValue).enable(),$$(e.defaultTimeValue).setValue()}this.refreshTimevalue()}refreshTimevalue(){const e=this.ids;let t="";switch(parseInt($$(e.timeFormat).getValue())){case 2:default:t="%h:%i %A";break;case 3:t="%H:%i"}$$(e.defaultTimeValue).define("format",t),$$(e.defaultTimeValue).refresh()}populate(e){const t=this.ids;super.populate(e);let i=this.defaultValues();Object.keys(t).forEach((n=>{let s=$$(t[n]);if(s){let t=e.settings[n]??i[n];void 0!==t&&s.setValue?.(t)}})),$$(t.defaultDateValue).setValue(new Date(e.settings.defaultDateValue)),$$(t.defaultTimeValue).setValue(new Date(e.settings.defaultTimeValue))}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i}}}},7119:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_abmobileview_form_email",{default:"",defaultCheckbox:""})}static get key(){return"mobile-email"}ui(){const t=this.ids;return super.ui([{cols:[{view:"label",label:i("Default Value:"),align:"right",width:s.labelWidthLarge},{id:t.defaultCheckbox,view:"checkbox",width:30,value:0,on:{onChange:e=>{this.checkboxDefaultValue(e),this.onChange()},onAfterRender:()=>{e.ClassUI.CYPRESS_REF(this)}}},{view:"text",id:t.default,name:"default",placeholder:i("Enter default value"),disabled:!0,labelWidth:s.labelWidthXLarge,on:{onChange:()=>{this.isValid(),this.onChange()},onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}])}checkboxDefaultValue(e){0===e?($$(this.ids.default).disable(),$$(this.ids.default).setValue("")):$$(this.ids.default).enable()}isValid(){const e=this.ids;let t=super.isValid();if($$(e.component).clearValidation(),t){const n=$$(e.required).getValue(),s=$$(e.default).getValue();n||s?webix.rules.isEmail(s)?t=!0:($$(e.component).markInvalid("default",i("This email is invalid")),t=!1):t=!0}return t}populate(e){const t=this.ids;super.populate(e);let i=this.defaultValues();Object.keys(t).forEach((n=>{let s=$$(t[n]);if(s){let t=e.settings[n]??i[n];void 0!==t&&s.setValue?.(t)}})),""===e.settings.default?$$(t.defaultCheckbox).setValue(0):$$(t.defaultCheckbox).setValue(1),this.isValid()}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i}}}},8904:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8111);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abmobileview_form_file",{}),this.AB=e}static get key(){return"mobile-file"}}}},2425:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(1511);function s(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abmobileview_form_formula",{}),this.AB=e}static get key(){return"mobile-formula"}}}},2724:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8111);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abmobileview_form_image",{}),this.AB=e}static get key(){return"mobile-image"}}}},5303:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(9018);function s(e){const t=(0,n.Z)(e),i=t.L(),s={required:0,disable:0};return class extends t{constructor(t,i={}){super(t,Object.assign(i,{field:"",required:"",disable:""})),this.AB=e}ui(e=[],t={}){const n=this.ids,s=this.AB.UISettings.config(),o=[{id:n.field,name:"fieldLabel",view:"text",disabled:!0,label:i("Field"),hidden:!!this.fieldsHide.field},{id:n.required,name:"required",view:"checkbox",labelWidth:s.labelWidthCheckbox,labelRight:i("Required"),click:()=>this.onChange(),hidden:!!this.fieldsHide.required},{id:n.disable,name:"disable",view:"checkbox",labelWidth:s.labelWidthCheckbox,labelRight:i("Disable"),click:()=>this.onChange(),hidden:!!this.fieldsHide.disable}].concat(e);return super.ui(o,t)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues(),n=e.field();$$(t.field).setValue(n?n.label:""),1==n?.settings?.required?($$(t.required).setValue(n.settings.required),$$(t.required).disable()):$$(t.required).setValue(null!=e.settings?.required?e.settings.required:i.required),1==e.settings?.disable?$$(t.disable).setValue(e.settings.disable):$$(t.disable).setValue(i.disable)}defaultValues(){const e=this.ViewClass();let t={};return e&&(t=e.defaultValues()),Object.assign(s,t)}values(){const e=this.ids,t=super.values()??{};return t.settings=t.settings??{},t.settings.required=$$(e.required).getValue(),t.settings.disable=$$(e.disable).getValue(),t}}}},82:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_number",{isStepper:""}),this.AB=e}static get key(){return"mobile-numberbox"}ui(){const e=this.ids,t=this.AB.UISettings.config();return super.ui([{id:e.isStepper,name:"isStepper",view:"checkbox",labelWidth:t.labelWidthCheckbox,labelRight:i("Plus/Minus Buttons"),on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.isStepper).setValue(null!=e.settings.isStepper?e.settings.isStepper:i.isStepper)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.isStepper=$$(e.isStepper).getValue(),i}}}},1511:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8111);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abmobileview_form_readonly",{}),this.AB=e}static get key(){return"mobile-fieldreadonly"}ui(){return this.fieldsHide.required=1,this.fieldsHide.disable=1,super.ui([])}}}},7041:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abmobileview_form_select_multiple",{type:""}),this.AB=e}static get key(){return"mobile-selectmultiple"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"richselect",label:i("Type"),options:[{id:"multicombo",value:i("Multi Combo")},{id:"checkbox",value:i("Checkboxes")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}}}},5496:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abmobileview_form_select_single",{type:""}),this.AB=e}static get key(){return"mobile-selectsingle"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"richselect",label:i("Type"),options:[{id:"richselect",value:i("Select list")},{id:"radio",value:i("Radio")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}}}},2857:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(5303);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abmobileview_form_textbox",{type:"",placeholder:""}),this.AB=e}static get key(){return"mobile-textbox"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"radio",label:i("Type"),vertical:!0,options:[{id:"single",value:i("Single line")},{id:"multiple",value:i("Multiple lines")},{id:"rich",value:i("Rich editor")}],on:{onChange:()=>this.onChange()}},{id:e.placeholder,name:"placeholder",view:"text",label:i("Placeholder"),placeholder:i("Text Placeholder"),on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type),$$(t.placeholder).setValue(e.settings.placeholder||i.placeholder)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i}}}},6088:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(9018);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abmobileview_label",{text:"",format:"",alignment:""}),this.AB=e}static get key(){return"mobile-label"}ui(){const e=this.defaultValues(),t=this.ids;return super.ui([{id:t.text,view:"text",name:"text",label:i("Text"),placeholder:i("Text Placeholder"),on:{onChange:(e,t)=>{if(e!==t){const t=this.CurrentView;t.text=e,t.save(),this.onChange()}}}},{view:"fieldset",label:i("Format Options:"),body:{type:"clean",padding:10,rows:[{id:t.format,view:"radio",name:"format",vertical:!0,value:e.format,options:[{id:0,value:i("normal")},{id:1,value:i("title")},{id:2,value:i("description")}],on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:i("Alignment:"),body:{type:"clean",padding:10,rows:[{id:t.alignment,view:"radio",name:"alignment",vertical:!0,value:e.alignment,options:[{id:"left",value:i("Left")},{id:"center",value:i("Center")},{id:"right",value:i("Right")}],on:{onChange:()=>{this.onChange()}}}]}},{}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids;$$(t.text).setValue(e.text),$$(t.format).setValue(e.settings.format),$$(t.alignment).setValue(e.settings.alignment)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i.text=i.settings.text,i}}}},4710:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(9018);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.UISettings.config();return class extends t{constructor(){super("properties_abmobileview_list",{datacollection:"",field:"",height:"",hideTitle:"",linkPageAdd:"",linkPageDetail:""})}static get key(){return"mobile-list"}ui(){const e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.propertyUpdateFieldOptions(e),this.onChange())}}},{id:e.field,name:"field",view:"richselect",label:i("Field"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:i("Height:"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.hideTitle,view:"checkbox",name:"hideTitle",label:i("Hide Title:"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"fieldset",label:i("Linked Pages:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.linkPageAdd,view:"combo",clear:!0,placeholder:i("No linked view"),name:"linkPageAdd",label:i("Add Page:"),labelWidth:s.labelWidthLarge,options:[],on:{onChange:()=>this.onChange()}},{id:e.linkPageDetail,view:"combo",clear:!0,placeholder:i("No linked view"),name:"linkPageDetail",label:i("Edit/Detail Page:"),labelWidth:s.labelWidthLarge,options:[],on:{onChange:()=>this.onChange()}}]}}])}async init(e){this.AB=e,await super.init(e)}propertyUpdateFieldOptions(e){var t=this.AB.datacollectionByID(e),i=t?t.datasource:null,n=[];null!=i&&(n=i.fields().map((e=>({id:e.id,value:e.label}))));const s=this.ids;$$(s.field).define("options",n),$$(s.field).refresh()}populate(e){super.populate(e);const t=this.ids;var i=e.settings.dataviewID?e.settings.dataviewID:null,n=$$(t.datacollection),s=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));n.define("options",s),n.define("value",i),n.refresh(),this.propertyUpdateFieldOptions(i),$$(t.field).setValue(e.settings.field),$$(t.height).setValue(e.settings.height);let o=this.pagesRelevant(e,"mobile-form",i),a=$$(t.linkPageAdd);a.define("options",o),a.define("value",e.settings.linkPageAdd),a.refresh();let r=$$(t.linkPageDetail);r.define("options",o),r.define("value",e.settings.linkPageDetail),r.refresh()}_filterWidgetAndDC(e,t,i){let n=e.datacollection;return e.key==t&&(n?.id==i||n?.datacollectionFollow?.id==i)}pagesRelevant(e,t,i){let n=[],s=e.parent;return s&&(n=n.concat(s.pages((e=>e.views((e=>this._filterWidgetAndDC(e,t,i)),!0).length),!0).map((e=>({id:e.id,value:e.label}))))),n=n.concat(e.pageRoot().pages((e=>e.views((e=>this._filterWidgetAndDC(e,t,i)),!0).length),!0).filter((e=>!n.find((t=>e.id==t.id)))).map((e=>{let t=e.parent;return{id:e.id,value:t?`${t.label} -> ${e.label}`:e.label}}))),n}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i}}}},9190:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(9018),s=i(3285);function o(e){const t=(0,n.Z)(e),i=function(e,t){t=t||"ui_common_label_template"+e.jobID();const i=(0,s.Z)(e);var n=i.L();return new class extends i{constructor(e){super(e,{format:"",list:"",buttonSave:""}),this.labelFormat=""}ui(){let e=this.ids;return{view:"popup",id:e.component,modal:!0,autoheight:!0,width:500,body:{rows:[{view:"label",label:n("<b>Label format</b>")},{view:"textarea",id:e.format,height:100},{view:"label",label:n("Select field item to generate format.")},{view:"label",label:n("<b>Fields</b>")},{view:"list",name:"columnList",id:e.list,width:500,height:180,maxHeight:180,select:!1,template:"#label#",on:{onItemClick:(e,t,i)=>{this.onItemClick(e,t,i)}}},{height:10},{cols:[{fillspace:!0},{view:"button",name:"cancel",value:n("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",id:e.buttonSave,label:n("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}}]}]},on:{onShow:()=>{this.onShow()}}}}init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.list),webix.ProgressBar)}buttonCancel(){$$(this.ids.component).hide()}async buttonSave(){var e=this.ids,t=$$(e.buttonSave);t.disable();var i=$$(e.format).getValue(),n=$$(e.list);n.showProgress({type:"icon"}),n.data.each((function(e){i=i.replace(new RegExp("{"+e.label+"}","g"),"{"+e.id+"}")})),this.labelFormat=i,this.emit("save",i),n.hideProgress(),t.enable(),this.hide()}hide(){$$(this.ids.component).hide()}setLabelFormat(e){this.labelFormat=e}objectLoad(e){super.objectLoad(e);var t=$$(this.ids.list);t.clearAll();var i=e.fields((e=>e.fieldUseAsLabel())).map((e=>({id:e.id,label:e.label})));t.parse(i),t.refresh()}onItemClick(e){var t=this.ids,i=$$(t.list).getItem(e),n=$$(t.format).getValue();n+=`{${i.label}}`,$$(t.format).setValue(n)}onShow(){var e=this.ids,t=this.labelFormat,i=$$(e.format),n=$$(e.list);if(i.setValue(""),i.enable(),n.enable(),$$(e.buttonSave).enable(),t)n.data?.count()>0&&n.data.each((function(e){t=t.replace(new RegExp(`{${e.id}}`,"g"),`{${e.label}}`)}));else if(n.data?.count()>0){var s=n.getItem(n.getFirstId());t=`{${s.label}}`}i.setValue(t||"")}show(e){$$(this.ids.component).show(e)}}(t)}(e),o=t.L(),a=e.UISettings.config();return class extends t{constructor(){super("properties_abmobileview_timeline",{datacollection:"",dateField:"",hideTitle:"",linkPageAdd:"",linkPageDetail:""})}static get key(){return"mobile-timeline"}ui(){const e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"richselect",label:o("Data Source"),labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.onChangeDC(e),this.onChange())}}},{id:e.dateField,name:"dateField",view:"richselect",label:o("Date Field"),labelWidth:a.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.hideTitle,view:"checkbox",name:"hideTitle",label:o("Hide Title:"),labelWidth:a.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.itemTemplate,view:"button",type:"icon",icon:"fa-regular fa-pen-to-square",label:o("Item Template"),click:function(){i.show(this.$view)}},{view:"fieldset",label:o("Linked Pages:"),labelWidth:a.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.linkPageAdd,view:"combo",clear:!0,placeholder:o("No linked view"),name:"linkPageAdd",label:o("Add Page:"),labelWidth:a.labelWidthLarge,options:[],on:{onChange:()=>this.onChange()}},{id:e.linkPageDetail,view:"combo",clear:!0,placeholder:o("No linked view"),name:"linkPageDetail",label:o("Edit/Detail Page:"),labelWidth:a.labelWidthLarge,options:[],on:{onChange:()=>this.onChange()}}]}}])}async init(e){this.AB=e,i.init(e),i.on("save",(()=>{this.onChange()})),await super.init(e)}onChangeDC(e){var t=this.AB.datacollectionByID(e),n=t?t.datasource:null;n&&i.objectLoad(n),this.propertyUpdateFieldOptions(e)}propertyUpdateFieldOptions(e){var t=this.AB.datacollectionByID(e),i=t?t.datasource:null,n=[];null!=i&&(n=i.fields().map((e=>({id:e.id,value:e.label}))));const s=this.ids;$$(s.dateField).define("options",n),$$(s.dateField).refresh()}populate(e){super.populate(e);const t=this.ids;var n=e.settings.dataviewID?e.settings.dataviewID:null,s=$$(t.datacollection),o=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));s.define("options",o),s.define("value",n),s.refresh(),this.propertyUpdateFieldOptions(n),$$(t.dateField).setValue(e.settings.dateField);let a=$$(t.hideTitle);e.settings.hideTitle?a.define("value",1):a.define("value",0),a.refresh();let r=this.AB.datacollectionByID(n)?.datasource;r&&i.objectLoad(r),e.settings.templateItem||(e.settings.templateItem='\n<div class="timeline-item-title">\n   <small>\n      {Title}\n   </small>\n   <div class="item-footer"></div>\n</div>\n<div class="item-after">\n   <small\n      >{Secondary Item}</small>\n</div>'),i.setLabelFormat(e.settings.templateItem);let l=this.pagesRelevant(e,"mobile-form",n),c=$$(t.linkPageAdd);c.define("options",l),c.define("value",e.settings.linkPageAdd),c.refresh();let h=$$(t.linkPageDetail);h.define("options",l),h.define("value",e.settings.linkPageDetail),h.refresh()}_filterWidgetAndDC(e,t,i){let n=e.datacollection;return e.key==t&&(n?.id==i||n?.datacollectionFollow?.id==i)}pagesRelevant(e,t,i){let n=[],s=e.parent;return s&&(n=n.concat(s.pages((e=>e.views((e=>this._filterWidgetAndDC(e,t,i)),!0).length),!0).map((e=>({id:e.id,value:e.label}))))),n=n.concat(e.pageRoot().pages((e=>e.views((e=>this._filterWidgetAndDC(e,t,i)),!0).length),!0).filter((e=>!n.find((t=>e.id==t.id)))).map((e=>{let t=e.parent;return{id:e.id,value:t?`${t.label} -> ${e.label}`:e.label}}))),n}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),n=super.values();return n.settings=t.getValues(),n.settings.templateItem=i.labelFormat,n}}}},2607:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_end",{name:""})}static get key(){return"End"}ui(){let e=this.ids;return{id:e.component,rows:[{view:"label",label:i("Terminate End Event")},{view:"label",label:i("Stops the flow of the process.")},{view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""}]}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids;$$(t.name).setValue(e.name)}values(){const e={},t=this.ids;return e.label=$$(t.name)?.getValue(),e}}}},5732:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_gateway_exclusive",{name:"",buttonFilter:""})}static get key(){return"GatewayExclusive"}ui(){let e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name"}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids,n=this.ui();this._element=e;const s=(e.process.processDataFields(e)||[]).map((e=>e.field)).filter((e=>e)),o=e.process.connectionsOutgoing(e.diagramID);this.__dfLookup={},this.conditions=e.conditions||this.conditions||{},o.forEach((s=>{const o=this.conditions[s.id]||{},a=e.process.elementForDiagramID(s.to);let r;this.__dfLookup[s.id]||(r=this.AB.filterComplexNew(`${t.component}_${s.id}_filter`),r.myPopup=webix.ui({view:"popup",height:240,width:480,hidden:!0,body:r.ui}),r.init(),r.on("save",(()=>{const e=r.getValue(),i=$$(`${t.buttonFilter}_${s.id}`);i.define("badge",e.rules?.length||null),i.refresh()})),this.__dfLookup[s.id]=r),r=this.__dfLookup[s.id];const l={view:"fieldset",label:i("to {0}",[a?a.name:i("unlabeled Task({0})",[s.id])]),body:{rows:[{id:`${t.component}_${s.id}_label`,view:"text",label:i("Label"),value:o.label||""},{id:`${t.buttonFilter}_${s.id}`,css:"webix_primary",view:"button",label:i("Add Filter"),icon:"fa fa-gear",type:"icon",badge:o.filterValue?.rules?.length||null,click:function(){r.popUp(this.$view,null,{pos:"top"})}}]}};n.elements.push(l)})),webix.ui(n,$$(t.component)),$$(t.component).show(),o.forEach((e=>{const t=this.conditions[e.id]||{},i=this.__dfLookup[e.id];i.fieldsLoad(s),t.filterValue&&i.setValue(t.filterValue),i.init()})),$$(t.name).setValue(e.name)}values(){let e={};const t=this.ids;return e.label=$$(t.name)?.getValue(),e.name=e.label,e.conditions={},this._element.process.connectionsOutgoing(this._element.diagramID).forEach((i=>{if(e.conditions[i.id]={},e.conditions[i.id].label=$$(`${t.component}_${i.id}_label`).getValue(),this.__dfLookup&&this.__dfLookup[i.id]){const t=this.__dfLookup[i.id];e.conditions[i.id].filterValue=t.getValue()}})),e}}}},7670:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),a=(0,s.Z)(e);return class extends t{constructor(){super("properties_process_participant",{name:"",users:""}),this.users=new a(this.ids.component+"_users_")}static get key(){return"process.participant"}uiUser(e){const t=this.users.ui(e??{});return{id:this.ids.users,rows:[t],paddingY:10}}ui(e){let t=this.ids,n={id:t.component,rows:[{view:"label",label:i("Process Participant:")},{view:"label",label:i("This element defines a group of users that are responsible for the tasks contained within.")},{view:"form",id:t.form,elements:[{id:t.name,view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:this.name}]}]},s={id:t.users};return e?.laneIDs&&0==e?.laneIDs.length&&(s=this.uiUser(e??{})),n.rows[2].elements.push(s),n}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids;if($$(t.name).setValue(e.name),e.laneIDs&&0==e.laneIDs.length){const i=this.uiUser(e??{});webix.ui(i,$$(t.users))}}values(){const e={},t=this.ids;e.label=$$(t.name).getValue();const i=this.users.values();return Object.keys(i).forEach((t=>{e[t]=i[t]})),e}}}},5178:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),s=i(8788);function o(e){const t=(0,n.Z)(e),i=(0,s.Z)(e);var o=t.L();return class extends i{constructor(t){super(t,{useField:"",fields:"",userField:"",buttonFilter:""}),this.AB=e,this.filterComponent=this.AB.filterComplexNew(`${this.ids.component}_filter`,e),this.filterComponent.init({isProcessParticipant:!0}),this.filterComponent.on("save",(e=>{this.populateBadgeNumber(e)}))}ui(e={}){const i=e.toUsers??e,n=super.ui(i),s=i.filterConditions||{glue:"and",rules:[]},a=e.process?.processDataFields(e)?.map((e=>e.field))||[];this.filterComponent.fieldsLoad(a.filter((e=>e))),this.filterComponent.setValue(s);const r=i.userProcessFieldData?.map((e=>({uuid:e.field.id,id:e.key,value:e.label,key:e.key})))||[],l=this.ids,c=[{},{cols:[{view:"checkbox",id:this.ids.useField,width:34,labelWidth:0,value:"1"==i.useField?1:0,click:function(e){$$(e).getValue()?$$(l.userField).enable():$$(l.userField).disable()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"label",label:o("by Field"),width:88},{view:"multicombo",id:this.ids.userField,value:i.userFields?i.userFields:0,disabled:"1"!=i.useField,suggest:{body:{yCount:4,data:r,on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${l.userField}_${e.id}`)}))},onItemClick:function(e){var t=$$(l.userField),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},placeholder:o("Click to add User"),labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){h.filterComponent.emit("save",s),t.CYPRESS_REF(this.getNode(),l.userField)},onChange:()=>{$$(this.ids.userField).getList().callEvent("onAfterRender")}}}]}],h=this;return n.elements.push(...c,{id:l.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:o("Scope query"),type:"icon",badge:0,click:function(){h.filterComponent.popUp(this.$view,null,{pos:"top"})}}),n}async init(e){this.AB=e}populateBadgeNumber(e={}){const t=this.ids,i=$$(t.buttonFilter);e.rules?(i.define("badge",e.rules?.length||null),i.refresh()):(i.define("badge",null),i.refresh())}values(){const e=super.values(),t=this.ids;return $$(t.useField)&&(e.useField=$$(t.useField).getValue()),$$(t.useField)?e.userFields=$$(t.userField).getValue():e.userFields=[],e.filterConditions=this.filterComponent.getValue(),e}}}},3412:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),a=(0,s.Z)(e);return class extends t{constructor(){super("properties_process_email",{name:"",to:"",from:"",subject:"",fromUser:"",toUser:"",message:"",toCustom:"",toCustomFields:"",fromCustom:"",fromCustomFields:"",customFrom:"",toEmailForm:"",fromEmailForm:""}),this.toUser=new a(this.ids.component+"_to_"),this.fromUser=new a(this.ids.component+"_from_")}static get key(){return"Email"}ui(e){const n=this.toUser.ui(e?.toUsers??{}),s=this.fromUser.ui(e?.fromUsers??{});let a=this.ids;return{id:a.component,rows:[{view:"label",label:i("Send Email:")},{view:"label",label:i("Generate an Email message to be sent.")},{view:"form",elements:[{id:a.name,view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:this.name},{id:a.to,view:"select",label:i("To"),name:"to",value:this.to,options:[{id:0,value:i("Next Participant")},{id:1,value:i("Select Role or User")},{id:2,value:i("Custom")}],on:{onChange:e=>{1==parseInt(e)?($$(a.toUser).show(),$$(a.toEmailForm).hide()):2==parseInt(e)?($$(a.toUser).hide(),$$(a.toEmailForm).show()):($$(a.toUser).hide(),$$(a.toEmailForm).hide())}}},{id:a.toUser,rows:[n],paddingY:10,hidden:1!=parseInt(this.to)},{id:a.toEmailForm,name:"toEmailForm",type:"form",css:"no-margin",rows:[{id:a.toCustom,view:"text",label:i("Email"),placeholder:i("Type email address here..."),name:"toCustom",value:this.toCustom},{id:a.toCustomFields,label:i("toCustomFields"),name:"toCustomFields",value:this.toCustomFields,view:"multicombo",placeholder:i("..."),suggest:{body:{data:[],on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${a.toCustomFields}_${e.id}`)}))},onItemClick:function(e){const t=$$(a.toCustomFields),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),a.toCustomFields)},onChange:()=>{$$(this.ids.toCustomFields).getList().callEvent("onAfterRender")}}}],hidden:2!=parseInt(this.to)},{id:a.from,view:"select",label:i("From"),name:"from",value:this.from,options:[{id:0,value:i("Current Participant")},{id:1,value:i("Select Role or User")},{id:2,value:i("Custom")}],on:{onChange:e=>{1==parseInt(e)?($$(a.fromUser).show(),$$(a.fromEmailForm).hide()):2==parseInt(e)?($$(a.fromUser).hide(),$$(a.fromEmailForm).show()):($$(a.fromUser).hide(),$$(a.fromEmailForm).hide())}}},{id:a.fromUser,rows:[s],paddingY:10,hidden:1!=parseInt(this.from)},{id:a.fromEmailForm,name:"fromEmailForm",type:"form",css:"no-margin",rows:[{id:a.fromCustom,view:"text",label:i("Email"),placeholder:i("Type email address here..."),name:"fromCustom",value:this.fromCustom},{id:a.fromCustomFields,view:"multicombo",label:i("Process"),placeholder:i("..."),name:"fromCustomFields",suggest:{body:{data:[],on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${a.fromCustomFields}_${e.id}`)}))},onItemClick:function(e){const t=$$(a.fromCustomFields),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},labelAlign:"left",value:this.fromCustomFields,stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),a.fromCustomFields)},onChange:()=>{$$(this.ids.fromCustomFields).getList().callEvent("onAfterRender")}}}],hidden:2!=parseInt(this.from)},{id:a.subject,view:"text",label:i("Subject"),name:"subject",value:this.subject},{view:"spacer",height:10},{id:a.message,view:"tinymce-editor",label:i("Message"),name:"message",value:this.message,borderless:!0,minHeight:500,config:{plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"}}]}]}}async init(e){return this.AB=e,Promise.resolve()}applicationLoad(e){super.applicationLoad(e)}processLoad(e){super.processLoad(e),this.process=e}populate(e){let t=this.ids;e.toUsers=e.toUsers??{},e.fromUsers=e.fromUsers??{};const i=e.process.processDataFields(e)||[];let n=i.filter((e=>"user"==e.field?.key));e.toUsers.userProcessFieldData=n,e.fromUsers.userProcessFieldData=n;let s=i.filter((e=>"email"==e.field?.key)).map((e=>({uuid:e.field.id,id:e.key,value:e.label,key:e.key})));$$(t.name).setValue(e.name),$$(t.to).setValue(e.to),$$(t.from).setValue(e.from),$$(t.subject).setValue(e.subject),$$(t.message).setValue(e.message),$$(t.toCustom).setValue(e.toCustom),$$(t.fromCustom).setValue(e.fromCustom),$$(t.fromCustomFields).options_setter(s),$$(t.fromCustomFields).refresh(),$$(t.fromCustomFields).setValue(e.fromCustomFields),$$(t.toCustomFields).options_setter(s),$$(t.toCustomFields).refresh(),$$(t.toCustomFields).setValue(e.toCustomFields);let o=this.toUser.ui(e.toUsers??{}),a={id:t.toUser,rows:[o],paddingY:10,hidden:1!=parseInt(e.to)};webix.ui(a,$$(t.toUser));let r=this.fromUser.ui(e.fromUsers??{}),l={id:t.fromUser,rows:[r],paddingY:10,hidden:1!=parseInt(e.from)};webix.ui(l,$$(t.fromUser))}values(){const e={},t=this.ids;return e.label=$$(t.name).getValue(),e.to=$$(t.to).getValue(),e.from=$$(t.from).getValue(),e.subject=$$(t.subject).getValue(),e.message=$$(t.message).getValue(),e.toCustom=$$(t.toCustom).getValue(),e.toCustomFields=$$(t.toCustomFields).getValue(),e.fromCustom=$$(t.fromCustom).getValue(),e.fromCustomFields=$$(t.fromCustomFields).getValue(),e.toUsers=this.toUser.values(),e.fromUsers=this.fromUser.values(),e}}}},6692:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings(),o=e.Class.ABProcessTaskManager;class a extends t{constructor(){super("properties_process_service",{name:"",option:""})}static get key(){return"TaskService"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:e.option,rows:[{view:"button",label:i("Accounting: Process Batch"),click:()=>{this.switchTo("AccountingBatchProcessing")}},{view:"button",label:i("Accounting: Fiscal Period Close"),click:()=>{this.switchTo("AccountingFPClose")}},{view:"button",label:i("Accounting: Fiscal Period Year Close"),click:()=>{this.switchTo("AccountingFPYearClose",e.component)}},{view:"button",label:i("Accounting: Journal Entry Archive"),click:()=>{this.switchTo("AccountingJEArchive")}},{view:"button",label:i("Query Task"),click:()=>{this.switchTo("TaskServiceQuery")}},{view:"button",label:i("Insert Record Task"),click:()=>{this.switchTo("InsertRecord")}},{view:"button",label:i("Calculate Task"),click:()=>{this.switchTo("Calculate")}},{view:"button",label:i("Get Reset Password Url"),click:()=>{this.switchTo("GetResetPasswordUrl")}}]}]}}async init(e){return this.AB=e,Promise.resolve()}switchTo(e){const t=this.ids,i=this.values();i.id=this.element.id,i.diagramID=this.element.diagramID,i.key=e??a.key;const n=o.newTask(i,this.element.process,this.AB)??null;n&&this.element.switchTo(n,t.component)}values(){const e=this.ids;let t={};const i=$$(e.name);return t.label=i?.getValue()??"",t.name=i?.getValue()??"",t}populate(e){const t=this.ids,i=$$(t.name);this.element=e,i?.setValue(e.label??"")}}return a}},9941:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8317);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_accounting_batch_processing",{form:"",label:"",processBatchValue:"",objectBatch:"",fieldBatchEntries:"",fieldBatchFinancialPeriod:"",objectJE:"",fieldJEAccount:"",fieldJERC:"",fieldJEStatus:"",fieldJEStatusComplete:"",objectBR:"",fieldBRFinancialPeriod:"",fieldBRAccount:"",fieldBRRC:"",fieldBREntries:""}),this.element=null}static get key(){return"AccountingBatchProcessing"}ui(){const e=this.ids;return{id:e.form,view:"form",elementsConfig:{labelWidth:s.labelWidthXXLarge},elements:[{id:e.label,view:"text",label:i("Name"),name:"label"},{id:e.processBatchValue,view:"select",label:i("Process Batch Value"),name:"processBatchValue",options:[]},{id:e.objectBatch,view:"select",label:i("Batch Object"),name:"objectBatch",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e);this._updateFieldOptions(this._optionsBatch,i)}}},{id:e.fieldBatchEntries,view:"select",label:i("Batch->JE[]"),name:"fieldBatchEntries",options:[],hidden:!0},{id:e.fieldBatchFinancialPeriod,view:"select",label:i("Batch->FinancialPeriod"),name:"fieldBatchFinancialPeriod",options:[],hidden:!0},{id:e.objectJE,view:"select",label:i("Journal Entry Object"),name:"objectJE",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e);this._updateFieldOptions(this._optionsJE,i)}}},{id:e.fieldJEAccount,view:"select",label:i("JE->Account"),name:"fieldJEAccount",options:[],hidden:!0},{id:e.fieldJERC,view:"select",label:i("JE->RC"),name:"fieldJERC",options:[],hidden:!0},{id:e.fieldJEStatus,view:"select",label:i("JE->Status"),name:"fieldJEStatus",options:[],hidden:!0,on:{onChange:(e,t)=>{e!=t&&this._changeStatusOptValue(e)}}},{id:e.fieldJEStatusComplete,view:"select",label:i("JE->Status->Complete"),name:"fieldJEStatusComplete",options:[],hidden:!0},{id:e.objectBR,view:"select",label:i("Balance Record"),name:"objectBR",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e);this._updateFieldOptions(this._optionsBR,i)}}},{id:e.fieldBRFinancialPeriod,view:"select",label:i("BR->FP"),name:"fieldBRFinancialPeriod",options:[],hidden:!0},{id:e.fieldBRAccount,view:"select",label:i("BR->Account"),name:"fieldBRAccount",options:[],hidden:!0},{id:e.fieldBRRC,view:"select",label:i("BR->RC"),name:"fieldBRRC",options:[],hidden:!0},{id:e.fieldBREntries,view:"select",label:i("BR->Entries"),name:"fieldBREntries",options:[],hidden:!0}]}}populate(e){const t=this.ids,n=(e?.process?.processDataFields(e)??[]).map((e=>({id:e.key,value:e.label})));n.unshift({value:i("Select a Process Value")});const s=this.CurrentApplication?.objectsIncluded().map((e=>({id:e.id,value:e.label||e.name,object:e})));if(s.unshift({value:i("Select an Object")}),$$(t.processBatchValue).define("options",n),$$(t.objectBatch).define("options",s),$$(t.objectJE).define("options",s),$$(t.objectBR).define("options",s),$$(t.processBatchValue).refresh(),$$(t.objectBatch).refresh(),$$(t.objectJE).refresh(),$$(t.objectBR).refresh(),e.objectBatch&&0!=e.objectBatch){const t=this._getFieldOptions(e.objectBatch);this._updateFieldOptions(this._optionsBatch,t)}if(e.objectJE&&0!=e.objectJE){const t=this._getFieldOptions(e.objectJE);this._updateFieldOptions(this._optionsJE,t)}if(e.fieldJEStatus&&this._changeStatusOptValue(e.fieldJEStatus),e.objectBR&&0!=e.objectBR){const t=this._getFieldOptions(e.objectBR);this._updateFieldOptions(this._optionsBR,t)}$$(t.label).setValue(e.label),e.defaults.settings.forEach((i=>{const n=0==e[i]?"":e[i];$$(t[i]).setValue(n)}))}values(){const e=this.ids;return $$(e.form).getValues()}_updateStatusOptions(e){const t=$$(this.ids.fieldJEStatusComplete);t&&(t.define("options",e),t.refresh(),t.show())}_changeStatusOptValue(e){const t=$$(this.ids.objectJE).getValue(),i=this.CurrentApplication.objectsIncluded().find((e=>e.id==t))?.object?.fieldByID(e);if(i?.options){const e=this._getListFieldOptions({field:i});this._updateStatusOptions(e)}}get _optionsBatch(){return[this.ids.fieldBatchEntries,this.ids.fieldBatchFinancialPeriod]}get _optionsBR(){return[this.ids.fieldBRFinancialPeriod,this.ids.fieldBRAccount,this.ids.fieldBRRC,this.ids.fieldBREntries]}get _optionsJE(){return[this.ids.fieldJEAccount,this.ids.fieldJERC,this.ids.fieldJEStatus]}}}},2914:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8317);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_accounting_fiscal_period",{form:"",label:"",processFPValue:"",objectFP:"",objectGL:"",objectAcc:"",fieldFPStart:"",fieldFPOpen:"",fieldFPStatus:"",fieldFPActive:"",fieldGLStarting:"",fieldGLRunning:"",fieldGLAccount:"",fieldGLRc:"",fieldGLDebit:"",fieldGLCredit:"",fieldAccType:"",fieldAccAsset:"",fieldAccExpense:"",fieldAccLiabilities:"",fieldAccEquity:"",fieldAccIncome:""}),this.element=null}static get key(){return"AccountingFPClose"}ui(){const e=this.ids;return{id:e.form,view:"form",elementsConfig:{labelWidth:s.labelWidthXXLarge},elements:[{id:e.label,view:"text",label:i("Name"),name:"label"},{id:e.processFPValue,view:"select",label:i("Process Fiscal Period Value"),name:"processFPValue",options:[]},{id:e.objectFP,view:"select",label:i("FP Object"),name:"objectFP",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e);this._updateFieldOptions(this._optionsFP,i)}}},{id:e.objectGL,view:"select",label:i("GL Object"),name:"objectGL",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e);this._updateFieldOptions(this._optionsGL,i)}}},{id:e.objectAcc,view:"select",label:i("Account Object"),name:"objectAcc",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e);this._updateFieldOptions(this._optionsAcc,i)}}},{id:e.fieldFPStart,view:"select",label:i("FP -> Start"),name:"fieldFPStart",options:[]},{id:e.fieldFPOpen,view:"select",label:i("FP -> Open"),name:"fieldFPOpen",options:[]},{id:e.fieldFPStatus,view:"select",label:i("FP -> Status"),name:"fieldFPStatus",options:[],on:{onChange:(t,i)=>{if(t==i)return;const n=this._getListFieldOptions({objectId:this.objectFP||$$(e.objectFP).getValue(),fieldId:t});this._updateFieldOptions(this._optionsFpStatus,n)}}},{id:e.fieldFPActive,view:"select",label:i("FP -> Active"),name:"fieldFPActive",options:[]},{id:e.fieldGLStarting,view:"select",label:i("GL -> Starting BL"),name:"fieldGLStarting",options:[]},{id:e.fieldGLRunning,view:"select",label:i("GL -> Running BL"),name:"fieldGLRunning",options:[]},{id:e.fieldGLAccount,view:"select",label:i("GL -> Account"),name:"fieldGLAccount",options:[]},{id:e.fieldGLRc,view:"select",label:i("GL -> RC"),name:"fieldGLRc",options:[]},{id:e.fieldGLDebit,view:"select",label:i("GL -> Debit"),name:"fieldGLDebit",options:[]},{id:e.fieldGLCredit,view:"select",label:i("GL -> Credit"),name:"fieldGLCredit",options:[]},{id:e.fieldAccType,view:"select",label:i("Acc -> Type"),name:"fieldAccType",options:[],on:{onChange:(t,i)=>{if(t==i)return;const n=this._getListFieldOptions({objectId:this.objectAcc||$$(e.objectAcc).getValue(),fieldId:t});this._updateFieldOptions(this._optionsAccType,n)}}},{id:e.fieldAccAsset,view:"select",label:i("Acc -> Asset"),name:"fieldAccAsset",options:[]},{id:e.fieldAccExpense,view:"select",label:i("Acc -> Expense"),name:"fieldAccExpense",options:[]},{id:e.fieldAccLiabilities,view:"select",label:i("Acc -> Liabilities"),name:"fieldAccLiabilities",options:[]},{id:e.fieldAccEquity,view:"select",label:i("Acc -> Equity"),name:"fieldAccEquity",options:[]},{id:e.fieldAccIncome,view:"select",label:i("Acc -> Income"),name:"fieldAccIncome",options:[]}]}}populate(e){const t=this.ids,n=(e?.process?.processDataFields(e)??[]).map((e=>({id:e.key,value:e.label})));n.unshift({value:i("Select a Process Value")});const s=this.CurrentApplication?.objectsIncluded().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({value:i("Select an Object")});const o=this._getFieldOptions(e.objectFP),a=this._getFieldOptions(e.objectGL),r=this._getFieldOptions(e.objectAcc),l=this._getListFieldOptions({objectId:e.objectFP,fieldId:e.fieldFPStatus}),c=this._getListFieldOptions({objectId:e.objectAcc,fieldId:e.fieldAccType});this._updateFieldOptions([t.processFPValue],n),this._updateFieldOptions(this._optionsObject,s),this._updateFieldOptions(this._optionsFP,o),this._updateFieldOptions(this._optionsGL,a),this._updateFieldOptions(this._optionsAcc,r),this._updateFieldOptions(this._optionsFpStatus,l),this._updateFieldOptions(this._optionsAccType,c),$$(t.label).setValue(e.label),e.defaults.settings.forEach((i=>{const n=0==e[i]?"":e[i];$$(t[i]).setValue(n)}))}values(){const e=this.ids;return $$(e.form).getValues()}get _optionsObject(){return[this.ids.objectFP,this.ids.objectGL,this.ids.objectAcc]}get _optionsFP(){return[this.ids.fieldFPStart,this.ids.fieldFPOpen,this.ids.fieldFPStatus]}get _optionsGL(){return[this.ids.fieldGLStarting,this.ids.fieldGLRunning,this.ids.fieldGLAccount,this.ids.fieldGLRc,this.ids.fieldGLDebit,this.ids.fieldGLCredit]}get _optionsAcc(){return[this.ids.fieldAccType]}get _optionsFpStatus(){return[this.ids.fieldFPActive]}get _optionsAccType(){return[this.ids.fieldAccAsset,this.ids.fieldAccExpense,this.ids.fieldAccLiabilities,this.ids.fieldAccEquity,this.ids.fieldAccIncome]}}}},2967:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8317);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_accounting_fiscal_year_close",{form:"",label:"",processFPYearValue:"",objectFPYear:"",objectFPMonth:"",objectGL:"",objectAccount:"",valueFundBalances:"",valueNetIncome:"",fieldFPYearStart:"",fieldFPYearEnd:"",fieldFPYearStatus:"",fieldFPYearActive:"",fieldFPMonthStart:"",fieldFPMonthEnd:"",fieldGLStartBalance:"",fieldGLRunningBalance:"",fieldGLrc:"",fieldAccNumber:"",fieldAccType:"",fieldAccTypeIncome:"",fieldAccTypeExpense:"",fieldAccTypeEquity:""}),this.element=null}static get key(){return"AccountingFPYearClose"}ui(){const e=this.ids;return{id:e.form,view:"form",elementsConfig:{labelWidth:s.labelWidthXXLarge},elements:[{id:e.label,view:"text",label:i("Name"),name:"label"},{id:e.processFPYearValue,view:"select",label:i("Process Fiscal Period Year Value"),name:"processFPYearValue",options:[]},{id:e.objectFPYear,view:"select",label:i("FP Year Object"),name:"objectFPYear",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e,"date");this._updateFieldOptions(this._optionsFPYearDate,i);const n=this._getFieldOptions(e,"list");this._updateFieldOptions(this._optionsAccountType,n)}}},{id:e.objectFPMonth,view:"select",label:i("FP Month Object"),name:"objectFPMonth",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e,"date");this._updateFieldOptions(this._optionsFPMonthDate,i)}}},{id:e.objectGL,view:"select",label:i("Balance Object"),name:"objectGL",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e,"number");this._updateFieldOptions(this._optionsGLbalance,i);const n=this._getFieldOptions(e,"connectObject");this._updateFieldOptions(this._optionsGLrc,n)}}},{id:e.objectAccount,view:"select",label:i("Account Object"),name:"objectAccount",options:[],on:{onChange:(e,t)=>{if(e==t)return;const i=this._getFieldOptions(e,"list");this._updateFieldOptions(this._optionsAccountType,i);const n=this._getFieldOptions(e,"number");this._updateFieldOptions(this._optionsAccountNumber,n)}}},{id:e.valueFundBalances,view:"text",label:i("Fund Balances Code"),name:"valueFundBalances"},{id:e.valueNetIncome,view:"text",label:i("Net Income Code"),name:"valueNetIncome"},{id:e.fieldFPYearStart,view:"select",label:i("FP Year -> Start"),name:"fieldFPYearStart",options:[]},{id:e.fieldFPYearEnd,view:"select",label:i("FP Year -> End"),name:"fieldFPYearEnd",options:[]},{id:e.fieldFPYearStatus,view:"select",label:i("FP Year -> Status"),name:"fieldFPYearStatus",options:[],on:{onChange:(t,i)=>{if(t==i)return;const n=this._getListFieldOptions({objectId:this.objectFPYear||$$(e.objectFPYear).getValue(),fieldId:t});this._updateFieldOptions(this._optionsFPYearStatusActive,n)}}},{id:e.fieldFPYearActive,view:"select",label:i("FP Year -> Active"),name:"fieldFPYearActive",options:[]},{id:e.fieldFPMonthStart,view:"select",label:i("FP Month -> Start"),name:"fieldFPMonthStart",options:[]},{id:e.fieldFPMonthEnd,view:"select",label:i("FP Month -> End"),name:"fieldFPMonthEnd",options:[]},{id:e.fieldGLStartBalance,view:"select",label:i("GL -> Start Balance"),name:"fieldGLStartBalance",options:[]},{id:e.fieldGLRunningBalance,view:"select",label:i("GL -> Running Balance"),name:"fieldGLRunningBalance",options:[]},{id:e.fieldGLrc,view:"select",label:i("GL -> RC"),name:"fieldGLrc",options:[]},{id:e.fieldAccNumber,view:"select",label:i("Acc -> Account Number"),name:"fieldAccNumber",options:[]},{id:e.fieldAccType,view:"select",label:i("Acc -> Type"),name:"fieldAccType",options:[],on:{onChange:(t,i)=>{if(t==i)return;const n=this._getListFieldOptions({objectId:this.objectAccount||$$(e.objectAccount).getValue(),fieldId:t});this._updateFieldOptions(this._optionsAccountTypeOptions,n)}}},{id:e.fieldAccTypeIncome,view:"select",label:i("Acc -> Income"),name:"fieldAccTypeIncome",options:[]},{id:e.fieldAccTypeExpense,view:"select",label:i("Acc -> Expense"),name:"fieldAccTypeExpense",options:[]},{id:e.fieldAccTypeEquity,view:"select",label:i("Acc -> Equity"),name:"fieldAccTypeEquity",options:[]}]}}populate(e){const t=this.ids,n=(e?.process?.processDataFields(e)??[]).map((e=>({id:e.key,value:e.label})));n.unshift({value:i("Select a Process Value")});const s=this.CurrentApplication?.objectsIncluded().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({value:i("Select an Object")});const o=this._getFieldOptions(e.objectFPYear,"date"),a=this._getFieldOptions(e.objectFPYear,"list"),r=this._getListFieldOptions({objectId:e.objectFPYear,fieldId:e.fieldFPYearStatus}),l=this._getFieldOptions(e.objectFPMonth,"date"),c=this._getFieldOptions(e.objectGL,"number"),h=this._getFieldOptions(e.objectGL,"connectObject"),d=this._getFieldOptions(e.objectAccount,"number"),u=this._getFieldOptions(e.objectAccount,"list"),p=this._getListFieldOptions({objectId:e.objectAccount,fieldId:e.fieldAccType});this._updateFieldOptions([t.processFPYearValue],n),this._updateFieldOptions(this._optionsObject,s),this._updateFieldOptions(this._optionsFPYearDate,o),this._updateFieldOptions(this._optionsFPYearStatus,a),this._updateFieldOptions(this._optionsFPYearStatusActive,r),this._updateFieldOptions(this._optionsFPMonthDate,l),this._updateFieldOptions(this._optionsGLbalance,c),this._updateFieldOptions(this._optionsGLrc,h),this._updateFieldOptions(this._optionsAccountNumber,d),this._updateFieldOptions(this._optionsAccountType,u),this._updateFieldOptions(this._optionsAccountTypeOptions,p),$$(t.label).setValue(e.label),e.defaults.settings.forEach((i=>{const n=0==e[i]?"":e[i];$$(t[i]).setValue(n)}))}values(){const e=this.ids;return $$(e.form).getValues()}get _optionsObject(){return[this.ids.objectFPYear,this.ids.objectFPMonth,this.ids.objectGL,this.ids.objectAccount]}get _optionsFPYearDate(){return[this.ids.fieldFPYearStart,this.ids.fieldFPYearEnd]}get _optionsFPYearStatus(){return[this.ids.fieldFPYearStatus]}get _optionsFPYearStatusActive(){return[this.ids.fieldFPYearActive]}get _optionsFPMonthDate(){return[this.ids.fieldFPMonthStart,this.ids.fieldFPMonthEnd]}get _optionsGLbalance(){return[this.ids.fieldGLStartBalance,this.ids.fieldGLRunningBalance]}get _optionsGLrc(){return[this.ids.fieldGLrc]}get _optionsAccountNumber(){return[this.ids.fieldAccNumber]}get _optionsAccountType(){return[this.ids.fieldAccType]}get _optionsAccountTypeOptions(){return[this.ids.fieldAccTypeIncome,this.ids.fieldAccTypeExpense,this.ids.fieldAccTypeEquity]}}}},9113:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(8317);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_accounting_je_archive",{form:"",label:"",processBatchValue:"",objectBatch:"",objectBalance:"",objectJE:"",objectJEArchive:"",fieldBatchFiscalMonth:"",fieldJeAccount:"",fieldJeRC:"",fieldJeArchiveBalance:"",fieldBrFiscalMonth:"",fieldBrAccount:"",fieldBrRC:"",fieldsMatch:""}),this.element=null}static get key(){return"AccountingJEArchive"}ui(){const e=this.ids;return{id:e.form,view:"form",elementsConfig:{labelWidth:s.labelWidthXLarge},elements:[{id:e.label,view:"text",label:i("Name"),name:"label"},{id:e.processBatchValue,view:"select",label:i("Process Batch Value"),name:"processBatchValue",options:[]},{id:e.objectBatch,view:"select",label:i("Batch Object"),name:"objectBatch",options:[],on:{onChange:e=>{this.objectBatch=e,this._refreshBatchFields(e)}}},{id:e.fieldBatchFiscalMonth,view:"select",label:i("Batch -> Fiscal Month"),name:"fieldBatchFiscalMonth",options:[]},{id:e.objectBalance,view:"select",label:i("BR Object"),name:"objectBalance",options:[],on:{onChange:e=>{this.objectBalance=e,this._refreshBRFields(e)}}},{id:e.fieldBrFiscalMonth,view:"select",label:i("BR -> Fiscal Month"),name:"fieldBrFiscalMonth",options:[]},{id:e.fieldBrAccount,view:"select",label:i("BR -> Account"),name:"fieldBrAccount",options:[]},{id:e.fieldBrRC,view:"select",label:i("BR -> RC"),name:"fieldBrRC",options:[]},{id:e.objectJE,view:"select",label:i("JE Object"),name:"objectJE",options:[],on:{onChange:e=>{this.objectJE=e,this._refreshJeFields(e),this._refreshFieldsMatch(this.objectJE,this.objectJEArchive,this.fieldsMatch)}}},{id:e.fieldJeAccount,view:"select",label:i("JE -> Account"),name:"fieldJeAccount",options:[]},{id:e.fieldJeRC,view:"select",label:i("JE -> RC"),name:"fieldJeRC",options:[]},{id:e.objectJEArchive,view:"select",label:i("JE Archive Object"),name:"objectJEArchive",options:[],on:{onChange:e=>{this.objectJEArchive=e,this._refreshJeArchiveFields(e),this._refreshFieldsMatch(this.objectJE,this.objectJEArchive,this.fieldsMatch)}}},{id:e.fieldJeArchiveBalance,view:"select",label:i("JE Archive -> BR"),name:"fieldJeArchiveBalance",options:[]},{view:"fieldset",label:"Fields Matching",body:{id:e.fieldsMatch,view:"form",elementsConfig:{labelWidth:s.labelWidthXXLarge},borderless:!0,elements:[]}}]}}populate(e){const t=this.ids,n=(e?.process?.processDataFields(e)??[]).map((e=>({id:e.key,value:e.label})));n.unshift({value:i("Select a Process Value")});const s=this.CurrentApplication?.objectsIncluded().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({value:i("Select an Object")}),this._updateFieldOptions([t.processBatchValue],n),this._updateFieldOptions(this._optionsObject,s),this._refreshBatchFields(e.objectBatch),this._refreshBRFields(e.objectBalance),this._refreshJeFields(e.objectJE),this._refreshJeArchiveFields(e.objectJEArchive),$$(t.label).setValue(e.label),e.defaults.settings.forEach((i=>{const n=0==e[i]?"":e[i];$$(t[i]).setValue?.(n),$$(t[i]).setValues?.(n)}))}values(){const e=this.ids,t=$$(e.form).getValues();return t.fieldsMatch=$$(e.fieldsMatch).getValues(),t}_refreshBatchFields(e){const t=this._getFieldOptions(e,"connectObject");this._updateFieldOptions(this._optionsBatch,t)}_refreshBRFields(e){const t=this._getFieldOptions(e,"connectObject");this._updateFieldOptions(this._optionsBalance,t)}_refreshJeFields(e){const t=this._getFieldOptions(e,"connectObject");this._updateFieldOptions(this._optionsJE,t)}_refreshJeArchiveFields(e){const t=this._getFieldOptions(e,"connectObject");this._updateFieldOptions(this._optionsJeArchive,t)}_refreshFieldsMatch(e,t,i={}){const n=this.ids,s=$$(n.fieldsMatch);if(!s)return;this.AB.Webix.ui([],s);const o=this.AB.objectByID(e);if(!o)return;const a=this.AB.objectByID(t);a&&(a.fields().forEach((e=>{let t=[];t=e.isConnection?o.fields((t=>t.isConnection&&t.settings?.linkObject==e.settings?.linkObject&&t.settings?.linkType==e.settings?.linkType&&t.settings?.linkViaType==e.settings?.linkViaType&&t.settings?.isCustomFK==e.settings?.isCustomFK)):o.fields((t=>t.key==e.key)),t=t.map((e=>({id:e.id,value:e.label}))),s.addView({view:"select",name:e.id,label:e.label,options:t})})),s.setValues(i??{}))}get _optionsObject(){return[this.ids.objectBatch,this.ids.objectBalance,this.ids.objectJE,this.ids.objectJEArchive]}get _optionsBatch(){return[this.ids.fieldBatchFiscalMonth]}get _optionsBalance(){return[this.ids.fieldBrFiscalMonth,this.ids.fieldBrAccount,this.ids.fieldBrRC]}get _optionsJE(){return[this.ids.fieldJeAccount,this.ids.fieldJeRC]}get _optionsJeArchive(){return[this.ids.fieldJeArchiveBalance]}}}},6699:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_calculate",{name:"",formulaText:"",variableList:"",variablePopup:"",operatorPopup:""}),this.element=null}static get key(){return"Calculate"}ui(){const e=this.ids;webix.ui({id:e.variablePopup,view:"popup",hidden:!0,body:{id:e.variableList,view:"list",template:e=>e.value,data:"",on:{onItemClick:function(i){const n=this.getItem(i);t(`{${n.value}}`),$$(e.variablePopup).hide()}}}});const t=t=>{const i=$$(e.formulaText).getValue();$$(e.formulaText).setValue(`${i}${t} `)};return webix.ui({id:e.operatorPopup,view:"popup",hidden:!0,width:180,body:{view:"list",template:e=>{let t="";return e.icon&&(t+=`<i class="fa fa-${e.icon}" aria-hidden="true"></i> `),e.label&&(t+=e.label),t},data:[{label:i("+ Adds"),symbol:"+"},{label:i("- Subtracts"),symbol:"-"},{label:i("* Multiples"),symbol:"*"},{label:i("/ Divides"),symbol:"/"},{label:i("( Open Bracket"),symbol:"("},{label:i(") Closed Bracket"),symbol:")"}],on:{onItemClick:function(i){const n=this.getItem(i);t(n.symbol),$$(e.operatorPopup).hide()}}}}),{rows:[{view:"form",elementsConfig:{labelWidth:120},elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:this.name},{id:e.formulaText,view:"texthighlight",height:200,label:i("Formula"),type:"textarea",value:this.formulaText||"",highlight:e=>e},{cols:[{width:120,fillspace:!0},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-at",label:i("Parameters"),click:function(){$$(e.variablePopup).show(this.$view)}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-hashtag",label:i("Operators"),click:function(){$$(e.operatorPopup).show(this.$view)}}]}]}]}}populate(e){const t=this.ids,i=(e?.process?.processDataFields(e)||[]).map((e=>({id:e.key,value:e.label})));$$(t.name).setValue(e.label),$$(t.formulaText).setValue(e.formulaText),$$(t.variableList).define("data",i),$$(t.variableList).refresh()}values(){const e={},t=this.ids;return e.label=$$(t.name)?.getValue(),e.formulaText=$$(t.formulaText).getValue(),e}}}},1051:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_getResetPasswordUrl",{name:"",email:""})}static get key(){return"GetResetPasswordUrl"}ui(){const e=this.ids;return{id:e.component,view:"form",rows:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:e.email,view:"multicombo",label:i("Email"),name:"email",options:[]}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){const t=(e.process.processDataFields(e)??[]).filter((e=>"email"==e.field?.key)).map((e=>({id:e.key,value:e.label}))),i=this.ids,n=$$(i.name),s=$$(i.email);n.setValue(e.label),s.setValue(e.email),s.define("options",t),s.refresh()}values(){const e={},t=this.ids,i=$$(t.name),n=$$(t.email);return e.label=i?.getValue()??"",e.name=i?.getValue()??"",e.email=n?.getValue()??"",e}}}},8010:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_insertRecord",{name:"",objectID:"",fieldValues:"",repeatLayout:"",repeatMode:"",repeatColumn:""})}static get key(){return"InsertRecord"}ui(){const e=this.ids,t=this.CurrentApplication.objectsIncluded().map((e=>({id:e.id,value:e.label??e.name})));return{id:e.component,view:"form",elementsConfig:{labelWidth:120},elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:e.objectID,view:"select",label:i("Object"),value:"",name:"objectID",options:t,on:{onChange:e=>{this.element.objectID=e,this.refreshFieldValues(e)}}},{id:e.repeatLayout,hidden:!0,cols:[{id:e.repeatMode,view:"select",label:i("Repeat"),value:"",name:"repeatMode",width:330,options:[{id:"rootData",value:i("For Connection in root data")}],on:{onChange:e=>{this.element.repeatMode=e,this.refreshFieldValues()}}},{id:e.repeatColumn,view:"select",label:"",value:this.repeatColumn,name:"repeatColumn",options:[],on:{onChange:e=>{this.element.repeatColumn=e,this.refreshFieldValues()}}}],on:{onViewShow:()=>{this.refreshFieldValues()}}},{view:"fieldset",label:i("Values"),body:{id:e.fieldValues,view:"form",borderless:!0,elements:[]}}]}}async init(e){return this.AB=e,Promise.resolve()}getFieldOptions(e){const t=[];return t.push({id:"PK",value:i("Primary Key")}),e.fields().forEach((e=>{if(e.isConnection){const n=e.datasourceLink;n&&(t.push({id:`${e.id}|PK`,value:`${e.label} -> ${i("Primary Key")}`}),n.fields().forEach((i=>{t.push({id:`${e.id}|${i.id}`,value:`${e.label} -> ${i.label}`})})))}else t.push({id:e.id,value:e.label})})),t}refreshFieldValues(e){const t=this.ids,n=$$(t.fieldValues);if(!n)return;webix.ui([],n);const s=this.AB.objectByID(e??this.element.objectID);if(!s)return;const o=this.element.objectOfStartElement,a=o?this.getFieldOptions(o):[],r=this.element.objectOfPrevElement,l=r?this.getFieldOptions(r):[],c=[{id:0,value:i("Not Set")},{id:1,value:i("Set by custom value")},{id:2,value:i("Set by the root data [{0}]",[o?o.label:""])},{id:3,value:i("Set by previous step data [{0}]",[r?r.label:""])},{id:4,value:i("Set by formula format")}];let h=[];const d=this.element.fieldRepeat;d&&d.datasourceLink&&(c.push({id:5,value:i("Set by the instance [{0}]",[d?.label??""])}),h=this.getFieldOptions(d.datasourceLink)),c.push({id:6,value:i("Set by the parameter of a Query task")});const u=(this.element.process.processDataFields(this.element)??[]).map((e=>({id:e.key,value:e.label})));s.fields().forEach((e=>{n.addView({fieldId:e.id,view:"layout",cols:[{rows:[{view:"label",label:e.label,width:100},{fillspace:!0}]},{rows:[{name:"setSelector",view:"select",options:c,on:{onChange:function(e){this.getParentView().queryView({name:"valuePanel"}).showBatch(e)}}},{name:"valuePanel",view:"multiview",visibleBatch:0,cols:[{batch:0,fillspace:!0},{batch:1,view:"text"},{batch:2,view:"select",options:a},{batch:3,view:"select",options:l},{batch:4,view:"text"},{batch:5,view:"select",options:h},{batch:6,view:"multicombo",label:"",options:u}]}]}]})}))}setFieldValues(){const e=this.ids,t=$$(e.fieldValues).getChildViews()??[];this.element.fieldValues=this.element.fieldValues??{},t.forEach((e=>{const t=e.config.fieldId,i=this.element.fieldValues[t]??{};e.queryView({name:"setSelector"}).setValue(i.set);const n=e.queryView({name:"valuePanel"}),s=n.queryView({batch:n.config.visibleBatch});s&&s.setValue&&s.setValue(i.value)}))}getFieldValues(){const e={},t=this.ids;return($$(t.fieldValues).getChildViews()??[]).forEach((t=>{const i=t.config.fieldId,n=t.queryView({name:"setSelector"}),s=t.queryView({name:"valuePanel"}),o=s.queryView({batch:s.config.visibleBatch});e[i]={},e[i].set=n.getValue(),e[i].value=o?.getValue?.()??null})),e}populate(e){const t=this.ids,i=$$(t.name),n=$$(t.objectID),s=$$(t.repeatLayout),o=$$(t.repeatMode),a=$$(t.repeatColumn),r=e?.objectOfStartElement?.connectFields().map((e=>({id:e.id,value:e.label})))??[];this.element=e,i.setValue(e.label),n.setValue(e.objectID),o.setValue(e.repeatMode),a.define("options",r),a.define("value",e.repeatColumn),a.refresh(),"SubProcess"==e.process?.key&&s.show(),this.refreshFieldValues(),this.setFieldValues()}values(){const e={},t=this.ids,i=$$(t.name),n=$$(t.objectID),s=$$(t.repeatMode),o=$$(t.repeatColumn);return e.label=i.getValue()??"",e.name=i.getValue()??"",e.objectID=n.getValue()??"",e.repeatMode=s.getValue()??"",e.repeatColumn=o.getValue()??"",e.fieldValues=this.getFieldValues(),e}}}},2367:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_service_query",{name:"",query:"",suggestions:""})}static get key(){return"TaskServiceQuery"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:this.name},{id:e.query}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){const t=this.ids,i=e.ABQLManager().builder(e.qlObj,e,this.AB),n=$$(t.name);this.element=e,webix.ui(i.ui(t.query),$$(t.query)),i.init(t.query),n.setValue(e.label)}values(){const e={},t=this.ids,i=$$(t.name);return e.label=i.getValue()??"",e.name=i.getValue()??"",e.qlObj=this.element.ABQLManager().parse(t.query,this.element,this.AB)??null,e}}}},6277:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_subprocess",{name:"",isEnable:"",parameterId:""})}static get key(){return"SubProcess"}ui(){let e=this.ids;return{id:e.component,view:"form",elementsConfig:{labelWidth:120},elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:e.isEnable,view:"switch",label:i("Enable"),value:!1},{id:e.parameterId,view:"richselect",label:i("Repeat for"),options:[{id:"",value:""}],value:""}]}}async init(e){return this.AB=e,Promise.resolve()}populate(e){let t=this.ids,i=(e.process.processDataFields(e)||[]).map((e=>({id:e.key,value:e.label}))),n=$$(t.parameterId);n.define("options",i),n.refresh(),$$(t.name).setValue(e.name),$$(t.isEnable).setValue(e.isEnable),n.setValue(e.parameterId)}values(){const e={},t=this.ids;return e.name=$$(t.name)?.getValue(),e.label=e.name,e.isEnable=$$(t.isEnable)?.getValue(),e.parameterId=$$(t.parameterId)?.getValue(),e}}}},4490:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings(),o=e.Class.ABProcessTaskManager;class a extends t{constructor(){super("properties_process_user",{name:"",option:""})}static get key(){return"TaskUser"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:e.option,rows:[{view:"button",label:i("Approval Task"),click:()=>{this.switchTo("Approval")}},{view:"button",label:i("External Task"),click:()=>{this.switchTo("External")}},{view:"button",label:i("Form Task"),click:()=>{this.switchTo("Form")}}]}]}}async init(e){return this.AB=e,Promise.resolve()}switchTo(e){const t=this.ids,i=this.values();i.id=this.element.id,i.diagramID=this.element.diagramID,i.key=e??a.key;const n=o.newTask(i,this.element.process,this.AB)??null;n&&this.element.switchTo(n,t.component)}values(){const e=this.ids;let t={};const i=$$(e.name);return t.label=i?.getValue()??"",t.name=i?.getValue()??"",t}populate(e){const t=this.ids,i=$$(t.name);this.element=e,i?.setValue(e.label??"")}}return a}},7825:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),a=(0,s.Z)(e);return class extends t{constructor(){super("properties_process_user_approval",{name:"",who:"",toUser:"",formBuilder:"",modalWindow:"",formPreview:""}),this.toUser=new a(`${this.ids.component}_to_`),this.on("save",(()=>{this.processComponents()}))}static get key(){return"Approval"}uiUser(e){const t=this.users.ui(e??{});return{id:this.ids.users,rows:[t],paddingY:10}}ui(e){const t=this.ids,n=[{id:0,value:i("Current Participant")},{id:1,value:i("Select Role or User")}];this.laneDiagramID&&"?laneID?"!=this.laneDiagramID||n.shift();const s=()=>({id:t.modalWindow,view:"window",position:"center",fullscreen:!0,modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"spacer",width:17},{view:"label",label:i("Customize the approval layout")},{view:"spacer"},{view:"button",label:i("Cancel"),autowidth:!0,click:function(){$$(t.modalWindow).close()}},{view:"button",css:"webixtype_form",label:i("Save"),autowidth:!0,click:()=>{this.formBuilder=$$(t.formBuilder).getFormData(),this.element.formBuilder=this.formBuilder,(this.formBuilder.components||[]).forEach((e=>{e._key&&e.key!=e._key&&(e.key=e._key)})),this.emit("save"),$$(t.modalWindow).close()}},{view:"spacer",width:17}]},body:{id:t.formBuilder,view:"formiobuilder",dataFields:this.dataFields,formComponents:this.formIOComponents}}),a=this.toUser.ui(e?.toUsers??{});return{id:t.component,view:"form",rows:[{id:t.name,view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:""},{id:t.who,view:"select",label:i("Who"),name:"who",options:n,value:1==n.length?"1":"",on:{onChange:e=>{1==parseInt(e)?$$(t.toUser).show():$$(t.toUser).hide()}}},{id:t.toUser,rows:[a],paddingY:10},{view:"spacer",height:10},{view:"toolbar",type:"clean",borderless:!0,cols:[{view:"label",label:i("Data To Approve")},{view:"spacer"},{view:"button",value:i("Customize Layout"),autowidth:!0,click:()=>{webix.ui(s()).show()}}]},{view:"layout",type:"form",rows:[{view:"layout",padding:20,rows:[{id:t.formPreview,view:"formiopreview",formComponents:[],height:500}]}]}]}}async init(e){this.AB=e}processComponents(){const e=this.ids;this.dataFields=this.element.process.processDataFields(this.element),this.formIOComponents=this.element.preProcessFormIOComponents();const t=$$(e.formPreview).getParentView();t.removeView(e.formPreview),t.addView({id:e.formPreview,view:"formiopreview",formComponents:this.formIOComponents,height:500})}populate(e){this.element=e;const t=this.ids,i=$$(t.name),n=$$(t.who);i.setValue(e.label);let s=(e.process.processDataFields(e)||[]).filter((e=>"user"==e.field?.key));if(e.toUsers.userProcessFieldData=s,null!==e.who)if(n.setValue(e.who),"0"===e.who)$$(t.toUser).hide();else{let i=this.toUser.ui(e.toUsers??{}),n={id:t.toUser,rows:[i],paddingY:10};webix.ui(n,$$(t.toUser))}this.processComponents()}values(){const e={},t=this.ids,i=$$(t.name),n=$$(t.who);return e.label=i?.getValue()??"",e.name=i?.getValue()??"",e.who=n?.getValue()??"",e.formBuilder=this.formIOComponents,e.toUsers=this.toUser.values(),e}}}},8866:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(3285),s=i(5178);function o(e){const t=(0,n.Z)(e),i=t.L(),o=e.Config.uiSettings(),a=(0,s.Z)(e);return class extends t{constructor(){super("properties_process_user_external",{toUsers:""}),this.toUsers=new a(`${this.ids.component}_to_`)}static get key(){return"External"}ui(){const e=this.ids;return{id:e.component,view:"form",elements:[{view:"text",label:i("Name"),labelWidth:o.labelWidthLarge,name:"name",value:""},{view:"select",label:i("Who"),name:"who",options:[{id:0,value:i("Current Participant")},{id:1,value:i("Select Role or User")}],value:"0",on:{onChange:t=>{const i=$$(e.toUsers);1===parseInt(t)?i.show():i.hide()}}},{id:e.toUsers,rows:[this.toUsers.ui({})]},{view:"texthighlight",label:i("URL"),name:"url",value:"",highlight:e=>e.replace(/{%=[^%]*%}/g,(e=>`<span style="font-weight:500;background-color:#ebedf0;">${e}</span>`))}]}}async init(e){this.AB=e}populate(e){const t=this.ids,i={name:e.name,who:e.who,url:e.url},n=$$(t.component),s=$$(t.toUsers);this.element=e,n.setValues(i),"0"===e.who?s.hide():webix.ui({id:t.toUsers,rows:[this.toUsers.ui(e)],paddingY:10},s)}values(){const e=this.ids,t=$$(e.component).getValues();return t.label=t.name,t.toUsers=this.toUsers.values(),t}}}},5778:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_user_form",{name:"",formBuilder:"",modalWindow:"",formPreview:""})}static get key(){return"Form"}ui(e){const t=this.ids,n=()=>({id:t.modalWindow,view:"window",position:"center",fullscreen:!0,modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"spacer",width:17},{view:"label",label:i("Customize the form layout")},{view:"spacer"},{view:"button",label:i("Cancel"),autowidth:!0,click:function(){$$(t.modalWindow).close()}},{view:"button",css:"webixtype_form",label:i("Save"),autowidth:!0,click:()=>{this.formBuilder=$$(t.formBuilder).getFormData(),this.element.formBuilder=this.formBuilder,(this.formBuilder.components??[]).forEach((e=>{e.key!=e?._key&&(e.key=e._key)})),this.processComponents(),$$(t.modalWindow).close()}},{view:"spacer",width:17}]},body:{id:t.formBuilder,view:"formiobuilder",formComponents:this.formIOComponents}});return{id:t.component,view:"form",rows:[{id:t.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{view:"spacer",height:10},{view:"toolbar",type:"clean",borderless:!0,cols:[{view:"label",label:i("Data To Form")},{view:"spacer"},{view:"button",value:i("Customize Layout"),autowidth:!0,click:()=>{webix.ui(n()).show()}}]},{view:"layout",type:"form",rows:[{view:"layout",padding:20,rows:[{id:t.formPreview,view:"formiopreview",formComponents:[],height:500}]}]}]}}async init(e){this.AB=e}processComponents(){const e=this.ids;this.formIOComponents=this.formBuilder;const t=$$(e.formPreview).getParentView();t.removeView(e.formPreview),t.addView({id:e.formPreview,view:"formiopreview",formComponents:this.formIOComponents,height:500})}populate(e){this.element=e;const t=this.ids;$$(t.name).setValue(e.label),this.formBuilder=e.formBuilder,this.processComponents()}values(){const e={},t=this.ids,i=$$(t.name);return e.label=i?.getValue()??"",e.name=i?.getValue()??"",e.formBuilder=this.formIOComponents,(e.formBuilder?.components??[]).forEach((e=>{if(!e.key){const t=this.AB.uuid().substring(0,4);e.key=`${this.AB.rules.nameFilter(e.label)}_${t}`}})),e}}}},7358:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return class extends t{constructor(){super("properties_process_trigger_lifecycle",{name:"",objList:"",lifecycleList:""})}static get key(){return"TriggerLifecycle"}ui(){const e=this.CurrentApplication.objectsIncluded(),t=[];e.forEach((e=>{t.push({id:e.id,value:e.label})}));const n=this.ids;return{id:n.component,rows:[{view:"label",label:i("Object Lifecycle Trigger:")},{view:"label",label:i("Begins a process when an object's data is Added, Updated or Deleted.")},{view:"form",id:n.component,elements:[{id:n.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:n.objList,view:"select",label:i("Object"),options:t},{id:n.lifecycleList,view:"select",label:i("lifecycle"),options:[{id:"added",value:i("after Add")},{id:"updated",value:i("after Update")},{id:"deleted",value:i("after Delete")}]}]}]}}async init(e){this.AB=e}populate(e){const t=this.ids;$$(t.name).setValue(e.label),$$(t.objList).setValue(e.objectID),$$(t.lifecycleList).setValue(e.lifecycleKey)}values(){const e={},t=this.ids;return e.label=$$(t.name)?.getValue(),e.objectID=$$(t.objList)?.getValue(),e.lifecycleKey=$$(t.lifecycleList)?.getValue(),e.triggerKey=`${e.objectID}.${e.lifecycleKey}`,e}}}},9722:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();class o extends t{constructor(){super("properties_process_trigger_lifecycle",{name:"",repeatEvery:"",repeatTime:"",repeatOnPanel:"",repeatDaily:"",repeatWeekly:"",repeatMonthly:"",isEnabled:"",triggerKey:""})}static get key(){return"TimerStartEvent"}ui(){let e=this.ids,t=[];for(let e=1;e<=31;e++)t.push({id:e,value:e});return{view:"form",id:e.component,elements:[{id:e.name,view:"text",label:i("Name"),labelWidth:s.labelWidthLarge,name:"name",value:""},{id:e.repeatEvery,view:"richselect",name:"repeatEvery",label:i("Repeat every"),labelWidth:s.labelWidthLarge,value:a.repeatEvery,options:[{id:"daily",value:i("Daily")},{id:"weekly",value:i("Weekly")},{id:"monthly",value:i("Monthly")}],on:{onChange:t=>{$$(e.repeatOnPanel).showBatch(t)}}},{id:e.repeatTime,view:"datepicker",name:"repeatTime",label:i("Time"),labelWidth:s.labelWidthLarge,value:a.repeatTime,timepicker:!0,type:"time",multiselect:!1},{view:"multiview",id:e.repeatOnPanel,cells:[{view:"radio",id:e.repeatDaily,label:" ",labelWidth:s.labelWidthLarge,batch:"daily",vertical:!0,value:a.repeatDaily,options:[{id:"day",value:i("Day")},{id:"weekday",value:i("Weekday")}]},{view:"multiselect",id:e.repeatWeekly,labelWidth:s.labelWidthLarge,label:i("Every week on:"),batch:"weekly",value:a.repeatWeekly,options:[{id:"SUN",value:i("Sunday")},{id:"MON",value:i("Monday")},{id:"TUE",value:i("Tuesday")},{id:"WED",value:i("Wednesday")},{id:"THU",value:i("Thursday")},{id:"FRI",value:i("Friday")},{id:"SAT",value:i("Saturday")}]},{view:"layout",batch:"monthly",rows:[{id:e.repeatMonthly,view:"richselect",labelWidth:s.labelWidthLarge,label:i("Monthly on day"),options:t,value:a.repeatMonthly}]}]},{id:e.isEnabled,view:"switch",label:i("Enable"),labelWidth:s.labelWidthLarge,value:a.isEnabled},{id:e.triggerKey,view:"text",hidden:!0,value:"triggerKey.??"}]}}async init(e){this.AB=e}populate(e){const t=this.ids;$$(t.name).setValue(e.label),$$(t.repeatEvery).setValue(e.repeatEvery),$$(t.repeatTime).setValue(e.repeatTime),$$(t.repeatDaily).setValue(e.repeatDaily),$$(t.repeatWeekly).setValue(e.repeatWeekly),$$(t.repeatMonthly).setValue(e.repeatMonthly),$$(t.isEnabled).setValue(e.isEnabled),$$(t.triggerKey).setValue(e.triggerKey),null!=e.triggerKey&&"triggerKey.??"!=e.triggerKey||$$(t.triggerKey).setValue(`timer.${e.id||this.AB.uuid()}`)}values(){const e={},t=this.ids;return e.label=$$(t.name).getValue(),e.repeatEvery=$$(t.repeatEvery).getValue(),e.repeatTime=$$(t.repeatTime).getValue().toLocaleTimeString(),e.repeatDaily=$$(t.repeatDaily).getValue(),e.repeatWeekly=$$(t.repeatWeekly).getValue(),e.repeatMonthly=$$(t.repeatMonthly).getValue(),e.isEnabled=$$(t.isEnabled).getValue(),e.triggerKey=$$(t.triggerKey)?.getValue(),e}}const a=e.Class.ABProcessTaskManager.allTasks().filter((e=>e.defaults().key==o.key))[0].defaults();return o}},8317:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(...e){super(...e)}_getFieldOptions(e,t=null){const n=[{value:i("Select a Field")}];return e&&this.CurrentApplication.objectsIncluded().find((t=>t.id==e))?.fields((e=>null==t||e.key==t)).forEach((e=>{n.push({id:e.id,value:e.label,field:e})})),n}_updateFieldOptions(e,t){e.forEach((e=>{const i=$$(e);i&&(i.define("options",t),i.refresh(),i.show())}))}_getListFieldOptions(e={}){let t;e.field?t=e.field:e.objectId&&e.fieldId&&(t=this.AB.objectByID(e.objectId)?.fieldByID(e.fieldId));const n=[{value:i("Select the value")}];return(t?.options?.()??t?.settings?.options??[]).forEach((e=>{n.push({id:e.id,value:e.text})})),n}}}},2135:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(t,i){super(`${t}_ofc`,{queryBuilder:"",queryBuilderContainer:"",queryBuilderLayout:"",showQBButton:""}),this.label=i,this.FilterComplex=e.filterComplexNew(`${this.ids.component}_fc`,{isSaveHidden:!0})}cleanRules(e,t,i){void 0===i&&(i=!0),function e(n){if(n)if(n.glue&&n.rules)n.rules.forEach((t=>{e(t)}));else{var s=t.filter((e=>e.id==n.key))[0];if(s)switch(s.type){case"number":case"formula":"string"==typeof n.value&&(-1==n.value.indexOf(".")?n.value=parseInt(n.value):n.value=parseFloat(n.value));break;case"date":i?n.value instanceof Date&&(n.value=webix.i18n.dateFormatStr(n.value)):"string"==typeof n.value&&(n.value=new Date(n.value))}}}(e)}ui(){const e=this.ids;let t={id:e.queryBuilderLayout,view:"layout",hidden:!0,type:"line",rows:[{id:e.showQBButton,cols:[{fillspace:!0},{view:"button",css:"webix_primary",name:"addqb",value:s("Add Custom Conditions"),autowidth:!0,click:()=>{$$(e.queryBuilderContainer).show(),$$(e.queryBuilderContainer).resize(),$$(e.showQBButton).hide(),this.FilterComplex.fieldsLoad(this.conditionFields(),this.CurrentObject)}},{fillspace:!0}]},{hidden:!0,id:e.queryBuilderContainer,cols:[{view:"layout",height:200,rows:[this.FilterComplex.ui]}]}]};return this.label&&t.rows[1].cols.unshift({view:"label",css:"ab-text-bold",label:this.label,width:i.labelWidthLarge}),t}init(e){this.AB=e,this.FilterComplex.init()}objectLoad(e){super.objectLoad(e),this.FilterComplex.fieldsLoad(this.conditionFields(),e)}getValue(){var e=this.FilterComplex.getValue();let t=this.conditionFields();return e&&this.cleanRules(e,t,!0),e}setValue(e){Array.isArray(e)&&(e=e[0]),e=e||{glue:"and",rules:[]},this.cleanRules(e,this.conditionFields(),!1),this.FilterComplex.setValue(e)}conditionFields(){var e=["string","LongText","number","date","email","formula","calculate"],t=[];return this.CurrentObject&&this.CurrentObject.fields().forEach((i=>{-1!=e.indexOf(i.key)&&t.push(i)})),t}}}},8975:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(2135),s=i(3285);function o(e){const t=(0,s.Z)(e),i=e.Config.uiSettings(),o=t.L(),a=(0,n.Z)(e);return class extends t{constructor(e,t){super(e,{selectAction:"",queryBuilder:"",valueDisplay:""});var i=webix.uid();Object.keys(this.ids).forEach((e=>{this.ids[e]=`${e}_${i}`})),this.listActions=t||[],this.actionDropList=[],this.listActions.forEach((e=>{this.actionDropList.push({id:e.key,value:e.label})})),this.selectedAction=null,this.actionDropList.length>0&&(this.selectedAction=this.actionDropList[0].id),this.removable=!0,this.objectQB=null}init(e){this.AB=e,this.objectQB?.init(e);var t=this.currentAction();t&&t.init(this.AB)}ui(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rules",padding:20,type:"line",rows:[{view:"template",css:"ab-component-form-rules-delete",template:'<i class="fa fa-trash ab-component-remove"></i>',height:30,borderless:!0,hidddatasourceen:0==this.removable,onClick:{"ab-component-remove":()=>{this.emit("delete",this)}}},{id:this.ids.selectAction,view:"richselect",label:o("Action"),placeholder:o("Choose an action"),labelWidth:i.labelWidthLarge,options:this.actionDropList,on:{onChange:(e,t)=>{this.selectAction(e,t)}}},{for:"values",hidden:!0,cells:[{view:"layout",cols:[{view:"label",label:o("Values"),css:"ab-text-bold",width:i.labelWidthLarge},{id:this.ids.valueDisplay,view:"layout",rows:[{label:o(" ABViewRule: This should be the Set Area"),css:"ab-text-bold",height:30}]}]}]},this.objectQB.ui()]}}replaceValueDisplay(e){var t=$$(this.ids.valueDisplay);if(t){var i=t.getChildViews(),n=[];i.forEach((e=>{n.push(e)})),n.forEach((e=>{t.removeView(e)})),t.addView(e.ui())}}selectAction(e,t){e&&$$(this.ids.component).getChildViews().forEach((e=>{e.show()}));var i=this.getAction(t);i&&i.stashCondition(this.objectQB.getValue()),this.selectedAction=e;var n=this.currentAction();n&&(this.objectQB?.setValue(n.condition()),this.replaceValueDisplay(n),n.init(this.AB))}conditionFields(){var e=[],t=this.currentAction();return t&&(e=t.conditionFields()),e}currentAction(){return this.getAction(this.selectedAction)}getAction(e){return this.listActions.filter((t=>t.key==e))[0]}objectLoad(e){super.objectLoad(e),this.listActions.forEach((t=>{t.objectLoad(e)}));var t=o("When");this.objectQB=new a(this.ids.component,t),this.objectQB.objectLoad(e)}formLoad(e){this.viewLoad(e),this.listActions.forEach((t=>{t.formLoad(e)}))}get currentForm(){return this.CurrentView}fromSettings(e){if((e=e||{}).selectedAction){this.selectedAction=e.selectedAction;var t=this.currentAction();if(!t)return;t.stashCondition(e.queryRules||{}),this.ids&&$$(this.ids.selectAction).setValue(this.selectedAction),t.fromSettings(e.actionSettings)}}toSettings(){var e={};if(this.selectedAction){e.selectedAction=this.selectedAction,e.queryRules=this.objectQB.getValue();let t=this.currentAction();t&&(e.actionSettings=t.toSettings())}return e}qbFixAfterShow(){var e=this.currentAction();e&&this.objectQB&&(this.objectQB.setValue(e.condition()),e.qbFixAfterShow())}async isReady(){let e=this.currentAction();return e?e.isReady():Promise.resolve()}isValid(e={}){var t={id:"hiddenQB_"+webix.uid(),hidden:!0,view:"querybuilder"},i=webix.ui(t),n=this.currentAction().condition();this.objectQB&&this.objectQB.cleanRules(n[0],n[1],!1);let s=n[0]||{},o=n[1]||[],a=(e="")=>"number"==typeof e?e:parseFloat(e.replace(/[^-0-9.]/g,""));o.filter((e=>"number"==e.type||"calculate"==e.type||"formula"==e.type)).forEach((t=>{try{s&&s.rules&&Array.isArray(s.rules)&&s.rules.forEach((e=>{e.key==t.id&&(e.value=a(e.value))})),e[t.id]&&"string"==typeof e[t.id]&&(e[t.id]=a(e[t.id]))}catch(e){}})),i.setValue({query:s,fields:o});var r=i.getFilterHelper()(e);return i.destructor(),r}get isPreProcess(){return this.currentAction().isPreProcess||!1}}}},6222:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e);return e.Config.uiSettings(),t.L(),class extends t{constructor(e,t){super(e,t);let i=webix.uid();Object.keys(this.ids).forEach((e=>{this.ids[e]=`${e}_${i}`})),this.key="ABViewRuleAction",this.queryObject=null,this.queryRules={},this.valueRules={}}ui(){return{}}init(e){return this.AB=e,Promise.resolve()}condition(){return[this.conditionRules(),this.conditionFields()]}stashCondition(e){Array.isArray(e)&&(e=e[0]),e&&("or"!=e.glue&&(e.glue="and"),e.rules=e.rules||[],this.queryRules=e)}conditionFields(){var e=["string","number","date","formula","calculate"],t=[];return this.queryObject&&this.queryObject.fields().forEach((i=>{-1!=e.indexOf(i.key)&&t.push({id:i.columnName,value:i.label,type:i.key})})),t}conditionRules(){return this.queryRules}objectLoad(e){super.objectLoad(e),this.queryObjectLoad(e)}queryObjectLoad(e){this.queryObject=e}formLoad(e){this.viewLoad(e)}get currentForm(){return this.CurrentView}valueDisplay(e){return this.valueDisplayComponent(e)}valueDisplayComponent(){return this._ui={ui:{template:"ABViewRuleAction.valueDisplayComponent"},init:e=>{console.error("!!! ABViewRuleAction.valueDisplayComponent() should be overridden."),console.warn(" --\x3e passed in data:",e)}}}fromSettings(e){e=e||{},this.valueRules=e.valueRules||{}}toSettings(){return{}}isReady(){return Promise.resolve()}qbFixAfterShow(){}}}},8791:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(e,t){super(e=e||"ABViewRuleList",{rules:"",rulesScrollview:"",action:"",when:"",values:"",set:""}),this.listRules=[],(t=t||{}).labels=t.labels||{},t.labels.header=t.labels.header||i("Rule List"),t.labels.headerDefault=t.labels.headerDefault||i("Rule List"),this.childSettings=t}ui(){const e=this.ids;return{view:"window",id:e.component,modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:this.childSettings.labels.headerDefault},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:i("Add new rule"),width:150,click:()=>{this.addRule(),$$(e.rulesScrollview).scrollTo(0,$$(e.rules).$height)}}]},body:{type:"form",rows:[{view:"scrollview",id:e.rulesScrollview,scroll:"xy",body:{view:"layout",id:e.rules,margin:20,padding:10,rows:[]}},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:i("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}},{fillspace:!0}]}]}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}buttonCancel(){$$(this.ids.component)?.hide()}buttonSave(){var e=this.toSettings();this.emit("save",e),this.hide()}hide(){$$(this.ids.component)?.hide()}show(){$$(this.ids.component)?.show()}addRule(e){var t=this.getRule();if(t){this.listRules.push(t);var i=$$(this.ids.rules);i&&(i.addView(t.ui()),t.objectLoad(this.CurrentObject),t.on("delete",(e=>{$$(this.ids.rules).removeView(t.ids.component);var i=this.listRules.indexOf(e);-1!==i&&this.listRules.splice(i,1)}))),e&&t.fromSettings(e)}}fromSettings(e){this.listRules.forEach((e=>{this.ids?.rules&&e?.ids?.component&&$$(this.ids.rules).removeView(e.ids.component)})),this.listRules=[],e&&e.forEach((e=>{this.addRule(e)}))}objectLoad(e){super.objectLoad(e),this.listRules.forEach((t=>{t.objectLoad(e)}))}toSettings(){var e=[];return this.listRules.forEach((t=>{e.push(t.toSettings())})),e}getRule(){return console.error("!!! ABViewRuleList.getRule() should be overridded by a child object."),null}formLoad(e){this.viewLoad(e)}get currentForm(){return this.CurrentView}rulesReady(){return Promise.resolve()}qbFixAfterShow(){this.listRules.forEach((e=>{e.qbFixAfterShow()}))}}}},1538:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i(8791),s=i(8975),o=i(3285),a=i(6222);const r={filterConditions:{glue:"and",rules:[]}};function l(e){const t=(0,o.Z)(e),i=(0,a.Z)(e),n=e.Config.uiSettings(),s=i.L();class l extends t{constructor(e,t){super(e,{updateForm:""}),this.uniqueIDs(),this.base=e,this.Rule=t,this.valueRules=null}ui(){return{view:"form",id:this.ids.updateForm,elements:[]}}init(e,t){this.AB=e,t=t||this.valueRules,this.setValues(t)}removeAddRow(){const e=this.formGet();if(!e)return;const t=e.getChildViews().filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()}))))[0];t&&e.removeView(t)}addRow(e){const t=this.formGet();if(!t)return;const i=t.getChildViews();if(null==e&&i.filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()})))).length>0)return;const n=new c(this.base,this.Rule);t.addView(n.ui()),n.init(this.AB,e),n.on("add",(()=>{this.addRow()})),n.on("delete",(e=>{this.delRow(e)})),this.Rule.formRows.push(n)}delRow(e){this.Rule.formRows.forEach(((t,i)=>{t.ui.id==e&&this.Rule.formRows.splice(i,0)}));const t=this.formGet();t&&t.removeView($$(e))}formClear(){const e=this.formGet();if(!e)return;const t=e.getChildViews(),i=[];t.forEach((e=>{i.push(e)})),i.forEach((t=>{e.removeView(t)})),this.Rule.formRows=[]}formGet(){const e=$$(this.ids.updateForm);if(!e){let e="ABViewRuleActionFormRecordRuleUpdate.formGet() could not find webix form.";return this.AB.notify.developer(new Error(e),{context:e,updateForm:this.ids.updateForm}),null}return e}setValues(e){(e=e||{}).fieldOperations=e.fieldOperations||[],this.formGet()&&(this.formClear(),e.fieldOperations.length>0&&e.fieldOperations.forEach((e=>{this.addRow(e)})),this.removeAddRow(),this.addRow())}fromSettings(e){const t=e.valueRules||e;this.setValues(t)}toSettings(){const e={fieldOperations:[]};return this.Rule.formRows.forEach((t=>{const i=t.toSettings();i&&e.fieldOperations.push(i)})),e}}class c extends t{constructor(e,t){super(e,{row:"",updateForm:"",field:"",value:"",currentDate:"",selectDc:"",selectBy:"",queryField:"",multiview:"",buttonAdd:"",buttonDelete:""}),this.uniqueIDs(),this.base=e,this.FilterComponent=null,this.Rule=t}ui(){const e=this.ids;return{id:e.row,view:"layout",rows:[{cols:[{view:"label",width:n.labelWidthSmall,label:s("Set")},{id:e.field,view:"combo",name:"field",placeholder:s("Choose a field"),height:32,options:this.getFieldList(!0),on:{onChange:e=>{this.selectField(e)}}},{view:"label",width:n.labelWidthSmall,label:s("To")},{},{view:"button",css:"webix_danger",id:e.buttonDelete,icon:"fa fa-trash",type:"icon",width:30,hidden:!0,click:()=>{this.emit("delete",e.row)}}]},{}]}}datacollections(e=(()=>!0)){return this.Rule.CurrentApplication?.datacollectionsIncluded(e)??[]}buttonsToggle(){const e=$$(this.ids.row).getChildViews()[0].getChildViews();e[4].hide(),e[5].show()}getFieldList(e){let t=[];if(this.Rule.CurrentObject&&(t=(this.Rule.CurrentObject.fields()||[]).map((e=>({id:e.id,value:e.label}))),e)){const e={};this.Rule.formRows.forEach((t=>{const i=$$(t.ids.row);if(i){const t=i.getChildViews()[0].getChildViews()[1];e[t.getValue()]=!0}})),t=t.filter((t=>!e[t.id]))}return t}isValid(){const e=this.ids,t=this.AB.Validation.validator(),i=$$(e.row).getChildViews()[0].getChildViews()[3],n=i.getParentView().getParentView(),o=this.Rule.getUpdateObjectField($$(e.field).getValue());if(o){const e=o.getValue(i,{}),a={};return a[o.columnName]=e,o.isValidData(a,t),(""==e||null==e||Array.isArray(e)&&0==e.length)&&t.addError(o.columnName,s("")),n.clearValidation(),t.updateForm(n),t.pass()}{const t=$$(e.row).getChildViews()[0].getChildViews()[1];return t.define("invalidMessage",s("A value is required")),t.define("invalid",!0),t.refresh(),!1}}selectField(e){const t=this.ids,i=this.Rule.getUpdateObjectField(e);if(!i)return;let n,o,a=i.formComponent().newInstance(this.Rule.CurrentApplication.isWebApp?this.Rule.CurrentApplication:null).component();console.warn("TODO: remove this testing code:"),n="function"==typeof a.ui?a.ui():a.ui,n.rows[0]?n.rows[0].id=t.value:n.id=t.value;let r={};if("user"==i.key){n.id=`update_container_${i.id}`,a.ids.component=t.value;const e=n.rows[0].rows[0];e.id=t.value,e.options=e.options||[],e.options.unshift({id:"ab-current-user",value:s("[Current User]")}),i.on("option.data",(()=>{e.suggest.on.onShow()}))}else"date"!=i.key&&"datetime"!=i.key||(r={id:t.currentDate,view:"checkbox",labelRight:s("Current Date/Time"),labelWidth:0,on:{onChange:e=>{const t=$$(n.id);t&&(e?t.disable():t.enable())}}});let l=this.datacollections((e=>e.datasource)),c=[];l.forEach((e=>{c.push({id:e.id,value:e.label,icon:e.settings.isQuery?"fa fa-filter":"fa fa-database"})}));const h=[{id:"select-one",value:s("Current selection")},{id:"filter-select-one",value:s("Select first after filter by...")}],d={type:"clean",rows:[{cols:[{id:t.selectDc,view:"richselect",options:{data:c},placeholder:s("Choose a data source"),on:{onChange:e=>{const n=this.datacollections((t=>t.id==e))[0];if(!n||"query"!=n.sourceType&&"connectObject"==i.key)$$(t.queryField).hide();else{const e=[];n.datasource.fields().forEach((t=>{e.push({id:t.id,value:t.label})})),$$(t.queryField).define("options",e),$$(t.queryField).refresh(),$$(t.queryField).show()}}}},{id:t.queryField,view:"combo",hidden:!0,placeholder:s("Choose value from..."),options:[{id:1,value:"figure this out"}]}]},{id:t.selectBy,view:"combo",options:h,placeholder:s("Choose select option"),on:{onChange:i=>{const n=$$(t.row);if(n.removeView(n.getChildViews()[1]),"select-one"==i)n.addView({},1);else{const i=(this.Rule.CurrentView?.datacollection?.datasource?.fields()??[]).map((function(e){return{id:e.id,value:e.label}}));this.FilterComponent=this.AB.filterComplexNew(`${this.base}_${e}`,{height:200,isSaveHidden:!0}),this.FilterComponent.init({isRecordRule:!0,recordRuleFieldOptions:i}),console.warn("TODO: remove this transition Code:"),"function"==typeof this.FilterComponent.ui?n.addView(this.FilterComponent.ui(),1):n.addView(this.FilterComponent.ui,1);const s=$$(t.selectDc).getValue(),o=this.datacollections((e=>e.id==s))[0];o&&this.populateFilters(o)}}}}]};if(i.isConnection&&"user"!=i.key){const e=i.datasourceLink;l=l.filter((t=>t.datasource.id==e.id));const n=this.datacollections((t=>"query"==t.sourceType&&t.datasource&&t.datasource.canFilterObject(e)));l=l.concat(n),c=[],l.forEach((e=>{c.push({id:e.id,value:e.label,icon:e.settings.isQuery?"fa fa-filter":"fa fa-database"})})),h.push({id:"filter-select-all",value:s("Select all after filter by...")}),o=d,$$(t.selectDc)?($$(t.selectDc).parse?$$(t.selectDc).parse(c):$$(t.selectDc).define("options",c),$$(t.selectDc).refresh()):o.rows[0].cols[0].options=c,a={init:function(){}}}else o={id:t.multiview,view:"multiview",cells:[{batch:"custom",rows:[n,r,{view:"label",label:s("<a>Or exists value</a>"),on:{onItemClick:function(){this.getParentView().getParentView().showBatch("exist")}}}]},{batch:"exist",rows:[d,{view:"label",label:s("<a>Or custom value</a>"),on:{onItemClick:function(){const e=this.getParentView().getParentView();$$(t.selectBy).setValue("select-one"),e.showBatch("custom")}}}]}]};const u=$$(t.row).getChildViews()[0];if(u.removeView(u.getChildViews()[3]),u.addView(o,3),a.init(),!i.isConnection&&i.customDisplay){const e=$$(n.id).$view;setTimeout((()=>{i.customDisplay(i,this.AB._App,e,{editable:!0,isForm:!0})}),50)}u.getChildViews()[4].show(),e&&this.emit("add")}setValue(e){const t=this.ids;$$(t.field).setValue(e.fieldID);const i=this.Rule.getUpdateObjectField(e.fieldID);if(i){const n=()=>{$$(t.selectDc).setValue(e.value),e.queryField&&$$(t.queryField).setValue(e.queryField);const i=e.selectBy||"select-one";if($$(t.selectBy).setValue(i),"select-one"!=i){const t=e.value,i=this.datacollections((e=>e.id==t))[0];i&&e.filterConditions&&this.populateFilters(i,e.filterConditions)}};"connectObject"==i.key?n():"exist"==e.valueType?($$(t.multiview)?.showBatch("exist"),n()):($$(t.multiview)?.showBatch("custom"),setTimeout((function(){if("date"==i.key||"datetime"==i.key){if("ab-current-date"==e.value)return void $$(t.currentDate).setValue(!0);!e.value||e.value instanceof Date||(e.value=new Date(e.value))}const n={};n[i.columnName]=e.value,"ab-current-user"==n[i.columnName]?$$(t.value).setValue(n[i.columnName]):i.setValue($$(t.value),n)}),50))}}populateFilters(e,t){t=t??r.filterConditions,this.FilterComponent.fieldsLoad(e.datasource?e.datasource.fields():[]),this.FilterComponent.setValue(t)}toSettings(){const e=this.ids,t=$$(e.field).getValue();if(!t)return null;const i={fieldID:t},n=$$(e.value),s=this.Rule.getUpdateObjectField(i.fieldID),o=()=>{i.value=$$(e.selectDc).getValue(),i.queryField=$$(e.queryField).getValue(),i.op="set",i.type=s.key,i.selectBy=$$(e.selectBy).getValue(),i.valueType="exist",this.FilterComponent&&(i.filterConditions=this.FilterComponent.getValue())};if("connectObject"==s.key)o();else if("exist"==$$(e.multiview).config.visibleBatch)o();else{switch(s.key){case"date":case"datetime":i.value=$$(e.currentDate).getValue()?"ab-current-date":s.getValue(n,{});break;case"user":if("ab-current-user"==n.getValue()){i.value="ab-current-user";break}default:i.value=s.getValue(n,{})}i.op="set",i.type=s.key,i.valueType="custom"}return i}init(e,t){return this.AB=e,t&&this.setValue(t),Promise.resolve()}}return class extends i{constructor(e,t){super(e,t),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=s("Update Record"),this.formRows=[],this.stashRules={}}ui(){return this._uiUpdater||this.valueDisplayComponent(),this._uiUpdater.ui()}init(){this._uiUpdater?.init(e,this.valueRules)}valueDisplayComponent(e){return null==this._uiUpdater&&(this._uiUpdater=new l(e??this.ids.component,this)),this._uiUpdater}getUpdateObjectField(e){return this.CurrentObject.fieldByID(e)}objectLoad(e){this.CurrentObject&&(this.stashRules[this.CurrentObject.id]=this.valueRules),super.objectLoad(e),e&&(this.valueRules=this.stashRules[this.CurrentObject.id]||{})}fromSettings(e){if(e=e||{},super.fromSettings(e),e.updateObjectID){const t=this.AB.objectByID(e.updateObjectID);this.objectLoad(t)}this._uiUpdater&&this._uiUpdater.fromSettings(e)}toSettings(){const e=super.toSettings();return e.valueRules=this._uiUpdater?.toSettings(),e.updateObjectID=this.CurrentObject.id,e}}}var c=i(2135);function h(e){const t=(0,o.Z)(e),i=(0,a.Z)(e),n=l(e),s=n.L(),r=(0,c.Z)(e);class h extends t{constructor(e,t,i){super(e,{updateForm:"",selectConnectedField:"",updateFieldsForm:""}),this.base=e,this.RuleAction=t,this.options=i??{},this.uniqueIDs(),this.ObjectUpdater=new n(`${this.base}_objupdater`,{})}ui(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rule",rows:[{id:this.ids.selectConnectedField,view:"richselect",label:s("Select which connected object to update."),labelWidth:300,value:this.RuleAction.selectedField(),options:this.RuleAction.fieldDropList,on:{onChange:(e,t)=>{this.selectAction(e,t)}}}]}}init(e){return this.ObjectUpdater.init(e)}addDisplay(e){$$(this.ids.component).addView(e)}removePreviousDisplays(){var e=$$(this.ids.component).getChildViews(),t=[];e.forEach((e=>{t.push(e)})),t.forEach((e=>{e.config.id!=this.ids.selectConnectedField&&$$(this.ids.component).removeView(e)}))}selectAction(e){this.removePreviousDisplays(),this.RuleAction.selectedFieldID=e;var t=this.RuleAction.connectedObject();if(t){if(this.ObjectUpdater.objectLoad(t),this.ObjectUpdater.applicationLoad(this.RuleAction.CurrentApplication),this.updateComponent=this.ObjectUpdater.valueDisplayComponent(this.ids.updateFieldsForm),this.showQBIfNeeded(),this.addDisplay(this.updateComponent.ui()),this.updateComponent.init(this.AB),this.options?.isUpdateValueDisabled){let e=this.updateComponent.formGet();e&&(e.disable(),e.hide())}}else this.AB.notify.builder(new Error("No connectedObject found."),{fieldID:this.selectedFieldID})}showQBIfNeeded(){var e=this.RuleAction.queryBuilderDisplay(this.base);this.addDisplay(e.ui()),e.init(this.AB)}fromSettings(e){$$(this.ids.selectConnectedField).setValue(e.selectedFieldID),this.objectQB&&this.objectQB.setValue(this.qbCondition),this.updateComponent&&this.updateComponent.fromSettings(e)}toSettings(){return this.updateComponent?.toSettings()??{}}}return class extends i{constructor(e){super(e,{}),this.key="ABViewRuleActionFormRecordRuleUpdateConnected",this.label=s("Update Connected Record"),this.selectedFieldID=null,this.fieldDropList=[],this.objectQB=null,this.qbCondition=null,this._uiChooser=null}ui(){return this._uiChooser||this.valueDisplayComponent(this.base),this._uiChooser.ui()}objectLoad(e){super.objectLoad(e),this.connectedFieldList().forEach((e=>{this.fieldDropList.push({id:e.id,value:e.label})}))}connectedFieldList(){return this.CurrentObject.connectFields()}connectedObject(){if(this.selectedFieldID){var e=this.selectedField();if(e)return e.datasourceLink}return null}selectedField(){return this.connectedFieldList().filter((e=>e.id==this.selectedFieldID))[0]}valueDisplayComponent(e){return null==this._uiChooser&&(this._uiChooser=new h(e,this,{isUpdateValueDisabled:this.isUpdateValueDisabled})),this._uiChooser}superValueDisplayComponent(e){return super.valueDisplayComponent(e)}queryBuilderDisplay(e){if(!this.objectQB){this.objectQB=new r(e,s("How to choose which object:"));var t=this.connectedObject();t&&this.objectQB.objectLoad(t)}return this.objectQB}fromSettings(e){e=e||{},this.selectedFieldID=e.selectedFieldID||null,this.qbCondition=e.qbCondition||{},super.fromSettings(e),this._uiChooser&&this._uiChooser.fromSettings(e)}toSettings(){var e=super.toSettings();e.selectedFieldID=this.selectedFieldID;var t=null;return this.objectQB&&(t=this.objectQB.getValue(),Array.isArray(t)&&(t=t[0]),t&&(t.glue=t.glue||"and")),e.qbCondition=t,this._uiChooser&&(e.valueRules=this._uiChooser.toSettings()),e}qbFixAfterShow(){this.objectQB&&this.objectQB.setValue(this.qbCondition)}}}function d(e,t){const i=(0,n.Z)(e),o=(0,s.Z)(e),a=i.L(),r=function(e){const t=l(e);return class extends t{constructor(t){super(t,{}),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=((...t)=>e.Multilingual.label(...t))("Update Record")}}}(e),c=function(e){const t=h(e);return class extends t{constructor(t){super(t,{}),this.key="ABViewRuleActionFormRecordRuleInsertConnected",this.label=((...t)=>e.Multilingual.label(...t))("Insert Connected Object")}}}(e),d=h(e),u=function(e){const t=h(e);return class extends t{constructor(t){super(t,{}),this.key="ABViewRuleActionFormRecordRuleRemoveConnected",this.label=((...t)=>e.Multilingual.label(...t))("Remove Connected Record"),this.isUpdateValueDisabled=!0}}}(e);return new class extends i{constructor(e="ABViewRuleListFormRecordRules"){super(e,{labels:{header:a("Record Rules"),headerDefault:a("Record Rules")}}),this.base=e}getRule(){var e=[new r(`${this.base}_ruleActionUpdate`),new c(`${this.base}_ruleActionInsertConnected`),new d(`${this.base}_ruleActionUpdateConnected`),new u(`${this.base}_ruleActionRemoveConnected`)],t=new o(`${this.base}_rule_record`,e);return t.init(this.AB),t.objectLoad(this.CurrentObject),t.formLoad(this.currentForm),t}}(t)}},708:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(8791),s=i(8975),o=i(6222);function a(e,t){const i=(0,n.Z)(e),a=(0,s.Z)(e),r=i.L(),l=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{message:""}),this.key="ABViewRuleActionFormSubmitRuleConfirmMessage",this.label=i("Show a confirmation message"),this.formRows=[]}ui(){return{id:this.ids.message,view:"textarea",height:130}}init(e){return this.AB=e,Promise.resolve()}fromSettings(e){e=e||{},super.fromSettings(e),$$(this.ids.message)?.setValue(e.message||"")}toSettings(){var e=super.toSettings();return e.message=$$(this.ids.message)?.getValue()||"",e}}}(e),c=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{pagesAndTabs:""}),this.key="ABViewRuleActionFormSubmitRuleExistPage",this.label=i("Redirect to an existing page"),this.formRows=[]}ui(){return{id:this.ids.pagesAndTabs,view:"richselect",options:[]}}init(e){this.AB=e,this.refreshUI()}fromSettings(e){super.fromSettings(e);const t=e.valueRules||{};$$(this.ids.pagesAndTabs).setValue(t.tabId??t.pageId??"")}toSettings(){const e=this.ids,t=super.toSettings(),i=$$(e.pagesAndTabs).getValue(),n=$$(e.pagesAndTabs).getPopup().getList().config.data.filter((e=>e.id==i))[0];return n&&("tab"==n.type?t.valueRules={pageId:n.pageId,tabId:i}:t.valueRules={pageId:i}),t}refreshUI(){const e=this.ids,t=[],i=(e,n,s,o)=>{n=n||"";const a="tab"==s?"fa fa-window-maximize":"fa fa-file-o",r=e.pageParent();t.push({id:e.id,value:`${n}${e.label}`,type:s,pageId:r?.id,icon:a}),"page"!=s&&"tab"!=s||((e?.pages?.()??[]).forEach((function(e){i(e,`${n}-`,"page")})),(e?.views?.((e=>"tab"==e.key))??[]).forEach((t=>{t.views().forEach((t=>{i(t,`${n}-`,"tab",e.id)}))})))};i(this.currentForm.pageRoot(),"","page"),$$(e.pagesAndTabs).define("options",t),$$(e.pagesAndTabs).refresh()}}}(e),h=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{}),this.key="ABViewRuleActionFormSubmitRuleParentPage",this.label=i("Redirect to the parent page"),this.formRows=[]}ui(){return{view:"label",label:this.label}}}}(e),d=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{}),this.key="ABViewRuleActionFormSubmitRuleClosePopup",this.label=i("Close the current popup"),this.formRows=[]}ui(){return{view:"layout",rows:[]}}}}(e),u=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{website:""}),this.key="ABViewRuleActionFormSubmitRuleWebsite",this.label=i("Redirect to another website URL"),this.formRows=[]}ui(){return{id:this.ids.website,view:"text"}}fromSettings(e){super.fromSettings(e);const t=e.valueRules||{};$$(this.ids.website).setValue(t.website??"")}toSettings(){const e=this.ids,t=super.toSettings();return t.valueRules={website:$$(e.website).getValue()??""},t}}}(e),p=function(e){const t=(0,o.Z)(e),i=t.L();return class extends t{constructor(e){super(e,{form:"",popup:"",list:"",toEmailsContainer:"",toEmails:"",fromName:"",message:""}),this.key="ABViewRuleActionFormSubmitRuleEmail",this.label=i("Send a custom email"),this.formRows=[]}ui(){const e=this.ids,t=this;return{id:e.form,view:"form",width:450,elementsConfig:{labelPosition:"top",labelWidth:100},cols:[{width:330,rows:[{view:"text",name:"fromName",label:i("From Name")},{view:"text",name:"fromEmail",label:i("From Email"),validate:webix.rules.isEmail,on:{onChange:function(){this.getValue()&&!this.validate()?$$(e.form).markInvalid("fromEmail",i("Email is invalid")):$$(e.form).markInvalid("fromEmail",!1)}}},{id:e.toEmailsContainer,view:"forminput",name:"toEmails",label:i("Send"),css:"ab-rich-text",width:320,body:{width:320,rows:[{height:25},{id:e.toEmails,width:320,view:"layout",rows:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:i("Add a recipient"),width:150,click:()=>{this.toEmailAdd()}}]}},{view:"text",name:"subject",label:i("Subject")},{id:e.message,view:"textarea",name:"message",label:i("Message"),width:320,height:400}]},{rows:[{view:"template",type:"header",template:"Fields"},{id:e.list,view:"list",width:120,css:{"background-color":"#fff !important;"},template:(e,t)=>this.fieldTemplate(e,t),on:{onItemClick:function(e){var i=this.getItem(e);t.enterField(i)}}}]}]}}init(e){this.AB=e;const t=this.ids;this.CurrentObject&&($$(t.list).parse(this.CurrentObject.fields((e=>e.fieldUseAsLabel()))),$$(t.list).refresh()),this.refreshUI()}fromSettings(e){super.fromSettings(e);let t=e.valueRules||{};$$(this.ids.form).setValues(t),(t.toEmails||[]).forEach((e=>{this.toEmailAdd({type:e.type,emailType:e.emailType,value:e.value})})),this.refreshUI()}toSettings(){const e=this.ids;var t=super.toSettings(),i=$$(e.form).getValues()||{},n=[];return $$(e.toEmails).getChildViews().forEach((e=>{var t=e.queryView({name:"emailType"}).getValue(),i=e.queryView({name:t}).getValue();n.push({type:"to",emailType:t,value:i})})),t.valueRules={fromName:i.fromName,fromEmail:i.fromEmail,toEmails:n,subject:i.subject,message:i.message},t}toEmailTemplate(e){const t=this;return{width:320,cols:[{view:"richselect",name:"emailType",value:(e=e||{}).emailType||"email",width:150,options:[{id:"email",value:i("A custom email address")},{id:"field",value:i("An email field")},{id:"query",value:i("From query")}],on:{onChange:function(e){t.emailTypeChange(e,this)}}},{width:150,name:"emailValue",visibleBatch:e.emailType||"email",cols:[{view:"text",name:"email",batch:"email",value:"email"==e.emailType?e.value:"",validate:webix.rules.isEmail,width:150,on:{onChange:()=>{this.toEmailValidate()}}},{view:"richselect",name:"field",batch:"field",value:"field"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:this.emailFieldOptions()}},{view:"richselect",name:"query",batch:"query",value:"query"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:this.queryOptions()}}]},{view:"button",css:"webix_danger",type:"icon",icon:"fa fa-trash-o",width:32,click:function(){var e=this.getParentView();t.toEmailRemove(e)}}]}}toEmailAdd(e){var t=$$(this.ids.toEmails).getChildViews().length;$$(this.ids.toEmails).addView(this.toEmailTemplate(e),t),this.refreshUI()}emailTypeChange(e,t){var n=t.getParentView().queryView({name:"emailValue"});switch(e){case"field":this.emailFieldOptions().length>0?n.showBatch("field"):(t.setValue("email"),webix.message(i("This form's chosen Datacollection has no Email Fields")));break;case"query":this.queryOptions().length>0?n.showBatch("query"):(t.setValue("email"),webix.message(i("There are no queries with Email Fields in this Application")));break;default:n.showBatch("email")}$$(this.ids.toEmailsContainer).adjust()}toEmailRemove(e){$$(this.ids.toEmails).removeView(e),this.refreshUI()}toEmailValidate(){let e=!0;$$(this.ids.toEmails).getChildViews().forEach((t=>{let i=t.queryView({name:"email"});i.getValue()&&!i.validate()&&(e=!1)})),e?$$(this.ids.form).markInvalid("toEmails",!1):$$(this.ids.form).markInvalid("toEmails",i("Email is invalid"))}fieldTemplate(e){return`<i class='fa fa-${e.icon} webix_icon_btn' aria-hidden='true'></i> ${e.label}`}emailFieldOptions(){var e=[],t=[],i=(e,i)=>{var n=e.fields((e=>"email"==e.key)).map((t=>{var n="",s="";return i?(n=`${i.id}|${t.urlPointer()}`,s=`${e.label}.${t.label} (${i.label})`):(n=`|${t.urlPointer()}`,s=`${e.label}.${t.label}`),{id:n,value:s}}));t=t.concat(n)};return i(this.CurrentObject),this.CurrentObject.connectFields().forEach((t=>{e.indexOf(t.id)>-1||(e.push(t.id),i(t.datasourceLink,t))})),t}queryOptions(){var e=[];return this.currentForm.application.datacollectionsIncluded((e=>{let t=e.datasource;return e.settings.isQuery&&t&&t.fields((e=>"email"==e.key)).length>0})).forEach((t=>{t.datasource&&t.datasource.fields((e=>"email"==e.key)).forEach((i=>{e.push({id:`${t.id}|${i.id}`,value:`${t.label}.${i.label}`})}))})),e}enterField(e){var t=webix.UIManager.getFocus(),i="";"text"==t.config.view&&"textarea"==t.config.view||(t.getValue&&(i=t.getValue()),t.setValue&&t.setValue(`${i}${e.label}`),webix.UIManager.setFocus(t))}refreshUI(){$$(this.ids.toEmailsContainer).adjust(),$$(this.ids.message).adjust()}}}(e);return new class extends i{constructor(e="ABViewRuleListFormSubmitRules"){super(e,{labels:{header:r("Submit Rules"),headerDefault:r("Submit Rules")}}),this.base=e}getRule(){var e=[new l(`${this.idBase}_ruleActionConfirmMessage`),new c(`${this.idBase}_ruleActionExistPage`),new h(`${this.idBase}_ruleActionParentPage`),new d(`${this.idBase}_ruleActionClosePopup`),new u(`${this.idBase}_ruleActionWebsite`),new p(`${this.idBase}_ruleActionEmail`)],t=new a(`${this.base}_rule`,e);return t.init(this.AB),t.objectLoad(this.CurrentObject),t.formLoad(this.currentForm),t}}(t)}},2418:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),s=null;function o(e){if(!s){const i=(0,n.Z)(e);var t=i.L();s=class extends i{constructor(t="properties_abview",i={}){var n={label:""};Object.keys(i).forEach((e=>{void 0===n[e]?n[e]="":console.error(`!!! ABFieldProperty:: passed in ids contains a restricted field : ${e}`)})),super(t,n),this.base=t,this.AB=e,this.fieldsHide={}}ui(e=[],i={}){let n=this.ids,s={view:"form",id:n.component,scroll:!0,elements:[{id:n.label,view:"text",label:t("Name"),name:"name",value:"",hidden:!!this.fieldsHide.label}],rules:{}};return e.forEach((e=>{s.elements.push(e)})),Object.keys(i).forEach((e=>{s.rules[e]=i[e]})),s}async init(e){this.AB=e,this.ViewClass()}clearEditor(){console.error("!!! Depreciated! call clear() instead."),this.clear()}clear(){$$(this.ids.label).setValue("")}propertyDatacollections(e){return e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label})))}defaults(){var e=this.ViewClass();return e?e.common():(console.error("!!! properties/views/ABView: could not find ViewClass"),null)}editorPopulate(e){console.error("!!! Depreciated. call populate() instead."),this.populate(e)}formValues(){return $$(this.ids.component).getValues()}isValid(){}markInvalid(e,t){$$(this.ids.component).markInvalid(e,t)}onChange(){this.emit("changed")}populate(e){this.viewLoad(e),$$(this.ids.label)?.setValue(e.label)}requiredOnChange(){}values(){let e={};return e.label=$$(this.ids.label).getValue(),e}ViewClass(){return this._ViewClass(this.constructor.key)}_ViewClass(e){var t=this.CurrentApplication;return t||(t=this.AB.applicationNew({})),t.viewAll((t=>t.common().key==e))[0]}}}return s}},1712:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(t){super(t??"properties_abview_csvexporter",{datacollection:"",buttonLabel:"",hasHeader:"",filename:"",width:"",buttonFilter:"",fields:""}),this.AB=e,this.propertyFilter=this.AB.filterComplexNew(`${t}_filter`)}static get key(){return"csvExporter"}ui(){const e=this.ids;return super.ui([{view:"fieldset",label:s("Data:"),labelWidth:i.labelWidthLarge,body:{rows:[{id:e.datacollection,name:"datacollection",view:"richselect",label:s("Data Source"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{e!=t&&(this.populateFilter(),this.onChange())}}},{id:e.hasHeader,name:"hasHeader",view:"checkbox",label:s("Header on first line"),labelWidth:i.labelWidthXLarge},{cols:[{view:"label",label:s("Filter Option:"),css:"ab-text-bold",width:i.labelWidthLarge},{id:e.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:s("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.showFilterPopup()}}]}]}},{view:"fieldset",label:s("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.buttonLabel,name:"buttonLabel",view:"text",label:s("Label"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.filename,name:"filename",view:"text",label:s("File name"),labelWidth:i.labelWidthLarge},{id:e.width,view:"counter",name:"width",label:s("Width:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:s("Fields:"),labelWidth:i.labelWidthLarge,body:{view:"list",id:e.fields,autoheight:!0,select:!1,template:e=>`<span style="min-width: 18px; display: inline-block;"><i class="fa ${e.isHidden?"fa-square-o":"fa-check-square-o"} ab-visible-field-icon"></i>&nbsp;</span> ${e.label}`,on:{onItemClick:(e,t,i)=>{this.toggleField(e,t,i),this.onChange()}}}}])}async init(e){this.AB=e,await super.init(e),this.propertyFilter.init(),this.propertyFilter.on("save",(e=>{this.onChange(),this.populateBadgeNumber(),this.filter_popup.hide()})),this.filter_popup=webix.ui({view:"popup",width:800,hidden:!0,body:this.propertyFilter.ui})}populate(e){super.populate(e),e.settings=e.settings??{};const t=this.ids,i=this.ViewClass().defaultValues();this.populateDatacollections(),$$(t.hasHeader).setValue(e.settings.hasHeader??i.hasHeader),$$(t.buttonLabel).setValue(e.settings.buttonLabel??i.buttonLabel),$$(t.filename).setValue(e.settings.filename??i.filename),$$(t.width).setValue(e.settings.width??i.width),this.populateFilter(),this.populateBadgeNumber(),this.populateFields()}populateDatacollections(){const e=this.CurrentView.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"}))),t=$$(this.ids.datacollection);t.define("options",e),t.define("value",this.CurrentView?.settings?.dataviewID??null),t.refresh()}populateBadgeNumber(){const e=this.ids,t=this.CurrentView;$$(e.buttonFilter).define("badge",t?.settings?.where?.rules?.length??null),$$(e.buttonFilter).refresh()}populateFilter(){const e=this.CurrentView,t=e.datacollection?.datasource;this.propertyFilter.fieldsLoad(t?.fields()??[]),this.propertyFilter.setValue(e.settings.where)}populateFields(){const e=this.ids,t=$$(e.fields),i=this.CurrentView,n=i.settings.hiddenFieldIds??[],s=i?.datacollection?.datasource?.fields();t.clearAll(),s?.length&&(t.parse(s.map((e=>({id:e.id,label:e.label,isHidden:n.indexOf(e.id)>=0})))),t.refresh())}showFilterPopup(){const e=$$(this.ids.buttonFilter);this.propertyFilter.popUp(e?.$view)}toggleField(e){const t=this.ids,i=$$(t.fields),n=i.getItem(e);i.updateItem(e,{isHidden:!n.isHidden}),i.refresh()}values(){const e=this.ids,t=this.ViewClass().defaultValues(),i=super.values();return i.settings=i.settings??{},i.settings.dataviewID=$$(e.datacollection).getValue(),i.settings.hasHeader=$$(e.hasHeader).getValue(),i.settings.where=this.propertyFilter.getValue(),i.settings.buttonLabel=$$(e.buttonLabel).getValue()??t.buttonLabel,i.settings.filename=$$(e.filename).getValue()??t.filename,i.settings.width=$$(e.width).getValue()??t.width,i.settings.hiddenFieldIds=$$(e.fields).find({isHidden:!0}).map((e=>e.id)),i}ViewClass(){return super._ViewClass("csvExporter")}}}},231:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418),s=i(1538);let o=null;function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L();return class extends t{constructor(t){super(t??"properties_abview_csvimporter",{datacollection:"",fields:"",buttonLabel:"",buttonRecordRules:"",width:""}),this.AB=e}static get key(){return"csvImporter"}ui(){const e=this.ids;return o=(0,s.Z)(this.AB,this.base),super.ui([{view:"fieldset",label:a("Data:"),labelWidth:i.labelWidthLarge,body:{id:e.datacollection,name:"datacollection",view:"richselect",label:a("Data Source"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:e=>this.selectSource(e)}}},{view:"fieldset",label:a("Available Fields:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fields,name:"fields",view:"list",select:!1,minHeight:250,template:this.listTemplate.bind(this),type:{markCheckbox:function(e){return`<span class='check webix_icon fa fa-${e.selected?"check-":""}square-o'></span>`}},onClick:{check:this.check.bind(this)}}]}},{view:"fieldset",label:a("Rules:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:a("Record Rules:"),width:i.labelWidthLarge},{id:e.buttonRecordRules,view:"button",name:"buttonRecordRules",css:"webix_primary",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:this.recordRuleShow.bind(this)}]}]}},{view:"fieldset",label:a("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.buttonLabel,name:"buttonLabel",view:"text",label:a("Label"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>this.onChange()}},{id:e.width,view:"counter",name:"width",label:a("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>this.onChange()}}]}}])}async init(e){this.AB=e,await super.init(e),o.init(e),o.on("save",(()=>{this.populateBadgeNumber()}))}selectSource(e){const t=this.CurrentView;t.settings=t.settings??{},t.settings.dataviewID=e,this.updateRules(),this.populateAvailableFields({selectAll:!0}),this.onChange()}updateRules(){const e=this.CurrentView.datacollection;e?.datasource&&o.objectLoad(e.datasource),o.fromSettings(this.CurrentView?.settings?.recordRules??[])}populateAvailableFields(e={}){const t=this.ids,i=this.CurrentView,n=this.AB.datacollectionByID(i.settings.dataviewID)?.datasource;i.settings=i.settings??{};const s=i.settings.availableFieldIds??[],o=n?.fields()?.map((t=>(t.selected=!!e.selectAll||s.filter((e=>t.id==e)).length>0,t)));$$(t.fields).clearAll(),$$(t.fields).parse(o)}populateBadgeNumber(){const e=this.ids,t=this.CurrentView;t&&($$(e.buttonRecordRules).define("badge",t.settings?.recordRules?.length??null),$$(e.buttonRecordRules).refresh())}listTemplate(e,t){const i=e.formComponent();if(null==i)return`<i class='fa fa-times'></i>  ${e.label} <div class='ab-component-form-fields-component-info'> Disable </div>`;const n=i.common().key,s=this.CurrentApplication.viewAll((e=>e.common().key==n))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${s?.common()?.icon??"fw"}'></i> ${s?a(s.common().labelKey??"Label"):""} </div>`}check(e,t){const i=this.ids;let n=$$(i.fields).getItem(t);n.selected=n.selected?0:1,$$(i.fields).updateItem(t,n),this.onChange()}recordRuleShow(){this.updateRules(),o.CurrentObject&&o.show(),o.qbFixAfterShow()}populate(e){super.populate(e);const t=this.ids;e.settings=e.settings??{},this.populateDataCollections(),this.populateAvailableFields(),$$(t.buttonLabel).setValue(e.settings.buttonLabel),$$(t.width).setValue(e.settings.width),e.settings.availableFieldIds=[],($$(t.fields).find({selected:!0})||[]).forEach((t=>{e.settings.availableFieldIds.push(t.id)}))}populateDataCollections(){const e=this.ids,t=this.CurrentView,i=this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"}))),n=$$(e.datacollection);n.define("options",i),n.define("value",t.settings.dataviewID),n.refresh()}defaultValues(){const e={dataviewID:null,buttonLabel:"Upload CSV",width:0,recordRules:[],availableFieldIds:[]},t=this.ViewClass();if(t){const i=t.defaultValues();Object.keys(i).forEach((t=>{e[t]=i[t]}))}return e}values(){const e=this.ids,t=super.values();return t.settings=t.settings??{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.recordRules=o.toSettings(),t.settings.buttonLabel=$$(e.buttonLabel).getValue(),t.settings.width=$$(e.width).getValue(),t.settings.availableFieldIds=[],$$(e.fields).find({selected:!0}).forEach((e=>{t.settings.availableFieldIds.push(e.id)})),t}ViewClass(){return super._ViewClass("csvImporter")}toSettings(){var e=this.defaults();return e.settings=this.defaultValues(),e}}}},814:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418),s=i(4245),o=i(8782);function a(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),a=t.L(),r="properties_abview_carousel",l=new((0,s.Z)(e,r)),c=new o.Z(e,r);return class extends t{constructor(){super(r,{datacollection:"",field:"",filterByCursor:"",width:"",height:"",showLabel:"",hideItem:"",hideButton:"",navigationType:"",gridFilterMenuButton:"",detailsPage:"",editPage:""}),this.ABFieldImage=e.Class.ABFieldManager.fieldByKey("image"),this._preFilterSettings=null,this.linkPageComponent=new c,this.linkPageComponent.on("changed",(()=>{this.onChange()}))}static get key(){return"carousel"}ui(){let e=this.ids,t=this;return super.ui([{view:"fieldset",label:a("Data:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.datacollection,view:"select",name:"datacollection",label:a("Datacollection:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:(t,i)=>{if(t!=i){this.linkPageComponent.clear();let i=[],n=this.AB.datacollectionByID(t);if(n){let e=n.datasource;e&&(i=e.fields((e=>e instanceof this.ABFieldImage)).map((e=>({id:e.id,value:e.label})))||[])}i.length>0?i.unshift({id:"",value:a("Select a field")}):i.unshift({id:"",value:a("no image fields.")}),$$(e.field).define("options",i),$$(e.field).refresh(),this.onChange()}}}},{id:e.field,view:"select",name:"field",label:a("Image Field:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange()}}},{id:e.filterByCursor,view:"checkbox",name:"filterByCursor",labelWidth:0,labelRight:a("Filter images by cursor"),on:{onChange:()=>{this.onChange()}}}]}},this.linkPageComponent.ui(),{view:"fieldset",label:a("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.navigationType,view:"select",name:"navigationType",label:a("Navigation Type"),labelWidth:i.labelWidthLarge,options:[{id:"corner",value:a("Corner")},{id:"side",value:a("Side")}],on:{onChange:()=>{this.onChange()}}},{id:e.showLabel,view:"checkbox",name:"showLabel",labelRight:a("Show label of image"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.hideItem,view:"checkbox",name:"hideItem",labelRight:a("Hide item list"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.hideButton,view:"checkbox",name:"hideButton",labelRight:a("Hide navigation buttons"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.width,view:"counter",name:"width",label:a("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:a("Height:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{cols:[{view:"label",label:a("Filter Option:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.gridFilterMenuButton,view:"button",css:"webix_primary",label:a("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.filterMenuShow(this.$view)}}]}]}}])}async init(e){super.init(e),this._handler_onCancel=()=>{l.setSettings(this._preFilterSettings),this.filter_property_popup.hide()},this.filter_property_popup=webix.ui({view:"window",modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",hidden:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:a("Filter Menu")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:this._handler_onCancel,on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:l.ui()}),l.on("cancel",this._handler_onCancel),l.on("save",(()=>{this.filter_property_popup.hide(),this.onChange()}));let i=[];return i.push(l.init(e)),i.push(this.linkPageComponent.init(e)),Promise.all(i)}populate(e){super.populate(e);let t=this.ids;if(e){var i=this.propertyDatacollections(e);$$(t.datacollection).define("options",i),$$(t.datacollection).refresh(),$$(t.datacollection).setValue(e.settings.dataviewID),$$(t.field).setValue(e.settings.field),$$(t.filterByCursor).setValue(e.settings.filterByCursor),$$(t.width).setValue(e.settings.width),$$(t.height).setValue(e.settings.height),$$(t.showLabel).setValue(e.settings.showLabel),$$(t.hideItem).setValue(e.settings.hideItem),$$(t.hideButton).setValue(e.settings.hideButton),$$(t.navigationType).setValue(e.settings.navigationType);var n=e.datacollection;n&&(l.objectLoad(n.datasource),l.setSettings(e.settings.filter)),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}filterMenuShow(){this._preFilterSettings=l.getSettings(),this.filter_property_popup.show()}values(){let e=this.ids,t=super.values();t.settings=t.settings||{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.field=$$(e.field).getValue(),t.settings.filterByCursor=$$(e.filterByCursor).getValue()||!1,t.settings.width=$$(e.width).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.hideItem=$$(e.hideItem).getValue(),t.settings.hideButton=$$(e.hideButton).getValue(),t.settings.navigationType=$$(e.navigationType).getValue(),t.settings.filter=l.getSettings();let i=this.linkPageComponent.getSettings();for(let e in i)t.settings[e]=i[e];return t}ViewClass(){return super._ViewClass("carousel")}}}},7887:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3156);function s(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_chart",{dataviewID:"",columnLabel:"",columnValue:"",multipleSeries:"",columnValue2:""}),this.AB=e}static get key(){return"chart"}ui(){const e=this.ids;return super.ui([{id:e.dataviewID,name:"dataviewID",view:"richselect",label:s("Chart Data"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange(),this.populateFieldOptions(),$$(e.multipleSeries).getValue()&&this.populateFieldOptions2()}}},{id:e.columnLabel,name:"columnLabel",view:"richselect",label:s("Label Column"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange()}}},{id:e.columnValue,name:"columnValue",view:"richselect",label:s("Value Column"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:()=>{this.onChange()}}},{id:e.multipleSeries,name:"multipleSeries",view:"checkbox",label:s("Multiple Series"),labelWidth:i.labelWidthLarge,value:0,on:{onChange:t=>{const i=$$(e.columnValue2);t?this.populateFieldOptions2():(i.setValue(""),i.disable()),this.onChange()}}},{id:e.columnValue2,name:"columnValue2",view:"richselect",label:s("Value Column 2"),labelWidth:i.labelWidthLarge,disabled:!0,options:[],on:{onChange:()=>{this.onChange()}}},{name:"isPercentage",view:"checkbox",labelRight:s("Percentage"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{name:"showLabel",view:"checkbox",label:s("Display Label"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{name:"labelPosition",view:"richselect",label:s("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:s("Left")},{id:"top",value:s("Top")}],on:{onChange:()=>{this.onChange()}}},{name:"labelWidth",view:"counter",label:s("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"counter",name:"height",label:`${s("Height")}: `,labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e),webix.extend($$(this.ids.component),webix.ProgressBar)}updateCharts(){this.CurrentView.refreshData()}populateDataview(){const e=this.AB.Account.isSystemDesigner()?e=>!e.isSystemObject:()=>!0,t=this.CurrentApplication.datacollectionsIncluded(e),i=$$(this.ids.dataviewID);i.define("options",t.map((e=>({id:e.id,value:e.label})))),i.refresh()}populateFieldOptions(){const e=this.CurrentView.datacollection;if(!e)return;const t=e.datasource;if(!t)return;const i=this.ids,n=$$(i.columnLabel),s=$$(i.columnValue);n.define("options",t.fields().map((e=>({id:e.id,value:e.columnName,key:e.key})))),n.refresh(),s.define("options",t.fields((e=>"number"===e.key||"formula"===e.key||"calculate"===e.key)).map((e=>({id:e.id,value:e.columnName,key:e.key})))),s.refresh()}populateFieldOptions2(){const e=this.CurrentView.datacollection;if(!e)return;const t=e.datasource;if(!t)return;const i=$$(this.ids.columnValue2);i.define("options",t.fields((e=>"number"===e.key||"formula"===e.key||"calculate"===e.key)).map((e=>({id:e.id,value:e.columnName,key:e.key})))),i.enable(),i.refresh()}populate(e){super.populate(e);const t=this.ids,i=$$(t.component),n=this.defaultValues(),s=Object.assign(i.getValues(),Object.assign(n,e.settings));this.populateDataview(),this.populateFieldOptions(),s.multipleSeries&&this.populateFieldOptions2(),i.setValues(s)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values(),t=this.ids,i=$$(t.component);return e.settings=Object.assign(i.getValues(),e.settings),e}ViewClass(){return super._ViewClass("chart")}}}},7661:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_chart_area",{}),this.AB=e}static get key(){return"area"}ui(){return super.ui([{name:"areaType",view:"richselect",label:s("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"area",value:s("Area")},{id:"stackedArea",value:s("Stacked Area")}],on:{onChange:()=>{this.onChange()}}},{name:"chartHeight",view:"counter",min:1,label:s("Height"),on:{onChange:()=>{this.onChange()}}},{name:"stepValue",view:"counter",min:1,label:s("Step"),on:{onChange:()=>{this.onChange()}}},{name:"maxValue",view:"counter",min:1,label:s("Max Value"),on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:s("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:s("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("area")}}}},2225:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_chart_bar",{}),this.AB=e}static get key(){return"bar"}ui(){return super.ui([{name:"barType",view:"richselect",label:s("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"bar",value:s("Vertical")},{id:"barH",value:s("Horizontal")}],on:{onChange:()=>{this.onChange()}}},{name:"barPreset",view:"richselect",label:s("Chart Preset"),labelWidth:i.labelWidthLarge,options:[{id:"column",value:s("Column")},{id:"stick",value:s("Stick")},{id:"alpha",value:s("Alpha")}],on:{onChange:()=>{this.onChange()}}},{name:"height",view:"counter",min:1,label:s("Height"),on:{onChange:()=>{this.onChange()}}},{name:"stepValue",view:"counter",min:1,label:s("Step"),on:{onChange:()=>{this.onChange()}}},{name:"maxValue",view:"counter",min:1,label:s("Max Value"),on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:s("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:s("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("bar")}}}},992:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_chart_line",{}),this.AB=e}static get key(){return"line"}ui(){return super.ui([{name:"lineType",view:"richselect",label:s("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"line",value:s("Line")},{id:"spline",value:s("Spline")}],on:{onChange:()=>{this.onChange()}}},{name:"linePreset",view:"richselect",label:s("Chart Preset"),labelWidth:i.labelWidthLarge,options:[{id:"plot",value:s("Plot")},{id:"diamond",value:s("Diamond")},{id:"simple",value:s("Simple")}],on:{onChange:()=>{this.onChange()}}},{name:"chartHeight",view:"counter",min:1,label:s("Height"),on:{onChange:()=>{this.onChange()}}},{name:"stepValue",view:"counter",min:1,label:s("Step"),on:{onChange:()=>{this.onChange()}}},{name:"maxValue",view:"counter",min:1,label:s("Max Value"),on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:s("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:s("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("line")}}}},3875:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_chart_pie",{}),this.AB=e}static get key(){return"pie"}ui(){return super.ui([{name:"pieType",view:"richselect",label:s("Chart Type"),labelWidth:i.labelWidthLarge,options:[{id:"pie",value:s("Standard")},{id:"pie3D",value:s("Pie3D")},{id:"donut",value:s("Donut")}],on:{onChange:()=>{this.onChange()}}},{name:"height",view:"counter",min:1,label:s("Height"),on:{onChange:()=>{this.onChange()}}},{name:"innerFontSize",view:"counter",min:1,label:s("Inner Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"labelFontSize",view:"counter",min:1,label:s("Label Font Size"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{name:"isLegend",view:"checkbox",labelRight:s("Show Legend"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=$$(this.ids.component),i=this.defaultValues(),n=Object.assign(t.getValues(),Object.assign(i,e.settings));t.setValues(n)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values();return e.settings=Object.assign($$(this.ids.component).getValues(),e.settings),e}ViewClass(){return super._ViewClass("pie")}}}},4158:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_comment",{dataviewID:"",columnUser:"",columnComment:"",columnDate:"",height:""}),this.AB=e}static get key(){return"comment"}ui(){const e=this.ids;return super.ui([{id:e.dataviewID,view:"richselect",name:"dataviewID",label:s("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:e=>{this.selectSource(e),this.onChange()}}},{id:e.columnUser,view:"richselect",name:"columnUser",label:s("Select a user field"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.columnComment,view:"richselect",name:"columnComment",label:s("Select a comment field"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.columnDate,view:"richselect",name:"columnDate",label:s("Select a date field"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:s("Height:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}selectSource(e){this.updateUserFieldOptions(e),this.updateCommentFieldOptions(e),this.updateDateFieldOptions(e)}updateDatacollectionOptions(e){const t=this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"}))),i=this.ids;$$(i.dataviewID).define("options",t),$$(i.dataviewID).define("value",e),$$(i.dataviewID).refresh()}updateUserFieldOptions(e){const t=this.CurrentView.AB.datacollectionByID(e),i=t?t.datasource:null,n=i?i.fields((e=>"user"===e.key)).map((e=>({id:e.id,value:e.label}))):[];n.unshift({id:null,value:"[Select]"});const s=this.ids;$$(s.columnUser).define("options",n),$$(s.columnUser).refresh()}updateCommentFieldOptions(e){const t=this.CurrentView.AB.datacollectionByID(e),i=t?t.datasource:null,n=i?i.fields((e=>"string"===e.key||"LongText"===e.key)).map((e=>({id:e.id,value:e.label}))):[];n.unshift({id:null,value:"[Select]"});const s=this.ids;$$(s.columnComment).define("options",n),$$(s.columnComment).refresh()}updateDateFieldOptions(e){const t=this.CurrentView.AB.datacollectionByID(e),i=t?t.datasource:null,n=i?i.fields((e=>"date"===e.key)).map((e=>({id:e.id,value:e.label}))):[];n.unshift({id:null,value:"[Select]"});const s=this.ids;$$(s.columnDate).define("options",n),$$(s.columnDate).refresh()}populate(e){super.populate(e);const t=this.ids,i=e.settings.dataviewID?e.settings.dataviewID:null;this.updateDatacollectionOptions(i),this.updateUserFieldOptions(i),this.updateCommentFieldOptions(i),this.updateDateFieldOptions(i);const n=$$(t.component),s=n.getValues();for(const t in e.settings)s[t]=s[t]||e.settings[t];n.setValues(s)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i}ViewClass(){return super._ViewClass("comment")}}}},4856:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L(),o="properties_abview_conditionalcontainer";let a;return class extends t{constructor(){super(o,{buttonFilter:"",datacollection:""}),this.AB=e,a=this.AB.Class.ABViewManager.viewClass("conditionalcontainer").defaultValues()}static get key(){return"conditionalcontainer"}get filterComponent(){return null==this._filterComponent&&(this._filterComponent=this.AB.filterComplexNew(`${o}_filter`)),this._filterComponent}ui(){return this.filterComponent.init(),this.filterComponent.on("save",(e=>{this.onFilterChange(e)})),null==this._filterPopup&&(this._filterPopup=this.AB.Webix.ui({view:"popup",width:800,hidden:!0,body:this.filterComponent.ui})),super.ui([{id:this.ids.datacollection,name:"datacollection",view:"richselect",label:s("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:e=>{this.changeDatacollection(e)}}},{view:"fieldset",name:"filter",label:s("Filter:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:s("Filter Data:"),width:i.labelWidthLarge},{id:this.ids.buttonFilter,view:"button",name:"buttonFilter",label:s("Settings"),icon:"fa fa-gear",type:"icon",css:"webix_primary",autowidth:!0,badge:0,click:()=>{const e=$$(this.ids.buttonFilter);this.showFilterPopup(e?.$view)}}]}]}}])}populate(e){if(super.populate(e),!e)return;const t=this.ids,i=$$(t.datacollection),n=e.application.datacollectionsIncluded().map((e=>{let t="fa-database";return"query"===e.sourceType&&(t="fa-filter"),{id:e.id,value:`<i class="fa ${t}"></i> ${e.label}`}}));i.define("options",n),i.define("value",e?.settings?.dataviewID??null),i.refresh(),e?.settings?.filterConditions&&this.filterComponent.setValue(e.settings.filterConditions),this.populatePopupEditors(e)}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids,t=this.filterComponent.getValue(),i=super.values();return i.settings=i.settings??{},i.settings.dataviewID=$$(e.datacollection).getValue(),i.settings.filterConditions=t,i}ViewClass(){return super._ViewClass("conditionalcontainer")}changeDatacollection(e){const t=this.CurrentView;this.populatePopupEditors(t,e),this.filterComponent.setValue(a.filterConditions),this.onChange(),this.populateBadgeNumber(t)}showFilterPopup(e){this._filterPopup.show(e,{pos:"bottom"})}hideFilterPopup(){this._filterPopup.hide()}onFilterChange(){this.values();const e=this.filterComponent.getValue();this.filterComponent.isConditionComplete(e)&&(this.hideFilterPopup(),setTimeout((()=>{this.onChange();const e=this.CurrentView;this.populateBadgeNumber(e)}),10))}populatePopupEditors(e,t){let i=e.datacollection;t&&(i=e.AB.datacollectionByID(t)),i?.datasource?this.filterComponent.fieldsLoad(i.datasource.fields()):this.filterComponent.fieldsLoad(),this.filterComponent.setValue(e.settings.filterConditions??a.filterConditions),this.populateBadgeNumber(e)}populateBadgeNumber(e){const t=this.ids,i=$$(t.buttonFilter),n=e?.settings?.filterConditions?.rules?.length||null;i.define("badge",n),i.refresh()}}}},3156:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(2418),s=null;function o(e){if(!s){const i=e.Config.uiSettings(),o=(0,n.Z)(e);var t=o.L();s=class extends o{constructor(t="properties_abview_container",i={}){var n={columns:"",gravity:""};Object.keys(i).forEach((e=>{void 0===n[e]?n[e]="":console.error(`!!! ABViewContainerProperty:: passed in ids contains a restricted id : ${e}`)})),super(t,n),this.base=t,this.AB=e}static get key(){return"viewcontainer"}ui(e=[],n={}){let s=this.ids,o=[{id:s.columns,name:"columns",view:"counter",min:1,label:t("Columns"),labelWidth:i.labelWidthXLarge,on:{onChange:(e,n)=>{e>8&&$$(s.columns).setValue(8);let o=$$(s.gravity),a=e=>{var n=o.getParentView().index(o);o.getParentView().addView({view:"counter",value:"1",min:1,label:t("Column {0} Gravity",[e]),labelWidth:i.labelWidthXLarge,css:"gravity_counter",on:{onChange:()=>{this.onChange()}}},n)};function r(){o.getParentView().removeView(o.getParentView().getChildViews()[o.getParentView().index(o)-1])}e>n?(2==e&&a(1),a(e)):e<n&&(r(),1==e&&r()),this.onChange()}}},{id:s.gravity,view:"text",name:"gravity",height:1}];return o=o.concat(e),super.ui(o,n)}clear(){}defaults(){var e=this.ViewClass();return e?e.common():(console.error("!!! properties/views/ABView: could not find ViewClass"),null)}editorPopulate(e){console.error("!!! Depreciated. call populate() instead."),this.populate(e)}formValues(){return $$(this.ids.component).getValues()}isValid(){}markInvalid(e,t){$$(this.ids.component).markInvalid(e,t)}populate(e){super.populate(e);let n=this.ids,s=$$(n.columns);s?.setValue(e.settings.columns||1);let o=$$(n.gravity);if(o){o.getParentView().queryView({css:"gravity_counter"},"all").map((e=>o.getParentView().removeView(e)));let n=s.getValue();if(n>1)for(var a=1;a<=n;a++){var r=o.getParentView().index(o);o.getParentView().addView({view:"counter",min:1,label:t("Column {0} Gravity",[a]),labelWidth:i.labelWidthXLarge,css:"gravity_counter",value:e.settings.gravity&&e.settings.gravity[a-1]?e.settings.gravity[a-1]:1,on:{onChange:()=>{this.onChange()}}},r)}}}requiredOnChange(){}values(){let e=super.values();e.settings={},e.settings.columns=$$(this.ids.columns).getValue();var t=[];return $$(this.ids.gravity).getParentView().queryView({css:"gravity_counter"},"all").map((e=>t.push($$(e).getValue()))),e.settings.gravity=t,e}ViewClass(){return super._ViewClass("viewcontainer")}}}return s}},5786:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(){super("properties_abview_data_filter",{datacollection:"",fields:"",custom_filters:"",custom_sort:"",batch:""}),this.AB=e}static get key(){return"data-filter"}ui(){let e=this.ids;return super.ui([{id:e.batch,visibleBatch:"advanced",rows:[{id:e.viewtype,name:"viewType",view:"combo",label:s("Display as"),labelWidth:t.labelWidthLarge,on:{onChange:(t,i)=>{t!=i&&($$(e.batch).showBatch(t),this.onChange())}},options:[{id:"advanced",value:"Search & filter"},{id:"connected",value:"Connected field"}]},{id:e.datacollection,name:"dataviewID",view:"combo",label:s("Datacollection"),labelWidth:t.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.populateFields(e),this.onChange())}}},{id:e.fields,batch:"connected",name:"field",view:"combo",label:s("Field"),labelWidth:t.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"checkbox",batch:"advanced",id:e.custom_filters,label:"Show Filters",labelWidth:t.labelWidthLarge,name:"showFilter",on:{onChange:()=>{this.onChange()}}},{view:"checkbox",batch:"advanced",id:e.custom_sort,label:"Show Sort",labelWidth:t.labelWidthLarge,name:"showSort",on:{onChange:()=>{this.onChange()}}},{}]}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);let t=this.ids;if(!e)return;const i=$$(t.component),n=this.defaultValues();let s=i.getValues();for(const e in n)s[e]=n[e]||s[e];for(const t in e.settings)s[t]=void 0!==e.settings[t]?e.settings[t]:s[t];let o=s.dataviewID?s.dataviewID:null;var a=$$(t.datacollection),r=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"})));a.define("options",r),a.define("value",e.datacollection),a.refresh(),o&&this.populateFields(o),i.setValues(s)}populateFields(e){let t=this.ids,i=this.AB.datacollectionByID(e);var n;n=(i?i.datasource:null).connectFields().map((e=>({id:e.columnName,value:e.label}))),$$(t.fields).define("options",n),$$(t.fields).refresh()}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i.text=i.settings.text,i}ViewClass(){return super._ViewClass("data-filter")}}}},2100:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e),s=i.L();return class extends i{constructor(){super("properties_abview_data_filter",{datacollection:"",labelField:""}),this.AB=e}static get key(){return"data-select"}ui(){let e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"combo",label:s("Datacollection"),labelWidth:t.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.onChange(),this.populateFields(e))}}},{id:e.labelField,name:"labelField",view:"combo",label:s("Label"),labelWidth:t.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){let t=this.ids;if(!e)return;const i=$$(t.component),n=this.defaultValues();let s=i.getValues();for(const e in n)s[e]=n[e]||s[e];for(const t in e.settings)s[t]=void 0!==e.settings[t]?e.settings[t]:s[t];let o=s.dataviewID?s.dataviewID:null;var a=$$(t.datacollection),r=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"})));a.define("options",r),a.define("value",e.datacollection),a.refresh(),o&&this.populateFields(o),i.setValues(s)}populateFields(e){const t=this.AB.datacollectionByID(e).datasource.fields().map((e=>({id:e.id,value:e.label})));$$(this.ids.labelField).define("options",t),$$(this.ids.labelField).refresh()}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i.text=i.settings.text,i}ViewClass(){return super._ViewClass("data-select")}}}},3300:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(1377),s=i(8782);function o(e){const t="properties_abview_dataview",i=(0,n.default)(e),o=(0,s.Z)(e,t),a=e.Config.uiSettings(),r=i.L();let l={};return class extends i{constructor(){super(t,{xCount:""}),this.AB=e,l=this.AB.Class.ABViewManager.viewClass("dataview").defaultValues(),this.linkPageComponent=new o(e,t)}static get key(){return"dataview"}ui(){const e=this.ids;return super.ui([{id:e.xCount,view:"counter",name:"xCount",min:1,label:r("Items in a row"),labelWidth:a.labelWidthLarge,step:1,on:{onChange:()=>{this.onChange()}}},this.linkPageComponent.ui()])}init(){super.init(this.AB),this.linkPageComponent.init(),this.linkPageComponent.on("changed",(()=>{this.onChange()}))}populate(e){if(super.populate(e),!e)return;const t=this.ids;$$(t.xCount).setValue(e.settings.xCount||l.xCount),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids;let t=super.values();t.settings=t.settings??{},t.settings.xCount=$$(e.xCount).getValue();let i=this.linkPageComponent.getSettings();for(let e in i)t.settings[e]=i[e];return t}ViewClass(){return super._ViewClass("dataview")}}}},1377:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3156);function s(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),s=t.L();let o={};return class extends t{constructor(t,i={}){super(t,Object.assign({datacollection:"",fields:"",showLabel:"",labelPosition:"",labelWidth:"",height:""},i)),this.AB=e,o=this.AB.Class.ABViewManager.viewClass("detail").defaultValues()}static get key(){return"detail"}ui(e){const t=this.ids;let n=[{id:t.datacollection,name:"datacollection",view:"richselect",label:s("Data Source"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{this.selectSource(e,t)}}},{id:t.fields,name:"fields",view:"list",select:!1,minHeight:200,template:this.listTemplate,type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:(...e)=>this.check(...e)}},{id:t.showLabel,name:"showLabel",view:"checkbox",label:s("Display Label"),labelWidth:i.labelWidthLarge},{id:t.labelPosition,name:"labelPosition",view:"richselect",label:s("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:s("Left")},{id:"top",value:s("Top")}],on:{onChange:()=>{this.onChange()}}},{id:t.labelWidth,name:"labelWidth",view:"counter",label:s("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.height,name:"height",view:"counter",label:s("Height:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}];return(e??[]).forEach((e=>{n.push(e)})),super.ui(n)}populate(e){if(super.populate(e),!e)return;const t=this.ids,i=e.settings?.dataviewID,n=$$(t.datacollection),s=e.application.datacollectionsIncluded().filter((e=>{const t=e.datasource;return t&&!t.isImported})).map((e=>{let t={id:e.id,value:e.label};return"query"==e.sourceType?t.icon="fa fa-filter":t.icon="fa fa-database",t}));n.define("options",s),n.define("value",i),n.refresh(),this.propertyUpdateFieldOptions(i,e),$$(t.showLabel).setValue(e.settings.showLabel??o.showLabel),$$(t.labelPosition).setValue(e.settings.labelPosition??o.labelPosition),$$(t.labelWidth).setValue(parseInt(e.settings.labelWidth)??o.labelWidth),$$(t.height).setValue(e.settings.height>=0?e.settings.height:o.height),e?.views().forEach((t=>{t instanceof this.AB.Class.ABViewDetailItem&&t.once("destroyed",(()=>this.populate(e)))}))}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids;let t=super.values();return t.settings=t.settings??{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue(),t.settings.labelWidth=$$(e.labelWidth).getValue(),t.settings.height=$$(e.height).getValue(),t}ViewClass(){return super._ViewClass("detail")}propertyUpdateFieldOptions(e,t){const i=this.ids,n=this.AB.datacollectionByID(e)?.datasource,s=n?.fields().map((e=>(e.selected=t?.views((t=>e.id==t.settings.fieldId)).length>0,e)));$$(i.fields).clearAll(),$$(i.fields).parse(s??[])}async selectSource(e){const t=this.ids;let i=this.CurrentView;i.settings.dataviewID=e;let n=i._views;i._views=[];let s=[];n.forEach((e=>{s.push(e.destroy())})),await Promise.all(s),this.propertyUpdateFieldOptions(e);let o=[],a=$$(t.fields).find({});a.reverse(),a.forEach(((e,n)=>{if(!e.selected){const s=a.length-n-1,r=i.addFieldToDetail(e,s);r&&(r.once("destroyed",(()=>this.populate(i))),o.push(r.save())),e.selected=1,$$(t.fields).updateItem(e.id,e)}})),await Promise.all(o),await i.save(),i.parentDetailComponent()?.emit("properties.updated",i),this.onChange()}listTemplate(e,t){return`${t.markCheckbox(e)} ${e.label}`}check(e,t){const i=this.ids,n=this.CurrentView,s=n.parentDetailComponent(),o=$$(i.fields).getItem(t);o.selected=o.selected?0:1,$$(i.fields).updateItem(t,o);const a=()=>{n.emit("properties.updated",n),this.onChange()};if(o.selected){const e=n.addFieldToDetail(o);e&&e.save().then((()=>{e.once("destroyed",(()=>this.populate(n))),n.viewInsert(e).then((()=>{a()}))}))}else{const e=s.views((e=>e.settings.fieldId==t))[0];e&&(e.destroy(),n.viewRemove(e).then((()=>{a()})))}}}}},9270:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(7420);function s(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abview_detail_checkbox",{height:""}),this.AB=e}static get key(){return"detailcheckbox"}ViewClass(){return super._ViewClass("detailcheckbox")}}}},3381:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(7420);function s(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abview_detail_custom",{height:""}),this.AB=e}static get key(){return"detailcustom"}ViewClass(){return super._ViewClass("detailcustom")}}}},8568:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(7420);function s(e){const t={height:0,width:0},i=(0,n.default)(e);return class extends i{constructor(){super("properties_abview_detail_image",{height:"",width:""}),this.AB=e}static get key(){return"detailimage"}ui(){return super.ui([{id:this.ids.height,name:"height",view:"counter",label:this.label("Height"),on:{onChange:()=>this.onChange()}},{id:this.ids.width,name:"width",view:"counter",label:this.label("Width"),on:{onChange:()=>this.onChange()}}])}ViewClass(){return super._ViewClass("detailimage")}populate(e){super.populate(e);const t=this.defaultValues(),i=e.settings?.height??t.height;$$(this.ids.height).setValue(i);const n=e.settings?.width??t.width;$$(this.ids.width).setValue(n)}defaultValues(){const e=super.defaultValues();return Object.assign(t,e)}values(){const e=super.values()??{};return e.settings=e.settings??{},e.settings.height=$$(this.ids.height).getValue(),e.settings.width=$$(this.ids.width).getValue(),e}}}},7420:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(t,i={}){super(t,Object.assign(i,{field:""})),this.AB=e}ui(e=[],t={}){const n=[{id:this.ids.field,name:"fieldLabel",view:"text",disabled:!0,label:i("Field")}].concat(e);return super.ui(n,t)}populate(e){super.populate(e);const[t]=this.AB.objectByID(e.settings.objectId).fields((t=>t.id==e.settings.fieldId));$$(this.ids.field).setValue(t.label)}defaultValues(){const e=this.ViewClass();let t={};return e&&(t=e.defaultValues()),t}}}},1023:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(7420);function s(e){const t={height:0},i=(0,n.default)(e);return class extends i{constructor(){super("properties_abview_detail_text",{height:""}),this.AB=e}static get key(){return"detailtext"}ui(){return super.ui([{id:this.ids.height,name:"height",view:"counter",label:this.label("Height"),on:{onChange:()=>this.onChange()}}])}ViewClass(){return super._ViewClass("detailtext")}populate(e){super.populate(e);const t=this.defaultValues(),i=e.settings?.height??t.height;$$(this.ids.height).setValue(i)}defaultValues(){const e=super.defaultValues();return Object.assign(t,e)}values(){const e=super.values()??{};return e.settings=e.settings??{},e.settings.height=$$(this.ids.height).getValue(),e}}}},7901:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(7420);function s(e){const t=(0,n.default)(e);return class extends t{constructor(){super("properties_abview_detail_tree",{height:""}),this.AB=e}static get key(){return"detailtree"}ViewClass(){return super._ViewClass("detailtree")}}}},6309:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();let o={};return class extends t{constructor(){super("properties_abview_docxBuilder",{buttonlabel:"",buttonPosition:"",datacollection:"",docxFile:"",docxDownload:"",filelabel:"",language:"",toolbarBackground:"",width:0}),this.AB=e,o=this.AB.Class.ABViewManager.viewClass("docxBuilder").defaultValues()}static get key(){return"docxBuilder"}ui(){const e=this.AB.Multilingual.languages().map((e=>({id:e.language_code,value:e.language_label})));return super.ui([{view:"fieldset",label:s("Data:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.datacollection,name:"datacollection",view:"multiselect",label:s("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{$$(this.ids.datacollection).getValue()?$$(this.ids.docxFile).enable():$$(this.ids.docxFile).disable(),this.onChange()}}}]}},{view:"fieldset",label:s("Template file:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:s("DOCX file:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:this.ids.docxFile,view:"uploader",value:s("Upload"),name:"docxFile",apiOnly:!0,inputName:"file",multiple:!1,on:{onBeforeFileAdd:e=>this.validateType(e),onFileUpload:(e,t)=>{this.uploadedFile(e)},onFileUploadError:(e,t)=>{},onViewShow:()=>{$$(this.ids.datacollection).getValue()?$$(this.ids.docxFile).enable():$$(this.ids.docxFile).disable()}}}]},{id:this.ids.filelabel,name:"filelabel",view:"text",label:s("Filename"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:this.ids.docxDownload,name:"docxDownload",view:"button",type:"icon",css:"webix_primary",icon:"fa fa-file-word-o",label:s("Download Template File"),click:()=>{this.downloadFile()}}]}},{view:"fieldset",label:s("Language:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.language,name:"language",view:"richselect",label:s("Language"),labelWidth:i.labelWidthLarge,options:e,on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:s("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.buttonlabel,name:"buttonlabel",view:"text",label:s("Label"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:this.ids.width,view:"counter",name:"width",label:s("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:this.ids.toolbarBackground,view:"richselect",name:"toolbarBackground",label:s("Page background:"),labelWidth:i.labelWidthXLarge,options:[{id:"ab-background-default",value:s("White (default)")},{id:"webix_dark",value:s("Dark")},{id:"ab-background-lightgray",value:s("Gray")}],on:{onChange:()=>{this.onChange()}}},{id:this.ids.buttonPosition,view:"richselect",name:"buttonPosition",label:s("Button Position:"),labelWidth:i.labelWidthXLarge,options:[{id:"left",value:s("Left (default)")},{id:"center",value:s("Centered")},{id:"right",value:s("Right")}],on:{onChange:()=>{this.onChange()}}}]}}])}populate(e){if(super.populate(e),!e)return;const t=this.ids,i=$$(t.datacollection),n=e.settings.dataviewID??null;$$(t.toolbarBackground).setValue(e.settings.toolbarBackground??o.toolbarBackground),$$(t.buttonPosition).setValue(e.settings.buttonPosition??o.buttonPosition);const s=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"===e.sourceType?"fa fa-filter":"fa fa-database"})));i.define("options",s),i.define("value",n),i.refresh(),$$(t.language).setValue(e.settings.language??o.language),$$(t.filelabel).setValue(e.filelabel??e.settings.filelabel),$$(t.buttonlabel).setValue(e.buttonlabel??e.settings.buttonlabel),$$(t.width).setValue(e.settings.width),e.settings.filename?$$(t.docxDownload).show():$$(t.docxDownload).hide()}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){const e=this.ids;let t=super.values();return t.settings=t.settings??{},t.settings.buttonlabel=$$(e.buttonlabel).getValue(),t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.width=$$(e.width).getValue(),t.filelabel=$$(e.filelabel).getValue(),t.settings.language=$$(e.language).getValue(),t.settings.toolbarBackground=$$(e.toolbarBackground).getValue(),t.settings.buttonPosition=$$(e.buttonPosition).getValue(),t}ViewClass(){return super._ViewClass("docxBuilder")}validateType(e){const t=this.ids,i=["docx"],n=e.type.toLowerCase();if(-1==i.indexOf(n))return this.AB.Webix.message(s(`Only [${i.join(", ")}] files are supported`)),!1;{const e=this.CurrentView.uploadUrl();return $$(t.docxFile).define("upload",e),$$(t.docxFile).refresh(),!0}}uploadedFile(e){if(!e||!e.data)return;const t=this.ids;let i=this.CurrentView;i.settings.filename=e.data.uuid,i.filelabel=e.name,$$(t.filelabel).setValue(i.filelabel),$$(t.docxDownload).show()}downloadFile(){const e=this.CurrentView,t=e.downloadUrl();fetch(t).then((e=>e.blob())).then((t=>{e.letUserDownload(t,e.filelabel)}))}}}},3257:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(3156),s=i(1538),o=i(708);function a(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),a=t.L();var r={};const l="properties_abview_form",c=(0,s.Z)(e,`${l}_popupRecordRule`),h=(0,o.Z)(e,`${l}_popupSubmitRule`);return class extends t{constructor(){super(l,{datacollection:"",fields:"",showLabel:"",labelPosition:"",labelWidth:"",height:"",clearOnLoad:"",clearOnSave:"",buttonSubmitRules:"",buttonRecordRules:""}),this.AB=e,r=this.AB.Class.ABViewManager.viewClass("form").defaultValues()}static get key(){return"form"}ui(){let e=this.ids;return super.ui([{id:e.datacollection,view:"richselect",name:"datacollection",label:a("Datacollection"),labelWidth:i.labelWidthLarge,skipAutoSave:!0,on:{onChange:(e,t)=>{this.selectSource(e,t)}}},{view:"fieldset",label:a("Form Fields:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fields,view:"list",name:"fields",select:!1,minHeight:200,template:(...e)=>this.listTemplate(...e),type:{markCheckbox:function(e){return"<span class='check webix_icon fa fa-"+(e.selected?"check-":"")+"square-o'></span>"}},onClick:{check:(...e)=>this.check(...e)}}]}},{id:e.showLabel,name:"showLabel",view:"checkbox",label:a("Display Label"),labelWidth:i.labelWidthLarge,click:()=>{this.onChange()}},{id:e.labelPosition,view:"richselect",name:"labelPosition",label:a("Label Position"),labelWidth:i.labelWidthLarge,options:[{id:"left",value:a("Left")},{id:"top",value:a("Top")}],on:{onChange:()=>{this.onChange()}}},{id:e.labelWidth,view:"counter",name:"labelWidth",label:a("Label Width"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:a("Height"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.clearOnLoad,view:"checkbox",name:"clearOnLoad",label:a("Clear on load"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.clearOnSave,view:"checkbox",name:"clearOnSave",label:a("Clear on save"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{view:"fieldset",label:a("Rules:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:a("Submit Rules:"),width:i.labelWidthLarge},{id:e.buttonSubmitRules,view:"button",css:"webix_primary",name:"buttonSubmitRules",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.submitRuleShow()}}]},{cols:[{view:"label",label:a("Record Rules:"),width:i.labelWidthLarge},{id:e.buttonRecordRules,view:"button",name:"buttonRecordRules",css:"webix_primary",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.recordRuleShow()}}]}]}}])}async init(e){super.init(e),webix.extend($$(this.ids.component),webix.ProgressBar);let t=[];return t.push(c.init(e)),c.on("save",(()=>{this.onChange(),this.populateBadgeNumber()})),t.push(h.init(e)),h.on("save",(()=>{this.onChange(),this.populateBadgeNumber()})),Promise.all(t)}populate(e){super.populate(e);let t=this.ids;if(!e)return;let i=e.parentFormComponent(),n=i.settings.dataviewID?i.settings.dataviewID:null;var s=$$(t.datacollection),o=e.application.datacollectionsIncluded().filter((e=>{const t=e.datasource;return"object"==e.sourceType&&!t?.isImported&&!t?.isReadOnly})).map((e=>{let t={id:e.id,value:e.label};return"query"==e.sourceType?t.icon="fa fa-filter":t.icon="fa fa-database",t}));s.define("options",o),s.define("value",n),s.refresh(),this.propertyUpdateFieldOptions(n),e.views().forEach((t=>{t instanceof this.AB.Class.ABViewFormItem&&t.once("destroyed",(()=>this.populate(e)))})),s.enable(),$$(t.showLabel).setValue(e.settings.showLabel),$$(t.labelPosition).setValue(e.settings.labelPosition||r.labelPosition),$$(t.labelWidth).setValue(e.settings.labelWidth||r.labelWidth),$$(t.height).setValue(e.settings.height||r.height),$$(t.clearOnLoad).setValue(e.settings.clearOnLoad||r.clearOnLoad),$$(t.clearOnSave).setValue(e.settings.clearOnSave||r.clearOnSave),c.objectLoad(this.CurrentObject),c.viewLoad(e),c.fromSettings(e.settings.recordRules||[]),h.objectLoad(this.CurrentObject),h.viewLoad(e),h.fromSettings(e.settings.submitRules||[]),this.populateBadgeNumber(),this.updateEventIds=this.updateEventIds||{},this.updateEventIds[e.id]||(this.updateEventIds[e.id]=!0,e.addListener("properties.updated",(()=>{this.populateBadgeNumber()})))}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){let e=this.ids,t=super.values();return t.settings=t.settings||{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.showLabel=$$(e.showLabel).getValue(),t.settings.labelPosition=$$(e.labelPosition).getValue()||r.labelPosition,t.settings.labelWidth=$$(e.labelWidth).getValue()||r.labelWidth,t.settings.height=$$(e.height).getValue(),t.settings.clearOnLoad=$$(e.clearOnLoad).getValue(),t.settings.clearOnSave=$$(e.clearOnSave).getValue(),t.settings.recordRules=c.toSettings(),t.settings.submitRules=h.toSettings(),t}ViewClass(){return super._ViewClass("carousel")}busy(){$$(this.ids.component)?.showProgress?.({type:"icon"})}check(e,t){const i=this.ids;let n=this.CurrentView,s=n.parentFormComponent(),o=$$(i.fields).getItem(t);o.selected=o.selected?0:1,$$(i.fields).updateItem(t,o);let a=()=>{s.refreshDefaultButton(i).save().then((()=>{n.emit("properties.updated",n),this.onChange()}))};if(o.selected){let e=n.addFieldToForm(o);e&&e.save().then((()=>{e.once("destroyed",(()=>this.populate(n))),n.viewInsert(e).then((()=>{a()}))}))}else{let e=s.fieldComponents().filter((e=>e.settings.fieldId==t))[0];e&&(e.destroy(),n.viewRemove(e).then((()=>{a()})))}}populateBadgeNumber(){const e=this.ids;let t=this.CurrentView;t&&(t.settings.submitRules?$$(e.buttonSubmitRules).define("badge",t.settings.submitRules.length||null):$$(e.buttonSubmitRules).define("badge",null),$$(e.buttonSubmitRules).refresh(),t.settings.recordRules?$$(e.buttonRecordRules).define("badge",t.settings.recordRules.length||null):$$(e.buttonRecordRules).define("badge",null),$$(e.buttonRecordRules).refresh())}ready(){$$(this.ids.component)?.hideProgress?.()}recordRuleShow(){c.fromSettings(this.CurrentView.settings.recordRules),c.show()}submitRuleShow(){h.fromSettings(this.CurrentView.settings.submitRules),h.show()}listTemplate(e,t){let i=this.CurrentView;var n=e.formComponent();if(null==n)return`<i class='fa fa-times'></i>  ${e.label} <div class='ab-component-form-fields-component-info'> Disable </div>`;var s=n.common().key,o=i.application.viewAll((e=>e.common().key==s))[0];return`${t.markCheckbox(e)} ${e.label} <div class='ab-component-form-fields-component-info'> <i class='fa fa-${o?o.common().icon:"fw"}'></i> ${o?a(o.common().labelKey):""} </div>`}propertyUpdateFieldOptions(e){const t=this.ids;var i=this.CurrentView.parentFormComponent().fieldComponents(),n=this.AB.datacollectionByID(e),s=n?n.datasource:null,o=[];null!=s&&(o=s.fields().map((e=>(e.selected=i.filter((t=>e.id==t.settings.fieldId)).length>0,e))),this.objectLoad(s)),$$(t.fields).clearAll(),$$(t.fields).parse(o)}refreshDefaultButton(){const e=this.ids,t=this.AB.Class.ABViewManager.viewClass("button");let i=this.views((e=>e instanceof t&&e.settings.isDefault))[0];null==i?(i=t.newInstance(this.application,this),i.settings.isDefault=!0):this._views=this.views((e=>!(e instanceof t||e.settings.isDefault)));let n=this.views().map((e=>(e.position.y||0)+1));n.push(this._views.length||0),n.push($$(e.fields).length||0);let s=Math.max(...n);return i.position.y=s,this._views.push(i),i}selectSource(e){const t=this.ids;this.busy();let i=this.CurrentView,n=i.parentFormComponent();i.settings.dataviewID=e;var s=i._views;return i._views=[],Promise.resolve().then((()=>{var e=[];return s.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(this.propertyUpdateFieldOptions(e),i._views.length>0)return Promise.resolve();let s=[],o=$$(t.fields).find({});o.reverse(),o.forEach(((e,n)=>{if(!e.selected){let a=o.length-n-1,r=i.addFieldToForm(e,a);r&&(r.once("destroyed",(()=>this.populate(i))),s.push(r.save())),e.selected=1,$$(t.fields).updateItem(e.id,e)}}));let a=n.refreshDefaultButton(t);return a&&s.push(a.save()),Promise.all(s)})).then((()=>i.save())).then((()=>(n.emit("properties.updated",i),this.ready(),this.onChange(),Promise.resolve())))}}}},3020:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_button",{includeSave:"",saveLabel:"",includeCancel:"",cancelLabel:"",includeReset:"",resetLabel:"",includeDelete:"",deleteLabel:"",afterCancel:"",alignment:""}),this.AB=e}static get key(){return"button"}ui(){const e=this.ids,t=this.AB.UISettings.config();return super.ui([{id:e.includeSave,name:"includeSave",view:"checkbox",label:i("Save"),click:()=>this.onChange()},{id:e.saveLabel,name:"saveLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Save Label"),placeholder:i("Save Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeCancel,name:"includeCancel",view:"checkbox",label:i("Cancel"),click:()=>this.onChange()},{id:e.cancelLabel,name:"cancelLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Cancel Label"),placeholder:i("Cancel Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeReset,name:"includeReset",view:"checkbox",label:i("Reset"),click:()=>this.onChange()},{id:e.resetLabel,name:"resetLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Reset Label"),placeholder:i("Reset Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.includeDelete,name:"includeDelete",view:"checkbox",label:i("Delete"),click:()=>this.onChange()},{id:e.deleteLabel,name:"deleteLabel",view:"text",labelWidth:t.labelWidthLarge,label:i("Delete Label"),placeholder:i("Delete Placeholder"),on:{onChange:()=>this.onChange()}},{id:e.afterCancel,name:"afterCancel",view:"richselect",labelWidth:t.labelWidthLarge,label:i("After Cancel"),on:{onChange:()=>this.onChange()}},{id:e.alignment,name:"alignment",view:"richselect",labelWidth:t.labelWidthLarge,label:i("Alignment"),options:[{id:"left",value:i("Left")},{id:"center",value:i("Center")},{id:"right",value:i("Right")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues(),n=[];this.addPagesToList(n,e.application,e.pageRoot().id);const s=n.map((e=>({id:e.id,value:e.value})));$$(t.afterCancel).define("options",s),$$(t.includeSave).setValue(null!=e.settings.includeSave?e.settings.includeSave:i.includeSave),$$(t.includeCancel).setValue(null!=e.settings.includeCancel?e.settings.includeCancel:i.includeCancel),$$(t.includeReset).setValue(null!=e.settings.includeReset?e.settings.includeReset:i.includeReset),$$(t.includeDelete).setValue(null!=e.settings.includeDelete?e.settings.includeDelete:i.includeDelete),$$(t.saveLabel).setValue(e.settings.saveLabel??""),$$(t.cancelLabel).setValue(e.settings.cancelLabel??""),$$(t.resetLabel).setValue(e.settings.resetLabel??""),$$(t.deleteLabel).setValue(e.settings.deleteLabel??""),$$(t.afterCancel).setValue(e.settings.afterCancel??i.afterCancel),$$(t.alignment).setValue(e.settings.alignment??i.alignment)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.includeSave=$$(e.includeSave).getValue(),i.settings.saveLabel=$$(e.saveLabel).getValue(),i.settings.includeCancel=$$(e.includeCancel).getValue(),i.settings.cancelLabel=$$(e.cancelLabel).getValue(),i.settings.includeReset=$$(e.includeReset).getValue(),i.settings.resetLabel=$$(e.resetLabel).getValue(),i.settings.includeDelete=$$(e.includeDelete).getValue(),i.settings.deleteLabel=$$(e.deleteLabel).getValue(),i.settings.afterCancel=$$(e.afterCancel).getValue(),i.settings.alignment=$$(e.alignment).getValue(),i}ViewClass(){return super._ViewClass("button")}addPagesToList(e,t,i){t&&t.pages&&e&&(t.pages()??[]).forEach((t=>{null==t.parent&&t.id!=i||(e.push({id:t.id,value:t.label}),this.addPagesToList(e,t,t.id))}))}}}},2480:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_checkbox",{}),this.AB=e}static get key(){return"checkbox"}}}},2318:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var n=i(4412),s=i(423),o=i(3285);let a=null,r=null;function l(e){const t="properties_abview_connect",i=(0,n.Z)(e),l=function(e,t){if(!a){const t="properties_abview_connect_viewpropertyaddpage",i=(0,o.Z)(e),n=i.L();a=class extends i{static get default(){return{formView:"none"}}constructor(){super(t,{formView:""}),this.AB=e}ui(){const e=this.ids;return{id:e.formView,name:"formView",view:"richselect",label:n("Add New Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(t,i)=>{t==n("No add new option")&&$$(e.formView).setValue(""),this.emit("change")}}}}setSettings(e,t={}){if(null==e)return;let i=[{id:"none",value:n("No add new option")}];const s=e.pageRoot().pages((t=>t.views((t=>"form"==t?.key&&t?.datacollection?.datasource?.id==e.field().settings.linkObject),!0).length),!0).map((e=>({id:e.id,value:e.label})));i=i.concat(s);const o=$$(this.ids.formView);o&&(o.define("options",i),o.define("value",t.formView??this.constructor.default.formView),o.refresh())}getSettings(e){const t=e.settings??{};return t.formView=$$(this.ids.formView).getValue(),t}}}return a}(e),c=function(e,t){if(!r){const t="properties_abview_connect_viewpropertyeditpage",i=(0,o.Z)(e),n=i.L();r=class extends i{static get default(){return{editForm:"none"}}constructor(){super(t,{formEdit:""}),this.AB=e}ui(){const e=this.ids;return{id:e.formEdit,name:"editForm",view:"richselect",label:n("Edit Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(t,i)=>{t==n("No add new option")&&$$(e.formEdit).setValue(""),this.emit("change")}}}}setSettings(e,t={}){if(null==e)return;const i=[{id:"none",value:n("No add new option")}];(e.pageRoot().pages((()=>!0),!0)??[]).forEach((t=>{t&&t.views((()=>!0),!0).forEach((n=>{"form"==n?.key&&n?.datacollection?.datasource?.id==e.field().settings.linkObject&&i.push({id:n.urlPointer(),value:`${t.label} - ${n.label}`})}))}));const s=$$(this.ids.formEdit);s&&(s.define("options",i),s.define("value",t.editForm??this.constructor.default.editForm),s.refresh())}getSettings(e){const t=e.settings||{},i=$$(this.ids.formEdit),n=(i.getPopup().config.body.data??[]).filter((e=>e.id==i.getValue()))[0];return n&&(t.editForm=n.id),t}}}return r}(e),h=i.L();let d=null,u=null;return class extends i{constructor(){super(t,{addNewSettings:"",popupWidth:"",popupHeight:"",advancedOption:"",buttonFilter:"",filterConnectedValue:"",buttonSort:""}),this.AB=e,d=this.AB.filterComplexNew(`${t}_filter`),d.on("save",(()=>this.onChange())),u=(0,s.Z)(this.AB,`${t}_sort`),u.on("changed",(()=>this.onChange()))}static get key(){return"connect"}ui(){const e=this,t=this.ids,i=this.AB.UISettings.config();return super.ui([this.addPageProperty.ui(),this.editPageProperty.ui(),{id:t.addNewSettings,view:"fieldset",name:"addNewSettings",label:h("Add New Popup Settings:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:t.popupWidth,view:"text",name:"popupWidth",placeholder:h("Set popup width"),label:h("Width:"),labelWidth:i.labelWidthLarge,validate:this.AB.Webix.rules.isNumber,on:{onChange:()=>this.onChange()}},{id:t.popupHeight,view:"text",name:"popupHeight",placeholder:h("Set popup height"),label:h("Height:"),labelWidth:i.labelWidthLarge,validate:this.AB.Webix.rules.isNumber,on:{onChange:()=>this.onChange()}}]}},{id:t.advancedOption,view:"fieldset",name:"advancedOption",label:h("Advanced Options:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:h("Filter Options:"),width:i.labelWidthLarge},{id:t.buttonFilter,view:"button",name:"buttonFilter",css:"webix_primary",label:h("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){e.showFilterPopup(this.$view)}}]},{rows:[{view:"label",label:h("Filter by Connected Field Value:")},{id:t.filterConnectedValue,view:"combo",name:"filterConnectedValue",options:[],on:{onChange:()=>this.onChange()}}]},{height:30},{rows:[{cols:[{view:"label",label:h("Sort Options:"),width:i.labelWidthLarge},{id:t.buttonSort,view:"button",name:"buttonSort",css:"webix_primary",label:h("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){e.showSortPopup(this.$view)}}]}]}]}}])}async init(e){this.AB=e,await super.init(e),d.init(),u.init(e),this.addPageProperty.on("change",(()=>{this.onChange()})),this.editPageProperty.on("change",(()=>{this.onChange()}))}populate(e){super.populate(e),this.populateFilterByConnectedFieldValue(e);const t=this.ids,i=this.defaultValues(),n=[{id:null,value:""}],s=this.AB.definitionByID(e.settings.fieldId),o=this.AB.definitionByID(s.settings.linkObject),a=[];o.fieldIDs.forEach((e=>{a.push(this.AB.definitionByID(e))}));const r=e.application.connectedObjects(s.settings.linkObject);e.parent.views().forEach((t=>{if("connect"==t.key){const i=this.AB.definitionByID(t.settings.fieldId);r.forEach((s=>{if(s.id==i.settings.linkObject){let s;if(a.forEach((e=>{if(e.settings.isCustomFK&&""!=e.settings.indexField&&e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==i.settings.linkObject){s=e.id;let t=this.AB.definitionByID(e.settings.indexField);t&&(s=`${e.id}:${t.columnName}`)}else e.settings.linkObject&&"one"==e.settings.linkType&&e.settings.linkObject==i.settings.linkObject&&(s=`${e.id}:uuid`)})),s){const i=e.parent.viewComponents[t.id].ui(),o=i.rows[0]??i;n.push({id:`${o.name}:${s}`,value:o.label})}}}))}})),this.addPageProperty.setSettings(e,{formView:e.settings.formView}),this.editPageProperty.setSettings(e,{editForm:e.settings.editForm}),$$(t.filterConnectedValue).define("options",n),$$(t.filterConnectedValue).setValue(e.settings.filterConnectedValue),$$(t.popupWidth).setValue(e.settings.popupWidth||i.popupWidth),$$(t.popupHeight).setValue(e.settings.popupHeight||i.popupHeight),this.populatePopupEditors(e),this.populateBadgeNumber(t,e)}_filterCondition(e){return e?.options?.filters?.rules?.length?e.options.filters:e?.settings?.filterConditions?.rules?.length?e.settings.filterConditions:null}populatePopupEditors(e){const t=this._filterCondition(e)??this.defaultValues().filterConditions;let i;const n=e.field();n&&(i=n.datasourceLink,i&&d.fieldsLoad(i.fields(),i)),d.setValue(t),i&&u.objectLoad(i),u.setSettings(e.settings.sortFields)}populateBadgeNumber(e,t){const i=$$(e.buttonFilter),n=this._filterCondition(t);n?.rules?(i.define("badge",n.rules.length||null),i.refresh()):(i.define("badge",null),i.refresh());const s=$$(e.buttonSort);t?.settings?.sortFields?.length?(s.define("badge",t.settings.sortFields.length||null),s.refresh()):(s.define("badge",null),s.refresh())}populateFilterByConnectedFieldValue(e){const t=this.AB.definitionByID(e.settings.fieldId);if("one"==t.settings.linkType&&"many"==t.settings.linkViaType||"one"==t.settings.linkType&&"one"==t.settings.linkViaType&&t.settings.isSource){const i=this.AB.objectByID(t.settings.linkObject);if(!i)return;let n=i.fields((e=>"connectObject"==e.key));if(!n||!n.length)return;n.forEach((t=>{let i=e.parent.views((i=>{let n=this.AB.definitionByID(i.settings.fieldId);return"connect"==i.key&&i.id!=e.id&&t.settings.linkObject==n.settings.linkObject})).map((t=>{const i=e.parent.viewComponents[t.id].ui(),n=i.rows[0]??i;return{id:n.name,value:n.label}}));i&&i.length&&d.addCustomOption(t.id,{conditions:[{id:"filterByConnectValue",value:h("Filter by Connected Field Value:"),batch:"FilterByConnectedFieldValue",handler:()=>!0}],values:[{batch:"FilterByConnectedFieldValue",view:"combo",options:i}]})}))}}values(){const e=this.ids,t=this.CurrentView,i=$$(e.component),n=super.values()??{};n.settings=i.getValues()??{},n.settings.popupWidth=$$(e.popupWidth).getValue(),n.settings.popupHeight=$$(e.popupHeight).getValue(),n.settings.filterConnectedValue=$$(e.filterConnectedValue).getValue(),n.settings.filterConditions=d.getValue(),n.settings.sortFields=u.getSettings();const s=this.addPageProperty.getSettings(t)??{},o=this.editPageProperty.getSettings(t)??{};return n.settings.formView=s.formView,n.settings.editForm=o.editForm,n}ViewClass(){return super._ViewClass("connect")}get addPageProperty(){return this._addPage||(this._addPage=new l),this._addPage}get editPageProperty(){return this._editPage||(this._editPage=new c),this._editPage}showFilterPopup(e){d.popUp(e,null,{pos:"top"})}showSortPopup(e){u.show(e,null,{pos:"top"})}}}},1722:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_custom",{}),this.AB=e}static get key(){return"fieldcustom"}}}},6929:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_datepicker",{}),this.AB=e}static get key(){return"datepicker"}}}},4412:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L(),s={required:0,disable:0};return class extends t{constructor(t,i={}){super(t,Object.assign(i,{field:"",required:"",disable:""})),this.AB=e}ui(e=[],t={}){const n=this.ids,s=this.AB.UISettings.config(),o=[{id:n.field,name:"fieldLabel",view:"text",disabled:!0,label:i("Field")},{id:n.required,name:"required",view:"checkbox",labelWidth:s.labelWidthCheckbox,labelRight:i("Required"),click:()=>this.onChange()},{id:n.disable,name:"disable",view:"checkbox",labelWidth:s.labelWidthCheckbox,labelRight:i("Disable"),click:()=>this.onChange()}].concat(e);return super.ui(o,t)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues(),n=e.field();$$(t.field).setValue(n?n.label:""),1==n?.settings?.required?($$(t.required).setValue(n.settings.required),$$(t.required).disable()):$$(t.required).setValue(null!=e.settings?.required?e.settings.required:i.required),1==e.settings?.disable?$$(t.disable).setValue(e.settings.disable):$$(t.disable).setValue(i.disable)}defaultValues(){const e=this.ViewClass();let t={};return e&&(t=e.defaultValues()),Object.assign(s,t)}values(){const e=this.ids,t=super.values()??{};return t.settings=t.settings??{},t.settings.required=$$(e.required).getValue(),t.settings.disable=$$(e.disable).getValue(),t}}}},5670:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_json",{type:"",filterField:""}),this.AB=e}static get key(){return"json"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"radio",label:i("Type"),vertical:!0,options:[{id:"string",value:i("JSON String")},{id:"systemObject",value:i("System Object Chooser UI")},{id:"filter",value:i("Filter UI")}],on:{onChange:t=>{"filter"==t?$$(e.filterField).show():$$(e.filterField).hide(),this.onChange()}}},{id:e.filterField,name:"filterField",view:"combo",hidden:!0,label:i("Object Field to Filter"),labelPosition:"top",placeholder:i("Select a field to filter by"),on:{onChange:e=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();let n=[{id:"",value:""}];e.parent.views().forEach((t=>{if("json"==t.key&&"systemObject"==t.settings.type){let i=e.parent.viewComponents[t.id];n.push({id:t.settings.fieldId,value:i.settings.fieldLabel})}})),$$(t.filterField).define("options",n),e.settings.filterField&&$$(t.filterField).setValue(e.settings.filterField),$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("json")}}}},6378:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_number",{isStepper:""}),this.AB=e}static get key(){return"numberbox"}ui(){const e=this.ids,t=this.AB.UISettings.config();return super.ui([{id:e.isStepper,name:"isStepper",view:"checkbox",labelWidth:t.labelWidthCheckbox,labelRight:i("Plus/Minus Buttons"),on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.isStepper).setValue(null!=e.settings.isStepper?e.settings.isStepper:i.isStepper)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.isStepper=$$(e.isStepper).getValue(),i}ViewClass(){return super._ViewClass("numberbox")}}}},7754:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_select_multiple",{type:""}),this.AB=e}static get key(){return"selectmultiple"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"richselect",label:i("Type"),options:[{id:"multicombo",value:i("Multi Combo")},{id:"checkbox",value:i("Checkboxes")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("selectmultiple")}}}},9720:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_select_single",{type:""}),this.AB=e}static get key(){return"selectsingle"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"richselect",label:i("Type"),options:[{id:"richselect",value:i("Select list")},{id:"radio",value:i("Radio")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("selectsingle")}}}},2651:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_form_textbox",{type:""}),this.AB=e}static get key(){return"textbox"}ui(){const e=this.ids;return super.ui([{id:e.type,name:"type",view:"radio",label:i("Type"),vertical:!0,options:[{id:"single",value:i("Single line")},{id:"multiple",value:i("Multiple lines")},{id:"rich",value:i("Rich editor")}],on:{onChange:()=>this.onChange()}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type)}values(){const e=this.ids,t=$$(e.component),i=super.values()??{};return i.settings=t.getValues()??{},i.settings.type=$$(e.type).getValue(),i}ViewClass(){return super._ViewClass("textbox")}}}},9975:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(4412);function s(e){const t=(0,n.Z)(e);return class extends t{constructor(){super("properties_abview_form_tree",{}),this.AB=e}static get key(){return"formtree"}}}},5177:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(2418),s=i(4550),o=i(2439);function a(e){const t="properties_abview_gantt",i=(0,n.Z)(e),a=e.Config.uiSettings(),r=i.L(),l=(0,s.Z)(e,`${t}_workspaceView_gantt`);return class extends i{constructor(){super(t,{dataviewID:"",fields:""}),this.AB=e}static get key(){return"gantt"}ui(){const e=this.ids;return super.ui([{view:"fieldset",label:`${r("Gantt Data")}:`,labelWidth:a.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.dataviewID,view:"richselect",name:"dataviewID",label:`${r("Datacollection")}:`,labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!==t&&(l.emit("dc.changed",e,this.CurrentView),this.onChange())}}}]}},{view:"fieldset",label:`${r("Gantt Fields")}:`,labelWidth:a.labelWidthLarge,body:{id:e.fields,view:"form",name:"fields",borderless:!0,elements:[l.ui()],on:{onChange:()=>{this.onChange()}}}}])}async init(e){this.AB=e,this.PopupNewDataFieldComponent=(0,o.Z)(e,`${t}_popupNewDataField`),await this.PopupNewDataFieldComponent.init(e),this.PopupNewDataFieldComponent.on("save",((...e)=>{l.emit("field.added",e[0])})),l.on("dc.changed",((e,t)=>{const i=this.AB.datacollectionByID(e);l.init(i.datasource,t),this.PopupNewDataFieldComponent.objectLoad(i.datasource)})),l.on("new.field",(e=>{this.PopupNewDataFieldComponent.show(null,e,!1)})),await super.init(e)}populateDataview(){const e=this.AB.Account.isSystemDesigner()?e=>!e.isSystemObject:()=>!0,t=this.CurrentApplication.datacollectionsIncluded(e),i=$$(this.ids.dataviewID);i.define("options",t.map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})))),i.refresh()}populate(e){super.populate(e);const t=this.ids,i=$$(t.component),n=this.defaultValues(),s=Object.assign(i.getValues(),n,e.settings);this.populateDataview(),i.setValues(s);let o=this.AB.datacollectionByID(s.dataviewID);o&&(l.init(o.datasource,this.CurrentView),this.PopupNewDataFieldComponent.objectLoad(o.datasource))}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=super.values(),t=this.ids;return e.settings=Object.assign($$(t.component).getValues(),$$(t.fields).getValues()),e}ViewClass(){return super._ViewClass("gantt")}}}},4973:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var n=i(2418),s=i(3285),o=i(5997),a=i(6038),r=i(4245),l=i(8782);function c(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),c=t.L(),h="properties_abview_grid",d=new((0,r.Z)(e,h))({isGrid:!0}),u=new l.Z(e,h);return class extends t{constructor(){super(h,{isEditable:"",massUpdate:"",allowDelete:"",isSortable:"",isExportable:"",datacollection:"",groupBy:"",groupByList:"",buttonFieldsVisible:"",buttonFieldsFreeze:"",buttonSummaryFields:"",buttonCountFields:"",height:"",hideHeader:"",labelAsField:"",hideButtons:""}),this._preFilterSettings=null,this.linkPageComponent=new u,this.linkPageComponent.on("changed",(()=>{this.onChange()})),this.PopupCountColumnsComponent=function(e,t){t=t||"ui_work_object_workspace_popupCountColumns";const i=(0,s.Z)(e);var n=i.L();return new class extends i{constructor(e){super(e,{list:""}),this.CountFieldIds=[]}ui(){const e=this.ids;return{id:e.component,view:"popup",body:{rows:[{cols:[{view:"button",css:"webix_primary",value:n("Select All"),on:{onItemClick:()=>{this.clickShowAll()}}},{view:"button",value:n("Unselect All"),on:{onItemClick:()=>{this.clickHideAll()}}}]},{id:e.list,view:"list",maxHeight:250,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa ab-count-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)}}}]},on:{onShow:()=>{this.onShow()}}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}onChange(){this.emit("changed",this.CountFieldIds)}clickHideAll(){var e=$$(this.ids.list);this.CountFieldIds=[],e.find({}).forEach((e=>{this.iconHide(e.id)})),this.onChange()}clickShowAll(){var e=$$(this.ids.list);this.CountFieldIds=e.find({}).map((e=>e.id)),e.find({}).forEach((e=>{this.iconShow(e.id)})),this.onChange()}clickListItem(e){this.CountFieldIds.indexOf(e)<0?(this.CountFieldIds.push(e),this.iconShow(e)):(this.CountFieldIds=this.CountFieldIds.filter((t=>t!=e)),this.iconHide(e)),this.onChange()}getValue(){return this.CountFieldIds}iconHide(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-count-field-icon").classList.remove("fa-circle")}iconShow(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-count-field-icon").classList.add("fa-circle")}setValue(e){this.CountFieldIds=e||[],this.onShow()}onShow(){var e=this.CurrentObject.fields().map((e=>({id:e.id,label:e.label})));$$(this.ids.list).clearAll(),$$(this.ids.list).parse(e),this.CountFieldIds.forEach((e=>{this.iconShow(e)}))}show(...e){$$(this.ids.component).show(...e)}}(t)}(e,`${h}_count`),this.PopupCountColumnsComponent.on("changed",(e=>{this.badgesCount(e),this.onChange()})),this.PopupFrozenColumnsComponent=new o.Z(e,`${h}_frozenFields`),this.PopupFrozenColumnsComponent.on("changed",(e=>{this.badgesFrozen(e),this.PopupHideFieldComponent.setFrozenColumnID(e),this.onChange()})),this.PopupHideFieldComponent=(0,a.Z)(e,`${h}_hideFields`),this.PopupHideFieldComponent.on("changed",((e=[])=>{this.badgesHidden(e),this.PopupFrozenColumnsComponent.setHiddenFields(e),this.onChange()})),this.PopupSummaryColumnsComponent=function(e,t){t=t||"ui_work_object_workspace_popupSummaryColumns";const i=(0,s.Z)(e);var n=i.L();return new class extends i{constructor(t){super(t,{list:""}),this.ABFieldNumber=e.Class.ABFieldManager.fieldByKey("number"),this.ABFieldFormula=e.Class.ABFieldManager.fieldByKey("formula"),this.ABFieldCalculate=e.Class.ABFieldManager.fieldByKey("calculate"),this.SummaryFieldIds=[]}ui(){const e=this.ids;return{view:"popup",id:e.component,body:{rows:[{cols:[{view:"button",value:n("Select All"),on:{onItemClick:()=>{this.clickHideAll()}}},{view:"button",css:"webix_primary",value:n("Unselect All"),on:{onItemClick:()=>{this.clickShowAll()}}}]},{view:"list",id:e.list,maxHeight:250,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa ab-summary-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)}}}]},on:{onShow:()=>{this.onShow()}}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}clickHideAll(){var e=$$(this.ids.list);this.SummaryFieldIds=[],e.find({}).forEach((e=>{this.iconHide(e.id)})),this.emit("changed",this.SummaryFieldIds)}clickShowAll(){var e=$$(this.ids.list);this.SummaryFieldIds=e.find({}).map((e=>e.id)),e.find({}).forEach((e=>{this.iconShow(e.id)})),this.emit("changed",this.SummaryFieldIds)}clickListItem(e){this.SummaryFieldIds.indexOf(e)<0?(this.SummaryFieldIds.push(e),this.iconShow(e)):(this.SummaryFieldIds=this.SummaryFieldIds.filter((t=>t!=e)),this.iconHide(e)),this.emit("changed",this.SummaryFieldIds)}getValue(){return this.SummaryFieldIds}iconHide(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-summary-field-icon").classList.remove("fa-circle")}iconShow(e){var t=$$(this.ids.list).getItemNode(e);t&&t.querySelector(".ab-summary-field-icon").classList.add("fa-circle")}setValue(e){this.SummaryFieldIds=e||[],this.onShow()}onShow(){const e=this.ids;var t=this.CurrentObject.fields((e=>e instanceof this.ABFieldNumber)).map((e=>({id:e.id,label:e.label}))),i=this.CurrentObject.fields((e=>e instanceof this.ABFieldCalculate)).map((e=>({id:e.id,label:e.label}))),n=this.CurrentObject.fields((e=>e instanceof this.ABFieldFormula)).map((e=>({id:e.id,label:e.label}))),s=t.concat(i);s=s.concat(n),$$(e.list).clearAll(),$$(e.list).parse(s),this.SummaryFieldIds.forEach((e=>{this.iconShow(e)}))}show(...e){$$(this.ids.component).show(...e)}}(t)}(e,`${h}_summary`),this.PopupSummaryColumnsComponent.on("changed",(e=>{this.badgesSummary(e),this.onChange()}))}static get key(){return"grid"}ui(){let e=this.ids,t=this;return super.ui([{view:"fieldset",label:c("Grid Properties:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.isEditable,view:"checkbox",name:"isEditable",labelRight:c("User can edit in grid."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.massUpdate,view:"checkbox",name:"massUpdate",labelRight:c("User can edit multiple items at one time."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.allowDelete,view:"checkbox",name:"allowDelete",labelRight:c("User can delete records."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.isSortable,view:"checkbox",name:"isSortable",labelRight:c("User can sort records."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.isExportable,view:"checkbox",name:"isExportable",labelRight:c("User can export."),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}}]}},{view:"fieldset",label:c("Grid Data:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.datacollection,view:"richselect",name:"datacollection",label:c("Datacollection:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:(t,i)=>{if(t!=i){this.linkPageComponent.clear(),this.linkPageComponent.viewLoad(this.CurrentView,t);let i=this.CurrentView?.AB.datacollectionByID(t);i&&"query"==i.sourceType?($$(e.isEditable).setValue(!1),$$(e.massUpdate).setValue(!1),$$(e.allowDelete).setValue(!1),$$(e.isEditable).disable(),$$(e.massUpdate).disable(),$$(e.allowDelete).disable()):($$(e.isEditable).enable(),$$(e.massUpdate).enable(),$$(e.allowDelete).enable()),this.refreshGroupBy(i),this.onChange()}}}}]}},{view:"fieldset",label:c("Group:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.groupBy,view:"multiselect",name:"groupBy",label:c("Group by:"),labelWidth:i.labelWidthLarge,options:[],on:{onChange:e=>{this.refreshGroupByList(e),this.onChange()}}},{id:e.groupByList,view:"list",name:"groupByList",drag:!0,data:[],height:200,template:"<span class='fa fa-sort'></span>&nbsp;&nbsp; #value#",on:{onAfterDrop:()=>{this.onChange()}}}]}},this.linkPageComponent.ui(),{view:"fieldset",label:c("Customize Display:"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:c("Hidden Fields:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonFieldsVisible,view:"button",name:"buttonFieldsVisible",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupHideFieldComponent.show(this.$view)}}]},{cols:[{view:"label",label:c("Filter Option:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonFilterData,view:"button",name:"buttonFilterData",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:()=>{this.filter_property_popup.show()}}]},{cols:[{view:"label",label:c("Freeze Columns:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonFieldsFreeze,view:"button",name:"buttonFieldsFreeze",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupFrozenColumnsComponent.show(this.$view)}}]},{cols:[{view:"label",label:c("Summary Fields:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonSummaryFields,view:"button",name:"buttonSummaryFields",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupSummaryColumnsComponent.show(this.$view)}}]},{cols:[{view:"label",label:c("Count Fields:"),css:"ab-text-bold",width:i.labelWidthXLarge},{id:e.buttonCountFields,view:"button",name:"buttonCountFields",label:c("Settings"),icon:"fa fa-gear",type:"icon",click:function(){t.PopupCountColumnsComponent.show(this.$view)}}]},{id:e.height,view:"counter",name:"height",label:c("Height:"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:e.hideHeader,view:"checkbox",name:"hideHeader",labelRight:c("Hide table header"),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.labelAsField,view:"checkbox",name:"labelAsField",labelRight:c("Show a field using label template"),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}},{id:e.hideButtons,view:"checkbox",name:"hideButtons",labelRight:c("Hide edit and view buttons"),labelWidth:i.labelWidthCheckbox,click:()=>{this.onChange()}}]}},{}])}async init(e){super.init(e);var i=this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));$$(this.ids.datacollection).define("options",i),$$(this.ids.datacollection).refresh(),this._handler_onCancel=()=>{d.setSettings(this._preFilterSettings),this.filter_property_popup.hide()},this.filter_property_popup=webix.ui({view:"window",modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",hidden:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:c("Filter Menu")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:this._handler_onCancel,on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:d.ui()}),d.on("cancel",this._handler_onCancel),d.on("save",(()=>{this.filter_property_popup.hide(),this.onChange()}));let n=[];return n.push(d.init(e)),n.push(this.linkPageComponent.init(e)),n.push(this.PopupFrozenColumnsComponent.init(e)),n.push(this.PopupHideFieldComponent.init(e)),n.push(this.PopupSummaryColumnsComponent.init(e)),n.push(this.PopupCountColumnsComponent.init(e)),Promise.all(n)}badgesCount(e){let t=e.length;0==t&&(t=!1),$$(this.ids.buttonCountFields).config.badge=t,$$(this.ids.buttonCountFields).refresh()}badgesHidden(e){let t=e.length;0==t&&(t=!1),$$(this.ids.buttonFieldsVisible).config.badge=t,$$(this.ids.buttonFieldsVisible).refresh()}badgesFrozen(e){const t=this.CurrentView.settings.hiddenFields||[];let i=this.CurrentView.datacollection.datasource.fields((e=>-1==t.indexOf(e.columnName))).map((e=>e.columnName)).indexOf(e)+1;0==i&&(i=!1),$$(this.ids.buttonFieldsFreeze).config.badge=i,$$(this.ids.buttonFieldsFreeze).refresh()}badgesSummary(e){let t=e.length;0==t&&(t=!1),$$(this.ids.buttonSummaryFields).config.badge=t,$$(this.ids.buttonSummaryFields).refresh()}get datacollection(){return this.AB.datacollectionByID(this.CurrentView.settings?.dataviewID)}populate(e){super.populate(e);let t=this.ids;if(!e)return;let i=$$(t.datacollection);i.blockEvent(),i.setValue(e.settings.dataviewID),i.unblockEvent(),$$(t.isEditable).setValue(e.settings.isEditable),$$(t.massUpdate).setValue(e.settings.massUpdate),$$(t.allowDelete).setValue(e.settings.allowDelete),$$(t.isSortable).setValue(e.settings.isSortable),$$(t.isExportable).setValue(e.settings.isExportable),""!=e.settings.datacollection?$$(t.datacollection).setValue(e.settings.dataviewID):$$(t.datacollection).setValue(""),$$(t.height).setValue(e.settings.height),$$(t.hideHeader).setValue(e.settings.hideHeader),$$(t.labelAsField).setValue(e.settings.labelAsField),$$(t.hideButtons).setValue(e.settings.hideButtons),this.refreshGroupBy(),this.refreshGroupByList(e.settings.groupBy);let n=this.datacollection;n&&(d.objectLoad(n.datasource),d.setSettings(e.settings.gridFilter),this.PopupCountColumnsComponent.objectLoad(n.datasource),this.PopupCountColumnsComponent.setValue(e.settings.countColumns||""),this.PopupFrozenColumnsComponent.objectLoad(n.datasource),this.PopupFrozenColumnsComponent.setValue(e.settings.frozenColumnID||""),this.PopupFrozenColumnsComponent.setHiddenFields(e.settings.hiddenFields),this.PopupHideFieldComponent.objectLoad(n.datasource),this.PopupHideFieldComponent.setSettings(e.settings.hiddenFields),this.PopupHideFieldComponent.setFrozenColumnID(e.settings.frozenColumnID||""),this.PopupSummaryColumnsComponent.objectLoad(n.datasource),this.PopupSummaryColumnsComponent.setValue(e.settings.summaryColumns||[]),this.badgesCount(e.settings.countColumns),this.badgesHidden(e.settings.hiddenFields),this.badgesFrozen(e.settings.frozenColumnID),this.badgesSummary(e.settings.summaryColumns)),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}filterMenuShow(){this._preFilterSettings=d.getSettings(),this.filter_property_popup.show()}refreshGroupBy(e){const t=this.ids;let i=this.CurrentView,n=[];(e=e||this.datacollection)&&e.datasource&&e.datasource.fields((e=>!e.isConnection&&i.settings.hiddenFields.indexOf(e.columnName)<0)).forEach((e=>{n.push({id:e.columnName,value:e.label})})),$$(t.groupBy).define("options",n),$$(t.groupBy).refresh(),$$(t.groupBy).setValue(i.settings.groupBy)}refreshGroupByList(e){const t=this.ids;let i=e||[];"string"==typeof i&&(i=i.split(","));let n=$$(t.groupBy).getList().data.find({});$$(t.groupByList).clearAll(),i.forEach((e=>{let i=n.filter((t=>t.id==e))[0];i&&$$(t.groupByList).add(i)}))}values(){let e=this.ids,t=super.values();t.settings=t.settings||{},t.settings.dataviewID=$$(e.datacollection).getValue(),t.settings.isEditable=$$(e.isEditable).getValue(),t.settings.massUpdate=$$(e.massUpdate).getValue(),t.settings.allowDelete=$$(e.allowDelete).getValue(),t.settings.isSortable=$$(e.isSortable).getValue(),t.settings.isExportable=$$(e.isExportable).getValue(),t.settings.height=$$(e.height).getValue(),t.settings.hideHeader=$$(e.hideHeader).getValue(),t.settings.labelAsField=$$(e.labelAsField).getValue(),t.settings.hideButtons=$$(e.hideButtons).getValue();let i=$$(e.groupByList).serialize()||[];t.settings.groupBy=i.map((e=>e.id)).join(","),t.settings.gridFilter=d.getSettings(),t.settings.hiddenFields=this.PopupHideFieldComponent.getSettings(),t.settings.frozenColumnID=this.PopupFrozenColumnsComponent.getValue(),t.settings.summaryColumns=this.PopupSummaryColumnsComponent.getValue(),t.settings.countColumns=this.PopupCountColumnsComponent.getValue();let n=this.linkPageComponent.getSettings();for(let e in n)t.settings[e]=n[e];return t}ViewClass(){return super._ViewClass("grid")}}}},5281:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_image",{width:"",height:""})}static get key(){return"image"}ui(){const e=this.ids;return super.ui([{cols:[{view:"label",label:s("Image:"),css:"ab-text-bold",width:i.labelWidthXLarge},{view:"uploader",value:s("Upload image"),name:"file",apiOnly:!0,inputName:"image",multiple:!1,accept:"image/png, image/gif, image/jpeg, image/jpg, image/bmp",upload:"/image/upload/1",on:{onFileUpload:t=>{if(t&&t.data){if(this.filename=t.data.uuid,t.file){let i=new Image;i.onload=function(){$$(e.width).setValue(i.width),$$(e.height).setValue(i.height)},i.src=URL.createObjectURL(t.file)}this.onChange()}},onFileUploadError:(e,t)=>{}}}]},{id:e.width,view:"counter",name:"width",label:s("Width:"),labelWidth:i.labelWidthXLarge,on:{onChange:(e,t)=>{e!=t&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout((()=>{this._saveTimeout=null,this.onChange()}),1e3))}}},{id:e.height,view:"counter",name:"height",label:s("Height:"),labelWidth:i.labelWidthXLarge,on:{onChange:(e,t)=>{e!=t&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout((()=>{this._saveTimeout=null,this.onChange()}),1e3))}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e),this.filename=e.settings.filename;const t=this.ids;let i=$$(t.width);i.blockEvent(),i.setValue(e.settings.width),i.unblockEvent();let n=$$(t.height);n.blockEvent(),n.setValue(e.settings.height),n.unblockEvent()}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=super.values();return t.settings=t.settings||{},t.settings.filename=this.filename,t.settings.width=$$(e.width).getValue(),t.settings.height=$$(e.height).getValue(),t}ViewClass(){return super._ViewClass("label")}}}},5711:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var n=i(2418),s=i(5609),o=i(2439),a=i(8782);function r(e){const t="properties_abview_kanban",i=(0,n.Z)(e),r=(0,a.Z)(e,t),l=i.L(),c=e.UISettings.config(),h=(0,s.Z)(e,`${t}_prop`);var d=null;return class extends i{constructor(){super(t,{datacollection:""}),this.linkPageComponent=new r(e,t)}static get key(){return"kanban"}ui(){let e=h.ui(),t=[{view:"fieldset",label:l("Kanban Data:"),labelWidth:c.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.datacollection,view:"richselect",name:"dataviewID",label:l("Data Source:"),placeholder:l("Select a Datacollection"),labelWidth:c.labelWidthLarge,options:[],on:{onChange:(e,t)=>{e!=t&&(this.refreshFields(e),this.onChange())}}}]}},...e.rows,this.linkPageComponent.ui()];return super.ui(t)}async init(e){this.AB=e,h.on("new.field",(e=>{let t=this.AB.datacollectionByID(this.CurrentView.settings.dataviewID);d.objectLoad(t.datasource),d.resetState(),d.show(null,e,!1)})),h.on("changed",(()=>{this.onChange()})),d=(0,o.Z)(e,`${t}_popupNewDataField`),await d.init(e),d.on("save",((...e)=>{h.emit("field.added",e[0])})),this.linkPageComponent.init(),this.linkPageComponent.on("changed",(()=>{this.onChange()})),await super.init(e)}populate(e){super.populate(e);var t=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));let i=$$(this.ids.datacollection),n=e.settings.dataviewID||null;i.blockEvent(),i.define("options",t),i.define("value",n),i.unblockEvent(),i.refresh(),this.refreshFields(n),this.linkPageComponent.viewLoad(e),this.linkPageComponent.setSettings(e.settings)}refreshFields(e){let t=this.AB.datacollectionByID(e);if(!t)return void h.clearValues();let i=t.datasource;h.init(i,this.CurrentView),d.objectLoad(i)}values(){const e=super.values(),t=this.ids,i=$$(t.component);e.settings=i.getValues();const n=this.linkPageComponent.getSettings();for(const t in n)e.settings[t]=n[t];return e}ViewClass(){return super._ViewClass("kanban")}}}},4247:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_label",{text:"",format:"",alignment:""}),this.AB=e}static get key(){return"label"}ui(){const e=this.defaultValues(),t=this.ids;return super.ui([{id:t.text,view:"text",name:"text",label:i("Text"),placeholder:i("Text Placeholder"),on:{onChange:(e,t)=>{if(e!==t){const t=this.CurrentView;t.text=e,t.save(),this.onChange()}}}},{view:"fieldset",label:i("Format Options:"),body:{type:"clean",padding:10,rows:[{id:t.format,view:"radio",name:"format",vertical:!0,value:e.format,options:[{id:0,value:i("normal")},{id:1,value:i("title")},{id:2,value:i("description")}],on:{onChange:()=>{this.onChange()}}}]}},{view:"fieldset",label:i("Alignment:"),body:{type:"clean",padding:10,rows:[{id:t.alignment,view:"radio",name:"alignment",vertical:!0,value:e.alignment,options:[{id:"left",value:i("Left")},{id:"center",value:i("Center")},{id:"right",value:i("Right")}],on:{onChange:()=>{this.onChange()}}}]}},{}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids;$$(t.text).setValue(e.text),$$(t.format).setValue(e.settings.format),$$(t.alignment).setValue(e.settings.alignment)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i.text=i.settings.text,i}ViewClass(){return super._ViewClass("label")}}}},1163:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_layout",{}),this.AB=e}static get key(){return"layout"}ui(){return super.ui([{view:"button",css:"webix_primary",value:i("Add Column "),click:()=>this.addView()}])}defaultValues(){let e={};const t=this.ViewClass();return t&&(e=t.defaultValues()),e}ViewClass(){return super._ViewClass("layout")}async addView(){const e=this.CurrentView;e.addColumn();const t=[];e.views().forEach((e=>{t.push(e.save())})),await Promise.all(t),this.onChange()}}}},8450:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.UISettings.config();return class extends t{constructor(){super("properties_abview_list",{datacollection:"",field:"",height:""})}static get key(){return"list"}ui(){const e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.propertyUpdateFieldOptions(e),this.onChange())}}},{id:e.field,name:"field",view:"richselect",label:i("Field"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.height,view:"counter",name:"height",label:i("Height:"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}propertyUpdateFieldOptions(e){var t=this.AB.datacollectionByID(e),i=t?t.datasource:null,n=[];null!=i&&(n=i.fields().map((e=>({id:e.id,value:e.label}))));const s=this.ids;$$(s.field).define("options",n),$$(s.field).refresh()}populate(e){super.populate(e);const t=this.ids;var i=e.settings.dataviewID?e.settings.dataviewID:null,n=$$(t.datacollection),s=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));n.define("options",s),n.define("value",i),n.refresh(),this.propertyUpdateFieldOptions(i),$$(t.field).setValue(e.settings.field),$$(t.height).setValue(e.settings.height)}defaultValues(){const e=this.ViewClass();let t=null;return e&&(t=e.defaultValues()),t}values(){const e=this.ids,t=$$(e.component),i=super.values();return i.settings=t.getValues(),i}ViewClass(){return super._ViewClass("list")}}}},6598:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();let o={};return class extends t{constructor(){super("properties_abview_menu",{orientation:"",buttonStyle:"",menuAlignment:"",menuInToolbar:0,menuPadding:"",menuTheme:"",menuPosition:"",menuTextLeft:"",menuTextCenter:"",menuTextRight:"",pages:"",treeDnD:"",pagesFieldset:"",pageOrderFieldset:""}),this.AB=e,o=this.AB.Class.ABViewManager.viewClass("menu").defaultValues()}static get key(){return"menu"}ui(){const e=this.ids;return super.ui([{id:e.orientation,name:"orientation",view:"richselect",label:s("Orientation"),value:o.orientation,labelWidth:i.labelWidthXLarge,options:[{id:"x",value:s("Horizontal")},{id:"y",value:s("Vertical")}],on:{onChange:()=>{this.onChange()}}},{id:e.buttonStyle,name:"buttonStyle",view:"richselect",label:s("Button Style"),value:o.buttonStyle,labelWidth:i.labelWidthXLarge,options:[{id:"ab-menu-default",value:s("Default")},{id:"ab-menu-link",value:s("Link")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuAlignment,name:"menuAlignment",view:"richselect",label:s("Menu Alignment"),value:o.menuAlignment,labelWidth:i.labelWidthXLarge,options:[{id:"ab-menu-left",value:s("Left")},{id:"ab-menu-center",value:s("Center")},{id:"ab-menu-right",value:s("Right")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuInToolbar,name:"menuInToolbar",view:"checkbox",labelRight:s("Put menu in toolbar"),value:o.menuInToolbar,labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{name:"toolbarFieldset",view:"fieldset",label:s("Toolbar Settings:"),labelWidth:i.labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{id:e.menuPadding,name:"menuPadding",view:"counter",label:s("Toolbar padding"),value:o.menuPadding,labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.menuTheme,name:"menuTheme",view:"richselect",label:s("Toolbar theme"),value:o.menuTheme,labelWidth:i.labelWidthLarge,options:[{id:"white",value:s("White")},{id:"bg_gray",value:s("Gray")},{id:"webix_dark",value:s("Dark")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuPosition,name:"menuPosition",view:"richselect",label:s("Menu Position"),value:o.menuPosition,labelWidth:i.labelWidthLarge,options:[{id:"left",value:s("Left")},{id:"center",value:s("Center")},{id:"right",value:s("Right")}],on:{onChange:()=>{this.onChange()}}},{id:e.menuTextLeft,name:"menuTextLeft",view:"text",label:s("Text Left"),placeholder:s("Place text in left region of toolbar."),labelWidth:i.labelWidthLarge,labelPosition:"top",on:{onChange:()=>{this.onChange()}}},{id:e.menuTextCenter,name:"menuTextCenter",view:"text",label:s("Text Center"),placeholder:s("Place text in center region of toolbar."),labelWidth:i.labelWidthLarge,labelPosition:"top",on:{onChange:()=>{this.onChange()}}},{id:e.menuTextRight,name:"menuTextRight",view:"text",label:s("Text Right"),placeholder:s("Place text in right region of toolbar."),labelWidth:i.labelWidthLarge,labelPosition:"top",on:{onChange:()=>{this.onChange()}}}]}},{id:e.pagesFieldset,name:"pagesFieldset",view:"fieldset",label:s("Page List:"),labelWidth:i.labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{id:e.pages,name:"pages",view:"edittree",borderless:!0,css:"transparent",editable:!0,editValue:"aliasname",editor:"text",template:function(e,t){return`<div class='ab-page-list-item'>\n                              ${t.icon(e)} ${t.checkbox(e,!1)} <div class="fa fa-${"viewcontainer"==e.key?"window-maximize":"file"}"></div> \n                              ${e.label}</div>`},on:{onItemCheck:(e,t)=>{this.onChange(),this.updateTreeDnD(e,t)},onBeforeEditStart:function(e){const t=this.getItem(e);t.aliasname||(t.aliasname=t.label,this.updateItem(t))},onBeforeEditStop:(t,i)=>{const n=$$(e.pages),s=$$(e.treeDnD);let o=n.getItem(i.id);if(o&&(o.translations.forEach((e=>{e.language_code==this.AB.Multilingual.currentLanguage()&&(e.aliasname=t.value)})),o.label=t.value,n.updateItem(i.id,o)),s.exists(i.id)){let e=s.getItem(i.id)||{};e.value=t.value,e.aliasname=t.value,this.onChange(),s.updateItem(i.id,e)}}}}]}},{id:e.pageOrderFieldset,name:"pageOrderFieldset",view:"fieldset",label:s("Drag & Drop to Reorder/Click to Add Icon:"),labelWidth:i.labelWidthLarge,body:{view:"layout",type:"clean",padding:10,rows:[{id:e.treeDnD,view:"edittree",borderless:!0,name:"treeDnD",template:"{common.icon()} <i class='fa fa-fw fa-#icon#'></i> <span>#value#</span>",drag:!0,editable:!0,editValue:"icon",editor:"combo",options:this.AB._App.icons,suggest:{template:"#value#",filter:function(e,t){return 0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())},body:{template:"<i class='fa fa-fw fa-#value#'></i> #value#"}},on:{onBeforeDrop:function(e){e.parent=e.target,e.index=-1},onAfterDrop:(e,t)=>{this.reorderPages()},onDataUpdate:()=>{this.reorderPages()}}}]}}])}populate(e){if(super.populate(e),!e)return;const t=this.ids;$$(t.orientation).setValue(e.settings.orientation??o.orientation),$$(t.buttonStyle).setValue(e.settings.buttonStyle??o.buttonStyle),$$(t.menuAlignment).setValue(e.settings.menuAlignment??o.menuAlignment),$$(t.menuInToolbar).setValue(parseInt(e.settings.menuInToolbar)??o.menuInToolbar),$$(t.menuPadding).setValue(e.settings.menuPadding??o.menuPadding),$$(t.menuTheme).setValue(e.settings.menuTheme??o.menuTheme),$$(t.menuPosition).setValue(e.settings.menuPosition??o.menuPosition),e.menuTextLeft=e.menuTextLeft||e.settings.menuTextLeft,$$(t.menuTextLeft).setValue(e.menuTextLeft??o.menuTextLeft),e.menuTextCenter=e.menuTextCenter||e.settings.menuTextCenter,$$(t.menuTextCenter).setValue(e.menuTextCenter??o.menuTextCenter),e.menuTextRight=e.menuTextRight||e.settings.menuTextRight,$$(t.menuTextRight).setValue(e.menuTextRight??o.menuTextRight);const i=new this.AB.Webix.TreeCollection,n=e.application,s=e.pageRoot();n.pages((e=>s?.id==e.id),!0).forEach(((t,n)=>{this.addPage(e,t,n,i)}));const a=$$(t.pages);a.clearAll(),a.data.importData(i),a.refresh(),a.blockEvent(),a.uncheckAll(),a.unblockEvent(),a.openAll();const r=$$(t.treeDnD);r.clearAll(),e?.settings?.order?.forEach((t=>{a.exists(t.tabId??t.pageId)&&(a.blockEvent(),a.checkItem(t.tabId??t.pageId),a.unblockEvent());const i=e.getAliasname(t);r.add({id:t.tabId??t.pageId,value:i,type:t.type,pageId:t.pageId??"",tabId:t.tabId??"",icon:t.icon},t.position?parseInt(t.position):0,t.parent&&"0"!=t.parent?t.parent:"")})),r.openAll(),$$(t.pagesFieldset).config.height=28*a.count()+18+40,$$(t.pagesFieldset).resize(),$$(t.pageOrderFieldset).config.height=28*a.count()+18+40,$$(t.pageOrderFieldset).resize()}values(){const e=this.ids;let t=super.values();if(t.settings=t.settings??{},t.settings.orientation=$$(e.orientation).getValue(),t.settings.buttonStyle=$$(e.buttonStyle).getValue(),t.settings.menuAlignment=$$(e.menuAlignment).getValue(),t.settings.menuInToolbar=$$(e.menuInToolbar).getValue(),t.settings.menuPadding=$$(e.menuPadding).getValue(),t.settings.menuTheme=$$(e.menuTheme).getValue(),t.settings.menuPosition=$$(e.menuPosition).getValue(),t.menuTextLeft=$$(e.menuTextLeft).getValue(),t.menuTextCenter=$$(e.menuTextCenter).getValue(),t.menuTextRight=$$(e.menuTextRight).getValue(),t.menuTextLeft.length&&(t.settings.menuTextLeft=""),t.menuTextCenter.length&&(t.settings.menuTextCenter=""),t.menuTextCenter.length&&(t.settings.menuTextRight=""),$$(e.pages)){for(let t=0;t<$$(e.pages).data.count();t++){let i=$$(e.pages).getIdByIndex(t);const n=$$(e.pages).getItem(i);let s,o="page";"viewcontainer"==n.key?(o="tab",s=i,i=n.pageParent().id):s="";let a=[];n&&n.translations&&(a=n.translations)}t.settings.pages&&delete t.settings.pages}return t}ViewClass(){return super._ViewClass("menu")}updateTreeDnD(e,t){const i=this.ids,n=this.CurrentView,o=$$(i.treeDnD),a=$$(i.pages);let r=n.application.pages((t=>t.id==e),!0)[0];if(r||(r=n.application.views((t=>t.id==e),!0)[0]),t){let e=n.getAliasname(r);o.add({id:r.id,value:e,type:r.type,pageId:r.pageId??"",tabId:r.tabId??""}),this.reorderPages()}else o.exists(e)&&!o.isBranch(e)?(o.remove(e),this.reorderPages()):o.exists(e)&&o.isBranch(e)&&(a.blockEvent(),a.checkItem(e),this.AB.Webix.message({text:s("Item comtains submenu, please remove items in submenu before removing."),type:"error",expire:1e4}),a.unblockEvent())}reorderPages(){const e=this.ids,t=this.CurrentView,i=$$(e.treeDnD);let n=[];i.data.each((e=>{let i=t.application.pages((t=>t.id==e.id),!0)[0];i||(i=t.application.views((t=>t.id==e.id),!0)[0]),n.push(i)}));let s=[];n.forEach((i=>{if(i){const n={},o=i.id,a=$$(e.treeDnD).getItem(o);n.parent=a.$parent,n.position=$$(e.treeDnD).getBranchIndex(o),n.icon=a.icon,n.type="viewcontainer"==i.key?"tab":"page","tab"==n.type?(n.tabId=i.id,n.pageId=t.getParentPageId(i)):n.pageId=i.id,n.isChecked="true",n.translations=i.translations,s.push(n)}})),t.settings.order=s,this.onChange(),i.openAll()}addPage(e,t,i,n,s){e?.settings?.order?.forEach((e=>{(e.pageId==t.id&&!e.id||s&&e.pageId==s&&e.tabId==t.id)&&(t.translations=e.translations)}));const o=e.getAliasname(t);t.label=o||t.label,n.add(t,i,s);const a=t.pages?t.pages():[];a.forEach(((i,s)=>{this.addPage(e,i,s,n,t.id)}));const r=this.AB.Class.ABViewManager.viewClass("tab");t.views((e=>e instanceof r)).forEach(((i,s)=>{i.views().forEach(((i,o)=>{const r=a.length+s+o;this.addPage(e,i,r,n,t.id)}))}))}}}},3348:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(2418),s=i(708);function o(e){const t="properties_abview_pdfImporter",i=(0,n.Z)(e),o=i.L(),a=e.UISettings.config(),r=(0,s.Z)(e,`${t}_popupSubmitRule`);return class extends i{constructor(){super(t,{datacollection:"",field:"",buttonSubmitRules:""}),this.AB=e}static get key(){return"pdfImporter"}ui(){const e=this.ids;return super.ui([{view:"fieldset",label:o("Data:"),labelWidth:a.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.datacollection,name:"dataviewID",view:"richselect",label:o("Data Source"),labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&(this.onChange(),this.populateFieldOptions())}}},{id:e.field,name:"fieldID",view:"richselect",label:o("Field"),labelWidth:a.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&this.onChange()}}},{view:"fieldset",label:o("Rules:"),labelWidth:a.labelWidthLarge,body:{type:"clean",padding:10,rows:[{cols:[{view:"label",label:o("Submit Rules:"),width:a.labelWidthLarge},{id:e.buttonSubmitRules,view:"button",css:"webix_primary",name:"buttonSubmitRules",label:o("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:()=>{this.submitRuleShow()}}]}]}}]}}])}async init(e){this.AB=e,await super.init(e),r.init(e),r.on("save",(()=>{this.onChange(),this.populateBadgeNumber()}))}populate(e){super.populate(e);const t=this.ids,i=$$(t.datacollection),n=e.settings.dataviewID,s=e.application.datacollectionsIncluded().filter((e=>"object"==e.sourceType&&!e?.datasource?.isReadOnly)).map((e=>({id:e.id,value:e.label,icon:"fa fa-database"})));i.define("options",s),i.define("value",n),i.refresh(),this.populateFieldOptions(e),r.objectLoad(this.CurrentObject),r.viewLoad(e),r.fromSettings(e.settings.submitRules??[])}populateFieldOptions(e){e=e??this.CurrentView;const t=$$(this.ids.datacollection),i=$$(this.ids.field),n=e.settings.fieldID,s=this.AB.datacollections((e=>e.id==t.getValue()))[0]?.datasource?.fields((e=>"image"==e.key))?.map((e=>({id:e.id,value:e.label,icon:"fa fa-file-image-o"})))??[];i.define("options",s),i.define("value",n),i.refresh()}populateBadgeNumber(){const e=this.ids,t=this.CurrentView;t&&($$(e.buttonSubmitRules).define("badge",t?.settings?.submitRules?.length||null),$$(e.buttonSubmitRules).refresh())}values(){const e=$$(this.ids.component),t=super.values();return t.settings=e.getValues(),t.settings.submitRules=r.toSettings(),t}submitRuleShow(){r.fromSettings(this.CurrentView.settings.submitRules),r.show()}ViewClass(){return super._ViewClass("pdfImporter")}}}},9630:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(3156);function s(e){const t=(0,n.default)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_page",{type:"",popupSettings:"",popupWidth:"",popupHeight:"",pageSettings:"",fixedPageWidth:"",pageWidth:"",pageBackground:""})}static get key(){return"page"}ui(){let e=this.ids,t=this;return super.ui([{id:e.type,name:"type",view:"richselect",label:s("Type"),options:[{id:"page",value:s("Page")},{id:"popup",value:s("Popup")}],on:{onChange:t=>{"page"==t?($$(e.popupSettings).hide(),$$(e.pageSettings).show()):($$(e.popupSettings).show(),$$(e.pageSettings).hide()),this.onChange()}}},{id:e.popupSettings,view:"fieldset",name:"popupSettings",label:s("Popup Settings"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.popupWidth,view:"text",name:"popupWidth",placeholder:s("Set popup width"),label:s("Width:"),labelWidth:i.labelWidthLarge,validate:webix.rules.isNumber,on:{onChange:()=>{this.onChange()}}},{id:e.popupHeight,view:"text",name:"popupHeight",placeholder:s("Set popup height"),label:s("Height:"),labelWidth:i.labelWidthLarge,validate:webix.rules.isNumber,on:{onChange:()=>{this.onChange()}}}]}},{id:e.pageSettings,view:"fieldset",name:"pageSettings",label:s("Page Settings"),labelWidth:i.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.fixedPageWidth,view:"checkbox",name:"fixedPageWidth",labelRight:s("Page has fixed width"),labelWidth:i.labelWidthCheckbox,click:function(){1==this.getValue()?$$(e.pageWidth).show():$$(e.pageWidth).hide(),t.onChange()}},{id:e.pageWidth,view:"text",name:"pageWidth",placeholder:s("Set page width"),label:s("Page width:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.pageBackground,view:"richselect",name:"pageBackground",label:s("Page background:"),labelWidth:i.labelWidthXLarge,options:[{id:"ab-background-default",value:s("White (default)")},{id:"ab-background-gray",value:s("Dark")}],on:{onChange:()=>{this.onChange()}}}]}}])}populate(e){super.populate(e);let t=this.ids,i=this.defaultValues();$$(t.type).setValue(e.settings.type||i.type),$$(t.popupWidth).setValue(e.settings.popupWidth||i.popupWidth),$$(t.popupHeight).setValue(e.settings.popupHeight||i.popupHeight),$$(t.pageWidth).setValue(e.settings.pageWidth||i.pageWidth),$$(t.fixedPageWidth).setValue(e.settings.fixedPageWidth||i.fixedPageWidth),$$(t.pageBackground).setValue(e.settings.pageBackground||i.pageBackground),e.isRoot()?$$(t.type).hide():$$(t.type).show(),"popup"==e.settings.type?($$(t.popupSettings).show(),$$(t.pageSettings).hide()):($$(t.popupSettings).hide(),$$(t.pageSettings).show()),1==e.settings.fixedPageWidth?$$(t.pageWidth).show():$$(t.pageWidth).hide()}defaultValues(){let e={};var t=this.ViewClass();return t&&(e=t.defaultValues()),e}values(){let e=this.ids,t=super.values();return t.settings=t.settings||{},t.settings.type=$$(e.type).getValue(),t.settings.popupWidth=$$(e.popupWidth).getValue(),t.settings.popupHeight=$$(e.popupHeight).getValue(),t.settings.pageWidth=$$(e.pageWidth).getValue(),t.settings.fixedPageWidth=$$(e.fixedPageWidth).getValue(),t.settings.pageBackground=$$(e.pageBackground).getValue(),t}ViewClass(){return super._ViewClass("page")}}}},1832:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.UISettings.config();return class extends t{constructor(){super("properties_abview_pivot",{datacollection:"",height:"",removeMissed:"",totalColumn:"",separateLabel:"",min:"",max:"",decimalPlaces:""}),this.AB=e}static get key(){return"pivot"}ui(){const e=this.ids;return super.ui([{id:e.datacollection,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!=t&&this.onChange()}}},{id:e.height,view:"counter",name:"height",label:i("Height:"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.removeMissed,view:"checkbox",name:"removeMissed",labelRight:i("Remove empty data."),labelWidth:s.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.totalColumn,view:"checkbox",name:"totalColumn",labelRight:i("Show a total column."),labelWidth:s.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.separateLabel,view:"checkbox",name:"separateLabel",labelRight:i("Separate header label."),labelWidth:s.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.min,view:"checkbox",name:"min",labelRight:i("Highlighting of a cell(s) with the least value in a row."),labelWidth:s.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.max,view:"checkbox",name:"max",labelRight:i("Highlighting of a cell(s) with the biggest value in a row."),labelWidth:s.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.decimalPlaces,name:"decimalPlaces",view:"counter",min:1,label:i("Decimal Places"),labelWidth:s.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e)}populate(e){super.populate(e);const t=this.ids,i=e.settings.dataviewID?e.settings.dataviewID:null;var n=$$(t.datacollection),s=e.application.datacollectionsIncluded().map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})));n.define("options",s),n.define("value",i),n.refresh(),$$(t.removeMissed).setValue(e.settings.removeMissed),$$(t.totalColumn).setValue(e.settings.totalColumn),$$(t.separateLabel).setValue(e.settings.separateLabel),$$(t.min).setValue(e.settings.min),$$(t.max).setValue(e.settings.max),$$(t.height).setValue(e.settings.height),$$(t.decimalPlaces).setValue(null==e.settings.decimalPlaces?2:e.settings.decimalPlaces)}values(){const e=$$(this.ids.component),t=super.values();return t.settings=e.getValues(),t}ViewClass(){return super._ViewClass("pivot")}}}},7375:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L();return class extends t{constructor(){super("properties_abview_pivot",{dataviewID:"",dataviewFieldsLabel:"",dataviewFields:"",fieldName:"",fieldText:"",fieldQueries:"",datacollectionIDs:"",editMode:"",hideCommonTab:"",hideDataTab:"",hideViewTab:""})}static get key(){return"reportsManager"}ui(){const t=this.ids,n=e.UISettings.config();return super.ui([{id:t.dataviewID,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:n.labelWidthLarge,on:{onChange:(e,t)=>{e!==t&&(this.getDataviewFieldOptions(e),this.onChange())}}},{id:t.dataviewFieldsLabel,view:"label",label:i("Dataview Fields"),hidden:!0},{id:t.dataviewFields,view:"form",hidden:!0,elements:[{id:t.fieldName,view:"richselect",name:"name",label:i("Name"),placeholder:i("Single line text"),labelWidth:n.labelWidthLarge},{id:t.fieldText,view:"richselect",name:"text",label:i("Text"),placeholder:i("JSON"),labelWidth:n.labelWidthLarge},{id:t.fieldQueries,view:"richselect",name:"queries",label:i("Queries"),placeholder:i("JSON"),labelWidth:n.labelWidthLarge}],on:{onChange:(e,t)=>{e!==t&&this.onChange()}}},{view:"label",label:i("Include Datacollections")},{id:t.datacollectionIDs,view:"multicombo",value:[],options:[],placeholder:i("Click to add Datacollections (Include all if nothing selected)"),labelAlign:"left",stringResult:!1,on:{onChange:()=>{this.onChange()}}},{id:t.editMode,name:"editMode",view:"checkbox",label:i("Edit mode"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.hideCommonTab,name:"hideCommonTab",view:"checkbox",label:i("Hide Common tab"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.hideDataTab,name:"hideDataTab",view:"checkbox",label:i("Hide Data tab"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:t.hideViewTab,name:"hideViewTab",view:"checkbox",label:i("Hide View tab"),labelWidth:n.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e);const t=this.ids,i=this.CurrentApplication.datacollectionsIncluded(),n=$$(t.dataviewID);n.define("options",i.map((e=>({id:e.id,value:e.label})))),n.refresh();const s=$$(t.datacollectionIDs);s.define("options",i.map((e=>({id:e.id,value:e.label})))),s.refresh()}getDataviewFieldOptions(e){const t=this.ids,i=$$(t.dataviewFieldsLabel),n=$$(t.dataviewFields),s=$$(t.fieldName),o=$$(t.fieldText),a=$$(t.fieldQueries),r=this.defaultValues();if(!e)return s.define("options",[]),s.refresh(),i.hide(),n.hide(),void n.setValues(r.dataviewFields);i.show(),n.show();const l=this.AB.datacollectionByID(e).datasource;s.define("options",l.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),s.refresh(),o.define("options",l.fields((e=>"json"===e.key)).map((e=>({id:e.id,value:e.label})))),o.refresh(),a.define("options",l.fields((e=>"json"===e.key)).map((e=>({id:e.id,value:e.label})))),a.refresh()}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();Object.keys(e.settings).forEach((n=>{const s=$$(t[n]);if("dataviewFields"===n){const o=$$(t.dataviewFieldsLabel);if(!e.settings.dataviewID)return s.setValues(i[n]),o.hide(),void s.hide();s.setValues(e.settings[n]),o.show(),s.show()}else s.setValue(e.settings[n])}))}defaultValues(){return this.ViewClass()?.defaultValues()||{}}values(){const e=super.values(),t=this.defaultValues(),i=this.ids;return e.settings=Object.assign({},t,$$(i.component).getValues()),e.settings.dataviewFields=e.settings.dataviewID?Object.assign({},t.$dataviewFields,$$(i.dataviewFields).getValues()):t.dataviewFields,e.settings.datacollectionIDs=$$(i.datacollectionIDs).getValue(),e}ViewClass(){return super._ViewClass("reportsManager")}}}},4333:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=t.L(),s=e.UISettings.config();return class extends t{constructor(){super("properties_abview_scheduler",{dataviewID:"",dataviewFieldsLabel:"",dataviewFields:"",fieldName:"",fieldStart:"",fieldEnd:"",fieldAllDay:"",fieldRepeat:"",fieldCalendar:"",fieldEventColor:"",fieldSectionID:"",fieldUnitID:"",fieldNotes:"",fieldOriginID:"",calendarDataviewID:"",calendarDataviewFieldsLabel:"",calendarDataviewFields:"",fieldTitle:"",fieldCalendarColor:"",fieldActive:"",timeline:"",export:"",sectionAdd:"",timelineSectionList:"",unitAdd:"",unitList:"",readonly:""})}static get key(){return"scheduler"}ui(){const e=this.ids;return super.ui([{id:e.dataviewID,name:"dataviewID",view:"richselect",label:i("Data Source"),labelWidth:s.labelWidthLarge,on:{onChange:(e,t)=>{e!==t&&(this.getDataviewFieldOptions(e),this.onChange())}}},{id:e.dataviewFieldsLabel,view:"label",label:i("Dataview Fields"),hidden:!0},{id:e.dataviewFields,view:"form",hidden:!0,elements:[{id:e.fieldName,view:"richselect",name:"name",label:i("Event"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldStart,view:"richselect",name:"start",label:i("Start"),placeholder:i("Date & Time"),labelWidth:s.labelWidthLarge},{id:e.fieldEnd,view:"richselect",name:"end",label:i("End"),placeholder:i("Date & Time"),labelWidth:s.labelWidthLarge},{id:e.fieldAllDay,view:"richselect",name:"allDay",label:i("All day"),placeholder:i("Checkbox"),labelWidth:s.labelWidthLarge},{id:e.fieldRepeat,view:"richselect",name:"repeat",label:i("Repeat"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldCalendar,view:"richselect",name:"calendar",label:i("Calendar"),placeholder:i("Connect to another record (One to Many)"),labelWidth:s.labelWidthLarge},{id:e.fieldEventColor,view:"richselect",name:"color",label:i("Color"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldSectionID,view:"richselect",name:"sectionID",label:i("Section ID"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldUnitID,view:"richselect",name:"unitID",label:i("Unit ID"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldNotes,view:"richselect",name:"notes",label:i("Notes"),placeholder:i("Long text"),labelWidth:s.labelWidthLarge},{id:e.fieldOriginID,view:"richselect",name:"originID",label:i("Origin ID"),placeholder:i("Number"),labelWidth:s.labelWidthLarge}],on:{onChange:(e,t)=>{e!==t&&this.onChange()}}},{id:e.calendarDataviewID,view:"richselect",name:"calendarDataviewID",label:i("Calendar Data Source"),labelWidth:s.labelWidthLarge,hidden:!0,on:{onChange:(e,t)=>{e!==t&&(this.getCalendarDataviewFieldOptions(e),this.onChange())}}},{id:e.calendarDataviewFieldsLabel,view:"label",label:i("Calendar Dataview Fields"),hidden:!0},{id:e.calendarDataviewFields,view:"form",hidden:!0,elements:[{id:e.fieldTitle,view:"richselect",name:"title",label:i("Title"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldCalendarColor,view:"richselect",name:"color",label:i("Color"),placeholder:i("Single line text"),labelWidth:s.labelWidthLarge},{id:e.fieldActive,view:"richselect",name:"active",label:i("Active"),placeholder:i("Checkbox"),labelWidth:s.labelWidthLarge}],on:{onChange:(e,t)=>{e!==t&&this.onChange()}}},{view:"label",label:i("Timeline")},{id:e.timeline,view:"form",elements:[{name:"day",view:"checkbox",label:i("Day"),labelWidth:s.labelWidthLarge},{name:"week",view:"checkbox",label:i("Week"),labelWidth:s.labelWidthLarge},{name:"month",view:"checkbox",label:i("Month"),labelWidth:s.labelWidthLarge},{name:"year",view:"checkbox",label:i("Year"),labelWidth:s.labelWidthLarge},{name:"agenda",view:"checkbox",label:i("Agenda"),labelWidth:s.labelWidthLarge},{name:"timeline",view:"checkbox",label:i("Timeline"),labelWidth:s.labelWidthLarge},{name:"units",view:"checkbox",label:i("Units"),labelWidth:s.labelWidthLarge}],on:{onChange:()=>{this.onChange()}}},{view:"label",label:i("Timeline Section List")},{cols:[{id:e.sectionAdd,view:"text",placeholder:i('Name of Section (not include ",")')},{view:"button",label:i("Add"),maxWidth:100,click:()=>{const t=$$(e.sectionAdd).getValue();if(""===t||t.includes(","))return;const i=$$(e.timelineSectionList);i.data.find((e=>e.value===t)).length>0||(i.data.add({value:t}),this.onChange())}}]},{id:e.timelineSectionList,view:"list",height:200,select:"multiselect",template:"#value#",data:[]},{cols:[{view:"button",label:i("Delete"),click:()=>{const t=$$(e.timelineSectionList);t.remove(t.getSelectedId()),this.onChange()}},{view:"button",label:i("Delete All"),click:()=>{$$(e.timelineSectionList).clearAll(),this.onChange()}}]},{view:"label",label:i("Unit List")},{cols:[{id:e.unitAdd,view:"text",placeholder:i('Name of Unit (not include ",")')},{view:"button",label:i("Add"),maxWidth:100,click:()=>{const t=$$(e.unitAdd).getValue();if(""===t||t.includes(","))return;const i=$$(e.unitList);i.data.find((e=>e.value===t)).length>0||(i.data.add({value:t}),this.onChange())}}]},{id:e.unitList,view:"list",height:200,select:"multiselect",template:"#value#",data:[]},{cols:[{view:"button",label:i("Delete"),click:()=>{const t=$$(e.unitList);t.remove(t.getSelectedId()),this.onChange()}},{view:"button",label:i("Delete All"),click:()=>{$$(e.unitList).clearAll(),this.onChange()}}]},{view:"label",label:i("Export")},{id:e.export,view:"form",elements:[{name:"excel",view:"checkbox",label:i("Excel"),labelWidth:s.labelWidthLarge},{name:"csv",view:"checkbox",label:i("CSV"),labelWidth:s.labelWidthLarge},{name:"pdf",view:"checkbox",label:i("PDF"),labelWidth:s.labelWidthLarge}],on:{onChange:()=>{this.onChange()}}},{id:e.readonly,name:"readonly",view:"checkbox",label:i("Read only"),labelWidth:s.labelWidthLarge,on:{onChange:()=>{this.onChange()}}}])}async init(e){this.AB=e,await super.init(e);const t=this.ids,i=$$(t.dataviewID);i.define("options",this.CurrentApplication.datacollectionsIncluded().map((e=>({id:e.id,value:e.label})))),i.refresh()}getDataviewFieldOptions(e){const t=this.ids,i=$$(t.fieldName),n=$$(t.fieldStart),s=$$(t.fieldEnd),o=$$(t.fieldAllDay),a=$$(t.fieldRepeat),r=$$(t.fieldCalendar),l=$$(t.fieldEventColor),c=$$(t.fieldSectionID),h=$$(t.fieldUnitID),d=$$(t.fieldNotes),u=$$(t.fieldOriginID),p=$$(t.dataviewFieldsLabel),f=$$(t.dataviewFields),m=$$(t.calendarDataviewID),g=this.defaultValues();if(m.setValue(g.calendarDataviewID),this.getCalendarDataviewFieldOptions(""),!e)return m.define("options",[]),m.refresh(),i.define("options",[]),i.refresh(),n.define("options",[]),n.refresh(),s.define("options",[]),s.refresh(),o.define("options",[]),o.refresh(),a.define("options",[]),a.refresh(),r.define("options",[]),r.refresh(),l.define("options",[]),l.refresh(),c.define("options",[]),c.refresh(),h.define("options",[]),h.refresh(),d.define("options",[]),d.refresh(),u.define("options",[]),u.refresh(),p.hide(),f.hide(),f.setValues(g.dataviewFields),void m.hide();p.show(),f.show(),m.show();const b=this.AB.datacollectionByID(e).datasource,v=b.fields((e=>"connectObject"===e.key&&"one"===e.settings.linkType&&"many"===e.settings.linkViaType));r.define("options",v.map((e=>({id:e.id,value:e.label})))),r.refresh();const w=v.map((e=>e.settings.linkObject)),y=[];w.forEach((e=>{y.push(...this.CurrentApplication.datacollectionsIncluded().filter((t=>t.settings.datasourceID===e)))})),m.define("options",y.map((e=>({id:e.id,value:e.label})))),m.refresh(),i.define("options",b.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),i.refresh(),n.define("options",b.fields((e=>"datetime"===e.key)).map((e=>({id:e.id,value:e.label})))),n.refresh(),s.define("options",b.fields((e=>"datetime"===e.key)).map((e=>({id:e.id,value:e.label})))),s.refresh(),o.define("options",b.fields((e=>"boolean"===e.key)).map((e=>({id:e.id,value:e.label})))),o.refresh(),a.define("options",b.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),a.refresh(),l.define("options",b.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),l.refresh(),c.define("options",b.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),c.refresh(),h.define("options",b.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),h.refresh(),d.define("options",b.fields((e=>"LongText"===e.key)).map((e=>({id:e.id,value:e.label})))),d.refresh(),u.define("options",b.fields((e=>"number"===e.key)).map((e=>({id:e.id,value:e.label})))),u.refresh()}getCalendarDataviewFieldOptions(e){const t=this.ids,i=$$(t.fieldTitle),n=$$(t.fieldCalendarColor),s=$$(t.fieldActive),o=$$(t.calendarDataviewFieldsLabel),a=$$(t.calendarDataviewFields);if(!e)return i.define("options",[]),i.refresh(),n.define("options",[]),n.refresh(),s.define("options",[]),s.refresh(),o.hide(),a.setValues(this.defaultValues().calendarDataviewFields),void a.hide();o.show(),a.show();const r=this.AB.datacollectionByID(e).datasource;i.define("options",r.fields((e=>"string"===e.key)).map((e=>({id:e.id,value:e.label})))),i.refresh(),n.define("options",r.fields((e=>"string"===e.key&&1===e.settings.required)).map((e=>({id:e.id,value:e.label})))),n.refresh(),s.define("options",r.fields((e=>"boolean"===e.key)).map((e=>({id:e.id,value:e.label})))),s.refresh()}populate(e){super.populate(e);const t=this.ids,i=this.defaultValues();Object.keys(e.settings).forEach((n=>{const s=$$(t[n]);if("object"==typeof e.settings[n]){switch(n){case"dataviewFields":{const s=$$(t.dataviewFieldsLabel),o=$$(t[n]),a=$$(t.calendarDataviewID);if(!e.settings.dataviewID)return o.setValues(i[n]),a.setValue(i.calendarDataviewID),s.hide(),o.hide(),void a.hide();s.show(),o.show(),a.show()}break;case"calendarDataviewFields":{const s=$$(t.calendarDataviewFieldsLabel),o=$$(t.calendarDataviewFields);if(!e.settings.dataviewID||!e.settings.calendarDataviewID)return o.setValues(i[n]),s.hide(),void o.hide();s.show(),o.show()}}s.setValues(e.settings[n])}else switch(n){case"timelineSectionList":case"unitList":if(""===e.settings[n])break;e.settings[n].split(", ").forEach((e=>{$$(t[n]).data.add({value:e})}));break;default:s.setValue(e.settings[n])}}))}defaultValues(){return this.ViewClass()?.defaultValues()||{}}values(){const e=super.values(),t=this.defaultValues();e.settings=Object.assign({},t,$$(this.ids.component).getValues());const i=this.ids;return e.settings.dataviewFields=e.settings.dataviewID?$$(i.dataviewFields).getValues():t.dataviewFields,e.settings.calendarDataviewFields=e.settings.calendarDataviewID?$$(i.calendarDataviewFields).getValues():t.calendarDataviewFields,e.settings.timeline=$$(i.timeline).getValues(),e.settings.timelineSectionList=$$(i.timelineSectionList).data.find((()=>!0)).map((e=>e.value)).join(", "),e.settings.unitList=$$(i.unitList).data.find((()=>!0)).map((e=>e.value)).join(", "),e.settings.export=$$(i.export).getValues(),e}ViewClass(){return super._ViewClass("scheduler")}}}},6234:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(2418),s=i(5888);function o(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),o=t.L(),a=(0,s.Z)(e);return class extends t{constructor(){super("properties_abview_tab",{sidebarWidth:"",sidebarPos:"",iconOnTop:"",height:"",minWidth:"",stackTabs:"",darkTheme:""})}static get key(){return"tab"}ui(){const e=this.ids;return super.ui([{id:e.height,name:"height",view:"counter",label:o("Height"),on:{onChange:()=>{this.onChange()}}},{id:e.minWidth,view:"counter",name:"minWidth",label:o("Minimum width"),on:{onChange:()=>{this.onChange()}}},{id:e.stackTabs,view:"checkbox",name:"stackTabs",labelRight:o("Stack Tabs Vertically"),labelWidth:i.labelWidthCheckbox,on:{onChange:t=>{1==t?($$(e.sidebarWidth).show(),$$(e.sidebarPos).show(),$$(e.iconOnTop).hide()):($$(e.sidebarWidth).hide(),$$(e.sidebarPos).hide(),$$(e.iconOnTop).show()),this.onChange()}}},{id:e.iconOnTop,view:"checkbox",name:"iconOnTop",labelRight:o("Position icon above text"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.darkTheme,view:"checkbox",name:"darkTheme",labelRight:o("Use Dark Theme"),labelWidth:i.labelWidthCheckbox,on:{onChange:()=>{this.onChange()}}},{id:e.sidebarWidth,view:"counter",name:"sidebarWidth",label:o("Width of Sidebar"),labelWidth:i.labelWidthXLarge,on:{onChange:()=>{this.onChange()}}},{id:e.sidebarPos,view:"richselect",name:"sidebarPos",label:o("Position of Sidebar"),labelWidth:i.labelWidthXLarge,options:[{id:"left",value:o("Left")},{id:"right",value:o("Right")}],on:{onChange:()=>{this.onChange()}}},{view:"button",css:"webix_primary",value:o("Add Tab"),click:()=>{this.CurrentView.tabPopup.show()}}])}async init(e){await super.init(e);const t=this.CurrentView;t.tabPopup||(t.tabPopup=new a(t),await t.tabPopup.init(e)),this.__tabPopupSave||(this.__tabPopupSave=t.tabPopup.on("saved",(()=>{this.onChange()})))}populate(e){super.populate(e);const t=this.ids;$$(t.height).setValue(e.settings.height),$$(t.minWidth).setValue(e.settings.minWidth),$$(t.stackTabs).setValue(e.settings.stackTabs),$$(t.darkTheme).setValue(e.settings.darkTheme),$$(t.sidebarWidth).setValue(e.settings.sidebarWidth),$$(t.sidebarPos).setValue(e.settings.sidebarPos),$$(t.iconOnTop).setValue(e.settings.iconOnTop),e.settings.stackTabs?($$(t.sidebarWidth).show(),$$(t.sidebarPos).show(),$$(t.iconOnTop).hide()):($$(t.sidebarWidth).hide(),$$(t.sidebarPos).hide(),$$(t.iconOnTop).show())}values(){const e=super.values(),t=this.ids,i=$$(t.component);return e.settings=i.getValues(),e}ViewClass(){return super._ViewClass("tab")}}}},7669:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(2418);function s(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L();return class extends t{constructor(){super("properties_abview_text",{height:"",dataviewID:"",field:""}),this.AB=e}static get key(){return"text"}ui(){const e=this.ids,t=this;return super.ui([{id:e.height,view:"counter",name:"height",label:s("Height:"),labelWidth:i.labelWidthLarge,on:{onChange:()=>{this.onChange()}}},{id:e.dataviewID,name:"dataviewID",view:"richselect",label:s("Data Source"),labelWidth:i.labelWidthLarge,on:{onChange:e=>{t.selectSource(e),this.onChange()}}},{id:e.field,name:"field",view:"list",maxHeight:322,template:"#label#",on:{onItemClick:function(e){const i=this.getItem(e);t.selectField(i)}}}])}async init(e){this.AB=e,await super.init(e)}selectSource(e){const t=this.CurrentView;this.updateFieldOptions(t,e)}selectField(e){const t=`{${e.label}}`;tinymce.activeEditor.execCommand("mceInsertContent",!1,t)}updateFieldOptions(e,t){const i=this.ids,n=e.AB.datacollectionByID(t)??e.AB.datacollectionByID(e.parent.settings.dataviewID)??null;"dataview"===e.parent.key&&(t=e.parent.settings.dataviewID);const s=$$(i.dataviewID),o=$$(i.field);if(s.setValue(t),!n)return void o.clearAll();const a=n?.datasource??null;o.clearAll(),a&&o.parse(a.fields()),o.refresh()}populate(e){super.populate(e);const t=this.ids,i=e.settings.dataviewID??"none",n=$$(t.dataviewID),o=this.AB.Account.isSystemDesigner()?()=>!0:e=>!e.isSystemObject,a=this.CurrentApplication.datacollectionsIncluded(o),r=[{id:"none",value:s("None")},...a.map((e=>({id:e.id,value:e.label,icon:"query"==e.sourceType?"fa fa-filter":"fa fa-database"})))];n.define("options",r),n.define("value",i),n.refresh(),this.updateFieldOptions(e,i),$$(t.height).setValue(e.settings.height)}values(){const e=super.values(),t=this.ids,i=$$(t.component);return e.settings=i.getValues(),"none"==e.settings.dataviewID&&(e.settings.dataviewID=null),e}ViewClass(){return super._ViewClass("text")}}}},4245:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),s=null;function o(e,t){if(!s){const o=`${t}_viewpropertyfilterdata`,a=(0,n.Z)(e),r=e.Config.uiSettings();var i=a.L();class l extends e.Class.ABMLClass{constructor(){super(["label"],e)}fromSettings(e){super.fromValues(e),this.filters=e.filters}toSettings(){let e=super.toObj();return e.filters=this.filters,e}}class c extends a{constructor(e){let t=`${o}_filterrule_${e}`;super(t,{label:"",filter:"",btnDelete:""}),this.indx=e,this.base=t,this.rowFilter=null}ui(){return{id:this.ids.component,cols:[{id:this.ids.label,view:"text",value:""},{id:this.ids.filter,view:"button",css:"webix_primary",value:i("Add Filter"),click:()=>{this.rowFilter.popUp($$(this.ids.filter).getNode())}},{id:this.ids.btnDelete,view:"button",css:"webix_primary",width:28,type:"icon",icon:"fa fa-times",click:()=>{webix.confirm({title:i("Remove Filter?"),message:i("Are you sure you want to remove this filter?"),callback:async e=>{if(e){let e=$$(this.ids.component);e.getParentView().removeView(e),this.emit("deleted")}}})}}]}}init(e){this.AB=e,this.rowFilter=this.AB.filterComplexNew(`${this.ids.filter}_fc`)}fromSettings(e){this.settings=new l,this.settings.fromSettings(e),$$(this.ids.label).setValue(this.settings.label),this.rowFilter?.setValue(this.settings.filters)}toSettings(){return this.settings.label=$$(this.ids.label).getValue(),this.settings.filters=this.rowFilter?.getValue(),this.settings.toSettings()}objectLoad(e){this.object=e,this.rowFilter&&this.rowFilter.fieldsLoad(this.object.fields(),this.object)}}s=class t extends a{static get default(){return{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1}}constructor(t){super(o,{filterRules:"",filterRulesScrollview:"",filterOptionRadio:"",filterUserLayout:"",filterUser:"",filterGlobal:"",filterMenuLayout:"",needLoadAllLabel:"",globalToolbar:""}),this.AB=e,this.queryRules=[],this.isGrid=!1,t?.isGrid&&(this.isGrid=!0)}ui(){const e=this.ids;return{type:"form",rows:[{view:"radio",id:e.filterOptionRadio,value:0,options:[{id:0,value:i("Do not Allow User filters")},{id:1,value:i("Enable User filters")},{id:2,value:i("Use a filter menu")},{id:3,value:i("Use a global filter input")}],vertical:!0,label:"Filter Option",labelWidth:r.labelWidthLarge,on:{onChange:e=>{this.setFilterOption(e)}}},{view:"radio",id:e.filterGlobal,hidden:!0,vertical:!0,label:"Show",labelWidth:r.labelWidthLarge,options:[{id:"default",value:i("All matching records")},{id:"single",value:i("Single records only")}]},{view:"layout",id:e.filterUserLayout,hidden:!0,cols:[{view:"radio",vertical:!0,id:e.filterUser,value:"toolbar",label:"Display",labelWidth:r.labelWidthLarge,width:200,options:[{id:"toolbar",value:i("Toolbar")},{id:"form",value:i("Form")}],on:{onChange:e=>{this.setFilterUser(e)}}},{view:"checkbox",id:e.globalToolbar,width:350,labelRight:i("Include a global filter input")},{}]},{view:"layout",id:e.filterMenuLayout,hidden:!0,rows:[{css:{"padding-bottom":10},cols:[{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:i("Add new filter"),width:150,click:()=>{this.addFilterRule({})}},{id:e.needLoadAllLabel,view:"label",label:i('need "LoadAll" from datasource'),css:{color:"red"},hidden:!0},{fillspace:!0}]},{id:e.filterRulesScrollview,view:"scrollview",scroll:"xy",body:{id:e.filterRules,view:"layout",margin:20,padding:10,rows:[]}}]},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:i("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}},{fillspace:!0}]}]}}init(e){this.AB=e}buttonCancel(){this.emit("cancel")}buttonSave(){this.emit("save")}objectLoad(e,t=!1){this.object=e,this.isLoadAll=t,this.queryRules&&this.queryRules.length&&this.queryRules.forEach((t=>{t.objectLoad(e)}))}setSettings(e={}){const i=this.ids;e||(e={}),(e.queryRules||[]).forEach((e=>{e?.queryRules?.[0]?.rules&&e.queryRules[0].rules.forEach((e=>{/^[+-]?\d+(\.\d+)?$/.exec(e.value)&&(e.value=JSON.parse(e.value))}))}));let n=e.filterOption;(null==n||Number.isNaN(n))&&(n=t.default.filterOption),$$(i.filterOptionRadio).setValue(n),$$(i.filterUser).setValue(e.userFilterPosition||t.default.userFilterPosition),$$(i.globalToolbar).setValue(void 0!==e.isGlobalToolbar?e.isGlobalToolbar:t.default.isGlobalToolbar),$$(i.filterGlobal).setValue(e.globalFilterPosition||t.default.globalFilterPosition),(this.queryRules??[]).forEach((e=>{$$(i.filterRules)&&$$(i.filterRules).removeView(e.ids.component)})),this.queryRules=[],(e.queryRules||[]).forEach((e=>{this.addFilterRule(e)}))}getSettings(){const e=this.ids;var t={};switch(t.filterOption=parseInt($$(e.filterOptionRadio).getValue()),t.queryRules=[],t.filterOption){case 0:t.isGlobalToolbar=0;break;case 1:this.isGrid?(t.userFilterPosition=$$(e.filterUser).getValue(),t.isGlobalToolbar=$$(e.globalToolbar).getValue()):(t.userFilterPosition="form",t.isGlobalToolbar=0);break;case 2:this.queryRules.forEach((e=>{t.queryRules.push(e.toSettings())}));break;case 3:t.globalFilterPosition=$$(e.filterGlobal).getValue()}return t}addFilterRule(e){if(null==this.object)return;e=e??{};let t=0;this.queryRules.forEach((e=>{e.indx>t&&(t=e.indx)})),t++;let i=new c(t);var n=$$(this.ids.filterRules);n&&(n.addView(i.ui()),i.init(this.AB),i.objectLoad(this.object),i.fromSettings(e),i.on("deleted",(()=>{this.queryRules=this.queryRules.filter((e=>e.indx!=i.indx))}))),this.queryRules.push(i)}onShow(){this.isLoadAll?$$(this.ids.needLoadAllLabel).hide():$$(this.ids.needLoadAllLabel).show()}setFilterOption(e){const t=this.ids;switch(JSON.parse(e||0)){case 1:$$(t.filterMenuLayout).hide(),$$(t.filterGlobal).hide(),this.isGrid&&$$(t.filterUserLayout).show();break;case 2:$$(t.filterUserLayout).hide(),$$(t.filterGlobal).hide(),$$(t.filterMenuLayout).show();break;case 3:$$(t.filterUserLayout).hide(),$$(t.filterMenuLayout).hide(),$$(t.filterGlobal).show();break;default:$$(t.filterUserLayout).hide(),$$(t.filterMenuLayout).hide(),$$(t.filterGlobal).hide()}}setFilterUser(e){switch(e){case"toolbar":$$(this.ids.globalToolbar).show();break;case"form":$$(this.ids.globalToolbar).hide()}}}}return s}},8782:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),s=null;function o(e,t){if(!s){const o=`${t}_viewpropertylinkpage`,a=(0,n.Z)(e),r=e.Config.uiSettings();var i=a.L();s=class extends a{constructor(){super(o,{detailsPage:"",editPage:""}),this.AB=e}static get default(){return{detailsPage:null,detailsTab:null,editPage:null,editTab:null}}ui(){return{view:"fieldset",label:i("Linked Pages:"),labelWidth:r.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:this.ids.detailsPage,view:"combo",clear:!0,placeholder:i("No linked view"),name:"detailsPage",label:i("Details Page:"),labelWidth:r.labelWidthLarge,options:[],on:{onChange:()=>this.emit("changed")}},{id:this.ids.editPage,view:"combo",clear:!0,placeholder:i("No linked form"),name:"editPage",label:i("Edit Form:"),labelWidth:r.labelWidthLarge,options:[],on:{onChange:()=>this.emit("changed")}}]}}}init(e){return this.AB=e,Promise.resolve()}clear(){$$(this.ids.detailsPage).setValue(""),$$(this.ids.editPage).setValue("")}viewLoad(e,t=!1){this.view=e;const i=this.ids;t=t||e.settings.dataviewID;let n=(i,n)=>i.key==n&&(i.settings.dataviewID==t||(this.AB??e.AB)?.datacollectionByID(i.settings.dataviewID)?.datacollectionFollow?.id==t),s=[];s=s.concat(e.pageRoot().views((e=>n(e,"detail")),!0).map((e=>({id:e.id,value:e.label})))),s=s.concat(e.pageRoot().pages((e=>e.views((e=>n(e,"detail")),!0).length),!0).map((e=>({id:e.id,value:e.label})))),$$(i.detailsPage).define("options",s),$$(i.detailsPage).refresh();let o=[];o=o.concat(e.pageRoot().views((e=>n(e,"form")),!0).map((e=>({id:e.id,value:e.label})))),o=o.concat(e.pageRoot().pages((e=>e.views((e=>n(e,"form")),!0).length),!0).map((e=>({id:e.id,value:e.label})))),$$(i.editPage).define("options",o),$$(i.editPage).refresh()}setSettings(e){if(e.detailsPage){let t=e.detailsPage;""!=e.detailsTab&&(t+=":"+e.detailsTab),$$(this.ids.detailsPage).setValue(t)}else $$(this.ids.detailsPage).setValue(null);if($$(this.ids.detailsPage).refresh(),e.editPage){var t=e.editPage;""!=e.editTab&&(t+=":"+e.editTab),$$(this.ids.editPage).setValue(t)}else $$(this.ids.editPage).setValue(null);$$(this.ids.editPage).refresh()}getSettings(){let e={};const t=$$(this.ids.detailsPage);let i=t.getValue();t.getList().exists(i)||(i="");var n="";if(i.split(":").length>1){var s=i.split(":");i=s[0],n=s[1]}e.detailsPage=i,e.detailsTab=n;const o=$$(this.ids.editPage);let a=$$(this.ids.editPage).getValue();o.getList().exists(a)||(a="");var r="";if(a.split(":").length>1){var l=a.split(":");a=l[0],r=l[1]}return e.editPage=a,e.editTab=r,e}}}return s}},4550:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285);const s={name:"Default Gantt",filterConditions:[],sortFields:[],settings:{dataviewID:"",titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""}};function o(e,t){const i=(0,n.Z)(e),o=i.L(),a=e.Class.ABFieldManager.fieldByKey("date"),r=e.Class.ABFieldManager.fieldByKey("number"),l=e.Class.ABFieldManager.fieldByKey("string"),c=e.Class.ABFieldManager.fieldByKey("LongText");return new class extends i{constructor(e){super(e,{titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""}),this.on("field.added",(e=>{this.refreshOptions(this.CurrentObject,this._view),this._autoSelectInput&&$$(this._autoSelectInput)?.setValue(e.id)})),this._autoSelectInput=null,this._dateFields=[]}type(){return"gantt"}icon(){return"fa fa-tasks"}refreshOptions(e,t){const i=this.ids,n=e.fields((e=>e instanceof a)).map((({id:e,label:t})=>({id:e,value:t})));n.sort(((e,t)=>e.value>t.value?1:-1)),n.unshift({id:null,value:o("Select a date field")}),this._dateFields=n,$$(i.startDateFieldID).define("options",n),$$(i.endDateFieldID).define("options",n);const h=e.fields((e=>e instanceof r)).map((({id:e,label:t})=>({id:e,value:t})));h.sort(((e,t)=>e.value>t.value?1:-1)),h.unshift({id:null,value:o("Select a number field")}),this._numberFields=h,$$(i.durationFieldID).define("options",h),$$(i.progressFieldID).define("options",h);const d=e.fields((e=>e instanceof l||e instanceof c)).map((({id:e,label:t})=>({id:e,value:t})));d.sort(((e,t)=>e.value>t.value?1:-1)),d.unshift({id:null,value:o("Select a string field")}),this._stringFields=d,$$(i.titleFieldID).define("options",d),$$(i.notesFieldID).define("options",d),t&&(t.titleFieldID&&($$(i.titleFieldID).define("value",t.titleFieldID),$$(i.titleFieldID).refresh(),this.syncCommonLists([i.titleFieldID,i.notesFieldID],this._stringFields)),t.startDateFieldID&&($$(i.startDateFieldID).define("value",t.startDateFieldID),$$(i.startDateFieldID).refresh(),this.syncCommonLists([i.startDateFieldID,i.endDateFieldID],this._dateFields)),t.endDateFieldID&&($$(i.endDateFieldID).define("value",t.endDateFieldID||s.settings.endDateFieldIDFieldID),$$(i.endDateFieldID).refresh(),this.syncCommonLists([i.startDateFieldID,i.endDateFieldID],this._dateFields)),t.durationFieldID&&($$(i.durationFieldID).define("value",t.durationFieldID||s.settings.durationFieldID),$$(i.durationFieldID).refresh(),this.syncCommonLists([i.durationFieldID,i.progressFieldID],this._numberFields)),t.progressFieldID&&($$(i.progressFieldID).define("value",t.progressFieldID),$$(i.progressFieldID).refresh(),this.syncCommonLists([i.durationFieldID,i.progressFieldID],this._numberFields)),t.notesFieldID&&($$(i.notesFieldID).define("value",t.notesFieldID),$$(i.notesFieldID).refresh(),this.syncCommonLists([i.titleFieldID,i.notesFieldID],this._stringFields)))}syncCommonLists(e,t){e.forEach((i=>{const n=[];e.filter((e=>e!=i)).forEach((e=>{n.push($$(e).getValue())}));const s=$$(i),o=t.filter((e=>-1==n.indexOf(e.id)));s.define("options",o),s.refresh()}))}ui(){const e=this.ids;return{batch:"gantt",rows:[{cols:[{id:e.titleFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-calendar'></span> ${o("Title")}`,placeholder:o("Select a string field"),labelWidth:130,name:"titleFieldID",options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.titleFieldID,e.notesFieldID],this._stringFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.titleFieldID,this.emit("new.field",l.defaults().key)}}]},{cols:[{id:e.startDateFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-calendar'></span> ${o("Start Date")}`,placeholder:o("Select a date field"),labelWidth:130,name:"startDateFieldID",required:!0,options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.startDateFieldID,e.endDateFieldID],this._dateFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.startDateFieldID,this.emit("new.field",a.defaults().key)}}]},{cols:[{id:e.endDateFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-calendar'></span> ${o("End Date")}`,placeholder:o("Select a date field"),labelWidth:130,name:"endDateFieldID",options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.startDateFieldID,e.endDateFieldID],this._dateFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.endDateFieldID,this.emit("new.field",a.defaults().key)}}]},{cols:[{id:e.durationFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-hashtag'></span> ${o("Duration")}`,placeholder:o("Select a number field"),labelWidth:130,name:"durationFieldID",options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.durationFieldID,e.progressFieldID],this._numberFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.durationFieldID,this.emit("new.field",r.defaults().key)}}]},{cols:[{id:e.progressFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-hashtag'></span> ${o("Progress")}`,placeholder:o("Select a number field"),labelWidth:130,name:"progressFieldID",required:!1,options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.durationFieldID,e.progressFieldID],this._numberFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.progressFieldID,this.emit("new.field",r.defaults().key)}}]},{cols:[{id:e.notesFieldID,view:"richselect",label:`<span style='opacity: 0.6;' class='webix_icon fa fa-align-right'></span> ${o("Notes")}`,placeholder:o("Select a string field"),labelWidth:130,name:"notesFieldID",required:!1,options:[],on:{onChange:(t,i)=>{this.syncCommonLists([e.titleFieldID,e.notesFieldID],this._stringFields)}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.notesFieldID,this.emit("new.field",c.defaults().key)}}]}]}}init(e,t){this.objectLoad(e),this._view=t,this.refreshOptions(e,t?.settings)}validate(e){const t=this.ids,i=$$(t.endDateFieldID).getValue()||s.settings.endDateFieldID,n=$$(t.durationFieldID).getValue()||s.settings.durationFieldID;return!(!i&&!n&&(e.markInvalid("endDateFieldID","Required"),e.markInvalid("durationFieldID","Required"),1))}values(){const e=this.ids,t={};return t.titleFieldID=$$(e.titleFieldID).getValue()||s.settings.titleFieldID,t.startDateFieldID=$$(e.startDateFieldID).getValue()||s.settings.startDateFieldID,t.endDateFieldID=$$(e.endDateFieldID).getValue()||s.settings.endDateFieldID,t.durationFieldID=$$(e.durationFieldID).getValue()||s.settings.durationFieldID,t.progressFieldID=$$(e.progressFieldID).getValue()||s.settings.progressFieldID,t.notesFieldID=$$(e.notesFieldID).getValue()||s.settings.notesFieldID,t}fromSettings(e){for(const t in s)this[v]=e[t]||s[t];this.settings=Object.assign({},s.settings,e.settings??{}),this.type=this.type()}toSettings(){const e={};for(const t in s)e[t]=this[t]||s[t];return e.settings=Object.assign({},s.settings,e.settings??{}),e.key=this.type(),e.type=this.type(),e}}(t)}},5609:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(3285);const s={name:"Default Kanban",settings:{verticalGroupingField:null,horizontalGroupingField:null,ownerField:null}};var o=null;function a(e,t){const i=(0,n.Z)(e);var a=i.L();const r=e.Class.ABFieldManager.fieldByKey("connectObject"),l=e.Class.ABFieldManager.fieldByKey("list"),c=e.Class.ABFieldManager.fieldByKey("user");return o||(o=class extends i{constructor(e){super(e,{vGroupInput:"",hGroupInput:"",ownerInput:""}),this.on("field.added",(e=>{this.refreshOptions(this.CurrentObject,this._view),this._autoSelectInput&&$$(this._autoSelectInput)?.setValue(e.id)})),this._autoSelectInput=null}type(){return"kanban"}icon(){return"fa fa-columns"}refreshOptions(e,t,i={}){let n=this.ids;const s=(i,n,s=(e=>e.key===l.defaults().key),o)=>{if(null!=i&&null!=e){var r=e.fields().filter(s).map((({id:e,label:t})=>({id:e,value:t})));!o&&r.length&&r.unshift({id:"none",value:a("None")}),i.define("options",r),t?t.settings[n]?i.define("value",t.settings[n]):!o&&r[0]&&i.define("value",r[0].id):1===r.filter((e=>e.id)).length&&i.define("value",r[0].id),i.refresh()}};s(i.vGroupInput||$$(n.vGroupInput),"verticalGroupingField",(e=>[l.defaults().key,c.defaults().key].includes(e.key)),!0),s(i.hGroupInput||$$(n.hGroupInput),"horizontalGroupingField",(e=>[r.defaults().key,l.defaults().key,c.defaults().key].includes(e.key)),!1),s(i.ownerInput||$$(n.ownerInput),"ownerField",(e=>e.key===c.defaults().key||e.key===r.defaults().key&&"one"==e.settings.linkType&&"many"==e.settings.linkViaType),!1)}ui(){let e=this.ids;return{batch:"kanban",rows:[{cols:[{id:e.vGroupInput,view:"richselect",label:`<span style="opacity: 0.6;" class='webix_icon fa fa-columns'></span> ${a("Vertical Grouping")}`,placeholder:a("Select a field"),labelWidth:180,name:"verticalGroupingField",required:!0,options:[],on:{onChange:()=>{$$(e.vGroupInput).validate(),$$(e.hGroupInput).validate(),this.emit("changed")}},invalidMessage:a("Required")},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.vGroupInput,this.emit("new.field",l.defaults().key)}}]},{cols:[{id:e.hGroupInput,view:"richselect",label:`<span style="opacity: 0.6;"class='webix_icon fa fa-list'></span> ${a("Horizontal Grouping")}`,placeholder:a("Select a field"),labelWidth:180,name:"horizontalGroupingField",required:!1,options:[],invalidMessage:a("Cannot be the same as vertical grouping field"),validate:t=>{var i=$$(e.vGroupInput).getValue();return!i||!t||i!==t},on:{onChange:()=>{$$(e.hGroupInput).validate(),this.emit("changed")}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.hGroupInput,this.emit("new.field",l.defaults().key)}}]},{cols:[{id:e.ownerInput,view:"richselect",label:`<span style="opacity: 0.6;" class='webix_icon fa fa-user-circle'></span> ${a("Card Owner")}`,placeholder:a("Select a user field"),labelWidth:180,name:"ownerField",options:[],on:{onChange:(e,t)=>{e!=t&&this.emit("changed")}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:30,click:()=>{this._autoSelectInput=e.ownerInput,this.emit("new.field",r.defaults().key)}}]}]}}init(e,t){this.objectLoad(e),this._view=t,this.refreshOptions(e,t)}clearValues(){const e=this.ids;[e.vGroupInput,e.hGroupInput,e.ownerInput].forEach((e=>{let t=$$(e);t.blockEvent(),t.define("value",null),t.unblockEvent(),t.refresh()}))}values(){let e=this.ids,t={};return t.verticalGroupingField=$$(e.vGroupInput).getValue()||null,t.horizontalGroupingField=$$(e.hGroupInput).getValue()||null,t.ownerField=$$(e.ownerInput).getValue()||null,t}fromSettings(e){for(var t in s)this[t]=e[t]||s[t];this.type=this.type(),this.key=this.type()}toSettings(){var e={};for(var t in s)e[t]=this[t]||s[t];return e.key=this.type(),e.type=this.type(),e}}),new o(t)}},3285:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=null;function s(e){return n||(n=class extends e.ClassUI{constructor(...t){super(...t),this.AB=e,this.CurrentApplicationID=null,this.CurrentDatacollectionID=null,this.CurrentObjectID=null,this.CurrentProcessID=null,this.CurrentQueryID=null,this.CurrentViewID=null}static L(){return function(...t){return e.Multilingual.labelPlugin("ABDesigner",...t)}}applicationLoad(e){this.CurrentApplicationID=e?.id}datacollectionLoad(e){this.CurrentDatacollectionID=e?.id}objectLoad(e){this.CurrentObjectID=e?.id}processLoad(e){this.CurrentProcessID=e?.id}queryLoad(e){this.CurrentQueryID=e?.id}versionLoad(e){this.CurrentVersionID=e?.id}viewLoad(e){this.CurrentViewID=e?.id,e?.application&&this.applicationLoad(e.application)}get CurrentApplication(){return this.AB.applicationByID(this.CurrentApplicationID)}get CurrentDatacollection(){return this.AB.datacollectionByID(this.CurrentDatacollectionID)}get CurrentObject(){let e=this.AB.objectByID(this.CurrentObjectID);return e||(e=this.AB.queryByID(this.CurrentObjectID)),e}get CurrentProcess(){return this.AB.processByID(this.CurrentProcessID)}get CurrentQuery(){return this.AB.queryByID(this.CurrentQueryID)}get CurrentView(){return this.CurrentApplication?.views((e=>e.id==this.CurrentViewID))[0]}datacollectionsIncluded(){return this.CurrentApplication?.datacollectionsIncluded().filter((e=>{const t=e.datasource;return"object"==e.sourceType&&!t?.isImported&&!t?.isReadOnly})).map((e=>{let t={id:e.id,value:e.label};return"query"==e.sourceType?t.icon="fa fa-filter":t.icon="fa fa-database",t}))}uniqueIDs(){let e=webix.uid();Object.keys(this.ids).forEach((t=>{this.ids[t]=`${this.ids[t]}_${e}`}))}warningsRefresh(e){e?.warningsEval?.(),this.emit("warnings")}warningsPropogate(e=[]){e.forEach((e=>{e.on("warnings",(()=>{this.emit("warnings")}))}))}}),n}},8788:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e){const t=(0,n.Z)(e);var i=t.L();return class extends t{constructor(e,t){super(e,Object.assign({form:"",name:"",role:"",useRole:"",useAccount:"",account:""},t))}ui(n={}){var s=e.Account.rolesAll().map((e=>({id:e.id,value:e.name}))),o=e.Account.userList().map((e=>({id:e.uuid,value:e.username}))),a=this.ids;return{view:"form",id:this.ids.component,css:"no-margin",elements:[{cols:[{view:"checkbox",id:this.ids.useRole,width:34,labelWidth:0,value:"1"==n.useRole?1:0,click:function(e){$$(e).getValue()?$$(a.role).enable():$$(a.role).disable()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"label",label:i("by Role"),width:88},{view:"multicombo",id:this.ids.role,value:n.role?n.role:0,disabled:"1"!=n.useRole,suggest:{body:{yCount:4,data:s,on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${a.role}_${e.id}`)}))},onItemClick:function(e){var t=$$(a.role),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},placeholder:i("Click to add Role"),labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),a.role)},onChange:()=>{$$(this.ids.role).getList().callEvent("onAfterRender")}}}]},{},{cols:[{view:"checkbox",id:this.ids.useAccount,width:34,labelWidth:0,value:"1"==n.useAccount?1:0,click:function(e){$$(e).getValue()?$$(a.account).enable():$$(a.account).disable()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"label",label:i("by Account"),width:88},{view:"multicombo",id:this.ids.account,value:n.account?n.account:0,disabled:"1"!=n.useAccount,suggest:{body:{yCount:4,data:o,on:{onAfterRender(){this.data.each((e=>{t.CYPRESS_REF(this.getItemNode(e.id),`${a.account}_${e.id}`)}))},onItemClick:function(e){var t=$$(a.account),i=t.getValue(),n=i.indexOf(e);-1==n?i.push(e):i.splice(n,1),t.setValue(i)}}}},placeholder:i("Click to add User"),labelAlign:"left",stringResult:!1,on:{onAfterRender:function(){t.CYPRESS_REF(this.getNode(),a.account)},onChange:()=>{$$(this.ids.account).getList().callEvent("onAfterRender")}}}]}]}}async init(e){return this.AB=e,Promise.resolve()}values(){var e={},t=this.ids;return $$(t.useRole)&&(e.useRole=$$(t.useRole).getValue()),$$(t.role)&&e.useRole?(e.role=$$(t.role).getValue(),"--"===e.role&&(e.role=null)):e.role=null,$$(t.useAccount)&&(e.useAccount=$$(t.useAccount).getValue()),$$(t.account)&&e.useAccount?(e.account=$$(t.account).getValue(),"--"===e.account&&(e.account=null)):e.account=null,e}}}},5997:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e,t){t=t||"ui_work_object_workspace_popupFrozenColumns";const i=(0,n.Z)(e);var s=i.L();return new class extends i{constructor(e){super(e,{list:""}),this._setting=""}ui(){var e=this.ids;return{view:"popup",id:e.component,width:500,body:{rows:[{view:"list",id:e.list,width:250,maxHeight:350,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa fa-circle-o ab-frozen-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)}}},{view:"button",css:"webix_primary",value:s("Clear All"),type:"form",on:{onItemClick:()=>this.clickClearAll()}}]},on:{onShow:()=>{this.onShow(),this.iconsReset()}}}}async init(e){this.AB=e,webix.ui(this.ui())}changed(){this.emit("changed",this._setting)}clickClearAll(){this.setValue(""),this.iconsReset(),this.changed()}clickListItem(e){var t=$$(this.ids.list).getItem(e).columnName;-1==(this._hiddenFields||[]).indexOf(t)?(this.setValue(t),this.iconsReset(),this.changed()):webix.alert({text:s("Sorry, you cannot freeze a hidden column.")})}iconDefault(e){e&&(e.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle"),e.querySelector(".ab-frozen-field-icon").classList.add("fa-circle-o"))}iconFreeze(e){e&&(e.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle-o"),e.querySelector(".ab-frozen-field-icon").classList.add("fa-circle"))}iconsReset(){for(var e=$$(this.ids.list),t=!1,i=e.getFirstId();i;){var n=e.getItem(i).columnName,s=e.getItemNode(i);""==this._setting?this.iconDefault(s):0==t?this.iconFreeze(s):this.iconDefault(s),this._setting==n&&(t=!0),-1!=(this._hiddenFields||[]).indexOf(n)?(s.style.opacity=.4,s.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle"),s.querySelector(".ab-frozen-field-icon").classList.remove("fa-circle-o"),s.querySelector(".ab-frozen-field-icon").classList.add("fa-eye-slash")):(s.style.opacity=1,s.querySelector(".ab-frozen-field-icon").classList.remove("fa-eye-slash")),i=e.getNextId(i)}}onShow(){var e=this.CurrentObject.fields(),t=[];e.forEach((e=>{t.push({id:e.id,label:e.label,columnName:e.columnName,$css:"hidden_fields_"+e.id})})),$$(this.ids.list).clearAll(),$$(this.ids.list).parse(t)}show(e,t){null!=t?$$(this.ids.component).show(e,t):$$(this.ids.component).show(e)}setValue(e){this._setting=e}getValue(){return this._setting}setHiddenFields(e=[]){this._hiddenFields=e??[]}}(t)}},6038:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(3285);function s(e,t){t=t||"ui_work_object_workspace_popupHideFields";const i=(0,n.Z)(e);var s=i.L();return new class extends i{constructor(e){super(e,{list:"",buttonHide:"",buttonShow:""}),this._settings=[],this._frozenColumnID=null}ui(){var t=this.ids;return{view:"popup",id:t.component,body:{rows:[{view:"list",id:t.list,maxHeight:350,select:!1,template:'<span style="min-width: 18px; display: inline-block;"><i class="fa ab-visible-field-icon"></i>&nbsp;</span> #label#',on:{onItemClick:(e,t,i)=>{this.clickListItem(e,t,i)},onAfterRender(){this.data.each((i=>{e.ClassUI.CYPRESS_REF(this.getItemNode(i.id),`${t.list}_${i.id}`)}))}}},{cols:[{id:t.buttonHide,view:"button",value:s("Hide All"),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onItemClick:()=>{this.clickHideAll()}}},{id:t.buttonShow,view:"button",css:"webix_primary",value:s("Show All"),type:"form",on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onItemClick:()=>{this.clickShowAll()}}}]}]},on:{onShow:()=>{this.onShow(),this.iconsReset()}}}}init(e){this.AB=e,webix.ui(this.ui()),this.$Component=$$(this.ids.component),this.$List=$$(this.ids.list)}changed(){this.emit("changed",this._settings)}clickHideAll(){var e=this.CurrentObject.fields(),t=[];e.forEach((function(e){t.push(e.columnName)})),this._settings=t,this.iconsReset(),this.changed()}clickShowAll(){this._settings=[],this.iconsReset(),this.changed()}clickListItem(e,t,i){var n=this.$List.getItem(e);if(this._frozenColumnID!=n.columnName){var o=[];(this._settings||[]).filter((e=>e==n.columnName)).length>0?(o=(this._settings||[]).filter((e=>e!=n.columnName)),this.iconShow(i)):((o=this._settings||[]).push(n.columnName),this.iconHide(i)),this._settings=o||[],this.changed()}else webix.alert({text:s("Sorry, you cannot hide your last frozen column.")})}iconFreezeOff(e){e&&e.querySelector(".ab-visible-field-icon").classList.remove("fa-thumb-tack")}iconFreezeOn(e){e&&e.querySelector(".ab-visible-field-icon").classList.add("fa-thumb-tack")}iconHide(e){e&&(e.querySelector(".ab-visible-field-icon").classList.add("fa-eye-slash"),e.style.opacity=.4)}iconShow(e){e&&(e.querySelector(".ab-visible-field-icon").classList.remove("fa-eye-slash"),e.style.opacity=1)}iconsReset(){for(var e=this.$List,t=e.getFirstId();t;){var i=e.getItem(t),n=e.getItemNode(t);this._frozenColumnID==i.columnName?this.iconFreezeOn(n):(this.iconFreezeOff(n),-1==(this._settings||[]).indexOf(i.columnName)?this.iconShow(n):this.iconHide(n)),t=e.getNextId(t)}}onShow(){var e=this.CurrentObject.fields(),t=[];e.forEach((e=>{t.push({id:e.id,label:e.label,columnName:e.columnName})})),this.$List.clearAll(),this.$List.parse(e)}show(e,t=null){null!=t?this.$Component.show(e,t):this.$Component.show(e)}setSettings(e){this._settings=this.AB.cloneDeep(e||[])}getSettings(){return this._settings||[]}setFrozenColumnID(e){this._frozenColumnID=e}}(t)}},2439:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(3285),s=i(7056);function o(e,t){t=t||"abd_work_object_workspace_popupNewDataField";const i=(0,n.Z)(e),o=i.L(),a=(0,s.Z)(e);return new class extends i{constructor(e){super(e,{types:"",editDefinitions:"",buttonSave:"",buttonCancel:"",title:"",buttonMaximize:"",buttonMinimize:"",chooseFieldType:"",searchBar:"",fieldSetting:"",submission:"",buttonBack:""}),this._componentHash={},this._componentsByType={},this._currentEditor=null,this.defaultEditorComponent=null,this.submenus=[],this._editField=null}ui(){const e=this.ids;return{view:"window",position:"center",id:e.component,resize:!0,modal:!0,boarderless:!0,height:500,width:700,head:{view:"toolbar",css:"webix_dark",paddingX:2,elements:[{view:"label",id:e.title,align:"center",label:o("Choose Field-Type"),css:"modal_title"},{cols:[{view:"button",id:e.buttonMaximize,label:'<span class="webix_icon"><i class="nomargin fa fa-expand"></i></span>',css:"webix_transparent",width:40,click:()=>{this.buttonMaximize()}},{view:"button",id:e.buttonMinimize,label:'<span class="webix_icon"><i class="nomargin fa fa-compress"></i></span>',hidden:!0,css:"webix_transparent",width:40,click:()=>{this.buttonMinimize()}},{view:"button",label:'<span class="webix_icon"><i class="nomargin fa fa-times"></i></span>',css:"webix_transparent",width:40,click:()=>{this.buttonCancel()},on:{onAfterRender(){i.CYPRESS_REF(this)}}}]}]},body:{rows:[{id:e.chooseFieldType,rows:[{view:"search",id:e.searchBar,placeholder:o("Search by title..."),align:"center",on:{onTimedKeyPress:()=>{this.searchBar()}}},{view:"dataview",id:e.types,borderless:!0,type:{width:87.5,height:85,borderless:!0,template:'<button type="button" class="webix_button webix_img_btn_top" style="text-align: center;"><span style="font-size: 30px; color: #94a1b3;"><i class="#icon#"></i><br></span><span style="font-size: 12px; line-height: 13px; display: inline-block; margin: 3px 3px 0;">#label#</span></button>',css:"webix_transparent"},data:[],datatype:"json",select:1,click:e=>{this.onClick(e)}}]},{id:e.fieldSetting,minWidth:692,maxWidth:3840,maxHeight:2160,hidden:!0,rows:[{view:"multiview",id:e.editDefinitions,padding:0,cells:[{id:"del_me",view:"label",label:o("edit definition here")}]},{id:e.submission,cols:[{fillspace:!0},{view:"button",value:'<span class="webix_icon"><i class="nomargin fa fa-arrow-left fa-sm"></i></span><span class"text">'+o("Back")+"</span>",id:e.buttonBack,css:"ab-cancel-button webix_transparent icon_back_btn",autowidth:!0,click:()=>{this.buttonBack()}},{view:"button",css:"webix_primary",id:e.buttonSave,label:'<span class="text">'+o("Create")+"</span>",autowidth:!0,type:"form",click:()=>{this.buttonSave()}},{width:17}]},{height:17}]}]},on:{onHide:()=>{this.resetState()}}}}async init(e){e&&(this.AB=e);const i=this.ids;webix.ui(this.ui()),webix.extend($$(i.component),webix.ProgressBar);const n=a.fields(),s={view:"multiview",id:i.editDefinitions,animate:!1,rows:[]};n.forEach((e=>{const i=new e(`${t}_properties`),n=i.defaults().menuName,a=i.defaults().key,r=i.defaults().icon;this.submenus.push({id:n,icon:`nomargin fa fa-${r}`,label:o(n)}),this.defaultEditorComponent||(this.defaultEditorComponent=i),s.rows.push(i.ui()),this._componentHash[n]=i,this._componentsByType[a]=i})),$$(i.types).define("data",this.submenus),$$(i.types).refresh(),webix.ui(s,$$(i.editDefinitions));for(let e in this._componentHash)this._componentHash[e].init(this.AB),this._componentHash[e].hide();this.defaultEditorComponent.show(),this._currentEditor=this.defaultEditorComponent}applicationLoad(e){super.applicationLoad(e);for(const t in this._componentHash)this._componentHash[t]?.applicationLoad(e)}objectLoad(e){super.objectLoad(e);for(const t in this._componentHash)this._componentHash[t]?.objectLoad(e)}buttonCancel(){$$(this.ids.searchBar).setValue(""),this.searchBar(),this.buttonBack(),$$(this.ids.component).hide()}buttonMaximize(){$$(this.ids.buttonMaximize).hide(),$$(this.ids.buttonMinimize).show(),webix.fullscreen.set(this.ids.component)}buttonMinimize(){$$(this.ids.buttonMinimize).hide(),$$(this.ids.buttonMaximize).show(),webix.fullscreen.exit()}searchBar(){const e=$$(this.ids.searchBar).getValue().toLowerCase();$$(this.ids.types).filter((t=>-1!=t.label.toLowerCase().indexOf(e)))}buttonBack(){this.resetState(),this.addPopup();for(const e in this._componentHash)this._componentHash[e].clear()}async buttonSave(){const e=this.ids;$$(e.buttonSave).disable(),$$(e.component).showProgress();const t=this._currentEditor;if(t)if(t.isValid()){const i=this.AB.cloneDeep(t.values());let n,s=null,a=null;if(this.CurrentObject.isNetsuite&&i.settings?.netsuiteOneColumn&&(i.columnName=i.settings.netsuiteOneColumn),this._editField){i.label&&(this._editField.label=i.label),a=this._editField.toObj();const e=this.AB.cloneDeep(a);for(let t in i)if("settings"==t&&i.settings&&"object"==typeof i.settings){e.settings=e.settings||{};for(let t in i.settings)e.settings[t]=i.settings[t]}else e[t]=i[t];this._editField.fromValues(e),s=this._editField}else{if(s=this.CurrentObject.fieldNew(i),i.columnName!==s.columnName&&""===s.columnName)return this.AB.Webix.message({text:o("The column name can't contain special characters."),type:"error"}),$$(e.buttonSave).enable(),void $$(e.component).hideProgress();let t=20+10*s.label.length;if(s.settings.showIcon&&(t+=20),t<100&&(t=100),s.settings.width=t,"connectObject"==s.key){let e=Math.floor(1e3*Math.random());s.settings.isSource=1;const i=s.datasourceLink;let o=s.columnName;i.fields((e=>e.columnName==o)).length&&(o=`${o}${e}`),"many"==s.settings.linkType&&"many"==s.settings.linkViaType&&(o=`${this.CurrentObject.name}${e}`),s.object.id==s.datasourceLink.id&&(o=this.CurrentObject.label),n=i.fieldNew({key:s.key,columnName:o,label:this.CurrentObject.label,settings:{showIcon:s.settings.showIcon,linkObject:s.object.id,linkType:s.settings.linkViaType,linkViaType:s.settings.linkType,isCustomFK:s.settings.isCustomFK,indexField:s.settings.indexField,indexField2:s.settings.indexField2,isSource:0,width:t}})}}const r=s.isValid();if(r.fail())r.updateForm($$(t.ids.component)),a&&s.fromValues(a),$$(e.buttonSave).enable(),$$(e.component).hideProgress();else try{await s.save();let t=()=>{$$(e.buttonSave).enable(),$$(e.component).hideProgress(),this._currentEditor.clear(),this.hide(),this.emit("save",s)};null!=n?(n.settings.linkColumn=s.id,await n.save(),s.settings.linkColumn=n.id,await s.save(),this._editField||this.CurrentObject.isNetsuite||(await s.migrateCreate(),await n.migrateCreate()),t()):t()}catch(e){this.AB.notify.developer(e,{context:"UIWorkObjectWorkspacePopupNewDataField:buttonSave(): error saving new field",field:s.toObj()})}}else $$(e.buttonSave).enable(),$$(e.component).hideProgress();else this.AB.notify.developer(new Error("Could not find the current editor."),{}),$$(e.buttonSave).enable(),$$(e.component).hideProgress();this.buttonCancel}hide(){$$(this.ids.component).hide()}modeAdd(e,t=!0){this.defaultEditorComponent.show(!1,!1),this._currentEditor=this.defaultEditorComponent;const i=this.ids;if(this.CurrentObject.isImported&&(e="connectObject"),e){const i=Object.keys(this._componentHash).map((e=>this._componentHash[e])).filter((t=>t.defaults().key==e))[0];if(!i)return;const n=i.defaults().menuName;t||$$(this.ids.buttonBack).hide(),this.onClick(n)}else $$(i.chooseFieldType).enable(),this.addPopup()}modeEdit(e){this._currentEditor?.hide();for(const t in this._componentsByType)t==e.key?(this._componentsByType[t].show(!1,!1),this._componentsByType[t].populate(e),this._currentEditor=this._componentsByType[t],this._currentEditor.modeEdit=!0):this._componentsByType[t].hide();const t=this._currentEditor.ui()?.elements;if(t){const e=e=>{e.disallowEdit&&$$(e.id)?.disable?.()};this._currentEditor.eachDeep(t,e)}this.editPopup(e.defaults.menuName)}onClick(e){$$(this.ids.chooseFieldType).hide(),$$(this.ids.fieldSetting).show(),$$(this.ids.title).setValue(o("Create Field:")+" "+e);const t=this._componentHash[e];t&&(t.show(),this._currentEditor=t,this._currentEditor.modeEdit=!1)}resetState(){const e=this._currentEditor.ui()?.elements;if(e){const t=e=>{e.disallowEdit&&$$(e.id)?.enable?.()};this._currentEditor.eachDeep(e,t)}this.defaultEditorComponent.show(),this._currentEditor=this.defaultEditorComponent}addPopup(){this.buttonMinimize(),$$(this.ids.chooseFieldType).show(),$$(this.ids.buttonBack).show(),$$(this.ids.title).setValue(o("Choose Field-Type")),$$(this.ids.fieldSetting).hide(),$$(this.ids.buttonSave).define("label",o("Create")),$$(this.ids.buttonSave).refresh()}editPopup(e){this.buttonMinimize(),$$(this.ids.chooseFieldType).hide(),$$(this.ids.buttonBack).hide(),$$(this.ids.title).setValue(o("Edit Field:")+" "+e),$$(this.ids.fieldSetting).show(),$$(this.ids.buttonSave).define("label",o("Save")),$$(this.ids.buttonSave).refresh()}show(e,t,i=!0){this._editField=e,this._editField?this.modeEdit(e):this.modeAdd(t,i),$$(this.ids.component).show()}typeClick(){const e=this.ids;let t=$$(e.types).config.data[0].submenu;"string"!=typeof t&&($$(e.types).getSubMenu($$(e.types).config.data[0].id),t=$$(e.types).config.data[0].submenu),$$(t)&&$$(t).show()}}(t)}},423:(e,t,i)=>{"use strict";function n(e,t){t=t||"ui_work_object_workspace_popupSortFields";const i=new e.Class.SortPopup(t);return i.AB=e,i}i.d(t,{Z:()=>n})},2770:(e,t,i)=>{const n=i(4009);e.exports=class{constructor(e,t=FileReader){this._AB=e,this._FileReader=t}L(...e){return this._AB.Multilingual.labelPlugin("ABDesigner",...e)}getSeparateItems(){return[{id:",",value:this.L("Comma (,)")},{id:"\t",value:this.L("Tab (&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)")},{id:";",value:this.L("Semicolon (;)")},{id:"s",value:this.L("Space ( )")}]}validateFile(e){if(!e||!e.file||!e.file.type)return!1;let t=e.file.type.toLowerCase();return"text/csv"==t||"application/vnd.ms-excel"==t}async getDataRows(e,t){return this.validateFile(e)?new Promise(((i,n)=>{let s=new this._FileReader;s.onload=e=>{const n=this.convertToArray(s.result,t);i(n)},s.readAsText(e.file)})):Promise.reject(this.L(".fileInfo parameter is invalid"))}convertToArray(e="",t=","){let i=[];return(e.split(/\r\n|\n|\r/).filter((e=>e&&e.length>0))||[]).forEach((e=>{let n=[];n=","==t?(e=e.replace(/,,/g,", ,")).match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g):e.split(t),i.push(n.map((e=>this.reformat(e))))})),i}getGuessDataType(e,t){for(var i,s=1;s<=10;s++){var o=e[s];if(!o)break;if(null!=(i=o[t])&&i.length>0)break}return n.getFieldType(i)}reformat(e){return e?e.trim().replace(/"/g,"").replace(/'/g,""):""}}},4009:e=>{e.exports=class{static getFieldType(e){return null==e||""===e?"string":0==e||1==e||1==e||0==e||"checked"==e||"unchecked"==e?"boolean":isNaN(e)?Date.parse(e)?"date":e.length>100?"LongText":"string":"number"}}}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={id:n,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nc=void 0,(()=>{"use strict";var e=i(5256),t=i.n(e),n=i(3285),s=null;function o(e){if(!s){const i=(0,n.Z)(e);var t=i.L();s=class extends i{constructor(e){var i="abd_common_popupEditMenu";super(i),this.labels={copy:t("Copy"),exclude:t("Exclude"),rename:t("Rename"),delete:t("Delete")},this.ids.menu=`${i}_menu_${e}`,this.ids.list=`${i}_list_${e}`,this.Popup=null,this._menuOptions=[{label:this.labels.rename,icon:"fa fa-pencil-square-o",command:"rename"},{label:this.labels.copy,icon:"fa fa-files-o",command:"copy"},{label:this.labels.exclude,icon:"fa fa-reply",command:"exclude"},{label:this.labels.delete,icon:"fa fa-trash",command:"delete"}]}ui(){return{view:"popup",id:this.ids.menu,head:t("Application Menu"),width:120,body:{view:"list",id:this.ids.list,borderless:!0,data:[],datatype:"json",template:"<i class='fa #icon#' aria-hidden='true'></i> #label#",autoheight:!0,select:!1,on:{onItemClick:e=>{const{command:t}=$$(this.ids.list).getItem(e);return this.trigger(t)}}}}}async init(e,t){if(t=t||{},null==this.Popup&&(this.Popup=webix.ui(this.ui())),this.$list=$$(this.ids.list),this.hide(),this.menuOptions(this._menuOptions),t.hideCopy){let e=this.$list.data.find((e=>e.label==this.labels.copy))[0];if(e&&(this.$list.remove(e.id),this.$list.refresh()),t.hideExclude){let e=this.$list.data.find((e=>e.label==this.labels.exclude))[0];e&&(this.$list.remove(e.id),this.$list.refresh())}}}menuOptions(e){this.$list.clearAll(),this._menuOptions=e;var t=[];e.forEach((e=>{t.push({label:e.label,icon:e.icon,command:e.command})})),this.$list.parse(t),this.$list.refresh()}show(e){this.Popup?.show(e)}trigger(e){if(e)return this.hide(),this.emit("click",e),!1}hide(){this.Popup?.hide()}}}return s}function a(e,t="ui_warnings",i={}){t=t||"ui_warnings";const s=(0,n.Z)(e);var o=s.L();return new class extends s{constructor(e,t={}){super(e,{buttonWarning:"",buttonWarningHide:"",warnings:"",warningsScroll:""})}ui(){var e=this.ids;return{rows:[{view:"button",type:"form",id:e.buttonWarning,css:"webix_primary darkorange",value:`<i class="fa fa-warning"></i> ${o("Show Issues")}`,hidden:!0,click:()=>{$$(e.warnings).show(),$$(e.buttonWarning).hide(),$$(e.buttonWarningHide).show()}},{view:"button",type:"form",id:e.buttonWarningHide,css:"webix_primary darkorange",value:`<i class="fa fa-warning"></i> ${o("Hide Issues")}`,hidden:!0,click:()=>{$$(e.warnings).hide(),$$(e.buttonWarningHide).hide(),$$(e.buttonWarning).show()}},{id:e.warnings,view:"scrollview",scroll:"y",css:"webix_theme_dark",minHeight:300,body:{rows:[{id:e.warningsScroll,template:"Here are my warnings",autoheight:!0,css:"webix_theme_dark"}]},hidden:!0}]}}async init(e){this.AB=e}show(e){super.show();var t=this.ids;Array.isArray(e)||(e=[e]);let i=[];if(e.forEach((e=>{i=i.concat(e?.warningsAll().map((e=>e.message)))})),i=i.filter((e=>e)),i=this.AB.uniq(i),i?.length){let e="<ul class='warningslist'>";i.forEach((t=>{t&&(e+=`<li><i class="warningtext fa fa-warning"></i> ${t}</li>`)})),e+="</ul>",$$(t.warningsScroll).setHTML(e),$$(t.warnings).isVisible()?($$(t.buttonWarning).hide(),$$(t.buttonWarningHide).show()):($$(t.buttonWarning).show(),$$(t.buttonWarningHide).hide())}else $$(t.warningsScroll).setHTML(""),$$(t.warnings).hide(),$$(t.buttonWarning).hide(),$$(t.buttonWarningHide).hide()}}(t,i)}var r=i(8788);function l(e){const t=function(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e);var s=i.L();const l=o(e);return new class extends i{constructor(){super("abd_choose_list",{toolbar:"",buttonCreateNewApplication:"",uploader:"",exporter:"",list:""}),this.cacheTemplate={}}ui(){return{id:this.ids.component,responsive:"hide",type:"space",cols:[{maxWidth:t.appListSpacerColMaxWidth,minWidth:t.appListSpacerColMinWidth,width:t.appListSpacerColMaxWidth},{responsiveCell:!1,rows:[{maxHeight:t.appListSpacerRowHeight,hidden:t.hideMobile},{view:"toolbar",css:"webix_dark",id:this.ids.toolBar,cols:[{view:"spacer",width:10},{view:"label",label:s("Applications"),fillspace:!0,on:{onAfterRender(){i.CYPRESS_REF(this)}}},{id:this.ids.buttonCreateNewApplication,view:"button",label:s("Add new application"),autowidth:!0,type:"icon",icon:"fa fa-plus",css:"webix_transparent",click:()=>{this.NewApp.show(),this.NewApp.clear()},on:{onAfterRender(){i.CYPRESS_REF(this)}}},{view:"uploader",id:this.ids.uploader,label:s("Import"),autowidth:!0,upload:"/definition/import",multiple:!1,type:"icon",icon:"fa fa-upload no-margin",autosend:!0,css:"webix_transparent",on:{onAfterFileAdd:()=>{$$(this.ids.uploader).disable()},onFileUpload:()=>(window.location.reload(),!1),onFileUploadError:e=>(this.AB.notify.developer("Error uploading file",{url:e.xhr.responseURL,status:e.status,code:e.xhr.status,response:e.xhr.responseText}),$$(this.ids.uploader).enable(),!1),onAfterRender(){i.CYPRESS_REF(this)}}},{view:"button",id:this.ids.exporter,label:s("Export All"),autowidth:!0,type:"icon",icon:"fa fa-download",css:"webix_transparent",click:function(){window.location.assign("/definition/export/all?download=1")},on:{onAfterRender(){i.CYPRESS_REF(this)}}}]},{id:this.ids.list,view:"list",css:"ab-app-select-list",template:(e,t)=>this.templateListItem(e,t),tooltip:e=>this.toolTipListItem(e),type:{height:t.appListRowHeight,iconGear:function(e){return`<span class="webix_icon fa fa-cog" data-cy="edit_${e.id}"></span>`},iconAdmin:function(e){return e.isAdminApp?"<span class='webix_icon fa fa-circle-o-notch'></span> ":""}},select:!1,onClick:{"ab-app-list-item":(e,t,i)=>this.onClickListItem(e,t,i),"ab-app-list-edit":(e,t,i)=>this.onClickListEdit(e,t,i)},onHover:{},on:{onAfterRender(){this.data.each((e=>{i.CYPRESS_REF(this.getItemNode(e.id),e.id)}))}}},{maxHeight:t.appListSpacerRowHeight,hidden:t.hideMobile}]},{maxWidth:t.appListSpacerColMaxWidth,minWidth:t.appListSpacerColMinWidth,width:t.appListSpacerColMaxWidth}]}}async init(e){this.AB=e,this.$list=$$(this.ids.list),webix.extend(this.$list,webix.ProgressBar),webix.extend(this.$list,webix.OverlayBox),this.MenuComponent=new l(this.ids.component),this.MenuComponent.init(e);var t=[{label:s("Edit"),icon:"fa fa-pencil-square-o",command:"edit"},{label:s("Export"),icon:"fa fa-download",command:"export"},{label:s("Delete"),icon:"fa fa-trash",command:"delete"}];this.MenuComponent.menuOptions(t),this.MenuComponent.on("click",(e=>{var t=this.$list.getSelectedItem();switch(e){case"edit":this.NewApp.show(),this.NewApp.applicationLoad(t);break;case"delete":webix.confirm({title:s("Delete {0}?",[s("Application")]),text:s("Do you want to delete <b>{0}</b>?",[t.label]),ok:s("Yes"),cancel:s("No"),callback:async e=>{if(e){this.busy();try{await t.destroy(),this.refreshList(),webix.message({type:"success",text:s("{0}&nbsp; Successfully Deleted",[t.label])})}catch(e){webix.message({type:"error",text:s("There was an error deleting {0}.",[t.label])})}this.ready()}}});break;case"export":window.location.assign(`/definition/export/${t.id}?download=1`)}})),this.AB.Network.on("definitions.allapplications",((e,t,i)=>{if(this.ready(),t)return this.AB.notify.developer(t,{plugin:"ABDesigner",context:"ui_choose_list:init(): /definition/allapplications"}),void e?.reject?.(t);this.AB.definitionsParse(i),e?.resolve?.()})),this._handler_create=e=>{"application"==e?.type&&(this.AB.applications((t=>t.id==e.id)).length<1&&this.AB.definitionSync("created",e.id,e),this.refresh())},this._handler_reload=e=>{"application"==e?.type?this.refresh():e||this.AB.notify.developer(new Error("No def passed"),{plugin:"ABDesigner",context:"_handler_reload(): /definition/allapplications"})},this.NewApp=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_choose_list_newApp",{tab:""}),this.selectNew=!0,this.AppWeb=function(e,t){const i=e.Config.uiSettings(),s=(0,n.Z)(e);var o=s.L();const l=(0,r.Z)(e);a(e,"view_warnings",void 0);var c="<span class='webix_icon wxi-alert' style='font-size:18px; color:#EED202;'>&nbsp;</span>",h=e.UISettings.icons.map((e=>`fa-${e}`));return new class extends s{constructor(){super("abd_choose_form",{tab:"",form:"",appFormPermissionList:"",appFormCreateRoleButton:"",saveButton:"",accessManager:"",accessManagerToolbar:"",translationManager:"",translationManagerToolbar:"",tutorialManager:"",tutorialManagerToolbar:"",icon:"",issue_id:"",issue_list:""}),this.tabValue=null,this.tabLabel=o("Web App")}ui(){return this.accessManagerUI=new l("application_amp"),this.translationManagerUI=new l("application_translate"),this.tutorialManagerUI=new l("application_tutorial"),{id:this.ids.component,value:"web",css:"app_form_window",position:"center",header:this.tabLabel,body:{id:this.ids.tab,view:"scrollview",scroll:!0,height:670,width:770,body:{padding:4,cols:[{view:"spacer",width:2},{rows:[{view:"form",id:this.ids.form,rules:{label:e=>0<e.length&&e.length<=20},borderless:!0,elements:[{name:"label",view:"text",label:o("Name"),labelWidth:100,placeholder:o("Application Name"),invalidMessage:o("&nbsp; Name must be less than or equal to 20 letters."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_label")}}},{name:"version",view:"text",label:o("Version"),labelWidth:100,placeholder:o("1.0.0"),invalidMessage:o("&nbsp; can only contain numbers or '.'s ."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_version_number")}}},{name:"icon",view:"richselect",id:this.ids.icon,label:o("Icon"),labelWidth:100,placeholder:o("Menu Icon"),options:{body:{template:"<span class='fa #value#' style='color: #33b5e5;'></span>&nbsp; #value#",yCount:3,data:h}},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_icon")}}},{height:i.smallSpacer},{name:"description",view:"textarea",label:o("Description"),labelWidth:100,height:100,placeholder:o("Application Description"),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_description")}}},{view:"spacer",height:4},{name:"isSystemObject",view:"checkbox",labelRight:o("Is this a System Object?"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isSystemObj")}}},{view:"label",label:o("Who can use this app?"),css:"npr_smallLabels"},{name:"roleAccess",view:"multicombo",id:this.ids.appFormPermissionList,label:"",labelPosition:"top",placeholder:o("Click to add Role"),button:!0,on:{onAfterRender(){this.data.value.forEach((t=>{e.ClassUI.CYPRESS_REF(`perm_role_${t.id}`)}))}}},{name:"isAccessManaged",view:"checkbox",labelRight:o("Enable Page / Tab Access Management"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isAccessManaged")},onChange:e=>{e?($$(this.ids.accessManager).show(),$$(this.ids.accessManagerToolbar).show()):($$(this.ids.accessManager).hide(),$$(this.ids.accessManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.accessManager).show(),$$(this.ids.accessManagerToolbar).show()):($$(this.ids.accessManager).hide(),$$(this.ids.accessManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.accessManagerToolbar,cols:[{view:"label",label:o("Who can manage page / tab access for this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.accessManagement)},{id:this.ids.accessManager,rows:[this.accessManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.accessManagement)},{view:"spacer",height:6},{name:"isTranslationManaged",view:"checkbox",labelRight:o("Enable Translation Tool"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isTranslationManaged")},onChange:e=>{e?($$(this.ids.translationManager).show(),$$(this.ids.translationManagerToolbar).show()):($$(this.ids.translationManager).hide(),$$(this.ids.translationManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.translationManager).show(),$$(this.ids.translationManagerToolbar).show()):($$(this.ids.translationManager).hide(),$$(this.ids.translationManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.translationManagerToolbar,cols:[{view:"label",label:o("Who can translate this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.translationManagement)},{id:this.ids.translationManager,rows:[this.translationManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.translationManagement)},{name:"isTutorialManaged",view:"checkbox",labelRight:o("Enable Tutorial Tool"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_isTutorialManaged")},onChange:e=>{e?($$(this.ids.tutorialManager).show(),$$(this.ids.tutorialManagerToolbar).show()):($$(this.ids.tutorialManager).hide(),$$(this.ids.tutorialManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.tutorialManager).show(),$$(this.ids.tutorialManagerToolbar).show()):($$(this.ids.tutorialManager).hide(),$$(this.ids.tutorialManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.tutorialManagerToolbar,cols:[{view:"label",label:o("Who can create tutorials for this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.tutorialManagement)},{id:this.ids.tutorialManager,rows:[this.tutorialManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.tutorialManagement)},{view:"spacer",height:2},{view:"toolbar",margin:14,paddingY:20,cols:[{view:"button",value:o("Cancel"),css:"ab-cancel-button",inputWidth:100,align:"right",click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_form_cancel")}}},{view:"button",id:this.ids.saveButton,value:o("Save"),css:"webix_primary",inputWidth:100,click:()=>{this.buttonSaveClick()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}],borderless:!0}]}]},{view:"spacer",width:8}]}}}}init(e){this.AB=e,this.AB.Webix.ui(this.ui()),webix.extend($$(this.ids.form),this.AB.Webix.ProgressBar),webix.extend($$(this.ids.appFormPermissionList),this.AB.Webix.ProgressBar),this.AB.Webix.ui({view:"window",id:this.ids.issue_id,css:"app_form_window_2",height:222,width:700,head:{type:"clean",cols:[{view:"spacer",width:50},{template:c+o(" Issues"),type:"header",css:"webix_win_title"},{view:"icon",icon:"wxi-close",click(){this.getTopParentView().hide()}},{view:"spacer",width:4}]},position:"center",close:!0,modal:!0,move:!0,scroll:!0,body:{rows:[{view:"list",id:this.ids.issue_list,template:c+" #issue#",scrollX:!0,scrollY:!0,select:!0,editable:!1,autoheight:!1,autowidth:!1,data:[],click(){this.getParentView().show()}}]}}),this.permissionPopulate()}tab(){return $$(this.ids.tab)}toList(){this.emit("view.list")}warningData(){const e=this.AB.applications(),t=[];return e.forEach((e=>{t.push(...e.warningsAll())})),t?.length?t.map(((e,t)=>({id:t,issue:o(e.message)}))):[{id:1,issue:o("No Issues Found")}]}async applicationCreate(e){e.name=e.label;var t=this.AB.applicationNew(e);try{await t.save(),webix.message({type:"success",text:o("{0}&nbsp; Successfully Created",[e.label])})}catch(t){webix.message({type:"error",text:o("Error Creating {0}",[e.label])}),this.AB.notify.developer(t,{plugin:"ABDesigner",context:"ui_choose_form:applicationCreate()",values:e})}}async applicationUpdate(e){var t=this.formValues(),i={};try{Object.keys(t).forEach((n=>{i[n]=e[n],"version"!=n&&(e[n]=t[n])})),await e.save(),webix.message({type:"success",text:o("{0} Successfully Updated",[e.label])})}catch(n){webix.message({type:"error",text:o("Error Updating {0}",[e.label])}),this.AB.notify.developer(n,{context:"ui_choose_form:applicationUpdate()",application:e.toObj(),values:t}),Object.keys(i).forEach((t=>{e[t]=i[t]}))}}async buttonSaveClick(){if(this.buttonSaveDisable(),this.formBusy(),this.CurrentApplication){if(this.formValidate("update")){try{await this.applicationUpdate(this.CurrentApplication),this.toList()}catch(e){}this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}}else if(this.formValidate("add")){try{await this.applicationCreate(this.formValues()),this.formReset(),this.toList()}catch(e){}this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}}buttonSaveDisable(){$$(this.ids.saveButton).disable()}buttonSaveEnable(){$$(this.ids.saveButton).enable()}cancel(){this.formReset(),this.toList()}formBusy(){$$(this.ids.form).showProgress({type:"icon"})}formPopulate(e){if(super.applicationLoad(e),e){["label","description","version","icon","isSystemObject","isAccessManaged","isTranslationManaged","isTutorialManaged"].forEach((t=>{$$(this.ids.form).elements[t]&&$$(this.ids.form).elements[t].setValue(e[t]||e.json[t])}));var t=$$(this.ids.accessManager);t.removeView(t.getChildViews()[0]),t.addView(this.accessManagerUI.ui(e.accessManagers||{}),0);var i=$$(this.ids.translationManager);i.removeView(i.getChildViews()[0]),i.addView(this.translationManagerUI.ui(e.translationManagers||{}),0);var n=$$(this.ids.tutorialManager);n.removeView(n.getChildViews()[0]),n.addView(this.tutorialManagerUI.ui(e.tutorialManagers||{}),0)}this.permissionPopulate(e)}formReady(){$$(this.ids.form).hideProgress()}formReset(){super.applicationLoad(null),$$(this.ids.form).clear(),$$(this.ids.form).clearValidation(),this.permissionPopulate(),$$(this.ids.accessManager).removeView($$(this.ids.accessManager).getChildViews()[0]),$$(this.ids.translationManager).removeView($$(this.ids.translationManager).getChildViews()[0]),$$(this.ids.accessManager).addView(this.accessManagerUI.ui(),0),$$(this.ids.translationManager).addView(this.translationManagerUI.ui(),0),$$(this.ids.tutorialManager).addView(this.tutorialManagerUI.ui(),0)}formValidate(e){if(!$$(this.ids.form).validate())return this.formReady(),this.buttonSaveEnable(),!1;var t=[];if("add"===e){var i=this.formValues();i.name=i.label;var n=this.AB.applicationNew(i),s=[];(this.AB.applications()||[]).forEach((e=>{e.areaKey()==n.areaKey()&&s.push(e)})),s.length>0&&t.push({attr:"label",msg:o("&nbsp; Name ({0}) is already in use.",[n.label])})}if(t.length>0){var a=!1;return t.forEach((e=>{$$(this.ids.form).markInvalid(e.attr,e.msg),a||($$(this.ids.form).elements[e.attr].focus(),a=!0)})),this.formReady(),this.buttonSaveEnable(),!1}return!0}formValues(){const e=$$(this.ids.form).getValues();return e.roleAccess=(e.roleAccess??"").split(","),e.accessManagers=this.accessManagerUI.values(),e.translationManagers=this.translationManagerUI.values(),e.tutorialManagers=this.tutorialManagerUI.values(),e.apptype="web",e}permissionPopulate(e){const t=$$(this.ids.appFormPermissionList),i=this.AB.Account.rolesAll().map((e=>({id:e.id,value:e.name})));e&&i.filter((t=>e.roleAccess.indexOf(t.id)>-1)).map((e=>{e.markCheckbox=1}));const n=i.filter((e=>e.markCheckbox)).map((e=>e.id));t.define("suggest",i),t.setValue(n),t.refresh()}show(){$$(this.ids.component).show()}}}(e),this.AppMobile=function(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e);var s=i.L();const o=(0,r.Z)(e);var a="<span class='webix_icon wxi-alert' style='font-size:18px; color:#EED202;'>&nbsp;</span>",l=e.UISettings.icons.map((e=>`fa-${e}`));return new class extends i{constructor(){super("abd_choose_list_newApp_mobile",{tab:"",configNetworking:"",form:"",appFormPermissionList:"",appFormCreateRoleButton:"",saveButton:"",accessManager:"",accessManagerToolbar:"",translationManager:"",translationManagerToolbar:"",tutorialManager:"",tutorialManagerToolbar:"",icon:"",issue_id:"",issue_list:""}),this.tabValue=null,this.tabLabel=s("Mobile App")}ui(){return this.accessManagerUI=new o("application_amp"),this.translationManagerUI=new o("application_translate"),this.tutorialManagerUI=new o("application_tutorial"),{id:this.ids.component,value:"mobile",header:this.tabLabel,body:{id:this.ids.tab,view:"scrollview",value:"body_mobile",scroll:!0,height:670,width:770,body:{padding:4,cols:[{view:"spacer",width:2},{rows:[{view:"form",id:this.ids.form,rules:{label:e=>0<e.length&&e.length<=20},borderless:!0,elements:[{name:"label",view:"text",label:s("Name"),labelWidth:100,placeholder:s("Application Name"),invalidMessage:s("&nbsp; Name must be less than or equal to 20 letters."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_list_newApp_mobile_label")}}},{name:"version",view:"text",label:s("Version"),labelWidth:100,placeholder:s("1.0.0"),invalidMessage:s("&nbsp; can only contain numbers or '.'s ."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_list_newApp_mobile_version_number")}}},{name:"icon",view:"richselect",id:this.ids.icon,label:s("Icon"),labelWidth:100,placeholder:s("Menu Icon"),options:{body:{template:"<span class='fa #value#' style='color: #33b5e5;'></span>&nbsp; #value#",yCount:3,data:l}},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_list_newApp_mobile_icon")}}},{height:t.smallSpacer},{name:"description",view:"textarea",label:s("Description"),labelWidth:100,height:100,placeholder:s("Application Description"),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_list_newApp_mobile_description")}}},{view:"spacer",height:4},{view:"label",label:s("Who can use this app?"),css:"npr_smallLabels"},{name:"roleAccess",view:"multicombo",id:this.ids.appFormPermissionList,label:"",labelPosition:"top",placeholder:s("Click to add Role"),button:!0,on:{onAfterRender(){this.data.value.forEach((t=>{e.ClassUI.CYPRESS_REF(`mobile_perm_role_${t.id}`)}))}}},{name:"isTutorialManaged",view:"checkbox",labelRight:s("Enable Tutorial Tool"),labelWidth:0,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_list_newApp_mobile_isTutorialManaged")},onChange:e=>{e?($$(this.ids.tutorialManager).show(),$$(this.ids.tutorialManagerToolbar).show()):($$(this.ids.tutorialManager).hide(),$$(this.ids.tutorialManagerToolbar).hide())},onItemClick:e=>{$$(e).getValue()?($$(this.ids.tutorialManager).show(),$$(this.ids.tutorialManagerToolbar).show()):($$(this.ids.tutorialManager).hide(),$$(this.ids.tutorialManagerToolbar).hide())}}},{view:"toolbar",id:this.ids.tutorialManagerToolbar,cols:[{view:"label",label:s("Who can create tutorials for this app?"),css:"npr_smallLabels"}],borderless:!0,hidden:1!=parseInt(this.tutorialManagement)},{id:this.ids.tutorialManager,rows:[this.tutorialManagerUI.ui()],paddingY:10,hidden:1!=parseInt(this.tutorialManagement)},{view:"fieldset",label:s("Networking"),body:{rows:[{id:this.ids.configNetworking,view:"combo",label:"type",name:"networkType",value:"rest",options:[{id:"rest",value:s("Rest")},{id:"socket",value:s("Socket")},{id:"relay",value:s("Relay")}]},{view:""},{view:""}]}},{view:"spacer",height:2},{view:"toolbar",margin:14,paddingY:20,cols:[{view:"button",value:s("Cancel"),css:"ab-cancel-button",inputWidth:100,align:"right",click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"abd_choose_list_newApp_mobile_cancel")}}},{view:"button",id:this.ids.saveButton,value:s("Save"),css:"webix_primary",inputWidth:100,click:()=>{this.buttonSaveClick()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}],borderless:!0}]}]},{view:"spacer",width:8}]}}}}init(e){this.AB=e,this.AB.Webix.ui(this.ui()),webix.extend($$(this.ids.form),this.AB.Webix.ProgressBar),webix.extend($$(this.ids.appFormPermissionList),this.AB.Webix.ProgressBar),this.AB.Webix.ui({view:"window",id:this.ids.issue_id,css:"app_form_window_2",height:222,width:700,head:{type:"clean",cols:[{view:"spacer",width:50},{template:a+s(" Issues"),type:"header",css:"webix_win_title"},{view:"icon",icon:"wxi-close",click(){this.getTopParentView().hide()}},{view:"spacer",width:4}]},position:"center",close:!0,modal:!0,move:!0,scroll:!0,body:{rows:[{view:"list",id:this.ids.issue_list,template:a+" #issue#",scrollX:!0,scrollY:!0,select:!0,editable:!1,autoheight:!1,autowidth:!1,data:[],click(){this.getParentView().show()}}]}}),this.permissionPopulate()}tab(){return $$(this.ids.tab)}toList(){this.emit("view.list")}warningData(){const e=this.AB.applications(),t=[];return e.forEach((e=>{t.push(...e.warningsAll())})),t?.length?t.map(((e,t)=>({id:t,issue:s(e.message)}))):[{id:1,issue:s("No Issues Found")}]}async applicationCreate(e){e.name=e.label;var t=this.AB.applicationMobileNew(e);try{await t.save(),webix.message({type:"success",text:s("{0}&nbsp; Successfully Created",[e.label])})}catch(t){webix.message({type:"error",text:s("Error Creating {0}",[e.label])}),this.AB.notify.developer(t,{plugin:"ABDesigner",context:"ui_choose_form:applicationCreate()",values:e})}}async applicationUpdate(e){var t=this.formValues(),i={};Object.keys(t).forEach((n=>{i[n]=e[n],e[n]=t[n]}));try{await e.save(),webix.message({type:"success",text:s("{0} Successfully Updated",[e.label])})}catch(n){webix.message({type:"error",text:s("Error Updating {0}",[e.label])}),this.AB.notify.developer(n,{context:"ui_choose_form:applicationUpdate()",application:e.toObj(),values:t}),Object.keys(i).forEach((t=>{e[t]=i[t]}))}}async buttonSaveClick(){if(this.buttonSaveDisable(),this.formBusy(),this.CurrentApplication){if(this.formValidate("update")){try{await this.applicationUpdate(this.CurrentApplication),this.toList()}catch(e){}this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}}else if(this.formValidate("add")){try{await this.applicationCreate(this.formValues()),this.formReset(),this.toList()}catch(e){}this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}}buttonSaveDisable(){$$(this.ids.saveButton).disable()}buttonSaveEnable(){$$(this.ids.saveButton).enable()}cancel(){this.formReset(),this.toList()}formBusy(){$$(this.ids.form).showProgress({type:"icon"})}formPopulate(e){super.applicationLoad(e);let t=$$(this.ids.form);if(e){["label","description","version","icon","isSystemObject","isAccessManaged","isTranslationManaged","isTutorialManaged","networkType"].forEach((i=>{t.elements[i]&&t.elements[i].setValue(e[i]||e.json[i])}));var i=$$(this.ids.accessManager);i&&(i.removeView(i.getChildViews()[0]),i.addView(this.accessManagerUI.ui(e.accessManagers||{}),0));var n=$$(this.ids.translationManager);n&&(n.removeView(n.getChildViews()[0]),n.addView(this.translationManagerUI.ui(e.translationManagers||{}),0));var s=$$(this.ids.tutorialManager);s&&(s.removeView(s.getChildViews()[0]),s.addView(this.tutorialManagerUI.ui(e.tutorialManagers||{}),0))}this.permissionPopulate(e)}formReady(){$$(this.ids.form).hideProgress()}formReset(){super.applicationLoad(null),$$(this.ids.form).clear(),$$(this.ids.form).clearValidation(),this.permissionPopulate(),$$(this.ids.configNetworking)?.setValue?.("rest")}formValidate(e){if(!$$(this.ids.form).validate())return this.formReady(),this.buttonSaveEnable(),!1;var t=[];if("add"===e){var i=this.formValues();i.name=i.label;var n=this.AB.applicationMobileNew(i),o=[];(this.AB.applications()||[]).forEach((e=>{e.areaKey()==n.areaKey()&&o.push(e)})),o.length>0&&t.push({attr:"label",msg:s("&nbsp; Name ({0}) is already in use.",[n.label])})}if(t.length>0){var a=!1;return t.forEach((e=>{$$(this.ids.form).markInvalid(e.attr,e.msg),a||($$(this.ids.form).elements[e.attr].focus(),a=!0)})),this.formReady(),this.buttonSaveEnable(),!1}return!0}formValues(){const e=$$(this.ids.form).getValues();return e.roleAccess=(e.roleAccess??"").split(","),e.accessManagers=this.accessManagerUI.values(),e.translationManagers=this.translationManagerUI.values(),e.tutorialManagers=this.tutorialManagerUI.values(),e.apptype="web",e}permissionPopulate(e){const t=$$(this.ids.appFormPermissionList),i=this.AB.Account.rolesAll().map((e=>({id:e.id,value:e.name})));e&&i.filter((t=>e.roleAccess.indexOf(t.id)>-1)).map((e=>{e.markCheckbox=1}));const n=i.filter((e=>e.markCheckbox)).map((e=>e.id));t.define("suggest",i),t.setValue(n),t.refresh()}show(){$$(this.ids.component).show()}}}(e)}ui(){const e=this;return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new Application"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:{view:"tabview",id:this.ids.tab,cells:[this.AppWeb.ui(),this.AppMobile.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onBeforeTabClick:e=>$$(e)?.isEnabled(),onAfterRender(){this.config.options.forEach((t=>{t.value==e.AppMobile.tabLabel?e.AppMobile.tabValue=t.id:e.AppWeb.tabValue=t.id})),this.$view.querySelectorAll(".webix_item_tab").forEach((e=>{var i=e.getAttribute("button_id");t.CYPRESS_REF(e,`${i}_tab`)}))}}}},on:{onBeforeShow:()=>{var e=$$(this.ids.tab).getValue();this.switchTab(e)}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);var t=[];return["AppWeb","AppMobile"].forEach((i=>{t.push(this[i].init(e)),this[i].on("view.list",(()=>{this.hide()})),this[i].on("cancel",(()=>{this.hide()}))})),Promise.all(t)}clear(){this.AppWeb.formReset(),this.AppMobile.formReset()}hide(){this.$component?.hide()}busy(){this.$component?.showProgress?.()}applicationLoad(e){super.applicationLoad(e),e.isMobile?(this.AppWeb.formReset(),this.AppWeb.tab().disable(),this.AppMobile.formPopulate(e),this.AppMobile.tab().enable(),$$(this.ids.tab).setValue(this.AppMobile.tabValue)):(this.AppWeb.formPopulate(e),this.AppWeb.tab().enable(),this.AppMobile.formReset(),this.AppMobile.tab().disable(),$$(this.ids.tab).setValue(this.AppWeb.tabValue))}ready(){this.$component?.hideProgress?.()}done(e){console.error("WHO IS CALLING THIS?"),this.ready(),this.hide(),this.emit("save",e)}show(e){this.AppWeb.tab().enable(),this.AppMobile.tab().enable(),null!=e&&(this.selectNew=e),this.$component&&this.$component.show()}switchTab(e){e==this.AppWeb?.ids.form?this.AppWeb?.onShow?.(this.CurrentApplicationID):e==this.AppMobile?.ids.form&&this.AppMobile?.onShow?.(this.CurrentApplicationID)}}}(e),await this.NewApp.init(e),this.AB.on("definition.created",this._handler_create)}busy(){this.$list.disable(),this.$list.showProgress&&this.$list.showProgress({type:"icon"})}refresh(){this.busy();var e=e=>!e.isSystemObj;this.AB.Account.isSystemDesigner()&&(e=()=>!0);var t=this.AB.applications(e);this.dcEditableApplications=new webix.DataCollection({data:t||[]}),["definition.updated","definition.deleted"].forEach((e=>{t.forEach((t=>{t.removeListener(e,this._handler_reload),t.on(e,this._handler_reload)}))})),this.dcEditableApplications.attachEvent("onAfterAdd",(()=>{this.refreshOverlay()})),this.dcEditableApplications.attachEvent("onAfterDelete",(()=>{this.refreshOverlay()})),this.refreshList(),this.ready()}onClickListEdit(e,t,i){return this.MenuComponent.show(i),this.$list.select(t),!1}onClickListItem(e,t){this.$list.select(t);let i=this.$list.getItem(t);return i&&(i.App=this.AB.App,this.emit("view.workplace",i)),!1}ready(){this.$list.enable(),this.$list.hideProgress&&this.$list.hideProgress()}refreshList(){this.$list.clearAll(),this.$list.data.unsync(),this.$list.data.sync(this.dcEditableApplications),this.$list.sort("label","asc"),this.refreshOverlay(),this.$list.refresh(),this.ready()}refreshOverlay(){this.$list.count()?this.$list.hideOverlay():this.$list.showOverlay(s("There is no application data"))}show(){super.show(),this.refresh()}templateListItem(e,t){if(!this.cacheTemplate[e.id]){var i={icon:"",count:0};e.warningsEval?.();let n=e.warningsAll();n.length&&(i.icon=this.WARNING_ICON,i.count=n.length),this.cacheTemplate[e.id]=`<div class='ab-app-list-item'>\n   <div class='ab-app-list-info'>\n      <div class='ab-app-list-name'><i class="lighten fa-fw fa ${e.icon}"></i> ${t.iconAdmin(e)}${e.label??""}</div>\n      <div class='ab-app-list-description'>${e.description??""}</div>\n   </div>\n   <div class='ab-app-list-edit'>\n      ${i.icon}\n      ${t.iconGear(e)}\n   </div>\n</div>`,setTimeout((()=>{delete this.cacheTemplate[e.id]}),400)}return this.cacheTemplate[e.id]}toolTipListItem(e){let t=$$(this.ids.list).data.getItem(e.id).warningsAll().length;return t?`${t} issues`:""}}}(e),i=(0,n.Z)(e);return new class extends i{constructor(){super("abd_choose")}ui(){return{id:this.ids.component,view:"multiview",animate:!1,cells:[t.ui()]}}async init(e){return this.AB=e,this.warningsPropogate([t]),this.on("warnings",(()=>{t.refreshList()})),t.on("view.workplace",(e=>{this.emit("view.workplace",e)})),Promise.all([t.init(e)])}show(){super.show(),t.show()}}}function c(e,t){var i=o(e);const n=e.Config.uiSettings();var s=function(...t){return e.Multilingual.labelPlugin("ABDesigner",...t)};class a extends e.ClassUI{constructor(e){var t=e.idBase||"ui_common_list";if(super(t,{listSetting:"",list:"",searchText:"",sort:"",group:"",buttonNew:""}),this.idBase=t,this.labels={addNew:"Add new item",confirmDeleteTitle:"Delete Item",title:"Items",searchPlaceholder:"Item name",renameErrorMessage:"error renaming {0}",confirmDeleteMessage:"Do you want to delete <b>{0}</b>?",listSearch:"Search",listSetting:"Settings",listSort:"Sort",listAsc:"A -> Z",listDesc:"Z -> A",listGroup:"Group"},e.labels)for(var i in e.labels)this.labels[i]=e.labels[i];e.menu=e.menu||{},e.menu.copy=void 0===e.menu.copy||e.menu.copy,e.menu.exclude=void 0===e.menu.exclude||e.menu.exclude,this.attributes=e,this._templateListItem=e.templateListItem||["<div class='ab-object-list-item'>","#label##warnings#","{common.iconGear}","</div>"].join(""),this.cacheTemplate={},this.CurrentApplication=null,this.itemList=null,this._initialized=!1,this._settings={}}ui(){this.PopupEditComponent=new i(this.ids.component);var t=this.ids;return{id:this.ids.component,rows:[{view:e.custom.editunitlist.view,id:this.ids.list,width:n.columnWidthLarge,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",uniteBy:()=>s(this.labels.title),template:(e,t)=>this.templateListItem(e,t),tooltip:e=>this.toolTipListItem(e),type:{height:35,headerHeight:35,iconGear:e=>`<div class="ab-object-list-edit"><span class="webix_icon fa fa-cog" data-cy="${this.ids.list}_edit_${e.id}"></span></div>`},on:{onAfterSelect:e=>{this.onSelectItem(e)},onBeforeEditStop:(e,t)=>{this.onBeforeEditStop(e,t)},onAfterEditStop:(e,t,i)=>{this.onAfterEditStop(e,t,i)},onAfterRender(){this.data.each((i=>{e.ClassUI.CYPRESS_REF(this.getItemNode(i.id),`${t.list}_${i.id}`)}))}},onClick:{"ab-object-list-edit":(e,t,i)=>{this.clickEditMenu(e,t,i)}}},{view:"accordion",multi:!0,css:"ab-object-list-filter",rows:[{id:this.ids.listSetting,header:s(this.labels.listSetting),headerHeight:45,headerAltHeight:45,body:{padding:5,rows:[{id:this.ids.searchText,view:"search",icon:"fa fa-search",label:s(this.labels.listSearch),labelWidth:80,placeholder:s(this.labels.searchPlaceholder),height:35,keyPressTimeout:100,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onTimedKeyPress:()=>{this.listSearch(),this.save()}}},{id:this.ids.sort,view:"segmented",label:s(this.labels.listSort),labelWidth:80,height:35,options:[{id:"asc",value:s(this.labels.listAsc)},{id:"desc",value:s(this.labels.listDesc)}],on:{onAfterRender(){this.$view.querySelectorAll("button").forEach((i=>{var n=i.getAttribute("button_id");e.ClassUI.CYPRESS_REF(i,`${t.sort}_${n}`)}))},onChange:e=>{this.listSort(e),this.save()}}},{id:this.ids.group,view:"checkbox",label:s(this.labels.listGroup),labelWidth:80,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onChange:e=>{this.listGroup(e),this.save()}}}]}}],on:{onAfterCollapse:()=>{this.listSettingCollapse(),this.save()},onAfterExpand:()=>{this.listSettingExpand(),this.save()}}},{view:"button",css:"webix_primary",id:this.ids.buttonNew,value:s(this.labels.addNew),type:"form",click:()=>{this.clickAddNew(!0)},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}}init(e){this.AB=e,$$(this.ids.component)&&$$(this.ids.component).adjust(),this.$list=$$(this.ids.list),this.$list&&(webix.extend(this.$list,webix.ProgressBar),this.$list.adjust()),this.PopupEditComponent.init(e,{hideCopy:!this.attributes.menu.copy,hideExclude:!this.attributes.menu.exclude}),this.PopupEditComponent.on("click",(e=>{var t=this.$list.getSelectedItem(!1);switch(e){case"delete":this.remove();break;case"rename":this.rename();break;case"exclude":this.emit("exclude",t);break;case"copy":this.copy(t);break;case"information":this.emit("information",t);break;default:this.emit("menu",{command:e,id:t.id})}})),this._settings=this.AB.Storage.get(this.idBase)||{objectlistIsOpen:!1,objectlistSearchText:"",objectlistSortDirection:"",objectlistIsGroup:!1},this._initialized=!0}dataLoad(e){this.busy(),this.itemList=new webix.DataCollection({data:e});var t=$$(this.ids.listSetting);t.getParentView().blockEvent(),t.define("collapsed",1!=this._settings.objectlistIsOpen),t.refresh(),t.getParentView().unblockEvent();var i=$$(this.ids.searchText);i.blockEvent(),i.setValue(this._settings.objectlistSearchText),i.unblockEvent();var n=$$(this.ids.sort);n.blockEvent(),n.setValue(this._settings.objectlistSortDirection),n.unblockEvent();var s=$$(this.ids.group);s.blockEvent(),s.setValue(this._settings.objectlistIsGroup),s.unblockEvent();var o=this.$list;o&&(o.clearAll(),o.data.unsync(),o.data.sync(this.itemList),o.refresh(),o.unselectAll()),this.listSort(this._settings.objectlistSortDirection),this.listSearch(),this.ready()}clickEditMenu(e,t,i){return this.PopupEditComponent.show(i),this.emit("show"),!1}copy(e){var t=e.toObj();t.id="copy_"+(this.itemList?this.itemList.count():"01"),delete t.translations,t.name=t.name+" copy",t.label=t.name;var i=this.$list,n=i.getIndexById(i.getSelectedId());i.add(t,n),i.select(t.id),i.edit(t.id)}listSettingCollapse(){this._settings.objectlistIsOpen=!1}listSettingExpand(){this._settings.objectlistIsOpen=!0}busy(){this.$list?.showProgress?.({type:"icon"})}ready(){this.$list?.hideProgress?.()}listSearch(){var e=$$(this.ids.searchText).getValue().toLowerCase();this.$list.filter((function(t){return!t.label||t.label.toLowerCase().indexOf(e)>-1})),this._settings.objectlistSearchText=e}listSort(e){null!=this.itemList&&(this.itemList.sort("label",e),this.listSearch(),this._settings.objectlistSortDirection=e)}listGroup(e){1==e?this.$list.define("uniteBy",(e=>e.label.toUpperCase().substr(0,1))):this.$list.define("uniteBy",(()=>s(this.labels.title))),this.$list.refresh(),this._settings.objectlistIsGroup=e}listCount(){if(this.$list)return this.$list.count()}selectedItem(){return this.$list.getSelectedItem(!1)}onAfterEditStop(e,t){if(this.showGear(t.id),e.value!=e.old){this.busy();var i=this.$list.getSelectedItem(!1);if(i.label=e.value,i.save)i.save().catch((t=>{this.ready(),webix.alert({title:s("Alert"),text:s(this.labels.renameErrorMessage,e.old)}),this.AB.notify.developer(t,{context:"ui_common_list:onAfterEditStop():Error saving item.",id:i.id,value:e.value})})).then((()=>{this.ready()}));else if(0==i.id.indexOf("copy_")){i.name=i.label;var n=i.id;delete i.id,this.emit("copied",{item:i,currID:n})}}}onBeforeEditStop(e){var t=this.$list.getSelectedItem(!1);return t.label=e.value,!t.isValid||!t.isValid().fail()||(t.label=e.old,!1)}onSelectItem(e){var t=this.$list.getItem(e);this.emit("selected",t),this.showGear(e)}save(){this._initialized&&this.AB.Storage.set(this.idBase,this._settings)}selectItem(e){this.$list.blockEvent(),this.select(e),this.$list.unblockEvent()}showGear(e){let t=this.$list.getItemNode(e);if(t){let e=t.querySelector(".ab-object-list-edit");e&&(e.style.visibility="visible",e.style.display="block")}}templateListItem(e,t){if(!this.cacheTemplate[e.id]){e.warningsEval?.();var i=e.warningsAll();if("string"==typeof this._templateListItem){var n="";i.length>0&&(n=this.WARNING_ICON),this.cacheTemplate[e.id]=this._templateListItem.replace("#label#",e.label||"??label??").replace("{common.iconGear}",t.iconGear(e)).replace("#warnings#",n)}else this.cacheTemplate[e.id]=this._templateListItem(e,t,i);setTimeout((()=>{delete this.cacheTemplate[e.id]}),400)}return this.cacheTemplate[e.id]}toolTipListItem(e){let t=$$(this.ids.list).data.getItem(e.id).warningsAll().length;return t?`${t} issues`:""}clickAddNew(e){this.emit("addNew",e)}exclude(){var e=this.$list.getSelectedItem(!1);this.emit("exclude",e)}rename(){var e=this.$list.getSelectedId(!1);this.$list.edit(e)}remove(){var e=this.$list.getSelectedItem(!1);webix.confirm({title:s(this.labels.confirmDeleteTitle),text:s(this.labels.confirmDeleteMessage,[e.label]),ok:s("Yes"),cancel:s("No"),callback:async t=>{if(t){this.busy();try{await e.destroy(),this.ready(),this.itemList.remove(e.id),this.emit("deleted",e),this.emit("selected",null)}catch(e){this.AB.notify.developer(e,{context:"ui_common_list:remove(): error removing item"}),this.ready()}}}})}select(e){this.$list.select(e)}callbackProcessEditorMenu(e){switch(e){case"rename":this.rename();break;case"exclude":this.exclude();break;case"delete":this.remove()}}}return new a(t)}var h=i(2770),d=i.n(h),u=i(4009),p=i.n(u);const f=["NETSUITE_CONSUMER_KEY","NETSUITE_CONSUMER_SECRET","NETSUITE_TOKEN_KEY","NETSUITE_TOKEN_SECRET"],m=["NETSUITE_REALM","NETSUITE_BASE_URL","NETSUITE_QUERY_BASE_URL"],g=f.concat(m);function b(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject",{tab:""}),this.selectNew=!0,this.BlankTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_blank",{form:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Create"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_object_list_newObject_blank_name")}}},{name:"isSystemObject",view:"checkbox",labelRight:i("is this a System Object?"),labelWidth:0,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_object_list_newObject_blank_isSystemObj")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Object"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){t.CYPRESS_REF(this)}}}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear()}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}save(){var e=$$(this.ids.buttonSave);e.disable();var t=this.$form;if(t.clearValidation(),!t.validate())return e.enable(),!1;var i=t.getValues();i.primaryColumnName="uuid",this.emit("save",i)}show(){$$(this.ids.component)?.show()}}}(e),this.CsvTab=function(e){const t=(0,n.Z)(e);var i=t.L();let s=e.Config.uiSettings();return new class extends t{constructor(){super("ui_work_object_list_newObject_csv",{form:"",uploadFileList:"",separatedBy:"",headerOnFirstLine:"",columnList:"",importButton:""}),this._csvImporter=new(d())(e)}ui(){let e=this.ids;return{id:e.component,header:i("Import CSV"),body:{view:"form",id:e.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:s.labelWidthMedium},{view:"uploader",name:"csvFile",value:i("Choose a CSV file"),accept:"text/csv",multiple:!1,autosend:!1,link:e.uploadFileList,on:{onBeforeFileAdd:e=>this.loadCsvFile(e)}},{id:e.uploadFileList,name:"uploadedFile",view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(e,t)=>{this.removeCsvFile(t)}}},{id:e.separatedBy,view:"richselect",name:"separatedBy",label:i("Separated by"),labelWidth:s.labelWidthXLarge,options:this._csvImporter.getSeparateItems(),value:",",on:{onChange:()=>{this.populateColumnList()}}},{id:e.headerOnFirstLine,view:"checkbox",name:"headerOnFirstLine",labelRight:i("Header on first line"),labelWidth:0,disabled:!0,value:!0,on:{onChange:()=>{this.populateColumnList()}}},{type:"space",rows:[{view:"scrollview",height:260,minHeight:260,maxHeight:260,body:{id:e.columnList,disabled:!0,rows:[]}}]},{margin:5,cols:[{fillspace:!0},{view:"button",name:"cancel",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()}},{view:"button",name:"import",id:e.importButton,value:i("Import"),css:"webix_primary",disabled:!0,autowidth:!0,type:"form",click:()=>{this.import()}}]}]}}}async init(e){return this.AB=e,this.allFields=this.AB.Class.ABFieldManager.allFields(),this._dataRows=[],this.$form=$$(this.ids.form),this.$uploadFileList=$$(this.ids.uploadFileList),this.$separatedBy=$$(this.ids.separatedBy),this.$headerOnFirstLine=$$(this.ids.headerOnFirstLine),this.$columnList=$$(this.ids.columnList),this.$importButton=$$(this.ids.importButton),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}async loadCsvFile(e){if(!this._csvImporter.validateFile(e))return webix.alert({title:i("This file extension is not allowed"),text:i("Please only upload CSV files"),ok:i("OK")}),!1;this.$form.showProgress&&this.$form.showProgress({type:"icon"});let t=this.$separatedBy.getValue();return this._dataRows=await this._csvImporter.getDataRows(e,t),this.$headerOnFirstLine.enable(),this.$columnList.enable(),this.$importButton.enable(),this.populateColumnList(),this.$form.hideProgress&&this.$form.hideProgress(),!0}removeCsvFile(e){return this.$uploadFileList.remove(e),this.formClear(),!0}populateColumnList(){webix.ui([],this.$columnList);var e=this._dataRows[0];if(null==e)return;var t=[];if(this.$headerOnFirstLine.getValue())t=e.map(((e,t)=>({include:!0,columnName:e,dataType:this._csvImporter.getGuessDataType(this._dataRows,t)})));else for(var i=0;i<e.length;i++)t.push({include:!0,columnName:"Field "+(i+1),dataType:this._csvImporter.getGuessDataType(this._dataRows,i)});let n=[];t.forEach((e=>{n.push({height:40,cols:[{view:"checkbox",value:e.include,width:30},{view:"text",value:e.columnName,width:s.labelWidthXLarge},{view:"select",value:e.dataType,options:[{id:"string",value:this.allFields.filter((e=>"string"==e.key))[0].defaults().menuName},{id:"LongText",value:this.allFields.filter((e=>"LongText"==e.key))[0].defaults().menuName},{id:"number",value:this.allFields.filter((e=>"number"==e.key))[0].defaults().menuName},{id:"date",value:this.allFields.filter((e=>"date"==e.key))[0].defaults().menuName},{id:"boolean",value:this.allFields.filter((e=>"boolean"==e.key))[0].defaults().menuName}],width:120}]})})),webix.ui(n,$$(this.$columnList))}import(){if(this.$importButton.disable(),!this.$form.validate())return this.$importButton.enable(),!1;let e=$$(this.$columnList).getChildViews();if(e.filter((e=>e.queryView({view:"checkbox"}).getValue()&&0==e.queryView({view:"text"}).getValue().trim().length)).length>0)return webix.alert({title:i("Column name is required"),text:i("Please enter column name"),ok:i("OK")}),this.$importButton.enable(),!1;if(e.filter((e=>e.queryView({view:"checkbox"}).getValue()&&this.allFields[0].reservedNames.indexOf(e.queryView({view:"text"}).getValue().trim().toLowerCase())>-1)).length>0)return webix.alert({title:i("Column name is invalid"),text:i("Please enter column name that does not match [{0}]",this.allFields[0].reservedNames.join(", ")),ok:i("OK")}),this.$importButton.enable(),!1;let t={primaryColumnName:"uuid",name:this.$form.getValues().name};this.emit("save",t)}onSuccess(t){let i=Promise.resolve();$$(this.$columnList).getChildViews().forEach(((e,n)=>{if(!e.queryView({view:"checkbox"}).getValue())return;let s=e.queryView({view:"text"}).getValue(),o=e.queryView({view:"select"}).getValue(),a={columnName:s,label:s,key:o,settings:{showIcon:1,weight:n}};switch(o){case"string":case"LongText":a.settings.supportMultilingual=0}let r=t.fieldNew(a);i=i.then((()=>r.save()))}));var n=t.model();return this._dataRows.forEach(((e,s)=>{i=i.then((()=>{if(this.$headerOnFirstLine.getValue()&&0==s)return Promise.resolve();var i={},o=e;return t.fields().forEach((e=>{null!=o[e.settings.weight]&&(i[e.columnName]=o[e.settings.weight])})),n.create(i)}))})),i.then((()=>(this.formClear(),this.$importButton.enable(),Promise.resolve()))).catch((t=>{e.notify.developer(t,{message:"Error import data rows from CSV"})}))}onError(e){e&&(e.updateForm&&e.updateForm(this.$form),this.$importButton.enable())}cancel(){this.formClear(),this.emit("cancel")}formClear(){this._dataRows=[],this.$form.clearValidation(),this.$form.clear(),this.$separatedBy.setValue(","),webix.ui([],$$(this.$columnList)),this.$uploadFileList.clearAll(),this.$headerOnFirstLine.disable(),this.$columnList.disable(),this.$importButton.disable()}}}(e),this.ApiTab=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_api",{form:"",buttonSave:"",buttonCancel:""}),this.API_Read=function(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_api_read_request",{requestPanel:"",requestForm:"",tabBasic:"",tabHeaders:"",tabPaging:"",tabSecret:"",pagingType:"",pagingStart:"",pagingLimit:"",pagingTotal:"",headers:"",secrets:""})}ui(){const t=this.ids,n=e.UISettings.config();return{id:t.requestPanel,header:i("Request"),body:{id:t.requestForm,view:"form",autoheight:!1,padding:0,elements:[{view:"layout",borderless:!0,margin:0,cols:[{view:"sidebar",data:[{id:t.tabBasic,value:i("Basic")},{id:t.tabHeaders,value:i("Header")},{id:t.tabPaging,value:i("Paging")},{id:t.tabSecret,value:i("Secret")}],width:120,select:!0,scroll:!1,on:{onAfterSelect:function(t){e.Webix.$$(t).show()}},ready:function(){this.select(this.getFirstId())}},{view:"multiview",animate:!1,cells:[{id:t.tabBasic,view:"layout",padding:10,rows:[{label:i("Verb"),name:"verb",options:["GET"],view:"select",disabled:!0},{view:"text",label:i("URI"),name:"url",placeholder:"https://example.com",type:"url",required:!0,on:{onChange:()=>{this._data.returnData=null}}},{fillspace:!0}]},{id:t.tabHeaders,view:"layout",padding:10,rows:[{padding:0,cols:[{label:i("Headers"),view:"label",padding:0,height:0},{icon:"wxi-plus",view:"icon",padding:0,width:38,click:()=>{this._addHeaderItem($$(this.ids.headers))}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:t.headers,view:"layout",padding:0,margin:0,rows:[]}}]},{id:t.tabPaging,view:"layout",padding:10,rows:[{id:t.pagingType,view:"richselect",label:i("Type"),value:"QueryString",labelWidth:n.labelWidthMedium,options:[{id:"QueryString",value:i("Query String")},{id:"Header",value:i("Headers")}]},{id:t.pagingStart,view:"text",label:i("Start"),labelWidth:n.labelWidthMedium,placeholder:i("Property name of the API for start index")},{id:t.pagingLimit,view:"text",label:i("Limit"),labelWidth:n.labelWidthMedium,placeholder:i("Property name of the API for limit return the item number")},{id:t.pagingTotal,view:"text",label:i("Total"),labelWidth:n.labelWidthMedium,placeholder:i("Property name of the API that returns the total value")},{fillspace:!0}]},{id:t.tabSecret,view:"layout",padding:10,rows:[{padding:0,cols:[{label:i("Secrets"),view:"label",padding:0,height:0},{icon:"wxi-plus",view:"icon",padding:0,width:38,click:()=>{this._addHeaderItem($$(this.ids.secrets))}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:t.secrets,view:"layout",padding:0,margin:0,rows:[]}}]}]}]}]}}}init(e,t){const i=this.ids,n=$$(i.requestForm);e.Webix.extend(n,webix.ProgressBar),this._data=t}getValues(){const e=this.ids,t=$$(e.requestForm).getValues()??{};t.paging={type:$$(e.pagingType).getValue(),start:$$(e.pagingStart).getValue(),limit:$$(e.pagingLimit).getValue(),total:$$(e.pagingTotal).getValue()};const i=$$(e.headers);return t.headers=t.headers??[],i?.getChildViews().forEach((e=>{const i=e.getChildViews()[0],n=e.getChildViews()[1],s=i.getValue(),o=n.getValue();null!=s&&null!=o&&t.headers.push({key:s,value:o})})),t.secrets=this._getSecretValues(),t}validate(){return $$(this.ids.requestForm).validate()}formClear(){const e=this.ids,t=$$(e.requestForm),i=$$(e.headers),n=$$(e.secrets);t.clearValidation(),t.clear(),this.AB.Webix.ui([],i),this.AB.Webix.ui([],n)}busy(){$$(this.ids.requestForm).showProgress({type:"icon"})}ready(){$$(this.ids.requestForm).hideProgress()}_getSecretValues(){const e=[];return $$(this.ids.secrets)?.getChildViews().forEach((t=>{const i=t.getChildViews()[0],n=t.getChildViews()[1],s=i.getValue(),o=n.getValue();null!=s&&null!=o&&e.push({name:s,value:o})})),e}_addHeaderItem(e){const t=this._headerItem(e);e.addView(t)}_headerItem(e,t,i){return{cols:[{placeholder:"key",view:"text",value:t},{placeholder:"value",view:"text",suggest:this._getSecretValues().map((e=>`SECRET:${e.name}`)),value:i},{icon:"wxi-trash",view:"icon",width:38,click:function(){const t=this.getParentView();e.removeView(t)}}]}}}}(e),s=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_api_read_response",{responsePanel:"",responseForm:"",tabBasic:"",tabFields:"",headers:"",dataKey:"",fields:""})}ui(){const t=this.ids;return{id:t.responsePanel,header:i("Response"),collapsed:!0,body:{id:t.responseForm,view:"form",autoheight:!1,padding:0,elements:[{view:"layout",borderless:!0,margin:0,cols:[{view:"sidebar",data:[{id:t.tabBasic,value:i("Basic")},{id:t.tabFields,value:i("Fields")}],width:120,select:!0,scroll:!1,on:{onAfterSelect:function(t){e.Webix.$$(t).show()}},ready:function(){this.select(this.getFirstId())}},{view:"multiview",animate:!1,cells:[{id:t.tabBasic,view:"layout",padding:10,rows:[{id:t.dataKey,view:"text",label:i("Data Key"),placeholder:"data.example",bottomLabel:i("* JSON key containing the relevant data from the response object. Can be left blank to use the root level data."),suggest:[],on:{onChange:()=>{this._guessFields()}}},{fillspace:!0}]},{id:t.tabFields,view:"layout",padding:10,rows:[{cols:[{label:i("Fields"),view:"label"},{icon:"wxi-plus",view:"icon",width:38,click:()=>{this._addFieldItem()}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:t.fields,view:"layout",padding:0,margin:0,rows:[]}}]}]}]}]}}}init(e,t){const i=this.ids,n=$$(i.responseForm);e.Webix.extend(n,webix.ProgressBar),this._data=t}getValues(){const e=this.ids,t={dataKey:$$(e.dataKey).getValue()},i=$$(e.fields);return t.fields=[],i?.getChildViews().forEach((e=>{const i=e.getChildViews()[0],n=e.getChildViews()[1];t.fields.push({columnName:i.getValue(),type:n.getValue()})})),t.fields=t.fields.filter((e=>null!=e.columnName&&null!=e.type)),t}validate(){return $$(this.ids.responseForm).validate()}formClear(){const e=this.ids,t=$$(e.responseForm);t.clearValidation(),t.clear(),this._clearDataKeys(),this._clearFieldItems()}busy(){$$(this.ids.responseForm).showProgress({type:"icon"})}ready(){$$(this.ids.responseForm).hideProgress()}async refreshResponse(t){if(!t?.url||this._data?.returnData)return;this.busy();const i=e.objectNew({id:e.uuid(),isAPI:!0,request:t}).model(),n=await i.findAll();this._data.returnData=n?.data,this._populateDataKeys(),this._guessFields(),this.ready()}_fieldItem(e,t){const i=this,n=this.AB.Class.ABFieldManager.allFields();return{cols:[{placeholder:"key",view:"text",value:e},{placeholder:"Type",options:["string","LongText","number","date","boolean"].map((e=>({id:e,value:n.filter((t=>t.defaults().key==e))[0]?.defaults().menuName}))),view:"select",value:t},{icon:"wxi-trash",view:"icon",width:38,click:function(){const e=this.getParentView();$$(i.ids.fields).removeView(e)}}]}}_addFieldItem(e,t){const i=this._fieldItem(e,t);$$(this.ids.connections).addView(i)}_clearFieldItems(){const t=$$(this.ids.connections);e.Webix.ui([],t)}_populateDataKeys(){if(this._clearDataKeys(),!this._data?.returnData)return;const e=$$(this.ids.dataKey),t=$$(e.config.suggest).getList(),i=[],n=(e,t)=>{let s=e;Array.isArray(e)&&e[0]&&(s=e[0]),Object.keys(s??{}).forEach((e=>{const o=t.length?`${t}.${e}`:e;Array.isArray(s[e])?i.push(o):"object"==typeof s[e]&&n(s[e],o)}))};n(this._data?.returnData,""),t.parse(i)}_clearDataKeys(){const e=$$(this.ids.dataKey),t=$$(e.config.suggest).getList();e.setValue(""),t.clearAll()}_guessFields(){if(this._clearFieldItems(),!this._data?.returnData)return;const t=this.getValues();let i=e.objectNew(Object.assign({isAPI:!0},{response:t})).dataFromKey(this._data?.returnData);if(null!=i){for(;i&&Array.isArray(i);)i=i[0];Object.keys(i).forEach((e=>{if("object"==typeof i[e]||Array.isArray(i[e]))return;const t=p().getFieldType(i[e]);this._addFieldItem(e,t)}))}}}}(e);return new class extends t{constructor(){super("ui_work_object_list_newObject_api_read",{})}ui(){const e=s.ui();return{view:"accordion",type:"clean",multi:!1,on:{onAfterExpand:t=>{if(e.id==t){const e=i.getValues();s.refreshResponse(e)}}},rows:[i.ui(),e]}}init(e){this._shareData={},i.init(e,this._shareData),s.init(e,this._shareData)}getValues(){return{request:i.getValues(),response:s.getValues()}}validate(){return i.validate()&&s.validate()}formClear(){i.formClear(),s.formClear()}busy(){i.busy(),s.busy()}ready(){i.ready(),s.ready()}}}(e)}ui(){return{id:this.ids.component,header:i("API"),body:{view:"form",id:this.ids.form,width:800,height:500,rules:{},elements:[{rows:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:70},{view:"checkbox",label:i("Read Only"),name:"readonly",value:1,disabled:!0}]},{view:"tabview",name:"apiType",tabbar:{options:[{value:"Create",disabled:!0},"Read",{value:"Update",disabled:!0},{value:"Delete",disabled:!0}],value:"Read",height:40},cells:[this.API_Read.ui()]},{cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Save"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),e.Webix.extend(this.$form,webix.ProgressBar),this.API_Read.init(e),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(async e=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear(),this.API_Read.formClear()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}async save(){this.busy();const t=this.$form;if(t.clearValidation(),!t.validate()||!this.API_Read.validate())return this.ready(),!1;let i=t.getValues();const n=this.API_Read.getValues();n.secrets=n?.request?.secrets??[],delete n?.request?.secrets,i=Object.assign(i,n);const s=e.objectNew(Object.assign({isAPI:!0},i));try{i.fieldIDs=[];for(const t of i.response?.fields??[]){const n=e.fieldNew({name:t.columnName,label:t.columnName,columnName:t.columnName,key:t.type},s);await n.save(!0),i.fieldIDs.push(n.id)}i.id=s.id,this.emit("save",s.toObj()),this.ready()}catch(e){console.error(e)}}show(){$$(this.ids.component)?.show()}busy(){const e=$$(this.ids.form),t=$$(this.ids.buttonSave);e.showProgress({type:"icon"}),t.disable()}ready(){const e=$$(this.ids.form),t=$$(this.ids.buttonSave);e.hideProgress(),t.enable()}}}(e),this.ImportTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_import",{form:"",filter:"",objectList:"",columnList:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Existing"),body:{view:"form",id:this.ids.form,width:400,elements:[{cols:[{view:"icon",icon:"fa fa-filter",align:"left"},{view:"text",id:this.ids.filter,on:{onTimedKeyPress:()=>this.filter()}}]},{view:"list",id:this.ids.objectList,select:!0,height:200,minHeight:250,maxHeight:250,data:[],template:"<div>#label#</div>",on:{onSelectChange:()=>this.objectSelect()}},{view:"label",label:`<b>${i("Columns")}</b>`,height:20},{view:"list",id:this.ids.columnList,datatype:"json",multiselect:!1,select:!1,height:200,minHeight:200,maxHeight:200,type:{height:40,isvisible:{view:"checkbox",width:30}},template:e=>`\n                               <span style="float: left;"><i class="fa fa-${e.icon}"></i></span>\n                               <span style="float: left;">&nbsp;${e.label}</span>\n                           `},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>this.cancel()},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Import"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$filter=$$(this.ids.filter),this.$objectList=$$(this.ids.objectList),this.$columnList=$$(this.ids.columnList),this.$buttonSave=$$(this.ids.buttonSave),this.$buttonCancel=$$(this.ids.buttonCancel),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}onShow(){this.formClear();let t=this.CurrentApplication.objectsExcluded((t=>!t.isSystemObject||e.Account.isSystemDesigner()));this.$objectList.parse(t,"json")}filter(){let e=this.$filter.getValue();this.$objectList.filter("#label#",e)}objectSelect(){this.$columnList.clearAll();let e=this.$objectList.getSelectedItem(!1);if(e){let t=[];e.fields().forEach((e=>{t.push({id:e.id,label:e.label,isvisible:!0,icon:e.icon})})),0==t.length&&t.push({id:"none",label:i("No Fields Defined"),isvisible:!0}),this.$columnList.parse(t)}}async save(){var e=this.$objectList.getSelectedItem();if(!e)return!1;this.$buttonSave.disable(),await this.CurrentApplication.objectInsert(e),this.emit("imported",e),this.$buttonSave.enable()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear(),this.$objectList.clearAll(),this.$columnList.clearAll()}onError(e){if(e){var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.$buttonSave.enable()}}}(e),this.NetsuiteTab=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_netsuite",{form:"",buttonSave:"",buttonCancel:""}),this.UI_Credentials=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_netsuite_credentials",{form:"",buttonVerify:"",labelVerified:""}),this.entries={}}ui(){let e={id:this.ids.component,header:i("Credentials"),body:{view:"form",id:this.ids.form,width:820,height:700,rules:{},elements:[{rows:[]},{cols:[{fillspace:!0},{view:"button",id:this.ids.buttonVerify,css:"webix_primary",value:i("Verify"),autowidth:!0,type:"form",click:()=>this.verify()}]},{cols:[{fillspace:!0},{id:this.ids.labelVerified,view:"label",label:i("All parameters are valid. Continue on to select a Table to work with."),hidden:!0}]}]}},t=e.body.elements[0].rows,n={view:"fieldset",label:i("Netsuite OAuth 1.0 Credentials"),body:{rows:[]}},s=e=>({cols:[{id:e,view:"text",label:e,name:e,required:!0,placeholder:`ENV:${e}`,value:`ENV:${e}`,labelWidth:230,on:{onChange:(t,i)=>{this.envVerify(e,t)}}},{id:`${e}_verified`,view:"label",width:20,label:'<i class="fa-solid fa-check"></i>',hidden:!0}]});f.forEach((e=>{n.body.rows.push(s(e))})),t.push(n),t.push({height:15});let o={view:"fieldset",label:i("Netsuite API Config"),body:{rows:[]}};return m.forEach((e=>{o.body.rows.push(s(e))})),t.push(o),e}async init(e){return this.AB=e,this.$form=$$(this.ids.form),e.Webix.extend(this.$form,webix.ProgressBar),Promise.resolve()}formClear(){this.$form.clearValidation(),this.$form.clear(),g.forEach((e=>{$$(e).setValue(`ENV:${e}`)}))}getValues(){return this.credentials()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonVerify).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonVerify).enable()}show(){$$(this.ids.component)?.show(),console.log("SHOW, Baby!  SHOW!")}busy(){const e=$$(this.ids.form),t=$$(this.ids.buttonVerify);e.showProgress({type:"icon"}),t.disable()}credentials(){let e={};return g.forEach((t=>{let i=$$(t);i&&(e[t]=i.getValue())})),e}envVerify(e,t){let i=t.replace("ENV:","");return this.AB.Network.get({url:`/env/verify/${i}`}).then((t=>{console.log(t),"success"==t.status?($$(`${e}_verified`).show(),this.entries[e]=!0):($$(`${e}_verified`).hide(),this.entries[e]=!1)})).catch((t=>{console.error(t),$$(`${e}_verified`).hide(),this.entries[e]=!1}))}ready(){const e=$$(this.ids.form),t=$$(this.ids.buttonVerify);e.hideProgress(),t.enable()}async verify(){let e=!0,t=[];g.forEach((e=>{let i=$$(e).getValue();t.push(this.envVerify(e,i))})),await Promise.all(t),g.forEach((t=>{e=e&&this.entries[t]})),e?(this.emit("verified"),$$(this.ids.labelVerified)?.show()):(this.emit("notverified"),$$(this.ids.labelVerified)?.hide())}}}(e),this.UI_Tables=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_netsuite_tables",{form:"",searchText:"",tableList:"",fields:"",buttonVerify:"",buttonLookup:""}),this.credentials={},this.lastSelectedTable=null}ui(){return{id:this.ids.component,header:i("Tables"),body:{view:"form",id:this.ids.form,width:800,height:700,rules:{},elements:[{cols:[{rows:[{cols:[{view:"label",align:"left",label:i("Use the provided credentials to request a list of tables to work with.")},{view:"button",id:this.ids.buttonLookup,value:i("Load Catalog"),autowidth:!0,click:()=>{this.loadCatalog()}}]},{id:this.ids.searchText,view:"search",icon:"fa fa-search",label:i("Search"),labelWidth:80,placeholder:i("tablename"),height:35,keyPressTimeout:100,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)},onTimedKeyPress:()=>{let e=$$(this.ids.searchText).getValue().toLowerCase();this.$list.filter((function(t){return!t.value||t.value.toLowerCase().indexOf(e)>-1}))}}},{id:this.ids.tableList,view:"list",select:1,height:400,on:{onItemClick:(e,t)=>{e!=this.lastSelectedTable&&(this.lastSelectedTable=e,this.emit("table.selected",e))}}}]},{rows:[{},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-database'></div>"},{view:"label",align:"center",label:i("Select an table to work with.")},{}]}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$list=$$(this.ids.tableList),e.Webix.extend(this.$form,webix.ProgressBar),e.Webix.extend(this.$list,webix.ProgressBar),Promise.resolve()}disable(){$$(this.ids.form).disable()}enable(){$$(this.ids.form).enable()}formClear(){this.$form.clearValidation(),this.$form.clear(),$$(this.ids.searchText).setValue(""),this.$list.filter((()=>!0)),this.lastSelectedTable=null}getValues(){return this.lastSelectedTable}async loadCatalog(){this.busy();let e=await this.AB.Network.get({url:"/netsuite/metadata",params:{credentials:JSON.stringify(this.credentials)}}),t=[];e.forEach((e=>{t.push({id:e,value:e})}));let i=$$(this.ids.tableList);i.clearAll(),i.parse(t),this.emit("tables",t)}_fieldItem(e){const t=this,i=this.AB.Class.ABFieldManager.allFields();let n=e.column||e.title,s=e.type;return{cols:[{view:"text",value:n,placeholder:"key"},{placeholder:"Type",options:["string","LongText","number","date","boolean"].map((e=>({id:e,value:i.filter((t=>t.defaults().key==e))[0]?.defaults().menuName}))),view:"select",value:s},{icon:"wxi-trash",view:"icon",width:38,click:function(){const e=this.getParentView();$$(t.ids.fields).removeView(e)}}]}}async loadFields(e){this.busyFields();let t=await this.AB.Network.get({url:`/netsuite/table/${e}`,params:{credentials:JSON.stringify(this.credentials)}});this.fieldList=t,(t||[]).forEach((e=>{const t=this._fieldItem(e);$$(this.ids.fields).addView(t)})),this.readyFields()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonVerify).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonVerify).enable()}show(){$$(this.ids.component)?.show()}busy(){$$(this.ids.tableList).showProgress({type:"icon"})}ready(){$$(this.ids.form).hideProgress()}setCredentials(e){this.credentials=e}}}(e),this.UI_Fields=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_netsuite_fields",{form:"",tableName:"",fieldSelector:"",fieldGrid:"",buttonVerify:""}),this.credentials={},this.fieldKeys=["string","LongText","number","date","datetime","boolean","json","list"],this.fieldList=null,this.fields=null}ui(){return{id:this.ids.component,header:i("Fields"),body:{view:"form",id:this.ids.form,width:800,height:450,rules:{},elements:[{id:this.ids.fieldSelector,view:"layout",padding:10,rows:[{rows:[{id:this.ids.tableName,label:i("Selected Table: {0}",[this.table]),view:"label",height:40},{}]},{id:this.ids.fieldGrid,view:"datatable",resizeColumn:!0,height:300,columns:[{id:"title",header:i("title"),editor:"text"},{id:"column",header:i("column")},{id:"nullable",header:i("nullable")},{id:"readOnly",header:i("read only")},{id:"default",header:i("Default Value"),editor:"text"},{id:"pk",header:i("is primary key"),template:"{common.radio()}"},{id:"created_at",header:i("Created At"),template:"{common.radio()}"},{id:"updated_at",header:i("Updated At"),template:"{common.radio()}"},{id:"abType",header:i("AB Field Type"),editor:"select",options:[" "].concat(this.fieldKeys),on:{onChange:(e,t)=>{}}},{id:"delme",header:"",template:"{common.trashIcon()}"}],editable:!0,scroll:"xy",onClick:{"wxi-trash":(e,t)=>{$$(this.ids.fieldGrid).remove(t),this.fields=this.fields.filter((e=>e.id!=t.row))}}},{cols:[{fillspace:!0},{view:"button",id:this.ids.buttonVerify,css:"webix_primary",value:i("Verify"),autowidth:!0,type:"form",click:()=>this.verify()}]}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$fieldSelector=$$(this.ids.fieldSelector),e.Webix.extend(this.$form,webix.ProgressBar),e.Webix.extend(this.$fieldSelector,webix.ProgressBar),Promise.resolve()}disable(){$$(this.ids.form).disable()}enable(){$$(this.ids.form).enable()}formClear(){this.$form.clearValidation(),this.$form.clear(),$$(this.ids.fieldGrid)?.clearAll(),this.disable(),$$(this.ids.buttonVerify).disable()}addABType(e){switch(e.type){case"array":e.abType="json";break;case"object":e.abType="connectObject";break;case"boolean":e.abType="boolean";break;default:e.abType="string"}if("string"==e.abType){let t=e.title?.toLowerCase();if(t){let i=t.indexOf("date")>-1,n=t.indexOf("day")>-1;(i||n)&&(e.abType="date")}"date-time"==e.format&&(e.abType="datetime")}"Internal ID"==e.title&&(e.pk=!0)}getValues(){return this.fields}setTableName(){$$(this.ids.tableName).setValue(`<span style="font-size: 1.5em; font-weight:bold">${this.table}</span>`)}async loadFields(e){$$(this.ids.fieldGrid)?.clearAll(),this.table=e,$$(this.ids.fieldSelector).show(),this.busy(),this.setTableName();let t=await this.AB.Network.get({url:`/netsuite/table/${e}`,params:{credentials:JSON.stringify(this.credentials)}});this.fieldList=t,(t||[]).forEach((e=>{this.addABType(e)})),this.fields=t.filter((e=>"object"!=e.type)),this.emit("connections",t.filter((e=>"object"==e.type))),$$(this.ids.fieldGrid).parse(this.fields),this.ready()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonVerify).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonVerify).enable()}show(){$$(this.ids.component)?.show()}busy(){const e=$$(this.ids.buttonVerify);this.$fieldSelector.showProgress({type:"icon"}),e.disable()}ready(){const e=$$(this.ids.buttonVerify);this.$fieldSelector.hideProgress(),e.enable()}setCredentials(e){this.credentials=e}verify(){this.emit("fields.ready",{credentials:this.credentials,table:this.table,fieldList:this.fields})}}}(e),this.UI_FieldTest=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_object_list_newObject_netsuite_dataTest",{form:"",network:"",dataView:"",buttonVerify:"",tableName:""}),this.credentials={},this.fieldKeys=["string","LongText","number","date","boolean","json","list"],this.fieldList=null,this.table=null}ui(){return{id:this.ids.component,header:i("Data Verification"),body:{view:"form",id:this.ids.form,width:800,height:400,rules:{},elements:[{view:"layout",padding:10,rows:[{cols:[{id:this.ids.tableName,label:i("Selected Table: {0}",[this.table]),view:"label",height:40},{}]},{view:"multiview",cells:[{id:this.ids.network,rows:[{},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-database'></div>"},{view:"label",align:"center",label:i("Gathering data from Netsuite.")},{}]},{id:this.ids.dataView,rows:[{},{view:"label",label:"Waiting for response"},{}]}]}]},{cols:[{fillspace:!0},{view:"button",id:this.ids.buttonVerify,css:"webix_primary",value:i("Verify"),autowidth:!0,type:"form",click:()=>this.verify()}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),e.Webix.extend(this.$form,webix.ProgressBar),Promise.resolve()}disable(){$$(this.ids.form).disable()}enable(){$$(this.ids.form).enable()}formClear(){this.$form.clearValidation(),this.$form.clear();let e={id:this.ids.dataView,rows:[{},{view:"label",label:"Waiting for response"},{}]};webix.ui(e,$$(this.ids.dataView)),this.disable()}setTableName(){$$(this.ids.tableName).setValue(`<span style="font-size: 1.5em; font-weight:bold">${this.table}</span>`)}setTable(e){this.table=e,this.setTableName(),this.formClear()}async loadConfig(e){this.credentials=e.credentials,this.setTable(e.table),this.fieldList=e.fieldList,$$(this.ids.network).show(),this.busy();let t=await this.AB.Network.get({url:`/netsuite/dataVerify/${this.table}`,params:{credentials:JSON.stringify(this.credentials)}});this.data=t,this.fieldList.filter((e=>"json"==e.abType)).forEach((e=>{this.data.forEach((t=>{try{t[e.column]=JSON.stringify(t[e.column])}catch(e){console.log(e)}}))})),this.showTable(),this.enable(),this.ready()}showTable(){let e={id:this.ids.dataView,view:"datatable",columns:this.fieldList.map((e=>({id:e.column,header:e.title}))),data:this.data};webix.ui(e,$$(this.ids.dataView)),$$(this.ids.dataView).show()}verify(){this.emit("data.verfied")}show(){$$(this.ids.component)?.show()}busy(){const e=$$(this.ids.buttonVerify);this.$form.showProgress({type:"icon"}),e.disable()}ready(){const e=$$(this.ids.buttonVerify);this.$form.hideProgress(),e.enable()}setCredentials(e){this.credentials=e}}}(e),this.UI_Connections=function(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return new class extends t{constructor(){super("ui_work_object_list_newObject_netsuite_connections",{form:"",connections:"",displayConnections:"",displayNoConnections:"",fieldGrid:"",buttonVerify:"",buttonLookup:"",tableName:""}),this.allTables=[],this.credentials={},this.connectionList=null,this.connections=null}ui(){return{id:this.ids.component,header:i("Connections"),body:{view:"form",id:this.ids.form,width:800,height:450,rules:{},elements:[{view:"layout",padding:10,rows:[{id:this.ids.tableName,label:i("Selected Table: {0}",[this.table]),view:"label",height:40}]},{view:"multiview",animate:!1,borderless:!0,rows:[{id:this.ids.displayNoConnections,rows:[{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-exclamation-triangle'></div>"},{view:"label",align:"center",label:i("You have no other Netwuite Objects imported")},{view:"label",align:"center",label:i("Continue creating this object now, then create the connections on the other objects you import.")},{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile}]},{id:this.ids.displayConnections,rows:[{view:"layout",padding:10,rows:[{cols:[{label:i("Connections"),view:"label"},{icon:"wxi-plus",view:"icon",width:38,click:()=>{this._addConnection()}}]},{view:"scrollview",scroll:"y",borderless:!0,padding:0,margin:0,body:{id:this.ids.connections,view:"layout",padding:0,margin:0,rows:[]}}]}]}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),e.Webix.extend(this.$form,webix.ProgressBar),Promise.resolve()}disable(){$$(this.ids.form).disable()}enable(){$$(this.ids.form).enable()}formClear(){this.$form.clearValidation(),this.$form.clear(),this.disable()}getValues(){return[]}setTable(e){this.table=e,$$(this.ids.tableName).setValue(`<span style="font-size: 1.5em; font-weight:bold">${this.table}</span>`)}loadConnections(e){this.connectionList=e,this.listNetsuiteObjects=this.AB.objects((e=>e.isNetsuite)),0==this.listNetsuiteObjects.length?$$(this.ids.displayNoConnections)?.show():$$(this.ids.displayConnections)?.show()}_fieldItem(e,t){const n=this,s=(this.AB.Class.ABFieldManager.allFields(),["one:one","one:many","many:one","many:many"].map((e=>({id:e,value:e}))));s.unshift({id:"_choose",value:i("choose link type")});let o=this.connectionList.map((e=>({id:e.column,value:e.column}))),a=[],r=this.listNetsuiteObjects.map((e=>({id:e.id,value:e.label})));return r.unshift({id:"_choose",value:i("Choose Object")}),{view:"form",elements:[{cols:[{rows:[{placeholder:i("Existing Netsuite Object"),options:r,view:"select",name:"thatObject",label:i("To:"),on:{onChange:async function(e,t,s){let o=n.AB.objectByID(e);if(o){let e=(await n.AB.Network.get({url:`/netsuite/table/${o.tableName}`,params:{credentials:JSON.stringify(n.credentials)}})).filter((e=>"object"==e.type)).map((e=>({id:e.column,value:e.column})));a=e;let t=this.getParentView().getParentView().getChildViews()[1].getChildViews()[0].getChildViews()[0].getChildViews()[1],s=[{id:"_choose",value:i("Choose")},{id:"_this_",value:i("This Object")}];s.push({id:o.id,value:o.label}),t.define("options",s),t.refresh()}}}},{placeholder:"Link Type",options:s,view:"select",name:"linkType",label:i("link type"),on:{onChange:async function(e,t,s){let r=this.getParentView().getChildViews()[0],l=this.getParentView().getChildViews()[1],c=r.getValue(),h=n.AB.objectByID(c),d=l.getValue(),u=d.split(":"),p=n.message(i("This object"),u[0],h.label),f=n.message(h.label,u[1],i("This object"));"_choose"==e&&(p=f="");let m=this.getParentView().getChildViews()[2],g=this.getParentView().getChildViews()[3];m.define("label",p),m.refresh(),g.define("label",f),g.refresh();let b,v=this.getParentView().getParentView().getChildViews()[1];switch(d){case"one:one":v.getChildViews()[0].show();break;case"one:many":b=v.getChildViews()[1].getChildViews()[0].getChildViews()[1],b.define("options",o),b.refresh(),v.getChildViews()[1].show();break;case"many:one":b=v.getChildViews()[1].getChildViews()[0].getChildViews()[1],b.define("options",a),b.refresh(),v.getChildViews()[1].show();break;case"many:many":v.getChildViews()[2].show()}}}},{view:"label"},{view:"label"}]},{rows:[{view:"fieldset",label:i("one to one"),hidden:!0,body:{rows:[{view:"label",label:i("which object holds the connection value?")},{view:"select",options:[{id:"_choose",value:i("Choose Object")},{id:"_this_",value:i("This Object")},{id:"_that_",value:i("That Object")}],name:"whichSource",on:{onChange:async function(e,t,i){if("_choose"==e)return;let n=this.getParentView().getChildViews()[2];"_this_"==e?n.define("options",o):n.define("options",a),n.refresh(),n.show()}}},{view:"select",label:i("which field"),name:"sourceField",options:[],hidden:!0}]}},{view:"fieldset",label:i("one:X"),hidden:!0,body:{rows:[{view:"label",label:i("which field defines the connection?")},{view:"select",name:"thatField",options:[]}]}},{view:"fieldset",label:i("many:many"),hidden:!0,body:{rows:[{view:"label",label:i("which table is the join table?")},{view:"combo",name:"joinTable",options:{filter:(e,t)=>e.value.toLowerCase().indexOf(t.toLowerCase())>-1,body:{data:this.allTables}},on:{onChange:async function(e,t,i){let s=await n.AB.Network.get({url:`/netsuite/table/${e}`,params:{credentials:JSON.stringify(n.credentials)}}),o=s.map((e=>({id:e.column,value:e.column}))),a=this.getParentView().getChildViews()[2];a.define("options",o),a.refresh(),a.show();let r=this.getParentView().getChildViews()[3];r.define("options",o),r.refresh(),r.show();let l=this.getParentView().getChildViews()[4];l.define("options",o);let c=s.find((e=>"Internal ID"==e.title));c&&l.setValue(c.column),l.refresh(),l.show();let h=this.getParentView().getChildViews()[5];h.define("options",o);let d=s.find((e=>!!e.column&&e.column.indexOf("entity")>-1));d&&h.setValue(d.column),h.refresh(),h.show();let u=n.AB.cloneDeep(o);u.unshift({id:"_none_",value:""});let p=this.getParentView().getChildViews()[6];p.define("options",u),p.refresh(),p.show()}}},{view:"select",label:i("This Object's reference"),labelPosition:"top",options:[],name:"thisObjReference",hidden:!0},{view:"select",label:i("That Object's reference"),labelPosition:"top",options:[],name:"thatObjReference",hidden:!0},{view:"select",label:i("Join Table Primary Key:"),labelPosition:"top",options:[],name:"joinTablePK",hidden:!0},{view:"select",label:i("Which field holds the Entity:"),labelPosition:"top",options:[],name:"joinTableEntity",hidden:!0},{view:"select",label:i("Join Table isActive Field:"),labelPosition:"top",options:[],name:"joinActiveField",hidden:!0,on:{onChange:async function(e,t,i){if("_none_"!=e){let e=this.getParentView().getChildViews();e[e.length-2].show(),e[e.length-1].show()}}}},{view:"text",label:i("Active Value"),name:"joinActiveValue",hidden:!0,value:""},{view:"text",label:i("InActive Value"),name:"joinInActiveValue",hidden:!0,value:""}]}}]},{rows:[{},{icon:"wxi-trash",view:"icon",width:38,click:function(){const e=this.getParentView().getParentView().getParentView();$$(n.ids.connections).removeView(e)}},{}]}]}]}}_addConnection(e,t){const i=this._fieldItem(e,t);$$(this.ids.connections).addView(i)}_clearFieldItems(){const t=$$(this.ids.connections);e.Webix.ui([],t)}message(e,t,n){let s;return s=i("many"==t?"{0} has many {1} entities":"{0} has one {1} entity",[e,n]),s}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonVerify).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonVerify).enable()}show(){$$(this.ids.component)?.show()}busy(){$$(this.ids.buttonVerify).disable()}ready(){$$(this.ids.buttonVerify).enable()}setCredentials(e){this.credentials=e}setAllTables(e){this.allTables=this.AB.cloneDeep(e),this.allTables.unshift({id:"_choose",value:i("Choose")})}getValues(){let e=[];return $$(this.ids.connections).getChildViews().forEach((t=>{e.push(t.getValues())})),e}}}(e)}ui(){return{id:this.ids.component,header:i("Netsuite"),body:{view:"form",id:this.ids.form,width:820,height:650,rules:{},elements:[{rows:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Object name"),labelWidth:70},{view:"checkbox",label:i("Read Only"),name:"readonly",value:0}]},{view:"tabview",cells:[this.UI_Credentials.ui(),this.UI_Tables.ui(),this.UI_Fields.ui(),this.UI_Connections.ui(),this.UI_FieldTest.ui()]},{fillspace:!0},{cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Save"),autowidth:!0,type:"form",click:()=>this.save(),disabled:!0}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),e.Webix.extend(this.$form,webix.ProgressBar),this.UI_Credentials.init(e),this.UI_Tables.init(e),this.UI_Fields.init(e),this.UI_Connections.init(e),this.UI_FieldTest.init(e),this.UI_Credentials.show(),this.UI_Tables.disable(),this.UI_Fields.disable(),this.UI_Connections.disable(),this.UI_FieldTest.disable(),this.UI_Credentials.on("verified",(()=>{this.UI_Tables.enable();let e=this.UI_Credentials.credentials();this.UI_Tables.setCredentials(e),this.UI_Fields.setCredentials(e),this.UI_FieldTest.setCredentials(e),this.UI_Connections.setCredentials(e),this.UI_Tables.show()})),this.UI_Credentials.on("notverified",(()=>{this.UI_Tables.disable()})),this.UI_Tables.on("tables",(e=>{this.UI_Connections.setAllTables(e)})),this.UI_Tables.on("table.selected",(e=>{this.UI_Fields.enable(),this.UI_Fields.loadFields(e),this.UI_Fields.show(),this.UI_Connections.setTable(e),this.UI_FieldTest.setTable(e)})),this.UI_Fields.on("connections",(e=>{this.UI_Connections.loadConnections(e),this.UI_Connections.enable()})),this.UI_Fields.on("fields.ready",(e=>{this.UI_FieldTest.enable(),this.UI_FieldTest.loadConfig(e)})),this.UI_FieldTest.on("data.verfied",(()=>{$$(this.ids.buttonSave).enable()})),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(async e=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear(),this.UI_Credentials.formClear(),this.UI_Tables.formClear(),this.UI_Fields.formClear(),this.UI_Connections.formClear(),this.UI_FieldTest.formClear(),$$(this.ids.buttonSave).disable()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;const n=this.$form.getValues();webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}async save(){this.busy();const t=this.$form;if(t.clearValidation(),!t.validate())return this.ready(),!1;let n=t.getValues();n.credentials=this.UI_Credentials.getValues(),n.tableName=this.UI_Tables.getValues();let s=this.UI_Fields.getValues(),o=s.find((e=>e.pk));if(!o)return void webix.alert({title:i("Error creating Object: {0}",[n.name]),ok:i("fix it"),text:i("No primary key specified."),type:"alert-error"});n.primaryColumnName=o.column,n.columnRef={created_at:null,updated_at:null},["created_at","updated_at"].forEach((e=>{let t=s.find((t=>t[e]));t&&(n.columnRef[e]=t.column)}));const a=e.objectNew(Object.assign({isNetsuite:!0},n));try{for(const t of s){let i={name:t.title,label:t.title,columnName:t.column,key:t.abType};t.default&&(i.settings={},i.settings.default=t.default);const n=e.fieldNew(i,a);await n.save(!0)}}catch(e){console.error(e)}let r=this.UI_Connections.getValues();for(var l=0;l<r.length;l++){let e=r[l],t=this.AB.objectByID(e.thatObject);if(!t)continue;let i=e.linkType,n=i.split(":"),s=n[0],o=n[1],c={key:"connectObject",label:t.label,settings:{showIcon:"1",linkObject:t.id,linkType:s,linkViaType:o,isCustomFK:0,indexField:"",indexField2:"",isSource:0,width:100}},h=this.AB.cloneDeep(c);switch(h.label=a.label||a.name,h.settings.linkObject=a.id,h.settings.linkType=o,h.settings.linkViaType=s,i){case"one:one":"_this_"==e.whichSource?c.settings.isSource=1:h.settings.isSource=1,c.columnName=e.sourceField,h.columnName=e.sourceField;break;case"one:many":case"many:one":c.columnName=e.thatField,h.columnName=e.thatField;break;case"many:many":c.settings.joinTable=e.joinTable,h.settings.joinTable=e.joinTable,c.settings.joinTableReference=e.thisObjReference,h.settings.joinTableReference=e.thatObjReference,c.settings.joinTablePK=e.joinTablePK,h.settings.joinTablePK=e.joinTablePK,c.settings.joinTableEntity=e.joinTableEntity,h.settings.joinTableEntity=e.joinTableEntity,"_none_"!=e.joinActiveField&&(c.settings.joinActiveField=e.joinActiveField,c.settings.joinActiveValue=e.joinActiveValue,c.settings.joinInActiveValue=e.joinInActiveValue,h.settings.joinActiveField=e.joinActiveField,h.settings.joinActiveValue=e.joinActiveValue,h.settings.joinInActiveValue=e.joinInActiveValue)}let d=t.fieldNew(h);await d.save(!0),c.settings.linkColumn=d.id;let u=a.fieldNew(c);await u.save(),d.settings.linkColumn=u.id,await d.save()}this.emit("save",a.toObj()),this.ready()}show(){$$(this.ids.component)?.show()}busy(){const e=$$(this.ids.form),t=$$(this.ids.buttonSave);e.showProgress({type:"icon"}),t.disable()}ready(){const e=$$(this.ids.form),t=$$(this.ids.buttonSave);e.hideProgress(),t.enable()}}}(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new object"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},selectNewObject:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui(),this.CsvTab.ui(),this.ApiTab.ui(),this.ImportTab.ui(),this.NetsuiteTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((e=>{var i=e.getAttribute("button_id");t.CYPRESS_REF(e,`${i}_tab`)}))}}}},on:{onBeforeShow:()=>{var e=$$(this.ids.tab).getValue();this.switchTab(e)}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);var t=[];return["BlankTab","CsvTab","ApiTab","ImportTab","NetsuiteTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{this.save(e,i)}))})),this.ImportTab.on("imported",(e=>{this.done(e)})),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.BlankTab.applicationLoad(e),this.CsvTab.applicationLoad(e),this.ApiTab.applicationLoad(e),this.ImportTab.applicationLoad(e),this.NetsuiteTab.applicationLoad(e)}hide(){this.$component?.hide()}busy(){this.$component?.showProgress?.()}ready(){this.$component?.hideProgress?.()}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}async save(e,t){if(!this.CurrentApplicationID)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;var n=this.AB.objectNew(e),s=n.isValid();if(s.fail())return this[t].emit("save.error",s),!1;n.createdInAppID||(n.createdInAppID=this.CurrentApplicationID),this.busy();var o=this.CurrentApplication;try{var a=await n.save();await o.objectInsert(a),this[t].emit("save.successful",a),this.done(a)}catch(e){this.ready(),await o.objectRemove(n),this[t].emit("save.error",e)}}show(e){null!=e&&(this.selectNew=e),this.$component&&this.$component.show()}switchTab(e){switch(e){case this.BlankTab?.ids.form:this.BlankTab?.onShow?.(this.CurrentApplicationID);break;case this.CsvTab?.ids.form:this.CsvTab?.onShow?.(this.CurrentApplicationID);break;case this.ApiTab?.ids.form:this.ApiTab?.onShow?.(this.CurrentApplicationID);break;case this.ImportTab?.ids.form:this.ImportTab?.onShow?.(this.CurrentApplicationID);break;case this.ExternalTab?.ids.form:this.ExternalTab?.onShow?.(this.CurrentApplicationID);break;case this.NetsuiteTab?.ids.form:this.NetsuiteTab?.onShow?.(this.CurrentApplicationID)}}}}function v(e,t){t=t||"ui_work_object_workspace_popupIndex";const i=(0,n.Z)(e);var s=i.L();const o=e.Class.ABIndex;return new class extends i{constructor(e){super(e,{popup:"",form:"",name:"",fields:"",unique:"",removeButton:"",saveButton:""})}ui(){let e=this.ids;return{view:"window",id:e.popup,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:s("Custom Index"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.close()},on:{onAfterRender(){i.CYPRESS_REF(this)}}}]},position:"center",resize:!0,modal:!0,editable:!1,width:500,height:500,body:{view:"form",id:e.form,elements:[{id:e.name,view:"text",label:s("Name"),name:"name"},{id:e.fields,view:"multicombo",label:s("Fields"),name:"fieldIDs",options:[]},{id:e.unique,view:"checkbox",label:s("Unique"),name:"unique"},{cols:[{id:e.removeButton,view:"button",type:"icon",icon:"fa fa-trash-o",css:"webix_danger",width:40,click:()=>this.removeIndex()},{fillspace:!0},{view:"button",value:s("Cancel"),width:100,click:()=>this.close()},{id:e.saveButton,view:"button",type:"icon",icon:"fa fa-floppy-o",css:"webix_primary",label:s("Save"),width:100,click:()=>this.save()}]}]}}}init(e){this.AB=e,webix.ui(this.ui());let t=$$(this.ids.form);t&&webix.extend(t,webix.ProgressBar)}open(e,t){this.CurrentObjectID=e.id,this.CurrentIndex=t;let i=this.ids,n=$$(i.popup);if(!n)return;n.show();let s=$$(i.fields);if(s&&this.CurrentObject){var o=["number","date","datetime","boolean","list","email","user","AutoIndex","combined"];let e=this.CurrentObject.fields((e=>o.indexOf(e.key)>-1||("string"==e.key||"LongText"==e.key)&&e.settings&&!e.settings.supportMultilingual||"connectObject"==e.key&&("one"==e.settings.linkType&&"many"==e.settings.linkViaType||"one"==e.settings.linkType&&"one"==e.settings.linkViaType&&e.settings.isSource))).map((e=>({id:e.id,value:e.label})));s.define("options",e),s.refresh()}let a=$$(this.ids.form);a&&(a.clear(),t&&a.setValues(t.toObj()));let r=$$(i.name),l=$$(i.unique),c=$$(i.saveButton),h=$$(i.removeButton);this.CurrentIndex?(r.disable(),s.disable(),l.disable(),c.hide(),h.show()):(r.enable(),s.enable(),l.enable(),c.show(),h.hide())}async save(){let e=$$(this.ids.form);if(!e)return;this.busy();let t=e.getValues();t.fieldIDs=t.fieldIDs.split(","),null==this.CurrentIndex&&(this.CurrentIndex=new o(t,this.CurrentObject)),this.CurrentIndex.fromValues(t);try{await this.CurrentIndex.save(),this.ready(),this.emit("changed"),this.close()}catch(e){let i=s("The system could not create your index.");"ER_DUP_ENTRY"===e.code&&(i=`${i} : ${s("There are duplicated values in this column.")}`),this.AB.notify.developer(e,{context:`${this.ids.component}:save()`,message:i,vals:t}),webix.alert({type:"alert-error",title:s("Failed"),text:i}),this.ready()}}close(){let e=$$(this.ids.popup);e&&e.hide()}busy(){$$(this.ids.form)?.showProgress?.({type:"icon"}),$$(this.ids.saveButton)?.disable(),$$(this.ids.removeButton)?.disable()}ready(){$$(this.ids.form)?.hideProgress?.(),$$(this.ids.saveButton)?.enable(),$$(this.ids.removeButton)?.enable()}removeIndex(){this.CurrentIndex&&webix.confirm({title:s("Delete this Index"),message:s("Do you want to remove this index ?"),callback:async e=>{if(e){this.busy();try{await this.CurrentIndex.destroy(),this.ready(),this.emit("changed"),this.close()}catch(e){this.AB.notify.developer(e,{context:`${this.ids.component}:removeIndex()`,ABIndex:this.CurrentIndex.toObj()}),this.ready()}}}})}}(t)}function w(e,t){t=t||"ui_work_object_workspace_popupDefineLabel";const i=(0,n.Z)(e);var s=i.L();return new class extends i{constructor(e){super(e,{format:"",list:"",buttonSave:""})}ui(){let e=this.ids;return{view:"popup",id:e.component,modal:!0,autoheight:!0,width:500,body:{rows:[{view:"label",label:s("<b>Label format</b>")},{view:"textarea",id:e.format,height:100},{view:"label",label:s("Select field item to generate format.")},{view:"label",label:s("<b>Fields</b>")},{view:"list",name:"columnList",id:e.list,width:500,height:180,maxHeight:180,select:!1,template:"#label#",on:{onItemClick:(e,t,i)=>{this.onItemClick(e,t,i)}}},{height:10},{cols:[{fillspace:!0},{view:"button",name:"cancel",value:s("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",id:e.buttonSave,label:s("Save"),type:"form",autowidth:!0,click:()=>{this.buttonSave()}}]}]},on:{onShow:()=>{this.onShow()}}}}init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.list),webix.ProgressBar)}changed(){this.emit("changed",this._settings)}buttonCancel(){$$(this.ids.component).hide()}async buttonSave(){var e=this.ids,t=$$(e.buttonSave);t.disable();var i=$$(e.format).getValue(),n=$$(e.list);n.showProgress({type:"icon"}),n.data.each((function(e){i=i.replace(new RegExp("{"+e.label+"}","g"),"{"+e.id+"}")})),this.CurrentObject.labelFormat=i;try{await this.CurrentObject.save(),this.hide(),this.changed()}catch(e){this.AB.notify.developer(e,{context:"ui_work_object_workspace_popupDefineLabel:buttonSave(): Error trying to save our Object"})}n.hideProgress(),t.enable()}hide(){$$(this.ids.component).hide()}objectLoad(e){super.objectLoad(e);var t=$$(this.ids.list);t.clearAll();var i=e.fields((e=>e.fieldUseAsLabel())).map((e=>({id:e.id,label:e.label})));t.parse(i),t.refresh()}onItemClick(e){var t=this.ids,i=$$(t.list).getItem(e),n=$$(t.format).getValue();n+=`{${i.label}}`,$$(t.format).setValue(n)}onShow(){var e=this.ids,t=this.CurrentObject.labelFormat,i=$$(e.format),n=$$(e.list);if(i.setValue(""),i.enable(),n.enable(),$$(e.buttonSave).enable(),t)n.data?.count()>0&&n.data.each((function(e){t=t.replace(new RegExp(`{${e.id}}`,"g"),`{${e.label}}`)}));else if(n.data?.count()>0){var s=n.getItem(n.getFirstId());t=`{${s.label}}`}i.setValue(t||"")}show(e){$$(this.ids.component).show(e)}}(t)}function y(e,t){t=t||"ui_work_object_workspace_popupExport";const i=(0,n.Z)(e);return new class extends i{constructor(e){super(e,{popupExport:"",list:""}),this.DatacollectionID=null,this.grid=null,this.filename=null,this.hiddenFields=[]}ui(){var e=this;return{view:"popup",id:this.ids.popupExport,width:160,height:180,select:!1,hidden:!0,body:{id:this.ids.list,view:"list",data:[{name:"CSV",icon:"file-excel-o"},{name:"Excel",icon:"file-excel-o"},{name:"PDF",icon:"file-pdf-o"},{name:"PNG",icon:"file-image-o"}],template:"<div><i class='fa fa-#icon# webix_icon_btn' aria-hidden='true'></i> #name#</div>",on:{onItemClick:function(t){var i=this.getItem(t);e.export(i.name)}}}}}init(e){this.AB=e,webix.ui(this.ui())}get Datacollection(){return this.AB.datacollectionByID(this.DatacollectionID)}dataCollectionLoad(e){this.DatacollectionID=e.id}setHiddenFields(e){this.hiddenFields=e||[]}setFilename(e){this.filename=e}setGridComponent(e){this.grid=e}show(e){$$(this.ids.popupExport).show(e)}async export(e){let t,i={},n=this.Datacollection;!n||n.settings.loadAll&&n.dataStatus!=n.dataStatusFlag.notInitial||(await n.reloadData(0,null),n.settings.loadAll=!0);var s=this.CurrentObject;s&&s.fields().forEach((e=>{this.hiddenFields.indexOf(e.columnName)>-1||(i[e.columnName]={template:t=>{let i=e.format(t);return i?.length||"calculate"!=e.key&&"formula"!=e.key&&"number"!=e.key||(i=0),i}})}));var o=this.grid;if(o){var a=this.filename,r=s?s.label:null;switch(e){case"CSV":webix.csv.delimiter.cols=",",t=webix.toCSV(o,{_filename:this.filename||r,columns:i});break;case"Excel":t=webix.toExcel(o,{filename:a||r,name:a||r,columns:i,filterHTML:!0});break;case"PDF":t=webix.toPDF(o,{filename:a||r,filterHTML:!0});break;case"PNG":t=webix.toPNG(o,{filename:a||r})}try{await t,$$(this.ids.popupExport).hide()}catch(t){this.AB.notify.developer(t,{message:`${this.ids.component}:export(): could not export: ${e}`})}}}}(t)}var O=i(5997),x=i(6038),$=i(231);function C(e,t){t=t||"ui_work_object_workspace_popupImport";const i=(0,n.Z)(e),s=new((0,$.default)(e));return new class extends i{constructor(e){super(e),this.popup=null}ui(){return{}}init(e){this.AB=e;var i=s.toSettings(),n=this.AB.viewNewDetatched(i);this.popup=n.component(t),this.popup.init(e),this.popup.objectLoad(this.CurrentObject)}objectLoad(e){super.objectLoad(e),this.popup?.objectLoad(e)}show(){this.popup.showPopup()}hide(){this.popup.hide()}}(t)}var S=i(2439),_=i(423),k=i(4550),E={name:"Default Grid",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};function P(e,t){const i=(0,n.Z)(e);return i.L(),new class extends i{constructor(e){super(e)}type(){return"grid"}icon(){return"fa fa-table"}fromSettings(e){for(var t in E)this[t]=e[t]||E[t];this.type=this.type(),this.key=this.type()}toSettings(){var e={};for(var t in E)e[t]=this[t]||E[t];return e.key=this.type(),e.type=this.type(),e}}(t)}var A=i(5609);function R(e,t){t=t||"ui_work_object_workspace_popupHideFields";const i=(0,n.Z)(e);return new class extends i{constructor(t){super(t,{}),this.AB=e,this.base=t,this.rowFilter=this.AB.filterComplexNew(`${this.ids.component}_filter`),this.rowFilter.on("save",((...e)=>{this.emit("save",...e),this.hide()}))}objectLoad(e){super.objectLoad(e),this.rowFilter&&this.rowFilter.fieldsLoad(e.fields(),e)}viewLoad(e){this.view=e}ui(){return{view:"popup",id:this.ids.component,autoheight:!0,minHeight:350,minWidth:400,body:this.rowFilter.ui,on:{onHide:()=>{this.hide()}}}}init(e){this.AB=e,webix.ui(this.ui()),this.$Component=$$(this.ids.component),this.$List=$$(this.ids.list)}show(e,t=null){this.$Component.isVisible()||(null!=t?this.$Component?.show(e,t):this.$Component?.show(e))}hide(e,t=null){null!=t?this.$Component.hide(e,t):this.$Component.hide(e)}setFilter(e){e.rules?.length||(e=e[0]||[]),this.rowFilter.setValue(e)}}(t)}function D(e,t,i){t=t||"ui_work_object_workspace_view_grid";const s=(0,n.Z)(e);var o=s.L();const a=P(e);return new class extends s{constructor(e,t={}){super(e),t.isReadOnly=t.isReadOnly??!1,this.settings=t}ui(){return{id:this.ids.component,rows:[{},{view:"label",label:"Impressive View -> Grid"},{}]}}async init(e){this.AB=e}defaultSettings(t){var i=a.toSettings();i.label=o(i.name);var n=this.AB.viewNewDetatched(i).toObj();return n.id=t?.id??e.jobID(),["isEditable","massUpdate","allowDelete","trackView"].forEach((e=>{n.settings[e]=1})),n.settings.padding=0,n.settings.showToolbar=0,n.settings.gridFilter={filterOption:0,isGlobalToolbar:0},{id:n.id,isDefaultView:!1,type:n.type,icon:n.icon,name:"Default Grid",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[],component:n}}getColumnIndex(e){return this._currentComponent.getColumnIndex(e)}datacollectionLoad(e){this.datacollection=e}get $grid(){return this._currentComponent?.getDataTable()}ready(){this.ListComponent.ready()}async show(e){await this.viewLoad(e),$$(this.ids.component).show(),this.emit("show")}async viewLoad(e){if(e.id==this.currentViewDef?.id)return;this.currentViewDef=e,this.currentView=this.AB.viewNewDetatched(e.component),this.currentView.warningsSilent=!0;var t=this.currentView.component();t.datacollectionLoad(this.datacollection);var i=t.ui();i.id=this.ids.component,webix.ui(i,$$(this.ids.component));let n=2;(this.settings.isReadOnly||this.datacollection?.datasource?.isReadOnly)&&(n=1),await t.init(this.AB,n),t.datacollectionLoad(this.datacollection),t.on("column.header.clicked",((e,t)=>{this.emit("column.header.clicked",e,t)})),t.on("object.track",((e,t)=>{this.emit("object.track",e,t)})),t.on("selection",(()=>{this.emit("selection")})),t.on("selection.cleared",(()=>{this.emit("selection.cleared")})),t.on("column.order",(e=>{this.emit("column.order",e)})),this._currentComponent=t}viewNew(e){var t=this.defaultSettings(e);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t}deleteSelected(e){return this._currentComponent.toolbarDeleteSelected(e)}massUpdate(e){return this._currentComponent.toolbarMassUpdate(e)}refreshHeader(e=[],t,i,n){var s=this.CurrentObject.columnHeaders(!0,!0,[],[],[]);this._currentComponent&&(this._currentComponent.columnConfig(s),this._currentComponent.settings.hiddenFields=e,this._currentComponent.settings.filterConditions=t,this._currentComponent.settings.sortFields=i,this._currentComponent.settings.frozenColumnID=n,this._currentComponent.refreshHeader(!0))}}(t,i)}function V(e,t){t=t||"ui_work_object_workspace_view_gantt";const i=(0,n.Z)(e),s=(i.L(),(0,k.Z)(e));return new class extends i{constructor(e){super(e)}ui(){return{id:this.ids.component,rows:[{},{view:"label",label:"Impressive View -> Gantt"},{}]}}async init(e){this.AB=e}defaultSettings(t){const i=s.toSettings();i.settings=Object.assign(i.settings,t.settings??{});const n=this.AB.viewNewDetatched(i).toObj();return n.id=t.id??e.jobID(),{id:n.id,isDefaultView:!1,type:n.type,icon:n.icon,name:"Default Gantt",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[],component:n}}datacollectionLoad(e){this.datacollection=e}async show(e){await this.viewLoad(e),$$(this.ids.component).show(),this.emit("show")}async viewLoad(e){if(e.id==this.currentViewDef?.id)return;this.currentViewDef=e,this._currentComponent?.eventsClear(),this.currentView=this.AB.viewNewDetatched(e.component),this.currentView.warningsSilent=!0;const t=this.currentView.component(),i=t.ui();i.id=this.ids.component,webix.ui(i,$$(this.ids.component)),await t.init(this.AB),t.datacollectionLoad(this.datacollection),t.show(),this._currentComponent=t}viewNew(e){return Object.assign(this.defaultSettings(e),e)}}(t)}function L(e,t){t=t||"ui_work_object_workspace_view_kanban";const i=(0,n.Z)(e);var s=i.L();const o=(0,A.Z)(e,`${t}_prop`);return new class extends i{constructor(e){super(e)}ui(){return{id:this.ids.component,rows:[{},{view:"label",label:"Impressive View -> Kanban"},{}]}}async init(e){this.AB=e}defaultSettings(t){var i=o.toSettings();Object.keys(i.settings).forEach((e=>{i.settings[e]=t.settings[e]})),i.label=s(i.name);var n=this.AB.viewNewDetatched({key:"text"}),a=this.CurrentObject,r=a.labelFormat;!r&&a.fields().length>0&&a.fields((e=>e.fieldUseAsLabel())).forEach((e=>{r=`${r}<br>${e.label}: {${n.fieldKey(e)}}`})),i.settings.textTemplate=r,i.settings.editFields=a.fields().map((e=>e.id));var l=this.AB.viewNewDetatched(i).toObj();return l.id=t.id??e.jobID(),{id:l.id,isDefaultView:!1,type:l.type,icon:l.icon,name:"Default Kanban",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[],component:l}}datacollectionLoad(e){this.datacollection=e}async show(e){await this.viewLoad(e),$$(this.ids.component).show(),this.emit("show")}async viewLoad(e){if(e.id!=this.currentViewDef?.id){this.currentViewDef=e,this.currentView=this.AB.viewNewDetatched(e.component),this.currentView.warningsSilent=!0;var t=this.currentView.component(),i=t.ui();i.id=this.ids.component,webix.ui(i,$$(this.ids.component)),await t.init(this.AB),t.datacollectionLoad(this.datacollection),t.show(),this._currentComponent=t}}viewNew(e){var t=this.defaultSettings(e);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t}}(t)}function T(e,t,i){t=t||"ui_work_object_workspace_workspaceviews";const s=(0,n.Z)(e),o=D(e,`${t}_grid`,i),a=V(e),r=L(e),l=(0,k.Z)(e),c=P(e),h=(0,A.Z)(e);var d={};d[l.type()]=l,d[c.type()]=c,d[h.type()]=h;var u={};u[l.type()]=a,u[c.type()]=o,u[h.type()]=r;const p={currentViewID:void 0,list:[]};return new class extends s{constructor(t,i){super(t),this.AB=e,this._settings=null}async init(e){this.AB=e,Object.keys(u).forEach((t=>{u[t].init(e)})),this._settings=await this.AB.Storage.get("workspaceviews")||{}}objectLoad(e){this.CurrentObjectID&&(this._settings[this.CurrentObjectID]=this.toObj()),super.objectLoad(e),Object.keys(u).forEach((t=>{u[t].objectLoad(e)})),this.fromObj(this._settings[this.CurrentObjectID])}fromObj(t){if(0===((t=t||e.cloneDeep(p))?.list??[]).length){var i=o.defaultSettings();i.isDefaultView=!0,t.list.unshift(i)}this.importViews(t),this.currentViewID=t.currentViewID,this.currentViewID||(this.currentViewID=this.list()[0].id)}clearObjectCache(e){delete this._settings?.[e]}toObj(){return{currentViewID:this.currentViewID,list:this._views}}list(e=(()=>!0)){return this._views.filter(e)}importViews(e){this._views=[],e.list.forEach((e=>{this.viewAdd(e,!1)}))}getCurrentView(){return this._views.find((e=>e.id==this.currentViewID))}setCurrentView(e){this.currentViewID=e,this._currentView=this.getCurrentView()}async viewAdd(e,t=!0){return this._views.push(e),t&&await this.save(),e}async viewNew(e){var t=u[e.type];if(t){var i=t.viewNew(e);return await this.viewAdd(i),i}}viewRemove(e){var t=this._views.indexOf(e);this._views.splice(t,1),e.id===this.currentViewID&&(this.currentViewID=this._views[0].id),this.save()}async save(){this._settings[this.CurrentObjectID]=this.toObj();try{await this.AB.Storage.set("workspaceviews",this._settings)}catch(e){console.error(e)}}async viewUpdate(e){var t=u[e.type];if(t){delete e.component;var i=t.viewNew(e),n=[];this._views.forEach((e=>{e.id==i.id?n.push(i):n.push(e)})),this._views=n,await this.save()}}get filterConditions(){return this._currentView.filterConditions}set filterConditions(e){this._currentView.filterConditions=e}get frozenColumnID(){return this._currentView.frozenColumnID}set frozenColumnID(e){this._currentView.frozenColumnID=e}get hiddenFields(){return this._currentView.hiddenFields||[]}set hiddenFields(e){this._currentView.hiddenFields=e}get sortFields(){return this._currentView.sortFields}set sortFields(e=[]){this._currentView.sortFields=e}}(t,i)}function B(e,t,i){t=t||"abd_work_object_workspace";const s=e.Config.uiSettings(),r=(0,n.Z)(e);var l=r.L(),c=D(e,`${t}_view_grid`,i),h=V(e,`${t}_view_gantt`),d=L(e,`${t}_view_kanban`),u=a(e,`${t}_view_warnings`,i),p=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){var e="ui_work_object_workspace_track";super({popup:`${e}_popup`,timeline:`${e}_timeline`})}ui(){let e=this.ids;return{view:"window",id:e.popup,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Record History"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",align:"right",click:()=>{this.close()},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},position:"center",resize:!0,modal:!0,editable:!1,width:500,height:500,body:{view:"timeline",id:e.timeline,type:{height:140,templateDate:e=>this.AB.rules.toDateFormat(e.timestamp,{localeCode:"en",format:"DD MMM, YYYY hh:mma"}),lineColor:e=>{switch(e.level){case"insert":return"#FF5C4C";case"update":return"#1CA1C1";case"delete":return"#94A1B3"}}},scheme:{$init:e=>{switch(e.level){case"insert":e.value=i("Add");break;case"update":e.value=i("Edit");break;case"delete":e.value=i("Delete")}if(e.details=`by <b>${e.username||i("Unknown")}</b>`,e.record){let t="";Object.keys(e.record).forEach((i=>{t=t.concat(`${i}: <b>${null!=e.record[i]?e.record[i]:""}</b> <br />`)})),e.details=e.details.concat("<br />"),e.details=e.details.concat(`<div>${t}</div>`)}}}}}}init(e){this.AB=e,webix.ui(this.ui());let t=$$(this.ids.timeline);t&&webix.extend(t,webix.ProgressBar)}open(e,t){this.objectLoad(e);let i=this.ids,n=$$(i.popup);n&&(n.show(),this.loadData(t))}async loadData(e){if(!this.CurrentObject)return;let t=$$(this.ids.timeline);t.showProgress({type:"icon"});try{var n=this.CurrentObject.model().logs({rowId:e});t.clearAll(!0),t.parse(n)}catch(e){console.error(e),webix.alert({text:i("Unable to display logs for this entry.")})}t.hideProgress()}close(){let e=this.ids,t=$$(e.popup);t&&t.hide()}}}(e);return new class extends r{constructor(t,i={}){super(t,{buttonAddField:"",buttonDeleteSelected:"",buttonDeleteSelectedSpacer:"",buttonExport:"",buttonImport:"",buttonFieldsVisible:"",buttonFieldsVisibleSpacer:"",buttonFilter:"",buttonFrozen:"",buttonFrozenSpacer:"",buttonLabel:"",buttonMassUpdate:"",buttonMassUpdateSpacer:"",buttonRowNew:"",buttonSort:"",buttonSortSpacer:"",layoutIndex:"",listIndex:"",buttonIndex:"",datatable:"",error:"",error_msg:"",viewMenu:"",viewMenuButton:"",viewMenuNewView:"",propertyFieldInfo:"",toolbar:"",noSelection:"",selectedObject:"",spaceAddField:"",spaceLabel:"",spaceImport:""}),i.showWarnings=i.showWarnings??!0,this.isReadOnly=i.isReadOnly??!1,this.settings=i,this.workspaceViews=T(e,`${t}_views`,{isReadOnly:this.isReadOnly}),this.hashViews={},this.hashViews.grid=c,c.on("column.header.clicked",((e,t)=>{this.PopupHeaderEditMenu.show(e,t)})),c.on("object.track",((e,t)=>{p.open(e,t)})),c.on("selection",(()=>{this.callbackCheckboxChecked("enable")})),c.on("selection.cleared",(()=>{this.callbackCheckboxChecked("disable")})),c.on("column.order",(e=>{var t=this.CurrentObject,i=[];e.forEach((e=>{i.push(t.fieldByID(e))})),t._fields=i,t.save()})),this.hashViews.gantt=h,this.hashViews.kanban=d,this.PopupCustomIndex=new v(e,`${t}_customIndex`),this.PopupCustomIndex.on("changed",(()=>{this.refreshIndexes()})),this.PopupHeaderEditMenu=function(e,t){t=t||"ui_work_object_workspace_popupHeaderEditMenu";var i=o(e),s=(0,n.Z)(e).L();return new class extends i{constructor(e){super(e),this.ids.list_info_item=`${e}_list_info_item`,this._menuOptions=[{label:s("Hide field"),icon:"fa fa-eye-slash",command:"hide",imported:!0},{label:s("Filter field"),icon:"fa fa-filter",command:"filter",imported:!0},{label:s("Sort field"),icon:"fa fa-sort",command:"sort",imported:!0},{label:s("Freeze field"),icon:"fa fa-thumb-tack",command:"freeze",imported:!0},{label:s("Edit field"),icon:"fa fa-pencil-square-o",command:"edit",imported:!1},{label:s("Delete field"),icon:"fa fa-trash",command:"delete",imported:!1}],this.$node=null,this.field=null}show(e,t){this.$node=e,this.field=t;const i=$$(this.ids.list);i.exists(this.ids.list_info_item)&&i.remove(this.ids.list_info_item),this.AB.Account.isSystemDesigner()&&i.add({id:this.ids.list_info_item,label:s("Information"),icon:"fa fa-info-circle",command:"system_info"}),super.show(e)}trigger(e){this.emit("click",e,this.field,this.$node)}}(t)}(e,`${t}_headerEditMenu`),this.PopupHeaderEditMenu.on("click",((e,t,i)=>{this.callbackHeaderEditorMenu(e,t,i)})),this.PopupDefineLabelComponent=new w(e,`${t}_defineLabel`),this.PopupDefineLabelComponent.on("changed",(()=>{this.callbackDefineLabel()})),this.PopupFilterDataTableComponent=new R(e,`${t}_popupFilter`),this.PopupFrozenColumnsComponent=new O.Z(e,`${t}_frozenFields`),this.PopupFrozenColumnsComponent.on("changed",(e=>{this.callbackFrozenColumns(e)})),this.PopupHideFieldComponent=(0,x.Z)(e,`${t}_hideFields`),this.PopupHideFieldComponent.on("changed",(e=>{this.callbackFieldsVisible(e)})),this.isReadOnly||(this.PopupNewDataFieldComponent=(0,S.Z)(e,`${t}_popupNewDataField`)),this.PopupSortFieldComponent=(0,_.Z)(e,`${t}_sortFields`),this.PopupSortFieldComponent.on("changed",(e=>{this.callbackSortFields(e)})),this.PopupExportObjectComponent=new y(e,`${t}_export`),this.PopupImportObjectComponent=new C(e,`${t}_import`),this.PopupViewSettingsComponent=function(e,t,i){t=t||"abd_work_object_workspace_popupAddView";const s=(0,n.Z)(e),o=s.L();return new class extends s{constructor(t,i={}){super(t,{form:"",formAdditional:"",nameInput:"",typeInput:"",cancelButton:"",cancelX:"",saveButton:""}),i.isReadOnly=i.isReadOnly??!1,this.settings=i,this.isReadOnly=i.isReadOnly,this._view=null,this.comGrid=P(e,`${t}_grid`),this.comKanban=(0,A.Z)(e,`${t}_kanban`),this.comKanban.on("new.field",(e=>{this._newFieldSource="comKanban",this.emit("new.field",e)})),this.comGantt=(0,k.Z)(e,`${t}_gantt`),this.comGantt.on("new.field",(e=>{this._newFieldSource="comGantt",this.emit("new.field",e)})),this.on("field.added",(e=>{this[this._newFieldSource]?.emit("field.added",e)}))}ui(){const e=this.ids,t={view:"form",id:e.form,visibleBatch:"global",rules:{hGroup:(e,{vGroup:t})=>!e||e!==t},elements:[{view:"text",label:o("Name"),id:e.nameInput,name:"name",placeholder:o("Create a name for the view"),required:!0,invalidMessage:o("this field is required"),on:{onChange:()=>{$$(e.nameInput).validate()},onAfterRender(){s.CYPRESS_REF(this)}}},{view:"richselect",label:o("Type"),id:e.typeInput,name:"type",hidden:this.isReadOnly,options:[{id:this.comGrid.type(),value:o("Grid")},{id:this.comKanban.type(),value:o("Kanban")},{id:this.comGantt.type(),value:o("Gantt")}],value:this.comGrid.type(),required:!0,on:{onChange:e=>{this.switchType(e)}}},{id:e.formAdditional,view:"layout",rows:[this.comKanban.ui(),this.comGantt.ui()]},{margin:5,cols:[{fillspace:!0},{id:e.buttonCancel,view:"button",value:o("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.buttonCancel()},on:{onAfterRender(){s.CYPRESS_REF(this)}}},{id:e.buttonSave,view:"button",css:"webix_primary",value:o("Save"),autowidth:!0,type:"form",click:()=>{this.buttonSave()},on:{onAfterRender(){s.CYPRESS_REF(this)}}}]}]};return{view:"window",id:e.component,width:400,resize:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:o("View Settings"),css:"modal_title",align:"center"},{id:e.cancelX,view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.buttonCancel()},on:{onAfterRender(){s.CYPRESS_REF(this)}}}]},position:"center",body:t,modal:!0,on:{onShow:()=>{this.onShow()}}}}async init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}switchType(e){switch($$(this.ids.formAdditional).showBatch(e),e){case"kanban":this.comKanban.init(this.CurrentObject,this._view);break;case"gantt":this.comGantt.init(this.CurrentObject,this._view)}$$(this.ids.component).resize()}onShow(){const e=this.ids;$$(e.form).clear(),$$(e.form).clearValidation(),this._view?($$(e.nameInput).setValue(this._view.name),$$(e.typeInput).setValue(this._view.type)):($$(e.nameInput).setValue(""),$$(e.typeInput).setValue(this.comGrid.type()))}show(e){this._view=e,$$(this.ids.component).show()}hide(){$$(this.ids.component).hide()}buttonCancel(){this.hide()}buttonSave(){const e=this.ids,t=$$(e.form);if(!t.validate())return;const i={},n=$$(e.typeInput);switch(n.getValue()){case this.comKanban.type():if(this.comKanban.validate&&!this.comKanban?.validate(t))return;i.settings=this.comKanban.values();break;case this.comGantt.type():if(this.comGantt.validate&&!this.comGantt.validate(t))return;i.settings=this.comGantt.values()}i.name=$$(e.nameInput).getValue(),i.type=n.getValue(),this._view?(this._view=Object.assign(this._view,i),this.emit("updated",this._view)):this.emit("added",i),this.hide()}get isReadOnly(){return this._isReadOnly??!1}set isReadOnly(e){this._isReadOnly=e,this._isReadOnly?$$(this.ids.typeInput)?.hide():$$(this.ids.typeInput)?.show()}}(t,i)}(e,`${t}_popupAddView`,{isReadOnly:this.isReadOnly}),this.isReadOnly||this.PopupViewSettingsComponent.on("new.field",(e=>{this.PopupNewDataFieldComponent.objectLoad(this.CurrentObject),this.PopupNewDataFieldComponent.show(null,e,!1)})),this.mockDataCollection=null,this.CurrentObjectID=null}ui(){var e=this.ids,t="button",i=this,n={id:this.ids.viewMenuNewView,view:"button",type:"icon",autowidth:!0,css:"webix_transparent",label:l("New view"),icon:"fa fa-plus-circle",align:"center",click:()=>{this.PopupViewSettingsComponent.show()}},o={id:e.viewMenu,view:"menu",data:[],on:{onMenuItemClick:t=>{var i=$$(e.viewMenu).getMenuItem(t);if(t!==e.viewMenuButton)if(i.isView){let e=this.workspaceViews.list((e=>e.id===t))[0];this.switchWorkspaceView(e)}else if("edit"===i.action){let e=this.workspaceViews.list((e=>e.id===i.viewId))[0];this.PopupViewSettingsComponent.show(e)}else"delete"===i.action&&webix.confirm({title:l("Delete View?"),message:l("Are you sure you want to remove this view?"),callback:e=>{if(e){var t=this.workspaceViews.list((e=>e.id===i.viewId))[0];this.workspaceViews.viewRemove(t),this.switchWorkspaceView(this.workspaceViews.getCurrentView())}}})}},type:{subsign:!0}},a={view:"toolbar",id:e.toolbar,hidden:!0,css:"webix_dark",elementsConfig:{autowidth:!0,padding:0,margin:0},margin:0,padding:0,rows:[{cols:[{responsive:"hide"},{view:t,id:e.buttonAddField,label:l("Add field"),icon:"fa fa-plus",css:"webix_transparent",type:"icon",hidden:this.isReadOnly,click:function(){i.toolbarAddFields(this.$view)}},{id:e.spaceAddField,responsive:"hide",hidden:this.isReadOnly},{view:t,id:e.buttonFieldsVisible,label:l("Hide fields"),icon:"fa fa-eye-slash",css:"webix_transparent",type:"icon",badge:null,click:function(){i.toolbarFieldsVisible(this.$view)}},{responsive:"hide",id:e.buttonFieldsVisibleSpacer},{view:t,id:e.buttonFilter,label:l("Filters"),icon:"fa fa-filter",css:"webix_transparent",type:"icon",minWidth:70,autowidth:!0,badge:null,click:function(){i.toolbarFilter(this.$view)}},{responsive:"hide"},{view:t,id:e.buttonSort,label:l("Sort"),icon:"fa fa-sort",css:"webix_transparent",type:"icon",badge:null,click:function(){i.toolbarSort(this.$view)}},{responsive:"hide",id:e.buttonSortSpacer},{view:t,id:e.buttonFrozen,label:l("Freeze"),icon:"fa fa-thumb-tack",css:"webix_transparent",type:"icon",badge:null,click:function(){i.toolbarFrozen(this.$view)}},{responsive:"hide",id:e.buttonFrozenSpacer},{view:t,id:e.buttonLabel,label:l("Label"),icon:"fa fa-crosshairs",css:"webix_transparent",type:"icon",click:function(){i.toolbarDefineLabel(this.$view)}},{id:e.spaceLabel,responsive:"hide",hidden:this.isReadOnly},{view:t,id:e.buttonImport,label:l("Import"),icon:"fa fa-upload",css:"webix_transparent",type:"icon",hidden:this.isReadOnly,click:function(){i.toolbarButtonImport()}},{id:e.spaceImport,responsive:"hide",hidden:this.isReadOnly},{view:t,id:e.buttonExport,label:l("Export"),icon:"fa fa-download",css:"webix_transparent",type:"icon",click:function(){i.toolbarButtonExport(this.$view)}},{responsive:"hide"},{view:t,id:e.buttonMassUpdate,label:l("Edit"),icon:"fa fa-pencil-square-o",css:"webix_transparent",type:"icon",badge:null,hidden:!0,click:function(){i.toolbarMassUpdate(this.$view)}},{responsive:"hide",hidden:!0,id:e.buttonMassUpdateSpacer},{view:t,id:e.buttonDeleteSelected,label:l("Delete"),icon:"fa fa-trash",css:"webix_transparent",type:"icon",badge:null,hidden:!0,click:function(){i.toolbarDeleteSelected(this.$view)}},{responsive:"hide",hidden:!0,id:e.buttonDeleteSelectedSpacer}]},{id:e.layoutIndex,css:{"background-color":"#747d84 !important"},hidden:this.isReadOnly,cols:[{view:t,id:e.buttonIndex,label:l("Add Index"),icon:"fa fa-plus-circle",css:"webix_transparent",type:"icon",click:()=>{this.PopupCustomIndex.open(this.CurrentObject)}},{id:e.listIndex,cols:[]},{responsive:"hide"}]}]};let r={view:"multiview",animate:!1,id:e.component,borderless:!0,rows:[{id:e.error,rows:[{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-exclamation-triangle'></div>"},{id:e.error_msg,view:"label",align:"center",label:l("There was an error")},{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile}]},{id:e.noSelection,rows:[{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-database'></div>"},{view:"label",align:"center",label:l("Select an object to work with.")},{cols:[{},{view:"button",label:l("Add new object"),type:"form",css:"webix_primary",autowidth:!0,click:()=>{this.emit("addNew",!0)}},{}]},{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile}]},{id:e.selectedObject,type:"wide",paddingY:0,rows:[{cols:[n,o]},a,{padding:0,rows:[{view:"multiview",animate:!1,cells:[c.ui(),d.ui(),h.ui()]},{view:"button",type:"form",id:e.buttonRowNew,css:"webix_primary",value:l("Add new row"),hidden:this.isReadOnly,click:()=>{this.rowAdd()}}]}]}]};return this.settings.showWarnings&&r.rows[2].rows[2].rows.push(u.ui()),r}init(e){this.AB=e;var t=[];return t.push(this.workspaceViews.init(e)),t.push(c.init(e)),t.push(h.init(e)),t.push(d.init(e)),t.push(p.init(e)),this.mockDataCollection=this.AB.datacollectionNew({}),this.mockDataCollection.init(),t.push(this.PopupCustomIndex.init(e)),c.datacollectionLoad(this.mockDataCollection),h.datacollectionLoad(this.mockDataCollection),d.datacollectionLoad(this.mockDataCollection),t.push(this.PopupHeaderEditMenu.init(e)),t.push(this.PopupDefineLabelComponent.init(e)),t.push(this.PopupFilterDataTableComponent.init(e)),this.PopupFilterDataTableComponent.on("save",((...e)=>{this.callbackFilterDataTable(...e)})),t.push(this.PopupFrozenColumnsComponent.init(e)),t.push(this.PopupHideFieldComponent.init(e)),this.isReadOnly||(t.push(this.PopupNewDataFieldComponent.init(e)),this.PopupNewDataFieldComponent.on("save",((...e)=>{this.callbackAddFields(...e),this.PopupViewSettingsComponent.emit("field.added",e[0])}))),t.push(this.PopupSortFieldComponent.init(e)),t.push(this.PopupImportObjectComponent.init(e)),t.push(this.PopupExportObjectComponent.init(e)),t.push(this.PopupViewSettingsComponent.init(e)),this.PopupViewSettingsComponent.on("added",(e=>{this.callbackViewAdded(e)})),this.PopupViewSettingsComponent.on("updated",(e=>{this.callbackViewUpdated(e)})),$$(this.ids.noSelection).show(),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.isReadOnly||this.PopupNewDataFieldComponent.applicationLoad(e)}callbackAddFields(){this.refreshView(),this.loadData()}async callbackFilterDataTable(e){this.mockDataCollection.filterCondition(e),this.updateFilterButton(e),this.workspaceViews.getCurrentView().filterConditions=e;try{await this.workspaceViews.save()}catch(e){console.error(e)}this.mockDataCollection.reloadData(),this.refreshView()}async updateFilterButton(e){var t=this.ids,i=$$(t.buttonFilter);if(i){var n=null;e?.rules?.length&&(n=1),i.define("badge",n),i.refresh()}}async callbackFrozenColumns(e){var t=this.workspaceViews.getCurrentView();t.frozenColumnID=e;try{await this.workspaceViews.save()}catch(e){}this.getBadgeFrozenColumn(),this.PopupHideFieldComponent.setFrozenColumnID(t.frozenColumnID),this.refreshView()}async callbackFieldsVisible(e){this.workspaceViews.getCurrentView().hiddenFields=e;try{await this.workspaceViews.save()}catch(e){}this.getBadgeHiddenFields(),this.PopupFrozenColumnsComponent.setHiddenFields(e),this.refreshView(),this.getBadgeFrozenColumn()}callbackCheckboxChecked(e){"enable"==e?this.enableUpdateDelete():this.disableUpdateDelete()}refreshView(){this.warningsRefresh(this.CurrentObject);var e=this.workspaceViews.getCurrentView();switch(e.type){case"gantt":h.show(e);break;case"grid":c.refreshHeader(e.hiddenFields,e.filterConditions,e.sortFields,e.frozenColumnID);break;case"kanban":d.show(e)}this.settings.showWarnings&&u.show(this.CurrentObject)}async callbackHeaderEditorMenu(e,t){var i=this.workspaceViews.getCurrentView();switch(e){case"hide":var n=[];i.hiddenFields.filter((e=>e==t.columnName)).length>0?n=i.hiddenFields.filter((e=>e!=t.columnName)):(n=i.hiddenFields).push(t.columnName),i.hiddenFields=n;try{await this.workspaceViews.save()}catch(e){}this.PopupHideFieldComponent.setSettings(i.hiddenFields),this.PopupFrozenColumnsComponent.setHiddenFields(i.hiddenFields),this.refreshView(),this.getBadgeHiddenFields(),this.getBadgeFrozenColumn();break;case"filter":this.toolbarFilter($$(this.ids.buttonFilter).$view,t.id);break;case"sort":this.toolbarSort($$(this.ids.buttonSort).$view,t.id);break;case"freeze":i.frozenColumnID=t.columnName;try{await this.workspaceViews.save()}catch(e){}this.PopupFrozenColumnsComponent.setValue(i.frozenColumnID||""),this.PopupHideFieldComponent.setFrozenColumnID(i.frozenColumnID||""),this.refreshView(),this.getBadgeFrozenColumn();break;case"edit":this.isReadOnly||this.PopupNewDataFieldComponent.show(t);break;case"delete":webix.confirm({title:l("Delete data field"),message:l("Do you want to delete <b>{0}</b>?",[t.label]),callback:e=>{e&&(this.busy(),t.destroy().then((()=>{this.ready(),this.refreshView(),this.loadData(),function e(i,n){0==i.length?n():i.shift()?.removeField?.(t,(t=>{t?n(t):e(i,n)}))??n()}(this.CurrentApplication.pages(),(()=>{}))})).catch((e=>{this.ready(),e&&e.message&&webix.alert({type:"alert-error",title:l("Could not delete"),text:e.message}),this.AB.notify.developer(e,{context:"Error trying to delete field",fields:t.toObj()})})))}});break;case"system_info":this.showSystemInfo(t)}}busy(){$$(this.ids.component)?.showProgress?.({type:"icon"})}callbackMassUpdate(){this.loadData()}async callbackSortFields(e){this.workspaceViews.getCurrentView().sortFields=e,await this.workspaceViews.save(),this.getBadgeSortFields(),this.refreshView(),this.loadData()}async callbackViewAdded(e){var t=await this.workspaceViews.viewNew(e);await this.switchWorkspaceView(t),this.refreshView(),this.loadData()}async callbackViewUpdated(e){await this.workspaceViews.viewUpdate(e),this.refreshWorkspaceViewMenu(),this.refreshView()}enableUpdateDelete(){var e=this.ids;$$(e.buttonMassUpdate).show(),$$(e.buttonMassUpdateSpacer).show(),$$(e.buttonDeleteSelected).show(),$$(e.buttonDeleteSelectedSpacer).show()}disableUpdateDelete(){var e=this.ids;$$(e.buttonMassUpdate).hide(),$$(e.buttonMassUpdateSpacer).hide(),$$(e.buttonDeleteSelected).hide(),$$(e.buttonDeleteSelectedSpacer).hide()}getBadgeFilters(){var e=this.ids,t=this.workspaceViews.filterConditions,i=0;t?.rules?.length&&(i=t.rules.length),void 0!==t&&($$(e.buttonFilter).define("badge",i||null),$$(e.buttonFilter).refresh())}getBadgeFrozenColumn(){var e=this.ids,t=this.workspaceViews.frozenColumnID,i=null;""!==t&&void 0!==t&&(i=c.getColumnIndex(t)),$$(e.buttonFrozen).define("badge",i),$$(e.buttonFrozen).refresh()}getBadgeHiddenFields(){var e=this.workspaceViews.hiddenFields;void 0!==e&&($$(this.ids.buttonFieldsVisible).define("badge",e.length||null),$$(this.ids.buttonFieldsVisible).refresh())}getBadgeSortFields(){var e=this.ids,t=(this.workspaceViews.sortFields||[]).filter((e=>""!=e.key));void 0!==t&&($$(e.buttonSort).define("badge",t.length||null),$$(e.buttonSort).refresh())}ready(){$$(this.ids.component)?.hideProgress?.()}async rowAdd(){var e=this.CurrentObject;if(e){var t=e.defaultValues();try{var i=await e.model().create(t);if(null==i)return;var n=this.mockDataCollection.$dc;n&&!n.exists(i.id)&&n.add(i,0)}catch(e){this.AB.notify.developer(e,{context:"ui_work_object_workspace:rowAdd(): error creating empty object",emptyObj:t});var s=this.AB.Label();webix.alert({title:s("Unable to create new row"),text:s("An administrator has already been alerted.")})}}}show(){$$(this.ids.component).show()}toolbarAddFields(){this.PopupNewDataFieldComponent.show()}toolbarButtonImport(){this.PopupImportObjectComponent.show()}toolbarButtonExport(e){this.PopupExportObjectComponent.show(e)}toolbarDeleteSelected(e){c.deleteSelected(e)}toolbarDefineLabel(e){this.PopupDefineLabelComponent.show(e)}toolbarFieldsVisible(e){this.PopupHideFieldComponent.show(e)}toolbarFilter(e,t){this.PopupFilterDataTableComponent.show(e,t)}toolbarFrozen(e){this.PopupFrozenColumnsComponent.show(e)}toolbarPermission(){console.error("TODO: toolbarPermission()")}toolbarMassUpdate(e){c.massUpdate(e)}toolbarSort(e,t){this.PopupSortFieldComponent.show(e,t)}async populateObjectWorkspace(e){$$(this.ids.toolbar).show(),$$(this.ids.selectedObject).show(),this.CurrentObjectID=e;var t=this.CurrentObject;this.isReadOnly=t?.isReadOnly??!1,this.workspaceViews.objectLoad(t);var i=this.workspaceViews.getCurrentView();this.mockDataCollection.datasource=t,c.objectLoad(t),d.objectLoad(t),h.objectLoad(t),this.isReadOnly||this.PopupNewDataFieldComponent.objectLoad(t),this.PopupDefineLabelComponent.objectLoad(t),this.PopupFilterDataTableComponent.objectLoad(t),this.PopupFrozenColumnsComponent.objectLoad(t),this.PopupHideFieldComponent.objectLoad(t),this.PopupSortFieldComponent.objectLoad(t),this.PopupImportObjectComponent.objectLoad(t),this.PopupExportObjectComponent.objectLoad(t),this._handler_show||(this._handler_show=()=>{this.PopupExportObjectComponent.setGridComponent(c.$grid)},c.on("show",this._handler_show)),this.PopupExportObjectComponent.setFilename(t.label),this.PopupViewSettingsComponent.objectLoad(t),this.refreshIndexes(),await this.switchWorkspaceView(i),this.refreshWorkspaceViewMenu(),this.refreshView()}clearObjectWorkspace(){$$(this.ids.noSelection).show(!1,!1)}queryLoad(e){this.objectLoad(e)}loadAll(){c.loadAll()}loadData(){var e={glue:"and",rules:[]};this.workspaceViews?.filterConditions[0]?.rules?.length>0?(e=this.workspaceViews.filterConditions[0].rules,this.workspaceViews.filterConditions.rules=this.workspaceViews.filterConditions[0].rules):this.workspaceViews?.filterConditions?.rules?.length>0&&(e=this.workspaceViews.filterConditions);var t=[];this.workspaceViews?.sortFields?.length>0&&(t=this.workspaceViews?.sortFields),this.mockDataCollection.datasource=this.CurrentObject,this.mockDataCollection.fromValues({settings:{datasourceID:this.CurrentObjectID,objectWorkspace:{filterConditions:e,sortFields:t}}}),this.mockDataCollection.filterCondition(e),this.updateFilterButton(e),this.mockDataCollection.refreshFilterConditions(e),this.mockDataCollection.clearAll();let i=this.workspaceViews.getCurrentView();"gantt"===i.type||"kanban"===i.type?(this.mockDataCollection.settings.loadAll=!0,this.mockDataCollection.loadData(0)):this.mockDataCollection.loadData(0,30).catch((e=>{this.toolbarFilter(this.$view);var t=e.toString();if("string"==typeof e)try{var i=JSON.parse(e);i.data&&i.data.sqlMessage&&(t=i.data.sqlMessage)}catch(e){}e.message&&(t=e.message);var n=this.ids;$$(n.error).show(),$$(n.error_msg).define("label",t),$$(n.error_msg).refresh(),this.AB.notify.developer(e,{context:"ui_work_object_workspace.loadData()",message:t,datacollection:this.mockDataCollection.toObj()})}))}async switchWorkspaceView(e){this.hashViews[e.type]&&(this.workspaceViews.setCurrentView(e.id),await this.hashViews[e.type].show(e),this.refreshWorkspaceViewMenu(),this.refreshToolBarView(),this.PopupFilterDataTableComponent.setFilter(e.filterConditions),this.PopupFrozenColumnsComponent.setValue(e.frozenColumnID||""),this.PopupFrozenColumnsComponent.setHiddenFields(e.hiddenFields),this.PopupHideFieldComponent.setSettings(e.hiddenFields),this.PopupHideFieldComponent.setFrozenColumnID(e.frozenColumnID||""),this.PopupSortFieldComponent.setSettings(e.sortFields),this.PopupExportObjectComponent.setHiddenFields(e.hiddenFields),this.workspaceViews.save(),this.loadData())}refreshToolBarView(){var e=this.ids;switch(this.workspaceViews.getCurrentView().type){case"grid":$$(e.buttonFieldsVisible).show(),$$(e.buttonFrozen).show(),$$(e.buttonSort).show(),$$(e.buttonFieldsVisibleSpacer).show(),$$(e.buttonFrozenSpacer).show(),$$(e.buttonSortSpacer).show();break;case"kanban":$$(e.buttonFieldsVisible).hide(),$$(e.buttonFrozen).hide(),$$(e.buttonSort).hide(),$$(e.buttonFieldsVisibleSpacer).hide(),$$(e.buttonFrozenSpacer).hide(),$$(e.buttonSortSpacer).hide()}this.getBadgeHiddenFields(),this.getBadgeFrozenColumn(),this.getBadgeSortFields(),this.getBadgeFilters(),$$(e.selectedObject).show(!0,!1),this.CurrentObject.isExternal||this.CurrentObject.isImported?$$(e.buttonAddField).disable():$$(e.buttonAddField).enable()}refreshWorkspaceViewMenu(){var e=this.workspaceViews.getCurrentView().id,t=this.workspaceViews.list().map((t=>({id:t.id,hash:t.type,value:t.name,isView:!0,$css:t.id===e?"selected":"",icon:`fa fa-${t.icon}`,submenu:t.isDefaultView?null:[{value:l("Edit"),icon:"fa fa-cog",viewId:t.id,action:"edit"},{value:l("Delete"),icon:"fa fa-trash",viewId:t.id,action:"delete"}]}))),i=$$(this.ids.viewMenu);i.clearAll(),i.define("data",t),i.refresh()}refreshIndexes(){let e=this.CurrentObject?.indexes()||[];webix.ui([],$$(this.ids.listIndex)),e.forEach((e=>{this.addNewIndex(e)}))}addNewIndex(e){$$(this.ids.listIndex).addView({view:"button",label:e.label||e.name,icon:"fa fa-key",css:"webix_transparent",type:"icon",width:160,click:()=>{this.PopupCustomIndex.open(this.CurrentObject,e)}})}async showSystemInfo(e){const t=e.getDbInfo(),i=this.AB.Webix.ui({view:"window",height:300,width:450,position:"center",modal:!0,resize:!0,head:{view:"toolbar",cols:[{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{i.close()}}]},body:{view:"property",id:this.ids.propertyFieldInfo,editable:!1,nameWidth:120,elements:[{label:"Database Information",type:"label"},{label:"Definition ID",type:"text",id:"DefinitionId"},{label:"Name",type:"text",id:"Field"},{label:"Type",type:"text",id:"Type"},{label:"Is Nullable",type:"text",id:"Null"},{label:"Key type",type:"text",id:"Key"},{label:"Default value",type:"text",id:"Default"},{label:"Extra",type:"text",id:"Extra"}]}});i.show();const n=$$(this.ids.propertyFieldInfo);this.AB.Webix.extend(n,this.AB.Webix.ProgressBar),n.showProgress({type:"icon"});try{const i=await t;i.DefinitionId=e.id,n.setValues(i)}catch(t){this.AB.notify.developer(t,{context:"Error trying to get the field information",fields:e.toObj()})}n.hideProgress()}get isReadOnly(){return this._isReadOnly??!1}set isReadOnly(e){this._isReadOnly=e,this.PopupViewSettingsComponent&&(this.PopupViewSettingsComponent.isReadOnly=e);const t=this.ids,i=$$(t.buttonAddField),n=$$(t.spaceAddField),s=$$(t.spaceLabel),o=$$(t.buttonImport),a=$$(t.spaceImport),r=$$(t.layoutIndex),l=$$(t.buttonRowNew);this._isReadOnly?(i?.hide(),n?.hide(),s?.hide(),o?.hide(),a?.hide(),r?.hide(),l?.hide()):(i?.show(),n?.show(),s?.show(),o?.show(),a?.show(),r?.show(),l?.show())}}(t,i)}function F(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ab_work_query"),this.QueryList=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_query_list"),this.ListComponent=c(e,{idBase:this.ids.component,labels:{addNew:"Add new query",confirmDeleteTitle:"Delete Query",title:"Queries",searchPlaceholder:"Query name"},menu:{copy:!1,exclude:!0}}),this.AddForm=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_query_list_newQuery",{tab:""}),this.selectNew=!0,this.BlankTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_query_list_newQuery_blank",{form:"",buttonSave:"",buttonCancel:"",object:""})}ui(){return{id:this.ids.component,header:i("Create"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Query name"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_query_list_newQuery_blank_name")}}},{id:this.ids.object,view:"richselect",label:i("Object"),name:"object",required:!0,placeholder:i("Select an object"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_query_list_newQuery_blank_object")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Query"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){t.CYPRESS_REF(this)}}}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$buttonSave=$$(this.ids.buttonSave),this.$objectList=$$(this.ids.object),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear())}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating Query: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.formClear(),this.$buttonSave.enable()}save(){this.$buttonSave.disable();var e=this.$form;if(e.clearValidation(),!e.validate())return this.$buttonSave.enable(),!1;let t=e.getValues(),i={name:t.name,label:t.name,joins:{alias:"BASE_OBJECT",objectID:t.object,links:[]}};this.emit("save",i)}show(){$$(this.ids.component)&&$$(this.ids.component).show()}onShow(e){if(this.$objectList&&e){let t=e.objectsIncluded().map((e=>({id:e.id,value:e.label})));this.$objectList.define("options",t),this.$objectList.refresh();let i=this.$objectList.getPopup();i.attachEvent("onShow",(()=>{i.define("width",300),i.resize()}))}this.$form&&this.$form.setValues({name:"",object:""})}}}(e),this.ImportTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_query_list_newQuery_import",{form:"",filter:"",queryList:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Existing"),body:{view:"form",id:this.ids.form,width:400,elements:[{cols:[{view:"icon",icon:"fa fa-filter",align:"left"},{view:"text",id:this.ids.filter,on:{onTimedKeyPress:()=>this.filter()}}]},{view:"list",id:this.ids.queryList,select:!0,height:200,minHeight:250,maxHeight:250,data:[],template:"<div>#label#</div>"},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>this.cancel()},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Import"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$filter=$$(this.ids.filter),this.$queryList=$$(this.ids.queryList),this.$buttonSave=$$(this.ids.buttonSave),this.$buttonCancel=$$(this.ids.buttonCancel),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}onShow(e){this.formClear();const t=e.queriesExcluded();this.$queryList.parse(t,"json")}filter(){let e=this.$filter.getValue();this.$queryList.filter("#label#",e)}save(){let e=this.$queryList.getSelectedItem();if(!e)return!1;this.$buttonSave.disable(),this.emit("save",e)}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear()),this.$queryList&&this.$queryList.clearAll()}onError(e){if(e){let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;let n=this.$form.getValues();webix.alert({title:i("Error creating Query: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.$buttonSave.enable()}}}(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new query"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},selectNewQuery:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui(),this.ImportTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((t=>{var i=t.getAttribute("button_id");e.ClassUI.CYPRESS_REF(t,`${i}_tab`)}))}}}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);let t=[];return["BlankTab","ImportTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{if(e.id)return this.import(e,i);this.save(e,i)}))})),Promise.all(t)}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}async import(e,t){this.busy();try{await this.CurrentApplication.queryInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}async save(e,t){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;let n=this.AB.queryNew(e),s=n.isValid();if(s.fail())return this[t].emit("save.error",s),!1;n.createdInAppID||(n.createdInAppID=this.CurrentApplicationID),this.busy();try{let e=await n.save();await this.CurrentApplication.queryInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}show(e){null!=e&&(this.selectNew=e),this.$component&&this.$component.show();const t=$$(this.ids.tab).getValue();this.switchTab(t)}hide(){this.$component&&this.$component.hide()}busy(){this.$component&&this.$component.showProgress()}ready(){this.$component&&this.$component.hideProgress()}switchTab(e){e!=this.BlankTab?.ui()?.body?.id&&e?e==this.ImportTab?.ui()?.body?.id&&this.ImportTab?.onShow?.(this.CurrentApplication):this.BlankTab?.onShow?.(this.CurrentApplication)}}}(e)}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewQuery(e)}));var t=[];t.push(this.ListComponent.init(e)),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("addNew",(e=>{this.clickNewQuery(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),t.push(this.AddForm.init(e)),this.AddForm.on("cancel",(()=>{this.AddForm.hide()})),this.AddForm.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)})),await Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.ListComponent.dataLoad(e?.queriesIncluded()),this.AddForm.applicationLoad(e)}warningsRefresh(){if(this.CurrentApplication){let e=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.queriesIncluded()),this.ListComponent.selectItem(e.id)}}clickNewQuery(){this.AddForm.show()}async exclude(e){this.ListComponent.busy();var t=this.CurrentApplication;await t.queryRemove(e),this.ListComponent.dataLoad(t.queriesIncluded()),this.emit("selected",null)}ready(){this.ListComponent.ready()}select(e){this.ListComponent.select(e.id)}}}(e),this.QueryWorkspace=function(e,t){const i=(0,n.Z)(e),s=e.Config.uiSettings();var o=i.L();const r="ui_work_query_workspace",l=function(e,t){const i=(0,n.Z)(e),s=e.Config.uiSettings();var o=i.L();return new class extends i{constructor(t={}){super("ui_work_query_workspace_design",{tree:"",tabObjects:"",depth:"",datatable:"",selectedObject:"",grouping:"",hidePrefix:"",filter:""}),this.settings=t,this.mockDatacollection=null,this.CurrentQueryID=null,this.DataFilter=e.filterComplexNew(this.ids.filter,{isSaveHidden:!0}),this.DataFilter.init({showObjectName:!0}),this.DataFilter.on("changed",(()=>{this.DataFilter.isComplete()&&(this.__saveInProcess||(this.__saveInProcess=this.save().finally((()=>{this.__saveInProcess=null}))))}))}ui(){const e=this,t=this.ids;return{view:"scrollview",id:t.component,body:{rows:[{id:t.selectedObject,type:"form",rows:[{cols:[{rows:[{view:"label",label:o("Manage Objects"),css:"ab-query-label"},{view:"tree",id:t.tree,css:"ab-tree",template:"{common.icon()} {common.checkbox()} #value#",data:[],on:{onItemClick:function(e,t,i){this.getItem(e).disabled||(this.isChecked(e)?this.uncheckItem(e):this.checkItem(e))},onItemCheck:(e,t,i)=>{this.checkObjectLink(e,t)},onBeforeOpen:function(i){let n=this.getItem(i);if(-1===n.$count){$$(t.tree).showProgress({type:"icon"});let s=e.getChildItems(n.objectLinkId,i);$$(t.tree).parse(s.treeItems),$$(t.tree).hideProgress()}}}}]},{view:"resizer",borderless:!0},{gravity:3,rows:[{view:"label",label:o("Manage Fields"),css:"ab-query-label"},{view:"tabview",id:t.tabObjects,tabbar:{tabMinWidth:240,css:"webix_dark",type:"bottom",bottomOffset:0},cells:[{}],multiview:{animate:!1,on:{onViewChange:(e,t)=>{this.setSelectedFields(t)}}}}]}]},{id:t.grouping,view:"checkbox",label:o("Grouping"),labelWidth:s.labelWidthXLarge,on:{onChange:()=>{this.save()}}},{id:t.hidePrefix,view:"checkbox",label:o("Hide prefix labels"),labelWidth:s.labelWidthXLarge,on:{onChange:()=>{this.save()}}},{view:"label",label:o("Manage Filters"),css:"ab-query-label"},{view:"button",label:o("Filters"),icon:"fa fa-filter",type:"button",click:function(){e.DataFilter.popUp(this.$view,{pos:"bottom"})}},{id:t.datatable,view:"treetable",minHeight:280,dragColumn:!0,columns:[],data:[],on:{onAfterColumnDrop:()=>{this.save()}}}]}]}}}init(e){this.AB=e;const t=this.ids;return webix.extend($$(t.tree),webix.ProgressBar),webix.extend($$(t.tabObjects),webix.ProgressBar),webix.extend($$(t.datatable),webix.ProgressBar),this.DataFilter.init({showObjectName:!0}),Promise.resolve()}clearWorkspace(){}populateQueryWorkspace(e){console.error("DEPRECIATED! Use queryLoad() instead"),this.queryLoad(e)}queryLoad(e){super.queryLoad(e);let t=this.CurrentQuery;if(null==t)return void this.clearWorkspace();this.mockDatacollection=this.AB.datacollectionNew({query:[t.toObj()],settings:{datasourceID:t.id}}),this.mockDatacollection.datasource=t;const i=t.objectBase(),n=this.ids;$$(n.selectedObject).show(),this.refreshTree();let s=t.joins().links||[];const o=$$(n.tabObjects);o?.showProgress({type:"icon"}),o.addView({body:{id:"temp"}}),o.getTabbar().config.options.map((e=>e.id)).forEach((e=>{"temp"!=e&&o.removeView(e)}));var a=o.getMultiview();if(a.getChildViews().map((e=>e)).forEach((e=>{e&&"temp"!=e.config.id&&a.removeView(e)})),!i)return;let r=this.templateField({object:i,isTypeHidden:!0,aliasName:"BASE_OBJECT"});o.addView(r),o.setValue(r.id),this.setSelectedFields("BASE_OBJECT");var l=(e,i)=>{(i||[]).forEach((i=>{if(!e)return;if(!i.fieldID)return;var n=e.fieldByID(i.fieldID);if(!n)return;var s=t.objectByID(n.settings.linkObject);if(!s)return;let a=this.templateField({field:n,joinType:i.type,aliasName:i.alias});o.addView(a),this.setSelectedFields(i.alias),l(s,i.links)}))};l(i,s),$$(n.grouping).define("value",e.settings.grouping),$$(n.grouping).refresh(),$$(n.hidePrefix).define("value",e.settings.hidePrefix),$$(n.hidePrefix).refresh(),o.removeView("temp"),o.adjust(),o.hideProgress(),this.refreshFilter(),this.refreshDataTable()}getChildItems(e,t){let i={data:[]},n=this.getObject(e);return t&&(i.parent=t),n.connectFields().forEach((e=>{let t=this.getObject(e.settings.linkObject);if(null==t)return;if(!this.CurrentApplication.isSystemObj&&t.isSystemObject)return;let n=e.id;var s=`${t.label} (${e.label})`;i.data.push({value:s,fieldID:n,objectId:t.id,objectLinkId:e.settings.linkObject,checked:!1,disabled:!1,open:!1,webix_kids:!0})})),{object:n,treeItems:i}}aliasName(){return this.AB.uuid().replace(/[^a-zA-Z0-9]+/g,"").substring(0,8)}save(e=null){let t=this.ids,i=this.CurrentQuery;return new Promise(((n,s)=>{var o=$$(t.tree);let a={alias:"BASE_OBJECT",objectID:i.objectBase().id,links:[]},r={};(o.getChecked().map((e=>o.getItem(e))).sort(((e,t)=>e.$level-t.$level))||[]).forEach((e=>{let i=e.alias;i||(i=this.aliasName(),o.updateItem(e.id,{alias:i}));let n="innerjoin",s=$$(t.tabObjects).getMultiview().getChildViews().filter((e=>e.config.id==i))[0];s&&(n=s.queryView({name:"joinType"}).getValue()||"innerjoin");let l=a.links,c={alias:i,fieldID:e.fieldID,type:n,links:[]};if(e.$level>1){let t=o.getParentId(e.id),i=o.getItem(t);l=r[i.alias].links}l.push(c),r[i]=c})),i.importJoins(a),null==e&&(e=$$(t.datatable).config.columns.map((e=>{let t=i.objectByAlias(e.alias);if(t)return!t.fieldByID(e.fieldID)||"BASE_OBJECT"!=e.alias&&i.links((t=>t.alias==e.alias)).length<1?void 0:{alias:e.alias,fieldID:e.fieldID}})).filter((e=>null!=e))),i.importFields(e),i.where=this.DataFilter.getValue(),i.settings={grouping:$$(t.grouping).getValue(),hidePrefix:$$(t.hidePrefix).getValue()},i.save().then((()=>i.migrateCreate())).then((()=>{this.refreshDataTable(),this.warningsRefresh(i),n()})).catch((e=>{this.AB.notify.developer(e,{context:`${t.component}:save(): Error saving Query`,query:i.toObj()}),s(e)}))}))}checkObjectLink(e,t){var i=$$(this.ids.tree);i.blockEvent();var n=e;if(t)for(;i.getParentId(n);)(n=i.getParentId(n))!=e&&i.checkItem(n);else i.data.eachSubItem(n,(function(t){t.id!=e&&i.uncheckItem(t.id)}));this.save().then((()=>{this.populateQueryWorkspace(this.CurrentQuery)})),i.unblockEvent()}depthChange(){this.save().then((()=>{this.populateQueryWorkspace(this.CurrentQuery)}))}setSelectedFields(e){let t=$$(e).queryView({name:"fields"});if(t){let i=this.CurrentQuery.fields((t=>t.alias==e),!0).map((e=>e.id));t.setValue(i)}}checkFields(){let e=this.ids;var t=[];$$(e.tabObjects).getMultiview().getChildViews().forEach((e=>{let i=e.queryView({name:"fields"});if(i&&i.getValue()){let n=i.getValue().split(",").map((t=>({alias:e.config.aliasName,fieldID:t})));t=t.concat(n)}}));var i=$$(e.datatable).config.columns.map((e=>e.fieldID));t.sort(((e,t)=>{var n=i.indexOf(e.fieldID),s=i.indexOf(t.fieldID);return n<0&&(n=999),s<0&&(s=999),n-s})),this.save(t).then((()=>{this.refreshFilter()}))}templateField(e){if(null==e.object&&null==e.field)throw new Error("Invalid params");var t=e.object?e.object:this.CurrentQuery.objectByID(e.field.settings.linkObject),i=t.fields((e=>e.fieldSupportQuery()),!0).map((e=>({id:e.id,value:e.label})));let n="";e.field&&(n=` (${e.field.label})`);var s=`${t.label}${n}`;let a=e.aliasName;return{header:s,body:{id:a,aliasName:a,type:"space",css:"bg-white",rows:[{view:"select",name:"joinType",label:o("join records by"),labelWidth:200,placeholder:o("Choose a type of table join"),hidden:1==e.isTypeHidden,value:e.joinType||"innerjoin",options:[{id:"innerjoin",value:o("Returns records that have matching values in both tables (INNER JOIN).")},{id:"left",value:o("Return all records from the left table, and the matched records from the right table (LEFT JOIN).")},{id:"right",value:o("Return all records from the right table, and the matched records from the left table (RIGHT JOIN).")},{id:"fullouterjoin",value:o("Return all records when there is a match in either left or right table (FULL JOIN)")}],on:{onChange:()=>{this.save()}}},{view:"dbllist",name:"fields",list:{height:300},labelLeft:o("Available Fields"),labelRight:o("Included Fields"),labelBottomLeft:o("Move these fields to the right to include in data set."),labelBottomRight:o("These fields will display in your final data set."),data:i,on:{onChange:()=>{this.checkFields()}}},{fillspace:!0}]}}}refreshTree(){let e=(t,i,s,o=0)=>{(s||[]).forEach((s=>{if(!i)return;let a=i.fieldByID(s.fieldID);if(!a)return;let r={fieldID:a.id};null!=o&&(r.$parent=o);let l=null;if((t.find(r)||[]).forEach((e=>{if(e.$parent){let i=t.getItem(e.$parent);i&&i.checked&&(l=e)}else l=e})),l){t.updateItem(l.id,{alias:s.alias,checked:!0,open:!0});let i=this.getChildItems(a.settings.linkObject,l.id);$$(n.tree).parse(i.treeItems),e(t,i.object,s.links,l.id)}}))};const t=this.CurrentQuery.objectBase();let i=this.CurrentQuery.joins().links||[],n=this.ids;if($$(n.tree).clearAll(),$$(n.tree).showProgress({type:"icon"}),t){let s=this.getChildItems(t.id);$$(n.tree).parse(s.treeItems),e($$(n.tree),t,i),$$(n.tree).hideProgress()}}refreshFilter(){let e=this.CurrentQuery;this.DataFilter.fieldsLoad(e?e.fields():[],e),this.DataFilter.setValue(e.where)}refreshDataTable(){if(null==this.mockDatacollection)return;let e=this.CurrentQuery;if(!e)return;let t=$$(this.ids.datatable);t.clearAll();var i=e.columnHeaders(!1,!1);t.refreshColumns(i),this.mockDatacollection.clearAll(),this.mockDatacollection.datasource=e,this.mockDatacollection.fromValues({query:[e.toObj()],settings:{datasourceID:e.id,objectWorkspace:{sortFields:e.objectWorkspace?.sortFields??[]}}}),this.mockDatacollection.datasource=e,this.mockDatacollection.unbind(t),this.mockDatacollection.bind(t),t.showProgress({type:"icon"}),this.mockDatacollection.loadData(0,50,(()=>{})).then((()=>{this.mockDatacollection.bind(t)})).catch((e=>{this.AB.alert({title:o("Error getting Query"),type:"alert-error",text:`<span style="font-family:monospace">${e.message}</span>`})}))}getObject(e){let t=this.CurrentQuery.objectByID(e);return t||(t=this.AB.objectByID(e),t||void 0)}show(){$$(this.ids.component).show()}}(void 0)}(e),c=B(e,`${r}_display`,{isReadOnly:!0,showWarnings:!1});var h=a(e,`${r}_view_warnings`,t);return new class extends i{constructor(e={}){super(r,{multiview:"",toolbar:"",modeButton:"",noSelection:"",run:"",design:""}),this.settings=e}ui(){var e=this.ids;return{view:"multiview",animate:!1,cells:[{id:e.noSelection,rows:[{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-filter'></div>"},{view:"label",align:"center",label:o("Select a query to work with.")},{cols:[{},{view:"button",css:"webix_primary",label:o("Add new query"),type:"form",autowidth:!0,click:()=>{this.emit("query.add")}},{}]},{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile}]},{id:e.component,rows:[{id:e.toolbar,view:"tabbar",css:"webix_dark",type:"bottom",borderless:!1,bottomOffset:0,options:[{id:e.design,value:o("Build Query"),icon:"fa fa-sliders",type:"icon"},{id:e.run,value:o("View Query"),icon:"fa fa-table",type:"icon"}],on:{onChange:(e,t)=>{e!=t&&this.changeMode(e)}}},{height:10},{id:e.multiview,view:"multiview",animate:!1,cells:[l.ui(),c.ui()]},h.ui()]}]}}init(e){return this.AB=e,this.warningsPropogate([l,c]),this.on("warnings",(()=>{h.show(this.CurrentQuery)})),Promise.all([l.init(e),c.init(e)])}changeMode(e){let t=this.ids;$$(this.ids.component).show(),$$(t.toolbar).show(!1,!1),e==t.run?(c.show(),c.populateObjectWorkspace(this.CurrentQueryID)):(l.show(!0),l.queryLoad(this.CurrentQuery))}applicationLoad(e){super.applicationLoad(e),this.clearWorkspace(),l.applicationLoad(e),c.applicationLoad(e)}clearWorkspace(){$$(this.ids.noSelection).show(!1,!1),l.clearWorkspace()}loadAll(){c.loadAll()}queryLoad(e){super.queryLoad(e),h.show(e),l.queryLoad(e),c.queryLoad(e),e?($$(this.ids.component).show(),l.show(!0)):this.clearWorkspace()}resetTabs(){$$(this.ids.toolbar)?.setValue?.(this.ids.design)}}(t)}(e)}ui(){return{id:this.ids.component,type:"space",cols:[this.QueryList.ui(),{view:"resizer"},this.QueryWorkspace.ui()]}}init(e){return this.AB=e,this.QueryList.on("selected",(e=>{this.select(e)})),this.QueryWorkspace.on("query.add",(()=>{this.QueryList.emit("addNew")})),this.warningsPropogate([this.QueryList,this.QueryWorkspace]),this.on("warnings",(()=>{this.QueryList.warningsRefresh()})),Promise.all([this.QueryWorkspace.init(e),this.QueryList.init(e)])}applicationLoad(e){super.applicationLoad(e),this.QueryWorkspace.clearWorkspace(),this.QueryList.applicationLoad(e),this.QueryWorkspace.applicationLoad(e)}show(){$$(this.ids.component).show(!1,!1);var e=this.CurrentApplication;e&&this.QueryList?.applicationLoad(e),this.QueryList?.ready(),this._lastSelectedQuery&&(this.QueryList.select(this._lastSelectedQuery),this.select(this._lastSelectedQuery))}select(e){this._lastSelectedQuery=e,this.QueryWorkspace.resetTabs(),this.QueryWorkspace.queryLoad(e)}}}function I(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_interface_list_newPage_blank",{form:"",buttonSave:"",buttonCancel:"",parentList:""})}ui(){return{id:this.ids.component,header:i("Blank"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"select",id:this.ids.parentList,label:i("Parent Page"),name:"parent",options:[],placeholder:i("Root Page"),labelWidth:110},{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Page name"),labelWidth:110,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"ui_work_interface_list_newPage_blank_name")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Page"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]}}}init(e){return this.AB=e,this.$form=$$(this.ids.form),this.on("save.error",(e=>{this.AB.notify.developer(e,{context:"ui_work_interface_list_newPage:init(): there was an error saving the values from our form."})})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}applicationLoad(e){super.applicationLoad(e);var t=[{id:"-",value:i("Root page")}],n=function(e,i){i=i||"",t.push({id:e.urlPointer(),value:i+e.label}),e.pages().forEach((function(e){n(e,i+"-")}))};e.isWebApp&&e.pages().forEach((function(e){n(e,"")})),$$(this.ids?.parentList)?.define&&($$(this.ids.parentList).define("options",t),$$(this.ids.parentList).refresh())}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form.clearValidation(),this.$form.clear()}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();this.AB.notify.developer(e,{context:"ui_work_interface_list_newPage: the entered data is invalid",base:n}),webix.alert({title:i("Error creating Page: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}save(){var e=$$(this.ids.buttonSave);e.disable();var t=this.$form;if(t.clearValidation(),!t.validate())return e.enable(),!1;var i=t.getValues();"-"===i.parent?i.parent=null:i.parent&&(i.parent=this.CurrentApplication.urlResolve(i.parent)),i.primaryColumnName="uuid",this.emit("save",i)}show(){$$(this.ids.component)&&$$(this.ids.component).show()}}}function j(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ab_work_interface_list_newInterface",{tab:""}),this.selectNew=!0,this.BlankTab=new I(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:i("Add new interface"),selectNewInterface:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((t=>{var i=t.getAttribute("button_id");e.ClassUI.CYPRESS_REF(t,`${i}_tab`)}))}}}},on:{onBeforeShow:()=>{var e=$$(this.ids.tab).getValue();this.switchTab(e)}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component),this.$form=$$(this.ids.form);var t=[];["BlankTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{this.save(e,i)}))})),await Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.BlankTab.applicationLoad(e)}hide(){this?.$component?.hide()}busy(){this?.$component?.showProgress()}ready(){this?.$component?.hideProgress()}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}async save(e,t){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;if(e){var n=null;if((n=e.useParent&&e.parent?e.parent:e.parent?e.parent.pageNew(e):this.CurrentApplication.pageNew(e)).isValid){var s=n.isValid();if(s.fail())return this[t].emit("save.error",s),!1}n.createdInAppID||(n.createdInAppID=this.CurrentApplication.id),this.busy();try{var o=await n.save();this[t].emit("save.successful",o),this.done(o)}catch(e){this.ready(),await this.CurrentApplication.pageRemove(n),this[t].emit("save.error",e)}}}show(){this.$component?.show()}switchTab(e){}}}function M(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ab_work_interface_list_copyInterface",{form:"",buttonSave:"",buttonCancel:""}),this.ids.parentList={}}ui(t){return{view:"window",id:this.ids.component,width:400,position:"center",modal:!0,head:i("Copy interface"),selectNewInterface:!0,body:{view:"form",id:this.ids.form,rules:{},elements:[{view:"select",id:this.ids.parentList,label:i("Parent Page"),name:"parent",options:[],placeholder:i("Root Page"),labelWidth:110},{view:"text",label:i("Name"),name:"name",required:!0,placeholder:`${i("{0} - copy",[t])}`,labelWidth:110,on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,"ui_work_interface_list_newPage_blank_name")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Paste Page"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}]}}}async init(e,t){this.AB=e,this.data=t,console.log(t),webix.ui(this.ui(t.name)),webix.extend($$(this.ids.component),webix.ProgressBar),this.$form=$$(this.ids.form),this.$component=$$(this.ids.component),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()}))}applicationLoad(e){super.applicationLoad(e);var t=[{id:"-",value:i("Root page")}],n=function(e,i){i=i||"",t.push({id:e.id,value:i+e.label}),e.pages().forEach((function(e){n(e,i+"-")}))};e.pages().forEach((function(e){n(e,"")})),$$(this.ids?.parentList)?.define("options",t),$$(this.ids?.parentList)?.refresh()}hide(){this?.$component?.hide()}cancel(){this.formClear(),this.emit("cancel")}busy(){this?.$component?.showProgress()}ready(){this?.$component?.hideProgress()}done(e){this.ready(),this.hide(),this.emit("save",e)}async save(){var e=$$(this.ids.buttonSave);e.disable(),this.busy();var t=this.$form;if(t.clearValidation(),!t.validate())return e.enable(),this.ready(),!1;var n=t.getValues();if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this.emit("save.error",!0),!1;if(!n)return;"-"===n.parent?n.parent=null:n.parent&&(n.parent=this.CurrentApplication.urlResolve(n.parent));var s=this.data;let o=await s.copy(null,n.parent,{newName:n.name}).catch((e=>{this.ready(),this.AB.notify.developer(e,{context:"ui_interface_list_copyPage:save(): Error saving copied page",base:s})}));this.emit("save.successful",o),this.done(o)}show(){this?.$component?.show()}formClear(){this?.$form.clearValidation(),this?.$form.clear()}onError(e){if(e){var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();this.AB.notify.developer(e,{context:"ui_interace_list: error",base:n}),webix.alert({title:i("Error creating Page: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}$$(this.ids.buttonSave).enable()}onSuccess(){this.formClear(),$$(this.ids.buttonSave).enable()}}}var Q=i(3759);function W(e){const t=(0,n.Z)(e),s=t.L();var o=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_interface_workspace_editor_components",{popup:"",list:""})}ui(){return{id:this.ids.component,css:"webix_primary",view:"button",type:"form",label:i("Add Widget"),align:"center",autowidth:!0,on:{onItemClick:()=>{this.showPopup()}}}}init(e){this.AB=e;let t=this.ids,n=this;webix.ui({view:"window",id:t.popup,modal:!0,width:600,height:550,select:!1,resize:!0,position:"center",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add Widget"),css:"modal_title",align:"center"},{view:"button",label:"Close",autowidth:!0,align:"center",click:()=>{this.hidePopup()}}]},body:{id:t.list,view:"dataview",css:"ab-datacollection-table borderless",borderless:!0,xCount:5,yCount:4,type:{borderless:!0,width:100,height:100},template:(e,t)=>this.template(e,t),on:{onItemClick:function(e){var t=this.getItem(e);n.addWidget(t)}}}})}show(){$$(this.ids.component).show()}hide(){$$(this.ids.component).hide()}showPopup(){$$(this.ids.popup).show()}hidePopup(){$$(this.ids.popup).hide()}addWidget(e){const t=e.newInstance(this.CurrentView.application,this.CurrentView);this.emit("widget.adding"),t.save().then((()=>{this.emit("widget.add"),this.emit("warnings")})),this.hidePopup()}template(e){if(e.common){var t=e.common().label;return t||(t=i(e.common().labelKey)),`<div class='ab-component-in-page'><i class='fa fa-2x fa-${e.common().icon}' aria-hidden='true'></i><br/>${t}</div>`}return e.label}viewLoad(e){super.viewLoad(e);let t=this.ids;var i=$$(t.list),n=$$(t.component),s=this.CurrentView.componentList();i.clearAll(),s&&s.length>0?(i.parse(s),n.show()):n.hide(),i.refresh()}}}(e),a=function(e){const t=(0,n.Z)(e),s=t.L(),o=function(e){const t=[];return[i(3759),i(8442),i(1298),i(6062),i(3725),i(3121),i(5250),i(8971),i(760),i(4713),i(2761),i(6720),i(1926),i(5903),i(2442),i(559),i(2363),i(803),i(5084),i(9074),i(7895),i(4826),i(6629),i(302),i(5694),i(5025),i(2279),i(7912)].forEach((i=>{const n=i.default(e);t.push(n)})),e.plugins().forEach((i=>{i.editor&&t.push(i.editor(e,Q.default))})),{editors:function(e=(()=>!0)){return t.filter(e)}}}(e);return new class extends t{constructor(){super("ui_work_interface_workspace_editor_layout",{editArea:"",editAreaContainer:"",editAreaLeft:"",editAreaRight:"",editAreaTop:"",editAreaBottom:"",editAreaSamplePopup:""}),this.CurrentViewMode=1,this._editorsByType={}}ui(){let e=this.ids;return{view:"scrollview",id:e.component,body:{cols:[{id:e.editAreaLeft,width:1},{id:e.editAreaContainer,type:"clean",rows:[{id:e.editAreaTop,height:1},{id:e.editAreaSamplePopup,view:"toolbar",css:"webix_dark",hidden:!0,cols:[{},{view:"label",label:s("Sample Popup")},{}]},{id:e.editArea,view:"layout",borderless:!0,rows:[]},{id:e.editAreaBottom,height:1}]},{id:e.editAreaRight,width:1}]}}}init(e){this.AB=e;let t=$$(this.ids.editArea);return t&&webix.extend(t,webix.ProgressBar),o.editors().forEach((e=>{this._editorsByType[e.key]=e})),Promise.resolve()}show(){$$(this.ids.component).show()}async viewLoad(e){this.currentEditor?.detatch?.(),super.viewLoad(e);let t=this.ids;var i;if($$(t.editArea).getChildViews().forEach((e=>{$$(t.editArea)?.removeView(e)})),"preview"==this.CurrentViewMode)i=e.component(),"popup"==this.CurrentView.settings.type&&this.CurrentView.settings.popupWidth&&this.CurrentView.settings.popupHeight?($$(t.editAreaContainer).define({width:parseInt(this.CurrentView.settings.popupWidth)}),$$(t.editArea).define({height:parseInt(this.CurrentView.settings.popupHeight)}),webix.html.addCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.addCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.addCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.addCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:0}),$$(t.editAreaRight).define({width:0}),$$(t.editAreaTop).define({height:0}),$$(t.editAreaBottom).define({height:0}),$$(t.editAreaSamplePopup).show()):"page"==this.CurrentView.settings.type&&1==this.CurrentView.settings.fixedPageWidth&&this.CurrentView.settings.pageWidth?($$(t.editAreaContainer).define({width:parseInt(this.CurrentView.settings.pageWidth)}),$$(t.editArea).define({height:0}),webix.html.removeCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:0}),$$(t.editAreaRight).define({width:0}),$$(t.editAreaTop).define({height:1}),$$(t.editAreaBottom).define({height:1}),$$(t.editAreaSamplePopup).hide()):($$(t.editAreaContainer).define({width:0}),$$(t.editArea).define({height:0}),webix.html.removeCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:1}),$$(t.editAreaRight).define({width:1}),$$(t.editAreaTop).define({height:1}),$$(t.editAreaBottom).define({height:1}),$$(t.editAreaSamplePopup).hide());else{let n=this._editorsByType[e.key];null==n&&(n=this._editorsByType._default),i=new n(e),await i.viewLoad(e),$$(t.editAreaContainer).define({width:0}),$$(t.editArea).define({height:0}),webix.html.removeCss($$(t.editAreaLeft).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaRight).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaTop).getNode(),"preview_item"),webix.html.removeCss($$(t.editAreaBottom).getNode(),"preview_item"),$$(t.editAreaLeft).define({width:1}),$$(t.editAreaRight).define({width:1}),$$(t.editAreaTop).define({height:1}),$$(t.editAreaBottom).define({height:1}),$$(t.editAreaSamplePopup).hide()}$$(t.editArea).addView(i.ui()),i.init(this.AB,2),i.on("view.edit",(e=>{this.emit("view.load",e)})),i.on("view.destroyed",(()=>{this.emit("view.load",this.CurrentView),this.emit("warnings")})),i.onShow&&i.onShow(),this.currentEditor=i,setTimeout((()=>{$$(t.component).adjust(),$$(t.editAreaContainer).adjust()}),150)}viewModeChange(e){this.CurrentViewMode=e}busy(){let e=$$(this.ids.editArea);e?.disable(),e?.showProgress({type:"icon"})}ready(){let e=$$(this.ids.editArea);e?.enable(),e?.hideProgress()}}}(e);return new class extends t{constructor(){super("ui_work_interface_workspace_editor",{toolbar:"",toolbarMap:"",toolbarViewMode:"",toolbarViewPage:"",layoutView:"",dataView:"",noContent:""}),this.CurrentViewPart="layout",this.CurrentViewMode=0,this.PreviousViews=[],this._handlerViewUpdate=()=>{this.viewLoad(this.CurrentView)}}ui(){let e=this.ids,t=this;return{id:e.component,view:"layout",borderless:!1,rows:[{id:e.toolbar,view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"button",type:"icon",icon:"fa fa-arrow-left",autowidth:!0,click:()=>{this.buttonBack()}},{id:e.toolbarMap,view:"list",layout:"x",borderless:!0,multiselect:!1,select:!1,scroll:!1,padding:0,css:"ab_breadcrumb",template:function(e){let i="";return(e.warningsAll?.()||[]).length>0&&(i=t.WARNING_ICON),'<span class="fa fa-chevron-right" aria-hidden="true"></span> '+e.label+i},on:{onItemClick:e=>{this.pageMap(e)}}},{view:"icon",icon:"fa fa-info-circle",tooltip:s('Check "Preview" to see what your layout will look like, Click "Add Widget" to add new items to the page.'),on:{onItemClick:()=>{this.infoAlert()}}}]},{view:"layout",type:"space",css:"gray",cols:[{id:e.toolbarViewMode,view:"checkbox",labelRight:s("Preview"),labelWidth:0,width:85,on:{onChange:(e,t)=>{this.viewModeChange(e,t)}}},{},o.ui()]},a.ui()]}}init(e){this.AB=e;var t=[];return $$(this.ids.toolbarViewMode).setValue(this.CurrentViewMode),t.push(a.init(e)),t.push(o.init(e)),o.on("widget.adding",(()=>{a.busy()})),o.on("widget.add",(()=>{this.viewLoad(this.CurrentView),a.ready()})),a.on("view.load",(e=>{this.emit("view.load",e)})),this.warningsPropogate([a,o]),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),a.applicationLoad(e),o.applicationLoad(e)}buttonBack(){if(this.PreviousViews.length>0){var e=this.PreviousViews.pop();this.CurrentViewPart="layout",this.emit("view.load",e)}else"data"==this.CurrentViewPart&&(this.CurrentViewPart="layout",this.emit("view.load",this.CurrentView))}pageMap(e){var t=$$(this.ids.toolbarMap).getItem(e);this.CurrentViewPart="layout",this.emit("view.load",t)}infoAlert(){webix.alert({title:s("Tip"),text:s('Check "Preview" to see what your layout will look like, Click "Add Widget" to add new items to the page.')})}show(){$$(this.ids.component).show()}viewLoad(e){this.CurrentView&&e&&e.id!=this.CurrentView.id&&(this.PreviousViews.push(this.CurrentView),this.PreviousViews.length>50&&this.PreviousViews.shift()),super.viewLoad(e),this.CurrentView&&this.CurrentView.removeListener("properties.updated",this._handlerViewUpdate).once("properties.updated",this._handlerViewUpdate);let t=$$(this.ids.toolbarMap);t.clearAll(),t.parse(e.allParents()),t.refresh(),a.viewLoad(e),a.show(),o.viewLoad(e)}viewModeChange(e,t){e!=t&&(e=1==e?"preview":"block",this.CurrentViewMode=e,a.viewModeChange(this.CurrentViewMode),this.CurrentView&&this.viewLoad(this.CurrentView))}}}var N=i(7056);function Z(e){var t=function(e){var t=o(e),i=new j(e),s=new M(e);const a=e.Config.uiSettings(),r=(0,n.Z)(e);var l=r.L();return new class extends r{constructor(){var e="ui_work_interface_list";super(e,{list:"",buttonNew:""}),this.EditPopup=new t(e),this.viewList=new webix.TreeCollection}ui(){var t=this.ids;return{id:t.component,rows:[{view:"unitlist",uniteBy:l("Pages"),height:34,data:[" "],type:{height:0,headerHeight:35}},{view:e._App.custom.edittree.view,id:t.list,width:a.columnWidthLarge,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",css:"ab-tree-ui",template:(e,t)=>this.templateListItem(e,t),type:{iconGear:"<span class='webix_icon fa fa-cog'></span>"},on:{onAfterRender:()=>{this.onAfterRender()},onAfterSelect:e=>{this.onAfterSelect(e)},onAfterOpen:()=>{this.onAfterOpen()},onAfterClose:()=>{this.onAfterClose()},onBeforeEditStop:(e,t)=>{this.onBeforeEditStop(e,t)},onAfterEditStop:(e,t,i)=>{this.onAfterEditStop(e,t,i)}},onClick:{"ab-page-list-edit":(e,t,i)=>{this.clickEditMenu(e,t,i)}}},{view:"button",css:"webix_primary",id:t.buttonNew,type:"form",value:l("Add new Page"),click:()=>{this.emit("clickNewView")}}]}}async init(e,t){this.AB=e,this.on("clickNewView",(e=>{this.clickNewView(e)})),$$(this.ids.component)&&$$(this.ids.component).adjust();let n=$$(this.ids.list);this.ListComponent=n,n&&(webix.extend(n,webix.ProgressBar),n.data.unsync(),n.data.sync(this.viewList),n.adjust()),await this.EditPopup.init(e,{hideExclude:!0}),this.EditPopup.menuOptions([{label:l("Rename"),icon:"fa fa-pencil-square-o",command:"rename"},{label:l("Copy"),icon:"fa fa-files-o",command:"copy"},{label:l("Delete"),icon:"fa fa-trash",command:"delete"}]),this.EditPopup.on("click",(e=>{switch(e){case"delete":this.remove();break;case"copy":this.copy();break;case"rename":this.rename()}})),await i.init(e),i.on("cancel",(()=>{i.hide()})),i.on("save",((e,t)=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)})),s.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.callbackNewPage(e),this.ListComponent.select(e.id),this.listReady()})),s.on("cancel",(()=>{s.hide(),this.listReady()}))}addNew(){this.clickNewView(!0)}applicationLoad(e){super.applicationLoad(e),this.listBusy(),this.viewList.clearAll();var t=(e,i,n)=>{e&&(this.viewList.add(e,i,n),e.pages().forEach(((i,n)=>{t(i,n,e.id)})))};e.pages().forEach(((e,i)=>{t(e,i)}));var n=$$(this.ids.list);n.refresh(),n.unselectAll(),this.listReady(),i.applicationLoad(e),s.applicationLoad(e)}clickNewView(){i.show()}showGear(e){var t=$$(this.ids.list).getItemNode(e);if(t){var i=t.querySelector(".ab-page-list-edit");i.style.visibility="visible",i.style.display="block"}}show(){$$(this.ids.component).show()}refreshTemplateItem(e){e=e.updateIcon(e),this.viewList.updateItem(e.id,e)}rename(){var e=$$(this.ids.list).getSelectedId(!1);$$(this.ids.list).edit(e)}copy(){var t=$$(this.ids.list).getSelectedItem(!1);this.listBusy(),s.init(e,t),s.applicationLoad(this.CurrentApplication),s.show()}remove(){var e=$$(this.ids.list).getSelectedItem(!1);e&&webix.confirm({title:l("Delete Page"),text:l("Are you sure you wish to delete this page?"),ok:l("Yes"),cancel:l("No"),callback:async t=>{if(t){this.listBusy();try{await e.destroy(),this.listReady(),$$(this.ids.list).remove($$(this.ids.list).getSelectedId()),this.emit("deleted",e),this.emit("selected",null)}catch(t){this.AB.notify.developer(t,{context:"ui_interface_list:remove(): error removing item",base:e}),this.listReady()}}}})}clickEditMenu(e,t,i){return this.EditPopup.show(i),!1}callbackNewPage(e){var t=e.pageParent()||e.parent,n=t.id!=e.id?t.id:null;this.viewList.exists(e.id)||this.viewList.add(e,null,n),e.pages().forEach(((t,i)=>{this.viewList.exists(t.id)||this.viewList.add(t,i,e.id)})),$$(this.ids.list).refresh(),n&&$$(this.ids.list).open(n),this.select(e),i.hide()}listBusy(){$$(this.ids.list)?.showProgress?.({type:"icon"})}listReady(){$$(this.ids.list)?.hideProgress?.()}select(e){$$(this.ids.list).select(e.id)}templateListItem(e,t,i){i&&console.error("templateListItem(): oldWarnings: How'd we get here?"),e.warningsEval();let n="";e.warningsAll().length>0&&(n=this.WARNING_ICON);var s=`<div class='ab-page-list-item'>\n            ${t.icon(e)} <span class='webix_icon fa fa-${e.icon||e.viewIcon()}'></span> ${e.label}${n}<div class='ab-page-list-edit'>${t.iconGear}</div>\n            </div>`;return e.removeListener("properties.updated",this.refreshTemplateItem).once("properties.updated",this.refreshTemplateItem),s}onAfterOpen(){var e=$$(this.ids.list).getSelectedId(!1);e&&this.showGear(e)}onAfterRender(){var e=$$(this.ids.list).getSelectedId(!1);e&&this.showGear(e)}onAfterSelect(e){this.showGear(e);let t=$$(this.ids.list).getItem(e);this.emit("selected",t)}onBeforeEditStop(e){var t=$$(this.ids.list).getSelectedItem(!1);return t.label=e.value,!t.isValid||!t.isValid().fail()||(t.label=e.old,!1)}onAfterEditStop(e,t,n){if(this.showGear(t.id),e.value!=e.old){this.listBusy();var s=$$(this.ids.list).getSelectedItem(!1);s.label=e.value,s.save().then((()=>{this.listReady(),i.applicationLoad(this.CurrentApplication),webix.alert({text:l("<b>{0}</b> is renamed.",[e.value])})})).catch((t=>{this.listReady(),this.AB.notify.developer(t,{context:"ABFieldProperty: isValid()",base:e.value}),webix.alert({text:l("System could not rename <b>{0}</b>.",[e.value])})}))}}onAfterClose(){$$(this.ids.list).getSelectedId(!0).forEach((e=>{this.showGear(e)}))}}}(e),i=function(e){const t="ui_work_interface_workspace",i=e.Config.uiSettings(),s=(0,n.Z)(e),o=s.L(),r=a(e,`${t}_view_warnings`,{});return new class extends s{constructor(){super(t,{noSelection:"",selectedView:""}),this.ColumnEditor=W(e),this.ColumnDetails=function(e){const t=(0,n.Z)(e);var i=function(e){const t=(0,n.Z)(e),i=t.L(),s=(0,N.Z)(e);return new class extends t{constructor(){super("ui_work_interface_workspace_details_properties",{editors:"",form:""}),this._editorsByType={},this.currentPanel=null,this._handler_onChange=(e=3e3,t=!1)=>{if(!this.CurrentView)return;let i=this.currentPanel.values();Object.keys(i??{}).forEach((e=>{"settings"!=e&&(this.CurrentView[e]=i[e])}));var n=this.CurrentView.toObj();Object.keys(i.settings??{}).forEach((e=>{n.settings[e]=i.settings[e]})),this.CurrentView.fromValues(n);let s=this.CurrentView;this.pendingSave=!0,this.unloadListener||(this.unloadListener=this.AB.Webix.event(window,"beforeunload",(()=>{this._handler_onChange(0,!0)}))),s.__timedSave&&clearTimeout(s.__timedSave),s.__timedSave=setTimeout((async()=>{this.busy();try{await s.save(),delete s.__timedSave}catch(e){this.AB.notify.developer(e,{message:"Error trying to save the View:",view:s.toObj()}),s.AB.message({text:this.label("Error trying to save the View"),type:"error"})}finally{this.ready(),this.pendingSave=!1,this.AB.Webix.eventRemove(this.unloadListener),delete this.unloadListener,this.emit("warnings")}}),e),t||this.emit("view.changed")}}ui(){let e=this.ids;return{id:e.component,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"spacer",width:10},{view:"label",label:i("Properties")},{view:"icon",icon:"fa fa-info-circle",tooltip:i("Tip"),on:{onItemClick:()=>{this.infoAlert()}}}]},{id:e.editors,rows:[{}]}]}}init(e){this.AB=e,s.views().forEach((e=>{this._editorsByType[e.key]=e}));const t=$$(this.ids.component);t&&this.AB.Webix.extend(t,this.AB.Webix.ProgressBar)}infoAlert(){webix.alert({title:i("Tip"),text:i("Edit a widgets properties here.")})}show(){$$(this.ids.component).expand()}viewLoad(e){if(this.currentPanel&&e.id!=this.CurrentViewID&&(this.pendingSave&&this._handler_onChange(10,!0),this.currentPanel.removeAllListeners("changed"),this.currentPanel=null),e.id!=this.CurrentViewID){super.viewLoad(e);let t=this._editorsByType[e.key];if(t){let i=new t;i.applicationLoad(this.CurrentApplication);let n=[i.ui()];webix.ui(n,$$(this.ids.editors)),i.init(this.AB),i.populate(e),i.on("changed",this._handler_onChange),this.currentPanel=i}}}ready(){const e=$$(this.ids.component);e?.enable?.(),e?.hideProgress?.()}busy(){const e=$$(this.ids.component);e?.showProgress?.({type:"icon"}),e?.disable?.()}}}(e);return new class extends t{constructor(){super("ui_work_interface_workspace_details")}ui(){return{id:this.ids.component,width:350,rows:[i.ui()]}}init(e){return this.AB=e,i.on("view.changed",(()=>{this.emit("view.changed")})),this.warningsPropogate([i]),i.init(e)}applicationLoad(e){super.applicationLoad(e),i.applicationLoad(e)}show(){$$(this.ids.component).show()}viewLoad(e){super.viewLoad(e),i.viewLoad(e)}}}(e),this.classABViewPage=e.Class.ABViewManager.viewClass("page")}ui(){let e=this.ids;return{view:"multiview",id:e.component,scroll:!0,cells:[{id:e.noSelection,rows:[{maxHeight:i.xxxLargeSpacer,hidden:i.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-file-text-o'></div>"},{view:"label",align:"center",label:o("Select a page to edit")},{cols:[{},{view:"button",css:"webix_primary",label:o("Add a new page"),type:"form",autowidth:!0,click:()=>{this.emit("view.new")}},{}]},{maxHeight:i.xxxLargeSpacer,hidden:i.hideMobile}]},{id:e.selectedView,view:"layout",rows:[{cols:[this.ColumnEditor.ui(),{view:"resizer",css:"bg_gray",width:11},this.ColumnDetails.ui()]},r.ui()]}]}}init(e){this.AB=e,$$(this.ids.noSelection).show(),$$(this.ids.selectedView).hide();var t=[];return t.push(this.ColumnEditor.init(e)),t.push(this.ColumnDetails.init(e)),this.ColumnEditor.on("view.load",(e=>{this.viewLoad(e)})),this.ColumnDetails.on("view.changed",(()=>{this.ColumnEditor.viewLoad(this.CurrentView)})),this.warningsPropogate([this.ColumnEditor,this.ColumnDetails]),this.on("warnings",(()=>{this.viewLoad(this.CurrentView)})),Promise.all(t)}applicationLoad(e){super.applicationLoad(e),this.ColumnEditor.applicationLoad(e),this.ColumnDetails.applicationLoad(e)}show(){$$(this.ids.component)?.show()}clearWorkspace(){$$(this.ids.noSelection)?.show(!1,!1)}viewLoad(e){super.viewLoad(e),$$(this.ids.selectedView)?.show(),this.ColumnEditor.viewLoad(e),this.ColumnDetails.viewLoad(e),$$(this.ids.component)?.resize(),e instanceof this.classABViewPage&&this.emit("select.view",e),r.show(e)}}}(e);const s=(0,n.Z)(e);return new class extends s{constructor(){super("ab_work_interface")}ui(){return{id:this.ids.component,type:"space",margin:10,cols:[t.ui(),{view:"resizer"},i.ui()]}}init(e){return this.AB=e,t.on("selected",(e=>{this.select(e)})),i.on("view.new",(()=>{t.clickNewView()})),i.on("select.view",(e=>{t.select(e)})),this.warningsPropogate([t,i]),this.on("warnings",(()=>{t.applicationLoad(this.CurrentApplication)})),Promise.all([i.init(e),t.init(e)])}applicationLoad(e){super.applicationLoad(e),t.applicationLoad(e),i.applicationLoad(e)}show(){$$(this.ids.component).show(),this.CurrentApplication&&t?.applicationLoad(this.CurrentApplication)}select(e){e?i.viewLoad(e):i.clearWorkspace()}}}function q(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_datacollection_list_newDataCollection",{tab:""}),this.selectNew=!0,this.BlankTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_dataCollection_list_newDataCollection_blank",{form:"",buttonSave:"",buttonCancel:"",object:""})}ui(){return{id:this.ids.component,header:i("Create"),body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Data Collection name"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_dataCollection_list_newDatacollection_blank_name")}}},{id:this.ids.object,view:"richselect",label:i("Object"),name:"object",required:!0,placeholder:i("Select an object"),labelWidth:70,on:{onAfterRender(){t.CYPRESS_REF(this,"ui_work_dataCollection_list_newDatacollection_blank_object")}}},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.cancel()},on:{onAfterRender(){t.CYPRESS_REF(this)}}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Add Data Collection"),autowidth:!0,type:"form",click:()=>this.save(),on:{onAfterRender(){t.CYPRESS_REF(this)}}}]}]}}}async init(e){return this.AB=e,this.$form=$$(this.ids.form),this.$buttonSave=$$(this.ids.buttonSave),this.$objectList=$$(this.ids.object),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()})),Promise.resolve()}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear())}onError(e){if(e){console.error(e);var t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;var n=this.$form.getValues();webix.alert({title:i("Error creating DataCollection: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.formClear(),this.$buttonSave.enable()}save(){this.$buttonSave.disable();var e=this.$form;if(e.clearValidation(),!e.validate())return this.$buttonSave.enable(),!1;let t=e.getValues(),i=t.object,n=this.AB.objectByID(i);n||(n=this.AB.queryByID(i));let s={name:t.name,label:t.name,settings:{datasourceID:i,isQuery:n?.isQuery??!1}};this.emit("save",s)}show(){$$(this.ids.component)&&$$(this.ids.component).show()}onShow(e){if(this.$objectList&&e){let t=[];t=t.concat(e.objectsIncluded().map((e=>({id:e.id,value:e.label,icon:"fa fa-database",isQuery:!1})))),t=t.concat(e.queriesIncluded().map((e=>({id:e.id,value:e.label,icon:"fa fa-filter",isQuery:!0})))),this.$objectList.define("options",t),this.$objectList.refresh();let i=this.$objectList.getPopup();i.attachEvent("onShow",(()=>{i.define("width",350),i.resize()}))}this.$form&&this.$form.setValues({name:"",object:""})}}}(e),this.ImportTab=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_datacollection_list_newDatacollection_import",{form:"",filter:"",datacollectionList:"",buttonSave:"",buttonCancel:""})}ui(){return{id:this.ids.component,header:i("Existing"),body:{view:"form",id:this.ids.form,width:400,elements:[{cols:[{view:"icon",icon:"fa fa-filter",align:"left"},{view:"text",id:this.ids.filter,on:{onTimedKeyPress:()=>this.filter()}}]},{view:"list",id:this.ids.datacollectionList,select:!0,height:200,minHeight:250,maxHeight:250,data:[],template:"<div>#label#</div>"},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>this.cancel()},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Import"),autowidth:!0,type:"form",click:()=>this.save()}]}]}}}async init(e){this.AB=e,this.$form=$$(this.ids.form),this.$filter=$$(this.ids.filter),this.$datacollectionList=$$(this.ids.datacollectionList),this.$buttonSave=$$(this.ids.buttonSave),this.$buttonCancel=$$(this.ids.buttonCancel),this.on("save.error",(e=>{this.onError(e)})),this.on("save.successful",(()=>{this.onSuccess()}))}onShow(e){this.formClear();const t=e.datacollectionsExcluded();this.$datacollectionList.parse(t,"json")}filter(){let e=this.$filter.getValue();this.$datacollectionList.filter("#label#",e)}save(){let e=this.$datacollectionList.getSelectedItem();if(!e)return!1;this.$buttonSave.disable(),this.emit("save",e)}cancel(){this.formClear(),this.emit("cancel")}formClear(){this.$form&&(this.$form.clearValidation(),this.$form.clear()),this.$datacollectionList&&this.$datacollectionList.clearAll()}onError(e){if(e){console.error(e);let t=i("the entered data is invalid");e.updateForm?e.updateForm(this.$form):t=e.code&&e.data?e.data?.sqlMessage??t:e?.message??t;let n=this.$form.getValues();webix.alert({title:i("Error creating DataCollection: {0}",[n.name]),ok:i("fix it"),text:t,type:"alert-error"})}this.$buttonSave.enable()}onSuccess(){this.$buttonSave.enable()}}}(e)}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new Data Collection"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]},selectNewDataCollection:!0,body:{view:"tabview",id:this.ids.tab,cells:[this.BlankTab.ui(),this.ImportTab.ui()],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.$view.querySelectorAll(".webix_item_tab").forEach((t=>{var i=t.getAttribute("button_id");e.ClassUI.CYPRESS_REF(t,`${i}_tab`)}))}}}}}}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);let t=[];return["BlankTab","ImportTab"].forEach((i=>{t.push(this[i].init(e)),this[i].on("cancel",(()=>{this.emit("cancel")})),this[i].on("save",(e=>{if(e.id)return this.import(e,i);this.save(e,i)}))})),Promise.all(t)}busy(){this.$component?.showProgress?.()}done(e){this.ready(),this.hide(),this.emit("save",e,this.selectNew)}hide(){this.$component?.hide()}async import(e,t){this.busy();try{await this.CurrentApplication.datacollectionInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}ready(){this.$component?.hideProgress?.()}async save(e,t){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this[t].emit("save.error",!0),!1;let n=this.AB.datacollectionNew(e),s=n.isValid();if(s.fail())return this[t].emit("save.error",s),!1;n.createdInAppID||(n.createdInAppID=this.CurrentApplicationID),this.busy();try{let e=await n.save();await this.CurrentApplication.datacollectionInsert(e),this[t].emit("save.successful",e),this.done(e)}catch(e){this.ready(),this[t].emit("save.error",e)}}show(e){null!=e&&(this.selectNew=e),this.$component?.show();const t=$$(this.ids.tab).getValue();this.switchTab(t)}switchTab(e){e!=this.BlankTab?.ui()?.body?.id&&e?e==this.ImportTab?.ui()?.body?.id&&this.ImportTab?.onShow?.(this.CurrentApplication):this.BlankTab?.onShow?.(this.CurrentApplication)}}}(e);return new class extends t{constructor(){super("ui_work_datacollection_list");let t=this;this.ListComponent=c(e,{idBase:this.ids.component,labels:{addNew:"Add new data collection",confirmDeleteTitle:"Delete Data Collection",title:"Data Collections",searchPlaceholder:"Data Collection name"},menu:{copy:!1,exclude:!0},templateListItem:function(e,i,n){let s="";return n?.length>0&&(s=t.WARNING_ICON),`<div class='ab-datacollection-list-item'>\n                  <i class="fa ${e.settings.isQuery?"fa-filter":"fa-database"}"></i>\n                  ${e.label||"??label??"}\n                  ${s}\n                  ${i.iconGear(e)}\n               </div>`}})}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewDataCollection(e)})),await this.ListComponent.init(e),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("addNew",(e=>{this.clickNewDataCollection(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),await i.init(e),i.on("cancel",(()=>{i.hide()})),i.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)}))}applicationLoad(e){var t=this.CurrentApplicationID,n=null;super.applicationLoad(e),t==this.CurrentApplicationID&&(n=this.ListComponent.selectedItem());var s=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(s=()=>!0),this.ListComponent.dataLoad(e?.datacollectionsIncluded(s)),n&&this.ListComponent.selectItem(n.id),i.applicationLoad(e)}warningsRefresh(){if(this.CurrentApplication){var e=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(e=()=>!0);let t=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.datacollectionsIncluded(e)),this.ListComponent.selectItem(t.id)}}async exclude(e){this.ListComponent.busy();var t=this.CurrentApplication;await(t?.datacollectionRemove(e)),this.ListComponent.dataLoad(t?.datacollectionsIncluded()),this.emit("selected",null)}ready(){this.ListComponent.ready()}clickNewDataCollection(){i.show()}}}(e),s=function(e,t){const i="ui_work_datacollection_workspace",s=e.Config.uiSettings(),o=(0,n.Z)(e),r=o.L(),l=D(e,`${i}_view_grid`,t),c=function(e){const t="ui_work_datacollection_workspace_properties",i=(0,n.Z)(e),s=e.Config.uiSettings(),o=e.custom,a=i.L();return new class extends i{constructor(){super(t,{propertyPanel:"",dataSource:"",linkDatacollection:"",linkField:"",followCursor:"",loadAllPanel:"",loadAll:"",fixSelect:"",filterPanel:"",populate:"",populateOptions:"",sortPanel:"",buttonFilter:"",buttonSort:"",list:"",filter:"",sort:""}),this.AB=e,this._templateListItem="\n            <div class='ab-page-list-item'>\n               {common.icon()} <span class='webix_icon fa fa-#typeIcon#'></span> #label# #hasDataCollection#\n            </div>\n         ",this._handler_loadData=e=>{this.populateFixSelector(e)},this.viewList=null,this.FilterComponent=this.AB.filterComplexNew(this.ids.filter),this.PopupSortFieldComponent=(0,_.Z)(e,t)}ui(){const e=this.ids,t=this;return{width:s.columnWidthXLarge,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"spacer",width:10},{view:"label",label:a("Properties")}]},{view:"scrollview",id:e.propertyPanel,body:{padding:15,rows:[{view:"fieldset",label:a("Data Source:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.dataSource,view:"richselect",name:"dataSource",label:a("Source:"),labelWidth:s.labelWidthLarge,options:{data:[]},on:{onChange:(e,t)=>{e!=t&&(this.selectSource(e,t),this.save())}}},{id:e.linkDatacollection,view:"select",name:"linkDatacollection",label:a("Linked To:"),labelWidth:s.labelWidthLarge,options:[],hidden:1,on:{onChange:e=>{this.initLinkFieldOptions(e),this.save()}}},{id:e.linkField,view:"select",name:"linkField",label:a("Linked Field:"),labelWidth:s.labelWidthLarge,options:[],hidden:1,on:{onChange:()=>{this.save()}}},{id:e.followCursor,view:"select",name:"followCursor",label:a("Follow Cursor:"),labelWidth:s.labelWidthLarge,hidden:1,on:{onChange:()=>{this.changeFollowCursor(),this.save()}}}]}},{view:"fieldset",label:a("Advanced Options:"),labelWidth:s.labelWidthLarge,body:{type:"clean",padding:10,rows:[{id:e.filterPanel,name:"filterPanel",cols:[{view:"label",label:a("Filter Data:"),width:s.labelWidthLarge},{id:e.buttonFilter,css:"webix_primary",view:"button",name:"buttonFilter",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){t.showFilterPopup(this.$view)}}]},{id:e.sortPanel,name:"sortPanel",cols:[{view:"label",label:a("Sort Data:"),width:s.labelWidthLarge},{id:e.buttonSort,css:"webix_primary",view:"button",name:"buttonSort",label:a("Settings"),icon:"fa fa-gear",type:"icon",badge:0,click:function(){t.showSortPopup(this.$view)}}]},{id:e.loadAllPanel,cols:[{view:"label",label:a("Load all:"),width:s.labelWidthLarge},{id:e.loadAll,view:"checkbox",name:"loadAll",label:"",on:{onChange:()=>{this.save()}}}]},{id:e.populate,view:"radio",name:"populate",label:a("Load Connections:"),labelWidth:s.labelWidthXLarge,labelPosition:"top",value:"all",tooltip:"#value# - #description#<br>#tip#",options:[{id:"all",value:a("All"),description:a("Load all the connected data"),tip:a("Will impact perfomance if your object has many connections")},{id:"none",value:a("None"),description:a("Don't load any connected data"),tip:a("Will load fast, but won't work with linked data collections")},{id:"custom",value:a("Custom"),description:a("Select the relevant connections to load"),tip:""}],on:{onItemClick:()=>{"custom"==$$(e.populate).getValue()?$$(e.populateOptions).show():(this.save(),$$(e.populateOptions).hide())}}},{id:e.populateOptions,view:"multicombo",name:"populateOptions",hidden:!0,placeholder:a("Select connections to load"),on:{onChange:()=>this.save()}},{id:e.fixSelect,view:"select",name:"fixSelect",label:a("Select:"),labelWidth:s.labelWidthLarge,options:[],on:{onChange:()=>{this.save()}}}]}},{view:"fieldset",label:a("Data used in..."),labelWidth:s.labelWidthLarge,body:{view:o.edittree.view,id:e.list,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",borderless:!0,padding:0,css:"ab-tree-ui",minHeight:300,template:(e,t)=>this.templateListItem(e,t),type:{iconGear:"<span class='webix_icon fa fa-cog'></span>"},on:{onAfterSelect:e=>{this.onAfterSelect(e)}}}},{maxHeight:s.mediumSpacer,height:s.mediumSpacer,minHeight:s.mediumSpacer,hidden:s.hideMobile}]}}]}}async init(e){this.AB=e;const t=this.ids,i=$$(t.list),n=$$(t.propertyPanel);i&&(webix.extend(i,webix.ProgressBar),i.adjust()),n&&webix.extend(n,webix.ProgressBar),this.initPopupEditors(),this.FilterComponent.myPopup=webix.ui({view:"popup",height:240,width:480,hidden:!0,body:this.FilterComponent.ui}),this.FilterComponent.on("save",(()=>{this.onFilterChange(),this.save()})),this.PopupSortFieldComponent.on("changed",(e=>{this.onSortChange(e),this.save()}))}onAfterSelect(e){const t=this.ids,i=$$(t.list).getItem(e),n=this.CurrentApplication.views((e=>e.id==i.id))[0];setTimeout((()=>{this.emit("interface",n)}),50)}applicationLoad(e){super.applicationLoad(e);const t=this.ids;this.refreshDataSourceOptions(),this.listBusy(),this.viewList=new webix.TreeCollection;const i=(e,t,n)=>{if("docxBuilder"==e.key&&e?.datacollections?.forEach)e.datacollections.forEach((i=>{const s={id:e.id+i.id,label:e.label,icon:e.icon?e.icon:"",viewIcon:e.viewIcon?e.viewIcon():"",datacollection:{id:i.id}};this.viewList.add(s,t,n)}));else{const i={id:e.viewId||e.id,label:e.label,icon:e.icon?e.icon:"",viewIcon:e.viewIcon?e.viewIcon():"",datacollection:{id:e.datacollection?e.datacollection.id:""}};this.viewList.add(i,t,n)}const s=e.pages?e.pages():[];s.forEach(((t,n)=>{i(t,n,e.id)})),s.forEach(((t,n)=>{const o=s.length+n;i(t,o,e.id)})),s.forEach(((t,n)=>{t.views().forEach(((t,o)=>{const a=s.length+n+o;i(t,a,e.id)}))}))};this.CurrentApplication.pages().forEach(((e,t)=>{i(e,t)}));const n=$$(t.list);n.clearAll(),n.data.unsync(),n.data.sync(this.viewList),n.refresh(),n.parse(this.viewList),n.unselectAll(),this.listReady()}datacollectionLoad(e){const t=this.ids;super.datacollectionLoad(e);let i={};const n=$$(t.filterPanel),s=$$(t.sortPanel),o=$$(t.dataSource),a=$$(t.linkDatacollection),r=$$(t.linkField),l=$$(t.followCursor),c=$$(t.loadAll),h=$$(t.fixSelect),d=$$(t.populate),u=$$(t.list);this.CurrentDatacollection&&(i=this.CurrentDatacollection.settings||{},this.CurrentDatacollection.removeListener("loadData",this._handler_loadData),this.CurrentDatacollection.on("loadData",this._handler_loadData)),this.initLinkDatacollectionOptions(),this.initLinkFieldOptions(this.CurrentDatacollection?.datacollectionLink?.id||null),this.populatePopupEditors(),this.populateBadgeNumber(),i.isQuery?(n.hide(),s.hide()):(n.show(),s.show()),this.refreshDataSourceOptions(),o.define("value",i.datasourceID),a.define("value",i.linkDatacollectionID),r.define("value",i.linkFieldID),l.define("value",i.followDatacollectionID),c.define("value",i.loadAll),h.define("value",i.fixSelect);const p=Array.isArray(i.populate)?"custom":i.populate?"all":"none";d.define("value",p),"custom"==p?($$(t.populateOptions).define("value",i.populate),$$(t.populateOptions).refresh(),$$(t.populateOptions).show()):$$(t.populateOptions).hide(),this.initPopulateOptions(),this.initFollowCursorOptions(),this.changeFollowCursor(),o.refresh(),a.refresh(),r.refresh(),l.refresh(),c.refresh(),h.refresh(),d.refresh(),u.openAll()}initPopulateOptions(){const e=this.ids,t=this.CurrentDatacollection?.datasource??null,i=t?.connectFields()??[];t&&i.length>0?($$(e.populate).enable(),$$(e.populateOptions).define("options",i.map((e=>({id:e.columnName,value:e.label})))),$$(e.populateOptions).refresh()):$$(e.populate).disable()}refreshDataSourceOptions(){if(!this.CurrentApplication)return;const e=this.ids;let t=[];const i=this.CurrentApplication.objectsIncluded().map((e=>e?{id:e.id,value:e.label,isQuery:!1,icon:"fa fa-database"}:null));t=t.concat(i);const n=this.CurrentApplication.queriesIncluded().map((e=>e?{id:e.id,value:e.label,isQuery:!0,icon:"fa fa-filter",disabled:e?.isDisabled()}:null));t=t.concat(n),t=t.filter((e=>null!==e)),t.unshift({id:"",value:a("Select a source")}),$$(e.dataSource).define("options",{body:{scheme:{$init:function(e){e.disabled&&(e.$css="disabled")}},data:t}}),$$(e.dataSource).refresh()}initFollowCursorOptions(){const e=$$(this.ids.followCursor),t=[];let i=[];this.CurrentDatacollection?.datasource&&(i=this.CurrentApplication.datacollectionsIncluded().filter((e=>e?.id!=this.CurrentDatacollection.id&&(e?.settings?.datasourceID==this.CurrentDatacollection.datasource.id||1==e?.settings?.isQuery&&e?.datasource?.objectIDs[0]==this.CurrentDatacollection.datasource.id)))),i?.length>0&&i.forEach((e=>{t.push({id:e.id,value:e.label})})),t.unshift({id:"",value:a("Select a data collection")}),e.define("options",t),e.define("value",this.CurrentDatacollection?.settings?.followDatacollectionID??null),e.refresh()}busy(){const e=this.ids,t=$$(e.propertyPanel);t?.showProgress&&t.showProgress({type:"icon"})}ready(){const e=this.ids,t=$$(e.propertyPanel);t?.hideProgress&&t.hideProgress()}changeFollowCursor(){const e=this.ids,t=this.CurrentDatacollection?.settings??{},i=$$(e.followCursor),n=$$(e.linkDatacollection),s=$$(e.linkField),o=$$(e.filterPanel),a=$$(e.sortPanel),r=$$(e.loadAllPanel),l=$$(e.fixSelect);i.getValue()?(n.hide(),s.hide(),o.hide(),a.hide(),r.hide(),l.hide()):(n.show(),t.isQuery||(o.show(),a.show()),r.show(),l.show())}save(){if(!this.CurrentDatacollection)return Promise.resolve();this.busy();const e=this.ids,t=this.CurrentDatacollection.settings||{};t.datasourceID=$$(e.dataSource).getValue(),t.linkDatacollectionID=$$(e.linkDatacollection).getValue(),t.linkFieldID=$$(e.linkField).getValue(),t.followDatacollectionID=$$(e.followCursor).getValue(),t.objectWorkspace={},t.objectWorkspace.filterConditions=this.FilterComponent.getValue(),t.objectWorkspace.sortFields=this.PopupSortFieldComponent.getSettings(),t.loadAll=$$(e.loadAll).getValue(),t.fixSelect=$$(e.fixSelect).getValue();const i=$$(e.populate).getValue();t.populate="all"==i||"none"!=i&&$$(e.populateOptions).getValue().split(","),this.CurrentDatacollection.settings=t;const n=$$(e.dataSource).getPopup().getList().getItem(this.CurrentDatacollection.settings.datasourceID);return this.CurrentDatacollection.settings.isQuery=!!n&&n.isQuery,new Promise(((e,t)=>{this.CurrentDatacollection.save().then((()=>{this.CurrentDatacollection.clearAll(),this.ready(),this.emit("save",this.CurrentDatacollection),e()})).catch((e=>{this.ready(),t(e)}))}))}initLinkDatacollectionOptions(){const e=this.ids,t=this.CurrentDatacollection?.datasource||null,i=$$(e.linkDatacollection),n=$$(e.linkField),s=$$(e.followCursor);if(t){const e=t.connectFields().map((e=>e.settings.linkObject)),o=[],r=this.CurrentApplication.datacollectionsIncluded().filter((t=>e.includes(t?.settings.datasourceID)));r?.length>0?(r.forEach((e=>{o.push({id:e.id,value:e.label})})),o.unshift({id:"",value:a("Select a link source")}),i.show(),i.define("options",o),i.define("value",this.CurrentDatacollection?.settings?.linkDatacollectionID||""),i.refresh(),s.hide()):(i.hide(),n.hide(),s.show())}else i.hide(),n.hide(),s.show()}initLinkFieldOptions(e=null){const t=this.ids,i=[],n=e?this.AB.datacollectionByID(e):null;if(n){const e=this.CurrentDatacollection.datasource,t=n.datasource;e.connectFields().filter((e=>e.settings.linkObject==(t||{}).id)).forEach((e=>{i.push({id:e.id,value:e.label})}))}const s=$$(t.linkField);i.length>0?s.show():s.hide();let o=i[0]?i[0].id:"";this.CurrentDatacollection?.settings&&(o=this.CurrentDatacollection.settings.linkFieldID),s.define("options",i),s.define("value",o),s.refresh();const a=$$(t.followCursor);i.length<1||!o?a.show():a.hide(),a.define("value",this.CurrentDatacollection?.settings?.followCursor),a.refresh()}populatePopupEditors(){const e=this.CurrentDatacollection||null,t=e?.datasource||null;if(t){const i=e?.settings?.objectWorkspace?.filterConditions||{glue:"and",rules:[]},n=e?.settings?.objectWorkspace?.sortFields||[];this.FilterComponent.fieldsLoad(t?t.fields():[]),this.FilterComponent.queriesLoad(this.CurrentApplication?.queriesIncluded()),this.FilterComponent.setValue(i),this.CurrentDatacollection.refreshFilterConditions(i),this.PopupSortFieldComponent.objectLoad(t),this.PopupSortFieldComponent.setSettings(n)}}populateBadgeNumber(){const e=this.ids,t=this.CurrentDatacollection,i=$$(e.buttonFilter),n=$$(e.buttonSort);t?.settings?.objectWorkspace?.filterConditions?.rules?(i.define("badge",t.settings.objectWorkspace.filterConditions.rules?.length||null),i.refresh()):(i.define("badge",null),i.refresh()),t?.settings?.objectWorkspace?.sortFields?(n.define("badge",t.settings.objectWorkspace.sortFields.length||null),n.refresh()):(n.define("badge",null),n.refresh())}populateFixSelector(e){const t=this.ids;let i="";const n=this.CurrentDatacollection.datasource,s=e?.data?.map((e=>({id:e.id,value:n?n.displayData(e):""})))||[];n&&(n.fields((e=>"user"==e.key)).length>0&&s.unshift({id:"_CurrentUser",value:a("Current User")}),s.unshift({id:"_FirstRecord",value:a("First Record")},{id:"_FirstRecordDefault",value:a("Default to First Record")})),s.unshift({id:"",value:a("Select fix cursor")}),i=this.CurrentDatacollection.settings.fixSelect||"";const o=$$(t.fixSelect);o.define("options",s),o.define("value",i),o.refresh()}initPopupEditors(){this.FilterComponent.init(),this.PopupSortFieldComponent.init(this.AB)}selectSource(e,t){const i=this.ids,n=$$(i.dataSource).getList().getItem(e),s=$$(i.dataSource);n?.disabled&&(s.blockEvent(),s.setValue(t||""),s.unblockEvent());const o=this.CurrentDatacollection.toObj()||{};o.settings=o.settings||{},o.settings.datasourceID=e,this.CurrentDatacollection.fromValues(o);const a=$$(i.filterPanel),r=$$(i.sortPanel);n.isQuery?(a.hide(),r.hide()):(this.initLinkDatacollectionOptions(),this.initLinkFieldOptions(this.CurrentDatacollection?.datacollectionLink?.id||null),this.initPopupEditors(),this.populatePopupEditors(),this.populateBadgeNumber(),a.show(),r.show())}showFilterPopup(e){this.FilterComponent.popUp(e,null,{pos:"top"})}showSortPopup(e){this.PopupSortFieldComponent.show(e,null,{pos:"top"})}onFilterChange(){if(!this.CurrentDatacollection)return;const e=this.FilterComponent.getValue();this.FilterComponent.isConditionComplete(e)||this.FilterComponent.setValue({glue:"and",rules:[]}),this.populateBadgeNumber()}onSortChange(e){const t=this.CurrentDatacollection;t&&(t.settings=t.settings||{},t.settings.objectWorkspace=t.settings.objectWorkspace||{},t.settings.objectWorkspace.sortFields=e||[],this.populateBadgeNumber())}switchTab(){}templateListItem(e,t){let i=this._templateListItem,n="";return e.datacollection&&this.CurrentDatacollection?.id&&e.datacollection.id==this.CurrentDatacollection.id&&(n="<i class='webix_icon hasDataCollection fa fa-check-circle'></i>"),i=i.replace("#typeIcon#",e.icon||e.viewIcon()).replace("#label#",e.label).replace("{common.icon()}",t.icon(e)).replace("#hasDataCollection#",n),i}listBusy(){const e=this.ids,t=$$(e.list);t?.showProgress&&t.showProgress({type:"icon"})}listReady(){const e=this.ids,t=$$(e.list);t?.hideProgress&&t.hideProgress()}}}(e),h=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_datacollection_workspace_linked_dc",{selectList:""}),this.AB=e}_getLinkedDC(){const e=this.CurrentDatacollection;return e?.datacollectionLink??e?.datacollectionFollow}_populateOptions(){let e=$$(this.ids.selectList);const t=this._getLinkedDC(),i=this.ui(t.getData(),t.getCursor()?.id);e=this.AB.Webix.ui(i,e);const n=[];t.datasource.fields().forEach((e=>{"connectObject"!=e.key&&"image"!=e.key&&"file"!=e.key&&n.push({id:e.columnName,header:e.label,minWidth:150,fillspace:!0})}));const s=e.getPopup().getBody();s.refreshColumns(n),s.refresh(),e.show()}ui(e=[],t){const n=this.ids,s=this.CurrentDatacollection,o=this._getLinkedDC();return{id:n.selectList,view:"richselect",label:i("Linked cursor: "),labelWidth:100,value:t,options:{view:"gridsuggest",data:e??[],template:function(e){return o?.datasource?.displayData(e)??e.id}},on:{onChange:e=>{o?.setCursor(e),s.reloadData(0,20)}}}}async init(e){this.AB=e;const t=this.ids,i=$$(t.selectList);i&&e.Webix.extend(i,e.Webix.ProgressBar)}async datacollectionLoad(e){const t=this.ids;super.datacollectionLoad(e);const i=this._getLinkedDC();i?i.dataStatus==i.dataStatusFlag.initialized?this._populateOptions():i.once("initializedData",(()=>{this._populateOptions(),e.reloadData(0,20)})):$$(t.selectList).hide()}busy(){const e=this.ids,t=$$(e.selectList);t?.showProgress&&t.showProgress({type:"icon"})}ready(){const e=this.ids,t=$$(e.selectList);t?.hideProgress&&t.hideProgress()}}}(e),d=a(e,`${i}_view_warnings`,t);return new class extends o{constructor(t,i={}){super(t,{multiview:"",noSelection:"",workspace:""}),this.AB=e,this.settings=i,this.workspaceViews=T(e,`${t}_views`,i),this.hashViewsGrid=l}ui(){const e=this.ids;return{view:"multiview",id:e.multiview,cells:[{id:e.noSelection,rows:[{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-table'></div>"},{view:"label",align:"center",label:r("Select a datacollection to work with.")},{cols:[{},{view:"button",css:"webix_primary",label:r("Add new data collection"),type:"form",autowidth:!0,click:()=>{this.emit("addNew",!0)}},{}]},{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile}]},{id:e.workspace,view:"layout",rows:[{cols:[{view:"layout",rows:[h.ui(),l.ui()]},{view:"resizer",css:"bg_gray",width:11},c.ui()]},d.ui()]}]}}async init(e){const t=this.ids;this.AB=e,this.warningsPropogate([c,l]),this.on("warnings",(()=>{d.show(this.mockDatacollection)})),this.workspaceViews.init(e),c.on("save",(async e=>{this.datacollectionLoad(e),this.hashViewsGrid&&await this.hashViewsGrid.show(l.defaultSettings()),await this.populateWorkspace(e)})),await l.init(e),await c.init(e),await h.init(e),this.mockDatacollection=this.AB.datacollectionNew({}),this.mockDatacollection.init(),l.datacollectionLoad(this.mockDatacollection),c.datacollectionLoad(this.mockDatacollection),h.datacollectionLoad(this.mockDatacollection),$$(t.noSelection).show()}applicationLoad(e){super.applicationLoad(e),l.applicationLoad(e),c.applicationLoad(e),h.applicationLoad(e)}datacollectionLoad(e){super.datacollectionLoad(e),d.show(e),l.datacollectionLoad(e),c.datacollectionLoad(e),h.datacollectionLoad(e),e||this.clearWorkspace()}loadAll(){l.loadAll()}loadData(){this.mockDatacollection.clearAll();try{this.mockDatacollection.loadData(0,20)}catch(e){let t=e.toString();if("string"==typeof e)try{const i=JSON.parse(e);i.data&&i.data.sqlMessage&&(t=i.data.sqlMessage)}catch(e){}this.AB.notify.developer(e,{context:"ui_work_datacollection_workspace.loadData()",message:t,datacollection:this.mockDatacollection.toObj()})}}clearWorkspace(){const e=this.ids;$$(e.noSelection).show(!1,!1)}async populateWorkspace(e){const t=this.ids;$$(t.workspace).show(),this.mockDatacollection=e,this.workspaceViews.objectLoad(null),this.mockDatacollection?.datasource?.id&&this.workspaceViews.clearObjectCache(this.mockDatacollection.datasource.id),this.workspaceViews.objectLoad(this.mockDatacollection.datasource);const i=this.workspaceViews.getCurrentView();this.hashViewsGrid&&(this.workspaceViews.setCurrentView(i.id),await this.hashViewsGrid.show(i)),await this.workspaceViews.save(),this.loadData(),this.warningsRefresh(e)}}(i,t)}(e,{allowDelete:0,configureHeaders:!1,detailsView:"",editView:"",isEditable:0,massUpdate:0,isReadOnly:!0});return new class extends t{constructor(){super("ui_work_datacollection")}ui(){return{id:this.ids.component,type:"space",cols:[i.ui(),{view:"resizer",width:11},s.ui()]}}async init(e){this.AB=e,i.on("selected",(e=>{this.select(e)})),s.on("addNew",(e=>{i.emit("addNew",e)})),this.warningsPropogate([i,s]),this.on("warnings",(()=>{i.warningsRefresh()})),await s.init(e),await i.init(e)}applicationLoad(e){const t=this.CurrentApplicationID;super.applicationLoad(e),t!=this.CurrentApplicationID&&s.clearWorkspace(),i.applicationLoad(e),s.applicationLoad(e)}show(){const e=this.ids;$$(e.component).show(!1,!1);const t=this.CurrentApplication;t&&(s.applicationLoad(t),i.applicationLoad(t)),i.ready()}select(e){null==e&&s.clearWorkspace(),s.datacollectionLoad(e),s.populateWorkspace(e)}}}var z,U,X=i(9293),G=i.n(X),Y=(z=function(e){var t=e.exports=function(e,i){if(i||(i=16),void 0===e&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(i),s=2;n===1/0;s*=2)n=Math.log(Math.pow(2,e/s))/Math.log(i)*s;var o=n-Math.floor(n),a="";for(s=0;s<Math.floor(n);s++)a=Math.floor(Math.random()*i).toString(i)+a;if(o){var r=Math.pow(i,o);a=Math.floor(Math.random()*r).toString(i)+a}var l=parseInt(a,i);return l!==1/0&&l>=Math.pow(2,e)?t(e,i):a};t.rack=function(e,i,n){var s=function(s){var a=0;do{if(a++>10){if(!n)throw new Error("too many ID collisions, use more bits");e+=n}var r=t(e,i)}while(Object.hasOwnProperty.call(o,r));return o[r]=s,r},o=s.hats={};return s.get=function(e){return s.hats[e]},s.set=function(e,t){return s.hats[e]=t,s},s.bits=e||128,s.base=i||16,s}},z(U={exports:{}}),U.exports);function H(e){if(!(this instanceof H))return new H(e);e=e||[128,36,1],this._seed=e.length?Y.rack(e[0],e[1],e[2]):e}H.prototype.next=function(e){return this._seed(e||!0)},H.prototype.nextPrefixed=function(e,t){var i;do{i=e+this.next(!0)}while(this.assigned(i));return this.claim(i,t),i},H.prototype.claim=function(e,t){this._seed.set(e,t||!0)},H.prototype.assigned=function(e){return this._seed.get(e)||!1},H.prototype.unclaim=function(e){delete this._seed.hats[e]},H.prototype.clear=function(){var e,t=this._seed.hats;for(e in t)this.unclaim(e)};const K=H;function J(e){return Array.prototype.concat.apply([],e)}var ee=Object.prototype.toString,te=Object.prototype.hasOwnProperty;function ie(e){return void 0===e}function ne(e){return void 0!==e}function se(e){return null==e}function oe(e){return"[object Array]"===ee.call(e)}function ae(e){return"[object Object]"===ee.call(e)}function re(e){return"[object Number]"===ee.call(e)}function le(e){var t=ee.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t||"[object GeneratorFunction]"===t||"[object AsyncGeneratorFunction]"===t||"[object Proxy]"===t}function ce(e){return"[object String]"===ee.call(e)}function he(e,t){return te.call(e,t)}function de(e,t){var i;return t=ke(t),pe(e,(function(e,n){if(t(e,n))return i=e,!1})),i}function ue(e,t){var i=[];return pe(e,(function(e,n){t(e,n)&&i.push(e)})),i}function pe(e,t){var i;if(!ie(e)){var n=oe(e)?Pe:Ee;for(var s in e)if(he(e,s)&&!1===t(i=e[s],n(s)))return i}}function fe(e,t,i){return pe(e,(function(e,n){i=t(i,e,n)})),i}function me(e,t){return!!fe(e,(function(e,i,n){return e&&t(i,n)}),!0)}function ge(e,t){return!!de(e,t)}function be(e,t){var i=[];return pe(e,(function(e,n){i.push(t(e,n))})),i}function ve(e){return e&&Object.keys(e)||[]}function we(e){return ve(e).length}function ye(e){return be(e,(function(e){return e}))}function Oe(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t=_e(t),pe(e,(function(e){var n=t(e)||"_",s=i[n];s||(s=i[n]=[]),s.push(e)})),i}function xe(e){e=_e(e);for(var t={},i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];pe(n,(function(i){return Oe(i,e,t)}));var o=be(t,(function(e,t){return e[0]}));return o}var $e=xe;function Ce(e,t){t=_e(t);var i=[];return pe(e,(function(e,n){for(var s=t(e,n),o={d:s,v:e},a=0;a<i.length;a++)if(s<i[a].d)return void i.splice(a,0,o);i.push(o)})),be(i,(function(e){return e.v}))}function Se(e){return function(t){return me(e,(function(e,i){return t[i]===e}))}}function _e(e){return le(e)?e:function(t){return t[e]}}function ke(e){return le(e)?e:function(t){return t===e}}function Ee(e){return e}function Pe(e){return Number(e)}function Ae(e,t){var i,n,s,o;function a(i){var a=Date.now(),c=i?0:o+t-a;if(c>0)return r(c);e.apply(s,n),l()}function r(e){i=setTimeout(a,e)}function l(){i&&clearTimeout(i),i=o=n=s=void 0}function c(){o=Date.now();for(var e=arguments.length,a=new Array(e),l=0;l<e;l++)a[l]=arguments[l];n=a,s=this,i||r(t)}return c.flush=function(){i&&a(!0),l()},c.cancel=l,c}function Re(e,t){return e.bind(t)}function De(){return De=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},De.apply(this,arguments)}function Ve(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return De.apply(void 0,[e].concat(i))}function Le(e,t){var i={},n=Object(e);return pe(t,(function(t){t in n&&(i[t]=e[t])})),i}function Te(e,t){var i={};return pe(Object(e),(function(e,n){-1===t.indexOf(n)&&(i[n]=e)})),i}function Be(e,t,i){return 2==arguments.length?e.getAttribute(t):null===i?e.removeAttribute(t):(e.setAttribute(t,i),e)}var Fe=[].indexOf,Ie=function(e,t){if(Fe)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1},je=/\s+/,Me=Object.prototype.toString;function Qe(e){return new We(e)}function We(e){if(!e||!e.nodeType)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}function Ne(e){for(var t;e.childNodes.length;)t=e.childNodes[0],e.removeChild(t);return e}We.prototype.add=function(e){if(this.list)return this.list.add(e),this;var t=this.array();return~Ie(t,e)||t.push(e),this.el.className=t.join(" "),this},We.prototype.remove=function(e){if("[object RegExp]"==Me.call(e))return this.removeMatching(e);if(this.list)return this.list.remove(e),this;var t=this.array(),i=Ie(t,e);return~i&&t.splice(i,1),this.el.className=t.join(" "),this},We.prototype.removeMatching=function(e){for(var t=this.array(),i=0;i<t.length;i++)e.test(t[i])&&this.remove(t[i]);return this},We.prototype.toggle=function(e,t){return this.list?(void 0!==t?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this):(void 0!==t?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e),this)},We.prototype.array=function(){var e=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(je);return""===e[0]&&e.shift(),e},We.prototype.has=We.prototype.contains=function(e){return this.list?this.list.contains(e):!!~Ie(this.array(),e)};var Ze="undefined"!=typeof Element?Element.prototype:{},qe=Ze.matches||Ze.matchesSelector||Ze.webkitMatchesSelector||Ze.mozMatchesSelector||Ze.msMatchesSelector||Ze.oMatchesSelector,ze=function(e,t){if(!e||1!==e.nodeType)return!1;if(qe)return qe.call(e,t);for(var i=e.parentNode.querySelectorAll(t),n=0;n<i.length;n++)if(i[n]==e)return!0;return!1};function Ue(e,t,i){for(var n=i?e:e.parentNode;n&&n.nodeType!==document.DOCUMENT_NODE&&n.nodeType!==document.DOCUMENT_FRAGMENT_NODE;){if(ze(n,t))return n;n=n.parentNode}return ze(n,t)?n:null}var Xe,Ge=window.addEventListener?"addEventListener":"attachEvent",Ye=window.removeEventListener?"removeEventListener":"detachEvent",He="addEventListener"!==Ge?"on":"",Ke={bind:function(e,t,i,n){return e[Ge](He+t,i,n||!1),i},unbind:function(e,t,i,n){return e[Ye](He+t,i,n||!1),i}},Je=["focus","blur"],et=function(e,t,i,n,s){return-1!==Je.indexOf(i)&&(s=!0),Ke.bind(e,i,(function(i){var s=i.target||i.srcElement;i.delegateTarget=Ue(s,t,!0),i.delegateTarget&&n.call(e,i)}),s)},tt=function(e,t,i,n){return-1!==Je.indexOf(t)&&(n=!0),Ke.unbind(e,t,i,n)},it=function(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var i=/<([\w:]+)/.exec(e);if(!i)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var n=i[1];if("body"==n)return(s=t.createElement("html")).innerHTML=e,s.removeChild(s.lastChild);var s,o=st[n]||st._default,a=o[0],r=o[1],l=o[2];for((s=t.createElement("div")).innerHTML=r+e+l;a--;)s=s.lastChild;if(s.firstChild==s.lastChild)return s.removeChild(s.firstChild);for(var c=t.createDocumentFragment();s.firstChild;)c.appendChild(s.removeChild(s.firstChild));return c},nt=!1;"undefined"!=typeof document&&((Xe=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',nt=!Xe.getElementsByTagName("link").length,Xe=void 0);var st={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:nt?[1,"X<div>","</div>"]:[0,"",""]};function ot(e,t){return(t=t||document).querySelector(e)}function at(e,t){return(t=t||document).querySelectorAll(e)}function rt(e){e.parentNode&&e.parentNode.removeChild(e)}function lt(e,t){return t.appendChild(function(e,t){if(e.ownerDocument!==t.ownerDocument)try{return t.ownerDocument.importNode(e,!0)}catch(e){}return e}(e,t))}function ct(e,t){return lt(t,e),e}st.td=st.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],st.option=st.optgroup=[1,'<select multiple="multiple">',"</select>"],st.thead=st.tbody=st.colgroup=st.caption=st.tfoot=[1,"<table>","</table>"],st.polyline=st.ellipse=st.polygon=st.circle=st.text=st.line=st.path=st.rect=st.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var ht={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function dt(e,t,i){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=ht[n];s?(2===s&&"number"==typeof i&&(i=String(i)+"px"),e.style[n]=i):e.setAttributeNS(null,t,i)}function ut(e,t,i){if("string"==typeof t){if(void 0===i)return function(e,t){return ht[t]?e.style[t]:e.getAttributeNS(null,t)}(e,t);dt(e,t,i)}else!function(e,t){var i,n,s=Object.keys(t);for(i=0;n=s[i];i++)dt(e,n,t[n])}(e,t);return e}function pt(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}var ft=/\s+/,mt=Object.prototype.toString;function gt(e){return void 0!==e}function bt(e){return new vt(e)}function vt(e){if(!e||!e.nodeType)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}function wt(e){var t=e.parentNode;return t&&t.removeChild(e),e}function yt(e){for(var t;t=e.firstChild;)wt(t);return e}function Ot(e){return e.cloneNode(!0)}vt.prototype.add=function(e){if(this.list)return this.list.add(e),this;var t=this.array();return~pt(t,e)||t.push(e),gt(this.el.className.baseVal)?this.el.className.baseVal=t.join(" "):this.el.className=t.join(" "),this},vt.prototype.remove=function(e){if("[object RegExp]"===mt.call(e))return this.removeMatching(e);if(this.list)return this.list.remove(e),this;var t=this.array(),i=pt(t,e);return~i&&t.splice(i,1),this.el.className.baseVal=t.join(" "),this},vt.prototype.removeMatching=function(e){for(var t=this.array(),i=0;i<t.length;i++)e.test(t[i])&&this.remove(t[i]);return this},vt.prototype.toggle=function(e,t){return this.list?(gt(t)?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this):(gt(t)?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e),this)},vt.prototype.array=function(){var e=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(ft);return""===e[0]&&e.shift(),e},vt.prototype.has=vt.prototype.contains=function(e){return this.list?this.list.contains(e):!!~pt(this.array(),e)};var xt="http://www.w3.org/2000/svg",$t='<svg xmlns="'+xt+'"';function Ct(e){var t=!1;"<svg"===e.substring(0,4)?-1===e.indexOf(xt)&&(e=$t+e.substring(4)):(e=$t+">"+e+"</svg>",t=!0);var i=function(e){var t;return(t=new DOMParser).async=!1,t.parseFromString(e,"text/xml")}(e);if(!t)return i;for(var n=document.createDocumentFragment(),s=i.firstChild;s.firstChild;)n.appendChild(s.firstChild);return n}function St(e,t){var i;return"<"===e.charAt(0)?(i=Ct(e).firstChild,i=document.importNode(i,!0)):i=document.createElementNS(xt,e),t&&ut(i,t),i}var _t=St("svg");function kt(e,t){var i,n,s=Object.keys(t);for(i=0;n=s[i];i++)e[n]=t[n];return e}function Et(e){return e?_t.createSVGTransformFromMatrix(e):_t.createSVGTransform()}var Pt=/([&<>]{1})/g,At=/([\n\r"]{1})/g,Rt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function Dt(e,t){return e.replace(t,(function(e,t){return Rt[t]||t}))}function Vt(e,t){var i,n,s,o,a;switch(e.nodeType){case 3:t.push(Dt(e.textContent,Pt));break;case 1:if(t.push("<",e.tagName),e.hasAttributes())for(i=0,n=(s=e.attributes).length;i<n;++i)o=s.item(i),t.push(" ",o.name,'="',Dt(o.value,At),'"');if(e.hasChildNodes()){for(t.push(">"),i=0,n=(a=e.childNodes).length;i<n;++i)Vt(a.item(i),t);t.push("</",e.tagName,">")}else t.push("/>");break;case 8:t.push("\x3c!--",Dt(e.nodeValue,Pt),"--\x3e");break;case 4:t.push("<![CDATA[",e.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+e.nodeType)}return t}function Lt(e,t){if(void 0!==t){try{!function(e,t){var i=Ct(t);if(yt(e),t){(function(e){return"#document-fragment"===e.nodeName})(i)||(i=i.documentElement);for(var n,s=(n=i.childNodes,Array.prototype.slice.call(n)),o=0;o<s.length;o++)lt(s[o],e)}}(e,t)}catch(e){throw new Error("error parsing SVG: "+e.message)}return e}return function(e){for(var t=e.firstChild,i=[];t;)Vt(t,i),t=t.nextSibling;return i.join("")}(e)}function Tt(e,t){return t instanceof SVGMatrix?e.createSVGTransformFromMatrix(t):t}function Bt(e,t){var i=e.transform.baseVal;return t&&(Array.isArray(t)||(t=[t]),function(e,t){var i,n;for(e.clear(),i=0;n=t[i];i++)e.appendItem(Tt(e,n))}(i,t)),i.consolidate()}var Ft=/^class /;function It(e){return"[object Array]"===Object.prototype.toString.call(e)}function jt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Mt(){var e=Array.prototype.slice.call(arguments);1===e.length&&It(e[0])&&(e=e[0]);var t=e.pop();return t.$inject=e,t}var Qt=/constructor\s*[^(]*\(\s*([^)]*)\)/m,Wt=/^(?:async )?(?:function\s*)?[^(]*\(\s*([^)]*)\)/m,Nt=/\/\*([^*]*)\*\//m;function Zt(e){if("function"!=typeof e)throw new Error('Cannot annotate "'+e+'". Expected a function!');var t=e.toString().match(function(e){return Ft.test(e.toString())}(e)?Qt:Wt);return t&&t[1]&&t[1].split(",").map((function(e){return(t=e.match(Nt))?t[1].trim():e.trim()}))||[]}function qt(){var e=[];this.factory=function(t,i){return e.push([t,"factory",i]),this},this.value=function(t,i){return e.push([t,"value",i]),this},this.type=function(t,i){return e.push([t,"type",i]),this},this.forEach=function(t){e.forEach(t)}}function zt(e,t){t=t||{get:function(e,t){if(i.push(e),!1===t)return null;throw a('No provider for "'+e+'"!')}};var i=[],n=this._providers=Object.create(t._providers||null),s=this._instances=Object.create(null),o=s.injector=this,a=function(e){var t=i.join(" -> ");return i.length=0,new Error(t?e+" (Resolving: "+t+")":e)},r=function(e,o){if(!n[e]&&-1!==e.indexOf(".")){for(var l=e.split("."),c=r(l.shift());l.length;)c=c[l.shift()];return c}if(jt(s,e))return s[e];if(jt(n,e)){if(-1!==i.indexOf(e))throw i.push(e),a("Cannot resolve circular dependency!");return i.push(e),s[e]=n[e][0](n[e][1]),i.pop(),s[e]}return t.get(e,o)},l=function(e,t){if(void 0===t&&(t={}),"function"!=typeof e){if(!It(e))throw new Error('Cannot invoke "'+e+'". Expected a function!');e=Mt(e.slice())}return{fn:e,dependencies:(e.$inject||Zt(e)).map((function(e){return jt(t,e)?t[e]:r(e)}))}},c=function(e){var t=l(e),i=t.fn,n=t.dependencies;return new(Function.prototype.bind.apply(i,[null].concat(n)))},h=function(e,t,i){var n=l(e,i),s=n.fn,o=n.dependencies;return s.apply(t,o)},d=function(e){return Mt((function(t){return e.get(t)}))},u={factory:h,type:c,value:function(e){return e}};e.forEach((function(e){function t(e,t){return"value"!==e&&It(t)&&(t=Mt(t.slice())),t}if(e instanceof qt)e.forEach((function(e){var i=e[0],s=e[1],o=e[2];n[i]=[u[s],t(s,o),s]}));else if("object"==typeof e)if(e.__exports__){var i=Object.keys(e).reduce((function(t,i){return"__"!==i.substring(0,2)&&(t[i]=e[i]),t}),Object.create(null)),s=new zt((e.__modules__||[]).concat([i]),o),a=Mt((function(e){return s.get(e)}));e.__exports__.forEach((function(e){n[e]=[a,e,"private",s]}))}else Object.keys(e).forEach((function(i){if("private"!==e[i][2]){var s=e[i][0],o=e[i][1];n[i]=[u[s],t(s,o),s]}else n[i]=e[i]}))})),this.get=r,this.invoke=h,this.instantiate=c,this.createChild=function(e,t){if(t&&t.length){var i,s,a,r,l=Object.create(null),c=Object.create(null),h=[],u=[],p=[];for(var f in n)i=n[f],-1!==t.indexOf(f)&&("private"===i[2]?-1===(s=h.indexOf(i[3]))?(a=i[3].createChild([],t),r=d(a),h.push(i[3]),u.push(a),p.push(r),l[f]=[r,f,"private",a]):l[f]=[p[s],f,"private",u[s]]:l[f]=[i[2],i[1]],c[f]=!0),"factory"!==i[2]&&"type"!==i[2]||!i[1].$scope||t.forEach((function(e){-1!==i[1].$scope.indexOf(e)&&(l[f]=[i[2],i[1]],c[e]=!0)}));t.forEach((function(e){if(!c[e])throw new Error('No provider for "'+e+'". Cannot use provider from the parent!')})),e.unshift(l)}return new zt(e,o)}}var Ut=i(2270),Xt=i.n(Ut);function Gt(e,t){var i=this;t=t||1e3,e.on(["render.shape","render.connection"],t,(function(e,t){var n=e.type,s=t.element,o=t.gfx,a=t.attrs;if(i.canRender(s))return"render.shape"===n?i.drawShape(o,s,a):i.drawConnection(o,s,a)})),e.on(["render.getShapePath","render.getConnectionPath"],t,(function(e,t){if(i.canRender(t))return"render.getShapePath"===e.type?i.getShapePath(t):i.getConnectionPath(t)}))}function Yt(e){return e.join(",").replace(/,?([A-z]),?/g,"$1")}function Ht(e){for(var t,i="",n=0;t=e[n];n++)i+=t.x+","+t.y+" ";return i}function Kt(e,t){var i=St("polyline");return ut(i,{points:Ht(e)}),t&&ut(i,t),i}function Jt(e){return ue(e,(function(t){return!de(e,(function(e){return e!==t&&ei(t,e)}))}))}function ei(e,t){if(t){if(e===t)return t;if(e.parent)return ei(e.parent,t)}}function ti(e,t,i){var n=!i||-1===e.indexOf(t);return n&&e.push(t),n}function ii(e,t,i){i=i||0,oe(e)||(e=[e]),pe(e,(function(e,n){var s=t(e,n,i);oe(s)&&s.length&&ii(s,t,i+1)}))}function ni(e,t){return function(e,t,i){var n=[],s=[];return ii(e,(function(e,o,a){ti(n,e,t);var r=e.children;if((-1===i||a<i)&&r&&ti(s,r,t))return r})),n}(e,!t,-1)}function si(e,t){var i,n,s,o;return t=!!t,oe(e)||(e=[e]),pe(e,(function(e){var a=e;e.waypoints&&!t&&(a=si(e.waypoints,!0));var r=a.x,l=a.y,c=a.height||0,h=a.width||0;(r<i||void 0===i)&&(i=r),(l<n||void 0===n)&&(n=l),(r+h>s||void 0===s)&&(s=r+h),(l+c>o||void 0===o)&&(o=l+c)})),{x:i,y:n,height:o-n,width:s-i}}function oi(e){return"waypoints"in e?"connection":"x"in e?"shape":"root"}function ai(e){return!(!e||!e.isFrame)}function ri(e,t){return Ve({},e||{},t||{})}function li(e,t){Gt.call(this,e,1),this.CONNECTION_STYLE=t.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=t.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=t.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}Gt.prototype.canRender=function(){},Gt.prototype.drawShape=function(){},Gt.prototype.drawConnection=function(){},Gt.prototype.getShapePath=function(){},Gt.prototype.getConnectionPath=function(){},Xt()(li,Gt),li.prototype.canRender=function(){return!0},li.prototype.drawShape=function(e,t,i){var n=St("rect");return ut(n,{x:0,y:0,width:t.width||0,height:t.height||0}),ai(t)?ut(n,Ve({},this.FRAME_STYLE,i||{})):ut(n,Ve({},this.SHAPE_STYLE,i||{})),ct(e,n),n},li.prototype.drawConnection=function(e,t,i){var n=Kt(t.waypoints,Ve({},this.CONNECTION_STYLE,i||{}));return ct(e,n),n},li.prototype.getShapePath=function(e){var t=e.x,i=e.y,n=e.width;return Yt([["M",t,i],["l",n,0],["l",0,e.height],["l",-n,0],["z"]])},li.prototype.getConnectionPath=function(e){var t,i,n=e.waypoints,s=[];for(t=0;i=n[t];t++)i=i.original||i,s.push([0===t?"M":"L",i.x,i.y]);return Yt(s)},li.$inject=["eventBus","styles"];const ci={__init__:["defaultRenderer"],defaultRenderer:["type",li],styles:["type",function(){var e={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},t=this;this.cls=function(e,t,i){return Ve(this.style(t,i),{class:e})},this.style=function(t,i){oe(t)||i||(i=t,t=[]);var n=fe(t,(function(t,i){return Ve(t,e[i]||{})}),{});return i?Ve(n,i):n},this.computeStyle=function(e,i,n){return oe(i)||(n=i,i=[]),t.style(i||[],Ve({},n,e||{}))}}]};function hi(e,t){if(!e||!t)return-1;var i=e.indexOf(t);return-1!==i&&e.splice(i,1),i}function di(e,t,i){if(e&&t){"number"!=typeof i&&(i=-1);var n=e.indexOf(t);if(-1!==n){if(n===i)return;if(-1===i)return;e.splice(n,1)}-1!==i?e.splice(i,0,t):e.push(t)}}function ui(e,t){return e&&t?e.indexOf(t):-1}function pi(e,t){return e&&t?Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)):-1}function fi(e,t,i,n){if(void 0===n&&(n=5),!e||!t||!i)return!1;var s=(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x),o=pi(e,t);return Math.abs(s/o)<=n}function mi(e,t){var i;return function(e,t){var i,n=(i=oe(e)?e:[e,void 0]).slice().shift();return me(i,(function(e){return Math.abs(n.y-e.y)<=2}))}(i=oe(e)?e:[e,t])?"h":!!function(e,t){var i,n=(i=oe(e)?e:[e,void 0]).slice().shift();return me(i,(function(e){return Math.abs(n.x-e.x)<=2}))}(i)&&"v"}function gi(e,t,i){return i=i||0,e.x>t.x-i&&e.y>t.y-i&&e.x<t.x+t.width+i&&e.y<t.y+t.height+i}function bi(e,t){return{x:Math.round(e.x+(t.x-e.x)/2),y:Math.round(e.y+(t.y-e.y)/2)}}var vi=i(2720),wi=i.n(vi);function yi(e){return{x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}}function Oi(e){return{x:Math.round(e.x),y:Math.round(e.y)}}function xi(e){return{top:e.y,right:e.x+(e.width||0),bottom:e.y+(e.height||0),left:e.x}}function $i(e){return{x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top}}function Ci(e){return Oi({x:e.x+(e.width||0)/2,y:e.y+(e.height||0)/2})}function Si(e,t,i){ae(i=i||0)||(i={x:i,y:i});var n=xi(e),s=xi(t),o=n.bottom+i.y<=s.top,a=n.left-i.x>=s.right,r=n.top-i.y>=s.bottom,l=o?"top":r?"bottom":null,c=n.right+i.x<=s.left?"left":a?"right":null;return c&&l?l+"-"+c:c||l||"intersect"}function _i(e,t,i){var n,s,o=(n=e,s=t,wi()(n,s));return 1===o.length||2===o.length&&pi(o[0],o[1])<1?Oi(o[0]):o.length>1?Oi((o=Ce(o,(function(e){var t=Math.floor(100*e.t2)||1;return t=((t=100-t)<10?"0":"")+t,e.segment2+"#"+t})))[i?0:o.length-1]):null}function ki(e,t){return Math.round(e*t)/t}function Ei(e){return re(e)?e+"px":e}function Pi(e,t,i){var n=St("g");bt(n).add(t);var s=void 0!==i?i:e.childNodes.length-1;return e.insertBefore(n,e.childNodes[s]||null),n}var Ai={shape:["x","y","width","height"],connection:["waypoints"]};function Ri(e,t,i,n){this._eventBus=t,this._elementRegistry=n,this._graphicsFactory=i,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(e||{})}function Di(e,t){var i="matrix("+t.a+","+t.b+","+t.c+","+t.d+","+t.e+","+t.f+")";e.setAttribute("transform",i)}Ri.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Ri.prototype._init=function(e){var t=this._eventBus,i=this._container=function(e){var t=(e=Ve({},{width:"100%",height:"100%"},e)).container||document.body,i=document.createElement("div");return i.setAttribute("class","djs-container"),Ve(i.style,{position:"relative",overflow:"hidden",width:Ei(e.width),height:Ei(e.height)}),t.appendChild(i),i}(e),n=this._svg=St("svg");ut(n,{width:"100%",height:"100%"}),ct(i,n);var s=this._viewport=Pi(n,"viewport");!1!==e.deferUpdate&&(this._viewboxChanged=Ae(Re(this._viewboxChanged,this),300)),t.on("diagram.init",(function(){t.fire("canvas.init",{svg:n,viewport:s})}),this),t.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],(function(){delete this._cachedViewbox}),this),t.on("diagram.destroy",500,this._destroy,this),t.on("diagram.clear",500,this._clear,this)},Ri.prototype._destroy=function(e){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},Ri.prototype._clear=function(){var e=this;this._elementRegistry.getAll().forEach((function(t){var i=oi(t);"root"===i?e.removeRootElement(t):e._removeElement(t,i)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},Ri.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Ri.prototype.getLayer=function(e,t){if(!e)throw new Error("must specify a name");var i=this._layers[e];if(i||(i=this._layers[e]=this._createLayer(e,t)),void 0!==t&&i.index!==t)throw new Error("layer <"+e+"> already created at index <"+t+">");return i.group},Ri.prototype._getChildIndex=function(e){return fe(this._layers,(function(t,i){return i.visible&&e>=i.index&&t++,t}),0)},Ri.prototype._createLayer=function(e,t){void 0===t&&(t=1);var i=this._getChildIndex(t);return{group:Pi(this._viewport,"layer-"+e,i),index:t,visible:!0}},Ri.prototype.showLayer=function(e){if(!e)throw new Error("must specify a name");var t=this._layers[e];if(!t)throw new Error("layer <"+e+"> does not exist");var i=this._viewport,n=t.group,s=t.index;if(t.visible)return n;var o=this._getChildIndex(s);return i.insertBefore(n,i.childNodes[o]||null),t.visible=!0,n},Ri.prototype.hideLayer=function(e){if(!e)throw new Error("must specify a name");var t=this._layers[e];if(!t)throw new Error("layer <"+e+"> does not exist");var i=t.group;return t.visible?(wt(i),t.visible=!1,i):i},Ri.prototype._removeLayer=function(e){var t=this._layers[e];t&&(delete this._layers[e],wt(t.group))},Ri.prototype.getActiveLayer=function(){var e=this._findPlaneForRoot(this.getRootElement());return e?e.layer:null},Ri.prototype.findRoot=function(e){if("string"==typeof e&&(e=this._elementRegistry.get(e)),e){var t=this._findPlaneForRoot(function(e){for(;e.parent;)e=e.parent;return e}(e))||{};return t.rootElement}},Ri.prototype.getRootElements=function(){return this._planes.map((function(e){return e.rootElement}))},Ri.prototype._findPlaneForRoot=function(e){return de(this._planes,(function(t){return t.rootElement===e}))},Ri.prototype.getContainer=function(){return this._container},Ri.prototype._updateMarker=function(e,t,i){var n;e.id||(e=this._elementRegistry.get(e)),(n=this._elementRegistry._elements[e.id])&&(pe([n.gfx,n.secondaryGfx],(function(e){e&&(i?bt(e).add(t):bt(e).remove(t))})),this._eventBus.fire("element.marker.update",{element:e,gfx:n.gfx,marker:t,add:!!i}))},Ri.prototype.addMarker=function(e,t){this._updateMarker(e,t,!0)},Ri.prototype.removeMarker=function(e,t){this._updateMarker(e,t,!1)},Ri.prototype.hasMarker=function(e,t){return e.id||(e=this._elementRegistry.get(e)),bt(this.getGraphics(e)).has(t)},Ri.prototype.toggleMarker=function(e,t){this.hasMarker(e,t)?this.removeMarker(e,t):this.addMarker(e,t)},Ri.prototype.getRootElement=function(){var e=this._rootElement;return e||this._planes.length?e:this.setRootElement(this.addRootElement(null))},Ri.prototype.addRootElement=function(e){var t=this._rootsIdx++;e||(e={id:"__implicitroot_"+t,children:[],isImplicit:!0});var i=e.layer="root-"+t;this._ensureValid("root",e);var n=this.getLayer(i,0);return this.hideLayer(i),this._addRoot(e,n),this._planes.push({rootElement:e,layer:n}),e},Ri.prototype.removeRootElement=function(e){if("string"==typeof e&&(e=this._elementRegistry.get(e)),this._findPlaneForRoot(e))return this._removeRoot(e),this._removeLayer(e.layer),this._planes=this._planes.filter((function(t){return t.rootElement!==e})),this._rootElement===e&&(this._rootElement=null),e},Ri.prototype.setRootElement=function(e,t){if(ne(t))throw new Error("override not supported");if(e!==this._rootElement){if(!e)throw new Error("rootElement required");return this._findPlaneForRoot(e)||(e=this.addRootElement(e)),this._setRoot(e),e}},Ri.prototype._removeRoot=function(e){var t=this._elementRegistry,i=this._eventBus;i.fire("root.remove",{element:e}),i.fire("root.removed",{element:e}),t.remove(e)},Ri.prototype._addRoot=function(e,t){var i=this._elementRegistry,n=this._eventBus;n.fire("root.add",{element:e}),i.add(e,t),n.fire("root.added",{element:e,gfx:t})},Ri.prototype._setRoot=function(e,t){var i=this._rootElement;i&&(this._elementRegistry.updateGraphics(i,null,!0),this.hideLayer(i.layer)),e&&(t||(t=this._findPlaneForRoot(e).layer),this._elementRegistry.updateGraphics(e,this._svg,!0),this.showLayer(e.layer)),this._rootElement=e,this._eventBus.fire("root.set",{element:e})},Ri.prototype._ensureValid=function(e,t){if(!t.id)throw new Error("element must have an id");if(this._elementRegistry.get(t.id))throw new Error("element <"+t.id+"> already exists");var i=Ai[e],n=me(i,(function(e){return void 0!==t[e]}));if(!n)throw new Error("must supply { "+i.join(", ")+" } with "+e)},Ri.prototype._setParent=function(e,t,i){di(t.children,e,i),e.parent=t},Ri.prototype._addElement=function(e,t,i,n){i=i||this.getRootElement();var s=this._eventBus,o=this._graphicsFactory;this._ensureValid(e,t),s.fire(e+".add",{element:t,parent:i}),this._setParent(t,i,n);var a=o.create(e,t,n);return this._elementRegistry.add(t,a),o.update(e,t,a),s.fire(e+".added",{element:t,gfx:a}),t},Ri.prototype.addShape=function(e,t,i){return this._addElement("shape",e,t,i)},Ri.prototype.addConnection=function(e,t,i){return this._addElement("connection",e,t,i)},Ri.prototype._removeElement=function(e,t){var i=this._elementRegistry,n=this._graphicsFactory,s=this._eventBus;if(e=i.get(e.id||e))return s.fire(t+".remove",{element:e}),n.remove(e),hi(e.parent&&e.parent.children,e),e.parent=null,s.fire(t+".removed",{element:e}),i.remove(e),e},Ri.prototype.removeShape=function(e){return this._removeElement(e,"shape")},Ri.prototype.removeConnection=function(e){return this._removeElement(e,"connection")},Ri.prototype.getGraphics=function(e,t){return this._elementRegistry.getGraphics(e,t)},Ri.prototype._changeViewbox=function(e){this._eventBus.fire("canvas.viewbox.changing"),e.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Ri.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Ri.prototype.viewbox=function(e){if(void 0===e&&this._cachedViewbox)return this._cachedViewbox;var t,i,n,s,o,a,r,l=this._viewport,c=this.getSize();return e?(this._changeViewbox((function(){o=Math.min(c.width/e.width,c.height/e.height);var t=this._svg.createSVGMatrix().scale(o).translate(-e.x,-e.y);Bt(l,t)})),e):(t=(n=this._rootElement?this.getActiveLayer():null)&&n.getBBox()||{},i=(s=Bt(l))?s.matrix:function(e,t,i,n,s,o){var a=_t.createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return kt(a,e);case 6:return kt(a,{a:e,b:t,c:i,d:n,e:s,f:o})}}(),o=ki(i.a,1e3),a=ki(-i.e||0,1e3),r=ki(-i.f||0,1e3),e=this._cachedViewbox={x:a?a/o:0,y:r?r/o:0,width:c.width/o,height:c.height/o,scale:o,inner:{width:t.width||0,height:t.height||0,x:t.x||0,y:t.y||0},outer:c})},Ri.prototype.scroll=function(e){var t=this._viewport,i=t.getCTM();return e&&this._changeViewbox((function(){e=Ve({dx:0,dy:0},e||{}),i=this._svg.createSVGMatrix().translate(e.dx,e.dy).multiply(i),Di(t,i)})),{x:i.e,y:i.f}},Ri.prototype.scrollToElement=function(e,t){var i=100;"string"==typeof e&&(e=this._elementRegistry.get(e));var n=this.findRoot(e);n!==this.getRootElement()&&this.setRootElement(n),t||(t={}),"number"==typeof t&&(i=t),t={top:t.top||i,right:t.right||i,bottom:t.bottom||i,left:t.left||i};var s,o,a=si(e),r=xi(a),l=this.viewbox(),c=this.zoom();l.y+=t.top/c,l.x+=t.left/c,l.width-=(t.right+t.left)/c,l.height-=(t.bottom+t.top)/c;var h=xi(l);if(a.width<l.width&&a.height<l.height){var d=Math.max(0,r.right-h.right),u=Math.min(0,r.left-h.left),p=Math.max(0,r.bottom-h.bottom),f=Math.min(0,r.top-h.top);s=d||u,o=p||f}else s=a.x-l.x,o=a.y-l.y;this.scroll({dx:-s*c,dy:-o*c})},Ri.prototype.zoom=function(e,t){return e?"fit-viewport"===e?this._fitViewport(t):(this._changeViewbox((function(){"object"!=typeof t&&(i=this.viewbox().outer,t={x:i.width/2,y:i.height/2}),n=this._setZoom(e,t)})),ki(n.a,1e3)):this.viewbox(e).scale;var i,n},Ri.prototype._fitViewport=function(e){var t,i,n=this.viewbox(),s=n.outer,o=n.inner;return o.x>=0&&o.y>=0&&o.x+o.width<=s.width&&o.y+o.height<=s.height&&!e?i={x:0,y:0,width:Math.max(o.width+o.x,s.width),height:Math.max(o.height+o.y,s.height)}:(t=Math.min(1,s.width/o.width,s.height/o.height),i={x:o.x+(e?o.width/2-s.width/t/2:0),y:o.y+(e?o.height/2-s.height/t/2:0),width:s.width/t,height:s.height/t}),this.viewbox(i),this.viewbox(!1).scale},Ri.prototype._setZoom=function(e,t){var i,n,s,o,a=this._svg,r=this._viewport,l=a.createSVGMatrix(),c=a.createSVGPoint(),h=(n=r.getCTM()).a;return t?(i=Ve(c,t).matrixTransform(n.inverse()),s=l.translate(i.x,i.y).scale(1/h*e).translate(-i.x,-i.y),o=n.multiply(s)):o=l.scale(e),Di(this._viewport,o),o},Ri.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Ri.prototype.getAbsoluteBBox=function(e){var t,i=this.viewbox();return{x:(t=e.waypoints?this.getGraphics(e).getBBox():e).x*i.scale-i.x*i.scale,y:t.y*i.scale-i.y*i.scale,width:t.width*i.scale,height:t.height*i.scale}},Ri.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Vi="data-element-id";function Li(e){this._elements={},this._eventBus=e}Li.$inject=["eventBus"],Li.prototype.add=function(e,t,i){var n=e.id;this._validateId(n),ut(t,Vi,n),i&&ut(i,Vi,n),this._elements[n]={element:e,gfx:t,secondaryGfx:i}},Li.prototype.remove=function(e){var t=this._elements,i=e.id||e,n=i&&t[i];n&&(ut(n.gfx,Vi,""),n.secondaryGfx&&ut(n.secondaryGfx,Vi,""),delete t[i])},Li.prototype.updateId=function(e,t){this._validateId(t),"string"==typeof e&&(e=this.get(e)),this._eventBus.fire("element.updateId",{element:e,newId:t});var i=this.getGraphics(e),n=this.getGraphics(e,!0);this.remove(e),e.id=t,this.add(e,i,n)},Li.prototype.updateGraphics=function(e,t,i){var n=e.id||e,s=this._elements[n];return i?s.secondaryGfx=t:s.gfx=t,t&&ut(t,Vi,n),t},Li.prototype.get=function(e){var t;t="string"==typeof e?e:e&&ut(e,Vi);var i=this._elements[t];return i&&i.element},Li.prototype.filter=function(e){var t=[];return this.forEach((function(i,n){e(i,n)&&t.push(i)})),t},Li.prototype.find=function(e){for(var t=this._elements,i=Object.keys(t),n=0;n<i.length;n++){var s=t[i[n]],o=s.element;if(e(o,s.gfx))return o}},Li.prototype.getAll=function(){return this.filter((function(e){return e}))},Li.prototype.forEach=function(e){var t=this._elements;Object.keys(t).forEach((function(i){var n=t[i],s=n.element,o=n.gfx;return e(s,o)}))},Li.prototype.getGraphics=function(e,t){var i=e.id||e,n=this._elements[i];return n&&(t?n.secondaryGfx:n.gfx)},Li.prototype._validateId=function(e){if(!e)throw new Error("element must have an id");if(this._elements[e])throw new Error("element with id "+e+" already added")};var Ti=i(1235),Bi=i.n(Ti),Fi=new(Bi())({name:"children",enumerable:!0,collection:!0},{name:"parent"}),Ii=new(Bi())({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),ji=new(Bi())({name:"attachers",collection:!0},{name:"host"}),Mi=new(Bi())({name:"outgoing",collection:!0},{name:"source"}),Qi=new(Bi())({name:"incoming",collection:!0},{name:"target"});function Wi(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(e){var t=this.label,i=this.labels;!e&&t?i.remove(t):i.add(e,0)}}),Fi.bind(this,"parent"),Ii.bind(this,"labels"),Mi.bind(this,"outgoing"),Qi.bind(this,"incoming")}function Ni(){Wi.call(this),Fi.bind(this,"children"),ji.bind(this,"host"),ji.bind(this,"attachers")}function Zi(){Ni.call(this)}function qi(){Ni.call(this),Ii.bind(this,"labelTarget")}function zi(){Wi.call(this),Mi.bind(this,"source"),Qi.bind(this,"target")}Xt()(Ni,Wi),Xt()(Zi,Ni),Xt()(qi,Ni),Xt()(zi,Wi);var Ui={connection:zi,shape:Ni,label:qi,root:Zi};function Xi(){this._uid=12}Xi.prototype.createRoot=function(e){return this.create("root",e)},Xi.prototype.createLabel=function(e){return this.create("label",e)},Xi.prototype.createShape=function(e){return this.create("shape",e)},Xi.prototype.createConnection=function(e){return this.create("connection",e)},Xi.prototype.create=function(e,t){return(t=Ve({},t||{})).id||(t.id=e+"_"+this._uid++),function(e,t){var i=Ui[e];if(!i)throw new Error("unknown type: <"+e+">");return Ve(new i,t)}(e,t)};var Gi=Array.prototype.slice;function Yi(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function Hi(){}function Ki(e){return e.childNodes[0]}function Ji(e,t,i,n,s){var o=Et();o.setTranslate(t,i);var a=Et();a.setRotate(n||0,0,0);var r=Et();r.setScale(s||1,s||1),Bt(e,[o,a,r])}function en(e,t,i){var n=Et();n.setTranslate(t,i),Bt(e,n)}function tn(e,t){var i=Et();i.setRotate(t,0,0),Bt(e,i)}function nn(e,t){this._eventBus=e,this._elementRegistry=t}function sn(e,t,i){var n=i||t.firstChild;e!==n&&t.insertBefore(e,n)}Yi.prototype.on=function(e,t,i,n){if(e=oe(e)?e:[e],le(t)&&(n=i,i=t,t=1e3),!re(t))throw new Error("priority must be a number");var s=i;n&&((s=Re(i,n)).__fn=i.__fn||i);var o=this;e.forEach((function(e){o._addListener(e,{priority:t,callback:s,next:null})}))},Yi.prototype.once=function(e,t,i,n){var s=this;if(le(t)&&(n=i,i=t,t=1e3),!re(t))throw new Error("priority must be a number");function o(){o.__isTomb=!0;var t=i.apply(n,arguments);return s.off(e,o),t}o.__fn=i,this.on(e,t,o)},Yi.prototype.off=function(e,t){e=oe(e)?e:[e];var i=this;e.forEach((function(e){i._removeListener(e,t)}))},Yi.prototype.createEvent=function(e){var t=new Hi;return t.init(e),t},Yi.prototype.fire=function(e,t){var i,n,s,o;if(o=Gi.call(arguments),"object"==typeof e&&(e=(t=e).type),!e)throw new Error("no event type specified");if(n=this._listeners[e]){i=t instanceof Hi?t:this.createEvent(t),o[0]=i;var a=i.type;e!==a&&(i.type=e);try{s=this._invokeListeners(i,o,n)}finally{e!==a&&(i.type=a)}return void 0===s&&i.defaultPrevented&&(s=!1),s}},Yi.prototype.handleError=function(e){return!1===this.fire("error",{error:e})},Yi.prototype._destroy=function(){this._listeners={}},Yi.prototype._invokeListeners=function(e,t,i){for(var n;i&&!e.cancelBubble;)n=this._invokeListener(e,t,i),i=i.next;return n},Yi.prototype._invokeListener=function(e,t,i){var n;if(i.callback.__isTomb)return n;try{n=function(e,t){return e.apply(null,t)}(i.callback,t),void 0!==n&&(e.returnValue=n,e.stopPropagation()),!1===n&&e.preventDefault()}catch(e){if(!this.handleError(e))throw console.error("unhandled error in event listener",e),e}return n},Yi.prototype._addListener=function(e,t){var i,n=this._getListeners(e);if(n){for(;n;){if(n.priority<t.priority)return t.next=n,void(i?i.next=t:this._setListeners(e,t));i=n,n=n.next}i.next=t}else this._setListeners(e,t)},Yi.prototype._getListeners=function(e){return this._listeners[e]},Yi.prototype._setListeners=function(e,t){this._listeners[e]=t},Yi.prototype._removeListener=function(e,t){var i,n,s,o=this._getListeners(e);if(t)for(;o;)i=o.next,(s=o.callback)!==t&&s.__fn!==t||(n?n.next=i:this._setListeners(e,i)),n=o,o=i;else this._setListeners(e,null)},Hi.prototype.stopPropagation=function(){this.cancelBubble=!0},Hi.prototype.preventDefault=function(){this.defaultPrevented=!0},Hi.prototype.init=function(e){Ve(this,e||{})},nn.$inject=["eventBus","elementRegistry"],nn.prototype._getChildrenContainer=function(e){var t,i=this._elementRegistry.getGraphics(e);return e.parent?(t=function(e){return e.parentNode.childNodes[1]}(i),t||(bt(t=St("g")).add("djs-children"),ct(i.parentNode,t))):t=i,t},nn.prototype._clear=function(e){var t=Ki(e);return Ne(t),t},nn.prototype._createContainer=function(e,t,i,n){var s=St("g");bt(s).add("djs-group"),void 0!==i?sn(s,t,t.childNodes[i]):ct(t,s);var o=St("g");bt(o).add("djs-element"),bt(o).add("djs-"+e),n&&bt(o).add("djs-frame"),ct(s,o);var a=St("g");return bt(a).add("djs-visual"),ct(o,a),o},nn.prototype.create=function(e,t,i){var n=this._getChildrenContainer(t.parent);return this._createContainer(e,n,i,ai(t))},nn.prototype.updateContainments=function(e){var t,i=this,n=this._elementRegistry;t=fe(e,(function(e,t){return t.parent&&(e[t.parent.id]=t.parent),e}),{}),pe(t,(function(e){var t=e.children;if(t){var s=i._getChildrenContainer(e);pe(t.slice().reverse(),(function(e){sn(n.getGraphics(e).parentNode,s)}))}}))},nn.prototype.drawShape=function(e,t){return this._eventBus.fire("render.shape",{gfx:e,element:t})},nn.prototype.getShapePath=function(e){return this._eventBus.fire("render.getShapePath",e)},nn.prototype.drawConnection=function(e,t){return this._eventBus.fire("render.connection",{gfx:e,element:t})},nn.prototype.getConnectionPath=function(e){return this._eventBus.fire("render.getConnectionPath",e)},nn.prototype.update=function(e,t,i){if(t.parent){var n=this._clear(i);if("shape"===e)this.drawShape(n,t),en(i,t.x,t.y);else{if("connection"!==e)throw new Error("unknown type: "+e);this.drawConnection(n,t)}t.hidden?ut(i,"display","none"):ut(i,"display","block")}},nn.prototype.remove=function(e){wt(this._elementRegistry.getGraphics(e).parentNode)};const on={__depends__:[ci],__init__:["canvas"],canvas:["type",Ri],elementRegistry:["type",Li],elementFactory:["type",Xi],eventBus:["type",Yi],graphicsFactory:["type",nn]};function an(e,t){this.injector=t=t||function(e){return function(e){var t=[],i=[];function n(e){return t.indexOf(e)>=0}e.forEach((function e(s){n(s)||((s.__depends__||[]).forEach(e),n(s)||(function(e){t.push(e)}(s),(s.__init__||[]).forEach((function(e){i.push(e)}))))}));var s=new zt(t);return i.forEach((function(e){try{s["string"==typeof e?"get":"invoke"](e)}catch(e){throw console.error("Failed to instantiate component"),console.error(e.stack),e}})),s}([{config:["value",e=e||{}]},on].concat(e.modules||[]))}(e),this.get=t.get,this.invoke=t.invoke,this.get("eventBus").fire("diagram.init")}function rn(){}function ln(e,t){this.model=e,this.properties=t}an.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},an.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},rn.prototype.get=function(e){return this.$model.properties.get(this,e)},rn.prototype.set=function(e,t){this.$model.properties.set(this,e,t)},ln.prototype.createType=function(e){var t=this.model,i=this.properties,n=Object.create(rn.prototype);pe(e.properties,(function(e){e.isMany||void 0===e.default||(n[e.name]=e.default)})),i.defineModel(n,t),i.defineDescriptor(n,e);var s=e.ns.name;function o(e){i.define(this,"$type",{value:s,enumerable:!0}),i.define(this,"$attrs",{value:{}}),i.define(this,"$parent",{writable:!0}),pe(e,Re((function(e,t){this.set(t,e)}),this))}return o.prototype=n,o.hasType=n.$instanceOf=this.model.hasType,i.defineModel(o,t),i.defineDescriptor(o,e),o};var cn={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},hn={String:function(e){return e},Boolean:function(e){return"true"===e},Integer:function(e){return parseInt(e,10)},Real:function(e){return parseFloat(e)}};function dn(e,t){var i=hn[e];return i?i(t):t}function un(e){return!!cn[e]}function pn(e){return!!hn[e]}function fn(e,t){var i,n,s=e.split(/:/);if(1===s.length)i=e,n=t;else{if(2!==s.length)throw new Error("expected <prefix:localName> or <localName>, got "+e);i=s[1],n=s[0]}return{name:e=(n?n+":":"")+i,prefix:n,localName:i}}function mn(e){this.ns=e,this.name=e.name,this.allTypes=[],this.allTypesByName={},this.properties=[],this.propertiesByName={}}function gn(e,t){this.packageMap={},this.typeMap={},this.packages=[],this.properties=t,pe(e,Re(this.registerPackage,this))}function bn(e,t,i){var n=t[i];if(n in e)throw new Error("package with "+i+" <"+n+"> already defined")}function vn(e){this.model=e}function wn(e,t,i){Object.defineProperty(e,t.name,{enumerable:!t.isReference,writable:!0,value:i,configurable:!0})}function yn(e){this.properties=new vn(this),this.factory=new ln(this,this.properties),this.registry=new gn(e,this.properties),this.typeCache={}}mn.prototype.build=function(){return Le(this,["ns","name","allTypes","allTypesByName","properties","propertiesByName","bodyProperty","idProperty"])},mn.prototype.addProperty=function(e,t,i){"boolean"==typeof t&&(i=t,t=void 0),this.addNamedProperty(e,!1!==i);var n=this.properties;void 0!==t?n.splice(t,0,e):n.push(e)},mn.prototype.replaceProperty=function(e,t,i){var n=e.ns,s=this.properties,o=this.propertiesByName,a=e.name!==t.name;if(e.isId){if(!t.isId)throw new Error("property <"+t.ns.name+"> must be id property to refine <"+e.ns.name+">");this.setIdProperty(t,!1)}if(e.isBody){if(!t.isBody)throw new Error("property <"+t.ns.name+"> must be body property to refine <"+e.ns.name+">");this.setBodyProperty(t,!1)}var r=s.indexOf(e);if(-1===r)throw new Error("property <"+n.name+"> not found in property list");s.splice(r,1),this.addProperty(t,i?void 0:r,a),o[n.name]=o[n.localName]=t},mn.prototype.redefineProperty=function(e,t,i){var n=e.ns.prefix,s=t.split("#"),o=fn(s[0],n),a=fn(s[1],o.prefix).name,r=this.propertiesByName[a];if(!r)throw new Error("refined property <"+a+"> not found");this.replaceProperty(r,e,i),delete e.redefines},mn.prototype.addNamedProperty=function(e,t){var i=e.ns,n=this.propertiesByName;t&&(this.assertNotDefined(e,i.name),this.assertNotDefined(e,i.localName)),n[i.name]=n[i.localName]=e},mn.prototype.removeNamedProperty=function(e){var t=e.ns,i=this.propertiesByName;delete i[t.name],delete i[t.localName]},mn.prototype.setBodyProperty=function(e,t){if(t&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+e.ns.name+">)");this.bodyProperty=e},mn.prototype.setIdProperty=function(e,t){if(t&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+e.ns.name+">)");this.idProperty=e},mn.prototype.assertNotDefined=function(e,t){var i=e.name,n=this.propertiesByName[i];if(n)throw new Error("property <"+i+"> already defined; override of <"+n.definedBy.ns.name+"#"+n.ns.name+"> by <"+e.definedBy.ns.name+"#"+e.ns.name+"> not allowed without redefines")},mn.prototype.hasProperty=function(e){return this.propertiesByName[e]},mn.prototype.addTrait=function(e,t){var i=this.allTypesByName,n=this.allTypes,s=e.name;s in i||(pe(e.properties,Re((function(i){i=Ve({},i,{name:i.ns.localName,inherited:t}),Object.defineProperty(i,"definedBy",{value:e});var n=i.replaces,s=i.redefines;n||s?this.redefineProperty(i,n||s,n):(i.isBody&&this.setBodyProperty(i),i.isId&&this.setIdProperty(i),this.addProperty(i))}),this)),n.push(e),i[s]=e)},gn.prototype.getPackage=function(e){return this.packageMap[e]},gn.prototype.getPackages=function(){return this.packages},gn.prototype.registerPackage=function(e){e=Ve({},e);var t=this.packageMap;bn(t,e,"prefix"),bn(t,e,"uri"),pe(e.types,Re((function(t){this.registerType(t,e)}),this)),t[e.uri]=t[e.prefix]=e,this.packages.push(e)},gn.prototype.registerType=function(e,t){var i=fn((e=Ve({},e,{superClass:(e.superClass||[]).slice(),extends:(e.extends||[]).slice(),properties:(e.properties||[]).slice(),meta:Ve(e.meta||{})})).name,t.prefix),n=i.name,s={};pe(e.properties,Re((function(e){var t=fn(e.name,i.prefix),n=t.name;un(e.type)||(e.type=fn(e.type,t.prefix).name),Ve(e,{ns:t,name:n}),s[n]=e}),this)),Ve(e,{ns:i,name:n,propertiesByName:s}),pe(e.extends,Re((function(e){var t=this.typeMap[e];t.traits=t.traits||[],t.traits.push(n)}),this)),this.definePackage(e,t),this.typeMap[n]=e},gn.prototype.mapTypes=function(e,t,i){var n=un(e.name)?{name:e.name}:this.typeMap[e.name],s=this;function o(e){return a(e,!0)}function a(i,n){var o=fn(i,un(i)?"":e.prefix);s.mapTypes(o,t,n)}if(!n)throw new Error("unknown type <"+e.name+">");pe(n.superClass,i?o:a),t(n,!i),pe(n.traits,o)},gn.prototype.getEffectiveDescriptor=function(e){var t=fn(e),i=new mn(t);this.mapTypes(t,(function(e,t){i.addTrait(e,t)}));var n=i.build();return this.definePackage(n,n.allTypes[n.allTypes.length-1].$pkg),n},gn.prototype.definePackage=function(e,t){this.properties.define(e,"$pkg",{value:t})},vn.prototype.set=function(e,t,i){var n=this.model.getPropertyDescriptor(e,t),s=n&&n.name;void 0===i?n?delete e[s]:delete e.$attrs[t]:n?s in e?e[s]=i:wn(e,n,i):e.$attrs[t]=i},vn.prototype.get=function(e,t){var i=this.model.getPropertyDescriptor(e,t);if(!i)return e.$attrs[t];var n=i.name;return!e[n]&&i.isMany&&wn(e,i,[]),e[n]},vn.prototype.define=function(e,t,i){if(!i.writable){var n=i.value;delete(i=Ve({},i,{get:function(){return n}})).value}Object.defineProperty(e,t,i)},vn.prototype.defineDescriptor=function(e,t){this.define(e,"$descriptor",{value:t})},vn.prototype.defineModel=function(e,t){this.define(e,"$model",{value:t})},yn.prototype.create=function(e,t){var i=this.getType(e);if(!i)throw new Error("unknown type <"+e+">");return new i(t)},yn.prototype.getType=function(e){var t=this.typeCache,i=ce(e)?e:e.ns.name,n=t[i];return n||(e=this.registry.getEffectiveDescriptor(i),n=t[i]=this.factory.createType(e)),n},yn.prototype.createAny=function(e,t,i){var n=fn(e),s={$type:e,$instanceOf:function(e){return e===this.$type}},o={name:e,isGeneric:!0,ns:{prefix:n.prefix,localName:n.localName,uri:t}};return this.properties.defineDescriptor(s,o),this.properties.defineModel(s,this),this.properties.define(s,"$parent",{enumerable:!1,writable:!0}),this.properties.define(s,"$instanceOf",{enumerable:!1,writable:!0}),pe(i,(function(e,t){ae(e)&&void 0!==e.value?s[e.name]=e.value:s[t]=e})),s},yn.prototype.getPackage=function(e){return this.registry.getPackage(e)},yn.prototype.getPackages=function(){return this.registry.getPackages()},yn.prototype.getElementDescriptor=function(e){return e.$descriptor},yn.prototype.hasType=function(e,t){return void 0===t&&(t=e,e=this),t in e.$model.getElementDescriptor(e).allTypesByName},yn.prototype.getPropertyDescriptor=function(e,t){return this.getElementDescriptor(e).propertiesByName[t]},yn.prototype.getTypeDescriptor=function(e){return this.registry.typeMap[e]};var On=String.fromCharCode,xn=Object.prototype.hasOwnProperty,$n=/&#(\d+);|&#x([0-9a-f]+);|&(\w+);/gi,Cn={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'};function Sn(e,t,i,n){return n?xn.call(Cn,n)?Cn[n]:"&"+n+";":On(t||parseInt(i,16))}function _n(e){return e.length>3&&-1!==e.indexOf("&")?e.replace($n,Sn):e}Object.keys(Cn).forEach((function(e){Cn[e.toUpperCase()]=Cn[e]}));var kn="xsi:type",En="non-whitespace outside of root node";function Pn(e){return new Error(e)}function An(e){return"missing namespace for prefix <"+e+">"}function Rn(e){return{get:e,enumerable:!0}}function Dn(e){var t,i={};for(t in e)i[t]=e[t];return i}function Vn(e){return e+"$uri"}function Ln(){return{line:0,column:0}}function Tn(e){throw e}function Bn(e){if(!this)return new Bn(e);var t,i,n,s,o,a,r,l,c,h=e&&e.proxy,d=Tn,u=Ln,p=!1,f=!1,m=null,g=!1;function b(e){e instanceof Error||(e=Pn(e)),m=e,d(e,u)}function v(e){o&&(e instanceof Error||(e=Pn(e)),o(e,u))}this.on=function(e,c){if("function"!=typeof c)throw Pn("required args <name, cb>");switch(e){case"openTag":i=c;break;case"text":t=c;break;case"closeTag":n=c;break;case"error":d=c;break;case"warn":o=c;break;case"cdata":s=c;break;case"attention":l=c;break;case"question":r=c;break;case"comment":a=c;break;default:throw Pn("unsupported event: "+e)}return this},this.ns=function(e){if(void 0===e&&(e={}),"object"!=typeof e)throw Pn("required args <nsMap={}>");var t,i={};for(t in e)i[t]=e[t];return i["http://www.w3.org/2001/XMLSchema-instance"]="xsi",f=!0,c=i,this},this.parse=function(e){if("string"!=typeof e)throw Pn("required args <xml=string>");return m=null,function(e){var o,d,m,w,y,O,x,$,C,S,_,k=f?[]:null,E=f?function(e){var t,i,n={};for(t in e)n[i=e[t]]=i,n[Vn(i)]=t;return n}(c):null,P=[],A=0,R=!1,D=!1,V=0,L=0,T="",B=0;function F(){if(null!==_)return _;var e,t,i,n,s,o,a,r,l,h,d,u=f&&E.xmlns,m=f&&p?[]:null,g=B,b=T,w=b.length,y={},O={};e:for(;g<w;g++)if(l=!1,!(32===(h=b.charCodeAt(g))||h<14&&h>8)){for((h<65||h>122||h>90&&h<97)&&95!==h&&58!==h&&(v("illegal first char attribute name"),l=!0),d=g+1;d<w;d++)if(!((h=b.charCodeAt(d))>96&&h<123||h>64&&h<91||h>47&&h<59||46===h||45===h||95===h)){if(32===h||h<14&&h>8){v("missing attribute value"),g=d;continue e}if(61===h)break;v("illegal attribute name char"),l=!0}if("xmlns:xmlns"===(r=b.substring(g,d))&&(v("illegal declaration of xmlns"),l=!0),34===(h=b.charCodeAt(d+1)))-1===(d=b.indexOf('"',g=d+2))&&-1!==(d=b.indexOf("'",g))&&(v("attribute value quote missmatch"),l=!0);else if(39===h)-1===(d=b.indexOf("'",g=d+2))&&-1!==(d=b.indexOf('"',g))&&(v("attribute value quote missmatch"),l=!0);else for(v("missing attribute value quotes"),l=!0,d+=1;d<w&&!(32===(h=b.charCodeAt(d+1))||h<14&&h>8);d++);for(-1===d&&(v("missing closing quotes"),d=w,l=!0),l||(o=b.substring(g,d)),g=d;d+1<w&&!(32===(h=b.charCodeAt(d+1))||h<14&&h>8);d++)g===d&&(v("illegal character after attribute end"),l=!0);if(g=d+1,!l)if(r in O)v("attribute <"+r+"> already defined");else if(O[r]=!0,f)if(p){if(null!==(s="xmlns"===r?"xmlns":120===r.charCodeAt(0)&&"xmlns:"===r.substr(0,6)?r.substr(6):null)){if(e=_n(o),t=Vn(s),!(a=c[e])){if("xmlns"===s||t in E&&E[t]!==e)do{a="ns"+A++}while(void 0!==E[a]);else a=s;c[e]=a}E[s]!==a&&(n||(E=Dn(E),n=!0),E[s]=a,"xmlns"===s&&(E[Vn(a)]=e,u=a),E[t]=e),y[r]=o;continue}m.push(r,o)}else-1!==(h=r.indexOf(":"))?(i=E[r.substring(0,h)])?((r=u===i?r.substr(h+1):i+r.substr(h))===kn&&(-1!==(h=o.indexOf(":"))?(i=o.substring(0,h),o=(i=E[i]||i)+o.substring(h)):o=u+":"+o),y[r]=o):v(An(r.substring(0,h))):y[r]=o;else y[r]=o}if(p)for(g=0,w=m.length;g<w;g++){if(r=m[g++],o=m[g],-1!==(h=r.indexOf(":"))){if(!(i=E[r.substring(0,h)])){v(An(r.substring(0,h)));continue}(r=u===i?r.substr(h+1):i+r.substr(h))===kn&&(-1!==(h=o.indexOf(":"))?(i=o.substring(0,h),o=(i=E[i]||i)+o.substring(h)):o=u+":"+o)}y[r]=o}return _=y}for(u=function(){for(var t,i,n=/(\r\n|\r|\n)/g,s=0,o=0,a=0,r=L;V>=a&&(t=n.exec(e))&&!((r=t[0].length+t.index)>V);)s+=1,a=r;return-1==V?(o=r,i=e.substring(L)):0===L?i=e.substring(L,V):(o=V-a,i=-1==L?e.substring(V):e.substring(V,L+1)),{data:i,line:s,column:o}},h&&(S=Object.create({},{name:Rn((function(){return $})),originalName:Rn((function(){return C})),attrs:Rn(F),ns:Rn((function(){return E}))}));-1!==L;){if(-1===(V=60===e.charCodeAt(L)?L:e.indexOf("<",L)))return P.length?b("unexpected end of file"):0===L?b("missing start tag"):void(L<e.length&&e.substring(L).trim()&&v(En));if(L!==V)if(P.length){if(t&&(t(e.substring(L,V),_n,u),g))return}else if(e.substring(L,V).trim()&&(v(En),g))return;if(33===(y=e.charCodeAt(V+1))){if(91===(w=e.charCodeAt(V+2))&&"CDATA["===e.substr(V+3,6)){if(-1===(L=e.indexOf("]]>",V)))return b("unclosed cdata");if(s&&(s(e.substring(V+9,L),u),g))return;L+=3;continue}if(45===w&&45===e.charCodeAt(V+3)){if(-1===(L=e.indexOf("--\x3e",V)))return b("unclosed comment");if(a&&(a(e.substring(V+4,L),_n,u),g))return;L+=3;continue}}if(63!==y){for(d=V+1;;d++){if(O=e.charCodeAt(d),isNaN(O))return L=-1,b("unclosed tag");if(34===O)d=-1!==(w=e.indexOf('"',d+1))?w:d;else if(39===O)d=-1!==(w=e.indexOf("'",d+1))?w:d;else if(62===O){L=d;break}}if(33!==y){if(_={},47===y){if(R=!1,D=!0,!P.length)return b("missing open tag");if(d=$=P.pop(),w=V+2+d.length,e.substring(V+2,w)!==d)return b("closing tag mismatch");for(;w<L;w++)if(!(32===(y=e.charCodeAt(w))||y>8&&y<14))return b("close tag")}else{if(47===e.charCodeAt(L-1)?(d=$=e.substring(V+1,L-1),R=!0,D=!0):(d=$=e.substring(V+1,L),R=!0,D=!1),!(y>96&&y<123||y>64&&y<91||95===y||58===y))return b("illegal first char nodeName");for(w=1,m=d.length;w<m;w++)if(!((y=d.charCodeAt(w))>96&&y<123||y>64&&y<91||y>47&&y<59||45===y||95===y||46==y)){if(32===y||y<14&&y>8){$=d.substring(0,w),_=null;break}return b("invalid nodeName")}D||P.push($)}if(f){if(o=E,R&&(D||k.push(o),null===_&&(p=-1!==d.indexOf("xmlns",w))&&(B=w,T=d,F(),p=!1)),C=$,-1!==(y=$.indexOf(":"))){if(!(x=E[$.substring(0,y)]))return b("missing namespace on <"+C+">");$=$.substr(y+1)}else x=E.xmlns;x&&($=x+":"+$)}if(R&&(B=w,T=d,i&&(h?i(S,_n,D,u):i($,F,_n,D,u),g)))return;if(D){if(n&&(n(h?S:$,_n,R,u),g))return;f&&(E=R?o:k.pop())}L+=1}else{if(l&&(l(e.substring(V,L+1),_n,u),g))return;L+=1}}else{if(-1===(L=e.indexOf("?>",V)))return b("unclosed question");if(r&&(r(e.substring(V,L+2),u),g))return;L+=2}}}(e),u=Ln,g=!1,m},this.stop=function(){g=!0}}function Fn(e){return e.xml&&"lowerCase"===e.xml.tagAlias}var In={xsi:"http://www.w3.org/2001/XMLSchema-instance",xml:"http://www.w3.org/XML/1998/namespace"},jn="xsi:type";function Mn(e){return e.xml&&e.xml.serialize}function Qn(e){return Mn(e)===jn}function Wn(e,t){return Fn(t)?e.prefix+":"+((i=e.localName).charAt(0).toUpperCase()+i.slice(1)):e.name;var i}function Nn(e){return new Error(e)}function Zn(e){return e.$descriptor}function qn(e){Ve(this,e),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(e){this.references.push(e)},this.addElement=function(e){if(!e)throw Nn("expected element");var t,i=this.elementsById,n=Zn(e).idProperty;if(n&&(t=e.get(n.name))){if(!/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i.test(t))throw new Error("illegal ID <"+t+">");if(i[t])throw Nn("duplicate ID <"+t+">");i[t]=e}},this.addWarning=function(e){this.warnings.push(e)}}function zn(){}function Un(){}function Xn(){}function Gn(e,t){this.property=e,this.context=t}function Yn(e,t){this.element=t,this.propertyDesc=e}function Hn(){}function Kn(e,t,i){this.model=e,this.type=e.getType(t),this.context=i}function Jn(e,t,i){Kn.call(this,e,t,i)}function es(e,t,i){this.model=e,this.context=i}function ts(e){e instanceof yn&&(e={model:e}),Ve(this,{lax:!1},e)}zn.prototype.handleEnd=function(){},zn.prototype.handleText=function(){},zn.prototype.handleNode=function(){},Un.prototype=Object.create(zn.prototype),Un.prototype.handleNode=function(){return this},Xn.prototype=Object.create(zn.prototype),Xn.prototype.handleText=function(e){this.body=(this.body||"")+e},Gn.prototype=Object.create(Xn.prototype),Gn.prototype.handleNode=function(e){if(this.element)throw Nn("expected no sub nodes");return this.element=this.createReference(e),this},Gn.prototype.handleEnd=function(){this.element.id=this.body},Gn.prototype.createReference=function(e){return{property:this.property.ns.name,id:""}},Yn.prototype=Object.create(Xn.prototype),Yn.prototype.handleEnd=function(){var e=this.body||"",t=this.element,i=this.propertyDesc;e=dn(i.type,e),i.isMany?t.get(i.name).push(e):t.set(i.name,e)},Hn.prototype=Object.create(Xn.prototype),Hn.prototype.handleNode=function(e){var t=this,i=this.element;return i?t=this.handleChild(e):(i=this.element=this.createElement(e),this.context.addElement(i)),t},Kn.prototype=Object.create(Hn.prototype),Kn.prototype.addReference=function(e){this.context.addReference(e)},Kn.prototype.handleText=function(e){if(!Zn(this.element).bodyProperty)throw Nn("unexpected body text <"+e+">");Xn.prototype.handleText.call(this,e)},Kn.prototype.handleEnd=function(){var e=this.body,t=this.element,i=Zn(t).bodyProperty;i&&void 0!==e&&(e=dn(i.type,e),t.set(i.name,e))},Kn.prototype.createElement=function(e){var t,i=e.attributes,n=this.type,s=Zn(n),o=this.context,a=new n({}),r=this.model;return pe(i,(function(e,i){var n=s.propertiesByName[i];n&&n.isReference?n.isMany?pe(e.split(" "),(function(e){o.addReference({element:a,property:n.ns.name,id:e})})):o.addReference({element:a,property:n.ns.name,id:e}):(n?e=dn(n.type,e):"xmlns"!==i&&(t=fn(i,s.ns.prefix),r.getPackage(t.prefix)&&o.addWarning({message:"unknown attribute <"+i+">",element:a,property:i,value:e})),a.set(i,e))})),a},Kn.prototype.getPropertyForNode=function(e){var t,i,n=fn(e.name),s=this.type,o=this.model,a=Zn(s),r=n.name,l=a.propertiesByName[r];if(l&&!l.isAttr)return Qn(l)&&(t=e.attributes["xsi:type"])?(t=function(e,t){var i=fn(e);return function(e,t){var i=e.name,n=e.localName,s=t.xml&&t.xml.typePrefix;return s&&0===n.indexOf(s)?e.prefix+":"+n.slice(s.length):i}(i,t.getPackage(i.prefix))}(t,o),Ve({},l,{effectiveType:Zn(i=o.getType(t)).name})):l;var c=o.getPackage(n.prefix);if(c){if(t=Wn(n,c),i=o.getType(t),l=de(a.properties,(function(e){return!e.isVirtual&&!e.isReference&&!e.isAttribute&&i.hasType(e.type)})))return Ve({},l,{effectiveType:Zn(i).name})}else if(l=de(a.properties,(function(e){return!e.isReference&&!e.isAttribute&&"Element"===e.type})))return l;throw Nn("unrecognized element <"+n.name+">")},Kn.prototype.toString=function(){return"ElementDescriptor["+Zn(this.type).name+"]"},Kn.prototype.valueHandler=function(e,t){return new Yn(e,t)},Kn.prototype.referenceHandler=function(e){return new Gn(e,this.context)},Kn.prototype.handler=function(e){return"Element"===e?new es(this.model,e,this.context):new Kn(this.model,e,this.context)},Kn.prototype.handleChild=function(e){var t,i,n,s;if(t=this.getPropertyForNode(e),n=this.element,pn(i=t.effectiveType||t.type))return this.valueHandler(t,n);var o=(s=t.isReference?this.referenceHandler(t).handleNode(e):this.handler(i).handleNode(e)).element;return void 0!==o&&(t.isMany?n.get(t.name).push(o):n.set(t.name,o),t.isReference?(Ve(o,{element:n}),this.context.addReference(o)):o.$parent=n),s},Jn.prototype=Object.create(Kn.prototype),Jn.prototype.createElement=function(e){var t=e.name,i=fn(t),n=this.model,s=this.type,o=n.getPackage(i.prefix),a=o&&Wn(i,o)||t;if(!s.hasType(a))throw Nn("unexpected element <"+e.originalName+">");return Kn.prototype.createElement.call(this,e)},es.prototype=Object.create(Hn.prototype),es.prototype.createElement=function(e){var t=e.name,i=fn(t).prefix,n=e.ns[i+"$uri"],s=e.attributes;return this.model.createAny(t,n,s)},es.prototype.handleChild=function(e){var t=new es(this.model,"Element",this.context).handleNode(e),i=this.element,n=t.element;return void 0!==n&&((i.$children=i.$children||[]).push(n),n.$parent=i),t},es.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},ts.prototype.fromXML=function(e,t,i){var n=t.rootHandler;t instanceof Kn?(n=t,t={}):"string"==typeof t?(n=this.handler(t),t={}):"string"==typeof n&&(n=this.handler(n));var s=this.model,o=this.lax,a=new qn(Ve({},t,{rootHandler:n})),r=new Bn({proxy:!0}),l=function(){var e=[];return Object.defineProperty(e,"peek",{value:function(){return this[this.length-1]}}),e}();function c(e,t,i){var n=t(),s=n.line,o=n.column,r=n.data;"<"===r.charAt(0)&&-1!==r.indexOf(" ")&&(r=r.slice(0,r.indexOf(" "))+">");var l="unparsable content "+(r?r+" ":"")+"detected\n\tline: "+s+"\n\tcolumn: "+o+"\n\tnested error: "+e.message;if(i)return a.addWarning({message:l,error:e}),!0;throw Nn(l)}function h(e,t){return c(e,t,!0)}n.context=a,l.push(n);var d=/^<\?xml /i,u=/ encoding="([^"]+)"/i,p=/^utf-8$/i;function f(e,t){try{l.peek().handleText(e)}catch(e){h(e,t)}}var m=s.getPackages().reduce((function(e,t){return e[t.uri]=t.prefix,e}),{"http://www.w3.org/XML/1998/namespace":"xml"});return r.ns(m).on("openTag",(function(e,t,i,n){var s=e.attrs||{},a=Object.keys(s).reduce((function(e,i){var n=t(s[i]);return e[i]=n,e}),{});!function(e,t){var i=l.peek();try{l.push(i.handleNode(e))}catch(e){c(e,t,o)&&l.push(new Un)}}({name:e.name,originalName:e.originalName,attributes:a,ns:e.ns},n)})).on("question",(function(e){if(d.test(e)){var t=u.exec(e),i=t&&t[1];i&&!p.test(i)&&a.addWarning({message:"unsupported document encoding <"+i+">, falling back to UTF-8"})}})).on("closeTag",(function(){l.pop().handleEnd()})).on("cdata",f).on("text",(function(e,t,i){!function(e,t){e.trim()&&f(e,t)}(t(e),i)})).on("error",c).on("warn",h),new Promise((function(t,i){var s;try{r.parse(e),function(){var e,t,i=a.elementsById,n=a.references;for(e=0;t=n[e];e++){var s=t.element,o=i[t.id],r=Zn(s).propertiesByName[t.property];if(o||a.addWarning({message:"unresolved reference <"+t.id+">",element:t.element,property:t.property,value:t.id}),r.isMany){var l=s.get(r.name),c=l.indexOf(t);-1===c&&(c=l.length),o?l[c]=o:l.splice(c,1)}else s.set(r.name,o)}}()}catch(e){s=e}var o=n.element;s||o||(s=Nn("failed to parse document as <"+n.type.$descriptor.name+">"));var l=a.warnings,c=a.references,h=a.elementsById;return s?(s.warnings=l,i(s)):t({rootElement:o,elementsById:h,references:c,warnings:l})}))},ts.prototype.handler=function(e){return new Jn(this.model,e)};var is=/<|>|'|"|&|\n\r|\n/g,ns=/<|>|&/g;function ss(e){var t={},i={},n={},s=[],o=[];this.byUri=function(t){return i[t]||e&&e.byUri(t)},this.add=function(e,t){i[e.uri]=e,t?s.push(e):o.push(e),this.mapPrefix(e.prefix,e.uri)},this.uriByPrefix=function(e){return t[e||"xmlns"]},this.mapPrefix=function(e,i){t[e||"xmlns"]=i},this.getNSKey=function(e){return void 0!==e.prefix?e.uri+"|"+e.prefix:e.uri},this.logUsed=function(t){var i=t.uri,s=this.getNSKey(t);n[s]=this.byUri(i),e&&e.logUsed(t)},this.getUsed=function(e){var t=this;return[].concat(s,o).filter((function(e){var i=t.getNSKey(e);return n[i]}))}}function os(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function as(e){return ce(e)?e:(e.prefix?e.prefix+":":"")+e.localName}var rs={"\n":"#10","\n\r":"#10",'"':"#34","'":"#39","<":"#60",">":"#62","&":"#38"},ls={"<":"lt",">":"gt","&":"amp"};function cs(e,t,i){return(e=ce(e)?e:""+e).replace(t,(function(e){return"&"+i[e]+";"}))}function hs(e){this.tagName=e}function ds(){}function us(e){this.tagName=e}function ps(e,t){this.body=[],this.attrs=[],this.parent=e,this.propertyDescriptor=t}function fs(e,t){ps.call(this,e,t)}function ms(){this.value="",this.write=function(e){this.value+=e}}function gs(e,t){var i=[""];this.append=function(t){return e.write(t),this},this.appendNewLine=function(){return t&&e.write("\n"),this},this.appendIndent=function(){return t&&e.write(i.join("  ")),this},this.indent=function(){return i.push(""),this},this.unindent=function(){return i.pop(),this}}function bs(e){return e=Ve({format:!1,preamble:!0},e||{}),{toXML:function(t,i){var n=i||new ms,s=new gs(n,e.format);if(e.preamble&&s.append('<?xml version="1.0" encoding="UTF-8"?>\n'),(new ps).build(t).serializeTo(s),!i)return n.value}}}function vs(e,t){yn.call(this,e,t)}hs.prototype.build=function(e){return this.element=e,this},hs.prototype.serializeTo=function(e){e.appendIndent().append("<"+this.tagName+">"+this.element.id+"</"+this.tagName+">").appendNewLine()},ds.prototype.serializeValue=ds.prototype.serializeTo=function(e){e.append(this.escape?cs(this.value,ns,ls):this.value)},ds.prototype.build=function(e,t){return this.value=t,"String"===e.type&&-1!==t.search(ns)&&(this.escape=!0),this},os(us,ds),us.prototype.serializeTo=function(e){e.appendIndent().append("<"+this.tagName+">"),this.serializeValue(e),e.append("</"+this.tagName+">").appendNewLine()},ps.prototype.build=function(e){this.element=e;var t,i,n=e.$descriptor,s=this.propertyDescriptor,o=n.isGeneric;return t=o?this.parseGeneric(e):this.parseNsAttributes(e),this.ns=s?this.nsPropertyTagName(s):this.nsTagName(n),this.tagName=this.addTagName(this.ns),o||(i=function(e){return ue(e.$descriptor.properties,(function(t){var i=t.name;if(t.isVirtual)return!1;if(!he(e,i))return!1;var n=e[i];return n!==t.default&&null!==n&&(!t.isMany||n.length)}))}(e),this.parseAttributes(ue(i,(function(e){return e.isAttr}))),this.parseContainments(ue(i,(function(e){return!e.isAttr})))),this.parseGenericAttributes(e,t),this},ps.prototype.nsTagName=function(e){return function(e,t){return t.isGeneric?Ve({localName:t.ns.localName},e):Ve({localName:(i=t.ns.localName,n=t.$pkg,Fn(n)?(s=i).charAt(0).toLowerCase()+s.slice(1):i)},e);var i,n,s}(this.logNamespaceUsed(e.ns),e)},ps.prototype.nsPropertyTagName=function(e){return function(e,t){return Ve({localName:t.ns.localName},e)}(this.logNamespaceUsed(e.ns),e)},ps.prototype.isLocalNs=function(e){return e.uri===this.ns.uri},ps.prototype.nsAttributeName=function(e){var t;if(t=ce(e)?fn(e):e.ns,e.inherited)return{localName:t.localName};var i=this.logNamespaceUsed(t);return this.getNamespaces().logUsed(i),this.isLocalNs(i)?{localName:t.localName}:Ve({localName:t.localName},i)},ps.prototype.parseGeneric=function(e){var t=this,i=this.body,n=[];return pe(e,(function(s,o){"$body"===o?i.push((new ds).build({type:"String"},s)):"$children"===o?pe(s,(function(e){i.push(new ps(t).build(e))})):0!==o.indexOf("$")&&t.parseNsAttribute(e,o,s)&&n.push({name:o,value:s})})),n},ps.prototype.parseNsAttribute=function(e,t,i){var n,s=e.$model,o=fn(t);if("xmlns"===o.prefix&&(n={prefix:o.localName,uri:i}),o.prefix||"xmlns"!==o.localName||(n={uri:i}),!n)return{name:t,value:i};if(s&&s.getPackage(i))this.logNamespace(n,!0,!0);else{var a=this.logNamespaceUsed(n,!0);this.getNamespaces().logUsed(a)}},ps.prototype.parseNsAttributes=function(e,t){var i=this,n=e.$attrs,s=[];return pe(n,(function(t,n){var o=i.parseNsAttribute(e,n,t);o&&s.push(o)})),s},ps.prototype.parseGenericAttributes=function(e,t){var i=this;pe(t,(function(t){if(t.name!==jn)try{i.addAttribute(i.nsAttributeName(t.name),t.value)}catch(i){console.warn("missing namespace information for ",t.name,"=",t.value,"on",e,i)}}))},ps.prototype.parseContainments=function(e){var t=this,i=this.body,n=this.element;pe(e,(function(e){var s=n.get(e.name),o=e.isReference;if(e.isMany||(s=[s]),e.isBody)i.push((new ds).build(e,s[0]));else if(pn(e.type))pe(s,(function(n){i.push(new us(t.addTagName(t.nsPropertyTagName(e))).build(e,n))}));else if(o)pe(s,(function(n){i.push(new hs(t.addTagName(t.nsPropertyTagName(e))).build(n))}));else{var a=Qn(e),r=function(e){return"property"===Mn(e)}(e);pe(s,(function(n){var s;s=a?new fs(t,e):r?new ps(t,e):new ps(t),i.push(s.build(n))}))}}))},ps.prototype.getNamespaces=function(e){var t,i=this.namespaces,n=this.parent;return i||(t=n&&n.getNamespaces(),e||!t?this.namespaces=i=new ss(t):i=t),i},ps.prototype.logNamespace=function(e,t,i){var n=this.getNamespaces(i),s=e.uri,o=e.prefix;return n.byUri(s)&&!i||n.add(e,t),n.mapPrefix(o,s),e},ps.prototype.logNamespaceUsed=function(e,t){var i,n,s,o=this.element.$model,a=this.getNamespaces(t),r=e.prefix,l=e.uri;if(!r&&!l)return{localName:e.localName};if(s=In[r]||o&&(o.getPackage(r)||{}).uri,!(l=l||s||a.uriByPrefix(r)))throw new Error("no namespace uri given for prefix <"+r+">");if(!(e=a.byUri(l))){for(i=r,n=1;a.uriByPrefix(i);)i=r+"_"+n++;e=this.logNamespace({prefix:i,uri:l},s===l)}return r&&a.mapPrefix(r,l),e},ps.prototype.parseAttributes=function(e){var t=this,i=this.element;pe(e,(function(e){var n=i.get(e.name);if(e.isReference)if(e.isMany){var s=[];pe(n,(function(e){s.push(e.id)})),n=s.join(" ")}else n=n.id;t.addAttribute(t.nsAttributeName(e),n)}))},ps.prototype.addTagName=function(e){var t=this.logNamespaceUsed(e);return this.getNamespaces().logUsed(t),as(e)},ps.prototype.addAttribute=function(e,t){var i=this.attrs;ce(t)&&(t=cs(t,is,rs)),i.push({name:e,value:t})},ps.prototype.serializeAttributes=function(e){var t=this.attrs,i=this.namespaces;i&&(t=function(e){return e.getUsed().filter((function(e){return"xml"!==e.prefix})).map((function(e){return{name:"xmlns"+(e.prefix?":"+e.prefix:""),value:e.uri}}))}(i).concat(t)),pe(t,(function(t){e.append(" ").append(as(t.name)).append('="').append(t.value).append('"')}))},ps.prototype.serializeTo=function(e){var t=this.body[0],i=t&&t.constructor!==ds;e.appendIndent().append("<"+this.tagName),this.serializeAttributes(e),e.append(t?">":" />"),t&&(i&&e.appendNewLine().indent(),pe(this.body,(function(t){t.serializeTo(e)})),i&&e.unindent().appendIndent(),e.append("</"+this.tagName+">")),e.appendNewLine()},os(fs,ps),fs.prototype.parseNsAttributes=function(e){var t=ps.prototype.parseNsAttributes.call(this,e),i=e.$descriptor;if(i.name===this.propertyDescriptor.type)return t;var n=this.typeNs=this.nsTagName(i);this.getNamespaces().logUsed(this.typeNs);var s=e.$model.getPackage(n.uri),o=s.xml&&s.xml.typePrefix||"";return this.addAttribute(this.nsAttributeName(jn),(n.prefix?n.prefix+":":"")+o+i.ns.localName),t},fs.prototype.isLocalNs=function(e){return e.uri===(this.typeNs||this.ns).uri},vs.prototype=Object.create(yn.prototype),vs.prototype.fromXML=function(e,t,i){ce(t)||(i=t,t="bpmn:Definitions");var n=new ts(Ve({model:this,lax:!0},i)),s=n.handler(t);return n.fromXML(e,s)},vs.prototype.toXML=function(e,t){var i=new bs(t);return new Promise((function(t,n){try{return t({xml:i.toXML(e)})}catch(e){return n(e)}}))};var ws={bpmn:{name:"BPMN20",uri:"http://www.omg.org/spec/BPMN/20100524/MODEL",prefix:"bpmn",associations:[],types:[{name:"Interface",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"operations",type:"Operation",isMany:!0},{name:"implementationRef",isAttr:!0,type:"String"}]},{name:"Operation",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"inMessageRef",type:"Message",isReference:!0},{name:"outMessageRef",type:"Message",isReference:!0},{name:"errorRef",type:"Error",isMany:!0,isReference:!0},{name:"implementationRef",isAttr:!0,type:"String"}]},{name:"EndPoint",superClass:["RootElement"]},{name:"Auditing",superClass:["BaseElement"]},{name:"GlobalTask",superClass:["CallableElement"],properties:[{name:"resources",type:"ResourceRole",isMany:!0}]},{name:"Monitoring",superClass:["BaseElement"]},{name:"Performer",superClass:["ResourceRole"]},{name:"Process",superClass:["FlowElementsContainer","CallableElement"],properties:[{name:"processType",type:"ProcessType",isAttr:!0},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"properties",type:"Property",isMany:!0},{name:"laneSets",isMany:!0,replaces:"FlowElementsContainer#laneSets",type:"LaneSet"},{name:"flowElements",isMany:!0,replaces:"FlowElementsContainer#flowElements",type:"FlowElement"},{name:"artifacts",type:"Artifact",isMany:!0},{name:"resources",type:"ResourceRole",isMany:!0},{name:"correlationSubscriptions",type:"CorrelationSubscription",isMany:!0},{name:"supports",type:"Process",isMany:!0,isReference:!0},{name:"definitionalCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"isExecutable",isAttr:!0,type:"Boolean"}]},{name:"LaneSet",superClass:["BaseElement"],properties:[{name:"lanes",type:"Lane",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Lane",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"partitionElementRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"partitionElement",type:"BaseElement"},{name:"flowNodeRef",type:"FlowNode",isMany:!0,isReference:!0},{name:"childLaneSet",type:"LaneSet",xml:{serialize:"xsi:type"}}]},{name:"GlobalManualTask",superClass:["GlobalTask"]},{name:"ManualTask",superClass:["Task"]},{name:"UserTask",superClass:["Task"],properties:[{name:"renderings",type:"Rendering",isMany:!0},{name:"implementation",isAttr:!0,type:"String"}]},{name:"Rendering",superClass:["BaseElement"]},{name:"HumanPerformer",superClass:["Performer"]},{name:"PotentialOwner",superClass:["HumanPerformer"]},{name:"GlobalUserTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"renderings",type:"Rendering",isMany:!0}]},{name:"Gateway",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"gatewayDirection",type:"GatewayDirection",default:"Unspecified",isAttr:!0}]},{name:"EventBasedGateway",superClass:["Gateway"],properties:[{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"eventGatewayType",type:"EventBasedGatewayType",isAttr:!0,default:"Exclusive"}]},{name:"ComplexGateway",superClass:["Gateway"],properties:[{name:"activationCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ExclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"InclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ParallelGateway",superClass:["Gateway"]},{name:"RootElement",isAbstract:!0,superClass:["BaseElement"]},{name:"Relationship",superClass:["BaseElement"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"direction",type:"RelationshipDirection",isAttr:!0},{name:"source",isMany:!0,isReference:!0,type:"Element"},{name:"target",isMany:!0,isReference:!0,type:"Element"}]},{name:"BaseElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,type:"String",isId:!0},{name:"documentation",type:"Documentation",isMany:!0},{name:"extensionDefinitions",type:"ExtensionDefinition",isMany:!0,isReference:!0},{name:"extensionElements",type:"ExtensionElements"}]},{name:"Extension",properties:[{name:"mustUnderstand",default:!1,isAttr:!0,type:"Boolean"},{name:"definition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"extensionAttributeDefinitions",type:"ExtensionAttributeDefinition",isMany:!0}]},{name:"ExtensionAttributeDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"isReference",default:!1,isAttr:!0,type:"Boolean"},{name:"extensionDefinition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionElements",properties:[{name:"valueRef",isAttr:!0,isReference:!0,type:"Element"},{name:"values",type:"Element",isMany:!0},{name:"extensionAttributeDefinition",type:"ExtensionAttributeDefinition",isAttr:!0,isReference:!0}]},{name:"Documentation",superClass:["BaseElement"],properties:[{name:"text",type:"String",isBody:!0},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Event",isAbstract:!0,superClass:["FlowNode","InteractionNode"],properties:[{name:"properties",type:"Property",isMany:!0}]},{name:"IntermediateCatchEvent",superClass:["CatchEvent"]},{name:"IntermediateThrowEvent",superClass:["ThrowEvent"]},{name:"EndEvent",superClass:["ThrowEvent"]},{name:"StartEvent",superClass:["CatchEvent"],properties:[{name:"isInterrupting",default:!0,isAttr:!0,type:"Boolean"}]},{name:"ThrowEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"inputSet",type:"InputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"CatchEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"parallelMultiple",isAttr:!0,type:"Boolean",default:!1},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"outputSet",type:"OutputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity",default:!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"EventDefinition",isAbstract:!0,superClass:["RootElement"]},{name:"CancelEventDefinition",superClass:["EventDefinition"]},{name:"ErrorEventDefinition",superClass:["EventDefinition"],properties:[{name:"errorRef",type:"Error",isAttr:!0,isReference:!0}]},{name:"TerminateEventDefinition",superClass:["EventDefinition"]},{name:"EscalationEventDefinition",superClass:["EventDefinition"],properties:[{name:"escalationRef",type:"Escalation",isAttr:!0,isReference:!0}]},{name:"Escalation",properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"escalationCode",isAttr:!0,type:"String"}],superClass:["RootElement"]},{name:"CompensateEventDefinition",superClass:["EventDefinition"],properties:[{name:"waitForCompletion",isAttr:!0,type:"Boolean",default:!0},{name:"activityRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"TimerEventDefinition",superClass:["EventDefinition"],properties:[{name:"timeDate",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeCycle",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeDuration",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"LinkEventDefinition",superClass:["EventDefinition"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"target",type:"LinkEventDefinition",isAttr:!0,isReference:!0},{name:"source",type:"LinkEventDefinition",isMany:!0,isReference:!0}]},{name:"MessageEventDefinition",superClass:["EventDefinition"],properties:[{name:"messageRef",type:"Message",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"ConditionalEventDefinition",superClass:["EventDefinition"],properties:[{name:"condition",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"SignalEventDefinition",superClass:["EventDefinition"],properties:[{name:"signalRef",type:"Signal",isAttr:!0,isReference:!0}]},{name:"Signal",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ImplicitThrowEvent",superClass:["ThrowEvent"]},{name:"DataState",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ItemAwareElement",superClass:["BaseElement"],properties:[{name:"itemSubjectRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"dataState",type:"DataState"}]},{name:"DataAssociation",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"ItemAwareElement",isMany:!0,isReference:!0},{name:"targetRef",type:"ItemAwareElement",isReference:!0},{name:"transformation",type:"FormalExpression",xml:{serialize:"property"}},{name:"assignment",type:"Assignment",isMany:!0}]},{name:"DataInput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"inputSetRef",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"inputSetWithOptional",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"inputSetWithWhileExecuting",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"DataOutput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"outputSetRef",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"outputSetWithOptional",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"outputSetWithWhileExecuting",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"InputSet",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"dataInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"optionalInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"whileExecutingInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"outputSetRefs",type:"OutputSet",isMany:!0,isReference:!0}]},{name:"OutputSet",superClass:["BaseElement"],properties:[{name:"dataOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"inputSetRefs",type:"InputSet",isMany:!0,isReference:!0},{name:"optionalOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"whileExecutingOutputRefs",type:"DataOutput",isMany:!0,isReference:!0}]},{name:"Property",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"DataInputAssociation",superClass:["DataAssociation"]},{name:"DataOutputAssociation",superClass:["DataAssociation"]},{name:"InputOutputSpecification",superClass:["BaseElement"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"inputSets",type:"InputSet",isMany:!0},{name:"outputSets",type:"OutputSet",isMany:!0}]},{name:"DataObject",superClass:["FlowElement","ItemAwareElement"],properties:[{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"}]},{name:"InputOutputBinding",properties:[{name:"inputDataRef",type:"InputSet",isAttr:!0,isReference:!0},{name:"outputDataRef",type:"OutputSet",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"Assignment",superClass:["BaseElement"],properties:[{name:"from",type:"Expression",xml:{serialize:"xsi:type"}},{name:"to",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"DataStore",superClass:["RootElement","ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"capacity",isAttr:!0,type:"Integer"},{name:"isUnlimited",default:!0,isAttr:!0,type:"Boolean"}]},{name:"DataStoreReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataStoreRef",type:"DataStore",isAttr:!0,isReference:!0}]},{name:"DataObjectReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataObjectRef",type:"DataObject",isAttr:!0,isReference:!0}]},{name:"ConversationLink",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ConversationAssociation",superClass:["BaseElement"],properties:[{name:"innerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0},{name:"outerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0}]},{name:"CallConversation",superClass:["ConversationNode"],properties:[{name:"calledCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"Conversation",superClass:["ConversationNode"]},{name:"SubConversation",superClass:["ConversationNode"],properties:[{name:"conversationNodes",type:"ConversationNode",isMany:!0}]},{name:"ConversationNode",isAbstract:!0,superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0},{name:"messageFlowRefs",type:"MessageFlow",isMany:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0}]},{name:"GlobalConversation",superClass:["Collaboration"]},{name:"PartnerEntity",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"PartnerRole",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"CorrelationProperty",superClass:["RootElement"],properties:[{name:"correlationPropertyRetrievalExpression",type:"CorrelationPropertyRetrievalExpression",isMany:!0},{name:"name",isAttr:!0,type:"String"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Error",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"errorCode",isAttr:!0,type:"String"}]},{name:"CorrelationKey",superClass:["BaseElement"],properties:[{name:"correlationPropertyRef",type:"CorrelationProperty",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Expression",superClass:["BaseElement"],isAbstract:!1,properties:[{name:"body",isBody:!0,type:"String"}]},{name:"FormalExpression",superClass:["Expression"],properties:[{name:"language",isAttr:!0,type:"String"},{name:"evaluatesToTypeRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Message",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"itemRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"ItemDefinition",superClass:["RootElement"],properties:[{name:"itemKind",type:"ItemKind",isAttr:!0},{name:"structureRef",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"import",type:"Import",isAttr:!0,isReference:!0}]},{name:"FlowElement",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"categoryValueRef",type:"CategoryValue",isMany:!0,isReference:!0}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"sourceRef",type:"FlowNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",isAttr:!0,isReference:!0}]},{name:"FlowElementsContainer",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"laneSets",type:"LaneSet",isMany:!0},{name:"flowElements",type:"FlowElement",isMany:!0}]},{name:"CallableElement",isAbstract:!0,superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"supportedInterfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"ioBinding",type:"InputOutputBinding",isMany:!0,xml:{serialize:"property"}}]},{name:"FlowNode",isAbstract:!0,superClass:["FlowElement"],properties:[{name:"incoming",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"outgoing",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"lanes",type:"Lane",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"CorrelationPropertyRetrievalExpression",superClass:["BaseElement"],properties:[{name:"messagePath",type:"FormalExpression"},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"CorrelationPropertyBinding",superClass:["BaseElement"],properties:[{name:"dataPath",type:"FormalExpression"},{name:"correlationPropertyRef",type:"CorrelationProperty",isAttr:!0,isReference:!0}]},{name:"Resource",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"resourceParameters",type:"ResourceParameter",isMany:!0}]},{name:"ResourceParameter",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isRequired",isAttr:!0,type:"Boolean"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"CorrelationSubscription",superClass:["BaseElement"],properties:[{name:"correlationKeyRef",type:"CorrelationKey",isAttr:!0,isReference:!0},{name:"correlationPropertyBinding",type:"CorrelationPropertyBinding",isMany:!0}]},{name:"MessageFlow",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"MessageFlowAssociation",superClass:["BaseElement"],properties:[{name:"innerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0},{name:"outerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0}]},{name:"InteractionNode",isAbstract:!0,properties:[{name:"incomingConversationLinks",type:"ConversationLink",isMany:!0,isVirtual:!0,isReference:!0},{name:"outgoingConversationLinks",type:"ConversationLink",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"Participant",superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"interfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"participantMultiplicity",type:"ParticipantMultiplicity"},{name:"endPointRefs",type:"EndPoint",isMany:!0,isReference:!0},{name:"processRef",type:"Process",isAttr:!0,isReference:!0}]},{name:"ParticipantAssociation",superClass:["BaseElement"],properties:[{name:"innerParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"outerParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"ParticipantMultiplicity",properties:[{name:"minimum",default:0,isAttr:!0,type:"Integer"},{name:"maximum",default:1,isAttr:!0,type:"Integer"}],superClass:["BaseElement"]},{name:"Collaboration",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"participants",type:"Participant",isMany:!0},{name:"messageFlows",type:"MessageFlow",isMany:!0},{name:"artifacts",type:"Artifact",isMany:!0},{name:"conversations",type:"ConversationNode",isMany:!0},{name:"conversationAssociations",type:"ConversationAssociation"},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0},{name:"messageFlowAssociations",type:"MessageFlowAssociation",isMany:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"choreographyRef",type:"Choreography",isMany:!0,isReference:!0},{name:"conversationLinks",type:"ConversationLink",isMany:!0}]},{name:"ChoreographyActivity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"participantRef",type:"Participant",isMany:!0,isReference:!0},{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"loopType",type:"ChoreographyLoopType",default:"None",isAttr:!0}]},{name:"CallChoreography",superClass:["ChoreographyActivity"],properties:[{name:"calledChoreographyRef",type:"Choreography",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"SubChoreography",superClass:["ChoreographyActivity","FlowElementsContainer"],properties:[{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"ChoreographyTask",superClass:["ChoreographyActivity"],properties:[{name:"messageFlowRef",type:"MessageFlow",isMany:!0,isReference:!0}]},{name:"Choreography",superClass:["Collaboration","FlowElementsContainer"]},{name:"GlobalChoreographyTask",superClass:["Choreography"],properties:[{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Group",superClass:["Artifact"],properties:[{name:"categoryValueRef",type:"CategoryValue",isAttr:!0,isReference:!0}]},{name:"Association",superClass:["Artifact"],properties:[{name:"associationDirection",type:"AssociationDirection",isAttr:!0},{name:"sourceRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"targetRef",type:"BaseElement",isAttr:!0,isReference:!0}]},{name:"Category",superClass:["RootElement"],properties:[{name:"categoryValue",type:"CategoryValue",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Artifact",isAbstract:!0,superClass:["BaseElement"]},{name:"CategoryValue",superClass:["BaseElement"],properties:[{name:"categorizedFlowElements",type:"FlowElement",isMany:!0,isVirtual:!0,isReference:!0},{name:"value",isAttr:!0,type:"String"}]},{name:"Activity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"isForCompensation",default:!1,isAttr:!0,type:"Boolean"},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"boundaryEventRefs",type:"BoundaryEvent",isMany:!0,isReference:!0},{name:"properties",type:"Property",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"startQuantity",default:1,isAttr:!0,type:"Integer"},{name:"resources",type:"ResourceRole",isMany:!0},{name:"completionQuantity",default:1,isAttr:!0,type:"Integer"},{name:"loopCharacteristics",type:"LoopCharacteristics"}]},{name:"ServiceTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"SubProcess",superClass:["Activity","FlowElementsContainer","InteractionNode"],properties:[{name:"triggeredByEvent",default:!1,isAttr:!0,type:"Boolean"},{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"LoopCharacteristics",isAbstract:!0,superClass:["BaseElement"]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential",default:!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior",default:"All",isAttr:!0},{name:"loopCardinality",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopDataInputRef",type:"ItemAwareElement",isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",isReference:!0},{name:"inputDataItem",type:"DataInput",xml:{serialize:"property"}},{name:"outputDataItem",type:"DataOutput",xml:{serialize:"property"}},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",isMany:!0},{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"oneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0}]},{name:"StandardLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"testBefore",default:!1,isAttr:!0,type:"Boolean"},{name:"loopCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopMaximum",type:"Integer",isAttr:!0}]},{name:"CallActivity",superClass:["Activity","InteractionNode"],properties:[{name:"calledElement",type:"String",isAttr:!0}]},{name:"Task",superClass:["Activity","InteractionNode"]},{name:"SendTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ReceiveTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ScriptTask",superClass:["Task"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"script",type:"String"}]},{name:"BusinessRuleTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"AdHocSubProcess",superClass:["SubProcess"],properties:[{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"ordering",type:"AdHocOrdering",isAttr:!0},{name:"cancelRemainingInstances",default:!0,isAttr:!0,type:"Boolean"}]},{name:"Transaction",superClass:["SubProcess"],properties:[{name:"protocol",isAttr:!0,type:"String"},{name:"method",isAttr:!0,type:"String"}]},{name:"GlobalScriptTask",superClass:["GlobalTask"],properties:[{name:"scriptLanguage",isAttr:!0,type:"String"},{name:"script",isAttr:!0,type:"String"}]},{name:"GlobalBusinessRuleTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"ComplexBehaviorDefinition",superClass:["BaseElement"],properties:[{name:"condition",type:"FormalExpression"},{name:"event",type:"ImplicitThrowEvent"}]},{name:"ResourceRole",superClass:["BaseElement"],properties:[{name:"resourceRef",type:"Resource",isReference:!0},{name:"resourceParameterBindings",type:"ResourceParameterBinding",isMany:!0},{name:"resourceAssignmentExpression",type:"ResourceAssignmentExpression"},{name:"name",isAttr:!0,type:"String"}]},{name:"ResourceParameterBinding",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"parameterRef",type:"ResourceParameter",isAttr:!0,isReference:!0}],superClass:["BaseElement"]},{name:"ResourceAssignmentExpression",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}}],superClass:["BaseElement"]},{name:"Import",properties:[{name:"importType",isAttr:!0,type:"String"},{name:"location",isAttr:!0,type:"String"},{name:"namespace",isAttr:!0,type:"String"}]},{name:"Definitions",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"targetNamespace",isAttr:!0,type:"String"},{name:"expressionLanguage",default:"http://www.w3.org/1999/XPath",isAttr:!0,type:"String"},{name:"typeLanguage",default:"http://www.w3.org/2001/XMLSchema",isAttr:!0,type:"String"},{name:"imports",type:"Import",isMany:!0},{name:"extensions",type:"Extension",isMany:!0},{name:"rootElements",type:"RootElement",isMany:!0},{name:"diagrams",isMany:!0,type:"bpmndi:BPMNDiagram"},{name:"exporter",isAttr:!0,type:"String"},{name:"relationships",type:"Relationship",isMany:!0},{name:"exporterVersion",isAttr:!0,type:"String"}]}],enumerations:[{name:"ProcessType",literalValues:[{name:"None"},{name:"Public"},{name:"Private"}]},{name:"GatewayDirection",literalValues:[{name:"Unspecified"},{name:"Converging"},{name:"Diverging"},{name:"Mixed"}]},{name:"EventBasedGatewayType",literalValues:[{name:"Parallel"},{name:"Exclusive"}]},{name:"RelationshipDirection",literalValues:[{name:"None"},{name:"Forward"},{name:"Backward"},{name:"Both"}]},{name:"ItemKind",literalValues:[{name:"Physical"},{name:"Information"}]},{name:"ChoreographyLoopType",literalValues:[{name:"None"},{name:"Standard"},{name:"MultiInstanceSequential"},{name:"MultiInstanceParallel"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"MultiInstanceBehavior",literalValues:[{name:"None"},{name:"One"},{name:"All"},{name:"Complex"}]},{name:"AdHocOrdering",literalValues:[{name:"Parallel"},{name:"Sequential"}]}],xml:{tagAlias:"lowerCase",typePrefix:"t"}},bpmndi:{name:"BPMNDI",uri:"http://www.omg.org/spec/BPMN/20100524/DI",prefix:"bpmndi",types:[{name:"BPMNDiagram",properties:[{name:"plane",type:"BPMNPlane",redefines:"di:Diagram#rootElement"},{name:"labelStyle",type:"BPMNLabelStyle",isMany:!0}],superClass:["di:Diagram"]},{name:"BPMNPlane",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"}],superClass:["di:Plane"]},{name:"BPMNShape",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"isHorizontal",isAttr:!0,type:"Boolean"},{name:"isExpanded",isAttr:!0,type:"Boolean"},{name:"isMarkerVisible",isAttr:!0,type:"Boolean"},{name:"label",type:"BPMNLabel"},{name:"isMessageVisible",isAttr:!0,type:"Boolean"},{name:"participantBandKind",type:"ParticipantBandKind",isAttr:!0},{name:"choreographyActivityShape",type:"BPMNShape",isAttr:!0,isReference:!0}],superClass:["di:LabeledShape"]},{name:"BPMNEdge",properties:[{name:"label",type:"BPMNLabel"},{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"sourceElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#source"},{name:"targetElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#target"},{name:"messageVisibleKind",type:"MessageVisibleKind",isAttr:!0,default:"initiating"}],superClass:["di:LabeledEdge"]},{name:"BPMNLabel",properties:[{name:"labelStyle",type:"BPMNLabelStyle",isAttr:!0,isReference:!0,redefines:"di:DiagramElement#style"}],superClass:["di:Label"]},{name:"BPMNLabelStyle",properties:[{name:"font",type:"dc:Font"}],superClass:["di:Style"]}],enumerations:[{name:"ParticipantBandKind",literalValues:[{name:"top_initiating"},{name:"middle_initiating"},{name:"bottom_initiating"},{name:"top_non_initiating"},{name:"middle_non_initiating"},{name:"bottom_non_initiating"}]},{name:"MessageVisibleKind",literalValues:[{name:"initiating"},{name:"non_initiating"}]}],associations:[]},dc:{name:"DC",uri:"http://www.omg.org/spec/DD/20100524/DC",prefix:"dc",types:[{name:"Boolean"},{name:"Integer"},{name:"Real"},{name:"String"},{name:"Font",properties:[{name:"name",type:"String",isAttr:!0},{name:"size",type:"Real",isAttr:!0},{name:"isBold",type:"Boolean",isAttr:!0},{name:"isItalic",type:"Boolean",isAttr:!0},{name:"isUnderline",type:"Boolean",isAttr:!0},{name:"isStrikeThrough",type:"Boolean",isAttr:!0}]},{name:"Point",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0}]},{name:"Bounds",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0},{name:"width",type:"Real",isAttr:!0},{name:"height",type:"Real",isAttr:!0}]}],associations:[]},di:{name:"DI",uri:"http://www.omg.org/spec/DD/20100524/DI",prefix:"di",types:[{name:"DiagramElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"extension",type:"Extension"},{name:"owningDiagram",type:"Diagram",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"owningElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"modelElement",isReadOnly:!0,isVirtual:!0,isReference:!0,type:"Element"},{name:"style",type:"Style",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"ownedElement",type:"DiagramElement",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:"Node",isAbstract:!0,superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,superClass:["DiagramElement"],properties:[{name:"source",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"target",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"waypoint",isUnique:!1,isMany:!0,type:"dc:Point",xml:{serialize:"xsi:type"}}]},{name:"Diagram",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"rootElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0},{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"},{name:"ownedStyle",type:"Style",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:"Shape",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Plane",isAbstract:!0,superClass:["Node"],properties:[{name:"planeElement",type:"DiagramElement",subsettedProperty:"DiagramElement-ownedElement",isMany:!0}]},{name:"LabeledEdge",isAbstract:!0,superClass:["Edge"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isMany:!0,isVirtual:!0}]},{name:"LabeledShape",isAbstract:!0,superClass:["Shape"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isMany:!0,isVirtual:!0}]},{name:"Label",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Style",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"}]},{name:"Extension",properties:[{name:"values",isMany:!0,type:"Element"}]}],associations:[],xml:{tagAlias:"lowerCase"}},bioc:{name:"bpmn.io colors for BPMN",uri:"http://bpmn.io/schema/bpmn/biocolor/1.0",prefix:"bioc",types:[{name:"ColoredShape",extends:["bpmndi:BPMNShape"],properties:[{name:"stroke",isAttr:!0,type:"String"},{name:"fill",isAttr:!0,type:"String"}]},{name:"ColoredEdge",extends:["bpmndi:BPMNEdge"],properties:[{name:"stroke",isAttr:!0,type:"String"},{name:"fill",isAttr:!0,type:"String"}]}],enumerations:[],associations:[]},color:{name:"BPMN in Color",uri:"http://www.omg.org/spec/BPMN/non-normative/color/1.0",prefix:"color",types:[{name:"ColoredLabel",extends:["bpmndi:BPMNLabel"],properties:[{name:"color",isAttr:!0,type:"String"}]},{name:"ColoredShape",extends:["bpmndi:BPMNShape"],properties:[{name:"background-color",isAttr:!0,type:"String"},{name:"border-color",isAttr:!0,type:"String"}]},{name:"ColoredEdge",extends:["bpmndi:BPMNEdge"],properties:[{name:"border-color",isAttr:!0,type:"String"}]}],enumerations:[],associations:[]}};const ys=function(e,t){return new vs(Ve({},ws,e),t)};function Os(e){return e?"<"+e.$type+(e.id?' id="'+e.id:"")+'" />':"<null>"}function xs(e){return function(){if(!window.Promise)throw new Error("Promises is not supported in this environment. Please polyfill Promise.");var t=arguments.length;if(!(t>=1&&le(arguments[t-1])))return e.apply(this,arguments);var i=arguments[t-1];console.warn(new Error("Passing callbacks to "+e.name+" is deprecated and will be removed in a future major release. Please switch to promises: https://bpmn.io/l/moving-to-promises.html"));var n=Array.prototype.slice.call(arguments,0,-1);e.apply(this,n).then((function(e){var t=Object.keys(e)[0];return i(null,e[t])}),(function(e){return i(e,e.warnings)}))}}function $s(e){he(e,"di")||Object.defineProperty(e,"di",{get:function(){throw new Error("Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472")}})}function Cs(e,t){return e.$instanceOf(t)}function Ss(e,t){var i={},n=[],s={};function o(e,t){return function(i){e(i,t)}}function a(e){i[e.id]=e}function r(i,n){try{var o=s[i.id]&&function(i,n){if(i.gfx)throw new Error(t("already rendered {element}",{element:Os(i)}));return e.element(i,s[i.id],n)}(i,n);return a(i),o}catch(e){l(e.message,{element:i,error:e}),console.error(t("failed to import {element}",{element:Os(i)})),console.error(e)}}function l(t,i){e.error(t,i)}function c(e){var i=e.bpmnElement;i?s[i.id]?l(t("multiple DI elements defined for {element}",{element:Os(i)}),{element:i}):(s[i.id]=e,$s(i)):l(t("no bpmnElement referenced in {element}",{element:Os(e)}),{element:e})}function h(e){c(e)}function d(){for(;n.length;)n.shift()()}function u(e,t){C(e,t),w(e.ioSpecification,t),v(e.artifacts,t),a(e)}function p(e,t){r(e,t)}function f(e,t){r(e,t)}function m(e,t){r(e,t)}function g(e,t){r(e,t)}function b(e,t){r(e,t)}function v(e,t){pe(e,(function(e){Cs(e,"bpmn:Association")?n.push((function(){b(e,t)})):b(e,t)}))}function w(e,t){e&&(pe(e.dataInputs,o(m,t)),pe(e.dataOutputs,o(g,t)))}function y(e,t){C(e,t),v(e.artifacts,t)}function O(e,t){var i=r(e,t);Cs(e,"bpmn:SubProcess")&&y(e,i||t),Cs(e,"bpmn:Activity")&&w(e.ioSpecification,t),n.push((function(){pe(e.dataInputAssociations,o(f,t)),pe(e.dataOutputAssociations,o(f,t))}))}function x(e,t){n.push((function(){var i=r(e,t);e.childLaneSet&&$(e.childLaneSet,i||t),function(e){pe(e.flowNodeRef,(function(t){var i=t.get("lanes");i&&i.push(e)}))}(e)}))}function $(e,t){pe(e.lanes,o(x,t))}function C(e,i){!function(e,i){pe(e,(function(e){Cs(e,"bpmn:SequenceFlow")?n.push((function(){!function(e,t){r(e,t)}(e,i)})):Cs(e,"bpmn:BoundaryEvent")?n.unshift((function(){O(e,i)})):Cs(e,"bpmn:FlowNode")?O(e,i):Cs(e,"bpmn:DataObject")||(Cs(e,"bpmn:DataStoreReference")||Cs(e,"bpmn:DataObjectReference")?function(e,t){r(e,t)}(e,i):l(t("unrecognized flowElement {element} in context {context}",{element:Os(e),context:i?Os(i.businessObject):"null"}),{element:e,context:i}))}))}(e.flowElements,i),e.laneSets&&function(e,t){pe(e,o($,t))}(e.laneSets,i)}function S(e,t){var i=r(e,t),n=e.processRef;n&&u(n,i||t)}return{handleDeferred:d,handleDefinitions:function(a,r){var f=a.diagrams;if(r&&-1===f.indexOf(r))throw new Error(t("diagram not part of bpmn:Definitions"));if(!r&&f&&f.length&&(r=f[0]),!r)throw new Error(t("no diagram to display"));s={},function(e){var t;c(t=e.plane),pe(t.planeElement,h)}(r);var m=r.plane;if(!m)throw new Error(t("no plane for {element}",{element:Os(r)}));var g=m.bpmnElement;if(!g){if(g=function(e){return de(e.rootElements,(function(e){return Cs(e,"bpmn:Process")||Cs(e,"bpmn:Collaboration")}))}(a),!g)throw new Error(t("no process or collaboration to display"));l(t("correcting missing bpmnElement on {plane} to {rootElement}",{plane:Os(m),rootElement:Os(g)})),m.bpmnElement=g,c(m)}var b,w,y=function(t,i){return e.root(t,s[t.id],i)}(g,m);if(Cs(g,"bpmn:Process")||Cs(g,"bpmn:SubProcess"))u(g,y);else{if(!Cs(g,"bpmn:Collaboration"))throw new Error(t("unsupported bpmnElement for {plane}: {rootElement}",{plane:Os(m),rootElement:Os(g)}));w=y,pe((b=g).participants,o(S,w)),v(b.artifacts,w),n.push((function(){!function(e,t){pe(e,o(p,t))}(b.messageFlows,w)})),function(e,t){ue(e,(function(e){return!i[e.id]&&Cs(e,"bpmn:Process")&&e.laneSets})).forEach(o(u,t))}(a.rootElements,y)}d()},handleSubProcess:y,registerDi:c}}function _s(e,t){var i=Es(e);return i&&"function"==typeof i.$instanceOf&&i.$instanceOf(t)}function ks(e,t){return ge(t,(function(t){return _s(e,t)}))}function Es(e){return e&&e.businessObject||e}function Ps(e){return e&&e.di}function As(e,t,i){var n,s,o,a,r=[];function l(e,t){var i=new Ss({root:function(e,t){return n.add(e,t)},element:function(e,t,i){return n.add(e,t,i)},error:function(e,t){r.push({message:e,context:t})}},o);t=t||e.diagrams&&e.diagrams[0];var s=function(e,t){if(t){var i,n=t.plane.bpmnElement,s=n;_s(n,"bpmn:Process")||_s(n,"bpmn:Collaboration")||(s=function(e){for(var t=e;t;){if(_s(t,"bpmn:Process"))return t;t=t.$parent}}(n)),i=_s(s,"bpmn:Collaboration")?s:de(e.rootElements,(function(e){if(_s(e,"bpmn:Collaboration"))return de(e.participants,(function(e){return e.processRef===s}))}));var o=[s];i&&(o=be(i.participants,(function(e){return e.processRef}))).push(i);var a=Rs(o),r=[t],l=[n];return pe(e.diagrams,(function(e){var t=e.plane.bpmnElement;-1!==a.indexOf(t)&&-1===l.indexOf(t)&&(r.push(e),l.push(t))})),r}}(e,t);if(!s)throw new Error(o("no diagram to display"));pe(s,(function(t){i.handleDefinitions(e,t)}));var l=t.plane.bpmnElement.id;a.setRootElement(a.findRoot(l+"_plane")||a.findRoot(l))}return new Promise((function(c,h){try{return n=e.get("bpmnImporter"),s=e.get("eventBus"),o=e.get("translate"),a=e.get("canvas"),s.fire("import.render.start",{definitions:t}),l(t,i),s.fire("import.render.complete",{error:void 0,warnings:r}),c({warnings:r})}catch(e){return e.warnings=r,h(e)}}))}function Rs(e){var t=[];return pe(e,(function(e){e&&(t.push(e),t=t.concat(Rs(e.flowElements)))})),t}var Ds='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14.02 5.57" width="53" height="21" style="vertical-align:middle"><path fill="currentColor" d="M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z"/><path fill="currentColor" d="M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z"/></svg>';function Vs(e){return e.join(";")}var Ls,Ts=Vs(["color: #404040"]),Bs='<div class="bjs-powered-by-lightbox" style="'+Vs(["z-index: 1001","position: fixed","top: 0","left: 0","right: 0","bottom: 0"])+'"><div class="backdrop" style="'+Vs(["width: 100%","height: 100%","background: rgba(40,40,40,0.2)"])+'"></div><div class="notice" style="'+Vs(["position: absolute","left: 50%","top: 40%","transform: translate(-50%)","width: 260px","padding: 10px","background: white","box-shadow: 0 1px 4px rgba(0,0,0,0.3)","font-family: Helvetica, Arial, sans-serif","font-size: 14px","display: flex","line-height: 1.3"])+'"><a href="https://bpmn.io" target="_blank" rel="noopener" style="margin: 15px 20px 15px 10px; align-self: center;'+Ts+'">'+Ds+'</a><span>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="https://bpmn.io" target="_blank" rel="noopener">bpmn.io</a>.</span></div></div>';function Fs(e){var t,i;e=Ve({},js,e),this._moddle=this._createModdle(e),this._container=this._createContainer(e),t=this._container,i=it('<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" style="position: absolute; bottom: 15px; right: 15px; z-index: 100; '+Ts+'">'+Ds+"</a>"),t.appendChild(i),Ke.bind(i,"click",(function(e){Ls||(Ls=it(Bs),et(Ls,".backdrop","click",(function(e){document.body.removeChild(Ls)}))),document.body.appendChild(Ls),e.preventDefault()})),this._init(this._container,this._moddle,e)}function Is(e,t){return e.warnings=t,e}G()(Fs,an),Fs.prototype.importXML=xs((function(e,t){var i=this;return new Promise((function(n,s){e=i._emit("import.parse.start",{xml:e})||e,i._moddle.fromXML(e,"bpmn:Definitions").then((function(e){var o,a,r=e.rootElement,l=e.references,c=e.warnings,h=e.elementsById;r=i._emit("import.parse.complete",(o={error:null,definitions:r,elementsById:h,references:l,warnings:c},a=i.get("eventBus").createEvent(o),Object.defineProperty(a,"context",{enumerable:!0,get:function(){return console.warn(new Error("import.parse.complete <context> is deprecated and will be removed in future library versions")),{warnings:o.warnings,references:o.references,elementsById:o.elementsById}}}),a))||r,i.importDefinitions(r,t).then((function(e){var t=[].concat(c,e.warnings||[]);return i._emit("import.done",{error:null,warnings:t}),n({warnings:t})})).catch((function(e){var t=[].concat(c,e.warnings||[]);return i._emit("import.done",{error:e,warnings:t}),s(Is(e,t))}))})).catch((function(e){return i._emit("import.parse.complete",{error:e}),e=function(e){var t=/unparsable content <([^>]+)> detected([\s\S]*)$/.exec(e.message);return t&&(e.message="unparsable content <"+t[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+t[2]),e}(e),i._emit("import.done",{error:e,warnings:e.warnings}),s(e)}))}))})),Fs.prototype.importDefinitions=xs((function(e,t){var i=this;return new Promise((function(n,s){i._setDefinitions(e),i.open(t).then((function(e){var t=e.warnings;return n({warnings:t})})).catch((function(e){return s(e)}))}))})),Fs.prototype.open=xs((function(e){var t=this._definitions,i=e,n=this;return new Promise((function(s,o){if(!t){var a=new Error("no XML imported");return o(Is(a,[]))}if("string"==typeof e&&(i=function(e,t){return t&&de(e.diagrams,(function(e){return e.id===t}))||null}(t,e),!i)){var r=new Error("BPMNDiagram <"+e+"> not found");return o(Is(r,[]))}try{n.clear()}catch(e){return o(Is(e,[]))}As(n,t,i).then((function(e){var t=e.warnings;return s({warnings:t})})).catch((function(e){return o(e)}))}))})),Fs.prototype.saveXML=xs((function(e){e=e||{};var t=this,i=this._definitions;return new Promise((function(n){if(!i)return n({error:new Error("no definitions loaded")});i=t._emit("saveXML.start",{definitions:i})||i,t._moddle.toXML(i,e).then((function(e){var i=e.xml;return i=t._emit("saveXML.serialized",{xml:i})||i,n({xml:i})}))})).catch((function(e){return{error:e}})).then((function(e){t._emit("saveXML.done",e);var i=e.error;return i?Promise.reject(i):e}))})),Fs.prototype.saveSVG=xs((function(e){e=e||{};var t=this;return new Promise((function(e,i){var n,s;t._emit("saveSVG.start");try{var o=t.get("canvas"),a=o.getActiveLayer(),r=ot("defs",o._svg),l=Lt(a),c=r?"<defs>"+Lt(r)+"</defs>":"",h=a.getBBox();n='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- created with bpmn-js / http://bpmn.io --\x3e\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+h.width+'" height="'+h.height+'" viewBox="'+h.x+" "+h.y+" "+h.width+" "+h.height+'" version="1.1">'+c+l+"</svg>"}catch(e){s=e}return t._emit("saveSVG.done",{error:s,svg:n}),s?i(s):e({svg:n})}))})),Fs.prototype._setDefinitions=function(e){this._definitions=e},Fs.prototype.getModules=function(){return this._modules},Fs.prototype.clear=function(){this.getDefinitions()&&an.prototype.clear.call(this)},Fs.prototype.destroy=function(){an.prototype.destroy.call(this),rt(this._container)},Fs.prototype.on=function(e,t,i,n){return this.get("eventBus").on(e,t,i,n)},Fs.prototype.off=function(e,t){this.get("eventBus").off(e,t)},Fs.prototype.attachTo=function(e){if(!e)throw new Error("parentNode required");this.detach(),e.get&&e.constructor.prototype.jquery&&(e=e.get(0)),"string"==typeof e&&(e=ot(e)),e.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},Fs.prototype.getDefinitions=function(){return this._definitions},Fs.prototype.detach=function(){var e=this._container,t=e.parentNode;t&&(this._emit("detach",{}),t.removeChild(e))},Fs.prototype._init=function(e,t,i){var n=i.modules||this.getModules(),s=i.additionalModules||[],o=[].concat([{bpmnjs:["value",this],moddle:["value",t]}],n,s),a=Ve(Te(i,["additionalModules"]),{canvas:Ve({},i.canvas,{container:e}),modules:o});an.call(this,a),i&&i.container&&this.attachTo(i.container)},Fs.prototype._emit=function(e,t){return this.get("eventBus").fire(e,t)},Fs.prototype._createContainer=function(e){var t=it('<div class="bjs-container"></div>');return Ve(t.style,{width:Ms(e.width),height:Ms(e.height),position:e.position}),t},Fs.prototype._createModdle=function(e){var t=Ve({},this._moddleExtensions,e.moddleExtensions);return new ys(t)},Fs.prototype._modules=[];var js={width:"100%",height:"100%",position:"relative"};function Ms(e){return e+(re(e)?"px":"")}function Qs(e){Fs.call(this,e),this.on("import.parse.complete",(function(e){e.error||this._collectIds(e.definitions,e.elementsById)}),this),this.on("diagram.destroy",(function(){this.get("moddle").ids.clear()}),this)}function Ws(e,t){return!_s(e,"bpmn:CallActivity")&&(_s(e,"bpmn:SubProcess")?!(!(t=t||Ps(e))||!_s(t,"bpmndi:BPMNPlane"))||t&&!!t.isExpanded:!_s(e,"bpmn:Participant")||!!Es(e).processRef)}function Ns(e){return e&&!!Es(e).triggeredByEvent}function Zs(e,t){var i=Es(e),n=!1;return i.eventDefinitions&&pe(i.eventDefinitions,(function(e){_s(e,t)&&(n=!0)})),n}function qs(e){return _s(e,"bpmn:FlowElement")||_s(e,"bpmn:Participant")||_s(e,"bpmn:Lane")||_s(e,"bpmn:SequenceFlow")||_s(e,"bpmn:MessageFlow")||_s(e,"bpmn:DataInput")||_s(e,"bpmn:DataOutput")?"name":_s(e,"bpmn:TextAnnotation")?"text":_s(e,"bpmn:Group")?"categoryValueRef":void 0}function zs(e){var t=e.businessObject,i=qs(t);if(i)return"categoryValueRef"===i?function(e){var t=e.categoryValueRef;return t&&t.value||""}(t):t[i]||""}function Us(e,t,i){return ge(e.eventDefinitions,(function(n){return n.$type===t&&function(e,t){return me(t,(function(t,i){return e[i]==t}))}(e,i)}))}function Xs(e){return e.businessObject}function Gs(e,t){var i=Ps(e);return i.get("color:background-color")||i.get("bioc:fill")||t||"white"}function Ys(e,t){var i=Ps(e);return i.get("color:border-color")||i.get("bioc:stroke")||t||"black"}function Hs(e,t,i){var n=Ps(e).get("label");return n&&n.get("color:color")||t||Ys(e,i)}function Ks(e,t){var i=e.x,n=e.y,s=e.width,o=e.height;return Yt([["M",i+t,n],["l",s-2*t,0],["a",t,t,0,0,1,t,t],["l",0,o-2*t],["a",t,t,0,0,1,-t,t],["l",2*t-s,0],["a",t,t,0,0,1,-t,-t],["l",0,2*t-o],["a",t,t,0,0,1,t,-t],["z"]])}G()(Qs,Fs),Qs.prototype._createModdle=function(e){var t=Fs.prototype._createModdle.call(this,e);return t.ids=new K([32,36,1]),t},Qs.prototype._collectIds=function(e,t){var i,n=e.$model.ids;for(i in n.clear(),t)n.claim(i,t[i])};var Js=new K,eo=.95;function to(e,t,i,n,s,o,a){Gt.call(this,t,a);var r=e&&e.defaultFillColor,l=e&&e.defaultStrokeColor,c=e&&e.defaultLabelColor,h=Js.next(),d={},u=i.computeStyle;function p(e,t){var i=Ve({fill:"black",strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},t.attrs),n=t.ref||{x:0,y:0},o=t.scale||1;"none"===i.strokeDasharray&&(i.strokeDasharray=[1e4,1]);var a=St("marker");ut(t.element,i),ct(a,t.element),ut(a,{id:e,viewBox:"0 0 20 20",refX:n.x,refY:n.y,markerWidth:20*o,markerHeight:20*o,orient:"auto"});var r=ot("defs",s._svg);r||(r=St("defs"),ct(s._svg,r)),ct(r,a),d[e]=a}function f(e){return e.replace(/[^0-9a-zA-z]+/g,"_")}function m(e,t,i){var n=e+"-"+f(t)+"-"+f(i)+"-"+h;return d[n]||function(e,t,i,n){if("sequenceflow-end"===t){var s=St("path");ut(s,{d:"M 1 5 L 11 10 L 1 15 Z"}),p(e,{element:s,ref:{x:11,y:10},scale:.5,attrs:{fill:n,stroke:n}})}if("messageflow-start"===t){var o=St("circle");ut(o,{cx:6,cy:6,r:3.5}),p(e,{element:o,attrs:{fill:i,stroke:n},ref:{x:6,y:6}})}if("messageflow-end"===t){var a=St("path");ut(a,{d:"m 1 5 l 0 -3 l 7 3 l -7 3 z"}),p(e,{element:a,attrs:{fill:i,stroke:n,strokeLinecap:"butt"},ref:{x:8.5,y:5}})}if("association-start"===t){var r=St("path");ut(r,{d:"M 11 5 L 1 10 L 11 15"}),p(e,{element:r,attrs:{fill:"none",stroke:n,strokeWidth:1.5},ref:{x:1,y:10},scale:.5})}if("association-end"===t){var l=St("path");ut(l,{d:"M 1 5 L 11 10 L 1 15"}),p(e,{element:l,attrs:{fill:"none",stroke:n,strokeWidth:1.5},ref:{x:12,y:10},scale:.5})}if("conditional-flow-marker"===t){var c=St("path");ut(c,{d:"M 0 10 L 8 6 L 16 10 L 8 14 Z"}),p(e,{element:c,attrs:{fill:i,stroke:n},ref:{x:-1,y:10},scale:.5})}if("conditional-default-flow-marker"===t){var h=St("path");ut(h,{d:"M 6 4 L 10 16"}),p(e,{element:h,attrs:{stroke:n},ref:{x:0,y:10},scale:.5})}}(n,e,t,i),"url(#"+n+")"}function g(e,t,i,n,s){ae(n)&&(s=n,n=0),n=n||0,"none"===(s=u(s,{stroke:"black",strokeWidth:2,fill:"white"})).fill&&delete s.fillOpacity;var o=t/2,a=i/2,r=St("circle");return ut(r,{cx:o,cy:a,r:Math.round((t+i)/4-n)}),ut(r,s),ct(e,r),r}function b(e,t,i,n,s,o){ae(s)&&(o=s,s=0),s=s||0,o=u(o,{stroke:"black",strokeWidth:2,fill:"white"});var a=St("rect");return ut(a,{x:s,y:s,width:t-2*s,height:i-2*s,rx:n,ry:n}),ut(a,o),ct(e,a),a}function v(e,t,i){var n=Kt(t,i=u(i,["no-fill"],{stroke:"black",strokeWidth:2,fill:"none"}));return ct(e,n),n}function w(e,t,i){i=u(i,["no-fill"],{strokeWidth:2,stroke:"black"});var n=St("path");return ut(n,{d:t}),ut(n,i),ct(e,n),n}function y(e,t,i,n){return w(t,i,Ve({"data-marker":e},n))}function O(e){return E[e]}function x(e){return function(t,i){return O(e)(t,i)}}function $(e,t){var i=Xs(e),n=function(e){return"bpmn:IntermediateThrowEvent"===e.$type||"bpmn:EndEvent"===e.$type}(i);return i.eventDefinitions&&i.eventDefinitions.length>1?i.parallelMultiple?O("bpmn:ParallelMultipleEventDefinition")(t,e,n):O("bpmn:MultipleEventDefinition")(t,e,n):Us(i,"bpmn:MessageEventDefinition")?O("bpmn:MessageEventDefinition")(t,e,n):Us(i,"bpmn:TimerEventDefinition")?O("bpmn:TimerEventDefinition")(t,e,n):Us(i,"bpmn:ConditionalEventDefinition")?O("bpmn:ConditionalEventDefinition")(t,e):Us(i,"bpmn:SignalEventDefinition")?O("bpmn:SignalEventDefinition")(t,e,n):Us(i,"bpmn:EscalationEventDefinition")?O("bpmn:EscalationEventDefinition")(t,e,n):Us(i,"bpmn:LinkEventDefinition")?O("bpmn:LinkEventDefinition")(t,e,n):Us(i,"bpmn:ErrorEventDefinition")?O("bpmn:ErrorEventDefinition")(t,e,n):Us(i,"bpmn:CancelEventDefinition")?O("bpmn:CancelEventDefinition")(t,e,n):Us(i,"bpmn:CompensateEventDefinition")?O("bpmn:CompensateEventDefinition")(t,e,n):Us(i,"bpmn:TerminateEventDefinition")?O("bpmn:TerminateEventDefinition")(t,e,n):null}function C(e,t,i){i=Ve({size:{width:100}},i);var n=o.createText(t||"",i);return bt(n).add("djs-label"),ct(e,n),n}function S(e,t,i){return C(e,Xs(t).name,{box:t,align:i,padding:5,style:{fill:Hs(t,c,l)}})}function _(e,t,i){Ji(C(e,t,{box:{height:30,width:i.height},align:"center-middle",style:{fill:Hs(i,c,l)}}),0,1*i.height,270)}function k(e){for(var t=e.waypoints,i="m  "+t[0].x+","+t[0].y,n=1;n<t.length;n++)i+="L"+t[n].x+","+t[n].y+" ";return i}var E=this.handlers={"bpmn:Event":function(e,t,i){return"fillOpacity"in i||(i.fillOpacity=eo),g(e,t.width,t.height,i)},"bpmn:StartEvent":function(e,t){var i={fill:Gs(t,r),stroke:Ys(t,l)};Xs(t).isInterrupting||(i={strokeDasharray:"6",strokeLinecap:"round",fill:Gs(t,r),stroke:Ys(t,l)});var n=O("bpmn:Event")(e,t,i);return $(t,e),n},"bpmn:MessageEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:t.width,containerHeight:t.height,position:{mx:.235,my:.315}}),{strokeWidth:1,fill:i?Ys(t,l):Gs(t,r),stroke:i?Gs(t,r):Ys(t,l)})},"bpmn:TimerEventDefinition":function(e,t){var i=g(e,t.width,t.height,.2*t.height,{strokeWidth:2,fill:Gs(t,r),stroke:Ys(t,l)});w(e,n.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.5}}),{strokeWidth:2,strokeLinecap:"square",stroke:Ys(t,l)});for(var s=0;s<12;s++){var o=n.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.5}}),a=t.width/2;w(e,o,{strokeWidth:1,strokeLinecap:"square",transform:"rotate("+30*s+","+t.height/2+","+a+")",stroke:Ys(t,l)})}return i},"bpmn:EscalationEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:i?Ys(t,l):"none",stroke:Ys(t,l)})},"bpmn:ConditionalEventDefinition":function(e,t){return w(e,n.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.222}}),{strokeWidth:1,stroke:Ys(t,l)})},"bpmn:LinkEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.57,my:.263}}),{strokeWidth:1,fill:i?Ys(t,l):"none",stroke:Ys(t,l)})},"bpmn:ErrorEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:t.width,containerHeight:t.height,position:{mx:.2,my:.722}}),{strokeWidth:1,fill:i?Ys(t,l):"none",stroke:Ys(t,l)})},"bpmn:CancelEventDefinition":function(e,t,i){var s=w(e,n.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.638,my:-.055}}),{strokeWidth:1,fill:i?Ys(t,l):"none",stroke:Ys(t,l)});return tn(s,45),s},"bpmn:CompensateEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.22,my:.5}}),{strokeWidth:1,fill:i?Ys(t,l):"none",stroke:Ys(t,l)})},"bpmn:SignalEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:i?Ys(t,l):"none",stroke:Ys(t,l)})},"bpmn:MultipleEventDefinition":function(e,t,i){return w(e,n.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:t.width,containerHeight:t.height,position:{mx:.222,my:.36}}),{strokeWidth:1,fill:i?Ys(t,l):"none"})},"bpmn:ParallelMultipleEventDefinition":function(e,t){return w(e,n.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:t.width,containerHeight:t.height,position:{mx:.458,my:.194}}),{strokeWidth:1,fill:Ys(t,l),stroke:Ys(t,l)})},"bpmn:EndEvent":function(e,t){var i=O("bpmn:Event")(e,t,{strokeWidth:4,fill:Gs(t,r),stroke:Ys(t,l)});return $(t,e),i},"bpmn:TerminateEventDefinition":function(e,t){return g(e,t.width,t.height,8,{strokeWidth:4,fill:Ys(t,l),stroke:Ys(t,l)})},"bpmn:IntermediateEvent":function(e,t){var i=O("bpmn:Event")(e,t,{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)});return g(e,t.width,t.height,3,{strokeWidth:1,fill:Gs(t,"none"),stroke:Ys(t,l)}),$(t,e),i},"bpmn:IntermediateCatchEvent":x("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":x("bpmn:IntermediateEvent"),"bpmn:Activity":function(e,t,i){return"fillOpacity"in(i=i||{})||(i.fillOpacity=eo),b(e,t.width,t.height,10,i)},"bpmn:Task":function(e,t){var i={fill:Gs(t,r),stroke:Ys(t,l)},n=O("bpmn:Activity")(e,t,i);return S(e,t,"center-middle"),P(e,t),n},"bpmn:ServiceTask":function(e,t){var i=O("bpmn:Task")(e,t);return w(e,n.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)}),w(e,n.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}}),{strokeWidth:0,fill:Gs(t,r)}),w(e,n.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}),{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)}),i},"bpmn:UserTask":function(e,t){var i=O("bpmn:Task")(e,t);return w(e,n.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:Gs(t,r),stroke:Ys(t,l)}),w(e,n.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:Gs(t,r),stroke:Ys(t,l)}),w(e,n.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:Ys(t,l),stroke:Ys(t,l)}),i},"bpmn:ManualTask":function(e,t){var i=O("bpmn:Task")(e,t);return w(e,n.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}}),{strokeWidth:.5,fill:Gs(t,r),stroke:Ys(t,l)}),i},"bpmn:SendTask":function(e,t){var i=O("bpmn:Task")(e,t);return w(e,n.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{strokeWidth:1,fill:Ys(t,l),stroke:Gs(t,r)}),i},"bpmn:ReceiveTask":function(e,t){var i,s=Xs(t),o=O("bpmn:Task")(e,t);return s.instantiate?(g(e,28,28,4.4,{strokeWidth:1}),i=n.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):i=n.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),w(e,i,{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)}),o},"bpmn:ScriptTask":function(e,t){var i=O("bpmn:Task")(e,t);return w(e,n.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}}),{strokeWidth:1,stroke:Ys(t,l)}),i},"bpmn:BusinessRuleTask":function(e,t){var i=O("bpmn:Task")(e,t);return ut(w(e,n.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}})),{strokeWidth:1,fill:Gs(t,"#aaaaaa"),stroke:Ys(t,l)}),ut(w(e,n.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}})),{strokeWidth:1,stroke:Ys(t,l)}),i},"bpmn:SubProcess":function(e,t,i){i=Ve({fill:Gs(t,r),stroke:Ys(t,l)},i);var n=O("bpmn:Activity")(e,t,i),s=Ws(t);return Ns(t)&&ut(n,{strokeDasharray:"1,2"}),S(e,t,s?"center-top":"center-middle"),s?P(e,t):P(e,t,["SubProcessMarker"]),n},"bpmn:AdHocSubProcess":function(e,t){return O("bpmn:SubProcess")(e,t)},"bpmn:Transaction":function(e,t){var n=O("bpmn:SubProcess")(e,t),s=i.style(["no-fill","no-events"],{stroke:Ys(t,l)});return b(e,t.width,t.height,8,3,s),n},"bpmn:CallActivity":function(e,t){return O("bpmn:SubProcess")(e,t,{strokeWidth:5})},"bpmn:Participant":function(e,t){var i={fillOpacity:eo,fill:Gs(t,r),stroke:Ys(t,l)},n=O("bpmn:Lane")(e,t,i);return Ws(t)?(v(e,[{x:30,y:0},{x:30,y:t.height}],{stroke:Ys(t,l)}),_(e,Xs(t).name,t)):C(e,Xs(t).name,{box:t,align:"center-middle",style:{fill:Hs(t,c,l)}}),!!Xs(t).participantMultiplicity&&O("ParticipantMultiplicityMarker")(e,t),n},"bpmn:Lane":function(e,t,i){var n=b(e,t.width,t.height,0,Ve({fill:Gs(t,r),fillOpacity:.35,stroke:Ys(t,l)},i)),s=Xs(t);return"bpmn:Lane"===s.$type&&_(e,s.name,t),n},"bpmn:InclusiveGateway":function(e,t){var i=O("bpmn:Gateway")(e,t);return g(e,t.width,t.height,.24*t.height,{strokeWidth:2.5,fill:Gs(t,r),stroke:Ys(t,l)}),i},"bpmn:ExclusiveGateway":function(e,t){var i=O("bpmn:Gateway")(e,t),s=n.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:t.width,containerHeight:t.height,position:{mx:.32,my:.3}});return Ps(t).isMarkerVisible&&w(e,s,{strokeWidth:1,fill:Ys(t,l),stroke:Ys(t,l)}),i},"bpmn:ComplexGateway":function(e,t){var i=O("bpmn:Gateway")(e,t);return w(e,n.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:t.width,containerHeight:t.height,position:{mx:.46,my:.26}}),{strokeWidth:1,fill:Ys(t,l),stroke:Ys(t,l)}),i},"bpmn:ParallelGateway":function(e,t){var i=O("bpmn:Gateway")(e,t);return w(e,n.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:t.width,containerHeight:t.height,position:{mx:.46,my:.2}}),{strokeWidth:1,fill:Ys(t,l),stroke:Ys(t,l)}),i},"bpmn:EventBasedGateway":function(e,t){var i=Xs(t),s=O("bpmn:Gateway")(e,t);g(e,t.width,t.height,.2*t.height,{strokeWidth:1,fill:"none",stroke:Ys(t,l)});var o=i.eventGatewayType,a=!!i.instantiate;if("Parallel"===o){var r=n.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:t.width,containerHeight:t.height,position:{mx:.474,my:.296}});ut(w(e,r),{strokeWidth:1,fill:"none"})}else"Exclusive"===o&&(a||ut(g(e,t.width,t.height,.26*t.height),{strokeWidth:1,fill:"none",stroke:Ys(t,l)}),function(){var i=n.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:t.width,containerHeight:t.height,position:{mx:.36,my:.44}}),s={strokeWidth:2,fill:Gs(t,"none"),stroke:Ys(t,l)};w(e,i,s)}());return s},"bpmn:Gateway":function(e,t){var i={fill:Gs(t,r),fillOpacity:eo,stroke:Ys(t,l)};return function(e,t,i,n){var s=t/2,o=i/2,a=[{x:s,y:0},{x:t,y:o},{x:s,y:i},{x:0,y:o}].map((function(e){return e.x+","+e.y})).join(" ");n=u(n,{stroke:"black",strokeWidth:2,fill:"white"});var r=St("polygon");return ut(r,{points:a}),ut(r,n),ct(e,r),r}(e,t.width,t.height,i)},"bpmn:SequenceFlow":function(e,t){var i,n=k(t),s=Gs(t,r),o=Ys(t,l),a=w(e,n,{strokeLinejoin:"round",markerEnd:m("sequenceflow-end",s,o),stroke:Ys(t,l)}),c=Xs(t);return t.source&&(i=t.source.businessObject,c.conditionExpression&&i.$instanceOf("bpmn:Activity")&&ut(a,{markerStart:m("conditional-flow-marker",s,o)}),i.default&&(i.$instanceOf("bpmn:Gateway")||i.$instanceOf("bpmn:Activity"))&&i.default===c&&ut(a,{markerStart:m("conditional-default-flow-marker",s,o)})),a},"bpmn:Association":function(e,t,i){var n=Xs(t),s=Gs(t,r),o=Ys(t,l);return i=Ve({strokeDasharray:"0.5, 5",strokeLinecap:"round",strokeLinejoin:"round",stroke:Ys(t,l)},i||{}),"One"!==n.associationDirection&&"Both"!==n.associationDirection||(i.markerEnd=m("association-end",s,o)),"Both"===n.associationDirection&&(i.markerStart=m("association-start",s,o)),v(e,t.waypoints,i)},"bpmn:DataInputAssociation":function(e,t){var i=Gs(t,r),n=Ys(t,l);return O("bpmn:Association")(e,t,{markerEnd:m("association-end",i,n)})},"bpmn:DataOutputAssociation":function(e,t){var i=Gs(t,r),n=Ys(t,l);return O("bpmn:Association")(e,t,{markerEnd:m("association-end",i,n)})},"bpmn:MessageFlow":function(e,t){var i=Xs(t),s=Ps(t),o=Gs(t,r),a=Ys(t,l),h=w(e,k(t),{markerEnd:m("messageflow-end",o,a),markerStart:m("messageflow-start",o,a),strokeDasharray:"10, 12",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px",stroke:Ys(t,l)});if(i.messageRef){var d=h.getPointAtLength(h.getTotalLength()/2),u=n.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:d.x,y:d.y}}),p={strokeWidth:1};"initiating"===s.messageVisibleKind?(p.fill="white",p.stroke="black"):(p.fill="#888",p.stroke="white");var f=w(e,u,p),g=C(e,i.messageRef.name,{align:"center-top",fitBox:!0,style:{fill:Ys(t,c)}}),b=f.getBBox(),v=g.getBBox();Ji(g,d.x-v.width/2,d.y+b.height/2+10,0)}return h},"bpmn:DataObject":function(e,t){var i=w(e,n.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.474,my:.296}}),{fill:Gs(t,r),fillOpacity:eo,stroke:Ys(t,l)});return function(e){var t=e.dataObjectRef;return e.isCollection||t&&t.isCollection}(Xs(t))&&function(e,t){var i=(t.height-18)/t.height;w(e,n.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.33,my:i}}),{strokeWidth:2})}(e,t),i},"bpmn:DataObjectReference":x("bpmn:DataObject"),"bpmn:DataInput":function(e,t){var i=n.getRawPath("DATA_ARROW"),s=O("bpmn:DataObject")(e,t);return w(e,i,{strokeWidth:1}),s},"bpmn:DataOutput":function(e,t){var i=n.getRawPath("DATA_ARROW"),s=O("bpmn:DataObject")(e,t);return w(e,i,{strokeWidth:1,fill:"black"}),s},"bpmn:DataStoreReference":function(e,t){return w(e,n.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:0,my:.133}}),{strokeWidth:2,fill:Gs(t,r),fillOpacity:eo,stroke:Ys(t,l)})},"bpmn:BoundaryEvent":function(e,t){var i=Xs(t).cancelActivity,n={strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)};i||(n.strokeDasharray="6",n.strokeLinecap="round");var s=Ve({},n,{fillOpacity:1}),o=Ve({},n,{fill:"none"}),a=O("bpmn:Event")(e,t,s);return g(e,t.width,t.height,3,o),$(t,e),a},"bpmn:Group":function(e,t){return b(e,t.width,t.height,10,{stroke:Ys(t,l),strokeWidth:1,strokeDasharray:"8,3,1,3",fill:"none",pointerEvents:"none"})},label:function(e,t){return function(e,t){var i={width:90,height:30,x:t.width/2+t.x,y:t.height/2+t.y};return C(e,zs(t),{box:i,fitBox:!0,style:Ve({},o.getExternalStyle(),{fill:Hs(t,c,l)})})}(e,t)},"bpmn:TextAnnotation":function(e,t){var i=b(e,t.width,t.height,0,0,{fill:"none",stroke:"none"});return w(e,n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:0,my:0}}),{stroke:Ys(t,l)}),C(e,Xs(t).text||"",{box:t,align:"left-top",padding:5,style:{fill:Hs(t,c,l)}}),i},ParticipantMultiplicityMarker:function(e,t){y("participant-multiplicity",e,n.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:t.width/2/t.width,my:(t.height-15)/t.height}}),{strokeWidth:2,fill:Gs(t,r),stroke:Ys(t,l)})},SubProcessMarker:function(e,t){en(b(e,14,14,0,{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)}),t.width/2-7.5,t.height-20),y("sub-process",e,n.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2-7.5)/t.width,my:(t.height-20)/t.height}}),{fill:Gs(t,r),stroke:Ys(t,l)})},ParallelMarker:function(e,t,i){y("parallel",e,n.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.parallel)/t.width,my:(t.height-20)/t.height}}),{fill:Gs(t,r),stroke:Ys(t,l)})},SequentialMarker:function(e,t,i){y("sequential",e,n.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.seq)/t.width,my:(t.height-19)/t.height}}),{fill:Gs(t,r),stroke:Ys(t,l)})},CompensationMarker:function(e,t,i){y("compensation",e,n.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.compensation)/t.width,my:(t.height-13)/t.height}}),{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l)})},LoopMarker:function(e,t,i){y("loop",e,n.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.loop)/t.width,my:(t.height-7)/t.height}}),{strokeWidth:1,fill:Gs(t,r),stroke:Ys(t,l),strokeLinecap:"round",strokeMiterlimit:.5})},AdhocMarker:function(e,t,i){y("adhoc",e,n.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+i.adhoc)/t.width,my:(t.height-15)/t.height}}),{strokeWidth:1,fill:Ys(t,l),stroke:Ys(t,l)})}};function P(e,t,i){var n,s=Xs(t),o=i&&-1!==i.indexOf("SubProcessMarker");n=o?{seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},pe(i,(function(i){O(i)(e,t,n)})),s.isForCompensation&&O("CompensationMarker")(e,t,n),"bpmn:AdHocSubProcess"===s.$type&&O("AdhocMarker")(e,t,n);var a=s.loopCharacteristics,r=a&&a.isSequential;a&&(void 0===r&&O("LoopMarker")(e,t,n),!1===r&&O("ParallelMarker")(e,t,n),!0===r&&O("SequentialMarker")(e,t,n))}this._drawPath=w,this._renderer=O}G()(to,Gt),to.$inject=["config.bpmnRenderer","eventBus","styles","pathMap","canvas","textRenderer"],to.prototype.canRender=function(e){return _s(e,"bpmn:BaseElement")},to.prototype.drawShape=function(e,t){var i=t.type;return this._renderer(i)(e,t)},to.prototype.drawConnection=function(e,t){var i=t.type;return this._renderer(i)(e,t)},to.prototype.getShapePath=function(e){return _s(e,"bpmn:Event")?Yt([["M",(t=e).x+t.width/2,t.y+t.height/2],["m",0,-(i=t.width/2)],["a",i,i,0,1,1,0,2*i],["a",i,i,0,1,1,0,-2*i],["z"]]):_s(e,"bpmn:Activity")?Ks(e,10):_s(e,"bpmn:Gateway")?function(e){var t=e.width/2,i=e.height/2;return Yt([["M",e.x+t,e.y],["l",t,i],["l",-t,i],["l",-t,-i],["z"]])}(e):function(e){var t=e.x,i=e.y,n=e.width;return Yt([["M",t,i],["l",n,0],["l",0,e.height],["l",-n,0],["z"]])}(e);var t,i};var io={width:150,height:50};function no(e,t){var i;t.textContent=e;try{var n,s=""===e;return t.textContent=s?"dummy":e,n={width:(i=t.getBBox()).width+2*i.x,height:i.height},s&&(n.width=0),n}catch(e){return{width:0,height:0}}}function so(e,t,i){for(var n,s=e.shift(),o=s;;){if((n=no(o,i)).width=o?n.width:0," "===o||""===o||n.width<Math.round(t)||o.length<2)return oo(e,o,s,n);o=ao(o,n.width,t)}}function oo(e,t,i,n){if(t.length<i.length){var s=i.slice(t.length).trim();e.unshift(s)}return{width:n.width,height:n.height,text:t}}function ao(e,t,i){var n=Math.max(e.length*(i/t),1),s=function(e,t){var i,n=e.split(/(\s|-|\u00AD)/g),s=[],o=0;if(n.length>1)for(;i=n.shift();){if(!(i.length+o<t)){"-"!==i&&"­"!==i||s.pop();break}s.push(i),o+=i.length}var a=s[s.length-1];return a&&"­"===a&&(s[s.length-1]="-"),s.join("")}(e,n);return s||(s=e.slice(0,Math.max(Math.round(n-1),1))),s}function ro(e){this._config=Ve({},{size:io,padding:0,style:{},align:"center-top"},e||{})}function lo(e){var t=Ve({fontFamily:"Arial, sans-serif",fontSize:12,fontWeight:"normal",lineHeight:1.2},e&&e.defaultStyle||{}),i=parseInt(t.fontSize,10)-1,n=Ve({},t,{fontSize:i},e&&e.externalStyle||{}),s=new ro({style:t});this.getExternalLabelBounds=function(e,t){var i=s.getDimensions(t,{box:{width:90,height:30,x:e.width/2+e.x,y:e.height/2+e.y},style:n});return{x:Math.round(e.x+e.width/2-i.width/2),y:Math.round(e.y),width:Math.ceil(i.width),height:Math.ceil(i.height)}},this.getTextAnnotationBounds=function(e,i){var n=s.getDimensions(i,{box:e,style:t,align:"left-top",padding:5});return{x:e.x,y:e.y,width:e.width,height:Math.max(30,Math.round(n.height))}},this.createText=function(e,t){return s.createText(e,t||{})},this.getDefaultStyle=function(){return t},this.getExternalStyle=function(){return n}}ro.prototype.createText=function(e,t){return this.layoutText(e,t).element},ro.prototype.getDimensions=function(e,t){return this.layoutText(e,t).dimensions},ro.prototype.layoutText=function(e,t){var i,n=Ve({},this._config.size,t.box),s=Ve({},this._config.style,t.style),o=function(e){var t=e.split("-");return{horizontal:t[0]||"center",vertical:t[1]||"top"}}(t.align||this._config.align),a=function(e){return ae(e)?Ve({top:0,left:0,right:0,bottom:0},e):{top:e,left:e,right:e,bottom:e}}(void 0!==t.padding?t.padding:this._config.padding),r=t.fitBox||!1,l=function(e){if("fontSize"in e&&"lineHeight"in e)return e.lineHeight*parseInt(e.fontSize,10)}(s),c=e.split(/\u00AD?\r?\n/),h=[],d=n.width-a.left-a.right,u=St("text");for(ut(u,{x:0,y:0}),ut(u,s),ct((i=void 0,(i=document.getElementById("helper-svg"))||(ut(i=St("svg"),{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(i)),i),u);c.length;)h.push(so(c,d,u));"middle"===o.vertical&&(a.top=a.bottom=0);var p=fe(h,(function(e,t,i){return e+(l||t.height)}),0)+a.top+a.bottom,f=fe(h,(function(e,t,i){return t.width>e?t.width:e}),0),m=a.top;"middle"===o.vertical&&(m+=(n.height-p)/2),m-=(l||h[0].height)/4;var g=St("text");return ut(g,s),pe(h,(function(e){var t;switch(m+=l||e.height,o.horizontal){case"left":t=a.left;break;case"right":t=(r?f:d)-a.right-e.width;break;default:t=Math.max(((r?f:d)-e.width)/2+a.left,0)}var i=St("tspan");ut(i,{x:t,y:m}),i.textContent=e.text,ct(g,i)})),wt(u),{dimensions:{width:f,height:p},element:g}},lo.$inject=["config.textRenderer"];var co=/\{([^{}]+)\}/g,ho=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;const uo={__init__:["bpmnRenderer"],bpmnRenderer:["type",to],textRenderer:["type",lo],pathMap:["type",function(){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z",height:36,width:36,heightElements:[20,7],widthElements:[8]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(e){return this.pathMap[e].d},this.getScaledPath=function(e,t){var i,n,s=this.pathMap[e];t.abspos?(i=t.abspos.x,n=t.abspos.y):(i=t.containerWidth*t.position.mx,n=t.containerHeight*t.position.my);var o,a,r={};if(t.position){for(var l=t.containerHeight/s.height*t.yScaleFactor,c=t.containerWidth/s.width*t.xScaleFactor,h=0;h<s.heightElements.length;h++)r["y"+h]=s.heightElements[h]*l;for(var d=0;d<s.widthElements.length;d++)r["x"+d]=s.widthElements[d]*c}return o=s.d,a={mx:i,my:n,e:r},String(o).replace(co,(function(e,t){return function(e,t,i){var n=i;return t.replace(ho,(function(e,t,i,s,o){t=t||s,n&&(t in n&&(n=n[t]),"function"==typeof n&&o&&(n=n()))})),n=(null==n||n==i?e:n)+""}(e,t,a)}))}}]},po={translate:["value",function(e,t){return t=t||{},e.replace(/{([^}]+)}/g,(function(e,i){return t[i]||"{"+i+"}"}))}]};var fo={width:90,height:20};function mo(e){return _s(e,"bpmn:Event")||_s(e,"bpmn:Gateway")||_s(e,"bpmn:DataStoreReference")||_s(e,"bpmn:DataObjectReference")||_s(e,"bpmn:DataInput")||_s(e,"bpmn:DataOutput")||_s(e,"bpmn:SequenceFlow")||_s(e,"bpmn:MessageFlow")||_s(e,"bpmn:Group")}function go(e){return vo(e.label)}function bo(e){return e.waypoints?function(e){var t=e.length/2-1,i=e[Math.floor(t)],n=e[Math.ceil(t+.01)],s=function(e){var t=e.length/2-1,i=e[Math.floor(t)],n=e[Math.ceil(t+.01)];return{x:i.x+(n.x-i.x)/2,y:i.y+(n.y-i.y)/2}}(e),o=Math.atan((n.y-i.y)/(n.x-i.x)),a=s.x,r=s.y;return Math.abs(o)<Math.PI/2?r-=15:a+=15,{x:a,y:r}}(e.waypoints):_s(e,"bpmn:Group")?{x:e.x+e.width/2,y:e.y+fo.height/2}:{x:e.x+e.width/2,y:e.y+e.height+fo.height/2}}function vo(e){return e&&!!e.labelTarget}function wo(e,t,i){return Ve({id:e.id,type:e.$type,businessObject:e,di:t},i)}function yo(e,t,i){var n=e.waypoint;return!n||n.length<2?[Ci(t),Ci(i)]:n.map((function(e){return{x:e.x,y:e.y}}))}function Oo(e,t,i,n){return new Error(e("element {element} referenced by {referenced}#{property} not yet drawn",{element:Os(i),referenced:Os(t),property:n}))}function xo(e,t,i,n,s,o){this._eventBus=e,this._canvas=t,this._elementFactory=i,this._elementRegistry=n,this._translate=s,this._textRenderer=o}xo.$inject=["eventBus","canvas","elementFactory","elementRegistry","translate","textRenderer"],xo.prototype.add=function(e,t,i){var n,s,o,a,r,l,c,h=this._translate;if(_s(t,"bpmndi:BPMNPlane")){var d=_s(e,"bpmn:SubProcess")?{id:e.id+"_plane"}:{};n=this._elementFactory.createRoot(wo(e,t,d)),this._canvas.addRootElement(n)}else if(_s(t,"bpmndi:BPMNShape")){var u=!Ws(e,t),p=function(e){return _s(e,"bpmn:Group")}(e);s=i&&(i.hidden||i.collapsed);var f=t.bounds;n=this._elementFactory.createShape(wo(e,t,{collapsed:u,hidden:s,x:Math.round(f.x),y:Math.round(f.y),width:Math.round(f.width),height:Math.round(f.height),isFrame:p})),_s(e,"bpmn:BoundaryEvent")&&this._attachBoundary(e,n),_s(e,"bpmn:Lane")&&(o=0),_s(e,"bpmn:DataStoreReference")&&(a=i,l=(r=Ci(f)).x,c=r.y,l>=a.x&&l<=a.x+a.width&&c>=a.y&&c<=a.y+a.height||(i=this._canvas.findRoot(i))),this._canvas.addShape(n,i,o)}else{if(!_s(t,"bpmndi:BPMNEdge"))throw new Error(h("unknown di {di} for element {semantic}",{di:Os(t),semantic:Os(e)}));var m=this._getSource(e),g=this._getTarget(e);s=i&&(i.hidden||i.collapsed),n=this._elementFactory.createConnection(wo(e,t,{hidden:s,source:m,target:g,waypoints:yo(t,m,g)})),_s(e,"bpmn:DataAssociation")&&(i=this._canvas.findRoot(i)),_s(e,"bpmn:SequenceFlow")&&(o=0),this._canvas.addConnection(n,i,o)}return mo(e)&&zs(n)&&this.addLabel(e,t,n),this._eventBus.fire("bpmnElement.added",{element:n}),n},xo.prototype._attachBoundary=function(e,t){var i=this._translate,n=e.attachedToRef;if(!n)throw new Error(i("missing {semantic}#attachedToRef",{semantic:Os(e)}));var s=this._elementRegistry.get(n.id),o=s&&s.attachers;if(!s)throw Oo(i,e,n,"attachedToRef");t.host=s,o||(s.attachers=o=[]),-1===o.indexOf(t)&&o.push(t)},xo.prototype.addLabel=function(e,t,i){var n,s,o;return n=function(e,t){var i,n,s,o=e.label;return o&&o.bounds?(s=o.bounds,n={width:Math.max(fo.width,s.width),height:s.height},i={x:s.x+s.width/2,y:s.y+s.height/2}):(i=bo(t),n=fo),Ve({x:i.x-n.width/2,y:i.y-n.height/2},n)}(t,i),(s=zs(i))&&(n=this._textRenderer.getExternalLabelBounds(n,s)),o=this._elementFactory.createLabel(wo(e,t,{id:e.id+"_label",labelTarget:i,type:"label",hidden:i.hidden||!zs(i),x:Math.round(n.x),y:Math.round(n.y),width:Math.round(n.width),height:Math.round(n.height)})),this._canvas.addShape(o,i.parent)},xo.prototype._getEnd=function(e,t){var i,n,s=e.$type,o=this._translate;if(n=e[t+"Ref"],"source"===t&&"bpmn:DataInputAssociation"===s&&(n=n&&n[0]),("source"===t&&"bpmn:DataOutputAssociation"===s||"target"===t&&"bpmn:DataInputAssociation"===s)&&(n=e.$parent),i=n&&this._getElement(n))return i;throw n?Oo(o,e,n,t+"Ref"):new Error(o("{semantic}#{side} Ref not specified",{semantic:Os(e),side:t}))},xo.prototype._getSource=function(e){return this._getEnd(e,"source")},xo.prototype._getTarget=function(e){return this._getEnd(e,"target")},xo.prototype._getElement=function(e){return this._elementRegistry.get(e.id)};const $o={__depends__:[uo,{__depends__:[po],bpmnImporter:["type",xo]}]};function Co(e){e&&"function"==typeof e.stopPropagation&&e.stopPropagation()}function So(e){return e.originalEvent||e.srcEvent}function _o(e,t){Co(e),Co(So(e))}function ko(e){return e.pointers&&e.pointers.length&&(e=e.pointers[0]),e.touches&&e.touches.length&&(e=e.touches[0]),e?{x:e.clientX,y:e.clientY}:null}function Eo(e,t){return(So(e)||e).button===t}function Po(e){return Eo(e,0)}function Ao(e){var t=So(e)||e;return!!Po(e)&&(/mac/i.test(navigator.platform)?t.metaKey:t.ctrlKey)}function Ro(e){var t=So(e)||e;return Po(e)&&t.shiftKey}function Do(e){return!0}function Vo(e){return Po(e)||function(e){return Eo(e,1)}(e)}function Lo(e,t,i){var n=this;function s(i,n,s){var o,a;(function(e,t){return!(l[e]||Po)(t)})(i,n)||(s?a=t.getGraphics(s):(o=n.delegateTarget||n.target)&&(a=o,s=t.get(a)),a&&s&&!1===e.fire(i,{element:s,gfx:a,originalEvent:n})&&(n.stopPropagation(),n.preventDefault()))}var o={};function a(e){return o[e]}var r={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},l={"element.contextmenu":Do,"element.mousedown":Vo,"element.mouseup":Vo,"element.click":Vo,"element.dblclick":Vo};function c(e,t,i,n){var a=o[i]=function(e){s(i,e)};n&&(l[i]=n),a.$delegate=et(e,"svg, .djs-element",t,a)}function h(e,t,i){var n=a(i);n&&tt(e,t,n.$delegate)}e.on("canvas.destroy",(function(e){var t;t=e.svg,pe(r,(function(e,i){h(t,i,e)}))})),e.on("canvas.init",(function(e){var t;t=e.svg,pe(r,(function(e,i){c(t,i,e)}))})),e.on(["shape.added","connection.added"],(function(t){var i=t.element,n=t.gfx;e.fire("interactionEvents.createHit",{element:i,gfx:n})})),e.on(["shape.changed","connection.changed"],500,(function(t){var i=t.element,n=t.gfx;e.fire("interactionEvents.updateHit",{element:i,gfx:n})})),e.on("interactionEvents.createHit",500,(function(e){var t=e.element,i=e.gfx;n.createDefaultHit(t,i)})),e.on("interactionEvents.updateHit",(function(e){var t=e.element,i=e.gfx;n.updateDefaultHit(t,i)}));var d=f("djs-hit djs-hit-stroke"),u=f("djs-hit djs-hit-click-stroke"),p={all:f("djs-hit djs-hit-all"),"click-stroke":u,stroke:d};function f(e,t){return t=Ve({stroke:"white",strokeWidth:15},t||{}),i.cls(e,["no-fill","no-border"],t)}function m(e,t){var i=p[t];if(!i)throw new Error("invalid hit type <"+t+">");return ut(e,i),e}function g(e,t){ct(e,t)}this.removeHits=function(e){pe(at(".djs-hit",e),wt)},this.createDefaultHit=function(e,t){var i,n=e.waypoints,s=e.isFrame;return n?this.createWaypointsHit(t,n):(i=s?"stroke":"all",this.createBoxHit(t,i,{width:e.width,height:e.height}))},this.createWaypointsHit=function(e,t){var i=Kt(t);return m(i,"stroke"),g(e,i),i},this.createBoxHit=function(e,t,i){i=Ve({x:0,y:0},i);var n=St("rect");return m(n,t),ut(n,i),g(e,n),n},this.updateDefaultHit=function(e,t){var i=ot(".djs-hit",t);if(i)return e.waypoints?function(e,t){ut(e,{points:Ht(t)})}(i,e.waypoints):ut(i,{width:e.width,height:e.height}),i},this.fire=s,this.triggerMouseEvent=function(e,t,i){var n=r[e];if(!n)throw new Error("unmapped DOM event name <"+e+">");return s(n,t,i)},this.mouseHandler=a,this.registerEvent=c,this.unregisterEvent=h}Lo.$inject=["eventBus","elementRegistry","styles"];const To={__init__:["interactionEvents"],interactionEvents:["type",Lo]};function Bo(e,t,i){this.offset=6;var n=t.cls("djs-outline",["no-fill"]),s=this;function o(e,t){var i=St("rect");return ut(i,Ve({x:10,y:10,width:100,height:100},n)),ct(e,i),i}e.on(["shape.added","shape.changed"],500,(function(e){var t=e.element,i=e.gfx,n=ot(".djs-outline",i);n||(n=o(i)),s.updateShapeOutline(n,t)})),e.on(["connection.added","connection.changed"],(function(e){var t=e.element,i=e.gfx,n=ot(".djs-outline",i);n||(n=o(i)),s.updateConnectionOutline(n,t)}))}Bo.prototype.updateShapeOutline=function(e,t){ut(e,{x:-this.offset,y:-this.offset,width:t.width+2*this.offset,height:t.height+2*this.offset})},Bo.prototype.updateConnectionOutline=function(e,t){var i=si(t);ut(e,{x:i.x-this.offset,y:i.y-this.offset,width:i.width+2*this.offset,height:i.height+2*this.offset})},Bo.$inject=["eventBus","styles","elementRegistry"];const Fo={__init__:["outline"],outline:["type",Bo]};function Io(e,t){this._eventBus=e,this._canvas=t,this._selectedElements=[];var i=this;e.on(["shape.remove","connection.remove"],(function(e){var t=e.element;i.deselect(t)})),e.on(["diagram.clear","root.set"],(function(e){i.select(null)}))}Io.$inject=["eventBus","canvas"],Io.prototype.deselect=function(e){var t=this._selectedElements,i=t.indexOf(e);if(-1!==i){var n=t.slice();t.splice(i,1),this._eventBus.fire("selection.changed",{oldSelection:n,newSelection:t})}},Io.prototype.get=function(){return this._selectedElements},Io.prototype.isSelected=function(e){return-1!==this._selectedElements.indexOf(e)},Io.prototype.select=function(e,t){var i=this._selectedElements,n=i.slice();oe(e)||(e=e?[e]:[]);var s=this._canvas,o=s.getRootElement();e=e.filter((function(e){var t=s.findRoot(e);return o===t})),t?pe(e,(function(e){-1===i.indexOf(e)&&i.push(e)})):this._selectedElements=i=e.slice(),this._eventBus.fire("selection.changed",{oldSelection:n,newSelection:i})};var jo="hover",Mo="selected";function Qo(e,t,i,n){function s(e,i){t.addMarker(e,i)}function o(e,i){t.removeMarker(e,i)}this._multiSelectionBox=null,e.on("element.hover",(function(e){s(e.element,jo)})),e.on("element.out",(function(e){o(e.element,jo)})),e.on("selection.changed",(function(e){var t=e.oldSelection,i=e.newSelection;pe(t,(function(e){-1===i.indexOf(e)&&o(e,Mo)})),pe(i,(function(e){-1===t.indexOf(e)&&s(e,Mo)}))}))}function Wo(e,t,i,n){e.on("create.end",500,(function(e){var i=e.context,n=i.canExecute,s=i.elements,o=(i.hints||{}).autoSelect;if(n){if(!1===o)return;oe(o)?t.select(o):t.select(s.filter(No))}})),e.on("connect.end",500,(function(e){var i=e.context,n=i.canExecute,s=i.hover;n&&s&&t.select(s)})),e.on("shape.move.end",500,(function(e){var i=e.previousSelection||[],s=n.get(e.context.shape.id);de(i,(function(e){return s.id===e.id}))||t.select(s)})),e.on("element.click",(function(e){if(Po(e)){var n=e.element;n===i.getRootElement()&&(n=null);var s=t.isSelected(n),o=t.get().length>1,a=Ao(e)||Ro(e);if(s&&o)return a?t.deselect(n):t.select(n);s?t.deselect(n):t.select(n,a)}}))}function No(e){return!e.hidden}Qo.$inject=["eventBus","canvas","selection","styles"],Wo.$inject=["eventBus","selection","canvas","elementRegistry"];const Zo={__init__:["selectionVisuals","selectionBehavior"],__depends__:[To,Fo],selection:["type",Io],selectionVisuals:["type",Qo],selectionBehavior:["type",Wo]};function qo(e){this._counter=0,this._prefix=(e?e+"-":"")+Math.floor(1e9*Math.random())+"-"}qo.prototype.next=function(){return this._prefix+ ++this._counter};var zo=new qo("ov");function Uo(e,t,i,n){var s,o;this._eventBus=t,this._canvas=i,this._elementRegistry=n,this._ids=zo,this._overlayDefaults=Ve({show:null,scale:!0},e&&e.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(s=i.getContainer(),o=it('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />'),s.insertBefore(o,s.firstChild),o),this._init()}function Xo(e,t,i){Ve(e.style,{left:t+"px",top:i+"px"})}function Go(e,t){e.style.display=!1===t?"none":""}function Yo(e,t){e.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(i){e.style[i+"transform"]=t}))}Uo.$inject=["config.overlays","eventBus","canvas","elementRegistry"],Uo.prototype.get=function(e){if(ce(e)&&(e={id:e}),ce(e.element)&&(e.element=this._elementRegistry.get(e.element)),e.element){var t=this._getOverlayContainer(e.element,!0);return t?e.type?ue(t.overlays,Se({type:e.type})):t.overlays.slice():[]}return e.type?ue(this._overlays,Se({type:e.type})):e.id?this._overlays[e.id]:null},Uo.prototype.add=function(e,t,i){if(ae(t)&&(i=t,t=null),e.id||(e=this._elementRegistry.get(e)),!i.position)throw new Error("must specifiy overlay position");if(!i.html)throw new Error("must specifiy overlay html");if(!e)throw new Error("invalid element specified");var n=this._ids.next();return i=Ve({},this._overlayDefaults,i,{id:n,type:t,element:e,html:i.html}),this._addOverlay(i),n},Uo.prototype.remove=function(e){var t=this.get(e)||[];oe(t)||(t=[t]);var i=this;pe(t,(function(e){var t=i._getOverlayContainer(e.element,!0);if(e&&(rt(e.html),rt(e.htmlContainer),delete e.htmlContainer,delete e.element,delete i._overlays[e.id]),t){var n=t.overlays.indexOf(e);-1!==n&&t.overlays.splice(n,1)}}))},Uo.prototype.show=function(){Go(this._overlayRoot)},Uo.prototype.hide=function(){Go(this._overlayRoot,!1)},Uo.prototype.clear=function(){this._overlays={},this._overlayContainers=[],Ne(this._overlayRoot)},Uo.prototype._updateOverlayContainer=function(e){var t=e.element,i=e.html,n=t.x,s=t.y;if(t.waypoints){var o=si(t);n=o.x,s=o.y}Xo(i,n,s),Be(e.html,"data-container-id",t.id)},Uo.prototype._updateOverlay=function(e){var t,i,n=e.position,s=e.htmlContainer,o=e.element,a=n.left,r=n.top;void 0!==n.right&&(t=o.waypoints?si(o).width:o.width,a=-1*n.right+t),void 0!==n.bottom&&(i=o.waypoints?si(o).height:o.height,r=-1*n.bottom+i),Xo(s,a||0,r||0),this._updateOverlayVisibilty(e,this._canvas.viewbox())},Uo.prototype._createOverlayContainer=function(e){var t=it('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(t);var i={html:t,element:e,overlays:[]};return this._updateOverlayContainer(i),this._overlayContainers.push(i),i},Uo.prototype._updateRoot=function(e){var t=e.scale||1,i="matrix("+[t,0,0,t,-1*e.x*t,-1*e.y*t].join(",")+")";Yo(this._overlayRoot,i)},Uo.prototype._getOverlayContainer=function(e,t){var i=de(this._overlayContainers,(function(t){return t.element===e}));return i||t?i:this._createOverlayContainer(e)},Uo.prototype._addOverlay=function(e){var t,i,n=e.id,s=e.element,o=e.html;o.get&&o.constructor.prototype.jquery&&(o=o.get(0)),ce(o)&&(o=it(o)),i=this._getOverlayContainer(s),(t=it('<div class="djs-overlay" data-overlay-id="'+n+'" style="position: absolute">')).appendChild(o),e.type&&Qe(t).add("djs-overlay-"+e.type),Go(t,this._canvas.findRoot(s)===this._canvas.getRootElement()),e.htmlContainer=t,i.overlays.push(e),i.html.appendChild(t),this._overlays[n]=e,this._updateOverlay(e),this._updateOverlayVisibilty(e,this._canvas.viewbox())},Uo.prototype._updateOverlayVisibilty=function(e,t){var i=e.show,n=this._canvas.findRoot(e.element),s=i&&i.minZoom,o=i&&i.maxZoom,a=e.htmlContainer,r=!0;(n!==this._canvas.getRootElement()||i&&(ne(s)&&s>t.scale||ne(o)&&o<t.scale))&&(r=!1),Go(a,r),this._updateOverlayScale(e,t)},Uo.prototype._updateOverlayScale=function(e,t){var i,n,s,o=e.scale,a=e.htmlContainer,r="";!0!==o&&(!1===o?(i=1,n=1):(i=o.min,n=o.max),ne(i)&&t.scale<i&&(s=(1/t.scale||1)*i),ne(n)&&t.scale>n&&(s=(1/t.scale||1)*n)),ne(s)&&(r="scale("+s+","+s+")"),Yo(a,r)},Uo.prototype._updateOverlaysVisibilty=function(e){var t=this;pe(this._overlays,(function(i){t._updateOverlayVisibilty(i,e)}))},Uo.prototype._init=function(){var e=this._eventBus,t=this;e.on("canvas.viewbox.changing",(function(e){t.hide()})),e.on("canvas.viewbox.changed",(function(e){var i;i=e.viewbox,t._updateRoot(i),t._updateOverlaysVisibilty(i),t.show()})),e.on(["shape.remove","connection.remove"],(function(e){var i=e.element;pe(t.get({element:i}),(function(e){t.remove(e.id)}));var n=t._getOverlayContainer(i);if(n){rt(n.html);var s=t._overlayContainers.indexOf(n);-1!==s&&t._overlayContainers.splice(s,1)}})),e.on("element.changed",500,(function(e){var i=e.element,n=t._getOverlayContainer(i,!0);n&&(pe(n.overlays,(function(e){t._updateOverlay(e)})),t._updateOverlayContainer(n))})),e.on("element.marker.update",(function(e){var i=t._getOverlayContainer(e.element,!0);i&&Qe(i.html)[e.add?"add":"remove"](e.marker)})),e.on("root.set",(function(){t._updateOverlaysVisibilty(t._canvas.viewbox())})),e.on("diagram.clear",this.clear,this)};const Ho={__init__:["overlays"],overlays:["type",Uo]};function Ko(e,t,i,n){e.on("element.changed",(function(n){var s=n.element;(s.parent||s===t.getRootElement())&&(n.gfx=i.getGraphics(s)),n.gfx&&e.fire(oi(s)+".changed",n)})),e.on("elements.changed",(function(t){var i=t.elements;i.forEach((function(t){e.fire("element.changed",{element:t})})),n.updateContainments(i)})),e.on("shape.changed",(function(e){n.update("shape",e.element,e.gfx)})),e.on("connection.changed",(function(e){n.update("connection",e.element,e.gfx)}))}Ko.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];const Jo={__init__:["changeSupport"],changeSupport:["type",Ko]};function ea(e){this._eventBus=e}function ta(e,t){t.invoke(ea,this),this.executed((function(t){var i=t.context;i.rootElement?e.setRootElement(i.rootElement):i.rootElement=e.getRootElement()})),this.revert((function(t){var i=t.context;i.rootElement&&e.setRootElement(i.rootElement)}))}ea.$inject=["eventBus"],ea.prototype.on=function(e,t,i,n,s,o){if((le(t)||re(t))&&(o=s,s=n,n=i,i=t,t=null),le(i)&&(o=s,s=n,n=i,i=1e3),ae(s)&&(o=s,s=!1),!le(n))throw new Error("handlerFn must be a function");oe(e)||(e=[e]);var a=this._eventBus;pe(e,(function(e){var r=["commandStack",e,t].filter((function(e){return e})).join(".");a.on(r,i,s?function(e,t){return function(i){return e.call(t||null,i.context,i.command,i)}}(n,o):n,o)}))},pe(["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"],(function(e){ea.prototype[e]=function(t,i,n,s,o){(le(t)||re(t))&&(o=s,s=n,n=i,i=t,t=null),this.on(t,e,i,n,s,o)}})),Xt()(ta,ea),ta.$inject=["canvas","injector"];const ia={__init__:["rootElementsBehavior"],rootElementsBehavior:["type",ta]};var na=i(8269),sa=i.n(na),oa={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function aa(e){return(e=""+e)&&e.replace(/[&<>"']/g,(function(e){return oa[e]}))}function ra(e){return e.id.replace(new RegExp("_plane$"),"")}function la(e){var t=e.id;return _s(e,"bpmn:SubProcess")?da(t):t}function ca(e){return da(e)}function ha(e){return _s(Ps(e),"bpmndi:BPMNPlane")}function da(e){return e+"_plane"}function ua(e,t,i,n){var s=it('<ul class="bjs-breadcrumbs"></ul>'),o=n.getContainer(),a=Qe(o);o.appendChild(s);var r=[];function l(e){e&&(r=function(e){for(var t=[],i=Es(e);i;i=i.$parent)(_s(i,"bpmn:SubProcess")||_s(i,"bpmn:Process"))&&t.push(i);return t.reverse()}(e));var i=r.map((function(e){var i=aa(e.name||e.id),s=it('<li><span class="bjs-crumb"><a title="'+i+'">'+i+"</a></span></li>"),o=n.findRoot(la(e))||n.findRoot(e.id);if(!o&&_s(e,"bpmn:Process")){var a=t.find((function(t){var i=Es(t);return i&&i.processRef&&i.processRef===e}));o=n.findRoot(a.id)}return s.addEventListener("click",(function(){n.setRootElement(o)})),s}));s.innerHTML="";var o=i.length>1;a.toggle("bjs-breadcrumbs-shown",o),i.forEach((function(e){s.appendChild(e)}))}e.on("element.changed",(function(e){var t=Es(e.element);de(r,(function(e){return e===t}))&&l()})),e.on("root.set",(function(e){l(e.element)}))}function pa(e,t){var i=null,n=new fa;e.on("root.set",(function(e){var s=e.element,o=t.viewbox(),a=n.get(s);if(n.set(i,{x:o.x,y:o.y,zoom:o.scale}),i=s,!_s(s,"bpmn:Collaboration")||a){a=a||{x:0,y:0,zoom:1};var r=(o.x-a.x)*o.scale,l=(o.y-a.y)*o.scale;0===r&&0===l||t.scroll({dx:r,dy:l}),a.zoom!==o.scale&&t.zoom(a.zoom,{x:0,y:0})}})),e.on("diagram.clear",(function(){n.clear(),i=null}))}function fa(){this._entries=[],this.set=function(e,t){var i=!1;for(var n in this._entries)if(this._entries[n][0]===e){this._entries[n][1]=t,i=!0;break}i||this._entries.push([e,t])},this.get=function(e){for(var t in this._entries)if(this._entries[t][0]===e)return this._entries[t][1];return null},this.clear=function(){this._entries.length=0},this.remove=function(e){var t=-1;for(var i in this._entries)if(this._entries[i][0]===e){t=i;break}-1!==t&&this._entries.splice(t,1)}}ua.$inject=["eventBus","elementRegistry","overlays","canvas"],pa.$inject=["eventBus","canvas"];function ma(e,t){this._eventBus=e,this._moddle=t;var i=this;e.on("import.render.start",1500,(function(e,t){i.handleImport(t.definitions)}))}function ga(e){return _s(e,"bpmndi:BPMNDiagram")?e:ga(e.$parent)}ma.prototype.handleImport=function(e){if(e.diagrams){var t=this;this._definitions=e,this._processToDiagramMap={},e.diagrams.forEach((function(e){e.plane&&e.plane.bpmnElement&&(t._processToDiagramMap[e.plane.bpmnElement.id]=e)}));var i=[];e.diagrams.forEach((function(e){var n=t.createNewDiagrams(e.plane);Array.prototype.push.apply(i,n)})),i.forEach((function(e){t.movePlaneElementsToOrigin(e.plane)}))}},ma.prototype.createNewDiagrams=function(e){var t=this,i=[],n=[];e.get("planeElement").forEach((function(t){var s=t.bpmnElement;if(s){var o=s.$parent;_s(s,"bpmn:SubProcess")&&!t.isExpanded&&i.push(s),_s(o,"bpmn:SubProcess")&&o!==e.bpmnElement&&n.push({diElement:t,parent:o})}}));var s=[];return i.forEach((function(e){if(!t._processToDiagramMap[e.id]){var i=t.createDiagram(e);t._processToDiagramMap[e.id]=i,s.push(i)}})),n.forEach((function(e){for(var n=e.diElement,s=e.parent;s&&-1===i.indexOf(s);)s=s.$parent;if(s){var o=t._processToDiagramMap[s.id];t.moveToDiPlane(n,o.plane)}})),s},ma.prototype.movePlaneElementsToOrigin=function(e){var t=e.get("planeElement"),i=function(e){var t={top:1/0,right:-1/0,bottom:-1/0,left:1/0};return e.planeElement.forEach((function(e){if(e.bounds){var i=xi(e.bounds);t.top=Math.min(i.top,t.top),t.left=Math.min(i.left,t.left)}})),$i(t)}(e),n=i.x-180,s=i.y-160;t.forEach((function(e){e.waypoint?e.waypoint.forEach((function(e){e.x=e.x-n,e.y=e.y-s})):e.bounds&&(e.bounds.x=e.bounds.x-n,e.bounds.y=e.bounds.y-s)}))},ma.prototype.moveToDiPlane=function(e,t){var i=ga(e).plane.get("planeElement");i.splice(i.indexOf(e),1),t.get("planeElement").push(e)},ma.prototype.createDiagram=function(e){var t=this._moddle.create("bpmndi:BPMNPlane",{bpmnElement:e}),i=this._moddle.create("bpmndi:BPMNDiagram",{plane:t});return t.$parent=i,t.bpmnElement=e,i.$parent=this._definitions,this._definitions.diagrams.push(i),i},ma.$inject=["eventBus","moddle"];var ba=250;function va(e,t,i,n){ea.call(this,t),this._canvas=e,this._eventBus=t,this._elementRegistry=i,this._overlays=n;var s=this;this.executed("shape.toggleCollapse",ba,(function(e){var t=e.shape;s.canDrillDown(t)?s.addOverlay(t):s.removeOverlay(t)}),!0),this.reverted("shape.toggleCollapse",ba,(function(e){var t=e.shape;s.canDrillDown(t)?s.addOverlay(t):s.removeOverlay(t)}),!0),this.executed(["shape.create","shape.move","shape.delete"],ba,(function(e){var t=e.oldParent,i=e.newParent||e.parent,n=e.shape;s.canDrillDown(n)&&s.addOverlay(n),s.updateDrilldownOverlay(t),s.updateDrilldownOverlay(i),s.updateDrilldownOverlay(n)}),!0),this.reverted(["shape.create","shape.move","shape.delete"],ba,(function(e){var t=e.oldParent,i=e.newParent||e.parent,n=e.shape;s.canDrillDown(n)&&s.addOverlay(n),s.updateDrilldownOverlay(t),s.updateDrilldownOverlay(i),s.updateDrilldownOverlay(n)}),!0),t.on("import.done",(function(){i.filter((function(e){return s.canDrillDown(e)})).map((function(e){s.addOverlay(e)}))}))}G()(va,ea),va.prototype.updateDrilldownOverlay=function(e){var t=this._canvas;if(e){var i=t.findRoot(e);i&&this.updateOverlayVisibility(i)}},va.prototype.canDrillDown=function(e){var t=this._canvas;return _s(e,"bpmn:SubProcess")&&t.findRoot(la(e))},va.prototype.updateOverlayVisibility=function(e){var t=this._overlays,i=e.businessObject,n=t.get({element:i.id,type:"drilldown"})[0];if(n){var s=i&&i.flowElements&&i.flowElements.length;Qe(n.html).toggle("bjs-drilldown-empty",!s)}},va.prototype.addOverlay=function(e){var t=this._canvas,i=this._overlays;i.get({element:e,type:"drilldown"}).length&&this.removeOverlay(e);var n=it('<button class="bjs-drilldown"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z"/></svg></button>');n.addEventListener("click",(function(){t.setRootElement(t.findRoot(la(e)))})),i.add(e,"drilldown",{position:{bottom:-7,right:-8},html:n}),this.updateOverlayVisibility(e)},va.prototype.removeOverlay=function(e){this._overlays.remove({element:e,type:"drilldown"})},va.$inject=["canvas","eventBus","elementRegistry","overlays"];const wa={__depends__:[Ho,Jo,ia],__init__:["drilldownBreadcrumbs","drilldownOverlayBehavior","drilldownCentering","subprocessCompatibility"],drilldownBreadcrumbs:["type",ua],drilldownCentering:["type",pa],drilldownOverlayBehavior:["type",va],subprocessCompatibility:["type",ma]};function ya(e){Fs.call(this,e)}function Oa(e){return!e.altKey&&(e.ctrlKey||e.metaKey)}function xa(e,t){return-1!==(e=oe(e)?e:[e]).indexOf(t.key)||-1!==e.indexOf(t.keyCode)}function $a(e){return e.shiftKey}G()(ya,Fs),ya.prototype._modules=[$o,po,Zo,Ho,wa],ya.prototype._moddleExtensions={};var Ca="keyboard.keydown";function Sa(e,t){var i=this;this._config=e||{},this._eventBus=t,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),t.on("diagram.destroy",(function(){i._fire("destroy"),i.unbind()})),t.on("diagram.init",(function(){i._fire("init")})),t.on("attach",(function(){e&&e.bindTo&&i.bind(e.bindTo)})),t.on("detach",(function(){i.unbind()}))}Sa.$inject=["config.keyboard","eventBus"],Sa.prototype._keydownHandler=function(e){this._keyHandler(e,Ca)},Sa.prototype._keyupHandler=function(e){this._keyHandler(e,"keyboard.keyup")},Sa.prototype._keyHandler=function(e,t){if(!this._isEventIgnored(e)){var i={keyEvent:e};this._eventBus.fire(t||Ca,i)&&e.preventDefault()}},Sa.prototype._isEventIgnored=function(e){return(t=e.target)&&(ze(t,"input, textarea")||"true"===t.contentEditable)&&this._isModifiedKeyIgnored(e);var t},Sa.prototype._isModifiedKeyIgnored=function(e){return!Oa(e)||-1===this._getAllowedModifiers(e.target).indexOf(e.key)},Sa.prototype._getAllowedModifiers=function(e){var t=Ue(e,"[input-handle-modified-keys]",!0);return!t||this._node&&!this._node.contains(t)?[]:t.getAttribute("input-handle-modified-keys").split(",")},Sa.prototype.bind=function(e){this.unbind(),this._node=e,Ke.bind(e,"keydown",this._keydownHandler,!0),Ke.bind(e,"keyup",this._keyupHandler,!0),this._fire("bind")},Sa.prototype.getBinding=function(){return this._node},Sa.prototype.unbind=function(){var e=this._node;e&&(this._fire("unbind"),Ke.unbind(e,"keydown",this._keydownHandler,!0),Ke.unbind(e,"keyup",this._keyupHandler,!0)),this._node=null},Sa.prototype._fire=function(e){this._eventBus.fire("keyboard."+e,{node:this._node})},Sa.prototype.addListener=function(e,t,i){le(e)&&(i=t,t=e,e=1e3),this._eventBus.on(i||Ca,e,t)},Sa.prototype.removeListener=function(e,t){this._eventBus.off(t||Ca,e)},Sa.prototype.hasModifier=function(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey},Sa.prototype.isCmd=Oa,Sa.prototype.isShift=$a,Sa.prototype.isKey=xa;var _a=["c","C",67],ka=["v","V",86],Ea=["y","Y",89],Pa=["z","Z",90];function Aa(e,t){var i=this;e.on("editorActions.init",500,(function(e){var n=e.editorActions;i.registerBindings(t,n)}))}Aa.$inject=["eventBus","keyboard"],Aa.prototype.registerBindings=function(e,t){function i(i,n){t.isRegistered(i)&&e.addListener(n)}i("undo",(function(e){var i=e.keyEvent;if(Oa(i)&&!$a(i)&&xa(Pa,i))return t.trigger("undo"),!0})),i("redo",(function(e){var i=e.keyEvent;if(Oa(i)&&(xa(Ea,i)||xa(Pa,i)&&$a(i)))return t.trigger("redo"),!0})),i("copy",(function(e){var i=e.keyEvent;if(Oa(i)&&xa(_a,i))return t.trigger("copy"),!0})),i("paste",(function(e){var i=e.keyEvent;if(Oa(i)&&xa(ka,i))return t.trigger("paste"),!0})),i("stepZoom",(function(e){var i=e.keyEvent;if(xa(["+","Add","="],i)&&Oa(i))return t.trigger("stepZoom",{value:1}),!0})),i("stepZoom",(function(e){var i=e.keyEvent;if(xa(["-","Subtract"],i)&&Oa(i))return t.trigger("stepZoom",{value:-1}),!0})),i("zoom",(function(e){var i=e.keyEvent;if(xa("0",i)&&Oa(i))return t.trigger("zoom",{value:1}),!0})),i("removeSelection",(function(e){if(xa(["Backspace","Delete","Del"],e.keyEvent))return t.trigger("removeSelection"),!0}))};const Ra={__init__:["keyboard","keyboardBindings"],keyboard:["type",Sa],keyboardBindings:["type",Aa]};var Da={moveSpeed:50,moveSpeedAccelerated:200};function Va(e,t,i){var n=this;this._config=Ve({},Da,e||{}),t.addListener((function(e){var i=e.keyEvent,s=n._config;if(t.isCmd(i)&&t.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],i)){var o,a=t.isShift(i)?s.moveSpeedAccelerated:s.moveSpeed;switch(i.key){case"ArrowLeft":case"Left":o="left";break;case"ArrowUp":case"Up":o="up";break;case"ArrowRight":case"Right":o="right";break;case"ArrowDown":case"Down":o="down"}return n.moveCanvas({speed:a,direction:o}),!0}})),this.moveCanvas=function(e){var t=0,n=0,s=e.speed/Math.min(Math.sqrt(i.viewbox().scale),1);switch(e.direction){case"left":t=s;break;case"up":n=s;break;case"right":t=-s;break;case"down":n=-s}i.scroll({dx:t,dy:n})}}Va.$inject=["config.keyboardMove","keyboard","canvas"];const La={__depends__:[Ra],__init__:["keyboardMove"],keyboardMove:["type",Va]};var Ta=/^djs-cursor-.*$/;function Ba(e){var t=Qe(document.body);t.removeMatching(Ta),e&&t.add("djs-cursor-"+e)}function Fa(){Ba(null)}function Ia(e,t){function i(){return!1}return t=t||"element.click",e.once(t,5e3,i),function(){e.off(t,i)}}function ja(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function Ma(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Qa(e,t){var i;function n(n){var s,o=i.start,a=i.button,r=ko(n),l=Ma(r,o);!i.dragging&&(s=l,Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2))>15)&&(i.dragging=!0,0===a&&Ia(e),Ba("grab")),i.dragging&&(l=Ma(r,i.last||i.start),t.scroll({dx:l.x,dy:l.y}),i.last=r),n.preventDefault()}function s(e){Ke.unbind(document,"mousemove",n),Ke.unbind(document,"mouseup",s),i=null,Fa()}e.on("element.mousedown",500,(function(e){return function(e){if(!Ue(e.target,".djs-draggable")){var t=e.button;if(!(t>=2||e.ctrlKey||e.shiftKey||e.altKey))return i={button:t,start:ko(e)},Ke.bind(document,"mousemove",n),Ke.bind(document,"mouseup",s),!0}}(e.originalEvent)})),this.isActive=function(){return!!i}}Qa.$inject=["eventBus","canvas"];const Wa={__init__:["moveCanvas"],moveCanvas:["type",Qa]};function Na(e){return Math.log(e)/Math.log(10)}function Za(e,t){var i=Na(e.min),n=Na(e.max);return(Math.abs(i)+Math.abs(n))/t}var qa=Math.sign||function(e){return e>=0?1:-1},za={min:.2,max:4};function Ua(e,t,i){e=e||{},this._enabled=!1,this._canvas=i,this._container=i._container,this._handleWheel=Re(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||.75;var n=this;t.on("canvas.init",(function(t){n._init(!1!==e.enabled)}))}Ua.$inject=["config.zoomScroll","eventBus","canvas"],Ua.prototype.scroll=function(e){this._canvas.scroll(e)},Ua.prototype.reset=function(){this._canvas.zoom("fit-viewport")},Ua.prototype.zoom=function(e,t){var i=Za(za,20);this._totalDelta+=e,Math.abs(this._totalDelta)>.1&&(this._zoom(e,t,i),this._totalDelta=0)},Ua.prototype._handleWheel=function(e){if(!Ue(e.target,".djs-scrollable",!0)){var t=this._container;e.preventDefault();var i,n=e.ctrlKey,s=e.shiftKey,o=-1*this._scale;if(o*=n?0===e.deltaMode?.02:.32:0===e.deltaMode?1:16,n){var a=t.getBoundingClientRect(),r={x:e.clientX-a.left,y:e.clientY-a.top};i=Math.sqrt(Math.pow(e.deltaY,2)+Math.pow(e.deltaX,2))*qa(e.deltaY)*o,this.zoom(i,r)}else i=s?{dx:o*e.deltaY,dy:0}:{dx:o*e.deltaX,dy:o*e.deltaY},this.scroll(i)}},Ua.prototype.stepZoom=function(e,t){var i=Za(za,10);this._zoom(e,t,i)},Ua.prototype._zoom=function(e,t,i){var n=this._canvas,s=e>0?1:-1,o=Na(n.zoom()),a=Math.round(o/i)*i;a+=i*s;var r,l,c=Math.pow(10,a);n.zoom((r=za,l=c,Math.max(r.min,Math.min(r.max,l))),t)},Ua.prototype.toggle=function(e){var t=this._container,i=this._handleWheel,n=this._enabled;return void 0===e&&(e=!n),n!==e&&Ke[e?"bind":"unbind"](t,"wheel",i,!1),this._enabled=e,e},Ua.prototype._init=function(e){this.toggle(e)};const Xa={__init__:["zoomScroll"],zoomScroll:["type",Ua]};function Ga(e){ya.call(this,e)}G()(Ga,ya),Ga.prototype._navigationModules=[La,Wa,Xa],Ga.prototype._modules=[].concat(ya.prototype._modules,Ga.prototype._navigationModules);var Ya=i(840),Ha=i.n(Ya),Ka=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];function Ja(e,t){return t.get(e,!1)}function er(e){e.preventDefault(),"function"==typeof e.stopPropagation?e.stopPropagation():e.srcEvent&&"function"==typeof e.srcEvent.stopPropagation&&e.srcEvent.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation()}function tr(e){function t(t){setTimeout((function(){pe(Ka,(function(t){Ke.unbind(e,t,er,!0)}))}),500)}Ke.bind(e,"touchstart",(function(t){pe(Ka,(function(t){Ke.bind(e,t,er,!0)}))}),!0),Ke.bind(e,"touchend",t,!0),Ke.bind(e,"touchcancel",t,!0);var i=new(Ha().Manager)(e,{inputClass:Ha().TouchInput,recognizers:[],domEvents:!0}),n=new(Ha().Tap),s=new(Ha().Pan)({threshold:10}),o=new(Ha().Press),a=new(Ha().Pinch),r=new(Ha().Tap)({event:"doubletap",taps:2});return a.requireFailure(s),a.requireFailure(o),i.add([s,o,a,r,n]),i.reset=function(e){var t=this.recognizers,n=this.session;n.stopped||(i.stop(e),setTimeout((function(){var e,i;for(e=0;i=t[e];e++)i.reset(),i.state=8;n.curRecognizer=null}),0))},i.on("hammer.input",(function(e){e.srcEvent.defaultPrevented&&i.reset(!0)})),i}function ir(e,t,i,n,s){var o,a=Ja("dragging",e),r=Ja("move",e),l=Ja("contextPad",e),c=Ja("palette",e);function h(e,t){return function(i){var o=d(i.target),a=o&&n.get(o);return t&&(i.srcEvent.button=t),s.fire(e,i,a)}}function d(e){return Ue(e,"svg, .djs-element",!0)}a&&i.on("drag.move",(function(e){var t=e.originalEvent;if(t&&!(t instanceof MouseEvent)){var i=ko(t),s=d(document.elementFromPoint(i.x,i.y)),o=s&&n.get(s);o!==e.hover&&(e.hover&&a.out(e),o&&(a.hover({element:o,gfx:s}),e.hover=o,e.hoverGfx=s))}})),l&&i.on("contextPad.create",(function(e){var t=tr(e.pad.html);t.on("panstart",(function(e){l.trigger("dragstart",e,!0)})),t.on("press",(function(e){l.trigger("dragstart",e,!0)})),t.on("tap",(function(e){l.trigger("click",e)}))})),c&&i.on("palette.create",(function(e){var t=tr(e.container);t.on("panstart",(function(e){c.trigger("dragstart",e,!0)})),t.on("press",(function(e){c.trigger("dragstart",e,!0)})),t.on("tap",(function(e){c.trigger("click",e)}))})),i.on("canvas.init",(function(e){!function(e){function i(e){var i=d(e.target),s=i&&n.get(i);if(r&&t.getRootElement()!==s)return r.start(e,s,!0);!function(e){var i=0,n=0;function s(e){var s=e.deltaX-i,o=e.deltaY-n;t.scroll({dx:s,dy:o}),i=e.deltaX,n=e.deltaY}function a(e){o.off("panmove",s),o.off("panend",a),o.off("pancancel",a)}o.on("panmove",s),o.on("panend",a),o.on("pancancel",a)}()}(o=tr(e)).on("tap",h("element.click")),o.on("doubletap",h("element.dblclick",1)),o.on("panstart",i),o.on("press",i),o.on("pinchstart",(function(e){var i=t.zoom(),n=e.center;function s(e){var s=1-(1-e.scale)/1.5,o=Math.max(.2,Math.min(4,s*i));t.zoom(o,n),er(e)}function a(e){o.off("pinchmove",s),o.off("pinchend",a),o.off("pinchcancel",a),o.reset(!0)}o.on("pinchmove",s),o.on("pinchend",a),o.on("pinchcancel",a)}))}(e.svg)}))}function nr(e,t){var i=this;t.on("canvas.init",(function(e){i.addBBoxMarker(e.svg)}))}ir.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"],nr.$inject=["canvas","eventBus"],nr.prototype.addBBoxMarker=function(e){var t={fill:"none",class:"outer-bound-marker"},i=St("rect");ut(i,{x:-1e4,y:1e4,width:10,height:10}),ut(i,t),ct(e,i);var n=St("rect");ut(n,{x:1e4,y:1e4,width:10,height:10}),ut(n,t),ct(e,n)};const sr={__depends__:[{__depends__:[To],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",ir],touchFix:["type",nr]}]};function or(e){return e&&e[e.length-1]}function ar(e){return e.y}function rr(e){return e.x}var lr={left:rr,center:rr,right:function(e){return e.x+e.width},top:ar,middle:ar,bottom:function(e){return e.y+e.height}};function cr(e){this._modeling=e}cr.$inject=["modeling"],cr.prototype._getOrientationDetails=function(e){var t="x",i="width";return-1!==["top","bottom","middle"].indexOf(e)&&(t="y",i="height"),{axis:t,dimension:i}},cr.prototype._isType=function(e,t){return-1!==t.indexOf(e)},cr.prototype._alignmentPosition=function(e,t){var i,n,s,o=this._getOrientationDetails(e),a=o.axis,r=o.dimension,l={},c={},h=!1;if(this._isType(e,["left","top"]))l[e]=t[0][a];else if(this._isType(e,["right","bottom"]))s=or(t),l[e]=s[a]+s[r];else if(this._isType(e,["center","middle"])){if(pe(t,(function(e){var t=e[a]+Math.round(e[r]/2);c[t]?c[t].elements.push(e):c[t]={elements:[e],center:t}})),i=Ce(c,(function(e){return e.elements.length>1&&(h=!0),e.elements.length})),h)return l[e]=or(i).center,l;n=t[0],s=or(t=Ce(t,(function(e){return e[a]+e[r]}))),l[e]=function(e,t){return Math.round((e[a]+t[a]+t[r])/2)}(n,s)}return l},cr.prototype.trigger=function(e,t){var i=this._modeling,n=ue(e,(function(e){return!(e.waypoints||e.host||e.labelTarget)}));if(!(n.length<2)){var s=Ce(n,lr[t]),o=this._alignmentPosition(t,s);i.alignElements(s,o)}};const hr={__init__:["alignElements"],alignElements:["type",cr]};function dr(e,t,i,n){for(var s;s=pr(e,i,t);)i=n(t,i,s);return i}function ur(e){return function(t,i,n){var s={x:i.x,y:i.y};return["x","y"].forEach((function(o){var a=e[o];if(a){var r="x"===o?"width":"height",l=a.margin,c=a.minDistance;s[o]=l<0?Math.min(n[o]+l-t[r]/2,i[o]-c+l):Math.max(n[o]+n[r]+l+t[r]/2,i[o]+c+l)}})),s}}function pr(e,t,i){var n={x:t.x-i.width/2,y:t.y-i.height/2,width:i.width,height:i.height},s=function(e){var t=fr(e);return e.host&&(t=t.concat(fr(e.host))),e.attachers&&(t=t.concat(e.attachers.reduce((function(e,t){return e.concat(fr(t))}),[]))),t}(e);return de(s,(function(e){return e!==i&&"intersect"===Si(e,n,10)}))}function fr(e){return(t=e,t.outgoing.map((function(e){return e.target}))).concat(function(e){return e.incoming.map((function(e){return e.source}))}(e));var t}function mr(){return!0}function gr(e,t,i){e.on("autoPlace",100,(function(e){var t=e.shape;return function(e,t,i){i||(i={});var n=i.defaultDistance||50,s=Ci(e);return{x:xi(e).right+n+t.width/2,y:s.y}}(e.source,t)})),e.on("autoPlace.end",(function(e){i.scrollToElement(e.shape)})),this.append=function(i,n,s){e.fire("autoPlace.start",{source:i,shape:n});var o=e.fire("autoPlace",{source:i,shape:n}),a=t.appendShape(i,n,o,i.parent,s);return e.fire("autoPlace.end",{source:i,shape:a}),a}}function br(e,t){e.on("autoPlace.end",500,(function(e){t.select(e.shape)}))}gr.$inject=["eventBus","modeling","canvas"],br.$inject=["eventBus","selection"];const vr={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",gr],autoPlaceSelectionBehavior:["type",br]};function wr(e,t){return _s(t,"bpmn:TextAnnotation")?function(e,t){var i=xi(e);return dr(e,t,{x:i.right+t.width/2,y:i.top-50-t.height/2},ur({y:{margin:-30,minDistance:20}}))}(e,t):ks(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])?function(e,t){var i=xi(e);return dr(e,t,{x:i.right-10+t.width/2,y:i.bottom+40+t.width/2},ur({x:{margin:30,minDistance:30}}))}(e,t):_s(t,"bpmn:FlowNode")?function(e,t){var i=xi(e),n=Ci(e),s=function(e,t){t||(t={});var i=t.defaultDistance||50,n=t.direction||"e",s=t.filter,o=t.getWeight||function(t){return t.source===e?1:-1},a=t.maxDistance||250,r=t.reference||"start";function l(e,t){return"n"===n?"start"===r?xi(e).top-xi(t).bottom:"center"===r?xi(e).top-Ci(t).y:xi(e).top-xi(t).top:"w"===n?"start"===r?xi(e).left-xi(t).right:"center"===r?xi(e).left-Ci(t).x:xi(e).left-xi(t).left:"s"===n?"start"===r?xi(t).top-xi(e).bottom:"center"===r?Ci(t).y-xi(e).bottom:xi(t).bottom-xi(e).bottom:"start"===r?xi(t).left-xi(e).right:"center"===r?Ci(t).x-xi(e).right:xi(t).right-xi(e).right}s||(s=mr);var c=e.incoming.filter(s).map((function(t){var i=o(t),n=i<0?l(t.source,e):l(e,t.source);return{id:t.source.id,distance:n,weight:i}})),h=e.outgoing.filter(s).map((function(t){var i=o(t),n=i>0?l(e,t.target):l(t.target,e);return{id:t.target.id,distance:n,weight:i}}));return fe(c.concat(h).reduce((function(e,t){return e[t.id+"__weight_"+t.weight]=t,e}),{}),(function(e,t){var i=t.distance,n=t.weight;return i<0||i>a||(e[String(i)]||(e[String(i)]=0),e[String(i)]+=1*n,(!e.distance||e[e.distance]<e[String(i)])&&(e.distance=i)),e}),{}).distance||i}(e,{filter:function(e){return _s(e,"bpmn:SequenceFlow")}}),o=30,a="left";return _s(e,"bpmn:BoundaryEvent")&&-1!==(a=Si(e,e.host,-25)).indexOf("top")&&(o*=-1),dr(e,t,{x:i.right+s+t.width/2,y:n.y+yr(a,80)},ur({y:{margin:o,minDistance:80}}))}(e,t):void 0}function yr(e,t){return-1!=e.indexOf("top")?-1*t:-1!=e.indexOf("bottom")?t:0}function Or(e){e.on("autoPlace",(function(e){var t=e.shape;return wr(e.source,t)}))}Or.$inject=["eventBus"];const xr={__depends__:[vr],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",Or]};function $r(e,t,i,n){ea.call(this,e),this._elementRegistry=t,this._modeling=i,this._rules=n;var s=this;this.postExecuted(["shape.create"],(function(e){var t=e.context,i=t.hints||{},n=t.shape,o=t.parent||t.newParent;!1!==i.autoResize&&s._expand([n],o)})),this.postExecuted(["elements.move"],(function(e){var t=e.context,i=J(ye(t.closure.topLevel)),n=t.hints,o=!n||n.autoResize;!1!==o&&pe(Oe(i,(function(e){return e.parent.id})),(function(e,t){oe(o)&&(e=e.filter((function(e){return de(o,Se({id:e.id}))}))),s._expand(e,t)}))})),this.postExecuted(["shape.toggleCollapse"],(function(e){var t=e.context,i=t.hints,n=t.shape;i&&!1===i.autoResize||n.collapsed||s._expand(n.children||[],n)})),this.postExecuted(["shape.resize"],(function(e){var t=e.context,i=t.hints,n=t.shape,o=n.parent;i&&!1===i.autoResize||o&&s._expand([n],o)}))}function Cr(e){e.invoke($r,this)}function Sr(e){ea.call(this,e),this.init()}function _r(e){Sr.call(this,e);var t=this;this.addRule("element.autoResize",(function(e){return t.canResize(e.elements,e.target)}))}function kr(e,t){_r.call(this,e),this._modeling=t}$r.$inject=["eventBus","elementRegistry","modeling","rules"],Xt()($r,ea),$r.prototype._getOptimalBounds=function(e,t){var i=this.getOffset(t),n=this.getPadding(t),s=xi(si(e)),o=xi(t),a={};return s.top-o.top<n.top&&(a.top=s.top-i.top),s.left-o.left<n.left&&(a.left=s.left-i.left),o.right-s.right<n.right&&(a.right=s.right+i.right),o.bottom-s.bottom<n.bottom&&(a.bottom=s.bottom+i.bottom),$i(Ve({},o,a))},$r.prototype._expand=function(e,t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),this._rules.allowed("element.autoResize",{elements:e,target:t})){var i=this._getOptimalBounds(e,t);if(function(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}(i,t)){var n=function(e,t){var i="";return e=xi(e),t=xi(t),e.top>t.top&&(i=i.concat("n")),e.right<t.right&&(i=i.concat("w")),e.bottom<t.bottom&&(i=i.concat("s")),e.left>t.left&&(i=i.concat("e")),i}(Le(t,["x","y","width","height"]),i);this.resize(t,i,{autoResize:n});var s=t.parent;s&&this._expand([t],s)}}},$r.prototype.getOffset=function(e){return{top:60,bottom:60,left:100,right:100}},$r.prototype.getPadding=function(e){return{top:2,bottom:2,left:15,right:15}},$r.prototype.resize=function(e,t,i){this._modeling.resizeShape(e,t,null,i)},Cr.$inject=["injector"],G()(Cr,$r),Cr.prototype.resize=function(e,t,i){_s(e,"bpmn:Participant")?this._modeling.resizeLane(e,t,null,i):this._modeling.resizeShape(e,t,null,i)},Sr.$inject=["eventBus"],Xt()(Sr,ea),Sr.prototype.addRule=function(e,t,i){var n=this;"string"==typeof e&&(e=[e]),e.forEach((function(e){n.canExecute(e,t,(function(e,t,n){return i(e)}),!0)}))},Sr.prototype.init=function(){},_r.$inject=["eventBus"],Xt()(_r,Sr),_r.prototype.canResize=function(e,t){return!1},G()(kr,_r),kr.$inject=["eventBus","modeling"],kr.prototype.canResize=function(e,t){if(_s(t.di,"bpmndi:BPMNPlane"))return!1;if(!_s(t,"bpmn:Participant")&&!_s(t,"bpmn:Lane")&&!_s(t,"bpmn:SubProcess"))return!1;var i=!0;return pe(e,(function(e){(_s(e,"bpmn:Lane")||e.labelTarget)&&(i=!1)})),i};const Er={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",Cr],bpmnAutoResizeProvider:["type",kr]};function Pr(e,t,i){var n,s,o=this,a=i.get("dragging",!1);a&&t.on("drag.start",(function(i){t.once("drag.move",1500,(function(t){!function(t){if(!t.hover){var i=t.originalEvent,n=o._findTargetGfx(i),s=n&&e.get(n);n&&s&&(t.stopPropagation(),a.hover({element:s,gfx:n}),a.move(i))}}(t)}))})),t.on("element.hover",(function(e){n=e.gfx,s=e.element})),t.on("element.hover",1500,(function(e){s&&t.fire("element.out",{element:s,gfx:n})})),t.on("element.out",(function(){n=null,s=null})),this._findTargetGfx=function(e){var t;if(e instanceof MouseEvent)return t=ko(e),Ue(document.elementFromPoint(t.x,t.y),"svg, .djs-element",!0)}}Pr.$inject=["elementRegistry","eventBus","injector"];const Ar={__init__:["hoverFix"],hoverFix:["type",Pr]};var Rr=Math.round,Dr="djs-drag-active";function Vr(e){e.preventDefault()}function Lr(e,t,i,n){var s,o={threshold:5,trapClick:!0};function a(e){var i=t.viewbox(),n=t._container.getBoundingClientRect();return{x:i.x+(e.x-n.left)/i.scale,y:i.y+(e.y-n.top)/i.scale}}function r(t,i){i=i||s;var n=e.createEvent(Ve({},i.payload,i.data,{isTouch:i.isTouch}));return!1!==e.fire("drag."+t,n)&&e.fire(i.prefix+"."+t,n)}function l(e,n){var o,l=s.payload,c=s.displacement,h=s.globalStart,d=ko(e),u=Ma(d,h),p=s.localStart,f=a(d),g=Ma(f,p);if(!s.active&&(n||(o=u,Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))>s.threshold))){if(Ve(l,{x:Rr(p.x+c.x),y:Rr(p.y+c.y),dx:0,dy:0},{originalEvent:e}),!1===r("start"))return m();s.active=!0,s.keepSelection||(l.previousSelection=i.get(),i.select(null)),s.cursor&&Ba(s.cursor),t.addMarker(t.getRootElement(),Dr)}_o(e),s.active&&(Ve(l,{x:Rr(f.x+c.x),y:Rr(f.y+c.y),dx:Rr(g.x),dy:Rr(g.y)},{originalEvent:e}),r("move"))}function c(e){var t=!0;s.active&&(e&&(s.payload.originalEvent=e,_o(e)),t=r("end")),!1===t&&r("rejected"),r("ended",g(!0!==t))}function h(e){27===e.which&&(Vr(e),m())}function d(t){var i;s.active&&(i=Ia(e),setTimeout(i,400),Vr(t)),c(t)}function u(e){l(e)}function p(e){var t=s.payload;t.hoverGfx=e.gfx,t.hover=e.element,r("hover")}function f(e){r("out");var t=s.payload;t.hoverGfx=null,t.hover=null}function m(e){var t;if(s){var i=s.active;i&&r("cancel"),t=g(e),i&&r("canceled",t)}}function g(o){var a,g;r("cleanup"),Fa(),g=s.trapClick?d:c,Ke.unbind(document,"mousemove",l),Ke.unbind(document,"dragstart",Vr),Ke.unbind(document,"selectstart",Vr),Ke.unbind(document,"mousedown",g,!0),Ke.unbind(document,"mouseup",g,!0),Ke.unbind(document,"keyup",h),Ke.unbind(document,"touchstart",u,!0),Ke.unbind(document,"touchcancel",m,!0),Ke.unbind(document,"touchmove",l,!0),Ke.unbind(document,"touchend",c,!0),e.off("element.hover",p),e.off("element.out",f),t.removeMarker(t.getRootElement(),Dr);var b=s.payload.previousSelection;return!1!==o&&b&&!i.get().length&&function(e){var t=e.filter((function(e){return n.get(e.id)}));t.length&&i.select(t)}(b),a=s,s=null,a}e.on("diagram.destroy",m),this.init=function(t,i,n,g){s&&m(!1),"string"==typeof i&&(g=n,n=i,i=null);var b,v,w,y,O,x=(g=Ve({},o,g||{})).data||{};y=g.trapClick?d:c,t?(b=So(t)||t,v=ko(t),_o(t),"dragstart"===b.type&&Vr(b)):(b=null,v={x:0,y:0}),w=a(v),i||(i=w),O=function(e){return"undefined"!=typeof TouchEvent&&e instanceof TouchEvent}(b),s=Ve({prefix:n,data:x,payload:{},globalStart:v,displacement:Ma(i,w),localStart:w,isTouch:O},g),g.manual||(O?(Ke.bind(document,"touchstart",u,!0),Ke.bind(document,"touchcancel",m,!0),Ke.bind(document,"touchmove",l,!0),Ke.bind(document,"touchend",c,!0)):(Ke.bind(document,"mousemove",l),Ke.bind(document,"dragstart",Vr),Ke.bind(document,"selectstart",Vr),Ke.bind(document,"mousedown",y,!0),Ke.bind(document,"mouseup",y,!0)),Ke.bind(document,"keyup",h),e.on("element.hover",p),e.on("element.out",f)),r("init"),g.autoActivate&&l(t,!0)},this.move=l,this.hover=p,this.out=f,this.end=c,this.cancel=m,this.context=function(){return s},this.setOptions=function(e){Ve(o,e)}}Lr.$inject=["eventBus","canvas","selection","elementRegistry"];const Tr={__depends__:[Ar,Zo],dragging:["type",Lr]};function Br(e,t,i){this._canvas=i,this._opts=Ve({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},e);var n=this;t.on("drag.move",(function(e){var t=n._toBorderPoint(e);n.startScroll(t)})),t.on(["drag.cleanup"],(function(){n.stopScroll()}))}Br.$inject=["config.autoScroll","eventBus","canvas"],Br.prototype.startScroll=function(e){var t,i,n,s=this._canvas,o=this._opts,a=this,r=s.getContainer().getBoundingClientRect(),l=[e.x,e.y,r.width-e.x,r.height-e.y];this.stopScroll();for(var c=0,h=0,d=0;d<4;d++)t=l[d],i=o.scrollThresholdOut[d],n=o.scrollThresholdIn[d],i<t&&t<n&&(0===d?c=o.scrollStep:1==d?h=o.scrollStep:2==d?c=-o.scrollStep:3==d&&(h=-o.scrollStep));0===c&&0===h||(s.scroll({dx:c,dy:h}),this._scrolling=setTimeout((function(){a.startScroll(e)}),o.scrollRepeatTimeout))},Br.prototype.stopScroll=function(){clearTimeout(this._scrolling)},Br.prototype.setOptions=function(e){this._opts=Ve({},this._opts,e)},Br.prototype._toBorderPoint=function(e){var t=this._canvas._container.getBoundingClientRect(),i=ko(e.originalEvent);return{x:i.x-t.left,y:i.y-t.top}};const Fr={__depends__:[Tr],__init__:["autoScroll"],autoScroll:["type",Br]};function Ir(e){this._commandStack=e.get("commandStack",!1)}Ir.$inject=["injector"],Ir.prototype.allowed=function(e,t){var i=!0,n=this._commandStack;return n&&(i=n.canExecute(e,t)),void 0===i||i};const jr={__init__:["rules"],rules:["type",Ir]};var Mr=Math.round,Qr=Math.max;function Wr(e,t){return function(e,t){var i,n;for(i=0;n=e[i];i++)if(pi(n,t)<=10)return{point:e[i],bendpoint:!0,index:i};return null}(e,t)||function(e,t){var i,n,s=wi()(function(e,t){return[["M",e.x,e.y],["m",0,-t],["a",t,t,0,1,1,0,20],["a",t,t,0,1,1,0,-20],["z"]]}(t,10),(i=[],e.forEach((function(e,t){i.push([0===t?"M":"L",e.x,e.y])})),i)),o=s[0],a=s[s.length-1];return o?o!==a?o.segment2!==a.segment2?{point:e[n=Qr(o.segment2,a.segment2)-1],bendpoint:!0,index:n}:{point:{x:Mr(o.x+a.x)/2,y:Mr(o.y+a.y)/2},index:o.segment2}:{point:{x:Mr(o.x),y:Mr(o.y)},index:o.segment2}:null}(e,t)}function Nr(e,t,i){var n=function(e,t){var i,n=ko(t),s=e._container.getBoundingClientRect();i={x:s.left,y:s.top};var o=e.viewbox();return{x:o.x+(n.x-i.x)/o.scale,y:o.y+(n.y-i.y)/o.scale}}(e,i);return Wr(t,n)}function Zr(e,t){var i=St("g");bt(i).add("djs-bendpoint"),ct(e,i);var n=St("circle");ut(n,{cx:0,cy:0,r:4}),bt(n).add("djs-visual"),ct(i,n);var s=St("circle");return ut(s,{cx:0,cy:0,r:10}),bt(s).add("djs-hit"),ct(i,s),t&&bt(i).add(t),i}function qr(e,t,i){var n=St("g"),s=bi(t,i),o=mi(t,i);return ct(e,n),function(e,t,i,n){var s=St("g");ct(e,s);var o=function(e,t,i){var n=t.x-e.x,s=t.y-e.y;return zr("h"===i?n:s)}(t,i,n),a=St("rect");ut(a,{x:-7,y:-1.5,width:14,height:3}),bt(a).add("djs-visual"),ct(s,a);var r=St("rect");ut(r,{x:-o/2,y:-7,width:o,height:14}),bt(r).add("djs-hit"),ct(s,r),tn(s,"v"===n?90:0)}(n,t,i,o),bt(n).add("djs-segment-dragger"),bt(n).add("h"===o?"horizontal":"vertical"),en(n,s.x,s.y),n}function zr(e){return Math.abs(Math.round(2*e/3))}function Ur(e,t,i,n,s){function o(e,t,n){Ke.bind(e,t,(function(e){i.triggerMouseEvent(t,e,n),e.stopPropagation()}))}function a(e,i){var n=t.getLayer("overlays"),s=ot('.djs-bendpoints[data-element-id="'+sa()(e.id)+'"]',n);return!s&&i&&(ut(s=St("g"),{"data-element-id":e.id}),bt(s).add("djs-bendpoints"),ct(n,s),o(s,"mousedown",e),o(s,"click",e),o(s,"dblclick",e)),s}function r(e,t){return ot('.djs-segment-dragger[data-segment-idx="'+e+'"]',t)}function l(e,t){t.waypoints.forEach((function(t,i){var n=Zr(e);ct(e,n),en(n,t.x,t.y)})),Zr(e,"floating")}function c(e,t){for(var i,n,s,a=t.waypoints,r=1;r<a.length;r++)mi(i=a[r-1],n=a[r])&&(ut(s=qr(e,i,n),{"data-segment-idx":r}),o(s,"mousemove",t))}function h(e){var t=a(e);return t||(l(t=a(e,!0),e),c(t,e)),t}function d(e){var t=a(e);t&&(function(e){pe(at(".djs-segment-dragger",e),(function(e){wt(e)}))}(t),function(e){pe(at(".djs-bendpoint",e),(function(e){wt(e)}))}(t),c(t,e),l(t,e))}e.on("connection.changed",(function(e){d(e.element)})),e.on("connection.remove",(function(e){var t=a(e.element);t&&wt(t)})),e.on("element.marker.update",(function(e){var t,i=e.element;i.waypoints&&(t=h(i),e.add?bt(t).add(e.marker):bt(t).remove(e.marker))})),e.on("element.mousemove",(function(e){var i,n,s=e.element,o=s.waypoints;if(o){if(i=a(s,!0),!(n=Nr(t,o,e.originalEvent)))return;!function(e,t){var i=ot(".floating",e),n=t.point;i&&en(i,n.x,n.y)}(i,n),n.bendpoint||function(e,t,i){var n,s,o=r(t.index,e),a=i[t.index-1],l=i[t.index],c=t.point,h=bi(a,l),d=mi(a,l);o&&(n=function(e){return ot(".djs-visual",e)}(o),s={x:c.x-h.x,y:c.y-h.y},"v"===d&&(s={x:s.y,y:s.x}),en(n,s.x,s.y))}(i,n,o)}})),e.on("element.mousedown",(function(e){if(Po(e)){var i=e.originalEvent,o=e.element;if(o.waypoints)return function(e,i){var o,a=i.waypoints,r=Nr(t,a,e);if(r)return o=function(e,t){var i,n,s=e.waypoints;return t.index<=0||t.bendpoint?null:(n=mi((i={start:s[t.index-1],end:s[t.index]}).start,i.end))?zr("h"===n?i.end.x-i.start.x:i.end.y-i.start.y)/2:null}(i,r),function(e,t,i){var n,s,o,a,r,l,c=e.index,h=e.point;return!(c<=0||e.bendpoint)&&(o=bi(n=t[c-1],s=t[c]),a=mi(n,s),r=Math.abs(h.x-o.x),l=Math.abs(h.y-o.y),a&&r<=i&&l<=i)}(r,a,o)?s.start(e,i,r.index):n.start(e,i,r.index,!r.bendpoint),!0}(i,o)}})),e.on("selection.changed",(function(e){var t=e.newSelection[0];t&&t.waypoints&&h(t)})),e.on("element.hover",(function(e){var t=e.element;t.waypoints&&(h(t),i.registerEvent(e.gfx,"mousemove","element.mousemove"))})),e.on("element.out",(function(e){i.unregisterEvent(e.gfx,"mousemove","element.mousemove")})),e.on("element.updateId",(function(e){var t=e.element,i=e.newId;if(t.waypoints){var n=a(t);n&&ut(n,{"data-element-id":i})}})),this.addHandles=h,this.updateHandles=d,this.getBendpointsContainer=a,this.getSegmentDragger=r}Ur.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var Xr=Math.round,Gr="reconnectStart",Yr="reconnectEnd",Hr="updateWaypoints";function Kr(e,t,i,n,s,o){this._injector=e,this.start=function(e,t,o,a){var r,l=i.getGraphics(t),c=t.source,h=t.target,d=t.waypoints,u=(r=a||0!==o?a||o!==d.length-1?Hr:Yr:Gr)===Hr?"connection.updateWaypoints":"connection.reconnect",p=s.allowed(u,{connection:t,source:c,target:h});!1===p&&(p=s.allowed(u,{connection:t,source:h,target:c})),!1!==p&&n.init(e,"bendpoint.move",{data:{connection:t,connectionGfx:l,context:{allowed:p,bendpointIndex:o,connection:t,source:c,target:h,insert:a,type:r}}})},t.on("bendpoint.move.hover",(function(e){var t,i=e.context,n=i.connection,o=n.source,a=n.target,r=e.hover,l=i.type;if(i.hover=r,r){var c=l===Hr?"connection.updateWaypoints":"connection.reconnect";if(t=i.allowed=s.allowed(c,{connection:n,source:l===Gr?r:o,target:l===Yr?r:a}))return i.source=l===Gr?r:o,void(i.target=l===Yr?r:a);!1===t&&(t=i.allowed=s.allowed(c,{connection:n,source:l===Yr?r:a,target:l===Gr?r:o})),t&&(i.source=l===Yr?r:a,i.target=l===Gr?r:o)}})),t.on(["bendpoint.move.out","bendpoint.move.cleanup"],(function(e){var t=e.context,i=t.type;t.hover=null,t.source=null,t.target=null,i!==Hr&&(t.allowed=!1)})),t.on("bendpoint.move.end",(function(e){var t=e.context,i=t.allowed,n=t.bendpointIndex,s=t.connection,a=t.insert,r=s.waypoints.slice(),l=t.source,c=t.target,h=t.type,d=t.hints||{},u={x:Xr(e.x),y:Xr(e.y)};if(!i)return!1;h===Hr?(a?r.splice(n,0,u):r[n]=u,d.bendpointMove={insert:a,bendpointIndex:n},r=this.cropWaypoints(s,r),o.updateWaypoints(s,function(e){e=e.slice();for(var t,i,n,s=0;e[s];)t=e[s],i=e[s-1],0===pi(t,n=e[s+1])||fi(i,n,t)?e.splice(s,1):s++;return e}(r),d)):(h===Gr?(d.docking="source",Jr(t)&&(d.docking="target",d.newWaypoints=r.reverse())):h===Yr&&(d.docking="target",Jr(t)&&(d.docking="source",d.newWaypoints=r.reverse())),o.reconnect(s,l,c,u,d))}),this)}function Jr(e){var t=e.hover,i=e.source,n=e.target,s=e.type;return s===Gr?t&&n&&t===n&&i!==n:s===Yr?t&&i&&t===i&&i!==n:void 0}Kr.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],Kr.prototype.cropWaypoints=function(e,t){var i=this._injector.get("connectionDocking",!1);if(!i)return t;var n=e.waypoints;return e.waypoints=t,e.waypoints=i.getCroppedWaypoints(e),t=e.waypoints,e.waypoints=n,t};var el="updateWaypoints",tl="connect-ok",il="connect-not-ok",nl="connect-hover",sl="djs-updating",ol="djs-element-hidden";function al(e,t,i,n){this._injector=t;var s=t.get("connectionPreview",!1);i.on("bendpoint.move.start",(function(e){var t=e.context,i=t.bendpointIndex,s=t.connection,o=t.insert,a=s.waypoints,r=a.slice();t.waypoints=a,o&&r.splice(i,0,{x:e.x,y:e.y}),s.waypoints=r,bt(t.draggerGfx=Zr(n.getLayer("overlays"))).add("djs-dragging"),n.addMarker(s,ol),n.addMarker(s,sl)})),i.on("bendpoint.move.hover",(function(e){var t=e.context,i=t.allowed,s=t.hover,o=t.type;if(s){if(n.addMarker(s,nl),o===el)return;i?(n.removeMarker(s,il),n.addMarker(s,tl)):!1===i&&(n.removeMarker(s,tl),n.addMarker(s,il))}})),i.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,(function(e){var t=e.context,i=t.hover,s=t.target;i&&(n.removeMarker(i,nl),n.removeMarker(i,s?tl:il))})),i.on("bendpoint.move.move",(function(t){var i=t.context,n=i.allowed,o=i.bendpointIndex,a=i.draggerGfx,r=i.hover,l=i.type,c=i.connection,h=c.source,d=c.target,u=c.waypoints.slice(),p={x:t.x,y:t.y},f=i.hints||{},m={};s&&(f.connectionStart&&(m.connectionStart=f.connectionStart),f.connectionEnd&&(m.connectionEnd=f.connectionEnd),"reconnectStart"===l?Jr(i)?(m.connectionEnd=m.connectionEnd||p,m.source=d,m.target=r||h,u=u.reverse()):(m.connectionStart=m.connectionStart||p,m.source=r||h,m.target=d):"reconnectEnd"===l?Jr(i)?(m.connectionStart=m.connectionStart||p,m.source=r||d,m.target=h,u=u.reverse()):(m.connectionEnd=m.connectionEnd||p,m.source=h,m.target=r||d):(m.noCropping=!0,m.noLayout=!0,u[o]=p),l===el&&(u=e.cropWaypoints(c,u)),m.waypoints=u,s.drawPreview(i,n,m)),en(a,t.x,t.y)}),this),i.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,(function(e){var t=e.context,i=t.connection,o=t.draggerGfx,a=t.hover,r=t.target,l=t.waypoints;i.waypoints=l,wt(o),n.removeMarker(i,sl),n.removeMarker(i,ol),a&&(n.removeMarker(a,tl),n.removeMarker(a,r?tl:il)),s&&s.cleanUp(t)}))}al.$inject=["bendpointMove","injector","eventBus","canvas"];var rl="connect-hover",ll="djs-updating";function cl(e,t,i){return hl(e,t,e[t]+i)}function hl(e,t,i){return{x:"x"===t?i:e.x,y:"y"===t?i:e.y}}function dl(e){return"x"===e?"y":"x"}function ul(e,t,i){var n,s;return e.original?e.original:(n=Ci(t),hl(e,s=dl(i),n[s]))}function pl(e,t,i,n,s,o){var a=e.get("connectionDocking",!1);function r(e,t){if(!a)return t;var i,n=e.waypoints;return e.waypoints=t,i=a.getCroppedWaypoints(e),e.waypoints=n,i}function l(e){s.update("connection",e.connection,e.connectionGfx)}this.start=function(e,t,s){var o,a,r,l,c=i.getGraphics(t),h=s-1,d=s,u=t.waypoints,p=u[h],f=u[d],m=Nr(i,u,e);(a=mi(p,f))&&(r="v"===a?"x":"y",0===h&&(p=ul(p,t.source,r)),d===u.length-1&&(f=ul(f,t.target,r)),o={connection:t,segmentStartIndex:h,segmentEndIndex:d,segmentStart:p,segmentEnd:f,axis:r,dragPosition:l=m?m.point:{x:(p.x+f.x)/2,y:(p.y+f.y)/2}},n.init(e,l,"connectionSegment.move",{cursor:"x"===r?"resize-ew":"resize-ns",data:{connection:t,connectionGfx:c,context:o}}))},t.on("connectionSegment.move.start",(function(e){var t=e.context,n=e.connection,s=i.getLayer("overlays");t.originalWaypoints=n.waypoints.slice(),t.draggerGfx=qr(s,t.segmentStart,t.segmentEnd),bt(t.draggerGfx).add("djs-dragging"),i.addMarker(n,ll)})),t.on("connectionSegment.move.move",(function(e){var t,i,n=e.context,s=n.connection,o=n.segmentStartIndex,a=n.segmentEndIndex,c=n.segmentStart,h=n.segmentEnd,d=n.axis,u=n.originalWaypoints.slice(),p=cl(c,d,e["d"+d]),f=cl(h,d,e["d"+d]),m=u.length,g=0;u[o]=p,u[a]=f,o<2&&(t=Si(s.source,p),1===o?"intersect"===t&&(u.shift(),u[0]=p,g--):"intersect"!==t&&(u.unshift(c),g++)),a>m-3&&(i=Si(s.target,f),a===m-2?"intersect"===i&&(u.pop(),u[u.length-1]=f):"intersect"!==i&&u.push(h)),n.newWaypoints=s.waypoints=r(s,u),function(e,t,i){var n,s,o,a,r,l,c=e.newWaypoints,h=(n=i,s=c[e.segmentStartIndex+t],o=c[e.segmentEndIndex+t],a=dl(e.axis),r=Math.max(s[a],o[a]),l=Math.min(s[a],o[a]),hl(s,a,Math.min(Math.max(l+20,n[a]),r-20)));en(e.draggerGfx,h.x,h.y)}(n,g,e),n.newSegmentStartIndex=o+g,l(e)})),t.on("connectionSegment.move.hover",(function(e){e.context.hover=e.hover,i.addMarker(e.hover,rl)})),t.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],(function(e){var t=e.context.hover;t&&i.removeMarker(t,rl)})),t.on("connectionSegment.move.cleanup",(function(e){var t=e.context,n=t.connection;t.draggerGfx&&wt(t.draggerGfx),i.removeMarker(n,ll)})),t.on(["connectionSegment.move.cancel","connectionSegment.move.end"],(function(e){var t=e.context;t.connection.waypoints=t.originalWaypoints,l(e)})),t.on("connectionSegment.move.end",(function(e){var t=e.context,i=t.connection,n=t.newWaypoints,s=t.newSegmentStartIndex,a=function(e,t){var i=0;return{waypoints:e.filter((function(n,s){return!fi(e[s-1],e[s+1],n)||(i=s<=t?i-1:i,!1)})),segmentOffset:i}}(n=n.map((function(e){return{original:e.original,x:Math.round(e.x),y:Math.round(e.y)}})),s),l=r(i,a.waypoints),c=a.segmentOffset,h={segmentMove:{segmentStartIndex:t.segmentStartIndex,newSegmentStartIndex:s+c}};o.updateWaypoints(i,l,h)}))}pl.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var fl=Math.abs,ml=Math.round;function gl(e){return{x:e.x,y:e.y}}function bl(e){return{x:e.x+e.width,y:e.y+e.height}}function vl(e,t){return!e||isNaN(e.x)||isNaN(e.y)?t:{x:ml(e.x+e.width/2),y:ml(e.y+e.height/2)}}function wl(e,t){var i=e.snapped;return!!i&&("string"==typeof t?i[t]:i.x&&i.y)}function yl(e,t,i){if("string"!=typeof t)throw new Error("axis must be in [x, y]");if("number"!=typeof i&&!1!==i)throw new Error("value must be Number or false");var n,s=e[t],o=e.snapped=e.snapped||{};return!1===i?o[t]=!1:(o[t]=!0,n=i-s,e[t]+=n,e["d"+t]+=n),s}function Ol(e){return e.children||[]}var xl=Math.abs,$l=Math.round;function Cl(e){function t(e,t){if(oe(e)){for(var i=e.length;i--;)if(xl(e[i]-t)<=10)return e[i]}else{var n=t%(e=+e);if(n<10)return t-n;if(n>e-10)return t-n+e}return t}function i(e){if(e.width)return{x:$l(e.width/2+e.x),y:$l(e.height/2+e.y)}}e.on("connectionSegment.move.move",1500,(function(e){var n,s,o=function(e){var t=e.snapPoints,n=e.connection,s=n.waypoints,o=e.segmentStart,a=e.segmentStartIndex,r=e.segmentEnd,l=e.segmentEndIndex,c=e.axis;if(t)return t;var h=[s[a-1],o,r,s[l+1]];return a<2&&h.unshift(i(n.source)),l>s.length-3&&h.unshift(i(n.target)),e.snapPoints=t={horizontal:[],vertical:[]},pe(h,(function(e){e&&(e=e.original||e,"y"===c&&t.horizontal.push(e.y),"x"===c&&t.vertical.push(e.x))})),t}(e.context),a=e.x,r=e.y;if(o){var l=a-(n=t(o.vertical,a)),c=r-(s=t(o.horizontal,r));Ve(e,{dx:e.dx-l,dy:e.dy-c,x:n,y:s}),(l||-1!==o.vertical.indexOf(a))&&yl(e,"x",n),(c||-1!==o.horizontal.indexOf(r))&&yl(e,"y",s)}})),e.on(["bendpoint.move.move","bendpoint.move.end"],1500,(function(e){var n,s,o=e.context,a=function(e){var t=e.snapPoints,i=e.connection.waypoints,n=e.bendpointIndex;if(t)return t;var s=[i[n-1],i[n+1]];return e.snapPoints=t={horizontal:[],vertical:[]},pe(s,(function(e){e&&(e=e.original||e,t.horizontal.push(e.y),t.vertical.push(e.x))})),t}(o),r=o.hover,l=r&&i(r),c=e.x,h=e.y;if(a){var d=c-(n=t(l?a.vertical.concat([l.x]):a.vertical,c)),u=h-(s=t(l?a.horizontal.concat([l.y]):a.horizontal,h));Ve(e,{dx:e.dx-d,dy:e.dy-u,x:e.x-d,y:e.y-u}),(d||-1!==a.vertical.indexOf(c))&&yl(e,"x",n),(u||-1!==a.horizontal.indexOf(h))&&yl(e,"y",s)}}))}Cl.$inject=["eventBus"];const Sl={__depends__:[Tr,jr],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",Ur],bendpointMove:["type",Kr],bendpointMovePreview:["type",al],connectionSegmentMove:["type",pl],bendpointSnapping:["type",Cl]};function _l(e,t,i,n){function s(e,t){return n.allowed("connection.create",{source:e,target:t})}e.on("connect.hover",(function(e){var t,i=e.context,n=i.start,o=e.hover;if(i.hover=o,!se(t=i.canExecute=s(n,o))){if(!1!==t)return i.source=n,void(i.target=o);se(t=i.canExecute=s(o,n))||!1!==t&&(i.source=o,i.target=n)}})),e.on(["connect.out","connect.cleanup"],(function(e){var t=e.context;t.hover=null,t.source=null,t.target=null,t.canExecute=!1})),e.on("connect.end",(function(e){var t=e.context,n=t.canExecute,s=t.connectionStart,o={x:e.x,y:e.y},a=t.source,r=t.target;if(!n)return!1;var l=null,c={connectionStart:kl(t)?o:s,connectionEnd:kl(t)?s:o};ae(n)&&(l=n),i.connect(a,r,l,c)})),this.start=function(e,i,n,s){ae(n)||(s=n,n=Ci(i)),t.init(e,"connect",{autoActivate:s,data:{shape:i,context:{start:i,connectionStart:n}}})}}function kl(e){var t=e.hover,i=e.source,n=e.target;return t&&i&&t===i&&i!==n}_l.$inject=["eventBus","dragging","modeling","rules"];var El="connect-ok",Pl="connect-not-ok";function Al(e,t,i){var n=e.get("connectionPreview",!1);n&&t.on("connect.move",(function(e){var t=e.context,i=t.canExecute,s=t.hover,o=t.source,a=t.start,r=t.startPosition,l=t.target,c=t.connectionStart||r,h=t.connectionEnd||{x:e.x,y:e.y},d=c,u=h;kl(t)&&(d=h,u=c),n.drawPreview(t,i,{source:o||a,target:l||s,connectionStart:d,connectionEnd:u})})),t.on("connect.hover",900,(function(e){var t=e.context,n=e.hover,s=t.canExecute;null!==s&&i.addMarker(n,s?El:Pl)})),t.on(["connect.out","connect.cleanup"],1100,(function(e){var t=e.hover;t&&(i.removeMarker(t,El),i.removeMarker(t,Pl))})),n&&t.on("connect.cleanup",(function(e){n.cleanUp(e.context)}))}Al.$inject=["injector","eventBus","canvas"];const Rl={__depends__:[Zo,jr,Tr],__init__:["connectPreview"],connect:["type",_l],connectPreview:["type",Al]};function Dl(e,t,i,n){this._canvas=t,this._graphicsFactory=i,this._elementFactory=n,this._connectionDocking=e.get("connectionDocking",!1),this._layouter=e.get("layouter",!1)}Dl.$inject=["injector","canvas","graphicsFactory","elementFactory"],Dl.prototype.drawPreview=function(e,t,i){i=i||{};var n,s=e.connectionPreviewGfx,o=e.getConnection,a=i.source,r=i.target,l=i.waypoints,c=i.connectionStart,h=i.connectionEnd,d=i.noLayout,u=i.noCropping,p=i.noNoop,f=this;s||(s=e.connectionPreviewGfx=this.createConnectionPreviewGfx()),yt(s),o||(o=e.getConnection=function(e){var t={};return function(i){var n=JSON.stringify(i),s=t[n];return s||(s=t[n]=e.apply(null,arguments)),s}}((function(e,t,i){return f.getConnection(e,t,i)}))),t&&(n=o(t,a,r)),n?(n.waypoints=l||[],this._layouter&&!d&&(n.waypoints=this._layouter.layoutConnection(n,{source:a,target:r,connectionStart:c,connectionEnd:h,waypoints:i.waypoints||n.waypoints})),n.waypoints&&n.waypoints.length||(n.waypoints=[a?Ci(a):c,r?Ci(r):h]),this._connectionDocking&&(a||r)&&!u&&(n.waypoints=this._connectionDocking.getCroppedWaypoints(n,a,r)),this._graphicsFactory.drawConnection(s,n)):!p&&this.drawNoopPreview(s,i)},Dl.prototype.drawNoopPreview=function(e,t){var i=t.source,n=t.target,s=t.connectionStart||Ci(i),o=t.connectionEnd||Ci(n),a=this.cropWaypoints(s,o,i,n);ct(e,this.createNoopConnection(a[0],a[1]))},Dl.prototype.cropWaypoints=function(e,t,i,n){var s=this._graphicsFactory,o=i&&s.getShapePath(i),a=n&&s.getShapePath(n),r=s.getConnectionPath({waypoints:[e,t]});return[e=i&&_i(o,r,!0)||e,t=n&&_i(a,r,!1)||t]},Dl.prototype.cleanUp=function(e){e&&e.connectionPreviewGfx&&wt(e.connectionPreviewGfx)},Dl.prototype.getConnection=function(e){var t=function(e){return ae(e)?e:{}}(e);return this._elementFactory.createConnection(t)},Dl.prototype.createConnectionPreviewGfx=function(){var e=St("g");return ut(e,{pointerEvents:"none"}),bt(e).add("djs-connection-preview"),ct(this._canvas.getActiveLayer(),e),e},Dl.prototype.createNoopConnection=function(e,t){var i=St("polyline");return ut(i,{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),ut(i,{points:[e.x,e.y,t.x,t.y]}),i};const Vl={__init__:["connectionPreview"],connectionPreview:["type",Dl]};var Ll=Math.min,Tl=Math.max;function Bl(e){e.preventDefault()}function Fl(e){e.stopPropagation()}function Il(e){this.container=e.container,this.parent=it('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=ot("[contenteditable]",this.parent),this.keyHandler=e.keyHandler||function(){},this.resizeHandler=e.resizeHandler||function(){},this.autoResize=Re(this.autoResize,this),this.handlePaste=Re(this.handlePaste,this)}function jl(e,t){this._eventBus=e,this._providers=[],this._textbox=new Il({container:t.getContainer(),keyHandler:Re(this._handleKey,this),resizeHandler:Re(this._handleResize,this)})}Il.prototype.create=function(e,t,i,n){var s=this.parent,o=this.content,a=this.container;n=this.options=n||{};var r=Le(t=this.style=t||{},["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);Ve(s.style,{width:e.width+"px",height:e.height+"px",maxWidth:e.maxWidth+"px",maxHeight:e.maxHeight+"px",minWidth:e.minWidth+"px",minHeight:e.minHeight+"px",left:e.x+"px",top:e.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},r);var l=Le(t,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return Ve(o.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},l),n.centerVertically&&Ve(o.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},l),o.innerText=i,Ke.bind(o,"keydown",this.keyHandler),Ke.bind(o,"mousedown",Fl),Ke.bind(o,"paste",this.handlePaste),n.autoResize&&Ke.bind(o,"input",this.autoResize),n.resizable&&this.resizable(t),a.appendChild(s),this.setSelection(o.lastChild,o.lastChild&&o.lastChild.length),s},Il.prototype.handlePaste=function(e){var t,i=this.options,n=this.style;if(e.preventDefault(),t=e.clipboardData?e.clipboardData.getData("text/plain"):window.clipboardData.getData("Text"),this.insertText(t),i.autoResize){var s=this.autoResize(n);s&&this.resizeHandler(s)}},Il.prototype.insertText=function(e){e=e.replace(/\r\n|\r|\n/g,"\n"),document.execCommand("insertText",!1,e)||this._insertTextIE(e)},Il.prototype._insertTextIE=function(e){var t,i,n,s=this.getSelection(),o=s.startContainer,a=s.endContainer,r=s.startOffset,l=s.endOffset,c=s.commonAncestorContainer,h=(t=c.childNodes,[].slice.call(t));if(function(e){return e.nodeType===Node.TEXT_NODE}(c)){var d=o.textContent;o.textContent=d.substring(0,r)+e+d.substring(l),i=o,n=r+e.length}else if(o===this.content&&a===this.content){var u=document.createTextNode(e);this.content.insertBefore(u,h[r]),i=u,n=u.textContent.length}else{var p=h.indexOf(o),f=h.indexOf(a);h.forEach((function(t,i){i===p?t.textContent=o.textContent.substring(0,r)+e+a.textContent.substring(l):i>p&&i<=f&&rt(t)})),i=o,n=r+e.length}i&&void 0!==n&&setTimeout((function(){self.setSelection(i,n)}))},Il.prototype.autoResize=function(){var e=this.parent,t=this.content,i=parseInt(this.style.fontSize)||12;if(t.scrollHeight>e.offsetHeight||t.scrollHeight<e.offsetHeight-i){var n=e.getBoundingClientRect(),s=t.scrollHeight;e.style.height=s+"px",this.resizeHandler({width:n.width,height:n.height,dx:0,dy:s-n.height})}},Il.prototype.resizable=function(){var e=this,t=this.parent,i=this.resizeHandle,n=parseInt(this.style.minWidth)||0,s=parseInt(this.style.minHeight)||0,o=parseInt(this.style.maxWidth)||1/0,a=parseInt(this.style.maxHeight)||1/0;if(!i){var r,l,c,h;i=this.resizeHandle=it('<div class="djs-direct-editing-resize-handle"></div>');var d=function(i){Bl(i),Fl(i);var d=Ll(Tl(c+i.clientX-r,n),o),u=Ll(Tl(h+i.clientY-l,s),a);t.style.width=d+"px",t.style.height=u+"px",e.resizeHandler({width:c,height:h,dx:i.clientX-r,dy:i.clientY-l})},u=function(e){Bl(e),Fl(e),Ke.unbind(document,"mousemove",d,!1),Ke.unbind(document,"mouseup",u,!1)};Ke.bind(i,"mousedown",(function(e){Bl(e),Fl(e),r=e.clientX,l=e.clientY;var i=t.getBoundingClientRect();c=i.width,h=i.height,Ke.bind(document,"mousemove",d),Ke.bind(document,"mouseup",u)}))}Ve(i.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),t.appendChild(i)},Il.prototype.destroy=function(){var e=this.parent,t=this.content,i=this.resizeHandle;t.innerText="",e.removeAttribute("style"),t.removeAttribute("style"),Ke.unbind(t,"keydown",this.keyHandler),Ke.unbind(t,"mousedown",Fl),Ke.unbind(t,"input",this.autoResize),Ke.unbind(t,"paste",this.handlePaste),i&&(i.removeAttribute("style"),rt(i)),rt(e)},Il.prototype.getValue=function(){return this.content.innerText.trim()},Il.prototype.getSelection=function(){return window.getSelection().getRangeAt(0)},Il.prototype.setSelection=function(e,t){var i=document.createRange();null===e?i.selectNodeContents(this.content):(i.setStart(e,t),i.setEnd(e,t));var n=window.getSelection();n.removeAllRanges(),n.addRange(i)},jl.$inject=["eventBus","canvas"],jl.prototype.registerProvider=function(e){this._providers.push(e)},jl.prototype.isActive=function(){return!!this._active},jl.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},jl.prototype._fire=function(e,t){this._eventBus.fire("directEditing."+e,t||{active:this._active})},jl.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0},jl.prototype.complete=function(){var e=this._active;if(e){var t,i=e.context.bounds,n=this.$textbox.getBoundingClientRect(),s=this.getValue();s===e.context.text&&n.height===i.height&&n.width===i.width||(t=this._textbox.container.getBoundingClientRect(),e.provider.update(e.element,s,e.context.text,{x:n.left-t.left,y:n.top-t.top,width:n.width,height:n.height})),this._fire("complete"),this.close()}},jl.prototype.getValue=function(){return this._textbox.getValue()},jl.prototype._handleKey=function(e){e.stopPropagation();var t=e.keyCode||e.charCode;return 27===t?(e.preventDefault(),this.cancel()):13!==t||e.shiftKey?void 0:(e.preventDefault(),this.complete())},jl.prototype._handleResize=function(e){this._fire("resize",e)},jl.prototype.activate=function(e){var t;this.isActive()&&this.cancel();var i=de(this._providers,(function(i){return(t=i.activate(e))?i:null}));return t&&(this.$textbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this._active={element:e,context:t,provider:i},t.options&&t.options.resizable&&(this.resizable=!0),this._fire("activate")),!!t};const Ml={__depends__:[To],__init__:["directEditing"],directEditing:["type",jl]};var Ql=".entry";function Wl(e,t,i){this._eventBus=t,this._overlays=i;var n=ne(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={position:{right:-9,top:-6},scale:n},this._current=null,this._init()}Wl.$inject=["config.contextPad","eventBus","overlays"],Wl.prototype._init=function(){var e=this._eventBus,t=this;e.on("selection.changed",(function(e){var i=e.newSelection;1===i.length?t.open(i[0]):t.close()})),e.on("elements.delete",(function(e){pe(e.elements,(function(e){t.isOpen(e)&&t.close()}))})),e.on("element.changed",(function(e){var i=e.element,n=t._current;n&&n.element===i&&t.open(i,!0)}))},Wl.prototype.registerProvider=function(e,t){t||(t=e,e=1e3),this._eventBus.on("contextPad.getProviders",e,(function(e){e.providers.push(t)}))},Wl.prototype.getEntries=function(e){var t=this._getProviders(),i={};return pe(t,(function(t){var n=t.getContextPadEntries(e);le(n)?i=n(i):pe(n,(function(e,t){i[t]=e}))})),i},Wl.prototype.trigger=function(e,t,i){var n,s,o=this._current.element,a=this._current.entries,r=t.delegateTarget||t.target;if(!r)return t.preventDefault();if(n=a[Be(r,"data-action")].action,s=t.originalEvent||t,le(n)){if("click"===e)return n(s,o,i)}else if(n[e])return n[e](s,o,i);t.preventDefault()},Wl.prototype.open=function(e,t){!t&&this.isOpen(e)||(this.close(),this._updateAndOpen(e))},Wl.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},Wl.prototype._updateAndOpen=function(e){var t=this.getEntries(e),i=this.getPad(e),n=i.html;pe(t,(function(e,t){var i,s=e.group||"default",o=it(e.html||'<div class="entry" draggable="true"></div>');Be(o,"data-action",t),(i=ot("[data-group="+s+"]",n))||(i=it('<div class="group" data-group="'+s+'"></div>'),n.appendChild(i)),i.appendChild(o),e.className&&function(e,t){var i=Qe(e);(oe(t)?t:t.split(/\s+/g)).forEach((function(e){i.add(e)}))}(o,e.className),e.title&&Be(o,"title",e.title),e.imageUrl&&o.appendChild(it('<img src="'+e.imageUrl+'">'))})),Qe(n).add("open"),this._current={element:e,pad:i,entries:t},this._eventBus.fire("contextPad.open",{current:this._current})},Wl.prototype.getPad=function(e){if(this.isOpen())return this._current.pad;var t=this,i=this._overlays,n=it('<div class="djs-context-pad"></div>'),s=Ve({html:n},this._overlaysConfig);et(n,Ql,"click",(function(e){t.trigger("click",e)})),et(n,Ql,"dragstart",(function(e){t.trigger("dragstart",e)})),Ke.bind(n,"mousedown",(function(e){e.stopPropagation()})),this._overlayId=i.add(e,"context-pad",s);var o=i.get(this._overlayId);return this._eventBus.fire("contextPad.create",{element:e,pad:o}),o},Wl.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},Wl.prototype.isOpen=function(e){return!(!this._current||e&&this._current.element!==e)};const Nl={__depends__:[To,Ho],contextPad:["type",Wl]};var Zl=["marker-start","marker-mid","marker-end"],ql=["circle","ellipse","line","path","polygon","polyline","rect"];function zl(e,t,i,n){this._elementRegistry=e,this._canvas=i,this._styles=n,this._clonedMarkers={};var s=this;t.on("drag.cleanup",(function(){pe(s._clonedMarkers,(function(e){wt(e)})),s._clonedMarkers={}}))}zl.$inject=["elementRegistry","eventBus","canvas","styles"],zl.prototype.getGfx=function(e){return this._elementRegistry.getGraphics(e)},zl.prototype.addDragger=function(e,t,i){var n=Ot(i=i||this.getGfx(e)),s=i.getBoundingClientRect();return this._cloneMarkers(Ki(n)),ut(n,this._styles.cls("djs-dragger",[],{x:s.top,y:s.left})),ct(t,n),n},zl.prototype.addFrame=function(e,t){var i=St("rect",{class:"djs-resize-overlay",width:e.width,height:e.height,x:e.x,y:e.y});return ct(t,i),i},zl.prototype._cloneMarkers=function(e){var t=this;if(e.childNodes)for(var i=0;i<e.childNodes.length;i++)t._cloneMarkers(e.childNodes[i]);(function(e){return-1!==ql.indexOf(e.nodeName)})(e)&&Zl.forEach((function(i){if(ut(e,i)){var n=function(e,t,i){return ot("marker#"+ut(e,t).match(/url\(['"]?#([^'"]*)['"]?\)/)[1],i||document)}(e,i,t._canvas.getContainer());t._cloneMarker(e,n,i)}}))},zl.prototype._cloneMarker=function(e,t,i){var n=t.id,s=this._clonedMarkers[n];if(!s){var o=n+"-clone";(s=Ot(t)).id=o,bt(s).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[n]=s;var a=ot("defs",this._canvas._svg);a||(a=St("defs"),ct(this._canvas._svg,a)),ct(a,s)}ut(e,i,"url(#"+this._clonedMarkers[n].id+")")};const Ul={__init__:["previewSupport"],previewSupport:["type",zl]};var Xl="drop-ok",Gl="drop-not-ok",Yl="attach-ok",Hl="new-parent",Kl="create";function Jl(e,t,i,n,s){function o(t,i){[Yl,Xl,Gl,Hl].forEach((function(n){n===i?e.addMarker(t,n):e.removeMarker(t,n)}))}function a(){var e=t.context();e&&e.prefix===Kl&&t.cancel()}i.on(["create.move","create.hover"],(function(e){var t=e.context,i=t.elements,n=e.hover,a=t.source,r=t.hints||{};if(!n)return t.canExecute=!1,void(t.target=null);ec(e);var l={x:e.x,y:e.y},c=t.canExecute=n&&function(e,t,i,n,o){if(!t)return!1;var a=de(e=ue(e,(function(t){var i=t.labelTarget;return!(t.parent||function(e){return!!e.labelTarget}(t)&&-1!==e.indexOf(i))})),(function(e){return!tc(e)})),r=!1,l=!1,c=!1;ic(e)&&(r=s.allowed("shape.attach",{position:i,shape:a,target:t})),r||(c=ic(e)?s.allowed("shape.create",{position:i,shape:a,source:n,target:t}):s.allowed("elements.create",{elements:e,position:i,target:t}));var h=o.connectionTarget;return c||r?(a&&n&&(l=s.allowed("connection.create",{source:h===n?a:n,target:h===n?n:a,hints:{targetParent:t,targetAttach:r}})),{attach:r,connect:l}):(null===c||null===r)&&null}(i,n,l,a,r);n&&null!==c&&(t.target=n,c&&c.attach?o(n,Yl):o(n,c?Hl:Gl))})),i.on(["create.end","create.out","create.cleanup"],(function(e){var t=e.hover;t&&o(t,null)})),i.on("create.end",(function(e){var t=e.context,i=t.source,s=t.shape,o=t.elements,a=t.target,r=t.canExecute,l=r&&r.attach,c=r&&r.connect,h=t.hints||{};if(!1===r||!a)return!1;ec(e);var d={x:e.x,y:e.y};s=c?n.appendShape(i,s,d,a,{attach:l,connection:!0===c?{}:c,connectionTarget:h.connectionTarget}):de(o=n.createElements(o,d,a,Ve({},h,{attach:l})),(function(e){return!tc(e)})),Ve(t,{elements:o,shape:s}),Ve(e,{elements:o,shape:s})})),i.on("create.init",(function(){i.on("elements.changed",a),i.once(["create.cancel","create.end"],2e3,(function(){i.off("elements.changed",a)}))})),this.start=function(e,i,n){oe(i)||(i=[i]);var s=de(i,(function(e){return!tc(e)}));if(s){n=Ve({elements:i,hints:{},shape:s},n||{}),pe(i,(function(e){re(e.x)||(e.x=0),re(e.y)||(e.y=0)}));var o=si(ue(i,(function(e){return!e.hidden})));pe(i,(function(e){tc(e)&&(e.waypoints=be(e.waypoints,(function(e){return{x:e.x-o.x-o.width/2,y:e.y-o.y-o.height/2}}))),Ve(e,{x:e.x-o.x-o.width/2,y:e.y-o.y-o.height/2})})),t.init(e,Kl,{cursor:"grabbing",autoActivate:!0,data:{shape:s,elements:i,context:n}})}}}function ec(e){var t=e.context.createConstraints;t&&(t.left&&(e.x=Math.max(e.x,t.left)),t.right&&(e.x=Math.min(e.x,t.right)),t.top&&(e.y=Math.max(e.y,t.top)),t.bottom&&(e.y=Math.min(e.y,t.bottom)))}function tc(e){return!!e.waypoints}function ic(e){return e&&1===e.length&&!tc(e[0])}function nc(e,t,i,n,s){t.on("create.move",750,(function(t){var o=t.hover,a=t.context,r=a.elements,l=a.dragGroup;l||(l=a.dragGroup=function(e){var t=St("g");ut(t,s.cls("djs-drag-group",["no-events"]));var o=St("g");return e.forEach((function(e){var s;e.hidden||(e.waypoints?(s=i._createContainer("connection",o),i.drawConnection(Ki(s),e)):(s=i._createContainer("shape",o),i.drawShape(Ki(s),e),en(s,e.x,e.y)),n.addDragger(e,t,s))})),t}(r)),o?(l.parentNode||ct(e.getActiveLayer(),l),en(l,t.x,t.y)):wt(l)})),t.on("create.cleanup",(function(e){var t=e.context.dragGroup;t&&wt(t)}))}Jl.$inject=["canvas","dragging","eventBus","modeling","rules"],nc.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const sc={__depends__:[Tr,Ul,jr,Zo],__init__:["create","createPreview"],create:["type",Jl],createPreview:["type",nc]};var oc="data-id",ac=["contextPad.close","canvas.viewbox.changing","commandStack.changed"];function rc(e,t,i){var n=ne(e&&e.scale)?e.scale:{min:1,max:1.5};this._config={scale:n},this._eventBus=t,this._canvas=i,this._providers={},this._current={}}rc.$inject=["config.popupMenu","eventBus","canvas"],rc.prototype.registerProvider=function(e,t,i){i||(i=t,t=1e3),this._eventBus.on("popupMenu.getProviders."+e,t,(function(e){e.providers.push(i)}))},rc.prototype.isEmpty=function(e,t){if(!e)throw new Error("element parameter is missing");if(!t)throw new Error("providerId parameter is missing");var i=this._getProviders(t);if(!i)return!0;var n=this._getEntries(e,i),s=this._getHeaderEntries(e,i),o=we(n)>0,a=s&&we(s)>0;return!o&&!a},rc.prototype.open=function(e,t,i){var n=this._getProviders(t);if(!e)throw new Error("Element is missing");if(!n||!n.length)throw new Error("No registered providers for: "+t);if(!i)throw new Error("the position argument is missing");this.isOpen()&&this.close(),this._emit("open");var s=this._current={className:t,element:e,position:i},o=this._getEntries(e,n),a=this._getHeaderEntries(e,n);s.entries=Ve({},o,a),s.container=this._createContainer(),we(a)&&s.container.appendChild(this._createEntries(a,"djs-popup-header")),we(o)&&s.container.appendChild(this._createEntries(o,"djs-popup-body"));var r=this._canvas.getContainer();this._attachContainer(s.container,r,i.cursor),this._bindAutoClose()},rc.prototype.close=function(){this.isOpen()&&(this._emit("close"),this._unbindAutoClose(),rt(this._current.container),this._current.container=null)},rc.prototype.isOpen=function(){return!!this._current.container},rc.prototype.trigger=function(e){e.preventDefault();var t=Be(e.delegateTarget||e.target,oc),i=this._getEntry(t);if(i.action)return i.action.call(null,e,i)},rc.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"popupMenu.getProviders."+e,providers:[]});return this._eventBus.fire(t),t.providers},rc.prototype._getEntries=function(e,t){var i={};return pe(t,(function(t){if(t.getPopupMenuEntries){var n=t.getPopupMenuEntries(e);le(n)?i=n(i):pe(n,(function(e,t){i[t]=e}))}else pe(t.getEntries(e),(function(e){var t=e.id;if(!t)throw new Error("every entry must have the id property set");i[t]=Te(e,["id"])}))})),i},rc.prototype._getHeaderEntries=function(e,t){var i={};return pe(t,(function(t){if(t.getPopupMenuHeaderEntries){var n=t.getPopupMenuHeaderEntries(e);le(n)?i=n(i):pe(n,(function(e,t){i[t]=e}))}else{if(!t.getHeaderEntries)return;pe(t.getHeaderEntries(e),(function(e){var t=e.id;if(!t)throw new Error("every entry must have the id property set");i[t]=Te(e,["id"])}))}})),i},rc.prototype._getEntry=function(e){var t=this._current.entries[e];if(!t)throw new Error("entry not found");return t},rc.prototype._emit=function(e){this._eventBus.fire("popupMenu."+e)},rc.prototype._createContainer=function(){var e=it('<div class="djs-popup">'),t=this._current.position,i=this._current.className;return Ve(e.style,{position:"absolute",left:t.x+"px",top:t.y+"px",visibility:"hidden"}),Qe(e).add(i),e},rc.prototype._attachContainer=function(e,t,i){var n=this;et(e,".entry","click",(function(e){n.trigger(e)})),this._updateScale(e),t.appendChild(e),i&&this._assureIsInbounds(e,i)},rc.prototype._updateScale=function(e){var t,i,n=this._canvas.zoom(),s=this._config.scale,o=n;!0!==s&&(!1===s?(t=1,i=1):(t=s.min,i=s.max),ne(t)&&n<t&&(o=t),ne(i)&&n>i&&(o=i)),function(e,t){e.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(i){e.style[i+"transform"]=t}))}(e,"scale("+o+")")},rc.prototype._assureIsInbounds=function(e,t){var i,n,s=this._canvas._container.getBoundingClientRect(),o=e.offsetLeft,a=e.offsetTop,r=e.scrollWidth,l=e.scrollHeight,c={},h=t.x-s.left,d=t.y-s.top;o+r>s.width&&(c.x=!0),a+l>s.height&&(c.y=!0),c.x&&c.y?(i=h-r+"px",n=d-l+"px"):c.x?(i=h-r+"px",n=d+"px"):c.y&&d<l?(i=h+"px",n="10px"):c.y&&(i=h+"px",n=d-l+"px"),Ve(e.style,{left:i,top:n},{visibility:"visible","z-index":1e3})},rc.prototype._createEntries=function(e,t){var i=it("<div>"),n=this;return Qe(i).add(t),pe(e,(function(e,t){var s=n._createEntry(e,t);i.appendChild(s)})),i},rc.prototype._createEntry=function(e,t){var i=it("<div>"),n=Qe(i);if(n.add("entry"),e.className&&e.className.split(" ").forEach((function(e){n.add(e)})),Be(i,oc,t),e.label){var s=it("<span>");s.textContent=e.label,i.appendChild(s)}return e.imageUrl&&i.appendChild(it('<img src="'+e.imageUrl+'" />')),!0===e.active&&n.add("active"),!0===e.disabled&&n.add("disabled"),e.title&&(i.title=e.title),i},rc.prototype._bindAutoClose=function(){this._eventBus.once(ac,this.close,this)},rc.prototype._unbindAutoClose=function(){this._eventBus.off(ac,this.close,this)};const lc={__init__:["popupMenu"],popupMenu:["type",rc]};function cc(){}cc.prototype.get=function(){return this._data},cc.prototype.set=function(e){this._data=e},cc.prototype.clear=function(){var e=this._data;return delete this._data,e},cc.prototype.isEmpty=function(){return!this._data};const hc={clipboard:["type",cc]};function dc(e){var t=this;function i(e){t._lastMoveEvent=e}this._lastMoveEvent=null,e.on("canvas.init",(function(e){(t._svg=e.svg).addEventListener("mousemove",i)})),e.on("canvas.destroy",(function(){t._lastMouseEvent=null,t._svg.removeEventListener("mousemove",i)}))}dc.$inject=["eventBus"],dc.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||((e=document.createEvent("MouseEvent")).initMouseEvent&&e.initMouseEvent("mousemove",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e);var e};const uc={__init__:["mouse"],mouse:["type",dc]};function pc(e,t,i,n,s,o,a,r){this._canvas=e,this._create=t,this._clipboard=i,this._elementFactory=n,this._eventBus=s,this._modeling=o,this._mouse=a,this._rules=r,s.on("copyPaste.copyElement",(function(e){var t=e.descriptor,i=e.element,n=e.elements;t.priority=1,t.id=i.id,de(n,(function(e){return e===i.parent}))&&(t.parent=i.parent.id),function(e){return!!e.host}(i)&&(t.priority=2,t.host=i.host.id),fc(i)&&(t.priority=3,t.source=i.source.id,t.target=i.target.id,t.waypoints=function(e){return be(e.waypoints,(function(e){return(e=gc(e)).original&&(e.original=gc(e.original)),e}))}(i)),mc(i)&&(t.priority=4,t.labelTarget=i.labelTarget.id),pe(["x","y","width","height"],(function(e){re(i[e])&&(t[e]=i[e])})),t.hidden=i.hidden,t.collapsed=i.collapsed})),s.on("copyPaste.pasteElements",(function(e){Ve(e.hints,{createElementsBehavior:!1})}))}function fc(e){return!!e.waypoints}function mc(e){return!!e.labelTarget}function gc(e){return Ve({},e)}function bc(e,t){var i=t.indexOf(e);return-1===i?t:t.splice(i,1)}pc.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"],pc.prototype.copy=function(e){var t,i;return oe(e)||(e=e?[e]:[]),i=!1===(t=this._eventBus.fire("copyPaste.canCopyElements",{elements:e}))?{}:this.createTree(oe(t)?t:e),this._clipboard.set(i),this._eventBus.fire("copyPaste.elementsCopied",{elements:e,tree:i}),i},pc.prototype.paste=function(e){var t=this._clipboard.get();if(!this._clipboard.isEmpty()){var i=e&&e.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:i});var n=this._createElements(t);if(e&&e.element&&e.point)return this._paste(n,e.element,e.point,i);this._create.start(this._mouse.getLastMoveEvent(),n,{hints:i||{}})}},pc.prototype._paste=function(e,t,i,n){pe(e,(function(e){re(e.x)||(e.x=0),re(e.y)||(e.y=0)}));var s=si(e);return pe(e,(function(e){fc(e)&&(e.waypoints=be(e.waypoints,(function(e){return{x:e.x-s.x-s.width/2,y:e.y-s.y-s.height/2}}))),Ve(e,{x:e.x-s.x-s.width/2,y:e.y-s.y-s.height/2})})),this._modeling.createElements(e,i,t,Ve({},n))},pc.prototype._createElements=function(e){var t=this,i=this._eventBus,n={},s=[];return pe(e,(function(e,o){o=parseInt(o,10),pe(e=Ce(e,"priority"),(function(e){var o,a=Ve({},Te(e,["priority"]));return n[e.parent]?a.parent=n[e.parent]:delete a.parent,i.fire("copyPaste.pasteElement",{cache:n,descriptor:a}),fc(a)?(a.source=n[e.source],a.target=n[e.target],o=n[e.id]=t.createConnection(a),void s.push(o)):mc(a)?(a.labelTarget=n[a.labelTarget],o=n[e.id]=t.createLabel(a),void s.push(o)):(a.host&&(a.host=n[a.host]),o=n[e.id]=t.createShape(a),void s.push(o))}))})),s},pc.prototype.createConnection=function(e){return this._elementFactory.createConnection(Te(e,["id"]))},pc.prototype.createLabel=function(e){return this._elementFactory.createLabel(Te(e,["id"]))},pc.prototype.createShape=function(e){return this._elementFactory.createShape(Te(e,["id"]))},pc.prototype.hasRelations=function(e,t){var i,n;return!(fc(e)&&(i=de(t,Se({id:e.source.id})),n=de(t,Se({id:e.target.id})),!i||!n)||mc(e)&&!de(t,Se({id:e.labelTarget.id})))},pc.prototype.createTree=function(e){var t=this._rules,i=this,n={},s=[];function o(e,t){var i=de(s,(function(t){return e===t.element}));i?i.depth<t&&(s=function(e,t){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t}(i,s),s.push({element:i.element,depth:t})):s.push({element:e,depth:t})}return ii(Jt(e),(function(e,t,n){if(!mc(e)){pe(e.labels,(function(e){o(e,n)})),pe([e.attachers,e.incoming,e.outgoing],(function(e){e&&e.length&&pe(e,(function(e){pe(e.labels,(function(e){o(e,n)})),o(e,n)}))})),o(e,n);var s=[];return e.children&&(s=e.children.slice()),i._eventBus.fire("copyPaste.createTree",{element:e,children:s}),s}})),e=be(s,(function(e){return e.element})),s=be(s,(function(t){return t.descriptor={},i._eventBus.fire("copyPaste.copyElement",{descriptor:t.descriptor,element:t.element,elements:e}),t})),s=Ce(s,(function(e){return e.descriptor.priority})),e=be(s,(function(e){return e.element})),pe(s,(function(s){var o=s.depth;i.hasRelations(s.element,e)&&function(e,i){return t.allowed("element.copy",{element:e,elements:i})}(s.element,e)?(n[o]||(n[o]=[]),n[o].push(s.descriptor)):bc(s.element,e)})),n};const vc={__depends__:[hc,sc,uc,jr],__init__:["copyPaste"],copyPaste:["type",pc]};function wc(e,t,i){oe(i)||(i=[i]),pe(i,(function(i){ie(e[i])||(t[i]=e[i])}))}function yc(e,t,i){var n;t.on("copyPaste.copyElement",750,(function(e){var t=e.descriptor,i=e.element,n=t.oldBusinessObject=Es(i),s=t.oldDi=Ps(i);if(t.type=i.type,wc(n,t,"name"),wc(s,t,"isExpanded"),Oc(t))return t;n.default&&(t.default=n.default.id)})),t.on("moddleCopy.canCopyProperty",(function(t){var n,s=t.parent,o=t.property;if("processRef"===t.propertyName&&_s(s,"bpmn:Participant")&&_s(o,"bpmn:Process"))return n=e.create("bpmn:Process"),i.copyElement(o,n)})),t.on("copyPaste.pasteElements",(function(){n={}})),t.on("copyPaste.pasteElement",(function(t){var s,o,a,r,l=t.cache,c=t.descriptor,h=c.oldBusinessObject,d=c.oldDi;if(Oc(c))return c.businessObject=Es(l[c.labelTarget]),void(c.di=Ps(l[c.labelTarget]));s=e.create(h.$type),c.businessObject=i.copyElement(h,s),(o=e.create(d.$type)).bpmnElement=s,c.di=i.copyElement(d,o),function(e,t){var i=Es(e);e.default&&(n[e.default]={element:i,property:"default"}),e.host&&(Es(e).attachedToRef=Es(t[e.host])),n=Te(n,fe(n,(function(t,n,s){var o=n.element,a=n.property;return s===e.id&&(o[a]=i,t.push(e.id)),t}),[]))}(c,l),wc(c,s,["isExpanded","name"]),a=c,oe(r="oldBusinessObject")||(r=[r]),pe(r,(function(e){a[e]&&delete a[e]}))}))}function Oc(e){return!!e.labelTarget}yc.$inject=["bpmnFactory","eventBus","moddleCopy"];var xc=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing"];function $c(e,t,i){this._bpmnFactory=t,this._eventBus=e,this._moddle=i,e.on("moddleCopy.canCopyProperties",(function(e){var t=e.propertyNames;if(t&&t.length)return Ce(t,(function(e){return"extensionElements"===e}))})),e.on("moddleCopy.canCopyProperty",(function(e){var t=e.parent,i=ae(t)&&t.$descriptor,n=e.propertyName;return(!n||-1===xc.indexOf(n))&&!(n&&i&&!de(i.properties,Se({name:n})))&&void 0})),e.on("moddleCopy.canSetCopiedProperty",(function(e){var t,i=e.property;if("bpmn:ExtensionElements",(t=i)&&"function"==typeof t.$instanceOf&&t.$instanceOf("bpmn:ExtensionElements")&&(!i.values||!i.values.length))return!1}))}function Cc(e,t){return fe(e.properties,(function(e,i){return t&&i.default?e:e.concat(i.name)}),[])}$c.$inject=["eventBus","bpmnFactory","moddle"],$c.prototype.copyElement=function(e,t,i){var n=this;i&&!oe(i)&&(i=[i]),i=i||Cc(e.$descriptor);var s=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:i,sourceElement:e,targetElement:t});return!1===s||(oe(s)&&(i=s),pe(i,(function(i){var s;he(e,i)&&(s=e.get(i));var o=n.copyProperty(s,t,i);!1!==n._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:t,property:o,propertyName:i})&&ne(o)&&t.set(i,o)}))),t},$c.prototype.copyProperty=function(e,t,i){var n=this,s=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:t,property:e,propertyName:i});if(!1!==s){if(s)return ae(s)&&s.$type&&!s.$parent&&(s.$parent=t),s;var o=this._moddle.getPropertyDescriptor(t,i);if(!o.isReference){if(o.isId)return this._copyId(e,t);if(oe(e))return fe(e,(function(e,o){return(s=n.copyProperty(o,t,i))?(s.$parent=t,e.concat(s)):e}),[]);if(ae(e)&&e.$type){if(this._moddle.getElementDescriptor(e).isGeneric)return;return(s=n._bpmnFactory.create(e.$type)).$parent=t,s=n.copyElement(e,s)}return e}}},$c.prototype._copyId=function(e,t){return this._moddle.ids.assigned(e)?void 0:(this._moddle.ids.claim(e,t),e)};const Sc={__depends__:[vc],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",yc],moddleCopy:["type",$c]};var _c=Math.round;function kc(e){this._modeling=e}kc.$inject=["modeling"],kc.prototype.replaceElement=function(e,t,i){if(e.waypoints)return null;var n=this._modeling,s=t.width||e.width,o=t.height||e.height,a=t.x||e.x,r=t.y||e.y,l=_c(a+s/2),c=_c(r+o/2);return n.replaceShape(e,Ve({},t,{x:l,y:c,width:s,height:o}),i)};const Ec={__init__:["replace"],replace:["type",kc]};var Pc=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function Ac(e,t,i,n,s,o,a){this.replaceElement=function(r,l,c){c=c||{};var h=l.type,d=r.businessObject;if(Rc(d)&&"bpmn:SubProcess"===h&&function(e,t){var i=e&&he(e,"collapsed")?e.collapsed:!Ws(e);return i!==(t&&(he(t,"collapsed")||he(t,"isExpanded"))?he(t,"collapsed")?t.collapsed:!t.isExpanded:i)}(r,l))return n.toggleCollapse(r),r;var u=e.create(h),p={type:h,businessObject:u,di:{}};!function(e,t,i){oe(i)||(i=[i]),pe(i,(function(i){ie(e[i])||(t[i]=e[i])}))}(r.di,p.di,["fill","stroke","background-color","border-color","color"]);var f,m=Cc(d.$descriptor),g=Cc(u.$descriptor,!0),b=(f=g,m.filter((function(e){return-1!==f.indexOf(e)})));Ve(u,Le(l,Pc));var v=ue(b,(function(e){return"eventDefinitions"===e?Dc(r,l.eventDefinitionType):"loopCharacteristics"===e?!Ns(u):!he(u,e)&&("processRef"!==e||!1!==l.isExpanded)&&"triggeredByEvent"!==e}));return u=i.copyElement(d,u,v),l.eventDefinitionType&&(Dc(u,l.eventDefinitionType)||(p.eventDefinitionType=l.eventDefinitionType,p.eventDefinitionAttrs=l.eventDefinitionAttrs)),_s(d,"bpmn:Activity")&&(Rc(d)?p.isExpanded=Ws(r):l&&he(l,"isExpanded")&&(p.isExpanded=l.isExpanded),Ws(r)&&!_s(d,"bpmn:Task")&&p.isExpanded&&(p.width=r.width,p.height=r.height)),Rc(d)&&!Rc(u)&&(c.moveChildren=!1),_s(d,"bpmn:Participant")&&(!0===l.isExpanded?u.processRef=e.create("bpmn:Process"):c.moveChildren=!1,p.width=r.width,p.height=t.getDefaultSize(p).height),o.allowed("shape.resize",{shape:u})||(p.height=t.getDefaultSize(p).height,p.width=t.getDefaultSize(p).width),u.name=d.name,ks(d,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&ks(u,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(u.default=d.default),l.host&&!_s(d,"bpmn:BoundaryEvent")&&_s(u,"bpmn:BoundaryEvent")&&(p.host=l.host),"bpmn:DataStoreReference"!==p.type&&"bpmn:DataObjectReference"!==p.type||(p.x=r.x+(r.width-p.width)/2),p=s.replaceElement(r,p,c),!1!==c.select&&a.select(p),p}}function Rc(e){return _s(e,"bpmn:SubProcess")}function Dc(e,t){var i=Es(e);return t&&i.get("eventDefinitions").some((function(e){return _s(e,t)}))}Ac.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules","selection"];const Vc={__depends__:[Sc,Ec,Zo],bpmnReplace:["type",Ac]};function Lc(e){return function(t){var i=t.target,n=Es(e),s=n.eventDefinitions&&n.eventDefinitions[0],o=n.$type===i.type,a=(s&&s.$type)===i.eventDefinitionType,r=n.triggeredByEvent===i.triggeredByEvent,l=void 0===i.isExpanded||i.isExpanded===Ws(e);return!(o&&a&&r&&l)}}var Tc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],Bc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],Fc=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Intermediate Catch Event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message Intermediate Throw Event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Intermediate Catch Event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Intermediate Throw Event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Intermediate Catch Event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link Intermediate Catch Event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link Intermediate Throw Event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation Intermediate Throw Event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal Intermediate Catch Event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal Intermediate Throw Event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],Ic=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message End Event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation End Event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error End Event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel End Event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation End Event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal End Event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],jc=[{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel Gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive Gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex Gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event based Gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],Mc=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],Qc=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],Wc=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}}],Nc=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive Task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Manual Task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business Rule Task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Script Task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call Activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub Process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],Zc=[{label:"Data Store Reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],qc=[{label:"Data Object Reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],zc=[{label:"Message Boundary Event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Boundary Event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Boundary Event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Boundary Event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Error Boundary Event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel Boundary Event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Signal Boundary Event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Compensation Boundary Event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],Uc=[{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Error Start Event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Escalation Start Event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Compensation Start Event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],Xc=[{label:"Sequence Flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default Flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional Flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],Gc=[{label:"Expanded Pool",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(e){var t="Empty Pool";return e.children&&e.children.length&&(t+=" (removes content)"),t},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}];function Yc(e,t,i,n,s,o,a){this._bpmnFactory=e,this._popupMenu=t,this._modeling=i,this._moddle=n,this._bpmnReplace=s,this._rules=o,this._translate=a,this.register()}Yc.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate"],Yc.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)},Yc.prototype.getEntries=function(e){var t,i=e.businessObject;if(!this._rules.allowed("shape.replace",{element:e}))return[];var n=Lc(e);return _s(i,"bpmn:DataObjectReference")?this._createEntries(e,Zc):_s(i,"bpmn:DataStoreReference")&&!_s(e.parent,"bpmn:Collaboration")?this._createEntries(e,qc):_s(i,"bpmn:StartEvent")&&!_s(i.$parent,"bpmn:SubProcess")?(t=ue(Tc,n),this._createEntries(e,t)):_s(i,"bpmn:Participant")?(t=ue(Gc,(function(t){return Ws(e)!==t.target.isExpanded})),this._createEntries(e,t)):_s(i,"bpmn:StartEvent")&&Ns(i.$parent)?(t=ue(Uc,(function(t){var i=!1!==t.target.isInterrupting,s=Es(e).isInterrupting===i;return n(t)||!n(t)&&!s})),this._createEntries(e,t)):_s(i,"bpmn:StartEvent")&&!Ns(i.$parent)&&_s(i.$parent,"bpmn:SubProcess")?(t=ue(Bc,n),this._createEntries(e,t)):_s(i,"bpmn:EndEvent")?(t=ue(Ic,(function(e){return!("bpmn:CancelEventDefinition"==e.target.eventDefinitionType&&!_s(i.$parent,"bpmn:Transaction"))&&n(e)})),this._createEntries(e,t)):_s(i,"bpmn:BoundaryEvent")?(t=ue(zc,(function(e){var t=e.target;if("bpmn:CancelEventDefinition"==t.eventDefinitionType&&!_s(i.attachedToRef,"bpmn:Transaction"))return!1;var s=!1!==t.cancelActivity,o=i.cancelActivity==s;return n(e)||!n(e)&&!o})),this._createEntries(e,t)):_s(i,"bpmn:IntermediateCatchEvent")||_s(i,"bpmn:IntermediateThrowEvent")?(t=ue(Fc,n),this._createEntries(e,t)):_s(i,"bpmn:Gateway")?(t=ue(jc,n),this._createEntries(e,t)):_s(i,"bpmn:Transaction")?(t=ue(Qc,n),this._createEntries(e,t)):Ns(i)&&Ws(e)?(t=ue(Wc,n),this._createEntries(e,t)):_s(i,"bpmn:SubProcess")&&Ws(e)?(t=ue(Mc,n),this._createEntries(e,t)):_s(i,"bpmn:AdHocSubProcess")&&!Ws(e)?(t=ue(Nc,(function(t){var i=t.target,n="bpmn:SubProcess"===i.type,s=!0===i.isExpanded;return Lc(e)&&(!n||s)})),this._createEntries(e,t)):_s(i,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,Xc):_s(i,"bpmn:FlowNode")?(t=ue(Nc,n),_s(i,"bpmn:SubProcess")&&!Ws(e)&&(t=ue(t,(function(e){return"Sub Process (collapsed)"!==e.label}))),this._createEntries(e,t)):[]},Yc.prototype.getHeaderEntries=function(e){var t=[];return _s(e,"bpmn:Activity")&&!Ns(e)&&(t=t.concat(this._getLoopEntries(e))),_s(e,"bpmn:DataObjectReference")&&(t=t.concat(this._getDataObjectIsCollection(e))),_s(e,"bpmn:Participant")&&(t=t.concat(this._getParticipantMultiplicity(e))),!_s(e,"bpmn:SubProcess")||_s(e,"bpmn:Transaction")||Ns(e)||t.push(this._getAdHocEntry(e)),t},Yc.prototype._createEntries=function(e,t){var i=[],n=this;return pe(t,(function(t){var s=n._createMenuEntry(t,e);i.push(s)})),i},Yc.prototype._createSequenceFlowEntries=function(e,t){var i=Es(e),n=[],s=this._modeling,o=this._moddle,a=this;return pe(t,(function(t){switch(t.actionName){case"replace-with-default-flow":i.sourceRef.default!==i&&(_s(i.sourceRef,"bpmn:ExclusiveGateway")||_s(i.sourceRef,"bpmn:InclusiveGateway")||_s(i.sourceRef,"bpmn:ComplexGateway")||_s(i.sourceRef,"bpmn:Activity"))&&n.push(a._createMenuEntry(t,e,(function(){s.updateProperties(e.source,{default:i})})));break;case"replace-with-conditional-flow":!i.conditionExpression&&_s(i.sourceRef,"bpmn:Activity")&&n.push(a._createMenuEntry(t,e,(function(){var t=o.create("bpmn:FormalExpression",{body:""});s.updateProperties(e,{conditionExpression:t})})));break;default:if(_s(i.sourceRef,"bpmn:Activity")&&i.conditionExpression)return n.push(a._createMenuEntry(t,e,(function(){s.updateProperties(e,{conditionExpression:void 0})})));if((_s(i.sourceRef,"bpmn:ExclusiveGateway")||_s(i.sourceRef,"bpmn:InclusiveGateway")||_s(i.sourceRef,"bpmn:ComplexGateway")||_s(i.sourceRef,"bpmn:Activity"))&&i.sourceRef.default===i)return n.push(a._createMenuEntry(t,e,(function(){s.updateProperties(e.source,{default:void 0})})))}})),n},Yc.prototype._createMenuEntry=function(e,t,i){var n=this._translate,s=this._bpmnReplace.replaceElement,o=e.label;return o&&"function"==typeof o&&(o=o(t)),i=i||function(){return s(t,e.target)},{label:n(o),className:e.className,id:e.actionName,action:i}},Yc.prototype._getLoopEntries=function(e){var t=this,i=this._translate;function n(i,n){var s;n.active?s=void 0:(s=t._moddle.create(n.options.loopCharacteristics),n.options.isSequential&&(s.isSequential=n.options.isSequential)),t._modeling.updateProperties(e,{loopCharacteristics:s})}var s,o,a,r=Es(e).loopCharacteristics;return r&&(s=r.isSequential,o=void 0===r.isSequential,a=void 0!==r.isSequential&&!r.isSequential),[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:i("Parallel Multi Instance"),active:a,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:i("Sequential Multi Instance"),active:s,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:i("Loop"),active:o,action:n,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}]},Yc.prototype._getDataObjectIsCollection=function(e){var t=this,i=this._translate,n=e.businessObject.dataObjectRef,s=n.isCollection;return[{id:"toggle-is-collection",className:"bpmn-icon-parallel-mi-marker",title:i("Collection"),active:s,action:function(i,s){t._modeling.updateModdleProperties(e,n,{isCollection:!s.active})}}]},Yc.prototype._getParticipantMultiplicity=function(e){var t=this,i=this._bpmnFactory,n=this._translate,s=e.businessObject.participantMultiplicity,o=[{id:"toggle-participant-multiplicity",className:"bpmn-icon-parallel-mi-marker",title:n("Participant Multiplicity"),active:!!s,action:function(n,s){var o;s.active||(o=i.create("bpmn:ParticipantMultiplicity")),t._modeling.updateProperties(e,{participantMultiplicity:o})}}];return o},Yc.prototype._getAdHocEntry=function(e){var t=this._translate,i=_s(Es(e),"bpmn:AdHocSubProcess"),n=this._bpmnReplace.replaceElement;return{id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:i,action:function(t,s){return n(e,i?{type:"bpmn:SubProcess"}:{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}}};const Hc={__depends__:[lc,Vc],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",Yc]};function Kc(e,t){for("string"==typeof t&&(t=[t]);e=e.parent;)if(ks(e,t))return e;return null}var Jc=Math.max,eh=Math.min;function th(e,t){return{top:e.top-t.top,right:e.right-t.right,bottom:e.bottom-t.bottom,left:e.left-t.left}}function ih(e,t){return{x:e.x+(t.left||0),y:e.y+(t.top||0),width:e.width-(t.left||0)+(t.right||0),height:e.height-(t.top||0)+(t.bottom||0)}}function nh(e,t,i){var n=t[e],s=i.min&&i.min[e],o=i.max&&i.max[e];return re(s)&&(n=(/top|left/.test(e)?eh:Jc)(n,s)),re(o)&&(n=(/top|left/.test(e)?Jc:eh)(n,o)),n}function sh(e,t){return void 0!==e?e:20}function oh(e){return!e.waypoints&&"label"!==e.type}function ah(e,t){var i;if((i=void 0===e.length?ue(e.children,oh):e).length)return function(e,t){var i,n,s,o;return"object"==typeof t?(i=sh(t.left),n=sh(t.right),s=sh(t.top),o=sh(t.bottom)):i=n=s=o=sh(t),{x:e.x-i,y:e.y-s,width:e.width+i+n,height:e.height+s+o}}(si(i),t)}var rh=Math.abs,lh=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],ch=30;function hh(e,t){return t=t||[],e.children.filter((function(e){_s(e,"bpmn:Lane")&&(hh(e,t),t.push(e))})),t}function dh(e){return e.children.filter((function(e){return _s(e,"bpmn:Lane")}))}function uh(e){return Kc(e,lh)||e}function ph(e,t,i,n,s,o,a,r,l,c,h,d){e=e||{},n.registerProvider(this),this._contextPad=n,this._modeling=s,this._elementFactory=o,this._connect=a,this._create=r,this._popupMenu=l,this._canvas=c,this._rules=h,this._translate=d,!1!==e.autoPlace&&(this._autoPlace=t.get("autoPlace",!1)),i.on("create.end",250,(function(e){var t=e.context.shape;if(Ao(e)&&n.isOpen(t)){var i=n.getEntries(t);i.replace&&i.replace.action.click(e,t)}}))}function fh(e,t,i){var n=e.$instanceOf(t),s=!1;return pe(e.eventDefinitions||[],(function(e){e.$type===i&&(s=!0)})),n&&s}ph.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"],ph.prototype.getContextPadEntries=function(e){var t=this._contextPad,i=this._modeling,n=this._elementFactory,s=this._connect,o=this._create,a=this._popupMenu,r=this._canvas,l=this._rules,c=this._autoPlace,h=this._translate,d={};if("label"===e.type)return d;var u=e.businessObject;function p(e,t){s.start(e,t)}function f(e,t,i,s){function a(t,i){var a=n.createShape(Ve({type:e},s));o.start(t,a,{source:i})}"string"!=typeof i&&(s=i,i=h("Append {type}",{type:e.replace(/^bpmn:/,"")}));var r=c?function(t,i){var o=n.createShape(Ve({type:e},s));c.append(i,o)}:a;return{group:"model",className:t,title:i,action:{dragstart:a,click:r}}}function m(e){return function(n,s){i.splitLane(s,e),t.open(s,!0)}}if(ks(u,["bpmn:Lane","bpmn:Participant"])&&Ws(e)){var g=dh(e);Ve(d,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:h("Add Lane above"),action:{click:function(e,t){i.addLane(t,"top")}}}}),g.length<2&&(e.height>=120&&Ve(d,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:h("Divide into two Lanes"),action:{click:m(2)}}}),e.height>=180&&Ve(d,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:h("Divide into three Lanes"),action:{click:m(3)}}})),Ve(d,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:h("Add Lane below"),action:{click:function(e,t){i.addLane(t,"bottom")}}}})}_s(u,"bpmn:FlowNode")&&(_s(u,"bpmn:EventBasedGateway")?Ve(d,{"append.receive-task":f("bpmn:ReceiveTask","bpmn-icon-receive-task",h("Append ReceiveTask")),"append.message-intermediate-event":f("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",h("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":f("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",h("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":f("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",h("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":f("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",h("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):fh(u,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?Ve(d,{"append.compensation-activity":f("bpmn:Task","bpmn-icon-task",h("Append compensation activity"),{isForCompensation:!0})}):_s(u,"bpmn:EndEvent")||u.isForCompensation||fh(u,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||Ns(u)||Ve(d,{"append.end-event":f("bpmn:EndEvent","bpmn-icon-end-event-none",h("Append EndEvent")),"append.gateway":f("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",h("Append Gateway")),"append.append-task":f("bpmn:Task","bpmn-icon-task",h("Append Task")),"append.intermediate-event":f("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",h("Append Intermediate/Boundary Event"))})),a.isEmpty(e,"bpmn-replace")||Ve(d,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:h("Change type"),action:{click:function(e,i){var n=Ve(function(e){var i=r.getContainer(),n=t.getPad(e).html,s=i.getBoundingClientRect(),o=n.getBoundingClientRect(),a=o.top-s.top;return{x:o.left-s.left,y:a+o.height+5}}(i),{cursor:{x:e.x,y:e.y}});a.open(i,"bpmn-replace",n)}}}}),ks(u,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&Ve(d,{"append.text-annotation":f("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:h("Connect using "+(u.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:p,dragstart:p}}}),_s(u,"bpmn:TextAnnotation")&&Ve(d,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:h("Connect using Association"),action:{click:p,dragstart:p}}}),ks(u,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&Ve(d,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:h("Connect using DataInputAssociation"),action:{click:p,dragstart:p}}}),_s(u,"bpmn:Group")&&Ve(d,{"append.text-annotation":f("bpmn:TextAnnotation","bpmn-icon-text-annotation")});var b=l.allowed("elements.delete",{elements:[e]});return oe(b)&&(b=b[0]===e),b&&Ve(d,{delete:{group:"edit",className:"bpmn-icon-trash",title:h("Remove"),action:{click:function(t){i.removeElements([e])}}}}),d};const mh={__depends__:[Ml,Nl,Zo,Rl,sc,Hc],__init__:["contextPadProvider"],contextPadProvider:["type",ph]};var gh={horizontal:["x","width"],vertical:["y","height"]};function bh(e){this._modeling=e,this._filters=[],this.registerFilter((function(e,t,i){var n,s=0,o=0;return pe(e,(function(e){e.waypoints||e.labelTarget||(s+=e[i],o+=1)})),n=Math.round(s/o),ue(e,(function(e){return e[i]<n+50}))}))}bh.$inject=["modeling"],bh.prototype.registerFilter=function(e){if("function"!=typeof e)throw new Error("the filter has to be a function");this._filters.push(e)},bh.prototype.trigger=function(e,t){var i,n,s=this._modeling;if(!(e.length<3||(this._setOrientation(t),n=this._filterElements(e),(i=this._createGroups(n)).length<=2)))return s.distributeElements(i,this._axis,this._dimension),i},bh.prototype._filterElements=function(e){var t=this._filters,i=this._axis,n=this._dimension,s=[].concat(e);return t.length?(pe(t,(function(e){s=e(s,i,n)})),s):e},bh.prototype._createGroups=function(e){var t=[],i=this,n=this._axis,s=this._dimension;if(!n)throw new Error('must have a defined "axis" and "dimension"');return pe(Ce(e,n),(function(e,o){var a,r=i._findRange(e,n,s),l=t[t.length-1];l&&i._hasIntersection(l.range,r)?t[t.length-1].elements.push(e):(a={range:r,elements:[e]},t.push(a))})),t},bh.prototype._setOrientation=function(e){var t=gh[e];this._axis=t[0],this._dimension=t[1]},bh.prototype._hasIntersection=function(e,t){return Math.max(e.min,e.max)>=Math.min(t.min,t.max)&&Math.min(e.min,e.max)<=Math.max(t.min,t.max)},bh.prototype._findRange=function(e){var t=e[this._axis];return{min:t+5,max:t+e[this._dimension]-5}};const vh={__init__:["distributeElements"],distributeElements:["type",bh]};function wh(e){e.registerFilter((function(e){return ue(e,(function(e){var t=ks(e,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:Participant","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(e.labelTarget||t)}))}))}wh.$inject=["distributeElements"];const yh={__depends__:[vh],__init__:["bpmnDistributeElements"],bpmnDistributeElements:["type",wh]};var Oh="is not a registered action";function xh(e,t){this._actions={};var i=this;e.on("diagram.init",(function(){i._registerDefaultActions(t),e.fire("editorActions.init",{editorActions:i})}))}function $h(e,t){return new Error(e+" "+t)}xh.$inject=["eventBus","injector"],xh.prototype._registerDefaultActions=function(e){var t=e.get("commandStack",!1),i=e.get("modeling",!1),n=e.get("selection",!1),s=e.get("zoomScroll",!1),o=e.get("copyPaste",!1),a=e.get("canvas",!1),r=e.get("rules",!1),l=e.get("keyboardMove",!1),c=e.get("keyboardMoveSelection",!1);t&&(this.register("undo",(function(){t.undo()})),this.register("redo",(function(){t.redo()}))),o&&n&&this.register("copy",(function(){var e=n.get();o.copy(e)})),o&&this.register("paste",(function(){o.paste()})),s&&this.register("stepZoom",(function(e){s.stepZoom(e.value)})),a&&this.register("zoom",(function(e){a.zoom(e.value)})),i&&n&&r&&this.register("removeSelection",(function(){var e=n.get();if(e.length){var t,s=r.allowed("elements.delete",{elements:e});!1!==s&&(t=oe(s)?s:e).length&&i.removeElements(t.slice())}})),l&&this.register("moveCanvas",(function(e){l.moveCanvas(e)})),c&&this.register("moveSelection",(function(e){c.moveSelection(e.direction,e.accelerated)}))},xh.prototype.trigger=function(e,t){if(!this._actions[e])throw $h(e,Oh);return this._actions[e](t)},xh.prototype.register=function(e,t){var i=this;if("string"==typeof e)return this._registerAction(e,t);pe(e,(function(e,t){i._registerAction(t,e)}))},xh.prototype._registerAction=function(e,t){if(this.isRegistered(e))throw $h(e,"is already registered");this._actions[e]=t},xh.prototype.unregister=function(e){if(!this.isRegistered(e))throw $h(e,Oh);this._actions[e]=void 0},xh.prototype.getActions=function(){return Object.keys(this._actions)},xh.prototype.isRegistered=function(e){return!!this._actions[e]};const Ch={__init__:["editorActions"],editorActions:["type",xh]};function Sh(e){e.invoke(xh,this)}G()(Sh,xh),Sh.$inject=["injector"],Sh.prototype._registerDefaultActions=function(e){xh.prototype._registerDefaultActions.call(this,e);var t=e.get("canvas",!1),i=e.get("elementRegistry",!1),n=e.get("selection",!1),s=e.get("spaceTool",!1),o=e.get("lassoTool",!1),a=e.get("handTool",!1),r=e.get("globalConnect",!1),l=e.get("distributeElements",!1),c=e.get("alignElements",!1),h=e.get("directEditing",!1),d=e.get("searchPad",!1),u=e.get("modeling",!1);t&&i&&n&&this._registerAction("selectElements",(function(){var e=t.getRootElement(),s=i.filter((function(t){return t!==e}));return n.select(s),s})),s&&this._registerAction("spaceTool",(function(){s.toggle()})),o&&this._registerAction("lassoTool",(function(){o.toggle()})),a&&this._registerAction("handTool",(function(){a.toggle()})),r&&this._registerAction("globalConnectTool",(function(){r.toggle()})),n&&l&&this._registerAction("distributeElements",(function(e){var t=n.get(),i=e.type;t.length&&l.trigger(t,i)})),n&&c&&this._registerAction("alignElements",(function(e){var t=n.get(),i=[],s=e.type;t.length&&(i=ue(t,(function(e){return!_s(e,"bpmn:Lane")})),c.trigger(i,s))})),n&&u&&this._registerAction("setColor",(function(e){var t=n.get();t.length&&u.setColor(t,e)})),n&&h&&this._registerAction("directEditing",(function(){var e=n.get();e.length&&h.activate(e[0])})),d&&this._registerAction("find",(function(){d.toggle()})),t&&u&&this._registerAction("moveToOrigin",(function(){var e,n,s=t.getRootElement();e=si(n=_s(s,"bpmn:Collaboration")?i.filter((function(e){return _s(e.parent,"bpmn:Collaboration")})):i.filter((function(e){return e!==s&&!_s(e.parent,"bpmn:SubProcess")}))),u.moveElements(n,{x:-e.x,y:-e.y},s)}))};const _h={__depends__:[Ch],editorActions:["type",Sh]};function kh(e){e.on(["create.init","shape.move.init"],(function(e){var t=e.context;ks(e.shape,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(t.gridSnappingContext||(t.gridSnappingContext={}),t.gridSnappingContext.snapLocation="top-left")}))}function Eh(e,t,i){return i||(i="round"),Math[i](e/t)*t}function Ph(e,t,i){var n=!i||!1!==i.active;this._eventBus=t;var s=this;t.on("diagram.init",800,(function(){s.setActive(n)})),t.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],1200,(function(t){var i=t.originalEvent;if(!(!s.active||i&&Oa(i))){var n=t.context,o=n.gridSnappingContext;o||(o=n.gridSnappingContext={}),["x","y"].forEach((function(i){var n={},o=function(e,t,i){var n=e.context,s=e.shape,o=n.gridSnappingContext,a=o.snapLocation,r=o.snapOffset;return r&&re(r[t])?r[t]:(r||(r=o.snapOffset={}),re(r[t])||(r[t]=0),s?(i.get(s.id)||(Ah(t)?r[t]+=s[t]+s.width/2:r[t]+=s[t]+s.height/2),a?("x"===t?/left/.test(a)?r[t]-=s.width/2:/right/.test(a)&&(r[t]+=s.width/2):/top/.test(a)?r[t]-=s.height/2:/bottom/.test(a)&&(r[t]+=s.height/2),r[t]):r[t]):r[t])}(t,i,e);o&&(n.offset=o);var a=function(e,t){var i=e.context,n=i.createConstraints,s=i.resizeConstraints||{},o=i.gridSnappingContext,a=o.snapConstraints;if(a&&a[t])return a[t];a||(a=o.snapConstraints={}),a[t]||(a[t]={});var r=i.direction;n&&(Ah(t)?(a.x.min=n.left,a.x.max=n.right):(a.y.min=n.top,a.y.max=n.bottom));var l=s.min,c=s.max;return l&&(Ah(t)?Dh(r)?a.x.max=l.left:a.x.min=l.right:Rh(r)?a.y.max=l.top:a.y.min=l.bottom),c&&(Ah(t)?Dh(r)?a.x.min=c.left:a.x.max=c.right:Rh(r)?a.y.min=c.top:a.y.max=c.bottom),a[t]}(t,i);a&&Ve(n,a),wl(t,i)||s.snapEvent(t,i,n)}))}}))}function Ah(e){return"x"===e}function Rh(e){return-1!==e.indexOf("n")}function Dh(e){return-1!==e.indexOf("w")}function Vh(e,t){ea.call(this,e),this._gridSnapping=t;var i=this;this.preExecute("shape.resize",(function(e){var t=e.context,n=(t.hints||{}).autoResize;if(n){var s=t.shape,o=t.newBounds;ce(n)?t.newBounds=i.snapComplex(o,n):t.newBounds=i.snapSimple(s,o)}}))}function Lh(e,t){e.on(["spaceTool.move","spaceTool.end"],2e3,(function(e){var i,n=e.context;n.initialized&&("x"===n.axis?(i=t.snapValue(e.dx),e.x=e.x+i-e.dx,e.dx=i):(i=t.snapValue(e.dy),e.y=e.y+i-e.dy,e.dy=i))}))}kh.$inject=["eventBus"],Ph.prototype.snapEvent=function(e,t,i){yl(e,t,this.snapValue(e[t],i))},Ph.prototype.getGridSpacing=function(){return 10},Ph.prototype.snapValue=function(e,t){var i,n,s=0;return t&&t.offset&&(s=t.offset),e=Eh(e+=s,10),t&&t.min&&re(i=t.min)&&(i=Eh(i+s,10,"ceil"),e=Math.max(e,i)),t&&t.max&&re(n=t.max)&&(n=Eh(n+s,10,"floor"),e=Math.min(e,n)),e-s},Ph.prototype.isActive=function(){return this.active},Ph.prototype.setActive=function(e){this.active=e,this._eventBus.fire("gridSnapping.toggle",{active:e})},Ph.prototype.toggleActive=function(){this.setActive(!this.active)},Ph.$inject=["elementRegistry","eventBus","config.gridSnapping"],Vh.$inject=["eventBus","gridSnapping","modeling"],Xt()(Vh,ea),Vh.prototype.snapSimple=function(e,t){var i=this._gridSnapping;return t.width=i.snapValue(t.width,{min:t.width}),t.height=i.snapValue(t.height,{min:t.height}),t.x=e.x+e.width/2-t.width/2,t.y=e.y+e.height/2-t.height/2,t},Vh.prototype.snapComplex=function(e,t){return/w|e/.test(t)&&(e=this.snapHorizontally(e,t)),/n|s/.test(t)&&(e=this.snapVertically(e,t)),e},Vh.prototype.snapHorizontally=function(e,t){var i=this._gridSnapping,n=/w/.test(t),s=/e/.test(t),o={};return o.width=i.snapValue(e.width,{min:e.width}),s&&(n?(o.x=i.snapValue(e.x,{max:e.x}),o.width+=i.snapValue(e.x-o.x,{min:e.x-o.x})):e.x=e.x+e.width-o.width),Ve(e,o),e},Vh.prototype.snapVertically=function(e,t){var i=this._gridSnapping,n=/n/.test(t),s=/s/.test(t),o={};return o.height=i.snapValue(e.height,{min:e.height}),n&&(s?(o.y=i.snapValue(e.y,{max:e.y}),o.height+=i.snapValue(e.y-o.y,{min:e.y-o.y})):e.y=e.y+e.height-o.height),Ve(e,o),e},Lh.$inject=["eventBus","gridSnapping"];const Th={__depends__:[{__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",Vh],gridSnappingSpaceToolBehavior:["type",Lh]}],__init__:["gridSnapping"],gridSnapping:["type",Ph]};function Bh(e,t){e.on("autoPlace",2e3,(function(e){var i=e.source,n=Ci(i),s=e.shape,o=wr(i,s);return["x","y"].forEach((function(e){var i={};o[e]!==n[e]&&(o[e]>n[e]?i.min=o[e]:i.max=o[e],_s(s,"bpmn:TextAnnotation")&&(function(e){return"x"===e}(e)?i.offset=-s.width/2:i.offset=-s.height/2),o[e]=t.snapValue(o[e],i))})),o}))}function Fh(e,t,i){t.on(["create.start","shape.move.start"],1750,(function(t){var n=t.context,s=n.shape,o=e.getRootElement();_s(s,"bpmn:Participant")&&_s(o,"bpmn:Process")&&o.children.length&&n.createConstraints&&(s.width=i.snapValue(s.width,{min:s.width}),s.height=i.snapValue(s.height,{min:s.height}))}))}function Ih(e,t,i){ea.call(this,e),this._gridSnapping=t;var n=this;this.postExecuted(["connection.create","connection.layout"],3e3,(function(e){var t=e.context,s=t.connection,o=t.hints||{},a=s.waypoints;o.connectionStart||o.connectionEnd||!1===o.createElementsBehavior||function(e){return e.length>3}(a)&&i.updateWaypoints(s,n.snapMiddleSegments(a))}))}function jh(e,t,i){var n=mi(t,i),s={};return function(e){return"h"===e}(n)&&(s.y=e.snapValue(t.y)),function(e){return"v"===e}(n)&&(s.x=e.snapValue(t.x)),("x"in s||"y"in s)&&(t=Ve({},t,s),i=Ve({},i,s)),[t,i]}Bh.$inject=["eventBus","gridSnapping"],Fh.$inject=["canvas","eventBus","gridSnapping"],Ih.$inject=["eventBus","gridSnapping","modeling"],G()(Ih,ea),Ih.prototype.snapMiddleSegments=function(e){var t,i=this._gridSnapping;e=e.slice();for(var n=1;n<e.length-2;n++)t=jh(i,e[n],e[n+1]),e[n]=t[0],e[n+1]=t[1];return e};const Mh={__depends__:[Th,{__init__:["gridSnappingAutoPlaceBehavior","gridSnappingCreateParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",Bh],gridSnappingCreateParticipantBehavior:["type",Fh],gridSnappingLayoutConnectionBehavior:["type",Ih]}],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",kh]};function Qh(e,t){this._interactionEvents=t;var i=this;e.on(["interactionEvents.createHit","interactionEvents.updateHit"],(function(e){var t=e.element,n=e.gfx;return _s(t,"bpmn:Lane")?i.createParticipantHit(t,n):_s(t,"bpmn:Participant")?Ws(t)?i.createParticipantHit(t,n):i.createDefaultHit(t,n):_s(t,"bpmn:SubProcess")?Ws(t)?i.createSubProcessHit(t,n):i.createDefaultHit(t,n):void 0}))}Qh.$inject=["eventBus","interactionEvents"],Qh.prototype.createDefaultHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createDefaultHit(e,t),!0},Qh.prototype.createParticipantHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:30,height:e.height}),!0},Qh.prototype.createSubProcessHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:e.width,height:30}),!0};const Wh={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",Qh]};function Nh(e){e.invoke(Aa,this)}G()(Nh,Aa),Nh.$inject=["injector"],Nh.prototype.registerBindings=function(e,t){function i(i,n){t.isRegistered(i)&&e.addListener(n)}Aa.prototype.registerBindings.call(this,e,t),i("selectElements",(function(i){var n=i.keyEvent;if(e.isKey(["a","A"],n)&&e.isCmd(n))return t.trigger("selectElements"),!0})),i("find",(function(i){var n=i.keyEvent;if(e.isKey(["f","F"],n)&&e.isCmd(n))return t.trigger("find"),!0})),i("spaceTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["s","S"],n)?(t.trigger("spaceTool"),!0):void 0})),i("lassoTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["l","L"],n)?(t.trigger("lassoTool"),!0):void 0})),i("handTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["h","H"],n)?(t.trigger("handTool"),!0):void 0})),i("globalConnectTool",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["c","C"],n)?(t.trigger("globalConnectTool"),!0):void 0})),i("directEditing",(function(i){var n=i.keyEvent;if(!e.hasModifier(n))return e.isKey(["e","E"],n)?(t.trigger("directEditing"),!0):void 0}))};const Zh={__depends__:[Ra],__init__:["keyboardBindings"],keyboardBindings:["type",Nh]};var qh={moveSpeed:1,moveSpeedAccelerated:10},zh="left",Uh="right",Xh="down",Gh={ArrowLeft:zh,Left:zh,ArrowUp:"up",Up:"up",ArrowRight:Uh,Right:Uh,ArrowDown:Xh,Down:Xh},Yh={left:function(e){return{x:-e,y:0}},up:function(e){return{x:0,y:-e}},right:function(e){return{x:e,y:0}},down:function(e){return{x:0,y:e}}};function Hh(e,t,i,n,s){var o=this;this._config=Ve({},qh,e||{}),t.addListener(1500,(function(e){var i=e.keyEvent,n=Gh[i.key];if(n&&!t.isCmd(i)){var s=t.isShift(i);return o.moveSelection(n,s),!0}})),this.moveSelection=function(e,t){var o=s.get();if(o.length){var a=this._config[t?"moveSpeedAccelerated":"moveSpeed"],r=Yh[e](a);n.allowed("elements.move",{shapes:o})&&i.moveElements(o,r)}}}Hh.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const Kh={__depends__:[Ra,Zo],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",Hh]};function Jh(e,t,i,n){this._dragging=n,this._rules=t;var s=this;e.on("resize.start",(function(e){var t,i,n;i=(t=e.context).resizeConstraints,n=t.minBounds,void 0===i&&(void 0===n&&(n=s.computeMinResizeBox(t)),t.resizeConstraints={min:xi(n)})})),e.on("resize.move",(function(e){var t={x:e.dx,y:e.dy};!function(e,t){var i,n=e.shape,o=e.direction,a=e.resizeConstraints;e.delta=t,i=function(e,t,i){var n=i.x,s=i.y,o={x:e.x,y:e.y,width:e.width,height:e.height};return-1!==t.indexOf("n")?(o.y=e.y+s,o.height=e.height-s):-1!==t.indexOf("s")&&(o.height=e.height+s),-1!==t.indexOf("e")?o.width=e.width+n:-1!==t.indexOf("w")&&(o.x=e.x+n,o.width=e.width-n),o}(n,o,t),e.newBounds=function(e,t){if(!t)return e;var i=xi(e);return $i({top:nh("top",i,t),right:nh("right",i,t),bottom:nh("bottom",i,t),left:nh("left",i,t)})}(i,a),e.canExecute=s.canResize(e)}(e.context,t)})),e.on("resize.end",(function(e){!function(e){var t=e.shape,n=e.canExecute,s=e.newBounds;if(n){if(!function(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}(t,s=yi(s)))return;i.resizeShape(t,s)}}(e.context)}))}function ed(e,t){var i=Ci(e),n=xi(e),s={x:i.x,y:i.y};return-1!==t.indexOf("n")?s.y=n.top:-1!==t.indexOf("s")&&(s.y=n.bottom),-1!==t.indexOf("e")?s.x=n.right:-1!==t.indexOf("w")&&(s.x=n.left),s}function td(e){return"n"===e||"s"===e?"resize-ns":"e"===e||"w"===e?"resize-ew":"nw"===e||"se"===e?"resize-nwse":"resize-nesw"}Jh.prototype.canResize=function(e){var t=this._rules,i=Le(e,["newBounds","shape","delta","direction"]);return t.allowed("shape.resize",i)},Jh.prototype.activate=function(e,t,i){var n,s,o=this._dragging;if("string"==typeof i&&(i={direction:i}),!(s=(n=Ve({shape:t},i)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");o.init(e,ed(t,s),"resize",{autoActivate:!0,cursor:td(s),data:{shape:t,context:n}})},Jh.prototype.computeMinResizeBox=function(e){var t,i,n,s,o,a,r,l=e.shape;return t=e.direction,i=l,n=e.minDimensions||{width:10,height:10},s=ah(l,e.childrenBoxPadding),o=xi(i),a={top:/n/.test(t)?o.bottom-n.height:o.top,left:/w/.test(t)?o.right-n.width:o.left,bottom:/s/.test(t)?o.top+n.height:o.bottom,right:/e/.test(t)?o.left+n.width:o.right},r=s?xi(s):a,$i({top:eh(a.top,r.top),left:eh(a.left,r.left),bottom:Jc(a.bottom,r.bottom),right:Jc(a.right,r.right)})},Jh.$inject=["eventBus","rules","modeling","dragging"];var id="djs-resizing",nd="resize-not-ok";function sd(e,t,i){e.on("resize.move",500,(function(e){var n,s,o,a;s=(n=e.context).shape,o=n.newBounds,(a=n.frame)||(a=n.frame=i.addFrame(s,t.getActiveLayer()),t.addMarker(s,id)),o.width>5&&ut(a,{x:o.x,width:o.width}),o.height>5&&ut(a,{y:o.y,height:o.height}),n.canExecute?bt(a).remove(nd):bt(a).add(nd)})),e.on("resize.cleanup",(function(e){var i,n;n=(i=e.context).shape,i.frame&&wt(i.frame),t.removeMarker(n,id)}))}sd.$inject=["eventBus","canvas","previewSupport"];var od=["n","w","s","e","nw","ne","se","sw"];function ad(e,t,i,n){this._resize=n,this._canvas=t;var s=this;e.on("selection.changed",(function(e){var t=e.newSelection;s.removeResizers(),1===t.length&&pe(t,Re(s.addResizer,s))})),e.on("shape.changed",(function(e){var t=e.element;i.isSelected(t)&&(s.removeResizers(),s.addResizer(t))}))}ad.prototype.makeDraggable=function(e,t,i){var n=this._resize;function s(t){Po(t)&&n.activate(t,e,i)}Ke.bind(t,"mousedown",s),Ke.bind(t,"touchstart",s)},ad.prototype._createResizer=function(e,t,i,n){var s=this._getResizersParent(),o=function(e){var t={x:0,y:0};return-1!==e.indexOf("e")?t.x=6:-1!==e.indexOf("w")&&(t.x=-6),-1!==e.indexOf("s")?t.y=6:-1!==e.indexOf("n")&&(t.y=-6),t}(n),a=St("g");bt(a).add("djs-resizer"),bt(a).add("djs-resizer-"+e.id),bt(a).add("djs-resizer-"+n),ct(s,a);var r=St("rect");ut(r,{x:-2+o.x,y:-2+o.y,width:4,height:4}),bt(r).add("djs-resizer-visual"),ct(a,r);var l=St("rect");return ut(l,{x:-10+o.x,y:-10+o.y,width:20,height:20}),bt(l).add("djs-resizer-hit"),ct(a,l),Ji(a,t,i),a},ad.prototype.createResizer=function(e,t){var i=ed(e,t),n=this._createResizer(e,i.x,i.y,t);this.makeDraggable(e,n,t)},ad.prototype.addResizer=function(e){var t=this;this._resize.canResize({shape:e})&&pe(od,(function(i){t.createResizer(e,i)}))},ad.prototype.removeResizers=function(){yt(this._getResizersParent())},ad.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},ad.$inject=["eventBus","canvas","selection","resize"];const rd={__depends__:[jr,Tr,Ul],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Jh],resizePreview:["type",sd],resizeHandles:["type",ad]};function ld(e,t){var i=t.create("bpmn:CategoryValue"),n=t.create("bpmn:Category",{categoryValue:[i]});return di(e.get("rootElements"),n),Es(n).$parent=e,Es(i).$parent=n,i}function cd(e,t,i,n,s,o,a){function r(e,t){(t||ks(e,["bpmn:Task","bpmn:TextAnnotation"])||hd(e))&&n.activate(e)}this._bpmnFactory=t,this._canvas=i,this._modeling=s,this._textRenderer=a,n.registerProvider(this),e.on("element.dblclick",(function(e){r(e.element,!0)})),e.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set"],(function(e){n.isActive()&&n.complete()})),e.on(["commandStack.changed"],(function(e){n.isActive()&&n.cancel()})),e.on("directEditing.activate",(function(e){o.removeResizers()})),e.on("create.end",500,(function(e){var t=e.context,i=t.shape,n=e.context.canExecute;e.isTouch||n&&(t.hints&&!1===t.hints.createElementsBehavior||r(i))})),e.on("autoPlace.end",500,(function(e){r(e.shape)}))}function hd(e){return _s(e,"bpmn:SubProcess")&&!Ws(e)}cd.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"],cd.prototype.activate=function(e){var t=zs(e);if(void 0!==t){var i={text:t};Ve(i,this.getEditingBBox(e));var n={};return(ks(e,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||hd(e))&&Ve(n,{centerVertically:!0}),mo(e)&&Ve(n,{autoResize:!0}),_s(e,"bpmn:TextAnnotation")&&Ve(n,{resizable:!0,autoResize:!0}),Ve(i,{options:n}),i}},cd.prototype.getEditingBBox=function(e){var t=this._canvas,i=e.label||e,n=t.getAbsoluteBBox(i),s=n.x+n.width/2,o=n.y+n.height/2,a={x:n.x,y:n.y},r=t.zoom(),l=this._textRenderer.getDefaultStyle(),c=this._textRenderer.getExternalStyle(),h=c.fontSize*r,d=c.lineHeight,u=l.fontSize*r,p=l.lineHeight,f={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};(_s(e,"bpmn:Lane")||function(e){return _s(e,"bpmn:Participant")&&Ws(e)}(e))&&(Ve(a,{width:n.height,height:30*r,x:n.x-n.height/2+15*r,y:o-30*r/2}),Ve(f,{fontSize:u+"px",lineHeight:p,paddingTop:7*r+"px",paddingBottom:7*r+"px",paddingLeft:5*r+"px",paddingRight:5*r+"px",transform:"rotate(-90deg)"})),(ks(e,["bpmn:Task","bpmn:CallActivity"])||function(e){return _s(e,"bpmn:Participant")&&!Ws(e)}(e)||hd(e))&&(Ve(a,{width:n.width,height:n.height}),Ve(f,{fontSize:u+"px",lineHeight:p,paddingTop:7*r+"px",paddingBottom:7*r+"px",paddingLeft:5*r+"px",paddingRight:5*r+"px"})),function(e){return _s(e,"bpmn:SubProcess")&&Ws(e)}(e)&&(Ve(a,{width:n.width,x:n.x}),Ve(f,{fontSize:u+"px",lineHeight:p,paddingTop:7*r+"px",paddingBottom:7*r+"px",paddingLeft:5*r+"px",paddingRight:5*r+"px"}));var m=90*r,g=7*r,b=4*r;if(i.labelTarget&&(Ve(a,{width:m,height:n.height+g+b,x:s-m/2,y:n.y-g}),Ve(f,{fontSize:h+"px",lineHeight:d,paddingTop:g+"px",paddingBottom:b+"px"})),mo(i)&&!go(i)&&!vo(i)){var v=bo(e),w=t.getAbsoluteBBox({x:v.x,y:v.y,width:0,height:0}),y=h+g+b;Ve(a,{width:m,height:y,x:w.x-m/2,y:w.y-y/2}),Ve(f,{fontSize:h+"px",lineHeight:d,paddingTop:g+"px",paddingBottom:b+"px"})}return _s(e,"bpmn:TextAnnotation")&&(Ve(a,{width:n.width,height:n.height,minWidth:30*r,minHeight:10*r}),Ve(f,{textAlign:"left",paddingTop:5*r+"px",paddingBottom:7*r+"px",paddingLeft:7*r+"px",paddingRight:5*r+"px",fontSize:u+"px",lineHeight:p})),{bounds:a,style:f}},cd.prototype.update=function(e,t,i,n){var s,o,a;if(_s(e,"bpmn:TextAnnotation")&&(o=this._canvas.getAbsoluteBBox(e),s={x:e.x,y:e.y,width:e.width/o.width*n.width,height:e.height/o.height*n.height}),_s(e,"bpmn:Group")&&!Es(e).categoryValueRef){var r=ld(Es(this._canvas.getRootElement()).$parent,this._bpmnFactory);Es(e).categoryValueRef=r}(a=t)&&a.trim()||(t=null),this._modeling.updateLabel(e,t,s)};var dd="djs-element-hidden",ud="djs-label-hidden";function pd(e,t,i,n){var s,o,a,r=this,l=t.getDefaultLayer();e.on("directEditing.activate",(function(e){var i=e.active;if(_s(s=i.element.label||i.element,"bpmn:TextAnnotation")){o=t.getAbsoluteBBox(s),a=St("g");var c=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:s.width,containerHeight:s.height,position:{mx:0,my:0}}),h=r.path=St("path");ut(h,{d:c,strokeWidth:2,stroke:fd(s)}),ct(a,h),ct(l,a),en(a,s.x,s.y)}_s(s,"bpmn:TextAnnotation")||s.labelTarget?t.addMarker(s,dd):(_s(s,"bpmn:Task")||_s(s,"bpmn:CallActivity")||_s(s,"bpmn:SubProcess")||_s(s,"bpmn:Participant"))&&t.addMarker(s,ud)})),e.on("directEditing.resize",(function(e){if(_s(s,"bpmn:TextAnnotation")){var t=e.height,i=e.dy,a=Math.max(s.height/o.height*(t+i),0),l=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:s.width,containerHeight:a,position:{mx:0,my:0}});ut(r.path,{d:l})}})),e.on(["directEditing.complete","directEditing.cancel"],(function(e){var i=e.active;i&&(t.removeMarker(i.element.label||i.element,dd),t.removeMarker(s,ud)),s=void 0,o=void 0,a&&(wt(a),a=void 0)}))}function fd(e,t){return Ps(e).get("stroke")||t||"black"}pd.$inject=["eventBus","canvas","elementRegistry","pathMap"];const md={__depends__:[Jo,rd,Ml],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",cd],labelEditingPreview:["type",pd]};var gd=["top","bottom","left","right"];function bd(e,t){function i(e){if(go(e)){var i=function(e){var t=Ci(e.label),i=vd(Ci(e),t);if(n=i,-1!==gd.indexOf(n)){var n,s=function(e){var t=Ci(e);return[].concat(e.incoming.map((function(e){return e.waypoints[e.waypoints.length-2]})),e.outgoing.map((function(e){return e.waypoints[1]}))).map((function(e){return vd(t,e)}))}(e);if(e.host){var o=function(e){var t,i=e.host,n=Si(Ci(e),i);return t=n.indexOf("-")>=0?n.split("-"):[n],gd.filter((function(e){return-1===t.indexOf(e)}))}(e);s=s.concat(o)}var a=gd.filter((function(e){return-1===s.indexOf(e)}));if(-1===a.indexOf(i))return a[0]}}(e);i&&function(e,i){var n=Ci(e),s=e.label,o=Ci(s);if(s.parent){var a,r=xi(e);switch(i){case"top":a={x:n.x,y:r.top-10-s.height/2};break;case"left":a={x:r.left-10-s.width/2,y:n.y};break;case"bottom":a={x:n.x,y:r.bottom+10+s.height/2};break;case"right":a={x:r.right+10+s.width/2,y:n.y}}var l=Ma(a,o);t.moveShape(s,l)}}(e,i)}}ea.call(this,e),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],(function(e){var t=e.context,n=t.connection,s=n.source,o=n.target;!1!==(t.hints||{}).createElementsBehavior&&(i(s),i(o))})),this.postExecuted(["label.create"],(function(e){var t=e.context,n=t.shape;!1!==(t.hints||{}).createElementsBehavior&&i(n.labelTarget)})),this.postExecuted(["elements.create"],(function(e){var t=e.context,n=t.elements;!1!==(t.hints||{}).createElementsBehavior&&n.forEach((function(e){i(e)}))}))}function vd(e,t){return Si(t,e,5)}function wd(e,t,i){ea.call(this,e),this.preExecute("shape.append",(function(e){var t=e.source,i=e.shape;e.position||(_s(i,"bpmn:TextAnnotation")?e.position={x:t.x+t.width/2+75,y:t.y-50-i.height/2}:e.position={x:t.x+t.width+80+i.width/2,y:t.y+t.height/2})}),!0)}function yd(e,t){e.invoke(ea,this),this.postExecute("shape.move",(function(e){var i=e.newParent,n=e.shape;pe(ue(n.incoming.concat(n.outgoing),(function(e){return _s(e,"bpmn:Association")})),(function(e){t.moveConnection(e,{x:0,y:0},i)}))}),!0)}function Od(e,t){t.invoke(ea,this),this._bpmnReplace=e;var i=this;this.postExecuted("elements.create",500,(function(e){var t=e.elements;1===(t=t.filter((function(e){return xd(e,e.host)}))).length&&t.map((function(e){return t.indexOf(e)})).forEach((function(n){var s=t[n];e.elements[n]=i.replaceShape(t[n],s)}))}),!0),this.preExecute("elements.move",500,(function(e){var t=e.shapes,n=e.newHost;if(1===t.length){var s=t[0];xd(s,n)&&(e.shapes=[i.replaceShape(s,n)])}}),!0)}function xd(e,t){return!vo(e)&&ks(e,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!t}function $d(e,t,i){function n(e){return ue(e.attachers,(function(e){return _s(e,"bpmn:BoundaryEvent")}))}ea.call(this,e),this.postExecute("connection.create",(function(e){var t=e.context.source,s=e.context.target,o=n(s);_s(t,"bpmn:EventBasedGateway")&&_s(s,"bpmn:ReceiveTask")&&o.length>0&&i.removeElements(o)})),this.postExecute("connection.reconnect",(function(e){var t=e.context.oldSource,s=e.context.newSource;_s(t,"bpmn:Gateway")&&_s(s,"bpmn:EventBasedGateway")&&pe(s.outgoing,(function(e){var t=e.target,s=n(t);_s(t,"bpmn:ReceiveTask")&&s.length>0&&i.removeElements(s)}))})),e.on("moddleCopy.canCopyProperty",2e3,(function(e){var i=e.parent,n=e.property,s=e.propertyName,o=t.getPropertyDescriptor(i,s);o&&o.isReference&&_s(n,"bpmn:RootElement")&&i.set(s,n)}))}function Cd(e){e.invoke(ea,this),this.preExecute("shape.create",1500,(function(e){var t=e.context,i=t.parent,n=t.shape;_s(i,"bpmn:Lane")&&!_s(n,"bpmn:Lane")&&(t.parent=Kc(i,"bpmn:Participant"))}))}function Sd(e,t,i){ea.call(this,e),this.preExecute("shape.create",(function(e){var i=e.context.shape;if(_s(i,"bpmn:DataObjectReference")&&"label"!==i.type){var n=t.create("bpmn:DataObject");i.businessObject.dataObjectRef=n}}))}G()(bd,ea),bd.$inject=["eventBus","modeling"],G()(wd,ea),wd.$inject=["eventBus","elementFactory","bpmnRules"],G()(yd,ea),yd.$inject=["injector","modeling"],Od.$inject=["bpmnReplace","injector"],G()(Od,ea),Od.prototype.replaceShape=function(e,t){var i,n=(i=Es(e).eventDefinitions)&&i[0],s={type:"bpmn:BoundaryEvent",host:t};return n&&(s.eventDefinitionType=n.$type),this._bpmnReplace.replaceElement(e,s,{layoutConnection:!1})},$d.$inject=["eventBus","moddle","modeling"],G()($d,ea),Cd.$inject=["injector"],G()(Cd,ea),Sd.$inject=["eventBus","bpmnFactory","moddle"],G()(Sd,ea);var _d=2e3;function kd(e,t,i){function n(){var t=e.getRootElement();return _s(t,"bpmn:Collaboration")?t:i.makeCollaboration()}ea.call(this,t),t.on(["create.start","shape.move.start"],_d,(function(t){var i=t.context,n=i.shape,s=e.getRootElement();if(_s(n,"bpmn:Participant")&&_s(s,"bpmn:Process")&&s.children.length){var o=s.children.filter((function(e){return!_s(e,"bpmn:Group")&&!vo(e)&&!function(e){return!!e.waypoints}(e)}));if(o.length){var a=si(o),r=function(e,t){t={width:t.width+40+30,height:t.height+40};var i=Math.max(e.width,t.width),n=Math.max(e.height,t.height);return{x:-i/2,y:-n/2,width:i,height:n}}(n,a);Ve(n,r),i.createConstraints=function(e,t){return{bottom:(t=xi(t)).top+e.height/2-20,left:t.right-e.width/2+20,top:t.bottom-e.height/2+20,right:t.left+e.width/2-20-30}}(n,a)}}})),t.on("create.start",_d,(function(i){var n=i.context.shape,s=e.getRootElement(),o=e.getGraphics(s);function a(e){e.element=s,e.gfx=o}_s(n,"bpmn:Participant")&&_s(s,"bpmn:Process")&&(t.on("element.hover",_d,a),t.once("create.cleanup",(function(){t.off("element.hover",a)})))})),this.preExecute("elements.create",_d,(function(e){var t,i=e.elements,s=e.parent,o=function(e){return de(e,(function(e){return _s(e,"bpmn:Participant")}))}(i);o&&_s(s,"bpmn:Process")&&(e.parent=n(),(t=e.hints=e.hints||{}).participant=o,t.process=s,t.processRef=Es(o).get("processRef"))}),!0),this.preExecute("shape.create",(function(e){var t=e.parent,i=e.shape;_s(i,"bpmn:Participant")&&_s(t,"bpmn:Process")&&(e.parent=n(),e.process=t,e.processRef=Es(i).get("processRef"))}),!0),this.execute("shape.create",(function(e){var t=e.hints||{},i=e.process||t.process,n=e.shape,s=t.participant;!i||s&&n!==s||Es(n).set("processRef",Es(i))}),!0),this.revert("shape.create",(function(e){var t=e.hints||{},i=e.process||t.process,n=e.processRef||t.processRef,s=e.shape,o=t.participant;!i||o&&s!==o||Es(s).set("processRef",n)}),!0),this.postExecute("shape.create",(function(e){var t=e.hints||{},n=e.process||e.hints.process,s=e.shape,o=t.participant;if(n){var a=n.children.slice();o?s===o&&i.moveElements(a,{x:0,y:0},o):i.moveElements(a,{x:0,y:0},s)}}),!0)}kd.$inject=["canvas","eventBus","modeling"],G()(kd,ea);var Ed="__targetRef_placeholder";function Pd(e,t){function i(e,i){var n=e.get("properties"),s=de(n,(function(e){return e.name===Ed}));return!s&&i&&di(n,s=t.create("bpmn:Property",{name:Ed})),s}function n(e,t){var n=i(e);n&&(function(e,t,i){return de(e.get("dataInputAssociations"),(function(e){return e!==i&&e.targetRef===t}))}(e,n,t)||hi(e.get("properties"),n))}function s(e){var t,s=e.context,o=s.connection,a=o.businessObject,r=o.target,l=r&&r.businessObject,c=s.newTarget,h=c&&c.businessObject,d=s.oldTarget||s.target,u=d&&d.businessObject,p=o.businessObject;u&&u!==l&&n(u,a),h&&h!==l&&n(h,a),l?(t=i(l,!0),p.targetRef=t):p.targetRef=null}ea.call(this,e),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],Ad(s)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],Ad(s))}function Ad(e){return function(t){if(_s(t.context.connection,"bpmn:DataInputAssociation"))return e(t)}}function Rd(e){this._bpmnUpdater=e}function Dd(e,t,i,n){function s(e){return e.children.filter((function(e){return _s(e,"bpmn:DataStoreReference")&&!e.labelTarget}))}function o(e,n){var s=e.businessObject||e;if(n=n||i.filter((function(e){return _s(e,"bpmn:Participant")&&Es(e).processRef}))[0]){var o=n.businessObject||n;t.execute("dataStore.updateContainment",{dataStoreBo:s,dataStoreDi:Ps(e),newSemanticParent:o.processRef||o,newDiParent:Ps(n)})}}ea.call(this,n),t.registerHandler("dataStore.updateContainment",Rd),this.preExecute("shape.create",(function(e){var t=e.context,i=t.shape;_s(i,"bpmn:DataStoreReference")&&"label"!==i.type&&(t.hints||(t.hints={}),t.hints.autoResize=!1)})),this.preExecute("elements.move",(function(e){var t=e.context,i=t.shapes;i.filter((function(e){return _s(e,"bpmn:DataStoreReference")})).length&&(t.hints||(t.hints={}),t.hints.autoResize=i.filter((function(e){return!_s(e,"bpmn:DataStoreReference")})))})),this.postExecute("shape.create",(function(e){var t=e.context.shape,i=t.parent;_s(t,"bpmn:DataStoreReference")&&"label"!==t.type&&_s(i,"bpmn:Collaboration")&&o(t)})),this.postExecute("shape.move",(function(e){var t=e.context,i=t.shape,n=t.oldParent,s=i.parent;_s(n,"bpmn:Collaboration")||_s(i,"bpmn:DataStoreReference")&&"label"!==i.type&&_s(s,"bpmn:Collaboration")&&o(i,_s(n,"bpmn:Participant")?n:function(e,t){for(;e.parent;){if(_s(e.parent,"bpmn:Participant"))return e.parent;e=e.parent}}(n))})),this.postExecute("shape.delete",(function(t){var i=t.context.shape,n=e.getRootElement();ks(i,["bpmn:Participant","bpmn:SubProcess"])&&_s(n,"bpmn:Collaboration")&&s(n).filter((function(e){return function(e,t){for(var i=e.businessObject||e,n=t.businessObject||t;i.$parent;){if(i.$parent===n.processRef||n)return!0;i=i.$parent}return!1}(e,i)})).forEach((function(e){o(e)}))})),this.postExecute("canvas.updateRoot",(function(e){var t=e.context,i=t.oldRoot,n=t.newRoot;s(i).forEach((function(e){_s(n,"bpmn:Process")&&o(e,n)}))}))}function Vd(e,t,i){ea.call(this,e),this.postExecuted("shape.delete",500,(function(e){var t=e.context,n=t.hints,s=t.shape,o=t.oldParent;_s(s,"bpmn:Lane")&&(n&&n.nested||function(e,t){var n,s,o,a=dh(t),r=[],l=[];ii(a,(function(t){return t.y>e.y?l.push(t):r.push(t),t.children})),a.length&&(n=l.length&&r.length?e.height/2:e.height,r.length&&(s=i.calculateAdjustments(r,"y",n,e.y-10),i.makeSpace(s.movingShapes,s.resizingShapes,{x:0,y:n},"s")),l.length&&(o=i.calculateAdjustments(l,"y",-n,e.y+e.height+10),i.makeSpace(o.movingShapes,o.resizingShapes,{x:0,y:-n},"n")))}(s,o))}))}function Ld(e,t){t.invoke(ea,this),this._bpmnReplace=e;var i=this;this.postExecuted("elements.create",500,(function(e){var t=e.elements;t.filter((function(e){return Td(e,e.host)})).map((function(e){return t.indexOf(e)})).forEach((function(n){e.elements[n]=i.replaceShape(t[n])}))}),!0),this.preExecute("elements.move",500,(function(e){var t=e.shapes,n=e.newHost;t.forEach((function(e,s){var o,a=e.host;Td(e,(o=a,-1!==t.indexOf(o)?a:n))&&(t[s]=i.replaceShape(e))}))}),!0)}function Td(e,t){return!vo(e)&&_s(e,"bpmn:BoundaryEvent")&&!t}function Bd(e,t,i){function n(e,n,s){var o,a,r,l,c,h,d,u,p=n.waypoints,f=e.outgoing.slice(),m=e.incoming.slice(),g=Wr(p,u=re(s.width)?Ci(s):s);if(g){if(o=p.slice(0,g.index),a=p.slice(g.index+(g.bendpoint?1:0)),!o.length||!a.length)return;r=g.bendpoint?p[g.index]:u,1!==o.length&&Fd(e,o[o.length-1])||o.push(Id(r)),1!==a.length&&Fd(e,a[0])||a.unshift(Id(r))}l=n.source,c=n.target,t.canConnect(l,e,n)&&(i.reconnectEnd(n,e,o||u),h=n),t.canConnect(e,c,n)&&(h?d=i.connect(e,c,{type:n.type,waypoints:a}):(i.reconnectStart(n,e,a||u),d=n));var b=[].concat(h&&ue(m,(function(e){return e.source===h.source}))||[],d&&ue(f,(function(e){return e.target===d.target}))||[]);b.length&&i.removeElements(b)}ea.call(this,e),this.preExecute("elements.move",(function(e){var i=e.newParent,n=e.shapes,s=e.delta,o=n[0];if(o&&i){i&&i.waypoints&&(e.newParent=i=i.parent);var a=Ci(o),r={x:a.x+s.x,y:a.y+s.y},l=de(i.children,(function(e){return t.canInsert(n,e)&&Wr(e.waypoints,r)}));l&&(e.targetFlow=l,e.position=r)}}),!0),this.postExecuted("elements.move",(function(e){var t=e.shapes,i=e.targetFlow,s=e.position;i&&n(t[0],i,s)}),!0),this.preExecute("shape.create",(function(e){var i=e.parent,n=e.shape;t.canInsert(n,i)&&(e.targetFlow=i,e.parent=i.parent)}),!0),this.postExecuted("shape.create",(function(e){var t=e.shape,i=e.targetFlow,s=e.position;i&&n(t,i,s)}),!0)}function Fd(e,t){var i=t.x,n=t.y;return i>=e.x&&i<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function Id(e){return Ve({},e)}function jd(e,t){ea.call(this,e),this.preExecuted("connection.create",(function(e){var i=e.context,n=i.source,s=i.target,o=s.incoming.slice();i.hints&&!1===i.hints.createElementsBehavior||_s(n,"bpmn:EventBasedGateway")&&s.incoming.length&&o.filter(Md).forEach((function(e){t.removeConnection(e)}))})),this.preExecuted("shape.replace",(function(e){var i=e.context.newShape;_s(i,"bpmn:EventBasedGateway")&&i.outgoing.filter(Md).map((function(e){return e.target})).reduce((function(e,t){var i=t.incoming.filter(Md);return e.concat(i)}),[]).forEach((function(e){e.source!==i&&t.removeConnection(e)}))}))}function Md(e){return _s(e,"bpmn:SequenceFlow")}Pd.$inject=["eventBus","bpmnFactory"],G()(Pd,ea),Rd.$inject=["bpmnUpdater"],Rd.prototype.execute=function(e){var t=e.dataStoreBo,i=e.dataStoreDi,n=e.newSemanticParent,s=e.newDiParent;e.oldSemanticParent=t.$parent,e.oldDiParent=i.$parent,this._bpmnUpdater.updateSemanticParent(t,n),this._bpmnUpdater.updateDiParent(i,s)},Rd.prototype.revert=function(e){var t=e.dataStoreBo,i=e.dataStoreDi,n=e.oldSemanticParent,s=e.oldDiParent;this._bpmnUpdater.updateSemanticParent(t,n),this._bpmnUpdater.updateDiParent(i,s)},Dd.$inject=["canvas","commandStack","elementRegistry","eventBus"],G()(Dd,ea),Vd.$inject=["eventBus","modeling","spaceTool"],G()(Vd,ea),Ld.$inject=["bpmnReplace","injector"],G()(Ld,ea),Ld.prototype.replaceShape=function(e){var t,i,n=(i=Es(e).eventDefinitions)&&i[0];return t=n?{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:n.$type}:{type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(e,t,{layoutConnection:!1})},G()(Bd,ea),Bd.$inject=["eventBus","bpmnRules","modeling"],jd.$inject=["eventBus","modeling"],G()(jd,ea);var Qd=1500;function Wd(e,t,i){t.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],Qd,(function(t){var n=t.context.shape||t.shape,s=t.hover;_s(s,"bpmn:Lane")&&!ks(n,["bpmn:Lane","bpmn:Participant"])&&(t.hover=uh(s),t.hoverGfx=e.getGraphics(t.hover));var o=i.getRootElement();s!==o&&(n.labelTarget||_s(n,"bpmn:Group"))&&(t.hover=o,t.hoverGfx=e.getGraphics(t.hover))})),t.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],Qd,(function(t){var i=t.hover;_s(i,"bpmn:Lane")&&(t.hover=uh(i)||i,t.hoverGfx=e.getGraphics(t.hover))})),t.on(["bendpoint.move.hover"],Qd,(function(t){var i=t.context,n=t.hover,s=i.type;_s(n,"bpmn:Lane")&&/reconnect/.test(s)&&(t.hover=uh(n)||n,t.hoverGfx=e.getGraphics(t.hover))})),t.on(["connect.start"],Qd,(function(e){var t=e.context,i=t.start;_s(i,"bpmn:Lane")&&(t.start=uh(i)||i)})),t.on("shape.move.start",2e3,(function(e){var t=e.shape;_s(t,"bpmn:Lane")&&(e.shape=uh(t)||t)}))}function Nd(e,t,i,n,s,o){function a(e){var i=Es(e).categoryValueRef;if(i){var n=i.$parent;i&&(hi(n.categoryValue,i),n&&!n.categoryValue.length&&function(e){hi(t.getDefinitions().get("rootElements"),e)}(n))}}s.invoke(ea,this),this.executed("shape.delete",(function(e){var t,n=e.context.shape;if(_s(n,"bpmn:Group")){var s=Es(n).categoryValueRef,o=i.filter((function(e){return _s(e,"bpmn:Group")}));t=s,o.some((function(e){var i=Es(e);return i.categoryValueRef&&i.categoryValueRef===t}))||a(n)}})),this.reverted("shape.delete",(function(e){var i=e.context.shape;if(_s(i,"bpmn:Group")){var n=Es(i).categoryValueRef,s=t.getDefinitions(),o=n?n.$parent:null;di(o.get("categoryValue"),n),di(s.get("rootElements"),o)}})),this.execute("shape.create",(function(i){var n=Es(i.context.shape);if(_s(n,"bpmn:Group")&&!n.categoryValueRef){var s=ld(t.getDefinitions(),e);n.categoryValueRef=s}})),this.revert("shape.create",(function(e){var t=e.context.shape;_s(t,"bpmn:Group")&&(a(t),delete Es(t).categoryValueRef)})),n.on("moddleCopy.canCopyProperty",2e3,(function(i){var n,s=i.property;if(_s(s,"bpmn:CategoryValue"))return n=ld(t.getDefinitions(),e),o.copyElement(s,n)}))}function Zd(e,t,i,n){var s,o,a,r;return 0==(s=(n.y-i.y)*(t.x-e.x)-(n.x-i.x)*(t.y-e.y))?null:(o=e.y-i.y,a=e.x-i.x,r=((n.x-i.x)*o-(n.y-i.y)*a)/s,{x:Math.round(e.x+r*(t.x-e.x)),y:Math.round(e.y+r*(t.y-e.y))})}function qd(e){function t(e,t,i){var n,s={x:i.x,y:i.y-50},o={x:i.x-50,y:i.y},a=Zd(e,t,i,s),r=Zd(e,t,i,o);n=a&&r?zd(a,i)>zd(r,i)?r:a:a||r,e.original=n}e.on("bpmnElement.added",(function(e){var i,n,s=e.element;s.waypoints&&(t((n=(i=s).waypoints)[0],n[1],Ci(i.source)),t(n[n.length-1],n[n.length-2],Ci(i.target)))}))}function zd(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ud(e){ea.call(this,e);var t=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],(function(e){var i=e.context.shape,n=Es(i),s=Ps(i);ks(n,t)&&!s.get("isHorizontal")&&s.set("isHorizontal",!0)}))}function Xd(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Gd(e){return Math.atan((e[1].y-e[0].y)/(e[1].x-e[0].x))}function Yd(e,t){var i=t[0],n=t[1],s={x:n.x-i.x,y:n.y-i.y},o=function(e,t,i){var n=[{n:e[0]-i[0],lambda:t[0]},{n:e[1]-i[1],lambda:t[1]}];return-(n[0].n*t[0]+n[1].n*t[1])/(n[0].lambda*t[0]+n[1].lambda*t[1])}([i.x,i.y],[s.x,s.y],[e.x,e.y]);return{x:i.x+o*s.x,y:i.y+o*s.y}}function Hd(e,t){var i=Yd(e,t);return Xd({x:i.x-e.x,y:i.y-e.y})}function Kd(e,t){return Xd({x:e.x-t.x,y:e.y-t.y})}Wd.$inject=["elementRegistry","eventBus","canvas"],Nd.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"],G()(Nd,ea),qd.$inject=["eventBus"],Ud.$inject=["eventBus"],G()(Ud,ea);var Jd=Math.sqrt,eu=Math.min,tu=Math.max,iu=Math.abs;function nu(e){return Math.pow(e,2)}function su(e,t){return Jd(nu(e.x-t.x)+nu(e.y-t.y))}function ou(e,t,i,n){var s=t.x-e.x,o=t.y-e.y,a=i.x-e.x,r=i.y-e.y,l=s*s+o*o,c=(s*a+o*r)/l,h=c*c-(a*a+r*r-n*n)/l;if(h<0&&h>-1e-6&&(h=0),h<0)return[];var d=Jd(h),u=-c+d,p=-c-d,f={x:e.x-s*u,y:e.y-o*u};return 0===h?[f]:[f,{x:e.x-s*p,y:e.y-o*p}].filter((function(i){return function(e,t,i){return au(e.x,t.x,i.x)&&au(e.y,t.y,i.y)}(i,e,t)}))}function au(e,t,i){return e>=eu(t,i)-ru&&e<=tu(t,i)+ru}var ru=.1;function lu(e,t){return iu(e.x-t.x)<=ru&&iu(e.y-t.y)<=ru}function cu(e,t){var i=Kd(e[t-1],e[t]);return i/(i+Kd(e[t],e[t+1]))}function hu(e,t){return[e[t],e[t+1]]}function du(e,t,i){var n=ja(t),s=ja(i),o=Ma(e,n),a=o.x*(i.width/t.width),r=o.y*(i.height/t.height);return Oi({x:s.x+a,y:s.y+r})}function uu(e,t,i){var n=ja(e),s=ja(t),o=ja(i),a=Ma(e,n),r=Ma(n,s),l=function(e,t,i){var n=xi(t),s=xi(i);if(function(e,t){return function(e,t){return e.right!==t.right&&e.left!==t.left}(e,t)||function(e,t){return e.top!==t.top&&e.bottom!==t.bottom}(e,t)}(n,s))return null;var o,a=Si(t,e);if("top"===a)o={x:0,y:s.bottom-n.bottom};else if("bottom"===a)o={x:0,y:s.top-n.top};else if("right"===a)o={x:s.left-n.left,y:0};else{if("left"!==a)return null;o={x:s.right-n.right,y:0}}return Si(i,{x:e.x+o.x,y:e.y+o.y})!==a?null:o}(n,t,i);if(l)return l;var c=r.x*(i.width/t.width),h=r.y*(i.height/t.height),d=o.x+c,u=o.y+h;return Oi({x:d+a.x-e.x,y:u+a.y-e.y})}var pu={width:90,height:20};function fu(e,t,i,n){ea.call(this,e),this.postExecute("element.updateProperties",(function(e){var i=e.context,s=i.element,o=i.properties;if("name"in o&&t.updateLabel(s,o.name),"text"in o&&_s(s,"bpmn:TextAnnotation")){var a=n.getTextAnnotationBounds({x:s.x,y:s.y,width:s.width,height:s.height},o.text||"");t.updateLabel(s,o.text,a)}})),this.postExecute(["shape.create","connection.create"],(function(e){var i=e.context;if(!1!==(i.hints||{}).createElementsBehavior){var s=i.shape||i.connection,o=s.businessObject;if(!vo(s)&&mo(s)&&zs(s)){var a=bo(s),r=n.getExternalLabelBounds(pu,zs(s));t.createLabel(s,a,{id:o.id+"_label",businessObject:o,width:r.width,height:r.height})}}})),this.postExecute("shape.delete",(function(e){var i=e.context,n=i.labelTarget,s=i.hints||{};n&&!1!==s.unsetLabel&&t.updateLabel(n,null,null,{removeShape:!1})})),this.postExecute(["label.create"],(function(e){var t,n=e.context,s=n.shape,o=n.labelTarget;o&&_s(o,"bpmn:BaseElement")&&((t=Ps(o)).label||(t.label=i.create("bpmndi:BPMNLabel",{bounds:i.create("dc:Bounds")}),s.di=t),Ve(t.label.bounds,{x:s.x,y:s.y,width:s.width,height:s.height}))})),this.postExecute(["connection.layout","connection.updateWaypoints"],(function(e){var i=e.context;if(!1!==(i.hints||{}).labelBehavior){var n,s=i.connection.label;s&&s.parent&&(n=function(e){var t=e.context,i=t.connection,n=i.label,s=Ve({},t.hints),o=t.newWaypoints||i.waypoints,a=t.oldWaypoints;return void 0===s.startChanged&&(s.startChanged=!!s.connectionStart),void 0===s.endChanged&&(s.endChanged=!!s.connectionEnd),function(e,t,i,n){var s=0,o=0,a=function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}(e),r=function(e,t){var i,n,s,o,a,r,l,c,h,d,u,p,f=0;for(f=0;f<t.length-1;f++){if(lu(i=t[f],n=t[f+1])?r=[i]:(s=su(e,i),o=su(e,n),r=ou(i,n,e,eu(s,o))),r.length<1)throw new Error("expected between [1, 2] circle -> line intersections");1===r.length&&(l={type:"bendpoint",position:r[0],segmentIndex:f,bendpointIndex:lu(i,r[0])?f:f+1}),2===r.length&&(u=r[0],p=r[1],l={type:"segment",position:a={x:(u.x+p.x)/2,y:(u.y+p.y)/2},segmentIndex:f,relativeLocation:su(i,a)/su(i,n)}),c=su(l.position,e),(!d||h>c)&&(d=l,h=c)}return d}(a,i),l=r.segmentIndex,c=function(e,t,i,n){var s=i.segmentIndex,o=t.length-e.length;if(n.segmentMove){var a=n.segmentMove.segmentStartIndex,r=n.segmentMove.newSegmentStartIndex;return s===a?r:s>=r?s+o<r?r:s+o:s}if(n.bendpointMove){var l,c=n.bendpointMove.insert,h=n.bendpointMove.bendpointIndex;return 0===o?s:(s>=h&&(l=c?s+1:s-1),s<h&&(l=s,c&&"bendpoint"!==i.type&&h-1===s&&cu(t,h)<i.relativeLocation&&l++),l)}return 0===o?s:n.connectionStart?0===s?0:null:n.connectionEnd&&s===e.length-2?t.length-2:null}(i,t,r,n);if(null===c)return{x:s,y:o};if(c<0||c>t.length-2)return{x:s,y:o};var h,d,u,p,f,m,g=hu(i,l),b=hu(t,c),v=r.position,w=(p=v,f=Kd((u=g)[0],u[1]),m=Kd(u[0],p),0===f?0:m/f),y=(h=b,d=Gd(g),Gd(h)-d);if("bendpoint"===r.type){var O=t.length-i.length,x=r.bendpointIndex,$=i[x];if(-1!==t.indexOf($))return{x:s,y:o};if(0===O){var C=t[x];return{x:C.x-r.position.x,y:C.y-r.position.y}}O<0&&0!==x&&x<i.length-1&&(w=cu(i,x))}var S,_,k=(b[1].x-b[0].x)*w+b[0].x,E=(b[1].y-b[0].y)*w+b[0].y,P=(S={x:a.x-v.x,y:a.y-v.y},(_=y)?{x:Math.cos(_)*S.x-Math.sin(_)*S.y,y:Math.sin(_)*S.x+Math.cos(_)*S.y}:S);return Oi({x:s=k+P.x-a.x,y:o=E+P.y-a.y})}(n,o,a,s)}(e),t.moveShape(s,n))}})),this.postExecute(["shape.replace"],(function(e){var t=e.context,i=t.newShape,n=t.oldShape,s=Es(i);s&&mo(s)&&n.label&&i.label&&(i.label.x=n.label.x,i.label.y=n.label.y)})),this.postExecute("shape.resize",(function(e){var i,n=e.context,s=n.shape,o=n.newBounds,a=n.oldBounds;if(go(s)){var r=s.label,l=function(e,t,i){return Oi(Ma(du(e,t,i),e))}(function(e,t){if(t.length){var i=function(e,t){return Ce(t.map((function(t){return{line:t,distance:Hd(e,t)}})),"distance")[0].line}(e,t);return Yd(e,i)}}(Ci(r),[[{x:(i=a).x,y:i.y},{x:i.x+(i.width||0),y:i.y}],[{x:i.x+(i.width||0),y:i.y},{x:i.x+(i.width||0),y:i.y+(i.height||0)}],[{x:i.x,y:i.y+(i.height||0)},{x:i.x+(i.width||0),y:i.y+(i.height||0)}],[{x:i.x,y:i.y},{x:i.x,y:i.y+(i.height||0)}]]),a,o);t.moveShape(r,l)}}))}function mu(e,t,i){var n=yu(e),s=Ou(n,t),o=n[0];return s.length?s[s.length-1]:du(o.original||o,i,t)}function gu(e,t,i){var n=yu(e),s=Ou(n,t),o=n[n.length-1];return s.length?s[0]:du(o.original||o,i,t)}function bu(e,t,i){var n=yu(e),s=wu(t,i),o=n[0];return du(o.original||o,s,t)}function vu(e,t,i){var n=yu(e),s=wu(t,i),o=n[n.length-1];return du(o.original||o,s,t)}function wu(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}function yu(e){var t=e.waypoints;if(!t.length)throw new Error("connection#"+e.id+": no waypoints");return t}function Ou(e,t){return ue(be(e,xu),(function(e){return function(e,t){return"intersect"===Si(t,e,1)}(e,t)}))}function xu(e){return e.original||e}function $u(e,t){ea.call(this,e),this.postExecute("shape.replace",(function(e){var i=e.oldShape,n=e.newShape;if(function(e,t){return _s(e,"bpmn:Participant")&&Ws(e)&&_s(t,"bpmn:Participant")&&!Ws(t)}(i,n)){var s,o,a,r,l=(o=ni([s=i],!1),a=[],r=[],o.forEach((function(e){e!==s&&(e.incoming.forEach((function(e){_s(e,"bpmn:MessageFlow")&&a.push(e)})),e.outgoing.forEach((function(e){_s(e,"bpmn:MessageFlow")&&r.push(e)})))}),[]),{incoming:a,outgoing:r});l.incoming.forEach((function(e){var s=gu(e,n,i);t.reconnectEnd(e,n,s)})),l.outgoing.forEach((function(e){var s=mu(e,n,i);t.reconnectStart(e,n,s)}))}}),!0)}function Cu(e,t,i){e.on(["shape.move.rejected","create.rejected"],(function(e){var n,s,o=e.context,a=o.shape;_s(o.target,"bpmn:Collaboration")&&_s(a,"bpmn:FlowNode")&&(n=e,s=i("flow elements must be children of pools/participants"),t.add({position:{x:n.x+5,y:n.y+5},type:"error",timeout:2e3,html:"<div>"+s+"</div>"}))}))}function Su(e,t){ea.call(this,e),this.preExecute("shape.resize",(function(e){var i=e.shape,n=Ps(i),s=n&&n.get("label");s&&s.get("bounds")&&t.updateModdleProperties(i,s,{bounds:void 0})}),!0)}function _u(e,t,i){ea.call(this,e),this.preExecute("shape.delete",(function(e){var n,s,o,a=e.context.shape;if(1===a.incoming.length&&1===a.outgoing.length){var r=a.incoming[0],l=a.outgoing[0];if(_s(r,"bpmn:SequenceFlow")&&_s(l,"bpmn:SequenceFlow")&&t.canConnect(r.source,l.target,r)){var c=(n=r.waypoints,s=l.waypoints,(o=Zd(ku(n[n.length-2]),ku(n[n.length-1]),ku(s[1]),ku(s[0])))?[].concat(n.slice(0,n.length-1),[o],s.slice(1)):[ku(n[0]),ku(s[s.length-1])]);i.reconnectEnd(r,l.target,c)}}}))}function ku(e){return e.original||e}function Eu(e,t){ea.call(this,e),this.preExecute("shape.delete",(function(e){var t=e.shape,i=t.parent;_s(t,"bpmn:Participant")&&(e.collaborationRoot=i)}),!0),this.postExecute("shape.delete",(function(e){var i=e.collaborationRoot;i&&!i.businessObject.participants.length&&t.makeProcess()}),!0)}function Pu(e,t,i,n){ea.call(this,e);var s=n.get("dragging",!1);function o(e){var n,s,o=e.source,a=e.target;e.parent&&(_s(e,"bpmn:SequenceFlow")&&(i.canConnectSequenceFlow(o,a)||(s=!0),i.canConnectMessageFlow(o,a)&&(n="bpmn:MessageFlow")),_s(e,"bpmn:MessageFlow")&&(i.canConnectMessageFlow(o,a)||(s=!0),i.canConnectSequenceFlow(o,a)&&(n="bpmn:SequenceFlow")),_s(e,"bpmn:Association")&&!i.canConnectAssociation(o,a)&&(s=!0),s&&t.removeConnection(e),n&&t.connect(o,a,{type:n,waypoints:e.waypoints.slice()}))}this.postExecuted("elements.move",(function(e){pe(e.closure.allConnections,o)}),!0),this.preExecute("connection.reconnect",(function(e){var n,o,a=e.context,r=a.connection,l=a.newSource||r.source,c=a.newTarget||r.target;(n=i.canConnect(l,c))&&n.type!==r.type&&(o=t.connect(l,c,{type:n.type,waypoints:r.waypoints.slice()}),t.removeConnection(r),a.connection=o,s&&function(e,t){var i,n=s.context(),o=n&&n.payload.previousSelection;o&&o.length&&-1!==(i=o.indexOf(e))&&o.splice(i,1,t)}(r,o))})),this.postExecuted("element.updateProperties",(function(e){var i,n=e.context,s=n.properties,o=n.element,a=o.businessObject;s.default&&(i=de(o.outgoing,Se({id:o.businessObject.default.id})))&&t.updateProperties(i,{conditionExpression:void 0}),s.conditionExpression&&a.sourceRef.default===a&&t.updateProperties(o.source,{default:void 0})}))}function Au(e,t,i,n,s,o){n.invoke(ea,this),this._bpmnReplace=e,this._elementRegistry=i,this._selection=o,this.postExecuted(["elements.create"],500,(function(e){var i=e.context,n=i.parent,s=i.elements,o=t.canReplace(s,n);o&&this.replaceElements(s,o.replacements)}),this),this.postExecuted(["elements.move"],500,(function(e){var i=e.context,n=i.newParent,s=i.newHost,o=[];pe(i.closure.topLevel,(function(e){o=Ns(e)?o.concat(e.children):o.concat(e)})),1===o.length&&s&&(n=s);var a=t.canReplace(o,n);a&&this.replaceElements(o,a.replacements,s)}),this),this.postExecute(["shape.replace"],1500,(function(e){var i,n=e.context,s=n.oldShape,o=n.newShape,a=s.attachers;a&&a.length&&(i=t.canReplace(a,o),this.replaceElements(a,i.replacements))}),this),this.postExecuted(["shape.replace"],1500,(function(e){var t=e.context,i=t.oldShape,n=t.newShape;s.unclaimId(i.businessObject.id,i.businessObject),s.updateProperties(n,{id:i.id})}))}G()(fu,ea),fu.$inject=["eventBus","modeling","bpmnFactory","textRenderer"],$u.$inject=["eventBus","modeling"],G()($u,ea),Cu.$inject=["eventBus","tooltips","translate"],G()(Su,ea),Su.$inject=["eventBus","modeling"],G()(_u,ea),_u.$inject=["eventBus","bpmnRules","modeling"],Eu.$inject=["eventBus","modeling"],G()(Eu,ea),G()(Pu,ea),Pu.$inject=["eventBus","modeling","bpmnRules","injector"],G()(Au,ea),Au.prototype.replaceElements=function(e,t){var i=this._elementRegistry,n=this._bpmnReplace,s=this._selection;pe(t,(function(t){var s={type:t.newElementType},o=i.get(t.oldElementId),a=e.indexOf(o);e[a]=n.replaceElement(o,s,{select:!1})})),t&&s.select(e)},Au.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var Ru={width:300,height:150},Du={width:140,height:120},Vu={width:50,height:30};function Lu(e){e.on("resize.start",1500,(function(e){var t=e.context,i=t.shape,n=t.direction,s=t.balanced;(_s(i,"bpmn:Lane")||_s(i,"bpmn:Participant"))&&(t.resizeConstraints=function(e,t,i){var n=uh(e),s=!0,o=!0,a=hh(n,[n]),r=xi(e),l={},c={};return/e/.test(t)?c.right=r.left+300:/w/.test(t)&&(c.left=r.right-300),a.forEach((function(e){var n=xi(e);/n/.test(t)&&(n.top<r.top-10&&(s=!1),i&&Tu(r.top-n.bottom)<10&&Mu(l,"top",n.top+60),Tu(r.top-n.top)<5&&ju(c,"top",n.bottom-60)),/s/.test(t)&&(n.bottom>r.bottom+10&&(o=!1),i&&Tu(r.bottom-n.top)<10&&ju(l,"bottom",n.bottom-60),Tu(r.bottom-n.bottom)<5&&Mu(c,"bottom",n.top+60))})),n.children.filter((function(e){return!e.hidden&&!e.waypoints&&(_s(e,"bpmn:FlowElement")||_s(e,"bpmn:Artifact"))})).forEach((function(e){var i=xi(e);s&&/n/.test(t)&&ju(c,"top",i.top-20),/e/.test(t)&&Mu(c,"right",i.right+20),o&&/s/.test(t)&&Mu(c,"bottom",i.bottom+20),/w/.test(t)&&ju(c,"left",i.left-50)})),{min:c,max:l}}(i,n,s)),_s(i,"bpmn:Participant")&&(t.minDimensions=Ru),_s(i,"bpmn:SubProcess")&&Ws(i)&&(t.minDimensions=Du),_s(i,"bpmn:TextAnnotation")&&(t.minDimensions=Vu)}))}Lu.$inject=["eventBus"];var Tu=Math.abs,Bu=Math.min,Fu=Math.max;function Iu(e,t,i,n){var s=e[t];e[t]=void 0===s?i:n(i,s)}function ju(e,t,i){return Iu(e,t,i,Bu)}function Mu(e,t,i){return Iu(e,t,i,Fu)}function Qu(e,t){e.on("resize.start",1501,(function(e){var t=e.context,i=t.shape;(_s(i,"bpmn:Lane")||_s(i,"bpmn:Participant"))&&(t.balanced=!Ao(e))})),e.on("resize.end",1001,(function(e){var i=e.context,n=i.shape,s=i.canExecute,o=i.newBounds;if(_s(n,"bpmn:Lane")||_s(n,"bpmn:Participant"))return s&&(o=yi(o),t.resizeLane(n,o,i.balanced)),!1}))}function Wu(e,t,i,n,s){function o(e){return ks(e,["bpmn:ReceiveTask","bpmn:SendTask"])||function(e,t){return oe(t)||(t=[t]),ge(t,(function(t){return Zs(e,t)}))}(e,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function a(t){return!!de(e.getDefinitions().get("rootElements"),Se({id:t.id}))}function r(e){return _s(e,"bpmn:ErrorEventDefinition")?"errorRef":_s(e,"bpmn:EscalationEventDefinition")?"escalationRef":_s(e,"bpmn:MessageEventDefinition")?"messageRef":_s(e,"bpmn:SignalEventDefinition")?"signalRef":void 0}function l(e){if(ks(e,["bpmn:ReceiveTask","bpmn:SendTask"]))return e.get("messageRef");var t=e.get("eventDefinitions")[0];return t.get(r(t))}i.invoke(ea,this),this.executed("shape.create",(function(t){var i=t.shape;if(o(i)){var n=l(Es(i));n&&!a(n)&&(di(e.getDefinitions().get("rootElements"),n),t.addedRootElement=n)}}),!0),this.reverted("shape.create",(function(t){var i=t.addedRootElement;i&&hi(e.getDefinitions().get("rootElements"),i)}),!0),t.on("copyPaste.copyElement",(function(e){var t=e.descriptor,i=e.element;if(o(i)){var n=l(Es(i));n&&(t.referencedRootElement=n)}})),t.on("copyPaste.pasteElement",500,(function(e){var t=e.descriptor,i=t.businessObject;if(o(i)){var l=t.referencedRootElement;l&&(a(l)||(l=n.copyElement(l,s.create(l.$type))),function(e,t){if(ks(e,["bpmn:ReceiveTask","bpmn:SendTask"]))return e.set("messageRef",t);var i=e.get("eventDefinitions")[0];i.set(r(i),t)}(i,l))}}))}Qu.$inject=["eventBus","modeling"],Wu.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"],G()(Wu,ea);var Nu=Math.max;function Zu(e){e.on("spaceTool.getMinDimensions",(function(e){var t=e.shapes,i=e.axis,n=e.start,s={};return pe(t,(function(e){var t=e.id;_s(e,"bpmn:Participant")&&(function(e){return"x"===e}(i)?s[t]=Ru:s[t]={width:Ru.width,height:qu(e,n)}),_s(e,"bpmn:SubProcess")&&Ws(e)&&(s[t]=Du),_s(e,"bpmn:TextAnnotation")&&(s[t]=Vu)})),s}))}function qu(e,t){var i;return dh(e).length?(i=function(e,t){var i;return i=zu(dh(e),t),e.height-i.height+60}(e,t),Nu(Ru.height,i)):Ru.height}function zu(e,t){var i,n,s;for(i=0;i<e.length;i++)if(t>=(n=e[i]).y&&t<=n.y+n.height)return(s=dh(n)).length?zu(s,t):n}Zu.$inject=["eventBus"];function Uu(e,t,i,n,s,o,a){ea.call(this,t),this._canvas=e,this._eventBus=t,this._modeling=i,this._elementFactory=n,this._bpmnFactory=s,this._bpmnjs=o,this._elementRegistry=a;var r=this;function l(e){return _s(e,"bpmn:SubProcess")&&!Ws(e)}function c(t){var i=t.shape,n=t.newRootElement,s=Es(i);n=r._addDiagram(n||s),t.newRootElement=e.addRootElement(n)}function h(t){var i=Es(t.shape);r._removeDiagram(i);var n=t.newRootElement=a.get(la(i));e.removeRootElement(n)}this.executed("shape.create",(function(e){l(e.shape)&&c(e)}),!0),this.postExecuted("shape.create",(function(e){var t=e.shape,i=e.newRootElement;i&&t.children&&(r._showRecursively(t.children),r._moveChildrenToShape(t,i))}),!0),this.reverted("shape.create",(function(e){l(e.shape)&&h(e)}),!0),this.preExecuted("shape.delete",(function(e){var t=e.shape;if(l(t)){var n=a.get(la(t));n&&i.removeElements(n.children.slice())}}),!0),this.executed("shape.delete",(function(e){l(e.shape)&&h(e)}),!0),this.reverted("shape.delete",(function(e){l(e.shape)&&c(e)}),!0),this.preExecuted("shape.replace",(function(t){var i=t.oldShape,n=t.newShape;l(i)&&l(n)&&(t.oldRoot=e.removeRootElement(la(i)))}),!0),this.postExecuted("shape.replace",(function(t){var n=t.newShape,s=t.oldRoot,o=e.findRoot(la(n));if(s&&o){var a=s.children;i.moveElements(a,{x:0,y:0},o)}}),!0),this.executed("element.updateProperties",(function(e){var t=e.element;if(_s(t,"bpmn:SubProcess")){var i=e.properties,n=e.oldProperties.id,s=i.id;if(n!==s){if(ha(t))return a.updateId(t,ca(s)),void a.updateId(n,s);a.get(ca(n))&&a.updateId(ca(n),ca(s))}}}),!0),this.reverted("element.updateProperties",(function(e){var t=e.element;if(_s(t,"bpmn:SubProcess")){var i=e.properties,n=e.oldProperties.id,s=i.id;if(n!==s){if(ha(t))return a.updateId(t,ca(n)),void a.updateId(s,n);var o=a.get(ca(s));o&&a.updateId(o,ca(n))}}}),!0),t.on("element.changed",(function(e){var i=e.element;if(ha(i)){var n=i,s=a.get(ra(n));s&&s!==n&&t.fire("element.changed",{element:s})}})),this.executed("shape.toggleCollapse",400,(function(e){var t=e.shape;_s(t,"bpmn:SubProcess")&&(Ws(t)?h(e):(c(e),r._showRecursively(t.children)))}),!0),this.reverted("shape.toggleCollapse",400,(function(e){var t=e.shape;_s(t,"bpmn:SubProcess")&&(Ws(t)?h(e):(c(e),r._showRecursively(t.children)))}),!0),this.postExecuted("shape.toggleCollapse",600,(function(e){var t=e.shape;if(_s(t,"bpmn:SubProcess")){var i=e.newRootElement;i&&(Ws(t)?r._moveChildrenToShape(i,t):r._moveChildrenToShape(t,i))}}),!0),t.on("copyPaste.createTree",(function(e){var t=e.element,i=e.children;if(l(t)){var n=la(t),s=a.get(n);s&&i.push.apply(i,s.children)}})),t.on("copyPaste.copyElement",(function(e){var t=e.descriptor,i=e.element,n=e.elements,s=i.parent;if(_s(Ps(s),"bpmndi:BPMNPlane")){var o=ra(s),a=de(n,(function(e){return e.id===o}));a&&(t.parent=a.id)}})),t.on("copyPaste.pasteElement",(function(e){var t=e.descriptor;t.parent&&(l(t.parent)||t.parent.hidden)&&(t.hidden=!0)}))}function Xu(e,t){e.invoke(ea,this),this.postExecuted("shape.replace",(function(e){var i=e.context.oldShape,n=e.context.newShape;if(_s(n,"bpmn:SubProcess")&&_s(i,"bpmn:Task")&&Ws(n)){var s,o={x:(s=n).x+s.width/6,y:s.y+s.height/2};t.createShape({type:"bpmn:StartEvent"},o,n)}}))}function Gu(e,t){ea.call(this,e),this.postExecuted("shape.toggleCollapse",1500,(function(e){var i=e.shape;if(!Ws(i)){var n=ni(i);n.forEach((function(e){var t=e.incoming.slice(),i=e.outgoing.slice();pe(t,(function(e){s(e,!0)})),pe(i,(function(e){s(e,!1)}))}))}function s(e,s){-1!==n.indexOf(e.source)&&-1!==n.indexOf(e.target)||(s?t.reconnectEnd(e,i,Ci(i)):t.reconnectStart(e,i,Ci(i)))}}),!0)}function Yu(e,t,i,n){ea.call(this,e),this.executed(["shape.toggleCollapse"],500,(function(e){var t,i=e.context.shape;_s(i,"bpmn:SubProcess")&&(i.collapsed?Ps(i).isExpanded=!1:((t=i.children).length&&t.forEach((function(e){"label"!==e.type||e.businessObject.name||(e.hidden=!0)})),Ps(i).isExpanded=!0))})),this.reverted(["shape.toggleCollapse"],500,(function(e){var t=e.context.shape;t.collapsed?Ps(t).isExpanded=!1:Ps(t).isExpanded=!0})),this.postExecuted(["shape.toggleCollapse"],500,(function(e){var n,s=e.context.shape,o=t.getDefaultSize(s);n=s.collapsed?function(e,t){return{x:e.x+(e.width-t.width)/2,y:e.y+(e.height-t.height)/2,width:t.width,height:t.height}}(s,o):function(e,t){var i,n,s=t;return(i=ah((n=e.children,n.filter((function(e){return!e.hidden}))).concat([e])))?(s.width=Math.max(i.width,s.width),s.height=Math.max(i.height,s.height),s.x=i.x+(i.width-s.width)/2,s.y=i.y+(i.height-s.height)/2):(s.x=e.x+(e.width-s.width)/2,s.y=e.y+(e.height-s.height)/2),s}(s,o),i.resizeShape(s,n,null,{autoResize:!s.collapsed&&"nwse"})}))}function Hu(e,t,i,n){t.invoke(ea,this),this.preExecute("shape.delete",(function(e){var t=e.context.shape,s=t.businessObject;vo(t)||(_s(t,"bpmn:Participant")&&Ws(t)&&i.ids.unclaim(s.processRef.id),n.unclaimId(s.id,s))})),this.preExecute("connection.delete",(function(e){var t=e.context.connection.businessObject;n.unclaimId(t.id,t)})),this.preExecute("canvas.updateRoot",(function(){var t=e.getRootElement(),n=t.businessObject;_s(t,"bpmn:Collaboration")&&i.ids.unclaim(n.id)}))}function Ku(e,t){ea.call(this,e),this.preExecute("connection.delete",(function(e){var i=e.context.connection,n=i.source;(function(e,t){if(!_s(e,"bpmn:SequenceFlow"))return!1;var i=Es(t),n=Es(e);return i.get("default")===n})(i,n)&&t.updateProperties(n,{default:null})}))}function Ju(e,t,i){var n;ea.call(this,e);var s=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(s,5e3,(function(e){(n=n||new ep).enter()})),this.postExecuted(s,500,(function(e){!function(){if(!n)throw new Error(i("out of bounds release"));n.leave()&&(t.updateLaneRefs(n.flowNodes,n.lanes),n=null)}()})),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],(function(e){var t=e.context.shape,s=function(){if(!n)throw new Error(i("out of bounds release"));return n}();t.labelTarget||(_s(t,"bpmn:Lane")&&s.addLane(t),_s(t,"bpmn:FlowNode")&&s.addFlowNode(t))}))}function ep(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}G()(Uu,ea),Uu.prototype._moveChildrenToShape=function(e,t){var i,n=this._modeling,s=e.children;if(s){var o=s.filter((function(e){return!e.hidden}));if(o.length){var a=si(o);if(t.x){var r=Ci(t),l=Ci(a);i={x:r.x-l.x,y:r.y-l.y}}else i={x:180-a.x,y:160-a.y};n.moveElements(s,i,t,{autoResize:!1})}else n.moveElements(s,{x:0,y:0},t,{autoResize:!1})}},Uu.prototype._showRecursively=function(e,t){var i=this,n=[];return e.forEach((function(e){e.hidden=!!t,n=n.concat(e),e.children&&(n=n.concat(i._showRecursively(e.children,e.collapsed||t)))})),n},Uu.prototype._addDiagram=function(e){var t=this._bpmnjs.getDefinitions().diagrams;return e.businessObject||(e=this._createNewDiagram(e)),t.push(e.di.$parent),e},Uu.prototype._createNewDiagram=function(e){var t=this._bpmnFactory,i=this._elementFactory,n=t.create("bpmndi:BPMNPlane",{bpmnElement:e}),s=t.create("bpmndi:BPMNDiagram",{plane:n});return n.$parent=s,i.createRoot({id:la(e),type:e.$type,di:n,businessObject:e,collapsed:!0})},Uu.prototype._removeDiagram=function(e){var t=this._bpmnjs.getDefinitions().diagrams,i=de(t,(function(t){return t.plane.bpmnElement.id===e.id}));return t.splice(t.indexOf(i),1),i},Uu.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"],Xu.$inject=["injector","modeling"],G()(Xu,ea),G()(Gu,ea),Gu.$inject=["eventBus","modeling"],G()(Yu,ea),Yu.$inject=["eventBus","elementFactory","modeling"],G()(Hu,ea),Hu.$inject=["canvas","injector","moddle","modeling"],G()(Ku,ea),Ku.$inject=["eventBus","modeling"],Ju.$inject=["eventBus","modeling","translate"],G()(Ju,ea);const tp={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","messageFlowBehavior","modelingFeedback","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior"],adaptiveLabelPositioningBehavior:["type",bd],appendBehavior:["type",wd],associationBehavior:["type",yd],attachEventBehavior:["type",Od],boundaryEventBehavior:["type",$d],createBehavior:["type",Cd],createDataObjectBehavior:["type",Sd],createParticipantBehavior:["type",kd],dataInputAssociationBehavior:["type",Pd],dataStoreBehavior:["type",Dd],deleteLaneBehavior:["type",Vd],detachEventBehavior:["type",Ld],dropOnFlowBehavior:["type",Bd],eventBasedGatewayBehavior:["type",jd],fixHoverBehavior:["type",Wd],groupBehavior:["type",Nd],importDockingFix:["type",qd],isHorizontalFix:["type",Ud],labelBehavior:["type",fu],messageFlowBehavior:["type",$u],modelingFeedback:["type",Cu],removeElementBehavior:["type",_u],removeEmbeddedLabelBoundsBehavior:["type",Su],removeParticipantBehavior:["type",Eu],replaceConnectionBehavior:["type",Pu],replaceElementBehaviour:["type",Au],resizeBehavior:["type",Lu],resizeLaneBehavior:["type",Qu],rootElementReferenceBehavior:["type",Wu],spaceToolBehavior:["type",Zu],subProcessPlaneBehavior:["type",Uu],subProcessStartEventBehavior:["type",Xu],toggleCollapseConnectionBehaviour:["type",Gu],toggleElementCollapseBehaviour:["type",Yu],unclaimIdBehavior:["type",Hu],unsetDefaultFlowBehavior:["type",Ku],updateFlowNodeRefsBehavior:["type",Ju]};function ip(e,t){var i=Si(e,t,-15);return"intersect"!==i?i:null}function np(e){Sr.call(this,e)}function sp(e){return!e||vo(e)}function op(e){do{if(_s(e,"bpmn:Process"))return Es(e);if(_s(e,"bpmn:Participant"))return Es(e).processRef||Es(e)}while(e=e.parent)}function ap(e){return _s(e,"bpmn:TextAnnotation")}function rp(e){return _s(e,"bpmn:Group")&&!e.labelTarget}function lp(e){return _s(e,"bpmn:BoundaryEvent")&&dp(e,"bpmn:CompensateEventDefinition")}function cp(e){return Es(e).isForCompensation}function hp(e){for(var t=e;t=t.parent;){if(_s(t,"bpmn:FlowElementsContainer"))return Es(t);if(_s(t,"bpmn:Participant"))return Es(t).processRef}return null}function dp(e,t){return!!de(Es(e).eventDefinitions||[],(function(e){return _s(e,t)}))}function up(e,t){return(Es(e).eventDefinitions||[]).every((function(e){return _s(e,t)}))}function pp(e){return _s(e,"bpmn:ReceiveTask")||_s(e,"bpmn:IntermediateCatchEvent")&&(dp(e,"bpmn:MessageEventDefinition")||dp(e,"bpmn:TimerEventDefinition")||dp(e,"bpmn:ConditionalEventDefinition")||dp(e,"bpmn:SignalEventDefinition"))}function fp(e){return e.waypoints}function mp(e,t){var i=function(e){for(var t=[];e;)(e=e.parent)&&t.push(e);return t}(t);return-1!==i.indexOf(e)}function gp(e,t,i){if(sp(e)||sp(t))return null;if(!_s(i,"bpmn:DataAssociation")){if(Ep(e,t))return{type:"bpmn:MessageFlow"};if(Pp(e,t))return{type:"bpmn:SequenceFlow"}}return Ap(e,t)||(lp(e)&&cp(t)?{type:"bpmn:Association",associationDirection:"One"}:!!kp(e,t)&&{type:"bpmn:Association"})}function bp(e,t,i){return!(!vo(e)&&!rp(e))||!(_s(t,"bpmn:Participant")&&!Ws(t))&&(_s(e,"bpmn:Participant")?_s(t,"bpmn:Process")||_s(t,"bpmn:Collaboration"):ks(e,["bpmn:DataInput","bpmn:DataOutput"])&&e.parent?t===e.parent:_s(e,"bpmn:Lane")?_s(t,"bpmn:Participant")||_s(t,"bpmn:Lane"):!(_s(e,"bpmn:BoundaryEvent")&&(n=e,!Es(n).cancelActivity||!wp(n)&&!yp(n)))&&(_s(e,"bpmn:FlowElement")&&!_s(e,"bpmn:DataStoreReference")?_s(t,"bpmn:FlowElementsContainer")?Ws(t):ks(t,["bpmn:Participant","bpmn:Lane"]):_s(e,"bpmn:DataStoreReference")&&_s(t,"bpmn:Collaboration")?ge(Es(t).get("participants"),(function(e){return!!e.get("processRef")})):ks(e,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?ks(t,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):!!_s(e,"bpmn:MessageFlow")&&(_s(t,"bpmn:Collaboration")||e.source.parent==t||e.target.parent==t)));var n}function vp(e){return _s(e,"bpmn:Lane")}function wp(e){var t=Es(e);return t&&!(t.eventDefinitions&&t.eventDefinitions.length)}function yp(e){return Op(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function Op(e,t){return t.some((function(t){return dp(e,t)}))}function xp(e,t,i,n){if(Array.isArray(e)||(e=[e]),1!==e.length)return!1;var s=e[0];return!vo(s)&&!!function(e){return!!function(e){return!vo(e)&&_s(e,"bpmn:BoundaryEvent")}(e)||!(!_s(e,"bpmn:IntermediateThrowEvent")||!wp(e))||_s(e,"bpmn:IntermediateCatchEvent")&&yp(e)}(s)&&!Ns(t)&&!(!_s(t,"bpmn:Activity")||cp(t))&&!(n&&!ip(n,t))&&!function(e){return _s(e,"bpmn:ReceiveTask")&&de(e.incoming,(function(e){return _s(e.source,"bpmn:EventBasedGateway")}))}(t)&&"attach"}function $p(e,t,i){if(!t)return!1;var n={replacements:[]};return pe(e,(function(e){Ns(t)||_s(e,"bpmn:StartEvent")&&"label"!==e.type&&bp(e,t)&&(function(e){return e&&!1!==Es(e).isInterrupting}(e)||n.replacements.push({oldElementId:e.id,newElementType:"bpmn:StartEvent"}),(function(e){return Zs(e,"bpmn:ErrorEventDefinition")}(e)||function(e){return Zs(e,"bpmn:EscalationEventDefinition")}(e)||function(e){return Zs(e,"bpmn:CompensateEventDefinition")}(e))&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:StartEvent"}),Op(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&_s(t,"bpmn:SubProcess")&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:StartEvent"})),_s(t,"bpmn:Transaction")||dp(e,"bpmn:CancelEventDefinition")&&"label"!==e.type&&(_s(e,"bpmn:EndEvent")&&bp(e,t)&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:EndEvent"}),_s(e,"bpmn:BoundaryEvent")&&xp(e,t,0,i)&&n.replacements.push({oldElementId:e.id,newElementType:"bpmn:BoundaryEvent"}))})),!!n.replacements.length&&n}function Cp(e,t){return!ge(e,vp)&&(!t||e.every((function(e){return bp(e,t)})))}function Sp(e,t,i,n){return!!t&&(!(!vo(e)&&!rp(e))||i!==t&&(!i||!mp(i,t))&&(bp(e,t)||Rp(e,t)))}function _p(e,t){return _s(e,"bpmn:SubProcess")?Ws(e)&&(!t||t.width>=100&&t.height>=80):_s(e,"bpmn:Lane")?!t||t.width>=130&&t.height>=60:_s(e,"bpmn:Participant")?!t||t.width>=250&&t.height>=50:!!ap(e)||!!rp(e)}function kp(e,t){return!(fp(e)||fp(t)||(!lp(e)||!cp(t))&&(mp(t,e)||mp(e,t)||!function(e,t){var i=ap(e),n=ap(t);return(i||n)&&i!==n}(e,t)&&!Ap(e,t)))}function Ep(e,t){return!(Lp(e)&&!Lp(t))&&_s(n=e,"bpmn:InteractionNode")&&!_s(n,"bpmn:BoundaryEvent")&&(!_s(n,"bpmn:Event")||_s(n,"bpmn:ThrowEvent")&&up(n,"bpmn:MessageEventDefinition"))&&function(e){return _s(e,"bpmn:InteractionNode")&&!cp(e)&&(!_s(e,"bpmn:Event")||_s(e,"bpmn:CatchEvent")&&up(e,"bpmn:MessageEventDefinition"))&&!(_s(e,"bpmn:BoundaryEvent")&&!dp(e,"bpmn:MessageEventDefinition"))}(t)&&(i=t,!(op(e)===op(i)));var i,n}function Pp(e,t){return!(pp(t)&&t.incoming.length>0&&(i=t.incoming,(i=i||[]).some(Vp))&&!_s(e,"bpmn:EventBasedGateway"))&&_s(s=e,"bpmn:FlowNode")&&!_s(s,"bpmn:EndEvent")&&!Ns(s)&&!(_s(s,"bpmn:IntermediateThrowEvent")&&dp(s,"bpmn:LinkEventDefinition"))&&!lp(s)&&!cp(s)&&function(e){return _s(e,"bpmn:FlowNode")&&!_s(e,"bpmn:StartEvent")&&!_s(e,"bpmn:BoundaryEvent")&&!Ns(e)&&!(_s(e,"bpmn:IntermediateCatchEvent")&&dp(e,"bpmn:LinkEventDefinition"))&&!cp(e)}(t)&&(n=t,hp(e)===hp(n))&&!(_s(e,"bpmn:EventBasedGateway")&&!pp(t));var i,n,s}function Ap(e,t){return ks(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&ks(t,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:!(!ks(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])||!ks(e,["bpmn:Activity","bpmn:CatchEvent"]))&&{type:"bpmn:DataOutputAssociation"}}function Rp(e,t,i){if(!t)return!1;if(Array.isArray(e)){if(1!==e.length)return!1;e=e[0]}return t.source!==e&&t.target!==e&&ks(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!vo(t)&&_s(e,"bpmn:FlowNode")&&!_s(e,"bpmn:BoundaryEvent")&&bp(e,t.parent)}function Dp(e,t){return!!vo(t)||!(_s(t,"bpmn:Lane")&&!function(e,t){return e&&t&&-1!==e.indexOf(t)}(e,t.parent))}function Vp(e){if(e&&e.source)return _s(e.source,"bpmn:EventBasedGateway")}function Lp(e){return Kc(e,"bpmn:Process")||Kc(e,"bpmn:Collaboration")}G()(np,Sr),np.$inject=["eventBus"],np.prototype.init=function(){this.addRule("connection.start",(function(e){return sp(t=e.source)?null:ks(t,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"]);var t})),this.addRule("connection.create",(function(e){var t=e.source,i=e.target,n=e.hints||{},s=n.targetParent;if(n.targetAttach)return!1;s&&(i.parent=s);try{return gp(t,i)}finally{s&&(i.parent=null)}})),this.addRule("connection.reconnect",(function(e){var t=e.connection;return gp(e.source,e.target,t)})),this.addRule("connection.updateWaypoints",(function(e){return{type:e.connection.type}})),this.addRule("shape.resize",(function(e){return _p(e.shape,e.newBounds)})),this.addRule("elements.create",(function(e){var t=e.elements,i=e.position,n=e.target;return!(fp(n)&&!Rp(t,n))&&me(t,(function(e){return fp(e)?gp(e.source,e.target,e):e.host?xp(e,e.host,0,i):Sp(e,n,null)}))})),this.addRule("elements.move",(function(e){var t=e.target,i=e.shapes,n=e.position;return xp(i,t,0,n)||$p(i,t,n)||Cp(i,t)||Rp(i,t)})),this.addRule("shape.create",(function(e){return Sp(e.shape,e.target,e.source,e.position)})),this.addRule("shape.attach",(function(e){return xp(e.shape,e.target,0,e.position)})),this.addRule("element.copy",(function(e){var t=e.element;return Dp(e.elements,t)}))},np.prototype.canConnectMessageFlow=Ep,np.prototype.canConnectSequenceFlow=Pp,np.prototype.canConnectDataAssociation=Ap,np.prototype.canConnectAssociation=kp,np.prototype.canMove=Cp,np.prototype.canAttach=xp,np.prototype.canReplace=$p,np.prototype.canDrop=bp,np.prototype.canInsert=Rp,np.prototype.canCreate=Sp,np.prototype.canConnect=gp,np.prototype.canResize=_p,np.prototype.canCopy=Dp;const Tp={__depends__:[jr],__init__:["bpmnRules"],bpmnRules:["type",np]};function Bp(e,t){e.on("saveXML.start",2e3,(function(){pe(t.getRootElements(),(function(e){var t,i=Ps(e);t=be(ue(ni([e],!1),(function(t){return t!==e&&!t.labelTarget})),Ps),i.set("planeElement",t)}))}))}Bp.$inject=["eventBus","canvas"];const Fp={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",Bp]};function Ip(e){ea.call(this,e);var t=this;this.preExecute(["shape.create","connection.create"],(function(e){var i=e.context,n=i.shape||i.connection,s=i.parent,o=t.getOrdering(n,s);o&&(void 0!==o.parent&&(i.parent=o.parent),i.parentIndex=o.index)})),this.preExecute(["shape.move","connection.move"],(function(e){var i=e.context,n=i.shape||i.connection,s=i.newParent||n.parent,o=t.getOrdering(n,s);o&&(void 0!==o.parent&&(i.newParent=o.parent),i.newParentIndex=o.index)}))}function jp(e,t,i){Ip.call(this,e);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:3,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function s(e){var t=e.order;if(t||(e.order=t=function(e){if(e.labelTarget)return{level:10};var t=de(n,(function(t){return ks(e,[t.type])}));return t&&t.order||{level:1}}(e)),!t)throw new Error("no order for <"+e.id+">");return t}this.getOrdering=function(e,i){if(e.labelTarget)return{parent:t.findRoot(e.labelTarget)||t.getRootElement(),index:-1};var n=s(e);n.containers&&(i=function(e,t,i){for(var n=t;n&&!ks(n,i);)n=n.parent;if(!n)throw new Error("no parent for <"+e.id+"> in <"+(t&&t.id)+">");return n}(e,i,n.containers));var o=i.children.indexOf(e),a=function(e,t){t=ke(t);var i=oe(e)?-1:void 0;return pe(e,(function(e,n){if(t(e,n))return i=n,!1})),i}(i.children,(function(t){return!(!e.labelTarget&&t.labelTarget)&&n.level<s(t).level}));return-1!==a&&-1!==o&&o<a&&(a-=1),{index:a,parent:i}}}Ip.prototype.getOrdering=function(e,t){return null},Xt()(Ip,ea),jp.$inject=["eventBus","canvas","translate"],G()(jp,Ip);const Mp={__depends__:[po],__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",jp]};function Qp(e,t){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=t,this._eventBus=e,this._uid=1,e.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}Qp.$inject=["eventBus","injector"],Qp.prototype.execute=function(e,t){if(!e)throw new Error("command required");this._currentExecution.trigger="execute";var i={command:e,context:t};this._pushAction(i),this._internalExecute(i),this._popAction(i)},Qp.prototype.canExecute=function(e,t){var i={command:e,context:t},n=this._getHandler(e),s=this._fire(e,"canExecute",i);if(void 0===s){if(!n)return!1;n.canExecute&&(s=n.canExecute(t))}return s},Qp.prototype.clear=function(e){this._stack.length=0,this._stackIdx=-1,!1!==e&&this._fire("changed",{trigger:"clear"})},Qp.prototype.undo=function(){var e,t=this._getUndoAction();if(t){for(this._currentExecution.trigger="undo",this._pushAction(t);t&&(this._internalUndo(t),(e=this._getUndoAction())&&e.id===t.id);)t=e;this._popAction()}},Qp.prototype.redo=function(){var e,t=this._getRedoAction();if(t){for(this._currentExecution.trigger="redo",this._pushAction(t);t&&(this._internalExecute(t,!0),(e=this._getRedoAction())&&e.id===t.id);)t=e;this._popAction()}},Qp.prototype.register=function(e,t){this._setHandler(e,t)},Qp.prototype.registerHandler=function(e,t){if(!e||!t)throw new Error("command and handlerCls must be defined");var i=this._injector.instantiate(t);this.register(e,i)},Qp.prototype.canUndo=function(){return!!this._getUndoAction()},Qp.prototype.canRedo=function(){return!!this._getRedoAction()},Qp.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},Qp.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},Qp.prototype._internalUndo=function(e){var t=this,i=e.command,n=e.context,s=this._getHandler(i);this._atomicDo((function(){t._fire(i,"revert",e),s.revert&&t._markDirty(s.revert(n)),t._revertedAction(e),t._fire(i,"reverted",e)}))},Qp.prototype._fire=function(e,t,i){arguments.length<3&&(i=t,t=null);var n,s,o,a=t?[e+"."+t,t]:[e];for(i=this._eventBus.createEvent(i),n=0;(s=a[n])&&(o=this._eventBus.fire("commandStack."+s,i),!i.cancelBubble);n++);return o},Qp.prototype._createId=function(){return this._uid++},Qp.prototype._atomicDo=function(e){var t=this._currentExecution;t.atomic=!0;try{e()}finally{t.atomic=!1}},Qp.prototype._internalExecute=function(e,t){var i=this,n=e.command,s=e.context,o=this._getHandler(n);if(!o)throw new Error("no command handler registered for <"+n+">");this._pushAction(e),t||(this._fire(n,"preExecute",e),o.preExecute&&o.preExecute(s),this._fire(n,"preExecuted",e)),this._atomicDo((function(){i._fire(n,"execute",e),o.execute&&i._markDirty(o.execute(s)),i._executedAction(e,t),i._fire(n,"executed",e)})),t||(this._fire(n,"postExecute",e),o.postExecute&&o.postExecute(s),this._fire(n,"postExecuted",e)),this._popAction(e)},Qp.prototype._pushAction=function(e){var t=this._currentExecution,i=t.actions,n=i[0];if(t.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+e.command+")");e.id||(e.id=n&&n.id||this._createId()),i.push(e)},Qp.prototype._popAction=function(){var e=this._currentExecution,t=e.trigger,i=e.actions,n=e.dirty;i.pop(),i.length||(this._eventBus.fire("elements.changed",{elements:xe("id",n.reverse())}),n.length=0,this._fire("changed",{trigger:t}),e.trigger=null)},Qp.prototype._markDirty=function(e){var t=this._currentExecution;e&&(e=oe(e)?e:[e],t.dirty=t.dirty.concat(e))},Qp.prototype._executedAction=function(e,t){var i=++this._stackIdx;t||this._stack.splice(i,this._stack.length,e)},Qp.prototype._revertedAction=function(e){this._stackIdx--},Qp.prototype._getHandler=function(e){return this._handlerMap[e]},Qp.prototype._setHandler=function(e,t){if(!e||!t)throw new Error("command and handler required");if(this._handlerMap[e])throw new Error("overriding handler for command <"+e+">");this._handlerMap[e]=t};const Wp={commandStack:["type",Qp]};var Np=new qo("tt");function Zp(e,t){e.style.display=!1===t?"none":""}var qp=".djs-tooltip";function zp(e,t){var i,n;this._eventBus=e,this._canvas=t,this._ids=Np,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=(i=t.getContainer(),n=it('<div class="djs-tooltip-container" style="position: absolute; width: 0; height: 0;" />'),i.insertBefore(n,i.firstChild),n);var s=this;et(this._tooltipRoot,qp,"mousedown",(function(e){e.stopPropagation()})),et(this._tooltipRoot,qp,"mouseover",(function(e){s.trigger("mouseover",e)})),et(this._tooltipRoot,qp,"mouseout",(function(e){s.trigger("mouseout",e)})),this._init()}zp.$inject=["eventBus","canvas"],zp.prototype.add=function(e){if(!e.position)throw new Error("must specifiy tooltip position");if(!e.html)throw new Error("must specifiy tooltip html");var t=this._ids.next();return e=Ve({},this._tooltipDefaults,e,{id:t}),this._addTooltip(e),e.timeout&&this.setTimeout(e),t},zp.prototype.trigger=function(e,t){var i=t.delegateTarget||t.target,n=this.get(Be(i,"data-tooltip-id"));n&&("mouseover"===e&&n.timeout&&this.clearTimeout(n),"mouseout"===e&&n.timeout&&(n.timeout=1e3,this.setTimeout(n)))},zp.prototype.get=function(e){return"string"!=typeof e&&(e=e.id),this._tooltips[e]},zp.prototype.clearTimeout=function(e){if(e=this.get(e)){var t=e.removeTimer;t&&(clearTimeout(t),e.removeTimer=null)}},zp.prototype.setTimeout=function(e){if(e=this.get(e)){this.clearTimeout(e);var t=this;e.removeTimer=setTimeout((function(){t.remove(e)}),e.timeout)}},zp.prototype.remove=function(e){var t=this.get(e);t&&(rt(t.html),rt(t.htmlContainer),delete t.htmlContainer,delete this._tooltips[t.id])},zp.prototype.show=function(){Zp(this._tooltipRoot)},zp.prototype.hide=function(){Zp(this._tooltipRoot,!1)},zp.prototype._updateRoot=function(e){var t=e.scale||1,i=e.scale||1,n="matrix("+t+",0,0,"+i+","+-1*e.x*t+","+-1*e.y*i+")";this._tooltipRoot.style.transform=n,this._tooltipRoot.style["-ms-transform"]=n},zp.prototype._addTooltip=function(e){var t,i=e.id,n=e.html,s=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),ce(n)&&(n=it(n)),(t=it('<div data-tooltip-id="'+i+'" class="djs-tooltip" style="position: absolute">')).appendChild(n),e.type&&Qe(t).add("djs-tooltip-"+e.type),e.className&&Qe(t).add(e.className),e.htmlContainer=t,s.appendChild(t),this._tooltips[i]=e,this._updateTooltip(e)},zp.prototype._updateTooltip=function(e){var t,i,n,s=e.position;t=e.htmlContainer,i=s.x,n=s.y,Ve(t.style,{left:i+"px",top:n+"px"})},zp.prototype._updateTooltipVisibilty=function(e){pe(this._tooltips,(function(t){var i=t.show,n=t.htmlContainer,s=!0;i&&((i.minZoom>e.scale||i.maxZoom<e.scale)&&(s=!1),Zp(n,s))}))},zp.prototype._init=function(){var e=this;this._eventBus.on("canvas.viewbox.changing",(function(t){e.hide()})),this._eventBus.on("canvas.viewbox.changed",(function(t){var i;i=t.viewbox,e._updateRoot(i),e._updateTooltipVisibilty(i),e.show()}))};const Up={__init__:["tooltips"],tooltips:["type",zp]};function Xp(e,t){if("function"!=typeof t)throw new Error("removeFn iterator must be a function");if(e){for(var i;i=e[0];)t(i);return e}}function Gp(e,t,i){ea.call(this,t);var n=e.get("movePreview",!1);t.on("shape.move.start",1400,(function(e){var t=e.context,i=t.shapes,n=t.validatedShapes;t.shapes=Yp(i),t.validatedShapes=Yp(n)})),n&&t.on("shape.move.start",250,(function(e){var t=e.context,i=t.shapes,s=[];pe(i,(function(e){pe(e.labels,(function(i){i.hidden||-1!==t.shapes.indexOf(i)||s.push(i),e.labelTarget&&s.push(e)}))})),pe(s,(function(e){n.makeDraggable(t,e,!0)}))})),this.preExecuted("elements.move",1400,(function(e){var t=e.context.closure,i=t.enclosedElements,n=[];pe(i,(function(e){pe(e.labels,(function(e){i[e.id]||n.push(e)}))})),t.addAll(n)})),this.preExecute(["connection.delete","shape.delete"],(function(e){var t=e.context;Xp((t.connection||t.shape).labels,(function(e){i.removeShape(e,{nested:!0})}))})),this.execute("shape.delete",(function(e){var t=e.context,i=t.shape,n=i.labelTarget;n&&(t.labelTargetIndex=ui(n.labels,i),t.labelTarget=n,i.labelTarget=null)})),this.revert("shape.delete",(function(e){var t=e.context,i=t.shape,n=t.labelTarget,s=t.labelTargetIndex;n&&(di(n.labels,i,s),i.labelTarget=n)}))}function Yp(e){return ue(e,(function(t){return-1===e.indexOf(t.labelTarget)}))}Xt()(Gp,ea),Gp.$inject=["injector","eventBus","modeling"];const Hp={__init__:["labelSupport"],labelSupport:["type",Gp]};var Kp="attach-ok";function Jp(e,t,i,n,s){ea.call(this,t);var o=e.get("movePreview",!1);t.on("shape.move.start",1401,(function(e){var t,i,n=e.context,s=n.shapes,o=n.validatedShapes;n.shapes=(i=ef(t=s),$e("id",t,i)),n.validatedShapes=function(e){var t=Oe(e,"id");return ue(e,(function(e){for(;e;){if(e.host&&t[e.host.id])return!1;e=e.parent}return!0}))}(o)})),o&&t.on("shape.move.start",251,(function(e){var t=e.context;pe(ef(t.shapes),(function(e){o.makeDraggable(t,e,!0),pe(e.labels,(function(e){o.makeDraggable(t,e,!0)}))}))})),o&&t.on("shape.move.start",(function(e){var n=e.context.shapes;if(1===n.length){var s=n[0].host;s&&(i.addMarker(s,Kp),t.once(["shape.move.out","shape.move.cleanup"],(function(){i.removeMarker(s,Kp)})))}})),this.preExecuted("elements.move",1401,(function(e){var t=e.context,i=t.closure;pe(ef(t.shapes),(function(e){i.add(e,i.topLevel[e.host.id])}))})),this.postExecuted("elements.move",(function(e){var t=e.context,i=t.shapes,n=t.newHost;n&&1!==i.length||pe(n?i:ue(i,(function(e){var t,n=e.host;return function(e){return!!e.host}(e)&&(t=n,!(-1!==i.indexOf(t)))})),(function(e){s.updateAttachment(e,n)}))})),this.postExecuted("elements.move",(function(e){pe(e.context.shapes,(function(e){pe(e.attachers,(function(e){pe(e.outgoing.slice(),(function(e){n.allowed("connection.reconnect",{connection:e,source:e.source,target:e.target})||s.removeConnection(e)})),pe(e.incoming.slice(),(function(e){n.allowed("connection.reconnect",{connection:e,source:e.source,target:e.target})||s.removeConnection(e)}))}))}))})),this.postExecute("shape.create",(function(e){var t=e.context,i=t.shape,n=t.host;n&&s.updateAttachment(i,n)})),this.postExecute("shape.replace",(function(e){var t=e.context,i=t.oldShape,o=t.newShape;Xp(i.attachers,(function(e){"attach"===n.allowed("elements.move",{target:o,shapes:[e]})?s.updateAttachment(e,o):s.removeShape(e)})),o.attachers.length&&pe(o.attachers,(function(e){var t=uu(e,i,o);s.moveShape(e,t,e.parent)}))})),this.postExecute("shape.resize",(function(e){var t=e.context,i=t.shape,n=t.oldBounds,o=t.newBounds,a=i.attachers;!1!==(t.hints||{}).attachSupport&&pe(a,(function(e){var t=uu(e,n,o);s.moveShape(e,t,e.parent),pe(e.labels,(function(e){s.moveShape(e,t,e.parent)}))}))})),this.preExecute("shape.delete",(function(e){var t=e.context.shape;Xp(t.attachers,(function(e){s.removeShape(e)})),t.host&&s.updateAttachment(t,null)}))}function ef(e){return J(be(e,(function(e){return e.attachers||[]})))}Xt()(Jp,ea),Jp.$inject=["injector","eventBus","canvas","rules","modeling"];const tf={__depends__:[jr],__init__:["attachSupport"],attachSupport:["type",Jp]};function nf(e,t){this._eventBus=e,this._dragging=t,this._tools=[],this._active=null}nf.$inject=["eventBus","dragging"],nf.prototype.registerTool=function(e,t){var i=this._tools;if(!t)throw new Error('A tool has to be registered with it\'s "events"');i.push(e),this.bindEvents(e,t)},nf.prototype.isActive=function(e){return e&&this._active===e},nf.prototype.length=function(e){return this._tools.length},nf.prototype.setActive=function(e){var t=this._eventBus;this._active!==e&&(this._active=e,t.fire("tool-manager.update",{tool:e}))},nf.prototype.bindEvents=function(e,t){var i=this._eventBus,n=this._dragging,s=[];i.on(t.tool+".init",(function(t){if(!t.context.reactivate&&this.isActive(e))return this.setActive(null),void n.cancel();this.setActive(e)}),this),pe(t,(function(e){s.push(e+".ended"),s.push(e+".canceled")})),i.on(s,250,(function(e){this._active&&(function(e){var t=e.originalEvent&&e.originalEvent.target;return t&&Ue(t,'.group[data-group="tools"]')}(e)||this.setActive(null))}),this)};const sf={__depends__:[Tr],__init__:["toolManager"],toolManager:["type",nf]};function of(e,t){return-1!==e.indexOf(t)}var af=Math.abs,rf=Math.round,lf={x:"width",y:"height"},cf="crosshair",hf={n:"top",w:"left",s:"bottom",e:"right"},df={n:"s",w:"e",s:"n",e:"w"};function uf(e,t,i,n,s,o,a){this._canvas=e,this._dragging=t,this._eventBus=i,this._modeling=n,this._rules=s,this._toolManager=o,this._mouse=a;var r=this;o.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),i.on("spaceTool.selection.end",(function(e){i.once("spaceTool.selection.ended",(function(){r.activateMakeSpace(e.originalEvent)}))})),i.on("spaceTool.move",1500,(function(e){var t=e.context,i=t.initialized;i||(i=t.initialized=r.init(e,t)),i&&ff(e)})),i.on("spaceTool.end",(function(e){var t=e.context,n=t.axis,s=t.direction,o=t.movingShapes,a=t.resizingShapes,l=t.start;if(t.initialized){ff(e);var c={x:0,y:0};c[n]=rf(e["d"+n]),r.makeSpace(o,a,c,s,l),i.once("spaceTool.ended",(function(e){r.activateSelection(e.originalEvent,!0,!0)}))}}))}function pf(e){return{top:e.top-20,right:e.right+20,bottom:e.bottom+20,left:e.left-20}}function ff(e){var t,i,n=e.context.spaceToolConstraints;n&&(re(n.left)&&(t=Math.max(e.x,n.left),e.dx=e.dx+t-e.x,e.x=t),re(n.right)&&(t=Math.min(e.x,n.right),e.dx=e.dx+t-e.x,e.x=t),re(n.top)&&(i=Math.max(e.y,n.top),e.dy=e.dy+i-e.y,e.y=i),re(n.bottom)&&(i=Math.min(e.y,n.bottom),e.dy=e.dy+i-e.y,e.y=i))}function mf(e,t){return-1!==e.indexOf(t)}function gf(e){return!!e.waypoints}function bf(e){return!!e.labelTarget}uf.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"],uf.prototype.activateSelection=function(e,t,i){this._dragging.init(e,"spaceTool.selection",{autoActivate:t,cursor:cf,data:{context:{reactivate:i}},trapClick:!1})},uf.prototype.activateMakeSpace=function(e){this._dragging.init(e,"spaceTool",{autoActivate:!0,cursor:cf,data:{context:{}}})},uf.prototype.makeSpace=function(e,t,i,n,s){return this._modeling.createSpace(e,t,i,n,s)},uf.prototype.init=function(e,t){var i=af(e.dx)>af(e.dy)?"x":"y",n=e["d"+i],s=e[i]-n;if(af(n)<5)return!1;n<0&&(n*=-1),Ao(e)&&(n*=-1);var o=function(e,t){if("x"===e){if(t>0)return"e";if(t<0)return"w"}if("y"===e){if(t>0)return"s";if(t<0)return"n"}return null}(i,n),a=ni(this._canvas.getRootElement(),!0),r=this.calculateAdjustments(a,i,n,s),l=function(e,t,i,n,s){var o=e.movingShapes,a=e.resizingShapes;if(a.length){var r,l,c={};return pe(a,(function(e){var h,d,u,p=xi(e),f=ue(e.children,(function(e){return!(gf(e)||bf(e)||mf(o,e)||mf(a,e))})),m=ue(e.children,(function(e){return!gf(e)&&!bf(e)&&mf(o,e)}));f.length&&(d=pf(xi(si(f))),h=n-p[hf[i]]+d[hf[i]],"n"===i?c.bottom=l=re(l)?Math.min(l,h):h:"w"===i?c.right=l=re(l)?Math.min(l,h):h:"s"===i?c.top=r=re(r)?Math.max(r,h):h:"e"===i&&(c.left=r=re(r)?Math.max(r,h):h)),m.length&&(u=pf(xi(si(m))),h=n-u[hf[df[i]]]+p[hf[df[i]]],"n"===i?c.bottom=l=re(l)?Math.min(l,h):h:"w"===i?c.right=l=re(l)?Math.min(l,h):h:"s"===i?c.top=r=re(r)?Math.max(r,h):h:"e"===i&&(c.left=r=re(r)?Math.max(r,h):h));var g=s&&s[e.id];g&&("n"===i?(h=n+e[lf[t]]-g[lf[t]],c.bottom=l=re(l)?Math.min(l,h):h):"w"===i?(h=n+e[lf[t]]-g[lf[t]],c.right=l=re(l)?Math.min(l,h):h):"s"===i?(h=n-e[lf[t]]+g[lf[t]],c.top=r=re(r)?Math.max(r,h):h):"e"===i&&(h=n-e[lf[t]]+g[lf[t]],c.left=r=re(r)?Math.max(r,h):h))})),c}}(r,i,o,s,this._eventBus.fire("spaceTool.getMinDimensions",{axis:i,direction:o,shapes:r.resizingShapes,start:s}));return Ve(t,r,{axis:i,direction:o,spaceToolConstraints:l,start:s}),Ba("resize-"+("x"===i?"ew":"ns")),!0},uf.prototype.calculateAdjustments=function(e,t,i,n){var s=this._rules,o=[],a=[];return pe(e,(function(e){if(e.parent&&!gf(e)){var r=e[t],l=r+e[lf[t]];return i>0&&r>n||i<0&&l<n?o.push(e):r<n&&l>n&&s.allowed("shape.resize",{shape:e})?a.push(e):void 0}})),{movingShapes:o,resizingShapes:a}},uf.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)},uf.prototype.isActive=function(){var e=this._dragging.context();return e&&/^spaceTool/.test(e.prefix)};var vf="djs-dragging",wf="djs-resizing",yf=Math.max;function Of(e,t,i,n,s){function o(e,t){pe(e,(function(e){s.addDragger(e,t),i.addMarker(e,vf)}))}e.on("spaceTool.selection.start",(function(e){var t=i.getLayer("space"),s=e.context,o=St("g");ut(o,n.cls("djs-crosshair-group",["no-events"])),ct(t,o);var a=St("path");ut(a,"d","M 0,-10000 L 0,10000"),bt(a).add("djs-crosshair"),ct(o,a);var r=St("path");ut(r,"d","M -10000,0 L 10000,0"),bt(r).add("djs-crosshair"),ct(o,r),s.crosshairGroup=o})),e.on("spaceTool.selection.move",(function(e){en(e.context.crosshairGroup,e.x,e.y)})),e.on("spaceTool.selection.cleanup",(function(e){var t=e.context.crosshairGroup;t&&wt(t)})),e.on("spaceTool.move",250,(function(e){var a=e.context,r=a.line,l=a.axis,c=a.movingShapes,h=a.resizingShapes;if(a.initialized){if(!a.dragGroup){var d=i.getLayer("space");ut(r=St("path"),"d","M0,0 L0,0"),bt(r).add("djs-crosshair"),ct(d,r),a.line=r;var u=St("g");ut(u,n.cls("djs-drag-group",["no-events"])),ct(i.getActiveLayer(),u),o(c,u),o(a.movingConnections=t.filter((function(e){var t=!1;pe(c,(function(i){pe(i.outgoing,(function(i){e===i&&(t=!0)}))}));var i=!1;pe(c,(function(t){pe(t.incoming,(function(t){e===t&&(i=!0)}))}));var n=!1;pe(h,(function(t){pe(t.outgoing,(function(t){e===t&&(n=!0)}))}));var s=!1;return pe(h,(function(t){pe(t.incoming,(function(t){e===t&&(s=!0)}))})),function(e){return e.waypoints}(e)&&(t||n)&&(i||s)})),u),a.dragGroup=u}if(!a.frameGroup){var p=St("g");ut(p,n.cls("djs-frame-group",["no-events"])),ct(i.getActiveLayer(),p);var f=[];pe(h,(function(e){var t=s.addFrame(e,p),n=t.getBBox();f.push({element:t,initialBounds:n}),i.addMarker(e,wf)})),a.frameGroup=p,a.frames=f}ut(r,{d:{x:"M"+e.x+", -10000 L"+e.x+", 10000",y:"M -10000, "+e.y+" L 10000, "+e.y}[l]});var m={x:e.dx,y:e.dy};m[{x:"y",y:"x"}[a.axis]]=0,en(a.dragGroup,m.x,m.y),pe(a.frames,(function(e){var t,i,n=e.element,s=e.initialBounds;"e"===a.direction?ut(n,{width:yf(s.width+m.x,5)}):ut(n,{width:t=yf(s.width-m.x,5),x:s.x+s.width-t}),"s"===a.direction?ut(n,{height:yf(s.height+m.y,5)}):ut(n,{height:i=yf(s.height-m.y,5),y:s.y+s.height-i})}))}})),e.on("spaceTool.cleanup",(function(e){var t=e.context,n=t.movingShapes,s=t.movingConnections,o=t.resizingShapes,a=t.line,r=t.dragGroup,l=t.frameGroup;pe(n,(function(e){i.removeMarker(e,vf)})),pe(s,(function(e){i.removeMarker(e,vf)})),r&&(wt(a),wt(r)),pe(o,(function(e){i.removeMarker(e,wf)})),l&&wt(l)}))}Of.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const xf={__init__:["spaceToolPreview"],__depends__:[Tr,jr,sf,Ul,uc],spaceTool:["type",uf],spaceToolPreview:["type",Of]};function $f(e){this._model=e}function Cf(e,t,i,n){ea.call(this,e),this._bpmnFactory=t,this._translate=n;var s=this;function o(e){pe(e.context.oldRoot.children,(function(e){_s(e,"bpmn:BaseElement")&&s.updateParent(e)}))}function a(e){var t=e.context.shape;_s(t,"bpmn:BaseElement")&&s.updateBounds(t)}function r(e){s.updateConnection(e.context)}function l(e){s.updateConnectionWaypoints(e.context.connection)}function c(e){s.updateAttachment(e.context)}this.executed(["connection.layout","connection.create"],(function(e){var t,n=e.context,s=n.hints||{};n.cropped||!1===s.createElementsBehavior||((t=n.connection).waypoints=i.getCroppedWaypoints(t),n.cropped=!0)})),this.reverted(["connection.layout"],(function(e){delete e.context.cropped})),this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],Sf((function(e){var t=e.context;s.updateParent(t.shape||t.connection,t.oldParent)}))),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],Sf((function(e){var t=e.context,i=t.shape||t.connection,n=t.parent||t.newParent;s.updateParent(i,n)}))),this.executed(["canvas.updateRoot"],o),this.reverted(["canvas.updateRoot"],o),this.executed(["shape.move","shape.create","shape.resize"],Sf((function(e){"label"!==e.context.shape.type&&a(e)}))),this.reverted(["shape.move","shape.create","shape.resize"],Sf((function(e){"label"!==e.context.shape.type&&a(e)}))),e.on("shape.changed",(function(e){"label"===e.element.type&&a({context:{shape:e.element}})})),this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],Sf(r)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],Sf(r)),this.executed(["connection.layout","connection.move","connection.updateWaypoints"],Sf(l)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],Sf(l)),this.executed("connection.reconnect",Sf((function(e){var t=e.context,i=t.connection,n=t.oldSource,s=t.newSource,o=Es(i),a=Es(n),r=Es(s);o.conditionExpression&&!ks(r,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(t.oldConditionExpression=o.conditionExpression,delete o.conditionExpression),n!==s&&a.default===o&&(t.oldDefault=a.default,delete a.default)}))),this.reverted("connection.reconnect",Sf((function(e){var t=e.context,i=t.connection,n=t.oldSource,s=t.newSource,o=Es(i),a=Es(n),r=Es(s);t.oldConditionExpression&&(o.conditionExpression=t.oldConditionExpression),t.oldDefault&&(a.default=t.oldDefault,delete r.default)}))),this.executed(["element.updateAttachment"],Sf(c)),this.reverted(["element.updateAttachment"],Sf(c))}function Sf(e){return function(t){var i=t.context;_s(i.shape||i.connection,"bpmn:BaseElement")&&e(t)}}function _f(e,t,i){Xi.call(this),this._bpmnFactory=e,this._moddle=t,this._translate=i}function kf(e,t,i){e[i]=t[i],delete t[i]}function Ef(e,t){this._modeling=e,this._canvas=t}function Pf(e){this._modeling=e}function Af(e,t){this._canvas=e,this._layouter=t}$f.$inject=["moddle"],$f.prototype._needsId=function(e){return ks(e,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])},$f.prototype._ensureId=function(e){var t;e.id?this._model.ids.claim(e.id,e):(t=_s(e,"bpmn:Activity")?"Activity":_s(e,"bpmn:Event")?"Event":_s(e,"bpmn:Gateway")?"Gateway":ks(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])?"Flow":(e.$type||"").replace(/^[^:]*:/g,""),t+="_",!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(t,e)))},$f.prototype.create=function(e,t){var i=this._model.create(e,t||{});return this._ensureId(i),i},$f.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})},$f.prototype.createDiShape=function(e,t){return this.create("bpmndi:BPMNShape",Ve({bpmnElement:e,bounds:this.createDiBounds()},t))},$f.prototype.createDiBounds=function(e){return this.create("dc:Bounds",e)},$f.prototype.createDiWaypoints=function(e){var t=this;return be(e,(function(e){return t.createDiWaypoint(e)}))},$f.prototype.createDiWaypoint=function(e){return this.create("dc:Point",Le(e,["x","y"]))},$f.prototype.createDiEdge=function(e,t){return this.create("bpmndi:BPMNEdge",Ve({bpmnElement:e,waypoint:this.createDiWaypoints([])},t))},$f.prototype.createDiPlane=function(e,t){return this.create("bpmndi:BPMNPlane",Ve({bpmnElement:e},t))},G()(Cf,ea),Cf.$inject=["eventBus","bpmnFactory","connectionDocking","translate"],Cf.prototype.updateAttachment=function(e){var t=e.shape,i=t.businessObject,n=t.host;i.attachedToRef=n&&n.businessObject},Cf.prototype.updateParent=function(e,t){if(!(e instanceof qi||_s(e,"bpmn:DataStoreReference")&&e.parent&&_s(e.parent,"bpmn:Collaboration"))){var i=e.parent,n=e.businessObject,s=Ps(e),o=i&&i.businessObject,a=Ps(i);_s(e,"bpmn:FlowNode")&&this.updateFlowNodeRefs(n,o,t&&t.businessObject),_s(e,"bpmn:DataOutputAssociation")&&(o=e.source?e.source.businessObject:null),_s(e,"bpmn:DataInputAssociation")&&(o=e.target?e.target.businessObject:null),this.updateSemanticParent(n,o),_s(e,"bpmn:DataObjectReference")&&n.dataObjectRef&&this.updateSemanticParent(n.dataObjectRef,o),this.updateDiParent(s,a)}},Cf.prototype.updateBounds=function(e){var t=Ps(e),i=function(e){if(_s(e,"bpmn:Activity")){var t=Ps(e);if(t){var i=t.get("label");if(i)return i.get("bounds")}}}(e);if(i){var n=Ma(i,t.get("bounds"));Ve(i,{x:e.x+n.x,y:e.y+n.y})}var s=e instanceof qi?this._getLabel(t):t,o=s.bounds;o||(o=this._bpmnFactory.createDiBounds(),s.set("bounds",o)),Ve(o,{x:e.x,y:e.y,width:e.width,height:e.height})},Cf.prototype.updateFlowNodeRefs=function(e,t,i){i!==t&&(_s(i,"bpmn:Lane")&&hi(i.get("flowNodeRef"),e),_s(t,"bpmn:Lane")&&di(t.get("flowNodeRef"),e))},Cf.prototype.updateDiConnection=function(e,t,i){var n=Ps(e),s=Ps(t),o=Ps(i);n.sourceElement&&n.sourceElement.bpmnElement!==Es(t)&&(n.sourceElement=t&&s),n.targetElement&&n.targetElement.bpmnElement!==Es(i)&&(n.targetElement=i&&o)},Cf.prototype.updateDiParent=function(e,t){if(t&&!_s(t,"bpmndi:BPMNPlane")&&(t=t.$parent),e.$parent!==t){var i=(t||e.$parent).get("planeElement");t?(i.push(e),e.$parent=t):(hi(i,e),e.$parent=null)}},Cf.prototype.getLaneSet=function(e){var t,i;return _s(e,"bpmn:Lane")?((t=e.childLaneSet)||(t=this._bpmnFactory.create("bpmn:LaneSet"),e.childLaneSet=t,t.$parent=e),t):(_s(e,"bpmn:Participant")&&(e=e.processRef),(t=(i=e.get("laneSets"))[0])||((t=this._bpmnFactory.create("bpmn:LaneSet")).$parent=e,i.push(t)),t)},Cf.prototype.updateSemanticParent=function(e,t,i){var n,s=this._translate;if(e.$parent!==t&&(!_s(e,"bpmn:DataInput")&&!_s(e,"bpmn:DataOutput")||(_s(t,"bpmn:Participant")&&"processRef"in t&&(t=t.processRef),!("ioSpecification"in t)||t.ioSpecification!==e.$parent))){if(_s(e,"bpmn:Lane"))t&&(t=this.getLaneSet(t)),n="lanes";else if(_s(e,"bpmn:FlowElement")){if(t)if(_s(t,"bpmn:Participant"))t=t.processRef;else if(_s(t,"bpmn:Lane"))do{t=t.$parent.$parent}while(_s(t,"bpmn:Lane"));n="flowElements"}else if(_s(e,"bpmn:Artifact")){for(;t&&!_s(t,"bpmn:Process")&&!_s(t,"bpmn:SubProcess")&&!_s(t,"bpmn:Collaboration");){if(_s(t,"bpmn:Participant")){t=t.processRef;break}t=t.$parent}n="artifacts"}else if(_s(e,"bpmn:MessageFlow"))n="messageFlows";else if(_s(e,"bpmn:Participant")){n="participants";var o,a=e.processRef;a&&(o=function(e){for(;e&&!_s(e,"bpmn:Definitions");)e=e.$parent;return e}(e.$parent||t),e.$parent&&(hi(o.get("rootElements"),a),a.$parent=null),t&&(di(o.get("rootElements"),a),a.$parent=o))}else _s(e,"bpmn:DataOutputAssociation")?n="dataOutputAssociations":_s(e,"bpmn:DataInputAssociation")&&(n="dataInputAssociations");if(!n)throw new Error(s("no parent for {element} in {parent}",{element:e.id,parent:t.id}));var r;if(e.$parent&&hi(r=e.$parent.get(n),e),t?((r=t.get(n)).push(e),e.$parent=t):e.$parent=null,i){var l=i.get(n);hi(r,e),t&&(l||(l=[],t.set(n,l)),l.push(e))}}},Cf.prototype.updateConnectionWaypoints=function(e){Ps(e).set("waypoint",this._bpmnFactory.createDiWaypoints(e.waypoints))},Cf.prototype.updateConnection=function(e){var t,i=e.connection,n=Es(i),s=i.source,o=Es(s),a=i.target,r=Es(i.target);if(_s(n,"bpmn:DataAssociation"))_s(n,"bpmn:DataInputAssociation")?(n.get("sourceRef")[0]=o,t=e.parent||e.newParent||r,this.updateSemanticParent(n,r,t)):_s(n,"bpmn:DataOutputAssociation")&&(t=e.parent||e.newParent||o,this.updateSemanticParent(n,o,t),n.targetRef=r);else{var l=_s(n,"bpmn:SequenceFlow");n.sourceRef!==o&&(l&&(hi(n.sourceRef&&n.sourceRef.get("outgoing"),n),o&&o.get("outgoing")&&o.get("outgoing").push(n)),n.sourceRef=o),n.targetRef!==r&&(l&&(hi(n.targetRef&&n.targetRef.get("incoming"),n),r&&r.get("incoming")&&r.get("incoming").push(n)),n.targetRef=r)}this.updateConnectionWaypoints(i),this.updateDiConnection(i,s,a)},Cf.prototype._getLabel=function(e){return e.label||(e.label=this._bpmnFactory.createDiLabel()),e.label},G()(_f,Xi),_f.$inject=["bpmnFactory","moddle","translate"],_f.prototype.baseCreate=Xi.prototype.create,_f.prototype.create=function(e,t){if("label"===e){var i=t.di||this._bpmnFactory.createDiLabel();return this.baseCreate(e,Ve({type:"label",di:i},fo,t))}return this.createBpmnElement(e,t)},_f.prototype.createBpmnElement=function(e,t){var i,n,s,o=this._translate,a=(t=t||{}).businessObject,r=t.di;if(!a){if(!t.type)throw new Error(o("no shape type specified"));$s(a=this._bpmnFactory.create(t.type))}if(!ks(r,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])){var l=Ve(r||{},{id:a.id+"_di"});r="root"===e?this._bpmnFactory.createDiPlane(a,l):"connection"===e?this._bpmnFactory.createDiEdge(a,l):this._bpmnFactory.createDiShape(a,l)}return _s(a,"bpmn:Group")&&(t=Ve({isFrame:!0},t)),function(e,t,i){pe(["processRef","isInterrupting","associationDirection","isForCompensation"],(function(i){void 0!==t[i]&&kf(e,t,i)}))}(a,t),t.isExpanded&&kf(r,t,"isExpanded"),_s(a,"bpmn:SubProcess")&&(t.collapsed=!Ws(a,r)),_s(a,"bpmn:ExclusiveGateway")&&(r.isMarkerVisible=!0),t.eventDefinitionType&&(n=a.get("eventDefinitions")||[],s=this._bpmnFactory.create(t.eventDefinitionType,t.eventDefinitionAttrs),"bpmn:ConditionalEventDefinition"===t.eventDefinitionType&&(s.condition=this._bpmnFactory.create("bpmn:FormalExpression")),n.push(s),s.$parent=a,a.eventDefinitions=n,delete t.eventDefinitionType),i=this.getDefaultSize(a,r),t=Ve({id:a.id},i,t,{businessObject:a,di:r}),this.baseCreate(e,t)},_f.prototype.getDefaultSize=function(e,t){var i=Es(e);return t=t||Ps(e),_s(i,"bpmn:SubProcess")?Ws(i,t)?{width:350,height:200}:{width:100,height:80}:_s(i,"bpmn:Task")?{width:100,height:80}:_s(i,"bpmn:Gateway")?{width:50,height:50}:_s(i,"bpmn:Event")?{width:36,height:36}:_s(i,"bpmn:Participant")?Ws(i,t)?{width:600,height:250}:{width:400,height:60}:_s(i,"bpmn:Lane")?{width:400,height:100}:_s(i,"bpmn:DataObjectReference")?{width:36,height:50}:_s(i,"bpmn:DataStoreReference")?{width:50,height:50}:_s(i,"bpmn:TextAnnotation")?{width:100,height:30}:_s(i,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}},_f.prototype.createParticipantShape=function(e){return ae(e)||(e={isExpanded:e}),!1!==(e=Ve({type:"bpmn:Participant"},e||{})).isExpanded&&(e.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(e)},Ef.$inject=["modeling","canvas"],Ef.prototype.preExecute=function(e){var t=this._modeling,i=e.elements,n=e.alignment;pe(i,(function(e){var i={x:0,y:0};n.left?i.x=n.left-e.x:n.right?i.x=n.right-e.width-e.x:n.center?i.x=n.center-Math.round(e.width/2)-e.x:n.top?i.y=n.top-e.y:n.bottom?i.y=n.bottom-e.height-e.y:n.middle&&(i.y=n.middle-Math.round(e.height/2)-e.y),t.moveElements([e],i,e.parent)}))},Ef.prototype.postExecute=function(e){},Pf.$inject=["modeling"],Pf.prototype.preExecute=function(e){var t=e.source;if(!t)throw new Error("source required");var i=e.target||t.parent,n=e.shape,s=e.hints||{};n=e.shape=this._modeling.createShape(n,e.position,i,{attach:s.attach}),e.shape=n},Pf.prototype.postExecute=function(e){var t,i,n=e.hints||{};t=e.source,i=e.shape,ge(t.outgoing,(function(e){return e.target===i}))||(n.connectionTarget===e.source?this._modeling.connect(e.shape,e.source,e.connection):this._modeling.connect(e.source,e.shape,e.connection))},Af.$inject=["canvas","layouter"],Af.prototype.execute=function(e){var t=e.connection,i=e.source,n=e.target,s=e.parent,o=e.parentIndex,a=e.hints;if(!i||!n)throw new Error("source and target required");if(!s)throw new Error("parent required");return t.source=i,t.target=n,t.waypoints||(t.waypoints=this._layouter.layoutConnection(t,a)),this._canvas.addConnection(t,s,o),t},Af.prototype.revert=function(e){var t=e.connection;return this._canvas.removeConnection(t),t.source=null,t.target=null,t};var Rf=Math.round;function Df(e){this._modeling=e}function Vf(e){return!!e.waypoints}Df.$inject=["modeling"],Df.prototype.preExecute=function(e){var t=e.elements,i=e.parent,n=e.parentIndex,s=e.position,o=e.hints,a=this._modeling;pe(t,(function(e){re(e.x)||(e.x=0),re(e.y)||(e.y=0)}));var r=si(ue(t,(function(e){return!e.hidden})));pe(t,(function(e){Vf(e)&&(e.waypoints=be(e.waypoints,(function(e){return{x:Rf(e.x-r.x-r.width/2+s.x),y:Rf(e.y-r.y-r.height/2+s.y)}}))),Ve(e,{x:Rf(e.x-r.x-r.width/2+s.x),y:Rf(e.y-r.y-r.height/2+s.y)})}));var l=Jt(t),c={};pe(t,(function(e){if(Vf(e))c[e.id]=re(n)?a.createConnection(c[e.source.id],c[e.target.id],n,e,e.parent||i,o):a.createConnection(c[e.source.id],c[e.target.id],e,e.parent||i,o);else{var t=Ve({},o);-1===l.indexOf(e)&&(t.autoResize=!1),c[e.id]=re(n)?a.createShape(e,Le(e,["x","y","width","height"]),e.parent||i,n,t):a.createShape(e,Le(e,["x","y","width","height"]),e.parent||i,t)}})),e.elements=ye(c)};var Lf=Math.round;function Tf(e){this._canvas=e}function Bf(e){Tf.call(this,e)}Tf.$inject=["canvas"],Tf.prototype.execute=function(e){var t=e.shape,i=e.position,n=e.parent,s=e.parentIndex;if(!n)throw new Error("parent required");if(!i)throw new Error("position required");return void 0!==i.width?Ve(t,i):Ve(t,{x:i.x-Lf(t.width/2),y:i.y-Lf(t.height/2)}),this._canvas.addShape(t,n,s),t},Tf.prototype.revert=function(e){var t=e.shape;return this._canvas.removeShape(t),t},Xt()(Bf,Tf),Bf.$inject=["canvas"];var Ff=Tf.prototype.execute;Bf.prototype.execute=function(e){var t=e.shape;return function(e){["width","height"].forEach((function(t){void 0===e[t]&&(e[t]=0)}))}(t),t.labelTarget=e.labelTarget,Ff.call(this,e)};var If=Tf.prototype.revert;function jf(e,t){this._canvas=e,this._modeling=t}function Mf(e,t){this._modeling=e,this._elementRegistry=t}function Qf(e,t){this._canvas=e,this._modeling=t}function Wf(e){this._modeling=e}Bf.prototype.revert=function(e){return e.shape.labelTarget=null,If.call(this,e)},jf.$inject=["canvas","modeling"],jf.prototype.execute=function(e){var t=e.connection,i=t.parent;return e.parent=i,e.parentIndex=ui(i.children,t),e.source=t.source,e.target=t.target,this._canvas.removeConnection(t),t.source=null,t.target=null,t},jf.prototype.revert=function(e){var t=e.connection,i=e.parent,n=e.parentIndex;return t.source=e.source,t.target=e.target,di(i.children,t,n),this._canvas.addConnection(t,i),t},Mf.$inject=["modeling","elementRegistry"],Mf.prototype.postExecute=function(e){var t=this._modeling,i=this._elementRegistry;pe(e.elements,(function(e){i.get(e.id)&&(e.waypoints?t.removeConnection(e):t.removeShape(e))}))},Qf.$inject=["canvas","modeling"],Qf.prototype.preExecute=function(e){var t=this._modeling,i=e.shape;Xp(i.incoming,(function(e){t.removeConnection(e,{nested:!0})})),Xp(i.outgoing,(function(e){t.removeConnection(e,{nested:!0})})),Xp(i.children,(function(e){e.waypoints?t.removeConnection(e,{nested:!0}):t.removeShape(e,{nested:!0})}))},Qf.prototype.execute=function(e){var t=this._canvas,i=e.shape,n=i.parent;return e.oldParent=n,e.oldParentIndex=ui(n.children,i),t.removeShape(i),i},Qf.prototype.revert=function(e){var t=this._canvas,i=e.shape,n=e.oldParent,s=e.oldParentIndex;return di(n.children,i,s),t.addShape(i,n),i},Wf.$inject=["modeling"];var Nf={x:"y",y:"x"};function Zf(e,t){this._layouter=e,this._canvas=t}function qf(){}function zf(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function Uf(e){this._modeling=e}function Xf(e){this._helper=new Uf(e)}function Gf(e){this._modeling=e,this._helper=new Uf(e)}function Yf(e){this._modeling=e}function Hf(e){return e.original||e}function Kf(e,t){this._modeling=e,this._rules=t}function Jf(e){this._modeling=e}function em(e){this._modeling=e}function tm(e){return Ve({},e)}function im(e){switch(e){case"n":case"s":return"y";case"w":case"e":return"x"}}function nm(e,t,i){var n=im(i);return/e|s/.test(i)?e[n]>t:/n|w/.test(i)?e[n]<t:void 0}function sm(e,t){return-1!==e.indexOf(t)}function om(e){this._modeling=e}function am(e){var t={};return pe(e,(function(e){t[e.id]=e.hidden,e.children&&(t=Ve({},t,am(e.children)))})),t}function rm(e,t){var i=[];return pe(e,(function(e){e.hidden=t,i=i.concat(e),e.children&&(i=i.concat(rm(e.children,e.collapsed||t)))})),i}function lm(e,t){var i=[];return pe(e,(function(e){e.hidden=t[e.id],i=i.concat(e),e.children&&(i=i.concat(lm(e.children,t)))})),i}function cm(e){this._modeling=e}function hm(e,t){return hi(e&&e.attachers,t)}function dm(e,t,i){if(e){var n=e.attachers;n||(e.attachers=n=[]),di(n,t,i)}}function um(){}function pm(e,t,i){this._eventBus=e,this._elementFactory=t,this._commandStack=i;var n=this;e.on("diagram.init",(function(){n.registerHandlers(i)}))}function fm(e){this._elementRegistry=e}function mm(e,t){pe(t,(function(t,i){e.set(i,t)}))}Wf.prototype.preExecute=function(e){var t=this._modeling,i=e.groups,n=e.axis,s=e.dimension;function o(e,t){e.range.min=Math.min(t[n],e.range.min),e.range.max=Math.max(t[n]+t[s],e.range.max)}function a(e){return e[n]+e[s]/2}function r(e){return e.length-1}function l(e){return e.max-e.min}var c,h,d=i[0],u=r(i),p=i[u],f=0;pe(i,(function(e,c){var h,d,p;e.elements.length<2?c&&c!==i.length-1&&(o(e,e.elements[0]),f+=l(e.range)):(d=(h=Ce(e.elements,n))[0],c===u&&(d=h[r(h)]),p=a(d),e.range=null,pe(h,(function(i){!function(e,i){var s={y:0};s[n]=e-a(i),s[n]&&(s[Nf[n]]=0,t.moveElements([i],s,i.parent))}(p,i),null!==e.range?o(e,i):e.range={min:i[n],max:i[n]+i[s]}})),c&&c!==i.length-1&&(f+=l(e.range)))})),h=Math.abs(p.range.min-d.range.max),(c=Math.round((h-f)/(i.length-1)))<i.length-1||pe(i,(function(e,o){var a,r={};e!==d&&e!==p&&(a=i[o-1],e.range.max=0,pe(e.elements,(function(i,o){r[Nf[n]]=0,r[n]=a.range.max-i[n]+c,e.range.min!==i[n]&&(r[n]+=i[n]-e.range.min),r[n]&&t.moveElements([i],r,i.parent),e.range.max=Math.max(i[n]+i[s],o?e.range.max:0)})))}))},Wf.prototype.postExecute=function(e){},Zf.$inject=["layouter","canvas"],Zf.prototype.execute=function(e){var t=e.connection;return Ve(e,{oldWaypoints:t.waypoints}),t.waypoints=this._layouter.layoutConnection(t,e.hints),t},Zf.prototype.revert=function(e){var t=e.connection;return t.waypoints=e.oldWaypoints,t},qf.prototype.execute=function(e){var t=e.connection,i=e.delta,n=e.newParent||t.parent,s=e.newParentIndex,o=t.parent;return e.oldParent=o,e.oldParentIndex=hi(o.children,t),di(n.children,t,s),t.parent=n,pe(t.waypoints,(function(e){e.x+=i.x,e.y+=i.y,e.original&&(e.original.x+=i.x,e.original.y+=i.y)})),t},qf.prototype.revert=function(e){var t=e.connection,i=t.parent,n=e.oldParent,s=e.oldParentIndex,o=e.delta;return hi(i.children,t),di(n.children,t,s),t.parent=n,pe(t.waypoints,(function(e){e.x-=o.x,e.y-=o.y,e.original&&(e.original.x-=o.x,e.original.y-=o.y)})),t},zf.prototype.add=function(e,t){return this.addAll([e],t)},zf.prototype.addAll=function(e,t){var i=function(e,t,i){ie(t)&&(t=!0),ae(t)&&(i=t,t=!0);var n=ri((i=i||{}).allShapes),s=ri(i.allConnections),o=ri(i.enclosedElements),a=ri(i.enclosedConnections),r=ri(i.topLevel,t&&Oe(e,(function(e){return e.id})));function l(e){r[e.source.id]&&r[e.target.id]&&(r[e.id]=[e]),n[e.source.id]&&n[e.target.id]&&(a[e.id]=o[e.id]=e),s[e.id]=e}return ii(e,(function(e){if(o[e.id]=e,!e.waypoints)return n[e.id]=e,pe(e.incoming,l),pe(e.outgoing,l),e.children;a[e.id]=s[e.id]=e})),{allShapes:n,allConnections:s,topLevel:r,enclosedConnections:a,enclosedElements:o}}(e,!!t,this);return Ve(this,i),this},Uf.prototype.moveRecursive=function(e,t,i){return e?this.moveClosure(this.getClosure(e),t,i):[]},Uf.prototype.moveClosure=function(e,t,i,n,s){var o=this._modeling,a=e.allShapes,r=e.allConnections,l=e.enclosedConnections,c=e.topLevel,h=!1;s&&s.parent===i&&(h=!0),pe(a,(function(e){o.moveShape(e,t,c[e.id]&&!h&&i,{recurse:!1,layout:!1})})),pe(r,(function(e){var n=!!a[e.source.id],s=!!a[e.target.id];l[e.id]&&n&&s?o.moveConnection(e,t,c[e.id]&&!h&&i):o.layoutConnection(e,{connectionStart:n&&bu(e,e.source,t),connectionEnd:s&&vu(e,e.target,t)})}))},Uf.prototype.getClosure=function(e){return(new zf).addAll(e,!0)},Xf.$inject=["modeling"],Xf.prototype.preExecute=function(e){e.closure=this._helper.getClosure(e.shapes)},Xf.prototype.postExecute=function(e){var t,i=e.hints;i&&i.primaryShape&&(t=i.primaryShape,i.oldParent=t.parent),this._helper.moveClosure(e.closure,e.delta,e.newParent,e.newHost,t)},Gf.$inject=["modeling"],Gf.prototype.execute=function(e){var t=e.shape,i=e.delta,n=e.newParent||t.parent,s=e.newParentIndex,o=t.parent;return e.oldBounds=Le(t,["x","y","width","height"]),e.oldParent=o,e.oldParentIndex=hi(o.children,t),di(n.children,t,s),Ve(t,{parent:n,x:t.x+i.x,y:t.y+i.y}),t},Gf.prototype.postExecute=function(e){var t=e.shape,i=e.delta,n=e.hints,s=this._modeling;!1!==n.layout&&(pe(t.incoming,(function(e){s.layoutConnection(e,{connectionEnd:vu(e,t,i)})})),pe(t.outgoing,(function(e){s.layoutConnection(e,{connectionStart:bu(e,t,i)})}))),!1!==n.recurse&&this.moveChildren(e)},Gf.prototype.revert=function(e){var t=e.shape,i=e.oldParent,n=e.oldParentIndex,s=e.delta;return di(i.children,t,n),Ve(t,{parent:i,x:t.x-s.x,y:t.y-s.y}),t},Gf.prototype.moveChildren=function(e){var t=e.delta,i=e.shape;this._helper.moveRecursive(i.children,t,null)},Gf.prototype.getNewParent=function(e){return e.newParent||e.shape.parent},Yf.$inject=["modeling"],Yf.prototype.execute=function(e){var t=e.newSource,i=e.newTarget,n=e.connection,s=e.dockingOrPoints;if(!t&&!i)throw new Error("newSource or newTarget required");return oe(s)&&(e.oldWaypoints=n.waypoints,n.waypoints=s),t&&(e.oldSource=n.source,n.source=t),i&&(e.oldTarget=n.target,n.target=i),n},Yf.prototype.postExecute=function(e){var t=e.connection,i=e.newSource,n=e.newTarget,s=e.dockingOrPoints,o=e.hints||{},a={};o.connectionStart&&(a.connectionStart=o.connectionStart),o.connectionEnd&&(a.connectionEnd=o.connectionEnd),!1!==o.layoutConnection&&(!i||n&&"source"!==o.docking||(a.connectionStart=a.connectionStart||Hf(oe(s)?s[0]:s)),!n||i&&"target"!==o.docking||(a.connectionEnd=a.connectionEnd||Hf(oe(s)?s[s.length-1]:s)),o.newWaypoints&&(a.waypoints=o.newWaypoints),this._modeling.layoutConnection(t,a))},Yf.prototype.revert=function(e){var t=e.oldSource,i=e.oldTarget,n=e.oldWaypoints,s=e.connection;return t&&(s.source=t),i&&(s.target=i),n&&(s.waypoints=n),s},Kf.$inject=["modeling","rules"],Kf.prototype.preExecute=function(e){var t,i=this,n=this._modeling,s=this._rules,o=e.oldShape,a=e.newData,r=e.hints||{};function l(e,t,i){return s.allowed("connection.reconnect",{connection:i,source:e,target:t})}var c,h={x:a.x,y:a.y},d={x:o.x,y:o.y,width:o.width,height:o.height};t=e.newShape=e.newShape||i.createShape(a,h,o.parent,r),o.host&&n.updateAttachment(t,o.host),!1!==r.moveChildren&&(c=o.children.slice(),n.moveElements(c,{x:0,y:0},t,r));var u=o.incoming.slice(),p=o.outgoing.slice();pe(u,(function(e){l(e.source,t,e)&&i.reconnectEnd(e,t,gu(e,t,d),r)})),pe(p,(function(e){var n=e.target;l(t,n,e)&&i.reconnectStart(e,t,mu(e,t,d),r)}))},Kf.prototype.postExecute=function(e){var t=e.oldShape;this._modeling.removeShape(t)},Kf.prototype.execute=function(e){},Kf.prototype.revert=function(e){},Kf.prototype.createShape=function(e,t,i,n){return this._modeling.createShape(e,t,i,n)},Kf.prototype.reconnectStart=function(e,t,i,n){this._modeling.reconnectStart(e,t,i,n)},Kf.prototype.reconnectEnd=function(e,t,i,n){this._modeling.reconnectEnd(e,t,i,n)},Jf.$inject=["modeling"],Jf.prototype.execute=function(e){var t=e.shape,i=e.newBounds,n=e.minBounds;if(void 0===i.x||void 0===i.y||void 0===i.width||void 0===i.height)throw new Error("newBounds must have {x, y, width, height} properties");if(n&&(i.width<n.width||i.height<n.height))throw new Error("width and height cannot be less than minimum height and width");if(!n&&i.width<10||i.height<10)throw new Error("width and height cannot be less than 10px");return e.oldBounds={width:t.width,height:t.height,x:t.x,y:t.y},Ve(t,{width:i.width,height:i.height,x:i.x,y:i.y}),t},Jf.prototype.postExecute=function(e){var t=this._modeling,i=e.shape,n=e.oldBounds;!1!==(e.hints||{}).layout&&(pe(i.incoming,(function(e){t.layoutConnection(e,{connectionEnd:gu(e,i,n)})})),pe(i.outgoing,(function(e){t.layoutConnection(e,{connectionStart:mu(e,i,n)})})))},Jf.prototype.revert=function(e){var t=e.shape,i=e.oldBounds;return Ve(t,{width:i.width,height:i.height,x:i.x,y:i.y}),t},em.$inject=["modeling"],em.prototype.preExecute=function(e){var t=e.delta,i=e.direction,n=e.movingShapes,s=e.resizingShapes,o=e.start,a={};this.moveShapes(n,t),pe(s,(function(e){a[e.id]=function(e){return{x:e.x,y:e.y,height:e.height,width:e.width}}(e)})),this.resizeShapes(s,t,i),this.updateConnectionWaypoints(function(e,t){var i=[];return pe(e.concat(t),(function(n){var s=n.incoming,o=n.outgoing;pe(s.concat(o),(function(n){var s=n.source,o=n.target;(of(e,s)||of(e,o)||of(t,s)||of(t,o))&&(of(i,n)||i.push(n))}))})),i}(n,s),t,i,o,n,s,a)},em.prototype.execute=function(){},em.prototype.revert=function(){},em.prototype.moveShapes=function(e,t){var i=this;pe(e,(function(e){i._modeling.moveShape(e,t,null,{autoResize:!1,layout:!1,recurse:!1})}))},em.prototype.resizeShapes=function(e,t,i){var n=this;pe(e,(function(e){var s=function(e,t,i){var n=e.x,s=e.y,o=e.width,a=e.height,r=i.x,l=i.y;switch(t){case"n":return{x:n,y:s+l,width:o,height:a-l};case"s":return{x:n,y:s,width:o,height:a+l};case"w":return{x:n+r,y:s,width:o-r,height:a};case"e":return{x:n,y:s,width:o+r,height:a};default:throw new Error("unknown direction: "+t)}}(e,i,t);n._modeling.resizeShape(e,s,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},em.prototype.updateConnectionWaypoints=function(e,t,i,n,s,o,a){var r=this,l=s.concat(o);pe(e,(function(e){var c=e.source,h=e.target,d=function(e){return be(e.waypoints,(function(e){return(e=tm(e)).original&&(e.original=tm(e.original)),e}))}(e),u=im(i),p={labelBehavior:!1};sm(l,c)&&sm(l,h)?(d=be(d,(function(e){return nm(e,n,i)&&(e[u]=e[u]+t[u]),e.original&&nm(e.original,n,i)&&(e.original[u]=e.original[u]+t[u]),e})),r._modeling.updateWaypoints(e,d,{labelBehavior:!1})):(sm(l,c)||sm(l,h))&&(sm(s,c)?p.connectionStart=bu(e,c,t):sm(s,h)?p.connectionEnd=vu(e,h,t):sm(o,c)?p.connectionStart=mu(e,c,a[c.id]):sm(o,h)&&(p.connectionEnd=gu(e,h,a[h.id])),r._modeling.layoutConnection(e,p))}))},om.$inject=["modeling"],om.prototype.execute=function(e){var t=e.shape,i=t.children;e.oldChildrenVisibility=am(i),t.collapsed=!t.collapsed;var n=rm(i,t.collapsed);return[t].concat(n)},om.prototype.revert=function(e){var t=e.shape,i=e.oldChildrenVisibility,n=lm(t.children,i);return t.collapsed=!t.collapsed,[t].concat(n)},cm.$inject=["modeling"],cm.prototype.execute=function(e){var t=e.shape,i=e.newHost,n=t.host;return e.oldHost=n,e.attacherIdx=hm(n,t),dm(i,t),t.host=i,t},cm.prototype.revert=function(e){var t=e.shape,i=e.newHost,n=e.oldHost,s=e.attacherIdx;return t.host=n,hm(i,t),dm(n,t,s),t},um.prototype.execute=function(e){var t=e.connection,i=e.newWaypoints;return e.oldWaypoints=t.waypoints,t.waypoints=i,t},um.prototype.revert=function(e){var t=e.connection,i=e.oldWaypoints;return t.waypoints=i,t},pm.$inject=["eventBus","elementFactory","commandStack"],pm.prototype.getHandlers=function(){return{"shape.append":Pf,"shape.create":Tf,"shape.delete":Qf,"shape.move":Gf,"shape.resize":Jf,"shape.replace":Kf,"shape.toggleCollapse":om,spaceTool:em,"label.create":Bf,"connection.create":Af,"connection.delete":jf,"connection.move":qf,"connection.layout":Zf,"connection.updateWaypoints":um,"connection.reconnect":Yf,"elements.create":Df,"elements.move":Xf,"elements.delete":Mf,"elements.distribute":Wf,"elements.align":Ef,"element.updateAttachment":cm}},pm.prototype.registerHandlers=function(e){pe(this.getHandlers(),(function(t,i){e.registerHandler(i,t)}))},pm.prototype.moveShape=function(e,t,i,n,s){"object"==typeof n&&(s=n,n=null);var o={shape:e,delta:t,newParent:i,newParentIndex:n,hints:s||{}};this._commandStack.execute("shape.move",o)},pm.prototype.updateAttachment=function(e,t){var i={shape:e,newHost:t};this._commandStack.execute("element.updateAttachment",i)},pm.prototype.moveElements=function(e,t,i,n){var s,o=(n=n||{}).attach,a=i;!0===o?(s=i,a=i.parent):!1===o&&(s=null);var r={shapes:e,delta:t,newParent:a,newHost:s,hints:n};this._commandStack.execute("elements.move",r)},pm.prototype.moveConnection=function(e,t,i,n,s){"object"==typeof n&&(s=n,n=void 0);var o={connection:e,delta:t,newParent:i,newParentIndex:n,hints:s||{}};this._commandStack.execute("connection.move",o)},pm.prototype.layoutConnection=function(e,t){var i={connection:e,hints:t||{}};this._commandStack.execute("connection.layout",i)},pm.prototype.createConnection=function(e,t,i,n,s,o){"object"==typeof i&&(o=s,s=n,n=i,i=void 0);var a={source:e,target:t,parent:s,parentIndex:i,connection:n=this._create("connection",n),hints:o};return this._commandStack.execute("connection.create",a),a.connection},pm.prototype.createShape=function(e,t,i,n,s){"number"!=typeof n&&(s=n,n=void 0);var o,a,r=(s=s||{}).attach;e=this._create("shape",e),r?(o=i.parent,a=i):o=i;var l={position:t,shape:e,parent:o,parentIndex:n,host:a,hints:s};return this._commandStack.execute("shape.create",l),l.shape},pm.prototype.createElements=function(e,t,i,n,s){oe(e)||(e=[e]),"number"!=typeof n&&(s=n,n=void 0);var o={position:t,elements:e,parent:i,parentIndex:n,hints:s=s||{}};return this._commandStack.execute("elements.create",o),o.elements},pm.prototype.createLabel=function(e,t,i,n){i=this._create("label",i);var s={labelTarget:e,position:t,parent:n||e.parent,shape:i};return this._commandStack.execute("label.create",s),s.shape},pm.prototype.appendShape=function(e,t,i,n,s){s=s||{};var o={source:e,position:i,target:n,shape:t=this._create("shape",t),connection:s.connection,connectionParent:s.connectionParent,hints:s};return this._commandStack.execute("shape.append",o),o.shape},pm.prototype.removeElements=function(e){var t={elements:e};this._commandStack.execute("elements.delete",t)},pm.prototype.distributeElements=function(e,t,i){var n={groups:e,axis:t,dimension:i};this._commandStack.execute("elements.distribute",n)},pm.prototype.removeShape=function(e,t){var i={shape:e,hints:t||{}};this._commandStack.execute("shape.delete",i)},pm.prototype.removeConnection=function(e,t){var i={connection:e,hints:t||{}};this._commandStack.execute("connection.delete",i)},pm.prototype.replaceShape=function(e,t,i){var n={oldShape:e,newData:t,hints:i||{}};return this._commandStack.execute("shape.replace",n),n.newShape},pm.prototype.alignElements=function(e,t){var i={elements:e,alignment:t};this._commandStack.execute("elements.align",i)},pm.prototype.resizeShape=function(e,t,i,n){var s={shape:e,newBounds:t,minBounds:i,hints:n};this._commandStack.execute("shape.resize",s)},pm.prototype.createSpace=function(e,t,i,n,s){var o={delta:i,direction:n,movingShapes:e,resizingShapes:t,start:s};this._commandStack.execute("spaceTool",o)},pm.prototype.updateWaypoints=function(e,t,i){var n={connection:e,newWaypoints:t,hints:i||{}};this._commandStack.execute("connection.updateWaypoints",n)},pm.prototype.reconnect=function(e,t,i,n,s){var o={connection:e,newSource:t,newTarget:i,dockingOrPoints:n,hints:s||{}};this._commandStack.execute("connection.reconnect",o)},pm.prototype.reconnectStart=function(e,t,i,n){n||(n={}),this.reconnect(e,t,e.target,i,Ve(n,{docking:"source"}))},pm.prototype.reconnectEnd=function(e,t,i,n){n||(n={}),this.reconnect(e,e.source,t,i,Ve(n,{docking:"target"}))},pm.prototype.connect=function(e,t,i,n){return this.createConnection(e,t,i||{},e.parent,n)},pm.prototype._create=function(e,t){return t instanceof Wi?t:this._elementFactory.create(e,t)},pm.prototype.toggleCollapse=function(e,t){var i={shape:e,hints:t||{}};this._commandStack.execute("shape.toggleCollapse",i)},fm.$inject=["elementRegistry"],fm.prototype.execute=function(e){var t=e.element,i=e.moddleElement,n=e.properties;if(!i)throw new Error("<moddleElement> required");var s=e.changed||this.getVisualReferences(i).concat(t),o=e.oldProperties||function(e,t){return fe(t,(function(t,i){return t[i]=e.get(i),t}),{})}(i,ve(n));return mm(i,n),e.oldProperties=o,e.changed=s,s},fm.prototype.revert=function(e){var t=e.oldProperties,i=e.moddleElement,n=e.changed;return mm(i,t),n},fm.prototype.getVisualReferences=function(e){var t=this._elementRegistry;return _s(e,"bpmn:DataObject")?function(e,t){return t.filter((function(t){return _s(t,"bpmn:DataObjectReference")&&Es(t).dataObjectRef===e}))}(e,t):[]};var gm={width:0,height:0};function bm(e,t,i,n,s){this._elementRegistry=e,this._moddle=t,this._translate=i,this._modeling=n,this._textRenderer=s}function vm(e,t){return"id"in e&&e.id!==t.id}function wm(e,t){var i=e.businessObject,n=Ps(e);pe(t,(function(e,t){"di"!==t?i.set(t,e):n&&function(e,t){pe(t,(function(t,i){e.set(i,t)}))}(n,e)}))}bm.$inject=["elementRegistry","moddle","translate","modeling","textRenderer"],bm.prototype.execute=function(e){var t=e.element,i=[t],n=this._translate;if(!t)throw new Error(n("element required"));var s=this._elementRegistry,o=this._moddle.ids,a=t.businessObject,r=function(e){var t=Ve({},e);return ym.forEach((function(i){i in e&&(t[i]=Es(t[i]))})),t}(e.properties),l=e.oldProperties||function(e,t){var i=ve(t),n=e.businessObject,s=Ps(e);return fe(i,(function(e,i){return e[i]="di"!==i?n.get(i):function(e,t){return fe(t,(function(t,i){return t[i]=e&&e.get(i),t}),{})}(s,ve(t.di)),e}),{})}(t,r);return vm(r,a)&&(o.unclaim(a.id),s.updateId(t,r.id),o.claim(r.id,a)),"default"in r&&(r.default&&i.push(s.get(r.default.id)),a.default&&i.push(s.get(a.default.id))),wm(t,r),e.oldProperties=l,e.changed=i,i},bm.prototype.postExecute=function(e){var t=e.element.label,i=t&&Es(t).name;if(i){var n=this._textRenderer.getExternalLabelBounds(t,i);this._modeling.resizeShape(t,n,gm)}},bm.prototype.revert=function(e){var t=e.element,i=e.properties,n=e.oldProperties,s=t.businessObject,o=this._elementRegistry,a=this._moddle.ids;return wm(t,n),vm(i,s)&&(a.unclaim(i.id),o.updateId(t,n.id),a.claim(n.id,s)),e.changed};var ym=["default"];function Om(e,t){this._canvas=e,this._modeling=t}function xm(e,t){this._modeling=e,this._spaceTool=t}function $m(e,t){this._modeling=e,this._translate=t}function Cm(e,t){this._modeling=e,this._spaceTool=t}Om.$inject=["canvas","modeling"],Om.prototype.execute=function(e){var t=this._canvas,i=e.newRoot,n=i.businessObject,s=t.getRootElement(),o=s.businessObject,a=o.$parent,r=Ps(s);t.setRootElement(i),t.removeRootElement(s),di(a.rootElements,n),n.$parent=a,hi(a.rootElements,o),o.$parent=null,s.di=null,r.bpmnElement=n,i.di=r,e.oldRoot=s},Om.prototype.revert=function(e){var t=this._canvas,i=e.newRoot,n=i.businessObject,s=e.oldRoot,o=s.businessObject,a=n.$parent,r=Ps(i);t.setRootElement(s),t.removeRootElement(i),hi(a.rootElements,n),n.$parent=null,di(a.rootElements,o),o.$parent=a,i.di=null,r.bpmnElement=o,s.di=r},xm.$inject=["modeling","spaceTool"],xm.prototype.preExecute=function(e){var t=this._spaceTool,i=this._modeling,n=e.shape,s=e.location,o=uh(n),a=o===n,r=a?n:n.parent;dh(r).length||i.createShape({type:"bpmn:Lane"},{x:n.x+ch,y:n.y,width:n.width-ch,height:n.height},r);var l=[];ii(o,(function(e){return l.push(e),e.label&&l.push(e.label),e===n?[]:ue(e.children,(function(e){return e!==n}))}));var c="top"===s?-120:120,h="top"===s?n.y:n.y+n.height,d=h+("top"===s?10:-10),u="top"===s?"n":"s",p=t.calculateAdjustments(l,"y",c,d);t.makeSpace(p.movingShapes,p.resizingShapes,{x:0,y:c},u,d),e.newLane=i.createShape({type:"bpmn:Lane"},{x:n.x+(a?ch:0),y:h-("top"===s?120:0),width:n.width-(a?ch:0),height:120},r)},$m.$inject=["modeling","translate"],$m.prototype.preExecute=function(e){var t=this._modeling,i=this._translate,n=e.shape,s=e.count,o=dh(n),a=o.length;if(a>s)throw new Error(i("more than {count} child lanes",{count:s}));var r,l,c,h,d,u=Math.round(n.height/s);for(d=0;d<s;d++)r=n.y+d*u,l=d===s-1?n.height-u*d:u,c={x:n.x+ch,y:r,width:n.width-ch,height:l},d<a?t.resizeShape(o[d],c):(h={type:"bpmn:Lane"},t.createShape(h,c,n))},Cm.$inject=["modeling","spaceTool"],Cm.prototype.preExecute=function(e){var t=e.shape,i=e.newBounds;!1!==e.balanced?this.resizeBalanced(t,i):this.resizeSpace(t,i)},Cm.prototype.resizeBalanced=function(e,t){var i=this._modeling,n=function(e,t){var i=uh(e),n=hh(i,_s(i,"bpmn:Process")?[]:[i]),s=xi(e),o=xi(t),a=function(e,t){return th(xi(t),xi(e))}(e,t),r=[];return n.forEach((function(t){if(t!==e){var i=0,n=a.right,l=0,c=a.left,h=xi(t);a.top&&(rh(h.bottom-s.top)<10&&(l=o.top-h.bottom),rh(h.top-s.top)<5&&(i=o.top-h.top)),a.bottom&&(rh(h.top-s.bottom)<10&&(i=o.bottom-h.top),rh(h.bottom-s.bottom)<5&&(l=o.bottom-h.bottom)),(i||n||l||c)&&r.push({shape:t,newBounds:ih(t,{top:i,right:n,bottom:l,left:c})})}})),r}(e,t);i.resizeShape(e,t),n.forEach((function(e){i.resizeShape(e.shape,e.newBounds)}))},Cm.prototype.resizeSpace=function(e,t){var i,n,s,o,a,r=this._spaceTool,l=xi(e),c=th(xi(t),l),h=uh(e),d=[],u=[];ii(h,(function(e){return d.push(e),(_s(e,"bpmn:Lane")||_s(e,"bpmn:Participant"))&&u.push(e),e.children})),(c.bottom||c.top)&&(i=c.bottom||c.top,n=e.y+(c.bottom?e.height:0)+(c.bottom?-10:10),s=c.bottom?"s":"n",o=c.top>0||c.bottom<0?-i:i,a=r.calculateAdjustments(d,"y",o,n),r.makeSpace(a.movingShapes,a.resizingShapes,{x:0,y:i},s)),(c.left||c.right)&&(i=c.right||c.left,n=e.x+(c.right?e.width:0)+(c.right?-10:100),s=c.right?"e":"w",o=c.left>0||c.right<0?-i:i,a=r.calculateAdjustments(u,"x",o,n),r.makeSpace(a.movingShapes,a.resizingShapes,{x:i,y:0},s))};var Sm="flowNodeRef",_m="lanes";function km(e){this._elementRegistry=e}function Em(e){this._moddle=e}km.$inject=["elementRegistry"],km.prototype.computeUpdates=function(e,t){var i=[],n=[],s={},o=[];function a(e){-1===i.indexOf(e)&&(o.push(e),i.push(e))}return t.forEach((function(e){var t=uh(e);t&&-1===i.indexOf(t)&&(t.children.filter((function(e){return _s(e,"bpmn:FlowNode")})).forEach(a),i.push(t))})),e.forEach(a),o.forEach((function(e){var t=e.businessObject,i=t.get(_m).slice(),o=function(e){if(!e.parent)return[];var t=function(e){var t=uh(e);return s[t.id]||(s[t.id]=hh(t)),s[t.id]}(e);return t.filter((function(t){return i=e,n=xi(t),s=i.x+i.width/2,o=i.y+i.height/2,s>n.left&&s<n.right&&o>n.top&&o<n.bottom;var i,n,s,o})).map((function(e){return e.businessObject}))}(e);n.push({flowNode:t,remove:i,add:o})})),t.forEach((function(e){var t=e.businessObject;e.parent||t.get(Sm).forEach((function(e){n.push({flowNode:e,remove:[t],add:[]})}))})),n},km.prototype.execute=function(e){var t=e.updates;t||(t=e.updates=this.computeUpdates(e.flowNodeShapes,e.laneShapes)),t.forEach((function(e){var t=e.flowNode,i=t.get(_m);e.remove.forEach((function(e){hi(i,e),hi(e.get(Sm),t)})),e.add.forEach((function(e){di(i,e),di(e.get(Sm),t)}))}))},km.prototype.revert=function(e){e.updates.forEach((function(e){var t=e.flowNode,i=t.get(_m);e.add.forEach((function(e){hi(i,e),hi(e.get(Sm),t)})),e.remove.forEach((function(e){di(i,e),di(e.get(Sm),t)}))}))},Em.$inject=["moddle"],Em.prototype.execute=function(e){var t=this._moddle.ids,i=e.id,n=e.element;e.claiming?t.claim(i,n):t.unclaim(i)},Em.prototype.revert=function(e){var t=this._moddle.ids,i=e.id,n=e.element;e.claiming?t.unclaim(i):t.claim(i,n)};var Pm={fill:void 0,stroke:void 0};function Am(e){this._commandStack=e,this._normalizeColor=function(e){if(e){if(ce(e)){var t=function(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="transparent",t.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(t.fillStyle)?t.fillStyle:null}(e);if(t)return t}throw new Error("invalid color value: "+e)}}}Am.$inject=["commandStack"],Am.prototype.postExecute=function(e){var t=e.elements,i=e.colors||Pm,n=this,s={};"fill"in i&&Ve(s,{"background-color":this._normalizeColor(i.fill)}),"stroke"in i&&Ve(s,{"border-color":this._normalizeColor(i.stroke)}),pe(t,(function(e){var t=function(e){return!!e.waypoints}(e)?Le(s,["border-color"]):s;!function(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}(t),e.labelTarget?n._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:Ps(e).label,properties:{color:s["background-color"]}}):n._commandStack.execute("element.updateProperties",{element:e,properties:{di:t}})}))};var Rm={width:0,height:0};function Dm(e,t,i){function n(e,t){var n=e.label||e,s=e.labelTarget||e;return function(e,t,i){var n=e.businessObject,s=qs(n);s&&("categoryValueRef"===s?n.categoryValueRef.value=t:n[s]=t)}(n,t),function(e,t){if(!mo(e)){var n=Ps(e);t&&!n.label&&(n.label=i.create("bpmndi:BPMNLabel")),!t&&n.label&&(n.label=null)}}(e,t),[n,s]}this.preExecute=function(t){var i=t.element,n=i.businessObject,s=t.newLabel;if(!vo(i)&&mo(i)&&!go(i)&&!Vm(s)){var o=bo(i);o={x:o.x,y:o.y+7},e.createLabel(i,o,{id:n.id+"_label",businessObject:n,di:i.di})}},this.execute=function(e){return e.oldLabel=zs(e.element),n(e.element,e.newLabel)},this.revert=function(e){return n(e.element,e.oldLabel)},this.postExecute=function(i){var n=i.element,s=n.label||n,o=i.newLabel,a=i.newBounds,r=i.hints||{};if(vo(s)||_s(s,"bpmn:TextAnnotation"))if(vo(s)&&Vm(o))!1!==r.removeShape&&e.removeShape(s,{unsetLabel:!1});else{var l=zs(s);void 0===a&&(a=t.getExternalLabelBounds(s,l)),a&&e.resizeShape(s,a,Rm)}}}function Vm(e){return!e||!e.trim()}function Lm(e,t,i,n){pm.call(this,e,t,i),this._bpmnRules=n}function Tm(){}Dm.$inject=["modeling","textRenderer","bpmnFactory"],G()(Lm,pm),Lm.$inject=["eventBus","elementFactory","commandStack","bpmnRules"],Lm.prototype.getHandlers=function(){var e=pm.prototype.getHandlers.call(this);return e["element.updateModdleProperties"]=fm,e["element.updateProperties"]=bm,e["canvas.updateRoot"]=Om,e["lane.add"]=xm,e["lane.resize"]=Cm,e["lane.split"]=$m,e["lane.updateRefs"]=km,e["id.updateClaim"]=Em,e["element.setColor"]=Am,e["element.updateLabel"]=Dm,e},Lm.prototype.updateLabel=function(e,t,i,n){this._commandStack.execute("element.updateLabel",{element:e,newLabel:t,newBounds:i,hints:n||{}})},Lm.prototype.connect=function(e,t,i,n){var s=this._bpmnRules;if(i||(i=s.canConnect(e,t)),i)return this.createConnection(e,t,i,e.parent,n)},Lm.prototype.updateModdleProperties=function(e,t,i){this._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:t,properties:i})},Lm.prototype.updateProperties=function(e,t){this._commandStack.execute("element.updateProperties",{element:e,properties:t})},Lm.prototype.resizeLane=function(e,t,i){this._commandStack.execute("lane.resize",{shape:e,newBounds:t,balanced:i})},Lm.prototype.addLane=function(e,t){var i={shape:e,location:t};return this._commandStack.execute("lane.add",i),i.newLane},Lm.prototype.splitLane=function(e,t){this._commandStack.execute("lane.split",{shape:e,count:t})},Lm.prototype.makeCollaboration=function(){var e=this._create("root",{type:"bpmn:Collaboration"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e},Lm.prototype.updateLaneRefs=function(e,t){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:e,laneShapes:t})},Lm.prototype.makeProcess=function(){var e={newRoot:this._create("root",{type:"bpmn:Process"})};this._commandStack.execute("canvas.updateRoot",e)},Lm.prototype.claimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t,claiming:!0})},Lm.prototype.unclaimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t})},Lm.prototype.setColor=function(e,t){e.length||(e=[e]),this._commandStack.execute("element.setColor",{elements:e,colors:t})},Tm.prototype.layoutConnection=function(e,t){return[(t=t||{}).connectionStart||Ci(t.source||e.source),t.connectionEnd||Ci(t.target||e.target)]};var Bm=Math.round,Fm={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Im(e,t,i){var n,s,o,a=Si(t,e,5),r=i.split(":")[0],l=Bm((t.x-e.x)/2+e.x),c=Bm((t.y-e.y)/2+e.y),h=(o=a,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[r].test(o)),d=/h|r|l/.test(r),u=!1,p=!1;return h?(n=d?{x:l,y:e.y}:{x:e.x,y:c},s=d?"h:h":"v:v"):(u=function(e,t){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[t].test(e)}(a,r),s=d?"h:v":"v:h",u?d?(p=c===e.y,n={x:e.x+20*(/l/.test(r)?-1:1),y:p?c+20:c}):n={x:(p=l===e.x)?l+20:l,y:e.y+20*(/t/.test(r)?-1:1)}:n={x:l,y:c}),{waypoints:Mm(e,n,s).concat(n),directions:s,turnNextDirections:p}}function jm(e){return e.split(":").reverse().join(":")}function Mm(e,t,i){if(!function(e){return e&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(e)}(i=i||"h:h"))throw new Error("unknown directions: <"+i+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(Zm(i)){var n=function(e,t,i){return Im(e,t,i)}(e,t,i),s=function(e,t,i){var n=Im(t,e,jm(i));return{waypoints:n.waypoints.slice().reverse(),directions:jm(n.directions),turnNextDirections:n.turnNextDirections}}(e,t,i),o=function(e,t){var i=e.directions.split(":")[1],n=t.directions.split(":")[0];e.turnNextDirections&&(i="h"==i?"v":"h"),t.turnNextDirections&&(n="h"==n?"v":"h");var s=i+":"+n;return{waypoints:Mm(e.waypoints[e.waypoints.length-1],t.waypoints[0],s),directions:s}}(n,s);return[].concat(n.waypoints,o.waypoints,s.waypoints)}return function(e,t,i){var n=Bm((t.x-e.x)/2+e.x),s=Bm((t.y-e.y)/2+e.y);if("h:v"===i)return[{x:t.x,y:e.y}];if("v:h"===i)return[{x:e.x,y:t.y}];if("h:h"===i)return[{x:n,y:e.y},{x:n,y:t.y}];if("v:v"===i)return[{x:e.x,y:s},{x:t.x,y:s}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(e,t,i)}function Qm(e,t,i,n,s){var o,a,r=(o=s&&s.preferredLayouts||[],a="straight",ie(o)?[]:(function(e){if(!oe(e))throw new Error("must supply array")}(o),a=ke(a),o.filter((function(e,t){return!a(e,t)}))))[0]||"h:h",l=Si(e,t,Fm[r]||0),c=function(e,t){if(Zm(t))return t;switch(e){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return t}}(l,r);i=i||Ci(e),n=n||Ci(t);var h=c.split(":"),d=qm(i,e,h[0],function(e){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[e]}(l));return function(e,t,i){var n=Mm(e,t,i);return n.unshift(e),n.push(t),zm(n)}(d,qm(n,t,h[1],l),c)}function Wm(e,t,i){return function(e,t,i){return e>=t&&e<=i}(t[e],i[e],i[e]+i[{x:"width",y:"height"}[e]])}function Nm(e,t,i,n){if(function(e){return e.length<3||!(e.length>4)&&!!de(e,(function(t,i){var n=e[i-1];return n&&pi(t,n)<3}))}(n))return null;var s,o=n[0],a=n.slice();return a[0]=i,a[1]=function(e,t,i){switch(mi(t,e)){case"v":return{x:i.x,y:e.y};case"h":return{x:e.x,y:i.y}}return{x:e.x,y:e.y}}(a[1],o,i),s=function(e,t,i){var n;for(n=e.length-2;0!==n;n--)if(gi(e[n],t,20)||gi(e[n],i,20))return e.slice(n);return e}(a,e,t),s!==a&&(a=Nm(e,t,i,s)),a&&mi(a)?null:a}function Zm(e){return e&&/t|r|b|l/.test(e)}function qm(e,t,i,n){if("h"===i&&(i=/left/.test(n)?"l":"r"),"v"===i&&(i=/top/.test(n)?"t":"b"),"t"===i)return{original:e,x:e.x,y:t.y};if("r"===i)return{original:e,x:t.x+t.width,y:e.y};if("b"===i)return{original:e,x:e.x,y:t.y+t.height};if("l"===i)return{original:e,x:t.x,y:e.y};throw new Error("unexpected dockingDirection: <"+i+">")}function zm(e){return e.reduce((function(t,i,n){return fi(t[t.length-1],e[n+1],i,0)||t.push(i),t}),[])}var Um={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},Xm={top:"t",right:"r",bottom:"b",left:"l"};function Gm(){}function Ym(e,t){return _s(t,"bpmn:Participant")?"source":_s(e,"bpmn:Participant")?"target":eg(t)?"source":eg(e)||_s(t,"bpmn:Event")?"target":_s(e,"bpmn:Event")?"source":null}function Hm(e){return eg(e)?"target":"source"}function Km(e,t){return e?e.original||e:Ci(t)}function Jm(e,t){return _s(t,"bpmn:Activity")&&_s(e,"bpmn:BoundaryEvent")&&t.businessObject.isForCompensation}function eg(e){return _s(e,"bpmn:SubProcess")&&Ws(e)}function tg(e,t){return e===t}function ig(e){var t=/right|left/.exec(e);return t&&t[0]}function ng(e){var t=/top|bottom/.exec(e);return t&&t[0]}function sg(e){return"right"===e||"left"===e}function og(e,t){var i=t.waypoints,n=i&&i.length&&Si(i[0],e);return"top"===n?["t:r"]:"right"===n?["r:b"]:"left"===n?["l:t"]:["b:l"]}function ag(e,t,i){var n,s,o,a,r=Ci(e),l=Ci(t),c=(a=(o=e).host,Si(Ci(o),a,-10)),h=tg(e.host,t),d=-1!==["top","right","bottom","left"].indexOf(c),u=Si(l,r,{x:e.width/2+t.width/2,y:e.height/2+t.height/2});return h?function(e,t,i,n,s){var o=t?e:ng(e);return[Xm[o]+":"+(t?sg(e)?rg("y",i,n,s)?"h":"b":rg("x",i,n,s)?"v":"l":"v")]}(c,d,e,t,i):(n=function(e,t,i){return i?Xm[e]:tg(ng(e),ng(t))||(n=ig(e),s=ig(t),Um[n]===s)?Xm[ng(e)]:Xm[ig(e)];var n,s}(c,u,d),s=function(e,t,i){return i?sg(e)?(n=t,s=ig(e),o=Um[s],-1!==n.indexOf(o)||tg(e,t)?"h":"v"):function(e,t){var i=ng(e),n=Um[i];return-1!==t.indexOf(n)}(e,t)||tg(e,t)?"v":"h":sg(t)||tg(ng(e),ng(t))&&ig(t)?"h":"v";var n,s,o}(c,u,d),[n+":"+s])}function rg(e,t,i,n){return!(lg(e,n,i,40)||lg(e,n,{x:i.x+i.width,y:i.y+i.height},40)||lg(e,n,Ci(t),40))}function lg(e,t,i,n){return Math.abs(t[e]-i[e])<n}function cg(e){return Ve({original:e.point.original||e.point},e.actual)}function hg(e,t){this._elementRegistry=e,this._graphicsFactory=t}G()(Gm,Tm),Gm.prototype.layoutConnection=function(e,t){t||(t={});var i,n,s=t.source||e.source,o=t.target||e.target,a=t.waypoints||e.waypoints,r=t.connectionStart,l=t.connectionEnd;return r||(r=Km(a&&a[0],s)),l||(l=Km(a&&a[a.length-1],o)),(_s(e,"bpmn:Association")||_s(e,"bpmn:DataAssociation"))&&a&&!Jm(s,o)?[].concat([r],a.slice(1,-1),[l]):(_s(e,"bpmn:MessageFlow")?i=function(e,t){return{preferredLayouts:["straight","v:v"],preserveDocking:Ym(e,t)}}(s,o):(_s(e,"bpmn:SequenceFlow")||Jm(s,o))&&(i=s===o?{preferredLayouts:og(s,e)}:_s(s,"bpmn:BoundaryEvent")?{preferredLayouts:ag(s,o,l)}:eg(s)||eg(o)?function(e){return{preferredLayouts:["straight","h:h"],preserveDocking:Hm(e)}}(s):_s(s,"bpmn:Gateway")?{preferredLayouts:["v:h"]}:_s(o,"bpmn:Gateway")?{preferredLayouts:["h:v"]}:{preferredLayouts:["h:h"]}),i&&(n=zm(function(e,t,i,n,s,o){var a;return oe(i)&&(s=i,o=n,i=Ci(e),n=Ci(t)),s=s||[],a=-1!==(o=Ve({preferredLayouts:[]},o)).preferredLayouts.indexOf("straight")&&function(e,t,i,n,s){var o,a,r={};return a=Si(e,t),/^(top|bottom|left|right)$/.test(a)?(/top|bottom/.test(a)&&(o="x"),/left|right/.test(a)&&(o="y"),"target"===s.preserveDocking?Wm(o,n,e)?(r[o]=n[o],[{x:void 0!==r.x?r.x:i.x,y:void 0!==r.y?r.y:i.y,original:{x:void 0!==r.x?r.x:i.x,y:void 0!==r.y?r.y:i.y}},{x:n.x,y:n.y}]):null:Wm(o,i,t)?(r[o]=i[o],[{x:i.x,y:i.y},{x:void 0!==r.x?r.x:n.x,y:void 0!==r.y?r.y:n.y,original:{x:void 0!==r.x?r.x:n.x,y:void 0!==r.y?r.y:n.y}}]):null):null}(e,t,i,n,o),a||(a=o.connectionEnd&&function(e,t,i,n){var s=n.slice().reverse();return(s=Nm(e,t,i,s))?s.reverse():null}(t,e,n,s),a||(a=o.connectionStart&&Nm(e,t,i,s))||(!o.connectionStart&&!o.connectionEnd&&s&&s.length?s:Qm(e,t,i,n,o)))}(s,o,r,l,a,i=Ve(i,t)))),n||[r,l])},hg.$inject=["elementRegistry","graphicsFactory"],hg.prototype.getCroppedWaypoints=function(e,t,i){t=t||e.source,i=i||e.target;var n=this.getDockingPoint(e,t,!0),s=this.getDockingPoint(e,i),o=e.waypoints.slice(n.idx+1,s.idx);return o.unshift(cg(n)),o.push(cg(s)),o},hg.prototype.getDockingPoint=function(e,t,i){var n,s,o=e.waypoints;return{point:s=o[n=i?0:o.length-1],actual:this._getIntersection(t,e,i)||s,idx:n}},hg.prototype._getIntersection=function(e,t,i){return _i(this._getShapePath(e),this._getConnectionPath(t),i)},hg.prototype._getConnectionPath=function(e){return this._graphicsFactory.getConnectionPath(e)},hg.prototype._getShapePath=function(e){return this._graphicsFactory.getShapePath(e)},hg.prototype._getGfx=function(e){return this._elementRegistry.getGraphics(e)};const dg={__init__:["modeling","bpmnUpdater"],__depends__:[tp,Tp,Fp,Mp,Vc,Wp,Up,Hp,tf,Zo,Jo,xf],bpmnFactory:["type",$f],bpmnUpdater:["type",Cf],elementFactory:["type",_f],modeling:["type",Lm],layouter:["type",Gm],connectionDocking:["type",hg]};var ug=Math.round;function pg(e,t,i,n,s){function o(e,t,i,n){return s.allowed("elements.move",{shapes:e,delta:t,position:i,target:n})}function a(e,i,n,s){if(ae(n)&&(s=n,n=!1),!i.waypoints&&i.parent){var o=function(e){return{x:e.x+ug(e.width/2),y:e.y+ug(e.height/2)}}(i);return t.init(e,o,"shape.move",{cursor:"grabbing",autoActivate:n,data:{shape:i,context:s||{}}}),!0}}e.on("shape.move.start",1500,(function(e){var t=e.context,i=e.shape,s=n.get().slice();-1===s.indexOf(i)&&(s=[i]),s=function(e){var t=Oe(e,"id");return ue(e,(function(e){for(;e=e.parent;)if(t[e.id])return!1;return!0}))}(s),Ve(t,{shapes:s,validatedShapes:s,shape:i})})),e.on("shape.move.start",1250,(function(e){var t=e.context,i=t.validatedShapes;if(!(t.canExecute=o(i)))return!1})),e.on("shape.move.move",500,(function(e){var t,i=e.context,n=i.validatedShapes,s=e.hover,a={x:e.dx,y:e.dy};t=o(n,a,{x:e.x,y:e.y},s),i.delta=a,i.canExecute=t,i.target=null!==t?s:null})),e.on("shape.move.end",(function(e){var t=e.context,n=t.delta,s=t.canExecute,o="attach"===s,a=t.shapes;if(!1===s)return!1;n.x=ug(n.x),n.y=ug(n.y),0===n.x&&0===n.y||i.moveElements(a,n,t.target,{primaryShape:t.shape,attach:o})})),e.on("element.mousedown",(function(e){if(Po(e)){var t=So(e);if(!t)throw new Error("must supply DOM mousedown event");return a(t,e.element)}})),this.start=a}pg.$inject=["eventBus","dragging","modeling","selection","rules"];var fg="djs-dragging",mg="drop-ok",gg="drop-not-ok",bg="new-parent",vg="attach-ok";function wg(e,t,i,n){function s(e){var t=ni(e,!0),i=be(t,(function(e){return(e.incoming||[]).concat(e.outgoing||[])}));return J(t.concat(i))}function o(e,i){[vg,mg,gg,bg].forEach((function(n){n===i?t.addMarker(e,n):t.removeMarker(e,n)}))}e.on("shape.move.start",499,(function(e){var o,a=e.context,r=a.shapes,l=a.allDraggedElements,c=ue(o=s(r),(function(e){return!function(e){return e.waypoints}(e)||de(o,Se({id:e.source.id}))&&de(o,Se({id:e.target.id}))}));if(!a.dragGroup){var h=St("g");ut(h,i.cls("djs-drag-group",["no-events"])),ct(t.getActiveLayer(),h),a.dragGroup=h}c.forEach((function(e){n.addDragger(e,a.dragGroup)})),pe(l=l?J([l,s(r)]):s(r),(function(e){t.addMarker(e,fg)})),a.allDraggedElements=l,a.differentParents=1!==we(Oe(r,(function(e){return e.parent&&e.parent.id})))})),e.on("shape.move.move",499,(function(e){var t=e.context,i=t.dragGroup,n=t.target,s=t.shape.parent,a=t.canExecute;n&&("attach"===a?o(n,vg):t.canExecute&&n&&n.id!==s.id?o(n,bg):o(n,t.canExecute?mg:gg)),en(i,e.dx,e.dy)})),e.on(["shape.move.out","shape.move.cleanup"],(function(e){var t=e.context.target;t&&o(t,null)})),e.on("shape.move.cleanup",(function(e){var i=e.context,n=i.allDraggedElements,s=i.dragGroup;pe(n,(function(e){t.removeMarker(e,fg)})),s&&wt(s)})),this.makeDraggable=function(e,i,s){n.addDragger(i,e.dragGroup),s&&t.addMarker(i,fg),e.allDraggedElements?e.allDraggedElements.push(i):e.allDraggedElements=[i]}}wg.$inject=["eventBus","canvas","styles","previewSupport"];const yg={__depends__:[To,Zo,Fo,jr,Tr,Ul],__init__:["move","movePreview"],move:["type",pg],movePreview:["type",wg]};var Og="open";function xg(e,t){this._eventBus=e,this._canvas=t;var i=this;e.on("tool-manager.update",(function(e){var t=e.tool;i.updateToolHighlight(t)})),e.on("i18n.changed",(function(){i._update()})),e.on("diagram.init",(function(){i._diagramInitialized=!0,i._rebuild()}))}function $g(e,t){var i=t.getPaletteEntries();return le(i)?i(e):(pe(i,(function(t,i){e[i]=t})),e)}xg.$inject=["eventBus","canvas"],xg.prototype.registerProvider=function(e,t){t||(t=e,e=1e3),this._eventBus.on("palette.getProviders",e,(function(e){e.providers.push(t)})),this._rebuild()},xg.prototype.getEntries=function(){return this._getProviders().reduce($g,{})},xg.prototype._rebuild=function(){this._diagramInitialized&&this._getProviders().length&&(this._container||this._init(),this._update())},xg.prototype._init=function(){var e=this,t=this._eventBus,i=this._getParentContainer(),n=this._container=it(xg.HTML_MARKUP);i.appendChild(n),Qe(i).add("djs-palette-shown"),et(n,".djs-palette-toggle, .entry","click",(function(t){var i=t.delegateTarget;if(ze(i,".djs-palette-toggle"))return e.toggle();e.trigger("click",t)})),Ke.bind(n,"mousedown",(function(e){e.stopPropagation()})),et(n,".entry","dragstart",(function(t){e.trigger("dragstart",t)})),t.on("canvas.resized",this._layoutChanged,this),t.fire("palette.create",{container:n})},xg.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},xg.prototype._toggleState=function(e){e=e||{};var t,i=this._getParentContainer(),n=this._container,s=this._eventBus,o=Qe(n),a=Qe(i);t="twoColumn"in e?e.twoColumn:this._needsCollapse(i.clientHeight,this._entries||{}),o.toggle("two-column",t),a.toggle("djs-palette-two-column",t),"open"in e&&(o.toggle(Og,e.open),a.toggle("djs-palette-open",e.open)),s.fire("palette.changed",{twoColumn:t,open:this.isOpen()})},xg.prototype._update=function(){var e=ot(".djs-palette-entries",this._container),t=this._entries=this.getEntries();Ne(e),pe(t,(function(t,i){var n=t.group||"default",s=ot("[data-group="+n+"]",e);s||(s=it('<div class="group" data-group="'+n+'"></div>'),e.appendChild(s));var o=t.html||(t.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),a=it(o);s.appendChild(a),t.separator||(Be(a,"data-action",i),t.title&&Be(a,"title",t.title),t.className&&function(e,t){var i=Qe(e);(oe(t)?t:t.split(/\s+/g)).forEach((function(e){i.add(e)}))}(a,t.className),t.imageUrl&&a.appendChild(it('<img src="'+t.imageUrl+'">')))})),this.open()},xg.prototype.trigger=function(e,t,i){var n,s,o,a=this._entries,r=t.delegateTarget||t.target;if(!r)return t.preventDefault();(n=a[Be(r,"data-action")])&&(s=n.action,o=t.originalEvent||t,le(s)?"click"===e&&s(o,i):s[e]&&s[e](o,i),t.preventDefault())},xg.prototype._layoutChanged=function(){this._toggleState({})},xg.prototype._needsCollapse=function(e,t){return e<46*Object.keys(t).length+50},xg.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},xg.prototype.open=function(){this._toggleState({open:!0})},xg.prototype.toggle=function(e){this.isOpen()?this.close():this.open()},xg.prototype.isActiveTool=function(e){return e&&this._activeTool===e},xg.prototype.updateToolHighlight=function(e){var t;this._toolsContainer||(t=ot(".djs-palette-entries",this._container),this._toolsContainer=ot("[data-group=tools]",t)),pe(this._toolsContainer.children,(function(t){var i=t.getAttribute("data-action");if(i){var n=Qe(t);i=i.replace("-tool",""),n.contains("entry")&&i===e?n.add("highlighted-entry"):n.remove("highlighted-entry")}}))},xg.prototype.isOpen=function(){return Qe(this._container).has(Og)},xg.prototype._getParentContainer=function(){return this._canvas.getContainer()},xg.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';const Cg={__init__:["palette"],palette:["type",xg]};var Sg="crosshair";function _g(e,t,i,n,s,o,a){this._selection=s,this._dragging=i,this._mouse=a;var r=this;o.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),e.on("lasso.selection.end",(function(t){var i=t.originalEvent.target;(t.hover||i instanceof SVGElement)&&e.once("lasso.selection.ended",(function(){r.activateLasso(t.originalEvent,!0)}))})),e.on("lasso.end",(function(e){var t=kg(e),i=n.filter((function(e){return e}));r.select(i,t)})),e.on("lasso.start",(function(e){var i=e.context;i.bbox=kg(e),function(e){var i,n=t.getActiveLayer();ut(i=e.frame=St("rect"),{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),ct(n,i)}(i)})),e.on("lasso.move",(function(e){var t=e.context;t.bbox=kg(e),function(e){var t=e.frame,i=e.bbox;ut(t,{x:i.x,y:i.y,width:i.width,height:i.height})}(t)})),e.on("lasso.cleanup",(function(e){!function(e){e.frame&&wt(e.frame)}(e.context)})),e.on("element.mousedown",1500,(function(e){if(Ro(e))return r.activateLasso(e.originalEvent),!0}))}function kg(e){var t={x:e.x-e.dx,y:e.y-e.dy},i={x:e.x,y:e.y};return t.x<=i.x&&t.y<i.y||t.x<i.x&&t.y<=i.y?{x:t.x,y:t.y,width:i.x-t.x,height:i.y-t.y}:t.x>=i.x&&t.y<i.y||t.x>i.x&&t.y<=i.y?{x:i.x,y:t.y,width:t.x-i.x,height:i.y-t.y}:t.x<=i.x&&t.y>i.y||t.x<i.x&&t.y>=i.y?{x:t.x,y:i.y,width:i.x-t.x,height:t.y-i.y}:t.x>=i.x&&t.y>i.y||t.x>i.x&&t.y>=i.y?{x:i.x,y:i.y,width:t.x-i.x,height:t.y-i.y}:{x:i.x,y:i.y,width:0,height:0}}_g.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],_g.prototype.activateLasso=function(e,t){this._dragging.init(e,"lasso",{autoActivate:t,cursor:Sg,data:{context:{}}})},_g.prototype.activateSelection=function(e,t){this._dragging.init(e,"lasso.selection",{trapClick:!1,autoActivate:t,cursor:Sg,data:{context:{}}})},_g.prototype.select=function(e,t){var i=function(e,t){var i={};return pe(e,(function(e){var n=e;n.waypoints&&(n=si(n)),!re(t.y)&&n.x>t.x&&(i[e.id]=e),!re(t.x)&&n.y>t.y&&(i[e.id]=e),n.x>t.x&&n.y>t.y&&(re(t.width)&&re(t.height)&&n.width+n.x<t.width+t.x&&n.height+n.y<t.height+t.y?i[e.id]=e:re(t.width)&&re(t.height)||(i[e.id]=e))})),i}(e,t);this._selection.select(ye(i))},_g.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)},_g.prototype.isActive=function(){var e=this._dragging.context();return e&&/^lasso/.test(e.prefix)};const Eg={__depends__:[sf,uc],__init__:["lassoTool"],lassoTool:["type",_g]};var Pg=1500,Ag="grab";function Rg(e,t,i,n,s,o){this._dragging=i,this._mouse=o;var a=this,r=n.get("keyboard",!1);s.registerTool("hand",{tool:"hand",dragging:"hand.move"}),e.on("element.mousedown",Pg,(function(e){if(Ao(e))return a.activateMove(e.originalEvent,!0),!1})),r&&r.addListener(Pg,(function(e){if(Dg(e.keyEvent)&&!a.isActive()){var t=a._mouse.getLastMoveEvent();a.activateMove(t,!!t)}}),"keyboard.keydown"),r&&r.addListener(Pg,(function(e){Dg(e.keyEvent)&&a.isActive()&&a.toggle()}),"keyboard.keyup"),e.on("hand.end",(function(t){var i=t.originalEvent.target;if(!(t.hover||i instanceof SVGElement))return!1;e.once("hand.ended",(function(){a.activateMove(t.originalEvent,{reactivate:!0})}))})),e.on("hand.move.move",(function(e){var i=t.viewbox().scale;t.scroll({dx:e.dx*i,dy:e.dy*i})})),e.on("hand.move.end",(function(t){var i=t.context.reactivate;return!Ao(t)&&i&&e.once("hand.move.ended",(function(e){a.activateHand(e.originalEvent,!0,!0)})),!1}))}function Dg(e){return xa(" ",e)}Rg.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"],Rg.prototype.activateMove=function(e,t,i){"object"==typeof t&&(i=t,t=!1),this._dragging.init(e,"hand.move",{autoActivate:t,cursor:Ag,data:{context:i||{}}})},Rg.prototype.activateHand=function(e,t,i){this._dragging.init(e,"hand",{trapClick:!1,autoActivate:t,cursor:Ag,data:{context:{reactivate:i}}})},Rg.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateHand(e,!!e)},Rg.prototype.isActive=function(){var e=this._dragging.context();return!!e&&/^(hand|hand\.move)$/.test(e.prefix)};const Vg={__depends__:[sf,uc],__init__:["handTool"],handTool:["type",Rg]};var Lg="connect-ok",Tg="connect-not-ok";function Bg(e,t,i,n,s,o,a){var r=this;this._dragging=t,this._rules=o,this._mouse=a,s.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),e.on("global-connect.hover",(function(e){var t=e.context,i=e.hover,s=t.canStartConnect=r.canStartConnect(i);null!==s&&(t.startTarget=i,n.addMarker(i,s?Lg:Tg))})),e.on(["global-connect.out","global-connect.cleanup"],(function(e){var t=e.context.startTarget,i=e.context.canStartConnect;t&&n.removeMarker(t,i?Lg:Tg)})),e.on(["global-connect.ended"],(function(t){var n=t.context.startTarget,s={x:t.x,y:t.y};if(r.canStartConnect(n))return e.once("element.out",(function(){e.once(["connect.ended","connect.canceled"],(function(){e.fire("global-connect.drag.ended")})),i.start(null,n,s)})),!1}))}Bg.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"],Bg.prototype.start=function(e,t){this._dragging.init(e,"global-connect",{autoActivate:t,trapClick:!1,data:{context:{}}})},Bg.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();return this.start(e,!!e)},Bg.prototype.isActive=function(){var e=this._dragging.context();return e&&/^global-connect/.test(e.prefix)},Bg.prototype.canStartConnect=function(e){return this._rules.allowed("connection.start",{source:e})};const Fg={__depends__:[Rl,jr,Tr,sf,uc],globalConnect:["type",Bg]};function Ig(e,t,i,n,s,o,a,r){this._palette=e,this._create=t,this._elementFactory=i,this._spaceTool=n,this._lassoTool=s,this._handTool=o,this._globalConnect=a,this._translate=r,e.registerProvider(this)}Ig.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],Ig.prototype.getPaletteEntries=function(e){var t={},i=this._create,n=this._elementFactory,s=this._spaceTool,o=this._lassoTool,a=this._handTool,r=this._globalConnect,l=this._translate;function c(e,t,s,o,a){function r(t){var s=n.createShape(Ve({type:e},a));a&&(Ps(s).isExpanded=a.isExpanded),i.start(t,s)}var c=e.replace(/^bpmn:/,"");return{group:t,className:s,title:o||l("Create {type}",{type:c}),action:{dragstart:r,click:r}}}function h(e){var t=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),s=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:t});i.start(e,[t,s],{hints:{autoSelect:[t]}})}function d(e){i.start(e,n.createParticipantShape())}return Ve(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:l("Activate the hand tool"),action:{click:function(e){a.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:l("Activate the lasso tool"),action:{click:function(e){o.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:l("Activate the create/remove space tool"),action:{click:function(e){s.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:l("Activate the global connect tool"),action:{click:function(e){r.start(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":c("bpmn:StartEvent","event","bpmn-icon-start-event-none",l("Create StartEvent")),"create.intermediate-event":c("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",l("Create Intermediate/Boundary Event")),"create.end-event":c("bpmn:EndEvent","event","bpmn-icon-end-event-none",l("Create EndEvent")),"create.exclusive-gateway":c("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",l("Create Gateway")),"create.task":c("bpmn:Task","activity","bpmn-icon-task",l("Create Task")),"create.data-object":c("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",l("Create DataObjectReference")),"create.data-store":c("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",l("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:l("Create expanded SubProcess"),action:{dragstart:h,click:h}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:l("Create Pool/Participant"),action:{dragstart:d,click:d}},"create.group":c("bpmn:Group","artifact","bpmn-icon-group",l("Create Group"))}),t};const jg={__depends__:[Cg,sc,xf,Eg,Vg,Fg,po],__init__:["paletteProvider"],paletteProvider:["type",Ig]};function Mg(e,t,i,n,s){ea.call(this,e),e.on("shape.move.move",250,(function(e){var o=e.context,a=o.canExecute;o.visualReplacements||(o.visualReplacements={}),a&&a.replacements?function(e){pe(e.canExecute.replacements,(function(o){var a=o.oldElementId,r={type:o.newElementType};if(!e.visualReplacements[a]){var l=t.get(a);Ve(r,{x:l.x,y:l.y});var c=i.createShape(r);n.addShape(c,l.parent);var h=ot('[data-element-id="'+sa()(l.id)+'"]',e.dragGroup);h&&ut(h,{display:"none"});var d=s.addDragger(c,e.dragGroup);e.visualReplacements[a]=d,n.removeShape(c)}}))}(o):function(e){var t=e.visualReplacements;pe(t,(function(i,n){var s=ot('[data-element-id="'+sa()(n)+'"]',e.dragGroup);s&&ut(s,{display:"inline"}),i.remove(),t[n]&&delete t[n]}))}(o)}))}Mg.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"],G()(Mg,ea);const Qg={__depends__:[Ul],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",Mg]};var Wg=["x","y"],Ng=Math.abs;function Zg(e){e.on(["connect.hover","connect.move","connect.end"],1250,(function(e){var t,i=e.context,n=i.canExecute,s=i.start,o=i.hover,a=i.source,r=i.target;e.originalEvent&&Oa(e.originalEvent)||(i.initialConnectionStart||(i.initialConnectionStart=i.connectionStart),n&&o&&function(e,t,i){Wg.forEach((function(n){var s=Ug(n,t);e[n]<t[n]+i?yl(e,n,t[n]+i):e[n]>t[n]+s-i&&yl(e,n,t[n]+s-i)}))}(e,o,function(e){return _s(e,"bpmn:Task")?10:20}(o)),o&&(t=n,ge(["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"],(function(e){return zg(t,e)})))?(i.connectionStart=vl(s),ks(o,["bpmn:Event","bpmn:Gateway"])&&qg(e,vl(o)),ks(o,["bpmn:Task","bpmn:SubProcess"])&&function(e,t){var i=vl(t);Wg.forEach((function(n){(function(e,t,i){return e[i]>t[i]+20&&e[i]<t[i]+Ug(i,t)-20})(e,t,n)&&yl(e,n,i[n])}))}(e,o),_s(a,"bpmn:BoundaryEvent")&&r===a.host&&function(e){var t=e.context,i=t.source,n=t.target;if(!function(e){var t=e.hover,i=e.source;return t&&i&&t===i}(t)){var s=vl(i),o=Si(s,n,-10),a=[];/top|bottom/.test(o)&&a.push("x"),/left|right/.test(o)&&a.push("y"),a.forEach((function(t){var i,n=e[t];Ng(n-s[t])<40&&(i=n>s[t]?s[t]+40:s[t]-40,yl(e,t,i))}))}}(e)):zg(n,"bpmn:MessageFlow")?(_s(s,"bpmn:Event")&&(i.connectionStart=vl(s)),_s(o,"bpmn:Event")&&qg(e,vl(o))):i.connectionStart=i.initialConnectionStart)}))}function qg(e,t){yl(e,"x",t.x),yl(e,"y",t.y)}function zg(e,t){return e&&e.type===t}function Ug(e,t){return"x"===e?t.width:t.height}function Xg(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}function Gg(e){this._snapValues={}}function Yg(e,t,i){var n=this;this._elementRegistry=e,t.on(["create.start","shape.move.start"],(function(e){n.initSnap(e)})),t.on(["create.move","create.end","shape.move.move","shape.move.end"],1250,(function(e){var t=e.context,s=t.shape,o=t.snapContext,a=t.target;if((!e.originalEvent||!Oa(e.originalEvent))&&!wl(e)&&a){var r=o.pointsForTarget(a);r.initialized||((r=n.addSnapTargetPoints(r,s,a)).initialized=!0),i.snap(e,r)}})),t.on(["create.cleanup","shape.move.cleanup"],(function(){i.hide()}))}function Hg(e){return!!e.labelTarget}function Kg(e,t){t.invoke(Yg,this),e.on(["create.move","create.end"],1500,Jg),e.on(["create.move","create.end","shape.move.move","shape.move.end"],1500,(function(e){var t=e.context,i=t.canExecute,n=t.target;i&&("attach"===i||i.attach)&&!wl(e)&&function(e,t){var i,n=xi(t),s=ip(e,t),o=e.context.shape;i=o.parent?{x:0,y:0}:Ci(o),/top/.test(s)?yl(e,"y",n.top-i.y):/bottom/.test(s)&&yl(e,"y",n.bottom-i.y),/left/.test(s)?yl(e,"x",n.left-i.x):/right/.test(s)&&yl(e,"x",n.right-i.x)}(e,n)}))}function Jg(e){var t=e.context.createConstraints;if(t){var i=t.top,n=t.right,s=t.bottom,o=t.left;(o&&o>=e.x||n&&n<=e.x)&&yl(e,"x",e.x),(i&&i>=e.y||s&&s<=e.y)&&yl(e,"y",e.y)}}function eb(e,t){return-1!==e.indexOf(t)}function tb(e,t,i){return t?{x:e.x-i.x,y:e.y-i.y}:{x:e.x,y:e.y}}function ib(e,t){var i=this;e.on(["resize.start"],(function(e){i.initSnap(e)})),e.on(["resize.move","resize.end"],1250,(function(e){var n=e.context,s=n.shape,o=s.parent,a=n.direction,r=n.snapContext;if(!(e.originalEvent&&Oa(e.originalEvent)||wl(e))){var l=r.pointsForTarget(o);l.initialized||((l=i.addSnapTargetPoints(l,s,o,a)).initialized=!0),function(e){return"n"===e||"s"===e}(a)&&yl(e,"x",e.x),function(e){return"e"===e||"w"===e}(a)&&yl(e,"y",e.y),t.snap(e,l)}})),e.on(["resize.cleanup"],(function(){t.hide()}))}function nb(e,t){var i=Ci(e),n=xi(e),s={x:i.x,y:i.y};return-1!==t.indexOf("n")?s.y=n.top:-1!==t.indexOf("s")&&(s.y=n.bottom),-1!==t.indexOf("e")?s.x=n.right:-1!==t.indexOf("w")&&(s.x=n.left),s}function sb(e){this._canvas=e,this._asyncHide=Ae(Re(this.hide,this),1e3)}Zg.$inject=["eventBus"],Xg.prototype.getSnapOrigin=function(e){return this._snapOrigins[e]},Xg.prototype.setSnapOrigin=function(e,t){this._snapOrigins[e]=t,-1===this._snapLocations.indexOf(e)&&this._snapLocations.push(e)},Xg.prototype.addDefaultSnap=function(e,t){var i=this._defaultSnaps[e];i||(i=this._defaultSnaps[e]=[]),i.push(t)},Xg.prototype.getSnapLocations=function(){return this._snapLocations},Xg.prototype.setSnapLocations=function(e){this._snapLocations=e},Xg.prototype.pointsForTarget=function(e){var t=e.id||e,i=this._targets[t];return i||(i=this._targets[t]=new Gg).initDefaults(this._defaultSnaps),i},Gg.prototype.add=function(e,t){var i=this._snapValues[e];i||(i=this._snapValues[e]={x:[],y:[]}),-1===i.x.indexOf(t.x)&&i.x.push(t.x),-1===i.y.indexOf(t.y)&&i.y.push(t.y)},Gg.prototype.snap=function(e,t,i,n){var s=this._snapValues[t];return s&&function(e,t,i){var n,s;for(i=void 0===i?10:i,n=0;n<t.length;n++)if(s=t[n],fl(s-e)<=i)return s}(e[i],s[i],n)},Gg.prototype.initDefaults=function(e){var t=this;pe(e||{},(function(e,i){pe(e,(function(e){t.add(i,e)}))}))},Yg.$inject=["elementRegistry","eventBus","snapping"],Yg.prototype.initSnap=function(e){var t,i=this._elementRegistry,n=e.context,s=n.shape,o=n.snapContext;o||(o=n.snapContext=new Xg);var a=(t=i.get(s.id)?vl(s,e):{x:e.x+vl(s).x,y:e.y+vl(s).y}).x-s.width/2,r=t.y-s.height/2,l=t.x+s.width/2,c=t.y+s.height/2;return o.setSnapOrigin("mid",{x:t.x-e.x,y:t.y-e.y}),Hg(s)||(o.setSnapOrigin("top-left",{x:a-e.x,y:r-e.y}),o.setSnapOrigin("bottom-right",{x:l-e.x,y:c-e.y})),o},Yg.prototype.addSnapTargetPoints=function(e,t,i){return pe(this.getSnapTargets(t,i),(function(i){if(Hg(i))Hg(t)&&e.add("mid",vl(i));else if(i.waypoints){if(i.waypoints.length<3)return;pe(i.waypoints.slice(1,-1),(function(t){e.add("mid",t)}))}else e.add("mid",vl(i))})),re(t.x)&&re(t.y)?(this._elementRegistry.get(t.id)&&e.add("mid",vl(t)),e):e},Yg.prototype.getSnapTargets=function(e,t){return Ol(t).filter((function(e){return!e.hidden}))},G()(Kg,Yg),Kg.$inject=["eventBus","injector"],Kg.prototype.initSnap=function(e){var t=Yg.prototype.initSnap.call(this,e),i=e.shape,n=!!this._elementRegistry.get(i.id);return pe(i.outgoing,(function(i){var s=i.waypoints[0];s=s.original||s,t.setSnapOrigin(i.id+"-docking",tb(s,n,e))})),pe(i.incoming,(function(i){var s=i.waypoints[i.waypoints.length-1];s=s.original||s,t.setSnapOrigin(i.id+"-docking",tb(s,n,e))})),_s(i,"bpmn:Participant")&&t.setSnapLocations(["top-left","bottom-right","mid"]),t},Kg.prototype.addSnapTargetPoints=function(e,t,i){Yg.prototype.addSnapTargetPoints.call(this,e,t,i);var n=this.getSnapTargets(t,i);pe(n,(function(i){var n;(_s(n=i,"bpmn:SubProcess")&&Ws(n)||_s(n,"bpmn:Participant")||("bpmn:TextAnnotation",[t,i].every((function(e){return _s(e,"bpmn:TextAnnotation")}))))&&(e.add("top-left",gl(i)),e.add("bottom-right",bl(i)))}));var s=this._elementRegistry;return pe(t.incoming,(function(i){if(s.get(t.id)){eb(n,i.source)||e.add("mid",Ci(i.source));var o=i.waypoints[0];e.add(i.id+"-docking",o.original||o)}})),pe(t.outgoing,(function(i){if(s.get(t.id)){eb(n,i.target)||e.add("mid",Ci(i.target));var o=i.waypoints[i.waypoints.length-1];e.add(i.id+"-docking",o.original||o)}})),_s(i,"bpmn:SequenceFlow")&&(e=this.addSnapTargetPoints(e,t,i.parent)),e},Kg.prototype.getSnapTargets=function(e,t){return Yg.prototype.getSnapTargets.call(this,e,t).filter((function(e){return!_s(e,"bpmn:Lane")}))},ib.prototype.initSnap=function(e){var t=e.context,i=t.shape,n=t.direction,s=t.snapContext;s||(s=t.snapContext=new Xg);var o=nb(i,n);return s.setSnapOrigin("corner",{x:o.x-e.x,y:o.y-e.y}),s},ib.prototype.addSnapTargetPoints=function(e,t,i,n){return pe(this.getSnapTargets(t,i),(function(t){e.add("corner",bl(t)),e.add("corner",gl(t))})),e.add("corner",nb(t,n)),e},ib.$inject=["eventBus","snapping"],ib.prototype.getSnapTargets=function(e,t){return Ol(t).filter((function(t){return i=e,!(t.host===i||function(e){return!!e.waypoints}(t)||function(e){return!!e.hidden}(t)||function(e){return!!e.labelTarget}(t));var i}))},sb.$inject=["canvas"],sb.prototype.snap=function(e,t){var i=e.context.snapContext,n=i.getSnapLocations(),s={x:wl(e,"x"),y:wl(e,"y")};pe(n,(function(n){var o=i.getSnapOrigin(n),a={x:e.x+o.x,y:e.y+o.y};if(pe(["x","y"],(function(e){var i;s[e]||void 0!==(i=t.snap(a,n,e,7))&&(s[e]={value:i,originValue:i-o[e]})})),s.x&&s.y)return!1})),this.showSnapLine("vertical",s.x&&s.x.value),this.showSnapLine("horizontal",s.y&&s.y.value),pe(["x","y"],(function(t){var i=s[t];ae(i)&&yl(e,t,i.originValue)}))},sb.prototype._createLine=function(e){var t=this._canvas.getLayer("snap"),i=St("path");return ut(i,{d:"M0,0 L0,0"}),bt(i).add("djs-snap-line"),ct(t,i),{update:function(t){re(t)?ut(i,"horizontal"===e?{d:"M-100000,"+t+" L+100000,"+t,display:""}:{d:"M "+t+",-100000 L "+t+", +100000",display:""}):ut(i,{display:"none"})}}},sb.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}},sb.prototype.showSnapLine=function(e,t){var i=this.getSnapLine(e);i&&i.update(t),this._asyncHide()},sb.prototype.getSnapLine=function(e){return this._snapLines||this._createSnapLines(),this._snapLines[e]},sb.prototype.hide=function(){pe(this._snapLines,(function(e){e.update()}))};const ob={__depends__:[{__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",Yg],resizeSnapping:["type",ib],snapping:["type",sb]}],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",Zg],createMoveSnapping:["type",Kg]};function ab(e,t,i,n){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=e,this._eventBus=t,this._overlays=i,this._selection=n,this._container=it(ab.BOX_HTML),this._searchInput=ot(ab.INPUT_SELECTOR,this._container),this._resultsContainer=ot(ab.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),t.on(["canvas.destroy","diagram.destroy"],this.close,this)}function rb(e,t,i){var n=function(e){var t="";return e.forEach((function(e){e.matched?t+='<strong class="'+ab.RESULT_HIGHLIGHT_CLASS+'">'+aa(e.matched)+"</strong>":t+=aa(e.normal)})),""!==t?t:null}(t),s=it(i);s.innerHTML=n,e.appendChild(s)}ab.$inject=["canvas","eventBus","overlays","selection"],ab.prototype._bindEvents=function(){var e=this;function t(t,i,n,s){e._eventMaps.push({el:t,type:n,listener:et(t,i,n,s)})}t(document,"html","click",(function(t){e.close()})),t(this._container,ab.INPUT_SELECTOR,"click",(function(e){e.stopPropagation(),e.delegateTarget.focus()})),t(this._container,ab.RESULT_SELECTOR,"mouseover",(function(t){t.stopPropagation(),e._scrollToNode(t.delegateTarget),e._preselect(t.delegateTarget)})),t(this._container,ab.RESULT_SELECTOR,"click",(function(t){t.stopPropagation(),e._select(t.delegateTarget)})),t(this._container,ab.INPUT_SELECTOR,"keydown",(function(e){38===e.keyCode&&e.preventDefault(),40===e.keyCode&&e.preventDefault()})),t(this._container,ab.INPUT_SELECTOR,"keyup",(function(t){if(27===t.keyCode)return e.close();if(13===t.keyCode){var i=e._getCurrentResult();return i?e._select(i):e.close()}return 38===t.keyCode?e._scrollToDirection(!0):40===t.keyCode?e._scrollToDirection():void(37!==t.keyCode&&39!==t.keyCode&&e._search(t.delegateTarget.value))}))},ab.prototype._unbindEvents=function(){this._eventMaps.forEach((function(e){tt(e.el,e.type,e.listener)}))},ab.prototype._search=function(e){var t=this;if(this._clearResults(),e&&""!==e){var i=this._searchProvider.find(e);if(i.length){i.forEach((function(e){var i=e.element.id,n=t._createResultNode(e,i);t._results[i]={element:e.element,node:n}}));var n=ot(ab.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(n),this._preselect(n)}}},ab.prototype._scrollToDirection=function(e){var t=this._getCurrentResult();if(t){var i=e?t.previousElementSibling:t.nextElementSibling;i&&(this._scrollToNode(i),this._preselect(i))}},ab.prototype._scrollToNode=function(e){if(e&&e!==this._getCurrentResult()){var t=e.offsetTop,i=this._resultsContainer.scrollTop,n=t-this._resultsContainer.clientHeight+e.clientHeight;t<i?this._resultsContainer.scrollTop=t:i<n&&(this._resultsContainer.scrollTop=n)}},ab.prototype._clearResults=function(){Ne(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")},ab.prototype._getCurrentResult=function(){return ot(ab.RESULT_SELECTED_SELECTOR,this._resultsContainer)},ab.prototype._createResultNode=function(e,t){var i=it(ab.RESULT_HTML);return e.primaryTokens.length>0&&rb(i,e.primaryTokens,ab.RESULT_PRIMARY_HTML),rb(i,e.secondaryTokens,ab.RESULT_SECONDARY_HTML),Be(i,ab.RESULT_ID_ATTRIBUTE,t),this._resultsContainer.appendChild(i),i},ab.prototype.registerProvider=function(e){this._searchProvider=e},ab.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,Qe(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))},ab.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,Qe(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))},ab.prototype.toggle=function(){this.isOpen()?this.close():this.open()},ab.prototype.isOpen=function(){return this._open},ab.prototype._preselect=function(e){var t=this._getCurrentResult();if(e!==t){t&&Qe(t).remove(ab.RESULT_SELECTED_CLASS);var i=Be(e,ab.RESULT_ID_ATTRIBUTE),n=this._results[i].element;Qe(e).add(ab.RESULT_SELECTED_CLASS),this._resetOverlay(n),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.preselected",n)}},ab.prototype._select=function(e){var t=Be(e,ab.RESULT_ID_ATTRIBUTE),i=this._results[t].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(i,{top:400}),this._selection.select(i),this._eventBus.fire("searchPad.selected",i)},ab.prototype._resetOverlay=function(e){if(this._overlayId&&this._overlays.remove(this._overlayId),e){var t=(i=si(e),n=i.width+12,{position:{bottom:(s=i.height+12)-6,right:n-6},show:!0,html:'<div style="'+["width: "+n+"px","height: "+s+"px"].join("; ")+'" class="'+ab.OVERLAY_CLASS+'"></div>'});this._overlayId=this._overlays.add(e,t)}var i,n,s},ab.CONTAINER_SELECTOR=".djs-search-container",ab.INPUT_SELECTOR=".djs-search-input input",ab.RESULTS_CONTAINER_SELECTOR=".djs-search-results",ab.RESULT_SELECTOR=".djs-search-result",ab.RESULT_SELECTED_CLASS="djs-search-result-selected",ab.RESULT_SELECTED_SELECTOR="."+ab.RESULT_SELECTED_CLASS,ab.RESULT_ID_ATTRIBUTE="data-result-id",ab.RESULT_HIGHLIGHT_CLASS="djs-search-highlight",ab.OVERLAY_CLASS="djs-search-overlay",ab.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>',ab.RESULT_HTML='<div class="djs-search-result"></div>',ab.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>',ab.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const lb={__depends__:[Ho,Zo],searchPad:["type",ab]};function cb(e,t,i){this._elementRegistry=e,this._canvas=i,t.registerProvider(this)}function hb(e){return ue(e,(function(e){return!!e.matched})).length>0}function db(e,t){var i=[],n=e;if(!e)return i;e=e.toLowerCase(),t=t.toLowerCase();var s=e.indexOf(t);return s>-1?(0!==s&&i.push({normal:n.substr(0,s)}),i.push({matched:n.substr(s,t.length)}),t.length+s<e.length&&i.push({normal:n.substr(t.length+s,e.length)})):i.push({normal:n}),i}cb.$inject=["elementRegistry","searchPad","canvas"],cb.prototype.find=function(e){var t=this._canvas.getRootElement(),i=this._elementRegistry.filter((function(e){return!e.labelTarget}));return i=ue(i,(function(e){return e!==t})),Ce(i=ue(i=be(i,(function(t){return{primaryTokens:db(zs(t),e),secondaryTokens:db(t.id,e),element:t}})),(function(e){return hb(e.primaryTokens)||hb(e.secondaryTokens)})),(function(e){return zs(e.element)+e.element.id}))};const ub={__depends__:[lb],__init__:["bpmnSearch"],bpmnSearch:["type",cb]};function pb(e){Qs.call(this,e)}G()(pb,Qs),pb.Viewer=ya,pb.NavigatedViewer=Ga,pb.prototype.createDiagram=xs((function(){return this.importXML('<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>')})),pb.prototype._interactionModules=[La,Wa,sr,Xa],pb.prototype._modelingModules=[hr,xr,Fr,Er,Sl,Rl,Vl,mh,Sc,sc,yh,_h,Mh,Wh,Zh,Kh,md,dg,yg,jg,Qg,rd,ob,ub],pb.prototype._modules=[].concat(ya.prototype._modules,pb.prototype._interactionModules,pb.prototype._modelingModules);var fb=i(3379),mb=i.n(fb),gb=i(7795),bb=i.n(gb),vb=i(569),wb=i.n(vb),yb=i(3565),Ob=i.n(yb),xb=i(9216),$b=i.n(xb),Cb=i(4589),Sb=i.n(Cb),_b=i(1629),kb={};kb.styleTagTransform=Sb(),kb.setAttributes=Ob(),kb.insert=wb().bind(null,"head"),kb.domAPI=bb(),kb.insertStyleElement=$b(),mb()(_b.Z,kb),_b.Z&&_b.Z.locals&&_b.Z.locals;var Eb=i(2622),Pb={};Pb.styleTagTransform=Sb(),Pb.setAttributes=Ob(),Pb.insert=wb().bind(null,"head"),Pb.domAPI=bb(),Pb.insertStyleElement=$b(),mb()(Eb.Z,Pb),Eb.Z&&Eb.Z.locals&&Eb.Z.locals;var Ab=i(5367),Rb={};Rb.styleTagTransform=Sb(),Rb.setAttributes=Ob(),Rb.insert=wb().bind(null,"head"),Rb.domAPI=bb(),Rb.insertStyleElement=$b(),mb()(Ab.Z,Rb),Ab.Z&&Ab.Z.locals&&Ab.Z.locals;class Db extends Gt{constructor(e,t){super(e,1500),this.bpmnRenderer=t}canRender(e){return ks(e,["bpmn:Task","bpmn:Event","bpmn:ExclusiveGateway"])&&!e.labelTarget}drawShape(e,t){const i=this.bpmnRenderer.drawShape(e,t);if(t.___abwarnings){const t=function(e,t,i){let n=[{x:0,y:0},{x:t,y:0},{x:t/2,y:-20}].map((function(e){return e.x+","+e.y})).join(" ");const s=St("polygon");return ut(s,{points:n,stroke:"#f90",strokeWidth:2,fill:"#f90"}),ct(e,s),s}(e,20);ut(t,{transform:"translate(-10, 10)"})}return i}getShapePath(e){return _s(e,"bpmn:Task")?Ks(e,2):this.bpmnRenderer.getShapePath(e)}}function Vb(){return Db}function Lb(e,t,i,n,s,o,a){this._palette=e,this._create=t,this._elementFactory=i,this._spaceTool=n,this._lassoTool=s,this._handTool=o,this._translate=a,e.registerProvider(this)}Db.$inject=["eventBus","bpmnRenderer"],Lb.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","translate","eventBus"],Lb.prototype.getPaletteEntries=function(){var e=this._create,t=this._elementFactory,i=this._spaceTool,n=this._lassoTool,s=this._handTool,o=this._translate;function a(i,n,s,a,r){function l(n){var s={type:i};if(r)for(var o in r)s[o]=r[o];var a=t.createShape(s);r&&(a.businessObject.di.isExpanded=r.isExpanded),e.start(n,a)}var c=i.replace(/^bpmn:/,"");return{group:n,className:s,title:a||o("Create {type}",{type:c}),action:{dragstart:l,click:l}}}function r(i,n){e.start(i,t.createParticipantShape(n))}return{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:o("Activate the hand tool"),action:{click:function(e){s.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:o("Activate the lasso tool"),action:{click:function(e){n.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:o("Activate the create/remove space tool"),action:{click:function(e){i.activateSelection(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":a("bpmn:StartEvent","event","bpmn-icon-start-event-none"),"create.end-event":a("bpmn:EndEvent","event","bpmn-icon-end-event-none"),"create.exclusive-gateway":a("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-xor"),"create.task":a("bpmn:Task","activity","bpmn-icon-task"),"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:o("Create Pool/Participant"),action:{dragstart:r,click:r}}}};const Tb=["bpmn:Task","bpmn:StartEvent","bpmn:EndEvent"];function Bb(e,t){0==e.length?t():e.shift()((i=>{if(i)return t(i);Bb(e,t)}))}function Fb(e){return"bpmn:SubProcess"==e.parent?.type}function Ib(e){const t="ui_work_process_workspace_model",i=e.Config.uiSettings(),s=(0,n.Z)(e),o=s.L(),r=a(e,`${t}_view_warnings`),l=function(e){const t=Vb(),i=Lb,n=function(e){const t=e.Class.ABProcessTaskManager;function i(e,t,i,n,s,o){this._popupMenu=e,this._modeling=t,this._moddle=i,this._bpmnReplace=n,this._rules=s,this._translate=o,this.register()}return i.$inject=["popupMenu","modeling","moddle","bpmnReplace","rules","translate"],i.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)},i.prototype.getEntries=function(e){var i,n=e.businessObject;if(!this._rules.allowed("shape.replace",{element:e}))return[];var s=Lc(e);return _s(n,"bpmn:StartEvent")&&!Ns(n.$parent)?n.$parent&&"bpmn:SubProcess"==n.$parent.$type?[]:(i=ue(t.StartEvents(),s),this._createEntries(e,i)):_s(n,"bpmn:Participant")?(i=ue(Gc,(function(e){return Ws(n)!==e.target.isExpanded})),this._createEntries(e,i)):_s(n,"bpmn:StartEvent")&&Ns(n.$parent)?n.$parent&&"bpmn:SubProcess"==n.$parent.$type?[]:(i=ue(Uc,(function(t){var i=!1!==t.target.isInterrupting,n=Es(e).isInterrupting===i;return s(t)||!s(t)&&!n})),this._createEntries(e,i)):_s(n,"bpmn:EndEvent")?(i=ue(t.EndEvents(),(function(e){return!("bpmn:CancelEventDefinition"==e.target.eventDefinitionType&&!_s(n.$parent,"bpmn:Transaction"))&&s(e)})),this._createEntries(e,i)):_s(n,"bpmn:BoundaryEvent")?(i=ue(zc,(function(e){var t=e.target;if("bpmn:CancelEventDefinition"==t.eventDefinition&&!_s(n.attachedToRef,"bpmn:Transaction"))return!1;var i=!1!==t.cancelActivity,o=n.cancelActivity==i;return s(e)||!s(e)&&!o})),this._createEntries(e,i)):_s(n,"bpmn:IntermediateCatchEvent")||_s(n,"bpmn:IntermediateThrowEvent")?(i=ue(Fc,s),this._createEntries(e,i)):_s(n,"bpmn:Gateway")?(i=ue(t.Gateways(),s),this._createEntries(e,i)):_s(n,"bpmn:Transaction")?(i=ue(Qc,s),this._createEntries(e,i)):Ns(n)&&Ws(n)?(i=ue(Wc,s),this._createEntries(e,i)):_s(e,"bpmn:SubProcess")&&Ws(e)?(i=ue(Mc,s),this._createEntries(e,i)):_s(n,"bpmn:AdHocSubProcess")&&!Ws(n)?(i=ue(Nc,(function(t){var i=t.target,n="bpmn:SubProcess"===i.type,s=!0===i.isExpanded;return Lc(e)&&(!n||s)})),this._createEntries(e,i)):_s(n,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,Xc):_s(n,"bpmn:FlowNode")?(i=ue(t.Tasks(),s),_s(n,"bpmn:SubProcess")&&!Ws(n)&&(i=ue(i,(function(e){return"Sub Process (collapsed)"!==e.label}))),this._createEntries(e,i)):[]},i.prototype.getHeaderEntries=function(e){var t=[];return _s(e,"bpmn:Activity")&&!Ns(e)&&(t=t.concat(this._getLoopEntries(e))),!_s(e,"bpmn:SubProcess")||_s(e,"bpmn:Transaction")||Ns(e)||t.push(this._getAdHocEntry(e)),t},i.prototype._createEntries=function(e,t){var i=[],n=this;return pe(t,(function(t){var s=n._createMenuEntry(t,e);i.push(s)})),i},i.prototype._createSequenceFlowEntries=function(e,t){var i=Es(e),n=[],s=this._modeling,o=this._moddle,a=this;return pe(t,(function(t){switch(t.actionName){case"replace-with-default-flow":i.sourceRef.default!==i&&(_s(i.sourceRef,"bpmn:ExclusiveGateway")||_s(i.sourceRef,"bpmn:InclusiveGateway")||_s(i.sourceRef,"bpmn:ComplexGateway")||_s(i.sourceRef,"bpmn:Activity"))&&n.push(a._createMenuEntry(t,e,(function(){s.updateProperties(e.source,{default:i})})));break;case"replace-with-conditional-flow":!i.conditionExpression&&_s(i.sourceRef,"bpmn:Activity")&&n.push(a._createMenuEntry(t,e,(function(){var t=o.create("bpmn:FormalExpression",{body:""});s.updateProperties(e,{conditionExpression:t})})));break;default:if(_s(i.sourceRef,"bpmn:Activity")&&i.conditionExpression)return n.push(a._createMenuEntry(t,e,(function(){s.updateProperties(e,{conditionExpression:void 0})})));if((_s(i.sourceRef,"bpmn:ExclusiveGateway")||_s(i.sourceRef,"bpmn:InclusiveGateway")||_s(i.sourceRef,"bpmn:ComplexGateway")||_s(i.sourceRef,"bpmn:Activity"))&&i.sourceRef.default===i)return n.push(a._createMenuEntry(t,e,(function(){s.updateProperties(e.source,{default:void 0})})))}})),n},i.prototype._createMenuEntry=function(e,t,i){var n=this._translate,s=this._bpmnReplace.replaceElement;i=i||function(){return s(t,e.target)};let o=e.label;return"function"==typeof e.label&&(o=e.label(t)),{label:n(o),className:e.className,id:e.actionName,action:i}},i.prototype._getLoopEntries=function(e){var t=this,i=this._translate;function n(i,n){var s;n.active?s=void 0:(s=t._moddle.create(n.options.loopCharacteristics),n.options.isSequential&&(s.isSequential=n.options.isSequential)),t._modeling.updateProperties(e,{loopCharacteristics:s})}var s,o,a,r=Es(e).loopCharacteristics;return r&&(s=r.isSequential,o=void 0===r.isSequential,a=void 0!==r.isSequential&&!r.isSequential),[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:i("Parallel Multi Instance"),active:a,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:i("Sequential Multi Instance"),active:s,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:i("Loop"),active:o,action:n,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}]},i.prototype._getAdHocEntry=function(e){var t=this._translate,i=_s(Es(e),"bpmn:AdHocSubProcess"),n=this._bpmnReplace.replaceElement;return{id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:i,action:function(){return n(e,i?{type:"bpmn:SubProcess"}:{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}}},i}(e);return{__init__:["customRenderer","paletteProvider","replaceMenuProvider"],customRenderer:["type",t],paletteProvider:["type",i],replaceMenuProvider:["type",n]}}(e),c=(0,N.Z)(e);return new class extends s{constructor(){super(t,{button:"",component:"",modeler:"",modelerBroken:"",modelerWorking:"",properties:"",propertyPanel:""}),this.viewer=null,this.unsavedChanges=!1,this.CurrentPropertiesObj=null,this.panelsByType={},this.panelSelectElement={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("Select an element to edit.")}</div>`},this.panelGenericEndEvent={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("This is a generic BPMN End Event placeholder. Change it to one of our Specific End Event Types to edit.")}</div>`},this.panelGenericTrigger={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("This is a generic BPMN Trigger placeholder. Change it to one of our Specific Trigger Types to edit.")}</div>`},this.panelGenericService={id:this.ids.properties,view:"template",template:`<div id="${this.ids.properties}_div">${o("This is a generic BPMN Task placeholder. Change it to one of our Specific Tasks to edit.")}</div>`}}ui(){let e=this.ids;return{id:e.component,css:"bg_gray",rows:[{id:e.button,view:"button",css:"webix_primary",type:"form",label:o("Save"),icon:"fa fa-save",click:()=>{this.saveProcess(this.CurrentProcess)}},{id:e.modelerWorking,cols:[{view:"template",template:`<div id="${e.modeler}" style="width: 100%; height: 100%;"></div>`},{view:"resizer",css:"bg_gray",width:11},{width:i.columnWidthXXLarge,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{type:"spacer",width:15},{view:"label",label:o("Properties")}]},{view:"scrollview",id:e.propertyPanel,body:{padding:15,rows:[{id:e.properties,view:"template",template:`<div id="${e.properties}_div">properties here!</div>`}]}}]}]},{id:e.modelerBroken,view:"template",template:'<div  style="width: 100%; height: 100%;"> Big Broken Icon Here </div>'},r.ui()]}}init(e){this.AB=e;let t=this.ids;$$(t.button)?.hide(),$$(t.modelerBroken)?.hide(),$$(t.modelerWorking)?.show(),c.processElements().forEach((e=>{this.panelsByType[e.key]=new e})),webix.ui(this.panelSelectElement,$$(t.properties))}applicationLoad(e){super.applicationLoad(e),Object.keys(this.panelsByType).forEach((t=>{this.panelsByType[t].applicationLoad(e)}))}checkKnownElement(e,t){const i=this.CurrentProcess.elementForDiagramID(e.id);if(Tb.indexOf(e.type)>-1&&!i){let i=t?.type??"unknown";i=e.parent?.type??e.businessObject?.$parent?.$type??i,"bpmn:SubProcess"!=i||-1==["bpmn:StartEvent","bpmn:EndEvent"].indexOf(e.type)?(e.___abwarnings=["generic task"],this.CurrentProcess.unknownShape(e),this.emit("warnings")):delete e.___abwarnings}if(i){const t=i.warnings();t.length>0&&(e.___abwarnings=t)}}clearWorkspace(){this.CurrentProcessID=null,this.unsavedChanges=!1}async saveProcess(e){this.CurrentPropertiesObj&&this.propertiesSave();try{let{xml:t}=await this.viewer.saveXML({preamble:!0});e.modelUpdate(t),await e.save(),this.unsavedChanges=!1,this.warningsRefresh(this.CurrentProcess),r.show(this.CurrentProcess),$$(this.ids.button).hide()}catch(e){this.AB.notify.developer(e,{context:"ui_work_process_workspace_model:saveProcess()"})}}processLoad(e){var t=this.ids;if(this.initDependencies(),Object.keys(this.panelsByType).forEach((t=>{this.panelsByType[t]?.processLoad?.(e)})),!this.viewer){$$(t.modelerBroken).hide(),$$(t.modelerWorking).show();const e=document.getElementById(t.modeler);this.viewer=new pb({container:e,additionalModules:[l],moddleExtensions:{ab:{name:"AppBuilder",uri:"http://some-company/schema/bpmn/ab",prefix:"ab",xml:{tagAlias:"lowerCase"},types:[{name:"SignalLifecycle",extends:["bpmn:SignalEventDefinition"],properties:[]},{name:"SignalTriggerTimer",extends:["bpmn:SignalEventDefinition"],properties:[]}],emumerations:[],associations:[]}}}),this.viewer.on(["bpmnElement.added"],(e=>{var t=e.element;"bpmn:SequenceFlow"!=t.type&&"bpmn:MessageFlow"!=t.type||this.CurrentProcess?.connectionUpsert(t)})),this.viewer.on("shape.add",(e=>{this.checkKnownElement(e.element,e.parent)})),this.viewer.on("shape.remove",(e=>{if(this.CurrentProcess){let n=this.CurrentProcess;var t=e.element;if(Fb(t)&&(n=this.CurrentProcess.elementForDiagramID(t.parent.id)||this.CurrentProcess),"bpmn:SequenceFlow"==t.type||"bpmn:MessageFlow"==t.type)n.connectionRemove(t);else{var i=n.elementForDiagramID(t.id);i&&i.destroy(),this.CurrentProcess.connectionsIncoming(t.id).forEach((e=>{this.CurrentProcess.connectionRemove(e);var t=this.CurrentProcess.elementForDiagramID(e.from);t&&(t.warningsEval(),this.timedUpdate(t))}))}this.CurrentProcess.unknownShapeRemove(t)}})),this.viewer.on("element.changed",(e=>{let i=e.element;if("label"==i.type)return;let n=this.CurrentProcess;if(Fb(i)&&(n=this.CurrentProcess.elementForDiagramID(i.parent.id)||this.CurrentProcess),null!=n)if("bpmn:SequenceFlow"!=i.type&&"bpmn:MessageFlow"!=i.type){var s=n.elementForDiagramID(i.id);if(s)s.onChange(i,t.properties);else if(this.viewer.get("elementRegistry").get(i.id)){var o=null,a=null;e.element.businessObject.eventDefinitions&&(o=e.element.businessObject.eventDefinitions[0]),o&&(a=o.$type),-1==Tb.indexOf(i.type)||a?n.elementNewForModelDefinition(i)?this.viewer.get("canvas").removeMarker(i.id,"highlight-undefined-task"):this.AB.notify.developer(new Error("no ProcessElement for BPMN Element"),{element:i}):this.viewer.get("canvas").addMarker(i.id,"highlight-undefined-task")}}else{n.connectionUpsert(i);let e=this.CurrentProcess.connectionForDiagramID(i.id);if(e){let t=this.CurrentProcess.elementForDiagramID(e.from);if(t)if(t.___pendingUpdate)t.___pendingUpdate--,0==t.___pendingUpdate&&delete t.___pendingUpdate;else{let e=t.diagramProperties(this.viewer);e=e.filter((e=>e.id.indexOf("Flow")>-1)),e.length>0&&(t.___pendingUpdate=e.length),t.warningsEval(),this.timedUpdate(t)}}}})),this.viewer.on("selection.changed",(e=>{if(this.CurrentProcess)if(1==e.newSelection.length){let n=e.newSelection[0];var i=this.CurrentProcess.elementForDiagramID(n.id);if(Fb(n)&&null==i){let e=this.CurrentProcess.elementForDiagramID(n.parent.id);e&&(i=e.elementForDiagramID(n.id))}if(i)this.CurrentPropertiesObj&&this.CurrentPropertiesObj.diagramID!=i.diagramID&&this.propertiesSave(),this.CurrentPropertiesObj=i,this.CurrentPropertiesObj._handlerSwitchTo||(this.CurrentPropertiesObj._handlerSwitchTo=e=>{this.CurrentPropertiesObj=e,this.panelShow(e)},this.CurrentPropertiesObj.on("switchTo",this.CurrentPropertiesObj._handlerSwitchTo)),this.panelShow(i),this.CurrentPropertiesObj._handlerSave||(this.CurrentPropertiesObj._handlerSave=()=>{this.saveProcess(this.CurrentProcess),this.CurrentPropertiesObj?.propertiesShow(t.properties)},this.CurrentPropertiesObj.on("save",this.CurrentPropertiesObj._handlerSave));else{this.CurrentPropertiesObj=null,Fb(n)&&-1!=["bpmn:StartEvent","bpmn:EndEvent"].indexOf(n.type)||console.warn("Selected Element is unknown to this Process: "+e.newSelection[0].id);let i=this.panelSelectElement;switch(n.type){case"bpmn:EndEvent":i=this.panelGenericEndEvent;break;case"bpmn:StartEvent":i=this.panelGenericTrigger;break;case"bpmn:Task":i=this.panelGenericService}webix.ui(i,$$(t.properties)),this.CurrentPanel=i}}else this.CurrentPropertiesObj&&this.propertiesSave(),this.CurrentPropertiesObj=null,$$(t.properties).hide()})),this.viewer.on("commandStack.changed",(()=>{this.unsavedChanges=!0,$$(t.button).show()}))}var i=[];this.CurrentProcess&&this.unsavedChanges&&i.push((e=>{webix.confirm({title:o("Save?"),text:o("Save your changes to {0}?",[this.CurrentProcess.label]),callback:i=>{i?this.saveProcess(this.CurrentProcess).then((()=>{e()})).catch(e):(this.unsavedChanges=!1,$$(t.button).hide(),e())}})})),i.push((async i=>{this.CurrentProcessID=null,this.viewer.clear(),super.processLoad(e),this.CurrentPropertiesObj=null,$$(t.properties).hide();var n=e.modelDefinition();n||(e.modelNew(),n=e.modelDefinition());try{await this.viewer.importXML(n),this.viewer.get("canvas").zoom("fit-viewport","auto"),i()}catch(e){i(e)}})),Bb(i,(i=>{i&&(i.toString().indexOf("no diagram to display")&&webix.confirm({title:o("Error Displaying Process"),message:o("Could not display the process definition for {0}. Do you want to start a blank process?",[this.CurrentProcess.name]),callback:i=>{i?(e.modelNew(),this.processLoad(this.CurrentProcess)):($$(t.modelerWorking).hide(),$$(t.modelerBroken).show(),this.viewer.clear(),this.viewer.destroy(),this.viewer=null)}}),this.AB.notify.developer(i,{context:"error during the process of changing the Process"})),$$(t.modelerBroken).hide(),$$(t.modelerWorking).show(),this.warningsRefresh(this.CurrentProcess),r.show(this.CurrentProcess)}))}panelShow(e){let t={ui:()=>this.panelSelectElement};this.panelsByType[e.key]&&(t=this.panelsByType[e.key]);let i={id:this.ids.properties,rows:[t.ui(e),{}]};webix.ui(i,$$(this.ids.properties)),t.populate?.(e),this.CurrentPanel=t}propertiesSave(){if(this.CurrentPanel&&"function"==typeof this.CurrentPanel.values){var e=this.CurrentPropertiesObj,t=this.CurrentPanel.values(),i=e.toObj();Object.keys(t).forEach((e=>{i[e]=t[e]})),e.name||(i.name=t.label),e.fromValues(i),e.warningsEval(),this.timedUpdate(e)}}show(){$$(this.ids.component).show()}timedUpdate(e){setTimeout((()=>{e.diagramProperties(this.viewer).forEach((e=>{this.updateElementProperties(e.id,e.def,e.warn)})),this.warningsRefresh(this.CurrentProcess),r.show(this.CurrentProcess)}),0)}updateElementProperties(e,t,i){var n=this.viewer.get("elementRegistry").get(e);n&&(i?n.___abwarnings=i:delete n.___abwarnings,this.viewer.get("modeling").updateProperties(n,t))}warningsRefresh(e){let t=e.elements();super.warningsRefresh(e),t.forEach((t=>e.elementAdd(t)))}initDependencies(){this.AB.custom.formiobuilder.init(),this.AB.custom.formiopreview.init(),this.AB.custom["tinymce-editor"].init()}}}function jb(e){var t=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_pwa_list_addWidget",{popup:"",list:""})}ui(){return{id:this.ids.component,css:"webix_primary",view:"button",type:"form",label:i("Add Widget"),align:"center",autowidth:!0,on:{onItemClick:()=>{this.show()}}}}init(e){this.AB=e;let t=this.ids,n=this;webix.ui({view:"window",id:t.popup,modal:!0,width:600,height:550,select:!1,resize:!0,position:"center",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add Widget"),css:"modal_title",align:"center"},{view:"button",label:"Close",autowidth:!0,align:"center",click:()=>{this.hide()}}]},body:{id:t.list,view:"dataview",css:"ab-datacollection-table borderless",borderless:!0,xCount:5,yCount:4,type:{borderless:!0,width:100,height:100},template:(e,t)=>this.template(e,t),on:{onItemClick:function(e){var t=this.getItem(e);n.addWidget(t)}}}})}show(){$$(this.ids.popup).show()}hide(){$$(this.ids.popup).hide()}addWidget(e){const t=e.newInstance(this.CurrentView.application,this.CurrentView);this.emit("widget.adding"),t.save().then((()=>{this.emit("widget.add"),this.emit("warnings")})),this.hide()}template(e){if(e.common){var t=e.common().label;return t||(t=i(e.common().labelKey)),`<div class='ab-component-in-page'><i class='fa fa-2x fa-${e.common().icon}' aria-hidden='true'></i><br/>${t}</div>`}return e.label}viewLoad(e){super.viewLoad(e);let t=this.ids;var i=$$(t.list),n=this.CurrentView.componentList();i.clearAll(),n&&n.length>0?i.parse(n):Menu.hide(),i.refresh()}}}(e);const i=(0,n.Z)(e);var s=i.L();return new class extends i{constructor(){super("ui_work_pwa_list",{tabs:"",tabs_add:"",menus:"",menus_add:"",widgets:"",widgets_add:""}),this.PageNew=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_pwa_list_newPage",{tab:""}),this.listPages=["PageBlank"],this.PageBlank=function(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e);var s=i.L();return new class extends i{constructor(){super("ui_work_pwa_list_newPage_blank",{form:"",saveButton:"",issue_id:"",issue_list:""}),this.tabValue=null,this.tabLabel=s("Blank"),this.menuType="??"}ui(){let i=this.ids;return{id:i.component,header:this.tabLabel,body:{view:"scrollview",scroll:!0,height:670,width:770,body:{padding:4,cols:[{view:"spacer",width:2},{rows:[{view:"form",id:i.form,rules:{label:e=>0<e.length&&e.length<=20},borderless:!0,elements:[{name:"label",view:"text",label:s("Name"),labelWidth:100,placeholder:s("Name"),invalidMessage:s("&nbsp; Name must be less than or equal to 20 letters."),on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,`${i.component}_label`)}}},{height:t.smallSpacer},{view:"spacer",height:2},{view:"toolbar",margin:14,paddingY:20,cols:[{view:"button",value:s("Cancel"),css:"ab-cancel-button",inputWidth:100,align:"right",click:()=>{this.cancel()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this,`${i.component}_cancel`)}}},{view:"button",id:i.saveButton,value:s("Save"),css:"webix_primary",inputWidth:100,click:()=>{this.buttonSaveClick()},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}],borderless:!0}]}]},{view:"spacer",width:8}]}}}}init(e){this.AB=e,this.AB.Webix.ui(this.ui()),webix.extend($$(this.ids.form),this.AB.Webix.ProgressBar)}toList(){this.emit("done")}async buttonSaveClick(){this.buttonSaveDisable(),this.formBusy();const e=this.CurrentApplication;var t=this.formValues();t.menuType=this.menuType;var i=e.pageNew(t);await i.save(),this.formReset(),this.toList(),this.formReady(),this.buttonSaveEnable(),$$(this.ids.component).hide()}buttonSaveDisable(){$$(this.ids.saveButton).disable()}buttonSaveEnable(){$$(this.ids.saveButton).enable()}cancel(){this.formReset(),this.toList()}formBusy(){$$(this.ids.form).showProgress({type:"icon"})}formPopulate(e){super.applicationLoad(e);let t=$$(this.ids.form);if(e){["label","description","version","icon","isSystemObject","isAccessManaged","isTranslationManaged","isTutorialManaged","networkType"].forEach((i=>{t.elements[i]&&t.elements[i].setValue(e[i]||e.json[i])}));var i=$$(this.ids.accessManager);i&&(i.removeView(i.getChildViews()[0]),i.addView(this.accessManagerUI.ui(e.accessManagers||{}),0));var n=$$(this.ids.translationManager);n&&(n.removeView(n.getChildViews()[0]),n.addView(this.translationManagerUI.ui(e.translationManagers||{}),0));var s=$$(this.ids.tutorialManager);s&&(s.removeView(s.getChildViews()[0]),s.addView(this.tutorialManagerUI.ui(e.tutorialManagers||{}),0))}this.permissionPopulate(e)}formReady(){$$(this.ids.form).hideProgress()}formReset(){super.applicationLoad(null),$$(this.ids.form).clear(),$$(this.ids.form).clearValidation()}formValidate(e){if(!$$(this.ids.form).validate())return this.formReady(),this.buttonSaveEnable(),!1;var t=[];if("add"===e){var i=this.formValues();i.name=i.label;var n=this.AB.applicationMobileNew(i),o=[];(this.AB.applications()||[]).forEach((e=>{e.areaKey()==n.areaKey()&&o.push(e)})),o.length>0&&t.push({attr:"label",msg:s("&nbsp; Name ({0}) is already in use.",[n.label])})}if(t.length>0){var a=!1;return t.forEach((e=>{$$(this.ids.form).markInvalid(e.attr,e.msg),a||($$(this.ids.form).elements[e.attr].focus(),a=!0)})),this.formReady(),this.buttonSaveEnable(),!1}return!0}formValues(){return $$(this.ids.form).getValues()}show(){$$(this.ids.component).show()}}}(e)}ui(){const e=this;var n={view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new Page"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:{view:"tabview",id:this.ids.tab,cells:[],tabbar:{on:{onAfterTabClick:e=>{this.switchTab(e)},onAfterRender(){this.config.options.forEach((t=>{e.listPages.forEach((i=>{t.value==e[i].tabLabel&&(e[i].tabValue=t.id)}))})),this.$view.querySelectorAll(".webix_item_tab").forEach((e=>{var i=e.getAttribute("button_id");t.CYPRESS_REF(e,`${i}_tab`)}))}}}},on:{onBeforeShow:()=>{var e=$$(this.ids.tab).getValue();this.switchTab(e)}}};return this.listPages.forEach((e=>{n.body.cells.push(this[e].ui())})),n}async init(e){this.AB=e,webix.ui(this.ui()),webix.extend($$(this.ids.component),webix.ProgressBar),this.$component=$$(this.ids.component);var t=[];return this.listPages.forEach((i=>{t.push(this[i].init(e)),this[i].on("done",(()=>{this.emit("done"),this.hide()})),this[i].on("cancel",(()=>{this.hide()}))})),Promise.all(t)}clear(){this.listPages.forEach((e=>{this[e].formReset()}))}hide(){this.$component?.hide()}busy(){this.$component?.showProgress?.()}applicationLoad(e){super.applicationLoad(e),this.listPages.forEach((t=>{this[t].applicationLoad(e)}))}ready(){this.$component?.hideProgress?.()}show(e){this.$component&&this.$component.show(),this.listPages.forEach((t=>{this[t].menuType=e}))}switchTab(e){this.listPages.forEach((t=>{e==this[t]?.ids.form&&this[t]?.onShow?.(this.CurrentApplicationID)}))}}}(e),this.viewListTabs=new webix.TreeCollection,this.viewListMenus=new webix.TreeCollection,this.viewListWidgets=new webix.TreeCollection,this.selectedPage=null}ui(){var e=this.ids;return{id:e.component,css:"webix_list",rows:[{view:"toolbar",css:"webix_unit_header",cols:[{view:"label",label:s("Tabs"),autowidth:!0},{},{id:e.tabs_add,view:"button",type:"icon",icon:"fa fa-fw fa-plus no-margin",width:35,click:async()=>{this.PageNew.show("tab")}},{width:10}]},{id:e.tabs,view:"tree",drag:!0,select:"row",dragscroll:!0,type:{template:(e,t)=>this.templatePage(e,t)},on:{onItemClick:t=>{$$(e.menus).unselect(),$$(e.widgets).unselect(),this.loadWidgets(t);let i=this.CurrentApplication.pageByID(t,!0);i&&this.emit("selected",i)},onBeforeDrop:(t,i)=>{if(t.from!==$$(e.widgets)){var n=this.CurrentApplication.pages((e=>t.start==e.id),!0)[0];n&&(n.menuType="tab");var s=this.CurrentApplication.pages((e=>t.target==e.id),!0)[0];return i.shiftKey?(this.moveToChild(s,n,t.to,"tab"),!1):void this.moveToChild(s.parent,n,t.to,"tab")}}},onClick:{delme:(t,i)=>{let n=this.CurrentApplication.pageByID(i,!0);return webix.confirm({title:s("Delete {0}",[n.label]),text:s("Are you sure you wish to delete this Page?  All child pages will be removed as well."),ok:s("Yes"),cancel:s("No"),callback:async t=>{if(t){let t=$$(e.tabs);t.showProgress();try{await n.destroy()}catch(e){this.AB.notify.developer(e,{context:"ui_work_pwa_list:delete menu: error removing item",page:n?.toObj()})}let i=t.getState();this.refreshTree(t,"tabs"),t.setState(i),t.hideProgress(),n.id==this.selectedPage?.id&&(this.selectedPage=null,this.loadWidgets(null),this.emit("selected",null))}}}),!1}},data:[]},{view:"toolbar",css:"webix_unit_header",cols:[{view:"label",label:s("Menu Items"),autowidth:!0},{},{id:e.menus_add,view:"button",type:"icon",icon:"fa fa-fw fa-plus no-margin",width:35,click:async()=>{this.PageNew.show("menu")}},{width:10}]},{id:e.menus,view:"tree",drag:!0,select:"row",dragscroll:!0,type:{template:(e,t)=>this.templatePage(e,t)},on:{onItemClick:t=>{$$(e.tabs).unselect(),$$(e.widgets).unselect(),this.loadWidgets(t);let i=this.CurrentApplication.pageByID(t,!0);i&&this.emit("selected",i)},onBeforeDrop:(t,i)=>{if(t.from!==$$(e.widgets)){var n=this.CurrentApplication.pageByID(t.start,!0);n&&(n.menuType="menu");var s=this.CurrentApplication.pageByID(t.target,!0);return i.shiftKey?(this.moveToChild(s,n,t.to,"menu"),!1):void this.moveToChild(s.parent,n,t.to,"menu")}}},onClick:{delme:(t,i)=>{let n=this.CurrentApplication.pageByID(i,!0);return webix.confirm({title:s("Delete {0}",[n.label]),text:s("Are you sure you wish to delete this Page?  All child pages will be removed as well."),ok:s("Yes"),cancel:s("No"),callback:async t=>{if(t){let t=$$(e.menus);t.showProgress();try{await n.destroy()}catch(e){this.AB.notify.developer(e,{context:"ui_work_pwa_list:delete menu: error removing item",page:n?.toObj()})}let i=t.getState();this.refreshTree(t,"menu"),t.setState(i),t.hideProgress(),n.id==this.selectedPage?.id&&(this.selectedPage=null,this.loadWidgets(null),this.emit("selected",null))}}}),!1}},data:[]},{view:"toolbar",css:"webix_unit_header",cols:[{view:"label",label:s("Widgets"),autowidth:!0},{},{id:e.widgets_add,view:"button",type:"icon",icon:"fa fa-fw fa-plus no-margin",width:35,click:()=>{t.show()}},{width:10}]},{id:e.widgets,view:"tree",drag:"order",select:"row",dragscroll:!0,type:{template:(e,t)=>this.templateWidget(e,t)},on:{onItemClick:e=>{let t=this.selectedPage.viewByID(e);this.emit("selected",t)},onBeforeDrop:(e,t)=>{var i=this.selectedPage.viewByID(e.start,!0);if("mobile-form"==i.parent?.key){if(0==e.parent)return!1;if(null==e.target)return!1;if(i.parent.id!==e.parent)return!1}else if(e.parent||e.target)return!1;setTimeout((()=>{this.widgetOrder()}),10)}},onClick:{delme:(t,i)=>{let n=this.selectedPage.viewByID(i);return webix.confirm({title:s("Delete {0}",[n.label]),text:s("Are you sure you wish to delete this widget?"),ok:s("Yes"),cancel:s("No"),callback:async t=>{if(t){$$(e.widgets).showProgress();try{await n.destroy()}catch(e){this.AB.notify.developer(e,{context:"ui_work_pwa_list:delete widget: error removing item",widget:n?.toObj()})}this.loadWidgets(this.selectedPage.id),$$(e.widgets).hideProgress(),this.emit("widget.updated"),this.emit("warnings")}}}),!1}},data:[]}]}}async init(e){this.AB=e;let i=$$(this.ids.tabs);i&&(webix.extend(i,webix.ProgressBar),i.data.unsync(),i.data.sync(this.viewListTabs),i.adjust());let n=$$(this.ids.menus);n&&(webix.extend(n,webix.ProgressBar),n.data.unsync(),n.data.sync(this.viewListMenus),n.adjust());let o=$$(this.ids.widgets);o&&(webix.extend(o,webix.ProgressBar),o.data.unsync(),o.data.sync(this.viewListWidgets),o.adjust(),webix.extend(o,webix.OverlayBox)),this.PageNew.init(e),this.PageNew.on("done",(()=>{this.refresh()})),$$(this.ids.component)&&$$(this.ids.component).adjust(),t.init(e),t.on("widget.adding",(()=>{o?.showProgress?.({type:"icon"})})),t.on("widget.add",(()=>{this.loadWidgets(this.selectedPage.id),o?.hideProgress?.(),this.emit("widget.updated"),this.emit("warnings")})),$$(this.ids.widgets_add)?.disable(),o.showOverlay(s("Select a Page to modify it's widgets ..."))}addNew(){this.clickNewView(!0)}refresh(){let e=$$(this.ids.tabs),t=$$(this.ids.menus),i=$$(this.ids.widgets),n=e.getState(),s=t.getState(),o=i.getState();this.applicationLoad(this.CurrentApplication),t.setState(s),e.setState(n),this.selectedPage&&(this.loadWidgets(this.selectedPage.id),i.setState(o))}applicationLoad(e){let t=!1;if(e?.id==this.CurrentApplicationID&&(t=!0),super.applicationLoad(e),this.PageNew.applicationLoad(e),this.refreshTree(this.viewListTabs,"tab"),this.refreshTree(this.viewListMenus,"menu"),t||$$(this.ids.widgets).clearAll(),t&&this.selectedPage){let e=null;e="tab"==this.selectedPage.menuType?$$(this.ids.tabs):$$(this.ids.menus),e.select(this.selectedPage.id)}}loadWidgets(e){let i=$$(this.ids.widgets);i.clearAll();let n=this.CurrentApplication.pageByID(e);if(!n)return;t.viewLoad(n),this.selectedPage=n,$$(this.ids.widgets_add)?.enable();var o=(e,t,i,n)=>{t&&(e.add(t,i,n),t.views().forEach(((i,n)=>{o(e,i,n,t.id)})))};let a=n.views()||[];a.forEach(((e,t)=>{o(i,e,t)})),0==a.length?i.showOverlay(s("Click [+] to add your first widget.")):i.hideOverlay()}refreshTree(e,t){e.clearAll();var i=(e,t,n,s)=>{t&&(e.add(t,n,s),t.pages().forEach(((n,s)=>{i(e,n,s,t.id)})))};this.CurrentApplication.pages((e=>e.menuType==t)).forEach(((t,n)=>{i(e,t,n)}))}async widgetOrder(){let e=$$(this.ids.widgets),t=e.find({}),i={};t.forEach((e=>{i[e.$parent]=e.$parent}));let n=[];Object.keys(i).forEach((i=>{let s=this.selectedPage.viewByID(i),o=e.getFirstChildId(s?.id);for(s||(s=this.selectedPage,o=e.getFirstId()),s._views=[];o;)s._views.push(t.find((e=>e.id==o))),o=e.getNextSiblingId(o);n.push(s.save())})),await Promise.all(n),this.emit("widget.updated")}async addChild(e,t,i){var n=t.parent;n&&await n.pageRemove(t),await e.pageInsert(t),t.parent=e,await t.save()}async moveToChild(e,t,i,n){i?.showProgress?.({type:"icon"}),await this.addChild(e,t,i);let s=i.getState();this.refreshTree(i,n),i.setState(s),i?.hideProgress?.()}show(){$$(this.ids.component).show()}templatePage(e,t){let i=null;if(e.warningsEval)e.warningsEval(),i=e.warningsAll();else{let t=this.CurrentApplication.pageByID(e.id);t?.warningsEval(),i=t?.warningsAll()??[]}let n="";i.length>0&&(n=this.WARNING_ICON);let s=e.defaultPage?"<i class='fa fa-asterisk dragme'></i>":"";return`${t.icon(e)}${t.folder(e)}<span>${e.label}</span><i class='fa fa-bars dragme'></i><i class='fa fa-trash dragme delme'></i>${s}${n}`}templateWidget(e,t){e.warningsEval();let i="";return e.warningsAll().length>0&&(i=this.WARNING_ICON),`${t.icon(e)}${t.folder(e)}<span>${e.label}</span><i class='fa fa-bars dragme'></i><i class='fa fa-trash dragme delme'></i>${i}`}refreshTemplateItem(e){e=e.updateIcon(e),this.viewList.updateItem(e.id,e)}rename(){var e=$$(this.ids.list).getSelectedId(!1);$$(this.ids.list).edit(e)}copy(){var t=$$(this.ids.list).getSelectedItem(!1);this.listBusy(),CopyForm.init(e,t),CopyForm.applicationLoad(this.CurrentApplication),CopyForm.show()}remove(){var e=$$(this.ids.list).getSelectedItem(!1);e&&webix.confirm({title:s("Delete Page"),text:s("Are you sure you wish to delete this page?"),ok:s("Yes"),cancel:s("No"),callback:async t=>{if(t){this.listBusy();try{await e.destroy(),this.listReady(),$$(this.ids.list).remove($$(this.ids.list).getSelectedId()),this.emit("deleted",e),this.emit("selected",null)}catch(t){this.AB.notify.developer(t,{context:"ui_interface_list:remove(): error removing item",base:e}),this.listReady()}}}})}clickEditMenu(e,t,i){return this.EditPopup.show(i),!1}}}function Mb(e){const t=(0,n.Z)(e),i=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_version_list"),this.AB={},this.ListComponent=function(e,t){const i=e.Config.uiSettings();var n=function(...t){return e.Multilingual.labelPlugin("ABDesigner",...t)};class s extends e.ClassUI{constructor(e){e.idBase=e.idBase||"ui_common_list";var t=e.idBase||"ui_common_list";if(super(t,{listSetting:"",vList:"",buttonNew:""}),this.idBase=t,this.labels={addNew:"Add new item",confirmDeleteTitle:"Delete Item"},e.labels)for(var i in e.labels)this.labels[i]=e.labels[i];e.menu=e.menu||{},e.menu.copy=void 0===e.menu.copy||e.menu.copy,e.menu.exclude=void 0===e.menu.exclude||e.menu.exclude,this.attributes=e,this._templateListItem="<div class='ab-object-list-item'>#version# - #changelog.author# <div style='padding-left:18px'>#changelog.commitMessage#</div></div>",this.cacheTemplate={},this.CurrentApplication=null,this.itemList=null,this._initialized=!1,this._settings={}}ui(){var t=this.ids;return{id:this.ids.component,rows:[{view:"list",id:this.ids.vList,width:i.columnWidthLarge,select:!0,editaction:"custom",editable:!0,editor:"text",editValue:"label",type:{height:57},template:(e,t)=>this.templateListItem(e,t),on:{onAfterSelect:e=>{this.onSelectItem(e)},onBeforeEditStop:(e,t)=>{this.onBeforeEditStop(e,t)},onAfterEditStop:(e,t,i)=>{this.onAfterEditStop(e,t,i)},onAfterRender(){this.data.each((i=>{e.ClassUI.CYPRESS_REF(this.getItemNode(i.id),`${t.list}_${i.id}`)}))}}},{view:"button",css:"webix_primary",id:this.ids.buttonNew,value:"Clear",type:"form",click:()=>{this.clearForm(!0)},on:{onAfterRender(){e.ClassUI.CYPRESS_REF(this)}}}]}}init(e){this.AB=e,$$(this.ids.component)&&$$(this.ids.component).adjust(),this.$list=$$(this.ids.vList),this._initialized=!0}applicationLoad(e){this.CurrentApplication=e}dataLoad(t){if(this.busy(),!t)return this.AB.notify.developer("No version Data",{context:"ui_work_version_list:dataLoad()",versionData:t}),this.clearForm(),void this.ready();var i=t.changeLog;this.itemList=new webix.DataCollection({data:function(t){const i=t,n=Object.keys(t).sort(((e,t)=>{const[i,n,s]=e.split(".").map((e=>parseInt(e))),[o,a,r]=t.split(".").map((e=>parseInt(e)));return i!==o?o-i:n!==a?a-n:r-s})).map(((n,s)=>"string"==typeof t[n]?(e.notify.developer(new Error,{context:"ui_version_list.loadData()",message:"The changelog object is not in the correct format.",version:n}),{version:n,id:s}):(t[n].versionNumber=n,{id:s,label:n,version:n,changelog:t[n],commitMessage:i[n].commitMessage,author:i[n].author,timestamp:i[n].timestamp,changeSize:i[n].changeSize})));return n}(i)});var n=this.$list||$$(this.ids.vList);n&&(n.clearAll(),n.data.unsync(),n.data.sync(this.itemList),n.refresh(),n.unselectAll()),this.ready()}busy(){this.$list?.showProgress?.({type:"icon"})}ready(){this.$list?.hideProgress?.()}onSelectItem(e){var t=this.$list.getItem(e);this.emit("selected",t)}clearForm(){this.emit("selected")}save(){this._initialized&&this.AB.Storage.set(this.idBase,this._settings)}selectItem(e){this.$list.blockEvent(),this.select(e),this.$list.unblockEvent()}templateListItem(e,t){return this.cacheTemplate[e.id]||("string"==typeof this._templateListItem?this.cacheTemplate[e.id]=this._templateListItem.replace("#label#",e.label||"??label??").replace("#title#",e.title||"??title??").replace("#year#",e.year||"??year??").replace("#version#",e.version||"??version??").replace("#changelog.author#",e.changelog?.author||"??changelog.author??").replace("#changelog.commitMessage#",e.changelog?.commitMessage||"??changelog.commitMessage??"):this.cacheTemplate[e.id]=this._templateListItem(e,t),setTimeout((()=>{delete this.cacheTemplate[e.id]}),400)),this.cacheTemplate[e.id]}exclude(){var e=this.$list.getSelectedItem(!1);this.emit("exclude",e)}rename(){var e=this.$list.getSelectedId(!1);this.$list.edit(e)}remove(){var e=this.$list.getSelectedItem(!1);webix.confirm({title:n(this.labels.confirmDeleteTitle),text:n(this.labels.confirmDeleteMessage,[e.label]),ok:n("Yes"),cancel:n("No"),callback:async t=>{if(t){this.busy();try{await e.destroy(),this.ready(),this.itemList.remove(e.id),this.emit("deleted",e),this.emit("selected",null)}catch(e){this.AB.notify.developer(e,{context:"ui_common_list:remove(): error removing item"}),this.ready()}}}})}select(e){this.$list.select(e)}callbackProcessEditorMenu(e){switch(e){case"rename":this.rename();break;case"exclude":this.exclude();break;case"delete":this.remove()}}}return new s(t)}(e,{idBase:this.ids.component,labels:{addNew:"Add new Version",title:"Versions",searchPlaceholder:"Version"}})}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,await this.ListComponent.init(e),this.on("addNew",((e,t)=>{let i=e.versionData||e.json.versionData;this.ListComponent.dataLoad(i),this.emit("selected",t)})),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("clearForm",(()=>{this.emit("clearForm")}))}applicationLoad(e){super.applicationLoad(e),this.AB=e;let t=e.versionData||e.json.versionData;this.ListComponent.dataLoad(t)}ready(){this.ListComponent.ready()}}}(e),s=function(e,t){e.Config.uiSettings();const i=(0,n.Z)(e),s=i.L();return new class extends i{constructor(t,i={}){super(t,{form:"",versionForm:"",versionOption:"",multiview:"",noSelection:"",workspace:""}),this.AB=e,this.versionNumber="1.0.0",this.settings=i}ui(){return{cells:[{id:this.ids.noSelection,rows:[{css:"webix_dark",id:this.ids.versionOption,view:"toolbar",cols:[{width:12},{view:"label",label:"App Version"}]},{view:"form",id:this.ids.form,rows:[{label:"Version number options for Current Changes",view:"label",height:10},{cols:[{id:this.ids.versionOption,options:this.getVersionOptions(this.versionNumber||"1.0.0"),view:"segmented",height:40},{width:15}]},{view:"text",label:"Author",name:"author",id:"author",labelPosition:"top"},{label:"Release Notes",view:"textarea",name:"commitMessage",id:"commitMessage",labelPosition:"top",placeholder:"Explain your changes. Users will see this."},{view:"text",label:"Version Number",name:"version",id:"version",labelPosition:"top",hidden:!0},{view:"text",label:"Date",name:"timestamp",id:"timestamp",labelPosition:"top",hidden:!0},{view:"checkbox",label:"Force keep this version",name:"keepVersion",id:"keepVersion",labelPosition:"top",hidden:!0},{id:"save_button",label:"Save Log Message",view:"button",height:38,type:"icon",css:"webix_primary",disabled:!1,click:()=>this.saveNew()},{id:"update_button",label:"Update Change Log",view:"button",height:38,type:"icon",css:"webix_primary",disabled:!1,hidden:!0,click:()=>this.saveUpdate()},{id:"rollback_button",label:"Rollback module to this version",view:"button",height:38,type:"icon",css:"webix_primary",disabled:!1,hidden:!0},{id:"export_button",label:"Export",view:"button",height:38,type:"icon",css:"webix_primary",icon:"fa fa-download",disabled:!1}]}]}]}}async init(e){const t=this.ids;this.AB=e,this.$form=$$(this.ids.form),this.$versionOption=$$(this.ids.versionOption),$$(t.noSelection).show()}applicationLoad(e){super.applicationLoad(e);let t=this.getVersionData(e);this.versionNumber=t?.versionNumber?t.versionNumber:"1.0.0",this.CurrentVersionID=this.versionNumber,this.setOptions(this.versionNumber)}getVersionData(e){let t=(e=e||this.CurrentApplication).versionData||e.json.versionData;return t||(this.AB.notify.developer("there is no versionData",{context:"ui_work_version_workspace:getVersionData()",application:e.toObj()}),t={}),t}setOptions(e){let t=this.$versionOption;t&&(t.data.options=this.getVersionOptions(e),t.refresh())}versionLoad(e){if(!e)return this.clearForm(),!1;super.versionLoad(e),this.$versionOption.disable(),$$("save_button").hide(),$$("update_button").show(),$$("version").show(),$$("timestamp").show(),$$("export_button").hide(),this.$form.setValues(e),this.setOptions(this.versionNumber),this.$versionOption.refresh(),this.versionData=e}clearForm(){this.$versionOption.enable(),$$("save_button").show(),$$("update_button").hide(),$$("version").hide(),$$("timestamp").hide(),$$("export_button").show(),this.$form.setValues({}),this.setOptions(this.versionNumber),this.$versionOption.refresh()}loadData(e){console.error("no function should be here",e)}async saveNew(){let e=this.$form.getValues();if(e.version=this.getVersionNumber(this.$versionOption.$getValue()),e.timestamp=(new Date).toISOString(),!this.CurrentApplication)return webix.alert({title:s("Shoot!"),test:s("No Application Set!  Why?")}),!1;try{await this.applicationChangeLogAdd(this.CurrentApplication,e),this.emit("versionDataUpdate",!0),this.toList()}catch(e){}}async saveUpdate(){let e=this.$form.getValues(),t={};if(t.version=e.version,t.author=e.author,t.date=e.date,t.commitMessage=e.commitMessage,!this.CurrentApplication)return webix.alert({title:s("Shoot!"),test:s("No Application Set!  Why?")}),!1;try{await this.applicationChangeLogUpdate(this.CurrentApplication,e),this.emit("versionDataUpdate",!0),this.toList()}catch(e){}}getVersionNumber(e){const t=/^(\d+\.\d+\.\d+)/.exec(e);if(t)return t[1];{const t=new Error("Failed to extract version number from input string.");return this.AB.notify.developer(t,{context:"ui_work_version_workspace:getVersionNumber()",application:this.Application.toObj(),string:e}),null}}getVersionOptions(e){const t=e.split(".")[0],i=e.split(".")[1],n=e.split(".")[2];return[`${parseInt(t)+1}.0.0 <i>major</i>`,`${t}.${parseInt(i)+1}.0 <i>minor</i>`,`${t}.${i}.${parseInt(n)+1} <i>patch</i>`]}async applicationChangeLogAdd(e,t){let i=this.getVersionData(e);var n=i?.versionNumber;let o=t.version;i.changeLog[o]=t,i.versionNumber=o,e.json.versionData=i;try{await e.save(),webix.message({type:"success",text:s("{0} Successfully logged update of ",[e.label]," to version: ",o)}),this.versionNumber=o,this.clearForm(),this.emit("addNew",e,o)}catch(i){webix.message({type:"error",text:s("Error Updating {0}",[e.label]," to version: ",o)}),this.AB.notify.developer(i,{context:"ui_work_version_workspace:applicationChangeLogAdd()",application:e.toObj(),values:t}),e.versionData.versionNumber=n,Reflect.deleteProperty(e.versionData.changeLog,o)}}async applicationChangeLogUpdate(e,t){e=this.CurrentApplication||e;let i=t.version;var n=this.getVersionData(e).changeLog[i];n||console.error("They are trying to change the version number..."),e.json.versionData.changeLog[i]=t;try{await e.save(),webix.message({type:"success",text:s("{0} Successfully logged update of ",[e.label]," to version: ",i)}),this.emit("addNew",e,t)}catch(o){webix.message({type:"error",text:s("Error Updating {0}",[e.label]," to version: ",i)}),this.AB.notify.developer(o,{context:"ui_work_version_workspace:applicationChangeLogUpdate()",application:e.toObj(),values:t}),e.json.versionData.versionNumber=n.versionNumber,Reflect.deleteProperty(e.json.versionData.changeLog,i)}}}("ui_work_version_workspace",{allowDelete:0,configureHeaders:!1,detailsView:"",editView:"",isEditable:0,massUpdate:0,isReadOnly:!0})}(e);return new class extends t{constructor(){super("ui_work_version")}ui(){return{id:this.ids.component,type:"space",cols:[i.ui(),{view:"resizer",width:11},s.ui()]}}async init(e){this.AB=e,i.on("selected",(e=>{this.select(e)})),s.on("addNew",((e,t)=>{i.emit("addNew",e,t)})),await s.init(e),await i.init(e),this.on("versionDataUpdate",(()=>{this.VersionList.refresh()})),this.on("clearForm",(()=>{this.VersionWorkspace.clearForm()}))}applicationLoad(e){const t=this.CurrentApplicationID;super.applicationLoad(e),t&&t!=this.CurrentApplicationID&&s.clearForm(),i.applicationLoad(e),s.applicationLoad(e)}show(){const e=this.ids;$$(e.component).show(!1,!1);const t=this.CurrentApplication;t&&(s.applicationLoad(t),i.applicationLoad(t)),i.ready()}select(e){null==e&&s.clearForm(),s.versionLoad(e)}}}function Qb(e){const t=(0,n.Z)(e);var i=t.L();const s=function(e){const t=(0,n.Z)(e);var i=function(e){const t=(0,n.Z)(e),i=t.L();var s=new b(e);return new class extends t{constructor(){super("ui_work_object_list",{informationMenuItem:"",propertyObjectInfo:"",propertyFieldsPopup:"",propertyFieldsList:""}),this.ListComponent=c(e,{idBase:this.ids.component,labels:{addNew:"Add new object",confirmDeleteTitle:"Delete Object",title:"Objects",searchPlaceholder:"Object name"},menu:{copy:!1,exclude:!0}})}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewProcess(e)})),await this.ListComponent.init(e),this.ListComponent.on("show",(()=>{const e=this.ListComponent.PopupEditComponent.ids.list,t=$$(e);t.exists(this.ids.informationMenuItem)&&t.remove(this.ids.informationMenuItem),this.AB.Account.isSystemDesigner()&&t.add({id:this.ids.informationMenuItem,label:i("Information"),icon:"fa fa-info-circle",command:"information"})})),this.ListComponent.on("selected",(e=>{this.emit("selected",e?.id)})),this.ListComponent.on("addNew",(e=>{this.clickNewProcess(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),this.ListComponent.on("information",(e=>{this.information(e)})),await s.init(e),s.on("cancel",(()=>{s.hide()})),s.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)}))}applicationLoad(e){var t=this.CurrentApplicationID,i=null;super.applicationLoad(e),t==this.CurrentApplicationID&&(i=this.ListComponent.selectedItem());var n=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(n=()=>!0),this.ListComponent.dataLoad(e?.objectsIncluded(n)),i&&this.ListComponent.selectItem(i.id),s.applicationLoad(e)}warningsRefresh(){if(this.CurrentApplication){var e=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(e=()=>!0);let t=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.objectsIncluded(e)),this.ListComponent.selectItem(t.id)}}clickNewProcess(){s.show()}async exclude(e){this.ListComponent.busy();var t=this.CurrentApplication;await t.objectRemove(e),this.ListComponent.dataLoad(t.objectsIncluded()),this.emit("selected",null)}async information(e){const t=e.getDbInfo();$$(this.ids.propertyFieldsPopup)||this.AB.Webix.ui({id:this.ids.propertyFieldsPopup,view:"popup",height:300,width:500,body:{id:this.ids.propertyFieldsList,view:"datatable",columns:[{id:"Field",header:"Name",width:150},{id:"Type",header:"Type",width:150},{id:"Default",header:"Default",width:150},{id:"Extra",header:"Extra"},{id:"Key",header:"Index Type"},{id:"Null",header:"Nullable"}]}});const i=this.AB.Webix.ui({view:"window",height:300,width:450,position:"center",modal:!0,resize:!0,head:{view:"toolbar",cols:[{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{i.close()}}]},body:{view:"property",id:this.ids.propertyObjectInfo,nameWidth:120,elements:[{label:"Database Information",type:"label"},{label:"Definition ID",type:"text",id:"definitionId"},{label:"Table Name",type:"text",id:"tableName"},{id:"fieldsPopup",label:"Fields",type:"popup",popup:this.ids.propertyFieldsPopup}]}});i.show();const n=$$(this.ids.propertyObjectInfo);this.AB.Webix.extend(n,this.AB.Webix.ProgressBar),n.showProgress({type:"icon"});try{const e=await t;n.setValues(e),$$(this.ids.propertyFieldsList).define("data",e.fields)}catch(t){this.AB.notify.developer(t,{context:"Error trying to get information of object",object:e.toObj()})}n.hideProgress()}ready(){this.ListComponent.ready()}}}(e),s=B(e);return new class extends t{constructor(){super("ui_work_object")}ui(){return{id:this.ids.component,type:"space",margin:10,cols:[i.ui(),{view:"resizer"},s.ui()]}}init(e){return this.AB=e,this.warningsPropogate([i,s]),this.on("warnings",(()=>{i.warningsRefresh()})),i.on("selected",(e=>{null==e?s.clearObjectWorkspace():s.populateObjectWorkspace(e)})),s.on("addNew",(e=>{i.emit("addNew",e)})),Promise.all([s.init(e),i.init(e)])}applicationLoad(e){var t=this.CurrentApplicationID;super.applicationLoad(e),t!=this.CurrentApplicationID&&s.clearObjectWorkspace(),i.applicationLoad(e),s.applicationLoad(e)}show(){$$(this.ids.component).show(!1,!1),i?.ready()}}}(e),o=F(e),r=q(e),l=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_process"),this.CurrentProcessID=null,this.ProcessList=function(e){const t=(0,n.Z)(e);return new class extends t{constructor(){super("ui_work_process_list"),this.ListComponent=c(e,{idBase:this.ids.component,labels:{addNew:"Add new process",confirmDeleteTitle:"Delete Process",title:"Processes",searchPlaceholder:"Process name"},menu:{copy:!1,exclude:!0}}),this.AddForm=function(e){const t=(0,n.Z)(e);var i=t.L();return new class extends t{constructor(){super("ui_work_process_list_newProcess",{form:"",buttonCancel:"",buttonSave:""}),this.selectNew=!0}ui(){return{view:"window",id:this.ids.component,position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new Process"),css:"modal_title",align:"center"},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{this.emit("cancel")},on:{onAfterRender(){t.CYPRESS_REF(this)}}}]},body:{view:"form",id:this.ids.form,width:400,rules:{},elements:[{view:"text",label:i("Name"),name:"name",required:!0,placeholder:i("Enter process name"),labelWidth:70},{margin:5,cols:[{fillspace:!0},{view:"button",id:this.ids.buttonCancel,value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.emit("cancel")}},{view:"button",id:this.ids.buttonSave,css:"webix_primary",value:i("Save"),autowidth:!0,type:"form",click:()=>{let e=$$(this.ids.form).getValues();return this.save(e)}}]}]}}}init(e){this.AB=e,webix.ui(this.ui()),this.$component=$$(this.ids.component),this.$form=$$(this.ids.form),this.$buttonSave=$$(this.ids.buttonSave),webix.extend(this.$component,webix.ProgressBar),this.hide()}async save(e){if(!this.CurrentApplication)return webix.alert({title:i("Shoot!"),test:i("No Application Set!  Why?")}),this.emit("save.error",!0),!1;this.busy();try{let t=await this.AB.processNew(e);await t.save(),await this.CurrentApplication.processInsert(t),this.emit("save",t),this.clear(),this.hide()}catch(e){return console.error(e),this.emit("save.error",e),!1}return this.ready(),!0}show(){this.$component&&this.$component.show()}hide(){this.$component&&this.$component.hide()}clear(){this.$form.clearValidation(),this.$form.clear(),this.$buttonSave.enable()}busy(){this.$component&&this.$component.showProgress&&this.$component.showProgress({type:"icon"})}ready(){this.$component&&this.$component.hideProgress&&this.$component.hideProgress()}}}(e)}ui(){return this.ListComponent.ui()}async init(e){this.AB=e,this.on("addNew",(e=>{this.clickNewProcess(e)})),await this.ListComponent.init(e),this.ListComponent.on("selected",(e=>{this.emit("selected",e)})),this.ListComponent.on("addNew",(e=>{this.clickNewProcess(e)})),this.ListComponent.on("deleted",(e=>{this.emit("deleted",e)})),this.ListComponent.on("exclude",(e=>{this.exclude(e)})),this.ListComponent.on("copied",(e=>{this.copy(e)})),await this.AddForm.init(e),this.AddForm.on("cancel",(()=>{this.AddForm.hide()})),this.AddForm.on("save",(e=>{this.applicationLoad(this.CurrentApplication),this.ListComponent.select(e.id)}))}applicationLoad(e){super.applicationLoad(e),this.ListComponent.dataLoad(e?.processes()),this.AddForm.applicationLoad(e)}clickNewProcess(){this.AddForm.show()}copy(e){this.ListComponent.busy(),this.CurrentApplication.processCreate(e.item).then((e=>{this.ListComponent.ready(),this.ListComponent.dataLoad(this.CurrentApplication.processes()),this.ListComponent.select(e.id)}))}async exclude(e){this.ListComponent.busy(),await this.CurrentApplication.processRemove(e),this.ListComponent.dataLoad(this.CurrentApplication.processes()),this.emit("selected",null)}busy(){this.ListComponent.busy()}ready(){this.ListComponent.ready()}warningsRefresh(){if(this.CurrentApplication){var e=e=>!e.isSystemObject;this.AB.Account.isSystemDesigner()&&(e=()=>!0);let t=this.ListComponent.selectedItem();this.ListComponent.dataLoad(this.CurrentApplication?.processes(e)),this.ListComponent.selectItem(t?.id)}}}}(e),this.ProcessWorkspace=function(e){const t=e.Config.uiSettings(),i=(0,n.Z)(e);var s=i.L();let o={ui:()=>{},init:()=>Promise.resolve(),applicationLoad:()=>{},clearWorkspace:()=>{},processLoad:()=>{}};const a=Ib(e),r=o,l=function(e){const t=(0,n.Z)(e),i=t.L();return new class extends t{constructor(){super("ui_work_process_workspace_monitor",{component:"",taskList:"",processLogs:"",detailView:"",resetButton:"",deleteButton:"",context:"",error:"",tabGroup:""})}ui(){const e=this.ids;return{id:e.component,cols:[{gravity:1,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{type:"spacer",width:15},{view:"label",label:i("Instances")},{view:"icon",id:"filterIcon",css:"icon-disable",icon:"fa fa-filter",align:"right",popup:{view:"checksuggest",id:"instanceFilter",button:!1,body:{template:`${i("Hide")} #value#`},data:[{id:"completed",value:i("Completed")},{id:"created",value:i("Created")},{id:"error",value:i("Error")}],on:{onValueSuggest:()=>{this.filter=$$("instanceFilter").config.value.split(",").filter((e=>""!==e)),$$("filterIcon").config.badge=0!=this.filter.length?this.filter.length:"",$$("filterIcon").refresh(),this.loadInstances()}}}}]},{view:"list",id:e.taskList,select:!0,navigation:!0,dynamic:!0,datafetch:20,item:{height:74,template:e=>{const{icon:t,color:i}={error:{icon:"fa-times-circle",color:"#FF5C4C"},created:{icon:"fa-clock-o",color:"#FFAE38"},completed:{icon:"fa-check-circle",color:"#38AEA2"}}[e.status]??{icon:"fa-question",color:"gray"};return`<div\n                                    style="float:left;height:70px;line-height:70px;margin-right:10px;color:${i};"\n                                    class="fa ${t} fa-2x">\n                                 </div>\n                                 <div style="margin:5px 0;height:60px;overflow:hidden;line-height:20px">\n                                    <div style="font-size: 16px; font-weight: 600;">\n                                       ${new Date(e.updated_at).toLocaleString(window?.webixLocale??"en-US")}\n                                    </div>\n                                    <div>${e.log[e.log.length-1].split(":")[2]}</div>\n                                 </div>`}},on:{onItemClick:e=>this.showInstance(e)}}]},{view:"resizer",css:"bg_gray",width:11},{gravity:2,rows:[{gravity:2,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{type:"spacer",width:15},{view:"label",label:i("Instance Details")},{id:e.resetButton,view:"button",width:100,css:"webix_secondary",type:"icon",icon:"fa fa-refresh",label:i("Reset"),click:()=>this.resetInstance()},{id:e.deleteButton,view:"button",width:100,css:"webix_danger",type:"icon",icon:"fa fa-trash",label:i("Delete"),click:()=>this.deleteInstance()},{type:"spacer",width:1}]},{view:"property",height:200,id:e.detailView,editable:!1,elements:[{label:i("Instance"),type:"label"},{label:i("ID"),type:"text",id:"id"},{label:i("Created"),type:"date",id:"created"},{label:i("Updated"),type:"date",id:"updated"},{label:i("Job ID"),type:"text",id:"jobId"},{label:i("Status"),type:"text",id:"status"},{label:i("Triggered By"),type:"text",id:"triggeredBy"}]}]},{view:"tabview",id:e.tabGroup,css:"webix_dark",cells:[{header:i("Logs"),body:{id:e.processLogs,view:"list",type:{height:"auto"},template:'<div style="padding:5px 0; line-height:20px;color:black">#value#</div>'}},{header:i("Context"),body:{view:"treetable",id:e.context,css:{color:"black !important"},resizable:!0,scroll:!0,columns:[{id:"title",header:i("Property"),width:300,template:"{common.treetable()} #key#"},{id:"value",header:i("Value"),width:500}]}}]}]}]}}async init(e){this.model=e.objectProcessInstance().model()}async processLoad(e){super.processLoad(e),this.loadInstances()}async loadInstances(e=!0){const t={$proxy:!0,load:(...e)=>this.fetchInstances(...e)},i=this;$$(this.ids.taskList).load(t,"json",(function(){const e=this.getFirstId();this.select(e),i.showInstance(e)}),e)}async fetchInstances(e,t){const i={glue:"and",rules:[{key:"d5afbc83-17dd-4b38-bded-1bf3f4594135",rule:"equals",value:this.CurrentProcessID}]};if(this.filter?.length>0){const e="b957a75d-65aa-427c-a813-63211658649a";this.filter.forEach((t=>i.rules.push({key:e,rule:"not_equal",value:t})))}return await this.model.findAll({where:i,sort:[{key:"updated_at",dir:"DESC"}],limit:t?.count??20,offset:t?.start??0})}showInstance(e){this.instance=e;const t=this.ids;if(!e)return $$(t.processLogs).clearAll(),$$(t.detailView).clear(),$$(t.tabGroup).removeView(t.error),$$(t.context).clearAll(),$$(t.resetButton).hide(),void $$(t.deleteButton).hide();const i=$$(t.taskList).getItem(e),n=i.log.map(((e,t)=>({id:t,value:e})));if($$(t.processLogs).clearAll(),$$(t.processLogs).parse(n),$$(t.detailView).setValues({id:i.id,created:new Date(i.created_at),updated:new Date(i.updated_at),jobId:i.jobID,status:i.status,triggeredBy:i.triggeredBy}),$$(t.context).clearAll(),$$(t.context).parse(this.processContext(i.context),"json"),$$(t.context).refresh(),$$(t.detailView).refresh(),$$(t.tabGroup).removeView(t.error),i.errorTasks){const e=[];for(var s in i.errorTasks)e.push({key:s,error:i.errorTasks[s]});$$(t.tabGroup).addView({header:"Errors",body:{id:t.error,view:"list",type:{height:"auto"},template:'<div style="color:black">#key# #error#</div>',data:e}})}"error"==i.status?$$(t.resetButton).show():$$(t.resetButton).hide(),$$(t.deleteButton).show()}async deleteInstance(){const e=this.instance;if(await webix.confirm({title:i("Delete Instance"),text:i("Are you sure? This can't be undone."),type:"confirm-warning"}).catch((()=>{})))if((await this.model.delete(e)).numRows>0){const t=$$(this.ids.taskList),n=t.getNextId(this.instance);t.remove(this.instance),this.showInstance(n),webix.message({text:`${i("Deleted Instance")} ${e}`,type:"success"})}else webix.messages({text:i("No rows were effected.  This does not seem right."),type:"warn"})}async resetInstance(){const e=$$(this.ids.taskList).getItem(this.instance),t=Object.keys(e.errorTasks);if(t.length<1)return;const n=this.CurrentProcess.elements().filter((e=>e.diagramID===t[0]))[0];await webix.confirm({title:i("Reset Instance"),text:`${i("Restart from")} '${n.label}' (${n.key} ${i("Task")})?`}).catch((()=>{}))&&1==await this.AB.Network.put({url:`/process/reset/${n.id}`,params:{instanceID:this.instance}})&&(webix.message({text:i("Instance Reset"),type:"success"}),this.processLoad(this.CurrentProcess))}processContext(e){const t=[];for(const i in e)"object"!=typeof e[i]||Array.isArray(e[i])||null===e[i]?t.push({key:i,value:e[i]}):t.push({key:i,open:!0,data:this.processContext(e[i])});return t}show(){$$(this.ids.component).show()}}}(e);return new class extends i{constructor(){super("ui_work_process_workspace",{multiview:"",tabbar:"",tabModel:"",tabTest:"",tabMonitor:"",noSelection:"",selectedItem:""})}ui(){let e=this.ids;return{view:"multiview",id:e.component,keepViews:!0,rows:[{id:e.noSelection,rows:[{maxHeight:t.xxxLargeSpacer,hidden:t.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-code-fork'></div>"},{view:"label",align:"center",label:s("Select a process to work with.")},{cols:[{},{view:"button",label:s("Add new process"),type:"form",css:"webix_primary",autowidth:!0,click:()=>{this.addNewProcess()}},{}]},{maxHeight:t.xxxLargeSpacer,hidden:t.hideMobile}]},{id:e.selectedItem,type:"wide",paddingY:0,rows:[{id:e.tabbar,view:"tabbar",css:"webix_dark",type:"bottom",borderless:!1,bottomOffset:0,options:[{id:e.tabModel,value:s("Model"),icon:"fa fa-code-fork",type:"icon",on:{click:()=>{this.changeTab("model")}}},{id:e.tabTest,value:s("Test"),icon:"fa fa-check-square",type:"icon",on:{click:()=>{this.changeTab("test")}}},{id:e.tabMonitor,value:s("Monitor"),icon:"fa fa-tachometer",type:"icon",on:{click:()=>{this.changeTab("monitor")}}}],on:{onChange:(e,t)=>{e!=t&&this.changeTab(e)}}},{id:e.multiview,view:"multiview",cells:[a.ui(),l.ui()]}]}]}}async init(e){this.AB=e,this.warningsPropogate([a,l]),$$(this.ids.noSelection).show();var t=[a.init(e),r.init(e),l.init(e)];await Promise.all(t)}addNewProcess(){this.emit("addNew")}applicationLoad(e){super.applicationLoad(e),a.applicationLoad(e),r.applicationLoad(e),l.applicationLoad(e)}changeTab(e){let t=this.ids;switch(e){case t.tabModel:$$(t.multiview).setValue(a.ids.component);break;case t.tabTest:$$(t.multiview).setValue(r.ids.component);break;case t.tabMonitor:$$(t.multiview).setValue(l.ids.component)}}clearWorkspace(){$$(this.ids.noSelection).show(!1,!1),a.clearWorkspace(),r.clearWorkspace(),l?.clearWorkspace?.()}processLoad(e){super.processLoad(e),$$(this.ids.selectedItem).show(),a.processLoad(this.CurrentProcess),r.processLoad(this.CurrentProcess),l.processLoad(this.CurrentProcess)}}}(e)}ui(){return{id:this.ids.component,type:"space",margin:10,cols:[this.ProcessList.ui(),{view:"resizer",css:"bg_gray",width:11},this.ProcessWorkspace.ui()]}}init(e){return this.AB=e,this.warningsPropogate([this.ProcessList,this.ProcessWorkspace]),this.on("warnings",(()=>{this.ProcessList.warningsRefresh()})),this.ProcessWorkspace.on("addNew",(()=>{this.ProcessList.clickNewProcess(!0)})),this.ProcessList.on("selected",(e=>{this.select(e)})),this.ProcessList.on("deleted",(e=>{this.CurrentProcessID==e.id&&this.select(null)})),Promise.all([this.ProcessWorkspace.init(e),this.ProcessList.init(e)])}applicationLoad(e){super.applicationLoad(e),this.ProcessWorkspace.applicationLoad(e),this.ProcessList.applicationLoad(e)}show(){$$(this.ids.component).show(!1,!1);var e=this.CurrentApplication;e&&(!e.loadedProcesss||this.ProcessList?.count()<1)&&(this.ProcessList?.busy(),this.ProcessList?.applicationLoad(e),this.ProcessList?.ready())}select(e){this.CurrentProcessID=e?.id,e?this.ProcessWorkspace?.processLoad(e):this.ProcessWorkspace?.clearWorkspace()}}}(e),h=Z(e),d=function(e){const t="ab_work_pwa",i=jb(e),s=function(e){const t=(0,n.Z)(e),i=t.L(),s=e.Config.uiSettings();return new class extends t{constructor(){super("ab_work_pwa_display",{content:"",iframe:"",noSelection:""}),this.currentPage=null,this._ViewSelect={id:this.ids.noSelection,rows:[{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-file-text-o'></div>"},{view:"label",align:"center",label:i("Select a page to see a preview")},{maxHeight:s.xxxLargeSpacer,hidden:s.hideMobile}]},this._ViewIFrame={id:this.ids.iframe,view:"iframe",height:700,width:360}}ui(){const e=this.ids;return{id:e.component,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"spacer",width:10},{view:"label",label:i("Preview")},{view:"icon",icon:"fa fa-info-circle",tooltip:i("Tip"),on:{onItemClick:()=>{this.infoAlert()}}}]},{rows:[{},{cols:[{},{id:e.content,rows:[this._ViewSelect]},{}]},{}]}]}}async init(e){this.AB=e}clearWorkspace(){let e=[this._ViewSelect];webix.ui(e,$$(this.ids.content)),this.currentPage=null}infoAlert(){webix.alert({title:i("Tip"),text:i("Select a page to see it's preview here.")})}pageLoad(e,t=!1){if(!e?.route)return;let i=$$(this.ids.iframe);if(!i){let e=[this._ViewIFrame];webix.ui(e,$$(this.ids.content)),i=$$(this.ids.iframe)}if(!t&&this.currentPage?.id==e.id)return;this.currentPage=e;let n=document.location.origin,s=this.AB.Tenant.id(),o=this.currentPage.application.id,a=`${n}/mobile/app/${s}/${o}?route=${e.route}`;"tab"==e.menuType&&(a=`${n}/mobile/app/${s}/${o}?route=tabs/${e.route}`),i.load(a)}refresh(){this.pageLoad(this.currentPage,!0)}show(){$$(this.ids.component).show()}}}(e),o=function(e){const t=(0,n.Z)(e),i=e.Config.uiSettings(),s=t.L(),o=(0,N.Z)(e);return new class extends t{constructor(){super("ab_work_pwa_display",{editors:"",noSelection:""}),this._editorsByType={},this.currentPanel=null,this._handler_onChange=(e=3e3,t=!1)=>{if(!this.CurrentView)return;let i=this.currentPanel.values(),n=!1;Object.keys(i??{}).forEach((e=>{"settings"!=e&&(this.CurrentView[e]!=i[e]&&(n=!0),this.CurrentView[e]=i[e])}));var s=this.CurrentView.toObj();Object.keys(i.settings??{}).forEach((e=>{s.settings[e]!=i.settings[e]&&(n=!0),s.settings[e]=i.settings[e]})),this.CurrentView.fromValues(s);let o=this.CurrentView;this.pendingSave=!0,this.unloadListener||(this.unloadListener=this.AB.Webix.event(window,"beforeunload",(()=>{this._handler_onChange(0,!0)}))),o.__timedSave&&clearTimeout(o.__timedSave),o.__timedSave=setTimeout((async()=>{this.busy();try{await o.save(),delete o.__timedSave}catch(e){this.AB.notify.developer(e,{message:"Error trying to save the View:",view:o.toObj()}),o.AB.message({text:this.label("Error trying to save the View"),type:"error"})}finally{this.ready(),this.pendingSave=!1,this.AB.Webix.eventRemove(this.unloadListener),delete this.unloadListener,this.emit("warnings"),!n&&t||this.emit("view.changed")}}),e)},this._ViewSelect={id:this.ids.noSelection,rows:[{maxHeight:i.xxxLargeSpacer,hidden:i.hideMobile},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-file-text-o'></div>"},{view:"label",align:"center",label:s("Select a page or widget to edit")},{maxHeight:i.xxxLargeSpacer,hidden:i.hideMobile}]}}ui(){let e=this.ids;return{id:e.component,rows:[{view:"toolbar",css:"ab-data-toolbar webix_dark",cols:[{view:"spacer",width:10},{view:"label",label:s("Properties")},{view:"icon",icon:"fa fa-info-circle",tooltip:s("Tip"),on:{onItemClick:()=>{this.infoAlert()}}}]},{id:e.editors,rows:[this._ViewSelect]}]}}async init(e){this.AB=e,o.mobileViews().forEach((e=>{this._editorsByType[e.key]=e}))}clearWorkspace(){let e=[this._ViewSelect];webix.ui(e,$$(this.ids.editors))}infoAlert(){webix.alert({title:s("Tip"),text:s("Edit a widgets properties here.")})}show(){$$(this.ids.component).expand()}viewLoad(e){if(this.currentPanel&&e.id!=this.CurrentViewID&&(this.pendingSave&&this._handler_onChange(10,!0),this.currentPanel.removeAllListeners("changed"),this.currentPanel=null),e.id!=this.CurrentViewID){super.viewLoad(e);let t=this._editorsByType[e.key];if(t){let i=new t;i.applicationLoad(this.CurrentApplication);let n=[i.ui()];webix.ui(n,$$(this.ids.editors)),i.init(this.AB),i.populate(e),i.on("changed",this._handler_onChange),this.currentPanel=i}}}ready(){const e=$$(this.ids.component);e?.enable?.(),e?.hideProgress?.()}busy(){const e=$$(this.ids.component);e?.showProgress?.({type:"icon"}),e?.disable?.()}}}(e),r=(0,n.Z)(e),l=a(e,`${t}_view_warnings`,{});return new class extends r{constructor(){super(t)}ui(){return{id:this.ids.component,view:"layout",rows:[{type:"space",margin:10,cols:[i.ui(),{view:"resizer"},s.ui(),{view:"resizer"},o.ui()]},l.ui()]}}init(e){return this.AB=e,i.on("selected",(e=>{this.select(e)})),i.on("widget.updated",(()=>{s.refresh()})),o.on("view.changed",(()=>{i.refresh(),s.refresh()})),this.warningsPropogate([i]),this.on("warnings",(()=>{i.applicationLoad(this.CurrentApplication),l.show(this.CurrentApplication.pages())})),Promise.all([s.init(e),o.init(e),i.init(e)])}applicationLoad(e){super.applicationLoad(e),i.applicationLoad(e),s.applicationLoad(e),o.applicationLoad(e),l.show(e.pages())}show(){$$(this.ids.component).show(),this.CurrentApplication&&(i?.applicationLoad(this.CurrentApplication),s?.applicationLoad(this.CurrentApplication),o?.applicationLoad(this.CurrentApplication))}select(e){e?(s.pageLoad(e),o.viewLoad(e)):(s.clearWorkspace(),o.clearWorkspace())}}}(e),u=Mb(e);return new class extends t{constructor(e={}){super("abd_work",{toolBar:"",labelAppName:"",tabbar:"",tab_object:"",tab_query:"",tab_datacollection:"",tab_processview:"",tab_interface:"",tab_pwa:"",tab_version:"",workspace:"",collapseMenu:"",expandMenu:""}),this.options=e,this.cacheSidebarItems={},this.selectedItem=this.ids.tab_object,this.expandMenu={id:this.ids.expandMenu,value:i("Expand Menu"),icon:"fa fa-fw fa-chevron-circle-right"},this.collapseMenu={id:this.ids.collapseMenu,value:i("Collapse Menu"),icon:"fa fa-fw fa-chevron-circle-left"}}scanTopic(e,t){let i=0,n={};return e&&e[t]().forEach((e=>{e.warningsEval(),i+=(e.warningsAll()||[]).length})),i&&(n.icon=this.WARNING_ICON_DARK,n.count=i),n}sidebarItems(e){let t=e?.id??null;if(!this.cacheSidebarItems[t]){const n=this.scanTopic(e,"objectsIncluded"),s=this.scanTopic(e,"queriesIncluded"),o=this.scanTopic(e,"datacollectionsIncluded"),a=this.scanTopic(e,"processes"),r=this.scanTopic(e,"pages"),l=this.scanTopic(e,"pages");this.cacheSidebarItems[t]=[{id:this.ids.tab_object,value:`${i("Objects")}`,icon:"fa fa-fw fa-database",issues:n},{id:this.ids.tab_query,value:`${i("Queries")}`,icon:"fa fa-fw fa-filter",issues:s},{id:this.ids.tab_datacollection,value:i("Data Collections"),icon:"fa fa-fw fa-table",issues:o},{id:this.ids.tab_processview,value:i("Process"),icon:"fa fa-fw fa-code-fork",issues:a},{id:this.ids.tab_interface,value:i("Interface"),icon:"fa fa-fw fa-id-card-o",issues:r},{id:this.ids.tab_pwa,value:i("PWA"),icon:"fa fa-fw fa-id-card-o",issues:l},{id:this.ids.tab_version,value:i("Version"),icon:"fa fa-fw fa-code-fork",on:{onclick:()=>{u.show()}}}],this.state?.collapsed?this.cacheSidebarItems[t]=this.cacheSidebarItems[t].concat(this.expandMenu):this.cacheSidebarItems[t]=this.cacheSidebarItems[t].concat(this.collapseMenu),setTimeout((()=>{this.cacheSidebarItems[t]=null}),500)}return this.cacheSidebarItems[t]}ui(){var e=this.expandMenu,t=this.collapseMenu,n=this.sidebarItems();return{id:this.ids.component,rows:[{view:"toolbar",id:this.ids.toolBar,autowidth:!0,elements:[{view:"button",css:"webix_transparent",label:i("Back to Applications page"),autowidth:!0,type:"icon",icon:"fa fa-arrow-left",hidden:this.options?.IsBackHidden??!1,click:()=>{this.emit("view.chooser")}},{},{view:"label",css:"appTitle",id:this.ids.labelAppName,align:"center"},{}]},{cols:[{id:this.ids.tabbar,css:"webix_dark",view:"sidebar",animate:!1,width:160,data:n,on:{onAfterSelect:i=>{i==this.ids.collapseMenu?setTimeout((()=>{this.$tabbar.remove(this.ids.collapseMenu),this.$tabbar.add(e),this.$tabbar.toggle(),this.$tabbar.select(this.selectedItem),this.saveState()}),0):i==this.ids.expandMenu?setTimeout((()=>{this.$tabbar.remove(this.ids.expandMenu),this.$tabbar.add(t),this.$tabbar.toggle(),this.$tabbar.select(this.selectedItem),this.saveState()}),0):(this.tabSwitch(i),this.selectedItem=i)}},template:function(e,t){return t.collapsed?t.icon(e,t):(e.issues?.icon||"")+t.icon(e,t)+"<span>"+e.value+"</span>"},tooltip:{template:function(e){return e.issues?.count?`${e.issues?.count} issues`:""}}},{id:this.ids.workspace,cells:[s.ui(),o.ui(),r.ui(),l.ui(),h.ui(),d.ui(),u.ui()]}]}]}}async init(e){this.AB=e,this.warningsPropogate([s,o,r,l,h,d]),this.on("warnings",(()=>{this.CurrentApplication.warningsEval(),this.refreshSideBar(this.CurrentApplication)})),s.init(e),o.init(e),r.init(e),l.init(e),h.init(e),d.init(e),u.init(e),this.$tabbar=$$(this.ids.tabbar),this.state=this.AB.Storage.get(this.ids.component),this.state&&(this.$tabbar.setState(this.state),this.state.collapsed&&setTimeout((()=>{this.$tabbar.remove(this.ids.collapseMenu),this.$tabbar.add(this.expandMenu)}),0)),this.tabSwitch(this.ids.tab_object),this.$tabbar.select(this.ids.tab_object)}applicationInit(e){if(e){var t=$$(this.ids.labelAppName);t.define("label",e?.label),t.refresh()}super.applicationLoad(e)}saveState(){this.state=this.$tabbar.getState(),this.AB.Storage.set(this.ids.component,this.state)}show(){$$(this.ids.component).show();let e=this.$tabbar.getSelectedId();this.tabSwitch(e)}refreshSideBar(e){let t=$$(this.ids.tabbar),i=this.sidebarItems(e),n=null,s=null;e?.isMobile?(n=this.ids.tab_interface,s=this.ids.tab_pwa):(n=this.ids.tab_pwa,s=this.ids.tab_interface),this.selectedItem==n&&(this.selectedItem=s),i=i.filter((e=>e.id!=n)),t?.clearAll(),t?.define("data",i),t?.refresh(),this.$tabbar.select(this.selectedItem)}transitionWorkspace(e){this.CurrentApplicationID!=e?.id&&this.applicationInit(e),s.applicationLoad(e),o.applicationLoad(e),r.applicationLoad(e),l.applicationLoad(e),h.applicationLoad(e),d.applicationLoad(e),u.applicationLoad(e),this.refreshSideBar(e),this.show()}tabSwitch(e){switch(e){case this.ids.tab_object:s.show();break;case this.ids.tab_query:o.show();break;case this.ids.tab_datacollection:r.show();break;case this.ids.tab_processview:l.show();break;case this.ids.tab_interface:h.show();break;case this.ids.tab_pwa:d.show();break;case"interface":console.error("HEY!  Who is calling this with 'interface'?"),h.show(),this.$tabbar.select(this.ids.tab_interface);break;case this.ids.tab_version:u.show()}}}}const Wb=[];var Nb=i(8023),Zb=i.n(Nb),qb=i(1597),zb={};zb.styleTagTransform=Sb(),zb.setAttributes=Ob(),zb.insert=wb().bind(null,"head"),zb.domAPI=bb(),zb.insertStyleElement=$b(),mb()(qb.Z,zb),qb.Z&&qb.Z.locals&&qb.Z.locals,window.__AB_Plugins=window.__AB_Plugins||[],window.__AB_Plugins.push({version:"0.0.0",key:"ABDesigner",apply:function(e){e.scriptLoadAll(this.scripts()),e.cssLoadAll(this.stylesheets()),e.pluginLoad(function(e){var t=function(e){const t=(0,n.Z)(e),i=l(e),s=Qb(e);var o=t.L();return new class extends t{constructor(){super("abd"),this.id=this.ids.component,this.icon="connectdevelop"}label(){return o("AB Designer")}type(){return"page"}pages(){return[]}component(){return{ui:this.ui(),init:()=>this.init(e),onShow:()=>{this.show()}}}getUserAccess(){return 2}ui(){return{id:this.ids.component,view:"multiview",borderless:!0,animate:!1,rows:[i.ui(),s.ui()]}}async init(e){this.AB=e,i.on("view.workplace",(e=>{s.transitionWorkspace(e)})),s.on("view.chooser",(()=>{i.show()})),s.on("warnings",(()=>{i.emit("warnings")})),await Promise.all([i.init(e),s.init(e)]);try{await this.AB.Network.post({url:"/definition/register"})}catch(e){"E_NOPERM"==e?.code&&this.AB.notify.developer(e,{plugin:"ABDesigner",context:"ui::init():/definition/register",msg:"User is not able to access /definition/register"})}}isRoot(){return!0}show(){super.show(),i.show()}}}(e),i={id:"ABDesigner",label:"AB Designer",icon:"fa-connectdevelop",isPlugin:!0,pages:function(){return this._pages},_pages:[t],datacollectionsIncluded:()=>{var t=[];return e.datacollections((e=>t.indexOf(e.id)>-1))}};return t.application=i,function(e){Wb.forEach((t=>{new t(e)}))}(e),i}(e))},definitions:function(){return t()},labels:function(e){return Zb()[e]||Zb().en},scripts:function(){return[]},stylesheets:function(){return[]}})})()})();